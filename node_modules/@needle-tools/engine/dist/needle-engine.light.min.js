var Nq=Object.defineProperty,zq=(n,e,i)=>e in n?Nq(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,p=(n,e,i)=>(zq(n,typeof e!="symbol"?e+"":e,i),i),jT=(n,e,i)=>{if(!e.has(n))throw TypeError("Cannot "+i)},vi=(n,e,i)=>(jT(n,e,"read from private field"),i?i.call(n):e.get(n)),xa=(n,e,i)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,i)},Ql=(n,e,i,r)=>(jT(n,e,"write to private field"),r?r.call(n,i):e.set(n,i),i),Em=(n,e,i)=>(jT(n,e,"access private method"),i);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Kc="162",pp={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},fp={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},kU=0,GT=1,OU=2,jq=3,Gq=0,HT=1,VT=2,Wl=3,Fn=0,an=1,yi=2,ln=0,fu=1,mp=2,QT=3,WT=4,XT=5,mu=100,DU=101,LU=102,qT=103,A_=104,UU=200,FU=201,NU=202,zU=203,b_=204,x_=205,jU=206,GU=207,HU=208,VU=209,QU=210,WU=211,XU=212,qU=213,YU=214,YT=0,__=1,Xv=2,gp=3,Mm=4,w_=5,S_=6,qv=7,Yv=0,JU=1,KU=2,Xs=0,Tm=1,Jv=2,ZU=3,Kv=4,$U=5,Im=6,vp=7,JT="attached",eF="detached",C_=300,Zc=301,gu=302,qs=303,Rm=304,Pm=306,Ao=1e3,Yn=1001,yp=1002,Rt=1003,Bm=1004,Hq=1004,$c=1005,Vq=1005,Dt=1006,Ap=1007,Qq=1007,bo=1008,Wq=1008,cn=1009,E_=1010,KT=1011,Zv=1012,bp=1013,_s=1014,Hi=1015,ur=1016,ZT=1017,$T=1018,eh=1020,tF=1021,Ti=1023,M_=1024,iF=1025,vu=1026,yu=1027,xp=1028,T_=1029,I_=1030,$v=1031,km=1033,R_=33776,P_=33777,B_=33778,k_=33779,eI=35840,tI=35841,iI=35842,nI=35843,rI=36196,sI=37492,oI=37496,aI=37808,lI=37809,cI=37810,hI=37811,uI=37812,dI=37813,pI=37814,fI=37815,mI=37816,gI=37817,vI=37818,yI=37819,AI=37820,bI=37821,O_=36492,xI=36494,_I=36495,nF=36283,wI=36284,SI=36285,CI=36286,ey=2200,EI=2201,rF=2202,Au=2300,Xl=2301,D_=2302,_p=2400,wp=2401,ty=2402,L_=2500,MI=2501,sF=0,TI=1,U_=2,oF=3e3,II=3001,Wr=3200,F_=3201,bu=0,aF=1,xo="",gt="srgb",Ii="srgb-linear",N_="display-p3",iy="display-p3-linear",ny="linear",Vi="srgb",ry="rec709",sy="p3",lF=0,xu=7680,cF=7681,hF=7682,uF=7683,dF=34055,pF=34056,fF=5386,RI=512,mF=513,gF=514,vF=515,yF=516,AF=517,bF=518,z_=519,xF=512,_F=513,wF=514,PI=515,SF=516,CF=517,EF=518,MF=519,oy=35044,ws=35048,Xq=35040,qq=35045,Yq=35049,Jq=35041,Kq=35046,Zq=35050,$q=35042,eY="100",j_="300 es",G_=1035,ql=2e3,ay=2001;let wr=class{addEventListener(n,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[n]===void 0&&(i[n]=[]),i[n].indexOf(e)===-1&&i[n].push(e)}hasEventListener(n,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[n]!==void 0&&i[n].indexOf(e)!==-1}removeEventListener(n,e){if(this._listeners===void 0)return;const i=this._listeners[n];if(i!==void 0){const r=i.indexOf(e);r!==-1&&i.splice(r,1)}}dispatchEvent(n){if(this._listeners===void 0)return;const e=this._listeners[n.type];if(e!==void 0){n.target=this;const i=e.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,n);n.target=null}}};const Ss=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let TF=1234567;const Sp=Math.PI/180,Om=180/Math.PI;function No(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ss[n&255]+Ss[n>>8&255]+Ss[n>>16&255]+Ss[n>>24&255]+"-"+Ss[e&255]+Ss[e>>8&255]+"-"+Ss[e>>16&15|64]+Ss[e>>24&255]+"-"+Ss[i&63|128]+Ss[i>>8&255]+"-"+Ss[i>>16&255]+Ss[i>>24&255]+Ss[r&255]+Ss[r>>8&255]+Ss[r>>16&255]+Ss[r>>24&255]).toLowerCase()}function In(n,e,i){return Math.max(e,Math.min(i,n))}function BI(n,e){return(n%e+e)%e}function tY(n,e,i,r,s){return r+(n-e)*(s-r)/(i-e)}function iY(n,e,i){return n!==e?(i-n)/(e-n):0}function ly(n,e,i){return(1-i)*n+i*e}function nY(n,e,i,r){return ly(n,e,1-Math.exp(-i*r))}function rY(n,e=1){return e-Math.abs(BI(n,e*2)-e)}function sY(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*(3-2*n))}function oY(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*n*(n*(n*6-15)+10))}function aY(n,e){return n+Math.floor(Math.random()*(e-n+1))}function lY(n,e){return n+Math.random()*(e-n)}function cY(n){return n*(.5-Math.random())}function hY(n){n!==void 0&&(TF=n);let e=TF+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function uY(n){return n*Sp}function dY(n){return n*Om}function kI(n){return(n&n-1)===0&&n!==0}function pY(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function H_(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function fY(n,e,i,r,s){const o=Math.cos,a=Math.sin,l=o(i/2),c=a(i/2),h=o((e+r)/2),u=a((e+r)/2),d=o((e-r)/2),f=a((e-r)/2),m=o((r-e)/2),g=a((r-e)/2);switch(s){case"XYX":n.set(l*u,c*d,c*f,l*h);break;case"YZY":n.set(c*f,l*u,c*d,l*h);break;case"ZXZ":n.set(c*d,c*f,l*u,l*h);break;case"XZX":n.set(l*u,c*g,c*m,l*h);break;case"YXY":n.set(c*m,l*u,c*g,l*h);break;case"ZYZ":n.set(c*g,c*m,l*u,l*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Ys(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Xt(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const pi={DEG2RAD:Sp,RAD2DEG:Om,generateUUID:No,clamp:In,euclideanModulo:BI,mapLinear:tY,inverseLerp:iY,lerp:ly,damp:nY,pingpong:rY,smoothstep:sY,smootherstep:oY,randInt:aY,randFloat:lY,randFloatSpread:cY,seededRandom:hY,degToRad:uY,radToDeg:dY,isPowerOfTwo:kI,ceilPowerOfTwo:pY,floorPowerOfTwo:H_,setQuaternionFromProperEuler:fY,normalize:Xt,denormalize:Ys};let J=class Tq{constructor(e=0,i=0){Tq.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,r=this.y,s=e.elements;return this.x=s[0]*i+s[3]*r+s[6],this.y=s[1]*i+s[4]*r+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(In(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y;return i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const r=Math.cos(i),s=Math.sin(i),o=this.x-e.x,a=this.y-e.y;return this.x=o*r-a*s+e.x,this.y=o*s+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Lt=class Iq{constructor(e,i,r,s,o,a,l,c,h){Iq.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,r,s,o,a,l,c,h)}set(e,i,r,s,o,a,l,c,h){const u=this.elements;return u[0]=e,u[1]=s,u[2]=l,u[3]=i,u[4]=o,u[5]=c,u[6]=r,u[7]=a,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(e,i,r){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,s=i.elements,o=this.elements,a=r[0],l=r[3],c=r[6],h=r[1],u=r[4],d=r[7],f=r[2],m=r[5],g=r[8],v=s[0],y=s[3],A=s[6],b=s[1],x=s[4],_=s[7],w=s[2],T=s[5],M=s[8];return o[0]=a*v+l*b+c*w,o[3]=a*y+l*x+c*T,o[6]=a*A+l*_+c*M,o[1]=h*v+u*b+d*w,o[4]=h*y+u*x+d*T,o[7]=h*A+u*_+d*M,o[2]=f*v+m*b+g*w,o[5]=f*y+m*x+g*T,o[8]=f*A+m*_+g*M,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8];return i*a*u-i*l*h-r*o*u+r*l*c+s*o*h-s*a*c}invert(){const e=this.elements,i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=u*a-l*h,f=l*c-u*o,m=h*o-a*c,g=i*d+r*f+s*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/g;return e[0]=d*v,e[1]=(s*h-u*r)*v,e[2]=(l*r-s*a)*v,e[3]=f*v,e[4]=(u*i-s*c)*v,e[5]=(s*o-l*i)*v,e[6]=m*v,e[7]=(r*c-h*i)*v,e[8]=(a*i-r*o)*v,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,r,s,o,a,l){const c=Math.cos(o),h=Math.sin(o);return this.set(r*c,r*h,-r*(c*a+h*l)+a+e,-s*h,s*c,-s*(-h*a+c*l)+l+i,0,0,1),this}scale(e,i){return this.premultiply(OI.makeScale(e,i)),this}rotate(e){return this.premultiply(OI.makeRotation(-e)),this}translate(e,i){return this.premultiply(OI.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,r=e.elements;for(let s=0;s<9;s++)if(i[s]!==r[s])return!1;return!0}fromArray(e,i=0){for(let r=0;r<9;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const OI=new Lt;function IF(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const mY={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Dm(n,e){return new mY[n](e)}function cy(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function RF(){const n=cy("canvas");return n.style.display="block",n}const PF={};function BF(n){n in PF||(PF[n]=!0,console.warn(n))}const kF=new Lt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),OF=new Lt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),V_={[Ii]:{transfer:ny,primaries:ry,toReference:n=>n,fromReference:n=>n},[gt]:{transfer:Vi,primaries:ry,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[iy]:{transfer:ny,primaries:sy,toReference:n=>n.applyMatrix3(OF),fromReference:n=>n.applyMatrix3(kF)},[N_]:{transfer:Vi,primaries:sy,toReference:n=>n.convertSRGBToLinear().applyMatrix3(OF),fromReference:n=>n.applyMatrix3(kF).convertLinearToSRGB()}},gY=new Set([Ii,iy]),xi={enabled:!0,_workingColorSpace:Ii,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!gY.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,i){if(this.enabled===!1||e===i||!e||!i)return n;const r=V_[e].toReference,s=V_[i].fromReference;return s(r(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return V_[n].primaries},getTransfer:function(n){return n===xo?ny:V_[n].transfer}};function Lm(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function DI(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Um,LI=class{static getDataURL(n){if(/^data:/i.test(n.src)||typeof HTMLCanvasElement>"u")return n.src;let e;if(n instanceof HTMLCanvasElement)e=n;else{Um===void 0&&(Um=cy("canvas")),Um.width=n.width,Um.height=n.height;const i=Um.getContext("2d");n instanceof ImageData?i.putImageData(n,0,0):i.drawImage(n,0,0,n.width,n.height),e=Um}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",n),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(n){if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap){const e=cy("canvas");e.width=n.width,e.height=n.height;const i=e.getContext("2d");i.drawImage(n,0,0,n.width,n.height);const r=i.getImageData(0,0,n.width,n.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=Lm(s[o]/255)*255;return i.putImageData(r,0,0),e}else if(n.data){const e=n.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Lm(e[i]/255)*255):e[i]=Lm(e[i]);return{data:e,width:n.width,height:n.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),n}},vY=0,th=class{constructor(n=null){this.isSource=!0,Object.defineProperty(this,"id",{value:vY++}),this.uuid=No(),this.data=n,this.dataReady=!0,this.version=0}set needsUpdate(n){n===!0&&this.version++}toJSON(n){const e=n===void 0||typeof n=="string";if(!e&&n.images[this.uuid]!==void 0)return n.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(UI(r[o].image)):s.push(UI(r[o]))}else s=UI(r);i.url=s}return e||(n.images[this.uuid]=i),i}};function UI(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?LI.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let yY=0,Gt=class AT extends wr{constructor(e=AT.DEFAULT_IMAGE,i=AT.DEFAULT_MAPPING,r=Yn,s=Yn,o=Dt,a=bo,l=Ti,c=cn,h=AT.DEFAULT_ANISOTROPY,u=xo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:yY++}),this.uuid=No(),this.name="",this.source=new th(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=h,this.format=l,this.internalFormat=null,this.type=c,this.offset=new J(0,0),this.repeat=new J(1,1),this.center=new J(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Lt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==C_)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ao:e.x=e.x-Math.floor(e.x);break;case Yn:e.x=e.x<0?0:1;break;case yp:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ao:e.y=e.y-Math.floor(e.y);break;case Yn:e.y=e.y<0?0:1;break;case yp:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Gt.DEFAULT_IMAGE=null,Gt.DEFAULT_MAPPING=C_,Gt.DEFAULT_ANISOTROPY=1;let qe=class Rq{constructor(e=0,i=0,r=0,s=1){Rq.prototype.isVector4=!0,this.x=e,this.y=i,this.z=r,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,r,s){return this.x=e,this.y=i,this.z=r,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,r=this.y,s=this.z,o=this.w,a=e.elements;return this.x=a[0]*i+a[4]*r+a[8]*s+a[12]*o,this.y=a[1]*i+a[5]*r+a[9]*s+a[13]*o,this.z=a[2]*i+a[6]*r+a[10]*s+a[14]*o,this.w=a[3]*i+a[7]*r+a[11]*s+a[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,r,s,o;const a=e.elements,l=a[0],c=a[4],h=a[8],u=a[1],d=a[5],f=a[9],m=a[2],g=a[6],v=a[10];if(Math.abs(c-u)<.01&&Math.abs(h-m)<.01&&Math.abs(f-g)<.01){if(Math.abs(c+u)<.1&&Math.abs(h+m)<.1&&Math.abs(f+g)<.1&&Math.abs(l+d+v-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const A=(l+1)/2,b=(d+1)/2,x=(v+1)/2,_=(c+u)/4,w=(h+m)/4,T=(f+g)/4;return A>b&&A>x?A<.01?(r=0,s=.707106781,o=.707106781):(r=Math.sqrt(A),s=_/r,o=w/r):b>x?b<.01?(r=.707106781,s=0,o=.707106781):(s=Math.sqrt(b),r=_/s,o=T/s):x<.01?(r=.707106781,s=.707106781,o=0):(o=Math.sqrt(x),r=w/o,s=T/o),this.set(r,s,o,i),this}let y=Math.sqrt((g-f)*(g-f)+(h-m)*(h-m)+(u-c)*(u-c));return Math.abs(y)<.001&&(y=1),this.x=(g-f)/y,this.y=(h-m)/y,this.z=(u-c)/y,this.w=Math.acos((l+d+v-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this.w=e.w+(i.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class DF extends wr{constructor(e=1,i=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new qe(0,0,e,i),this.scissorTest=!1,this.viewport=new qe(0,0,e,i);const s={width:e,height:i,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Dt,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},r);const o=new Gt(s,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);o.flipY=!1,o.generateMipmaps=r.generateMipmaps,o.internalFormat=r.internalFormat,this.textures=[];const a=r.count;for(let l=0;l<a;l++)this.textures[l]=o.clone(),this.textures[l].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,i,r=1){if(this.width!==e||this.height!==i||this.depth!==r){this.width=e,this.height=i,this.depth=r;for(let s=0,o=this.textures.length;s<o;s++)this.textures[s].image.width=e,this.textures[s].image.height=i,this.textures[s].image.depth=r;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,s=e.textures.length;r<s;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const i=Object.assign({},e.texture.image);return this.texture.source=new th(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class qt extends DF{constructor(e=1,i=1,r={}){super(e,i,r),this.isWebGLRenderTarget=!0}}class Q_ extends Gt{constructor(e=null,i=1,r=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:r,depth:s},this.magFilter=Rt,this.minFilter=Rt,this.wrapR=Yn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class AY extends qt{constructor(e=1,i=1,r=1,s={}){super(e,i,s),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new Q_(null,e,i,r),this.texture.isRenderTargetTexture=!0}}let FI=class extends Gt{constructor(n=null,e=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:n,width:e,height:i,depth:r},this.magFilter=Rt,this.minFilter=Rt,this.wrapR=Yn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class bY extends qt{constructor(e=1,i=1,r=1,s={}){super(e,i,s),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new FI(null,e,i,r),this.texture.isRenderTargetTexture=!0}}let Ce=class{constructor(n=0,e=0,i=0,r=1){this.isQuaternion=!0,this._x=n,this._y=e,this._z=i,this._w=r}static slerpFlat(n,e,i,r,s,o,a){let l=i[r+0],c=i[r+1],h=i[r+2],u=i[r+3];const d=s[o+0],f=s[o+1],m=s[o+2],g=s[o+3];if(a===0){n[e+0]=l,n[e+1]=c,n[e+2]=h,n[e+3]=u;return}if(a===1){n[e+0]=d,n[e+1]=f,n[e+2]=m,n[e+3]=g;return}if(u!==g||l!==d||c!==f||h!==m){let v=1-a;const y=l*d+c*f+h*m+u*g,A=y>=0?1:-1,b=1-y*y;if(b>Number.EPSILON){const _=Math.sqrt(b),w=Math.atan2(_,y*A);v=Math.sin(v*w)/_,a=Math.sin(a*w)/_}const x=a*A;if(l=l*v+d*x,c=c*v+f*x,h=h*v+m*x,u=u*v+g*x,v===1-a){const _=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=_,c*=_,h*=_,u*=_}}n[e]=l,n[e+1]=c,n[e+2]=h,n[e+3]=u}static multiplyQuaternionsFlat(n,e,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],h=i[r+3],u=s[o],d=s[o+1],f=s[o+2],m=s[o+3];return n[e]=a*m+h*u+l*f-c*d,n[e+1]=l*m+h*d+c*u-a*f,n[e+2]=c*m+h*f+a*d-l*u,n[e+3]=h*m-a*u-l*d-c*f,n}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get w(){return this._w}set w(n){this._w=n,this._onChangeCallback()}set(n,e,i,r){return this._x=n,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(n){return this._x=n.x,this._y=n.y,this._z=n.z,this._w=n.w,this._onChangeCallback(),this}setFromEuler(n,e=!0){const i=n._x,r=n._y,s=n._z,o=n._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(r/2),u=a(s/2),d=l(i/2),f=l(r/2),m=l(s/2);switch(o){case"XYZ":this._x=d*h*u+c*f*m,this._y=c*f*u-d*h*m,this._z=c*h*m+d*f*u,this._w=c*h*u-d*f*m;break;case"YXZ":this._x=d*h*u+c*f*m,this._y=c*f*u-d*h*m,this._z=c*h*m-d*f*u,this._w=c*h*u+d*f*m;break;case"ZXY":this._x=d*h*u-c*f*m,this._y=c*f*u+d*h*m,this._z=c*h*m+d*f*u,this._w=c*h*u-d*f*m;break;case"ZYX":this._x=d*h*u-c*f*m,this._y=c*f*u+d*h*m,this._z=c*h*m-d*f*u,this._w=c*h*u+d*f*m;break;case"YZX":this._x=d*h*u+c*f*m,this._y=c*f*u+d*h*m,this._z=c*h*m-d*f*u,this._w=c*h*u-d*f*m;break;case"XZY":this._x=d*h*u-c*f*m,this._y=c*f*u-d*h*m,this._z=c*h*m+d*f*u,this._w=c*h*u+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(n,e){const i=e/2,r=Math.sin(i);return this._x=n.x*r,this._y=n.y*r,this._z=n.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(n){const e=n.elements,i=e[0],r=e[4],s=e[8],o=e[1],a=e[5],l=e[9],c=e[2],h=e[6],u=e[10],d=i+a+u;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(h-l)*f,this._y=(s-c)*f,this._z=(o-r)*f}else if(i>a&&i>u){const f=2*Math.sqrt(1+i-a-u);this._w=(h-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+c)/f}else if(a>u){const f=2*Math.sqrt(1+a-i-u);this._w=(s-c)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+h)/f}else{const f=2*Math.sqrt(1+u-i-a);this._w=(o-r)/f,this._x=(s+c)/f,this._y=(l+h)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(n,e){let i=n.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(n.x)>Math.abs(n.z)?(this._x=-n.y,this._y=n.x,this._z=0,this._w=i):(this._x=0,this._y=-n.z,this._z=n.y,this._w=i)):(this._x=n.y*e.z-n.z*e.y,this._y=n.z*e.x-n.x*e.z,this._z=n.x*e.y-n.y*e.x,this._w=i),this.normalize()}angleTo(n){return 2*Math.acos(Math.abs(In(this.dot(n),-1,1)))}rotateTowards(n,e){const i=this.angleTo(n);if(i===0)return this;const r=Math.min(1,e/i);return this.slerp(n,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(n){return this._x*n._x+this._y*n._y+this._z*n._z+this._w*n._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let n=this.length();return n===0?(this._x=0,this._y=0,this._z=0,this._w=1):(n=1/n,this._x=this._x*n,this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this._onChangeCallback(),this}multiply(n){return this.multiplyQuaternions(this,n)}premultiply(n){return this.multiplyQuaternions(n,this)}multiplyQuaternions(n,e){const i=n._x,r=n._y,s=n._z,o=n._w,a=e._x,l=e._y,c=e._z,h=e._w;return this._x=i*h+o*a+r*c-s*l,this._y=r*h+o*l+s*a-i*c,this._z=s*h+o*c+i*l-r*a,this._w=o*h-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(n,e){if(e===0)return this;if(e===1)return this.copy(n);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*n._w+i*n._x+r*n._y+s*n._z;if(a<0?(this._w=-n._w,this._x=-n._x,this._y=-n._y,this._z=-n._z,a=-a):this.copy(n),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-e;return this._w=f*o+e*this._w,this._x=f*i+e*this._x,this._y=f*r+e*this._y,this._z=f*s+e*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),u=Math.sin((1-e)*h)/c,d=Math.sin(e*h)/c;return this._w=o*u+this._w*d,this._x=i*u+this._x*d,this._y=r*u+this._y*d,this._z=s*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(n,e,i){return this.copy(n).slerp(e,i)}random(){const n=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(n),r*Math.cos(n),s*Math.sin(e),s*Math.cos(e))}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._w===this._w}fromArray(n,e=0){return this._x=n[e],this._y=n[e+1],this._z=n[e+2],this._w=n[e+3],this._onChangeCallback(),this}toArray(n=[],e=0){return n[e]=this._x,n[e+1]=this._y,n[e+2]=this._z,n[e+3]=this._w,n}fromBufferAttribute(n,e){return this._x=n.getX(e),this._y=n.getY(e),this._z=n.getZ(e),this._w=n.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},S=class Pq{constructor(e=0,i=0,r=0){Pq.prototype.isVector3=!0,this.x=e,this.y=i,this.z=r}set(e,i,r){return r===void 0&&(r=this.z),this.x=e,this.y=i,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(LF.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(LF.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,r=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*r+o[6]*s,this.y=o[1]*i+o[4]*r+o[7]*s,this.z=o[2]*i+o[5]*r+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,r=this.y,s=this.z,o=e.elements,a=1/(o[3]*i+o[7]*r+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*r+o[8]*s+o[12])*a,this.y=(o[1]*i+o[5]*r+o[9]*s+o[13])*a,this.z=(o[2]*i+o[6]*r+o[10]*s+o[14])*a,this}applyQuaternion(e){const i=this.x,r=this.y,s=this.z,o=e.x,a=e.y,l=e.z,c=e.w,h=2*(a*s-l*r),u=2*(l*i-o*s),d=2*(o*r-a*i);return this.x=i+c*h+a*d-l*u,this.y=r+c*u+l*h-o*d,this.z=s+c*d+o*u-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,r=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*r+o[8]*s,this.y=o[1]*i+o[5]*r+o[9]*s,this.z=o[2]*i+o[6]*r+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const r=e.x,s=e.y,o=e.z,a=i.x,l=i.y,c=i.z;return this.x=s*c-o*l,this.y=o*a-r*c,this.z=r*l-s*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const r=e.dot(this)/i;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return NI.copy(this).projectOnVector(e),this.sub(NI)}reflect(e){return this.sub(NI.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(In(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y,s=this.z-e.z;return i*i+r*r+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,r){const s=Math.sin(i)*e;return this.x=s*Math.sin(r),this.y=Math.cos(i)*e,this.z=s*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,r){return this.x=e*Math.sin(i),this.y=r,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=r,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,r=Math.sqrt(1-i*i);return this.x=r*Math.cos(e),this.y=i,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const NI=new S,LF=new Ce;let Ht=class{constructor(n=new S(1/0,1/0,1/0),e=new S(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=n,this.max=e}set(n,e){return this.min.copy(n),this.max.copy(e),this}setFromArray(n){this.makeEmpty();for(let e=0,i=n.length;e<i;e+=3)this.expandByPoint(ol.fromArray(n,e));return this}setFromBufferAttribute(n){this.makeEmpty();for(let e=0,i=n.count;e<i;e++)this.expandByPoint(ol.fromBufferAttribute(n,e));return this}setFromPoints(n){this.makeEmpty();for(let e=0,i=n.length;e<i;e++)this.expandByPoint(n[e]);return this}setFromCenterAndSize(n,e){const i=ol.copy(e).multiplyScalar(.5);return this.min.copy(n).sub(i),this.max.copy(n).add(i),this}setFromObject(n,e=!1){return this.makeEmpty(),this.expandByObject(n,e)}clone(){return new this.constructor().copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(n){return this.isEmpty()?n.set(0,0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return this.isEmpty()?n.set(0,0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}expandByObject(n,e=!1){n.updateWorldMatrix(!1,!1);const i=n.geometry;if(i!==void 0){const s=i.getAttribute("position");if(e===!0&&s!==void 0&&n.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)n.isMesh===!0?n.getVertexPosition(o,ol):ol.fromBufferAttribute(s,o),ol.applyMatrix4(n.matrixWorld),this.expandByPoint(ol);else n.boundingBox!==void 0?(n.boundingBox===null&&n.computeBoundingBox(),W_.copy(n.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),W_.copy(i.boundingBox)),W_.applyMatrix4(n.matrixWorld),this.union(W_)}const r=n.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],e);return this}containsPoint(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y||n.z<this.min.z||n.z>this.max.z)}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y&&this.min.z<=n.min.z&&n.max.z<=this.max.z}getParameter(n,e){return e.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y),(n.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y||n.max.z<this.min.z||n.min.z>this.max.z)}intersectsSphere(n){return this.clampPoint(n.center,ol),ol.distanceToSquared(n.center)<=n.radius*n.radius}intersectsPlane(n){let e,i;return n.normal.x>0?(e=n.normal.x*this.min.x,i=n.normal.x*this.max.x):(e=n.normal.x*this.max.x,i=n.normal.x*this.min.x),n.normal.y>0?(e+=n.normal.y*this.min.y,i+=n.normal.y*this.max.y):(e+=n.normal.y*this.max.y,i+=n.normal.y*this.min.y),n.normal.z>0?(e+=n.normal.z*this.min.z,i+=n.normal.z*this.max.z):(e+=n.normal.z*this.max.z,i+=n.normal.z*this.min.z),e<=-n.constant&&i>=-n.constant}intersectsTriangle(n){if(this.isEmpty())return!1;this.getCenter(hy),X_.subVectors(this.max,hy),Fm.subVectors(n.a,hy),Nm.subVectors(n.b,hy),zm.subVectors(n.c,hy),_u.subVectors(Nm,Fm),wu.subVectors(zm,Nm),Cp.subVectors(Fm,zm);let e=[0,-_u.z,_u.y,0,-wu.z,wu.y,0,-Cp.z,Cp.y,_u.z,0,-_u.x,wu.z,0,-wu.x,Cp.z,0,-Cp.x,-_u.y,_u.x,0,-wu.y,wu.x,0,-Cp.y,Cp.x,0];return!zI(e,Fm,Nm,zm,X_)||(e=[1,0,0,0,1,0,0,0,1],!zI(e,Fm,Nm,zm,X_))?!1:(q_.crossVectors(_u,wu),e=[q_.x,q_.y,q_.z],zI(e,Fm,Nm,zm,X_))}clampPoint(n,e){return e.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return this.clampPoint(n,ol).distanceTo(n)}getBoundingSphere(n){return this.isEmpty()?n.makeEmpty():(this.getCenter(n.center),n.radius=this.getSize(ol).length()*.5),n}intersect(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}applyMatrix4(n){return this.isEmpty()?this:(ih[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(n),ih[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(n),ih[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(n),ih[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(n),ih[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(n),ih[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(n),ih[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(n),ih[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(n),this.setFromPoints(ih),this)}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}};const ih=[new S,new S,new S,new S,new S,new S,new S,new S],ol=new S,W_=new Ht,Fm=new S,Nm=new S,zm=new S,_u=new S,wu=new S,Cp=new S,hy=new S,X_=new S,q_=new S,Ep=new S;function zI(n,e,i,r,s){for(let o=0,a=n.length-3;o<=a;o+=3){Ep.fromArray(n,o);const l=s.x*Math.abs(Ep.x)+s.y*Math.abs(Ep.y)+s.z*Math.abs(Ep.z),c=e.dot(Ep),h=i.dot(Ep),u=r.dot(Ep);if(Math.max(-Math.max(c,h,u),Math.min(c,h,u))>l)return!1}return!0}const xY=new Ht,uy=new S,jI=new S;let Zi=class{constructor(n=new S,e=-1){this.isSphere=!0,this.center=n,this.radius=e}set(n,e){return this.center.copy(n),this.radius=e,this}setFromPoints(n,e){const i=this.center;e!==void 0?i.copy(e):xY.setFromPoints(n).getCenter(i);let r=0;for(let s=0,o=n.length;s<o;s++)r=Math.max(r,i.distanceToSquared(n[s]));return this.radius=Math.sqrt(r),this}copy(n){return this.center.copy(n.center),this.radius=n.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(n){return n.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(n){return n.distanceTo(this.center)-this.radius}intersectsSphere(n){const e=this.radius+n.radius;return n.center.distanceToSquared(this.center)<=e*e}intersectsBox(n){return n.intersectsSphere(this)}intersectsPlane(n){return Math.abs(n.distanceToPoint(this.center))<=this.radius}clampPoint(n,e){const i=this.center.distanceToSquared(n);return e.copy(n),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(n){return this.isEmpty()?(n.makeEmpty(),n):(n.set(this.center,this.center),n.expandByScalar(this.radius),n)}applyMatrix4(n){return this.center.applyMatrix4(n),this.radius=this.radius*n.getMaxScaleOnAxis(),this}translate(n){return this.center.add(n),this}expandByPoint(n){if(this.isEmpty())return this.center.copy(n),this.radius=0,this;uy.subVectors(n,this.center);const e=uy.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),r=(i-this.radius)*.5;this.center.addScaledVector(uy,r/i),this.radius+=r}return this}union(n){return n.isEmpty()?this:this.isEmpty()?(this.copy(n),this):(this.center.equals(n.center)===!0?this.radius=Math.max(this.radius,n.radius):(jI.subVectors(n.center,this.center).setLength(n.radius),this.expandByPoint(uy.copy(n.center).add(jI)),this.expandByPoint(uy.copy(n.center).sub(jI))),this)}equals(n){return n.center.equals(this.center)&&n.radius===this.radius}clone(){return new this.constructor().copy(this)}};const nh=new S,GI=new S,Y_=new S,Su=new S,HI=new S,J_=new S,VI=new S;let Js=class{constructor(n=new S,e=new S(0,0,-1)){this.origin=n,this.direction=e}set(n,e){return this.origin.copy(n),this.direction.copy(e),this}copy(n){return this.origin.copy(n.origin),this.direction.copy(n.direction),this}at(n,e){return e.copy(this.origin).addScaledVector(this.direction,n)}lookAt(n){return this.direction.copy(n).sub(this.origin).normalize(),this}recast(n){return this.origin.copy(this.at(n,nh)),this}closestPointToPoint(n,e){e.subVectors(n,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(n){return Math.sqrt(this.distanceSqToPoint(n))}distanceSqToPoint(n){const e=nh.subVectors(n,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(n):(nh.copy(this.origin).addScaledVector(this.direction,e),nh.distanceToSquared(n))}distanceSqToSegment(n,e,i,r){GI.copy(n).add(e).multiplyScalar(.5),Y_.copy(e).sub(n).normalize(),Su.copy(this.origin).sub(GI);const s=n.distanceTo(e)*.5,o=-this.direction.dot(Y_),a=Su.dot(this.direction),l=-Su.dot(Y_),c=Su.lengthSq(),h=Math.abs(1-o*o);let u,d,f,m;if(h>0)if(u=o*l-a,d=o*a-l,m=s*h,u>=0)if(d>=-m)if(d<=m){const g=1/h;u*=g,d*=g,f=u*(u+o*d+2*a)+d*(o*u+d+2*l)+c}else d=s,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;else d=-s,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;else d<=-m?(u=Math.max(0,-(-o*s+a)),d=u>0?-s:Math.min(Math.max(-s,-l),s),f=-u*u+d*(d+2*l)+c):d<=m?(u=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+c):(u=Math.max(0,-(o*s+a)),d=u>0?s:Math.min(Math.max(-s,-l),s),f=-u*u+d*(d+2*l)+c);else d=o>0?-s:s,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(GI).addScaledVector(Y_,d),f}intersectSphere(n,e){nh.subVectors(n.center,this.origin);const i=nh.dot(this.direction),r=nh.dot(nh)-i*i,s=n.radius*n.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,e):this.at(a,e)}intersectsSphere(n){return this.distanceSqToPoint(n.center)<=n.radius*n.radius}distanceToPlane(n){const e=n.normal.dot(this.direction);if(e===0)return n.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(n.normal)+n.constant)/e;return i>=0?i:null}intersectPlane(n,e){const i=this.distanceToPlane(n);return i===null?null:this.at(i,e)}intersectsPlane(n){const e=n.distanceToPoint(this.origin);return e===0||n.normal.dot(this.direction)*e<0}intersectBox(n,e){let i,r,s,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(i=(n.min.x-d.x)*c,r=(n.max.x-d.x)*c):(i=(n.max.x-d.x)*c,r=(n.min.x-d.x)*c),h>=0?(s=(n.min.y-d.y)*h,o=(n.max.y-d.y)*h):(s=(n.max.y-d.y)*h,o=(n.min.y-d.y)*h),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),u>=0?(a=(n.min.z-d.z)*u,l=(n.max.z-d.z)*u):(a=(n.max.z-d.z)*u,l=(n.min.z-d.z)*u),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,e)}intersectsBox(n){return this.intersectBox(n,nh)!==null}intersectTriangle(n,e,i,r,s){HI.subVectors(e,n),J_.subVectors(i,n),VI.crossVectors(HI,J_);let o=this.direction.dot(VI),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Su.subVectors(this.origin,n);const l=a*this.direction.dot(J_.crossVectors(Su,J_));if(l<0)return null;const c=a*this.direction.dot(HI.cross(Su));if(c<0||l+c>o)return null;const h=-a*Su.dot(VI);return h<0?null:this.at(h/o,s)}applyMatrix4(n){return this.origin.applyMatrix4(n),this.direction.transformDirection(n),this}equals(n){return n.origin.equals(this.origin)&&n.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},he=class xU{constructor(e,i,r,s,o,a,l,c,h,u,d,f,m,g,v,y){xU.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,r,s,o,a,l,c,h,u,d,f,m,g,v,y)}set(e,i,r,s,o,a,l,c,h,u,d,f,m,g,v,y){const A=this.elements;return A[0]=e,A[4]=i,A[8]=r,A[12]=s,A[1]=o,A[5]=a,A[9]=l,A[13]=c,A[2]=h,A[6]=u,A[10]=d,A[14]=f,A[3]=m,A[7]=g,A[11]=v,A[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new xU().fromArray(this.elements)}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(e){const i=this.elements,r=e.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,r){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,i,r){return this.set(e.x,i.x,r.x,0,e.y,i.y,r.y,0,e.z,i.z,r.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,r=e.elements,s=1/jm.setFromMatrixColumn(e,0).length(),o=1/jm.setFromMatrixColumn(e,1).length(),a=1/jm.setFromMatrixColumn(e,2).length();return i[0]=r[0]*s,i[1]=r[1]*s,i[2]=r[2]*s,i[3]=0,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,r=e.x,s=e.y,o=e.z,a=Math.cos(r),l=Math.sin(r),c=Math.cos(s),h=Math.sin(s),u=Math.cos(o),d=Math.sin(o);if(e.order==="XYZ"){const f=a*u,m=a*d,g=l*u,v=l*d;i[0]=c*u,i[4]=-c*d,i[8]=h,i[1]=m+g*h,i[5]=f-v*h,i[9]=-l*c,i[2]=v-f*h,i[6]=g+m*h,i[10]=a*c}else if(e.order==="YXZ"){const f=c*u,m=c*d,g=h*u,v=h*d;i[0]=f+v*l,i[4]=g*l-m,i[8]=a*h,i[1]=a*d,i[5]=a*u,i[9]=-l,i[2]=m*l-g,i[6]=v+f*l,i[10]=a*c}else if(e.order==="ZXY"){const f=c*u,m=c*d,g=h*u,v=h*d;i[0]=f-v*l,i[4]=-a*d,i[8]=g+m*l,i[1]=m+g*l,i[5]=a*u,i[9]=v-f*l,i[2]=-a*h,i[6]=l,i[10]=a*c}else if(e.order==="ZYX"){const f=a*u,m=a*d,g=l*u,v=l*d;i[0]=c*u,i[4]=g*h-m,i[8]=f*h+v,i[1]=c*d,i[5]=v*h+f,i[9]=m*h-g,i[2]=-h,i[6]=l*c,i[10]=a*c}else if(e.order==="YZX"){const f=a*c,m=a*h,g=l*c,v=l*h;i[0]=c*u,i[4]=v-f*d,i[8]=g*d+m,i[1]=d,i[5]=a*u,i[9]=-l*u,i[2]=-h*u,i[6]=m*d+g,i[10]=f-v*d}else if(e.order==="XZY"){const f=a*c,m=a*h,g=l*c,v=l*h;i[0]=c*u,i[4]=-d,i[8]=h*u,i[1]=f*d+v,i[5]=a*u,i[9]=m*d-g,i[2]=g*d-m,i[6]=l*u,i[10]=v*d+f}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_Y,e,wY)}lookAt(e,i,r){const s=this.elements;return zo.subVectors(e,i),zo.lengthSq()===0&&(zo.z=1),zo.normalize(),Cu.crossVectors(r,zo),Cu.lengthSq()===0&&(Math.abs(r.z)===1?zo.x+=1e-4:zo.z+=1e-4,zo.normalize(),Cu.crossVectors(r,zo)),Cu.normalize(),K_.crossVectors(zo,Cu),s[0]=Cu.x,s[4]=K_.x,s[8]=zo.x,s[1]=Cu.y,s[5]=K_.y,s[9]=zo.y,s[2]=Cu.z,s[6]=K_.z,s[10]=zo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,s=i.elements,o=this.elements,a=r[0],l=r[4],c=r[8],h=r[12],u=r[1],d=r[5],f=r[9],m=r[13],g=r[2],v=r[6],y=r[10],A=r[14],b=r[3],x=r[7],_=r[11],w=r[15],T=s[0],M=s[4],R=s[8],B=s[12],E=s[1],P=s[5],O=s[9],N=s[13],L=s[2],Q=s[6],D=s[10],F=s[14],H=s[3],K=s[7],Z=s[11],oe=s[15];return o[0]=a*T+l*E+c*L+h*H,o[4]=a*M+l*P+c*Q+h*K,o[8]=a*R+l*O+c*D+h*Z,o[12]=a*B+l*N+c*F+h*oe,o[1]=u*T+d*E+f*L+m*H,o[5]=u*M+d*P+f*Q+m*K,o[9]=u*R+d*O+f*D+m*Z,o[13]=u*B+d*N+f*F+m*oe,o[2]=g*T+v*E+y*L+A*H,o[6]=g*M+v*P+y*Q+A*K,o[10]=g*R+v*O+y*D+A*Z,o[14]=g*B+v*N+y*F+A*oe,o[3]=b*T+x*E+_*L+w*H,o[7]=b*M+x*P+_*Q+w*K,o[11]=b*R+x*O+_*D+w*Z,o[15]=b*B+x*N+_*F+w*oe,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[4],s=e[8],o=e[12],a=e[1],l=e[5],c=e[9],h=e[13],u=e[2],d=e[6],f=e[10],m=e[14],g=e[3],v=e[7],y=e[11],A=e[15];return g*(+o*c*d-s*h*d-o*l*f+r*h*f+s*l*m-r*c*m)+v*(+i*c*m-i*h*f+o*a*f-s*a*m+s*h*u-o*c*u)+y*(+i*h*d-i*l*m-o*a*d+r*a*m+o*l*u-r*h*u)+A*(-s*l*u-i*c*d+i*l*f+s*a*d-r*a*f+r*c*u)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,r){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=r),this}invert(){const e=this.elements,i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=e[9],f=e[10],m=e[11],g=e[12],v=e[13],y=e[14],A=e[15],b=d*y*h-v*f*h+v*c*m-l*y*m-d*c*A+l*f*A,x=g*f*h-u*y*h-g*c*m+a*y*m+u*c*A-a*f*A,_=u*v*h-g*d*h+g*l*m-a*v*m-u*l*A+a*d*A,w=g*d*c-u*v*c-g*l*f+a*v*f+u*l*y-a*d*y,T=i*b+r*x+s*_+o*w;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/T;return e[0]=b*M,e[1]=(v*f*o-d*y*o-v*s*m+r*y*m+d*s*A-r*f*A)*M,e[2]=(l*y*o-v*c*o+v*s*h-r*y*h-l*s*A+r*c*A)*M,e[3]=(d*c*o-l*f*o-d*s*h+r*f*h+l*s*m-r*c*m)*M,e[4]=x*M,e[5]=(u*y*o-g*f*o+g*s*m-i*y*m-u*s*A+i*f*A)*M,e[6]=(g*c*o-a*y*o-g*s*h+i*y*h+a*s*A-i*c*A)*M,e[7]=(a*f*o-u*c*o+u*s*h-i*f*h-a*s*m+i*c*m)*M,e[8]=_*M,e[9]=(g*d*o-u*v*o-g*r*m+i*v*m+u*r*A-i*d*A)*M,e[10]=(a*v*o-g*l*o+g*r*h-i*v*h-a*r*A+i*l*A)*M,e[11]=(u*l*o-a*d*o-u*r*h+i*d*h+a*r*m-i*l*m)*M,e[12]=w*M,e[13]=(u*v*s-g*d*s+g*r*f-i*v*f-u*r*y+i*d*y)*M,e[14]=(g*l*s-a*v*s-g*r*c+i*v*c+a*r*y-i*l*y)*M,e[15]=(a*d*s-u*l*s+u*r*c-i*d*c-a*r*f+i*l*f)*M,this}scale(e){const i=this.elements,r=e.x,s=e.y,o=e.z;return i[0]*=r,i[4]*=s,i[8]*=o,i[1]*=r,i[5]*=s,i[9]*=o,i[2]*=r,i[6]*=s,i[10]*=o,i[3]*=r,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,r,s))}makeTranslation(e,i,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const r=Math.cos(i),s=Math.sin(i),o=1-r,a=e.x,l=e.y,c=e.z,h=o*a,u=o*l;return this.set(h*a+r,h*l-s*c,h*c+s*l,0,h*l+s*c,u*l+r,u*c-s*a,0,h*c-s*l,u*c+s*a,o*c*c+r,0,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,i,r,s,o,a){return this.set(1,r,o,0,e,1,a,0,i,s,1,0,0,0,0,1),this}compose(e,i,r){const s=this.elements,o=i._x,a=i._y,l=i._z,c=i._w,h=o+o,u=a+a,d=l+l,f=o*h,m=o*u,g=o*d,v=a*u,y=a*d,A=l*d,b=c*h,x=c*u,_=c*d,w=r.x,T=r.y,M=r.z;return s[0]=(1-(v+A))*w,s[1]=(m+_)*w,s[2]=(g-x)*w,s[3]=0,s[4]=(m-_)*T,s[5]=(1-(f+A))*T,s[6]=(y+b)*T,s[7]=0,s[8]=(g+x)*M,s[9]=(y-b)*M,s[10]=(1-(f+v))*M,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,r){const s=this.elements;let o=jm.set(s[0],s[1],s[2]).length();const a=jm.set(s[4],s[5],s[6]).length(),l=jm.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],al.copy(this);const c=1/o,h=1/a,u=1/l;return al.elements[0]*=c,al.elements[1]*=c,al.elements[2]*=c,al.elements[4]*=h,al.elements[5]*=h,al.elements[6]*=h,al.elements[8]*=u,al.elements[9]*=u,al.elements[10]*=u,i.setFromRotationMatrix(al),r.x=o,r.y=a,r.z=l,this}makePerspective(e,i,r,s,o,a,l=ql){const c=this.elements,h=2*o/(i-e),u=2*o/(r-s),d=(i+e)/(i-e),f=(r+s)/(r-s);let m,g;if(l===ql)m=-(a+o)/(a-o),g=-2*a*o/(a-o);else if(l===ay)m=-a/(a-o),g=-a*o/(a-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return c[0]=h,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=u,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=m,c[14]=g,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,r,s,o,a,l=ql){const c=this.elements,h=1/(i-e),u=1/(r-s),d=1/(a-o),f=(i+e)*h,m=(r+s)*u;let g,v;if(l===ql)g=(a+o)*d,v=-2*d;else if(l===ay)g=o*d,v=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=v,c[14]=-g,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,r=e.elements;for(let s=0;s<16;s++)if(i[s]!==r[s])return!1;return!0}fromArray(e,i=0){for(let r=0;r<16;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],e}};const jm=new S,al=new he,_Y=new S(0,0,0),wY=new S(1,1,1),Cu=new S,K_=new S,zo=new S,UF=new he,FF=new Ce;let ri=class Bq{constructor(e=0,i=0,r=0,s=Bq.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,r,s=this._order){return this._x=e,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,r=!0){const s=e.elements,o=s[0],a=s[4],l=s[8],c=s[1],h=s[5],u=s[9],d=s[2],f=s[6],m=s[10];switch(i){case"XYZ":this._y=Math.asin(In(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,h),this._z=0);break;case"YXZ":this._x=Math.asin(-In(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(l,m),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(In(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-In(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(In(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(l,m));break;case"XZY":this._z=Math.asin(-In(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,h),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-u,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,r){return UF.makeRotationFromQuaternion(e),this.setFromRotationMatrix(UF,i,r)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return FF.setFromEuler(this),this.setFromQuaternion(FF,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};ri.DEFAULT_ORDER="XYZ";let Cs=class{constructor(){this.mask=1}set(n){this.mask=(1<<n|0)>>>0}enable(n){this.mask|=1<<n|0}enableAll(){this.mask=-1}toggle(n){this.mask^=1<<n|0}disable(n){this.mask&=~(1<<n|0)}disableAll(){this.mask=0}test(n){return(this.mask&n.mask)!==0}isEnabled(n){return(this.mask&(1<<n|0))!==0}},SY=0;const NF=new S,Gm=new Ce,rh=new he,Z_=new S,dy=new S,CY=new S,EY=new Ce,zF=new S(1,0,0),jF=new S(0,1,0),GF=new S(0,0,1),MY={type:"added"},TY={type:"removed"},QI={type:"childadded",child:null},WI={type:"childremoved",child:null};let ve=class bT extends wr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:SY++}),this.uuid=No(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=bT.DEFAULT_UP.clone();const e=new S,i=new ri,r=new Ce,s=new S(1,1,1);function o(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(o),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new he},normalMatrix:{value:new Lt}}),this.matrix=new he,this.matrixWorld=new he,this.matrixAutoUpdate=bT.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=bT.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Cs,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Gm.setFromAxisAngle(e,i),this.quaternion.multiply(Gm),this}rotateOnWorldAxis(e,i){return Gm.setFromAxisAngle(e,i),this.quaternion.premultiply(Gm),this}rotateX(e){return this.rotateOnAxis(zF,e)}rotateY(e){return this.rotateOnAxis(jF,e)}rotateZ(e){return this.rotateOnAxis(GF,e)}translateOnAxis(e,i){return NF.copy(e).applyQuaternion(this.quaternion),this.position.add(NF.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(zF,e)}translateY(e){return this.translateOnAxis(jF,e)}translateZ(e){return this.translateOnAxis(GF,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(rh.copy(this.matrixWorld).invert())}lookAt(e,i,r){e.isVector3?Z_.copy(e):Z_.set(e,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),dy.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?rh.lookAt(dy,Z_,this.up):rh.lookAt(Z_,dy,this.up),this.quaternion.setFromRotationMatrix(rh),s&&(rh.extractRotation(s.matrixWorld),Gm.setFromRotationMatrix(rh),this.quaternion.premultiply(Gm.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(MY),QI.child=e,this.dispatchEvent(QI),QI.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(TY),WI.child=e,this.dispatchEvent(WI),WI.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),rh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),rh.multiply(e.parent.matrixWorld)),e.applyMatrix4(rh),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const o=this.children[r].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,r=[]){this[e]===i&&r.push(this);const s=this.children;for(let o=0,a=s.length;o<a;o++)s[o].getObjectsByProperty(e,i,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(dy,e,CY),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(dy,EY,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++){const o=i[r];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,i){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const s=this.children;for(let o=0,a=s.length;o<a;o++){const l=s[o];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const i=e===void 0||typeof e=="string",r={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let h=0,u=c.length;h<u;h++){const d=c[h];o(e.shapes,d)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,h=this.material.length;c<h;c++)l.push(o(e.materials,this.material[c]));s.material=l}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let l=0;l<this.children.length;l++)s.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];s.animations.push(o(e.animations,c))}}if(i){const l=a(e.geometries),c=a(e.materials),h=a(e.textures),u=a(e.images),d=a(e.shapes),f=a(e.skeletons),m=a(e.animations),g=a(e.nodes);l.length>0&&(r.geometries=l),c.length>0&&(r.materials=c),h.length>0&&(r.textures=h),u.length>0&&(r.images=u),d.length>0&&(r.shapes=d),f.length>0&&(r.skeletons=f),m.length>0&&(r.animations=m),g.length>0&&(r.nodes=g)}return r.object=s,r;function a(l){const c=[];for(const h in l){const u=l[h];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let r=0;r<e.children.length;r++){const s=e.children[r];this.add(s.clone())}return this}};ve.DEFAULT_UP=new S(0,1,0),ve.DEFAULT_MATRIX_AUTO_UPDATE=!0,ve.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ll=new S,sh=new S,XI=new S,oh=new S,Hm=new S,Vm=new S,HF=new S,qI=new S,YI=new S,JI=new S;let Xr=class Uv{constructor(e=new S,i=new S,r=new S){this.a=e,this.b=i,this.c=r}static getNormal(e,i,r,s){s.subVectors(r,i),ll.subVectors(e,i),s.cross(ll);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,r,s,o){ll.subVectors(s,i),sh.subVectors(r,i),XI.subVectors(e,i);const a=ll.dot(ll),l=ll.dot(sh),c=ll.dot(XI),h=sh.dot(sh),u=sh.dot(XI),d=a*h-l*l;if(d===0)return o.set(0,0,0),null;const f=1/d,m=(h*c-l*u)*f,g=(a*u-l*c)*f;return o.set(1-m-g,g,m)}static containsPoint(e,i,r,s){return this.getBarycoord(e,i,r,s,oh)===null?!1:oh.x>=0&&oh.y>=0&&oh.x+oh.y<=1}static getInterpolation(e,i,r,s,o,a,l,c){return this.getBarycoord(e,i,r,s,oh)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,oh.x),c.addScaledVector(a,oh.y),c.addScaledVector(l,oh.z),c)}static isFrontFacing(e,i,r,s){return ll.subVectors(r,i),sh.subVectors(e,i),ll.cross(sh).dot(s)<0}set(e,i,r){return this.a.copy(e),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(e,i,r,s){return this.a.copy(e[i]),this.b.copy(e[r]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,r,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ll.subVectors(this.c,this.b),sh.subVectors(this.a,this.b),ll.cross(sh).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Uv.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return Uv.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,r,s,o){return Uv.getInterpolation(e,this.a,this.b,this.c,i,r,s,o)}containsPoint(e){return Uv.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Uv.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const r=this.a,s=this.b,o=this.c;let a,l;Hm.subVectors(s,r),Vm.subVectors(o,r),qI.subVectors(e,r);const c=Hm.dot(qI),h=Vm.dot(qI);if(c<=0&&h<=0)return i.copy(r);YI.subVectors(e,s);const u=Hm.dot(YI),d=Vm.dot(YI);if(u>=0&&d<=u)return i.copy(s);const f=c*d-u*h;if(f<=0&&c>=0&&u<=0)return a=c/(c-u),i.copy(r).addScaledVector(Hm,a);JI.subVectors(e,o);const m=Hm.dot(JI),g=Vm.dot(JI);if(g>=0&&m<=g)return i.copy(o);const v=m*h-c*g;if(v<=0&&h>=0&&g<=0)return l=h/(h-g),i.copy(r).addScaledVector(Vm,l);const y=u*g-m*d;if(y<=0&&d-u>=0&&m-g>=0)return HF.subVectors(o,s),l=(d-u)/(d-u+(m-g)),i.copy(s).addScaledVector(HF,l);const A=1/(y+v+f);return a=v*A,l=f*A,i.copy(r).addScaledVector(Hm,a).addScaledVector(Vm,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const VF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Eu={h:0,s:0,l:0},$_={h:0,s:0,l:0};function KI(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*6*(2/3-i):n}let be=class{constructor(n,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(n,e,i)}set(n,e,i){if(e===void 0&&i===void 0){const r=n;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(n,e,i);return this}setScalar(n){return this.r=n,this.g=n,this.b=n,this}setHex(n,e=gt){return n=Math.floor(n),this.r=(n>>16&255)/255,this.g=(n>>8&255)/255,this.b=(n&255)/255,xi.toWorkingColorSpace(this,e),this}setRGB(n,e,i,r=xi.workingColorSpace){return this.r=n,this.g=e,this.b=i,xi.toWorkingColorSpace(this,r),this}setHSL(n,e,i,r=xi.workingColorSpace){if(n=BI(n,1),e=In(e,0,1),i=In(i,0,1),e===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,o=2*i-s;this.r=KI(o,s,n+1/3),this.g=KI(o,s,n),this.b=KI(o,s,n-1/3)}return xi.toWorkingColorSpace(this,r),this}setStyle(n,e=gt){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+n+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(n)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+n)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(n)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+n)}else if(n&&n.length>0)return this.setColorName(n,e);return this}setColorName(n,e=gt){const i=VF[n.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+n),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(n){return this.r=n.r,this.g=n.g,this.b=n.b,this}copySRGBToLinear(n){return this.r=Lm(n.r),this.g=Lm(n.g),this.b=Lm(n.b),this}copyLinearToSRGB(n){return this.r=DI(n.r),this.g=DI(n.g),this.b=DI(n.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(n=gt){return xi.fromWorkingColorSpace(Es.copy(this),n),Math.round(In(Es.r*255,0,255))*65536+Math.round(In(Es.g*255,0,255))*256+Math.round(In(Es.b*255,0,255))}getHexString(n=gt){return("000000"+this.getHex(n).toString(16)).slice(-6)}getHSL(n,e=xi.workingColorSpace){xi.fromWorkingColorSpace(Es.copy(this),e);const i=Es.r,r=Es.g,s=Es.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=h<=.5?u/(o+a):u/(2-o-a),o){case i:l=(r-s)/u+(r<s?6:0);break;case r:l=(s-i)/u+2;break;case s:l=(i-r)/u+4;break}l/=6}return n.h=l,n.s=c,n.l=h,n}getRGB(n,e=xi.workingColorSpace){return xi.fromWorkingColorSpace(Es.copy(this),e),n.r=Es.r,n.g=Es.g,n.b=Es.b,n}getStyle(n=gt){xi.fromWorkingColorSpace(Es.copy(this),n);const e=Es.r,i=Es.g,r=Es.b;return n!==gt?`color(${n} ${e.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(n,e,i){return this.getHSL(Eu),this.setHSL(Eu.h+n,Eu.s+e,Eu.l+i)}add(n){return this.r+=n.r,this.g+=n.g,this.b+=n.b,this}addColors(n,e){return this.r=n.r+e.r,this.g=n.g+e.g,this.b=n.b+e.b,this}addScalar(n){return this.r+=n,this.g+=n,this.b+=n,this}sub(n){return this.r=Math.max(0,this.r-n.r),this.g=Math.max(0,this.g-n.g),this.b=Math.max(0,this.b-n.b),this}multiply(n){return this.r*=n.r,this.g*=n.g,this.b*=n.b,this}multiplyScalar(n){return this.r*=n,this.g*=n,this.b*=n,this}lerp(n,e){return this.r+=(n.r-this.r)*e,this.g+=(n.g-this.g)*e,this.b+=(n.b-this.b)*e,this}lerpColors(n,e,i){return this.r=n.r+(e.r-n.r)*i,this.g=n.g+(e.g-n.g)*i,this.b=n.b+(e.b-n.b)*i,this}lerpHSL(n,e){this.getHSL(Eu),n.getHSL($_);const i=ly(Eu.h,$_.h,e),r=ly(Eu.s,$_.s,e),s=ly(Eu.l,$_.l,e);return this.setHSL(i,r,s),this}setFromVector3(n){return this.r=n.x,this.g=n.y,this.b=n.z,this}applyMatrix3(n){const e=this.r,i=this.g,r=this.b,s=n.elements;return this.r=s[0]*e+s[3]*i+s[6]*r,this.g=s[1]*e+s[4]*i+s[7]*r,this.b=s[2]*e+s[5]*i+s[8]*r,this}equals(n){return n.r===this.r&&n.g===this.g&&n.b===this.b}fromArray(n,e=0){return this.r=n[e],this.g=n[e+1],this.b=n[e+2],this}toArray(n=[],e=0){return n[e]=this.r,n[e+1]=this.g,n[e+2]=this.b,n}fromBufferAttribute(n,e){return this.r=n.getX(e),this.g=n.getY(e),this.b=n.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Es=new be;be.NAMES=VF;let IY=0,Ut=class extends wr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:IY++}),this.uuid=No(),this.name="",this.type="Material",this.blending=fu,this.side=Fn,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=b_,this.blendDst=x_,this.blendEquation=mu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new be(0,0,0),this.blendAlpha=0,this.depthFunc=gp,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=z_,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=xu,this.stencilZFail=xu,this.stencilZPass=xu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(n){this._alphaTest>0!=n>0&&this.version++,this._alphaTest=n}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(n){if(n!==void 0)for(const e in n){const i=n[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];if(r===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]=i}}toJSON(n){const e=n===void 0||typeof n=="string";e&&(n={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(n).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(n).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(n).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(n).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(n).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(n).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(n).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(n).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(n).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(n).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(n).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(n).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(n).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(n).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(n).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(n).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(n).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(n).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(n).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(n).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(n).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(n).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(n).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(n).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==fu&&(i.blending=this.blending),this.side!==Fn&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==b_&&(i.blendSrc=this.blendSrc),this.blendDst!==x_&&(i.blendDst=this.blendDst),this.blendEquation!==mu&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==gp&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==z_&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==xu&&(i.stencilFail=this.stencilFail),this.stencilZFail!==xu&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==xu&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(e){const s=r(n.textures),o=r(n.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(n){this.name=n.name,this.blending=n.blending,this.side=n.side,this.vertexColors=n.vertexColors,this.opacity=n.opacity,this.transparent=n.transparent,this.blendSrc=n.blendSrc,this.blendDst=n.blendDst,this.blendEquation=n.blendEquation,this.blendSrcAlpha=n.blendSrcAlpha,this.blendDstAlpha=n.blendDstAlpha,this.blendEquationAlpha=n.blendEquationAlpha,this.blendColor.copy(n.blendColor),this.blendAlpha=n.blendAlpha,this.depthFunc=n.depthFunc,this.depthTest=n.depthTest,this.depthWrite=n.depthWrite,this.stencilWriteMask=n.stencilWriteMask,this.stencilFunc=n.stencilFunc,this.stencilRef=n.stencilRef,this.stencilFuncMask=n.stencilFuncMask,this.stencilFail=n.stencilFail,this.stencilZFail=n.stencilZFail,this.stencilZPass=n.stencilZPass,this.stencilWrite=n.stencilWrite;const e=n.clippingPlanes;let i=null;if(e!==null){const r=e.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=n.clipIntersection,this.clipShadows=n.clipShadows,this.shadowSide=n.shadowSide,this.colorWrite=n.colorWrite,this.precision=n.precision,this.polygonOffset=n.polygonOffset,this.polygonOffsetFactor=n.polygonOffsetFactor,this.polygonOffsetUnits=n.polygonOffsetUnits,this.dithering=n.dithering,this.alphaTest=n.alphaTest,this.alphaHash=n.alphaHash,this.alphaToCoverage=n.alphaToCoverage,this.premultipliedAlpha=n.premultipliedAlpha,this.forceSinglePass=n.forceSinglePass,this.visible=n.visible,this.toneMapped=n.toneMapped,this.userData=JSON.parse(JSON.stringify(n.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(n){n===!0&&this.version++}},Jt=class extends Ut{constructor(n){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new be(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ri,this.combine=Yv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapRotation.copy(n.envMapRotation),this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.fog=n.fog,this}};const ah=RY();function RY(){const n=new ArrayBuffer(4),e=new Float32Array(n),i=new Uint32Array(n),r=new Uint32Array(512),s=new Uint32Array(512);for(let c=0;c<256;++c){const h=c-127;h<-27?(r[c]=0,r[c|256]=32768,s[c]=24,s[c|256]=24):h<-14?(r[c]=1024>>-h-14,r[c|256]=1024>>-h-14|32768,s[c]=-h-1,s[c|256]=-h-1):h<=15?(r[c]=h+15<<10,r[c|256]=h+15<<10|32768,s[c]=13,s[c|256]=13):h<128?(r[c]=31744,r[c|256]=64512,s[c]=24,s[c|256]=24):(r[c]=31744,r[c|256]=64512,s[c]=13,s[c|256]=13)}const o=new Uint32Array(2048),a=new Uint32Array(64),l=new Uint32Array(64);for(let c=1;c<1024;++c){let h=c<<13,u=0;for(;!(h&8388608);)h<<=1,u-=8388608;h&=-8388609,u+=947912704,o[c]=h|u}for(let c=1024;c<2048;++c)o[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)a[c]=c<<23;a[31]=1199570944,a[32]=2147483648;for(let c=33;c<63;++c)a[c]=2147483648+(c-32<<23);a[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(l[c]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:s,mantissaTable:o,exponentTable:a,offsetTable:l}}function _o(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=In(n,-65504,65504),ah.floatView[0]=n;const e=ah.uint32View[0],i=e>>23&511;return ah.baseTable[i]+((e&8388607)>>ah.shiftTable[i])}function py(n){const e=n>>10;return ah.uint32View[0]=ah.mantissaTable[ah.offsetTable[e]+(n&1023)]+ah.exponentTable[e],ah.floatView[0]}const Mp={toHalfFloat:_o,fromHalfFloat:py},Jn=new S,ew=new J;let Ye=class{constructor(n,e,i=!1){if(Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=n,this.itemSize=e,this.count=n!==void 0?n.length/e:0,this.normalized=i,this.usage=oy,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Hi,this.version=0}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}get updateRange(){return BF("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(n){return this.usage=n,this}addUpdateRange(n,e){this.updateRanges.push({start:n,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(n){return this.name=n.name,this.array=new n.array.constructor(n.array),this.itemSize=n.itemSize,this.count=n.count,this.normalized=n.normalized,this.usage=n.usage,this.gpuType=n.gpuType,this}copyAt(n,e,i){n*=this.itemSize,i*=e.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[n+r]=e.array[i+r];return this}copyArray(n){return this.array.set(n),this}applyMatrix3(n){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)ew.fromBufferAttribute(this,e),ew.applyMatrix3(n),this.setXY(e,ew.x,ew.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Jn.fromBufferAttribute(this,e),Jn.applyMatrix3(n),this.setXYZ(e,Jn.x,Jn.y,Jn.z);return this}applyMatrix4(n){for(let e=0,i=this.count;e<i;e++)Jn.fromBufferAttribute(this,e),Jn.applyMatrix4(n),this.setXYZ(e,Jn.x,Jn.y,Jn.z);return this}applyNormalMatrix(n){for(let e=0,i=this.count;e<i;e++)Jn.fromBufferAttribute(this,e),Jn.applyNormalMatrix(n),this.setXYZ(e,Jn.x,Jn.y,Jn.z);return this}transformDirection(n){for(let e=0,i=this.count;e<i;e++)Jn.fromBufferAttribute(this,e),Jn.transformDirection(n),this.setXYZ(e,Jn.x,Jn.y,Jn.z);return this}set(n,e=0){return this.array.set(n,e),this}getComponent(n,e){let i=this.array[n*this.itemSize+e];return this.normalized&&(i=Ys(i,this.array)),i}setComponent(n,e,i){return this.normalized&&(i=Xt(i,this.array)),this.array[n*this.itemSize+e]=i,this}getX(n){let e=this.array[n*this.itemSize];return this.normalized&&(e=Ys(e,this.array)),e}setX(n,e){return this.normalized&&(e=Xt(e,this.array)),this.array[n*this.itemSize]=e,this}getY(n){let e=this.array[n*this.itemSize+1];return this.normalized&&(e=Ys(e,this.array)),e}setY(n,e){return this.normalized&&(e=Xt(e,this.array)),this.array[n*this.itemSize+1]=e,this}getZ(n){let e=this.array[n*this.itemSize+2];return this.normalized&&(e=Ys(e,this.array)),e}setZ(n,e){return this.normalized&&(e=Xt(e,this.array)),this.array[n*this.itemSize+2]=e,this}getW(n){let e=this.array[n*this.itemSize+3];return this.normalized&&(e=Ys(e,this.array)),e}setW(n,e){return this.normalized&&(e=Xt(e,this.array)),this.array[n*this.itemSize+3]=e,this}setXY(n,e,i){return n*=this.itemSize,this.normalized&&(e=Xt(e,this.array),i=Xt(i,this.array)),this.array[n+0]=e,this.array[n+1]=i,this}setXYZ(n,e,i,r){return n*=this.itemSize,this.normalized&&(e=Xt(e,this.array),i=Xt(i,this.array),r=Xt(r,this.array)),this.array[n+0]=e,this.array[n+1]=i,this.array[n+2]=r,this}setXYZW(n,e,i,r,s){return n*=this.itemSize,this.normalized&&(e=Xt(e,this.array),i=Xt(i,this.array),r=Xt(r,this.array),s=Xt(s,this.array)),this.array[n+0]=e,this.array[n+1]=i,this.array[n+2]=r,this.array[n+3]=s,this}onUpload(n){return this.onUploadCallback=n,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const n={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(n.name=this.name),this.usage!==oy&&(n.usage=this.usage),n}};class PY extends Ye{constructor(e,i,r){super(new Int8Array(e),i,r)}}class BY extends Ye{constructor(e,i,r){super(new Uint8Array(e),i,r)}}class kY extends Ye{constructor(e,i,r){super(new Uint8ClampedArray(e),i,r)}}class OY extends Ye{constructor(e,i,r){super(new Int16Array(e),i,r)}}let tw=class extends Ye{constructor(n,e,i){super(new Uint16Array(n),e,i)}};class DY extends Ye{constructor(e,i,r){super(new Int32Array(e),i,r)}}let ZI=class extends Ye{constructor(n,e,i){super(new Uint32Array(n),e,i)}};class LY extends Ye{constructor(e,i,r){super(new Uint16Array(e),i,r),this.isFloat16BufferAttribute=!0}getX(e){let i=py(this.array[e*this.itemSize]);return this.normalized&&(i=Ys(i,this.array)),i}setX(e,i){return this.normalized&&(i=Xt(i,this.array)),this.array[e*this.itemSize]=_o(i),this}getY(e){let i=py(this.array[e*this.itemSize+1]);return this.normalized&&(i=Ys(i,this.array)),i}setY(e,i){return this.normalized&&(i=Xt(i,this.array)),this.array[e*this.itemSize+1]=_o(i),this}getZ(e){let i=py(this.array[e*this.itemSize+2]);return this.normalized&&(i=Ys(i,this.array)),i}setZ(e,i){return this.normalized&&(i=Xt(i,this.array)),this.array[e*this.itemSize+2]=_o(i),this}getW(e){let i=py(this.array[e*this.itemSize+3]);return this.normalized&&(i=Ys(i,this.array)),i}setW(e,i){return this.normalized&&(i=Xt(i,this.array)),this.array[e*this.itemSize+3]=_o(i),this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=Xt(i,this.array),r=Xt(r,this.array)),this.array[e+0]=_o(i),this.array[e+1]=_o(r),this}setXYZ(e,i,r,s){return e*=this.itemSize,this.normalized&&(i=Xt(i,this.array),r=Xt(r,this.array),s=Xt(s,this.array)),this.array[e+0]=_o(i),this.array[e+1]=_o(r),this.array[e+2]=_o(s),this}setXYZW(e,i,r,s,o){return e*=this.itemSize,this.normalized&&(i=Xt(i,this.array),r=Xt(r,this.array),s=Xt(s,this.array),o=Xt(o,this.array)),this.array[e+0]=_o(i),this.array[e+1]=_o(r),this.array[e+2]=_o(s),this.array[e+3]=_o(o),this}}let rt=class extends Ye{constructor(n,e,i){super(new Float32Array(n),e,i)}},UY=0;const _a=new he,$I=new ve,Qm=new S,jo=new Ht,fy=new Ht,Sr=new S;let dt=class kq extends wr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:UY++}),this.uuid=No(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(IF(e)?ZI:tw)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,r=0){this.groups.push({start:e,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const o=new Lt().getNormalMatrix(e);r.applyNormalMatrix(o),r.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return _a.makeRotationFromQuaternion(e),this.applyMatrix4(_a),this}rotateX(e){return _a.makeRotationX(e),this.applyMatrix4(_a),this}rotateY(e){return _a.makeRotationY(e),this.applyMatrix4(_a),this}rotateZ(e){return _a.makeRotationZ(e),this.applyMatrix4(_a),this}translate(e,i,r){return _a.makeTranslation(e,i,r),this.applyMatrix4(_a),this}scale(e,i,r){return _a.makeScale(e,i,r),this.applyMatrix4(_a),this}lookAt(e){return $I.lookAt(e),$I.updateMatrix(),this.applyMatrix4($I.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Qm).negate(),this.translate(Qm.x,Qm.y,Qm.z),this}setFromPoints(e){const i=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new rt(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ht);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new S(-1/0,-1/0,-1/0),new S(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let r=0,s=i.length;r<s;r++){const o=i[r];jo.setFromBufferAttribute(o),this.morphTargetsRelative?(Sr.addVectors(this.boundingBox.min,jo.min),this.boundingBox.expandByPoint(Sr),Sr.addVectors(this.boundingBox.max,jo.max),this.boundingBox.expandByPoint(Sr)):(this.boundingBox.expandByPoint(jo.min),this.boundingBox.expandByPoint(jo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zi);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new S,1/0);return}if(e){const r=this.boundingSphere.center;if(jo.setFromBufferAttribute(e),i)for(let o=0,a=i.length;o<a;o++){const l=i[o];fy.setFromBufferAttribute(l),this.morphTargetsRelative?(Sr.addVectors(jo.min,fy.min),jo.expandByPoint(Sr),Sr.addVectors(jo.max,fy.max),jo.expandByPoint(Sr)):(jo.expandByPoint(fy.min),jo.expandByPoint(fy.max))}jo.getCenter(r);let s=0;for(let o=0,a=e.count;o<a;o++)Sr.fromBufferAttribute(e,o),s=Math.max(s,r.distanceToSquared(Sr));if(i)for(let o=0,a=i.length;o<a;o++){const l=i[o],c=this.morphTargetsRelative;for(let h=0,u=l.count;h<u;h++)Sr.fromBufferAttribute(l,h),c&&(Qm.fromBufferAttribute(e,h),Sr.add(Qm)),s=Math.max(s,r.distanceToSquared(Sr))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ye(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),l=[],c=[];for(let R=0;R<r.count;R++)l[R]=new S,c[R]=new S;const h=new S,u=new S,d=new S,f=new J,m=new J,g=new J,v=new S,y=new S;function A(R,B,E){h.fromBufferAttribute(r,R),u.fromBufferAttribute(r,B),d.fromBufferAttribute(r,E),f.fromBufferAttribute(o,R),m.fromBufferAttribute(o,B),g.fromBufferAttribute(o,E),u.sub(h),d.sub(h),m.sub(f),g.sub(f);const P=1/(m.x*g.y-g.x*m.y);isFinite(P)&&(v.copy(u).multiplyScalar(g.y).addScaledVector(d,-m.y).multiplyScalar(P),y.copy(d).multiplyScalar(m.x).addScaledVector(u,-g.x).multiplyScalar(P),l[R].add(v),l[B].add(v),l[E].add(v),c[R].add(y),c[B].add(y),c[E].add(y))}let b=this.groups;b.length===0&&(b=[{start:0,count:e.count}]);for(let R=0,B=b.length;R<B;++R){const E=b[R],P=E.start,O=E.count;for(let N=P,L=P+O;N<L;N+=3)A(e.getX(N+0),e.getX(N+1),e.getX(N+2))}const x=new S,_=new S,w=new S,T=new S;function M(R){w.fromBufferAttribute(s,R),T.copy(w);const B=l[R];x.copy(B),x.sub(w.multiplyScalar(w.dot(B))).normalize(),_.crossVectors(T,B);const E=_.dot(c[R])<0?-1:1;a.setXYZW(R,x.x,x.y,x.z,E)}for(let R=0,B=b.length;R<B;++R){const E=b[R],P=E.start,O=E.count;for(let N=P,L=P+O;N<L;N+=3)M(e.getX(N+0)),M(e.getX(N+1)),M(e.getX(N+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Ye(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let f=0,m=r.count;f<m;f++)r.setXYZ(f,0,0,0);const s=new S,o=new S,a=new S,l=new S,c=new S,h=new S,u=new S,d=new S;if(e)for(let f=0,m=e.count;f<m;f+=3){const g=e.getX(f+0),v=e.getX(f+1),y=e.getX(f+2);s.fromBufferAttribute(i,g),o.fromBufferAttribute(i,v),a.fromBufferAttribute(i,y),u.subVectors(a,o),d.subVectors(s,o),u.cross(d),l.fromBufferAttribute(r,g),c.fromBufferAttribute(r,v),h.fromBufferAttribute(r,y),l.add(u),c.add(u),h.add(u),r.setXYZ(g,l.x,l.y,l.z),r.setXYZ(v,c.x,c.y,c.z),r.setXYZ(y,h.x,h.y,h.z)}else for(let f=0,m=i.count;f<m;f+=3)s.fromBufferAttribute(i,f+0),o.fromBufferAttribute(i,f+1),a.fromBufferAttribute(i,f+2),u.subVectors(a,o),d.subVectors(s,o),u.cross(d),r.setXYZ(f+0,u.x,u.y,u.z),r.setXYZ(f+1,u.x,u.y,u.z),r.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,r=e.count;i<r;i++)Sr.fromBufferAttribute(e,i),Sr.normalize(),e.setXYZ(i,Sr.x,Sr.y,Sr.z)}toNonIndexed(){function e(l,c){const h=l.array,u=l.itemSize,d=l.normalized,f=new h.constructor(c.length*u);let m=0,g=0;for(let v=0,y=c.length;v<y;v++){l.isInterleavedBufferAttribute?m=c[v]*l.data.stride+l.offset:m=c[v]*u;for(let A=0;A<u;A++)f[g++]=h[m++]}return new Ye(f,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new kq,r=this.index.array,s=this.attributes;for(const l in s){const c=s[l],h=e(c,r);i.setAttribute(l,h)}const o=this.morphAttributes;for(const l in o){const c=[],h=o[l];for(let u=0,d=h.length;u<d;u++){const f=h[u],m=e(f,r);c.push(m)}i.morphAttributes[l]=c}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,c=a.length;l<c;l++){const h=a[l];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const c in r){const h=r[c];e.data.attributes[c]=h.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],u=[];for(let d=0,f=h.length;d<f;d++){const m=h[d];u.push(m.toJSON(e.data))}u.length>0&&(s[c]=u,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(i));const s=e.attributes;for(const h in s){const u=s[h];this.setAttribute(h,u.clone(i))}const o=e.morphAttributes;for(const h in o){const u=[],d=o[h];for(let f=0,m=d.length;f<m;f++)u.push(d[f].clone(i));this.morphAttributes[h]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let h=0,u=a.length;h<u;h++){const d=a[h];this.addGroup(d.start,d.count,d.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const QF=new he,Tp=new Js,iw=new Zi,WF=new S,Wm=new S,Xm=new S,qm=new S,eR=new S,nw=new S,rw=new J,sw=new J,ow=new J,XF=new S,qF=new S,YF=new S,aw=new S,lw=new S;let pe=class extends ve{constructor(n=new dt,e=new Jt){super(),this.isMesh=!0,this.type="Mesh",this.geometry=n,this.material=e,this.updateMorphTargets()}copy(n,e){return super.copy(n,e),n.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=n.morphTargetInfluences.slice()),n.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,e=Object.keys(n);if(e.length>0){const i=n[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){const o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}getVertexPosition(n,e){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(r,n);const a=this.morphTargetInfluences;if(s&&a){nw.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const h=a[l],u=s[l];h!==0&&(eR.fromBufferAttribute(u,n),o?nw.addScaledVector(eR,h):nw.addScaledVector(eR.sub(e),h))}e.add(nw)}return e}raycast(n,e){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),iw.copy(i.boundingSphere),iw.applyMatrix4(s),Tp.copy(n.ray).recast(n.near),!(iw.containsPoint(Tp.origin)===!1&&(Tp.intersectSphere(iw,WF)===null||Tp.origin.distanceToSquared(WF)>(n.far-n.near)**2))&&(QF.copy(s).invert(),Tp.copy(n.ray).applyMatrix4(QF),!(i.boundingBox!==null&&Tp.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(n,e,Tp)))}_computeIntersections(n,e,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,h=s.attributes.uv1,u=s.attributes.normal,d=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,g=d.length;m<g;m++){const v=d[m],y=o[v.materialIndex],A=Math.max(v.start,f.start),b=Math.min(a.count,Math.min(v.start+v.count,f.start+f.count));for(let x=A,_=b;x<_;x+=3){const w=a.getX(x),T=a.getX(x+1),M=a.getX(x+2);r=cw(this,y,n,i,c,h,u,w,T,M),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=v.materialIndex,e.push(r))}}else{const m=Math.max(0,f.start),g=Math.min(a.count,f.start+f.count);for(let v=m,y=g;v<y;v+=3){const A=a.getX(v),b=a.getX(v+1),x=a.getX(v+2);r=cw(this,o,n,i,c,h,u,A,b,x),r&&(r.faceIndex=Math.floor(v/3),e.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,g=d.length;m<g;m++){const v=d[m],y=o[v.materialIndex],A=Math.max(v.start,f.start),b=Math.min(l.count,Math.min(v.start+v.count,f.start+f.count));for(let x=A,_=b;x<_;x+=3){const w=x,T=x+1,M=x+2;r=cw(this,y,n,i,c,h,u,w,T,M),r&&(r.faceIndex=Math.floor(x/3),r.face.materialIndex=v.materialIndex,e.push(r))}}else{const m=Math.max(0,f.start),g=Math.min(l.count,f.start+f.count);for(let v=m,y=g;v<y;v+=3){const A=v,b=v+1,x=v+2;r=cw(this,o,n,i,c,h,u,A,b,x),r&&(r.faceIndex=Math.floor(v/3),e.push(r))}}}};function FY(n,e,i,r,s,o,a,l){let c;if(e.side===an?c=r.intersectTriangle(a,o,s,!0,l):c=r.intersectTriangle(s,o,a,e.side===Fn,l),c===null)return null;lw.copy(l),lw.applyMatrix4(n.matrixWorld);const h=i.ray.origin.distanceTo(lw);return h<i.near||h>i.far?null:{distance:h,point:lw.clone(),object:n}}function cw(n,e,i,r,s,o,a,l,c,h){n.getVertexPosition(l,Wm),n.getVertexPosition(c,Xm),n.getVertexPosition(h,qm);const u=FY(n,e,i,r,Wm,Xm,qm,aw);if(u){s&&(rw.fromBufferAttribute(s,l),sw.fromBufferAttribute(s,c),ow.fromBufferAttribute(s,h),u.uv=Xr.getInterpolation(aw,Wm,Xm,qm,rw,sw,ow,new J)),o&&(rw.fromBufferAttribute(o,l),sw.fromBufferAttribute(o,c),ow.fromBufferAttribute(o,h),u.uv1=Xr.getInterpolation(aw,Wm,Xm,qm,rw,sw,ow,new J)),a&&(XF.fromBufferAttribute(a,l),qF.fromBufferAttribute(a,c),YF.fromBufferAttribute(a,h),u.normal=Xr.getInterpolation(aw,Wm,Xm,qm,XF,qF,YF,new S),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const d={a:l,b:c,c:h,normal:new S,materialIndex:0};Xr.getNormal(Wm,Xm,qm,d.normal),u.face=d}return u}class Ki extends dt{constructor(e=1,i=1,r=1,s=1,o=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:s,heightSegments:o,depthSegments:a};const l=this;s=Math.floor(s),o=Math.floor(o),a=Math.floor(a);const c=[],h=[],u=[],d=[];let f=0,m=0;g("z","y","x",-1,-1,r,i,e,a,o,0),g("z","y","x",1,-1,r,i,-e,a,o,1),g("x","z","y",1,1,e,r,i,s,a,2),g("x","z","y",1,-1,e,r,-i,s,a,3),g("x","y","z",1,-1,e,i,r,s,o,4),g("x","y","z",-1,-1,e,i,-r,s,o,5),this.setIndex(c),this.setAttribute("position",new rt(h,3)),this.setAttribute("normal",new rt(u,3)),this.setAttribute("uv",new rt(d,2));function g(v,y,A,b,x,_,w,T,M,R,B){const E=_/M,P=w/R,O=_/2,N=w/2,L=T/2,Q=M+1,D=R+1;let F=0,H=0;const K=new S;for(let Z=0;Z<D;Z++){const oe=Z*P-N;for(let we=0;we<Q;we++){const Oe=we*E-O;K[v]=Oe*b,K[y]=oe*x,K[A]=L,h.push(K.x,K.y,K.z),K[v]=0,K[y]=0,K[A]=T>0?1:-1,u.push(K.x,K.y,K.z),d.push(we/M),d.push(1-Z/R),F+=1}}for(let Z=0;Z<R;Z++)for(let oe=0;oe<M;oe++){const we=f+oe+Q*Z,Oe=f+oe+Q*(Z+1),se=f+(oe+1)+Q*(Z+1),_e=f+(oe+1)+Q*Z;c.push(we,Oe,_e),c.push(Oe,se,_e),H+=6}l.addGroup(m,H,B),m+=H,f+=F}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ki(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ym(n){const e={};for(const i in n){e[i]={};for(const r in n[i]){const s=n[i][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][r]=null):e[i][r]=s.clone():Array.isArray(s)?e[i][r]=s.slice():e[i][r]=s}}return e}function Ks(n){const e={};for(let i=0;i<n.length;i++){const r=Ym(n[i]);for(const s in r)e[s]=r[s]}return e}function NY(n){const e=[];for(let i=0;i<n.length;i++)e.push(n[i].clone());return e}function JF(n){return n.getRenderTarget()===null?n.outputColorSpace:xi.workingColorSpace}const Jm={clone:Ym,merge:Ks};var zY=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,jY=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Bt extends Ut{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=zY,this.fragmentShader=jY,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ym(e.uniforms),this.uniformsGroups=NY(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?i.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?i.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?i.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?i.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?i.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?i.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?i.uniforms[s]={type:"m4",value:o.toArray()}:i.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const r={};for(const s in this.extensions)this.extensions[s]===!0&&(r[s]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}let my=class extends ve{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new he,this.projectionMatrix=new he,this.projectionMatrixInverse=new he,this.coordinateSystem=ql}copy(n,e){return super.copy(n,e),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this.coordinateSystem=n.coordinateSystem,this}getWorldDirection(n){return super.getWorldDirection(n).negate()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,e){super.updateWorldMatrix(n,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Mu=new S,KF=new J,ZF=new J;let Ft=class extends my{constructor(n=50,e=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=n,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(n,e){return super.copy(n,e),this.fov=n.fov,this.zoom=n.zoom,this.near=n.near,this.far=n.far,this.focus=n.focus,this.aspect=n.aspect,this.view=n.view===null?null:Object.assign({},n.view),this.filmGauge=n.filmGauge,this.filmOffset=n.filmOffset,this}setFocalLength(n){const e=.5*this.getFilmHeight()/n;this.fov=Om*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const n=Math.tan(Sp*.5*this.fov);return .5*this.getFilmHeight()/n}getEffectiveFOV(){return Om*2*Math.atan(Math.tan(Sp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(n,e,i){Mu.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Mu.x,Mu.y).multiplyScalar(-n/Mu.z),Mu.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Mu.x,Mu.y).multiplyScalar(-n/Mu.z)}getViewSize(n,e){return this.getViewBounds(n,KF,ZF),e.subVectors(ZF,KF)}setViewOffset(n,e,i,r,s,o){this.aspect=n/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=this.near;let e=n*Math.tan(Sp*.5*this.fov)/this.zoom,i=2*e,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,e-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(s+=n*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,e,e-i,n,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const e=super.toJSON(n);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const Km=-90,Zm=1;class tR extends ve{constructor(e,i,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Ft(Km,Zm,e,i);s.layers=this.layers,this.add(s);const o=new Ft(Km,Zm,e,i);o.layers=this.layers,this.add(o);const a=new Ft(Km,Zm,e,i);a.layers=this.layers,this.add(a);const l=new Ft(Km,Zm,e,i);l.layers=this.layers,this.add(l);const c=new Ft(Km,Zm,e,i);c.layers=this.layers,this.add(c);const h=new Ft(Km,Zm,e,i);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[r,s,o,a,l,c]=i;for(const h of i)this.remove(h);if(e===ql)r.up.set(0,1,0),r.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===ay)r.up.set(0,-1,0),r.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of i)this.add(h),h.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,a,l,c,h,u]=this.children,d=e.getRenderTarget(),f=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),g=e.xr.enabled;e.xr.enabled=!1;const v=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,s),e.render(i,o),e.setRenderTarget(r,1,s),e.render(i,a),e.setRenderTarget(r,2,s),e.render(i,l),e.setRenderTarget(r,3,s),e.render(i,c),e.setRenderTarget(r,4,s),e.render(i,h),r.texture.generateMipmaps=v,e.setRenderTarget(r,5,s),e.render(i,u),e.setRenderTarget(d,f,m),e.xr.enabled=g,r.texture.needsPMREMUpdate=!0}}class gy extends Gt{constructor(e,i,r,s,o,a,l,c,h,u){e=e!==void 0?e:[],i=i!==void 0?i:Zc,super(e,i,r,s,o,a,l,c,h,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class iR extends qt{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},s=[r,r,r,r,r,r];this.texture=new gy(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Dt}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Ki(5,5,5),o=new Bt({name:"CubemapFromEquirect",uniforms:Ym(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:an,blending:ln});o.uniforms.tEquirect.value=i;const a=new pe(s,o),l=i.minFilter;return i.minFilter===bo&&(i.minFilter=Dt),new tR(1,10,this).update(e,a),i.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,i,r,s){const o=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(i,r,s);e.setRenderTarget(o)}}const nR=new S,GY=new S,HY=new Lt;let dr=class{constructor(n=new S(1,0,0),e=0){this.isPlane=!0,this.normal=n,this.constant=e}set(n,e){return this.normal.copy(n),this.constant=e,this}setComponents(n,e,i,r){return this.normal.set(n,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(n,e){return this.normal.copy(n),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(n,e,i){const r=nR.subVectors(i,e).cross(GY.subVectors(n,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,n),this}copy(n){return this.normal.copy(n.normal),this.constant=n.constant,this}normalize(){const n=1/this.normal.length();return this.normal.multiplyScalar(n),this.constant*=n,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(n){return this.normal.dot(n)+this.constant}distanceToSphere(n){return this.distanceToPoint(n.center)-n.radius}projectPoint(n,e){return e.copy(n).addScaledVector(this.normal,-this.distanceToPoint(n))}intersectLine(n,e){const i=n.delta(nR),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(n.start)===0?e.copy(n.start):null;const s=-(n.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:e.copy(n.start).addScaledVector(i,s)}intersectsLine(n){const e=this.distanceToPoint(n.start),i=this.distanceToPoint(n.end);return e<0&&i>0||i<0&&e>0}intersectsBox(n){return n.intersectsPlane(this)}intersectsSphere(n){return n.intersectsPlane(this)}coplanarPoint(n){return n.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(n,e){const i=e||HY.getNormalMatrix(n),r=this.coplanarPoint(nR).applyMatrix4(n),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(n){return this.constant-=n.dot(this.normal),this}equals(n){return n.normal.equals(this.normal)&&n.constant===this.constant}clone(){return new this.constructor().copy(this)}};const Ip=new Zi,hw=new S;let Rp=class{constructor(n=new dr,e=new dr,i=new dr,r=new dr,s=new dr,o=new dr){this.planes=[n,e,i,r,s,o]}set(n,e,i,r,s,o){const a=this.planes;return a[0].copy(n),a[1].copy(e),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(n){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(n.planes[i]);return this}setFromProjectionMatrix(n,e=ql){const i=this.planes,r=n.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],h=r[5],u=r[6],d=r[7],f=r[8],m=r[9],g=r[10],v=r[11],y=r[12],A=r[13],b=r[14],x=r[15];if(i[0].setComponents(l-s,d-c,v-f,x-y).normalize(),i[1].setComponents(l+s,d+c,v+f,x+y).normalize(),i[2].setComponents(l+o,d+h,v+m,x+A).normalize(),i[3].setComponents(l-o,d-h,v-m,x-A).normalize(),i[4].setComponents(l-a,d-u,v-g,x-b).normalize(),e===ql)i[5].setComponents(l+a,d+u,v+g,x+b).normalize();else if(e===ay)i[5].setComponents(a,u,g,b).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(n){if(n.boundingSphere!==void 0)n.boundingSphere===null&&n.computeBoundingSphere(),Ip.copy(n.boundingSphere).applyMatrix4(n.matrixWorld);else{const e=n.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Ip.copy(e.boundingSphere).applyMatrix4(n.matrixWorld)}return this.intersectsSphere(Ip)}intersectsSprite(n){return Ip.center.set(0,0,0),Ip.radius=.7071067811865476,Ip.applyMatrix4(n.matrixWorld),this.intersectsSphere(Ip)}intersectsSphere(n){const e=this.planes,i=n.center,r=-n.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(n){const e=this.planes;for(let i=0;i<6;i++){const r=e[i];if(hw.x=r.normal.x>0?n.max.x:n.min.x,hw.y=r.normal.y>0?n.max.y:n.min.y,hw.z=r.normal.z>0?n.max.z:n.min.z,r.distanceToPoint(hw)<0)return!1}return!0}containsPoint(n){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(n)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function $F(){let n=null,e=!1,i=null,r=null;function s(o,a){i(o,a),r=n.requestAnimationFrame(s)}return{start:function(){e!==!0&&i!==null&&(r=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(o){i=o},setContext:function(o){n=o}}}function VY(n,e){const i=e.isWebGL2,r=new WeakMap;function s(h,u){const d=h.array,f=h.usage,m=d.byteLength,g=n.createBuffer();n.bindBuffer(u,g),n.bufferData(u,d,f),h.onUploadCallback();let v;if(d instanceof Float32Array)v=n.FLOAT;else if(d instanceof Uint16Array)if(h.isFloat16BufferAttribute)if(i)v=n.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=n.UNSIGNED_SHORT;else if(d instanceof Int16Array)v=n.SHORT;else if(d instanceof Uint32Array)v=n.UNSIGNED_INT;else if(d instanceof Int32Array)v=n.INT;else if(d instanceof Int8Array)v=n.BYTE;else if(d instanceof Uint8Array)v=n.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)v=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:g,type:v,bytesPerElement:d.BYTES_PER_ELEMENT,version:h.version,size:m}}function o(h,u,d){const f=u.array,m=u._updateRange,g=u.updateRanges;if(n.bindBuffer(d,h),m.count===-1&&g.length===0&&n.bufferSubData(d,0,f),g.length!==0){for(let v=0,y=g.length;v<y;v++){const A=g[v];i?n.bufferSubData(d,A.start*f.BYTES_PER_ELEMENT,f,A.start,A.count):n.bufferSubData(d,A.start*f.BYTES_PER_ELEMENT,f.subarray(A.start,A.start+A.count))}u.clearUpdateRanges()}m.count!==-1&&(i?n.bufferSubData(d,m.offset*f.BYTES_PER_ELEMENT,f,m.offset,m.count):n.bufferSubData(d,m.offset*f.BYTES_PER_ELEMENT,f.subarray(m.offset,m.offset+m.count)),m.count=-1),u.onUploadCallback()}function a(h){return h.isInterleavedBufferAttribute&&(h=h.data),r.get(h)}function l(h){h.isInterleavedBufferAttribute&&(h=h.data);const u=r.get(h);u&&(n.deleteBuffer(u.buffer),r.delete(h))}function c(h,u){if(h.isGLBufferAttribute){const f=r.get(h);(!f||f.version<h.version)&&r.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}h.isInterleavedBufferAttribute&&(h=h.data);const d=r.get(h);if(d===void 0)r.set(h,s(h,u));else if(d.version<h.version){if(d.size!==h.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");o(d.buffer,h,u),d.version=h.version}}return{get:a,remove:l,update:c}}class cr extends dt{constructor(e=1,i=1,r=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:r,heightSegments:s};const o=e/2,a=i/2,l=Math.floor(r),c=Math.floor(s),h=l+1,u=c+1,d=e/l,f=i/c,m=[],g=[],v=[],y=[];for(let A=0;A<u;A++){const b=A*f-a;for(let x=0;x<h;x++){const _=x*d-o;g.push(_,-b,0),v.push(0,0,1),y.push(x/l),y.push(1-A/c)}}for(let A=0;A<c;A++)for(let b=0;b<l;b++){const x=b+h*A,_=b+h*(A+1),w=b+1+h*(A+1),T=b+1+h*A;m.push(x,_,T),m.push(_,w,T)}this.setIndex(m),this.setAttribute("position",new rt(g,3)),this.setAttribute("normal",new rt(v,3)),this.setAttribute("uv",new rt(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cr(e.width,e.height,e.widthSegments,e.heightSegments)}}var QY=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,WY=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,XY=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,qY=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,YY=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,JY=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,KY=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ZY=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,$Y=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,eJ=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,tJ=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,iJ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,nJ=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,rJ=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,sJ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,oJ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,aJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,lJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,cJ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,hJ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,uJ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,dJ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,pJ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,fJ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,mJ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,gJ=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,vJ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,yJ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,AJ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,bJ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,xJ="gl_FragColor = linearToOutputTexel( gl_FragColor );",_J=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,wJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,SJ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,CJ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,EJ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,MJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,TJ=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,IJ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,RJ=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,PJ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,BJ=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,kJ=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,OJ=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,DJ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,LJ=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,UJ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,FJ=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,NJ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,zJ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,jJ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,GJ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,HJ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,VJ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,QJ=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,WJ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,XJ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,qJ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,YJ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,JJ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,KJ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,ZJ=`#ifdef USE_MAP
#ifdef USE_MIPMAP_BIAS
    vec4 sampledDiffuseColor = texture2D( map, vMapUv, mipmapBias );
#else
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
#endif
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,$J=`#ifdef USE_MAP
	uniform sampler2D map;
        
#ifdef USE_MIPMAP_BIAS
    uniform float mipmapBias;
#endif
#endif`,eK=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,tK=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,iK=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,nK=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,rK=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,sK=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,oK=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,aK=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,lK=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,cK=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,hK=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,uK=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,dK=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,pK=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,fK=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,mK=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,gK=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,vK=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,yK=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,AK=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,bK=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,xK=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,_K=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,wK=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,SK=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,CK=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,EK=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,MK=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,TK=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,IK=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,RK=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,PK=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,BK=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,kK=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,OK=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,DK=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,LK=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,UK=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,FK=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	float startCompression = 0.8 - 0.04;
	float desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min(color.r, min(color.g, color.b));
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) return color;
	float d = 1. - startCompression;
	float newPeak = 1. - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	float g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);
	return mix(color, vec3(1, 1, 1), g);
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,NK=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,zK=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,jK=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,GK=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,HK=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,VK=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const QK=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,WK=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,XK=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,qK=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,YK=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,JK=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,KK=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,ZK=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,$K=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,eZ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,tZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,iZ=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,nZ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,rZ=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,sZ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,oZ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,aZ=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lZ=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cZ=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,hZ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uZ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,dZ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,pZ=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fZ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mZ=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,gZ=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vZ=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yZ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AZ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,bZ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,xZ=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_Z=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,wZ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,SZ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ct={alphahash_fragment:QY,alphahash_pars_fragment:WY,alphamap_fragment:XY,alphamap_pars_fragment:qY,alphatest_fragment:YY,alphatest_pars_fragment:JY,aomap_fragment:KY,aomap_pars_fragment:ZY,batching_pars_vertex:$Y,batching_vertex:eJ,begin_vertex:tJ,beginnormal_vertex:iJ,bsdfs:nJ,iridescence_fragment:rJ,bumpmap_pars_fragment:sJ,clipping_planes_fragment:oJ,clipping_planes_pars_fragment:aJ,clipping_planes_pars_vertex:lJ,clipping_planes_vertex:cJ,color_fragment:hJ,color_pars_fragment:uJ,color_pars_vertex:dJ,color_vertex:pJ,common:fJ,cube_uv_reflection_fragment:mJ,defaultnormal_vertex:gJ,displacementmap_pars_vertex:vJ,displacementmap_vertex:yJ,emissivemap_fragment:AJ,emissivemap_pars_fragment:bJ,colorspace_fragment:xJ,colorspace_pars_fragment:_J,envmap_fragment:wJ,envmap_common_pars_fragment:SJ,envmap_pars_fragment:CJ,envmap_pars_vertex:EJ,envmap_physical_pars_fragment:FJ,envmap_vertex:MJ,fog_vertex:TJ,fog_pars_vertex:IJ,fog_fragment:RJ,fog_pars_fragment:PJ,gradientmap_pars_fragment:BJ,lightmap_fragment:kJ,lightmap_pars_fragment:OJ,lights_lambert_fragment:DJ,lights_lambert_pars_fragment:LJ,lights_pars_begin:UJ,lights_toon_fragment:NJ,lights_toon_pars_fragment:zJ,lights_phong_fragment:jJ,lights_phong_pars_fragment:GJ,lights_physical_fragment:HJ,lights_physical_pars_fragment:VJ,lights_fragment_begin:QJ,lights_fragment_maps:WJ,lights_fragment_end:XJ,logdepthbuf_fragment:qJ,logdepthbuf_pars_fragment:YJ,logdepthbuf_pars_vertex:JJ,logdepthbuf_vertex:KJ,map_fragment:ZJ,map_pars_fragment:$J,map_particle_fragment:eK,map_particle_pars_fragment:tK,metalnessmap_fragment:iK,metalnessmap_pars_fragment:nK,morphinstance_vertex:rK,morphcolor_vertex:sK,morphnormal_vertex:oK,morphtarget_pars_vertex:aK,morphtarget_vertex:lK,normal_fragment_begin:cK,normal_fragment_maps:hK,normal_pars_fragment:uK,normal_pars_vertex:dK,normal_vertex:pK,normalmap_pars_fragment:fK,clearcoat_normal_fragment_begin:mK,clearcoat_normal_fragment_maps:gK,clearcoat_pars_fragment:vK,iridescence_pars_fragment:yK,opaque_fragment:AK,packing:bK,premultiplied_alpha_fragment:xK,project_vertex:_K,dithering_fragment:wK,dithering_pars_fragment:SK,roughnessmap_fragment:CK,roughnessmap_pars_fragment:EK,shadowmap_pars_fragment:MK,shadowmap_pars_vertex:TK,shadowmap_vertex:IK,shadowmask_pars_fragment:RK,skinbase_vertex:PK,skinning_pars_vertex:BK,skinning_vertex:kK,skinnormal_vertex:OK,specularmap_fragment:DK,specularmap_pars_fragment:LK,tonemapping_fragment:UK,tonemapping_pars_fragment:FK,transmission_fragment:NK,transmission_pars_fragment:zK,uv_pars_fragment:jK,uv_pars_vertex:GK,uv_vertex:HK,worldpos_vertex:VK,background_vert:QK,background_frag:WK,backgroundCube_vert:XK,backgroundCube_frag:qK,cube_vert:YK,cube_frag:JK,depth_vert:KK,depth_frag:ZK,distanceRGBA_vert:$K,distanceRGBA_frag:eZ,equirect_vert:tZ,equirect_frag:iZ,linedashed_vert:nZ,linedashed_frag:rZ,meshbasic_vert:sZ,meshbasic_frag:oZ,meshlambert_vert:aZ,meshlambert_frag:lZ,meshmatcap_vert:cZ,meshmatcap_frag:hZ,meshnormal_vert:uZ,meshnormal_frag:dZ,meshphong_vert:pZ,meshphong_frag:fZ,meshphysical_vert:mZ,meshphysical_frag:gZ,meshtoon_vert:vZ,meshtoon_frag:yZ,points_vert:AZ,points_frag:bZ,shadow_vert:xZ,shadow_frag:_Z,sprite_vert:wZ,sprite_frag:SZ},Ge={common:{diffuse:{value:new be(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Lt},alphaMap:{value:null},alphaMapTransform:{value:new Lt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Lt}},envmap:{envMap:{value:null},envMapRotation:{value:new Lt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Lt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Lt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Lt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Lt},normalScale:{value:new J(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Lt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Lt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Lt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Lt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new be(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new be(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Lt},alphaTest:{value:0},uvTransform:{value:new Lt}},sprite:{diffuse:{value:new be(16777215)},opacity:{value:1},center:{value:new J(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Lt},alphaMap:{value:null},alphaMapTransform:{value:new Lt},alphaTest:{value:0}}},qr={basic:{uniforms:Ks([Ge.common,Ge.specularmap,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.fog]),vertexShader:Ct.meshbasic_vert,fragmentShader:Ct.meshbasic_frag},lambert:{uniforms:Ks([Ge.common,Ge.specularmap,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.fog,Ge.lights,{emissive:{value:new be(0)}}]),vertexShader:Ct.meshlambert_vert,fragmentShader:Ct.meshlambert_frag},phong:{uniforms:Ks([Ge.common,Ge.specularmap,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.fog,Ge.lights,{emissive:{value:new be(0)},specular:{value:new be(1118481)},shininess:{value:30}}]),vertexShader:Ct.meshphong_vert,fragmentShader:Ct.meshphong_frag},standard:{uniforms:Ks([Ge.common,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.roughnessmap,Ge.metalnessmap,Ge.fog,Ge.lights,{emissive:{value:new be(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ct.meshphysical_vert,fragmentShader:Ct.meshphysical_frag},toon:{uniforms:Ks([Ge.common,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.gradientmap,Ge.fog,Ge.lights,{emissive:{value:new be(0)}}]),vertexShader:Ct.meshtoon_vert,fragmentShader:Ct.meshtoon_frag},matcap:{uniforms:Ks([Ge.common,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.fog,{matcap:{value:null}}]),vertexShader:Ct.meshmatcap_vert,fragmentShader:Ct.meshmatcap_frag},points:{uniforms:Ks([Ge.points,Ge.fog]),vertexShader:Ct.points_vert,fragmentShader:Ct.points_frag},dashed:{uniforms:Ks([Ge.common,Ge.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ct.linedashed_vert,fragmentShader:Ct.linedashed_frag},depth:{uniforms:Ks([Ge.common,Ge.displacementmap]),vertexShader:Ct.depth_vert,fragmentShader:Ct.depth_frag},normal:{uniforms:Ks([Ge.common,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,{opacity:{value:1}}]),vertexShader:Ct.meshnormal_vert,fragmentShader:Ct.meshnormal_frag},sprite:{uniforms:Ks([Ge.sprite,Ge.fog]),vertexShader:Ct.sprite_vert,fragmentShader:Ct.sprite_frag},background:{uniforms:{uvTransform:{value:new Lt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ct.background_vert,fragmentShader:Ct.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Lt}},vertexShader:Ct.backgroundCube_vert,fragmentShader:Ct.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ct.cube_vert,fragmentShader:Ct.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ct.equirect_vert,fragmentShader:Ct.equirect_frag},distanceRGBA:{uniforms:Ks([Ge.common,Ge.displacementmap,{referencePosition:{value:new S},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ct.distanceRGBA_vert,fragmentShader:Ct.distanceRGBA_frag},shadow:{uniforms:Ks([Ge.lights,Ge.fog,{color:{value:new be(0)},opacity:{value:1}}]),vertexShader:Ct.shadow_vert,fragmentShader:Ct.shadow_frag}};qr.physical={uniforms:Ks([qr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Lt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Lt},clearcoatNormalScale:{value:new J(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Lt},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Lt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Lt},sheen:{value:0},sheenColor:{value:new be(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Lt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Lt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Lt},transmissionSamplerSize:{value:new J},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Lt},attenuationDistance:{value:0},attenuationColor:{value:new be(0)},specularColor:{value:new be(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Lt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Lt},anisotropyVector:{value:new J},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Lt}}]),vertexShader:Ct.meshphysical_vert,fragmentShader:Ct.meshphysical_frag};const uw={r:0,b:0,g:0},Pp=new ri,CZ=new he;function EZ(n,e,i,r,s,o,a){const l=new be(0);let c=o===!0?0:1,h,u,d=null,f=0,m=null;function g(y,A){let b=!1,x=A.isScene===!0?A.background:null;x&&x.isTexture&&(x=(A.backgroundBlurriness>0?i:e).get(x)),x===null?v(l,c):x&&x.isColor&&(v(x,1),b=!0);const _=n.xr.getEnvironmentBlendMode();_==="additive"?r.buffers.color.setClear(0,0,0,1,a):_==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(n.autoClear||b)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Pm)?(u===void 0&&(u=new pe(new Ki(1,1,1),new Bt({name:"BackgroundCubeMaterial",uniforms:Ym(qr.backgroundCube.uniforms),vertexShader:qr.backgroundCube.vertexShader,fragmentShader:qr.backgroundCube.fragmentShader,side:an,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(w,T,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(u)),Pp.copy(A.backgroundRotation),Pp.x*=-1,Pp.y*=-1,Pp.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Pp.y*=-1,Pp.z*=-1),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=A.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(CZ.makeRotationFromEuler(Pp)),u.material.toneMapped=xi.getTransfer(x.colorSpace)!==Vi,(d!==x||f!==x.version||m!==n.toneMapping)&&(u.material.needsUpdate=!0,d=x,f=x.version,m=n.toneMapping),u.layers.enableAll(),y.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(h===void 0&&(h=new pe(new cr(2,2),new Bt({name:"BackgroundMaterial",uniforms:Ym(qr.background.uniforms),vertexShader:qr.background.vertexShader,fragmentShader:qr.background.fragmentShader,side:Fn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(h)),h.material.uniforms.t2D.value=x,h.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,h.material.toneMapped=xi.getTransfer(x.colorSpace)!==Vi,x.matrixAutoUpdate===!0&&x.updateMatrix(),h.material.uniforms.uvTransform.value.copy(x.matrix),(d!==x||f!==x.version||m!==n.toneMapping)&&(h.material.needsUpdate=!0,d=x,f=x.version,m=n.toneMapping),h.layers.enableAll(),y.unshift(h,h.geometry,h.material,0,0,null))}function v(y,A){y.getRGB(uw,JF(n)),r.buffers.color.setClear(uw.r,uw.g,uw.b,A,a)}return{getClearColor:function(){return l},setClearColor:function(y,A=1){l.set(y),c=A,v(l,c)},getClearAlpha:function(){return c},setClearAlpha:function(y){c=y,v(l,c)},render:g}}function MZ(n,e,i,r){const s=n.getParameter(n.MAX_VERTEX_ATTRIBS),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||o!==null,l={},c=y(null);let h=c,u=!1;function d(L,Q,D,F,H){let K=!1;if(a){const Z=v(F,D,Q);h!==Z&&(h=Z,m(h.object)),K=A(L,F,D,H),K&&b(L,F,D,H)}else{const Z=Q.wireframe===!0;(h.geometry!==F.id||h.program!==D.id||h.wireframe!==Z)&&(h.geometry=F.id,h.program=D.id,h.wireframe=Z,K=!0)}H!==null&&i.update(H,n.ELEMENT_ARRAY_BUFFER),(K||u)&&(u=!1,R(L,Q,D,F),H!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.get(H).buffer))}function f(){return r.isWebGL2?n.createVertexArray():o.createVertexArrayOES()}function m(L){return r.isWebGL2?n.bindVertexArray(L):o.bindVertexArrayOES(L)}function g(L){return r.isWebGL2?n.deleteVertexArray(L):o.deleteVertexArrayOES(L)}function v(L,Q,D){const F=D.wireframe===!0;let H=l[L.id];H===void 0&&(H={},l[L.id]=H);let K=H[Q.id];K===void 0&&(K={},H[Q.id]=K);let Z=K[F];return Z===void 0&&(Z=y(f()),K[F]=Z),Z}function y(L){const Q=[],D=[],F=[];for(let H=0;H<s;H++)Q[H]=0,D[H]=0,F[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Q,enabledAttributes:D,attributeDivisors:F,object:L,attributes:{},index:null}}function A(L,Q,D,F){const H=h.attributes,K=Q.attributes;let Z=0;const oe=D.getAttributes();for(const we in oe)if(oe[we].location>=0){const Oe=H[we];let se=K[we];if(se===void 0&&(we==="instanceMatrix"&&L.instanceMatrix&&(se=L.instanceMatrix),we==="instanceColor"&&L.instanceColor&&(se=L.instanceColor)),Oe===void 0||Oe.attribute!==se||se&&Oe.data!==se.data)return!0;Z++}return h.attributesNum!==Z||h.index!==F}function b(L,Q,D,F){const H={},K=Q.attributes;let Z=0;const oe=D.getAttributes();for(const we in oe)if(oe[we].location>=0){let Oe=K[we];Oe===void 0&&(we==="instanceMatrix"&&L.instanceMatrix&&(Oe=L.instanceMatrix),we==="instanceColor"&&L.instanceColor&&(Oe=L.instanceColor));const se={};se.attribute=Oe,Oe&&Oe.data&&(se.data=Oe.data),H[we]=se,Z++}h.attributes=H,h.attributesNum=Z,h.index=F}function x(){const L=h.newAttributes;for(let Q=0,D=L.length;Q<D;Q++)L[Q]=0}function _(L){w(L,0)}function w(L,Q){const D=h.newAttributes,F=h.enabledAttributes,H=h.attributeDivisors;D[L]=1,F[L]===0&&(n.enableVertexAttribArray(L),F[L]=1),H[L]!==Q&&((r.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](L,Q),H[L]=Q)}function T(){const L=h.newAttributes,Q=h.enabledAttributes;for(let D=0,F=Q.length;D<F;D++)Q[D]!==L[D]&&(n.disableVertexAttribArray(D),Q[D]=0)}function M(L,Q,D,F,H,K,Z){Z===!0?n.vertexAttribIPointer(L,Q,D,H,K):n.vertexAttribPointer(L,Q,D,F,H,K)}function R(L,Q,D,F){if(r.isWebGL2===!1&&(L.isInstancedMesh||F.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();const H=F.attributes,K=D.getAttributes(),Z=Q.defaultAttributeValues;for(const oe in K){const we=K[oe];if(we.location>=0){let Oe=H[oe];if(Oe===void 0&&(oe==="instanceMatrix"&&L.instanceMatrix&&(Oe=L.instanceMatrix),oe==="instanceColor"&&L.instanceColor&&(Oe=L.instanceColor)),Oe!==void 0){const se=Oe.normalized,_e=Oe.itemSize,Ee=i.get(Oe);if(Ee===void 0)continue;const et=Ee.buffer,We=Ee.type,Ue=Ee.bytesPerElement,st=r.isWebGL2===!0&&(We===n.INT||We===n.UNSIGNED_INT||Oe.gpuType===bp);if(Oe.isInterleavedBufferAttribute){const ge=Oe.data,X=ge.stride,ze=Oe.offset;if(ge.isInstancedInterleavedBuffer){for(let Ie=0;Ie<we.locationSize;Ie++)w(we.location+Ie,ge.meshPerAttribute);L.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=ge.meshPerAttribute*ge.count)}else for(let Ie=0;Ie<we.locationSize;Ie++)_(we.location+Ie);n.bindBuffer(n.ARRAY_BUFFER,et);for(let Ie=0;Ie<we.locationSize;Ie++)M(we.location+Ie,_e/we.locationSize,We,se,X*Ue,(ze+_e/we.locationSize*Ie)*Ue,st)}else{if(Oe.isInstancedBufferAttribute){for(let ge=0;ge<we.locationSize;ge++)w(we.location+ge,Oe.meshPerAttribute);L.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=Oe.meshPerAttribute*Oe.count)}else for(let ge=0;ge<we.locationSize;ge++)_(we.location+ge);n.bindBuffer(n.ARRAY_BUFFER,et);for(let ge=0;ge<we.locationSize;ge++)M(we.location+ge,_e/we.locationSize,We,se,_e*Ue,_e/we.locationSize*ge*Ue,st)}}else if(Z!==void 0){const se=Z[oe];if(se!==void 0)switch(se.length){case 2:n.vertexAttrib2fv(we.location,se);break;case 3:n.vertexAttrib3fv(we.location,se);break;case 4:n.vertexAttrib4fv(we.location,se);break;default:n.vertexAttrib1fv(we.location,se)}}}}T()}function B(){O();for(const L in l){const Q=l[L];for(const D in Q){const F=Q[D];for(const H in F)g(F[H].object),delete F[H];delete Q[D]}delete l[L]}}function E(L){if(l[L.id]===void 0)return;const Q=l[L.id];for(const D in Q){const F=Q[D];for(const H in F)g(F[H].object),delete F[H];delete Q[D]}delete l[L.id]}function P(L){for(const Q in l){const D=l[Q];if(D[L.id]===void 0)continue;const F=D[L.id];for(const H in F)g(F[H].object),delete F[H];delete D[L.id]}}function O(){N(),u=!0,h!==c&&(h=c,m(h.object))}function N(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:d,reset:O,resetDefaultState:N,dispose:B,releaseStatesOfGeometry:E,releaseStatesOfProgram:P,initAttributes:x,enableAttribute:_,disableUnusedAttributes:T}}function TZ(n,e,i,r){const s=r.isWebGL2;let o;function a(u){o=u}function l(u,d){n.drawArrays(o,u,d),i.update(d,o,1)}function c(u,d,f){if(f===0)return;let m,g;if(s)m=n,g="drawArraysInstanced";else if(m=e.get("ANGLE_instanced_arrays"),g="drawArraysInstancedANGLE",m===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[g](o,u,d,f),i.update(d,o,f)}function h(u,d,f){if(f===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let g=0;g<f;g++)this.render(u[g],d[g]);else{m.multiDrawArraysWEBGL(o,u,0,d,0,f);let g=0;for(let v=0;v<f;v++)g+=d[v];i.update(g,o,1)}}this.setMode=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=h}function IZ(n,e,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(M){if(M==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&n.constructor.name==="WebGL2RenderingContext";let l=i.precision!==void 0?i.precision:"highp";const c=o(l);c!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",c,"instead."),l=c);const h=a||e.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,d=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_TEXTURE_SIZE),g=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),v=n.getParameter(n.MAX_VERTEX_ATTRIBS),y=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),A=n.getParameter(n.MAX_VARYING_VECTORS),b=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),x=f>0,_=a||e.has("OES_texture_float"),w=x&&_,T=a?n.getParameter(n.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:h,getMaxAnisotropy:s,getMaxPrecision:o,precision:l,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:f,maxTextureSize:m,maxCubemapSize:g,maxAttributes:v,maxVertexUniforms:y,maxVaryings:A,maxFragmentUniforms:b,vertexTextures:x,floatFragmentTextures:_,floatVertexTextures:w,maxSamples:T}}function RZ(n){const e=this;let i=null,r=0,s=!1,o=!1;const a=new dr,l=new Lt,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f){const m=d.length!==0||f||r!==0||s;return s=f,r=d.length,m},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(d,f){i=u(d,f,0)},this.setState=function(d,f,m){const g=d.clippingPlanes,v=d.clipIntersection,y=d.clipShadows,A=n.get(d);if(!s||g===null||g.length===0||o&&!y)o?u(null):h();else{const b=o?0:r,x=b*4;let _=A.clippingState||null;c.value=_,_=u(g,f,x,m);for(let w=0;w!==x;++w)_[w]=i[w];A.clippingState=_,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=b}};function h(){c.value!==i&&(c.value=i,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(d,f,m,g){const v=d!==null?d.length:0;let y=null;if(v!==0){if(y=c.value,g!==!0||y===null){const A=m+v*4,b=f.matrixWorldInverse;l.getNormalMatrix(b),(y===null||y.length<A)&&(y=new Float32Array(A));for(let x=0,_=m;x!==v;++x,_+=4)a.copy(d[x]).applyMatrix4(b,l),a.normal.toArray(y,_),y[_+3]=a.constant}c.value=y,c.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,y}}function PZ(n){let e=new WeakMap;function i(a,l){return l===qs?a.mapping=Zc:l===Rm&&(a.mapping=gu),a}function r(a){if(a&&a.isTexture){const l=a.mapping;if(l===qs||l===Rm)if(e.has(a)){const c=e.get(a).texture;return i(c,a.mapping)}else{const c=a.image;if(c&&c.height>0){const h=new iR(c.height);return h.fromEquirectangularTexture(n,a),e.set(a,h),a.addEventListener("dispose",s),i(h.texture,a.mapping)}else return null}}return a}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap}return{get:r,dispose:o}}let Yl=class extends my{constructor(n=-1,e=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=n,this.right=e,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(n,e){return super.copy(n,e),this.left=n.left,this.right=n.right,this.top=n.top,this.bottom=n.bottom,this.near=n.near,this.far=n.far,this.zoom=n.zoom,this.view=n.view===null?null:Object.assign({},n.view),this}setViewOffset(n,e,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-n,o=i+n,a=r+e,l=r-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const e=super.toJSON(n);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}};const $m=4,eN=[.125,.215,.35,.446,.526,.582],Bp=20,rR=new Yl,tN=new be;let sR=null,oR=0,aR=0;const kp=(1+Math.sqrt(5))/2,eg=1/kp,iN=[new S(1,1,1),new S(-1,1,1),new S(1,1,-1),new S(-1,1,-1),new S(0,kp,eg),new S(0,kp,-eg),new S(eg,0,kp),new S(-eg,0,kp),new S(kp,eg,0),new S(-kp,eg,0)];class lR{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,r=.1,s=100){sR=this._renderer.getRenderTarget(),oR=this._renderer.getActiveCubeFace(),aR=this._renderer.getActiveMipmapLevel(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,r,s,o),i>0&&this._blur(o,0,0,i),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=oN(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=sN(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(sR,oR,aR),e.scissorTest=!1,dw(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===Zc||e.mapping===gu?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),sR=this._renderer.getRenderTarget(),oR=this._renderer.getActiveCubeFace(),aR=this._renderer.getActiveMipmapLevel();const r=i||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:Dt,minFilter:Dt,generateMipmaps:!1,type:ur,format:Ti,colorSpace:Ii,depthBuffer:!1},s=rN(e,i,r),{_lodMax:o}=this;if({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=nN(o),this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=rN(e,i,r);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=nN(a)),this._blurMaterial=BZ(a,e,i)}return s}_compileMaterial(e){const i=new pe(this._lodPlanes[0],e);this._renderer.compile(i,rR)}_sceneToCubeUV(e,i,r,s){const o=new Ft(90,1,i,r),a=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],c=this._renderer,h=c.autoClear,u=c.toneMapping;c.getClearColor(tN),c.toneMapping=Xs,c.autoClear=!1;const d=new Jt({name:"PMREM.Background",side:an,depthWrite:!1,depthTest:!1}),f=new pe(new Ki,d);let m=!1;const g=e.background;g?g.isColor&&(d.color.copy(g),e.background=null,m=!0):(d.color.copy(tN),m=!0);for(let v=0;v<6;v++){const y=v%3;y===0?(o.up.set(0,a[v],0),o.lookAt(l[v],0,0)):y===1?(o.up.set(0,0,a[v]),o.lookAt(0,l[v],0)):(o.up.set(0,a[v],0),o.lookAt(0,0,l[v]));const A=this._cubeSize;dw(s,y*A,v>2?A:0,A,A),c.setRenderTarget(s),m&&c.render(f,o),c.render(e,o)}f.geometry.dispose(),f.material.dispose(),c.toneMapping=u,c.autoClear=h,e.background=g}_textureToCubeUV(e,i){const r=this._renderer,s=e.mapping===Zc||e.mapping===gu;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=oN()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=sN());const o=s?this._cubemapMaterial:this._equirectMaterial,a=new pe(this._lodPlanes[0],o),l=o.uniforms;l.envMap.value=e;const c=this._cubeSize;dw(i,0,0,3*c,2*c),r.setRenderTarget(i),r.render(a,rR)}_applyPMREM(e){const i=this._renderer,r=i.autoClear;i.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=iN[(s-1)%iN.length];this._blur(e,s-1,s,o,a)}i.autoClear=r}_blur(e,i,r,s,o){const a=this._pingPongRenderTarget;this._halfBlur(e,a,i,r,s,"latitudinal",o),this._halfBlur(a,e,r,r,s,"longitudinal",o)}_halfBlur(e,i,r,s,o,a,l){const c=this._renderer,h=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new pe(this._lodPlanes[s],h),f=h.uniforms,m=this._sizeLods[r]-1,g=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*Bp-1),v=o/g,y=isFinite(o)?1+Math.floor(u*v):Bp;y>Bp&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${Bp}`);const A=[];let b=0;for(let M=0;M<Bp;++M){const R=M/v,B=Math.exp(-R*R/2);A.push(B),M===0?b+=B:M<y&&(b+=2*B)}for(let M=0;M<A.length;M++)A[M]=A[M]/b;f.envMap.value=e.texture,f.samples.value=y,f.weights.value=A,f.latitudinal.value=a==="latitudinal",l&&(f.poleAxis.value=l);const{_lodMax:x}=this;f.dTheta.value=g,f.mipInt.value=x-r;const _=this._sizeLods[s],w=3*_*(s>x-$m?s-x+$m:0),T=4*(this._cubeSize-_);dw(i,w,T,3*_,2*_),c.setRenderTarget(i),c.render(d,rR)}}function nN(n){const e=[],i=[],r=[];let s=n;const o=n-$m+1+eN.length;for(let a=0;a<o;a++){const l=Math.pow(2,s);i.push(l);let c=1/l;a>n-$m?c=eN[a-n+$m-1]:a===0&&(c=0),r.push(c);const h=1/(l-2),u=-h,d=1+h,f=[u,u,d,u,d,d,u,u,d,d,u,d],m=6,g=6,v=3,y=2,A=1,b=new Float32Array(v*g*m),x=new Float32Array(y*g*m),_=new Float32Array(A*g*m);for(let T=0;T<m;T++){const M=T%3*2/3-1,R=T>2?0:-1,B=[M,R,0,M+2/3,R,0,M+2/3,R+1,0,M,R,0,M+2/3,R+1,0,M,R+1,0];b.set(B,v*g*T),x.set(f,y*g*T);const E=[T,T,T,T,T,T];_.set(E,A*g*T)}const w=new dt;w.setAttribute("position",new Ye(b,v)),w.setAttribute("uv",new Ye(x,y)),w.setAttribute("faceIndex",new Ye(_,A)),e.push(w),s>$m&&s--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function rN(n,e,i){const r=new qt(n,e,i);return r.texture.mapping=Pm,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function dw(n,e,i,r,s){n.viewport.set(e,i,r,s),n.scissor.set(e,i,r,s)}function BZ(n,e,i){const r=new Float32Array(Bp),s=new S(0,1,0);return new Bt({name:"SphericalGaussianBlur",defines:{n:Bp,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:cR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ln,depthTest:!1,depthWrite:!1})}function sN(){return new Bt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:cR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ln,depthTest:!1,depthWrite:!1})}function oN(){return new Bt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:cR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ln,depthTest:!1,depthWrite:!1})}function cR(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function kZ(n){let e=new WeakMap,i=null;function r(l){if(l&&l.isTexture){const c=l.mapping,h=c===qs||c===Rm,u=c===Zc||c===gu;if(h||u)if(l.isRenderTargetTexture&&l.needsPMREMUpdate===!0){l.needsPMREMUpdate=!1;let d=e.get(l);return i===null&&(i=new lR(n)),d=h?i.fromEquirectangular(l,d):i.fromCubemap(l,d),e.set(l,d),d.texture}else{if(e.has(l))return e.get(l).texture;{const d=l.image;if(h&&d&&d.height>0||u&&d&&s(d)){i=new lR(n);const f=h?i.fromEquirectangular(l):i.fromCubemap(l);return e.set(l,f),l.addEventListener("dispose",o),f.texture}else return null}}}return l}function s(l){let c=0;const h=6;for(let u=0;u<h;u++)l[u]!==void 0&&c++;return c===h}function o(l){const c=l.target;c.removeEventListener("dispose",o);const h=e.get(c);h!==void 0&&(e.delete(c),h.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function OZ(n){const e={};function i(r){if(e[r]!==void 0)return e[r];let s;switch(r){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(r)}return e[r]=s,s}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?(i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance")):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){const s=i(r);return s===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),s}}}function DZ(n,e,i,r){const s={},o=new WeakMap;function a(d){const f=d.target;f.index!==null&&e.remove(f.index);for(const g in f.attributes)e.remove(f.attributes[g]);for(const g in f.morphAttributes){const v=f.morphAttributes[g];for(let y=0,A=v.length;y<A;y++)e.remove(v[y])}f.removeEventListener("dispose",a),delete s[f.id];const m=o.get(f);m&&(e.remove(m),o.delete(f)),r.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,i.memory.geometries--}function l(d,f){return s[f.id]===!0||(f.addEventListener("dispose",a),s[f.id]=!0,i.memory.geometries++),f}function c(d){const f=d.attributes;for(const g in f)e.update(f[g],n.ARRAY_BUFFER);const m=d.morphAttributes;for(const g in m){const v=m[g];for(let y=0,A=v.length;y<A;y++)e.update(v[y],n.ARRAY_BUFFER)}}function h(d){const f=[],m=d.index,g=d.attributes.position;let v=0;if(m!==null){const b=m.array;v=m.version;for(let x=0,_=b.length;x<_;x+=3){const w=b[x+0],T=b[x+1],M=b[x+2];f.push(w,T,T,M,M,w)}}else if(g!==void 0){const b=g.array;v=g.version;for(let x=0,_=b.length/3-1;x<_;x+=3){const w=x+0,T=x+1,M=x+2;f.push(w,T,T,M,M,w)}}else return;const y=new(IF(f)?ZI:tw)(f,1);y.version=v;const A=o.get(d);A&&e.remove(A),o.set(d,y)}function u(d){const f=o.get(d);if(f){const m=d.index;m!==null&&f.version<m.version&&h(d)}else h(d);return o.get(d)}return{get:l,update:c,getWireframeAttribute:u}}function LZ(n,e,i,r){const s=r.isWebGL2;let o;function a(m){o=m}let l,c;function h(m){l=m.type,c=m.bytesPerElement}function u(m,g){n.drawElements(o,g,l,m*c),i.update(g,o,1)}function d(m,g,v){if(v===0)return;let y,A;if(s)y=n,A="drawElementsInstanced";else if(y=e.get("ANGLE_instanced_arrays"),A="drawElementsInstancedANGLE",y===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}y[A](o,g,l,m*c,v),i.update(g,o,v)}function f(m,g,v){if(v===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let A=0;A<v;A++)this.render(m[A]/c,g[A]);else{y.multiDrawElementsWEBGL(o,g,0,l,m,0,v);let A=0;for(let b=0;b<v;b++)A+=g[b];i.update(A,o,1)}}this.setMode=a,this.setIndex=h,this.render=u,this.renderInstances=d,this.renderMultiDraw=f}function UZ(n){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(o,a,l){switch(i.calls++,a){case n.TRIANGLES:i.triangles+=l*(o/3);break;case n.LINES:i.lines+=l*(o/2);break;case n.LINE_STRIP:i.lines+=l*(o-1);break;case n.LINE_LOOP:i.lines+=l*o;break;case n.POINTS:i.points+=l*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function s(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:s,update:r}}function FZ(n,e){return n[0]-e[0]}function NZ(n,e){return Math.abs(e[1])-Math.abs(n[1])}function zZ(n,e,i){const r={},s=new Float32Array(8),o=new WeakMap,a=new qe,l=[];for(let h=0;h<8;h++)l[h]=[h,0];function c(h,u,d){const f=h.morphTargetInfluences;if(e.isWebGL2===!0){const m=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,g=m!==void 0?m.length:0;let v=o.get(u);if(v===void 0||v.count!==g){let y=function(){P.dispose(),o.delete(u),u.removeEventListener("dispose",y)};v!==void 0&&v.texture.dispose();const A=u.morphAttributes.position!==void 0,b=u.morphAttributes.normal!==void 0,x=u.morphAttributes.color!==void 0,_=u.morphAttributes.position||[],w=u.morphAttributes.normal||[],T=u.morphAttributes.color||[];let M=0;A===!0&&(M=1),b===!0&&(M=2),x===!0&&(M=3);let R=u.attributes.position.count*M,B=1;R>e.maxTextureSize&&(B=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const E=new Float32Array(R*B*4*g),P=new Q_(E,R,B,g);P.type=Hi,P.needsUpdate=!0;const O=M*4;for(let N=0;N<g;N++){const L=_[N],Q=w[N],D=T[N],F=R*B*4*N;for(let H=0;H<L.count;H++){const K=H*O;A===!0&&(a.fromBufferAttribute(L,H),E[F+K+0]=a.x,E[F+K+1]=a.y,E[F+K+2]=a.z,E[F+K+3]=0),b===!0&&(a.fromBufferAttribute(Q,H),E[F+K+4]=a.x,E[F+K+5]=a.y,E[F+K+6]=a.z,E[F+K+7]=0),x===!0&&(a.fromBufferAttribute(D,H),E[F+K+8]=a.x,E[F+K+9]=a.y,E[F+K+10]=a.z,E[F+K+11]=D.itemSize===4?a.w:1)}}v={count:g,texture:P,size:new J(R,B)},o.set(u,v),u.addEventListener("dispose",y)}if(h.isInstancedMesh===!0&&h.morphTexture!==null)d.getUniforms().setValue(n,"morphTexture",h.morphTexture,i);else{let y=0;for(let b=0;b<f.length;b++)y+=f[b];const A=u.morphTargetsRelative?1:1-y;d.getUniforms().setValue(n,"morphTargetBaseInfluence",A),d.getUniforms().setValue(n,"morphTargetInfluences",f)}d.getUniforms().setValue(n,"morphTargetsTexture",v.texture,i),d.getUniforms().setValue(n,"morphTargetsTextureSize",v.size)}else{const m=f===void 0?0:f.length;let g=r[u.id];if(g===void 0||g.length!==m){g=[];for(let x=0;x<m;x++)g[x]=[x,0];r[u.id]=g}for(let x=0;x<m;x++){const _=g[x];_[0]=x,_[1]=f[x]}g.sort(NZ);for(let x=0;x<8;x++)x<m&&g[x][1]?(l[x][0]=g[x][0],l[x][1]=g[x][1]):(l[x][0]=Number.MAX_SAFE_INTEGER,l[x][1]=0);l.sort(FZ);const v=u.morphAttributes.position,y=u.morphAttributes.normal;let A=0;for(let x=0;x<8;x++){const _=l[x],w=_[0],T=_[1];w!==Number.MAX_SAFE_INTEGER&&T?(v&&u.getAttribute("morphTarget"+x)!==v[w]&&u.setAttribute("morphTarget"+x,v[w]),y&&u.getAttribute("morphNormal"+x)!==y[w]&&u.setAttribute("morphNormal"+x,y[w]),s[x]=T,A+=T):(v&&u.hasAttribute("morphTarget"+x)===!0&&u.deleteAttribute("morphTarget"+x),y&&u.hasAttribute("morphNormal"+x)===!0&&u.deleteAttribute("morphNormal"+x),s[x]=0)}const b=u.morphTargetsRelative?1:1-A;d.getUniforms().setValue(n,"morphTargetBaseInfluence",b),d.getUniforms().setValue(n,"morphTargetInfluences",s)}}return{update:c}}function jZ(n,e,i,r){let s=new WeakMap;function o(c){const h=r.render.frame,u=c.geometry,d=e.get(c,u);if(s.get(d)!==h&&(e.update(d),s.set(d,h)),c.isInstancedMesh&&(c.hasEventListener("dispose",l)===!1&&c.addEventListener("dispose",l),s.get(c)!==h&&(i.update(c.instanceMatrix,n.ARRAY_BUFFER),c.instanceColor!==null&&i.update(c.instanceColor,n.ARRAY_BUFFER),s.set(c,h))),c.isSkinnedMesh){const f=c.skeleton;s.get(f)!==h&&(f.update(),s.set(f,h))}return d}function a(){s=new WeakMap}function l(c){const h=c.target;h.removeEventListener("dispose",l),i.remove(h.instanceMatrix),h.instanceColor!==null&&i.remove(h.instanceColor)}return{update:o,dispose:a}}class tg extends Gt{constructor(e,i,r,s,o,a,l,c,h,u){if(u=u!==void 0?u:vu,u!==vu&&u!==yu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===vu&&(r=_s),r===void 0&&u===yu&&(r=eh),super(null,s,o,a,l,c,u,r,h),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=l!==void 0?l:Rt,this.minFilter=c!==void 0?c:Rt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}const aN=new Gt,lN=new tg(1,1);lN.compareFunction=PI;const cN=new Q_,hN=new FI,uN=new gy,dN=[],pN=[],fN=new Float32Array(16),mN=new Float32Array(9),gN=new Float32Array(4);function ig(n,e,i){const r=n[0];if(r<=0||r>0)return n;const s=e*i;let o=dN[s];if(o===void 0&&(o=new Float32Array(s),dN[s]=o),e!==0){r.toArray(o,0);for(let a=1,l=0;a!==e;++a)l+=i,n[a].toArray(o,l)}return o}function pr(n,e){if(n.length!==e.length)return!1;for(let i=0,r=n.length;i<r;i++)if(n[i]!==e[i])return!1;return!0}function fr(n,e){for(let i=0,r=e.length;i<r;i++)n[i]=e[i]}function pw(n,e){let i=pN[e];i===void 0&&(i=new Int32Array(e),pN[e]=i);for(let r=0;r!==e;++r)i[r]=n.allocateTextureUnit();return i}function GZ(n,e){const i=this.cache;i[0]!==e&&(n.uniform1f(this.addr,e),i[0]=e)}function HZ(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(pr(i,e))return;n.uniform2fv(this.addr,e),fr(i,e)}}function VZ(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(pr(i,e))return;n.uniform3fv(this.addr,e),fr(i,e)}}function QZ(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(pr(i,e))return;n.uniform4fv(this.addr,e),fr(i,e)}}function WZ(n,e){const i=this.cache,r=e.elements;if(r===void 0){if(pr(i,e))return;n.uniformMatrix2fv(this.addr,!1,e),fr(i,e)}else{if(pr(i,r))return;gN.set(r),n.uniformMatrix2fv(this.addr,!1,gN),fr(i,r)}}function XZ(n,e){const i=this.cache,r=e.elements;if(r===void 0){if(pr(i,e))return;n.uniformMatrix3fv(this.addr,!1,e),fr(i,e)}else{if(pr(i,r))return;mN.set(r),n.uniformMatrix3fv(this.addr,!1,mN),fr(i,r)}}function qZ(n,e){const i=this.cache,r=e.elements;if(r===void 0){if(pr(i,e))return;n.uniformMatrix4fv(this.addr,!1,e),fr(i,e)}else{if(pr(i,r))return;fN.set(r),n.uniformMatrix4fv(this.addr,!1,fN),fr(i,r)}}function YZ(n,e){const i=this.cache;i[0]!==e&&(n.uniform1i(this.addr,e),i[0]=e)}function JZ(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(pr(i,e))return;n.uniform2iv(this.addr,e),fr(i,e)}}function KZ(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(pr(i,e))return;n.uniform3iv(this.addr,e),fr(i,e)}}function ZZ(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(pr(i,e))return;n.uniform4iv(this.addr,e),fr(i,e)}}function $Z(n,e){const i=this.cache;i[0]!==e&&(n.uniform1ui(this.addr,e),i[0]=e)}function e$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(pr(i,e))return;n.uniform2uiv(this.addr,e),fr(i,e)}}function t$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(pr(i,e))return;n.uniform3uiv(this.addr,e),fr(i,e)}}function i$(n,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(pr(i,e))return;n.uniform4uiv(this.addr,e),fr(i,e)}}function n$(n,e,i){const r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(n.uniform1i(this.addr,s),r[0]=s);const o=this.type===n.SAMPLER_2D_SHADOW?lN:aN;i.setTexture2D(e||o,s)}function r$(n,e,i){const r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(n.uniform1i(this.addr,s),r[0]=s),i.setTexture3D(e||hN,s)}function s$(n,e,i){const r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(n.uniform1i(this.addr,s),r[0]=s),i.setTextureCube(e||uN,s)}function o$(n,e,i){const r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(n.uniform1i(this.addr,s),r[0]=s),i.setTexture2DArray(e||cN,s)}function a$(n){switch(n){case 5126:return GZ;case 35664:return HZ;case 35665:return VZ;case 35666:return QZ;case 35674:return WZ;case 35675:return XZ;case 35676:return qZ;case 5124:case 35670:return YZ;case 35667:case 35671:return JZ;case 35668:case 35672:return KZ;case 35669:case 35673:return ZZ;case 5125:return $Z;case 36294:return e$;case 36295:return t$;case 36296:return i$;case 35678:case 36198:case 36298:case 36306:case 35682:return n$;case 35679:case 36299:case 36307:return r$;case 35680:case 36300:case 36308:case 36293:return s$;case 36289:case 36303:case 36311:case 36292:return o$}}function l$(n,e){n.uniform1fv(this.addr,e)}function c$(n,e){const i=ig(e,this.size,2);n.uniform2fv(this.addr,i)}function h$(n,e){const i=ig(e,this.size,3);n.uniform3fv(this.addr,i)}function u$(n,e){const i=ig(e,this.size,4);n.uniform4fv(this.addr,i)}function d$(n,e){const i=ig(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,i)}function p$(n,e){const i=ig(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,i)}function f$(n,e){const i=ig(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,i)}function m$(n,e){n.uniform1iv(this.addr,e)}function g$(n,e){n.uniform2iv(this.addr,e)}function v$(n,e){n.uniform3iv(this.addr,e)}function y$(n,e){n.uniform4iv(this.addr,e)}function A$(n,e){n.uniform1uiv(this.addr,e)}function b$(n,e){n.uniform2uiv(this.addr,e)}function x$(n,e){n.uniform3uiv(this.addr,e)}function _$(n,e){n.uniform4uiv(this.addr,e)}function w$(n,e,i){const r=this.cache,s=e.length,o=pw(i,s);pr(r,o)||(n.uniform1iv(this.addr,o),fr(r,o));for(let a=0;a!==s;++a)i.setTexture2D(e[a]||aN,o[a])}function S$(n,e,i){const r=this.cache,s=e.length,o=pw(i,s);pr(r,o)||(n.uniform1iv(this.addr,o),fr(r,o));for(let a=0;a!==s;++a)i.setTexture3D(e[a]||hN,o[a])}function C$(n,e,i){const r=this.cache,s=e.length,o=pw(i,s);pr(r,o)||(n.uniform1iv(this.addr,o),fr(r,o));for(let a=0;a!==s;++a)i.setTextureCube(e[a]||uN,o[a])}function E$(n,e,i){const r=this.cache,s=e.length,o=pw(i,s);pr(r,o)||(n.uniform1iv(this.addr,o),fr(r,o));for(let a=0;a!==s;++a)i.setTexture2DArray(e[a]||cN,o[a])}function M$(n){switch(n){case 5126:return l$;case 35664:return c$;case 35665:return h$;case 35666:return u$;case 35674:return d$;case 35675:return p$;case 35676:return f$;case 5124:case 35670:return m$;case 35667:case 35671:return g$;case 35668:case 35672:return v$;case 35669:case 35673:return y$;case 5125:return A$;case 36294:return b$;case 36295:return x$;case 36296:return _$;case 35678:case 36198:case 36298:case 36306:case 35682:return w$;case 35679:case 36299:case 36307:return S$;case 35680:case 36300:case 36308:case 36293:return C$;case 36289:case 36303:case 36311:case 36292:return E$}}class T${constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.type=i.type,this.setValue=a$(i.type)}}class I${constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=M$(i.type)}}class R${constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,r){const s=this.seq;for(let o=0,a=s.length;o!==a;++o){const l=s[o];l.setValue(e,i[l.id],r)}}}const hR=/(\w+)(\])?(\[|\.)?/g;function vN(n,e){n.seq.push(e),n.map[e.id]=e}function P$(n,e,i){const r=n.name,s=r.length;for(hR.lastIndex=0;;){const o=hR.exec(r),a=hR.lastIndex;let l=o[1];const c=o[2]==="]",h=o[3];if(c&&(l=l|0),h===void 0||h==="["&&a+2===s){vN(i,h===void 0?new T$(l,n,e):new I$(l,n,e));break}else{let u=i.map[l];u===void 0&&(u=new R$(l),vN(i,u)),i=u}}}class fw{constructor(e,i){this.seq=[],this.map={};const r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let s=0;s<r;++s){const o=e.getActiveUniform(i,s),a=e.getUniformLocation(i,o.name);P$(o,a,this)}}setValue(e,i,r,s){const o=this.map[i];o!==void 0&&o.setValue(e,r,s)}setOptional(e,i,r){const s=i[r];s!==void 0&&this.setValue(e,r,s)}static upload(e,i,r,s){for(let o=0,a=i.length;o!==a;++o){const l=i[o],c=r[l.id];c.needsUpdate!==!1&&l.setValue(e,c.value,s)}}static seqWithValue(e,i){const r=[];for(let s=0,o=e.length;s!==o;++s){const a=e[s];a.id in i&&r.push(a)}return r}}function yN(n,e,i){const r=n.createShader(e);return n.shaderSource(r,i),n.compileShader(r),r}const B$=37297;let k$=0;function O$(n,e){const i=n.split(`
`),r=[],s=Math.max(e-6,0),o=Math.min(e+6,i.length);for(let a=s;a<o;a++){const l=a+1;r.push(`${l===e?">":" "} ${l}: ${i[a]}`)}return r.join(`
`)}function D$(n){const e=xi.getPrimaries(xi.workingColorSpace),i=xi.getPrimaries(n);let r;switch(e===i?r="":e===sy&&i===ry?r="LinearDisplayP3ToLinearSRGB":e===ry&&i===sy&&(r="LinearSRGBToLinearDisplayP3"),n){case Ii:case iy:return[r,"LinearTransferOETF"];case gt:case N_:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[r,"LinearTransferOETF"]}}function AN(n,e,i){const r=n.getShaderParameter(e,n.COMPILE_STATUS),s=n.getShaderInfoLog(e).trim();if(r&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const a=parseInt(o[1]);return i.toUpperCase()+`

`+s+`

`+O$(n.getShaderSource(e),a)}else return s}function L$(n,e){const i=D$(e);return`vec4 ${n}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function U$(n,e){let i;switch(e){case Tm:i="Linear";break;case Jv:i="Reinhard";break;case ZU:i="OptimizedCineon";break;case Kv:i="ACESFilmic";break;case Im:i="AgX";break;case vp:i="Neutral";break;case $U:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+n+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function F$(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||n.alphaToCoverage||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ng).join(`
`)}function N$(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ng).join(`
`)}function z$(n){const e=[];for(const i in n){const r=n[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function j$(n,e){const i={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const o=n.getActiveAttrib(e,s),a=o.name;let l=1;o.type===n.FLOAT_MAT2&&(l=2),o.type===n.FLOAT_MAT3&&(l=3),o.type===n.FLOAT_MAT4&&(l=4),i[a]={type:o.type,location:n.getAttribLocation(e,a),locationSize:l}}return i}function ng(n){return n!==""}function bN(n,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function xN(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const G$=/^[ \t]*#include +<([\w\d./]+)>/gm;function uR(n){return n.replace(G$,V$)}const H$=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function V$(n,e){let i=Ct[e];if(i===void 0){const r=H$.get(e);if(r!==void 0)i=Ct[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return uR(i)}const Q$=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function _N(n){return n.replace(Q$,W$)}function W$(n,e,i,r){let s="";for(let o=parseInt(e);o<parseInt(i);o++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return s}function wN(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	`;return n.isWebGL2&&(e+=`precision ${n.precision} sampler3D;
		precision ${n.precision} sampler2DArray;
		precision ${n.precision} sampler2DShadow;
		precision ${n.precision} samplerCubeShadow;
		precision ${n.precision} sampler2DArrayShadow;
		precision ${n.precision} isampler2D;
		precision ${n.precision} isampler3D;
		precision ${n.precision} isamplerCube;
		precision ${n.precision} isampler2DArray;
		precision ${n.precision} usampler2D;
		precision ${n.precision} usampler3D;
		precision ${n.precision} usamplerCube;
		precision ${n.precision} usampler2DArray;
		`),n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function X$(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===HT?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===VT?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Wl&&(e="SHADOWMAP_TYPE_VSM"),e}function q$(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Zc:case gu:e="ENVMAP_TYPE_CUBE";break;case Pm:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Y$(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case gu:e="ENVMAP_MODE_REFRACTION";break}return e}function J$(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Yv:e="ENVMAP_BLENDING_MULTIPLY";break;case JU:e="ENVMAP_BLENDING_MIX";break;case KU:e="ENVMAP_BLENDING_ADD";break}return e}function K$(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function Z$(n,e,i,r){const s=n.getContext(),o=i.defines;let a=i.vertexShader,l=i.fragmentShader;const c=X$(i),h=q$(i),u=Y$(i),d=J$(i),f=K$(i),m=i.isWebGL2?"":F$(i),g=N$(i),v=z$(o),y=s.createProgram();let A,b,x=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(A=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,v].filter(ng).join(`
`),A.length>0&&(A+=`
`),b=[m,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,v].filter(ng).join(`
`),b.length>0&&(b+=`
`)):(A=[wN(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,v,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ng).join(`
`),b=[m,wN(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,v,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+u:"",i.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+c:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Xs?"#define TONE_MAPPING":"",i.toneMapping!==Xs?Ct.tonemapping_pars_fragment:"",i.toneMapping!==Xs?U$("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Ct.colorspace_pars_fragment,L$("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(ng).join(`
`)),a=uR(a),a=bN(a,i),a=xN(a,i),l=uR(l),l=bN(l,i),l=xN(l,i),a=_N(a),l=_N(l),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,A=[g,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+A,b=["precision mediump sampler2DArray;","#define varying in",i.glslVersion===j_?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===j_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);const _=x+A+a,w=x+b+l,T=yN(s,s.VERTEX_SHADER,_),M=yN(s,s.FRAGMENT_SHADER,w);s.attachShader(y,T),s.attachShader(y,M),i.index0AttributeName!==void 0?s.bindAttribLocation(y,0,i.index0AttributeName):i.morphTargets===!0&&s.bindAttribLocation(y,0,"position"),s.linkProgram(y);function R(O){if(n.debug.checkShaderErrors){const N=s.getProgramInfoLog(y).trim(),L=s.getShaderInfoLog(T).trim(),Q=s.getShaderInfoLog(M).trim();let D=!0,F=!0;if(s.getProgramParameter(y,s.LINK_STATUS)===!1)if(D=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(s,y,T,M);else{const H=AN(s,T,"vertex"),K=AN(s,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(y,s.VALIDATE_STATUS)+`

Material Name: `+O.name+`
Material Type: `+O.type+`

Program Info Log: `+N+`
`+H+`
`+K)}else N!==""?console.warn("THREE.WebGLProgram: Program Info Log:",N):(L===""||Q==="")&&(F=!1);F&&(O.diagnostics={runnable:D,programLog:N,vertexShader:{log:L,prefix:A},fragmentShader:{log:Q,prefix:b}})}s.deleteShader(T),s.deleteShader(M),B=new fw(s,y),E=j$(s,y)}let B;this.getUniforms=function(){return B===void 0&&R(this),B};let E;this.getAttributes=function(){return E===void 0&&R(this),E};let P=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return P===!1&&(P=s.getProgramParameter(y,B$)),P},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(y),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=k$++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=T,this.fragmentShader=M,this}let $$=0;class eee{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,r=e.fragmentShader,s=this._getShaderStage(i),o=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(s)===!1&&(a.add(s),s.usedTimes++),a.has(o)===!1&&(a.add(o),o.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let r=i.get(e);return r===void 0&&(r=new Set,i.set(e,r)),r}_getShaderStage(e){const i=this.shaderCache;let r=i.get(e);return r===void 0&&(r=new tee(e),i.set(e,r)),r}}class tee{constructor(e){this.id=$$++,this.code=e,this.usedTimes=0}}function iee(n,e,i,r,s,o,a){const l=new Cs,c=new eee,h=new Set,u=[],d=s.isWebGL2,f=s.logarithmicDepthBuffer,m=s.vertexTextures;let g=s.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(E){return h.add(E),E===0?"uv":`uv${E}`}function A(E,P,O,N,L){const Q=N.fog,D=L.geometry,F=E.isMeshStandardMaterial?N.environment:null,H=(E.isMeshStandardMaterial?i:e).get(E.envMap||F),K=H&&H.mapping===Pm?H.image.height:null,Z=v[E.type];E.precision!==null&&(g=s.getMaxPrecision(E.precision),g!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",g,"instead."));const oe=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,we=oe!==void 0?oe.length:0;let Oe=0;D.morphAttributes.position!==void 0&&(Oe=1),D.morphAttributes.normal!==void 0&&(Oe=2),D.morphAttributes.color!==void 0&&(Oe=3);let se,_e,Ee,et;if(Z){const Re=qr[Z];se=Re.vertexShader,_e=Re.fragmentShader}else se=E.vertexShader,_e=E.fragmentShader,c.update(E),Ee=c.getVertexShaderID(E),et=c.getFragmentShaderID(E);const We=n.getRenderTarget(),Ue=L.isInstancedMesh===!0,st=L.isBatchedMesh===!0,ge=!!E.map,X=!!E.matcap,ze=!!H,Ie=!!E.aoMap,Te=!!E.lightMap,Ve=!!E.bumpMap,Ae=!!E.normalMap,nt=!!E.displacementMap,ct=!!E.emissiveMap,It=!!E.metalnessMap,V=!!E.roughnessMap,U=E.anisotropy>0,ue=E.clearcoat>0,Me=E.iridescence>0,De=E.sheen>0,Pe=E.transmission>0,At=U&&!!E.anisotropyMap,ht=ue&&!!E.clearcoatMap,je=ue&&!!E.clearcoatNormalMap,He=ue&&!!E.clearcoatRoughnessMap,St=Me&&!!E.iridescenceMap,Fe=Me&&!!E.iridescenceThicknessMap,Kt=De&&!!E.sheenColorMap,Le=De&&!!E.sheenRoughnessMap,_t=!!E.specularMap,ut=!!E.specularColorMap,I=!!E.specularIntensityMap,k=Pe&&!!E.transmissionMap,G=Pe&&!!E.thicknessMap,ee=!!E.gradientMap,j=!!E.alphaMap,Y=E.alphaTest>0,W=!!E.alphaHash,ae=!!E.extensions;let ce=Xs;E.toneMapped&&(We===null||We.isXRRenderTarget===!0)&&(ce=n.toneMapping);const xe={isWebGL2:d,shaderID:Z,shaderType:E.type,shaderName:E.name,vertexShader:se,fragmentShader:_e,defines:E.defines,customVertexShaderID:Ee,customFragmentShaderID:et,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:g,batching:st,instancing:Ue,instancingColor:Ue&&L.instanceColor!==null,instancingMorph:Ue&&L.morphTexture!==null,supportsVertexTextures:m,outputColorSpace:We===null?n.outputColorSpace:We.isXRRenderTarget===!0?We.texture.colorSpace:Ii,alphaToCoverage:!!E.alphaToCoverage,map:ge,matcap:X,envMap:ze,envMapMode:ze&&H.mapping,envMapCubeUVHeight:K,aoMap:Ie,lightMap:Te,bumpMap:Ve,normalMap:Ae,displacementMap:m&&nt,emissiveMap:ct,normalMapObjectSpace:Ae&&E.normalMapType===aF,normalMapTangentSpace:Ae&&E.normalMapType===bu,metalnessMap:It,roughnessMap:V,anisotropy:U,anisotropyMap:At,clearcoat:ue,clearcoatMap:ht,clearcoatNormalMap:je,clearcoatRoughnessMap:He,iridescence:Me,iridescenceMap:St,iridescenceThicknessMap:Fe,sheen:De,sheenColorMap:Kt,sheenRoughnessMap:Le,specularMap:_t,specularColorMap:ut,specularIntensityMap:I,transmission:Pe,transmissionMap:k,thicknessMap:G,gradientMap:ee,opaque:E.transparent===!1&&E.blending===fu&&E.alphaToCoverage===!1,alphaMap:j,alphaTest:Y,alphaHash:W,combine:E.combine,mapUv:ge&&y(E.map.channel),aoMapUv:Ie&&y(E.aoMap.channel),lightMapUv:Te&&y(E.lightMap.channel),bumpMapUv:Ve&&y(E.bumpMap.channel),normalMapUv:Ae&&y(E.normalMap.channel),displacementMapUv:nt&&y(E.displacementMap.channel),emissiveMapUv:ct&&y(E.emissiveMap.channel),metalnessMapUv:It&&y(E.metalnessMap.channel),roughnessMapUv:V&&y(E.roughnessMap.channel),anisotropyMapUv:At&&y(E.anisotropyMap.channel),clearcoatMapUv:ht&&y(E.clearcoatMap.channel),clearcoatNormalMapUv:je&&y(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:He&&y(E.clearcoatRoughnessMap.channel),iridescenceMapUv:St&&y(E.iridescenceMap.channel),iridescenceThicknessMapUv:Fe&&y(E.iridescenceThicknessMap.channel),sheenColorMapUv:Kt&&y(E.sheenColorMap.channel),sheenRoughnessMapUv:Le&&y(E.sheenRoughnessMap.channel),specularMapUv:_t&&y(E.specularMap.channel),specularColorMapUv:ut&&y(E.specularColorMap.channel),specularIntensityMapUv:I&&y(E.specularIntensityMap.channel),transmissionMapUv:k&&y(E.transmissionMap.channel),thicknessMapUv:G&&y(E.thicknessMap.channel),alphaMapUv:j&&y(E.alphaMap.channel),vertexTangents:!!D.attributes.tangent&&(Ae||U),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!D.attributes.color&&D.attributes.color.itemSize===4,pointsUvs:L.isPoints===!0&&!!D.attributes.uv&&(ge||j),fog:!!Q,useFog:E.fog===!0,fogExp2:!!Q&&Q.isFogExp2,flatShading:E.flatShading===!0,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:f,skinning:L.isSkinnedMesh===!0,morphTargets:D.morphAttributes.position!==void 0,morphNormals:D.morphAttributes.normal!==void 0,morphColors:D.morphAttributes.color!==void 0,morphTargetsCount:we,morphTextureStride:Oe,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numLightProbes:P.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:E.dithering,shadowMapEnabled:n.shadowMap.enabled&&O.length>0,shadowMapType:n.shadowMap.type,toneMapping:ce,useLegacyLights:n._useLegacyLights,decodeVideoTexture:ge&&E.map.isVideoTexture===!0&&xi.getTransfer(E.map.colorSpace)===Vi,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===yi,flipSided:E.side===an,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:ae&&E.extensions.derivatives===!0,extensionFragDepth:ae&&E.extensions.fragDepth===!0,extensionDrawBuffers:ae&&E.extensions.drawBuffers===!0,extensionShaderTextureLOD:ae&&E.extensions.shaderTextureLOD===!0,extensionClipCullDistance:ae&&E.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:ae&&E.extensions.multiDraw===!0&&r.has("WEBGL_multi_draw"),rendererExtensionFragDepth:d||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()};return xe.vertexUv1s=h.has(1),xe.vertexUv2s=h.has(2),xe.vertexUv3s=h.has(3),h.clear(),xe}function b(E){const P=[];if(E.shaderID?P.push(E.shaderID):(P.push(E.customVertexShaderID),P.push(E.customFragmentShaderID)),E.defines!==void 0)for(const O in E.defines)P.push(O),P.push(E.defines[O]);return E.isRawShaderMaterial===!1&&(x(P,E),_(P,E),P.push(n.outputColorSpace)),P.push(E.customProgramCacheKey),P.join()}function x(E,P){E.push(P.precision),E.push(P.outputColorSpace),E.push(P.envMapMode),E.push(P.envMapCubeUVHeight),E.push(P.mapUv),E.push(P.alphaMapUv),E.push(P.lightMapUv),E.push(P.aoMapUv),E.push(P.bumpMapUv),E.push(P.normalMapUv),E.push(P.displacementMapUv),E.push(P.emissiveMapUv),E.push(P.metalnessMapUv),E.push(P.roughnessMapUv),E.push(P.anisotropyMapUv),E.push(P.clearcoatMapUv),E.push(P.clearcoatNormalMapUv),E.push(P.clearcoatRoughnessMapUv),E.push(P.iridescenceMapUv),E.push(P.iridescenceThicknessMapUv),E.push(P.sheenColorMapUv),E.push(P.sheenRoughnessMapUv),E.push(P.specularMapUv),E.push(P.specularColorMapUv),E.push(P.specularIntensityMapUv),E.push(P.transmissionMapUv),E.push(P.thicknessMapUv),E.push(P.combine),E.push(P.fogExp2),E.push(P.sizeAttenuation),E.push(P.morphTargetsCount),E.push(P.morphAttributeCount),E.push(P.numDirLights),E.push(P.numPointLights),E.push(P.numSpotLights),E.push(P.numSpotLightMaps),E.push(P.numHemiLights),E.push(P.numRectAreaLights),E.push(P.numDirLightShadows),E.push(P.numPointLightShadows),E.push(P.numSpotLightShadows),E.push(P.numSpotLightShadowsWithMaps),E.push(P.numLightProbes),E.push(P.shadowMapType),E.push(P.toneMapping),E.push(P.numClippingPlanes),E.push(P.numClipIntersection),E.push(P.depthPacking)}function _(E,P){l.disableAll(),P.isWebGL2&&l.enable(0),P.supportsVertexTextures&&l.enable(1),P.instancing&&l.enable(2),P.instancingColor&&l.enable(3),P.instancingMorph&&l.enable(4),P.matcap&&l.enable(5),P.envMap&&l.enable(6),P.normalMapObjectSpace&&l.enable(7),P.normalMapTangentSpace&&l.enable(8),P.clearcoat&&l.enable(9),P.iridescence&&l.enable(10),P.alphaTest&&l.enable(11),P.vertexColors&&l.enable(12),P.vertexAlphas&&l.enable(13),P.vertexUv1s&&l.enable(14),P.vertexUv2s&&l.enable(15),P.vertexUv3s&&l.enable(16),P.vertexTangents&&l.enable(17),P.anisotropy&&l.enable(18),P.alphaHash&&l.enable(19),P.batching&&l.enable(20),E.push(l.mask),l.disableAll(),P.fog&&l.enable(0),P.useFog&&l.enable(1),P.flatShading&&l.enable(2),P.logarithmicDepthBuffer&&l.enable(3),P.skinning&&l.enable(4),P.morphTargets&&l.enable(5),P.morphNormals&&l.enable(6),P.morphColors&&l.enable(7),P.premultipliedAlpha&&l.enable(8),P.shadowMapEnabled&&l.enable(9),P.useLegacyLights&&l.enable(10),P.doubleSided&&l.enable(11),P.flipSided&&l.enable(12),P.useDepthPacking&&l.enable(13),P.dithering&&l.enable(14),P.transmission&&l.enable(15),P.sheen&&l.enable(16),P.opaque&&l.enable(17),P.pointsUvs&&l.enable(18),P.decodeVideoTexture&&l.enable(19),P.alphaToCoverage&&l.enable(20),E.push(l.mask)}function w(E){const P=v[E.type];let O;if(P){const N=qr[P];O=Jm.clone(N.uniforms)}else O=E.uniforms;return O}function T(E,P){let O;for(let N=0,L=u.length;N<L;N++){const Q=u[N];if(Q.cacheKey===P){O=Q,++O.usedTimes;break}}return O===void 0&&(O=new Z$(n,P,E,o),u.push(O)),O}function M(E){if(--E.usedTimes===0){const P=u.indexOf(E);u[P]=u[u.length-1],u.pop(),E.destroy()}}function R(E){c.remove(E)}function B(){c.dispose()}return{getParameters:A,getProgramCacheKey:b,getUniforms:w,acquireProgram:T,releaseProgram:M,releaseShaderCache:R,programs:u,dispose:B}}function nee(){let n=new WeakMap;function e(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function i(o){n.delete(o)}function r(o,a,l){n.get(o)[a]=l}function s(){n=new WeakMap}return{get:e,remove:i,update:r,dispose:s}}function ree(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function SN(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function CN(){const n=[];let e=0;const i=[],r=[],s=[];function o(){e=0,i.length=0,r.length=0,s.length=0}function a(d,f,m,g,v,y){let A=n[e];return A===void 0?(A={id:d.id,object:d,geometry:f,material:m,groupOrder:g,renderOrder:d.renderOrder,z:v,group:y},n[e]=A):(A.id=d.id,A.object=d,A.geometry=f,A.material=m,A.groupOrder=g,A.renderOrder=d.renderOrder,A.z=v,A.group=y),e++,A}function l(d,f,m,g,v,y){const A=a(d,f,m,g,v,y);m.transmission>0?r.push(A):m.transparent===!0?s.push(A):i.push(A)}function c(d,f,m,g,v,y){const A=a(d,f,m,g,v,y);m.transmission>0?r.unshift(A):m.transparent===!0?s.unshift(A):i.unshift(A)}function h(d,f){i.length>1&&i.sort(d||ree),r.length>1&&r.sort(f||SN),s.length>1&&s.sort(f||SN)}function u(){for(let d=e,f=n.length;d<f;d++){const m=n[d];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:i,transmissive:r,transparent:s,init:o,push:l,unshift:c,finish:u,sort:h}}function see(){let n=new WeakMap;function e(r,s){const o=n.get(r);let a;return o===void 0?(a=new CN,n.set(r,[a])):s>=o.length?(a=new CN,o.push(a)):a=o[s],a}function i(){n=new WeakMap}return{get:e,dispose:i}}function oee(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new S,color:new be};break;case"SpotLight":i={position:new S,direction:new S,color:new be,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new S,color:new be,distance:0,decay:0};break;case"HemisphereLight":i={direction:new S,skyColor:new be,groundColor:new be};break;case"RectAreaLight":i={color:new be,position:new S,halfWidth:new S,halfHeight:new S};break}return n[e.id]=i,i}}}function aee(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=i,i}}}let lee=0;function cee(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function hee(n,e){const i=new oee,r=aee(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)s.probe.push(new S);const o=new S,a=new he,l=new he;function c(u,d){let f=0,m=0,g=0;for(let O=0;O<9;O++)s.probe[O].set(0,0,0);let v=0,y=0,A=0,b=0,x=0,_=0,w=0,T=0,M=0,R=0,B=0;u.sort(cee);const E=d===!0?Math.PI:1;for(let O=0,N=u.length;O<N;O++){const L=u[O],Q=L.color,D=L.intensity,F=L.distance,H=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)f+=Q.r*D*E,m+=Q.g*D*E,g+=Q.b*D*E;else if(L.isLightProbe){for(let K=0;K<9;K++)s.probe[K].addScaledVector(L.sh.coefficients[K],D);B++}else if(L.isDirectionalLight){const K=i.get(L);if(K.color.copy(L.color).multiplyScalar(L.intensity*E),L.castShadow){const Z=L.shadow,oe=r.get(L);oe.shadowBias=Z.bias,oe.shadowNormalBias=Z.normalBias,oe.shadowRadius=Z.radius,oe.shadowMapSize=Z.mapSize,s.directionalShadow[v]=oe,s.directionalShadowMap[v]=H,s.directionalShadowMatrix[v]=L.shadow.matrix,_++}s.directional[v]=K,v++}else if(L.isSpotLight){const K=i.get(L);K.position.setFromMatrixPosition(L.matrixWorld),K.color.copy(Q).multiplyScalar(D*E),K.distance=F,K.coneCos=Math.cos(L.angle),K.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),K.decay=L.decay,s.spot[A]=K;const Z=L.shadow;if(L.map&&(s.spotLightMap[M]=L.map,M++,Z.updateMatrices(L),L.castShadow&&R++),s.spotLightMatrix[A]=Z.matrix,L.castShadow){const oe=r.get(L);oe.shadowBias=Z.bias,oe.shadowNormalBias=Z.normalBias,oe.shadowRadius=Z.radius,oe.shadowMapSize=Z.mapSize,s.spotShadow[A]=oe,s.spotShadowMap[A]=H,T++}A++}else if(L.isRectAreaLight){const K=i.get(L);K.color.copy(Q).multiplyScalar(D),K.halfWidth.set(L.width*.5,0,0),K.halfHeight.set(0,L.height*.5,0),s.rectArea[b]=K,b++}else if(L.isPointLight){const K=i.get(L);if(K.color.copy(L.color).multiplyScalar(L.intensity*E),K.distance=L.distance,K.decay=L.decay,L.castShadow){const Z=L.shadow,oe=r.get(L);oe.shadowBias=Z.bias,oe.shadowNormalBias=Z.normalBias,oe.shadowRadius=Z.radius,oe.shadowMapSize=Z.mapSize,oe.shadowCameraNear=Z.camera.near,oe.shadowCameraFar=Z.camera.far,s.pointShadow[y]=oe,s.pointShadowMap[y]=H,s.pointShadowMatrix[y]=L.shadow.matrix,w++}s.point[y]=K,y++}else if(L.isHemisphereLight){const K=i.get(L);K.skyColor.copy(L.color).multiplyScalar(D*E),K.groundColor.copy(L.groundColor).multiplyScalar(D*E),s.hemi[x]=K,x++}}b>0&&(e.isWebGL2?n.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Ge.LTC_FLOAT_1,s.rectAreaLTC2=Ge.LTC_FLOAT_2):(s.rectAreaLTC1=Ge.LTC_HALF_1,s.rectAreaLTC2=Ge.LTC_HALF_2):n.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Ge.LTC_FLOAT_1,s.rectAreaLTC2=Ge.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=Ge.LTC_HALF_1,s.rectAreaLTC2=Ge.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=f,s.ambient[1]=m,s.ambient[2]=g;const P=s.hash;(P.directionalLength!==v||P.pointLength!==y||P.spotLength!==A||P.rectAreaLength!==b||P.hemiLength!==x||P.numDirectionalShadows!==_||P.numPointShadows!==w||P.numSpotShadows!==T||P.numSpotMaps!==M||P.numLightProbes!==B)&&(s.directional.length=v,s.spot.length=A,s.rectArea.length=b,s.point.length=y,s.hemi.length=x,s.directionalShadow.length=_,s.directionalShadowMap.length=_,s.pointShadow.length=w,s.pointShadowMap.length=w,s.spotShadow.length=T,s.spotShadowMap.length=T,s.directionalShadowMatrix.length=_,s.pointShadowMatrix.length=w,s.spotLightMatrix.length=T+M-R,s.spotLightMap.length=M,s.numSpotLightShadowsWithMaps=R,s.numLightProbes=B,P.directionalLength=v,P.pointLength=y,P.spotLength=A,P.rectAreaLength=b,P.hemiLength=x,P.numDirectionalShadows=_,P.numPointShadows=w,P.numSpotShadows=T,P.numSpotMaps=M,P.numLightProbes=B,s.version=lee++)}function h(u,d){let f=0,m=0,g=0,v=0,y=0;const A=d.matrixWorldInverse;for(let b=0,x=u.length;b<x;b++){const _=u[b];if(_.isDirectionalLight){const w=s.directional[f];w.direction.setFromMatrixPosition(_.matrixWorld),o.setFromMatrixPosition(_.target.matrixWorld),w.direction.sub(o),w.direction.transformDirection(A),f++}else if(_.isSpotLight){const w=s.spot[g];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(A),w.direction.setFromMatrixPosition(_.matrixWorld),o.setFromMatrixPosition(_.target.matrixWorld),w.direction.sub(o),w.direction.transformDirection(A),g++}else if(_.isRectAreaLight){const w=s.rectArea[v];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(A),l.identity(),a.copy(_.matrixWorld),a.premultiply(A),l.extractRotation(a),w.halfWidth.set(_.width*.5,0,0),w.halfHeight.set(0,_.height*.5,0),w.halfWidth.applyMatrix4(l),w.halfHeight.applyMatrix4(l),v++}else if(_.isPointLight){const w=s.point[m];w.position.setFromMatrixPosition(_.matrixWorld),w.position.applyMatrix4(A),m++}else if(_.isHemisphereLight){const w=s.hemi[y];w.direction.setFromMatrixPosition(_.matrixWorld),w.direction.transformDirection(A),y++}}}return{setup:c,setupView:h,state:s}}function EN(n,e){const i=new hee(n,e),r=[],s=[];function o(){r.length=0,s.length=0}function a(u){r.push(u)}function l(u){s.push(u)}function c(u){i.setup(r,u)}function h(u){i.setupView(r,u)}return{init:o,state:{lightsArray:r,shadowsArray:s,lights:i},setupLights:c,setupLightsView:h,pushLight:a,pushShadow:l}}function uee(n,e){let i=new WeakMap;function r(o,a=0){const l=i.get(o);let c;return l===void 0?(c=new EN(n,e),i.set(o,[c])):a>=l.length?(c=new EN(n,e),l.push(c)):c=l[a],c}function s(){i=new WeakMap}return{get:r,dispose:s}}class vy extends Ut{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Wr,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class dR extends Ut{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const dee=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,pee=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function fee(n,e,i){let r=new Rp;const s=new J,o=new J,a=new qe,l=new vy({depthPacking:F_}),c=new dR,h={},u=i.maxTextureSize,d={[Fn]:an,[an]:Fn,[yi]:yi},f=new Bt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new J},radius:{value:4}},vertexShader:dee,fragmentShader:pee}),m=f.clone();m.defines.HORIZONTAL_PASS=1;const g=new dt;g.setAttribute("position",new Ye(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new pe(g,f),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=HT;let A=this.type;this.render=function(T,M,R){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||T.length===0)return;const B=n.getRenderTarget(),E=n.getActiveCubeFace(),P=n.getActiveMipmapLevel(),O=n.state;O.setBlending(ln),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);const N=A!==Wl&&this.type===Wl,L=A===Wl&&this.type!==Wl;for(let Q=0,D=T.length;Q<D;Q++){const F=T[Q],H=F.shadow;if(H===void 0){console.warn("THREE.WebGLShadowMap:",F,"has no shadow.");continue}if(H.autoUpdate===!1&&H.needsUpdate===!1)continue;s.copy(H.mapSize);const K=H.getFrameExtents();if(s.multiply(K),o.copy(H.mapSize),(s.x>u||s.y>u)&&(s.x>u&&(o.x=Math.floor(u/K.x),s.x=o.x*K.x,H.mapSize.x=o.x),s.y>u&&(o.y=Math.floor(u/K.y),s.y=o.y*K.y,H.mapSize.y=o.y)),H.map===null||N===!0||L===!0){const oe=this.type!==Wl?{minFilter:Rt,magFilter:Rt}:{};H.map!==null&&H.map.dispose(),H.map=new qt(s.x,s.y,oe),H.map.texture.name=F.name+".shadowMap",H.camera.updateProjectionMatrix()}n.setRenderTarget(H.map),n.clear();const Z=H.getViewportCount();for(let oe=0;oe<Z;oe++){const we=H.getViewport(oe);a.set(o.x*we.x,o.y*we.y,o.x*we.z,o.y*we.w),O.viewport(a),H.updateMatrices(F,oe),r=H.getFrustum(),_(M,R,H.camera,F,this.type)}H.isPointLightShadow!==!0&&this.type===Wl&&b(H,R),H.needsUpdate=!1}A=this.type,y.needsUpdate=!1,n.setRenderTarget(B,E,P)};function b(T,M){const R=e.update(v);f.defines.VSM_SAMPLES!==T.blurSamples&&(f.defines.VSM_SAMPLES=T.blurSamples,m.defines.VSM_SAMPLES=T.blurSamples,f.needsUpdate=!0,m.needsUpdate=!0),T.mapPass===null&&(T.mapPass=new qt(s.x,s.y)),f.uniforms.shadow_pass.value=T.map.texture,f.uniforms.resolution.value=T.mapSize,f.uniforms.radius.value=T.radius,n.setRenderTarget(T.mapPass),n.clear(),n.renderBufferDirect(M,null,R,f,v,null),m.uniforms.shadow_pass.value=T.mapPass.texture,m.uniforms.resolution.value=T.mapSize,m.uniforms.radius.value=T.radius,n.setRenderTarget(T.map),n.clear(),n.renderBufferDirect(M,null,R,m,v,null)}function x(T,M,R,B){let E=null;const P=R.isPointLight===!0?T.customDistanceMaterial:T.customDepthMaterial;if(P!==void 0)E=P;else if(E=R.isPointLight===!0?c:l,n.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const O=E.uuid,N=M.uuid;let L=h[O];L===void 0&&(L={},h[O]=L);let Q=L[N];Q===void 0&&(Q=E.clone(),L[N]=Q,M.addEventListener("dispose",w)),E=Q}if(E.visible=M.visible,E.wireframe=M.wireframe,B===Wl?E.side=M.shadowSide!==null?M.shadowSide:M.side:E.side=M.shadowSide!==null?M.shadowSide:d[M.side],E.alphaMap=M.alphaMap,E.alphaTest=M.alphaTest,E.map=M.map,E.clipShadows=M.clipShadows,E.clippingPlanes=M.clippingPlanes,E.clipIntersection=M.clipIntersection,E.displacementMap=M.displacementMap,E.displacementScale=M.displacementScale,E.displacementBias=M.displacementBias,E.wireframeLinewidth=M.wireframeLinewidth,E.linewidth=M.linewidth,R.isPointLight===!0&&E.isMeshDistanceMaterial===!0){const O=n.properties.get(E);O.light=R}return E}function _(T,M,R,B,E){if(T.visible===!1)return;if(T.layers.test(M.layers)&&(T.isMesh||T.isLine||T.isPoints)&&(T.castShadow||T.receiveShadow&&E===Wl)&&(!T.frustumCulled||r.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,T.matrixWorld);const O=e.update(T),N=T.material;if(Array.isArray(N)){const L=O.groups;for(let Q=0,D=L.length;Q<D;Q++){const F=L[Q],H=N[F.materialIndex];if(H&&H.visible){const K=x(T,H,B,E);T.onBeforeShadow(n,T,M,R,O,K,F),n.renderBufferDirect(R,null,O,K,T,F),T.onAfterShadow(n,T,M,R,O,K,F)}}}else if(N.visible){const L=x(T,N,B,E);T.onBeforeShadow(n,T,M,R,O,L,null),n.renderBufferDirect(R,null,O,L,T,null),T.onAfterShadow(n,T,M,R,O,L,null)}}const P=T.children;for(let O=0,N=P.length;O<N;O++)_(P[O],M,R,B,E)}function w(T){T.target.removeEventListener("dispose",w);for(const M in h){const R=h[M],B=T.target.uuid;B in R&&(R[B].dispose(),delete R[B])}}}function mee(n,e,i){const r=i.isWebGL2;function s(){let j=!1;const Y=new qe;let W=null;const ae=new qe(0,0,0,0);return{setMask:function(ce){W!==ce&&!j&&(n.colorMask(ce,ce,ce,ce),W=ce)},setLocked:function(ce){j=ce},setClear:function(ce,xe,Re,Je,Xe){Xe===!0&&(ce*=Je,xe*=Je,Re*=Je),Y.set(ce,xe,Re,Je),ae.equals(Y)===!1&&(n.clearColor(ce,xe,Re,Je),ae.copy(Y))},reset:function(){j=!1,W=null,ae.set(-1,0,0,0)}}}function o(){let j=!1,Y=null,W=null,ae=null;return{setTest:function(ce){ce?Ue(n.DEPTH_TEST):st(n.DEPTH_TEST)},setMask:function(ce){Y!==ce&&!j&&(n.depthMask(ce),Y=ce)},setFunc:function(ce){if(W!==ce){switch(ce){case YT:n.depthFunc(n.NEVER);break;case __:n.depthFunc(n.ALWAYS);break;case Xv:n.depthFunc(n.LESS);break;case gp:n.depthFunc(n.LEQUAL);break;case Mm:n.depthFunc(n.EQUAL);break;case w_:n.depthFunc(n.GEQUAL);break;case S_:n.depthFunc(n.GREATER);break;case qv:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}W=ce}},setLocked:function(ce){j=ce},setClear:function(ce){ae!==ce&&(n.clearDepth(ce),ae=ce)},reset:function(){j=!1,Y=null,W=null,ae=null}}}function a(){let j=!1,Y=null,W=null,ae=null,ce=null,xe=null,Re=null,Je=null,Xe=null;return{setTest:function(Ze){j||(Ze?Ue(n.STENCIL_TEST):st(n.STENCIL_TEST))},setMask:function(Ze){Y!==Ze&&!j&&(n.stencilMask(Ze),Y=Ze)},setFunc:function(Ze,vt,ot){(W!==Ze||ae!==vt||ce!==ot)&&(n.stencilFunc(Ze,vt,ot),W=Ze,ae=vt,ce=ot)},setOp:function(Ze,vt,ot){(xe!==Ze||Re!==vt||Je!==ot)&&(n.stencilOp(Ze,vt,ot),xe=Ze,Re=vt,Je=ot)},setLocked:function(Ze){j=Ze},setClear:function(Ze){Xe!==Ze&&(n.clearStencil(Ze),Xe=Ze)},reset:function(){j=!1,Y=null,W=null,ae=null,ce=null,xe=null,Re=null,Je=null,Xe=null}}}const l=new s,c=new o,h=new a,u=new WeakMap,d=new WeakMap;let f={},m={},g=new WeakMap,v=[],y=null,A=!1,b=null,x=null,_=null,w=null,T=null,M=null,R=null,B=new be(0,0,0),E=0,P=!1,O=null,N=null,L=null,Q=null,D=null;const F=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let H=!1,K=0;const Z=n.getParameter(n.VERSION);Z.indexOf("WebGL")!==-1?(K=parseFloat(/^WebGL (\d)/.exec(Z)[1]),H=K>=1):Z.indexOf("OpenGL ES")!==-1&&(K=parseFloat(/^OpenGL ES (\d)/.exec(Z)[1]),H=K>=2);let oe=null,we={};const Oe=n.getParameter(n.SCISSOR_BOX),se=n.getParameter(n.VIEWPORT),_e=new qe().fromArray(Oe),Ee=new qe().fromArray(se);function et(j,Y,W,ae){const ce=new Uint8Array(4),xe=n.createTexture();n.bindTexture(j,xe),n.texParameteri(j,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(j,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Re=0;Re<W;Re++)r&&(j===n.TEXTURE_3D||j===n.TEXTURE_2D_ARRAY)?n.texImage3D(Y,0,n.RGBA,1,1,ae,0,n.RGBA,n.UNSIGNED_BYTE,ce):n.texImage2D(Y+Re,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ce);return xe}const We={};We[n.TEXTURE_2D]=et(n.TEXTURE_2D,n.TEXTURE_2D,1),We[n.TEXTURE_CUBE_MAP]=et(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(We[n.TEXTURE_2D_ARRAY]=et(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),We[n.TEXTURE_3D]=et(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),l.setClear(0,0,0,1),c.setClear(1),h.setClear(0),Ue(n.DEPTH_TEST),c.setFunc(gp),nt(!1),ct(GT),Ue(n.CULL_FACE),Ve(ln);function Ue(j){f[j]!==!0&&(n.enable(j),f[j]=!0)}function st(j){f[j]!==!1&&(n.disable(j),f[j]=!1)}function ge(j,Y){return m[j]!==Y?(n.bindFramebuffer(j,Y),m[j]=Y,r&&(j===n.DRAW_FRAMEBUFFER&&(m[n.FRAMEBUFFER]=Y),j===n.FRAMEBUFFER&&(m[n.DRAW_FRAMEBUFFER]=Y)),!0):!1}function X(j,Y){let W=v,ae=!1;if(j){W=g.get(Y),W===void 0&&(W=[],g.set(Y,W));const ce=j.textures;if(W.length!==ce.length||W[0]!==n.COLOR_ATTACHMENT0){for(let xe=0,Re=ce.length;xe<Re;xe++)W[xe]=n.COLOR_ATTACHMENT0+xe;W.length=ce.length,ae=!0}}else W[0]!==n.BACK&&(W[0]=n.BACK,ae=!0);if(ae)if(i.isWebGL2)n.drawBuffers(W);else if(e.has("WEBGL_draw_buffers")===!0)e.get("WEBGL_draw_buffers").drawBuffersWEBGL(W);else throw new Error("THREE.WebGLState: Usage of gl.drawBuffers() require WebGL2 or WEBGL_draw_buffers extension")}function ze(j){return y!==j?(n.useProgram(j),y=j,!0):!1}const Ie={[mu]:n.FUNC_ADD,[DU]:n.FUNC_SUBTRACT,[LU]:n.FUNC_REVERSE_SUBTRACT};if(r)Ie[qT]=n.MIN,Ie[A_]=n.MAX;else{const j=e.get("EXT_blend_minmax");j!==null&&(Ie[qT]=j.MIN_EXT,Ie[A_]=j.MAX_EXT)}const Te={[UU]:n.ZERO,[FU]:n.ONE,[NU]:n.SRC_COLOR,[b_]:n.SRC_ALPHA,[QU]:n.SRC_ALPHA_SATURATE,[HU]:n.DST_COLOR,[jU]:n.DST_ALPHA,[zU]:n.ONE_MINUS_SRC_COLOR,[x_]:n.ONE_MINUS_SRC_ALPHA,[VU]:n.ONE_MINUS_DST_COLOR,[GU]:n.ONE_MINUS_DST_ALPHA,[WU]:n.CONSTANT_COLOR,[XU]:n.ONE_MINUS_CONSTANT_COLOR,[qU]:n.CONSTANT_ALPHA,[YU]:n.ONE_MINUS_CONSTANT_ALPHA};function Ve(j,Y,W,ae,ce,xe,Re,Je,Xe,Ze){if(j===ln){A===!0&&(st(n.BLEND),A=!1);return}if(A===!1&&(Ue(n.BLEND),A=!0),j!==XT){if(j!==b||Ze!==P){if((x!==mu||T!==mu)&&(n.blendEquation(n.FUNC_ADD),x=mu,T=mu),Ze)switch(j){case fu:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case mp:n.blendFunc(n.ONE,n.ONE);break;case QT:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case WT:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",j);break}else switch(j){case fu:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case mp:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case QT:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case WT:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",j);break}_=null,w=null,M=null,R=null,B.set(0,0,0),E=0,b=j,P=Ze}return}ce=ce||Y,xe=xe||W,Re=Re||ae,(Y!==x||ce!==T)&&(n.blendEquationSeparate(Ie[Y],Ie[ce]),x=Y,T=ce),(W!==_||ae!==w||xe!==M||Re!==R)&&(n.blendFuncSeparate(Te[W],Te[ae],Te[xe],Te[Re]),_=W,w=ae,M=xe,R=Re),(Je.equals(B)===!1||Xe!==E)&&(n.blendColor(Je.r,Je.g,Je.b,Xe),B.copy(Je),E=Xe),b=j,P=!1}function Ae(j,Y){j.side===yi?st(n.CULL_FACE):Ue(n.CULL_FACE);let W=j.side===an;Y&&(W=!W),nt(W),j.blending===fu&&j.transparent===!1?Ve(ln):Ve(j.blending,j.blendEquation,j.blendSrc,j.blendDst,j.blendEquationAlpha,j.blendSrcAlpha,j.blendDstAlpha,j.blendColor,j.blendAlpha,j.premultipliedAlpha),c.setFunc(j.depthFunc),c.setTest(j.depthTest),c.setMask(j.depthWrite),l.setMask(j.colorWrite);const ae=j.stencilWrite;h.setTest(ae),ae&&(h.setMask(j.stencilWriteMask),h.setFunc(j.stencilFunc,j.stencilRef,j.stencilFuncMask),h.setOp(j.stencilFail,j.stencilZFail,j.stencilZPass)),V(j.polygonOffset,j.polygonOffsetFactor,j.polygonOffsetUnits),j.alphaToCoverage===!0?Ue(n.SAMPLE_ALPHA_TO_COVERAGE):st(n.SAMPLE_ALPHA_TO_COVERAGE)}function nt(j){O!==j&&(j?n.frontFace(n.CW):n.frontFace(n.CCW),O=j)}function ct(j){j!==kU?(Ue(n.CULL_FACE),j!==N&&(j===GT?n.cullFace(n.BACK):j===OU?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):st(n.CULL_FACE),N=j}function It(j){j!==L&&(H&&n.lineWidth(j),L=j)}function V(j,Y,W){j?(Ue(n.POLYGON_OFFSET_FILL),(Q!==Y||D!==W)&&(n.polygonOffset(Y,W),Q=Y,D=W)):st(n.POLYGON_OFFSET_FILL)}function U(j){j?Ue(n.SCISSOR_TEST):st(n.SCISSOR_TEST)}function ue(j){j===void 0&&(j=n.TEXTURE0+F-1),oe!==j&&(n.activeTexture(j),oe=j)}function Me(j,Y,W){W===void 0&&(oe===null?W=n.TEXTURE0+F-1:W=oe);let ae=we[W];ae===void 0&&(ae={type:void 0,texture:void 0},we[W]=ae),(ae.type!==j||ae.texture!==Y)&&(oe!==W&&(n.activeTexture(W),oe=W),n.bindTexture(j,Y||We[j]),ae.type=j,ae.texture=Y)}function De(){const j=we[oe];j!==void 0&&j.type!==void 0&&(n.bindTexture(j.type,null),j.type=void 0,j.texture=void 0)}function Pe(){try{n.compressedTexImage2D.apply(n,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function At(){try{n.compressedTexImage3D.apply(n,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function ht(){try{n.texSubImage2D.apply(n,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function je(){try{n.texSubImage3D.apply(n,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function He(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function St(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function Fe(){try{n.texStorage2D.apply(n,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function Kt(){try{n.texStorage3D.apply(n,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function Le(){try{n.texImage2D.apply(n,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function _t(){try{n.texImage3D.apply(n,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function ut(j){_e.equals(j)===!1&&(n.scissor(j.x,j.y,j.z,j.w),_e.copy(j))}function I(j){Ee.equals(j)===!1&&(n.viewport(j.x,j.y,j.z,j.w),Ee.copy(j))}function k(j,Y){let W=d.get(Y);W===void 0&&(W=new WeakMap,d.set(Y,W));let ae=W.get(j);ae===void 0&&(ae=n.getUniformBlockIndex(Y,j.name),W.set(j,ae))}function G(j,Y){const W=d.get(Y).get(j);u.get(Y)!==W&&(n.uniformBlockBinding(Y,W,j.__bindingPointIndex),u.set(Y,W))}function ee(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),r===!0&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),f={},oe=null,we={},m={},g=new WeakMap,v=[],y=null,A=!1,b=null,x=null,_=null,w=null,T=null,M=null,R=null,B=new be(0,0,0),E=0,P=!1,O=null,N=null,L=null,Q=null,D=null,_e.set(0,0,n.canvas.width,n.canvas.height),Ee.set(0,0,n.canvas.width,n.canvas.height),l.reset(),c.reset(),h.reset()}return{buffers:{color:l,depth:c,stencil:h},enable:Ue,disable:st,bindFramebuffer:ge,drawBuffers:X,useProgram:ze,setBlending:Ve,setMaterial:Ae,setFlipSided:nt,setCullFace:ct,setLineWidth:It,setPolygonOffset:V,setScissorTest:U,activeTexture:ue,bindTexture:Me,unbindTexture:De,compressedTexImage2D:Pe,compressedTexImage3D:At,texImage2D:Le,texImage3D:_t,updateUBOMapping:k,uniformBlockBinding:G,texStorage2D:Fe,texStorage3D:Kt,texSubImage2D:ht,texSubImage3D:je,compressedTexSubImage2D:He,compressedTexSubImage3D:St,scissor:ut,viewport:I,reset:ee}}function gee(n,e,i,r,s,o,a){const l=s.isWebGL2,c=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new J,d=new WeakMap;let f;const m=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(V,U){return g?new OffscreenCanvas(V,U):cy("canvas")}function y(V,U,ue,Me){let De=1;const Pe=It(V);if((Pe.width>Me||Pe.height>Me)&&(De=Me/Math.max(Pe.width,Pe.height)),De<1||U===!0)if(typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&V instanceof ImageBitmap||typeof VideoFrame<"u"&&V instanceof VideoFrame){const At=U?H_:Math.floor,ht=At(De*Pe.width),je=At(De*Pe.height);f===void 0&&(f=v(ht,je));const He=ue?v(ht,je):f;return He.width=ht,He.height=je,He.getContext("2d").drawImage(V,0,0,ht,je),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Pe.width+"x"+Pe.height+") to ("+ht+"x"+je+")."),He}else return"data"in V&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Pe.width+"x"+Pe.height+")."),V;return V}function A(V){const U=It(V);return kI(U.width)&&kI(U.height)}function b(V){return l?!1:V.wrapS!==Yn||V.wrapT!==Yn||V.minFilter!==Rt&&V.minFilter!==Dt}function x(V,U){return V.generateMipmaps&&U&&V.minFilter!==Rt&&V.minFilter!==Dt}function _(V){n.generateMipmap(V)}function w(V,U,ue,Me,De=!1){if(l===!1)return U;if(V!==null){if(n[V]!==void 0)return n[V];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+V+"'")}let Pe=U;if(U===n.RED&&(ue===n.FLOAT&&(Pe=n.R32F),ue===n.HALF_FLOAT&&(Pe=n.R16F),ue===n.UNSIGNED_BYTE&&(Pe=n.R8)),U===n.RED_INTEGER&&(ue===n.UNSIGNED_BYTE&&(Pe=n.R8UI),ue===n.UNSIGNED_SHORT&&(Pe=n.R16UI),ue===n.UNSIGNED_INT&&(Pe=n.R32UI),ue===n.BYTE&&(Pe=n.R8I),ue===n.SHORT&&(Pe=n.R16I),ue===n.INT&&(Pe=n.R32I)),U===n.RG&&(ue===n.FLOAT&&(Pe=n.RG32F),ue===n.HALF_FLOAT&&(Pe=n.RG16F),ue===n.UNSIGNED_BYTE&&(Pe=n.RG8)),U===n.RG_INTEGER&&(ue===n.UNSIGNED_BYTE&&(Pe=n.RG8UI),ue===n.UNSIGNED_SHORT&&(Pe=n.RG16UI),ue===n.UNSIGNED_INT&&(Pe=n.RG32UI),ue===n.BYTE&&(Pe=n.RG8I),ue===n.SHORT&&(Pe=n.RG16I),ue===n.INT&&(Pe=n.RG32I)),U===n.RGBA){const At=De?ny:xi.getTransfer(Me);ue===n.FLOAT&&(Pe=n.RGBA32F),ue===n.HALF_FLOAT&&(Pe=n.RGBA16F),ue===n.UNSIGNED_BYTE&&(Pe=At===Vi?n.SRGB8_ALPHA8:n.RGBA8),ue===n.UNSIGNED_SHORT_4_4_4_4&&(Pe=n.RGBA4),ue===n.UNSIGNED_SHORT_5_5_5_1&&(Pe=n.RGB5_A1)}return(Pe===n.R16F||Pe===n.R32F||Pe===n.RG16F||Pe===n.RG32F||Pe===n.RGBA16F||Pe===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Pe}function T(V,U,ue){return x(V,ue)===!0||V.isFramebufferTexture&&V.minFilter!==Rt&&V.minFilter!==Dt?Math.log2(Math.max(U.width,U.height))+1:V.mipmaps!==void 0&&V.mipmaps.length>0?V.mipmaps.length:V.isCompressedTexture&&Array.isArray(V.image)?U.mipmaps.length:1}function M(V){return V===Rt||V===Bm||V===$c?n.NEAREST:n.LINEAR}function R(V){const U=V.target;U.removeEventListener("dispose",R),E(U),U.isVideoTexture&&d.delete(U)}function B(V){const U=V.target;U.removeEventListener("dispose",B),O(U)}function E(V){const U=r.get(V);if(U.__webglInit===void 0)return;const ue=V.source,Me=m.get(ue);if(Me){const De=Me[U.__cacheKey];De.usedTimes--,De.usedTimes===0&&P(V),Object.keys(Me).length===0&&m.delete(ue)}r.remove(V)}function P(V){const U=r.get(V);n.deleteTexture(U.__webglTexture);const ue=V.source,Me=m.get(ue);delete Me[U.__cacheKey],a.memory.textures--}function O(V){const U=r.get(V);if(V.depthTexture&&V.depthTexture.dispose(),V.isWebGLCubeRenderTarget)for(let Me=0;Me<6;Me++){if(Array.isArray(U.__webglFramebuffer[Me]))for(let De=0;De<U.__webglFramebuffer[Me].length;De++)n.deleteFramebuffer(U.__webglFramebuffer[Me][De]);else n.deleteFramebuffer(U.__webglFramebuffer[Me]);U.__webglDepthbuffer&&n.deleteRenderbuffer(U.__webglDepthbuffer[Me])}else{if(Array.isArray(U.__webglFramebuffer))for(let Me=0;Me<U.__webglFramebuffer.length;Me++)n.deleteFramebuffer(U.__webglFramebuffer[Me]);else n.deleteFramebuffer(U.__webglFramebuffer);if(U.__webglDepthbuffer&&n.deleteRenderbuffer(U.__webglDepthbuffer),U.__webglMultisampledFramebuffer&&n.deleteFramebuffer(U.__webglMultisampledFramebuffer),U.__webglColorRenderbuffer)for(let Me=0;Me<U.__webglColorRenderbuffer.length;Me++)U.__webglColorRenderbuffer[Me]&&n.deleteRenderbuffer(U.__webglColorRenderbuffer[Me]);U.__webglDepthRenderbuffer&&n.deleteRenderbuffer(U.__webglDepthRenderbuffer)}const ue=V.textures;for(let Me=0,De=ue.length;Me<De;Me++){const Pe=r.get(ue[Me]);Pe.__webglTexture&&(n.deleteTexture(Pe.__webglTexture),a.memory.textures--),r.remove(ue[Me])}r.remove(V)}let N=0;function L(){N=0}function Q(){const V=N;return V>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+V+" texture units while this GPU supports only "+s.maxTextures),N+=1,V}function D(V){const U=[];return U.push(V.wrapS),U.push(V.wrapT),U.push(V.wrapR||0),U.push(V.magFilter),U.push(V.minFilter),U.push(V.anisotropy),U.push(V.internalFormat),U.push(V.format),U.push(V.type),U.push(V.generateMipmaps),U.push(V.premultiplyAlpha),U.push(V.flipY),U.push(V.unpackAlignment),U.push(V.colorSpace),U.join()}function F(V,U){const ue=r.get(V);if(V.isVideoTexture&&nt(V),V.isRenderTargetTexture===!1&&V.version>0&&ue.__version!==V.version){const Me=V.image;if(Me===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Me.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ee(ue,V,U);return}}i.bindTexture(n.TEXTURE_2D,ue.__webglTexture,n.TEXTURE0+U)}function H(V,U){const ue=r.get(V);if(V.version>0&&ue.__version!==V.version){Ee(ue,V,U);return}i.bindTexture(n.TEXTURE_2D_ARRAY,ue.__webglTexture,n.TEXTURE0+U)}function K(V,U){const ue=r.get(V);if(V.version>0&&ue.__version!==V.version){Ee(ue,V,U);return}i.bindTexture(n.TEXTURE_3D,ue.__webglTexture,n.TEXTURE0+U)}function Z(V,U){const ue=r.get(V);if(V.version>0&&ue.__version!==V.version){et(ue,V,U);return}i.bindTexture(n.TEXTURE_CUBE_MAP,ue.__webglTexture,n.TEXTURE0+U)}const oe={[Ao]:n.REPEAT,[Yn]:n.CLAMP_TO_EDGE,[yp]:n.MIRRORED_REPEAT},we={[Rt]:n.NEAREST,[Bm]:n.NEAREST_MIPMAP_NEAREST,[$c]:n.NEAREST_MIPMAP_LINEAR,[Dt]:n.LINEAR,[Ap]:n.LINEAR_MIPMAP_NEAREST,[bo]:n.LINEAR_MIPMAP_LINEAR},Oe={[xF]:n.NEVER,[MF]:n.ALWAYS,[_F]:n.LESS,[PI]:n.LEQUAL,[wF]:n.EQUAL,[EF]:n.GEQUAL,[SF]:n.GREATER,[CF]:n.NOTEQUAL};function se(V,U,ue){if(U.type===Hi&&e.has("OES_texture_float_linear")===!1&&(U.magFilter===Dt||U.magFilter===Ap||U.magFilter===$c||U.magFilter===bo||U.minFilter===Dt||U.minFilter===Ap||U.minFilter===$c||U.minFilter===bo)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),ue?(n.texParameteri(V,n.TEXTURE_WRAP_S,oe[U.wrapS]),n.texParameteri(V,n.TEXTURE_WRAP_T,oe[U.wrapT]),(V===n.TEXTURE_3D||V===n.TEXTURE_2D_ARRAY)&&n.texParameteri(V,n.TEXTURE_WRAP_R,oe[U.wrapR]),n.texParameteri(V,n.TEXTURE_MAG_FILTER,we[U.magFilter]),n.texParameteri(V,n.TEXTURE_MIN_FILTER,we[U.minFilter])):(n.texParameteri(V,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(V,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(V===n.TEXTURE_3D||V===n.TEXTURE_2D_ARRAY)&&n.texParameteri(V,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(U.wrapS!==Yn||U.wrapT!==Yn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(V,n.TEXTURE_MAG_FILTER,M(U.magFilter)),n.texParameteri(V,n.TEXTURE_MIN_FILTER,M(U.minFilter)),U.minFilter!==Rt&&U.minFilter!==Dt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),U.compareFunction&&(n.texParameteri(V,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(V,n.TEXTURE_COMPARE_FUNC,Oe[U.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(U.magFilter===Rt||U.minFilter!==$c&&U.minFilter!==bo||U.type===Hi&&e.has("OES_texture_float_linear")===!1||l===!1&&U.type===ur&&e.has("OES_texture_half_float_linear")===!1)return;if(U.anisotropy>1||r.get(U).__currentAnisotropy){const Me=e.get("EXT_texture_filter_anisotropic");n.texParameterf(V,Me.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(U.anisotropy,s.getMaxAnisotropy())),r.get(U).__currentAnisotropy=U.anisotropy}}}function _e(V,U){let ue=!1;V.__webglInit===void 0&&(V.__webglInit=!0,U.addEventListener("dispose",R));const Me=U.source;let De=m.get(Me);De===void 0&&(De={},m.set(Me,De));const Pe=D(U);if(Pe!==V.__cacheKey){De[Pe]===void 0&&(De[Pe]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,ue=!0),De[Pe].usedTimes++;const At=De[V.__cacheKey];At!==void 0&&(De[V.__cacheKey].usedTimes--,At.usedTimes===0&&P(U)),V.__cacheKey=Pe,V.__webglTexture=De[Pe].texture}return ue}function Ee(V,U,ue){let Me=n.TEXTURE_2D;(U.isDataArrayTexture||U.isCompressedArrayTexture)&&(Me=n.TEXTURE_2D_ARRAY),U.isData3DTexture&&(Me=n.TEXTURE_3D);const De=_e(V,U),Pe=U.source;i.bindTexture(Me,V.__webglTexture,n.TEXTURE0+ue);const At=r.get(Pe);if(Pe.version!==At.__version||De===!0){i.activeTexture(n.TEXTURE0+ue);const ht=xi.getPrimaries(xi.workingColorSpace),je=U.colorSpace===xo?null:xi.getPrimaries(U.colorSpace),He=U.colorSpace===xo||ht===je?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,U.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,U.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,U.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,He);const St=b(U)&&A(U.image)===!1;let Fe=y(U.image,St,!1,s.maxTextureSize);Fe=ct(U,Fe);const Kt=A(Fe)||l,Le=o.convert(U.format,U.colorSpace);let _t=o.convert(U.type),ut=w(U.internalFormat,Le,_t,U.colorSpace,U.isVideoTexture);se(Me,U,Kt);let I;const k=U.mipmaps,G=l&&U.isVideoTexture!==!0&&ut!==rI,ee=At.__version===void 0||De===!0,j=Pe.dataReady,Y=T(U,Fe,Kt);if(U.isDepthTexture)ut=n.DEPTH_COMPONENT,l?U.type===Hi?ut=n.DEPTH_COMPONENT32F:U.type===_s?ut=n.DEPTH_COMPONENT24:U.type===eh?ut=n.DEPTH24_STENCIL8:ut=n.DEPTH_COMPONENT16:U.type===Hi&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),U.format===vu&&ut===n.DEPTH_COMPONENT&&U.type!==Zv&&U.type!==_s&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),U.type=_s,_t=o.convert(U.type)),U.format===yu&&ut===n.DEPTH_COMPONENT&&(ut=n.DEPTH_STENCIL,U.type!==eh&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),U.type=eh,_t=o.convert(U.type))),ee&&(G?i.texStorage2D(n.TEXTURE_2D,1,ut,Fe.width,Fe.height):i.texImage2D(n.TEXTURE_2D,0,ut,Fe.width,Fe.height,0,Le,_t,null));else if(U.isDataTexture)if(k.length>0&&Kt){G&&ee&&i.texStorage2D(n.TEXTURE_2D,Y,ut,k[0].width,k[0].height);for(let W=0,ae=k.length;W<ae;W++)I=k[W],G?j&&i.texSubImage2D(n.TEXTURE_2D,W,0,0,I.width,I.height,Le,_t,I.data):i.texImage2D(n.TEXTURE_2D,W,ut,I.width,I.height,0,Le,_t,I.data);U.generateMipmaps=!1}else G?(ee&&i.texStorage2D(n.TEXTURE_2D,Y,ut,Fe.width,Fe.height),j&&i.texSubImage2D(n.TEXTURE_2D,0,0,0,Fe.width,Fe.height,Le,_t,Fe.data)):i.texImage2D(n.TEXTURE_2D,0,ut,Fe.width,Fe.height,0,Le,_t,Fe.data);else if(U.isCompressedTexture)if(U.isCompressedArrayTexture){G&&ee&&i.texStorage3D(n.TEXTURE_2D_ARRAY,Y,ut,k[0].width,k[0].height,Fe.depth);for(let W=0,ae=k.length;W<ae;W++)I=k[W],U.format!==Ti?Le!==null?G?j&&i.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,W,0,0,0,I.width,I.height,Fe.depth,Le,I.data,0,0):i.compressedTexImage3D(n.TEXTURE_2D_ARRAY,W,ut,I.width,I.height,Fe.depth,0,I.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):G?j&&i.texSubImage3D(n.TEXTURE_2D_ARRAY,W,0,0,0,I.width,I.height,Fe.depth,Le,_t,I.data):i.texImage3D(n.TEXTURE_2D_ARRAY,W,ut,I.width,I.height,Fe.depth,0,Le,_t,I.data)}else{G&&ee&&i.texStorage2D(n.TEXTURE_2D,Y,ut,k[0].width,k[0].height);for(let W=0,ae=k.length;W<ae;W++)I=k[W],U.format!==Ti?Le!==null?G?j&&i.compressedTexSubImage2D(n.TEXTURE_2D,W,0,0,I.width,I.height,Le,I.data):i.compressedTexImage2D(n.TEXTURE_2D,W,ut,I.width,I.height,0,I.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):G?j&&i.texSubImage2D(n.TEXTURE_2D,W,0,0,I.width,I.height,Le,_t,I.data):i.texImage2D(n.TEXTURE_2D,W,ut,I.width,I.height,0,Le,_t,I.data)}else if(U.isDataArrayTexture)G?(ee&&i.texStorage3D(n.TEXTURE_2D_ARRAY,Y,ut,Fe.width,Fe.height,Fe.depth),j&&i.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Fe.width,Fe.height,Fe.depth,Le,_t,Fe.data)):i.texImage3D(n.TEXTURE_2D_ARRAY,0,ut,Fe.width,Fe.height,Fe.depth,0,Le,_t,Fe.data);else if(U.isData3DTexture)G?(ee&&i.texStorage3D(n.TEXTURE_3D,Y,ut,Fe.width,Fe.height,Fe.depth),j&&i.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Fe.width,Fe.height,Fe.depth,Le,_t,Fe.data)):i.texImage3D(n.TEXTURE_3D,0,ut,Fe.width,Fe.height,Fe.depth,0,Le,_t,Fe.data);else if(U.isFramebufferTexture){if(ee)if(G)i.texStorage2D(n.TEXTURE_2D,Y,ut,Fe.width,Fe.height);else{let W=Fe.width,ae=Fe.height;for(let ce=0;ce<Y;ce++)i.texImage2D(n.TEXTURE_2D,ce,ut,W,ae,0,Le,_t,null),W>>=1,ae>>=1}}else if(k.length>0&&Kt){if(G&&ee){const W=It(k[0]);i.texStorage2D(n.TEXTURE_2D,Y,ut,W.width,W.height)}for(let W=0,ae=k.length;W<ae;W++)I=k[W],G?j&&i.texSubImage2D(n.TEXTURE_2D,W,0,0,Le,_t,I):i.texImage2D(n.TEXTURE_2D,W,ut,Le,_t,I);U.generateMipmaps=!1}else if(G){if(ee){const W=It(Fe);i.texStorage2D(n.TEXTURE_2D,Y,ut,W.width,W.height)}j&&i.texSubImage2D(n.TEXTURE_2D,0,0,0,Le,_t,Fe)}else i.texImage2D(n.TEXTURE_2D,0,ut,Le,_t,Fe);x(U,Kt)&&_(Me),At.__version=Pe.version,U.onUpdate&&U.onUpdate(U)}V.__version=U.version}function et(V,U,ue){if(U.image.length!==6)return;const Me=_e(V,U),De=U.source;i.bindTexture(n.TEXTURE_CUBE_MAP,V.__webglTexture,n.TEXTURE0+ue);const Pe=r.get(De);if(De.version!==Pe.__version||Me===!0){i.activeTexture(n.TEXTURE0+ue);const At=xi.getPrimaries(xi.workingColorSpace),ht=U.colorSpace===xo?null:xi.getPrimaries(U.colorSpace),je=U.colorSpace===xo||At===ht?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,U.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,U.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,U.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,je);const He=U.isCompressedTexture||U.image[0].isCompressedTexture,St=U.image[0]&&U.image[0].isDataTexture,Fe=[];for(let W=0;W<6;W++)!He&&!St?Fe[W]=y(U.image[W],!1,!0,s.maxCubemapSize):Fe[W]=St?U.image[W].image:U.image[W],Fe[W]=ct(U,Fe[W]);const Kt=Fe[0],Le=A(Kt)||l,_t=o.convert(U.format,U.colorSpace),ut=o.convert(U.type),I=w(U.internalFormat,_t,ut,U.colorSpace),k=l&&U.isVideoTexture!==!0,G=Pe.__version===void 0||Me===!0,ee=De.dataReady;let j=T(U,Kt,Le);se(n.TEXTURE_CUBE_MAP,U,Le);let Y;if(He){k&&G&&i.texStorage2D(n.TEXTURE_CUBE_MAP,j,I,Kt.width,Kt.height);for(let W=0;W<6;W++){Y=Fe[W].mipmaps;for(let ae=0;ae<Y.length;ae++){const ce=Y[ae];U.format!==Ti?_t!==null?k?ee&&i.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,ae,0,0,ce.width,ce.height,_t,ce.data):i.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,ae,I,ce.width,ce.height,0,ce.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):k?ee&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,ae,0,0,ce.width,ce.height,_t,ut,ce.data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,ae,I,ce.width,ce.height,0,_t,ut,ce.data)}}}else{if(Y=U.mipmaps,k&&G){Y.length>0&&j++;const W=It(Fe[0]);i.texStorage2D(n.TEXTURE_CUBE_MAP,j,I,W.width,W.height)}for(let W=0;W<6;W++)if(St){k?ee&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,0,0,Fe[W].width,Fe[W].height,_t,ut,Fe[W].data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,I,Fe[W].width,Fe[W].height,0,_t,ut,Fe[W].data);for(let ae=0;ae<Y.length;ae++){const ce=Y[ae].image[W].image;k?ee&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,ae+1,0,0,ce.width,ce.height,_t,ut,ce.data):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,ae+1,I,ce.width,ce.height,0,_t,ut,ce.data)}}else{k?ee&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,0,0,_t,ut,Fe[W]):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,I,_t,ut,Fe[W]);for(let ae=0;ae<Y.length;ae++){const ce=Y[ae];k?ee&&i.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,ae+1,0,0,_t,ut,ce.image[W]):i.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+W,ae+1,I,_t,ut,ce.image[W])}}}x(U,Le)&&_(n.TEXTURE_CUBE_MAP),Pe.__version=De.version,U.onUpdate&&U.onUpdate(U)}V.__version=U.version}function We(V,U,ue,Me,De,Pe){const At=o.convert(ue.format,ue.colorSpace),ht=o.convert(ue.type),je=w(ue.internalFormat,At,ht,ue.colorSpace);if(!r.get(U).__hasExternalTextures){const He=Math.max(1,U.width>>Pe),St=Math.max(1,U.height>>Pe);De===n.TEXTURE_3D||De===n.TEXTURE_2D_ARRAY?i.texImage3D(De,Pe,je,He,St,U.depth,0,At,ht,null):i.texImage2D(De,Pe,je,He,St,0,At,ht,null)}i.bindFramebuffer(n.FRAMEBUFFER,V),Ae(U)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Me,De,r.get(ue).__webglTexture,0,Ve(U)):(De===n.TEXTURE_2D||De>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&De<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Me,De,r.get(ue).__webglTexture,Pe),i.bindFramebuffer(n.FRAMEBUFFER,null)}function Ue(V,U,ue){if(n.bindRenderbuffer(n.RENDERBUFFER,V),U.depthBuffer&&!U.stencilBuffer){let Me=l===!0?n.DEPTH_COMPONENT24:n.DEPTH_COMPONENT16;if(ue||Ae(U)){const De=U.depthTexture;De&&De.isDepthTexture&&(De.type===Hi?Me=n.DEPTH_COMPONENT32F:De.type===_s&&(Me=n.DEPTH_COMPONENT24));const Pe=Ve(U);Ae(U)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Pe,Me,U.width,U.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,Pe,Me,U.width,U.height)}else n.renderbufferStorage(n.RENDERBUFFER,Me,U.width,U.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,V)}else if(U.depthBuffer&&U.stencilBuffer){const Me=Ve(U);ue&&Ae(U)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Me,n.DEPTH24_STENCIL8,U.width,U.height):Ae(U)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Me,n.DEPTH24_STENCIL8,U.width,U.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,U.width,U.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,V)}else{const Me=U.textures;for(let De=0;De<Me.length;De++){const Pe=Me[De],At=o.convert(Pe.format,Pe.colorSpace),ht=o.convert(Pe.type),je=w(Pe.internalFormat,At,ht,Pe.colorSpace),He=Ve(U);ue&&Ae(U)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,He,je,U.width,U.height):Ae(U)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,He,je,U.width,U.height):n.renderbufferStorage(n.RENDERBUFFER,je,U.width,U.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function st(V,U){if(U&&U.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(n.FRAMEBUFFER,V),!(U.depthTexture&&U.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(U.depthTexture).__webglTexture||U.depthTexture.image.width!==U.width||U.depthTexture.image.height!==U.height)&&(U.depthTexture.image.width=U.width,U.depthTexture.image.height=U.height,U.depthTexture.needsUpdate=!0),F(U.depthTexture,0);const ue=r.get(U.depthTexture).__webglTexture,Me=Ve(U);if(U.depthTexture.format===vu)Ae(U)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ue,0,Me):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ue,0);else if(U.depthTexture.format===yu)Ae(U)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ue,0,Me):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ue,0);else throw new Error("Unknown depthTexture format")}function ge(V){const U=r.get(V),ue=V.isWebGLCubeRenderTarget===!0;if(V.depthTexture&&!U.__autoAllocateDepthBuffer){if(ue)throw new Error("target.depthTexture not supported in Cube render targets");st(U.__webglFramebuffer,V)}else if(ue){U.__webglDepthbuffer=[];for(let Me=0;Me<6;Me++)i.bindFramebuffer(n.FRAMEBUFFER,U.__webglFramebuffer[Me]),U.__webglDepthbuffer[Me]=n.createRenderbuffer(),Ue(U.__webglDepthbuffer[Me],V,!1)}else i.bindFramebuffer(n.FRAMEBUFFER,U.__webglFramebuffer),U.__webglDepthbuffer=n.createRenderbuffer(),Ue(U.__webglDepthbuffer,V,!1);i.bindFramebuffer(n.FRAMEBUFFER,null)}function X(V,U,ue){const Me=r.get(V);U!==void 0&&We(Me.__webglFramebuffer,V,V.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ue!==void 0&&ge(V)}function ze(V){const U=V.texture,ue=r.get(V),Me=r.get(U);V.addEventListener("dispose",B);const De=V.textures,Pe=V.isWebGLCubeRenderTarget===!0,At=De.length>1,ht=A(V)||l;if(At||(Me.__webglTexture===void 0&&(Me.__webglTexture=n.createTexture()),Me.__version=U.version,a.memory.textures++),Pe){ue.__webglFramebuffer=[];for(let je=0;je<6;je++)if(l&&U.mipmaps&&U.mipmaps.length>0){ue.__webglFramebuffer[je]=[];for(let He=0;He<U.mipmaps.length;He++)ue.__webglFramebuffer[je][He]=n.createFramebuffer()}else ue.__webglFramebuffer[je]=n.createFramebuffer()}else{if(l&&U.mipmaps&&U.mipmaps.length>0){ue.__webglFramebuffer=[];for(let je=0;je<U.mipmaps.length;je++)ue.__webglFramebuffer[je]=n.createFramebuffer()}else ue.__webglFramebuffer=n.createFramebuffer();if(At)if(s.drawBuffers)for(let je=0,He=De.length;je<He;je++){const St=r.get(De[je]);St.__webglTexture===void 0&&(St.__webglTexture=n.createTexture(),a.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&V.samples>0&&Ae(V)===!1){ue.__webglMultisampledFramebuffer=n.createFramebuffer(),ue.__webglColorRenderbuffer=[],i.bindFramebuffer(n.FRAMEBUFFER,ue.__webglMultisampledFramebuffer);for(let je=0;je<De.length;je++){const He=De[je];ue.__webglColorRenderbuffer[je]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ue.__webglColorRenderbuffer[je]);const St=o.convert(He.format,He.colorSpace),Fe=o.convert(He.type),Kt=w(He.internalFormat,St,Fe,He.colorSpace,V.isXRRenderTarget===!0),Le=Ve(V);n.renderbufferStorageMultisample(n.RENDERBUFFER,Le,Kt,V.width,V.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+je,n.RENDERBUFFER,ue.__webglColorRenderbuffer[je])}n.bindRenderbuffer(n.RENDERBUFFER,null),V.depthBuffer&&(ue.__webglDepthRenderbuffer=n.createRenderbuffer(),Ue(ue.__webglDepthRenderbuffer,V,!0)),i.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Pe){i.bindTexture(n.TEXTURE_CUBE_MAP,Me.__webglTexture),se(n.TEXTURE_CUBE_MAP,U,ht);for(let je=0;je<6;je++)if(l&&U.mipmaps&&U.mipmaps.length>0)for(let He=0;He<U.mipmaps.length;He++)We(ue.__webglFramebuffer[je][He],V,U,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+je,He);else We(ue.__webglFramebuffer[je],V,U,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+je,0);x(U,ht)&&_(n.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(At){for(let je=0,He=De.length;je<He;je++){const St=De[je],Fe=r.get(St);i.bindTexture(n.TEXTURE_2D,Fe.__webglTexture),se(n.TEXTURE_2D,St,ht),We(ue.__webglFramebuffer,V,St,n.COLOR_ATTACHMENT0+je,n.TEXTURE_2D,0),x(St,ht)&&_(n.TEXTURE_2D)}i.unbindTexture()}else{let je=n.TEXTURE_2D;if((V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(l?je=V.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(je,Me.__webglTexture),se(je,U,ht),l&&U.mipmaps&&U.mipmaps.length>0)for(let He=0;He<U.mipmaps.length;He++)We(ue.__webglFramebuffer[He],V,U,n.COLOR_ATTACHMENT0,je,He);else We(ue.__webglFramebuffer,V,U,n.COLOR_ATTACHMENT0,je,0);x(U,ht)&&_(je),i.unbindTexture()}V.depthBuffer&&ge(V)}function Ie(V){const U=A(V)||l,ue=V.textures;for(let Me=0,De=ue.length;Me<De;Me++){const Pe=ue[Me];if(x(Pe,U)){const At=V.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,ht=r.get(Pe).__webglTexture;i.bindTexture(At,ht),_(At),i.unbindTexture()}}}function Te(V){if(l&&V.samples>0&&Ae(V)===!1){const U=V.textures,ue=V.width,Me=V.height;let De=n.COLOR_BUFFER_BIT;const Pe=[],At=V.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ht=r.get(V),je=U.length>1;if(je)for(let He=0;He<U.length;He++)i.bindFramebuffer(n.FRAMEBUFFER,ht.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+He,n.RENDERBUFFER,null),i.bindFramebuffer(n.FRAMEBUFFER,ht.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+He,n.TEXTURE_2D,null,0);i.bindFramebuffer(n.READ_FRAMEBUFFER,ht.__webglMultisampledFramebuffer),i.bindFramebuffer(n.DRAW_FRAMEBUFFER,ht.__webglFramebuffer);for(let He=0;He<U.length;He++){Pe.push(n.COLOR_ATTACHMENT0+He),V.depthBuffer&&Pe.push(At);const St=ht.__ignoreDepthValues!==void 0?ht.__ignoreDepthValues:!1;if(St===!1&&(V.depthBuffer&&(De|=n.DEPTH_BUFFER_BIT),V.stencilBuffer&&(De|=n.STENCIL_BUFFER_BIT)),je&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ht.__webglColorRenderbuffer[He]),St===!0&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[At]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[At])),je){const Fe=r.get(U[He]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Fe,0)}n.blitFramebuffer(0,0,ue,Me,0,0,ue,Me,De,n.NEAREST),h&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Pe)}if(i.bindFramebuffer(n.READ_FRAMEBUFFER,null),i.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),je)for(let He=0;He<U.length;He++){i.bindFramebuffer(n.FRAMEBUFFER,ht.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+He,n.RENDERBUFFER,ht.__webglColorRenderbuffer[He]);const St=r.get(U[He]).__webglTexture;i.bindFramebuffer(n.FRAMEBUFFER,ht.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+He,n.TEXTURE_2D,St,0)}i.bindFramebuffer(n.DRAW_FRAMEBUFFER,ht.__webglMultisampledFramebuffer)}}function Ve(V){return Math.min(s.maxSamples,V.samples)}function Ae(V){const U=r.get(V);return l&&V.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&U.__useRenderToTexture!==!1}function nt(V){const U=a.render.frame;d.get(V)!==U&&(d.set(V,U),V.update())}function ct(V,U){const ue=V.colorSpace,Me=V.format,De=V.type;return V.isCompressedTexture===!0||V.isVideoTexture===!0||V.format===G_||ue!==Ii&&ue!==xo&&(xi.getTransfer(ue)===Vi?l===!1?e.has("EXT_sRGB")===!0&&Me===Ti?(V.format=G_,V.minFilter=Dt,V.generateMipmaps=!1):U=LI.sRGBToLinear(U):(Me!==Ti||De!==cn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ue)),U}function It(V){return typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement?(u.width=V.naturalWidth||V.width,u.height=V.naturalHeight||V.height):typeof VideoFrame<"u"&&V instanceof VideoFrame?(u.width=V.displayWidth,u.height=V.displayHeight):(u.width=V.width,u.height=V.height),u}this.allocateTextureUnit=Q,this.resetTextureUnits=L,this.setTexture2D=F,this.setTexture2DArray=H,this.setTexture3D=K,this.setTextureCube=Z,this.rebindTextures=X,this.setupRenderTarget=ze,this.updateRenderTargetMipmap=Ie,this.updateMultisampleRenderTarget=Te,this.setupDepthRenderbuffer=ge,this.setupFrameBufferTexture=We,this.useMultisampledRTT=Ae}function MN(n,e,i){const r=i.isWebGL2;function s(o,a=xo){let l;const c=xi.getTransfer(a);if(o===cn)return n.UNSIGNED_BYTE;if(o===ZT)return n.UNSIGNED_SHORT_4_4_4_4;if(o===$T)return n.UNSIGNED_SHORT_5_5_5_1;if(o===E_)return n.BYTE;if(o===KT)return n.SHORT;if(o===Zv)return n.UNSIGNED_SHORT;if(o===bp)return n.INT;if(o===_s)return n.UNSIGNED_INT;if(o===Hi)return n.FLOAT;if(o===ur)return r?n.HALF_FLOAT:(l=e.get("OES_texture_half_float"),l!==null?l.HALF_FLOAT_OES:null);if(o===tF)return n.ALPHA;if(o===Ti)return n.RGBA;if(o===M_)return n.LUMINANCE;if(o===iF)return n.LUMINANCE_ALPHA;if(o===vu)return n.DEPTH_COMPONENT;if(o===yu)return n.DEPTH_STENCIL;if(o===G_)return l=e.get("EXT_sRGB"),l!==null?l.SRGB_ALPHA_EXT:null;if(o===xp)return n.RED;if(o===T_)return n.RED_INTEGER;if(o===I_)return n.RG;if(o===$v)return n.RG_INTEGER;if(o===km)return n.RGBA_INTEGER;if(o===R_||o===P_||o===B_||o===k_)if(c===Vi)if(l=e.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(o===R_)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===P_)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===B_)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===k_)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=e.get("WEBGL_compressed_texture_s3tc"),l!==null){if(o===R_)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===P_)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===B_)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===k_)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===eI||o===tI||o===iI||o===nI)if(l=e.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(o===eI)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===tI)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===iI)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===nI)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===rI)return l=e.get("WEBGL_compressed_texture_etc1"),l!==null?l.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===sI||o===oI)if(l=e.get("WEBGL_compressed_texture_etc"),l!==null){if(o===sI)return c===Vi?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(o===oI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===aI||o===lI||o===cI||o===hI||o===uI||o===dI||o===pI||o===fI||o===mI||o===gI||o===vI||o===yI||o===AI||o===bI)if(l=e.get("WEBGL_compressed_texture_astc"),l!==null){if(o===aI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===lI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===cI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===hI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===uI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===dI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===pI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===fI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===mI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===gI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===vI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===yI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===AI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===bI)return c===Vi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===O_||o===xI||o===_I)if(l=e.get("EXT_texture_compression_bptc"),l!==null){if(o===O_)return c===Vi?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(o===xI)return l.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(o===_I)return l.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(o===nF||o===wI||o===SI||o===CI)if(l=e.get("EXT_texture_compression_rgtc"),l!==null){if(o===O_)return l.COMPRESSED_RED_RGTC1_EXT;if(o===wI)return l.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(o===SI)return l.COMPRESSED_RED_GREEN_RGTC2_EXT;if(o===CI)return l.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return o===eh?r?n.UNSIGNED_INT_24_8:(l=e.get("WEBGL_depth_texture"),l!==null?l.UNSIGNED_INT_24_8_WEBGL:null):n[o]!==void 0?n[o]:null}return{convert:s}}class pR extends Ft{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let Cr=class extends ve{constructor(){super(),this.isGroup=!0,this.type="Group"}};const vee={type:"move"};class fR{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Cr,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Cr,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new S,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new S),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Cr,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new S,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new S),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const r of e.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,r){let s=null,o=null,a=null;const l=this._targetRay,c=this._grip,h=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(h&&e.hand){a=!0;for(const v of e.hand.values()){const y=i.getJointPose(v,r),A=this._getHandJoint(h,v);y!==null&&(A.matrix.fromArray(y.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),A.matrixWorldNeedsUpdate=!0,A.jointRadius=y.radius),A.visible=y!==null}const u=h.joints["index-finger-tip"],d=h.joints["thumb-tip"],f=u.position.distanceTo(d.position),m=.02,g=.005;h.inputState.pinching&&f>m+g?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&f<=m-g&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(o=i.getPose(e.gripSpace,r),o!==null&&(c.matrix.fromArray(o.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,o.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(o.linearVelocity)):c.hasLinearVelocity=!1,o.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(o.angularVelocity)):c.hasAngularVelocity=!1));l!==null&&(s=i.getPose(e.targetRaySpace,r),s===null&&o!==null&&(s=o),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(vee)))}return l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),h!==null&&(h.visible=a!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const r=new Cr;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[i.jointName]=r,e.add(r)}return e.joints[i.jointName]}}const yee=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Aee=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class bee{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,r){if(this.texture===null){const s=new Gt,o=e.properties.get(s);o.__webglTexture=i.texture,(i.depthNear!=r.depthNear||i.depthFar!=r.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=s}}render(e,i){if(this.texture!==null){if(this.mesh===null){const r=i.cameras[0].viewport,s=new Bt({extensions:{fragDepth:!0},vertexShader:yee,fragmentShader:Aee,uniforms:{depthColor:{value:this.texture},depthWidth:{value:r.z},depthHeight:{value:r.w}}});this.mesh=new pe(new cr(20,20),s)}e.render(this.mesh,i)}}reset(){this.texture=null,this.mesh=null}}class xee extends wr{constructor(e,i){super();const r=this;let s=null,o=1,a=null,l="local-floor",c=1,h=null,u=null,d=null,f=null,m=null,g=null;const v=new bee,y=i.getContextAttributes();let A=null,b=null;const x=[],_=[],w=new J;let T=null;const M=new Ft;M.layers.enable(1),M.viewport=new qe;const R=new Ft;R.layers.enable(2),R.viewport=new qe;const B=[M,R],E=new pR;E.layers.enable(1),E.layers.enable(2);let P=null,O=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.controllerAutoUpdate=!0,this.getController=function(se){let _e=x[se];return _e===void 0&&(_e=new fR,x[se]=_e),_e.getTargetRaySpace()},this.getControllerGrip=function(se){let _e=x[se];return _e===void 0&&(_e=new fR,x[se]=_e),_e.getGripSpace()},this.getHand=function(se){let _e=x[se];return _e===void 0&&(_e=new fR,x[se]=_e),_e.getHandSpace()};function N(se){const _e=_.indexOf(se.inputSource);if(_e===-1)return;const Ee=x[_e];Ee!==void 0&&(Ee.update(se.inputSource,se.frame,h||a),Ee.dispatchEvent({type:se.type,data:se.inputSource}))}function L(){var se;s.removeEventListener("select",N),s.removeEventListener("selectstart",N),s.removeEventListener("selectend",N),s.removeEventListener("squeeze",N),s.removeEventListener("squeezestart",N),s.removeEventListener("squeezeend",N),s.removeEventListener("end",L),s.removeEventListener("inputsourceschange",Q);for(let _e=0;_e<x.length;_e++){const Ee=_[_e];Ee!==null&&(_[_e]=null,(se=x[_e])==null||se.disconnect(Ee))}P=null,O=null,v.reset(),e.setRenderTarget(A),m=null,f=null,d=null,s=null,b=null,Oe.stop(),r.isPresenting=!1,e.setPixelRatio(T),e.setSize(w.width,w.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(se){o=se,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(se){l=se,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||a},this.setReferenceSpace=function(se){h=se},this.getBaseLayer=function(){return f!==null?f:m},this.getBinding=function(){return d},this.getFrame=function(){return g},this.getSession=function(){return s},this.setSession=async function(se){if(s=se,s!==null){if(A=e.getRenderTarget(),s.addEventListener("select",N),s.addEventListener("selectstart",N),s.addEventListener("selectend",N),s.addEventListener("squeeze",N),s.addEventListener("squeezestart",N),s.addEventListener("squeezeend",N),s.addEventListener("end",L),s.addEventListener("inputsourceschange",Q),y.xrCompatible!==!0&&await i.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(w),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const _e={antialias:s.renderState.layers===void 0?y.antialias:!0,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:o};m=new XRWebGLLayer(s,i,_e),s.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),b=new qt(m.framebufferWidth,m.framebufferHeight,{format:Ti,type:cn,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil})}else{let _e=null,Ee=null,et=null;y.depth&&(et=y.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,_e=y.stencil?yu:vu,Ee=y.stencil?eh:_s);const We={colorFormat:i.RGBA8,depthFormat:et,scaleFactor:o};d=new XRWebGLBinding(s,i),f=d.createProjectionLayer(We),s.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),b=new qt(f.textureWidth,f.textureHeight,{format:Ti,type:cn,depthTexture:new tg(f.textureWidth,f.textureHeight,Ee,void 0,void 0,void 0,void 0,void 0,void 0,_e),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0});const Ue=e.properties.get(b);Ue.__ignoreDepthValues=f.ignoreDepthValues}b.isXRRenderTarget=!0,this.setFoveation(c),h=null,a=await s.requestReferenceSpace(l),Oe.setContext(s),Oe.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};function Q(se){var _e;for(let Ee=0;Ee<se.removed.length;Ee++){const et=se.removed[Ee],We=_.indexOf(et);We>=0&&(_[We]=null,(_e=x[We])==null||_e.disconnect(et))}for(let Ee=0;Ee<se.added.length;Ee++){const et=se.added[Ee];let We=_.indexOf(et);if(We===-1){for(let st=0;st<x.length;st++)if(st>=_.length){_.push(et),We=st;break}else if(_[st]===null){_[st]=et,We=st;break}if(We===-1)break}const Ue=x[We];Ue&&Ue.connect(et)}}const D=new S,F=new S;function H(se,_e,Ee){D.setFromMatrixPosition(_e.matrixWorld),F.setFromMatrixPosition(Ee.matrixWorld);const et=D.distanceTo(F),We=_e.projectionMatrix.elements,Ue=Ee.projectionMatrix.elements,st=We[14]/(We[10]-1),ge=We[14]/(We[10]+1),X=(We[9]+1)/We[5],ze=(We[9]-1)/We[5],Ie=(We[8]-1)/We[0],Te=(Ue[8]+1)/Ue[0],Ve=st*Ie,Ae=st*Te,nt=et/(-Ie+Te),ct=nt*-Ie;_e.matrixWorld.decompose(se.position,se.quaternion,se.scale),se.translateX(ct),se.translateZ(nt),se.matrixWorld.compose(se.position,se.quaternion,se.scale),se.matrixWorldInverse.copy(se.matrixWorld).invert();const It=st+nt,V=ge+nt,U=Ve-ct,ue=Ae+(et-ct),Me=X*ge/V*It,De=ze*ge/V*It;se.projectionMatrix.makePerspective(U,ue,Me,De,It,V),se.projectionMatrixInverse.copy(se.projectionMatrix).invert()}function K(se,_e){_e===null?se.matrixWorld.copy(se.matrix):se.matrixWorld.multiplyMatrices(_e.matrixWorld,se.matrix),se.matrixWorldInverse.copy(se.matrixWorld).invert()}this.updateCamera=function(se){if(s===null)return;v.texture!==null&&(v.depthNear>0&&(se.near=v.depthNear),v.depthFar>0&&(se.far=v.depthFar)),E.near=R.near=M.near=se.near,E.far=R.far=M.far=se.far,(P!==E.near||O!==E.far)&&(s.updateRenderState({depthNear:E.near,depthFar:E.far}),P=E.near,O=E.far,M.near=P,M.far=O,R.near=P,R.far=O,M.updateProjectionMatrix(),R.updateProjectionMatrix(),se.updateProjectionMatrix());const _e=se.parent,Ee=E.cameras;K(E,_e);for(let et=0;et<Ee.length;et++)K(Ee[et],_e);Ee.length===2?H(E,M,R):E.projectionMatrix.copy(M.projectionMatrix),Z(se,E,_e)};function Z(se,_e,Ee){Ee===null?se.matrix.copy(_e.matrixWorld):(se.matrix.copy(Ee.matrixWorld),se.matrix.invert(),se.matrix.multiply(_e.matrixWorld)),se.matrix.decompose(se.position,se.quaternion,se.scale),se.updateMatrixWorld(!0),se.projectionMatrix.copy(_e.projectionMatrix),se.projectionMatrixInverse.copy(_e.projectionMatrixInverse),se.isPerspectiveCamera&&(se.fov=Om*2*Math.atan(1/se.projectionMatrix.elements[5]),se.zoom=1)}this.getCamera=function(){return E},this.getFoveation=function(){if(!(f===null&&m===null))return c},this.setFoveation=function(se){c=se,f!==null&&(f.fixedFoveation=se),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=se)},this.hasDepthSensing=function(){return v.texture!==null};let oe=null;function we(se,_e){if(u=_e.getViewerPose(h||a),g=_e,u!==null){const Ee=u.views;m!==null&&(e.setRenderTargetFramebuffer(b,m.framebuffer),e.setRenderTarget(b));let et=!1;Ee.length!==E.cameras.length&&(E.cameras.length=0,et=!0);for(let Ue=0;Ue<Ee.length;Ue++){const st=Ee[Ue];let ge=null;if(m!==null)ge=m.getViewport(st);else{const ze=d.getViewSubImage(f,st);ge=ze.viewport,Ue===0&&(e.setRenderTargetTextures(b,ze.colorTexture,f.ignoreDepthValues?void 0:ze.depthStencilTexture),e.setRenderTarget(b))}let X=B[Ue];X===void 0&&(X=new Ft,X.layers.enable(Ue),X.viewport=new qe,B[Ue]=X),X.matrix.fromArray(st.transform.matrix),X.matrix.decompose(X.position,X.quaternion,X.scale),X.projectionMatrix.fromArray(st.projectionMatrix),X.projectionMatrixInverse.copy(X.projectionMatrix).invert(),X.viewport.set(ge.x,ge.y,ge.width,ge.height),Ue===0&&(E.matrix.copy(X.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),et===!0&&E.cameras.push(X)}const We=s.enabledFeatures;if(We&&We.includes("depth-sensing")){const Ue=d.getDepthInformation(Ee[0]);Ue&&Ue.isValid&&Ue.texture&&v.init(e,Ue,s.renderState)}}if(r.controllerAutoUpdate)for(let Ee=0;Ee<x.length;Ee++){const et=_[Ee],We=x[Ee];et!==null&&We!==void 0&&We.update(et,_e,h||a)}v.render(e,E),oe&&oe(se,_e),_e.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:_e}),g=null}const Oe=new $F;Oe.setAnimationLoop(we),this.setAnimationLoop=function(se){oe=se},this.dispose=function(){}}}const Op=new ri,_ee=new he;function wee(n,e){function i(y,A){y.matrixAutoUpdate===!0&&y.updateMatrix(),A.value.copy(y.matrix)}function r(y,A){A.color.getRGB(y.fogColor.value,JF(n)),A.isFog?(y.fogNear.value=A.near,y.fogFar.value=A.far):A.isFogExp2&&(y.fogDensity.value=A.density)}function s(y,A,b,x,_){A.isMeshBasicMaterial||A.isMeshLambertMaterial?o(y,A):A.isMeshToonMaterial?(o(y,A),d(y,A)):A.isMeshPhongMaterial?(o(y,A),u(y,A)):A.isMeshStandardMaterial?(o(y,A),f(y,A),A.isMeshPhysicalMaterial&&m(y,A,_)):A.isMeshMatcapMaterial?(o(y,A),g(y,A)):A.isMeshDepthMaterial?o(y,A):A.isMeshDistanceMaterial?(o(y,A),v(y,A)):A.isMeshNormalMaterial?o(y,A):A.isLineBasicMaterial?(a(y,A),A.isLineDashedMaterial&&l(y,A)):A.isPointsMaterial?c(y,A,b,x):A.isSpriteMaterial?h(y,A):A.isShadowMaterial?(y.color.value.copy(A.color),y.opacity.value=A.opacity):A.isShaderMaterial&&(A.uniformsNeedUpdate=!1)}function o(y,A){y.opacity.value=A.opacity,A.color&&y.diffuse.value.copy(A.color),A.emissive&&y.emissive.value.copy(A.emissive).multiplyScalar(A.emissiveIntensity),A.map&&(y.map.value=A.map,i(A.map,y.mapTransform)),A.alphaMap&&(y.alphaMap.value=A.alphaMap,i(A.alphaMap,y.alphaMapTransform)),A.bumpMap&&(y.bumpMap.value=A.bumpMap,i(A.bumpMap,y.bumpMapTransform),y.bumpScale.value=A.bumpScale,A.side===an&&(y.bumpScale.value*=-1)),A.normalMap&&(y.normalMap.value=A.normalMap,i(A.normalMap,y.normalMapTransform),y.normalScale.value.copy(A.normalScale),A.side===an&&y.normalScale.value.negate()),A.displacementMap&&(y.displacementMap.value=A.displacementMap,i(A.displacementMap,y.displacementMapTransform),y.displacementScale.value=A.displacementScale,y.displacementBias.value=A.displacementBias),A.emissiveMap&&(y.emissiveMap.value=A.emissiveMap,i(A.emissiveMap,y.emissiveMapTransform)),A.specularMap&&(y.specularMap.value=A.specularMap,i(A.specularMap,y.specularMapTransform)),A.alphaTest>0&&(y.alphaTest.value=A.alphaTest);const b=e.get(A),x=b.envMap,_=b.envMapRotation;if(x&&(y.envMap.value=x,Op.copy(_),Op.x*=-1,Op.y*=-1,Op.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Op.y*=-1,Op.z*=-1),y.envMapRotation.value.setFromMatrix4(_ee.makeRotationFromEuler(Op)),y.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=A.reflectivity,y.ior.value=A.ior,y.refractionRatio.value=A.refractionRatio),A.lightMap){y.lightMap.value=A.lightMap;const w=n._useLegacyLights===!0?Math.PI:1;y.lightMapIntensity.value=A.lightMapIntensity*w,i(A.lightMap,y.lightMapTransform)}A.aoMap&&(y.aoMap.value=A.aoMap,y.aoMapIntensity.value=A.aoMapIntensity,i(A.aoMap,y.aoMapTransform))}function a(y,A){y.diffuse.value.copy(A.color),y.opacity.value=A.opacity,A.map&&(y.map.value=A.map,i(A.map,y.mapTransform))}function l(y,A){y.dashSize.value=A.dashSize,y.totalSize.value=A.dashSize+A.gapSize,y.scale.value=A.scale}function c(y,A,b,x){y.diffuse.value.copy(A.color),y.opacity.value=A.opacity,y.size.value=A.size*b,y.scale.value=x*.5,A.map&&(y.map.value=A.map,i(A.map,y.uvTransform)),A.alphaMap&&(y.alphaMap.value=A.alphaMap,i(A.alphaMap,y.alphaMapTransform)),A.alphaTest>0&&(y.alphaTest.value=A.alphaTest)}function h(y,A){y.diffuse.value.copy(A.color),y.opacity.value=A.opacity,y.rotation.value=A.rotation,A.map&&(y.map.value=A.map,i(A.map,y.mapTransform)),A.alphaMap&&(y.alphaMap.value=A.alphaMap,i(A.alphaMap,y.alphaMapTransform)),A.alphaTest>0&&(y.alphaTest.value=A.alphaTest)}function u(y,A){y.specular.value.copy(A.specular),y.shininess.value=Math.max(A.shininess,1e-4)}function d(y,A){A.gradientMap&&(y.gradientMap.value=A.gradientMap)}function f(y,A){y.metalness.value=A.metalness,A.metalnessMap&&(y.metalnessMap.value=A.metalnessMap,i(A.metalnessMap,y.metalnessMapTransform)),y.roughness.value=A.roughness,A.roughnessMap&&(y.roughnessMap.value=A.roughnessMap,i(A.roughnessMap,y.roughnessMapTransform)),e.get(A).envMap&&(y.envMapIntensity.value=A.envMapIntensity)}function m(y,A,b){y.ior.value=A.ior,A.sheen>0&&(y.sheenColor.value.copy(A.sheenColor).multiplyScalar(A.sheen),y.sheenRoughness.value=A.sheenRoughness,A.sheenColorMap&&(y.sheenColorMap.value=A.sheenColorMap,i(A.sheenColorMap,y.sheenColorMapTransform)),A.sheenRoughnessMap&&(y.sheenRoughnessMap.value=A.sheenRoughnessMap,i(A.sheenRoughnessMap,y.sheenRoughnessMapTransform))),A.clearcoat>0&&(y.clearcoat.value=A.clearcoat,y.clearcoatRoughness.value=A.clearcoatRoughness,A.clearcoatMap&&(y.clearcoatMap.value=A.clearcoatMap,i(A.clearcoatMap,y.clearcoatMapTransform)),A.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=A.clearcoatRoughnessMap,i(A.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),A.clearcoatNormalMap&&(y.clearcoatNormalMap.value=A.clearcoatNormalMap,i(A.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(A.clearcoatNormalScale),A.side===an&&y.clearcoatNormalScale.value.negate())),A.iridescence>0&&(y.iridescence.value=A.iridescence,y.iridescenceIOR.value=A.iridescenceIOR,y.iridescenceThicknessMinimum.value=A.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=A.iridescenceThicknessRange[1],A.iridescenceMap&&(y.iridescenceMap.value=A.iridescenceMap,i(A.iridescenceMap,y.iridescenceMapTransform)),A.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=A.iridescenceThicknessMap,i(A.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),A.transmission>0&&(y.transmission.value=A.transmission,y.transmissionSamplerMap.value=b.texture,y.transmissionSamplerSize.value.set(b.width,b.height),A.transmissionMap&&(y.transmissionMap.value=A.transmissionMap,i(A.transmissionMap,y.transmissionMapTransform)),y.thickness.value=A.thickness,A.thicknessMap&&(y.thicknessMap.value=A.thicknessMap,i(A.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=A.attenuationDistance,y.attenuationColor.value.copy(A.attenuationColor)),A.anisotropy>0&&(y.anisotropyVector.value.set(A.anisotropy*Math.cos(A.anisotropyRotation),A.anisotropy*Math.sin(A.anisotropyRotation)),A.anisotropyMap&&(y.anisotropyMap.value=A.anisotropyMap,i(A.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=A.specularIntensity,y.specularColor.value.copy(A.specularColor),A.specularColorMap&&(y.specularColorMap.value=A.specularColorMap,i(A.specularColorMap,y.specularColorMapTransform)),A.specularIntensityMap&&(y.specularIntensityMap.value=A.specularIntensityMap,i(A.specularIntensityMap,y.specularIntensityMapTransform))}function g(y,A){A.matcap&&(y.matcap.value=A.matcap)}function v(y,A){const b=e.get(A).light;y.referencePosition.value.setFromMatrixPosition(b.matrixWorld),y.nearDistance.value=b.shadow.camera.near,y.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:s}}function See(n,e,i,r){let s={},o={},a=[];const l=i.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function c(b,x){const _=x.program;r.uniformBlockBinding(b,_)}function h(b,x){let _=s[b.id];_===void 0&&(g(b),_=u(b),s[b.id]=_,b.addEventListener("dispose",y));const w=x.program;r.updateUBOMapping(b,w);const T=e.render.frame;o[b.id]!==T&&(f(b),o[b.id]=T)}function u(b){const x=d();b.__bindingPointIndex=x;const _=n.createBuffer(),w=b.__size,T=b.usage;return n.bindBuffer(n.UNIFORM_BUFFER,_),n.bufferData(n.UNIFORM_BUFFER,w,T),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,x,_),_}function d(){for(let b=0;b<l;b++)if(a.indexOf(b)===-1)return a.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(b){const x=s[b.id],_=b.uniforms,w=b.__cache;n.bindBuffer(n.UNIFORM_BUFFER,x);for(let T=0,M=_.length;T<M;T++){const R=Array.isArray(_[T])?_[T]:[_[T]];for(let B=0,E=R.length;B<E;B++){const P=R[B];if(m(P,T,B,w)===!0){const O=P.__offset,N=Array.isArray(P.value)?P.value:[P.value];let L=0;for(let Q=0;Q<N.length;Q++){const D=N[Q],F=v(D);typeof D=="number"||typeof D=="boolean"?(P.__data[0]=D,n.bufferSubData(n.UNIFORM_BUFFER,O+L,P.__data)):D.isMatrix3?(P.__data[0]=D.elements[0],P.__data[1]=D.elements[1],P.__data[2]=D.elements[2],P.__data[3]=0,P.__data[4]=D.elements[3],P.__data[5]=D.elements[4],P.__data[6]=D.elements[5],P.__data[7]=0,P.__data[8]=D.elements[6],P.__data[9]=D.elements[7],P.__data[10]=D.elements[8],P.__data[11]=0):(D.toArray(P.__data,L),L+=F.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,O,P.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function m(b,x,_,w){const T=b.value,M=x+"_"+_;if(w[M]===void 0)return typeof T=="number"||typeof T=="boolean"?w[M]=T:w[M]=T.clone(),!0;{const R=w[M];if(typeof T=="number"||typeof T=="boolean"){if(R!==T)return w[M]=T,!0}else if(R.equals(T)===!1)return R.copy(T),!0}return!1}function g(b){const x=b.uniforms;let _=0;const w=16;for(let M=0,R=x.length;M<R;M++){const B=Array.isArray(x[M])?x[M]:[x[M]];for(let E=0,P=B.length;E<P;E++){const O=B[E],N=Array.isArray(O.value)?O.value:[O.value];for(let L=0,Q=N.length;L<Q;L++){const D=N[L],F=v(D),H=_%w;H!==0&&w-H<F.boundary&&(_+=w-H),O.__data=new Float32Array(F.storage/Float32Array.BYTES_PER_ELEMENT),O.__offset=_,_+=F.storage}}}const T=_%w;return T>0&&(_+=w-T),b.__size=_,b.__cache={},this}function v(b){const x={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(x.boundary=4,x.storage=4):b.isVector2?(x.boundary=8,x.storage=8):b.isVector3||b.isColor?(x.boundary=16,x.storage=12):b.isVector4?(x.boundary=16,x.storage=16):b.isMatrix3?(x.boundary=48,x.storage=48):b.isMatrix4?(x.boundary=64,x.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),x}function y(b){const x=b.target;x.removeEventListener("dispose",y);const _=a.indexOf(x.__bindingPointIndex);a.splice(_,1),n.deleteBuffer(s[x.id]),delete s[x.id],delete o[x.id]}function A(){for(const b in s)n.deleteBuffer(s[b]);a=[],s={},o={}}return{bind:c,update:h,dispose:A}}class lh{constructor(e={}){const{canvas:i=RF(),context:r=null,depth:s=!0,stencil:o=!0,alpha:a=!1,antialias:l=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:h=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let f;r!==null?f=r.getContextAttributes().alpha:f=a;const m=new Uint32Array(4),g=new Int32Array(4);let v=null,y=null;const A=[],b=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=gt,this._useLegacyLights=!1,this.toneMapping=Xs,this.toneMappingExposure=1;const x=this;let _=!1,w=0,T=0,M=null,R=-1,B=null;const E=new qe,P=new qe;let O=null;const N=new be(0);let L=0,Q=i.width,D=i.height,F=1,H=null,K=null;const Z=new qe(0,0,Q,D),oe=new qe(0,0,Q,D);let we=!1;const Oe=new Rp;let se=!1,_e=!1,Ee=null;const et=new he,We=new J,Ue=new S,st={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ge(){return M===null?F:1}let X=r;function ze(z,ne){for(let me=0;me<z.length;me++){const ye=z[me],le=i.getContext(ye,ne);if(le!==null)return le}return null}try{const z={alpha:!0,depth:s,stencil:o,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:h,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${Kc}`),i.addEventListener("webglcontextlost",ee,!1),i.addEventListener("webglcontextrestored",j,!1),i.addEventListener("webglcontextcreationerror",Y,!1),X===null){const ne=["webgl2","webgl","experimental-webgl"];if(x.isWebGL1Renderer===!0&&ne.shift(),X=ze(ne,z),X===null)throw ze(ne)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&X instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),X.getShaderPrecisionFormat===void 0&&(X.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(z){throw console.error("THREE.WebGLRenderer: "+z.message),z}let Ie,Te,Ve,Ae,nt,ct,It,V,U,ue,Me,De,Pe,At,ht,je,He,St,Fe,Kt,Le,_t,ut,I;function k(){Ie=new OZ(X),Te=new IZ(X,Ie,e),Ie.init(Te),_t=new MN(X,Ie,Te),Ve=new mee(X,Ie,Te),Ae=new UZ(X),nt=new nee,ct=new gee(X,Ie,Ve,nt,Te,_t,Ae),It=new PZ(x),V=new kZ(x),U=new VY(X,Te),ut=new MZ(X,Ie,U,Te),ue=new DZ(X,U,Ae,ut),Me=new jZ(X,ue,U,Ae),Fe=new zZ(X,Te,ct),je=new RZ(nt),De=new iee(x,It,V,Ie,Te,ut,je),Pe=new wee(x,nt),At=new see,ht=new uee(Ie,Te),St=new EZ(x,It,V,Ve,Me,f,c),He=new fee(x,Me,Te),I=new See(X,Ae,Te,Ve),Kt=new TZ(X,Ie,Ae,Te),Le=new LZ(X,Ie,Ae,Te),Ae.programs=De.programs,x.capabilities=Te,x.extensions=Ie,x.properties=nt,x.renderLists=At,x.shadowMap=He,x.state=Ve,x.info=Ae}k();const G=new xee(x,X);this.xr=G,this.getContext=function(){return X},this.getContextAttributes=function(){return X.getContextAttributes()},this.forceContextLoss=function(){const z=Ie.get("WEBGL_lose_context");z&&z.loseContext()},this.forceContextRestore=function(){const z=Ie.get("WEBGL_lose_context");z&&z.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(z){z!==void 0&&(F=z,this.setSize(Q,D,!1))},this.getSize=function(z){return z.set(Q,D)},this.setSize=function(z,ne,me=!0){if(G.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Q=z,D=ne,i.width=Math.floor(z*F),i.height=Math.floor(ne*F),me===!0&&(i.style.width=z+"px",i.style.height=ne+"px"),this.setViewport(0,0,z,ne)},this.getDrawingBufferSize=function(z){return z.set(Q*F,D*F).floor()},this.setDrawingBufferSize=function(z,ne,me){Q=z,D=ne,F=me,i.width=Math.floor(z*me),i.height=Math.floor(ne*me),this.setViewport(0,0,z,ne)},this.getCurrentViewport=function(z){return z.copy(E)},this.getViewport=function(z){return z.copy(Z)},this.setViewport=function(z,ne,me,ye){z.isVector4?Z.set(z.x,z.y,z.z,z.w):Z.set(z,ne,me,ye),Ve.viewport(E.copy(Z).multiplyScalar(F).round())},this.getScissor=function(z){return z.copy(oe)},this.setScissor=function(z,ne,me,ye){z.isVector4?oe.set(z.x,z.y,z.z,z.w):oe.set(z,ne,me,ye),Ve.scissor(P.copy(oe).multiplyScalar(F).round())},this.getScissorTest=function(){return we},this.setScissorTest=function(z){Ve.setScissorTest(we=z)},this.setOpaqueSort=function(z){H=z},this.setTransparentSort=function(z){K=z},this.getClearColor=function(z){return z.copy(St.getClearColor())},this.setClearColor=function(){St.setClearColor.apply(St,arguments)},this.getClearAlpha=function(){return St.getClearAlpha()},this.setClearAlpha=function(){St.setClearAlpha.apply(St,arguments)},this.clear=function(z=!0,ne=!0,me=!0){let ye=0;if(z){let le=!1;if(M!==null){const $e=M.texture.format;le=$e===km||$e===$v||$e===T_}if(le){const $e=M.texture.type,Pt=$e===cn||$e===_s||$e===Zv||$e===eh||$e===ZT||$e===$T,zt=St.getClearColor(),Qt=St.getClearAlpha(),hi=zt.r,ti=zt.g,ii=zt.b;Pt?(m[0]=hi,m[1]=ti,m[2]=ii,m[3]=Qt,X.clearBufferuiv(X.COLOR,0,m)):(g[0]=hi,g[1]=ti,g[2]=ii,g[3]=Qt,X.clearBufferiv(X.COLOR,0,g))}else ye|=X.COLOR_BUFFER_BIT}ne&&(ye|=X.DEPTH_BUFFER_BIT),me&&(ye|=X.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),X.clear(ye)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",ee,!1),i.removeEventListener("webglcontextrestored",j,!1),i.removeEventListener("webglcontextcreationerror",Y,!1),At.dispose(),ht.dispose(),nt.dispose(),It.dispose(),V.dispose(),Me.dispose(),ut.dispose(),I.dispose(),De.dispose(),G.dispose(),G.removeEventListener("sessionstart",Xe),G.removeEventListener("sessionend",Ze),Ee&&(Ee.dispose(),Ee=null),vt.stop()};function ee(z){z.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function j(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const z=Ae.autoReset,ne=He.enabled,me=He.autoUpdate,ye=He.needsUpdate,le=He.type;k(),Ae.autoReset=z,He.enabled=ne,He.autoUpdate=me,He.needsUpdate=ye,He.type=le}function Y(z){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",z.statusMessage)}function W(z){const ne=z.target;ne.removeEventListener("dispose",W),ae(ne)}function ae(z){ce(z),nt.remove(z)}function ce(z){const ne=nt.get(z).programs;ne!==void 0&&(ne.forEach(function(me){De.releaseProgram(me)}),z.isShaderMaterial&&De.releaseShaderCache(z))}this.renderBufferDirect=function(z,ne,me,ye,le,$e){ne===null&&(ne=st);const Pt=le.isMesh&&le.matrixWorld.determinant()<0,zt=Ln(z,ne,me,ye,le);Ve.setMaterial(ye,Pt);let Qt=me.index,hi=1;if(ye.wireframe===!0){if(Qt=ue.getWireframeAttribute(me),Qt===void 0)return;hi=2}const ti=me.drawRange,ii=me.attributes.position;let bs=ti.start*hi,hr=(ti.start+ti.count)*hi;$e!==null&&(bs=Math.max(bs,$e.start*hi),hr=Math.min(hr,($e.start+$e.count)*hi)),Qt!==null?(bs=Math.max(bs,0),hr=Math.min(hr,Qt.count)):ii!=null&&(bs=Math.max(bs,0),hr=Math.min(hr,ii.count));const Aa=hr-bs;if(Aa<0||Aa===1/0)return;ut.setup(le,ye,zt,me,Qt);let Jc,Un=Kt;if(Qt!==null&&(Jc=U.get(Qt),Un=Le,Un.setIndex(Jc)),le.isMesh)ye.wireframe===!0?(Ve.setLineWidth(ye.wireframeLinewidth*ge()),Un.setMode(X.LINES)):Un.setMode(X.TRIANGLES);else if(le.isLine){let Zt=ye.linewidth;Zt===void 0&&(Zt=1),Ve.setLineWidth(Zt*ge()),le.isLineSegments?Un.setMode(X.LINES):le.isLineLoop?Un.setMode(X.LINE_LOOP):Un.setMode(X.LINE_STRIP)}else le.isPoints?Un.setMode(X.POINTS):le.isSprite&&Un.setMode(X.TRIANGLES);if(le.isBatchedMesh)Un.renderMultiDraw(le._multiDrawStarts,le._multiDrawCounts,le._multiDrawCount);else if(le.isInstancedMesh)Un.renderInstances(bs,Aa,le.count);else if(me.isInstancedBufferGeometry){const Zt=me._maxInstanceCount!==void 0?me._maxInstanceCount:1/0,LT=Math.min(me.instanceCount,Zt);Un.renderInstances(bs,Aa,LT)}else Un.render(bs,Aa)};function xe(z,ne,me){z.transparent===!0&&z.side===yi&&z.forceSinglePass===!1?(z.side=an,z.needsUpdate=!0,_r(z,ne,me),z.side=Fn,z.needsUpdate=!0,_r(z,ne,me),z.side=yi):_r(z,ne,me)}this.compile=function(z,ne,me=null){me===null&&(me=z),y=ht.get(me),y.init(),b.push(y),me.traverseVisible(function(le){le.isLight&&le.layers.test(ne.layers)&&(y.pushLight(le),le.castShadow&&y.pushShadow(le))}),z!==me&&z.traverseVisible(function(le){le.isLight&&le.layers.test(ne.layers)&&(y.pushLight(le),le.castShadow&&y.pushShadow(le))}),y.setupLights(x._useLegacyLights);const ye=new Set;return z.traverse(function(le){const $e=le.material;if($e)if(Array.isArray($e))for(let Pt=0;Pt<$e.length;Pt++){const zt=$e[Pt];xe(zt,me,le),ye.add(zt)}else xe($e,me,le),ye.add($e)}),b.pop(),y=null,ye},this.compileAsync=function(z,ne,me=null){const ye=this.compile(z,ne,me);return new Promise(le=>{function $e(){if(ye.forEach(function(Pt){nt.get(Pt).currentProgram.isReady()&&ye.delete(Pt)}),ye.size===0){le(z);return}setTimeout($e,10)}Ie.get("KHR_parallel_shader_compile")!==null?$e():setTimeout($e,10)})};let Re=null;function Je(z){Re&&Re(z)}function Xe(){vt.stop()}function Ze(){vt.start()}const vt=new $F;vt.setAnimationLoop(Je),typeof self<"u"&&vt.setContext(self),this.setAnimationLoop=function(z){Re=z,G.setAnimationLoop(z),z===null?vt.stop():vt.start()},G.addEventListener("sessionstart",Xe),G.addEventListener("sessionend",Ze),this.render=function(z,ne){if(ne!==void 0&&ne.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(_===!0)return;z.matrixWorldAutoUpdate===!0&&z.updateMatrixWorld(),ne.parent===null&&ne.matrixWorldAutoUpdate===!0&&ne.updateMatrixWorld(),G.enabled===!0&&G.isPresenting===!0&&(G.cameraAutoUpdate===!0&&G.updateCamera(ne),ne=G.getCamera()),z.isScene===!0&&z.onBeforeRender(x,z,ne,M),y=ht.get(z,b.length),y.init(),b.push(y),et.multiplyMatrices(ne.projectionMatrix,ne.matrixWorldInverse),Oe.setFromProjectionMatrix(et),_e=this.localClippingEnabled,se=je.init(this.clippingPlanes,_e),v=At.get(z,A.length),v.init(),A.push(v),ot(z,ne,0,x.sortObjects),v.finish(),x.sortObjects===!0&&v.sort(H,K),this.info.render.frame++,se===!0&&je.beginShadows();const me=y.state.shadowsArray;if(He.render(me,z,ne),se===!0&&je.endShadows(),this.info.autoReset===!0&&this.info.reset(),(G.enabled===!1||G.isPresenting===!1||G.hasDepthSensing()===!1)&&St.render(v,z),y.setupLights(x._useLegacyLights),ne.isArrayCamera){const ye=ne.cameras;for(let le=0,$e=ye.length;le<$e;le++){const Pt=ye[le];wt(v,z,Pt,Pt.viewport)}}else wt(v,z,ne);M!==null&&(ct.updateMultisampleRenderTarget(M),ct.updateRenderTargetMipmap(M)),z.isScene===!0&&z.onAfterRender(x,z,ne),ut.resetDefaultState(),R=-1,B=null,b.pop(),b.length>0?y=b[b.length-1]:y=null,A.pop(),A.length>0?v=A[A.length-1]:v=null};function ot(z,ne,me,ye){if(z.visible===!1)return;if(z.layers.test(ne.layers)){if(z.isGroup)me=z.renderOrder;else if(z.isLOD)z.autoUpdate===!0&&z.update(ne);else if(z.isLight)y.pushLight(z),z.castShadow&&y.pushShadow(z);else if(z.isSprite){if(!z.frustumCulled||Oe.intersectsSprite(z)){ye&&Ue.setFromMatrixPosition(z.matrixWorld).applyMatrix4(et);const $e=Me.update(z),Pt=z.material;Pt.visible&&v.push(z,$e,Pt,me,Ue.z,null)}}else if((z.isMesh||z.isLine||z.isPoints)&&(!z.frustumCulled||Oe.intersectsObject(z))){const $e=Me.update(z),Pt=z.material;if(ye&&(z.boundingSphere!==void 0?(z.boundingSphere===null&&z.computeBoundingSphere(),Ue.copy(z.boundingSphere.center)):($e.boundingSphere===null&&$e.computeBoundingSphere(),Ue.copy($e.boundingSphere.center)),Ue.applyMatrix4(z.matrixWorld).applyMatrix4(et)),Array.isArray(Pt)){const zt=$e.groups;for(let Qt=0,hi=zt.length;Qt<hi;Qt++){const ti=zt[Qt],ii=Pt[ti.materialIndex];ii&&ii.visible&&v.push(z,$e,ii,me,Ue.z,ti)}}else Pt.visible&&v.push(z,$e,Pt,me,Ue.z,null)}}const le=z.children;for(let $e=0,Pt=le.length;$e<Pt;$e++)ot(le[$e],ne,me,ye)}function wt(z,ne,me,ye){const le=z.opaque,$e=z.transmissive,Pt=z.transparent;y.setupLightsView(me),se===!0&&je.setGlobalState(x.clippingPlanes,me),$e.length>0&&ei(le,$e,ne,me),ye&&Ve.viewport(E.copy(ye)),le.length>0&&Ni(le,ne,me),$e.length>0&&Ni($e,ne,me),Pt.length>0&&Ni(Pt,ne,me),Ve.buffers.depth.setTest(!0),Ve.buffers.depth.setMask(!0),Ve.buffers.color.setMask(!0),Ve.setPolygonOffset(!1)}function ei(z,ne,me,ye){if((me.isScene===!0?me.overrideMaterial:null)!==null)return;const le=Te.isWebGL2;Ee===null&&(Ee=new qt(1,1,{generateMipmaps:!0,type:Ie.has("EXT_color_buffer_half_float")?ur:cn,minFilter:bo,samples:le?4:0})),x.getDrawingBufferSize(We),le?Ee.setSize(We.x,We.y):Ee.setSize(H_(We.x),H_(We.y));const $e=x.getRenderTarget();x.setRenderTarget(Ee),x.getClearColor(N),L=x.getClearAlpha(),L<1&&x.setClearColor(16777215,.5),x.clear();const Pt=x.toneMapping;x.toneMapping=Xs,Ni(z,me,ye),ct.updateMultisampleRenderTarget(Ee),ct.updateRenderTargetMipmap(Ee);let zt=!1;for(let Qt=0,hi=ne.length;Qt<hi;Qt++){const ti=ne[Qt],ii=ti.object,bs=ti.geometry,hr=ti.material,Aa=ti.group;if(hr.side===yi&&ii.layers.test(ye.layers)){const Jc=hr.side;hr.side=an,hr.needsUpdate=!0,on(ii,me,ye,bs,hr,Aa),hr.side=Jc,hr.needsUpdate=!0,zt=!0}}zt===!0&&(ct.updateMultisampleRenderTarget(Ee),ct.updateRenderTargetMipmap(Ee)),x.setRenderTarget($e),x.setClearColor(N,L),x.toneMapping=Pt}function Ni(z,ne,me){const ye=ne.isScene===!0?ne.overrideMaterial:null;for(let le=0,$e=z.length;le<$e;le++){const Pt=z[le],zt=Pt.object,Qt=Pt.geometry,hi=ye===null?Pt.material:ye,ti=Pt.group;zt.layers.test(me.layers)&&on(zt,ne,me,Qt,hi,ti)}}function on(z,ne,me,ye,le,$e){z.onBeforeRender(x,ne,me,ye,le,$e),z.modelViewMatrix.multiplyMatrices(me.matrixWorldInverse,z.matrixWorld),z.normalMatrix.getNormalMatrix(z.modelViewMatrix),le.onBeforeRender(x,ne,me,ye,z,$e),le.transparent===!0&&le.side===yi&&le.forceSinglePass===!1?(le.side=an,le.needsUpdate=!0,x.renderBufferDirect(me,ne,ye,le,z,$e),le.side=Fn,le.needsUpdate=!0,x.renderBufferDirect(me,ne,ye,le,z,$e),le.side=yi):x.renderBufferDirect(me,ne,ye,le,z,$e),z.onAfterRender(x,ne,me,ye,le,$e)}function _r(z,ne,me){ne.isScene!==!0&&(ne=st);const ye=nt.get(z),le=y.state.lights,$e=y.state.shadowsArray,Pt=le.state.version,zt=De.getParameters(z,le.state,$e,ne,me),Qt=De.getProgramCacheKey(zt);let hi=ye.programs;ye.environment=z.isMeshStandardMaterial?ne.environment:null,ye.fog=ne.fog,ye.envMap=(z.isMeshStandardMaterial?V:It).get(z.envMap||ye.environment),ye.envMapRotation=ye.environment!==null&&z.envMap===null?ne.environmentRotation:z.envMapRotation,hi===void 0&&(z.addEventListener("dispose",W),hi=new Map,ye.programs=hi);let ti=hi.get(Qt);if(ti!==void 0){if(ye.currentProgram===ti&&ye.lightsStateVersion===Pt)return ci(z,zt),ti}else zt.uniforms=De.getUniforms(z),z.onBuild(me,zt,x),z.onBeforeCompile(zt,x),ti=De.acquireProgram(zt,Qt),hi.set(Qt,ti),ye.uniforms=zt.uniforms;const ii=ye.uniforms;return(!z.isShaderMaterial&&!z.isRawShaderMaterial||z.clipping===!0)&&(ii.clippingPlanes=je.uniform),ci(z,zt),ye.needsLights=qn(z),ye.lightsStateVersion=Pt,ye.needsLights&&(ii.ambientLightColor.value=le.state.ambient,ii.lightProbe.value=le.state.probe,ii.directionalLights.value=le.state.directional,ii.directionalLightShadows.value=le.state.directionalShadow,ii.spotLights.value=le.state.spot,ii.spotLightShadows.value=le.state.spotShadow,ii.rectAreaLights.value=le.state.rectArea,ii.ltc_1.value=le.state.rectAreaLTC1,ii.ltc_2.value=le.state.rectAreaLTC2,ii.pointLights.value=le.state.point,ii.pointLightShadows.value=le.state.pointShadow,ii.hemisphereLights.value=le.state.hemi,ii.directionalShadowMap.value=le.state.directionalShadowMap,ii.directionalShadowMatrix.value=le.state.directionalShadowMatrix,ii.spotShadowMap.value=le.state.spotShadowMap,ii.spotLightMatrix.value=le.state.spotLightMatrix,ii.spotLightMap.value=le.state.spotLightMap,ii.pointShadowMap.value=le.state.pointShadowMap,ii.pointShadowMatrix.value=le.state.pointShadowMatrix),ye.currentProgram=ti,ye.uniformsList=null,ti}function Li(z){if(z.uniformsList===null){const ne=z.currentProgram.getUniforms();z.uniformsList=fw.seqWithValue(ne.seq,z.uniforms)}return z.uniformsList}function ci(z,ne){const me=nt.get(z);me.outputColorSpace=ne.outputColorSpace,me.batching=ne.batching,me.instancing=ne.instancing,me.instancingColor=ne.instancingColor,me.instancingMorph=ne.instancingMorph,me.skinning=ne.skinning,me.morphTargets=ne.morphTargets,me.morphNormals=ne.morphNormals,me.morphColors=ne.morphColors,me.morphTargetsCount=ne.morphTargetsCount,me.numClippingPlanes=ne.numClippingPlanes,me.numIntersection=ne.numClipIntersection,me.vertexAlphas=ne.vertexAlphas,me.vertexTangents=ne.vertexTangents,me.toneMapping=ne.toneMapping}function Ln(z,ne,me,ye,le){ne.isScene!==!0&&(ne=st),ct.resetTextureUnits();const $e=ne.fog,Pt=ye.isMeshStandardMaterial?ne.environment:null,zt=M===null?x.outputColorSpace:M.isXRRenderTarget===!0?M.texture.colorSpace:Ii,Qt=(ye.isMeshStandardMaterial?V:It).get(ye.envMap||Pt),hi=ye.vertexColors===!0&&!!me.attributes.color&&me.attributes.color.itemSize===4,ti=!!me.attributes.tangent&&(!!ye.normalMap||ye.anisotropy>0),ii=!!me.morphAttributes.position,bs=!!me.morphAttributes.normal,hr=!!me.morphAttributes.color;let Aa=Xs;ye.toneMapped&&(M===null||M.isXRRenderTarget===!0)&&(Aa=x.toneMapping);const Jc=me.morphAttributes.position||me.morphAttributes.normal||me.morphAttributes.color,Un=Jc!==void 0?Jc.length:0,Zt=nt.get(ye),LT=y.state.lights;if(se===!0&&(_e===!0||z!==B)){const ba=z===B&&ye.id===R;je.setState(ye,z,ba)}let UT=!1;ye.version===Zt.__version?(Zt.needsLights&&Zt.lightsStateVersion!==LT.state.version||Zt.outputColorSpace!==zt||le.isBatchedMesh&&Zt.batching===!1||!le.isBatchedMesh&&Zt.batching===!0||le.isInstancedMesh&&Zt.instancing===!1||!le.isInstancedMesh&&Zt.instancing===!0||le.isSkinnedMesh&&Zt.skinning===!1||!le.isSkinnedMesh&&Zt.skinning===!0||le.isInstancedMesh&&Zt.instancingColor===!0&&le.instanceColor===null||le.isInstancedMesh&&Zt.instancingColor===!1&&le.instanceColor!==null||le.isInstancedMesh&&Zt.instancingMorph===!0&&le.morphTexture===null||le.isInstancedMesh&&Zt.instancingMorph===!1&&le.morphTexture!==null||Zt.envMap!==Qt||ye.fog===!0&&Zt.fog!==$e||Zt.numClippingPlanes!==void 0&&(Zt.numClippingPlanes!==je.numPlanes||Zt.numIntersection!==je.numIntersection)||Zt.vertexAlphas!==hi||Zt.vertexTangents!==ti||Zt.morphTargets!==ii||Zt.morphNormals!==bs||Zt.morphColors!==hr||Zt.toneMapping!==Aa||Te.isWebGL2===!0&&Zt.morphTargetsCount!==Un)&&(UT=!0):(UT=!0,Zt.__version=ye.version);let up=Zt.currentProgram;UT===!0&&(up=_r(ye,ne,le));let PU=!1,Wv=!1,FT=!1;const xs=up.getUniforms(),dp=Zt.uniforms;if(Ve.useProgram(up.program)&&(PU=!0,Wv=!0,FT=!0),ye.id!==R&&(R=ye.id,Wv=!0),PU||B!==z){xs.setValue(X,"projectionMatrix",z.projectionMatrix),xs.setValue(X,"viewMatrix",z.matrixWorldInverse);const ba=xs.map.cameraPosition;ba!==void 0&&ba.setValue(X,Ue.setFromMatrixPosition(z.matrixWorld)),Te.logarithmicDepthBuffer&&xs.setValue(X,"logDepthBufFC",2/(Math.log(z.far+1)/Math.LN2)),(ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshLambertMaterial||ye.isMeshBasicMaterial||ye.isMeshStandardMaterial||ye.isShaderMaterial)&&xs.setValue(X,"isOrthographic",z.isOrthographicCamera===!0),B!==z&&(B=z,Wv=!0,FT=!0)}if(le.isSkinnedMesh){xs.setOptional(X,le,"bindMatrix"),xs.setOptional(X,le,"bindMatrixInverse");const ba=le.skeleton;ba&&(Te.floatVertexTextures?(ba.boneTexture===null&&ba.computeBoneTexture(),xs.setValue(X,"boneTexture",ba.boneTexture,ct)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}le.isBatchedMesh&&(xs.setOptional(X,le,"batchingTexture"),xs.setValue(X,"batchingTexture",le._matricesTexture,ct));const NT=me.morphAttributes;if((NT.position!==void 0||NT.normal!==void 0||NT.color!==void 0&&Te.isWebGL2===!0)&&Fe.update(le,me,up),(Wv||Zt.receiveShadow!==le.receiveShadow)&&(Zt.receiveShadow=le.receiveShadow,xs.setValue(X,"receiveShadow",le.receiveShadow)),ye.isMeshGouraudMaterial&&ye.envMap!==null&&(dp.envMap.value=Qt,dp.flipEnvMap.value=Qt.isCubeTexture&&Qt.isRenderTargetTexture===!1?-1:1),Wv&&(xs.setValue(X,"toneMappingExposure",x.toneMappingExposure),Zt.needsLights&&yo(dp,FT),$e&&ye.fog===!0&&Pe.refreshFogUniforms(dp,$e),Pe.refreshMaterialUniforms(dp,ye,F,D,Ee),fw.upload(X,Li(Zt),dp,ct)),ye.isShaderMaterial&&ye.uniformsNeedUpdate===!0&&(fw.upload(X,Li(Zt),dp,ct),ye.uniformsNeedUpdate=!1),ye.isSpriteMaterial&&xs.setValue(X,"center",le.center),xs.setValue(X,"modelViewMatrix",le.modelViewMatrix),xs.setValue(X,"normalMatrix",le.normalMatrix),xs.setValue(X,"modelMatrix",le.matrixWorld),ye.isShaderMaterial||ye.isRawShaderMaterial){const ba=ye.uniformsGroups;for(let zT=0,Fq=ba.length;zT<Fq;zT++)if(Te.isWebGL2){const BU=ba[zT];I.update(BU,up),I.bind(BU,up)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return up}function yo(z,ne){z.ambientLightColor.needsUpdate=ne,z.lightProbe.needsUpdate=ne,z.directionalLights.needsUpdate=ne,z.directionalLightShadows.needsUpdate=ne,z.pointLights.needsUpdate=ne,z.pointLightShadows.needsUpdate=ne,z.spotLights.needsUpdate=ne,z.spotLightShadows.needsUpdate=ne,z.rectAreaLights.needsUpdate=ne,z.hemisphereLights.needsUpdate=ne}function qn(z){return z.isMeshLambertMaterial||z.isMeshToonMaterial||z.isMeshPhongMaterial||z.isMeshStandardMaterial||z.isShadowMaterial||z.isShaderMaterial&&z.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(z,ne,me){nt.get(z.texture).__webglTexture=ne,nt.get(z.depthTexture).__webglTexture=me;const ye=nt.get(z);ye.__hasExternalTextures=!0,ye.__autoAllocateDepthBuffer=me===void 0,ye.__autoAllocateDepthBuffer||Ie.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ye.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(z,ne){const me=nt.get(z);me.__webglFramebuffer=ne,me.__useDefaultFramebuffer=ne===void 0},this.setRenderTarget=function(z,ne=0,me=0){M=z,w=ne,T=me;let ye=!0,le=null,$e=!1,Pt=!1;if(z){const zt=nt.get(z);zt.__useDefaultFramebuffer!==void 0?(Ve.bindFramebuffer(X.FRAMEBUFFER,null),ye=!1):zt.__webglFramebuffer===void 0?ct.setupRenderTarget(z):zt.__hasExternalTextures&&ct.rebindTextures(z,nt.get(z.texture).__webglTexture,nt.get(z.depthTexture).__webglTexture);const Qt=z.texture;(Qt.isData3DTexture||Qt.isDataArrayTexture||Qt.isCompressedArrayTexture)&&(Pt=!0);const hi=nt.get(z).__webglFramebuffer;z.isWebGLCubeRenderTarget?(Array.isArray(hi[ne])?le=hi[ne][me]:le=hi[ne],$e=!0):Te.isWebGL2&&z.samples>0&&ct.useMultisampledRTT(z)===!1?le=nt.get(z).__webglMultisampledFramebuffer:Array.isArray(hi)?le=hi[me]:le=hi,E.copy(z.viewport),P.copy(z.scissor),O=z.scissorTest}else E.copy(Z).multiplyScalar(F).floor(),P.copy(oe).multiplyScalar(F).floor(),O=we;if(Ve.bindFramebuffer(X.FRAMEBUFFER,le)&&Te.drawBuffers&&ye&&Ve.drawBuffers(z,le),Ve.viewport(E),Ve.scissor(P),Ve.setScissorTest(O),$e){const zt=nt.get(z.texture);X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_CUBE_MAP_POSITIVE_X+ne,zt.__webglTexture,me)}else if(Pt){const zt=nt.get(z.texture),Qt=ne||0;X.framebufferTextureLayer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,zt.__webglTexture,me||0,Qt)}R=-1},this.readRenderTargetPixels=function(z,ne,me,ye,le,$e,Pt){if(!(z&&z.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let zt=nt.get(z).__webglFramebuffer;if(z.isWebGLCubeRenderTarget&&Pt!==void 0&&(zt=zt[Pt]),zt){Ve.bindFramebuffer(X.FRAMEBUFFER,zt);try{const Qt=z.texture,hi=Qt.format,ti=Qt.type;if(hi!==Ti&&_t.convert(hi)!==X.getParameter(X.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ii=ti===ur&&(Ie.has("EXT_color_buffer_half_float")||Te.isWebGL2&&Ie.has("EXT_color_buffer_float"));if(ti!==cn&&_t.convert(ti)!==X.getParameter(X.IMPLEMENTATION_COLOR_READ_TYPE)&&!(ti===Hi&&(Te.isWebGL2||Ie.has("OES_texture_float")||Ie.has("WEBGL_color_buffer_float")))&&!ii){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ne>=0&&ne<=z.width-ye&&me>=0&&me<=z.height-le&&X.readPixels(ne,me,ye,le,_t.convert(hi),_t.convert(ti),$e)}finally{const Qt=M!==null?nt.get(M).__webglFramebuffer:null;Ve.bindFramebuffer(X.FRAMEBUFFER,Qt)}}},this.copyFramebufferToTexture=function(z,ne,me=0){const ye=Math.pow(2,-me),le=Math.floor(ne.image.width*ye),$e=Math.floor(ne.image.height*ye);ct.setTexture2D(ne,0),X.copyTexSubImage2D(X.TEXTURE_2D,me,0,0,z.x,z.y,le,$e),Ve.unbindTexture()},this.copyTextureToTexture=function(z,ne,me,ye=0){const le=ne.image.width,$e=ne.image.height,Pt=_t.convert(me.format),zt=_t.convert(me.type);ct.setTexture2D(me,0),X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,me.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,me.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,me.unpackAlignment),ne.isDataTexture?X.texSubImage2D(X.TEXTURE_2D,ye,z.x,z.y,le,$e,Pt,zt,ne.image.data):ne.isCompressedTexture?X.compressedTexSubImage2D(X.TEXTURE_2D,ye,z.x,z.y,ne.mipmaps[0].width,ne.mipmaps[0].height,Pt,ne.mipmaps[0].data):X.texSubImage2D(X.TEXTURE_2D,ye,z.x,z.y,Pt,zt,ne.image),ye===0&&me.generateMipmaps&&X.generateMipmap(X.TEXTURE_2D),Ve.unbindTexture()},this.copyTextureToTexture3D=function(z,ne,me,ye,le=0){if(x.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const $e=Math.round(z.max.x-z.min.x),Pt=Math.round(z.max.y-z.min.y),zt=z.max.z-z.min.z+1,Qt=_t.convert(ye.format),hi=_t.convert(ye.type);let ti;if(ye.isData3DTexture)ct.setTexture3D(ye,0),ti=X.TEXTURE_3D;else if(ye.isDataArrayTexture||ye.isCompressedArrayTexture)ct.setTexture2DArray(ye,0),ti=X.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,ye.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ye.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,ye.unpackAlignment);const ii=X.getParameter(X.UNPACK_ROW_LENGTH),bs=X.getParameter(X.UNPACK_IMAGE_HEIGHT),hr=X.getParameter(X.UNPACK_SKIP_PIXELS),Aa=X.getParameter(X.UNPACK_SKIP_ROWS),Jc=X.getParameter(X.UNPACK_SKIP_IMAGES),Un=me.isCompressedTexture?me.mipmaps[le]:me.image;X.pixelStorei(X.UNPACK_ROW_LENGTH,Un.width),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,Un.height),X.pixelStorei(X.UNPACK_SKIP_PIXELS,z.min.x),X.pixelStorei(X.UNPACK_SKIP_ROWS,z.min.y),X.pixelStorei(X.UNPACK_SKIP_IMAGES,z.min.z),me.isDataTexture||me.isData3DTexture?X.texSubImage3D(ti,le,ne.x,ne.y,ne.z,$e,Pt,zt,Qt,hi,Un.data):ye.isCompressedArrayTexture?X.compressedTexSubImage3D(ti,le,ne.x,ne.y,ne.z,$e,Pt,zt,Qt,Un.data):X.texSubImage3D(ti,le,ne.x,ne.y,ne.z,$e,Pt,zt,Qt,hi,Un),X.pixelStorei(X.UNPACK_ROW_LENGTH,ii),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,bs),X.pixelStorei(X.UNPACK_SKIP_PIXELS,hr),X.pixelStorei(X.UNPACK_SKIP_ROWS,Aa),X.pixelStorei(X.UNPACK_SKIP_IMAGES,Jc),le===0&&ye.generateMipmaps&&X.generateMipmap(ti),Ve.unbindTexture()},this.initTexture=function(z){z.isCubeTexture?ct.setTextureCube(z,0):z.isData3DTexture?ct.setTexture3D(z,0):z.isDataArrayTexture||z.isCompressedArrayTexture?ct.setTexture2DArray(z,0):ct.setTexture2D(z,0),Ve.unbindTexture()},this.resetState=function(){w=0,T=0,M=null,Ve.reset(),ut.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ql}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorSpace=e===N_?"display-p3":"srgb",i.unpackColorSpace=xi.workingColorSpace===iy?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===gt?II:oF}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===II?gt:Ii}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class TN extends lh{}TN.prototype.isWebGL1Renderer=!0;class xT{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new be(e),this.density=i}clone(){return new xT(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}let mw=class Oq{constructor(e,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new be(e),this.near=i,this.far=r}clone(){return new Oq(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}};class Er extends ve{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ri,this.environmentRotation=new ri,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),i.object.environmentRotation=this.environmentRotation.toArray(),i}}let yy=class{constructor(n,e){this.isInterleavedBuffer=!0,this.array=n,this.stride=e,this.count=n!==void 0?n.length/e:0,this.usage=oy,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=No()}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}get updateRange(){return BF("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(n){return this.usage=n,this}addUpdateRange(n,e){this.updateRanges.push({start:n,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(n){return this.array=new n.array.constructor(n.array),this.count=n.count,this.stride=n.stride,this.usage=n.usage,this}copyAt(n,e,i){n*=this.stride,i*=e.stride;for(let r=0,s=this.stride;r<s;r++)this.array[n+r]=e.array[i+r];return this}set(n,e=0){return this.array.set(n,e),this}clone(n){n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=No()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(n.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(n){return this.onUploadCallback=n,this}toJSON(n){return n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=No()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const Zs=new S;let Go=class Dq{constructor(e,i,r,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=r,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,r=this.data.count;i<r;i++)Zs.fromBufferAttribute(this,i),Zs.applyMatrix4(e),this.setXYZ(i,Zs.x,Zs.y,Zs.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)Zs.fromBufferAttribute(this,i),Zs.applyNormalMatrix(e),this.setXYZ(i,Zs.x,Zs.y,Zs.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)Zs.fromBufferAttribute(this,i),Zs.transformDirection(e),this.setXYZ(i,Zs.x,Zs.y,Zs.z);return this}getComponent(e,i){let r=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(r=Ys(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=Xt(r,this.array)),this.data.array[e*this.data.stride+this.offset+i]=r,this}setX(e,i){return this.normalized&&(i=Xt(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=Xt(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=Xt(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=Xt(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=Ys(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=Ys(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=Ys(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=Ys(i,this.array)),i}setXY(e,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=Xt(i,this.array),r=Xt(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this}setXYZ(e,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=Xt(i,this.array),r=Xt(r,this.array),s=Xt(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=s,this}setXYZW(e,i,r,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=Xt(i,this.array),r=Xt(r,this.array),s=Xt(s,this.array),o=Xt(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return new Ye(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Dq(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};class gw extends Ut{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new be(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let rg;const Ay=new S,sg=new S,og=new S,ag=new J,by=new J,IN=new he,vw=new S,xy=new S,yw=new S,RN=new J,mR=new J,PN=new J;let gR=class extends ve{constructor(n=new gw){if(super(),this.isSprite=!0,this.type="Sprite",rg===void 0){rg=new dt;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new yy(e,5);rg.setIndex([0,1,2,0,2,3]),rg.setAttribute("position",new Go(i,3,0,!1)),rg.setAttribute("uv",new Go(i,2,3,!1))}this.geometry=rg,this.material=n,this.center=new J(.5,.5)}raycast(n,e){n.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),sg.setFromMatrixScale(this.matrixWorld),IN.copy(n.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n.camera.matrixWorldInverse,this.matrixWorld),og.setFromMatrixPosition(this.modelViewMatrix),n.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&sg.multiplyScalar(-og.z);const i=this.material.rotation;let r,s;i!==0&&(s=Math.cos(i),r=Math.sin(i));const o=this.center;Aw(vw.set(-.5,-.5,0),og,o,sg,r,s),Aw(xy.set(.5,-.5,0),og,o,sg,r,s),Aw(yw.set(.5,.5,0),og,o,sg,r,s),RN.set(0,0),mR.set(1,0),PN.set(1,1);let a=n.ray.intersectTriangle(vw,xy,yw,!1,Ay);if(a===null&&(Aw(xy.set(-.5,.5,0),og,o,sg,r,s),mR.set(0,1),a=n.ray.intersectTriangle(vw,yw,xy,!1,Ay),a===null))return;const l=n.ray.origin.distanceTo(Ay);l<n.near||l>n.far||e.push({distance:l,point:Ay.clone(),uv:Xr.getInterpolation(Ay,vw,xy,yw,RN,mR,PN,new J),face:null,object:this})}copy(n,e){return super.copy(n,e),n.center!==void 0&&this.center.copy(n.center),this.material=n.material,this}};function Aw(n,e,i,r,s,o){ag.subVectors(n,i).addScalar(.5).multiply(r),s!==void 0?(by.x=o*ag.x-s*ag.y,by.y=s*ag.x+o*ag.y):by.copy(ag),n.copy(e),n.x+=by.x,n.y+=by.y,n.applyMatrix4(IN)}const bw=new S,BN=new S;let vR=class extends ve{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(n){super.copy(n,!1);const e=n.levels;for(let i=0,r=e.length;i<r;i++){const s=e[i];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=n.autoUpdate,this}addLevel(n,e=0,i=0){e=Math.abs(e);const r=this.levels;let s;for(s=0;s<r.length&&!(e<r[s].distance);s++);return r.splice(s,0,{distance:e,hysteresis:i,object:n}),this.add(n),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(n){const e=this.levels;if(e.length>0){let i,r;for(i=1,r=e.length;i<r;i++){let s=e[i].distance;if(e[i].object.visible&&(s-=s*e[i].hysteresis),n<s)break}return e[i-1].object}return null}raycast(n,e){if(this.levels.length>0){bw.setFromMatrixPosition(this.matrixWorld);const i=n.ray.origin.distanceTo(bw);this.getObjectForDistance(i).raycast(n,e)}}update(n){const e=this.levels;if(e.length>1){bw.setFromMatrixPosition(n.matrixWorld),BN.setFromMatrixPosition(this.matrixWorld);const i=bw.distanceTo(BN)/n.zoom;e[0].object.visible=!0;let r,s;for(r=1,s=e.length;r<s;r++){let o=e[r].distance;if(e[r].object.visible&&(o-=o*e[r].hysteresis),i>=o)e[r-1].object.visible=!1,e[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)e[r].object.visible=!1}}toJSON(n){const e=super.toJSON(n);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let r=0,s=i.length;r<s;r++){const o=i[r];e.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return e}};const kN=new S,ON=new qe,DN=new qe,Cee=new S,LN=new he,xw=new S,yR=new Zi,UN=new he,AR=new Js;let wo=class extends pe{constructor(n,e){super(n,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=JT,this.bindMatrix=new he,this.bindMatrixInverse=new he,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const n=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ht),this.boundingBox.makeEmpty();const e=n.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,xw),this.boundingBox.expandByPoint(xw)}computeBoundingSphere(){const n=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Zi),this.boundingSphere.makeEmpty();const e=n.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,xw),this.boundingSphere.expandByPoint(xw)}copy(n,e){return super.copy(n,e),this.bindMode=n.bindMode,this.bindMatrix.copy(n.bindMatrix),this.bindMatrixInverse.copy(n.bindMatrixInverse),this.skeleton=n.skeleton,n.boundingBox!==null&&(this.boundingBox=n.boundingBox.clone()),n.boundingSphere!==null&&(this.boundingSphere=n.boundingSphere.clone()),this}raycast(n,e){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),yR.copy(this.boundingSphere),yR.applyMatrix4(r),n.ray.intersectsSphere(yR)!==!1&&(UN.copy(r).invert(),AR.copy(n.ray).applyMatrix4(UN),!(this.boundingBox!==null&&AR.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(n,e,AR)))}getVertexPosition(n,e){return super.getVertexPosition(n,e),this.applyBoneTransform(n,e),e}bind(n,e){this.skeleton=n,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new qe,e=this.geometry.attributes.skinWeight;for(let i=0,r=e.count;i<r;i++){n.fromBufferAttribute(e,i);const s=1/n.manhattanLength();s!==1/0?n.multiplyScalar(s):n.set(1,0,0,0),e.setXYZW(i,n.x,n.y,n.z,n.w)}}updateMatrixWorld(n){super.updateMatrixWorld(n),this.bindMode===JT?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===eF?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(n,e){const i=this.skeleton,r=this.geometry;ON.fromBufferAttribute(r.attributes.skinIndex,n),DN.fromBufferAttribute(r.attributes.skinWeight,n),kN.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let s=0;s<4;s++){const o=DN.getComponent(s);if(o!==0){const a=ON.getComponent(s);LN.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),e.addScaledVector(Cee.copy(kN).applyMatrix4(LN),o)}}return e.applyMatrix4(this.bindMatrixInverse)}},Dp=class extends ve{constructor(){super(),this.isBone=!0,this.type="Bone"}},Ms=class extends Gt{constructor(n=null,e=1,i=1,r,s,o,a,l,c=Rt,h=Rt,u,d){super(null,o,a,l,c,h,r,s,u,d),this.isDataTexture=!0,this.image={data:n,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const FN=new he,Eee=new he;let _y=class Lq{constructor(e=[],i=[]){this.uuid=No(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,s=this.bones.length;r<s;r++)this.boneInverses.push(new he)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const r=new he;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,i=this.boneInverses,r=this.boneMatrices,s=this.boneTexture;for(let o=0,a=e.length;o<a;o++){const l=e[o]?e[o].matrixWorld:Eee;FN.multiplyMatrices(l,i[o]),FN.toArray(r,o*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new Lq(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const r=new Ms(i,e,e,Ti,Hi);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this}getBoneByName(e){for(let i=0,r=this.bones.length;i<r;i++){const s=this.bones[i];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let r=0,s=e.bones.length;r<s;r++){const o=e.bones[r];let a=i[o];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),a=new Dp),this.bones.push(a),this.boneInverses.push(new he().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let s=0,o=i.length;s<o;s++){const a=i[s];e.bones.push(a.uuid);const l=r[s];e.boneInverses.push(l.toArray())}return e}},So=class extends Ye{constructor(n,e,i,r=1){super(n,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}toJSON(){const n=super.toJSON();return n.meshPerAttribute=this.meshPerAttribute,n.isInstancedBufferAttribute=!0,n}};const lg=new he,NN=new he,_w=[],zN=new Ht,Mee=new he,wy=new pe,Sy=new Zi;let bR=class extends pe{constructor(n,e,i){super(n,e),this.isInstancedMesh=!0,this.instanceMatrix=new So(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,Mee)}computeBoundingBox(){const n=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new Ht),n.boundingBox===null&&n.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,lg),zN.copy(n.boundingBox).applyMatrix4(lg),this.boundingBox.union(zN)}computeBoundingSphere(){const n=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Zi),n.boundingSphere===null&&n.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,lg),Sy.copy(n.boundingSphere).applyMatrix4(lg),this.boundingSphere.union(Sy)}copy(n,e){return super.copy(n,e),this.instanceMatrix.copy(n.instanceMatrix),n.instanceColor!==null&&(this.instanceColor=n.instanceColor.clone()),this.count=n.count,n.boundingBox!==null&&(this.boundingBox=n.boundingBox.clone()),n.boundingSphere!==null&&(this.boundingSphere=n.boundingSphere.clone()),this}getColorAt(n,e){e.fromArray(this.instanceColor.array,n*3)}getMatrixAt(n,e){e.fromArray(this.instanceMatrix.array,n*16)}getMorphAt(n,e){const i=e.morphTargetInfluences,r=this.morphTexture.source.data.data,s=i.length+1,o=n*s+1;for(let a=0;a<i.length;a++)i[a]=r[o+a]}raycast(n,e){const i=this.matrixWorld,r=this.count;if(wy.geometry=this.geometry,wy.material=this.material,wy.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Sy.copy(this.boundingSphere),Sy.applyMatrix4(i),n.ray.intersectsSphere(Sy)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,lg),NN.multiplyMatrices(i,lg),wy.matrixWorld=NN,wy.raycast(n,_w);for(let o=0,a=_w.length;o<a;o++){const l=_w[o];l.instanceId=s,l.object=this,e.push(l)}_w.length=0}}setColorAt(n,e){this.instanceColor===null&&(this.instanceColor=new So(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,n*3)}setMatrixAt(n,e){e.toArray(this.instanceMatrix.array,n*16)}setMorphAt(n,e){const i=e.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new Ms(new Float32Array(r*this.count),r,this.count,xp,Hi));const s=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=r*n;s[l]=a,s.set(i,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};function Tee(n,e){return n.z-e.z}function Iee(n,e){return e.z-n.z}class Ree{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i){const r=this.pool,s=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1});const o=r[this.index];s.push(o),this.index++,o.start=e.start,o.count=e.count,o.z=i}reset(){this.list.length=0,this.index=0}}const cg="batchId",Tu=new he,jN=new he,Pee=new he,GN=new he,xR=new Rp,ww=new Ht,Lp=new Zi,Cy=new S,_R=new Ree,Ts=new pe,Sw=[];function Bee(n,e,i=0){const r=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const s=n.count;for(let o=0;o<s;o++)for(let a=0;a<r;a++)e.setComponent(o+i,a,n.getComponent(o,a))}else e.array.set(n.array,i*r);e.needsUpdate=!0}class Cw extends pe{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,i,r=i*2,s){super(new dt,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=i,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4),r=new Ms(i,e,e,Ti,Hi);this._matricesTexture=r}_initializeGeometry(e){const i=this.geometry,r=this._maxVertexCount,s=this._maxGeometryCount,o=this._maxIndexCount;if(this._geometryInitialized===!1){for(const l in e.attributes){const c=e.getAttribute(l),{array:h,itemSize:u,normalized:d}=c,f=new h.constructor(r*u),m=new Ye(f,u,d);i.setAttribute(l,m)}if(e.getIndex()!==null){const l=r>65536?new Uint32Array(o):new Uint16Array(o);i.setIndex(new Ye(l,1))}const a=s>65536?new Uint32Array(r):new Uint16Array(r);i.setAttribute(cg,new Ye(a,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(cg))throw new Error(`BatchedMesh: Geometry cannot use attribute "${cg}"`);const i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in i.attributes){if(r===cg)continue;if(!e.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const s=e.getAttribute(r),o=i.getAttribute(r);if(s.itemSize!==o.itemSize||s.normalized!==o.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ht);const e=this._geometryCount,i=this.boundingBox,r=this._active;i.makeEmpty();for(let s=0;s<e;s++)r[s]!==!1&&(this.getMatrixAt(s,Tu),this.getBoundingBoxAt(s,ww).applyMatrix4(Tu),i.union(ww))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zi);const e=this._geometryCount,i=this.boundingSphere,r=this._active;i.makeEmpty();for(let s=0;s<e;s++)r[s]!==!1&&(this.getMatrixAt(s,Tu),this.getBoundingSphereAt(s,Lp).applyMatrix4(Tu),i.union(Lp))}addGeometry(e,i=-1,r=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const s={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let o=null;const a=this._reservedRanges,l=this._drawRanges,c=this._bounds;this._geometryCount!==0&&(o=a[a.length-1]),i===-1?s.vertexCount=e.getAttribute("position").count:s.vertexCount=i,o===null?s.vertexStart=0:s.vertexStart=o.vertexStart+o.vertexCount;const h=e.getIndex(),u=h!==null;if(u&&(r===-1?s.indexCount=h.count:s.indexCount=r,o===null?s.indexStart=0:s.indexStart=o.indexStart+o.indexCount),s.indexStart!==-1&&s.indexStart+s.indexCount>this._maxIndexCount||s.vertexStart+s.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const d=this._visibility,f=this._active,m=this._matricesTexture,g=this._matricesTexture.image.data;d.push(!0),f.push(!0);const v=this._geometryCount;this._geometryCount++,Pee.toArray(g,v*16),m.needsUpdate=!0,a.push(s),l.push({start:u?s.indexStart:s.vertexStart,count:-1}),c.push({boxInitialized:!1,box:new Ht,sphereInitialized:!1,sphere:new Zi});const y=this.geometry.getAttribute(cg);for(let A=0;A<s.vertexCount;A++)y.setX(s.vertexStart+A,v);return y.needsUpdate=!0,this.setGeometryAt(v,e),v}setGeometryAt(e,i){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const r=this.geometry,s=r.getIndex()!==null,o=r.getIndex(),a=i.getIndex(),l=this._reservedRanges[e];if(s&&a.count>l.indexCount||i.attributes.position.count>l.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const c=l.vertexStart,h=l.vertexCount;for(const m in r.attributes){if(m===cg)continue;const g=i.getAttribute(m),v=r.getAttribute(m);Bee(g,v,c);const y=g.itemSize;for(let A=g.count,b=h;A<b;A++){const x=c+A;for(let _=0;_<y;_++)v.setComponent(x,_,0)}v.needsUpdate=!0,v.addUpdateRange(c*y,h*y)}if(s){const m=l.indexStart;for(let g=0;g<a.count;g++)o.setX(m+g,c+a.getX(g));for(let g=a.count,v=l.indexCount;g<v;g++)o.setX(m+g,c);o.needsUpdate=!0,o.addUpdateRange(m,l.indexCount)}const u=this._bounds[e];i.boundingBox!==null?(u.box.copy(i.boundingBox),u.boxInitialized=!0):u.boxInitialized=!1,i.boundingSphere!==null?(u.sphere.copy(i.boundingSphere),u.sphereInitialized=!0):u.sphereInitialized=!1;const d=this._drawRanges[e],f=i.getAttribute("position");return d.count=s?a.count:f.count,this._visibilityChanged=!0,e}deleteGeometry(e){const i=this._active;return e>=i.length||i[e]===!1?this:(i[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,i){if(this._active[e]===!1)return null;const r=this._bounds[e],s=r.box,o=this.geometry;if(r.boxInitialized===!1){s.makeEmpty();const a=o.index,l=o.attributes.position,c=this._drawRanges[e];for(let h=c.start,u=c.start+c.count;h<u;h++){let d=h;a&&(d=a.getX(d)),s.expandByPoint(Cy.fromBufferAttribute(l,d))}r.boxInitialized=!0}return i.copy(s),i}getBoundingSphereAt(e,i){if(this._active[e]===!1)return null;const r=this._bounds[e],s=r.sphere,o=this.geometry;if(r.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(e,ww),ww.getCenter(s.center);const a=o.index,l=o.attributes.position,c=this._drawRanges[e];let h=0;for(let u=c.start,d=c.start+c.count;u<d;u++){let f=u;a&&(f=a.getX(f)),Cy.fromBufferAttribute(l,f),h=Math.max(h,s.center.distanceToSquared(Cy))}s.radius=Math.sqrt(h),r.sphereInitialized=!0}return i.copy(s),i}setMatrixAt(e,i){const r=this._active,s=this._matricesTexture,o=this._matricesTexture.image.data,a=this._geometryCount;return e>=a||r[e]===!1?this:(i.toArray(o,e*16),s.needsUpdate=!0,this)}getMatrixAt(e,i){const r=this._active,s=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||r[e]===!1?null:i.fromArray(s,e*16)}setVisibleAt(e,i){const r=this._visibility,s=this._active,o=this._geometryCount;return e>=o||s[e]===!1||r[e]===i?this:(r[e]=i,this._visibilityChanged=!0,this)}getVisibleAt(e){const i=this._visibility,r=this._active,s=this._geometryCount;return e>=s||r[e]===!1?!1:i[e]}raycast(e,i){const r=this._visibility,s=this._active,o=this._drawRanges,a=this._geometryCount,l=this.matrixWorld,c=this.geometry;Ts.material=this.material,Ts.geometry.index=c.index,Ts.geometry.attributes=c.attributes,Ts.geometry.boundingBox===null&&(Ts.geometry.boundingBox=new Ht),Ts.geometry.boundingSphere===null&&(Ts.geometry.boundingSphere=new Zi);for(let h=0;h<a;h++){if(!r[h]||!s[h])continue;const u=o[h];Ts.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(h,Ts.matrixWorld).premultiply(l),this.getBoundingBoxAt(h,Ts.geometry.boundingBox),this.getBoundingSphereAt(h,Ts.geometry.boundingSphere),Ts.raycast(e,Sw);for(let d=0,f=Sw.length;d<f;d++){const m=Sw[d];m.object=this,m.batchId=h,i.push(m)}Sw.length=0}Ts.material=null,Ts.geometry.index=null,Ts.geometry.attributes={},Ts.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(i=>({...i})),this._reservedRanges=e._reservedRanges.map(i=>({...i})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(i=>({boxInitialized:i.boxInitialized,box:i.box.clone(),sphereInitialized:i.sphereInitialized,sphere:i.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,i,r,s,o){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=s.getIndex(),l=a===null?1:a.array.BYTES_PER_ELEMENT,c=this._active,h=this._visibility,u=this._multiDrawStarts,d=this._multiDrawCounts,f=this._drawRanges,m=this.perObjectFrustumCulled;m&&(GN.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),xR.setFromProjectionMatrix(GN,e.coordinateSystem));let g=0;if(this.sortObjects){jN.copy(this.matrixWorld).invert(),Cy.setFromMatrixPosition(r.matrixWorld).applyMatrix4(jN);for(let A=0,b=h.length;A<b;A++)if(h[A]&&c[A]){this.getMatrixAt(A,Tu),this.getBoundingSphereAt(A,Lp).applyMatrix4(Tu);let x=!1;if(m&&(x=!xR.intersectsSphere(Lp)),!x){const _=Cy.distanceTo(Lp.center);_R.push(f[A],_)}}const v=_R.list,y=this.customSort;y===null?v.sort(o.transparent?Iee:Tee):y.call(this,v,r);for(let A=0,b=v.length;A<b;A++){const x=v[A];u[g]=x.start*l,d[g]=x.count,g++}_R.reset()}else for(let v=0,y=h.length;v<y;v++)if(h[v]&&c[v]){let A=!1;if(m&&(this.getMatrixAt(v,Tu),this.getBoundingSphereAt(v,Lp).applyMatrix4(Tu),A=!xR.intersectsSphere(Lp)),!A){const b=f[v];u[g]=b.start*l,d[g]=b.count,g++}}this._multiDrawCount=g,this._visibilityChanged=!1}onBeforeShadow(e,i,r,s,o,a){this.onBeforeRender(e,null,s,o,a)}}let zi=class extends Ut{constructor(n){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new be(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.linewidth=n.linewidth,this.linecap=n.linecap,this.linejoin=n.linejoin,this.fog=n.fog,this}};const HN=new S,VN=new S,QN=new he,wR=new Js,Ew=new Zi;let hn=class extends ve{constructor(n=new dt,e=new zi){super(),this.isLine=!0,this.type="Line",this.geometry=n,this.material=e,this.updateMorphTargets()}copy(n,e){return super.copy(n,e),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}computeLineDistances(){const n=this.geometry;if(n.index===null){const e=n.attributes.position,i=[0];for(let r=1,s=e.count;r<s;r++)HN.fromBufferAttribute(e,r-1),VN.fromBufferAttribute(e,r),i[r]=i[r-1],i[r]+=HN.distanceTo(VN);n.setAttribute("lineDistance",new rt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(n,e){const i=this.geometry,r=this.matrixWorld,s=n.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Ew.copy(i.boundingSphere),Ew.applyMatrix4(r),Ew.radius+=s,n.ray.intersectsSphere(Ew)===!1)return;QN.copy(r).invert(),wR.copy(n.ray).applyMatrix4(QN);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new S,h=new S,u=new S,d=new S,f=this.isLineSegments?2:1,m=i.index,g=i.attributes.position;if(m!==null){const v=Math.max(0,o.start),y=Math.min(m.count,o.start+o.count);for(let A=v,b=y-1;A<b;A+=f){const x=m.getX(A),_=m.getX(A+1);if(c.fromBufferAttribute(g,x),h.fromBufferAttribute(g,_),wR.distanceSqToSegment(c,h,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const w=n.ray.origin.distanceTo(d);w<n.near||w>n.far||e.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this})}}else{const v=Math.max(0,o.start),y=Math.min(g.count,o.start+o.count);for(let A=v,b=y-1;A<b;A+=f){if(c.fromBufferAttribute(g,A),h.fromBufferAttribute(g,A+1),wR.distanceSqToSegment(c,h,d,u)>l)continue;d.applyMatrix4(this.matrixWorld);const x=n.ray.origin.distanceTo(d);x<n.near||x>n.far||e.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const n=this.geometry.morphAttributes,e=Object.keys(n);if(e.length>0){const i=n[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){const o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}};const WN=new S,XN=new S;let Is=class extends hn{constructor(n,e){super(n,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const n=this.geometry;if(n.index===null){const e=n.attributes.position,i=[];for(let r=0,s=e.count;r<s;r+=2)WN.fromBufferAttribute(e,r),XN.fromBufferAttribute(e,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+WN.distanceTo(XN);n.setAttribute("lineDistance",new rt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},SR=class extends hn{constructor(n,e){super(n,e),this.isLineLoop=!0,this.type="LineLoop"}},Iu=class extends Ut{constructor(n){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new be(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.size=n.size,this.sizeAttenuation=n.sizeAttenuation,this.fog=n.fog,this}};const qN=new he,CR=new Js,Mw=new Zi,Tw=new S;let hg=class extends ve{constructor(n=new dt,e=new Iu){super(),this.isPoints=!0,this.type="Points",this.geometry=n,this.material=e,this.updateMorphTargets()}copy(n,e){return super.copy(n,e),this.material=Array.isArray(n.material)?n.material.slice():n.material,this.geometry=n.geometry,this}raycast(n,e){const i=this.geometry,r=this.matrixWorld,s=n.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Mw.copy(i.boundingSphere),Mw.applyMatrix4(r),Mw.radius+=s,n.ray.intersectsSphere(Mw)===!1)return;qN.copy(r).invert(),CR.copy(n.ray).applyMatrix4(qN);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,h=i.attributes.position;if(c!==null){const u=Math.max(0,o.start),d=Math.min(c.count,o.start+o.count);for(let f=u,m=d;f<m;f++){const g=c.getX(f);Tw.fromBufferAttribute(h,g),YN(Tw,g,l,r,n,e,this)}}else{const u=Math.max(0,o.start),d=Math.min(h.count,o.start+o.count);for(let f=u,m=d;f<m;f++)Tw.fromBufferAttribute(h,f),YN(Tw,f,l,r,n,e,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,e=Object.keys(n);if(e.length>0){const i=n[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){const o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}};function YN(n,e,i,r,s,o,a){const l=CR.distanceSqToPoint(n);if(l<i){const c=new S;CR.closestPointToPoint(n,c),c.applyMatrix4(r);const h=s.ray.origin.distanceTo(c);if(h<s.near||h>s.far)return;o.push({distance:h,distanceToRay:Math.sqrt(l),point:c,index:e,face:null,object:a})}}class JN extends Gt{constructor(e,i,r,s,o,a,l,c,h){super(e,i,r,s,o,a,l,c,h),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Dt,this.magFilter=o!==void 0?o:Dt,this.generateMipmaps=!1;const u=this;function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class kee extends Gt{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=Rt,this.minFilter=Rt,this.generateMipmaps=!1,this.needsUpdate=!0}}let Ru=class extends Gt{constructor(n,e,i,r,s,o,a,l,c,h,u,d){super(null,o,a,l,c,h,r,s,u,d),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=n,this.flipY=!1,this.generateMipmaps=!1}},Oee=class extends Ru{constructor(n,e,i,r,s,o){super(n,e,i,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Yn}},Dee=class extends Ru{constructor(n,e,i){super(void 0,n[0].width,n[0].height,e,i,Zc),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=n}};class ER extends Gt{constructor(e,i,r,s,o,a,l,c,h){super(e,i,r,s,o,a,l,c,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class wa{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){const r=this.getUtoTmapping(e);return this.getPoint(r,i)}getPoints(e=5){const i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return i}getSpacedPoints(e=5){const i=[];for(let r=0;r<=e;r++)i.push(this.getPointAt(r/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,s=this.getPoint(0),o=0;i.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),o+=r.distanceTo(s),i.push(o),s=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){const r=this.getLengths();let s=0;const o=r.length;let a;i?a=i:a=e*r[o-1];let l=0,c=o-1,h;for(;l<=c;)if(s=Math.floor(l+(c-l)/2),h=r[s]-a,h<0)l=s+1;else if(h>0)c=s-1;else{c=s;break}if(s=c,r[s]===a)return s/(o-1);const u=r[s],d=r[s+1]-u,f=(a-u)/d;return(s+f)/(o-1)}getTangent(e,i){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=i||(o.isVector2?new J:new S);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,i){const r=this.getUtoTmapping(e);return this.getTangent(r,i)}computeFrenetFrames(e,i){const r=new S,s=[],o=[],a=[],l=new S,c=new he;for(let m=0;m<=e;m++){const g=m/e;s[m]=this.getTangentAt(g,new S)}o[0]=new S,a[0]=new S;let h=Number.MAX_VALUE;const u=Math.abs(s[0].x),d=Math.abs(s[0].y),f=Math.abs(s[0].z);u<=h&&(h=u,r.set(1,0,0)),d<=h&&(h=d,r.set(0,1,0)),f<=h&&r.set(0,0,1),l.crossVectors(s[0],r).normalize(),o[0].crossVectors(s[0],l),a[0].crossVectors(s[0],o[0]);for(let m=1;m<=e;m++){if(o[m]=o[m-1].clone(),a[m]=a[m-1].clone(),l.crossVectors(s[m-1],s[m]),l.length()>Number.EPSILON){l.normalize();const g=Math.acos(In(s[m-1].dot(s[m]),-1,1));o[m].applyMatrix4(c.makeRotationAxis(l,g))}a[m].crossVectors(s[m],o[m])}if(i===!0){let m=Math.acos(In(o[0].dot(o[e]),-1,1));m/=e,s[0].dot(l.crossVectors(o[0],o[e]))>0&&(m=-m);for(let g=1;g<=e;g++)o[g].applyMatrix4(c.makeRotationAxis(s[g],m*g)),a[g].crossVectors(s[g],o[g])}return{tangents:s,normals:o,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Iw extends wa{constructor(e=0,i=0,r=1,s=1,o=0,a=Math.PI*2,l=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=r,this.yRadius=s,this.aStartAngle=o,this.aEndAngle=a,this.aClockwise=l,this.aRotation=c}getPoint(e,i=new J){const r=i,s=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const a=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=s;for(;o>s;)o-=s;o<Number.EPSILON&&(a?o=0:o=s),this.aClockwise===!0&&!a&&(o===s?o=-s:o=o-s);const l=this.aStartAngle+e*o;let c=this.aX+this.xRadius*Math.cos(l),h=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){const u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=c-this.aX,m=h-this.aY;c=f*u-m*d+this.aX,h=f*d+m*u+this.aY}return r.set(c,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class KN extends Iw{constructor(e,i,r,s,o,a){super(e,i,r,r,s,o,a),this.isArcCurve=!0,this.type="ArcCurve"}}function MR(){let n=0,e=0,i=0,r=0;function s(o,a,l,c){n=o,e=l,i=-3*o+3*a-2*l-c,r=2*o-2*a+l+c}return{initCatmullRom:function(o,a,l,c,h){s(a,l,h*(l-o),h*(c-a))},initNonuniformCatmullRom:function(o,a,l,c,h,u,d){let f=(a-o)/h-(l-o)/(h+u)+(l-a)/u,m=(l-a)/u-(c-a)/(u+d)+(c-l)/d;f*=u,m*=u,s(a,l,f,m)},calc:function(o){const a=o*o,l=a*o;return n+e*o+i*a+r*l}}}const Rw=new S,TR=new MR,IR=new MR,RR=new MR;class ZN extends wa{constructor(e=[],i=!1,r="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=r,this.tension=s}getPoint(e,i=new S){const r=i,s=this.points,o=s.length,a=(o-(this.closed?0:1))*e;let l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/o)+1)*o:c===0&&l===o-1&&(l=o-2,c=1);let h,u;this.closed||l>0?h=s[(l-1)%o]:(Rw.subVectors(s[0],s[1]).add(s[0]),h=Rw);const d=s[l%o],f=s[(l+1)%o];if(this.closed||l+2<o?u=s[(l+2)%o]:(Rw.subVectors(s[o-1],s[o-2]).add(s[o-1]),u=Rw),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let g=Math.pow(h.distanceToSquared(d),m),v=Math.pow(d.distanceToSquared(f),m),y=Math.pow(f.distanceToSquared(u),m);v<1e-4&&(v=1),g<1e-4&&(g=v),y<1e-4&&(y=v),TR.initNonuniformCatmullRom(h.x,d.x,f.x,u.x,g,v,y),IR.initNonuniformCatmullRom(h.y,d.y,f.y,u.y,g,v,y),RR.initNonuniformCatmullRom(h.z,d.z,f.z,u.z,g,v,y)}else this.curveType==="catmullrom"&&(TR.initCatmullRom(h.x,d.x,f.x,u.x,this.tension),IR.initCatmullRom(h.y,d.y,f.y,u.y,this.tension),RR.initCatmullRom(h.z,d.z,f.z,u.z,this.tension));return r.set(TR.calc(c),IR.calc(c),RR.calc(c)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const s=e.points[i];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){const s=this.points[i];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const s=e.points[i];this.points.push(new S().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function $N(n,e,i,r,s){const o=(r-e)*.5,a=(s-i)*.5,l=n*n,c=n*l;return(2*i-2*r+o+a)*c+(-3*i+3*r-2*o-a)*l+o*n+i}function Lee(n,e){const i=1-n;return i*i*e}function Uee(n,e){return 2*(1-n)*n*e}function Fee(n,e){return n*n*e}function Ey(n,e,i,r){return Lee(n,e)+Uee(n,i)+Fee(n,r)}function Nee(n,e){const i=1-n;return i*i*i*e}function zee(n,e){const i=1-n;return 3*i*i*n*e}function jee(n,e){return 3*(1-n)*n*n*e}function Gee(n,e){return n*n*n*e}function My(n,e,i,r,s){return Nee(n,e)+zee(n,i)+jee(n,r)+Gee(n,s)}class PR extends wa{constructor(e=new J,i=new J,r=new J,s=new J){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=r,this.v3=s}getPoint(e,i=new J){const r=i,s=this.v0,o=this.v1,a=this.v2,l=this.v3;return r.set(My(e,s.x,o.x,a.x,l.x),My(e,s.y,o.y,a.y,l.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class ez extends wa{constructor(e=new S,i=new S,r=new S,s=new S){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=r,this.v3=s}getPoint(e,i=new S){const r=i,s=this.v0,o=this.v1,a=this.v2,l=this.v3;return r.set(My(e,s.x,o.x,a.x,l.x),My(e,s.y,o.y,a.y,l.y),My(e,s.z,o.z,a.z,l.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class BR extends wa{constructor(e=new J,i=new J){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new J){const r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new J){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class tz extends wa{constructor(e=new S,i=new S){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new S){const r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new S){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class kR extends wa{constructor(e=new J,i=new J,r=new J){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new J){const r=i,s=this.v0,o=this.v1,a=this.v2;return r.set(Ey(e,s.x,o.x,a.x),Ey(e,s.y,o.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class OR extends wa{constructor(e=new S,i=new S,r=new S){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new S){const r=i,s=this.v0,o=this.v1,a=this.v2;return r.set(Ey(e,s.x,o.x,a.x),Ey(e,s.y,o.y,a.y),Ey(e,s.z,o.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class DR extends wa{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new J){const r=i,s=this.points,o=(s.length-1)*e,a=Math.floor(o),l=o-a,c=s[a===0?a:a-1],h=s[a],u=s[a>s.length-2?s.length-1:a+1],d=s[a>s.length-3?s.length-1:a+2];return r.set($N(l,c.x,h.x,u.x,d.x),$N(l,c.y,h.y,u.y,d.y)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const s=e.points[i];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){const s=this.points[i];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const s=e.points[i];this.points.push(new J().fromArray(s))}return this}}var Pw=Object.freeze({__proto__:null,ArcCurve:KN,CatmullRomCurve3:ZN,CubicBezierCurve:PR,CubicBezierCurve3:ez,EllipseCurve:Iw,LineCurve:BR,LineCurve3:tz,QuadraticBezierCurve:kR,QuadraticBezierCurve3:OR,SplineCurve:DR});class iz extends wa{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Pw[r](i,e))}return this}getPoint(e,i){const r=e*this.getLength(),s=this.getCurveLengths();let o=0;for(;o<s.length;){if(s[o]>=r){const a=s[o]-r,l=this.curves[o],c=l.getLength(),h=c===0?0:1-a/c;return l.getPointAt(h,i)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let i=0;for(let r=0,s=this.curves.length;r<s;r++)i+=this.curves[r].getLength(),e.push(i);return this.cacheLengths=e,e}getSpacedPoints(e=40){const i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){const i=[];let r;for(let s=0,o=this.curves;s<o.length;s++){const a=o[s],l=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,c=a.getPoints(l);for(let h=0;h<c.length;h++){const u=c[h];r&&r.equals(u)||(i.push(u),r=u)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){const s=e.curves[i];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const s=this.curves[i];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){const s=e.curves[i];this.curves.push(new Pw[s.type]().fromJSON(s))}return this}}class Ty extends iz{constructor(e){super(),this.type="Path",this.currentPoint=new J,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,r=e.length;i<r;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){const r=new BR(this.currentPoint.clone(),new J(e,i));return this.curves.push(r),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,r,s){const o=new kR(this.currentPoint.clone(),new J(e,i),new J(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}bezierCurveTo(e,i,r,s,o,a){const l=new PR(this.currentPoint.clone(),new J(e,i),new J(r,s),new J(o,a));return this.curves.push(l),this.currentPoint.set(o,a),this}splineThru(e){const i=[this.currentPoint.clone()].concat(e),r=new DR(i);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,r,s,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(e+l,i+c,r,s,o,a),this}absarc(e,i,r,s,o,a){return this.absellipse(e,i,r,r,s,o,a),this}ellipse(e,i,r,s,o,a,l,c){const h=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+h,i+u,r,s,o,a,l,c),this}absellipse(e,i,r,s,o,a,l,c){const h=new Iw(e,i,r,s,o,a,l,c);if(this.curves.length>0){const d=h.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(h);const u=h.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class l_ extends dt{constructor(e=[new J(0,-.5),new J(.5,0),new J(0,.5)],i=12,r=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:r,phiLength:s},i=Math.floor(i),s=In(s,0,Math.PI*2);const o=[],a=[],l=[],c=[],h=[],u=1/i,d=new S,f=new J,m=new S,g=new S,v=new S;let y=0,A=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:y=e[b+1].x-e[b].x,A=e[b+1].y-e[b].y,m.x=A*1,m.y=-y,m.z=A*0,v.copy(m),m.normalize(),c.push(m.x,m.y,m.z);break;case e.length-1:c.push(v.x,v.y,v.z);break;default:y=e[b+1].x-e[b].x,A=e[b+1].y-e[b].y,m.x=A*1,m.y=-y,m.z=A*0,g.copy(m),m.x+=v.x,m.y+=v.y,m.z+=v.z,m.normalize(),c.push(m.x,m.y,m.z),v.copy(g)}for(let b=0;b<=i;b++){const x=r+b*u*s,_=Math.sin(x),w=Math.cos(x);for(let T=0;T<=e.length-1;T++){d.x=e[T].x*_,d.y=e[T].y,d.z=e[T].x*w,a.push(d.x,d.y,d.z),f.x=b/i,f.y=T/(e.length-1),l.push(f.x,f.y);const M=c[3*T+0]*_,R=c[3*T+1],B=c[3*T+0]*w;h.push(M,R,B)}}for(let b=0;b<i;b++)for(let x=0;x<e.length-1;x++){const _=x+b*e.length,w=_,T=_+e.length,M=_+e.length+1,R=_+1;o.push(w,T,R),o.push(M,R,T)}this.setIndex(o),this.setAttribute("position",new rt(a,3)),this.setAttribute("uv",new rt(l,2)),this.setAttribute("normal",new rt(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new l_(e.points,e.segments,e.phiStart,e.phiLength)}}class _T extends l_{constructor(e=1,i=1,r=4,s=8){const o=new Ty;o.absarc(0,-i/2,e,Math.PI*1.5,0),o.absarc(0,i/2,e,0,Math.PI*.5),super(o.getPoints(r),s),this.type="CapsuleGeometry",this.parameters={radius:e,length:i,capSegments:r,radialSegments:s}}static fromJSON(e){return new _T(e.radius,e.length,e.capSegments,e.radialSegments)}}class wT extends dt{constructor(e=1,i=32,r=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:r,thetaLength:s},i=Math.max(3,i);const o=[],a=[],l=[],c=[],h=new S,u=new J;a.push(0,0,0),l.push(0,0,1),c.push(.5,.5);for(let d=0,f=3;d<=i;d++,f+=3){const m=r+d/i*s;h.x=e*Math.cos(m),h.y=e*Math.sin(m),a.push(h.x,h.y,h.z),l.push(0,0,1),u.x=(a[f]/e+1)/2,u.y=(a[f+1]/e+1)/2,c.push(u.x,u.y)}for(let d=1;d<=i;d++)o.push(d,d+1,0);this.setIndex(o),this.setAttribute("position",new rt(a,3)),this.setAttribute("normal",new rt(l,3)),this.setAttribute("uv",new rt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wT(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Wn extends dt{constructor(e=1,i=1,r=1,s=32,o=1,a=!1,l=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:r,radialSegments:s,heightSegments:o,openEnded:a,thetaStart:l,thetaLength:c};const h=this;s=Math.floor(s),o=Math.floor(o);const u=[],d=[],f=[],m=[];let g=0;const v=[],y=r/2;let A=0;b(),a===!1&&(e>0&&x(!0),i>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new rt(d,3)),this.setAttribute("normal",new rt(f,3)),this.setAttribute("uv",new rt(m,2));function b(){const _=new S,w=new S;let T=0;const M=(i-e)/r;for(let R=0;R<=o;R++){const B=[],E=R/o,P=E*(i-e)+e;for(let O=0;O<=s;O++){const N=O/s,L=N*c+l,Q=Math.sin(L),D=Math.cos(L);w.x=P*Q,w.y=-E*r+y,w.z=P*D,d.push(w.x,w.y,w.z),_.set(Q,M,D).normalize(),f.push(_.x,_.y,_.z),m.push(N,1-E),B.push(g++)}v.push(B)}for(let R=0;R<s;R++)for(let B=0;B<o;B++){const E=v[B][R],P=v[B+1][R],O=v[B+1][R+1],N=v[B][R+1];u.push(E,P,N),u.push(P,O,N),T+=6}h.addGroup(A,T,0),A+=T}function x(_){const w=g,T=new J,M=new S;let R=0;const B=_===!0?e:i,E=_===!0?1:-1;for(let O=1;O<=s;O++)d.push(0,y*E,0),f.push(0,E,0),m.push(.5,.5),g++;const P=g;for(let O=0;O<=s;O++){const N=O/s*c+l,L=Math.cos(N),Q=Math.sin(N);M.x=B*Q,M.y=y*E,M.z=B*L,d.push(M.x,M.y,M.z),f.push(0,E,0),T.x=L*.5+.5,T.y=Q*.5*E+.5,m.push(T.x,T.y),g++}for(let O=0;O<s;O++){const N=w+O,L=P+O;_===!0?u.push(L,L+1,N):u.push(L+1,L,N),R+=3}h.addGroup(A,R,_===!0?1:2),A+=R}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wn(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ST extends Wn{constructor(e=1,i=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(0,e,i,r,s,o,a,l),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l}}static fromJSON(e){return new ST(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class cp extends dt{constructor(e=[],i=[],r=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:r,detail:s};const o=[],a=[];l(s),h(r),u(),this.setAttribute("position",new rt(o,3)),this.setAttribute("normal",new rt(o.slice(),3)),this.setAttribute("uv",new rt(a,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function l(b){const x=new S,_=new S,w=new S;for(let T=0;T<i.length;T+=3)m(i[T+0],x),m(i[T+1],_),m(i[T+2],w),c(x,_,w,b)}function c(b,x,_,w){const T=w+1,M=[];for(let R=0;R<=T;R++){M[R]=[];const B=b.clone().lerp(_,R/T),E=x.clone().lerp(_,R/T),P=T-R;for(let O=0;O<=P;O++)O===0&&R===T?M[R][O]=B:M[R][O]=B.clone().lerp(E,O/P)}for(let R=0;R<T;R++)for(let B=0;B<2*(T-R)-1;B++){const E=Math.floor(B/2);B%2===0?(f(M[R][E+1]),f(M[R+1][E]),f(M[R][E])):(f(M[R][E+1]),f(M[R+1][E+1]),f(M[R+1][E]))}}function h(b){const x=new S;for(let _=0;_<o.length;_+=3)x.x=o[_+0],x.y=o[_+1],x.z=o[_+2],x.normalize().multiplyScalar(b),o[_+0]=x.x,o[_+1]=x.y,o[_+2]=x.z}function u(){const b=new S;for(let x=0;x<o.length;x+=3){b.x=o[x+0],b.y=o[x+1],b.z=o[x+2];const _=y(b)/2/Math.PI+.5,w=A(b)/Math.PI+.5;a.push(_,1-w)}g(),d()}function d(){for(let b=0;b<a.length;b+=6){const x=a[b+0],_=a[b+2],w=a[b+4],T=Math.max(x,_,w),M=Math.min(x,_,w);T>.9&&M<.1&&(x<.2&&(a[b+0]+=1),_<.2&&(a[b+2]+=1),w<.2&&(a[b+4]+=1))}}function f(b){o.push(b.x,b.y,b.z)}function m(b,x){const _=b*3;x.x=e[_+0],x.y=e[_+1],x.z=e[_+2]}function g(){const b=new S,x=new S,_=new S,w=new S,T=new J,M=new J,R=new J;for(let B=0,E=0;B<o.length;B+=9,E+=6){b.set(o[B+0],o[B+1],o[B+2]),x.set(o[B+3],o[B+4],o[B+5]),_.set(o[B+6],o[B+7],o[B+8]),T.set(a[E+0],a[E+1]),M.set(a[E+2],a[E+3]),R.set(a[E+4],a[E+5]),w.copy(b).add(x).add(_).divideScalar(3);const P=y(w);v(T,E+0,b,P),v(M,E+2,x,P),v(R,E+4,_,P)}}function v(b,x,_,w){w<0&&b.x===1&&(a[x]=b.x-1),_.x===0&&_.z===0&&(a[x]=w/2/Math.PI+.5)}function y(b){return Math.atan2(b.z,-b.x)}function A(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cp(e.vertices,e.indices,e.radius,e.details)}}class CT extends cp{constructor(e=1,i=0){const r=(1+Math.sqrt(5))/2,s=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(o,a,e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new CT(e.radius,e.detail)}}const Bw=new S,kw=new S,LR=new S,Ow=new Xr;class UR extends dt{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},e!==null){const r=Math.pow(10,4),s=Math.cos(Sp*i),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],h=["a","b","c"],u=new Array(3),d={},f=[];for(let m=0;m<l;m+=3){o?(c[0]=o.getX(m),c[1]=o.getX(m+1),c[2]=o.getX(m+2)):(c[0]=m,c[1]=m+1,c[2]=m+2);const{a:g,b:v,c:y}=Ow;if(g.fromBufferAttribute(a,c[0]),v.fromBufferAttribute(a,c[1]),y.fromBufferAttribute(a,c[2]),Ow.getNormal(LR),u[0]=`${Math.round(g.x*r)},${Math.round(g.y*r)},${Math.round(g.z*r)}`,u[1]=`${Math.round(v.x*r)},${Math.round(v.y*r)},${Math.round(v.z*r)}`,u[2]=`${Math.round(y.x*r)},${Math.round(y.y*r)},${Math.round(y.z*r)}`,!(u[0]===u[1]||u[1]===u[2]||u[2]===u[0]))for(let A=0;A<3;A++){const b=(A+1)%3,x=u[A],_=u[b],w=Ow[h[A]],T=Ow[h[b]],M=`${x}_${_}`,R=`${_}_${x}`;R in d&&d[R]?(LR.dot(d[R].normal)<=s&&(f.push(w.x,w.y,w.z),f.push(T.x,T.y,T.z)),d[R]=null):M in d||(d[M]={index0:c[A],index1:c[b],normal:LR.clone()})}}for(const m in d)if(d[m]){const{index0:g,index1:v}=d[m];Bw.fromBufferAttribute(a,g),kw.fromBufferAttribute(a,v),f.push(Bw.x,Bw.y,Bw.z),f.push(kw.x,kw.y,kw.z)}this.setAttribute("position",new rt(f,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Pu extends Ty{constructor(e){super(e),this.uuid=No(),this.type="Shape",this.holes=[]}getPointsHoles(e){const i=[];for(let r=0,s=this.holes.length;r<s;r++)i[r]=this.holes[r].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){const s=e.holes[i];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const s=this.holes[i];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){const s=e.holes[i];this.holes.push(new Ty().fromJSON(s))}return this}}const Hee={triangulate:function(n,e,i=2){const r=e&&e.length,s=r?e[0]*i:n.length;let o=nz(n,0,s,i,!0);const a=[];if(!o||o.next===o.prev)return a;let l,c,h,u,d,f,m;if(r&&(o=qee(n,e,o,i)),n.length>80*i){l=h=n[0],c=u=n[1];for(let g=i;g<s;g+=i)d=n[g],f=n[g+1],d<l&&(l=d),f<c&&(c=f),d>h&&(h=d),f>u&&(u=f);m=Math.max(h-l,u-c),m=m!==0?32767/m:0}return Iy(o,a,i,l,c,m,0),a}};function nz(n,e,i,r,s){let o,a;if(s===ste(n,e,i,r)>0)for(o=e;o<i;o+=r)a=oz(o,n[o],n[o+1],a);else for(o=i-r;o>=e;o-=r)a=oz(o,n[o],n[o+1],a);return a&&Dw(a,a.next)&&(Py(a),a=a.next),a}function Up(n,e){if(!n)return n;e||(e=n);let i=n,r;do if(r=!1,!i.steiner&&(Dw(i,i.next)||xn(i.prev,i,i.next)===0)){if(Py(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function Iy(n,e,i,r,s,o,a){if(!n)return;!a&&o&&$ee(n,r,s,o);let l=n,c,h;for(;n.prev!==n.next;){if(c=n.prev,h=n.next,o?Qee(n,r,s,o):Vee(n)){e.push(c.i/i|0),e.push(n.i/i|0),e.push(h.i/i|0),Py(n),n=h.next,l=h.next;continue}if(n=h,n===l){a?a===1?(n=Wee(Up(n),e,i),Iy(n,e,i,r,s,o,2)):a===2&&Xee(n,e,i,r,s,o):Iy(Up(n),e,i,r,s,o,1);break}}}function Vee(n){const e=n.prev,i=n,r=n.next;if(xn(e,i,r)>=0)return!1;const s=e.x,o=i.x,a=r.x,l=e.y,c=i.y,h=r.y,u=s<o?s<a?s:a:o<a?o:a,d=l<c?l<h?l:h:c<h?c:h,f=s>o?s>a?s:a:o>a?o:a,m=l>c?l>h?l:h:c>h?c:h;let g=r.next;for(;g!==e;){if(g.x>=u&&g.x<=f&&g.y>=d&&g.y<=m&&ug(s,l,o,c,a,h,g.x,g.y)&&xn(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Qee(n,e,i,r){const s=n.prev,o=n,a=n.next;if(xn(s,o,a)>=0)return!1;const l=s.x,c=o.x,h=a.x,u=s.y,d=o.y,f=a.y,m=l<c?l<h?l:h:c<h?c:h,g=u<d?u<f?u:f:d<f?d:f,v=l>c?l>h?l:h:c>h?c:h,y=u>d?u>f?u:f:d>f?d:f,A=FR(m,g,e,i,r),b=FR(v,y,e,i,r);let x=n.prevZ,_=n.nextZ;for(;x&&x.z>=A&&_&&_.z<=b;){if(x.x>=m&&x.x<=v&&x.y>=g&&x.y<=y&&x!==s&&x!==a&&ug(l,u,c,d,h,f,x.x,x.y)&&xn(x.prev,x,x.next)>=0||(x=x.prevZ,_.x>=m&&_.x<=v&&_.y>=g&&_.y<=y&&_!==s&&_!==a&&ug(l,u,c,d,h,f,_.x,_.y)&&xn(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;x&&x.z>=A;){if(x.x>=m&&x.x<=v&&x.y>=g&&x.y<=y&&x!==s&&x!==a&&ug(l,u,c,d,h,f,x.x,x.y)&&xn(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=b;){if(_.x>=m&&_.x<=v&&_.y>=g&&_.y<=y&&_!==s&&_!==a&&ug(l,u,c,d,h,f,_.x,_.y)&&xn(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Wee(n,e,i){let r=n;do{const s=r.prev,o=r.next.next;!Dw(s,o)&&rz(s,r,r.next,o)&&Ry(s,o)&&Ry(o,s)&&(e.push(s.i/i|0),e.push(r.i/i|0),e.push(o.i/i|0),Py(r),Py(r.next),r=n=o),r=r.next}while(r!==n);return Up(r)}function Xee(n,e,i,r,s,o){let a=n;do{let l=a.next.next;for(;l!==a.prev;){if(a.i!==l.i&&ite(a,l)){let c=sz(a,l);a=Up(a,a.next),c=Up(c,c.next),Iy(a,e,i,r,s,o,0),Iy(c,e,i,r,s,o,0);return}l=l.next}a=a.next}while(a!==n)}function qee(n,e,i,r){const s=[];let o,a,l,c,h;for(o=0,a=e.length;o<a;o++)l=e[o]*r,c=o<a-1?e[o+1]*r:n.length,h=nz(n,l,c,r,!1),h===h.next&&(h.steiner=!0),s.push(tte(h));for(s.sort(Yee),o=0;o<s.length;o++)i=Jee(s[o],i);return i}function Yee(n,e){return n.x-e.x}function Jee(n,e){const i=Kee(n,e);if(!i)return e;const r=sz(i,n);return Up(r,r.next),Up(i,i.next)}function Kee(n,e){let i=e,r=-1/0,s;const o=n.x,a=n.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const f=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(f<=o&&f>r&&(r=f,s=i.x<i.next.x?i:i.next,f===o))return s}i=i.next}while(i!==e);if(!s)return null;const l=s,c=s.x,h=s.y;let u=1/0,d;i=s;do o>=i.x&&i.x>=c&&o!==i.x&&ug(a<h?o:r,a,c,h,a<h?r:o,a,i.x,i.y)&&(d=Math.abs(a-i.y)/(o-i.x),Ry(i,n)&&(d<u||d===u&&(i.x>s.x||i.x===s.x&&Zee(s,i)))&&(s=i,u=d)),i=i.next;while(i!==l);return s}function Zee(n,e){return xn(n.prev,n,e.prev)<0&&xn(e.next,n,n.next)<0}function $ee(n,e,i,r){let s=n;do s.z===0&&(s.z=FR(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,ete(s)}function ete(n){let e,i,r,s,o,a,l,c,h=1;do{for(i=n,n=null,o=null,a=0;i;){for(a++,r=i,l=0,e=0;e<h&&(l++,r=r.nextZ,!!r);e++);for(c=h;l>0||c>0&&r;)l!==0&&(c===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,l--):(s=r,r=r.nextZ,c--),o?o.nextZ=s:n=s,s.prevZ=o,o=s;i=r}o.nextZ=null,h*=2}while(a>1);return n}function FR(n,e,i,r,s){return n=(n-i)*s|0,e=(e-r)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function tte(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function ug(n,e,i,r,s,o,a,l){return(s-a)*(e-l)>=(n-a)*(o-l)&&(n-a)*(r-l)>=(i-a)*(e-l)&&(i-a)*(o-l)>=(s-a)*(r-l)}function ite(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!nte(n,e)&&(Ry(n,e)&&Ry(e,n)&&rte(n,e)&&(xn(n.prev,n,e.prev)||xn(n,e.prev,e))||Dw(n,e)&&xn(n.prev,n,n.next)>0&&xn(e.prev,e,e.next)>0)}function xn(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Dw(n,e){return n.x===e.x&&n.y===e.y}function rz(n,e,i,r){const s=Uw(xn(n,e,i)),o=Uw(xn(n,e,r)),a=Uw(xn(i,r,n)),l=Uw(xn(i,r,e));return!!(s!==o&&a!==l||s===0&&Lw(n,i,e)||o===0&&Lw(n,r,e)||a===0&&Lw(i,n,r)||l===0&&Lw(i,e,r))}function Lw(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Uw(n){return n>0?1:n<0?-1:0}function nte(n,e){let i=n;do{if(i.i!==n.i&&i.next.i!==n.i&&i.i!==e.i&&i.next.i!==e.i&&rz(i,i.next,n,e))return!0;i=i.next}while(i!==n);return!1}function Ry(n,e){return xn(n.prev,n,n.next)<0?xn(n,e,n.next)>=0&&xn(n,n.prev,e)>=0:xn(n,e,n.prev)<0||xn(n,n.next,e)<0}function rte(n,e){let i=n,r=!1;const s=(n.x+e.x)/2,o=(n.y+e.y)/2;do i.y>o!=i.next.y>o&&i.next.y!==i.y&&s<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==n);return r}function sz(n,e){const i=new NR(n.i,n.x,n.y),r=new NR(e.i,e.x,e.y),s=n.next,o=e.prev;return n.next=e,e.prev=n,i.next=s,s.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function oz(n,e,i,r){const s=new NR(n,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function Py(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function NR(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ste(n,e,i,r){let s=0;for(let o=e,a=i-r;o<i;o+=r)s+=(n[a]-n[o])*(n[o+1]+n[a+1]),a=o;return s}class Gl{static area(e){const i=e.length;let r=0;for(let s=i-1,o=0;o<i;s=o++)r+=e[s].x*e[o].y-e[o].x*e[s].y;return r*.5}static isClockWise(e){return Gl.area(e)<0}static triangulateShape(e,i){const r=[],s=[],o=[];az(e),lz(r,e);let a=e.length;i.forEach(az);for(let c=0;c<i.length;c++)s.push(a),a+=i[c].length,lz(r,i[c]);const l=Hee.triangulate(r,s);for(let c=0;c<l.length;c+=3)o.push(l.slice(c,c+3));return o}}function az(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function lz(n,e){for(let i=0;i<e.length;i++)n.push(e[i].x),n.push(e[i].y)}class zv extends dt{constructor(e=new Pu([new J(.5,.5),new J(-.5,.5),new J(-.5,-.5),new J(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];const r=this,s=[],o=[];for(let l=0,c=e.length;l<c;l++){const h=e[l];a(h)}this.setAttribute("position",new rt(s,3)),this.setAttribute("uv",new rt(o,2)),this.computeVertexNormals();function a(l){const c=[],h=i.curveSegments!==void 0?i.curveSegments:12,u=i.steps!==void 0?i.steps:1,d=i.depth!==void 0?i.depth:1;let f=i.bevelEnabled!==void 0?i.bevelEnabled:!0,m=i.bevelThickness!==void 0?i.bevelThickness:.2,g=i.bevelSize!==void 0?i.bevelSize:m-.1,v=i.bevelOffset!==void 0?i.bevelOffset:0,y=i.bevelSegments!==void 0?i.bevelSegments:3;const A=i.extrudePath,b=i.UVGenerator!==void 0?i.UVGenerator:ote;let x,_=!1,w,T,M,R;A&&(x=A.getSpacedPoints(u),_=!0,f=!1,w=A.computeFrenetFrames(u,!1),T=new S,M=new S,R=new S),f||(y=0,m=0,g=0,v=0);const B=l.extractPoints(h);let E=B.shape;const P=B.holes;if(!Gl.isClockWise(E)){E=E.reverse();for(let ge=0,X=P.length;ge<X;ge++){const ze=P[ge];Gl.isClockWise(ze)&&(P[ge]=ze.reverse())}}const O=Gl.triangulateShape(E,P),N=E;for(let ge=0,X=P.length;ge<X;ge++){const ze=P[ge];E=E.concat(ze)}function L(ge,X,ze){return X||console.error("THREE.ExtrudeGeometry: vec does not exist"),ge.clone().addScaledVector(X,ze)}const Q=E.length,D=O.length;function F(ge,X,ze){let Ie,Te,Ve;const Ae=ge.x-X.x,nt=ge.y-X.y,ct=ze.x-ge.x,It=ze.y-ge.y,V=Ae*Ae+nt*nt,U=Ae*It-nt*ct;if(Math.abs(U)>Number.EPSILON){const ue=Math.sqrt(V),Me=Math.sqrt(ct*ct+It*It),De=X.x-nt/ue,Pe=X.y+Ae/ue,At=ze.x-It/Me,ht=ze.y+ct/Me,je=((At-De)*It-(ht-Pe)*ct)/(Ae*It-nt*ct);Ie=De+Ae*je-ge.x,Te=Pe+nt*je-ge.y;const He=Ie*Ie+Te*Te;if(He<=2)return new J(Ie,Te);Ve=Math.sqrt(He/2)}else{let ue=!1;Ae>Number.EPSILON?ct>Number.EPSILON&&(ue=!0):Ae<-Number.EPSILON?ct<-Number.EPSILON&&(ue=!0):Math.sign(nt)===Math.sign(It)&&(ue=!0),ue?(Ie=-nt,Te=Ae,Ve=Math.sqrt(V)):(Ie=Ae,Te=nt,Ve=Math.sqrt(V/2))}return new J(Ie/Ve,Te/Ve)}const H=[];for(let ge=0,X=N.length,ze=X-1,Ie=ge+1;ge<X;ge++,ze++,Ie++)ze===X&&(ze=0),Ie===X&&(Ie=0),H[ge]=F(N[ge],N[ze],N[Ie]);const K=[];let Z,oe=H.concat();for(let ge=0,X=P.length;ge<X;ge++){const ze=P[ge];Z=[];for(let Ie=0,Te=ze.length,Ve=Te-1,Ae=Ie+1;Ie<Te;Ie++,Ve++,Ae++)Ve===Te&&(Ve=0),Ae===Te&&(Ae=0),Z[Ie]=F(ze[Ie],ze[Ve],ze[Ae]);K.push(Z),oe=oe.concat(Z)}for(let ge=0;ge<y;ge++){const X=ge/y,ze=m*Math.cos(X*Math.PI/2),Ie=g*Math.sin(X*Math.PI/2)+v;for(let Te=0,Ve=N.length;Te<Ve;Te++){const Ae=L(N[Te],H[Te],Ie);Ee(Ae.x,Ae.y,-ze)}for(let Te=0,Ve=P.length;Te<Ve;Te++){const Ae=P[Te];Z=K[Te];for(let nt=0,ct=Ae.length;nt<ct;nt++){const It=L(Ae[nt],Z[nt],Ie);Ee(It.x,It.y,-ze)}}}const we=g+v;for(let ge=0;ge<Q;ge++){const X=f?L(E[ge],oe[ge],we):E[ge];_?(M.copy(w.normals[0]).multiplyScalar(X.x),T.copy(w.binormals[0]).multiplyScalar(X.y),R.copy(x[0]).add(M).add(T),Ee(R.x,R.y,R.z)):Ee(X.x,X.y,0)}for(let ge=1;ge<=u;ge++)for(let X=0;X<Q;X++){const ze=f?L(E[X],oe[X],we):E[X];_?(M.copy(w.normals[ge]).multiplyScalar(ze.x),T.copy(w.binormals[ge]).multiplyScalar(ze.y),R.copy(x[ge]).add(M).add(T),Ee(R.x,R.y,R.z)):Ee(ze.x,ze.y,d/u*ge)}for(let ge=y-1;ge>=0;ge--){const X=ge/y,ze=m*Math.cos(X*Math.PI/2),Ie=g*Math.sin(X*Math.PI/2)+v;for(let Te=0,Ve=N.length;Te<Ve;Te++){const Ae=L(N[Te],H[Te],Ie);Ee(Ae.x,Ae.y,d+ze)}for(let Te=0,Ve=P.length;Te<Ve;Te++){const Ae=P[Te];Z=K[Te];for(let nt=0,ct=Ae.length;nt<ct;nt++){const It=L(Ae[nt],Z[nt],Ie);_?Ee(It.x,It.y+x[u-1].y,x[u-1].x+ze):Ee(It.x,It.y,d+ze)}}}Oe(),se();function Oe(){const ge=s.length/3;if(f){let X=0,ze=Q*X;for(let Ie=0;Ie<D;Ie++){const Te=O[Ie];et(Te[2]+ze,Te[1]+ze,Te[0]+ze)}X=u+y*2,ze=Q*X;for(let Ie=0;Ie<D;Ie++){const Te=O[Ie];et(Te[0]+ze,Te[1]+ze,Te[2]+ze)}}else{for(let X=0;X<D;X++){const ze=O[X];et(ze[2],ze[1],ze[0])}for(let X=0;X<D;X++){const ze=O[X];et(ze[0]+Q*u,ze[1]+Q*u,ze[2]+Q*u)}}r.addGroup(ge,s.length/3-ge,0)}function se(){const ge=s.length/3;let X=0;_e(N,X),X+=N.length;for(let ze=0,Ie=P.length;ze<Ie;ze++){const Te=P[ze];_e(Te,X),X+=Te.length}r.addGroup(ge,s.length/3-ge,1)}function _e(ge,X){let ze=ge.length;for(;--ze>=0;){const Ie=ze;let Te=ze-1;Te<0&&(Te=ge.length-1);for(let Ve=0,Ae=u+y*2;Ve<Ae;Ve++){const nt=Q*Ve,ct=Q*(Ve+1),It=X+Ie+nt,V=X+Te+nt,U=X+Te+ct,ue=X+Ie+ct;We(It,V,U,ue)}}}function Ee(ge,X,ze){c.push(ge),c.push(X),c.push(ze)}function et(ge,X,ze){Ue(ge),Ue(X),Ue(ze);const Ie=s.length/3,Te=b.generateTopUV(r,s,Ie-3,Ie-2,Ie-1);st(Te[0]),st(Te[1]),st(Te[2])}function We(ge,X,ze,Ie){Ue(ge),Ue(X),Ue(Ie),Ue(X),Ue(ze),Ue(Ie);const Te=s.length/3,Ve=b.generateSideWallUV(r,s,Te-6,Te-3,Te-2,Te-1);st(Ve[0]),st(Ve[1]),st(Ve[3]),st(Ve[1]),st(Ve[2]),st(Ve[3])}function Ue(ge){s.push(c[ge*3+0]),s.push(c[ge*3+1]),s.push(c[ge*3+2])}function st(ge){o.push(ge.x),o.push(ge.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return ate(i,r,e)}static fromJSON(e,i){const r=[];for(let o=0,a=e.shapes.length;o<a;o++){const l=i[e.shapes[o]];r.push(l)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new Pw[s.type]().fromJSON(s)),new zv(r,e.options)}}const ote={generateTopUV:function(n,e,i,r,s){const o=e[i*3],a=e[i*3+1],l=e[r*3],c=e[r*3+1],h=e[s*3],u=e[s*3+1];return[new J(o,a),new J(l,c),new J(h,u)]},generateSideWallUV:function(n,e,i,r,s,o){const a=e[i*3],l=e[i*3+1],c=e[i*3+2],h=e[r*3],u=e[r*3+1],d=e[r*3+2],f=e[s*3],m=e[s*3+1],g=e[s*3+2],v=e[o*3],y=e[o*3+1],A=e[o*3+2];return Math.abs(l-u)<Math.abs(a-h)?[new J(a,1-c),new J(h,1-d),new J(f,1-g),new J(v,1-A)]:[new J(l,1-c),new J(u,1-d),new J(m,1-g),new J(y,1-A)]}};function ate(n,e,i){if(i.shapes=[],Array.isArray(n))for(let r=0,s=n.length;r<s;r++){const o=n[r];i.shapes.push(o.uuid)}else i.shapes.push(n.uuid);return i.options=Object.assign({},e),e.extrudePath!==void 0&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class ET extends cp{constructor(e=1,i=0){const r=(1+Math.sqrt(5))/2,s=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,o,e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new ET(e.radius,e.detail)}}class au extends cp{constructor(e=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,s,e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new au(e.radius,e.detail)}}class c_ extends dt{constructor(e=.5,i=1,r=32,s=1,o=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:r,phiSegments:s,thetaStart:o,thetaLength:a},r=Math.max(3,r),s=Math.max(1,s);const l=[],c=[],h=[],u=[];let d=e;const f=(i-e)/s,m=new S,g=new J;for(let v=0;v<=s;v++){for(let y=0;y<=r;y++){const A=o+y/r*a;m.x=d*Math.cos(A),m.y=d*Math.sin(A),c.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/i+1)/2,g.y=(m.y/i+1)/2,u.push(g.x,g.y)}d+=f}for(let v=0;v<s;v++){const y=v*(r+1);for(let A=0;A<r;A++){const b=A+y,x=b,_=b+r+1,w=b+r+2,T=b+1;l.push(x,_,T),l.push(_,w,T)}}this.setIndex(l),this.setAttribute("position",new rt(c,3)),this.setAttribute("normal",new rt(h,3)),this.setAttribute("uv",new rt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new c_(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class MT extends dt{constructor(e=new Pu([new J(0,.5),new J(-.5,-.5),new J(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};const r=[],s=[],o=[],a=[];let l=0,c=0;if(Array.isArray(e)===!1)h(e);else for(let u=0;u<e.length;u++)h(e[u]),this.addGroup(l,c,u),l+=c,c=0;this.setIndex(r),this.setAttribute("position",new rt(s,3)),this.setAttribute("normal",new rt(o,3)),this.setAttribute("uv",new rt(a,2));function h(u){const d=s.length/3,f=u.extractPoints(i);let m=f.shape;const g=f.holes;Gl.isClockWise(m)===!1&&(m=m.reverse());for(let y=0,A=g.length;y<A;y++){const b=g[y];Gl.isClockWise(b)===!0&&(g[y]=b.reverse())}const v=Gl.triangulateShape(m,g);for(let y=0,A=g.length;y<A;y++){const b=g[y];m=m.concat(b)}for(let y=0,A=m.length;y<A;y++){const b=m[y];s.push(b.x,b.y,0),o.push(0,0,1),a.push(b.x,b.y)}for(let y=0,A=v.length;y<A;y++){const b=v[y],x=b[0]+d,_=b[1]+d,w=b[2]+d;r.push(x,_,w),c+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes;return lte(i,e)}static fromJSON(e,i){const r=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=i[e.shapes[s]];r.push(a)}return new MT(r,e.curveSegments)}}function lte(n,e){if(e.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++){const s=n[i];e.shapes.push(s.uuid)}else e.shapes.push(n.uuid);return e}class tl extends dt{constructor(e=1,i=32,r=16,s=0,o=Math.PI*2,a=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:r,phiStart:s,phiLength:o,thetaStart:a,thetaLength:l},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const c=Math.min(a+l,Math.PI);let h=0;const u=[],d=new S,f=new S,m=[],g=[],v=[],y=[];for(let A=0;A<=r;A++){const b=[],x=A/r;let _=0;A===0&&a===0?_=.5/i:A===r&&c===Math.PI&&(_=-.5/i);for(let w=0;w<=i;w++){const T=w/i;d.x=-e*Math.cos(s+T*o)*Math.sin(a+x*l),d.y=e*Math.cos(a+x*l),d.z=e*Math.sin(s+T*o)*Math.sin(a+x*l),g.push(d.x,d.y,d.z),f.copy(d).normalize(),v.push(f.x,f.y,f.z),y.push(T+_,1-x),b.push(h++)}u.push(b)}for(let A=0;A<r;A++)for(let b=0;b<i;b++){const x=u[A][b+1],_=u[A][b],w=u[A+1][b],T=u[A+1][b+1];(A!==0||a>0)&&m.push(x,_,T),(A!==r-1||c<Math.PI)&&m.push(_,w,T)}this.setIndex(m),this.setAttribute("position",new rt(g,3)),this.setAttribute("normal",new rt(v,3)),this.setAttribute("uv",new rt(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tl(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class TT extends cp{constructor(e=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,s,e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new TT(e.radius,e.detail)}}class lu extends dt{constructor(e=1,i=.4,r=12,s=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:r,tubularSegments:s,arc:o},r=Math.floor(r),s=Math.floor(s);const a=[],l=[],c=[],h=[],u=new S,d=new S,f=new S;for(let m=0;m<=r;m++)for(let g=0;g<=s;g++){const v=g/s*o,y=m/r*Math.PI*2;d.x=(e+i*Math.cos(y))*Math.cos(v),d.y=(e+i*Math.cos(y))*Math.sin(v),d.z=i*Math.sin(y),l.push(d.x,d.y,d.z),u.x=e*Math.cos(v),u.y=e*Math.sin(v),f.subVectors(d,u).normalize(),c.push(f.x,f.y,f.z),h.push(g/s),h.push(m/r)}for(let m=1;m<=r;m++)for(let g=1;g<=s;g++){const v=(s+1)*m+g-1,y=(s+1)*(m-1)+g-1,A=(s+1)*(m-1)+g,b=(s+1)*m+g;a.push(v,y,b),a.push(y,A,b)}this.setIndex(a),this.setAttribute("position",new rt(l,3)),this.setAttribute("normal",new rt(c,3)),this.setAttribute("uv",new rt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lu(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class IT extends dt{constructor(e=1,i=.4,r=64,s=8,o=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:r,radialSegments:s,p:o,q:a},r=Math.floor(r),s=Math.floor(s);const l=[],c=[],h=[],u=[],d=new S,f=new S,m=new S,g=new S,v=new S,y=new S,A=new S;for(let x=0;x<=r;++x){const _=x/r*o*Math.PI*2;b(_,o,a,e,m),b(_+.01,o,a,e,g),y.subVectors(g,m),A.addVectors(g,m),v.crossVectors(y,A),A.crossVectors(v,y),v.normalize(),A.normalize();for(let w=0;w<=s;++w){const T=w/s*Math.PI*2,M=-i*Math.cos(T),R=i*Math.sin(T);d.x=m.x+(M*A.x+R*v.x),d.y=m.y+(M*A.y+R*v.y),d.z=m.z+(M*A.z+R*v.z),c.push(d.x,d.y,d.z),f.subVectors(d,m).normalize(),h.push(f.x,f.y,f.z),u.push(x/r),u.push(w/s)}}for(let x=1;x<=r;x++)for(let _=1;_<=s;_++){const w=(s+1)*(x-1)+(_-1),T=(s+1)*x+(_-1),M=(s+1)*x+_,R=(s+1)*(x-1)+_;l.push(w,T,R),l.push(T,M,R)}this.setIndex(l),this.setAttribute("position",new rt(c,3)),this.setAttribute("normal",new rt(h,3)),this.setAttribute("uv",new rt(u,2));function b(x,_,w,T,M){const R=Math.cos(x),B=Math.sin(x),E=w/_*x,P=Math.cos(E);M.x=T*(2+P)*.5*R,M.y=T*(2+P)*B*.5,M.z=T*Math.sin(E)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new IT(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class RT extends dt{constructor(e=new OR(new S(-1,-1,0),new S(-1,1,0),new S(1,1,0)),i=64,r=1,s=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:r,radialSegments:s,closed:o};const a=e.computeFrenetFrames(i,o);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const l=new S,c=new S,h=new J;let u=new S;const d=[],f=[],m=[],g=[];v(),this.setIndex(g),this.setAttribute("position",new rt(d,3)),this.setAttribute("normal",new rt(f,3)),this.setAttribute("uv",new rt(m,2));function v(){for(let x=0;x<i;x++)y(x);y(o===!1?i:0),b(),A()}function y(x){u=e.getPointAt(x/i,u);const _=a.normals[x],w=a.binormals[x];for(let T=0;T<=s;T++){const M=T/s*Math.PI*2,R=Math.sin(M),B=-Math.cos(M);c.x=B*_.x+R*w.x,c.y=B*_.y+R*w.y,c.z=B*_.z+R*w.z,c.normalize(),f.push(c.x,c.y,c.z),l.x=u.x+r*c.x,l.y=u.y+r*c.y,l.z=u.z+r*c.z,d.push(l.x,l.y,l.z)}}function A(){for(let x=1;x<=i;x++)for(let _=1;_<=s;_++){const w=(s+1)*(x-1)+(_-1),T=(s+1)*x+(_-1),M=(s+1)*x+_,R=(s+1)*(x-1)+_;g.push(w,T,R),g.push(T,M,R)}}function b(){for(let x=0;x<=i;x++)for(let _=0;_<=s;_++)h.x=x/i,h.y=_/s,m.push(h.x,h.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new RT(new Pw[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class zR extends dt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const i=[],r=new Set,s=new S,o=new S;if(e.index!==null){const a=e.attributes.position,l=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:l.count,materialIndex:0}]);for(let h=0,u=c.length;h<u;++h){const d=c[h],f=d.start,m=d.count;for(let g=f,v=f+m;g<v;g+=3)for(let y=0;y<3;y++){const A=l.getX(g+y),b=l.getX(g+(y+1)%3);s.fromBufferAttribute(a,A),o.fromBufferAttribute(a,b),cz(s,o,r)===!0&&(i.push(s.x,s.y,s.z),i.push(o.x,o.y,o.z))}}}else{const a=e.attributes.position;for(let l=0,c=a.count/3;l<c;l++)for(let h=0;h<3;h++){const u=3*l+h,d=3*l+(h+1)%3;s.fromBufferAttribute(a,u),o.fromBufferAttribute(a,d),cz(s,o,r)===!0&&(i.push(s.x,s.y,s.z),i.push(o.x,o.y,o.z))}}this.setAttribute("position",new rt(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function cz(n,e,i){const r=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return i.has(r)===!0||i.has(s)===!0?!1:(i.add(r),i.add(s),!0)}var hz=Object.freeze({__proto__:null,BoxGeometry:Ki,CapsuleGeometry:_T,CircleGeometry:wT,ConeGeometry:ST,CylinderGeometry:Wn,DodecahedronGeometry:CT,EdgesGeometry:UR,ExtrudeGeometry:zv,IcosahedronGeometry:ET,LatheGeometry:l_,OctahedronGeometry:au,PlaneGeometry:cr,PolyhedronGeometry:cp,RingGeometry:c_,ShapeGeometry:MT,SphereGeometry:tl,TetrahedronGeometry:TT,TorusGeometry:lu,TorusKnotGeometry:IT,TubeGeometry:RT,WireframeGeometry:zR});class Fw extends Ut{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new be(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Nw extends Bt{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}let mr=class extends Ut{constructor(n){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new be(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new be(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bu,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ri,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(n)}copy(n){return super.copy(n),this.defines={STANDARD:""},this.color.copy(n.color),this.roughness=n.roughness,this.metalness=n.metalness,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.roughnessMap=n.roughnessMap,this.metalnessMap=n.metalnessMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapRotation.copy(n.envMapRotation),this.envMapIntensity=n.envMapIntensity,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.flatShading=n.flatShading,this.fog=n.fog,this}},Co=class extends mr{constructor(n){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new J(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return In(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new be(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new be(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new be(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(n)}get anisotropy(){return this._anisotropy}set anisotropy(n){this._anisotropy>0!=n>0&&this.version++,this._anisotropy=n}get clearcoat(){return this._clearcoat}set clearcoat(n){this._clearcoat>0!=n>0&&this.version++,this._clearcoat=n}get iridescence(){return this._iridescence}set iridescence(n){this._iridescence>0!=n>0&&this.version++,this._iridescence=n}get sheen(){return this._sheen}set sheen(n){this._sheen>0!=n>0&&this.version++,this._sheen=n}get transmission(){return this._transmission}set transmission(n){this._transmission>0!=n>0&&this.version++,this._transmission=n}copy(n){return super.copy(n),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=n.anisotropy,this.anisotropyRotation=n.anisotropyRotation,this.anisotropyMap=n.anisotropyMap,this.clearcoat=n.clearcoat,this.clearcoatMap=n.clearcoatMap,this.clearcoatRoughness=n.clearcoatRoughness,this.clearcoatRoughnessMap=n.clearcoatRoughnessMap,this.clearcoatNormalMap=n.clearcoatNormalMap,this.clearcoatNormalScale.copy(n.clearcoatNormalScale),this.ior=n.ior,this.iridescence=n.iridescence,this.iridescenceMap=n.iridescenceMap,this.iridescenceIOR=n.iridescenceIOR,this.iridescenceThicknessRange=[...n.iridescenceThicknessRange],this.iridescenceThicknessMap=n.iridescenceThicknessMap,this.sheen=n.sheen,this.sheenColor.copy(n.sheenColor),this.sheenColorMap=n.sheenColorMap,this.sheenRoughness=n.sheenRoughness,this.sheenRoughnessMap=n.sheenRoughnessMap,this.transmission=n.transmission,this.transmissionMap=n.transmissionMap,this.thickness=n.thickness,this.thicknessMap=n.thicknessMap,this.attenuationDistance=n.attenuationDistance,this.attenuationColor.copy(n.attenuationColor),this.specularIntensity=n.specularIntensity,this.specularIntensityMap=n.specularIntensityMap,this.specularColor.copy(n.specularColor),this.specularColorMap=n.specularColorMap,this}};class dg extends Ut{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new be(16777215),this.specular=new be(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new be(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bu,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ri,this.combine=Yv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uz extends Ut{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new be(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new be(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bu,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class zw extends Ut{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bu,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class jR extends Ut{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new be(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new be(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bu,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ri,this.combine=Yv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class dz extends Ut{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new be(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bu,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pz extends zi{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Fp(n,e,i){return!n||!i&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function fz(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function mz(n){function e(s,o){return n[s]-n[o]}const i=n.length,r=new Array(i);for(let s=0;s!==i;++s)r[s]=s;return r.sort(e),r}function GR(n,e,i){const r=n.length,s=new n.constructor(r);for(let o=0,a=0;a!==r;++o){const l=i[o]*e;for(let c=0;c!==e;++c)s[a++]=n[l+c]}return s}function HR(n,e,i,r){let s=1,o=n[0];for(;o!==void 0&&o[r]===void 0;)o=n[s++];if(o===void 0)return;let a=o[r];if(a!==void 0)if(Array.isArray(a))do a=o[r],a!==void 0&&(e.push(o.time),i.push.apply(i,a)),o=n[s++];while(o!==void 0);else if(a.toArray!==void 0)do a=o[r],a!==void 0&&(e.push(o.time),a.toArray(i,i.length)),o=n[s++];while(o!==void 0);else do a=o[r],a!==void 0&&(e.push(o.time),i.push(a)),o=n[s++];while(o!==void 0)}function cte(n,e,i,r,s=30){const o=n.clone();o.name=e;const a=[];for(let c=0;c<o.tracks.length;++c){const h=o.tracks[c],u=h.getValueSize(),d=[],f=[];for(let m=0;m<h.times.length;++m){const g=h.times[m]*s;if(!(g<i||g>=r)){d.push(h.times[m]);for(let v=0;v<u;++v)f.push(h.values[m*u+v])}}d.length!==0&&(h.times=Fp(d,h.times.constructor),h.values=Fp(f,h.values.constructor),a.push(h))}o.tracks=a;let l=1/0;for(let c=0;c<o.tracks.length;++c)l>o.tracks[c].times[0]&&(l=o.tracks[c].times[0]);for(let c=0;c<o.tracks.length;++c)o.tracks[c].shift(-1*l);return o.resetDuration(),o}function hte(n,e=0,i=n,r=30){r<=0&&(r=30);const s=i.tracks.length,o=e/r;for(let a=0;a<s;++a){const l=i.tracks[a],c=l.ValueTypeName;if(c==="bool"||c==="string")continue;const h=n.tracks.find(function(A){return A.name===l.name&&A.ValueTypeName===c});if(h===void 0)continue;let u=0;const d=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let f=0;const m=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=m/3);const g=l.times.length-1;let v;if(o<=l.times[0]){const A=u,b=d-u;v=l.values.slice(A,b)}else if(o>=l.times[g]){const A=g*d+u,b=A+d-u;v=l.values.slice(A,b)}else{const A=l.createInterpolant(),b=u,x=d-u;A.evaluate(o),v=A.resultBuffer.slice(b,x)}c==="quaternion"&&new Ce().fromArray(v).normalize().conjugate().toArray(v);const y=h.times.length;for(let A=0;A<y;++A){const b=A*m+f;if(c==="quaternion")Ce.multiplyQuaternionsFlat(h.values,b,v,0,h.values,b);else{const x=m-f*2;for(let _=0;_<x;++_)h.values[b+_]-=v[_]}}}return n.blendMode=MI,n}const ute={convertArray:Fp,isTypedArray:fz,getKeyframeOrder:mz,sortedArray:GR,flattenJSON:HR,subclip:cte,makeClipAdditive:hte};let pg=class{constructor(n,e,i,r){this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(n){const e=this.parameterPositions;let i=this._cachedIndex,r=e[i],s=e[i-1];e:{t:{let o;i:{n:if(!(n<r)){for(let a=i+2;;){if(r===void 0){if(n<s)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=e[++i],n<r)break t}o=e.length;break i}if(!(n>=s)){const a=e[1];n<a&&(i=2,s=a);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=e[--i-1],n>=s)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;n<e[a]?o=a:i=a+1}if(r=e[i],s=e[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,n,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(n){const e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=n*r;for(let o=0;o!==r;++o)e[o]=i[s+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},gz=class extends pg{constructor(n,e,i,r){super(n,e,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:_p,endingEnd:_p}}intervalChanged_(n,e,i){const r=this.parameterPositions;let s=n-2,o=n+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case wp:s=n,a=2*e-i;break;case ty:s=r.length-2,a=e+r[s]-r[s+1];break;default:s=n,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case wp:o=n,l=2*i-e;break;case ty:o=1,l=i+r[1]-r[0];break;default:o=n-1,l=e}const c=(i-e)*.5,h=this.valueSize;this._weightPrev=c/(e-a),this._weightNext=c/(l-i),this._offsetPrev=s*h,this._offsetNext=o*h}interpolate_(n,e,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=n*a,c=l-a,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,f=this._weightNext,m=(i-e)/(r-e),g=m*m,v=g*m,y=-d*v+2*d*g-d*m,A=(1+d)*v+(-1.5-2*d)*g+(-.5+d)*m+1,b=(-1-f)*v+(1.5+f)*g+.5*m,x=f*v-f*g;for(let _=0;_!==a;++_)s[_]=y*o[h+_]+A*o[c+_]+b*o[l+_]+x*o[u+_];return s}},VR=class extends pg{constructor(n,e,i,r){super(n,e,i,r)}interpolate_(n,e,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=n*a,c=l-a,h=(i-e)/(r-e),u=1-h;for(let d=0;d!==a;++d)s[d]=o[c+d]*u+o[l+d]*h;return s}},vz=class extends pg{constructor(n,e,i,r){super(n,e,i,r)}interpolate_(n){return this.copySampleValue_(n-1)}},cl=class{constructor(n,e,i,r){if(n===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=Fp(e,this.TimeBufferType),this.values=Fp(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(n){const e=n.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(n);else{i={name:n.name,times:Fp(n.times,Array),values:Fp(n.values,Array)};const r=n.getInterpolation();r!==n.DefaultInterpolation&&(i.interpolation=r)}return i.type=n.ValueTypeName,i}InterpolantFactoryMethodDiscrete(n){return new vz(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodLinear(n){return new VR(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodSmooth(n){return new gz(this.times,this.values,this.getValueSize(),n)}setInterpolation(n){let e;switch(n){case Au:e=this.InterpolantFactoryMethodDiscrete;break;case Xl:e=this.InterpolantFactoryMethodLinear;break;case D_:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(n!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Au;case this.InterpolantFactoryMethodLinear:return Xl;case this.InterpolantFactoryMethodSmooth:return D_}}getValueSize(){return this.values.length/this.times.length}shift(n){if(n!==0){const e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]+=n}return this}scale(n){if(n!==1){const e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]*=n}return this}trim(n,e){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<n;)++s;for(;o!==-1&&i[o]>e;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=i.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let n=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);const i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),n=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),n=!1;break}o=l}if(r!==void 0&&fz(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),n=!1;break}}return n}optimize(){const n=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===D_,s=n.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=n[a],h=n[a+1];if(c!==h&&(a!==1||c!==n[0]))if(r)l=!0;else{const u=a*i,d=u-i,f=u+i;for(let m=0;m!==i;++m){const g=e[u+m];if(g!==e[d+m]||g!==e[f+m]){l=!0;break}}}if(l){if(a!==o){n[o]=n[a];const u=a*i,d=o*i;for(let f=0;f!==i;++f)e[d+f]=e[u+f]}++o}}if(s>0){n[o]=n[s];for(let a=s*i,l=o*i,c=0;c!==i;++c)e[l+c]=e[a+c];++o}return o!==n.length?(this.times=n.slice(0,o),this.values=e.slice(0,o*i)):(this.times=n,this.values=e),this}clone(){const n=this.times.slice(),e=this.values.slice(),i=this.constructor,r=new i(this.name,n,e);return r.createInterpolant=this.createInterpolant,r}};cl.prototype.TimeBufferType=Float32Array,cl.prototype.ValueBufferType=Float32Array,cl.prototype.DefaultInterpolation=Xl;let Np=class extends cl{};Np.prototype.ValueTypeName="bool",Np.prototype.ValueBufferType=Array,Np.prototype.DefaultInterpolation=Au,Np.prototype.InterpolantFactoryMethodLinear=void 0,Np.prototype.InterpolantFactoryMethodSmooth=void 0;let jw=class extends cl{};jw.prototype.ValueTypeName="color";let ch=class extends cl{};ch.prototype.ValueTypeName="number";let yz=class extends pg{constructor(n,e,i,r){super(n,e,i,r)}interpolate_(n,e,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-e)/(r-e);let c=n*a;for(let h=c+a;c!==h;c+=4)Ce.slerpFlat(s,0,o,c-a,o,c,l);return s}},hl=class extends cl{InterpolantFactoryMethodLinear(n){return new yz(this.times,this.values,this.getValueSize(),n)}};hl.prototype.ValueTypeName="quaternion",hl.prototype.DefaultInterpolation=Xl,hl.prototype.InterpolantFactoryMethodSmooth=void 0;let zp=class extends cl{};zp.prototype.ValueTypeName="string",zp.prototype.ValueBufferType=Array,zp.prototype.DefaultInterpolation=Au,zp.prototype.InterpolantFactoryMethodLinear=void 0,zp.prototype.InterpolantFactoryMethodSmooth=void 0;let Jl=class extends cl{};Jl.prototype.ValueTypeName="vector";let $s=class{constructor(n,e=-1,i,r=L_){this.name=n,this.tracks=i,this.duration=e,this.blendMode=r,this.uuid=No(),this.duration<0&&this.resetDuration()}static parse(n){const e=[],i=n.tracks,r=1/(n.fps||1);for(let o=0,a=i.length;o!==a;++o)e.push(pte(i[o]).scale(r));const s=new this(n.name,n.duration,e,n.blendMode);return s.uuid=n.uuid,s}static toJSON(n){const e=[],i=n.tracks,r={name:n.name,duration:n.duration,tracks:e,uuid:n.uuid,blendMode:n.blendMode};for(let s=0,o=i.length;s!==o;++s)e.push(cl.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(n,e,i,r){const s=e.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const h=mz(l);l=GR(l,1,h),c=GR(c,1,h),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new ch(".morphTargetInfluences["+e[a].name+"]",l,c).scale(1/i))}return new this(n,-1,o)}static findByName(n,e){let i=n;if(!Array.isArray(n)){const r=n;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null}static CreateClipsFromMorphTargetSequences(n,e,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=n.length;a<l;a++){const c=n[a],h=c.name.match(s);if(h&&h.length>1){const u=h[1];let d=r[u];d||(r[u]=d=[]),d.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],e,i));return o}static parseAnimation(n,e){if(!n)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(h,u,d,f,m){if(d.length!==0){const g=[],v=[];HR(d,g,v,f),g.length!==0&&m.push(new h(u,g,v))}},r=[],s=n.name||"default",o=n.fps||30,a=n.blendMode;let l=n.length||-1;const c=n.hierarchy||[];for(let h=0;h<c.length;h++){const u=c[h].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const d={};let f;for(f=0;f<u.length;f++)if(u[f].morphTargets)for(let m=0;m<u[f].morphTargets.length;m++)d[u[f].morphTargets[m]]=-1;for(const m in d){const g=[],v=[];for(let y=0;y!==u[f].morphTargets.length;++y){const A=u[f];g.push(A.time),v.push(A.morphTarget===m?1:0)}r.push(new ch(".morphTargetInfluence["+m+"]",g,v))}l=d.length*o}else{const d=".bones["+e[h].name+"]";i(Jl,d+".position",u,"pos",r),i(hl,d+".quaternion",u,"rot",r),i(Jl,d+".scale",u,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const n=this.tracks;let e=0;for(let i=0,r=n.length;i!==r;++i){const s=this.tracks[i];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this}trim(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].trim(0,this.duration);return this}validate(){let n=!0;for(let e=0;e<this.tracks.length;e++)n=n&&this.tracks[e].validate();return n}optimize(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].optimize();return this}clone(){const n=[];for(let e=0;e<this.tracks.length;e++)n.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,n,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function dte(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ch;case"vector":case"vector2":case"vector3":case"vector4":return Jl;case"color":return jw;case"quaternion":return hl;case"bool":case"boolean":return Np;case"string":return zp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function pte(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=dte(n.type);if(n.times===void 0){const i=[],r=[];HR(n.keys,i,r,"value"),n.times=i,n.values=r}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const hh={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};let Gw=class{constructor(n,e,i){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=n,this.onProgress=e,this.onError=i,this.itemStart=function(h){a++,s===!1&&r.onStart!==void 0&&r.onStart(h,o,a),s=!0},this.itemEnd=function(h){o++,r.onProgress!==void 0&&r.onProgress(h,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(h){r.onError!==void 0&&r.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=c.length;u<d;u+=2){const f=c[u],m=c[u+1];if(f.global&&(f.lastIndex=0),f.test(h))return m}return null}}};const Az=new Gw;let Kn=class{constructor(n){this.manager=n!==void 0?n:Az,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,e){const i=this;return new Promise(function(r,s){i.load(n,r,e,s)})}parse(){}setCrossOrigin(n){return this.crossOrigin=n,this}setWithCredentials(n){return this.withCredentials=n,this}setPath(n){return this.path=n,this}setResourcePath(n){return this.resourcePath=n,this}setRequestHeader(n){return this.requestHeader=n,this}};Kn.DEFAULT_MATERIAL_NAME="__DEFAULT";const uh={};let fte=class extends Error{constructor(n,e){super(n),this.response=e}},Yr=class extends Kn{constructor(n){super(n)}load(n,e,i,r){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const s=hh.get(n);if(s!==void 0)return this.manager.itemStart(n),setTimeout(()=>{e&&e(s),this.manager.itemEnd(n)},0),s;if(uh[n]!==void 0){uh[n].push({onLoad:e,onProgress:i,onError:r});return}uh[n]=[],uh[n].push({onLoad:e,onProgress:i,onError:r});const o=new Request(n,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=uh[n],u=c.body.getReader(),d=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),f=d?parseInt(d):0,m=f!==0;let g=0;const v=new ReadableStream({start(y){A();function A(){u.read().then(({done:b,value:x})=>{if(b)y.close();else{g+=x.byteLength;const _=new ProgressEvent("progress",{lengthComputable:m,loaded:g,total:f});for(let w=0,T=h.length;w<T;w++){const M=h[w];M.onProgress&&M.onProgress(_)}y.enqueue(x),A()}})}}});return new Response(v)}else throw new fte(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),u=h&&h[1]?h[1].toLowerCase():void 0,d=new TextDecoder(u);return c.arrayBuffer().then(f=>d.decode(f))}}}).then(c=>{hh.add(n,c);const h=uh[n];delete uh[n];for(let u=0,d=h.length;u<d;u++){const f=h[u];f.onLoad&&f.onLoad(c)}}).catch(c=>{const h=uh[n];if(h===void 0)throw this.manager.itemError(n),c;delete uh[n];for(let u=0,d=h.length;u<d;u++){const f=h[u];f.onError&&f.onError(c)}this.manager.itemError(n)}).finally(()=>{this.manager.itemEnd(n)}),this.manager.itemStart(n)}setResponseType(n){return this.responseType=n,this}setMimeType(n){return this.mimeType=n,this}};class mte extends Kn{constructor(e){super(e)}load(e,i,r,s){const o=this,a=new Yr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{i(o.parse(JSON.parse(l)))}catch(c){s?s(c):console.error(c),o.manager.itemError(e)}},r,s)}parse(e){const i=[];for(let r=0;r<e.length;r++){const s=$s.parse(e[r]);i.push(s)}return i}}class gte extends Kn{constructor(e){super(e)}load(e,i,r,s){const o=this,a=[],l=new Ru,c=new Yr(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(o.withCredentials);let h=0;function u(d){c.load(e[d],function(f){const m=o.parse(f,!0);a[d]={width:m.width,height:m.height,format:m.format,mipmaps:m.mipmaps},h+=1,h===6&&(m.mipmapCount===1&&(l.minFilter=Dt),l.image=a,l.format=m.format,l.needsUpdate=!0,i&&i(l))},r,s)}if(Array.isArray(e))for(let d=0,f=e.length;d<f;++d)u(d);else c.load(e,function(d){const f=o.parse(d,!0);if(f.isCubemap){const m=f.mipmaps.length/f.mipmapCount;for(let g=0;g<m;g++){a[g]={mipmaps:[]};for(let v=0;v<f.mipmapCount;v++)a[g].mipmaps.push(f.mipmaps[g*f.mipmapCount+v]),a[g].format=f.format,a[g].width=f.width,a[g].height=f.height}l.image=a}else l.image.width=f.width,l.image.height=f.height,l.mipmaps=f.mipmaps;f.mipmapCount===1&&(l.minFilter=Dt),l.format=f.format,l.needsUpdate=!0,i&&i(l)},r,s);return l}}let By=class extends Kn{constructor(n){super(n)}load(n,e,i,r){this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const s=this,o=hh.get(n);if(o!==void 0)return s.manager.itemStart(n),setTimeout(function(){e&&e(o),s.manager.itemEnd(n)},0),o;const a=cy("img");function l(){h(),hh.add(n,this),e&&e(this),s.manager.itemEnd(n)}function c(u){h(),r&&r(u),s.manager.itemError(n),s.manager.itemEnd(n)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),n.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(n),a.src=n,a}};class vte extends Kn{constructor(e){super(e)}load(e,i,r,s){const o=new gy;o.colorSpace=gt;const a=new By(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let l=0;function c(h){a.load(e[h],function(u){o.images[h]=u,l++,l===6&&(o.needsUpdate=!0,i&&i(o))},void 0,s)}for(let h=0;h<e.length;++h)c(h);return o}}class QR extends Kn{constructor(e){super(e)}load(e,i,r,s){const o=this,a=new Ms,l=new Yr(this.manager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(o.withCredentials),l.load(e,function(c){let h;try{h=o.parse(c)}catch(u){if(s!==void 0)s(u);else{console.error(u);return}}h.image!==void 0?a.image=h.image:h.data!==void 0&&(a.image.width=h.width,a.image.height=h.height,a.image.data=h.data),a.wrapS=h.wrapS!==void 0?h.wrapS:Yn,a.wrapT=h.wrapT!==void 0?h.wrapT:Yn,a.magFilter=h.magFilter!==void 0?h.magFilter:Dt,a.minFilter=h.minFilter!==void 0?h.minFilter:Dt,a.anisotropy=h.anisotropy!==void 0?h.anisotropy:1,h.colorSpace!==void 0&&(a.colorSpace=h.colorSpace),h.flipY!==void 0&&(a.flipY=h.flipY),h.format!==void 0&&(a.format=h.format),h.type!==void 0&&(a.type=h.type),h.mipmaps!==void 0&&(a.mipmaps=h.mipmaps,a.minFilter=bo),h.mipmapCount===1&&(a.minFilter=Dt),h.generateMipmaps!==void 0&&(a.generateMipmaps=h.generateMipmaps),a.needsUpdate=!0,i&&i(a,h)},r,s),a}}let Kl=class extends Kn{constructor(n){super(n)}load(n,e,i,r){const s=new Gt,o=new By(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(n,function(a){s.image=a,s.needsUpdate=!0,e!==void 0&&e(s)},i,r),s}},Bu=class extends ve{constructor(n,e=1){super(),this.isLight=!0,this.type="Light",this.color=new be(n),this.intensity=e}dispose(){}copy(n,e){return super.copy(n,e),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const e=super.toJSON(n);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}};class WR extends Bu{constructor(e,i,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ve.DEFAULT_UP),this.updateMatrix(),this.groundColor=new be(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const XR=new he,bz=new S,xz=new S;let qR=class{constructor(n){this.camera=n,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new J(512,512),this.map=null,this.mapPass=null,this.matrix=new he,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Rp,this._frameExtents=new J(1,1),this._viewportCount=1,this._viewports=[new qe(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(n){const e=this.camera,i=this.matrix;bz.setFromMatrixPosition(n.matrixWorld),e.position.copy(bz),xz.setFromMatrixPosition(n.target.matrixWorld),e.lookAt(xz),e.updateMatrixWorld(),XR.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(XR),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(XR)}getViewport(n){return this._viewports[n]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(n){return this.camera=n.camera.clone(),this.bias=n.bias,this.radius=n.radius,this.mapSize.copy(n.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const n={};return this.bias!==0&&(n.bias=this.bias),this.normalBias!==0&&(n.normalBias=this.normalBias),this.radius!==1&&(n.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(n.mapSize=this.mapSize.toArray()),n.camera=this.camera.toJSON(!1).object,delete n.camera.matrix,n}},yte=class extends qR{constructor(){super(new Ft(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(n){const e=this.camera,i=Om*2*n.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=n.distance||e.far;(i!==e.fov||r!==e.aspect||s!==e.far)&&(e.fov=i,e.aspect=r,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(n)}copy(n){return super.copy(n),this.focus=n.focus,this}},ky=class extends Bu{constructor(n,e,i=0,r=Math.PI/3,s=0,o=2){super(n,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ve.DEFAULT_UP),this.updateMatrix(),this.target=new ve,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new yte}get power(){return this.intensity*Math.PI}set power(n){this.intensity=n/Math.PI}dispose(){this.shadow.dispose()}copy(n,e){return super.copy(n,e),this.distance=n.distance,this.angle=n.angle,this.penumbra=n.penumbra,this.decay=n.decay,this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}};const _z=new he,Oy=new S,YR=new S;let Ate=class extends qR{constructor(){super(new Ft(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new J(4,2),this._viewportCount=6,this._viewports=[new qe(2,1,1,1),new qe(0,1,1,1),new qe(3,1,1,1),new qe(1,1,1,1),new qe(3,0,1,1),new qe(1,0,1,1)],this._cubeDirections=[new S(1,0,0),new S(-1,0,0),new S(0,0,1),new S(0,0,-1),new S(0,1,0),new S(0,-1,0)],this._cubeUps=[new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,0,1),new S(0,0,-1)]}updateMatrices(n,e=0){const i=this.camera,r=this.matrix,s=n.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Oy.setFromMatrixPosition(n.matrixWorld),i.position.copy(Oy),YR.copy(i.position),YR.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(YR),i.updateMatrixWorld(),r.makeTranslation(-Oy.x,-Oy.y,-Oy.z),_z.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_z)}},jp=class extends Bu{constructor(n,e,i=0,r=2){super(n,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Ate}get power(){return this.intensity*4*Math.PI}set power(n){this.intensity=n/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(n,e){return super.copy(n,e),this.distance=n.distance,this.decay=n.decay,this.shadow=n.shadow.clone(),this}},bte=class extends qR{constructor(){super(new Yl(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Gp=class extends Bu{constructor(n,e){super(n,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ve.DEFAULT_UP),this.updateMatrix(),this.target=new ve,this.shadow=new bte}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}};class Hw extends Bu{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class wz extends Bu{constructor(e,i,r=10,s=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class Sz{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new S)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const r=e.x,s=e.y,o=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*s),i.addScaledVector(a[2],.488603*o),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*s)),i.addScaledVector(a[5],1.092548*(s*o)),i.addScaledVector(a[6],.315392*(3*o*o-1)),i.addScaledVector(a[7],1.092548*(r*o)),i.addScaledVector(a[8],.546274*(r*r-s*s)),i}getIrradianceAt(e,i){const r=e.x,s=e.y,o=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*s),i.addScaledVector(a[2],2*.511664*o),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*s),i.addScaledVector(a[5],2*.429043*s*o),i.addScaledVector(a[6],.743125*o*o-.247708),i.addScaledVector(a[7],2*.429043*r*o),i.addScaledVector(a[8],.429043*(r*r-s*s)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const r=this.coefficients;for(let s=0;s<9;s++)r[s].fromArray(e,i+s*3);return this}toArray(e=[],i=0){const r=this.coefficients;for(let s=0;s<9;s++)r[s].toArray(e,i+s*3);return e}static getBasisAt(e,i){const r=e.x,s=e.y,o=e.z;i[0]=.282095,i[1]=.488603*s,i[2]=.488603*o,i[3]=.488603*r,i[4]=1.092548*r*s,i[5]=1.092548*s*o,i[6]=.315392*(3*o*o-1),i[7]=1.092548*r*o,i[8]=.546274*(r*r-s*s)}}class Cz extends Bu{constructor(e=new Sz,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class PT extends Kn{constructor(e){super(e),this.textures={}}load(e,i,r,s){const o=this,a=new Yr(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(l){try{i(o.parse(JSON.parse(l)))}catch(c){s?s(c):console.error(c),o.manager.itemError(e)}},r,s)}parse(e){const i=this.textures;function r(o){return i[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),i[o]}const s=PT.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new be().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(s.blendSrc=e.blendSrc),e.blendDst!==void 0&&(s.blendDst=e.blendDst),e.blendEquation!==void 0&&(s.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(s.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(s.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==void 0&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const a=e.uniforms[o];switch(s.uniforms[o]={},a.type){case"t":s.uniforms[o].value=r(a.value);break;case"c":s.uniforms[o].value=new be().setHex(a.value);break;case"v2":s.uniforms[o].value=new J().fromArray(a.value);break;case"v3":s.uniforms[o].value=new S().fromArray(a.value);break;case"v4":s.uniforms[o].value=new qe().fromArray(a.value);break;case"m3":s.uniforms[o].value=new Lt().fromArray(a.value);break;case"m4":s.uniforms[o].value=new he().fromArray(a.value);break;default:s.uniforms[o].value=a.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const o in e.extensions)s.extensions[o]=e.extensions[o];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=r(e.map)),e.matcap!==void 0&&(s.matcap=r(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),s.normalScale=new J().fromArray(o)}return e.displacementMap!==void 0&&(s.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=r(e.envMap)),e.envMapRotation!==void 0&&s.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new J().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=r(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const i={ShadowMaterial:Fw,SpriteMaterial:gw,RawShaderMaterial:Nw,ShaderMaterial:Bt,PointsMaterial:Iu,MeshPhysicalMaterial:Co,MeshStandardMaterial:mr,MeshPhongMaterial:dg,MeshToonMaterial:uz,MeshNormalMaterial:zw,MeshLambertMaterial:jR,MeshDepthMaterial:vy,MeshDistanceMaterial:dR,MeshBasicMaterial:Jt,MeshMatcapMaterial:dz,LineDashedMaterial:pz,LineBasicMaterial:zi,Material:Ut};return new i[e]}}let dh=class{static decodeText(n){if(typeof TextDecoder<"u")return new TextDecoder().decode(n);let e="";for(let i=0,r=n.length;i<r;i++)e+=String.fromCharCode(n[i]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(n){const e=n.lastIndexOf("/");return e===-1?"./":n.slice(0,e+1)}static resolveURL(n,e){return typeof n!="string"||n===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(n)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(n)||/^data:.*,.*$/i.test(n)||/^blob:.*$/i.test(n)?n:e+n)}};class Vw extends dt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Ez extends Kn{constructor(e){super(e)}load(e,i,r,s){const o=this,a=new Yr(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,function(l){try{i(o.parse(JSON.parse(l)))}catch(c){s?s(c):console.error(c),o.manager.itemError(e)}},r,s)}parse(e){const i={},r={};function s(f,m){if(i[m]!==void 0)return i[m];const g=f.interleavedBuffers[m],v=o(f,g.buffer),y=Dm(g.type,v),A=new yy(y,g.stride);return A.uuid=g.uuid,i[m]=A,A}function o(f,m){if(r[m]!==void 0)return r[m];const g=f.arrayBuffers[m],v=new Uint32Array(g).buffer;return r[m]=v,v}const a=e.isInstancedBufferGeometry?new Vw:new dt,l=e.data.index;if(l!==void 0){const f=Dm(l.type,l.array);a.setIndex(new Ye(f,1))}const c=e.data.attributes;for(const f in c){const m=c[f];let g;if(m.isInterleavedBufferAttribute){const v=s(e.data,m.data);g=new Go(v,m.itemSize,m.offset,m.normalized)}else{const v=Dm(m.type,m.array),y=m.isInstancedBufferAttribute?So:Ye;g=new y(v,m.itemSize,m.normalized)}m.name!==void 0&&(g.name=m.name),m.usage!==void 0&&g.setUsage(m.usage),a.setAttribute(f,g)}const h=e.data.morphAttributes;if(h)for(const f in h){const m=h[f],g=[];for(let v=0,y=m.length;v<y;v++){const A=m[v];let b;if(A.isInterleavedBufferAttribute){const x=s(e.data,A.data);b=new Go(x,A.itemSize,A.offset,A.normalized)}else{const x=Dm(A.type,A.array);b=new Ye(x,A.itemSize,A.normalized)}A.name!==void 0&&(b.name=A.name),g.push(b)}a.morphAttributes[f]=g}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let f=0,m=u.length;f!==m;++f){const g=u[f];a.addGroup(g.start,g.count,g.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const f=new S;d.center!==void 0&&f.fromArray(d.center),a.boundingSphere=new Zi(f,d.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class xte extends Kn{constructor(e){super(e)}load(e,i,r,s){const o=this,a=this.path===""?dh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const l=new Yr(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){let h=null;try{h=JSON.parse(c)}catch(d){s!==void 0&&s(d),console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message);return}const u=h.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){s!==void 0&&s(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(h,i)},r,s)}async loadAsync(e,i){const r=this,s=this.path===""?dh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const o=new Yr(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials);const a=await o.loadAsync(e,i),l=JSON.parse(a),c=l.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(l)}parse(e,i){const r=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,s),a=this.parseImages(e.images,function(){i!==void 0&&i(h)}),l=this.parseTextures(e.textures,a),c=this.parseMaterials(e.materials,l),h=this.parseObject(e.object,o,c,l,r),u=this.parseSkeletons(e.skeletons,h);if(this.bindSkeletons(h,u),i!==void 0){let d=!1;for(const f in a)if(a[f].data instanceof HTMLImageElement){d=!0;break}d===!1&&i(h)}return h}async parseAsync(e){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,s,l,a,i),h=this.parseSkeletons(e.skeletons,c);return this.bindSkeletons(c,h),c}parseShapes(e){const i={};if(e!==void 0)for(let r=0,s=e.length;r<s;r++){const o=new Pu().fromJSON(e[r]);i[o.uuid]=o}return i}parseSkeletons(e,i){const r={},s={};if(i.traverse(function(o){o.isBone&&(s[o.uuid]=o)}),e!==void 0)for(let o=0,a=e.length;o<a;o++){const l=new _y().fromJSON(e[o],s);r[l.uuid]=l}return r}parseGeometries(e,i){const r={};if(e!==void 0){const s=new Ez;for(let o=0,a=e.length;o<a;o++){let l;const c=e[o];switch(c.type){case"BufferGeometry":case"InstancedBufferGeometry":l=s.parse(c);break;default:c.type in hz?l=hz[c.type].fromJSON(c,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${c.type}"`)}l.uuid=c.uuid,c.name!==void 0&&(l.name=c.name),c.userData!==void 0&&(l.userData=c.userData),r[c.uuid]=l}}return r}parseMaterials(e,i){const r={},s={};if(e!==void 0){const o=new PT;o.setTextures(i);for(let a=0,l=e.length;a<l;a++){const c=e[a];r[c.uuid]===void 0&&(r[c.uuid]=o.parse(c)),s[c.uuid]=r[c.uuid]}}return s}parseAnimations(e){const i={};if(e!==void 0)for(let r=0;r<e.length;r++){const s=e[r],o=$s.parse(s);i[o.uuid]=o}return i}parseImages(e,i){const r=this,s={};let o;function a(c){return r.manager.itemStart(c),o.load(c,function(){r.manager.itemEnd(c)},void 0,function(){r.manager.itemError(c),r.manager.itemEnd(c)})}function l(c){if(typeof c=="string"){const h=c,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:r.resourcePath+h;return a(u)}else return c.data?{data:Dm(c.type,c.data),width:c.width,height:c.height}:null}if(e!==void 0&&e.length>0){const c=new Gw(i);o=new By(c),o.setCrossOrigin(this.crossOrigin);for(let h=0,u=e.length;h<u;h++){const d=e[h],f=d.url;if(Array.isArray(f)){const m=[];for(let g=0,v=f.length;g<v;g++){const y=f[g],A=l(y);A!==null&&(A instanceof HTMLImageElement?m.push(A):m.push(new Ms(A.data,A.width,A.height)))}s[d.uuid]=new th(m)}else{const m=l(d.url);s[d.uuid]=new th(m)}}}return s}async parseImagesAsync(e){const i=this,r={};let s;async function o(a){if(typeof a=="string"){const l=a,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:i.resourcePath+l;return await s.loadAsync(c)}else return a.data?{data:Dm(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){s=new By(this.manager),s.setCrossOrigin(this.crossOrigin);for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.url;if(Array.isArray(h)){const u=[];for(let d=0,f=h.length;d<f;d++){const m=h[d],g=await o(m);g!==null&&(g instanceof HTMLImageElement?u.push(g):u.push(new Ms(g.data,g.width,g.height)))}r[c.uuid]=new th(u)}else{const u=await o(c.url);r[c.uuid]=new th(u)}}}return r}parseTextures(e,i){function r(o,a){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),a[o])}const s={};if(e!==void 0)for(let o=0,a=e.length;o<a;o++){const l=e[o];l.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',l.uuid),i[l.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",l.image);const c=i[l.image],h=c.data;let u;Array.isArray(h)?(u=new gy,h.length===6&&(u.needsUpdate=!0)):(h&&h.data?u=new Ms:u=new Gt,h&&(u.needsUpdate=!0)),u.source=c,u.uuid=l.uuid,l.name!==void 0&&(u.name=l.name),l.mapping!==void 0&&(u.mapping=r(l.mapping,_te)),l.channel!==void 0&&(u.channel=l.channel),l.offset!==void 0&&u.offset.fromArray(l.offset),l.repeat!==void 0&&u.repeat.fromArray(l.repeat),l.center!==void 0&&u.center.fromArray(l.center),l.rotation!==void 0&&(u.rotation=l.rotation),l.wrap!==void 0&&(u.wrapS=r(l.wrap[0],Mz),u.wrapT=r(l.wrap[1],Mz)),l.format!==void 0&&(u.format=l.format),l.internalFormat!==void 0&&(u.internalFormat=l.internalFormat),l.type!==void 0&&(u.type=l.type),l.colorSpace!==void 0&&(u.colorSpace=l.colorSpace),l.minFilter!==void 0&&(u.minFilter=r(l.minFilter,Tz)),l.magFilter!==void 0&&(u.magFilter=r(l.magFilter,Tz)),l.anisotropy!==void 0&&(u.anisotropy=l.anisotropy),l.flipY!==void 0&&(u.flipY=l.flipY),l.generateMipmaps!==void 0&&(u.generateMipmaps=l.generateMipmaps),l.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=l.premultiplyAlpha),l.unpackAlignment!==void 0&&(u.unpackAlignment=l.unpackAlignment),l.compareFunction!==void 0&&(u.compareFunction=l.compareFunction),l.userData!==void 0&&(u.userData=l.userData),s[l.uuid]=u}return s}parseObject(e,i,r,s,o){let a;function l(f){return i[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",f),i[f]}function c(f){if(f!==void 0){if(Array.isArray(f)){const m=[];for(let g=0,v=f.length;g<v;g++){const y=f[g];r[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),m.push(r[y])}return m}return r[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),r[f]}}function h(f){return s[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",f),s[f]}let u,d;switch(e.type){case"Scene":a=new Er,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new be(e.background):a.background=h(e.background)),e.environment!==void 0&&(a.environment=h(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new mw(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new xT(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new Ft(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Yl(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new Hw(e.color,e.intensity);break;case"DirectionalLight":a=new Gp(e.color,e.intensity);break;case"PointLight":a=new jp(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new wz(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new ky(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new WR(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new Cz().fromJSON(e);break;case"SkinnedMesh":u=l(e.geometry),d=c(e.material),a=new wo(u,d),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":u=l(e.geometry),d=c(e.material),a=new pe(u,d);break;case"InstancedMesh":u=l(e.geometry),d=c(e.material);const f=e.count,m=e.instanceMatrix,g=e.instanceColor;a=new bR(u,d,f),a.instanceMatrix=new So(new Float32Array(m.array),16),g!==void 0&&(a.instanceColor=new So(new Float32Array(g.array),g.itemSize));break;case"BatchedMesh":u=l(e.geometry),d=c(e.material),a=new Cw(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,d),a.geometry=u,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map(v=>{const y=new Ht;y.min.fromArray(v.boxMin),y.max.fromArray(v.boxMax);const A=new Zi;return A.radius=v.sphereRadius,A.center.fromArray(v.sphereCenter),{boxInitialized:v.boxInitialized,box:y,sphereInitialized:v.sphereInitialized,sphere:A}}),a._maxGeometryCount=e.maxGeometryCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=h(e.matricesTexture.uuid);break;case"LOD":a=new vR;break;case"Line":a=new hn(l(e.geometry),c(e.material));break;case"LineLoop":a=new SR(l(e.geometry),c(e.material));break;case"LineSegments":a=new Is(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new hg(l(e.geometry),c(e.material));break;case"Sprite":a=new gR(c(e.material));break;case"Group":a=new Cr;break;case"Bone":a=new Dp;break;default:a=new ve}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let m=0;m<f.length;m++)a.add(this.parseObject(f[m],i,r,s,o))}if(e.animations!==void 0){const f=e.animations;for(let m=0;m<f.length;m++){const g=f[m];a.animations.push(o[g])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const f=e.levels;for(let m=0;m<f.length;m++){const g=f[m],v=a.getObjectByProperty("uuid",g.object);v!==void 0&&a.addLevel(v,g.distance,g.hysteresis)}}return a}bindSkeletons(e,i){Object.keys(i).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const s=i[r.skeleton];s===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(s,r.bindMatrix)}})}}const _te={UVMapping:C_,CubeReflectionMapping:Zc,CubeRefractionMapping:gu,EquirectangularReflectionMapping:qs,EquirectangularRefractionMapping:Rm,CubeUVReflectionMapping:Pm},Mz={RepeatWrapping:Ao,ClampToEdgeWrapping:Yn,MirroredRepeatWrapping:yp},Tz={NearestFilter:Rt,NearestMipmapNearestFilter:Bm,NearestMipmapLinearFilter:$c,LinearFilter:Dt,LinearMipmapNearestFilter:Ap,LinearMipmapLinearFilter:bo};let Iz=class extends Kn{constructor(n){super(n),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(n){return this.options=n,this}load(n,e,i,r){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const s=this,o=hh.get(n);if(o!==void 0){if(s.manager.itemStart(n),o.then){o.then(c=>{e&&e(c),s.manager.itemEnd(n)}).catch(c=>{r&&r(c)});return}return setTimeout(function(){e&&e(o),s.manager.itemEnd(n)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(n,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return hh.add(n,c),e&&e(c),s.manager.itemEnd(n),c}).catch(function(c){r&&r(c),hh.remove(n),s.manager.itemError(n),s.manager.itemEnd(n)});hh.add(n,l),s.manager.itemStart(n)}},Qw;class Ww{static getContext(){return Qw===void 0&&(Qw=new(window.AudioContext||window.webkitAudioContext)),Qw}static setContext(e){Qw=e}}class Xw extends Kn{constructor(e){super(e)}load(e,i,r,s){const o=this,a=new Yr(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{const h=c.slice(0);Ww.getContext().decodeAudioData(h,function(u){i(u)}).catch(l)}catch(h){l(h)}},r,s);function l(c){s?s(c):console.error(c),o.manager.itemError(e)}}}const Rz=new he,Pz=new he,Hp=new he;class wte{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ft,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ft,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const i=this._cache;if(i.focus!==e.focus||i.fov!==e.fov||i.aspect!==e.aspect*this.aspect||i.near!==e.near||i.far!==e.far||i.zoom!==e.zoom||i.eyeSep!==this.eyeSep){i.focus=e.focus,i.fov=e.fov,i.aspect=e.aspect*this.aspect,i.near=e.near,i.far=e.far,i.zoom=e.zoom,i.eyeSep=this.eyeSep,Hp.copy(e.projectionMatrix);const r=i.eyeSep/2,s=r*i.near/i.focus,o=i.near*Math.tan(Sp*i.fov*.5)/i.zoom;let a,l;Pz.elements[12]=-r,Rz.elements[12]=r,a=-o*i.aspect+s,l=o*i.aspect+s,Hp.elements[0]=2*i.near/(l-a),Hp.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Hp),a=-o*i.aspect-s,l=o*i.aspect-s,Hp.elements[0]=2*i.near/(l-a),Hp.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Hp)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Pz),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Rz)}}let JR=class{constructor(n=!0){this.autoStart=n,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Bz(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let n=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Bz();n=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=n}return n}};function Bz(){return(typeof performance>"u"?Date:performance).now()}const Zl=new S,kz=new Ce,Ste=new S,Vp=new S;let Oz=class extends ve{constructor(){super(),this.type="AudioListener",this.context=Ww.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new JR}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(n){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=n,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}updateMatrixWorld(n){super.updateMatrixWorld(n);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Zl,kz,Ste),!(!Number.isFinite(Zl.x)||!Number.isFinite(Zl.y)||!Number.isFinite(Zl.z)))if(Vp.set(0,0,-1).applyQuaternion(kz),e.positionX){const r=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Zl.x,r),e.positionY.linearRampToValueAtTime(Zl.y,r),e.positionZ.linearRampToValueAtTime(Zl.z,r),e.forwardX.linearRampToValueAtTime(Vp.x,r),e.forwardY.linearRampToValueAtTime(Vp.y,r),e.forwardZ.linearRampToValueAtTime(Vp.z,r),e.upX.linearRampToValueAtTime(i.x,r),e.upY.linearRampToValueAtTime(i.y,r),e.upZ.linearRampToValueAtTime(i.z,r)}else e.setPosition(Zl.x,Zl.y,Zl.z),e.setOrientation(Vp.x,Vp.y,Vp.z,i.x,i.y,i.z)}},KR=class extends ve{constructor(n){super(),this.type="Audio",this.listener=n,this.context=n.context,this.gain=this.context.createGain(),this.gain.connect(n.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(n){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=n,this.connect(),this}setMediaElementSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(n),this.connect(),this}setMediaStreamSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(n),this.connect(),this}setBuffer(n){return this.buffer=n,this.sourceType="buffer",this.autoplay&&this.play(),this}play(n=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+n;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||(this.buffer?this.buffer.duration:Number.MAX_VALUE))),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let n=1,e=this.filters.length;n<e;n++)this.filters[n-1].connect(this.filters[n]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let n=1,e=this.filters.length;n<e;n++)this.filters[n-1].disconnect(this.filters[n]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(n){return n||(n=[]),this._connected===!0?(this.disconnect(),this.filters=n.slice(),this.connect()):this.filters=n.slice(),this}setDetune(n){return this.detune=n,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(n){return this.setFilters(n?[n]:[])}setPlaybackRate(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=n,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=n,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(n){return this.loopStart=n,this}setLoopEnd(n){return this.loopEnd=n,this}getVolume(){return this.gain.gain.value}setVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}};const Qp=new S,Dz=new Ce,Cte=new S,Wp=new S;class Lz extends KR{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,i,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Qp,Dz,Cte),Wp.set(0,0,1).applyQuaternion(Dz);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(Qp.x,r),i.positionY.linearRampToValueAtTime(Qp.y,r),i.positionZ.linearRampToValueAtTime(Qp.z,r),i.orientationX.linearRampToValueAtTime(Wp.x,r),i.orientationY.linearRampToValueAtTime(Wp.y,r),i.orientationZ.linearRampToValueAtTime(Wp.z,r)}else i.setPosition(Qp.x,Qp.y,Qp.z),i.setOrientation(Wp.x,Wp.y,Wp.z)}}class Ete{constructor(e,i=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)e+=i[r];return e/i.length}}class Uz{constructor(e,i,r){this.binding=e,this.valueSize=r;let s,o,a;switch(i){case"quaternion":s=this._slerp,o=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":s=this._select,o=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:s=this._lerp,o=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=o,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){const r=this.buffer,s=this.valueSize,o=e*s+s;let a=this.cumulativeWeight;if(a===0){for(let l=0;l!==s;++l)r[o+l]=r[l];a=i}else{a+=i;const l=i/a;this._mixBufferRegion(r,o,0,l,s)}this.cumulativeWeight=a}accumulateAdditive(e){const i=this.buffer,r=this.valueSize,s=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,s,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const i=this.valueSize,r=this.buffer,s=e*i+i,o=this.cumulativeWeight,a=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const c=i*this._origIndex;this._mixBufferRegion(r,s,c,1-o,i)}a>0&&this._mixBufferRegionAdditive(r,s,this._addIndex*i,1,i);for(let c=i,h=i+i;c!==h;++c)if(r[c]!==r[c+i]){l.setValue(r,s);break}}saveOriginalState(){const e=this.binding,i=this.buffer,r=this.valueSize,s=r*this._origIndex;e.getValue(i,s);for(let o=r,a=s;o!==a;++o)i[o]=i[s+o%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let r=e;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[e+r]}_select(e,i,r,s,o){if(s>=.5)for(let a=0;a!==o;++a)e[i+a]=e[r+a]}_slerp(e,i,r,s){Ce.slerpFlat(e,i,e,i,e,r,s)}_slerpAdditive(e,i,r,s,o){const a=this._workIndex*o;Ce.multiplyQuaternionsFlat(e,a,e,i,e,r),Ce.slerpFlat(e,i,e,i,e,a,s)}_lerp(e,i,r,s,o){const a=1-s;for(let l=0;l!==o;++l){const c=i+l;e[c]=e[c]*a+e[r+l]*s}}_lerpAdditive(e,i,r,s,o){for(let a=0;a!==o;++a){const l=i+a;e[l]=e[l]+e[r+a]*s}}}const ZR="\\[\\]\\.:\\/",Mte=new RegExp("["+ZR+"]","g"),$R="[^"+ZR+"]",Tte="[^"+ZR.replace("\\.","")+"]",Ite=/((?:WC+[\/:])*)/.source.replace("WC",$R),Rte=/(WCOD+)?/.source.replace("WCOD",Tte),Pte=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",$R),Bte=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",$R),kte=new RegExp("^"+Ite+Rte+Pte+Bte+"$"),Ote=["material","materials","bones","map"];let Dte=class{constructor(n,e,i){const r=i||Yt.parseTrackName(e);this._targetGroup=n,this._bindings=n.subscribe_(e,r)}getValue(n,e){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(n,e)}setValue(n,e){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(n,e)}bind(){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=n.length;e!==i;++e)n[e].bind()}unbind(){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=n.length;e!==i;++e)n[e].unbind()}},Yt=class Fv{constructor(e,i,r){this.path=i,this.parsedPath=r||Fv.parseTrackName(i),this.node=Fv.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,r){return e&&e.isAnimationObjectGroup?new Fv.Composite(e,i,r):new Fv(e,i,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Mte,"")}static parseTrackName(e){const i=kte.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const o=r.nodeName.substring(s+1);Ote.indexOf(o)!==-1&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=o)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(i);if(r!==void 0)return r}if(e.children){const r=function(o,a){for(let l=0;l<o.length;l++){const c=o[l];if(!a&&(c.name===i||c.uuid===i)||a&&c.userData&&c.userData.name===i)return c;const h=r(c.children,a);if(h)return h}return null},s=r(e.children);if(s)return s;{const o=r(e.children,!0);if(o)return o}}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)e[i++]=r[s]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,r=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(e||(e=Fv.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let h=i.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===h){h=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const a=e[s];if(a===void 0){const h=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+s+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(o!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Yt.Composite=Dte,Yt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Yt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Yt.prototype.GetterByBindingType=[Yt.prototype._getValue_direct,Yt.prototype._getValue_array,Yt.prototype._getValue_arrayElement,Yt.prototype._getValue_toArray],Yt.prototype.SetterByBindingTypeAndVersioning=[[Yt.prototype._setValue_direct,Yt.prototype._setValue_direct_setNeedsUpdate,Yt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Yt.prototype._setValue_array,Yt.prototype._setValue_array_setNeedsUpdate,Yt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Yt.prototype._setValue_arrayElement,Yt.prototype._setValue_arrayElement_setNeedsUpdate,Yt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Yt.prototype._setValue_fromArray,Yt.prototype._setValue_fromArray_setNeedsUpdate,Yt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Lte{constructor(){this.isAnimationObjectGroup=!0,this.uuid=No(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,s=arguments.length;r!==s;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const e=this._objects,i=this._indicesByUUID,r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length;let l,c=e.length,h=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){const f=arguments[u],m=f.uuid;let g=i[m];if(g===void 0){g=c++,i[m]=g,e.push(f);for(let v=0,y=a;v!==y;++v)o[v].push(new Yt(f,r[v],s[v]))}else if(g<h){l=e[g];const v=--h,y=e[v];i[y.uuid]=g,e[g]=y,i[m]=v,e[v]=f;for(let A=0,b=a;A!==b;++A){const x=o[A],_=x[v];let w=x[g];x[g]=_,w===void 0&&(w=new Yt(f,r[A],s[A])),x[v]=w}}else e[g]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){const e=this._objects,i=this._indicesByUUID,r=this._bindings,s=r.length;let o=this.nCachedObjects_;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],h=c.uuid,u=i[h];if(u!==void 0&&u>=o){const d=o++,f=e[d];i[f.uuid]=u,e[u]=f,i[h]=d,e[d]=c;for(let m=0,g=s;m!==g;++m){const v=r[m],y=v[d],A=v[u];v[u]=y,v[d]=A}}}this.nCachedObjects_=o}uncache(){const e=this._objects,i=this._indicesByUUID,r=this._bindings,s=r.length;let o=this.nCachedObjects_,a=e.length;for(let l=0,c=arguments.length;l!==c;++l){const h=arguments[l],u=h.uuid,d=i[u];if(d!==void 0)if(delete i[u],d<o){const f=--o,m=e[f],g=--a,v=e[g];i[m.uuid]=d,e[d]=m,i[v.uuid]=f,e[f]=v,e.pop();for(let y=0,A=s;y!==A;++y){const b=r[y],x=b[f],_=b[g];b[d]=x,b[f]=_,b.pop()}}else{const f=--a,m=e[f];f>0&&(i[m.uuid]=d),e[d]=m,e.pop();for(let g=0,v=s;g!==v;++g){const y=r[g];y[d]=y[f],y.pop()}}}this.nCachedObjects_=o}subscribe_(e,i){const r=this._bindingsIndicesByPath;let s=r[e];const o=this._bindings;if(s!==void 0)return o[s];const a=this._paths,l=this._parsedPaths,c=this._objects,h=c.length,u=this.nCachedObjects_,d=new Array(h);s=o.length,r[e]=s,a.push(e),l.push(i),o.push(d);for(let f=u,m=c.length;f!==m;++f){const g=c[f];d[f]=new Yt(g,e,i)}return d}unsubscribe_(e){const i=this._bindingsIndicesByPath,r=i[e];if(r!==void 0){const s=this._paths,o=this._parsedPaths,a=this._bindings,l=a.length-1,c=a[l],h=e[l];i[h]=r,a[r]=c,a.pop(),o[r]=o[l],o.pop(),s[r]=s[l],s.pop()}}}class Fz{constructor(e,i,r=null,s=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=r,this.blendMode=s;const o=i.tracks,a=o.length,l=new Array(a),c={endingStart:_p,endingEnd:_p};for(let h=0;h!==a;++h){const u=o[h].createInterpolant(null);l[h]=u,u.settings=c}this._interpolantSettings=c,this._interpolants=l,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=EI,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,r){if(e.fadeOut(i),this.fadeIn(i),r){const s=this._clip.duration,o=e._clip.duration,a=o/s,l=s/o;e.warp(1,a,i),this.warp(l,1,i)}return this}crossFadeTo(e,i,r){return e.crossFadeFrom(this,i,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,r){const s=this._mixer,o=s.time,a=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=s._lendControlInterpolant(),this._timeScaleInterpolant=l);const c=l.parameterPositions,h=l.sampleValues;return c[0]=o,c[1]=o+r,h[0]=e/a,h[1]=i/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,r,s){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const c=(e-o)*r;c<0||r===0?i=0:(this._startTime=null,i=r*c)}i*=this._updateTimeScale(e);const a=this._updateTime(i),l=this._updateWeight(e);if(l>0){const c=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case MI:for(let u=0,d=c.length;u!==d;++u)c[u].evaluate(a),h[u].accumulateAdditive(l);break;case L_:default:for(let u=0,d=c.length;u!==d;++u)c[u].evaluate(a),h[u].accumulate(s,l)}}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const s=r.evaluate(e)[0];i*=s,e>r.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const s=r.evaluate(e)[0];i*=s,e>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(e){const i=this._clip.duration,r=this.loop;let s=this.time+e,o=this._loopCount;const a=r===rF;if(e===0)return o===-1?s:a&&(o&1)===1?i-s:s;if(r===ey){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=i)s=i;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),s>=i||s<0){const l=Math.floor(s/i);s-=i*l,o+=Math.abs(l);const c=this.repetitions-o;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?i:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const h=e<0;this._setEndings(h,!h,a)}else this._setEndings(!1,!1,a);this._loopCount=o,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=s;if(a&&(o&1)===1)return i-s}return s}_setEndings(e,i,r){const s=this._interpolantSettings;r?(s.endingStart=wp,s.endingEnd=wp):(e?s.endingStart=this.zeroSlopeAtStart?wp:_p:s.endingStart=ty,i?s.endingEnd=this.zeroSlopeAtEnd?wp:_p:s.endingEnd=ty)}_scheduleFading(e,i,r){const s=this._mixer,o=s.time;let a=this._weightInterpolant;a===null&&(a=s._lendControlInterpolant(),this._weightInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=o,c[0]=i,l[1]=o+e,c[1]=r,this}}const Ute=new Float32Array(1);class qw extends wr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){const r=e._localRoot||this._root,s=e._clip.tracks,o=s.length,a=e._propertyBindings,l=e._interpolants,c=r.uuid,h=this._bindingsByRootAndName;let u=h[c];u===void 0&&(u={},h[c]=u);for(let d=0;d!==o;++d){const f=s[d],m=f.name;let g=u[m];if(g!==void 0)++g.referenceCount,a[d]=g;else{if(g=a[d],g!==void 0){g._cacheIndex===null&&(++g.referenceCount,this._addInactiveBinding(g,c,m));continue}const v=i&&i._propertyBindings[d].binding.parsedPath;g=new Uz(Yt.create(r,m,v),f.ValueTypeName,f.getValueSize()),++g.referenceCount,this._addInactiveBinding(g,c,m),a[d]=g}l[d].resultBuffer=g.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,s=e._clip.uuid,o=this._actionsByClip[s];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,s,r)}const i=e._propertyBindings;for(let r=0,s=i.length;r!==s;++r){const o=i[r];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const i=e._propertyBindings;for(let r=0,s=i.length;r!==s;++r){const o=i[r];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const i=e._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(e,i,r){const s=this._actions,o=this._actionsByClip;let a=o[i];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[i]=a;else{const l=a.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=s.length,s.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const i=this._actions,r=i[i.length-1],s=e._cacheIndex;r._cacheIndex=s,i[s]=r,i.pop(),e._cacheIndex=null;const o=e._clip.uuid,a=this._actionsByClip,l=a[o],c=l.knownActions,h=c[c.length-1],u=e._byClipCacheIndex;h._byClipCacheIndex=u,c[u]=h,c.pop(),e._byClipCacheIndex=null;const d=l.actionByRoot,f=(e._localRoot||this._root).uuid;delete d[f],c.length===0&&delete a[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const i=e._propertyBindings;for(let r=0,s=i.length;r!==s;++r){const o=i[r];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const i=this._actions,r=e._cacheIndex,s=this._nActiveActions++,o=i[s];e._cacheIndex=s,i[s]=e,o._cacheIndex=r,i[r]=o}_takeBackAction(e){const i=this._actions,r=e._cacheIndex,s=--this._nActiveActions,o=i[s];e._cacheIndex=s,i[s]=e,o._cacheIndex=r,i[r]=o}_addInactiveBinding(e,i,r){const s=this._bindingsByRootAndName,o=this._bindings;let a=s[i];a===void 0&&(a={},s[i]=a),a[r]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const i=this._bindings,r=e.binding,s=r.rootNode.uuid,o=r.path,a=this._bindingsByRootAndName,l=a[s],c=i[i.length-1],h=e._cacheIndex;c._cacheIndex=h,i[h]=c,i.pop(),delete l[o],Object.keys(l).length===0&&delete a[s]}_lendBinding(e){const i=this._bindings,r=e._cacheIndex,s=this._nActiveBindings++,o=i[s];e._cacheIndex=s,i[s]=e,o._cacheIndex=r,i[r]=o}_takeBackBinding(e){const i=this._bindings,r=e._cacheIndex,s=--this._nActiveBindings,o=i[s];e._cacheIndex=s,i[s]=e,o._cacheIndex=r,i[r]=o}_lendControlInterpolant(){const e=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=e[i];return r===void 0&&(r=new VR(new Float32Array(2),new Float32Array(2),1,Ute),r.__cacheIndex=i,e[i]=r),r}_takeBackControlInterpolant(e){const i=this._controlInterpolants,r=e.__cacheIndex,s=--this._nActiveControlInterpolants,o=i[s];e.__cacheIndex=s,i[s]=e,o.__cacheIndex=r,i[r]=o}clipAction(e,i,r){const s=i||this._root,o=s.uuid;let a=typeof e=="string"?$s.findByName(s,e):e;const l=a!==null?a.uuid:e,c=this._actionsByClip[l];let h=null;if(r===void 0&&(a!==null?r=a.blendMode:r=L_),c!==void 0){const d=c.actionByRoot[o];if(d!==void 0&&d.blendMode===r)return d;h=c.knownActions[0],a===null&&(a=h._clip)}if(a===null)return null;const u=new Fz(this,a,i,r);return this._bindAction(u,h),this._addInactiveAction(u,l,o),u}existingAction(e,i){const r=i||this._root,s=r.uuid,o=typeof e=="string"?$s.findByName(r,e):e,a=o?o.uuid:e,l=this._actionsByClip[a];return l!==void 0&&l.actionByRoot[s]||null}stopAllAction(){const e=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const i=this._actions,r=this._nActiveActions,s=this.time+=e,o=Math.sign(e),a=this._accuIndex^=1;for(let h=0;h!==r;++h)i[h]._update(s,e,o,a);const l=this._bindings,c=this._nActiveBindings;for(let h=0;h!==c;++h)l[h].apply(a);return this}setTime(e){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const i=this._actions,r=e.uuid,s=this._actionsByClip,o=s[r];if(o!==void 0){const a=o.knownActions;for(let l=0,c=a.length;l!==c;++l){const h=a[l];this._deactivateAction(h);const u=h._cacheIndex,d=i[i.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,d._cacheIndex=u,i[u]=d,i.pop(),this._removeInactiveBindingsForAction(h)}delete s[r]}}uncacheRoot(e){const i=e.uuid,r=this._actionsByClip;for(const a in r){const l=r[a].actionByRoot,c=l[i];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const s=this._bindingsByRootAndName,o=s[i];if(o!==void 0)for(const a in o){const l=o[a];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,i){const r=this.existingAction(e,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class Se{constructor(e){this.value=e}clone(){return new Se(this.value.clone===void 0?this.value:this.value.clone())}}let Fte=0;class Nte extends wr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Fte++}),this.name="",this.usage=oy,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const i=e.uniforms;this.uniforms.length=0;for(let r=0,s=i.length;r<s;r++){const o=Array.isArray(i[r])?i[r]:[i[r]];for(let a=0;a<o.length;a++)this.uniforms.push(o[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class Yw extends yy{constructor(e,i,r=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class zte{constructor(e,i,r,s,o){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=i,this.itemSize=r,this.elementSize=s,this.count=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,i){return this.type=e,this.elementSize=i,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const Nz=new he;let ku=class{constructor(n,e,i=0,r=1/0){this.ray=new Js(n,e),this.near=i,this.far=r,this.camera=null,this.layers=new Cs,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(n,e){this.ray.set(n,e)}setFromCamera(n,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(n.x,n.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(n.x,n.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(n){return Nz.identity().extractRotation(n.matrixWorld),this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Nz),this}intersectObject(n,e=!0,i=[]){return e2(n,this,i,e),i.sort(zz),i}intersectObjects(n,e=!0,i=[]){for(let r=0,s=n.length;r<s;r++)e2(n[r],this,i,e);return i.sort(zz),i}};function zz(n,e){return n.distance-e.distance}function e2(n,e,i,r){if(n.layers.test(e.layers)&&n.raycast(e,i),r===!0){const s=n.children;for(let o=0,a=s.length;o<a;o++)e2(s[o],e,i,!0)}}class t2{constructor(e=1,i=0,r=0){return this.radius=e,this.phi=i,this.theta=r,this}set(e,i,r){return this.radius=e,this.phi=i,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(In(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class jte{constructor(e=1,i=0,r=0){return this.radius=e,this.theta=i,this.y=r,this}set(e,i,r){return this.radius=e,this.theta=i,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}const jz=new J;class Gte{constructor(e=new J(1/0,1/0),i=new J(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=jz.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,jz).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Gz=new S,Jw=new S;class Ho{constructor(e=new S,i=new S){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){Gz.subVectors(e,this.start),Jw.subVectors(this.end,this.start);const r=Jw.dot(Jw);let s=Jw.dot(Gz)/r;return i&&(s=In(s,0,1)),s}closestPointToPoint(e,i,r){const s=this.closestPointToPointParameter(e,i);return this.delta(r).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Hz=new S;class Hte extends ve{constructor(e,i){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const r=new dt,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,l=1,c=32;a<c;a++,l++){const h=a/c*Math.PI*2,u=l/c*Math.PI*2;s.push(Math.cos(h),Math.sin(h),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new rt(s,3));const o=new zi({fog:!1,toneMapped:!1});this.cone=new Is(r,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),Hz.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Hz),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Ou=new S,Kw=new he,i2=new he;class Vte extends Is{constructor(e){const i=Vz(e),r=new dt,s=[],o=[],a=new be(0,0,1),l=new be(0,1,0);for(let h=0;h<i.length;h++){const u=i[h];u.parent&&u.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),o.push(a.r,a.g,a.b),o.push(l.r,l.g,l.b))}r.setAttribute("position",new rt(s,3)),r.setAttribute("color",new rt(o,3));const c=new zi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,c),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const i=this.bones,r=this.geometry,s=r.getAttribute("position");i2.copy(this.root.matrixWorld).invert();for(let o=0,a=0;o<i.length;o++){const l=i[o];l.parent&&l.parent.isBone&&(Kw.multiplyMatrices(i2,l.matrixWorld),Ou.setFromMatrixPosition(Kw),s.setXYZ(a,Ou.x,Ou.y,Ou.z),Kw.multiplyMatrices(i2,l.parent.matrixWorld),Ou.setFromMatrixPosition(Kw),s.setXYZ(a+1,Ou.x,Ou.y,Ou.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function Vz(n){const e=[];n.isBone===!0&&e.push(n);for(let i=0;i<n.children.length;i++)e.push.apply(e,Vz(n.children[i]));return e}class Qte extends pe{constructor(e,i,r){const s=new tl(i,4,2),o=new Jt({wireframe:!0,fog:!1,toneMapped:!1});super(s,o),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Wte=new S,Qz=new be,Wz=new be;class Xte extends ve{constructor(e,i,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const s=new au(i);s.rotateY(Math.PI*.5),this.material=new Jt({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const o=s.getAttribute("position"),a=new Float32Array(o.count*3);s.setAttribute("color",new Ye(a,3)),this.add(new pe(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=e.geometry.getAttribute("color");Qz.copy(this.light.color),Wz.copy(this.light.groundColor);for(let r=0,s=i.count;r<s;r++){const o=r<s/2?Qz:Wz;i.setXYZ(r,o.r,o.g,o.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Wte.setFromMatrixPosition(this.light.matrixWorld).negate())}}let Zw=class extends Is{constructor(n=10,e=10,i=4473924,r=8947848){i=new be(i),r=new be(r);const s=e/2,o=n/e,a=n/2,l=[],c=[];for(let d=0,f=0,m=-a;d<=e;d++,m+=o){l.push(-a,0,m,a,0,m),l.push(m,0,-a,m,0,a);const g=d===s?i:r;g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3}const h=new dt;h.setAttribute("position",new rt(l,3)),h.setAttribute("color",new rt(c,3));const u=new zi({vertexColors:!0,toneMapped:!1});super(h,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}};class qte extends Is{constructor(e=10,i=16,r=8,s=64,o=4473924,a=8947848){o=new be(o),a=new be(a);const l=[],c=[];if(i>1)for(let d=0;d<i;d++){const f=d/i*(Math.PI*2),m=Math.sin(f)*e,g=Math.cos(f)*e;l.push(0,0,0),l.push(m,0,g);const v=d&1?o:a;c.push(v.r,v.g,v.b),c.push(v.r,v.g,v.b)}for(let d=0;d<r;d++){const f=d&1?o:a,m=e-e/r*d;for(let g=0;g<s;g++){let v=g/s*(Math.PI*2),y=Math.sin(v)*m,A=Math.cos(v)*m;l.push(y,0,A),c.push(f.r,f.g,f.b),v=(g+1)/s*(Math.PI*2),y=Math.sin(v)*m,A=Math.cos(v)*m,l.push(y,0,A),c.push(f.r,f.g,f.b)}}const h=new dt;h.setAttribute("position",new rt(l,3)),h.setAttribute("color",new rt(c,3));const u=new zi({vertexColors:!0,toneMapped:!1});super(h,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Xz=new S,$w=new S,qz=new S;class Yz extends ve{constructor(e,i,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let s=new dt;s.setAttribute("position",new rt([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const o=new zi({fog:!1,toneMapped:!1});this.lightPlane=new hn(s,o),this.add(this.lightPlane),s=new dt,s.setAttribute("position",new rt([0,0,0,0,0,1],3)),this.targetLine=new hn(s,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Xz.setFromMatrixPosition(this.light.matrixWorld),$w.setFromMatrixPosition(this.light.target.matrixWorld),qz.subVectors($w,Xz),this.lightPlane.lookAt($w),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt($w),this.targetLine.scale.z=qz.length()}}const e1=new S,Rn=new my;class Jz extends Is{constructor(e){const i=new dt,r=new zi({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],o=[],a={};l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4");function l(g,v){c(g),c(v)}function c(g){s.push(0,0,0),o.push(0,0,0),a[g]===void 0&&(a[g]=[]),a[g].push(s.length/3-1)}i.setAttribute("position",new rt(s,3)),i.setAttribute("color",new rt(o,3)),super(i,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const h=new be(16755200),u=new be(16711680),d=new be(43775),f=new be(16777215),m=new be(3355443);this.setColors(h,u,d,f,m)}setColors(e,i,r,s,o){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,i.r,i.g,i.b),a.setXYZ(25,i.r,i.g,i.b),a.setXYZ(26,i.r,i.g,i.b),a.setXYZ(27,i.r,i.g,i.b),a.setXYZ(28,i.r,i.g,i.b),a.setXYZ(29,i.r,i.g,i.b),a.setXYZ(30,i.r,i.g,i.b),a.setXYZ(31,i.r,i.g,i.b),a.setXYZ(32,r.r,r.g,r.b),a.setXYZ(33,r.r,r.g,r.b),a.setXYZ(34,r.r,r.g,r.b),a.setXYZ(35,r.r,r.g,r.b),a.setXYZ(36,r.r,r.g,r.b),a.setXYZ(37,r.r,r.g,r.b),a.setXYZ(38,s.r,s.g,s.b),a.setXYZ(39,s.r,s.g,s.b),a.setXYZ(40,o.r,o.g,o.b),a.setXYZ(41,o.r,o.g,o.b),a.setXYZ(42,o.r,o.g,o.b),a.setXYZ(43,o.r,o.g,o.b),a.setXYZ(44,o.r,o.g,o.b),a.setXYZ(45,o.r,o.g,o.b),a.setXYZ(46,o.r,o.g,o.b),a.setXYZ(47,o.r,o.g,o.b),a.setXYZ(48,o.r,o.g,o.b),a.setXYZ(49,o.r,o.g,o.b),a.needsUpdate=!0}update(){const e=this.geometry,i=this.pointMap,r=1,s=1;Rn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Nn("c",i,e,Rn,0,0,-1),Nn("t",i,e,Rn,0,0,1),Nn("n1",i,e,Rn,-r,-s,-1),Nn("n2",i,e,Rn,r,-s,-1),Nn("n3",i,e,Rn,-r,s,-1),Nn("n4",i,e,Rn,r,s,-1),Nn("f1",i,e,Rn,-r,-s,1),Nn("f2",i,e,Rn,r,-s,1),Nn("f3",i,e,Rn,-r,s,1),Nn("f4",i,e,Rn,r,s,1),Nn("u1",i,e,Rn,r*.7,s*1.1,-1),Nn("u2",i,e,Rn,-r*.7,s*1.1,-1),Nn("u3",i,e,Rn,0,s*2,-1),Nn("cf1",i,e,Rn,-r,0,1),Nn("cf2",i,e,Rn,r,0,1),Nn("cf3",i,e,Rn,0,-s,1),Nn("cf4",i,e,Rn,0,s,1),Nn("cn1",i,e,Rn,-r,0,-1),Nn("cn2",i,e,Rn,r,0,-1),Nn("cn3",i,e,Rn,0,-s,-1),Nn("cn4",i,e,Rn,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Nn(n,e,i,r,s,o,a){e1.set(s,o,a).unproject(r);const l=e[n];if(l!==void 0){const c=i.getAttribute("position");for(let h=0,u=l.length;h<u;h++)c.setXYZ(l[h],e1.x,e1.y,e1.z)}}const t1=new Ht;class n2 extends Is{constructor(e,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),o=new dt;o.setIndex(new Ye(r,1)),o.setAttribute("position",new Ye(s,3)),super(o,new zi({color:i,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&t1.setFromObject(this.object),t1.isEmpty())return;const i=t1.min,r=t1.max,s=this.geometry.attributes.position,o=s.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=i.x,o[4]=r.y,o[5]=r.z,o[6]=i.x,o[7]=i.y,o[8]=r.z,o[9]=r.x,o[10]=i.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=i.z,o[15]=i.x,o[16]=r.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=r.x,o[22]=i.y,o[23]=i.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,i){return super.copy(e,i),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class r2 extends Is{constructor(e,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new dt;o.setIndex(new Ye(r,1)),o.setAttribute("position",new rt(s,3)),super(o,new zi({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Yte extends hn{constructor(e,i=1,r=16776960){const s=r,o=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new dt;a.setAttribute("position",new rt(o,3)),a.computeBoundingSphere(),super(a,new zi({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=i;const l=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],c=new dt;c.setAttribute("position",new rt(l,3)),c.computeBoundingSphere(),this.add(new pe(c,new Jt({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Kz=new S;let i1,s2;class Jte extends ve{constructor(e=new S(0,0,1),i=new S(0,0,0),r=1,s=16776960,o=r*.2,a=o*.2){super(),this.type="ArrowHelper",i1===void 0&&(i1=new dt,i1.setAttribute("position",new rt([0,0,0,0,1,0],3)),s2=new Wn(0,.5,1,5,1),s2.translate(0,-.5,0)),this.position.copy(i),this.line=new hn(i1,new zi({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new pe(s2,new Jt({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,o,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Kz.set(e.z,0,-e.x).normalize();const i=Math.acos(e.y);this.quaternion.setFromAxisAngle(Kz,i)}}setLength(e,i=e*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,e-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}let Vo=class extends Is{constructor(n=1){const e=[0,0,0,n,0,0,0,0,0,0,n,0,0,0,0,0,0,n],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new dt;r.setAttribute("position",new rt(e,3)),r.setAttribute("color",new rt(i,3));const s=new zi({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(n,e,i){const r=new be,s=this.geometry.attributes.color.array;return r.set(n),r.toArray(s,0),r.toArray(s,3),r.set(e),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};class Zz{constructor(){this.type="ShapePath",this.color=new be,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new Ty,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){return this.currentPath.lineTo(e,i),this}quadraticCurveTo(e,i,r,s){return this.currentPath.quadraticCurveTo(e,i,r,s),this}bezierCurveTo(e,i,r,s,o,a){return this.currentPath.bezierCurveTo(e,i,r,s,o,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function i(A){const b=[];for(let x=0,_=A.length;x<_;x++){const w=A[x],T=new Pu;T.curves=w.curves,b.push(T)}return b}function r(A,b){const x=b.length;let _=!1;for(let w=x-1,T=0;T<x;w=T++){let M=b[w],R=b[T],B=R.x-M.x,E=R.y-M.y;if(Math.abs(E)>Number.EPSILON){if(E<0&&(M=b[T],B=-B,R=b[w],E=-E),A.y<M.y||A.y>R.y)continue;if(A.y===M.y){if(A.x===M.x)return!0}else{const P=E*(A.x-M.x)-B*(A.y-M.y);if(P===0)return!0;if(P<0)continue;_=!_}}else{if(A.y!==M.y)continue;if(R.x<=A.x&&A.x<=M.x||M.x<=A.x&&A.x<=R.x)return!0}}return _}const s=Gl.isClockWise,o=this.subPaths;if(o.length===0)return[];let a,l,c;const h=[];if(o.length===1)return l=o[0],c=new Pu,c.curves=l.curves,h.push(c),h;let u=!s(o[0].getPoints());u=e?!u:u;const d=[],f=[];let m=[],g=0,v;f[g]=void 0,m[g]=[];for(let A=0,b=o.length;A<b;A++)l=o[A],v=l.getPoints(),a=s(v),a=e?!a:a,a?(!u&&f[g]&&g++,f[g]={s:new Pu,p:v},f[g].s.curves=l.curves,u&&g++,m[g]=[]):m[g].push({h:l,p:v[0]});if(!f[0])return i(o);if(f.length>1){let A=!1,b=0;for(let x=0,_=f.length;x<_;x++)d[x]=[];for(let x=0,_=f.length;x<_;x++){const w=m[x];for(let T=0;T<w.length;T++){const M=w[T];let R=!0;for(let B=0;B<f.length;B++)r(M.p,f[B].p)&&(x!==B&&b++,R?(R=!1,d[B].push(M)):A=!0);R&&d[x].push(M)}}b>0&&A===!1&&(m=d)}let y;for(let A=0,b=f.length;A<b;A++){c=f[A].s,h.push(c),y=m[A];for(let x=0,_=y.length;x<_;x++)c.holes.push(y[x].h)}return h}}class Kte extends qt{constructor(e=1,i=1,r=1,s={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,i,{...s,count:r}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Kc}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported. Existing: "+window.__THREE__+", new: "+Kc):window.__THREE__=Kc);const Zte=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Kv,AddEquation:mu,AddOperation:KU,AdditiveAnimationBlendMode:MI,AdditiveBlending:mp,AgXToneMapping:Im,AlphaFormat:tF,AlwaysCompare:MF,AlwaysDepth:__,AlwaysStencilFunc:z_,AmbientLight:Hw,AnimationAction:Fz,AnimationClip:$s,AnimationLoader:mte,AnimationMixer:qw,AnimationObjectGroup:Lte,AnimationUtils:ute,ArcCurve:KN,ArrayCamera:pR,ArrowHelper:Jte,AttachedBindMode:JT,Audio:KR,AudioAnalyser:Ete,AudioContext:Ww,AudioListener:Oz,AudioLoader:Xw,AxesHelper:Vo,BackSide:an,BasicDepthPacking:Wr,BasicShadowMap:Gq,BatchedMesh:Cw,Bone:Dp,BooleanKeyframeTrack:Np,Box2:Gte,Box3:Ht,Box3Helper:r2,BoxGeometry:Ki,BoxHelper:n2,BufferAttribute:Ye,BufferGeometry:dt,BufferGeometryLoader:Ez,ByteType:E_,Cache:hh,Camera:my,CameraHelper:Jz,CanvasTexture:ER,CapsuleGeometry:_T,CatmullRomCurve3:ZN,CineonToneMapping:ZU,CircleGeometry:wT,ClampToEdgeWrapping:Yn,Clock:JR,Color:be,ColorKeyframeTrack:jw,ColorManagement:xi,CompressedArrayTexture:Oee,CompressedCubeTexture:Dee,CompressedTexture:Ru,CompressedTextureLoader:gte,ConeGeometry:ST,ConstantAlphaFactor:qU,ConstantColorFactor:WU,CubeCamera:tR,CubeReflectionMapping:Zc,CubeRefractionMapping:gu,CubeTexture:gy,CubeTextureLoader:vte,CubeUVReflectionMapping:Pm,CubicBezierCurve:PR,CubicBezierCurve3:ez,CubicInterpolant:gz,CullFaceBack:GT,CullFaceFront:OU,CullFaceFrontBack:jq,CullFaceNone:kU,Curve:wa,CurvePath:iz,CustomBlending:XT,CustomToneMapping:$U,CylinderGeometry:Wn,Cylindrical:jte,Data3DTexture:FI,DataArrayTexture:Q_,DataTexture:Ms,DataTextureLoader:QR,DataUtils:Mp,DecrementStencilOp:uF,DecrementWrapStencilOp:pF,DefaultLoadingManager:Az,DepthFormat:vu,DepthStencilFormat:yu,DepthTexture:tg,DetachedBindMode:eF,DirectionalLight:Gp,DirectionalLightHelper:Yz,DiscreteInterpolant:vz,DisplayP3ColorSpace:N_,DodecahedronGeometry:CT,DoubleSide:yi,DstAlphaFactor:jU,DstColorFactor:HU,DynamicCopyUsage:Zq,DynamicDrawUsage:ws,DynamicReadUsage:Yq,EdgesGeometry:UR,EllipseCurve:Iw,EqualCompare:wF,EqualDepth:Mm,EqualStencilFunc:gF,EquirectangularReflectionMapping:qs,EquirectangularRefractionMapping:Rm,Euler:ri,EventDispatcher:wr,ExtrudeGeometry:zv,FileLoader:Yr,Float16BufferAttribute:LY,Float32BufferAttribute:rt,FloatType:Hi,Fog:mw,FogExp2:xT,FramebufferTexture:kee,FrontSide:Fn,Frustum:Rp,GLBufferAttribute:zte,GLSL1:eY,GLSL3:j_,GreaterCompare:SF,GreaterDepth:S_,GreaterEqualCompare:EF,GreaterEqualDepth:w_,GreaterEqualStencilFunc:bF,GreaterStencilFunc:yF,GridHelper:Zw,Group:Cr,HalfFloatType:ur,HemisphereLight:WR,HemisphereLightHelper:Xte,IcosahedronGeometry:ET,ImageBitmapLoader:Iz,ImageLoader:By,ImageUtils:LI,IncrementStencilOp:hF,IncrementWrapStencilOp:dF,InstancedBufferAttribute:So,InstancedBufferGeometry:Vw,InstancedInterleavedBuffer:Yw,InstancedMesh:bR,Int16BufferAttribute:OY,Int32BufferAttribute:DY,Int8BufferAttribute:PY,IntType:bp,InterleavedBuffer:yy,InterleavedBufferAttribute:Go,Interpolant:pg,InterpolateDiscrete:Au,InterpolateLinear:Xl,InterpolateSmooth:D_,InvertStencilOp:fF,KeepStencilOp:xu,KeyframeTrack:cl,LOD:vR,LatheGeometry:l_,Layers:Cs,LessCompare:_F,LessDepth:Xv,LessEqualCompare:PI,LessEqualDepth:gp,LessEqualStencilFunc:vF,LessStencilFunc:mF,Light:Bu,LightProbe:Cz,Line:hn,Line3:Ho,LineBasicMaterial:zi,LineCurve:BR,LineCurve3:tz,LineDashedMaterial:pz,LineLoop:SR,LineSegments:Is,LinearDisplayP3ColorSpace:iy,LinearEncoding:oF,LinearFilter:Dt,LinearInterpolant:VR,LinearMipMapLinearFilter:Wq,LinearMipMapNearestFilter:Qq,LinearMipmapLinearFilter:bo,LinearMipmapNearestFilter:Ap,LinearSRGBColorSpace:Ii,LinearToneMapping:Tm,LinearTransfer:ny,Loader:Kn,LoaderUtils:dh,LoadingManager:Gw,LoopOnce:ey,LoopPingPong:rF,LoopRepeat:EI,LuminanceAlphaFormat:iF,LuminanceFormat:M_,MOUSE:pp,Material:Ut,MaterialLoader:PT,MathUtils:pi,Matrix3:Lt,Matrix4:he,MaxEquation:A_,Mesh:pe,MeshBasicMaterial:Jt,MeshDepthMaterial:vy,MeshDistanceMaterial:dR,MeshLambertMaterial:jR,MeshMatcapMaterial:dz,MeshNormalMaterial:zw,MeshPhongMaterial:dg,MeshPhysicalMaterial:Co,MeshStandardMaterial:mr,MeshToonMaterial:uz,MinEquation:qT,MirroredRepeatWrapping:yp,MixOperation:JU,MultiplyBlending:WT,MultiplyOperation:Yv,NearestFilter:Rt,NearestMipMapLinearFilter:Vq,NearestMipMapNearestFilter:Hq,NearestMipmapLinearFilter:$c,NearestMipmapNearestFilter:Bm,NeutralToneMapping:vp,NeverCompare:xF,NeverDepth:YT,NeverStencilFunc:RI,NoBlending:ln,NoColorSpace:xo,NoToneMapping:Xs,NormalAnimationBlendMode:L_,NormalBlending:fu,NotEqualCompare:CF,NotEqualDepth:qv,NotEqualStencilFunc:AF,NumberKeyframeTrack:ch,Object3D:ve,ObjectLoader:xte,ObjectSpaceNormalMap:aF,OctahedronGeometry:au,OneFactor:FU,OneMinusConstantAlphaFactor:YU,OneMinusConstantColorFactor:XU,OneMinusDstAlphaFactor:GU,OneMinusDstColorFactor:VU,OneMinusSrcAlphaFactor:x_,OneMinusSrcColorFactor:zU,OrthographicCamera:Yl,P3Primaries:sy,PCFShadowMap:HT,PCFSoftShadowMap:VT,PMREMGenerator:lR,Path:Ty,PerspectiveCamera:Ft,Plane:dr,PlaneGeometry:cr,PlaneHelper:Yte,PointLight:jp,PointLightHelper:Qte,Points:hg,PointsMaterial:Iu,PolarGridHelper:qte,PolyhedronGeometry:cp,PositionalAudio:Lz,PropertyBinding:Yt,PropertyMixer:Uz,QuadraticBezierCurve:kR,QuadraticBezierCurve3:OR,Quaternion:Ce,QuaternionKeyframeTrack:hl,QuaternionLinearInterpolant:yz,RED_GREEN_RGTC2_Format:SI,RED_RGTC1_Format:nF,REVISION:Kc,RGBADepthPacking:F_,RGBAFormat:Ti,RGBAIntegerFormat:km,RGBA_ASTC_10x10_Format:yI,RGBA_ASTC_10x5_Format:mI,RGBA_ASTC_10x6_Format:gI,RGBA_ASTC_10x8_Format:vI,RGBA_ASTC_12x10_Format:AI,RGBA_ASTC_12x12_Format:bI,RGBA_ASTC_4x4_Format:aI,RGBA_ASTC_5x4_Format:lI,RGBA_ASTC_5x5_Format:cI,RGBA_ASTC_6x5_Format:hI,RGBA_ASTC_6x6_Format:uI,RGBA_ASTC_8x5_Format:dI,RGBA_ASTC_8x6_Format:pI,RGBA_ASTC_8x8_Format:fI,RGBA_BPTC_Format:O_,RGBA_ETC2_EAC_Format:oI,RGBA_PVRTC_2BPPV1_Format:nI,RGBA_PVRTC_4BPPV1_Format:iI,RGBA_S3TC_DXT1_Format:P_,RGBA_S3TC_DXT3_Format:B_,RGBA_S3TC_DXT5_Format:k_,RGB_BPTC_SIGNED_Format:xI,RGB_BPTC_UNSIGNED_Format:_I,RGB_ETC1_Format:rI,RGB_ETC2_Format:sI,RGB_PVRTC_2BPPV1_Format:tI,RGB_PVRTC_4BPPV1_Format:eI,RGB_S3TC_DXT1_Format:R_,RGFormat:I_,RGIntegerFormat:$v,RawShaderMaterial:Nw,Ray:Js,Raycaster:ku,Rec709Primaries:ry,RectAreaLight:wz,RedFormat:xp,RedIntegerFormat:T_,ReinhardToneMapping:Jv,RenderTarget:DF,RepeatWrapping:Ao,ReplaceStencilOp:cF,ReverseSubtractEquation:LU,RingGeometry:c_,SIGNED_RED_GREEN_RGTC2_Format:CI,SIGNED_RED_RGTC1_Format:wI,SRGBColorSpace:gt,SRGBTransfer:Vi,Scene:Er,ShaderChunk:Ct,ShaderLib:qr,ShaderMaterial:Bt,ShadowMaterial:Fw,Shape:Pu,ShapeGeometry:MT,ShapePath:Zz,ShapeUtils:Gl,ShortType:KT,Skeleton:_y,SkeletonHelper:Vte,SkinnedMesh:wo,Source:th,Sphere:Zi,SphereGeometry:tl,Spherical:t2,SphericalHarmonics3:Sz,SplineCurve:DR,SpotLight:ky,SpotLightHelper:Hte,Sprite:gR,SpriteMaterial:gw,SrcAlphaFactor:b_,SrcAlphaSaturateFactor:QU,SrcColorFactor:NU,StaticCopyUsage:Kq,StaticDrawUsage:oy,StaticReadUsage:qq,StereoCamera:wte,StreamCopyUsage:$q,StreamDrawUsage:Xq,StreamReadUsage:Jq,StringKeyframeTrack:zp,SubtractEquation:DU,SubtractiveBlending:QT,TOUCH:fp,TangentSpaceNormalMap:bu,TetrahedronGeometry:TT,Texture:Gt,TextureLoader:Kl,TorusGeometry:lu,TorusKnotGeometry:IT,Triangle:Xr,TriangleFanDrawMode:U_,TriangleStripDrawMode:TI,TrianglesDrawMode:sF,TubeGeometry:RT,UVMapping:C_,Uint16BufferAttribute:tw,Uint32BufferAttribute:ZI,Uint8BufferAttribute:BY,Uint8ClampedBufferAttribute:kY,Uniform:Se,UniformsGroup:Nte,UniformsLib:Ge,UniformsUtils:Jm,UnsignedByteType:cn,UnsignedInt248Type:eh,UnsignedIntType:_s,UnsignedShort4444Type:ZT,UnsignedShort5551Type:$T,UnsignedShortType:Zv,VSMShadowMap:Wl,Vector2:J,Vector3:S,Vector4:qe,VectorKeyframeTrack:Jl,VideoTexture:JN,WebGL1Renderer:TN,WebGL3DRenderTarget:bY,WebGLArrayRenderTarget:AY,WebGLCoordinateSystem:ql,WebGLCubeRenderTarget:iR,WebGLMultipleRenderTargets:Kte,WebGLRenderTarget:qt,WebGLRenderer:lh,WebGLUtils:MN,WebGPUCoordinateSystem:ay,WireframeGeometry:zR,WrapAroundEnding:ty,ZeroCurvatureEnding:_p,ZeroFactor:UU,ZeroSlopeEnding:wp,ZeroStencilOp:lF,_SRGBAFormat:G_,createCanvasElement:RF,sRGBEncoding:II},Symbol.toStringTag,{value:"Module"}));let $z,e4=null;function ul(){return $z}function o2(n){if(n==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}e4!==n&&(e4=n,$z=new n)}const a2=new Map;function eo(n=(e=>(e=globalThis.location)==null?void 0:e.hostname)()){if(a2.has(n))return a2.get(n);const e=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(n);return a2.set(n,e),e===!0}function t4(){return window.location.hostname.includes("glitch.me")}var Si=(n=>(n.ContextRegistered="ContextRegistered",n.ContextCreationStart="ContextCreationStart",n.ContextCreated="ContextCreated",n.ContextFirstFrameRendered="ContextFirstFrameRendered",n.ContextDestroying="ContextDestroying",n.ContextDestroyed="ContextDestroyed",n.MissingCamera="MissingCamera",n.ContextClearing="ContextClearing",n.ContextCleared="ContextCleared",n))(Si||{});class fi{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(e){globalThis["NeedleEngine.Context.Current"]=e}static get All(){return this.Registered}static register(e){this.Registered.push(e),this.dispatchCallback("ContextRegistered",e)}static unregister(e){const i=this.Registered.indexOf(e);i!==-1&&this.Registered.splice(i,1)}static registerCallback(e,i){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(i)}static unregisterCallback(e,i){if(!this._callbacks[e])return;const r=this._callbacks[e].indexOf(i);r!==-1&&this._callbacks[e].splice(r,1)}static dispatchCallback(e,i,r){if(!this._callbacks[e])return!0;const s={event:e,context:i};if(r)for(const a in r)s[a]=r[a];const o=new Array;return this._callbacks[e].forEach(a=>{const l=a(s);l instanceof Promise&&o.push(l)}),Promise.all(o)}static addContextCreatedCallback(e){this.registerCallback("ContextCreated",e)}static addContextDestroyedCallback(e){this.registerCallback("ContextDestroyed",e)}}p(fi,"Registered",[]),p(fi,"_callbacks",{});const i4=()=>n=>n;function $te(n){return i4()(n)}function eie(){return!!te("debug")}class Qo{constructor(e,i){p(this,"_factory"),p(this,"_cache",[]),p(this,"_maxSize"),p(this,"_index",0),this._factory=e,this._maxSize=i}get(){const e=this._index%this._maxSize;return this._index++,this._cache.length<=e&&(this._cache[e]=this._factory()),this._cache[e]}}let Xp=!1;const l2=new Array;typeof window<"u"&&setTimeout(()=>{if(Xp){const n={},e=new URL(window.location.href),i=new URL(e);i.searchParams.append("console","");const r=i.toString().replace(/=$|=(?=&)/g,"");for(const o of l2){const a=new URL(e);a.searchParams.append(o,""),n[o]=a.toString().replace(/=$|=(?=&)/g,"")}console.log(`\u{1F335} ?help: Debug Options for Needle Engine.
Append any of these parameters to the URL to enable specific debug options.
Example: ${r} will show an onscreen console window.`);const s=Xp===!0?"":` (containing "${Xp}")`;console.group("Available URL parameters:"+s);for(const o in n)typeof Xp=="string"&&!o.toLowerCase().includes(Xp.toLowerCase())||(console.groupCollapsed(o),console.log("Reload with this flag enabled:"),console.log(n[o]),console.groupEnd());console.groupEnd()}},100);function Dy(){var n;return new URLSearchParams((n=globalThis.location)==null?void 0:n.search)}function te(n){Xp&&!l2.includes(n)&&l2.push(n);const e=Dy();if(e.has(n)){const i=e.get(n);if(i){const r=Number(i);return isNaN(r)?i:r}else return!0}return!1}Xp=te("help");function tie(n,e){const i=Dy();i.has(n)?i.set(n,e):i.append(n,e),document.location.search=i.toString()}function n1(n,e,i=!0){const r=Dy();r.has(n)?e===null?r.delete(n):r.set(n,e):e!==null&&r.append(n,e),i?n4(n,r):h2(n,r)}function c2(n,e,i){n.has(e)?n.set(e,i.toString()):n.append(e,i.toString())}function n4(n,e,i){window.history.pushState(i,n,"?"+e.toString())}function h2(n,e,i){window.history.replaceState(i,n,"?"+e.toString())}function iie(n){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=i.length,s=0;s<n;s++)e+=i.charAt(Math.floor(Math.random()*r));return e}function nie(n,e){return Math.floor(Math.random()*(e-n+1))+n}const r4=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],s4=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function o4(){const n=r4[Math.floor(Math.random()*r4.length)],e=s4[Math.floor(Math.random()*s4.length)];return n+"_"+e}function a4(n){return n=n.replace(/[^a-z0-9 \.,_-]/gim,""),n.trim()}function fg(n,e,i=!0,r=!1){var s;if(e==null)return null;if(e.userData&&e.userData.guid===n||e.guid==n)return e;if(r&&(s=e.userData)!=null&&s.components){for(const o of e.userData.components)if(o.guid===n)return o}if(i){if(e.scenes)for(const o in e.scenes){const a=e.scenes[o],l=fg(n,a,i,r);if(l)return l}if(e.children)for(const o in e.children){const a=e.children[o],l=fg(n,a,i,r);if(l)return l}}}function Ly(n,e){if(n!=null&&typeof n=="object"){let i;Array.isArray(n)?i=[]:(i=Object.create(n),Object.assign(i,n));for(const r of Object.keys(n)){const s=n[r];e&&!e(n,r,s)?i[r]=s:s?.clone!==void 0&&typeof s.clone=="function"?i[r]=s.clone():i[r]=Ly(s,e)}return i}return n}function $l(n){return new Promise((e,i)=>{setTimeout(e,n)})}function r1(n,e){if(n<=0)return Promise.resolve();if(e||(e=fi.Current),!e)return Promise.reject("No context");const i=e.time.frameCount+n;return new Promise((r,s)=>{if(!e)return s("No context");const o=()=>{e.time.frameCount>=i&&(e.pre_update_callbacks.splice(e.pre_update_callbacks.indexOf(o),1),r())};e.pre_update_callbacks.push(o)})}const s1=te("debugresolveurl"),l4="rel:";function rie(n,e){return Du(n,e)}function Du(n,e){if(e===void 0)return s1&&console.warn("getPath: uri is undefined, returning uri",e),e;if(e.startsWith("./"))return e;if(e.startsWith("http"))return s1&&console.warn("getPath: uri is absolute, returning uri",e),e;if(n===void 0)return s1&&console.warn("getPath: source is undefined, returning uri",e),e;e.startsWith(l4)&&(e=e.substring(4));const i=n.lastIndexOf("/");if(i>=0){const r=n.substring(0,i+1);for(;r.endsWith("/")&&e.startsWith("/");)e=e.substring(1);const s=r+e;return s1&&console.log("source:",n,`changed uri 
from`,e,`
to `,s,`
basePath: `+r),s}return e}class sie{constructor(e,i){p(this,"writeCallbacks",[]),p(this,"_applied",!1),p(this,"_object"),p(this,"_prop"),p(this,"_wrapperProp"),this._object=e,this._prop=i,this._wrapperProp=Symbol("$"+i),this.apply()}subscribeWrite(e){this.writeCallbacks.push(e)}unsubscribeWrite(e){const i=this.writeCallbacks.indexOf(e);i!==-1&&this.writeCallbacks.splice(i,1)}apply(){if(this._applied||!this._object)return;const e=this._object,i=this._prop;if(e[i]===void 0)return;this._applied=!0,e[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const r=e[i];e[this._wrapperProp]=r,Object.defineProperty(e,i,{get:()=>e[this._wrapperProp],set:s=>{e[this._wrapperProp]=s;for(const o of this.writeCallbacks)o(s,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const e=this._object,i=this._prop;Reflect.deleteProperty(e,i);const r=e[this._wrapperProp];e[i]=r,Reflect.deleteProperty(e,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class cu{constructor(e,i){if(p(this,"_watches",[]),Array.isArray(i))for(const r of i)this._watches.push(new cu(e,r));else this._watches.push(new sie(e,i))}subscribeWrite(e){for(const i of this._watches)i.subscribeWrite(e)}unsubscribeWrite(e){for(const i of this._watches)i.unsubscribeWrite(e)}apply(){for(const e of this._watches)e.apply()}revoke(){for(const e of this._watches)e.revoke()}dispose(){for(const e of this._watches)e.dispose();this._watches.length=0}}const mg=Symbol("needle:watches");function o1(n,e){if(!n[mg])if(n instanceof J)n[mg]=new cu(n,["x","y"]);else if(n instanceof S)n[mg]=new cu(n,["x","y","z"]);else if(n instanceof qe||n instanceof Ce)n[mg]=new cu(n,["x","y","z","w"]);else return!1;return n[mg].subscribeWrite(e),!0}function u2(n,e){if(!n)return;const i=n[mg];i&&i.unsubscribeWrite(e)}let d2;function gg(){if(d2!==void 0)return d2;const n=window.navigator.userAgent,e=/Windows|MacOS|Mac OS/.test(n),i=/Windows NT/.test(n)&&/Edg/.test(n)&&!/Win64/.test(n);return d2=e&&!i&&!Lu()}let a1;function ec(){return a1!==void 0?a1:typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1?a1=!0:a1=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent)}function c4(){return/Android/.test(navigator.userAgent)}function qp(){return/WebXRViewer\//i.test(navigator.userAgent)}let l1;function h4(){if(l1!==void 0)return l1;if(navigator.userAgentData)return l1=navigator.userAgentData.platform==="macOS";{const n=navigator.userAgent.toLowerCase();return l1=n.includes("mac os x")||n.includes("macintosh")}}let p2;const oie=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function Lu(){return p2!==void 0?p2:p2=oie.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function vg(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function c1(){return navigator.userAgent.includes("OculusBrowser")}async function Uy(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(n){return console.error("Error querying `microphone` permissions.",n),!1}}const aie=/ip=(?<ip>.+?)\n/s;async function lie(){const n=await(await fetch("https://www.cloudflare.com/cdn-cgi/trace")).text(),e=aie.exec(n);return e?e[1]:null}async function cie(){return(await(await fetch("https://api.db-ip.com/v2/free/self")).json()).ipAddress}async function hie(){return await(await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null)).json()}const Uu=new WeakMap;function u4(n,e,i){if(!Uu.get(n)){const s=new MutationObserver(o=>{uie(n,o)});Uu.set(n,{observer:s,attributeChangedListeners:new Map}),s.observe(n,{attributes:!0})}const r=Uu.get(n).attributeChangedListeners;r.has(e)||r.set(e,[]),r.get(e).push(i)}function d4(n,e,i){if(!Uu.get(n))return;const r=Uu.get(n).attributeChangedListeners;if(!r.has(e))return;const s=r.get(e),o=s.indexOf(i);if(o!==-1&&(s.splice(o,1),s.length<=0)){r.delete(e);const a=Uu.get(n);a?.observer.disconnect(),Uu.delete(n)}}function uie(n,e){const i=Uu.get(n).attributeChangedListeners;for(const r of e)if(r.type==="attributes"){const s=r.attributeName,o=n.getAttribute(s);if(i.has(s))for(const a of i.get(s))a(o)}}class f2{constructor(e){p(this,"reason"),this.reason=e}}async function h1(n){const e=await Promise.allSettled(n).catch(s=>[new f2(s.message)]);let i=!1;const r=e.map(s=>"value"in s?s.value:(i=!0,new f2(s.reason)));return{anyFailed:i,results:r}}async function p4(n){if(!globalThis.QRCode){const r="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js";let s=document.head.querySelector(`script[src="${r}"]`);s||(s=document.createElement("script"),s.src=r,document.head.appendChild(s)),await new Promise((o,a)=>{s.addEventListener("load",()=>{o(!0)})})}const e=globalThis.QRCode,i=n.domElement??document.createElement("div");return new e(i,{width:n.width??256,height:n.height??256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:e.CorrectLevel.M,...n}),i}const f4=te("debugdebug");let Fy=!1;(te("noerrors")||te("nooverlaymessages"))&&(Fy=!0);const m2="needle_engine_global_error_container";var Wo=(n=>(n[n.Log=0]="Log",n[n.Warn=1]="Warn",n[n.Error=2]="Error",n))(Wo||{});function g2(){return y4}const v2=new Array;function die(n){v2.push(n)}let y2=!1;function pie(...n){if(!y2){y2=!0;try{for(let e=0;e<v2.length;e++)v2[e](...n)}catch(e){console.error(e)}y2=!1}}const m4=console.error,g4=function(...n){m4.apply(console,n),gie(n),tc(2,n),A2(...n)};function v4(n){Fy=!n,n?console.error=g4:console.error=m4}function fie(n){return v4(n)}function mie(){Fy||(f4&&console.warn("Patch console",window.location.hostname),console.error=g4,window.addEventListener("error",n=>{if(!n)return;const e=n.error;if(e===void 0){eo()&&console.warn("Received unknown error",n,n.target);return}tc(2,e,n.filename,n.lineno),A2(n)},!0),window.addEventListener("unhandledrejection",n=>{Fy||n&&(n.reason?tc(2,n.reason.message,n.reason.stack):tc(2,"unhandled rejection"),A2(n))}))}let y4=0;function A2(...n){y4+=1,pie(...n)}function gie(n){if(Array.isArray(n))for(let e=0;e<n.length;e++){const i=n[e];typeof i=="string"&&i.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(n[e]="Some animated objects couldn't be found: see console for details")}}function tc(n,e,i,r){if(Fy)return;const s=fi.Current,o=s?.domElement??document.querySelector("needle-engine");if(o){if(Array.isArray(e)){let a="";for(let l=0;l<e.length;l++){let c=e[l];c instanceof Error&&(c=c.message),typeof c!="object"&&(l>0&&(a+=" "),a+=c)}e=a}!e||e.length<=0||vie(n,o,e)}}const Ny=new Map;function vie(n,e,i){if(i==null)return;const r=Aie(e);if(r.childElementCount>=20){const l=r.lastElementChild;x4(l)}i.length>400&&(i=i.substring(0,400)+"...");const s=i;if(Ny.has(s))return;const o=bie(n,i);r.prepend(o);const a=()=>{Ny.delete(s),x4(o)};Ny.set(s,a),setTimeout(a,1e4)}function A4(){f4&&console.log("Clearing messages");for(const n of Ny.values())n?.call(n);Ny.clear()}const yie=`

@import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 400;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function Aie(n){globalThis[m2]||(globalThis[m2]=new Map);const e=globalThis[m2];if(e.has(n))return e.get(n);{const i=document.createElement("div");e.set(n,i),i.setAttribute("data-needle_engine_debug_overlay",""),i.classList.add("debug-container"),i.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
            word-break: break-word;
        `,n.shadowRoot?n.shadowRoot.appendChild(i):n.appendChild(i);const r=document.createElement("style");return r.innerHTML=yie,i.appendChild(r),i}}const b4=Symbol("logtype"),u1=new Map;function x4(n){n.remove();const e=n[b4],i=u1.get(e)??[];i.push(n),u1.set(e,i)}function bie(n,e){if(u1.has(n)){const r=u1.get(n);if(r.length>0){const s=r.pop();return s.innerHTML=e,s}}const i=document.createElement("div");switch(i.setAttribute("data-id","__needle_engine_debug_overlay"),i.style.marginRight="5px",i.style.padding=".5em",i.style.backgroundColor="rgba(0,0,0,.9)",i.style.marginTop="5px",i.style.marginBottom="3px",i.style.borderRadius="8px",i.style.pointerEvents="all",i.style.userSelect="text",i.style.maxWidth="250px",i.style.whiteSpace="pre-wrap",i.style["backdrop-filter"]="blur(10px)",i.style["-webkit-backdrop-filter"]="blur(10px)",i.style.backgroundColor="rgba(20,20,20,.8)",i.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",i.style.border="1px solid rgba(160,160,160,.2)",i[b4]=n,n){case 0:i.classList.add("log"),i.style.color="rgba(200,200,200,.7)",i.style.backgroundColor="rgba(40,40,40,.7)";break;case 1:i.classList.add("warn"),i.style.color="rgb(255, 255, 150)",i.style.backgroundColor="rgba(50,50,20,.8)";break;case 2:i.classList.add("error"),i.style.color="rgb(255, 50, 50",i.style.backgroundColor="rgba(50,20,20,.8)";break}return i.title="Open the browser console (F12) for more information",i.innerHTML=e,i}var dl={};dl.d=(n,e)=>{for(var i in e)dl.o(e,i)&&!dl.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:e[i]})},dl.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),dl.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var Zn={};dl.d(Zn,{ti:()=>Ci,nS:()=>fj,eB:()=>g_,Yp:()=>b2,VB:()=>Jp,BC:()=>zy,zN:()=>Yp,cV:()=>Vv,hW:()=>y_,k2:()=>T4,K6:()=>sl,M7:()=>x2,ls:()=>Gy,Hi:()=>W4,EY:()=>v_,MR:()=>U4,zf:()=>M4,Ay:()=>Dse,yo:()=>mj});var b2={};dl.r(b2),dl.d(b2,{get:()=>_4,set:()=>xie});var x2={};dl.r(x2),dl.d(x2,{alphaTestTransformer:()=>g1,asPreprocessorValueTransformer:()=>F4,toPreprocessorTriggerTransformer:()=>D2,toUserDataTransformer:()=>Bne,uniformOrUserDataTransformer:()=>Sa});const _2={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},xie=function(n){for(const e in n)_2[e]=n[e]},_4=function(n){return Object.prototype.hasOwnProperty.call(_2,n)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${n}'`),_2[n]};class Ci{constructor(e,i=null,r=!0){this._id=e,this._value=i,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=r}get id(){return this._id}get value(){return this._value}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,i){this.output(i)}output(e){}_outputValue(e){e[this._id]=this._value}process(e){}render(e){}getInheritedInput(e){if(this._value!=="inherit")return this._value;const i=e._parent._value;return i&&i[`_${this._id}`]?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}getDefaultValue(){return _4(this._id)}isValid(e){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class _ie extends Ci{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(e){this.isValid(e)&&(this._value=e,this._needsUpdate=!0)}update(e,i){if(this._value!=="auto")this._actualValue=this._value;else{const r=e._parent._value;if(r!==null){const s=r._renderOrder._actualValue,o=1+r._children._uis.indexOf(e);this._actualValue=s+o}}for(const r of e._children._uis)r._renderOrder._value==="auto"&&(r._renderOrder._needsUpdate=!0);this._outputValue(i)}_outputValue(e){e[this._id]=this._actualValue}get value(){return this._value}}class Yp extends Ci{constructor(e,i=null,r=!0){super(e,i,r),this.output=this._outputValue,this._notInheritedValue=null}update(e,i){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),this.propagate(e),this._outputValue(i)}propagate(e){for(const i of e._children._uis){const r=i[`_${this._id}`];r!==void 0&&r._value==="inherit"&&(i[`_${this._id}`]._needsUpdate=!0)}}_outputValue(e){e[this._id]=this._notInheritedValue}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class wie extends Yp{constructor(){super("offset","inherit",!1)}update(e,i){super.update(e,i),e._parent._value!==null&&(e.position.z=this._notInheritedValue)}}class Sie extends Yp{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=Eie,this.output=this._outputValue}}const Cie=["inherit","none","antialiased"];function Eie(n){return Cie.indexOf(n)===-1?(console.warn(`.fontSmoothing value '${n}' is not valid. Aborted`),!1):!0}var Mie=n=>{var e={};return dl.d(e,n),e};const Qe=Mie({BackSide:()=>an,BufferAttribute:()=>Ye,BufferGeometry:()=>dt,Color:()=>be,DoubleSide:()=>yi,EventDispatcher:()=>wr,FileLoader:()=>Yr,FrontSide:()=>Fn,LinearFilter:()=>Dt,Mesh:()=>pe,MeshBasicMaterial:()=>Jt,Object3D:()=>ve,Plane:()=>dr,PlaneGeometry:()=>cr,ShaderMaterial:()=>Bt,Texture:()=>Gt,TextureLoader:()=>Kl,Vector2:()=>J,Vector3:()=>S,Vector4:()=>qe});class un extends Ci{constructor(e,i,r=!0){super(e,"unset",r),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(e,i){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const r of e._children._uis){const s=r[`_${this._id}`];(s._input?s._input:s._value)==="inherit"&&(r[`_${this._id}`]._needsUpdate=!0)}this.output(i)}computeOutputValue(e){this._value=this._input}_computeFromInherited(e){this._value=this._inheritedInput}set value(e){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._input=this._inline=e,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(e){return!0}getInheritedInput(e){if(this._input!=="inherit")return this._input;const i=e._parent._value;return i?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}}class d1 extends un{constructor(e,i){super(e,i,!1),this._input=new Qe.Vector4(0,0,0,0),this._inline=null,this._value=new Qe.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input)}set inline(e){this._vector4ValueSetter(this._input,e),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get top(){return this._input.x}set right(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(e,i){if(i instanceof Qe.Vector4){e.copy(i);return}if((typeof i=="string"||i instanceof String)&&(i=i.split(" ")),Array.isArray(i))switch(i=i.map(r=>parseFloat(r)),i.length){case 1:e.setScalar(i[0]);return;case 2:e.x=e.z=i[0],e.y=e.w=i[1];return;case 3:e.x=i[0],e.y=i[1],e.z=i[2];return;case 4:e.x=i[0],e.y=i[1],e.z=i[2],e.w=i[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(i)||e.setScalar(i)}}class Tie extends d1{constructor(){super("padding",new Qe.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._bounds._needsUpdate=!0,e._bounds._needsRender=!0,e._layouter._needsProcess=!0,e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}class Iie extends d1{constructor(){super("margin",new Qe.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._flexDirection._needsProcess=!0)}}const w4=function(n,e,i){n[e]=i},Rie=function(n,e,i){i!==null&&(n[e]=i)};class p1{constructor(e){this._definition=e}set definition(e){this._definition=e}mediate(e,i,r,s=null){for(const o in this._definition){const a=this._definition[o];if(r[o]!==void 0){const l=a.t?a.t:w4;l(i,a.m,r[o]),s&&l(s,a.m,r[o])}}}static mediate(e,i,r,s,o=null){if(i)for(const a in s){const l=s[a];if(r[a]!==void 0){const c=l.t?l.t:w4;c(i,l.m,r[a]),o&&c(o,l.m,r[a])}}}}class Pie extends Ci{constructor(){super("parent",null,!1)}update(e,i){e.parent&&e.parent.isUI?this._value=e.parent:this._value=null}set value(e){console.warn("ParentProperty is readonly")}get value(){return this._value}find(e){return this._value?e(this._value)?this._value:this._value._parent.find(e):null}dispose(){this._value=null}}const w2=function(n,e,i=6){return n.toFixed(i)===e.toFixed(i)};class S4 extends Ci{constructor(e,i){super(e,i,!0),this.output=this._outputValue}set value(e){this.isValid(e)&&(w2(this._value,e)||(this._value=e,this._needsUpdate=!0))}get value(){return this._value}}class C4 extends Yp{constructor(e){super(e,"inherit",!0),this.isValid=kie}}const Bie=[Qe.FrontSide,Qe.BackSide,Qe.DoubleSide];function kie(n){return Bie.indexOf(n)===-1?(console.warn(`SideProperty value '${n}' is not valid. Abort`),!1):!0}class E4{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(e){this._lineBreak=e}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(e){this._kerning=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(e){this._cumulativeWidth=e}get marginLeft(){return this._marginLeft}set marginLeft(e){this._marginLeft=e}get marginRight(){return this._marginRight}set marginRight(e){this._marginRight=e}get paddingLeft(){return this._paddingLeft}set paddingLeft(e){this._paddingLeft=e}get paddingRight(){return this._paddingRight}set paddingRight(e){this._paddingRight=e}get lineBase(){return 0}set fontFactor(e){this._fontFactor=e}get fontFactor(){return this._fontFactor}}class M4{constructor(e){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=e}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(e){this._yoffset=e}clone(e){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class T4 extends E4{constructor(e){super(),this._typographic=e}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}const Oie={light:"100",normal:"400",bold:"700",bolder:"900"};function S2(n){return isNaN(n)?Oie[n]||n:n.toString()}class Die extends Qe.EventDispatcher{constructor(e,i){super(),this._isReady=!1,this._weight=S2(e),this._style=i,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(e){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(e){let i=this._chars[e];if(i)return i;if(e.match(/\s/))return this._chars[" "];const r=this._getFallbackCharacter(e);if(r&&(i=this._chars[r],i))return i;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${e}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(e){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(e,i){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(e){return this._kernings[e]?this._kernings[e]:0}adjustTypographicGlyphs(e){for(const i in e){const r=this.getTypographicGlyph(i),s=e[i];for(const o in s)r["_"+o]=e[i][o]}}_checkReadiness(){this._readyCondition()&&Uie(this)}_alterElementProperties(e){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const Lie={type:"ready"};function Uie(n){n._isReady=!0,n.dispatchEvent(Lie)}const zy=Die;class Fie extends Ci{constructor(e=null){super("font",e,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=Nie}output(e){e[this._id]=this._fontVariant}update(e,i){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof zy)this._fontVariant=this._value;else{const r=e._fontFamily._value;r&&(this._fontVariant=r.getVariant(e._fontWeight._value,e._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(e),this._handleFontReadyClosure=zie(e,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!e._fontMaterial._defaultMaterial||!(e._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(e._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,e._fontMaterial._needsUpdate=!0))}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function Nie(n){return n instanceof zy?!0:(console.warn(`.font value '${n}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function zie(n,e){return function(){e._needsUpdate=!0,n._glyphs._needsProcess=!0,e._fontVariant.removeEventListener("ready",e._handleFontReadyClosure),e._handleFontReadyClosure=null}}class jie extends un{constructor(e){super("display",e),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=Hie}computeOutputValue(e){e._visible._value=this._output!=="none"}}const Gie=["none","flex"];function Hie(n){return Gie.indexOf(n)===-1?(console.warn(`(.style) display value '${n}' is not valid. Aborted`),!1):!0}class Vie extends un{constructor(e){super("boxSizing",e),this._allowsInherit=!1,this.isValidValue=Wie}computeOutputValue(e){this._value=this._inheritedInput,e._bounds._needsUpdate=!0}}const Qie=["border-box","content-box"];function Wie(n){return Qie.indexOf(n)===-1?(console.warn(`(.style) boxSizing value '${n}' is not valid. Aborted`),!1):!0}class jy extends un{constructor(e,i){super(e,i,!1),this._value=new Qe.Color,this.output=this._outputValue}computeOutputValue(e){this._input!=="inherit"&&this._value.set(this._input)}set inline(e){this._input=this._inline=e,this._needsUpdate=!0}}class C2 extends un{constructor(e,i){super(e,i,!0),this.isValidValue=Xie,this._allowsInherit=!1,this._input=i,this._value=i,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(e){e[this._id]=this._inheritedInput}}function Xie(n){return n<0&&n>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${n}' is not valid)`),!1):!0}class qie extends un{constructor(e){super("backgroundImage",e,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new Qe.Vector2(1,1),this.isValidValue=Yie}get value(){return this._value}output(e){e[this._id]=this._value,e.tSize=this._textureSize}computeOutputValue(e){if(this._value=this._inheritedInput,this._value instanceof Qe.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(e){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function Yie(n){return!0}class Jie extends un{constructor(e){super("backgroundSize",e,!0),this.isValidValue=Zie,this.output=this._outputValue}}const Kie=["cover","contain","stretch"];function Zie(n){return Kie.indexOf(n)===-1?(console.warn(`(.style) backgroundSize value '${n}' is not valid. Aborted`),!1):!0}class $ie extends un{constructor(e){super("overflow",e,!0),this.isValidValue=tne,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(e,i){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const r of e._children._uis)r._overflow._needsUpdate=!0;this.output(i)}output(e){e.clippingPlanes=this._clippingPlanes}computeOutputValue(e){super.computeOutputValue(e),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const i=e._parent._value;if(i!==null){const r=i._overflow;if((r._value==="hidden"||r._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new Qe.Plane(new Qe.Vector3(0,-1,0),1),new Qe.Plane(new Qe.Vector3(-1,0,0),1),new Qe.Plane(new Qe.Vector3(0,1,0),1),new Qe.Plane(new Qe.Vector3(1,0,0),1)];for(let s=0;s<this._clippingPlanes.length;s++)this._clippingPlanes[s].parent=i;r._clippingPlanes!==null&&this._clippingPlanes.push(...r._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(r._value==="visible"||r._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(e){this._renderStrategy(e)}_emptyRender(e){}_hiddenRender(e){const i=e._parent._value,r=i._bounds._offsetHeight,s=i._bounds._offsetWidth,o=i._padding._value,a=i._borderWidth._value;for(let l=0;l<4&&l<this._clippingPlanes.length;l++){const c=this._clippingPlanes[l];switch(l%4){case 0:c.constant=r/2-(o.x+a.x);break;case 1:c.constant=s/2-(o.y+a.y);break;case 2:c.constant=r/2-(o.z+a.z);break;case 3:c.constant=s/2-(o.w+a.w);break}c.applyMatrix4(i.matrixWorld)}for(let l=0;l<e._children._uis.length;l++){const c=e._children._uis[l];c._overflow._needsRender=!0}}_propagateRender(e){for(let i=0;i<e._children._uis.length;i++){const r=e._children._uis[i];r._overflow._needsRender=!0}}}const ene=["visible","hidden"];function tne(n){return ene.indexOf(n)===-1?(console.warn(`(.style) overflow value '${n}' is not valid. Aborted`),!1):!0}const yg="rem",I4="em",f1="%",ine=[yg,I4,f1],R4=function(n){return ine.indexOf(n)===-1?yg:n};class nne extends d1{constructor(e){super("borderRadius",e),this._valueUV=this._value.clone(),this._input=new Qe.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new Qe.Vector2(0,1),this._cornerTR=new Qe.Vector2(1,1),this._cornerBR=new Qe.Vector2(1,0),this._cornerBL=new Qe.Vector2(0,0);const i=new m1(this._valueUV,["x","y"]),r=new m1(this._valueUV,["z","w"]),s=new m1(this._valueUV,["x","w"]),o=new m1(this._valueUV,["y","z"]);i.complementaryMediation=r,r.complementaryMediation=i,s.complementaryMediation=o,o.complementaryMediation=s,this._sideMediators=[i,r,s,o],this._units=yg}set units(e){this._units=R4(e),this._needsProcess=!0}get units(){return this._units}set mediation(e){e!==this._mediation&&(this._mediation=e,this._needsUpdate=!0)}get mediation(){return this._mediation}output(e){e.cornerTL=this._cornerTL,e.cornerTR=this._cornerTR,e.cornerBR=this._cornerBR,e.cornerBL=this._cornerBL}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(e){this._needsRender=!0}render(e){this._valueUV.copy(this._value);const i=e._bounds._offsetWidth,r=e._bounds._offsetHeight;if(this._units===f1&&this._valueUV.divideScalar(100),this._units===yg&&this._valueUV.divideScalar(Math.min(i,r)),this._mediation)do this._sideMediators.forEach(a=>a.computeValue()),this._sideMediators.sort((a,l)=>a.value<l.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let s=i>r?r/i:1,o=i<r?i/r:1;this._units===f1&&(s=o=1),this._cornerTL.x=this._valueUV.x*s,this._cornerTL.y=1-this._valueUV.x*o,this._cornerTR.x=1-this._valueUV.y*s,this._cornerTR.y=1-this._valueUV.y*o,this._cornerBR.x=1-this._valueUV.z*s,this._cornerBR.y=this._valueUV.z*o,this._cornerBL.x=this._valueUV.w*s,this._cornerBL.y=this._valueUV.w*o}dispose(){for(const e of this._sideMediators)e.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(e){this._input.x===e&&this._input.y===e||(this._input.x=this._input.y=e,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(e){this._input.y===e&&this._input.z===e||(this._input.y=this._input.z=e,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(e){this._input.z===e&&this._input.w===e||(this._input.z=this._input.w=e,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(e){this._input.w===e&&this._input.x===e||(this._input.w=this._input.x=e,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class m1{constructor(e,i){this._borderRadiuses=e,this._sideProperties=i,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(e){this._complementaryMediation=e}computeValue(){let e=0;for(const i of this._sideProperties)e+=this._borderRadiuses[i];this._value=e}mediate(e=!0){if(!(this._value<1)){for(const i of this._sideProperties)this._borderRadiuses[i]/=this._value;e&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class rne extends d1{constructor(e){super("borderWidth",e,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=yg}set units(e){this._units=R4(e),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,e._bounds._needsUpdate=!0,e._layouter._needsUpdate=!0}_outputValue(e){e[this._id]=this._valueUV}process(e){this._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._valueUV.copy(this._value);const i=e._bounds._offsetWidth,r=e._bounds._offsetHeight;if(this._units===f1&&(console.log("Percent"),console.log(this._valueUV)),this._units===yg)i!==0&&(this._valueUV.w/=i,this._valueUV.y/=i),r!==0&&(this._valueUV.x/=r,this._valueUV.z/=r);else if(this._units===I4){if(i!==0){const s=i>r?r/i:1;this._valueUV.y*=s,this._valueUV.w*=s}if(r!==0){const s=i<r?i/r:1;this._valueUV.x*=s,this._valueUV.z*=s}}}}class sne extends Ci{constructor(e,i=!0){super("visible",i,!0),this._needsUpdate=!1}update(e,i){e.visible=this._value,e._parent._value&&(e._parent._value._children._needsUpdate=!0)}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}}class P4 extends jy{constructor(e){super("backgroundColor",e,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(e){e._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class ph extends Ci{constructor(e="untitled"){super(e,void 0,!1)}update(e,i){}output(e){}}class one extends Ci{constructor(){super("inlineJustificator",null,!1),this._value=null}update(e,i){}process(e){const i=e._bounds._innerHeight,r=e._layouter._value,s=Math.abs(r.height);let o=(()=>{switch(e._alignItems._value){case"inherit":case"start":return i/2;case"end":return s-i/2;case"stretch":case"center":return s/2}})();const a=e._padding._value,l=e._borderWidth._value;o+=(-a.x+a.z)/2+(-l.x+l.z)/2,r.forEach(c=>{c.y+=o,c.forEach(h=>{h.offsetY+=o})})}}const ane=["start","center","end","stretch"],lne=function(n){return ane.indexOf(n)===-1?(console.warn(`(.style) alignItems value '${n}' is not valid. Aborted`),!1):!0};class E2 extends un{constructor(){super("alignItems","inherit",!0),this.isValidValue=lne}}class M2 extends un{constructor(){super("textAlign","inherit",!0),this.isValidValue=hne}}const cne=["left","right","center","justify","justify-left","justify-right","justify-center"],hne=function(n){return cne.indexOf(n)===-1?(console.warn(`(.style) textAlign value '${n}' is not valid. Aborted`),!1):!0};class T2 extends un{constructor(){super("flexDirection","inherit",!0),this.isValid=dne}}const une=["row","row-reverse","column","column-reverse"];function dne(n){return une.indexOf(n)===-1?(console.warn(`(.style) flexDirection value '${n}' is not valid. Aborted`),!1):!0}class I2 extends un{constructor(){super("justifyContent","inherit",!0),this.isValidValue=fne}}const pne=["start","center","end","space-between","space-around","space-evenly"];function fne(n){return pne.indexOf(n)===-1?(console.warn(`(.style) justifyContent value '${n}' is not valid. Aborted`),!1):!0}class mne extends un{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._parent._value&&(e._parent._value._children._needsProcess=!0)}}class B4 extends un{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=vne}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value&&(e._parent._value._children._needsProcess=!0)}}const gne=["static","absolute"];function vne(n){return gne.indexOf(n)===-1?(console.warn(`(.style) position value '${n}' is not valid. Aborted`),!1):!0}class k4 extends un{constructor(e,i=null){super(e,i,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._inline=e,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let e=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(e=!1),this._input=this._computed):e=this._input==="inherit",e){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const i=parseFloat(this._input.replace("%","").trim());isNaN(i)||(this._value=i/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=e}}update(e,i){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const r of e._children._uis)r[`_${this._id}`]._needsUpdate=!0;this.output(i),e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}computeOutputValue(e){e._bounds._needsUpdate=!0,e._renderer._needsRender=!0}getInheritedInput(e){if(this._input!=="inherit"&&!this._auto)return this._input;const i=e._parent._value;return i?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class yne extends k4{constructor(){super("width")}}class Ane extends k4{constructor(){super("height")}computeOutputValue(e){super.computeOutputValue(e)}}class O4 extends ph{constructor(){super("textContent"),this._needsUpdate=!1}set value(e){}process(e){let i="";for(let r=0;r<e.children.length;r++){const s=e.children[r];s.isUI&&(i+=s.textContent)}this._value=i}}class D4 extends un{constructor(e){super("fontStyle",e,!0),this.isValidValue=xne}}const bne=["normal","italic"];function xne(n){return bne.indexOf(n)===-1?(console.warn(`(.style) fontStyle value '${n}' is not valid. Aborted`),!1):!0}class L4 extends un{constructor(){super("fontWeight","inherit",!0),this.isValid=wne}}const _ne=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function wne(n){return _ne.indexOf(n.toString())===-1?(console.warn(`(.style) fontWeight value '${n}' is not valid. Aborted`),!1):!0}class U4{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class Sne extends U4{constructor(e){super(),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._name=e.info.face,this._textureWidth=e.common.scaleW,this._textureHeight=e.common.scaleH,this._charset=e.chars.map(i=>i.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class Cne extends T4{constructor(e){super(e)}get uv(){return this.typographic.uv}}class BT extends M4{constructor(e,i){super(e),this._char=i.char,this._width=i.width,this._heigth=i.height,this._xadvance=i.xadvance?i.xadvance:this._width,this._xoffset=i.xoffset?i.xoffset:0,this._yoffset=i.yoffset?i.yoffset:0,this._uv=i.uv?i.uv:null,isNaN(i.x)||(this._uv={left:i.x/e.textureWidth,right:(i.x+i.width)/e.textureWidth,top:1-(i.y+i.height)/e.textureHeight,bottom:1-i.y/e.textureHeight})}get uv(){return this._uv}clone(e){return new BT(this._font,{char:e,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new Cne(this)}}class Ene extends Qe.PlaneGeometry{constructor(e,i){let r=1,s=1;const o=e.typographic.font.size,a=i._segments.value;r=Math.ceil(e.typographic.width/o*a),s=Math.ceil(e.typographic.height/o*a),super(e.width,e.height,r,s),e.uv?(this._mapUVs(e),this._transformGeometry(e)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,e.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(e){const i=e.uv.right-e.uv.left,r=e.uv.bottom-e.uv.top,s=this.getAttribute("uv").array.slice(),o=[];for(let a=0;a<s.length;a+=2){const l=s[a],c=s[a+1];o.push(e.uv.left+i*l),o.push(e.uv.top+r*c)}this.setAttribute("uvG",new Qe.BufferAttribute(new Float32Array(o),2))}_nullifyUVs(){const e=[],i=this.getAttribute("uv").array.length;for(let r=0;r<i;r++)e.push(0);this.setAttribute("uvG",new Qe.BufferAttribute(new Float32Array(e),2))}_transformGeometry(e){this.translate(e.width/2,-e.height/2,0)}}const Mne=`
attribute vec2 uvG;
varying vec2 vUvG;
`,R2=Mne,Tne=`
vUvG = uvG;
`,P2=Tne,Ine=`
gl_Position.z -= 0.00001;
`,B2=Ine,Rne=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,k2=Rne,Pne=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,O2=Pne,g1=function(n,e,i){n.alphaTest=i,D2(n,"USE_ALPHATEST",i>0)},D2=function(n,e,i){n.defines&&(i?n.defines[e]===void 0&&(n.defines[e]="",n.needsUpdate=!0):n.defines[e]!==void 0&&(delete n.defines[e],n.needsUpdate=!0))},F4=function(n,e,i){n.defines[e]&&n.defines[e]===i||(n.defines[e]=i,n.needsUpdate=!0)},Sa=function(n,e,i){n.userData[e]?n.userData[e].value=i:n.uniforms[e].value=i},Bne=function(n,e,i){n.userData[e].value=i};class sl{static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,i){e.userData.glyphMap={value:i.glyphMap},e.userData.unitRange={value:new Qe.Vector2}}static bindUniformsWithUserData(e,i){e.uniforms.glyphMap=i.userData.glyphMap,e.uniforms.unitRange=i.userData.unitRange}static injectShaderChunks(e){sl.injectVertexShaderChunks(e),sl.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+R2),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+P2),e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+B2)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+k2),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+O2)}static from(e){return class extends e{constructor(i={}){sl.ensureMaterialOptions(i),super(i),p(this,"_cumulativeOnBeforeCompile",r=>{sl.bindUniformsWithUserData(r,this),sl.injectShaderChunks(r),this._userDefinedOnBeforeCompile(r)}),sl.ensureDefines(this),sl.ensureUserData(this,i),this._userDefinedOnBeforeCompile=r=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return sl.mediation}set onBeforeCompile(i){this._userDefinedOnBeforeCompile=i}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return Dne}}const kne=function(n,e,i){const r=i?i.texture:null,s=i?i.unitRange:new Qe.Vector2;if(n[e]!==void 0){n.glyphMap=r,n.unitRange=s;return}n.userData&&n.userData.glyphMap&&(n.userData.glyphMap.value=r,n.userData.unitRange.value=s)},One=function(n,e,i){i&&i!=="antialiased"?n.defines.NO_RGSS="":delete n.defines.NO_RGSS,n.needsUpdate=!0},Dne={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:g1},fontSide:{m:"side"},font:{m:"glyphMap",t:kne},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:One},invertAlpha:{m:"INVERT_ALPHA",t:D2}},Lne=`
${R2}
#include <clipping_planes_pars_vertex>
void main() {
	${P2}
	#include <begin_vertex>
	#include <project_vertex>
	${B2}
	#include <clipping_planes_vertex>
}
`,Une=`
uniform vec3 diffuse;
uniform float opacity;
${k2}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${O2}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,Fne=.02;class _U extends Qe.ShaderMaterial{static get mediation(){return sl.mediation}constructor(e={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new Qe.Vector2(0,0)},alphaTest:{value:Fne}},transparent:!0,clipping:!0,vertexShader:Lne,fragmentShader:Une,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=e.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(e){this.uniforms.unitRange.value.copy(e)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(e){this.uniforms.glyphMap.value=e}get isDefault(){return this.constructor===_U}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}}class Nne extends zy{constructor(e,i,r,s){if(super(e,i),this._unitRange=new Qe.Vector2(1,1),r.pages?this._buildData(r):zne(this,r),s instanceof Qe.Texture)this._texture=s,this._buildTexture(s);else if(typeof s=="string"||s instanceof String)jne(this,s);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof s}'. Only Texture and String allowed.`);this._defaultMaterialClass=_U,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(e){this._defaultMaterialClass=e}get fontMaterial(){return this._defaultMaterialClass}_buildData(e){this._font=new Sne(e),this._kernings=this._buildKerningPairs(e),this._chars=this._buildCharacters(e),this._chars[" "]=this._buildCharacterWhite(e),this._chars[`
`]=this._buildCharacterWhite(e,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(e,"	",4,1),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._distanceRange=e.distanceField.distanceRange,this._unitRange=new Qe.Vector2(this._distanceRange,this._distanceRange).divide(new Qe.Vector2(e.common.scaleW,e.common.scaleH))}_buildTexture(e){e.generateMipmaps=!1,e.minFilter=Qe.LinearFilter,e.magFilter=Qe.LinearFilter,e.needsUpdate=!0}_getFallbackCharacter(e){return Jp.missingCharacter(this,e)}getGeometricGlyph(e,i){return new Ene(e,i)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(e){const i={};for(let r=0;r<e.kernings.length;r++){const s=e.kernings[r];if(s.amount===0)continue;const o=String.fromCharCode(s.first,s.second);i[o]=s.amount}return i}_buildCharacters(e){const i={};for(let r=0;r<e.chars.length;r++){const s=e.chars[r];i[s.char]=new BT(this._font,s)}return i}_buildCharacterWhite(e,i=" ",r=1,s=1){return new BT(this._font,{char:i,width:e.info.size/3*r,height:e.info.size*.7*s})}_alterElementProperties(e){}}function zne(n,e){new Qe.FileLoader().setResponseType("json").load(e,i=>{n._buildData(i),n._checkReadiness()})}function jne(n,e){n._texture=new Qe.TextureLoader().load(e,i=>{n._buildTexture(i),n._checkReadiness()})}class v1 extends Qe.EventDispatcher{constructor(e){super(),p(this,"_checkReadiness",()=>{this._variants.every(i=>i.isReady)&&Hne(this)}),this._name=e,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(e,i,r,s,o=!1){if(o||!this.getVariant(e,i)){this._isReady=!1;const a=new Nne(e,i,r,s);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${e}, ${i}) already exists.`);return this}addCustomImplementationVariant(e,i=!1){return i||!this.getVariant(e.weight,e.style)?(this._isReady=!1,this._variants.push(e),e.isReady?this._checkReadiness():e.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${e.weight}, ${e.style}) already exists.`),this}getVariant(e,i){return e=S2(e),this._variants.find(r=>r.weight===e&&r.style===i)}get name(){return this._name}}const Gne={type:"ready"};function Hne(n){n._isReady=!0,n.dispatchEvent(Gne)}const y1={},Vne=function(n){const e=[...arguments];e.forEach(r=>{if(!(r instanceof v1))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof r} given.`)});const i=function(){return e.every(r=>r.isReady)};return new Promise((r,s)=>{if(i())r();else for(let o=0;o<e.length;o++){const a=e[o];a.isReady||a.addEventListener("ready",()=>{i()&&r()})}})},Qne=function(n){return y1[n]&&console.error(`FontLibrary::addFontFamily - Font('${n}') is already registered`),y1[n]=new v1(n),y1[n]},Wne=function(n){return y1[n]},Xne=function(n){N4=n};let N4=function(n,e){return console.error(`The character '${e}' is not included in the font characters set.`)," "};function qne(n,e){return N4(n,e)}const Yne={addFontFamily:Qne,getFontFamily:Wne,prepare:Vne,setMissingCharacterHandler:Xne,missingCharacter:qne},Jp=Yne;class z4 extends un{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(e){if(this._input instanceof v1)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const i=Jp.getFontFamily(this._input);i?this._value=i:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(e){if(this._input!=="inherit")return this._input;const i=e._parent._value;return i?i[`_${this._id}`].getInheritedInput(i):this.getDefaultValue()}}class j4 extends un{constructor(){super("lineHeight","inherit",!0)}update(e,i){super.update(e,i),e._layouter._needsProcess=!0}}class G4 extends un{constructor(){super("whiteSpace","inherit"),this.isValidValue=Kne}}const Jne=["normal","nowrap","pre","pre-line","pre-wrap"];function Kne(n){return Jne.indexOf(n)===-1?(console.warn(`(.style) whiteSpace value '${n}' is not valid. Aborted`),!1):!0}class H4 extends un{constructor(){super("letterSpacing","inherit",!0)}}class Zne extends un{constructor(){super("fontSize","inherit",!0)}}class V4 extends Ci{constructor(){super("segments",1,!1)}}class $ne extends Yp{constructor(){super("invertAlpha","inherit")}}class A1 extends un{constructor(){super("fontKerning","inherit"),this.isValidValue=tre}}const ere=["normal","none","inherit"];function tre(n){return ere.indexOf(n)===-1?(console.warn(`(.style) fontKerning value '${n}' is not valid. Aborted`),!1):!0}class b1 extends Yp{constructor(e){super(e,"inherit",!0)}}class Q4 extends Yp{constructor(e){super(e,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(e,i){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(e):this.propagate(e),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:g1},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},e._transferToFontMaterial(),this._outputValue(i)}getInheritedInput(e){if(this._value!=="inherit")return this._value;let i=e,r=null;for(;i._parent._value;)if(i=i._parent._value,i[`_${this._id}`]._value!=="inherit"){r=i[`_${this._id}`]._value;break}return r!==null?r:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}const ire=function(n,e,i){n.traverse(r=>{r.renderOrder=i})};class Gy extends Qe.Object3D{constructor(e,i){super(),p(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(x1.register(this),this.activatePseudoState("root")):(x1.remove(this),this.deactivatePseudoState("root"))}),Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:ire}},this._fontMesh=null,this._fontMaterial=new Q4("fontMaterial"),this._fontCustomDepthMaterial=new Q4("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:Rie},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=e.children?new e.children:new ph("children"),this._parent=new Pie,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new C4("backgroundSide"),this._fontSide=new C4("fontSide"),this._backgroundAlphaTest=new S4("backgroundAlphaTest",.02),this._fontAlphaTest=new S4("fontAlphaTest",.02),this._visible=new sne("visible",!0),this._backgroundCastShadow=new b1("backgroundCastShadow"),this._fontCastShadow=new b1("fontCastShadow"),this._backgroundReceiveShadow=new b1("backgroundReceiveShadow"),this._fontReceiveShadow=new b1("fontReceiveShadow"),this._renderOrder=new _ie,this._segments=e.segments?new e.segments:new V4,this._bounds=e.bounds?new e.bounds:new ph("bounds"),this._order=new mne,this._padding=new Tie,this._margin=new Iie,this._position=new B4,this._flexDirection=e.flexDirection?new e.flexDirection:new T2,this._justifyContent=e.justifyContent?new e.justifyContent:new I2,this._alignItems=e.alignItems?new e.alignItems:new E2,this._display=new jie("flex"),this._boxSizing=new Vie("border-box"),this._width=new yne,this._height=new Ane,this._backgroundColor=e.backgroundColor?new e.backgroundColor:new P4,this._backgroundOpacity=new C2("backgroundOpacity",.5),this._backgroundImage=new qie,this._backgroundSize=new Jie("cover"),this._color=e.color?new e.color:new jy("color","inherit"),this._fontOpacity=new C2("fontOpacity","inherit"),this._whiteSpace=e.whiteSpace?new e.whiteSpace:new G4,this._fontFamily=e.fontFamily?new e.fontFamily:new z4,this._fontStyle=e.fontStyle?new e.fontStyle:new D4("normal"),this._fontWeight=e.fontWeight?new e.fontWeight:new L4,this._fontSize=e.fontSize?new e.fontSize:new Zne,this._lineHeight=e.lineHeight?new e.lineHeight:new j4,this._fontKerning=e.fontKerning?new e.fontKerning:new A1,this._letterSpacing=e.letterSpacing?new e.letterSpacing:new H4,this._overflow=new $ie("visible"),this._borderRadius=new nne(0),this._borderWidth=new rne(0),this._borderColor=new jy("borderColor",16711935),this._borderOpacity=new C2("borderOpacity",1),this._font=new Fie,this._lineBreak=e.lineBreak?new e.lineBreak:new ph("lineBreak"),this._textContent=e.textContent?new e.textContent:new O4,this._glyphs=e.glyphs?new e.glyphs:new ph("glyphs"),this._inlines=e.inlines?new e.inlines:new ph("inlines"),this._layouter=e.layouter?new e.layouter:new ph("layouter"),this._inlineJustificator=new one,this._textAlign=e.textAlign?new e.textAlign:new M2,this._autoSize=e.autoSize?new e.autoSize:new ph("autoSize"),this._renderer=e.renderer?new e.renderer:new ph("renderer"),this._offset=new wie,this._invertAlpha=new $ne,this._fontSmooth=e.fontSmooth?new e.fontSmooth:new Sie,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],i.backgroundSide||(i.backgroundSide=0),i&&this.set(i)}update(){const e={};for(const i of this._components)i._needsUpdate&&(i.update(this,e),i._needsUpdate=!1);this._transferToBackgroundMesh(e),this._transferToFontMesh(e),this._transferToBackgroundMaterial(e),this._transferToFontMaterial(e);for(const i of this._children._uis)i.update()}process(){for(const e of this._children._uis)e.process();for(const e of this._components)e._needsProcess&&(e.process(this),e._needsProcess=!1)}render(){for(let e=0;e<this._components.length;e++){const i=this._components[e];i._needsRender&&(i.render(this),i._needsRender=!1)}for(const e of this._children._uis)e.render()}set(e){if(e.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),e.fontFamily)){const i=e.fontFamily.pages?e.fontFamily.info.face:e.fontFamily;let r=Jp.getFontFamily(i);if(!r){const s=e.fontStyle?e.fontStyle:"normal",o=e.fontWeight?e.fontWeight:"400";r=Jp.addFontFamily(i).addVariant(o,s,e.fontFamily,e.fontTexture)}e.fontFamily=r,delete e.fontTexture}for(let i of Object.keys(e)){const r=e[i];switch(i){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),i="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),i="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),i="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),i="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),i="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),i="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),i="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":i="borderColor";break}switch(i){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${i}`].value=r;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${i}`]&&(this[`_${i}`].inline=r);break;case"paddingTop":this._padding.top=r;break;case"paddingRight":this._padding.right=r;break;case"paddingBottom":this._padding.bottom=r;break;case"paddingLeft":this._padding.left=r;break;case"marginTop":this._margin.top=r;break;case"marginRight":this._margin.right=r;break;case"marginBottom":this._margin.bottom=r;break;case"marginLeft":this._margin.left=r;break;case"borderTopWidth":this._borderWidth.top=r;break;case"borderRightWidth":this._borderWidth.right=r;break;case"borderBottomWidth":this._borderWidth.bottom=r;break;case"borderLeftWidth":this._borderWidth.left=r;break;case"borderTopLeftRadius":this._borderRadius.topLeft=r;break;case"borderTopRightRadius":this._borderRadius.topRight=r;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=r;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=r;break;case"side":case"castShadow":case"receiveShadow":const s=i.charAt(0).toUpperCase()+i.substr(1);this[`_background${s}`].value=r,this[`_font${s}`].value=r;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${i}`].value=r;break;default:this[`_${i}`]!==void 0?this[`_${i}`].value=r:this[i]=r}}}get(e){switch(e){case"overflow":case"width":case"height":return this[`_${e}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(e){let i=!1;for(let r=0;r<arguments.length;r++)super.add(arguments[r]),arguments[r].isUI&&(i=!0);return i&&this._rebuildChildrenLists(),this}remove(e){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(e){this._backgroundMaterial=e,this._backgroundMaterialMediation={...e.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,Sa(e,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(e){this._backgroundCustomDepthMaterial=e,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(e=null){if(!e){e={};for(const i of this._components)i.output(e)}p1.mediate(this,this._backgroundMaterial,e,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(e){this._backgroundSide.value=e,this._backgroundMaterial&&(this._backgroundMaterial.side=e)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(e){this._backgroundAlphaTest.value=e,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=e)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(e){this._fontMaterial.value=e}set fontCustomDepthMaterial(e){this._fontCustomDepthMaterial.value=e}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(e=null){const i=this._fontMaterial.value;if(i){if(!e){e={};for(const r of this._components)r.output(e)}p1.mediate(this,i,e,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(e){this._fontSide.value=e}get fontSide(){return this._fontSide.value}set fontAlphaTest(e){this._fontAlphaTest.value=e}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(e=null){if(!e){e={};for(const i of this._components)i.output(e)}p1.mediate(this,this._backgroundMesh,e,this._backgroundMeshMediation)}setBackgroundMesh(e){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=e,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&Sa(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(e){}deactivatePseudoState(e){}togglePseudoState(e){}hasPseudoState(e){return!1}set borderRadiusMediation(e){this._borderRadius.mediation=e}set backgroundCastShadow(e){this._backgroundCastShadow&&(this._backgroundCastShadow.value=e)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(e){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=e)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(e){this._renderOrder&&(this._renderOrder.value=e)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(e=null){if(this._fontMesh){if(!e){e={};for(const i of this._components)i.output(e)}p1.mediate(this,this._fontMesh,e,this._fontMeshMediation)}}setFontMesh(e){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=e,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(e){this._fontCastShadow&&(this._fontCastShadow.value=e)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(e){this._fontReceiveShadow&&(this._fontReceiveShadow.value=e)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(e){this._segments.value=e}get segments(){return this._segments.value}set onAfterUpdate(e){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(e)}addAfterUpdate(e){this._onAfterUpdates.push(e)}removeAfterUpdate(e){const i=this._onAfterUpdates.indexOf(e);i!==-1&&this._onAfterUpdates.splice(i,1)}performAfterUpdate(){for(let e=0;e<this._onAfterUpdates.length;e++)this._onAfterUpdates[e]()}getProperty(e){return this[`_${e}`]?this[`_${e}`]:null}appendProperty(e,i){this[`_${e}`]=i,this._components.push(i)}replaceProperty(e,i){const r=this[`_${e}`],s=this._components.indexOf(r);return this._components[s]=this[`_${e}`]=i,i.needsUpdate=!0,r}}class x1{static register(e){this.elements.includes(e)||this.elements.push(e)}static remove(e){const i=this.elements.indexOf(e);i!==-1&&this.elements.splice(i,1)}static update(){for(const e of this.elements)e.update(),e.process(),e.process(),e.render()}}x1.elements=[];const nre=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,L2=nre,rre=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,U2=rre,sre=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,F2=sre,ore=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,N2=ore,are=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,z2=are,lre=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,j2=lre,cre=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,G2=cre,W4={msdfAlphaglyphParsVertexGlsl:R2,msdfAlphaglyphVertexGlsl:P2,msdfOffsetglyphVertexGlsl:B2,msdfAlphaglyphParsFragmentGlsl:k2,msdfAlphaglyphFragmentGlsl:O2,frameBorderParsVertexGlsl:L2,frameBorderVertexGlsl:U2,frameCommonParsFragmentGlsl:z2,frameBorderParsFragmentGlsl:F2,frameBorderFragmentGlsl:N2,frameBackgroundParsFragmentGlsl:j2,frameBackgroundFragmentGlsl:G2},hre=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${L2}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${U2}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,ure=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${z2}

${F2}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${j2}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${G2}

	${N2}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class kT{static get mediation(){return pre}static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,i){e.userData.borderColor={value:null},e.userData.borderRadius={value:new Qe.Vector4(0,0,0,0)},e.userData.cornerTL={value:new Qe.Vector2(0,1)},e.userData.cornerTR={value:new Qe.Vector2(1,1)},e.userData.cornerBR={value:new Qe.Vector2(1,0)},e.userData.cornerBL={value:new Qe.Vector2(0,0)},e.userData.borderWidth={value:new Qe.Vector4(0,0,0,0)},e.userData.borderOpacity={value:null},e.userData.frameSize={value:new Qe.Vector3(1,1,1)},e.userData.textureSize={value:new Qe.Vector2(1,1)}}static bindUniformsWithUserData(e,i){e.uniforms.borderColor=i.userData.borderColor,e.uniforms.borderRadius=i.userData.borderRadius,e.uniforms.cornerTL=i.userData.cornerTL,e.uniforms.cornerTR=i.userData.cornerTR,e.uniforms.cornerBR=i.userData.cornerBR,e.uniforms.cornerBL=i.userData.cornerBL,e.uniforms.borderWidth=i.userData.borderWidth,e.uniforms.borderOpacity=i.userData.borderOpacity,e.uniforms.frameSize=i.userData.frameSize,e.uniforms.textureSize=i.userData.textureSize}static injectShaderChunks(e){kT.injectVertexShaderChunks(e),kT.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+L2),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+U2)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+j2),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+F2),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+z2),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",G2),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",N2+`
#include <alphamap_fragment>`)}}const dre=function(n,e,i){i=["stretch","contain","cover"].indexOf(i),F4(n,"BACKGROUND_MAPPING",i)},pre={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:g1},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:dre},borderWidth:{m:"borderWidth",t:Sa},borderColor:{m:"borderColor",t:Sa},cornerTL:{m:"cornerTL",t:Sa},cornerTR:{m:"cornerTR",t:Sa},cornerBR:{m:"cornerBR",t:Sa},cornerBL:{m:"cornerBL",t:Sa},borderOpacity:{m:"borderOpacity",t:Sa},size:{m:"frameSize",t:Sa},tSize:{m:"textureSize",t:Sa}};class X4 extends Qe.ShaderMaterial{static get mediation(){return kT.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new Qe.Color(16777215)},opacity:{value:1},borderColor:{value:new Qe.Color(0)},borderOpacity:{value:0},borderRadius:{value:new Qe.Vector4(0,0,0,0)},cornerTL:{value:new Qe.Vector2(0,1)},cornerTR:{value:new Qe.Vector2(1,1)},cornerBR:{value:new Qe.Vector2(1,0)},cornerBL:{value:new Qe.Vector2(0,0)},borderWidth:{value:new Qe.Vector4(0,0,0,0)},frameSize:{value:new Qe.Vector3(1,1,1)},textureSize:{value:new Qe.Vector2(1,1)}},side:Qe.FrontSide,transparent:!0,clipping:!0,vertexShader:hre,fragmentShader:ure,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(e){this.uniforms.map.value=e,e?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}}class fre extends Ci{constructor(){super("children",null,!1),p(this,"_sortOrder",(e,i)=>e._order._value<i._order._value?-1:e._order._value>i._order._value?1:this._uis.indexOf(e)<this._uis.indexOf(i)?-1:1),this._uis=[],this._boxes=[]}update(e,i){this._compute(e),e._layouter._needsUpdate=!0,e._renderOrder._needsUpdate=!0}process(e){this._compute(e),e._flexDirection._needsProcess=!0,e._layouter._needsProcess=!0,e._overflow._needsRender=!0}_compute(e){this._uis=e.children.filter(i=>i.visible&&i.isUI),this._boxes=this._uis.filter(i=>i.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class q4 extends Ci{constructor(){super("bounds",null,!1),this._size=new Qe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(e,i){const r=e._width,s=e._padding._value,o=e._borderWidth._value,a=e._margin._value,l=r._auto?1:r._value,c=i*l-(a.y+a.w);w2(c,this._offsetWidth)||(this._offsetWidth=c,this._innerWidth=this._offsetWidth-(s.y+s.w+o.y+o.w),this._centerX=H2(e),this._propagateWidth(e),this._triggerCascadingDependencies(e))}setReferenceHeight(e,i){const r=e._height,s=e._padding._value,o=e._borderWidth._value,a=e._margin._value,l=r._auto?1:r._value,c=i*l-(a.x+a.z);w2(c,this._offsetHeight)||(this._offsetHeight=c,this._innerHeight=this._offsetHeight-(s.x+s.z+o.x+o.z),this._centerY=V2(e),this._propagateHeight(e),this._triggerCascadingDependencies(e))}setChildrenWidth(e,i){const r=e._padding._value,s=e._borderWidth._value;this._innerWidth=i,this._offsetWidth=this._innerWidth+(r.y+r.w+s.y+s.w),this._centerX=H2(e),this._propagateWidth(e),this._triggerCascadingDependencies(e)}setChildrenHeight(e,i){const r=e._padding._value,s=e._borderWidth._value;this._innerHeight=i,this._offsetHeight=this._innerHeight+(r.x+r.z+s.x+s.z),this._centerY=V2(e),this._propagateHeight(e),this._triggerCascadingDependencies(e)}update(e,i){const r=e._padding._value,s=e._borderWidth._value,o=e._width;!o._auto&&!o._relative&&(e._boxSizing._value==="content-box"?(this._innerWidth=o._value,this._offsetWidth=this._innerWidth+r.y+r.w+s.y+s.w):(this._offsetWidth=o._value,this._innerWidth=this._offsetWidth-(r.y+r.w+s.y+s.w)),this._centerX=H2(e),this._needsProcess=!0,this._propagateWidth(e),this._triggerCascadingDependencies(e));const a=e._height;!a._auto&&!a._relative&&(e._boxSizing._value==="content-box"?(this._innerHeight=a._value,this._offsetHeight=this._innerHeight+r.x+r.z+s.x+s.z):(this._offsetHeight=a._value,this._innerHeight=this._offsetHeight-(r.x+r.z+s.x+s.z)),this._centerY=V2(e),this._needsProcess=!0,this._propagateHeight(e),this._triggerCascadingDependencies(e))}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,e._backgroundMesh&&e._backgroundMesh.updateScale(),e._renderer._needsRender=!0}output(e){e.size=this._size}process(e){e._overflow._needsRender=!0}_computeChildrenSideWidth(e){return mre(e)}_computeChildrenSideHeight(e){return gre(e)}_propagateWidth(e){for(let i=0;i<e._children._boxes.length;i++){const r=e._children._boxes[i];r._width._relative&&r._bounds.setReferenceWidth(r,this._innerWidth)}}_propagateHeight(e){for(let i=0;i<e._children._boxes.length;i++){const r=e._children._boxes[i];r._height._relative&&r._bounds.setReferenceHeight(r,this._innerHeight)}}_triggerCascadingDependencies(e){e._parent._value&&(e._parent._value._autoSize._needsProcess=!0),e._flexDirection._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0,e._overflow._needsRender=!0}}function H2(n){const e=n._padding._value,i=n._borderWidth._value,r=e.w+i.w,s=e.y+i.y;return(r-s)/2}function V2(n){const e=n._padding._value,i=n._borderWidth._value,r=e.x+i.x;return(e.z+i.z-r)/2}function mre(n){return n._children._boxes.reduce((e,i)=>{const r=i._margin._value,s=i._bounds._offsetWidth+r.y+r.w;return e+s},0)}function gre(n){return n._children._boxes.reduce((e,i)=>{const r=i._margin._value,s=i._bounds._offsetHeight+r.x+r.z;return e+s},0)}class vre extends E2{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"row":case"row-reverse":switch(this._process=wre,this._value){case"start":this._childAlign=Are;break;case"end":this._childAlign=yre;break;default:this._childAlign=Y4}break;case"column":case"column-reverse":switch(this._process=_re,this._value){case"start":this._childAlign=xre;break;case"end":this._childAlign=bre;break;default:this._childAlign=Y4}break}this._needsProcess=!0,e._autoSize._needsProcess=!0,e._flexDirection._needsProcess=!0,e._justifyContent._needsProcess=!0,this._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}process(e){this._process(e,this._childAlign);let i="center",r="center",s="center";const o=e._padding._value,a=e._borderWidth._value;e._flexDirection._value.indexOf("column")!==-1?this._value==="start"?i=r="left":this._value==="end"?i=r="right":i="centerX":this._value==="start"?i=s="top":this._value==="end"?i=s="bottom":i="centerY";let l=-(o.x-o.z)/2-(a.x-a.z)/2,c=-(o.y-o.w)/2-(a.y-a.w)/2;r==="left"?c=(o.w-o.y)/2+(a.w-a.y)/2:r==="right"&&(c=-(o.y-o.w)/2-(a.y-a.w)/2),s==="top"?l=-(o.x-o.z)/2-(a.x-a.z)/2:s==="bottom"&&(l=(o.z-o.x)/2+(a.z-a.x)/2),e._children._boxes.forEach(h=>{let u=0,d=0;i==="top"?d=-h._margin._value.x:i==="bottom"?d=h._margin._value.z:i==="left"?u=h._margin._value.w:i==="right"?u=-h._margin._value.y:i==="centerX"?u=(h._margin._value.w-h._margin._value.y)/2:i==="centerY"&&(d=(-h._margin._value.x+h._margin._value.z)/2),e._layouter._childrenPos[h.id].x+=c+u,e._layouter._childrenPos[h.id].y+=l+d})}}function Y4(){return 0}function yre(n,e){return-e+n._bounds._offsetHeight/2}function Are(n,e){return e-n._bounds._offsetHeight/2}function bre(n,e){return e-n._bounds._offsetWidth/2}function xre(n,e){return-e+n._bounds._offsetWidth/2}function _re(n,e){const i=n._bounds._innerWidth/2;n._children._boxes.forEach(r=>{n._layouter._childrenPos[r.id].x=e(r,i)})}function wre(n,e){const i=n._bounds._innerHeight/2;n._children._boxes.forEach(r=>{n._layouter._childrenPos[r.id].y=e(r,i)})}class Sre extends T2{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,this._value){case"row":this._process=Cre;break;case"row-reverse":this._process=Ere;break;case"column":this._process=Mre;break;case"column-reverse":this._process=Tre;break}e._justifyContent._needsUpdate||e._justifyContent.computeOutputValue(e),e._alignItems._needsUpdate||e._alignItems.computeOutputValue(e),this._needsProcess=!0}process(e){switch(this._value){case"row":this._offset=-e._bounds._innerWidth/2;break;case"row-reverse":this._offset=e._bounds._innerWidth/2;break;case"column":this._offset=e._bounds._innerHeight/2;break;case"column-reverse":this._offset=-e._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(e),e._justifyContent._needsProcess=!0,e._layouter._needsProcess=!0}}function Cre(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,r=n._children._boxes;for(let s=0;s<r.length;s++){const o=r[s],a=o.id,l=o._bounds._offsetWidth;e+=o._margin._value.w*i;const c=n._layouter._childrenPos[a];c.x=e+l/2*i,c.y=0,e+=i*(l+o._margin._value.y)}}function Ere(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,r=n._children._boxes;for(let s=0;s<r.length;s++){const o=r[s],a=o.id,l=o._bounds._offsetWidth;e+=o._margin._value.y*i;const c=n._layouter._childrenPos[a];c.x=e+l/2*i,c.y=0,e+=(l+o._margin._value.w)*i}}function Mre(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,r=n._children._boxes;for(let s=0;s<r.length;s++){const o=r[s],a=o.id,l=o._bounds._offsetHeight;e+=o._margin._value.x*i;const c=n._layouter._childrenPos[a];c.x=0,c.y=e+l/2*i,e+=(l+o._margin._value.z)*i}}function Tre(n){let e=n._flexDirection._offset;const i=n._flexDirection._reverse,r=n._children._boxes;for(let s=0;s<r.length;s++){const o=r[s],a=o.id,l=o._bounds._offsetHeight;e+=o._margin._value.z*i;const c=n._layouter._childrenPos[a];c.x=0,c.y=e+l/2*i,e+=(l+o._margin._value.x)*i}}class Ire extends I2{constructor(e){super("justifyContent",e,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"column-reverse":case"column":this._process=Pre.bind(this);break;case"row-reverse":case"row":this._process=Rre.bind(this);break}switch(this._value){case"end":this._computeOffset=Ore,this._computeMargin=Q2;break;case"center":this._computeOffset=Dre,this._computeMargin=Q2;break;case"start":this._computeOffset=_1,this._computeMargin=Q2;break;case"space-between":this._computeOffset=_1,this._computeMargin=Lre;break;case"space-around":this._computeOffset=_1,this._computeMargin=Fre;break;case"space-evenly":this._computeOffset=_1,this._computeMargin=Ure;break}e._flexDirection._needsProcess=!0}process(e){this._process(e),e._alignItems._needsProcess=!0}}function Rre(n){const e=n._flexDirection._offset,{usedDirectionSpace:i,remainingSpace:r}=Bre(n),s=e*2-i*Math.sign(e),o=this._computeOffset(s),a=this._computeMargin(n,r,n._flexDirection._reverse);n._children._boxes.forEach((l,c)=>{n._layouter._childrenPos[l.id].x-=o-a[c]})}function Pre(n){const e=n._flexDirection._offset,{usedDirectionSpace:i,remainingSpace:r}=kre(n),s=e*2-i*Math.sign(e),o=this._computeOffset(s),a=this._computeMargin(n,r,n._flexDirection._reverse);n._children._boxes.forEach((l,c)=>{n._layouter._childrenPos[l.id].y-=o-a[c]})}function Bre(n){const e=n._bounds._computeChildrenSideWidth(n);return{usedDirectionSpace:e,remainingSpace:n._bounds._innerWidth-e}}function kre(n){const e=n._bounds._computeChildrenSideHeight(n);return{usedDirectionSpace:e,remainingSpace:n._bounds._innerHeight-e}}function _1(n){return 0}function Ore(n){return n}function Dre(n){return n/2}function Q2(n,e=0,i=1){return Array(n._children._boxes.length).fill(0)}function Lre(n,e=0,i=1){const r=n._children._boxes.length,s=Array(r).fill(0);if(e>0&&r>1){const o=e/(r-1)*i;s[0]=0;for(let a=1;a<r;a++)s[a]=o*a}return s}function Ure(n,e=0,i=1){const r=n._children._boxes.length,s=Array(r).fill(0);if(e>0){const o=e/(r+1)*i;for(let a=0;a<r;a++)s[a]=o*(a+1)}return s}function Fre(n,e=0,i=1){const r=n._children._boxes.length,s=Array(r).fill(0);if(e>0){const o=e/r*i,a=o/2;s[0]=a;for(let l=1;l<r;l++)s[l]=a+o*l}return s}let W2;class J4 extends Qe.Mesh{constructor(e){const i=e.slice,r={};let s=1,o=1;if(i){if(s=i.width?i.width:1,o=i.height?i.height:1,i.top){if(i.left){const d=new Qe.PlaneGeometry(i.left*s,i.top*o,1,1);fh(d,0,i.left,1-i.top,1),d.translate(i.left*s/2,-i.top*o/2,0),r.topLeft=d}const u=new Qe.PlaneGeometry(1,i.top*o,1,1);if(fh(u,i.left,1-i.right,1-i.top,1),u.translate(0,-i.top*o/2,0),r.top=u,i.right){const d=new Qe.PlaneGeometry(i.right*s,i.top*o,1,1);fh(d,1-i.right,1,1-i.top,1),d.translate(-i.right*s/2,-i.top*o/2,0),r.topRight=d}}if(i.left){const u=new Qe.PlaneGeometry(i.left*s,1,1,1);fh(u,0,i.left,i.bottom,1-i.top),u.translate(i.left*s/2,0,0),r.left=u}const h=new Qe.PlaneGeometry(1,1,1,1);if(fh(h,i.left,1-i.right,i.bottom,1-i.top),r.middle=h,i.right){const u=new Qe.PlaneGeometry(i.right*s,1,1,1);fh(u,1-i.right,1,i.bottom,1-i.top),u.translate(-i.right*s/2,0,0),r.right=u}if(i.bottom){if(i.left){const d=new Qe.PlaneGeometry(i.left*s,i.bottom*o,1,1);fh(d,0,i.left,0,i.bottom),d.translate(i.left*s/2,i.bottom*o/2,0),r.bottomLeft=d}const u=new Qe.PlaneGeometry(1,i.bottom*o,1,1);if(fh(u,i.left,1-i.right,0,i.bottom),u.translate(0,i.bottom*o/2,0),r.bottom=u,i.right){const d=new Qe.PlaneGeometry(i.right*s,i.bottom*o,1,1);fh(d,1-i.right,1,0,i.bottom),d.translate(-i.right*s/2,i.bottom*o/2,0),r.bottomRight=d}}}let a=e.backgroundMaterial;i&&(W2||(W2=new Qe.MeshBasicMaterial({alphaTest:1.1})),a=W2);const l=new Qe.PlaneGeometry(1,1,e._segments.value,e._segments.value),c=new Qe.BufferAttribute(new Float32Array(l.getAttribute("uv").array),2);if(l.setAttribute("uvB",c).name="uvB",super(l,a),this.name="UIBackgroundBox",i){this.slice=i,this.sliceSize=new Qe.Vector3(1-(i.left+i.right),1-(i.bottom+i.top),1),this.sliceScale=new Qe.Vector3(s,o,1);for(const h in r){const u=new Qe.Mesh(r[h],e.backgroundMaterial);this.add(u),r[h]=u}this.updateScale=this.updateScaleSlice,this.slices=r}}updateScale(){}updateScaleSlice(){const e=new Qe.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(e.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(e.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const i in this.slices){const r=this.slices[i];r.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const s=Nre[i];for(const a in s)r.position[a]=this.scale[a]*s[a]*r.scale[a];const o=zre[i];if(o){o.x&&(r.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),o.y&&(r.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const a in o){const l=this.scale[a]-(1-this.sliceSize[a])*this.sliceScale[a];r.scale[a]=Math.max(0,l*(1/this.scale[a]))}}}e.x!==1&&(this.slices.left.scale.x*=e.x,this.slices.topLeft.scale.x*=e.x,this.slices.bottomLeft.scale.x*=e.x,this.slices.right.scale.x*=e.x,this.slices.topRight.scale.x*=e.x,this.slices.bottomRight.scale.x*=e.x),e.y!==1&&(this.slices.top.scale.y*=e.y,this.slices.topLeft.scale.y*=e.y,this.slices.topRight.scale.y*=e.y,this.slices.bottom.scale.y*=e.y,this.slices.bottomLeft.scale.y*=e.y,this.slices.bottomRight.scale.y*=e.y)}}const Nre={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},zre={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function fh(n,e,i,r,s){const o=i-e,a=s-r,l=n.attributes.uv;for(let h=0;h<l.count;h++){const u=l.getX(h),d=l.getY(h);l.setXY(h,e+u*o,r+d*a)}const c=new Qe.BufferAttribute(new Float32Array(n.getAttribute("uv").array),2);n.setAttribute("uvB",c).name="uvB"}class K4 extends Ci{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new J4(e)),e.performAfterUpdate()}}class jre extends B4{constructor(){super("position")}update(e,i){super.update(e,i),this._needsProcess=!0}}class Gre extends Ci{constructor(){super("autosize"),this._needsProcess=!0}process(e){e._width._auto&&Hre(e),e._height._auto&&Vre(e);const i=e._alignItems._value==="stretch",r=i&&e._flexDirection._value.indexOf("column")!==-1,s=i&&!r;for(const o of e._children._boxes)(o._width._auto&&r||o._width._relative)&&o._bounds.setReferenceWidth(o,e._bounds._innerWidth),(o._height._auto&&s||o._height._relative)&&o._bounds.setReferenceHeight(o,e._bounds._innerHeight)}}function Hre(n){n._bounds.setChildrenWidth(n,Wre(n))}function Vre(n){n._bounds.setChildrenHeight(n,Qre(n))}function Qre(n){switch(n._flexDirection._value){case"row":case"row-reverse":return Jre(n);case"column":case"column-reverse":return qre(n)}}function Wre(n){switch(n._flexDirection._value){case"row":case"row-reverse":return Xre(n);case"column":case"column-reverse":return Yre(n)}}function Xre(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const r=i._margin._value,s=i._bounds._offsetWidth+r.y+r.w;e+=s}return e}function qre(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const r=i._margin._value,s=i._bounds._offsetHeight+r.x+r.z;e+=s}return e}function Yre(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const r=i._margin._value,s=i._bounds._offsetWidth+r.y+r.w;s>e&&(e=s)}return e}function Jre(n){let e=0;for(const i of n._children._boxes){if(i._position._value!=="static")continue;const r=i._margin._value,s=i._bounds._offsetHeight+r.x+r.z;s>e&&(e=s)}return e}class m_ extends Gy{constructor(e,i){m_.definePropertiesValues(e,i),super(e,i),m_.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new Qe.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(e,i){e.children||(e.children=fre),e.bounds||(e.bounds=q4),e.flexDirection||(e.flexDirection=Sre),e.justifyContent||(e.justifyContent=Ire),e.alignItems||(e.alignItems=vre),e.position||(e.position=jre),e.autoSize||(e.autoSize=Gre),e.renderer||(e.renderer=K4),i.fontSide||(i.fontSide=0),i.invertAlpha||(i.invertAlpha=!1),i.fontCastShadow||(i.fontCastShadow=!1),i.fontReceiveShadow||(i.fontReceiveShadow=!1),i.backgroundCastShadow||(i.backgroundCastShadow=!1),i.backgroundReceiveShadow||(i.backgroundReceiveShadow=!1)}static init(e){Object.defineProperties(e,{isBox:{configurable:!1,enumerable:!0,value:!0}}),e.backgroundMaterial=new X4,e._renderer.render(e),e._backgroundMesh.visible=!1}}let Z4=class extends Array{constructor(...n){super(...n),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}};class Kre extends Ci{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(e,i){this._childrenPos={};for(const r of e._children._boxes)r._position._value==="static"&&(this._childrenPos[r.id]=r.position)}process(e){}}class g_ extends m_{constructor(e={}){const i={};g_.definePropertiesValues(i,e),super(i,e),g_.init(this)}add(e){const i=[];for(let r=0;r<arguments.length;r++){const s=arguments[r];!s.isUI||s.isBox?i.push(s):console.warn("Block element can only contain Box elements.",s)}return super.add(...i)}static definePropertiesValues(e,i){e.layouter=Kre}static init(e){Object.defineProperties(e,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class Zre extends Ci{constructor(){super("textContent",null,!1)}update(e,i){e._glyphs._needsUpdate=!0,e._whiteSpace._needsProcess=!0}}class $re extends Ci{constructor(){super("inlines",null,!1),this._value=null}process(e){if(this._value=e._glyphs._value.map(i=>i.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const i=this._value.length-1;this._value[i].paddingRight=e._padding._value.y,this._value[i].marginRight=e._margin._value.y}e._fontSize._needsProcess=!0,e._lineBreak._needsProcess=!0,e._fontKerning._needsProcess=!0,e._layouter._needsProcess=!0}get value(){return this._value}}class ese extends Ci{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(e){e._font._fontVariant&&e._font._fontVariant.isReady&&(this._value=e._whiteSpace._whiteSpacedContent.split("").map(i=>e._font._fontVariant.getTypographicGlyph(i)),this._value&&(e._inlines._needsProcess=!0))}get value(){return this._value}}class tse extends jy{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class $4 extends Ci{constructor(e=`- ,.:?!
`){super("lineBreak",e,!0),this._newLineBreakability=null}update(e,i){this._needsProcess=!0}process(e){const i=e._whiteSpace._newLineBreakability;if(e._inlines._value)for(let r=0;r<e._inlines._value.length;r++){const s=e._inlines._value[r],o=s.char;let a=null;o!==void 0&&(i!=="nowrap"&&(this._value.includes(o)||o.match(/\s/g))&&(a="possible"),o.match(/\n/g)&&(a=i)),s.lineBreak=a}}get value(){return this._value}}class ej extends Ci{constructor(){super("layouter",null,!1),this._value=null}update(e,i){this._value=e._parent.find(r=>r.isUI&&r.isText),this._needsProcess=!0}process(e){this._value&&(this._value._layouter._needsProcess=!0)}}class ise extends jy{constructor(e){super("backgroundColor",e,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class tj extends D4{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class ij extends L4{constructor(){super()}computeOutputValue(e){this._value=S2(this.getInheritedInput(e))}}class nj extends z4{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(e){let i=this._inheritedInput;if(i==="inherit"&&(i=this.getInheritedInput(e)),i instanceof v1)this._value=i,e._font._needsUpdate=!0;else if(typeof i=="string"){const r=Jp.getFontFamily(i);r?(this._value=r,e._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${i}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class X2 extends G4{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(e){switch(super._computeFromInherited(e),this._newLineBreakability=nse(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=rse;break;case"pre-line":this._stringCollapser=sj;break;default:this._stringCollapser=sse}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=hse;break;case"pre-wrap":this._inlineCollapser=cse;break;default:this._inlineCollapser=use}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=ose;break;case"pre":this._inlineWrapper=ase;break;default:this._inlineWrapper=lse}this._needsProcess=!0}process(e){e.isInline&&!e.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(e._textContent._value),e._glyphs._needsProcess=!0)}}const rj={"	":"	","\n":`
`,"\r":"\r"," ":" "},nse=function(n){switch(n){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function rse(n){return sj(n.replace(/\n/g," "))}function sj(n){return n.replace(/[ ]{2,}/g," ")}function sse(n){return n}function ose(n,e,i,r){const s=n[e];if(s.lineBreak==="mandatory"||i+s.xadvance+s.xoffset+s.kerning>r.INNER_WIDTH)return!0;const o=lj(n,e,r);return dse(n[e-1],i,o,r)}function ase(n,e,i,r){return n[e].lineBreak==="mandatory"}function lse(){return!1}function cse(n){if(!n[0])return 0;const e=n[0],i=n[n.length-1];return e.char&&e.char===`
`&&n.length>1&&aj([e],n[1]),i.char&&i.char===`
`&&n.length>1&&oj([i],n[n.length-2]),e.offsetX}function hse(n){if(!n[0])return 0;let e=[],i;for(let r=0;r<n.length;r++){const s=n[r];if(s.char&&rj[s.char]&&n.length>r){e.push(s),i=n[r+1];continue}break}aj(e,i),e=[],i=null;for(let r=n.length-1;r>0;r--){const s=n[r];if(s.char&&rj[s.char]&&r>0){e.push(s),i=n[r-1];continue}break}return oj(e,i),n[0].offsetX}function use(n){return n[0]?n[0].offsetX:0}function oj(n,e){if(e)for(let i=0;i<n.length;i++){const r=n[i];r.fontFactor=0,r.offsetX=e.offsetX+e.cumulativeWidth,r.cumulativeWidth=0}}function aj(n,e){if(e)for(let i=0;i<n.length;i++){const r=n[i];r.fontFactor=0,r.offsetX=e.offsetX,r.cumulativeWidth=0}}function lj(n,e,i,r){if(r=r||0,!n[e])return r;const s=n[e];return s.lineBreak?r+s.xadvance:lj(n,e+1,i,r+s.xadvance+s.xoffset+s.kerning+i.LETTERSPACING)}function dse(n,e,i,r){return!n||!n.char||e+i<r.INNER_WIDTH?!1:r.BREAKON.indexOf(n.char)>-1}class cj extends H4{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}}class hj extends un{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._font._fontVariant&&(e._bounds._needsProcess=!0,e._layouter._needsProcess=!0)}process(e){if(!e._font._fontVariant||!e._font._fontVariant.isReady)return;const i=this._value/e._font._fontVariant.typographic.size,r=e._inlines._value;for(let s=0;s<r.length;s++){const o=r[s];o.resetOffsets(),o.fontSize=this._value,o.fontFactor=i}}get value(){return this._value}}class uj extends V4{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(e,i){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),e._layouter._needsUpdate=!0}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class pse extends uj{constructor(){super(),this._value="inherit"}}class fse extends A1{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value._layouter._needsProcess=!1}process(e){if(this._value!=="none"){const i=e._whiteSpace._whiteSpacedContent,r=e._inlines._value;for(let s=1;s<r.length;s++){const o=i[s-1]+i[s];r[s].kerning=e._font._fontVariant.getKerningAmount(o)}}}}class dj extends Ci{constructor(){super("children",null,!1),this._uis=[]}update(e,i){}process(e){}_compute(e){}dispose(){}}function mse(n,e=!1){const i=n[0].index!==null,r=new Set(Object.keys(n[0].attributes)),s=new Set(Object.keys(n[0].morphAttributes)),o={},a={},l=n[0].morphTargetsRelative,c=new Qe.BufferGeometry;let h=0;for(let u=0;u<n.length;++u){const d=n[u];let f=0;if(i!==(d.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const m in d.attributes){if(!r.has(m))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+m+'" attribute exists among all geometries, or in none of them.'),null;o[m]===void 0&&(o[m]=[]),o[m].push(d.attributes[m]),f++}if(f!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(l!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const m in d.morphAttributes){if(!s.has(m))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[m]===void 0&&(a[m]=[]),a[m].push(d.morphAttributes[m])}if(e){let m;if(i)m=d.index.count;else if(d.attributes.position!==void 0)m=d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;c.addGroup(h,m,u),h+=m}}if(i){let u=0;const d=[];for(let f=0;f<n.length;++f){const m=n[f].index;for(let g=0;g<m.count;++g)d.push(m.getX(g)+u);u+=n[f].attributes.position.count}c.setIndex(d)}for(const u in o){const d=pj(o[u]);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;c.setAttribute(u,d)}for(const u in a){const d=a[u][0].length;if(d===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[u]=[];for(let f=0;f<d;++f){const m=[];for(let v=0;v<a[u].length;++v)m.push(a[u][v][f]);const g=pj(m);if(!g)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;c.morphAttributes[u].push(g)}}return c}function pj(n){let e,i,r,s=-1,o=0;for(let h=0;h<n.length;++h){const u=n[h];if(e===void 0&&(e=u.array.constructor),e!==u.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=u.itemSize),i!==u.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=u.normalized),r!==u.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(s===-1&&(s=u.gpuType),s!==u.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=u.count*i}const a=new e(o),l=new Qe.BufferAttribute(a,i,r);let c=0;for(let h=0;h<n.length;++h){const u=n[h];if(u.isInterleavedBufferAttribute){const d=c/i;for(let f=0,m=u.count;f<m;f++)for(let g=0;g<i;g++){const v=u.getComponent(f,g);l.setComponent(f+d,g,v)}}else a.set(u.array,c);c+=u.count*i}return s!==void 0&&(l.gpuType=s),l}class gse extends Ci{constructor(){super("renderer")}render(e){if(!e._inlines._value||!e._inlines._value.length)return;const i=e._inlines._value.map(s=>e._font._fontVariant.getGeometricGlyph(s,e).translate(s.offsetX,s.offsetY,0)),r=mse(i);e.setFontMesh(new Qe.Mesh(r,e.fontMaterial)),e._fontMesh.renderOrder=1/0}}class vse extends M2{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(e){this._value=this._inheritedInput,e._layouter._needsProcess=!0}}class Vv extends Gy{constructor(e={}){const i={};Vv.definePropertiesValues(i,e),super(i,e),p(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0}),Vv.init(this)}add(e){const i=[];for(let r=0;r<arguments.length;r++){const s=arguments[r];!s.isUI||s.isInline?(i.push(s),s.position.z=.005):console.warn("Block element can only contain Box elements.",s)}return super.add(...i)}set textContent(e){this._textContent.value=e}get textContent(){return this._textContent._value}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(e,i){e.children||(e.children=dj),e.textContent||(e.textContent=Zre),e.glyphs||(e.glyphs=ese),e.inlines||(e.inlines=$re),e.layouter||(e.layouter=ej),e.renderer||(e.renderer=gse),e.fontFamily||(e.fontFamily=nj),e.fontWeight||(e.fontWeight=ij),e.fontStyle||(e.fontStyle=tj),e.fontSize||(e.fontSize=hj),e.color||(e.color=tse),e.backgroundColor||(e.backgroundColor=ise),e.lineBreak||(e.lineBreak=$4),e.letterSpacing||(e.letterSpacing=cj),e.whiteSpace||(e.whiteSpace=X2),e.segments||(e.segments=pse),e.textAlign||(e.textAlign=vse),e.fontKerning||(e.fontKerning=fse)}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class yse extends O4{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,i){this._needsUpdate=!1;for(let r=e.children.length-1;r>=0;r--){const s=e.children[r];s.isUI&&(e.remove(s),s.clear())}e._children._uis=[],this._value&&e.add(new Vv({name:"anonymousInline",textContent:this._value}))}}class Ase extends Array{constructor(...e){super(...e),this.width=0,this.height=0}}class bse extends Ci{constructor(){super("layouter",null,!1),this._value=null}update(e,i){}process(e){let i=e._width._value;e._width._auto?i=1/0:i=e._bounds._innerWidth;const r=e._lineHeight._value,s=new Ase(new Z4);let o=0;e._children._inlines.forEach(d=>{if(!d._inlines.value)return;this._resetInlines(d);const f=d._fontSize._value,m=d._letterSpacing._value*f,g=d._whiteSpace._value,v=d._lineBreak._value,y={WHITESPACE:g,LETTERSPACING:m,BREAKON:v,INNER_WIDTH:i},A=d._whiteSpace._inlineWrapper;o+=d._margin._value.w+d._padding._value.w,d._inlines.value.forEach((b,x,_)=>{const w=s[s.length-1];if(A(_,x,o,y)){if(s.push(new Z4(b)),b.offsetX=b.xoffset,b.width===0){o=0;return}b.cumulativeWidth=b.xadvance+m,o=b.cumulativeWidth;return}s[s.length-1].push(b),b.offsetX=o+b.xoffset+b.kerning,b.cumulativeWidth=b.xadvance+b.kerning+m,o+=b.cumulativeWidth,w.length-1===1&&w[w.length-2].width===0&&(b.offsetX-=b.xoffset,o-=b.xoffset)}),o+=d._margin._value.y+d._padding._value.y});const a=e._whiteSpace._inlineCollapser;let l=0,c=0,h=0;s.forEach((d,f)=>{const m=a(d);let g=0,v=0;if(d.forEach(y=>{g=Math.max(g,y.lineHeight),v=Math.max(v,y.lineBase),y.offsetX-=m}),d.lineHeight=g,d.lineBase=v,f===0?h=-(g*r-g)*.5:h-=s[f-1].lineHeight*r,d.y=h,d.x=0,d.forEach(y=>{y.offsetY=h-y.anchor,y.lineHeight<d.lineHeight&&(y.offsetY-=d.lineBase-y.lineBase)}),c+=d.lineHeight*r,d.width=0,d[0]){const y=d[d.length-1];d.width=y.offsetX+y.cumulativeWidth+y.paddingRight+y.marginRight+d[0].offsetX,l=Math.max(l,d.width)}}),s.height=c,s.width=l,this._value=s,i===1/0&&e._bounds.setChildrenWidth(e,s.width),e._height._auto&&e._bounds.setChildrenHeight(e,s.height);const u=e._parent._value;u&&(u._autoSize._needsProcess=!0,u._flexDirection._needsProcess=!0),e._inlineJustificator._needsProcess=!0,e._textAlign._needsProcess=!0,e._overflow._needsUpdate=!0}_resetInlines(e){e._fontSize.process(e)}}class xse extends M2{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput,this._needsProcess=!0}process(e){_se(e),e._renderer._needsRender=!0}}function _se(n){const e=n._layouter._value,i=n._textAlign._value,r=n._bounds._innerWidth;for(let s=0;s<e.length;s++){const o=e[s],a=wse(n,o,s===e.length-1),l=n._padding._value,c=n._borderWidth._value,h=(-l.w+l.y)/2+(-c.w+c.y)/2;o.x+=a;for(let u=0;u<o.length;u++)o[u].offsetX+=a-h}if(i.indexOf("justify")===0)for(let s=0;s<e.length;s++){const o=e[s];if(i.indexOf("-")!==-1&&s===e.length-1)return;const a=r-o.width;if(a<=0)return;let l=0;for(let d=1;d<o.length-1;d++)l+=o[d].char===" "?1:0;const c=a/l;let h=1;i==="justify-right"&&(o.reverse(),h=-1);let u=0;for(let d=1;d<=o.length-1;d++){const f=o[d];f.offsetX+=u*h,u+=f.char===" "?c:0}i==="justify-right"&&o.reverse()}}function wse(n,e,i){switch(n._textAlign._value){case"justify-left":case"justify":case"left":return-n._bounds._innerWidth/2;case"justify-right":case"right":return-e.width+n._bounds._innerWidth/2;case"center":return-e.width/2;case"justify-center":return i?-e.width/2:-n._bounds._innerWidth/2;default:console.warn(`textAlign: '${n._textAlign._value}' is not valid`)}}class Sse extends T2{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput}}class Cse extends j4{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class Ese extends A1{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e)}}class Mse extends q4{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class Tse extends Ci{constructor(){super("children",null,!1),p(this,"_sortOrder",(e,i)=>e._order._value<i._order._value?-1:e._order._value>i._order._value?1:this._uis.indexOf(e)<this._uis.indexOf(i)?-1:1),this._uis=[],this._inlines=[],this._boxes=[]}update(e,i){this._compute(e),this._needsProcess=!0}process(e){this._compute(e),e._overflow._needsRender=!0}_compute(e){this._uis=e.children.filter(i=>i.visible&&i.isUI),this._inlines=this._uis.filter(i=>i.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class Ise extends Ci{constructor(){super("autosize")}process(e){if(e._layouter._value&&e._layouter._value.length){const i=e._layouter._value,r=e._padding._value,s=e._borderWidth._value;e._width._auto&&e._bounds.setOffsetWidth(e,i.width+r.w+r.y+s.w+s.y),e._height._auto&&e._bounds.setOffsetHeight(e,i.height+r.x+r.z+s.x+s.z)}}}class Rse extends K4{constructor(){super("renderer"),this._needsUpdate=!1}render(e){super.render(e);for(const i of e._children._inlines)i._renderer.render(i);e.performAfterUpdate()}}class v_ extends m_{constructor(e={},i={}){v_.definePropertiesValues(i,e),super(i,e),v_.init(this)}add(e){const i=[];let r=!1;for(let s=0;s<arguments.length;s++){const o=arguments[s];!o.isUI||o.isInline?(o.isInline&&(r=!0),i.push(o)):console.warn("Block element can only contain Box elements.",o)}return i.length>0&&super.add(...i),r&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(e){this._textContent.value=e}get textContent(){return super.textContent}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(e,i){e.flexDirection=Sse,e.justifyContent=I2,e.alignItems=E2,e.bounds=Mse,e.autoSize=Ise,e.renderer=Rse,e.children||(e.children=Tse),e.textContent||(e.textContent=yse),e.layouter||(e.layouter=bse),e.lineHeight||(e.lineHeight=Cse),e.textAlign||(e.textAlign=xse),e.whiteSpace||(e.whiteSpace=X2),e.fontKerning||(e.fontKerning=Ese),e.segments||(e.segments=uj),i.width||(i.width="100%"),i.fontSide||(i.fontSide=0)}static init(e){Object.defineProperties(e,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class Pse extends Ci{constructor(){super("inlines",null,!1),this._value=[]}process(e){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const i=this._value.length-1;this._value[i].paddingRight=e._padding._value.y,this._value[i].marginRight=e._margin._value.y}}class Bse extends Ci{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new J4(e)),e._backgroundMesh.position.x=e._inlines._value[0].offsetX+e._inlines._value[0].width/2,e._backgroundMesh.position.y=e._inlines._value[0].offsetY+e._inlines._value[0].lineBase/2,e._bounds.render(e)}}class kse extends Ci{constructor(){super("bounds",null,!1),this._size=new Qe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(e,i){this.output(i),this._needsProcess=!0}process(e){this._offsetWidth=this._innerWidth=e._inlines._value[0].width,this._offsetHeight=this._innerHeight=e._inlines._value[0].height,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(e){e.size=this._size}}class y_ extends Gy{constructor(e={}){const i={};y_.definePropertiesValues(i,e),super(i,e),y_.init(this)}clear(){for(const e of this._inlines._value)e.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new Qe.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(e){const i=[];for(let r=0;r<arguments.length;r++){const s=arguments[r];s.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",s):(i.push(s),s.position.z=.005)}return super.add(...i)}static definePropertiesValues(e,i){e.children||(e.children=dj),e.bounds||(e.bounds=kse),e.inlines||(e.inlines=Pse),e.layouter||(e.layouter=ej),e.renderer||(e.renderer=Bse),e.fontFamily||(e.fontFamily=nj),e.fontWeight||(e.fontWeight=ij),e.fontStyle||(e.fontStyle=tj),e.fontSize||(e.fontSize=hj),e.backgroundColor||(e.backgroundColor=P4),e.lineBreak||(e.lineBreak=$4),e.letterSpacing||(e.letterSpacing=cj),e.whiteSpace||(e.whiteSpace=X2),e.fontKerning||(e.fontKerning=A1),i.backgroundSize||(i.backgroundSize="cover"),i.width||(i.width="100%"),i.height||(i.height="100%"),i.boxSizing||(i.boxSizing="border-box")}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),e._inlines._value=[new Ose(e)],e.backgroundMaterial=new X4,e._renderer.render(e)}}class Ose extends E4{constructor(e){super(),this._uiElement=e}get xadvance(){const e=this._uiElement._padding._value,i=this._uiElement._width;return i._relative?i._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.w+e.y+i.value}get width(){const e=this._uiElement._width;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get height(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get anchor(){return this.height}get lineHeight(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get lineBase(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}clear(){this._uiElement=null}}class fj{constructor(e){this._subject=e}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const mj=()=>x1.update(),gj={BaseProperty:Ci,Block:g_,Text:v_,Inline:Vv,InlineBlock:y_,MeshUIBaseElement:Gy,FontLibrary:Jp,update:mj,MSDFFontMaterialUtils:sl,ShaderChunkUI:W4,Behavior:fj,FontVariant:zy};typeof global<"u"&&(global.ThreeMeshUI=gj);const Dse=gj;var Lse=Zn.ti,vj=Zn.nS,q2=Zn.eB,Use=Zn.Yp,Y2=Zn.VB,Fse=Zn.BC,Nse=Zn.zN,w1=Zn.cV,zse=Zn.hW,jse=Zn.k2,Gse=Zn.K6,Hse=Zn.M7,Vse=Zn.ls,Qse=Zn.Hi,J2=Zn.EY,Wse=Zn.MR,Xse=Zn.zf,ji=Zn.Ay,yj=Zn.yo;const Aj=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:Lse,Behavior:vj,Block:q2,DefaultValues:Use,FontLibrary:Y2,FontVariant:Fse,InheritableProperty:Nse,Inline:w1,InlineBlock:zse,InlineGlyph:jse,MSDFFontMaterialUtils:Gse,MaterialTransformers:Hse,MeshUIBaseElement:Vse,ShaderChunkUI:Qse,Text:J2,TypographicFont:Wse,TypographicGlyph:Xse,default:ji,update:yj},Symbol.toStringTag,{value:"Module"}));class qse{constructor(){p(this,"Rad2Deg",180/Math.PI),p(this,"Deg2Rad",Math.PI/180),p(this,"Epsilon",1e-5)}random(e,i){return e!==void 0&&i!==void 0?Math.random()*(i-e)+e:Math.random()}randomVector3(e,i=0,r=1){e.x=this.random(i,r),e.y=this.random(i,r),e.z=this.random(i,r)}clamp(e,i,r){return e<i?i:e>r?r:e}clamp01(e){return this.clamp(e,0,1)}lerp(e,i,r){return r=r<0?0:r,r=r>1?1:r,e+(i-e)*r}inverseLerp(e,i,r){return(r-e)/(i-e)}remap(e,i,r,s,o){return s+(o-s)*(e-i)/(r-i)}moveTowards(e,i,r){return e+=r,(r<0&&e<i||r>0&&e>i)&&(e=i),e}toDegrees(e){return e*180/Math.PI}toRadians(e){return e*Math.PI/180}tan(e){return Math.tan(e)}gammaToLinear(e){return Math.pow(e,2.2)}linearToGamma(e){return Math.pow(e,1/2.2)}approximately(e,i,r=Number.EPSILON){for(const s of Yse){const o=e[s],a=i[s];if(o===void 0||a===void 0)break;if(Math.abs(o-a)>r)return!1}return!0}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}}const Yse=["x","y","z","w"],tt=new qse;class bj{constructor(e){p(this,"y"),p(this,"s"),p(this,"alpha",0),this.setAlpha(e),this.y=null,this.s=null}setAlpha(e){if(e<=0||e>1)throw new Error;this.alpha=e}filter(e,i){i&&this.setAlpha(i);let r;return this.y?r=this.alpha*e+(1-this.alpha)*this.s:r=e,this.y=e,this.s=r,r}lastValue(){return this.y}reset(e){this.y=e,this.s=e}}class S1{constructor(e,i=1,r=0,s=1){if(p(this,"freq"),p(this,"minCutOff"),p(this,"beta"),p(this,"dCutOff"),p(this,"x"),p(this,"dx"),p(this,"lasttime"),e<=0||i<=0||s<=0)throw new Error;this.freq=e,this.minCutOff=i,this.beta=r,this.dCutOff=s,this.x=new bj(this.alpha(this.minCutOff)),this.dx=new bj(this.alpha(this.dCutOff)),this.lasttime=null}alpha(e){const i=1/this.freq;return 1/(1+1/(2*Math.PI*e)/i)}filter(e,i=null){this.lasttime&&i&&(this.freq=1/(i-this.lasttime)),this.lasttime=i;const r=this.x.lastValue(),s=r?(e-r)*this.freq:0,o=this.dx.filter(s,this.alpha(this.dCutOff)),a=this.minCutOff+this.beta*Math.abs(o);return this.x.filter(e,this.alpha(a))}reset(e){e!=null&&this.x.reset(e),this.x.alpha=this.alpha(this.minCutOff),this.dx.alpha=this.alpha(this.dCutOff),this.lasttime=null}}class K2{constructor(e,i=1,r=0,s=1){p(this,"x"),p(this,"y"),p(this,"z"),this.x=new S1(e,i,r,s),this.y=new S1(e,i,r,s),this.z=new S1(e,i,r,s)}filter(e,i,r=null){i.x=this.x.filter(e.x,r),i.y=this.y.filter(e.y,r),i.z=this.z.filter(e.z,r)}reset(e){this.x.reset(e?.x),this.y.reset(e?.y),this.z.reset(e?.z)}}class Ag extends pe{constructor(e,i,r,s=128){if(i<=0||r<=0||s<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const o=new tl(r,2*s,s);o.scale(1,1,-1);const a=o.getAttribute("position"),l=new S;for(let c=0;c<a.count;++c)if(l.fromBufferAttribute(a,c),l.y<0){const h=-i*3/2,u=l.y<h?-i/l.y:1-l.y*l.y/(3*h*h);l.multiplyScalar(u),l.toArray(a.array,3*c)}a.needsUpdate=!0,super(o,new Jt({map:e,depthWrite:!1}))}}const C1="needle:cameraController";function xj(n){return n[C1]}function Z2(n,e,i){i?n[C1]=e:n[C1]===e&&(n[C1]=null)}const $2="needle:autofit";function _j(n){return n[$2]===void 0?!0:n[$2]!==!1}function eP(n,e){n[$2]=e}function Jse(n,e,i){const r=n.length(),s=e.length(),o=tt.lerp(r,s,i);return n.lerp(e,i).normalize().multiplyScalar(o)}const tP=new Ce,Kse=new Ce().setFromAxisAngle(new S(0,1,0),Math.PI);function Zse(n,e){n.lookAt(e),n.quaternion.multiply(Kse)}function Hy(n,e,i=!0,r=!1){if(n===e)return;tP.copy(n.quaternion);const s=kt(e),o=kt(n);if(r){if(Ca(n,Ri(e)),i){const a=o.y,l=o.sub(sP(n));l.y=a,n.lookAt(l)}Number.isNaN(n.quaternion.x)&&n.quaternion.copy(tP);return}i&&(s.y=o.y),n.lookAt(s),Number.isNaN(n.quaternion.x)&&n.quaternion.copy(tP)}const $se=new Qo(()=>new S,100);function bt(n,e,i){const r=$se.get();return r.set(0,0,0),n instanceof S?r.copy(n):n instanceof DOMPointReadOnly?r.set(n.x,n.y,n.z):(typeof n=="number"&&(r.x=n),typeof e=="number"&&(r.y=e),typeof i=="number"&&(r.z=i)),r}const eoe=new Qo(()=>new be,30);function wj(n){const e=eoe.get();return n?e.copy(n):e.set(0,0,0),e}const toe=new Qo(()=>new Ce,100);function ic(n){const e=toe.get();return e.identity(),n instanceof Ce?e.copy(n):n instanceof DOMPointReadOnly&&e.set(n.x,n.y,n.z,n.w),e}const iP=new Qo(()=>new S,100),Sj=Symbol("lastMatrixWorldUpdateKey");function kt(n,e=null,i=!0){const r=e??iP.get();return n?n.parent?(i&&n.updateWorldMatrix(!0,!1),n.matrixWorldNeedsUpdate&&n[Sj]!==Date.now()&&(n[Sj]=Date.now(),n.updateMatrixWorld()),r.setFromMatrixPosition(n.matrixWorld),r):r.copy(n.position):r.set(0,0,0)}function gr(n,e){if(!n)return n;const i=iP.get();return e!==i&&i.copy(e),(n?.parent??n).worldToLocal(i),n.position.set(i.x,i.y,i.z),n}function Kp(n,e,i,r){const s=iP.get();return s.set(e,i,r),gr(n,s),n}const E1=new Qo(()=>new Ce,100),Zp=new Ce,nP=new Ce;function Ri(n,e=null){if(!n)return E1.get().identity();const i=e??E1.get();return n.parent?(n.getWorldQuaternion(i),i):i.copy(n.quaternion)}function Ca(n,e){if(!n)return;e!==Zp&&Zp.copy(e);const i=Zp,r=n?.parent;r?.getWorldQuaternion(nP),nP.invert();const s=nP.multiply(i);n.quaternion.set(s.x,s.y,s.z,s.w)}function rP(n,e,i,r,s){Zp.set(e,i,r,s),Ca(n,Zp)}const ioe=new Qo(()=>new S,100),noe=new S;function Qi(n,e=null){return e||(e=ioe.get()),n?n.parent?(n.getWorldScale(e),e):e.copy(n.scale):e.set(0,0,0)}function bg(n,e){if(!n)return;if(!n.parent){n.scale.copy(e);return}const i=noe;n.parent.getWorldScale(i),n.scale.copy(e),n.scale.divide(i)}const roe=new S,Cj=new Ce;function soe(n){return Ri(n,Cj),roe.set(0,0,1).applyQuaternion(Cj)}const ooe=new Qo(()=>new S,100),Ej=new Ce;function sP(n,e){return e||(e=ooe.get().set(0,0,1)),Ri(n,Ej),e.applyQuaternion(Ej)}const Mj=new ri,Tj=new ri,aoe=new S;function oP(n){const e=E1.get();return n.getWorldQuaternion(e),Tj.setFromQuaternion(e),Tj}function aP(n,e){const i=E1.get();Ca(n,i.setFromEuler(e))}function Vy(n){const e=oP(n),i=aoe;return i.set(e.x,e.y,e.z),i.x=tt.toDegrees(i.x),i.y=tt.toDegrees(i.y),i.z=tt.toDegrees(i.z),i}function lP(n,e){Qy(n,e.x,e.y,e.z,!0)}function Qy(n,e,i,r,s=!0){s&&(e=tt.toRadians(e),i=tt.toRadians(i),r=tt.toRadians(r)),Mj.set(e,i,r),Zp.setFromEuler(Mj),Ca(n,Zp)}function M1(n,e=!0){n&&(e?function i(r){console.groupCollapsed((r.name?r.name:"(no name : "+r.type+")")+" %o",r),r.children.forEach(i),console.groupEnd()}(n):n.traverse(function(i){for(var r="|___",s=i;s.parent!==null;)r="	"+r,s=s.parent;console.log(r+i.name+" <"+i.type+">")}))}function loe(n){let e=n?.name||"";if(!n)return e;let i=n.parent;for(;i;)e=i.name+"/"+e,i=i.parent;return e}function Ij(n){if(n){const e=n;return e.blendMode!==void 0&&e.clampWhenFinished!==void 0&&e.enabled!==void 0&&e.fadeIn!==void 0&&e.getClip!==void 0}return!1}class Ea{static createBlitMaterial(e){return new Bt({uniforms:{map:new Se(null)},vertexShader:this.vertex,fragmentShader:e})}static copyTexture(e,i){const r=i??this.blipMaterial;r.uniforms.map.value=e,r.needsUpdate=!0,r.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new Bt({uniforms:{map:new Se(null)},vertexShader:this.vertex,fragmentShader:this.fragment}));const s=r.vertexShader;r.vertexShader=this.vertex,this.mesh||(this.mesh=new pe(this.planeGeometry,this.blipMaterial));const o=this.mesh;o.material=r,o.frustumCulled=!1,this.scene.children.length=0,this.scene.add(o),this.renderer||(this.renderer=new lh({antialias:!1})),this.renderer.setSize(e.image.width,e.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const a=new Gt(this.renderer.domElement);return a.name="Copy",a.needsUpdate=!0,r.vertexShader=s,a}static textureToCanvas(e,i){if(!e)return null;(i===!0||e.isCompressedTexture===!0)&&(e=Rj(e));const r=e.image;if(hoe(r)){const s=document.createElement("canvas");s.width=r.width,s.height=r.height;const o=s.getContext("2d");return o?(o.drawImage(r,0,0,r.width,r.height,0,0,s.width,s.height),s):(console.error("Failed getting canvas 2d context"),null)}return null}}p(Ea,"planeGeometry",new cr(2,2,1,1)),p(Ea,"renderer"),p(Ea,"perspectiveCam",new Ft),p(Ea,"scene",new Er),p(Ea,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),p(Ea,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),p(Ea,"blipMaterial"),p(Ea,"mesh");function Rj(n){return Ea.copyTexture(n)}function coe(n,e=!1){return Ea.textureToCanvas(n,e)}function hoe(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}function uoe(n){const e=n.type;return e==="Mesh"||e==="SkinnedMesh"}function cP(n,e){e?n["needle:rendercustomshadow"]=!0:n["needle:rendercustomshadow"]=!1}function Pj(n){return!!(n&&(n["needle:rendercustomshadow"]===!0||n["needle:rendercustomshadow"]==null))}function pl(n,e=void 0){const i=new Ht;i.makeEmpty();const r=[];function s(a){let l=!0;if(a.visible&&_j(a)!==!1&&!(a.type==="TransformControlsGizmo"||a.type==="TransformControlsPlane")){if(a instanceof r2&&(l=!1),a instanceof Zw&&(l=!1),a instanceof Ag&&(l=!1),a.isGizmo===!0&&(l=!1),a.material instanceof Fw&&(l=!1),uoe(a)||(l=!1),l&&(e&&Array.isArray(e)&&e!=null&&e.includes(a)||typeof e=="function"&&e(a)===!0))return;if(a.isUI!==!0){if(l){const c=a.children;a.children=r;const h=a.position,u=a.scale;if(Number.isNaN(h.x)||Number.isNaN(h.y)||Number.isNaN(h.z)){console.warn(`Object "${a.name}" has NaN values in position or scale.... will ignore it`,h,u);return}i.expandByObject(a,!0),a.children=c}for(const c of a.children)s(c)}}}let o=!1;for(const a of n)a&&(o=!0,a.updateMatrixWorld(),s(a));return o||console.warn("No objects to fit camera to..."),i}function Bj(n,e,i){const r=pl([n],i?.ignore),s=new S;r.getSize(s);const o=new S;r.getCenter(o);const a=new S;e.getSize(a);const l=new S;e.getCenter(l);const c=new S;c.set(a.x/s.x,a.y/s.y,a.z/s.z);const h=Math.min(c.x,c.y,c.z),u=i?.scale!==!1;if(u&&bg(n,Qi(n).multiplyScalar(h)),i?.position!==!1){const d=new S;r.getCenter(d),d.y=r.min.y;const f=new S;e.getCenter(f),f.y=e.min.y;const m=f.clone().sub(d);u&&m.multiplyScalar(h),gr(n,kt(n).add(m))}return{boundsBefore:r,scale:c}}function kj(n,e){const i=pl([n]),r=new S;i.getCenter(r),r.y=i.min.y;const s=e.clone().sub(r),o=kt(n);return gr(n,o.add(s)),{offset:s,bounds:i}}function hP(n,e,i,r){if(Array.isArray(e)){let a=!0;for(let l=0;l<e.length;l++)hP(n,e[l],l,e)||(a=!1);return a}if(e.type==="MeshStandardMaterial")return!1;if(e["material:fbx"]!=null)return!0;const s=new mr;s["material:fbx"]=e;const o=e;return o&&(o.map?s.color.set(1,1,1):s.color.copyLinearToSRGB(o.color),s.emissive.copyLinearToSRGB(o.emissive),s.emissiveIntensity=o.emissiveIntensity,s.opacity=o.opacity,s.displacementScale=o.displacementScale,s.transparent=o.transparent,s.bumpMap=o.bumpMap,s.aoMap=o.aoMap,s.map=o.map,s.displacementMap=o.displacementMap,s.emissiveMap=o.emissiveMap,s.normalMap=o.normalMap,s.envMap=o.envMap,s.alphaMap=o.alphaMap,s.metalness=o.reflectivity,o.shininess&&(s.roughness=1-Math.sqrt(o.shininess)/10),s.needsUpdate=!0),i===void 0?n.material=s:r[i]=s,!0}let T1=!1;die((...n)=>{var e;it()&&(e=fi.Current)!=null&&e.isInXR&&($p(!0),Oj("error",...n))});function $p(n){if(n){if(T1)return;T1=!0,poe()}else{if(!T1)return;T1=!1,foe()}}const Wy={log:void 0,warn:void 0,error:void 0};class doe{constructor(){p(this,"familyName","needle-xr"),p(this,"root",null),p(this,"context",null),p(this,"defaultFontSize",.06),p(this,"targetObject",new ve),p(this,"userForwardViewPoint",new S),p(this,"oneEuroFilter",new K2(90,.8)),p(this,"_lastElementRemoveTime",0),p(this,"onBeforeRender",()=>{var e,i;const r=(e=this.context)==null?void 0:e.mainCamera;if(this.context&&r instanceof Ft){const s=this.getRoot();Number.isNaN(s.position.x)&&s.position.set(0,0,0),Number.isNaN(s.quaternion.x)&&s.quaternion.set(0,0,0,1),this.context.scene.add(this.targetObject);const o=((i=this.context.xr)==null?void 0:i.rigScale)??1,a=3.5*o,l=r.worldForward;l.y=0,l.normalize().multiplyScalar(a),this.userForwardViewPoint.copy(r.worldPosition).sub(l),this.targetObject.position.distanceTo(this.userForwardViewPoint)>2*o&&(this.targetObject.position.copy(this.userForwardViewPoint),Hy(this.targetObject,r,!0,!0),this.targetObject.rotateY(Math.PI)),this.oneEuroFilter.filter(this.targetObject.position,s.position,this.context.time.time);const c=this.context.time.deltaTime;if(s.quaternion.slerp(this.targetObject.quaternion,c*5),s.scale.setScalar(o),this.targetObject.removeFromParent(),this.context.scene.add(s),this.context.time.time-this._lastElementRemoveTime>.1){this._lastElementRemoveTime=this.context.time.time;const h=Date.now();for(let u=0;u<this._activeTexts.length;u++){const d=this._activeTexts[u];if(d instanceof ji.Text&&h-d._activatedTime>2e4){d.removeFromParent(),this._textBuffer.push(d),this._activeTexts.splice(u,1);break}}}}}),p(this,"textOptions",{fontSize:this.defaultFontSize,fontFamily:this.familyName,padding:.03,margin:.005,color:0,backgroundColor:16777215,backgroundOpacity:.4,borderRadius:.03,offset:.025}),p(this,"_textBuffer",[]),p(this,"_activeTexts",[]),this.ensureFont()}onEnable(){this.context=fi.Current||fi.All[0],this.context.pre_render_callbacks.push(this.onBeforeRender)}onDisable(){var e,i,r;(i=this.context)==null||i.pre_render_callbacks.splice((e=this.context)==null?void 0:e.pre_render_callbacks.indexOf(this.onBeforeRender),1),(r=this.root)==null||r.removeFromParent()}addLog(e,i){const r=this.getRoot(),s=this.getText();let o=16777215,a=0;switch(e){case"log":o=16777215,a=0;break;case"warn":o=16772761,a=4465152;break;case"error":o=16755370,a=7798784;break}i.length>1e3&&(i=i.substring(0,1e3)+"...");const l=new Date().toISOString().split("T")[1].split(".")[0];s.textContent="["+l+"] "+i,s.visible=!0,s._activatedTime=Date.now(),r.add(s),this._activeTexts.push(s),this.context&&this.context.scene.add(r),s.set({backgroundColor:o,color:a}),ji.update()}ensureFont(){let e=ji.FontLibrary.getFontFamily(this.familyName);if(!e){e=ji.FontLibrary.addFontFamily(this.familyName);const i=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");i?.addEventListener("ready",()=>{ji.update()})}}getText(){const e=this.getRoot();if(this._textBuffer.length>0){const r=this._textBuffer.pop();return r.visible=!0,setTimeout(()=>this.disableDepthTestRecursive(r),100),r}if(e.children.length>20&&this._activeTexts.length>0)return this._activeTexts.shift();const i=new ji.Text(this.textOptions);return setTimeout(()=>this.disableDepthTestRecursive(i),500),setTimeout(()=>this.disableDepthTestRecursive(i),1500),i}disableDepthTestRecursive(e,i=0){for(let s=0;s<e.children.length;s++){const o=e.children[s];o instanceof ve&&this.disableDepthTestRecursive(o,i+1)}e.renderOrder=10*i,e.layers.set(2);const r=e.material;r&&(r.depthWrite=!1,r.depthTest=!1,r.transparent=!0),i===0&&ji.update()}getRoot(){if(this.root)return this.root;const e=this.defaultFontSize,i={boxSizing:"border-box",fontFamily:this.familyName,width:"2.6",fontSize:e,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:0,whiteSpace:"pre-wrap",flexDirection:"column-reverse"};return this.root=new ji.Block(i),this.root}}let fl=null;function poe(){fl||(fl=new doe),fl.onEnable();for(const n in Wy){Wy[n]=console[n];let e=!1;console[n]=function(){var i;if((i=Wy[n])==null||i.apply(console,arguments),!e)try{e=!0,Oj(n,...arguments)}finally{e=!1}}}}function foe(){fl?.onDisable();for(const n in Wy)console[n]=Wy[n]}const Xy=new Map;function Oj(n,...e){try{switch(Xy.clear(),n){case"log":fl?.addLog("log",i());break;case"warn":fl?.addLog("warn",i());break;case"error":fl?.addLog("error",i());break}}catch(o){console.error("Error in spatial console",o)}finally{Xy.clear()}function i(){let o="";for(let a=0;a<e.length;a++){const l=e[a];o+=r(l),a<e.length-1&&(o+=", ")}return o}function r(o,a=0){if(typeof o=="string")return'"'+o+'"';if(typeof o=="number"){if(o%1!==0){const l=o.toFixed(5),c=l.indexOf(".");let h=l.length-1;for(;h>c&&l[h]==="0";)h--;return l.substring(0,h+1)}return o.toString()}else if(Array.isArray(o)){let l="[";for(let c=0;c<o.length;c++){const h=o[c];l+=r(h,a+1),c<o.length-1&&(l+=", ")}return l+="]",l}else{if(o===null)return"null";if(o===void 0)return"undefined";if(typeof o=="function")return o.name+"()"}if(o instanceof J)return`(${r(o.x)}, ${r(o.y)})`;if(o instanceof S)return`(${r(o.x)}, ${r(o.y)}, ${r(o.z)})`;if(o instanceof qe)return`(${r(o.x)}, ${r(o.y)}, ${r(o.z)}, ${r(o.w)})`;if(o instanceof Ce)return`(${r(o.x)}, ${r(o.y)}, ${r(o.z)}, ${r(o.w)})`;if(o instanceof Ut||o instanceof Gt)return o.name;if(o instanceof Lt)return`[${o.elements.join(", ")}]`;if(o instanceof he)return`[${o.elements.join(", ")}]`;if(o instanceof Cs)return o.mask.toString();if(typeof o=="object"){if(Xy.has(o))return"*";let l=`{
`;l+=s(a);const c=Object.keys(o);let h="";for(let u=0;u<c.length;u++){const d=c[u],f=o[d];if(Xy.has(f)){h+="";continue}Xy.set(f,!0),h+=d+":"+r(f,a+1),u<c.length-1&&(h+=", "),h.length>=60&&(h+=`
`,h+=s(a),l+=h,h="")}return l+=h,l+=`
}`,l}return o}function s(o){let a="";for(let l=0;l<o;l++)a+=" ";return a}}const moe=te("nodevlogs");function dn(n,e=Wo.Log){tc(e,n)}function Pi(n){dn(n,Wo.Warn)}function I1(n){dn(n,Wo.Error)}let uP,dP;function it(){if(moe)return!1;if(uP!==void 0)return uP;if(dP!==void 0)return dP;let n=eo();return n||(n=window.location.hostname.endsWith(".local-credentialless.webcontainer.io")),dP=n,n}function goe(n){uP=n}let Ma=null,Ta=null,nc=null,pP=!1,Dj=null;const Lj="terminal",qy=te("console"),voe=te("noerrors")||te("noconsole");if(qy&&mP(),!voe&&(qy||eo())){if(eo()&&!qy){const e=new URL(window.location.href);e.searchParams.set("console","1"),console.log('\u{1F335} Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development. In VR a spatial console will appear.)',`
Open this page to get the console: `+e.toString())}const n=ec()||c1()&&it();if((n||qy)&&(mie(),Fj(),zj(!0),n)){const e=document.querySelector("needle-engine");e?.addEventListener("enter-ar",()=>{(qy||Ma||g2()>0)&&te("noerrors")}),e?.addEventListener("exit-ar",()=>{xoe()})}}const fP=Symbol("consoleParent");function mP(){if(Ma!==null){Ma.showSwitch();return}zj()}function Uj(){Ma!==null&&(Ma.hide(),Ma.hideSwitch())}function Fj(){Dj||(Dj=setInterval(yoe,500))}let Nj=0;function yoe(){const n=g2(),e=n!==Nj;Nj=n,e&&Aoe()}function Aoe(){mP(),nc&&(nc.setAttribute("error","true"),nc.innerText="\u{1F92C}")}function boe(){nc&&(nc.removeAttribute("error"),nc.innerText=Lj)}function xoe(){Ta&&Ta[fP]&&Ta[fP].appendChild(Ta)}function zj(n=!1){if(Ma||pP)return;pP=!0;const e=document.createElement("script");e.onload=()=>{pP=!1,Fj(),Ma=new VConsole({pluginOrder:["default","needle-console"]});const i=globalThis["needle:codegen_files"];if(i&&i.length>0&&Ma.addPlugin(_oe()),Ta=Soe(),Ta&&(Ta[fP]=Ta.parentElement,Ta.style.position="absolute",Ta.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),Ma.setSwitchPosition(20,30),nc=woe(),nc){nc.innerText=Lj,nc.addEventListener("click",boe);const r=document.createElement("style"),s=40;r.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255, 255, 255, .1);
                    border-radius: 50%;
                    width: ${s}px;
                    height: ${s}px;
                    padding: 0;
                    line-height: ${s}px;
                    font-size: ${s*.4}px;
                    text-align: center;
                    background: #ffffff5c;
                    backdrop-filter: blur(16px);
                    -webkit-backdrop-filter: blur(16px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);

                    font-family: 'Material Symbols Outlined';
                    color: black;
                    font-size: 2.3em;
                    font-weight: 100;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out, background .1s linear;
                    background: rgba(245, 245, 245, .8);
                    outline: rgba(0, 0, 0, .05) 1px solid;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                    line-height: 35px;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
                #__vconsole .vc-panel {
                    font-family: monospace;
                    font-size: 11px;
                }
                #__vconsole .vc-plugin-box.vc-actived {
                    height: 100%;
                }
                #__vconsole .vc-mask {
                    overflow: hidden;
                }
            `,Ta?.prepend(r),n===!0&&g2()<=0&&Uj(),console.log("\u{1F335} Debug console has loaded")}},e.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(e)}function _oe(){const n=new VConsole.VConsolePlugin("needle-console","\u{1F335} Inspect glTF"),e=()=>document.querySelector("#__vc_plug_"+n._id+" iframe");return n.on("renderTab",function(i){const r=globalThis["needle:codegen_files"];if(!r||r.length===0)return;let s=globalThis["needle:codegen_files"][0];const o=s.indexOf("?");o>-1&&(s=s.substring(0,o));const a=location.protocol+"//"+location.host+location.pathname+"/"+s,l=encodeURIComponent(a);n.fullUrl="https://viewer.needle.tools?inspect&file="+l;var c='<iframe src="" style="width: 100%; height: 99%; border: none;"></iframe>';i(c)}),n.on("show",function(){const i=e();i&&i.src!==n.fullUrl&&(i.src=n.fullUrl)}),n.on("hide",function(){const i=e();i&&(i.src="")}),n.on("addTopBar",function(i){var r=new Array;r.push({name:"Open in new window \u2197",onClick:function(s){window.open(n.fullUrl,"_blank"),Ma?.hide()}}),r.push({name:"Reload",onClick:function(s){const o=e();o&&(o.src=n.fullUrl)}}),r.push({name:"Fullscreen",onClick:function(s){const o=e();o.requestFullscreen?o.requestFullscreen():o.webkitRequestFullscreen instanceof Function&&o.webkitRequestFullscreen()}}),i(r)}),n}function woe(){return document.querySelector("#__vconsole .vc-switch")||null}function Soe(){return document.querySelector("#__vconsole")||null}const jj=te("debugdefines");xg('if(!globalThis[""3.47.2-beta.3""]) globalThis[""3.47.2-beta.3""] = "0.0.0";'),xg('if(!globalThis[""undefined""]) globalThis[""undefined""] = "unknown";'),xg('if(!globalThis[""Thu Aug 08 2024 15:10:59 GMT+0200 (Central European Summer Time)""]) globalThis[""Thu Aug 08 2024 15:10:59 GMT+0200 (Central European Summer Time)""] = "unknown";'),xg('globalThis["__NEEDLE_ENGINE_VERSION__"] = "3.47.2-beta.3";'),xg('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "undefined";'),xg('globalThis["__NEEDLE_PROJECT_BUILD_TIME__"] = "Thu Aug 08 2024 15:10:59 GMT+0200 (Central European Summer Time)";');const ml="3.47.2-beta.3",R1="undefined",gP="Thu Aug 08 2024 15:10:59 GMT+0200 (Central European Summer Time)";jj&&console.log(`Engine version: ${ml} (generator: ${R1})
Project built at ${gP}`);const mh="needle_isActiveInHierarchy",ef="builtin_components",Yy="needle_editor_guid";function xg(n){try{(0,eval)(n)}catch(e){jj&&console.error(e)}}const Coe='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',Eoe=btoa(Coe),Moe="data:image/svg+xml;base64,"+Eoe,Toe=Moe,Ioe=`<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" version="1.1" viewBox="0 0 1014 282" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m665.95 132.73v44.88l-10.56-8.4c-0.8-0.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18 0.4-6.06 1.2s-3.54 1.8-4.98 3-2.56 2.5-3.36 3.9-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c0.32 0.24 0.56 0.44 0.72 0.6s0.36 0.32 0.6 0.48c0.96-1.2 2.14-2.28 3.54-3.24s2.92-1.76 4.56-2.4 3.34-1.14 5.1-1.5 3.44-0.54 5.04-0.54c1.44 0 2.92 0.04 4.44 0.12s2.84 0.28 3.96 0.6c4.56 1.12 7.8 3.12 9.72 6s2.88 6.56 2.88 11.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m732.38 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m795.93 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m858.57 97.21c0.64 0.48 0.96 1.16 0.96 2.04v74.88c-0.08 1.04-0.12 2.12-0.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18s-2.06-1.66-2.46-1.98c-1.76 2.48-4.26 4.44-7.5 5.88s-7.02 2.16-11.34 2.16c-3.84 0-7.4-0.7-10.68-2.1s-6.14-3.44-8.58-6.12-4.34-5.94-5.7-9.78-2.04-8.16-2.04-12.96c0-4.32 0.78-8.34 2.34-12.06s3.6-6.92 6.12-9.6 5.38-4.78 8.58-6.3 6.48-2.28 9.84-2.28c2.56 0 4.82 0.22 6.78 0.66s3.68 1.06 5.16 1.86 2.78 1.74 3.9 2.82 2.16 2.22 3.12 3.42v-35.04l10.68 8.64zm-27.96 67.92c3.6 0 6.52-0.68 8.76-2.04s3.98-3.06 5.22-5.1 2.1-4.22 2.58-6.54 0.72-4.44 0.72-6.36v-1.2c0-1.12-0.22-2.7-0.66-4.74s-1.28-4.06-2.52-6.06-3-3.7-5.28-5.1-5.22-2.02-8.82-1.86c-3.44 0-6.26 0.74-8.46 2.22s-3.96 3.26-5.28 5.34-2.24 4.2-2.76 6.36-0.78 3.92-0.78 5.28c0 1.84 0.24 3.92 0.72 6.24s1.36 4.48 2.64 6.48 3.04 3.68 5.28 5.04 5.12 2.04 8.64 2.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m882.81 97.09c0.64 0.48 0.96 1.12 0.96 1.92l-0.12 41.04v37.08l-10.56-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-77.88l10.8 8.64z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m950.36 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.8559 0 0 .7642 45.348 36.475)"> <g transform="translate(2.7114)"> <path d="m3.935 173.02c-0.331 0-0.497-0.402-0.497-1.207v-51.002c0-0.738 0.138-1.107 0.414-1.107h1.781c0.277 0 0.415 0.335 0.415 1.006v5.935c0 0.336 0.027 0.553 0.083 0.654 0.055 0.101 0.151-0.017 0.289-0.352 0.912-1.744 1.754-3.236 2.527-4.477 0.773-1.24 1.554-2.179 2.341-2.816s1.65-0.956 2.588-0.956c1.685 0 3.011 0.922 3.977 2.766 0.967 1.845 1.602 3.84 1.905 5.986 0.056 0.268 0.139 0.369 0.249 0.302s0.221-0.235 0.331-0.503c0.939-1.811 1.802-3.353 2.589-4.628 0.787-1.274 1.581-2.246 2.382-2.917s1.671-1.006 2.61-1.006c2.016 0 3.569 1.392 4.66 4.175 1.09 2.783 1.636 6.421 1.636 10.915v37.925c0 0.871-0.18 1.307-0.539 1.307h-1.739c-0.138 0-0.249-0.1-0.332-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.338-6.321-1.015-8.3-0.676-1.978-1.76-2.967-3.251-2.967-0.884 0-1.726 0.386-2.527 1.157s-1.519 1.727-2.154 2.867-1.201 2.213-1.699 3.219c-0.248 0.469-0.421 0.905-0.517 1.308-0.097 0.402-0.145 0.972-0.145 1.71v37.221c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.166 0-0.29-0.1-0.373-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.332-6.321-0.994-8.3-0.663-1.978-1.754-2.967-3.273-2.967-1.242 0-2.375 0.704-3.396 2.112-1.022 1.409-2.223 3.555-3.604 6.439v39.031c0 0.805-0.18 1.207-0.539 1.207h-1.698z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m53.642 166.28c-1.077 2.549-2.237 4.477-3.479 5.785-1.243 1.307-2.61 1.961-4.101 1.961-2.154 0-3.853-1.324-5.095-3.973-1.243-2.649-1.864-6.187-1.864-10.613 0-3.488 0.4-6.489 1.201-9.004s1.988-4.51 3.562-5.985c1.574-1.476 3.521-2.414 5.841-2.817l3.686-0.704c0.221-0.067 0.394-0.218 0.518-0.453 0.124-0.234 0.187-0.587 0.187-1.056v-2.917c0-3.89-0.504-6.975-1.512-9.255s-2.354-3.42-4.039-3.42c-1.298 0-2.472 0.72-3.521 2.162s-2.002 3.572-2.858 6.388c-0.083 0.268-0.159 0.453-0.228 0.554-0.069 0.1-0.172 0.083-0.311-0.051l-1.698-1.71c-0.083-0.134-0.138-0.285-0.166-0.453-0.027-0.167 0.014-0.452 0.125-0.855 0.856-3.353 2.009-6.052 3.459-8.098 1.449-2.045 3.224-3.068 5.322-3.068 1.74 0 3.211 0.687 4.412 2.062s2.112 3.37 2.734 5.986c0.621 2.615 0.932 5.7 0.932 9.255v35.712c0 0.536-0.035 0.888-0.104 1.056s-0.2 0.251-0.393 0.251h-1.533c-0.166 0-0.29-0.117-0.373-0.352-0.083-0.234-0.124-0.553-0.124-0.955l-0.083-5.231c-0.055-0.939-0.221-1.006-0.497-0.202zm0.456-19.314c0-1.14-0.194-1.643-0.58-1.509l-3.107 0.603c-1.436 0.202-2.686 0.638-3.749 1.308-1.063 0.671-1.953 1.543-2.671 2.616s-1.257 2.33-1.616 3.772-0.538 3.102-0.538 4.98c0 3.152 0.455 5.616 1.367 7.393 0.911 1.778 2.14 2.666 3.686 2.666 0.939 0 1.85-0.419 2.734-1.257s1.671-1.895 2.361-3.169c0.663-1.408 1.181-2.85 1.553-4.326 0.373-1.475 0.56-2.883 0.56-4.225v-8.852z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m79.034 173.02c-0.166 0-0.297-0.117-0.394-0.352-0.096-0.234-0.145-0.553-0.145-0.955v-4.628c0-0.536-0.041-0.838-0.124-0.905s-0.207 0.1-0.373 0.503c-0.276 0.67-0.69 1.593-1.242 2.766-0.553 1.174-1.271 2.23-2.154 3.169-0.884 0.939-1.961 1.408-3.231 1.408-1.74 0-3.314-0.989-4.722-2.967-1.409-1.979-2.534-4.963-3.376-8.953-0.843-3.991-1.264-8.937-1.264-14.838 0-5.701 0.415-10.68 1.243-14.939s1.988-7.595 3.479-10.009c1.492-2.415 3.204-3.622 5.137-3.622 1.436 0 2.616 0.57 3.541 1.71 0.926 1.14 1.719 2.381 2.382 3.722 0.249 0.47 0.414 0.637 0.497 0.503s0.125-0.536 0.125-1.207v-23.841c0-0.805 0.151-1.208 0.455-1.208h1.864c0.276 0 0.414 0.369 0.414 1.107v72.128c0 0.537-0.041 0.905-0.124 1.107-0.083 0.201-0.235 0.301-0.455 0.301h-1.533zm-0.621-42.049c-0.939-2.213-1.885-3.94-2.838-5.181s-2.009-1.861-3.169-1.861c-1.463 0-2.768 0.889-3.914 2.666s-2.044 4.376-2.693 7.796-0.973 7.578-0.973 12.474c0 5.097 0.338 9.272 1.015 12.524 0.676 3.253 1.567 5.651 2.672 7.193 1.104 1.543 2.305 2.314 3.603 2.314 1.188 0 2.258-0.704 3.211-2.113 0.952-1.408 1.705-3.118 2.257-5.13s0.829-3.957 0.829-5.835v-24.847z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m89.514 149.38c0 3.42 0.345 6.606 1.035 9.557 0.691 2.951 1.609 5.315 2.755 7.092s2.437 2.666 3.873 2.666c1.519 0 2.837-0.738 3.956-2.213 1.118-1.476 2.064-3.655 2.837-6.539 0.083-0.336 0.166-0.52 0.249-0.554 0.083-0.033 0.179 0.017 0.29 0.151l1.408 1.912c0.221 0.268 0.235 0.67 0.041 1.207-0.69 2.548-1.47 4.661-2.34 6.337-0.87 1.677-1.857 2.935-2.962 3.773-1.104 0.838-2.319 1.257-3.645 1.257-2.043 0-3.838-1.14-5.385-3.42-1.546-2.28-2.761-5.482-3.645-9.607-0.884-4.124-1.325-8.836-1.325-14.134 0-5.901 0.455-10.931 1.367-15.089 0.911-4.158 2.14-7.377 3.686-9.658 1.547-2.28 3.3-3.42 5.261-3.42 1.988 0 3.714 1.073 5.178 3.219 1.463 2.146 2.595 5.231 3.396 9.255s1.201 8.886 1.201 14.587c0 0.469-0.02 0.939-0.062 1.408-0.041 0.469-0.214 0.704-0.517 0.704h-16.362c-0.083 0-0.152 0.151-0.207 0.453-0.056 0.302-0.083 0.654-0.083 1.056zm13.752-6.237c0.304 0 0.497-0.1 0.58-0.302 0.083-0.201 0.124-0.57 0.124-1.106 0-3.219-0.283-6.187-0.849-8.903s-1.367-4.896-2.402-6.539c-1.036-1.643-2.272-2.464-3.708-2.464-1.629 0-2.996 0.955-4.101 2.867-1.104 1.911-1.94 4.342-2.506 7.293s-0.849 6.002-0.849 9.154h13.711z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m148.54 119.7c0.165 0 0.283 0.117 0.352 0.352s0.076 0.52 0.02 0.855l-6.254 50.902c-0.028 0.47-0.104 0.788-0.228 0.956s-0.297 0.251-0.518 0.251h-1.615c-0.442 0-0.718-0.402-0.829-1.207l-5.26-40.138c-0.111-0.604-0.201-0.905-0.27-0.905s-0.131 0.301-0.186 0.905l-5.012 40.138c-0.028 0.47-0.097 0.788-0.207 0.956-0.111 0.168-0.277 0.251-0.497 0.251h-1.74c-0.442 0-0.718-0.402-0.829-1.207l-6.503-50.801c-0.055-0.403-0.048-0.721 0.021-0.956s0.2-0.352 0.393-0.352h1.823c0.166 0 0.297 0.067 0.393 0.201 0.097 0.134 0.159 0.403 0.187 0.805l5.302 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.219-41.949c0.055-0.268 0.124-0.47 0.207-0.604s0.193-0.201 0.331-0.201h1.533c0.138 0 0.262 0.067 0.373 0.201 0.11 0.134 0.179 0.403 0.207 0.805l5.468 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.053-41.849c0.055-0.335 0.138-0.57 0.249-0.704 0.11-0.134 0.234-0.201 0.373-0.201h1.284z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m156.49 171.51c0 0.604-0.042 1.006-0.125 1.208-0.082 0.201-0.262 0.301-0.538 0.301h-1.533c-0.221 0-0.366-0.083-0.435-0.251s-0.103-0.486-0.103-0.956v-50.902c0-0.805 0.152-1.207 0.456-1.207h1.822c0.304 0 0.456 0.402 0.456 1.207v50.6zm0.165-63.979c0 1.207-0.207 1.811-0.621 1.811h-1.905c-0.221 0-0.366-0.135-0.435-0.403s-0.104-0.67-0.104-1.207v-7.847c0-1.006 0.18-1.509 0.539-1.509h1.988c0.359 0 0.538 0.47 0.538 1.409v7.746z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m168.3 124.83c-0.221 0-0.331 0.269-0.331 0.805v33.801c0 3.42 0.221 5.667 0.663 6.74 0.441 1.073 1.09 1.609 1.946 1.609h3.024c0.138 0 0.242 0.084 0.311 0.252 0.069 0.167 0.103 0.419 0.103 0.754v2.716c0 0.537-0.138 0.906-0.414 1.107-0.248 0.067-0.614 0.134-1.098 0.201-0.483 0.067-0.959 0.118-1.429 0.151-0.469 0.034-0.828 0.05-1.077 0.05-1.712 0-2.934-0.955-3.665-2.867-0.732-1.911-1.098-5.013-1.098-9.305v-35.108c0-0.604-0.124-0.906-0.373-0.906h-3.521c-0.248 0-0.373-0.268-0.373-0.804v-3.521c0-0.537 0.111-0.805 0.332-0.805h3.686c0.166 0 0.263-0.268 0.29-0.805l0.415-16.095c0-0.805 0.124-1.207 0.372-1.207h1.492c0.303 0 0.455 0.436 0.455 1.307v15.995c0 0.537 0.097 0.805 0.29 0.805h5.468c0.221 0 0.331 0.268 0.331 0.805v3.521c0 0.536-0.124 0.804-0.373 0.804h-5.426z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m179.4 173.02c-0.331 0-0.497-0.402-0.497-1.207v-72.329c0-0.738 0.138-1.107 0.414-1.107h1.782c0.276 0 0.414 0.336 0.414 1.006v27.162c0 0.335 0.034 0.536 0.103 0.603s0.159-0.033 0.27-0.302c0.994-1.81 1.898-3.319 2.713-4.526 0.814-1.208 1.629-2.113 2.444-2.717 0.814-0.603 1.691-0.905 2.63-0.905 2.182 0 3.839 1.375 4.971 4.125 1.132 2.749 1.698 6.404 1.698 10.965v37.925c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.165 0-0.29-0.1-0.373-0.301-0.082-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.366-6.321-1.097-8.3-0.732-1.978-1.899-2.967-3.501-2.967-0.883 0-1.705 0.318-2.464 0.956-0.76 0.637-1.526 1.576-2.299 2.816-0.773 1.241-1.643 2.834-2.61 4.779v39.031c0 0.805-0.179 1.207-0.538 1.207h-1.699z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> </g> <g transform="matrix(.80638 0 0 .80638 452.53 65.421)" fill-rule="nonzero"> <path d="m79.32 36.98v150.76l15.68-13.2 6.59-156.31-22.27 18.75z" fill="url(#f)"/> <path d="m79.32 36.98-22.27-18.75 6.59 156.31 15.68 13.2v-150.76z" fill="url(#e)"/> <path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z" fill="url(#d)"/> <path d="m25.19 104.83-25.19-14.59 16.97 53.86 16.85 9.77-8.63-49.04z" fill="url(#c)"/> <path d="M43.86,82.5L18.69,67.98L0,90.24L25.18,104.83L43.86,82.5Z" fill="#9c3"/> <path d="m134.82 78.69-9.97 56.5 15.58-9.04 19.57-62.05-25.18 14.59z" fill="url(#b)"/> <path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z" fill="url(#a)"/> <path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33 25.19-14.59z" fill="#ffe113"/> <path d="M101.59,18.23L79.32,0L57.05,18.23L79.32,36.98L101.59,18.23Z" fill="#f3e600"/> </g> <defs> <linearGradient id="f" x2="1" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)" gradientUnits="userSpaceOnUse"><stop stop-color="#62d399" offset="0"/><stop stop-color="#acd842" offset=".51"/><stop stop-color="#d7db0a" offset=".9"/><stop stop-color="#d7db0a" offset="1"/></linearGradient> <linearGradient id="e" x2="1" gradientTransform="matrix(-1.6,-162.13,162.13,-1.6,69.68,178.9)" gradientUnits="userSpaceOnUse"><stop stop-color="#0ba398" offset="0"/><stop stop-color="#4ca352" offset=".5"/><stop stop-color="#76a30a" offset="1"/></linearGradient> <linearGradient id="d" x2="1" gradientTransform="matrix(-1.9,-67.98,67.98,-1.9,36.6,152.17)" gradientUnits="userSpaceOnUse"><stop stop-color="#36a382" offset="0"/><stop stop-color="#36a382" offset=".19"/><stop stop-color="#49a459" offset=".54"/><stop stop-color="#76a30b" offset="1"/></linearGradient> <linearGradient id="c" x2="1" gradientTransform="matrix(2.18,-62.38,62.38,2.18,15.82,153.24)" gradientUnits="userSpaceOnUse"><stop stop-color="#267880" offset="0"/><stop stop-color="#457a5c" offset=".51"/><stop stop-color="#717516" offset="1"/></linearGradient> <linearGradient id="b" x2="1" gradientTransform="matrix(13.85,-71.96,71.96,13.85,135.08,135.43)" gradientUnits="userSpaceOnUse"><stop stop-color="#b0d939" offset="0"/><stop stop-color="#eadb04" offset="1"/></linearGradient> <linearGradient id="a" x2="1" gradientTransform="matrix(26.159 -64.737 64.737 26.159 107.42 128.14)" gradientUnits="userSpaceOnUse"><stop stop-color="#74af52" offset="0"/><stop stop-color="#74af52" offset=".17"/><stop stop-color="#99be32" offset=".48"/><stop stop-color="#c0c40a" offset="1"/></linearGradient> </defs> </svg>`;btoa(Ioe);const Roe='<svg viewBox="0 0 509 154" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M665.95 132.73v44.88l-10.56-8.4c-.8-.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18.4-6.06 1.2-1.88.8-3.54 1.8-4.98 3-1.44 1.2-2.56 2.5-3.36 3.9-.8 1.4-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-.72-.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c.32.24.56.44.72.6.16.16.36.32.6.48.96-1.2 2.14-2.28 3.54-3.24 1.4-.96 2.92-1.76 4.56-2.4 1.64-.64 3.34-1.14 5.1-1.5 1.76-.36 3.44-.54 5.04-.54 1.44 0 2.92.04 4.44.12 1.52.08 2.84.28 3.96.6 4.56 1.12 7.8 3.12 9.72 6 1.92 2.88 2.88 6.56 2.88 11.04ZM732.38 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM795.93 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM858.57 97.21c.64.48.96 1.16.96 2.04v74.88c-.08 1.04-.12 2.12-.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18-1.24-1-2.06-1.66-2.46-1.98-1.76 2.48-4.26 4.44-7.5 5.88-3.24 1.44-7.02 2.16-11.34 2.16-3.84 0-7.4-.7-10.68-2.1-3.28-1.4-6.14-3.44-8.58-6.12-2.44-2.68-4.34-5.94-5.7-9.78-1.36-3.84-2.04-8.16-2.04-12.96 0-4.32.78-8.34 2.34-12.06 1.56-3.72 3.6-6.92 6.12-9.6 2.52-2.68 5.38-4.78 8.58-6.3 3.2-1.52 6.48-2.28 9.84-2.28 2.56 0 4.82.22 6.78.66 1.96.44 3.68 1.06 5.16 1.86s2.78 1.74 3.9 2.82a35.92 35.92 0 0 1 3.12 3.42V88.57l10.68 8.64Zm-27.96 67.92c3.6 0 6.52-.68 8.76-2.04 2.24-1.36 3.98-3.06 5.22-5.1a20.5 20.5 0 0 0 2.58-6.54c.48-2.32.72-4.44.72-6.36v-1.2c0-1.12-.22-2.7-.66-4.74-.44-2.04-1.28-4.06-2.52-6.06s-3-3.7-5.28-5.1c-2.28-1.4-5.22-2.02-8.82-1.86-3.44 0-6.26.74-8.46 2.22-2.2 1.48-3.96 3.26-5.28 5.34-1.32 2.08-2.24 4.2-2.76 6.36-.52 2.16-.78 3.92-.78 5.28 0 1.84.24 3.92.72 6.24.48 2.32 1.36 4.48 2.64 6.48s3.04 3.68 5.28 5.04c2.24 1.36 5.12 2.04 8.64 2.04ZM882.81 97.09c.64.48.96 1.12.96 1.92l-.12 41.04v37.08l-10.56-8.4c-.72-.64-1.08-1.44-1.08-2.4V88.45l10.8 8.64ZM950.36 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14Z" style="fill-rule:nonzero" transform="translate(-452.406 -63.709) scale(1.00797)"/><path d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75Z" style="fill:url(#a);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98Z" style="fill:url(#b);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33Z" style="fill:url(#c);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04Z" style="fill:url(#d);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5Z" style="fill:#9c3;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59Z" style="fill:url(#e);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5Z" style="fill:url(#f);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1Z" style="fill:#ffe113;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75Z" style="fill:#f3e600;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><defs><linearGradient id="a" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)"><stop offset="0" style="stop-color:#62d399;stop-opacity:1"/><stop offset=".51" style="stop-color:#acd842;stop-opacity:1"/><stop offset=".9" style="stop-color:#d7db0a;stop-opacity:1"/><stop offset="1" style="stop-color:#d7db0a;stop-opacity:1"/></linearGradient><linearGradient id="b" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-90.565 123.412 54.953) scale(162.14)"><stop offset="0" style="stop-color:#0ba398;stop-opacity:1"/><stop offset=".5" style="stop-color:#4ca352;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30a;stop-opacity:1"/></linearGradient><linearGradient id="c" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="scale(-68) rotate(88.4 .881 -1.396)"><stop offset="0" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".19" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".54" style="stop-color:#49a459;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30b;stop-opacity:1"/></linearGradient><linearGradient id="d" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-88 87.255 68.431) scale(62.42)"><stop offset="0" style="stop-color:#267880;stop-opacity:1"/><stop offset=".51" style="stop-color:#457a5c;stop-opacity:1"/><stop offset="1" style="stop-color:#717516;stop-opacity:1"/></linearGradient><linearGradient id="e" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-79.1 149.53 -14.065) scale(73.28)"><stop offset="0" style="stop-color:#b0d939;stop-opacity:1"/><stop offset="1" style="stop-color:#eadb04;stop-opacity:1"/></linearGradient><linearGradient id="f" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-67.997 148.705 -15.558) scale(69.8226)"><stop offset="0" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".17" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".48" style="stop-color:#99be32;stop-opacity:1"/><stop offset="1" style="stop-color:#c0c40a;stop-opacity:1"/></linearGradient></defs></svg>',Poe=btoa(Roe),Boe="data:image/svg+xml;charset=utf-8;base64,"+Poe,koe=Boe;/**
 * postprocessing v6.35.5 build Sat Jun 01 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rschen
 * @license Zlib
 */var vP=1/1e3,Ooe=1e3,Doe=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*vP}get fixedDelta(){return this._fixedDelta*vP}set fixedDelta(n){this._fixedDelta=n*Ooe}get elapsed(){return this._elapsed*vP}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},Loe=new my,Fu=null;function Uoe(){if(Fu===null){const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);Fu=new dt,Fu.setAttribute!==void 0?(Fu.setAttribute("position",new Ye(n,3)),Fu.setAttribute("uv",new Ye(e,2))):(Fu.addAttribute("position",new Ye(n,3)),Fu.addAttribute("uv",new Ye(e,2)))}return Fu}var Jr=class Uq{constructor(e="Pass",i=new Er,r=Loe){this.name=e,this.renderer=null,this.scene=i,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const i=this.fullscreenMaterial;i!==null&&(i.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let i=this.screen;i!==null?i.material=e:(i=new pe(Uoe(),e),i.frustumCulled=!1,this.scene===null&&(this.scene=new Er),this.scene.add(i),this.screen=i)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,i=Wr){}render(e,i,r,s,o){throw new Error("Render method not implemented!")}setSize(e,i){}initialize(e,i,r){}dispose(){for(const e of Object.keys(this)){const i=this[e];(i instanceof qt||i instanceof Ut||i instanceof Gt||i instanceof Uq)&&this[e].dispose()}}},Foe=class extends Jr{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,i,r,s){const o=n.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},Noe=Number(Kc.replace(/\D+/g,""));function _g(n){return Noe<154?n.replace("colorspace_fragment","encodings_fragment"):n}var zoe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,tf="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Gj=class extends Bt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Se(null),opacity:new Se(1)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zoe,vertexShader:tf}),this.fragmentShader=_g(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},Hj=class extends Jr{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new Gj,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new qt(1,1,{minFilter:Dt,magFilter:Dt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,i,r,s){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==cn?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===gt&&(this.renderTarget.texture.colorSpace=gt))}},Vj=new be,P1=class extends Jr{constructor(n=!0,e=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,i){this.color=n,this.depth=e,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,i,r,s){const o=this.overrideClearColor,a=this.overrideClearAlpha,l=n.getClearAlpha(),c=o!==null,h=a>=0;c?(n.getClearColor(Vj),n.setClearColor(o,h?a:l)):h&&n.setClearAlpha(a),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(Vj,l):h&&n.setClearAlpha(l)}},joe=class extends Jr{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new P1(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,i,r,s){const o=n.getContext(),a=n.state.buffers,l=this.scene,c=this.camera,h=this.clearPass,u=this.inverted?0:1,d=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.stencil.setFunc(o.ALWAYS,u,4294967295),a.stencil.setClear(d),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(n,null):(h.render(n,e),h.render(n,i))),this.renderToScreen?(n.setRenderTarget(null),n.render(l,c)):(n.setRenderTarget(e),n.render(l,c),n.setRenderTarget(i),n.render(l,c)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(o.EQUAL,1,4294967295),a.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.stencil.setLocked(!0)}},yP=class{constructor(n=null,{depthBuffer:e=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,i,s,r),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Hj,this.depthTexture=null,this.passes=[],this.timer=new Doe,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const e=this.inputBuffer,i=this.multisampling;i>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const e=n.getSize(new J),i=n.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===cn&&n.outputColorSpace===gt&&(this.inputBuffer.texture.colorSpace=gt,this.outputBuffer.texture.colorSpace=gt,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(e.width,e.height);for(const s of this.passes)s.initialize(n,i,r)}}replaceRenderer(n,e=!0){const i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(n),e&&r!==null&&(r.removeChild(i.domElement),r.appendChild(n.domElement)),i}createDepthTexture(){const n=this.depthTexture=new tg;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=yu,n.type=eh):n.type=_s,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,e,i,r){const s=this.renderer,o=s===null?new J:s.getDrawingBufferSize(new J),a={minFilter:Dt,magFilter:Dt,stencilBuffer:e,depthBuffer:n,type:i},l=new qt(o.width,o.height,a);return r>0&&(l.ignoreDepthForMultisampleCopy=!1,l.samples=r),i===cn&&s!==null&&s.outputColorSpace===gt&&(l.texture.colorSpace=gt),l.texture.name="EffectComposer.Buffer",l.texture.generateMipmaps=!1,l}setMainScene(n){for(const e of this.passes)e.mainScene=n}setMainCamera(n){for(const e of this.passes)e.mainCamera=n}addPass(n,e){const i=this.passes,r=this.renderer,s=r.getDrawingBufferSize(new J),o=r.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(n.setRenderer(r),n.setSize(s.width,s.height),n.initialize(r,o,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?i.splice(e,0,n):i.push(n),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const l=this.createDepthTexture();for(n of i)n.setDepthTexture(l)}else n.setDepthTexture(this.depthTexture)}removePass(n){const e=this.passes,i=e.indexOf(n);if(i!==-1&&e.splice(i,1).length>0){if(this.depthTexture!==null){const r=(s,o)=>s||o.needsDepthTexture;e.reduce(r,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===e.length&&(n.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const e=this.renderer,i=this.copyPass;let r=this.inputBuffer,s=this.outputBuffer,o=!1,a,l,c;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const h of this.passes)h.enabled&&(h.render(e,r,s,n,o),h.needsSwap&&(o&&(i.renderToScreen=h.renderToScreen,a=e.getContext(),l=e.state.buffers.stencil,l.setFunc(a.NOTEQUAL,1,4294967295),i.render(e,r,s,n,o),l.setFunc(a.EQUAL,1,4294967295)),c=r,r=s,s=c),h instanceof joe?o=!0:h instanceof Foe&&(o=!1))}setSize(n,e,i){const r=this.renderer,s=r.getSize(new J);(n===void 0||e===void 0)&&(n=s.width,e=s.height),(s.width!==n||s.height!==e)&&r.setSize(n,e,i);const o=r.getDrawingBufferSize(new J);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Xo={NONE:0,DEPTH:1,CONVOLUTION:2},bi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Goe=class{constructor(){this.shaderParts=new Map([[bi.FRAGMENT_HEAD,null],[bi.FRAGMENT_MAIN_UV,null],[bi.FRAGMENT_MAIN_IMAGE,null],[bi.VERTEX_HEAD,null],[bi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Xo.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Ii}},AP=!1,Qj=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let i;if(e.material.flatShading)switch(e.material.side){case yi:i=this.materialsFlatShadedDoubleSide;break;case an:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(e.material.side){case yi:i=this.materialsDoubleSide;break;case an:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=i[2]:e.isInstancedMesh?e.material=i[1]:e.material=i[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof Bt))return n.clone();const e=n.uniforms,i=new Map;for(const s in e){const o=e[s].value;o.isRenderTargetTexture&&(e[s].value=null,i.set(s,o))}const r=n.clone();for(const s of i)e[s[0]].value=s[1],r.uniforms[s[0]].value=s[1];return r}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const i of e)i.uniforms=Object.assign({},n.uniforms),i.side=Fn;e[2].skinning=!0,this.materialsBackSide=e.map(i=>{const r=this.cloneMaterial(i);return r.uniforms=Object.assign({},n.uniforms),r.side=an,r}),this.materialsDoubleSide=e.map(i=>{const r=this.cloneMaterial(i);return r.uniforms=Object.assign({},n.uniforms),r.side=yi,r}),this.materialsFlatShaded=e.map(i=>{const r=this.cloneMaterial(i);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(i=>{const r=this.cloneMaterial(i);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=an,r}),this.materialsFlatShadedDoubleSide=e.map(i=>{const r=this.cloneMaterial(i);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=yi,r})}}render(n,e,i){const r=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,AP){const s=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,i);for(const o of s)o[0].material=o[1];this.meshCount!==s.size&&s.clear()}else{const s=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,i),e.overrideMaterial=s}n.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return AP}static set workaroundEnabled(n){AP=n}},Nu=-1,Ei=class extends wr{constructor(n,e=Nu,i=Nu,r=1){super(),this.resizable=n,this.baseSize=new J(1,1),this.preferredSize=new J(e,i),this.target=this.preferredSize,this.s=r,this.effectiveSize=new J,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,i=this.effectiveSize,r=this.scale;e.width!==Nu?i.width=e.width:e.height!==Nu?i.width=Math.round(e.height*(n.width/Math.max(n.height,1))):i.width=Math.round(n.width*r),e.height!==Nu?i.height=e.height:e.width!==Nu?i.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):i.height=Math.round(n.height*r)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Nu),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Nu}},Hoe=class extends Set{constructor(n,e=10){super(),this.l=e,this.exclusive=!1,n!==void 0&&this.set(n)}get layer(){return this.l}set layer(n){const e=this.l;for(const i of this)i.layers.disable(e),i.layers.enable(n);this.l=n}getLayer(){return this.layer}setLayer(n){this.layer=n}isExclusive(){return this.exclusive}setExclusive(n){this.exclusive=n}clear(){const n=this.layer;for(const e of this)e.layers.disable(n);return super.clear()}set(n){this.clear();for(const e of n)this.add(e);return this}indexOf(n){return this.has(n)?0:-1}add(n){return this.exclusive?n.layers.set(this.layer):n.layers.enable(this.layer),super.add(n)}delete(n){return this.has(n)&&n.layers.disable(this.layer),super.delete(n)}toggle(n){let e;return this.has(n)?(this.delete(n),e=!1):(this.add(n),e=!0),e}setVisible(n){for(const e of this)n?e.layers.enable(0):e.layers.disable(0);return this}},Vt={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Voe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Qoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",Woe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Xoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",qoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Yoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Joe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",Koe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Zoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",$oe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",eae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",tae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",iae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",nae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",rae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",sae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",oae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",aae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",lae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",cae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",hae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",uae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",dae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",pae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",fae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",mae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",gae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",vae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",yae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",Aae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",bae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",xae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",_ae=new Map([[Vt.ADD,Voe],[Vt.ALPHA,Qoe],[Vt.AVERAGE,Woe],[Vt.COLOR,Xoe],[Vt.COLOR_BURN,qoe],[Vt.COLOR_DODGE,Yoe],[Vt.DARKEN,Joe],[Vt.DIFFERENCE,Koe],[Vt.DIVIDE,Zoe],[Vt.DST,null],[Vt.EXCLUSION,$oe],[Vt.HARD_LIGHT,eae],[Vt.HARD_MIX,tae],[Vt.HUE,iae],[Vt.INVERT,nae],[Vt.INVERT_RGB,rae],[Vt.LIGHTEN,sae],[Vt.LINEAR_BURN,oae],[Vt.LINEAR_DODGE,aae],[Vt.LINEAR_LIGHT,lae],[Vt.LUMINOSITY,cae],[Vt.MULTIPLY,hae],[Vt.NEGATION,uae],[Vt.NORMAL,dae],[Vt.OVERLAY,pae],[Vt.PIN_LIGHT,fae],[Vt.REFLECT,mae],[Vt.SATURATION,gae],[Vt.SCREEN,vae],[Vt.SOFT_LIGHT,yae],[Vt.SRC,Aae],[Vt.SUBTRACT,bae],[Vt.VIVID_LIGHT,xae]]),wae=class extends wr{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new Se(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return _ae.get(this.blendFunction)}},rc={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Sae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Cae="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Eae=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Wj=class extends Bt{constructor(n=new qe){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Se(null),texelSize:new Se(new qe),scale:new Se(1),kernel:new Se(0)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Sae,vertexShader:Cae}),this.fragmentShader=_g(this.fragmentShader),this.setTexelSize(n.x,n.y),this.kernelSize=rc.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return Eae[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const i=1/n,r=1/e;this.uniforms.texelSize.value.set(i,r,i*.5,r*.5)}},bP=class extends Jr{constructor({kernelSize:n=rc.MEDIUM,resolutionScale:e=.5,width:i=Ei.AUTO_SIZE,height:r=Ei.AUTO_SIZE,resolutionX:s=i,resolutionY:o=r}={}){super("KawaseBlurPass"),this.renderTargetA=new qt(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new Ei(this,s,o,e);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new Wj,this._blurMaterial.kernelSize=n,this.copyMaterial=new Gj}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,i,r,s){const o=this.scene,a=this.camera,l=this.renderTargetA,c=this.renderTargetB,h=this.blurMaterial,u=h.kernelSequence;let d=e;this.fullscreenMaterial=h;for(let f=0,m=u.length;f<m;++f){const g=f&1?c:l;h.kernel=u[f],h.inputBuffer=d.texture,n.setRenderTarget(g),n.render(o,a),d=g}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=d.texture,n.setRenderTarget(this.renderToScreen?null:i),n.render(o,a)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e);const r=i.width,s=i.height;this.renderTargetA.setSize(r,s),this.renderTargetB.setSize(r,s),this.blurMaterial.setSize(n,e)}initialize(n,e,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==cn?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===gt&&(this.renderTargetA.texture.colorSpace=gt,this.renderTargetB.texture.colorSpace=gt))}static get AUTO_SIZE(){return Ei.AUTO_SIZE}},Mae=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,Tae=class extends Bt{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Kc.replace(/\D+/g,"")},uniforms:{inputBuffer:new Se(null),threshold:new Se(0),smoothing:new Se(1),range:new Se(null)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Mae,vertexShader:tf}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},Xj=class extends Jr{constructor({renderTarget:n,luminanceRange:e,colorOutput:i,resolutionScale:r=1,width:s=Ei.AUTO_SIZE,height:o=Ei.AUTO_SIZE,resolutionX:a=s,resolutionY:l=o}={}){super("LuminancePass"),this.fullscreenMaterial=new Tae(i,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new Ei(this,a,l,r);c.addEventListener("change",h=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,i,r,s){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height)}initialize(n,e,i){i!==void 0&&i!==cn&&(this.renderTarget.texture.type=i,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Iae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Rae="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Pae=class extends Bt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Se(null),texelSize:new Se(new J)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Iae,vertexShader:Rae}),this.fragmentShader=_g(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Bae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,kae="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Oae=class extends Bt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Se(null),supportBuffer:new Se(null),texelSize:new Se(new J),radius:new Se(.85)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Bae,vertexShader:kae}),this.fragmentShader=_g(this.fragmentShader)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Dae=class extends Jr{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Pae,this.upsamplingMaterial=new Oae,this.resolution=new J}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let i=0;i<n;++i){const r=e.clone();r.texture.name="Downsampling.Mipmap"+i,this.downsamplingMipmaps.push(r)}this.upsamplingMipmaps.push(e);for(let i=1,r=n-1;i<r;++i){const s=e.clone();s.texture.name="Upsampling.Mipmap"+i,this.upsamplingMipmaps.push(s)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,i,r,s){const{scene:o,camera:a}=this,{downsamplingMaterial:l,upsamplingMaterial:c}=this,{downsamplingMipmaps:h,upsamplingMipmaps:u}=this;let d=e;this.fullscreenMaterial=l;for(let f=0,m=h.length;f<m;++f){const g=h[f];l.setSize(d.width,d.height),l.inputBuffer=d.texture,n.setRenderTarget(g),n.render(o,a),d=g}this.fullscreenMaterial=c;for(let f=u.length-1;f>=0;--f){const m=u[f];c.setSize(d.width,d.height),c.inputBuffer=d.texture,c.supportBuffer=h[f].texture,n.setRenderTarget(m),n.render(o,a),d=m}}setSize(n,e){const i=this.resolution;i.set(n,e);let r=i.width,s=i.height;for(let o=0,a=this.downsamplingMipmaps.length;o<a;++o)r=Math.round(r*.5),s=Math.round(s*.5),this.downsamplingMipmaps[o].setSize(r,s),o<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[o].setSize(r,s)}initialize(n,e,i){if(i!==void 0){const r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const s of r)s.texture.type=i;if(i!==cn)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===gt)for(const s of r)s.texture.colorSpace=gt}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},to=class extends wr{constructor(n,e,{attributes:i=Xo.NONE,blendFunction:r=Vt.NORMAL,defines:s=new Map,uniforms:o=new Map,extensions:a=null,vertexShader:l=null}={}){super(),this.name=n,this.renderer=null,this.attributes=i,this.fragmentShader=e,this.vertexShader=l,this.defines=s,this.uniforms=o,this.extensions=a,this.blendMode=new wae(r),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=Ii,this._outputColorSpace=xo}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=Wr){}update(n,e,i){}setSize(n,e){}initialize(n,e,i){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof qt||e instanceof Ut||e instanceof Gt||e instanceof Jr)&&this[n].dispose()}}},Lae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,xP=class extends to{constructor({blendFunction:n=Vt.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:i=.025,mipmapBlur:r=!1,intensity:s=1,radius:o=.85,levels:a=8,kernelSize:l=rc.LARGE,resolutionScale:c=.5,width:h=Ei.AUTO_SIZE,height:u=Ei.AUTO_SIZE,resolutionX:d=h,resolutionY:f=u}={}){super("BloomEffect",Lae,{blendFunction:n,uniforms:new Map([["map",new Se(null)],["intensity",new Se(s)]])}),this.renderTarget=new qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new bP({kernelSize:l}),this.luminancePass=new Xj({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=i,this.mipmapBlurPass=new Dae,this.mipmapBlurPass.enabled=r,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=r?this.mipmapBlurPass.texture:this.renderTarget.texture;const m=this.resolution=new Ei(this,d,f,c);m.addEventListener("change",g=>this.setSize(m.baseWidth,m.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,i){const r=this.renderTarget,s=this.luminancePass;s.enabled?(s.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,s.renderTarget):this.blurPass.render(n,s.renderTarget,r)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,r)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,i){this.blurPass.initialize(n,e,i),this.luminancePass.initialize(n,e,i),this.mipmapBlurPass.initialize(n,e,i),i!==void 0&&(this.renderTarget.texture.type=i,n!==null&&n.outputColorSpace===gt&&(this.renderTarget.texture.colorSpace=gt))}},Uae="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",qj=class extends to{constructor({blendFunction:n=Vt.SRC,brightness:e=0,contrast:i=0}={}){super("BrightnessContrastEffect",Uae,{blendFunction:n,uniforms:new Map([["brightness",new Se(e)],["contrast",new Se(i)]])}),this.inputColorSpace=gt}get brightness(){return this.uniforms.get("brightness").value}set brightness(n){this.uniforms.get("brightness").value=n}getBrightness(){return this.brightness}setBrightness(n){this.brightness=n}get contrast(){return this.uniforms.get("contrast").value}set contrast(n){this.uniforms.get("contrast").value=n}getContrast(){return this.contrast}setContrast(n){this.contrast=n}},Fae=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,Nae="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",Yj=class extends to{constructor({offset:n=new J(.001,5e-4),radialModulation:e=!1,modulationOffset:i=.15}={}){super("ChromaticAberrationEffect",Fae,{vertexShader:Nae,attributes:Xo.CONVOLUTION,uniforms:new Map([["offset",new Se(n)],["modulationOffset",new Se(i)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(n){n?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(n){this.uniforms.get("modulationOffset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}},Jj={RED:0,GREEN:1,BLUE:2,ALPHA:3},Kj={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},zae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,B1=class extends Bt{constructor(n=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:n?"2":"1"},uniforms:{inputBuffer:new Se(null),cocBuffer:new Se(null),texelSize:new Se(new J),kernel64:new Se(null),kernel16:new Se(null),scale:new Se(1)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zae,vertexShader:tf}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set cocBuffer(n){this.uniforms.cocBuffer.value=n}setCoCBuffer(n){this.uniforms.cocBuffer.value=n}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(n){return this.scale}setScale(n){this.scale=n}generateKernel(){const n=2.39996323,e=new Float64Array(128),i=new Float64Array(32);let r=0,s=0;for(let o=0,a=Math.sqrt(80);o<80;++o){const l=o*n,c=Math.sqrt(o)/a,h=c*Math.cos(l),u=c*Math.sin(l);o%5===0?(i[s++]=h,i[s++]=u):(e[r++]=h,e[r++]=u)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=i}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}};function wg(n,e,i){return n*(e-i)-e}function nf(n,e,i){return Math.min(Math.max((n+e)/(e-i),0),1)}var jae=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Gae=class extends Bt{constructor(n){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Se(null),focusDistance:new Se(0),focusRange:new Se(0),cameraNear:new Se(.3),cameraFar:new Se(1e3)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:jae,vertexShader:tf}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(n)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Wr){this.depthBuffer=n,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(n){this.uniforms.focusDistance.value=n}get worldFocusDistance(){return-wg(this.focusDistance,this.near,this.far)}set worldFocusDistance(n){this.focusDistance=nf(-n,this.near,this.far)}getFocusDistance(n){this.uniforms.focusDistance.value=n}setFocusDistance(n){this.uniforms.focusDistance.value=n}get focalLength(){return this.focusRange}set focalLength(n){this.focusRange=n}get focusRange(){return this.uniforms.focusRange.value}set focusRange(n){this.uniforms.focusRange.value=n}get worldFocusRange(){return-wg(this.focusRange,this.near,this.far)}set worldFocusRange(n){this.focusRange=nf(-n,this.near,this.far)}getFocalLength(n){return this.focusRange}setFocalLength(n){this.focusRange=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Ft?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Hae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,Vae=class extends Bt{constructor(n=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Se(n),inputBuffer:new Se(null),strength:new Se(1)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Hae,vertexShader:tf}),this.colorChannel=Jj.RED,this.maskFunction=Kj.DISCARD}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set maskTexture(n){this.uniforms.maskTexture.value=n,delete this.defines.MASK_PRECISION_HIGH,n.type!==cn&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(n){this.maskTexture=n}set colorChannel(n){this.defines.COLOR_CHANNEL=n.toFixed(0),this.needsUpdate=!0}setColorChannel(n){this.colorChannel=n}set maskFunction(n){this.defines.MASK_FUNCTION=n.toFixed(0),this.needsUpdate=!0}setMaskFunction(n){this.maskFunction=n}get inverted(){return this.defines.INVERTED!==void 0}set inverted(n){this.inverted&&!n?delete this.defines.INVERTED:n&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get strength(){return this.uniforms.strength.value}set strength(n){this.uniforms.strength.value=n}getStrength(){return this.strength}setStrength(n){this.strength=n}},sc=class extends Jr{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,i,r,s){const o=this.fullscreenMaterial.uniforms;e!==null&&o!==void 0&&o[this.input]!==void 0&&(o[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:i),n.render(this.scene,this.camera)}initialize(n,e,i){i!==void 0&&i!==cn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Qae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,Zj=class extends to{constructor(n,{blendFunction:e,worldFocusDistance:i,worldFocusRange:r,focusDistance:s=0,focalLength:o=.1,focusRange:a=o,bokehScale:l=1,resolutionScale:c=1,width:h=Ei.AUTO_SIZE,height:u=Ei.AUTO_SIZE,resolutionX:d=h,resolutionY:f=u}={}){super("DepthOfFieldEffect",Qae,{blendFunction:e,attributes:Xo.DEPTH,uniforms:new Map([["nearColorBuffer",new Se(null)],["farColorBuffer",new Se(null)],["nearCoCBuffer",new Se(null)],["farCoCBuffer",new Se(null)],["scale",new Se(1)]])}),this.camera=n,this.renderTarget=new qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new sc(new Gae(n));const m=this.cocMaterial;m.focusDistance=s,m.focusRange=a,i!==void 0&&(m.worldFocusDistance=i),r!==void 0&&(m.worldFocusRange=r),this.blurPass=new bP({resolutionScale:c,resolutionX:d,resolutionY:f,kernelSize:rc.MEDIUM}),this.maskPass=new sc(new Vae(this.renderTargetCoC.texture));const g=this.maskPass.fullscreenMaterial;g.colorChannel=Jj.GREEN,this.maskFunction=Kj.MULTIPLY_RGB,this.bokehNearBasePass=new sc(new B1(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new sc(new B1(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new sc(new B1(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new sc(new B1(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const v=this.resolution=new Ei(this,d,f,c);v.addEventListener("change",y=>this.setSize(v.baseWidth,v.baseHeight)),this.bokehScale=l}set mainCamera(n){this.camera=n,this.cocMaterial.copyCameraSettings(n)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(n){this.maskFunction!==n&&(this.defines.set("MASK_FUNCTION",n.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=n,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(n){this.bokehNearBasePass.fullscreenMaterial.scale=n,this.bokehNearFillPass.fullscreenMaterial.scale=n,this.bokehFarBasePass.fullscreenMaterial.scale=n,this.bokehFarFillPass.fullscreenMaterial.scale=n,this.maskPass.fullscreenMaterial.strength=n,this.uniforms.get("scale").value=n}getBokehScale(){return this.bokehScale}setBokehScale(n){this.bokehScale=n}getTarget(){return this.target}setTarget(n){this.target=n}calculateFocusDistance(n){const e=this.camera,i=e.position.distanceTo(n);return nf(-i,e.near,e.far)}setDepthTexture(n,e=Wr){this.cocMaterial.depthBuffer=n,this.cocMaterial.depthPacking=e}update(n,e,i){const r=this.renderTarget,s=this.renderTargetCoC,o=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){const l=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=l}this.cocPass.render(n,null,s),this.blurPass.render(n,s,o),this.maskPass.render(n,e,a),this.bokehFarBasePass.render(n,a,r),this.bokehFarFillPass.render(n,r,this.renderTargetFar),this.bokehNearBasePass.render(n,e,r),this.bokehNearFillPass.render(n,r,this.renderTargetNear)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e);const r=i.width,s=i.height;this.cocPass.setSize(n,e),this.blurPass.setSize(n,e),this.maskPass.setSize(n,e),this.renderTargetFar.setSize(n,e),this.renderTargetCoC.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.renderTarget.setSize(r,s),this.renderTargetNear.setSize(r,s),this.renderTargetCoCBlurred.setSize(r,s),this.bokehNearBasePass.fullscreenMaterial.setSize(n,e),this.bokehNearFillPass.fullscreenMaterial.setSize(n,e),this.bokehFarBasePass.fullscreenMaterial.setSize(n,e),this.bokehFarFillPass.fullscreenMaterial.setSize(n,e)}initialize(n,e,i){this.cocPass.initialize(n,e,i),this.maskPass.initialize(n,e,i),this.bokehNearBasePass.initialize(n,e,i),this.bokehNearFillPass.initialize(n,e,i),this.bokehFarBasePass.initialize(n,e,i),this.bokehFarFillPass.initialize(n,e,i),this.blurPass.initialize(n,e,cn),n.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,n!==null&&n.outputColorSpace===gt&&(this.renderTarget.texture.colorSpace=gt,this.renderTargetNear.texture.colorSpace=gt,this.renderTargetFar.texture.colorSpace=gt,this.renderTargetMasked.texture.colorSpace=gt))}};function Wae(n,e,i){const r=new Map([[M_,1],[xp,1],[I_,2],[Ti,4]]);let s;if(r.has(e)||console.error("Invalid noise texture format"),i===cn){s=new Uint8Array(n*r.get(e));for(let o=0,a=s.length;o<a;++o)s[o]=Math.random()*255+.5}else{s=new Float32Array(n*r.get(e));for(let o=0,a=s.length;o<a;++o)s[o]=Math.random()}return s}var Xae=class extends Ms{constructor(n,e,i=M_,r=cn){super(Wae(n*e,i,r),n,e,i,r),this.needsUpdate=!0}},Jy={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},qae=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,Yae=class extends Bt{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:Jy.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new Se(null),depthBuffer0:new Se(null),depthBuffer1:new Se(null),cameraNearFar:new Se(new J(1,1))},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:qae,vertexShader:tf}),this.depthMode=Xv}set depthBuffer0(n){this.uniforms.depthBuffer0.value=n}set depthPacking0(n){this.defines.DEPTH_PACKING_0=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(n,e=Wr){this.depthBuffer0=n,this.depthPacking0=e}set depthBuffer1(n){this.uniforms.depthBuffer1.value=n}set depthPacking1(n){this.defines.DEPTH_PACKING_1=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(n,e=Wr){this.depthBuffer1=n,this.depthPacking1=e}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(n){this.defines.DEPTH_TEST_STRATEGY=n.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(n){this.maxDepthStrategy=n?Jy.KEEP_MAX_DEPTH:Jy.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(n){this.maxDepthStrategy=n}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(n){this.defines.DEPTH_EPSILON=n.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(n){this.epsilon=n}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(n){let e;switch(n){case YT:e="false";break;case __:e="true";break;case Mm:e="abs(d1 - d0) <= DEPTH_EPSILON";break;case qv:e="abs(d1 - d0) > DEPTH_EPSILON";break;case Xv:e="d0 > d1";break;case gp:e="d0 >= d1";break;case w_:e="d0 <= d1";break;case S_:default:e="d0 < d1";break}this.defines.DEPTH_MODE=n.toFixed(0),this.defines["depthTest(d0, d1)"]=e,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(n){this.depthMode=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),n instanceof Ft?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},k1=class extends Jr{constructor(n,e,i=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new P1,this.overrideMaterialManager=i===null?null:new Qj(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new Qj(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,i,r,s){const o=this.scene,a=this.camera,l=this.selection,c=a.layers.mask,h=o.background,u=n.shadowMap.autoUpdate,d=this.renderToScreen?null:e;l!==null&&a.layers.set(l.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(d),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,o,a):n.render(o,a),a.layers.mask=c,o.background=h,n.shadowMap.autoUpdate=u}},Jae="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",$j=class extends to{constructor({blendFunction:n=Vt.SRC,hue:e=0,saturation:i=0}={}){super("HueSaturationEffect",Jae,{blendFunction:n,uniforms:new Map([["hue",new Se(new S)],["saturation",new Se(i)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(n){this.uniforms.get("saturation").value=n}getSaturation(){return this.saturation}setSaturation(n){this.saturation=n}get hue(){const n=this.uniforms.get("hue").value;return Math.acos((n.x*3-1)/2)}set hue(n){const e=Math.sin(n),i=Math.cos(n);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3)}getHue(){return this.hue}setHue(n){this.hue=n}},_P={DEPTH:0,LUMA:1,COLOR:2},Kae={DISABLED:0,DEPTH:1,CUSTOM:2},rf={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Mr={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},Ky={DEFAULT:0,ESKIL:1},Zae=class extends Jr{constructor(n,e,{renderTarget:i,resolutionScale:r=1,width:s=Ei.AUTO_SIZE,height:o=Ei.AUTO_SIZE,resolutionX:a=s,resolutionY:l=o}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new k1(n,e,new vy({depthPacking:F_}));const c=this.renderPass;c.skipShadowMapUpdate=!0,c.ignoreBackground=!0;const h=c.clearPass;h.overrideClearColor=new be(16777215),h.overrideClearAlpha=1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new qt(1,1,{minFilter:Rt,magFilter:Rt}),this.renderTarget.texture.name="DepthPass.Target");const u=this.resolution=new Ei(this,a,l,r);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,i,r,s){const o=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,o)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height)}},$ae="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",e5=class extends to{constructor(n=30){super("PixelationEffect",$ae,{uniforms:new Map([["active",new Se(!1)],["d",new Se(new qe)]])}),this.resolution=new J,this._granularity=0,this.granularity=n}get granularity(){return this._granularity}set granularity(n){let e=Math.floor(n);e%2>0&&(e+=1),this._granularity=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(n){this.granularity=n}setSize(n,e){const i=this.resolution;i.set(n,e);const r=this.granularity,s=r/i.x,o=r/i.y;this.uniforms.get("d").value.set(s,o,1/s,1/o)}},t5=class extends xP{constructor(n,e,i){super(i),this.setAttributes(this.getAttributes()|Xo.DEPTH),this.camera=e,this.depthPass=new Zae(n,e),this.clearPass=new P1(!0,!1,!1),this.clearPass.overrideClearColor=new be(0),this.depthMaskPass=new sc(new Yae);const r=this.depthMaskMaterial;r.copyCameraSettings(e),r.depthBuffer1=this.depthPass.texture,r.depthPacking1=F_,r.depthMode=Mm,this.renderTargetMasked=new qt(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new Hoe,this.selection.layer=11,this._inverted=!1,this._ignoreBackground=!1}set mainScene(n){this.depthPass.mainScene=n}set mainCamera(n){this.camera=n,this.depthPass.mainCamera=n,this.depthMaskMaterial.copyCameraSettings(n)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(n){this._inverted=n,this.depthMaskMaterial.depthMode=n?qv:Mm}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(n){this._ignoreBackground=n,this.depthMaskMaterial.maxDepthStrategy=n?Jy.DISCARD_MAX_DEPTH:Jy.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}setDepthTexture(n,e=Wr){this.depthMaskMaterial.depthBuffer0=n,this.depthMaskMaterial.depthPacking0=e}update(n,e,i){const r=this.camera,s=this.selection,o=this.inverted;let a=e;if(this.ignoreBackground||!o||s.size>0){const l=r.layers.mask;r.layers.set(s.layer),this.depthPass.render(n),r.layers.mask=l,a=this.renderTargetMasked,this.clearPass.render(n,a),this.depthMaskPass.render(n,e,a)}super.update(n,a,i)}setSize(n,e){super.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.depthPass.setSize(n,e)}initialize(n,e,i){super.initialize(n,e,i),this.clearPass.initialize(n,e,i),this.depthPass.initialize(n,e,i),this.depthMaskPass.initialize(n,e,i),n!==null&&n.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),i!==void 0&&(this.renderTargetMasked.texture.type=i,n!==null&&n.outputColorSpace===gt&&(this.renderTargetMasked.texture.colorSpace=gt))}},ele=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,tle=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,ile=class extends Bt{constructor(n=new J,e=_P.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:Kc.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Se(null),depthBuffer:new Se(null),predicationBuffer:new Se(null),texelSize:new Se(n)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ele,vertexShader:tle}),this.edgeDetectionMode=e}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Wr){this.depthBuffer=n,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(n){this.defines.EDGE_DETECTION_MODE=n.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(n){this.edgeDetectionMode=n}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(n){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=n.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(n){this.localContrastAdaptationFactor=n}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(n){this.defines.EDGE_THRESHOLD=n.toFixed("6"),this.defines.DEPTH_THRESHOLD=(n*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(n){this.edgeDetectionThreshold=n}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(n){this.defines.PREDICATION_MODE=n.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(n){this.predicationMode=n}set predicationBuffer(n){this.uniforms.predicationBuffer.value=n}setPredicationBuffer(n){this.uniforms.predicationBuffer.value=n}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(n){this.defines.PREDICATION_THRESHOLD=n.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(n){this.predicationThreshold=n}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(n){this.defines.PREDICATION_SCALE=n.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(n){this.predicationScale=n}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(n){this.defines.PREDICATION_STRENGTH=n.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(n){this.predicationStrength=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},nle=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,rle="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",sle=class extends Bt{constructor(n=new J,e=new J){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Se(null),searchTexture:new Se(null),areaTexture:new Se(null),resolution:new Se(e),texelSize:new Se(n)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:nle,vertexShader:rle})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(n){this.uniforms.searchTexture.value=n}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(n){this.uniforms.areaTexture.value=n}setLookupTextures(n,e){this.searchTexture=n,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(n){const e=Math.min(Math.max(n,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(n){this.orthogonalSearchSteps=n}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(n){const e=Math.min(Math.max(n,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(n){this.diagonalSearchSteps=n}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(n){n?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(n){this.diagonalDetection=n}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(n){const e=Math.min(Math.max(n,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(n){this.cornerRounding=n}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(n){n?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(n){this.cornerDetection=n}setSize(n,e){const i=this.uniforms;i.texelSize.value.set(1/n,1/e),i.resolution.value.set(n,e)}},i5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",n5="data:image/png;base64,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",ole="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",ale="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",r5=class extends to{constructor({blendFunction:n=Vt.SRC,preset:e=rf.MEDIUM,edgeDetectionMode:i=_P.COLOR,predicationMode:r=Kae.DISABLED}={}){super("SMAAEffect",ole,{vertexShader:ale,blendFunction:n,attributes:Xo.CONVOLUTION|Xo.DEPTH,uniforms:new Map([["weightMap",new Se(null)]])});let s,o;arguments.length>1&&(s=arguments[0],o=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(i=arguments[3])),this.renderTargetEdges=new qt(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new P1(!0,!1,!1),this.clearPass.overrideClearColor=new be(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new sc(new ile),this.edgeDetectionMaterial.edgeDetectionMode=i,this.edgeDetectionMaterial.predicationMode=r,this.weightsPass=new sc(new sle);const a=new Gw;a.onLoad=()=>{const l=new Gt(s);l.name="SMAA.Search",l.magFilter=Rt,l.minFilter=Rt,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!0,this.weightsMaterial.searchTexture=l;const c=new Gt(o);c.name="SMAA.Area",c.magFilter=Dt,c.minFilter=Dt,c.generateMipmaps=!1,c.needsUpdate=!0,c.flipY=!1,this.weightsMaterial.areaTexture=c,this.dispatchEvent({type:"load"})},a.itemStart("search"),a.itemStart("area"),s!==void 0&&o!==void 0?(a.itemEnd("search"),a.itemEnd("area")):typeof Image<"u"&&(s=new Image,o=new Image,s.addEventListener("load",()=>a.itemEnd("search")),o.addEventListener("load",()=>a.itemEnd("area")),s.src=i5,o.src=n5),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(n){this.edgeDetectionMaterial.edgeDetectionThreshold=n}setOrthogonalSearchSteps(n){this.weightsMaterial.orthogonalSearchSteps=n}applyPreset(n){const e=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(n){case rf.LOW:e.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case rf.MEDIUM:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case rf.HIGH:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case rf.ULTRA:e.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(n,e=Wr){this.edgeDetectionMaterial.depthBuffer=n,this.edgeDetectionMaterial.depthPacking=e}update(n,e,i){this.clearPass.render(n,this.renderTargetEdges),this.edgeDetectionPass.render(n,e,this.renderTargetEdges),this.weightsPass.render(n,this.renderTargetEdges,this.renderTargetWeights)}setSize(n,e){this.edgeDetectionMaterial.setSize(n,e),this.weightsMaterial.setSize(n,e),this.renderTargetEdges.setSize(n,e),this.renderTargetWeights.setSize(n,e)}dispose(){const{searchTexture:n,areaTexture:e}=this.weightsMaterial;n!==null&&e!==null&&(n.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return i5}static get areaImageDataURL(){return n5}},lle=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,cle="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",hle=class extends Bt{constructor(n){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Se(null),normalBuffer:new Se(null),normalDepthBuffer:new Se(null),noiseTexture:new Se(null),inverseProjectionMatrix:new Se(new he),projectionMatrix:new Se(new he),texelSize:new Se(new J),cameraNearFar:new Se(new J),distanceCutoff:new Se(new J),proximityCutoff:new Se(new J),noiseScale:new Se(new J),minRadiusScale:new Se(.33),intensity:new Se(1),fade:new Se(.01),bias:new Se(0)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:lle,vertexShader:cle}),this.copyCameraSettings(n),this.resolution=new J,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(n){this.uniforms.normalDepthBuffer.value=n,n!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(n){this.normalDepthBuffer=n}set normalBuffer(n){this.uniforms.normalBuffer.value=n}setNormalBuffer(n){this.uniforms.normalBuffer.value=n}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Wr){this.depthBuffer=n,this.depthPacking=e}set noiseTexture(n){this.uniforms.noiseTexture.value=n}setNoiseTexture(n){this.uniforms.noiseTexture.value=n}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(n){this.defines.SAMPLES_INT=n.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/n).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(n){this.samples=n}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(n){this.defines.SPIRAL_TURNS=n.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(n){this.rings=n}get intensity(){return this.uniforms.intensity.value}set intensity(n){this.uniforms.intensity.value=n,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(n){this.uniforms.intensity.value=n}get fade(){return this.uniforms.fade.value}set fade(n){this.uniforms.fade.value=n}getFade(){return this.uniforms.fade.value}setFade(n){this.uniforms.fade.value=n}get bias(){return this.uniforms.bias.value}set bias(n){this.uniforms.bias.value=n}getBias(){return this.uniforms.bias.value}setBias(n){this.uniforms.bias.value=n}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(n){this.uniforms.minRadiusScale.value=n}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(n){this.uniforms.minRadiusScale.value=n}updateRadius(){const n=this.r*this.resolution.height;this.defines.RADIUS=n.toFixed(11),this.defines.RADIUS_SQ=(n*n).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(n){this.r=Math.min(Math.max(n,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(n){this.radius=n}get distanceScaling(){return!0}set distanceScaling(n){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(n){this.distanceScaling=n}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(n){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-wg(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(n){this.distanceThreshold=nf(-n,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(n){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+n,0),1)}get worldDistanceFalloff(){return-wg(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(n){this.distanceFalloff=nf(-n,this.near,this.far)}setDistanceCutoff(n,e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(n){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-wg(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(n){this.proximityThreshold=nf(-n,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(n){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+n,0),1)}get worldProximityFalloff(){return-wg(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(n){this.proximityFalloff=nf(-n,this.near,this.far)}setProximityCutoff(n,e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(n,0),1),Math.min(Math.max(n+e,0),1))}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNearFar.value.set(n.near,n.far),this.uniforms.projectionMatrix.value.copy(n.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(n.projectionMatrix).invert(),n instanceof Ft?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const i=this.uniforms,r=i.noiseTexture.value;r!==null&&i.noiseScale.value.set(n/r.image.width,e/r.image.height),i.texelSize.value.set(1/n,1/e),this.resolution.set(n,e),this.updateRadius()}},ule=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,dle="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",ple=class extends Bt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Se(null),normalBuffer:new Se(null),texelSize:new Se(new J)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ule,vertexShader:dle})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Wr){this.depthBuffer=n,this.depthPacking=e}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},wP=class extends Jr{constructor({normalBuffer:n=null,resolutionScale:e=.5,width:i=Ei.AUTO_SIZE,height:r=Ei.AUTO_SIZE,resolutionX:s=i,resolutionY:o=r}={}){super("DepthDownsamplingPass");const a=new ple;a.normalBuffer=n,this.fullscreenMaterial=a,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new qt(1,1,{minFilter:Rt,magFilter:Rt,depthBuffer:!1,type:Hi}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const l=this.resolution=new Ei(this,s,o,e);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,e=Wr){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e}render(n,e,i,r,s){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height),this.fullscreenMaterial.setSize(n,e)}initialize(n,e,i){const r=n.getContext();if(!(r.getExtension("EXT_color_buffer_float")||r.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},fle=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,s5=64,o5=class extends to{constructor(n,e,{blendFunction:i=Vt.MULTIPLY,samples:r=9,rings:s=7,normalDepthBuffer:o=null,depthAwareUpsampling:a=!0,worldDistanceThreshold:l,worldDistanceFalloff:c,worldProximityThreshold:h,worldProximityFalloff:u,distanceThreshold:d=.97,distanceFalloff:f=.03,rangeThreshold:m=5e-4,rangeFalloff:g=.001,minRadiusScale:v=.1,luminanceInfluence:y=.7,radius:A=.1825,intensity:b=1,bias:x=.025,fade:_=.01,color:w=null,resolutionScale:T=1,width:M=Ei.AUTO_SIZE,height:R=Ei.AUTO_SIZE,resolutionX:B=M,resolutionY:E=R}={}){super("SSAOEffect",fle,{blendFunction:i,attributes:Xo.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new Se(null)],["normalDepthBuffer",new Se(o)],["luminanceInfluence",new Se(y)],["color",new Se(null)],["intensity",new Se(b)],["scale",new Se(0)]])}),this.renderTarget=new qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const P=this.resolution=new Ei(this,B,E,T);P.addEventListener("change",L=>this.setSize(P.baseWidth,P.baseHeight)),this.camera=n,this.depthDownsamplingPass=new wP({normalBuffer:e,resolutionScale:T}),this.depthDownsamplingPass.enabled=o===null,this.ssaoPass=new sc(new hle(n));const O=new Xae(s5,s5,Ti);O.wrapS=O.wrapT=Ao;const N=this.ssaoMaterial;N.normalBuffer=e,N.noiseTexture=O,N.minRadiusScale=v,N.samples=r,N.radius=A,N.rings=s,N.fade=_,N.bias=x,N.distanceThreshold=d,N.distanceFalloff=f,N.proximityThreshold=m,N.proximityFalloff=g,l!==void 0&&(N.worldDistanceThreshold=l),c!==void 0&&(N.worldDistanceFalloff=c),h!==void 0&&(N.worldProximityThreshold=h),u!==void 0&&(N.worldProximityFalloff=u),o!==null&&(this.ssaoMaterial.normalDepthBuffer=o,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=a,this.color=w}set mainCamera(n){this.camera=n,this.ssaoMaterial.copyCameraSettings(n)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(n){this.ssaoMaterial.normalBuffer=n,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=n}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(n){this.ssaoMaterial.samples=n}get rings(){return this.ssaoMaterial.rings}set rings(n){this.ssaoMaterial.rings=n}get radius(){return this.ssaoMaterial.radius}set radius(n){this.ssaoMaterial.radius=n}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(n){this.depthAwareUpsampling!==n&&(n?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(n){this.depthAwareUpsampling=n}get distanceScaling(){return!0}set distanceScaling(n){}get color(){return this.uniforms.get("color").value}set color(n){const e=this.uniforms,i=this.defines;n!==null?i.has("COLORIZE")?e.get("color").value.set(n):(i.set("COLORIZE","1"),e.get("color").value=new be(n),this.setChanged()):i.has("COLORIZE")&&(i.delete("COLORIZE"),e.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(n){this.uniforms.get("luminanceInfluence").value=n}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getColor(){return this.color}setColor(n){this.color=n}setDistanceCutoff(n,e){this.ssaoMaterial.distanceThreshold=n,this.ssaoMaterial.distanceFalloff=e}setProximityCutoff(n,e){this.ssaoMaterial.proximityThreshold=n,this.ssaoMaterial.proximityFalloff=e}setDepthTexture(n,e=Wr){this.depthDownsamplingPass.setDepthTexture(n,e),this.ssaoMaterial.depthBuffer=n,this.ssaoMaterial.depthPacking=e}update(n,e,i){const r=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(n),this.ssaoPass.render(n,null,r)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e);const r=i.width,s=i.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(r,s),this.renderTarget.setSize(r,s),this.depthDownsamplingPass.resolution.scale=i.scale,this.depthDownsamplingPass.setSize(n,e)}initialize(n,e,i){try{let r=this.uniforms.get("normalDepthBuffer").value;r===null&&(this.depthDownsamplingPass.initialize(n,e,i),r=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=r,this.ssaoMaterial.normalDepthBuffer=r,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},mle=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,gle="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",vle=class extends Wj{constructor({kernelSize:n=rc.MEDIUM,offset:e=0,rotation:i=0,focusArea:r=.4,feather:s=.3}={}){super(),this.fragmentShader=mle,this.vertexShader=gle,this.kernelSize=n,this.fragmentShader=_g(this.fragmentShader),this.uniforms.aspect=new Se(1),this.uniforms.rotation=new Se(new J),this.uniforms.maskParams=new Se(new qe),this._offset=e,this._focusArea=r,this._feather=s,this.rotation=i,this.updateParams()}updateParams(){const n=this.uniforms.maskParams.value,e=Math.max(this.focusArea,0),i=Math.max(e-this.feather,0);n.set(this.offset-e,this.offset-i,this.offset+e,this.offset+i)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(n){this.uniforms.rotation.value.set(Math.cos(n),Math.sin(n))}get offset(){return this._offset}set offset(n){this._offset=n,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(n){this._focusArea=n,this.updateParams()}get feather(){return this._feather}set feather(n){this._feather=n,this.updateParams()}setSize(n,e){super.setSize(n,e),this.uniforms.aspect.value=n/e}},yle=class extends bP{constructor({offset:n=0,rotation:e=0,focusArea:i=.4,feather:r=.3,kernelSize:s=rc.MEDIUM,resolutionScale:o=.5,resolutionX:a=Ei.AUTO_SIZE,resolutionY:l=Ei.AUTO_SIZE}={}){super({kernelSize:s,resolutionScale:o,resolutionX:a,resolutionY:l}),this.blurMaterial=new vle({kernelSize:s,offset:n,rotation:e,focusArea:i,feather:r})}},Ale=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,ble="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",a5=class extends to{constructor({blendFunction:n,offset:e=0,rotation:i=0,focusArea:r=.4,feather:s=.3,kernelSize:o=rc.MEDIUM,resolutionScale:a=.5,resolutionX:l=Ei.AUTO_SIZE,resolutionY:c=Ei.AUTO_SIZE}={}){super("TiltShiftEffect",Ale,{vertexShader:ble,blendFunction:n,uniforms:new Map([["rotation",new Se(new J)],["maskParams",new Se(new J)],["map",new Se(null)]])}),this._offset=e,this._focusArea=r,this._feather=s,this.renderTarget=new qt(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new yle({kernelSize:o,resolutionScale:a,resolutionX:l,resolutionY:c,offset:e,rotation:i,focusArea:r,feather:s});const h=this.resolution=new Ei(this,l,c,a);h.addEventListener("change",u=>this.setSize(h.baseWidth,h.baseHeight)),this.rotation=i,this.updateParams()}updateParams(){const n=this.uniforms.get("maskParams").value,e=Math.max(this.focusArea-this.feather,0);n.set(this.offset-e,this.offset+e)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(n){this.uniforms.get("rotation").value.set(Math.cos(n),Math.sin(n)),this.blurPass.blurMaterial.rotation=n}get offset(){return this._offset}set offset(n){this._offset=n,this.blurPass.blurMaterial.offset=n,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(n){this._focusArea=n,this.blurPass.blurMaterial.focusArea=n,this.updateParams()}get feather(){return this._feather}set feather(n){this._feather=n,this.blurPass.blurMaterial.feather=n,this.updateParams()}get bias(){return 0}set bias(n){}update(n,e,i){this.blurPass.render(n,e,this.renderTarget)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(n,e,i){this.blurPass.initialize(n,e,i),i!==void 0&&(this.renderTarget.texture.type=i,n!==null&&n.outputColorSpace===gt&&(this.renderTarget.texture.colorSpace=gt))}},xle=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,_le=class extends Bt{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new Se(null),luminanceBuffer1:new Se(null),minLuminance:new Se(.01),deltaTime:new Se(0),tau:new Se(1)},extensions:{shaderTextureLOD:!0},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:xle,vertexShader:tf})}set luminanceBuffer0(n){this.uniforms.luminanceBuffer0.value=n}setLuminanceBuffer0(n){this.uniforms.luminanceBuffer0.value=n}set luminanceBuffer1(n){this.uniforms.luminanceBuffer1.value=n}setLuminanceBuffer1(n){this.uniforms.luminanceBuffer1.value=n}set mipLevel1x1(n){this.defines.MIP_LEVEL_1X1=n.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(n){this.mipLevel1x1=n}set deltaTime(n){this.uniforms.deltaTime.value=n}setDeltaTime(n){this.uniforms.deltaTime.value=n}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(n){this.uniforms.minLuminance.value=n}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(n){this.uniforms.minLuminance.value=n}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(n){this.uniforms.tau.value=n}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(n){this.uniforms.tau.value=n}},wle=class extends Jr{constructor(n,{minLuminance:e=.01,adaptationRate:i=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new _le,this.needsSwap=!1,this.renderTargetPrevious=new qt(1,1,{minFilter:Rt,magFilter:Rt,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const r=this.fullscreenMaterial;r.luminanceBuffer0=this.renderTargetPrevious.texture,r.luminanceBuffer1=n,r.minLuminance=e,r.adaptationRate=i,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new Hj(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(n){this.fullscreenMaterial.mipLevel1x1=n}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(n){this.fullscreenMaterial.adaptationRate=n}render(n,e,i,r,s){this.fullscreenMaterial.deltaTime=r,n.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),n.render(this.scene,this.camera),this.copyPass.render(n,this.renderTargetAdapted)}},Sle=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,O1=class extends to{constructor({blendFunction:n=Vt.SRC,adaptive:e=!1,mode:i=e?Mr.REINHARD2_ADAPTIVE:Mr.AGX,resolution:r=256,maxLuminance:s=4,whitePoint:o=s,middleGrey:a=.6,minLuminance:l=.01,averageLuminance:c=1,adaptationRate:h=1}={}){super("ToneMappingEffect",Sle,{blendFunction:n,uniforms:new Map([["luminanceBuffer",new Se(null)],["maxLuminance",new Se(s)],["whitePoint",new Se(o)],["middleGrey",new Se(a)],["averageLuminance",new Se(c)]])}),this.renderTargetLuminance=new qt(1,1,{minFilter:bo,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new Xj({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new wle(this.luminancePass.texture,{minLuminance:l,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=r,this.mode=i}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(n){if(this.mode!==n){switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",n.toFixed(0)),n){case Mr.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case Mr.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case Mr.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)","OptimizedCineonToneMapping(texel)");break;case Mr.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case Mr.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case Mr.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=n===Mr.REINHARD2_ADAPTIVE,this.setChanged()}}getMode(){return this.mode}setMode(n){this.mode=n}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(n){this.uniforms.get("whitePoint").value=n}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(n){this.uniforms.get("middleGrey").value=n}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(n){this.uniforms.get("averageLuminance").value=n}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(n){const e=Math.max(0,Math.ceil(Math.log2(n))),i=Math.pow(2,e);this.luminancePass.resolution.setPreferredSize(i,i),this.adaptiveLuminanceMaterial.mipLevel1x1=e}getResolution(){return this.resolution}setResolution(n){this.resolution=n}get adaptive(){return this.mode===Mr.REINHARD2_ADAPTIVE}set adaptive(n){this.mode=n?Mr.REINHARD2_ADAPTIVE:Mr.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(n){this.adaptiveLuminanceMaterial.adaptationRate=n}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(n){console.warn(this.name,"distinction was removed.")}update(n,e,i){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(n,e),this.adaptiveLuminancePass.render(n,null,null,i))}initialize(n,e,i){this.adaptiveLuminancePass.initialize(n,e,i)}},Cle=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,l5=class extends to{constructor({blendFunction:n,eskil:e=!1,technique:i=e?Ky.ESKIL:Ky.DEFAULT,offset:r=.5,darkness:s=.5}={}){super("VignetteEffect",Cle,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",i.toFixed(0)]]),uniforms:new Map([["offset",new Se(r)],["darkness",new Se(s)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Ky.ESKIL}set eskil(n){this.technique=n?Ky.ESKIL:Ky.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}},Ele=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Mle="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Tle=class extends Bt{constructor(n,e,i,r,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Kc.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Se(null),depthBuffer:new Se(null),resolution:new Se(new J),texelSize:new Se(new J),cameraNear:new Se(.3),cameraFar:new Se(1e3),aspect:new Se(1),time:new Se(0)},blending:ln,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),n&&this.setShaderParts(n),e&&this.setDefines(e),i&&this.setUniforms(i),this.copyCameraSettings(r)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Wr){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=Ele.replace(bi.FRAGMENT_HEAD,n.get(bi.FRAGMENT_HEAD)||"").replace(bi.FRAGMENT_MAIN_UV,n.get(bi.FRAGMENT_MAIN_UV)||"").replace(bi.FRAGMENT_MAIN_IMAGE,n.get(bi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Mle.replace(bi.VERTEX_HEAD,n.get(bi.VERTEX_HEAD)||"").replace(bi.VERTEX_MAIN_SUPPORT,n.get(bi.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=_g(this.fragmentShader),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Ft?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const i=this.uniforms;i.resolution.value.set(n,e),i.texelSize.value.set(1/n,1/e),i.aspect.value=n/e}static get Section(){return bi}};function c5(n,e,i){for(const r of e){const s="$1"+n+r.charAt(0).toUpperCase()+r.slice(1),o=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(o,s))}}function Ile(n,e,i){let r=e.getFragmentShader(),s=e.getVertexShader();const o=r!==void 0&&/mainImage/.test(r),a=r!==void 0&&/mainUv/.test(r);if(i.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(a&&i.attributes&Xo.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!o&&!a)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const l=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=i.shaderParts;let h=c.get(bi.FRAGMENT_HEAD)||"",u=c.get(bi.FRAGMENT_MAIN_UV)||"",d=c.get(bi.FRAGMENT_MAIN_IMAGE)||"",f=c.get(bi.VERTEX_HEAD)||"",m=c.get(bi.VERTEX_MAIN_SUPPORT)||"";const g=new Set,v=new Set;if(a&&(u+=`	${n}MainUv(UV);
`,i.uvTransformation=!0),s!==null&&/mainSupport/.test(s)){const b=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);m+=`	${n}MainSupport(`,m+=b?`vUv);
`:`);
`;for(const x of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const _ of x[1].split(/\s*,\s*/))i.varyings.add(_),g.add(_),v.add(_);for(const x of s.matchAll(l))v.add(x[1])}for(const b of r.matchAll(l))v.add(b[1]);for(const b of e.defines.keys())v.add(b.replace(/\([\w\s,]*\)/g,""));for(const b of e.uniforms.keys())v.add(b);v.delete("while"),v.delete("for"),v.delete("if"),e.uniforms.forEach((b,x)=>i.uniforms.set(n+x.charAt(0).toUpperCase()+x.slice(1),b)),e.defines.forEach((b,x)=>i.defines.set(n+x.charAt(0).toUpperCase()+x.slice(1),b));const y=new Map([["fragment",r],["vertex",s]]);c5(n,v,i.defines),c5(n,v,y),r=y.get("fragment"),s=y.get("vertex");const A=e.blendMode;if(i.blendModes.set(A.blendFunction,A),o){e.inputColorSpace!==null&&e.inputColorSpace!==i.colorSpace&&(d+=e.inputColorSpace===gt?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==xo?i.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(i.colorSpace=e.inputColorSpace);const b=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${n}MainImage(color0, UV, `,i.attributes&Xo.DEPTH&&b.test(r)&&(d+="depth, ",i.readDepth=!0),d+=`color1);
	`;const x=n+"BlendOpacity";i.uniforms.set(x,A.opacity),d+=`color0 = blend${A.blendFunction}(color0, color1, ${x});

	`,h+=`uniform float ${x};

`}if(h+=r+`
`,s!==null&&(f+=s+`
`),c.set(bi.FRAGMENT_HEAD,h),c.set(bi.FRAGMENT_MAIN_UV,u),c.set(bi.FRAGMENT_MAIN_IMAGE,d),c.set(bi.VERTEX_HEAD,f),c.set(bi.VERTEX_MAIN_SUPPORT,m),e.extensions!==null)for(const b of e.extensions)i.extensions.add(b)}}var h5=class extends Jr{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new Tle(null,null,null,n),this.listener=i=>this.handleEvent(i),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,i)=>i.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new Goe;let e=0;for(const a of this.effects)if(a.blendMode.blendFunction===Vt.DST)n.attributes|=a.getAttributes()&Xo.DEPTH;else{if(n.attributes&a.getAttributes()&Xo.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${a.name})`);Ile("e"+e++,a,n)}let i=n.shaderParts.get(bi.FRAGMENT_HEAD),r=n.shaderParts.get(bi.FRAGMENT_MAIN_IMAGE),s=n.shaderParts.get(bi.FRAGMENT_MAIN_UV);const o=/\bblend\b/g;for(const a of n.blendModes.values())i+=a.getShaderCode().replace(o,`blend${a.blendFunction}`)+`
`;n.attributes&Xo.DEPTH?(n.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===gt&&(r+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(s=`vec2 transformedUv = vUv;
`+s,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(bi.FRAGMENT_HEAD,i),n.shaderParts.set(bi.FRAGMENT_MAIN_IMAGE,r),n.shaderParts.set(bi.FRAGMENT_MAIN_UV,s);for(const[a,l]of n.shaderParts)l!==null&&n.shaderParts.set(a,l.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=Wr){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const i of this.effects)i.setDepthTexture(n,e)}render(n,e,i,r,s){for(const o of this.effects)o.update(n,e,r);if(!this.skipRendering||this.renderToScreen){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,o.time+=r*this.timeScale,n.setRenderTarget(this.renderToScreen?null:i),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const i of this.effects)i.setSize(n,e)}initialize(n,e,i){this.renderer=n;for(const r of this.effects)r.initialize(n,e,i);this.updateMaterial(),i!==void 0&&i!==cn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},u5=class extends Jr{constructor(n,e,{renderTarget:i,resolutionScale:r=1,width:s=Ei.AUTO_SIZE,height:o=Ei.AUTO_SIZE,resolutionX:a=s,resolutionY:l=o}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new k1(n,e,new zw);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const h=c.getClearPass();h.overrideClearColor=new be(7829503),h.overrideClearAlpha=1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new qt(1,1,{minFilter:Rt,magFilter:Rt}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new Ei(this,a,l,r);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,i,r,s){const o=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,o,o)}setSize(n,e){const i=this.resolution;i.setBaseSize(n,e),this.renderTarget.setSize(i.width,i.height)}},Zy=function(){var n=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),r(++n%e.children.length)},!1);function i(u){return e.appendChild(u.dom),u}function r(u){for(var d=0;d<e.children.length;d++)e.children[d].style.display=d===u?"block":"none";n=u}var s=(performance||Date).now(),o=s,a=0,l=i(new Zy.Panel("FPS","#0ff","#002")),c=i(new Zy.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=i(new Zy.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:i,showPanel:r,begin:function(){s=(performance||Date).now()},end:function(){a++;var u=(performance||Date).now();if(c.update(u-s,200),u>=o+1e3&&(l.update(a*1e3/(u-o),100),o=u,a=0,h)){var d=performance.memory;h.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return u},update:function(){s=this.end()},domElement:e,setMode:r}};Zy.Panel=function(n,e,i){var r=1/0,s=0,o=Math.round,a=o(window.devicePixelRatio||1),l=80*a,c=48*a,h=3*a,u=2*a,d=3*a,f=15*a,m=74*a,g=30*a,v=document.createElement("canvas");v.width=l,v.height=c,v.style.cssText="width:80px;height:48px";var y=v.getContext("2d");return y.font="bold "+9*a+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=i,y.fillRect(0,0,l,c),y.fillStyle=e,y.fillText(n,h,u),y.fillRect(d,f,m,g),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(d,f,m,g),{dom:v,update:function(A,b){r=Math.min(r,A),s=Math.max(s,A),y.fillStyle=i,y.globalAlpha=1,y.fillRect(0,0,l,f),y.fillStyle=e,y.fillText(o(A)+" "+n+" ("+o(r)+"-"+o(s)+")",h,u),y.drawImage(v,d+a,f,m-a,g,d,f,m-a,g),y.fillRect(d+m-a,f,a,g),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(d+m-a,f,a,o((1-A/b)*g))}}};const Rle=Zy,Ple=te("debugpatch");function D1(n,e,i,r){const s=Ple===e;if(!i&&!r)return;const o=e+"___needle";kle(n,e,i,r);const a=Object.getOwnPropertyDescriptor(n,e),l=n[e];s&&console.log("Patch",n.constructor.name,e,a,l),a?(s&&console.log("Apply patch with existing descriptor",n.constructor.name,e,a),typeof a.value=="function"&&(n[e]=p5(a.value,n,e))):(s&&console.log("Create patch with new property",n.constructor.name,e,a),Object.defineProperty(n,e,{set:function(c){if(typeof c=="function")this[o]=p5(c,n,e);else{const h=this[o];f5(n,e,this,h,c),this[o]=c,m5(n,e,this,h,c)}},get:function(){const c=this[o];return typeof c=="function"&&c[o]?c[o]:c}}))}function Ble(n,e,i){const r=CP(n,e);if(r)for(let s=r.length-1;s>=0;s--){const o=r[s];o.prefix===i&&(o.prefix=null),o.postfix===i&&(o.postfix=null),!o.prefix&&!o.postfix&&r.splice(s,1)}}const d5=Symbol("Needle:Patches:WrappedFunction");function p5(n,e,i){if(n[d5])return n;const r=function(...s){f5(e,i,this,...s);const o=n.apply(this,s);return m5(e,i,this,o,...s),o};return r[d5]=!0,r}const L1="Needle:Patches";function SP(){return globalThis[L1]||(globalThis[L1]=new WeakMap),globalThis[L1]}function CP(n,e){const i=SP().get(n);return i?i.get(e):null}function kle(n,e,i,r){let s=SP().get(n);s||(s=new Map,SP().set(n,s));let o=s.get(e);o||(o=[],s.set(e,o)),o.push({prefix:i,postfix:r})}function f5(n,e,i,...r){var s;if(!i)return;const o=CP(n,e);if(o)for(const a of o)(s=a.prefix)==null||s.call(i,...r)}function m5(n,e,i,r,...s){var o;if(!i)return;const a=CP(n,e);if(a)for(const l of a)(o=l.postfix)==null||o.call(i,r,...s)}const g5="";globalThis.GLTF_PROGRESSIVE_VERSION=g5,console.debug(`[gltf-progressive] version ${g5}`);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const v5="166",U1=0,Ole=1,Dle=2,y5=1,A5=100,b5=204,x5=205,_5=3,Lle=0,w5="attached",Ule="detached",S5=300,Fle=301,$y=1e3,sf=1001,EP=1002,eA=1003,Nle=1004,zle=1005,tA=1006,jle=1007,F1=1008,Ia=1009,of=1015,N1=1016,zu=1023,Sg=1028,iA=1030,Gle=33777,Hle=33779,Vle=35840,Qle=35842,Wle=36196,Xle=37492,qle=37496,Yle=37808,C5=37812,Jle=36492,nA=2300,rA=2301,MP=2302,E5=2400,M5=2401,T5=2402,Kle=2500,Zle=0,I5=1,TP=2,$le=0,IP="",Rs="srgb",Eo="srgb-linear",R5="display-p3",RP="display-p3-linear",PP="linear",P5="srgb",B5="rec709",k5="p3",Cg=7680,O5=519,BP=35044,af=2e3,kP=2001;class z1{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(i);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Ps=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let D5=1234567;const sA=Math.PI/180,oA=180/Math.PI;function gl(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ps[n&255]+Ps[n>>8&255]+Ps[n>>16&255]+Ps[n>>24&255]+"-"+Ps[e&255]+Ps[e>>8&255]+"-"+Ps[e>>16&15|64]+Ps[e>>24&255]+"-"+Ps[i&63|128]+Ps[i>>8&255]+"-"+Ps[i>>16&255]+Ps[i>>24&255]+Ps[r&255]+Ps[r>>8&255]+Ps[r>>16&255]+Ps[r>>24&255]).toLowerCase()}function Bs(n,e,i){return Math.max(e,Math.min(i,n))}function OP(n,e){return(n%e+e)%e}function ece(n,e,i,r,s){return r+(n-e)*(s-r)/(i-e)}function tce(n,e,i){return n!==e?(i-n)/(e-n):0}function aA(n,e,i){return(1-i)*n+i*e}function ice(n,e,i,r){return aA(n,e,1-Math.exp(-i*r))}function nce(n,e=1){return e-Math.abs(OP(n,e*2)-e)}function rce(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*(3-2*n))}function sce(n,e,i){return n<=e?0:n>=i?1:(n=(n-e)/(i-e),n*n*n*(n*(n*6-15)+10))}function oce(n,e){return n+Math.floor(Math.random()*(e-n+1))}function ace(n,e){return n+Math.random()*(e-n)}function lce(n){return n*(.5-Math.random())}function cce(n){n!==void 0&&(D5=n);let e=D5+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function hce(n){return n*sA}function uce(n){return n*oA}function dce(n){return(n&n-1)===0&&n!==0}function pce(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function fce(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function mce(n,e,i,r,s){const o=Math.cos,a=Math.sin,l=o(i/2),c=a(i/2),h=o((e+r)/2),u=a((e+r)/2),d=o((e-r)/2),f=a((e-r)/2),m=o((r-e)/2),g=a((r-e)/2);switch(s){case"XYX":n.set(l*u,c*d,c*f,l*h);break;case"YZY":n.set(c*f,l*u,c*d,l*h);break;case"ZXZ":n.set(c*d,c*f,l*u,l*h);break;case"XZX":n.set(l*u,c*g,c*m,l*h);break;case"YXY":n.set(c*m,l*u,c*g,l*h);break;case"ZYZ":n.set(c*g,c*m,l*u,l*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function vl(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Bi(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const gce={DEG2RAD:sA,RAD2DEG:oA,generateUUID:gl,clamp:Bs,euclideanModulo:OP,mapLinear:ece,inverseLerp:tce,lerp:aA,damp:ice,pingpong:nce,smoothstep:rce,smootherstep:sce,randInt:oce,randFloat:ace,randFloatSpread:lce,seededRandom:cce,degToRad:hce,radToDeg:uce,isPowerOfTwo:dce,ceilPowerOfTwo:pce,floorPowerOfTwo:fce,setQuaternionFromProperEuler:mce,normalize:Bi,denormalize:vl};class Tn{constructor(e=0,i=0){Tn.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,r=this.y,s=e.elements;return this.x=s[0]*i+s[3]*r+s[6],this.y=s[1]*i+s[4]*r+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(Bs(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y;return i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const r=Math.cos(i),s=Math.sin(i),o=this.x-e.x,a=this.y-e.y;return this.x=o*r-a*s+e.x,this.y=o*s+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class hu{constructor(e,i,r,s,o,a,l,c,h){hu.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,r,s,o,a,l,c,h)}set(e,i,r,s,o,a,l,c,h){const u=this.elements;return u[0]=e,u[1]=s,u[2]=l,u[3]=i,u[4]=o,u[5]=c,u[6]=r,u[7]=a,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(e,i,r){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,s=i.elements,o=this.elements,a=r[0],l=r[3],c=r[6],h=r[1],u=r[4],d=r[7],f=r[2],m=r[5],g=r[8],v=s[0],y=s[3],A=s[6],b=s[1],x=s[4],_=s[7],w=s[2],T=s[5],M=s[8];return o[0]=a*v+l*b+c*w,o[3]=a*y+l*x+c*T,o[6]=a*A+l*_+c*M,o[1]=h*v+u*b+d*w,o[4]=h*y+u*x+d*T,o[7]=h*A+u*_+d*M,o[2]=f*v+m*b+g*w,o[5]=f*y+m*x+g*T,o[8]=f*A+m*_+g*M,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8];return i*a*u-i*l*h-r*o*u+r*l*c+s*o*h-s*a*c}invert(){const e=this.elements,i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=u*a-l*h,f=l*c-u*o,m=h*o-a*c,g=i*d+r*f+s*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/g;return e[0]=d*v,e[1]=(s*h-u*r)*v,e[2]=(l*r-s*a)*v,e[3]=f*v,e[4]=(u*i-s*c)*v,e[5]=(s*o-l*i)*v,e[6]=m*v,e[7]=(r*c-h*i)*v,e[8]=(a*i-r*o)*v,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,r,s,o,a,l){const c=Math.cos(o),h=Math.sin(o);return this.set(r*c,r*h,-r*(c*a+h*l)+a+e,-s*h,s*c,-s*(-h*a+c*l)+l+i,0,0,1),this}scale(e,i){return this.premultiply(DP.makeScale(e,i)),this}rotate(e){return this.premultiply(DP.makeRotation(-e)),this}translate(e,i){return this.premultiply(DP.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,r=e.elements;for(let s=0;s<9;s++)if(i[s]!==r[s])return!1;return!0}fromArray(e,i=0){for(let r=0;r<9;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const DP=new hu;function vce(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function LP(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const L5={};function U5(n){n in L5||(L5[n]=!0,console.warn(n))}const F5=new hu().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),N5=new hu().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),j1={[Eo]:{transfer:PP,primaries:B5,toReference:n=>n,fromReference:n=>n},[Rs]:{transfer:P5,primaries:B5,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[RP]:{transfer:PP,primaries:k5,toReference:n=>n.applyMatrix3(N5),fromReference:n=>n.applyMatrix3(F5)},[R5]:{transfer:P5,primaries:k5,toReference:n=>n.convertSRGBToLinear().applyMatrix3(N5),fromReference:n=>n.applyMatrix3(F5).convertLinearToSRGB()}},yce=new Set([Eo,RP]),qo={enabled:!0,_workingColorSpace:Eo,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!yce.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,i){if(this.enabled===!1||e===i||!e||!i)return n;const r=j1[e].toReference,s=j1[i].fromReference;return s(r(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return j1[n].primaries},getTransfer:function(n){return n===IP?PP:j1[n].transfer}};function Eg(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function UP(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Mg;class Ace{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{Mg===void 0&&(Mg=LP("canvas")),Mg.width=e.width,Mg.height=e.height;const r=Mg.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=Mg}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=LP("canvas");i.width=e.width,i.height=e.height;const r=i.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const s=r.getImageData(0,0,e.width,e.height),o=s.data;for(let a=0;a<o.length;a++)o[a]=Eg(o[a]/255)*255;return r.putImageData(s,0,0),i}else if(e.data){const i=e.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(Eg(i[r]/255)*255):i[r]=Eg(i[r]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let bce=0;class xce{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:bce++}),this.uuid=gl(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},s=this.data;if(s!==null){let o;if(Array.isArray(s)){o=[];for(let a=0,l=s.length;a<l;a++)s[a].isDataTexture?o.push(FP(s[a].image)):o.push(FP(s[a]))}else o=FP(s);r.url=o}return i||(e.images[this.uuid]=r),r}}function FP(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Ace.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _ce=0;class Qr extends z1{constructor(e=Qr.DEFAULT_IMAGE,i=Qr.DEFAULT_MAPPING,r=sf,s=sf,o=tA,a=F1,l=zu,c=Ia,h=Qr.DEFAULT_ANISOTROPY,u=IP){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_ce++}),this.uuid=gl(),this.name="",this.source=new xce(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=h,this.format=l,this.internalFormat=null,this.type=c,this.offset=new Tn(0,0),this.repeat=new Tn(1,1),this.center=new Tn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new hu,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==S5)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case $y:e.x=e.x-Math.floor(e.x);break;case sf:e.x=e.x<0?0:1;break;case EP:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case $y:e.y=e.y-Math.floor(e.y);break;case sf:e.y=e.y<0?0:1;break;case EP:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Qr.DEFAULT_IMAGE=null,Qr.DEFAULT_MAPPING=S5,Qr.DEFAULT_ANISOTROPY=1;class il{constructor(e=0,i=0,r=0,s=1){il.prototype.isVector4=!0,this.x=e,this.y=i,this.z=r,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,r,s){return this.x=e,this.y=i,this.z=r,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,r=this.y,s=this.z,o=this.w,a=e.elements;return this.x=a[0]*i+a[4]*r+a[8]*s+a[12]*o,this.y=a[1]*i+a[5]*r+a[9]*s+a[13]*o,this.z=a[2]*i+a[6]*r+a[10]*s+a[14]*o,this.w=a[3]*i+a[7]*r+a[11]*s+a[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,r,s,o;const a=e.elements,l=a[0],c=a[4],h=a[8],u=a[1],d=a[5],f=a[9],m=a[2],g=a[6],v=a[10];if(Math.abs(c-u)<.01&&Math.abs(h-m)<.01&&Math.abs(f-g)<.01){if(Math.abs(c+u)<.1&&Math.abs(h+m)<.1&&Math.abs(f+g)<.1&&Math.abs(l+d+v-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const A=(l+1)/2,b=(d+1)/2,x=(v+1)/2,_=(c+u)/4,w=(h+m)/4,T=(f+g)/4;return A>b&&A>x?A<.01?(r=0,s=.707106781,o=.707106781):(r=Math.sqrt(A),s=_/r,o=w/r):b>x?b<.01?(r=.707106781,s=0,o=.707106781):(s=Math.sqrt(b),r=_/s,o=T/s):x<.01?(r=.707106781,s=.707106781,o=0):(o=Math.sqrt(x),r=w/o,s=T/o),this.set(r,s,o,i),this}let y=Math.sqrt((g-f)*(g-f)+(h-m)*(h-m)+(u-c)*(u-c));return Math.abs(y)<.001&&(y=1),this.x=(g-f)/y,this.y=(h-m)/y,this.z=(u-c)/y,this.w=Math.acos((l+d+v-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this.w=e.w+(i.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class wce extends Qr{constructor(e=null,i=1,r=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:r,depth:s},this.magFilter=eA,this.minFilter=eA,this.wrapR=sf,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ju{constructor(e=0,i=0,r=0,s=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=r,this._w=s}static slerpFlat(e,i,r,s,o,a,l){let c=r[s+0],h=r[s+1],u=r[s+2],d=r[s+3];const f=o[a+0],m=o[a+1],g=o[a+2],v=o[a+3];if(l===0){e[i+0]=c,e[i+1]=h,e[i+2]=u,e[i+3]=d;return}if(l===1){e[i+0]=f,e[i+1]=m,e[i+2]=g,e[i+3]=v;return}if(d!==v||c!==f||h!==m||u!==g){let y=1-l;const A=c*f+h*m+u*g+d*v,b=A>=0?1:-1,x=1-A*A;if(x>Number.EPSILON){const w=Math.sqrt(x),T=Math.atan2(w,A*b);y=Math.sin(y*T)/w,l=Math.sin(l*T)/w}const _=l*b;if(c=c*y+f*_,h=h*y+m*_,u=u*y+g*_,d=d*y+v*_,y===1-l){const w=1/Math.sqrt(c*c+h*h+u*u+d*d);c*=w,h*=w,u*=w,d*=w}}e[i]=c,e[i+1]=h,e[i+2]=u,e[i+3]=d}static multiplyQuaternionsFlat(e,i,r,s,o,a){const l=r[s],c=r[s+1],h=r[s+2],u=r[s+3],d=o[a],f=o[a+1],m=o[a+2],g=o[a+3];return e[i]=l*g+u*d+c*m-h*f,e[i+1]=c*g+u*f+h*d-l*m,e[i+2]=h*g+u*m+l*f-c*d,e[i+3]=u*g-l*d-c*f-h*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,r,s){return this._x=e,this._y=i,this._z=r,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const r=e._x,s=e._y,o=e._z,a=e._order,l=Math.cos,c=Math.sin,h=l(r/2),u=l(s/2),d=l(o/2),f=c(r/2),m=c(s/2),g=c(o/2);switch(a){case"XYZ":this._x=f*u*d+h*m*g,this._y=h*m*d-f*u*g,this._z=h*u*g+f*m*d,this._w=h*u*d-f*m*g;break;case"YXZ":this._x=f*u*d+h*m*g,this._y=h*m*d-f*u*g,this._z=h*u*g-f*m*d,this._w=h*u*d+f*m*g;break;case"ZXY":this._x=f*u*d-h*m*g,this._y=h*m*d+f*u*g,this._z=h*u*g+f*m*d,this._w=h*u*d-f*m*g;break;case"ZYX":this._x=f*u*d-h*m*g,this._y=h*m*d+f*u*g,this._z=h*u*g-f*m*d,this._w=h*u*d+f*m*g;break;case"YZX":this._x=f*u*d+h*m*g,this._y=h*m*d+f*u*g,this._z=h*u*g-f*m*d,this._w=h*u*d-f*m*g;break;case"XZY":this._x=f*u*d-h*m*g,this._y=h*m*d-f*u*g,this._z=h*u*g+f*m*d,this._w=h*u*d+f*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const r=i/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,r=i[0],s=i[4],o=i[8],a=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10],f=r+l+d;if(f>0){const m=.5/Math.sqrt(f+1);this._w=.25/m,this._x=(u-c)*m,this._y=(o-h)*m,this._z=(a-s)*m}else if(r>l&&r>d){const m=2*Math.sqrt(1+r-l-d);this._w=(u-c)/m,this._x=.25*m,this._y=(s+a)/m,this._z=(o+h)/m}else if(l>d){const m=2*Math.sqrt(1+l-r-d);this._w=(o-h)/m,this._x=(s+a)/m,this._y=.25*m,this._z=(c+u)/m}else{const m=2*Math.sqrt(1+d-r-l);this._w=(a-s)/m,this._x=(o+h)/m,this._y=(c+u)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let r=e.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Bs(this.dot(e),-1,1)))}rotateTowards(e,i){const r=this.angleTo(e);if(r===0)return this;const s=Math.min(1,i/r);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const r=e._x,s=e._y,o=e._z,a=e._w,l=i._x,c=i._y,h=i._z,u=i._w;return this._x=r*u+a*l+s*h-o*c,this._y=s*u+a*c+o*l-r*h,this._z=o*u+a*h+r*c-s*l,this._w=a*u-r*l-s*c-o*h,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const r=this._x,s=this._y,o=this._z,a=this._w;let l=a*e._w+r*e._x+s*e._y+o*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=a,this._x=r,this._y=s,this._z=o,this;const c=1-l*l;if(c<=Number.EPSILON){const m=1-i;return this._w=m*a+i*this._w,this._x=m*r+i*this._x,this._y=m*s+i*this._y,this._z=m*o+i*this._z,this.normalize(),this}const h=Math.sqrt(c),u=Math.atan2(h,l),d=Math.sin((1-i)*u)/h,f=Math.sin(i*u)/h;return this._w=a*d+this._w*f,this._x=r*d+this._x*f,this._y=s*d+this._y*f,this._z=o*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,i,r){return this.copy(e).slerp(i,r)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),r=Math.random(),s=Math.sqrt(1-r),o=Math.sqrt(r);return this.set(s*Math.sin(e),s*Math.cos(e),o*Math.sin(i),o*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class fe{constructor(e=0,i=0,r=0){fe.prototype.isVector3=!0,this.x=e,this.y=i,this.z=r}set(e,i,r){return r===void 0&&(r=this.z),this.x=e,this.y=i,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(z5.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(z5.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,r=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[3]*r+o[6]*s,this.y=o[1]*i+o[4]*r+o[7]*s,this.z=o[2]*i+o[5]*r+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,r=this.y,s=this.z,o=e.elements,a=1/(o[3]*i+o[7]*r+o[11]*s+o[15]);return this.x=(o[0]*i+o[4]*r+o[8]*s+o[12])*a,this.y=(o[1]*i+o[5]*r+o[9]*s+o[13])*a,this.z=(o[2]*i+o[6]*r+o[10]*s+o[14])*a,this}applyQuaternion(e){const i=this.x,r=this.y,s=this.z,o=e.x,a=e.y,l=e.z,c=e.w,h=2*(a*s-l*r),u=2*(l*i-o*s),d=2*(o*r-a*i);return this.x=i+c*h+a*d-l*u,this.y=r+c*u+l*h-o*d,this.z=s+c*d+o*u-a*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,r=this.y,s=this.z,o=e.elements;return this.x=o[0]*i+o[4]*r+o[8]*s,this.y=o[1]*i+o[5]*r+o[9]*s,this.z=o[2]*i+o[6]*r+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const r=e.x,s=e.y,o=e.z,a=i.x,l=i.y,c=i.z;return this.x=s*c-o*l,this.y=o*a-r*c,this.z=r*l-s*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const r=e.dot(this)/i;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return NP.copy(this).projectOnVector(e),this.sub(NP)}reflect(e){return this.sub(NP.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(Bs(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y,s=this.z-e.z;return i*i+r*r+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,r){const s=Math.sin(i)*e;return this.x=s*Math.sin(r),this.y=Math.cos(i)*e,this.z=s*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,r){return this.x=e*Math.sin(i),this.y=r,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=r,this.z=s,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,r=Math.sqrt(1-i*i);return this.x=r*Math.cos(e),this.y=i,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const NP=new fe,z5=new ju;class yl{constructor(e=new fe(1/0,1/0,1/0),i=new fe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i+=3)this.expandByPoint(Al.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,r=e.count;i<r;i++)this.expandByPoint(Al.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=Al.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const o=r.getAttribute("position");if(i===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let a=0,l=o.count;a<l;a++)e.isMesh===!0?e.getVertexPosition(a,Al):Al.fromBufferAttribute(o,a),Al.applyMatrix4(e.matrixWorld),this.expandByPoint(Al);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),G1.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),G1.copy(r.boundingBox)),G1.applyMatrix4(e.matrixWorld),this.union(G1)}const s=e.children;for(let o=0,a=s.length;o<a;o++)this.expandByObject(s[o],i);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Al),Al.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,r;return e.normal.x>0?(i=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),i<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(lA),H1.subVectors(this.max,lA),Tg.subVectors(e.a,lA),Ig.subVectors(e.b,lA),Rg.subVectors(e.c,lA),Gu.subVectors(Ig,Tg),Hu.subVectors(Rg,Ig),lf.subVectors(Tg,Rg);let i=[0,-Gu.z,Gu.y,0,-Hu.z,Hu.y,0,-lf.z,lf.y,Gu.z,0,-Gu.x,Hu.z,0,-Hu.x,lf.z,0,-lf.x,-Gu.y,Gu.x,0,-Hu.y,Hu.x,0,-lf.y,lf.x,0];return!zP(i,Tg,Ig,Rg,H1)||(i=[1,0,0,0,1,0,0,0,1],!zP(i,Tg,Ig,Rg,H1))?!1:(V1.crossVectors(Gu,Hu),i=[V1.x,V1.y,V1.z],zP(i,Tg,Ig,Rg,H1))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Al).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Al).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(gh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),gh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),gh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),gh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),gh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),gh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),gh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),gh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(gh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const gh=[new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe],Al=new fe,G1=new yl,Tg=new fe,Ig=new fe,Rg=new fe,Gu=new fe,Hu=new fe,lf=new fe,lA=new fe,H1=new fe,V1=new fe,cf=new fe;function zP(n,e,i,r,s){for(let o=0,a=n.length-3;o<=a;o+=3){cf.fromArray(n,o);const l=s.x*Math.abs(cf.x)+s.y*Math.abs(cf.y)+s.z*Math.abs(cf.z),c=e.dot(cf),h=i.dot(cf),u=r.dot(cf);if(Math.max(-Math.max(c,h,u),Math.min(c,h,u))>l)return!1}return!0}const Sce=new yl,cA=new fe,jP=new fe;class bl{constructor(e=new fe,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const r=this.center;i!==void 0?r.copy(i):Sce.setFromPoints(e).getCenter(r);let s=0;for(let o=0,a=e.length;o<a;o++)s=Math.max(s,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const r=this.center.distanceToSquared(e);return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;cA.subVectors(e,this.center);const i=cA.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),s=(r-this.radius)*.5;this.center.addScaledVector(cA,s/r),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(jP.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(cA.copy(e.center).add(jP)),this.expandByPoint(cA.copy(e.center).sub(jP))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const vh=new fe,GP=new fe,Q1=new fe,Vu=new fe,HP=new fe,W1=new fe,VP=new fe;class X1{constructor(e=new fe,i=new fe(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,vh)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=vh.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(vh.copy(this.origin).addScaledVector(this.direction,i),vh.distanceToSquared(e))}distanceSqToSegment(e,i,r,s){GP.copy(e).add(i).multiplyScalar(.5),Q1.copy(i).sub(e).normalize(),Vu.copy(this.origin).sub(GP);const o=e.distanceTo(i)*.5,a=-this.direction.dot(Q1),l=Vu.dot(this.direction),c=-Vu.dot(Q1),h=Vu.lengthSq(),u=Math.abs(1-a*a);let d,f,m,g;if(u>0)if(d=a*c-l,f=a*l-c,g=o*u,d>=0)if(f>=-g)if(f<=g){const v=1/u;d*=v,f*=v,m=d*(d+a*f+2*l)+f*(a*d+f+2*c)+h}else f=o,d=Math.max(0,-(a*f+l)),m=-d*d+f*(f+2*c)+h;else f=-o,d=Math.max(0,-(a*f+l)),m=-d*d+f*(f+2*c)+h;else f<=-g?(d=Math.max(0,-(-a*o+l)),f=d>0?-o:Math.min(Math.max(-o,-c),o),m=-d*d+f*(f+2*c)+h):f<=g?(d=0,f=Math.min(Math.max(-o,-c),o),m=f*(f+2*c)+h):(d=Math.max(0,-(a*o+l)),f=d>0?o:Math.min(Math.max(-o,-c),o),m=-d*d+f*(f+2*c)+h);else f=a>0?-o:o,d=Math.max(0,-(a*f+l)),m=-d*d+f*(f+2*c)+h;return r&&r.copy(this.origin).addScaledVector(this.direction,d),s&&s.copy(GP).addScaledVector(Q1,f),m}intersectSphere(e,i){vh.subVectors(e.center,this.origin);const r=vh.dot(this.direction),s=vh.dot(vh)-r*r,o=e.radius*e.radius;if(s>o)return null;const a=Math.sqrt(o-s),l=r-a,c=r+a;return c<0?null:l<0?this.at(c,i):this.at(l,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/i;return r>=0?r:null}intersectPlane(e,i){const r=this.distanceToPlane(e);return r===null?null:this.at(r,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let r,s,o,a,l,c;const h=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,f=this.origin;return h>=0?(r=(e.min.x-f.x)*h,s=(e.max.x-f.x)*h):(r=(e.max.x-f.x)*h,s=(e.min.x-f.x)*h),u>=0?(o=(e.min.y-f.y)*u,a=(e.max.y-f.y)*u):(o=(e.max.y-f.y)*u,a=(e.min.y-f.y)*u),r>a||o>s||((o>r||isNaN(r))&&(r=o),(a<s||isNaN(s))&&(s=a),d>=0?(l=(e.min.z-f.z)*d,c=(e.max.z-f.z)*d):(l=(e.max.z-f.z)*d,c=(e.min.z-f.z)*d),r>c||l>s)||((l>r||r!==r)&&(r=l),(c<s||s!==s)&&(s=c),s<0)?null:this.at(r>=0?r:s,i)}intersectsBox(e){return this.intersectBox(e,vh)!==null}intersectTriangle(e,i,r,s,o){HP.subVectors(i,e),W1.subVectors(r,e),VP.crossVectors(HP,W1);let a=this.direction.dot(VP),l;if(a>0){if(s)return null;l=1}else if(a<0)l=-1,a=-a;else return null;Vu.subVectors(this.origin,e);const c=l*this.direction.dot(W1.crossVectors(Vu,W1));if(c<0)return null;const h=l*this.direction.dot(HP.cross(Vu));if(h<0||c+h>a)return null;const u=-l*Vu.dot(VP);return u<0?null:this.at(u/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class li{constructor(e,i,r,s,o,a,l,c,h,u,d,f,m,g,v,y){li.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,r,s,o,a,l,c,h,u,d,f,m,g,v,y)}set(e,i,r,s,o,a,l,c,h,u,d,f,m,g,v,y){const A=this.elements;return A[0]=e,A[4]=i,A[8]=r,A[12]=s,A[1]=o,A[5]=a,A[9]=l,A[13]=c,A[2]=h,A[6]=u,A[10]=d,A[14]=f,A[3]=m,A[7]=g,A[11]=v,A[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new li().fromArray(this.elements)}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(e){const i=this.elements,r=e.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,r){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,i,r){return this.set(e.x,i.x,r.x,0,e.y,i.y,r.y,0,e.z,i.z,r.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,r=e.elements,s=1/Pg.setFromMatrixColumn(e,0).length(),o=1/Pg.setFromMatrixColumn(e,1).length(),a=1/Pg.setFromMatrixColumn(e,2).length();return i[0]=r[0]*s,i[1]=r[1]*s,i[2]=r[2]*s,i[3]=0,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,r=e.x,s=e.y,o=e.z,a=Math.cos(r),l=Math.sin(r),c=Math.cos(s),h=Math.sin(s),u=Math.cos(o),d=Math.sin(o);if(e.order==="XYZ"){const f=a*u,m=a*d,g=l*u,v=l*d;i[0]=c*u,i[4]=-c*d,i[8]=h,i[1]=m+g*h,i[5]=f-v*h,i[9]=-l*c,i[2]=v-f*h,i[6]=g+m*h,i[10]=a*c}else if(e.order==="YXZ"){const f=c*u,m=c*d,g=h*u,v=h*d;i[0]=f+v*l,i[4]=g*l-m,i[8]=a*h,i[1]=a*d,i[5]=a*u,i[9]=-l,i[2]=m*l-g,i[6]=v+f*l,i[10]=a*c}else if(e.order==="ZXY"){const f=c*u,m=c*d,g=h*u,v=h*d;i[0]=f-v*l,i[4]=-a*d,i[8]=g+m*l,i[1]=m+g*l,i[5]=a*u,i[9]=v-f*l,i[2]=-a*h,i[6]=l,i[10]=a*c}else if(e.order==="ZYX"){const f=a*u,m=a*d,g=l*u,v=l*d;i[0]=c*u,i[4]=g*h-m,i[8]=f*h+v,i[1]=c*d,i[5]=v*h+f,i[9]=m*h-g,i[2]=-h,i[6]=l*c,i[10]=a*c}else if(e.order==="YZX"){const f=a*c,m=a*h,g=l*c,v=l*h;i[0]=c*u,i[4]=v-f*d,i[8]=g*d+m,i[1]=d,i[5]=a*u,i[9]=-l*u,i[2]=-h*u,i[6]=m*d+g,i[10]=f-v*d}else if(e.order==="XZY"){const f=a*c,m=a*h,g=l*c,v=l*h;i[0]=c*u,i[4]=-d,i[8]=h*u,i[1]=f*d+v,i[5]=a*u,i[9]=m*d-g,i[2]=g*d-m,i[6]=l*u,i[10]=v*d+f}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Cce,e,Ece)}lookAt(e,i,r){const s=this.elements;return Yo.subVectors(e,i),Yo.lengthSq()===0&&(Yo.z=1),Yo.normalize(),Qu.crossVectors(r,Yo),Qu.lengthSq()===0&&(Math.abs(r.z)===1?Yo.x+=1e-4:Yo.z+=1e-4,Yo.normalize(),Qu.crossVectors(r,Yo)),Qu.normalize(),q1.crossVectors(Yo,Qu),s[0]=Qu.x,s[4]=q1.x,s[8]=Yo.x,s[1]=Qu.y,s[5]=q1.y,s[9]=Yo.y,s[2]=Qu.z,s[6]=q1.z,s[10]=Yo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,s=i.elements,o=this.elements,a=r[0],l=r[4],c=r[8],h=r[12],u=r[1],d=r[5],f=r[9],m=r[13],g=r[2],v=r[6],y=r[10],A=r[14],b=r[3],x=r[7],_=r[11],w=r[15],T=s[0],M=s[4],R=s[8],B=s[12],E=s[1],P=s[5],O=s[9],N=s[13],L=s[2],Q=s[6],D=s[10],F=s[14],H=s[3],K=s[7],Z=s[11],oe=s[15];return o[0]=a*T+l*E+c*L+h*H,o[4]=a*M+l*P+c*Q+h*K,o[8]=a*R+l*O+c*D+h*Z,o[12]=a*B+l*N+c*F+h*oe,o[1]=u*T+d*E+f*L+m*H,o[5]=u*M+d*P+f*Q+m*K,o[9]=u*R+d*O+f*D+m*Z,o[13]=u*B+d*N+f*F+m*oe,o[2]=g*T+v*E+y*L+A*H,o[6]=g*M+v*P+y*Q+A*K,o[10]=g*R+v*O+y*D+A*Z,o[14]=g*B+v*N+y*F+A*oe,o[3]=b*T+x*E+_*L+w*H,o[7]=b*M+x*P+_*Q+w*K,o[11]=b*R+x*O+_*D+w*Z,o[15]=b*B+x*N+_*F+w*oe,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[4],s=e[8],o=e[12],a=e[1],l=e[5],c=e[9],h=e[13],u=e[2],d=e[6],f=e[10],m=e[14],g=e[3],v=e[7],y=e[11],A=e[15];return g*(+o*c*d-s*h*d-o*l*f+r*h*f+s*l*m-r*c*m)+v*(+i*c*m-i*h*f+o*a*f-s*a*m+s*h*u-o*c*u)+y*(+i*h*d-i*l*m-o*a*d+r*a*m+o*l*u-r*h*u)+A*(-s*l*u-i*c*d+i*l*f+s*a*d-r*a*f+r*c*u)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,r){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=r),this}invert(){const e=this.elements,i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=e[9],f=e[10],m=e[11],g=e[12],v=e[13],y=e[14],A=e[15],b=d*y*h-v*f*h+v*c*m-l*y*m-d*c*A+l*f*A,x=g*f*h-u*y*h-g*c*m+a*y*m+u*c*A-a*f*A,_=u*v*h-g*d*h+g*l*m-a*v*m-u*l*A+a*d*A,w=g*d*c-u*v*c-g*l*f+a*v*f+u*l*y-a*d*y,T=i*b+r*x+s*_+o*w;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/T;return e[0]=b*M,e[1]=(v*f*o-d*y*o-v*s*m+r*y*m+d*s*A-r*f*A)*M,e[2]=(l*y*o-v*c*o+v*s*h-r*y*h-l*s*A+r*c*A)*M,e[3]=(d*c*o-l*f*o-d*s*h+r*f*h+l*s*m-r*c*m)*M,e[4]=x*M,e[5]=(u*y*o-g*f*o+g*s*m-i*y*m-u*s*A+i*f*A)*M,e[6]=(g*c*o-a*y*o-g*s*h+i*y*h+a*s*A-i*c*A)*M,e[7]=(a*f*o-u*c*o+u*s*h-i*f*h-a*s*m+i*c*m)*M,e[8]=_*M,e[9]=(g*d*o-u*v*o-g*r*m+i*v*m+u*r*A-i*d*A)*M,e[10]=(a*v*o-g*l*o+g*r*h-i*v*h-a*r*A+i*l*A)*M,e[11]=(u*l*o-a*d*o-u*r*h+i*d*h+a*r*m-i*l*m)*M,e[12]=w*M,e[13]=(u*v*s-g*d*s+g*r*f-i*v*f-u*r*y+i*d*y)*M,e[14]=(g*l*s-a*v*s-g*r*c+i*v*c+a*r*y-i*l*y)*M,e[15]=(a*d*s-u*l*s+u*r*c-i*d*c-a*r*f+i*l*f)*M,this}scale(e){const i=this.elements,r=e.x,s=e.y,o=e.z;return i[0]*=r,i[4]*=s,i[8]*=o,i[1]*=r,i[5]*=s,i[9]*=o,i[2]*=r,i[6]*=s,i[10]*=o,i[3]*=r,i[7]*=s,i[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,r,s))}makeTranslation(e,i,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const r=Math.cos(i),s=Math.sin(i),o=1-r,a=e.x,l=e.y,c=e.z,h=o*a,u=o*l;return this.set(h*a+r,h*l-s*c,h*c+s*l,0,h*l+s*c,u*l+r,u*c-s*a,0,h*c-s*l,u*c+s*a,o*c*c+r,0,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,i,r,s,o,a){return this.set(1,r,o,0,e,1,a,0,i,s,1,0,0,0,0,1),this}compose(e,i,r){const s=this.elements,o=i._x,a=i._y,l=i._z,c=i._w,h=o+o,u=a+a,d=l+l,f=o*h,m=o*u,g=o*d,v=a*u,y=a*d,A=l*d,b=c*h,x=c*u,_=c*d,w=r.x,T=r.y,M=r.z;return s[0]=(1-(v+A))*w,s[1]=(m+_)*w,s[2]=(g-x)*w,s[3]=0,s[4]=(m-_)*T,s[5]=(1-(f+A))*T,s[6]=(y+b)*T,s[7]=0,s[8]=(g+x)*M,s[9]=(y-b)*M,s[10]=(1-(f+v))*M,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,r){const s=this.elements;let o=Pg.set(s[0],s[1],s[2]).length();const a=Pg.set(s[4],s[5],s[6]).length(),l=Pg.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],xl.copy(this);const c=1/o,h=1/a,u=1/l;return xl.elements[0]*=c,xl.elements[1]*=c,xl.elements[2]*=c,xl.elements[4]*=h,xl.elements[5]*=h,xl.elements[6]*=h,xl.elements[8]*=u,xl.elements[9]*=u,xl.elements[10]*=u,i.setFromRotationMatrix(xl),r.x=o,r.y=a,r.z=l,this}makePerspective(e,i,r,s,o,a,l=af){const c=this.elements,h=2*o/(i-e),u=2*o/(r-s),d=(i+e)/(i-e),f=(r+s)/(r-s);let m,g;if(l===af)m=-(a+o)/(a-o),g=-2*a*o/(a-o);else if(l===kP)m=-a/(a-o),g=-a*o/(a-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return c[0]=h,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=u,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=m,c[14]=g,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,r,s,o,a,l=af){const c=this.elements,h=1/(i-e),u=1/(r-s),d=1/(a-o),f=(i+e)*h,m=(r+s)*u;let g,v;if(l===af)g=(a+o)*d,v=-2*d;else if(l===kP)g=o*d,v=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=v,c[14]=-g,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,r=e.elements;for(let s=0;s<16;s++)if(i[s]!==r[s])return!1;return!0}fromArray(e,i=0){for(let r=0;r<16;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],e}}const Pg=new fe,xl=new li,Cce=new fe(0,0,0),Ece=new fe(1,1,1),Qu=new fe,q1=new fe,Yo=new fe,j5=new li,G5=new ju;class jv{constructor(e=0,i=0,r=0,s=jv.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,r,s=this._order){return this._x=e,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,r=!0){const s=e.elements,o=s[0],a=s[4],l=s[8],c=s[1],h=s[5],u=s[9],d=s[2],f=s[6],m=s[10];switch(i){case"XYZ":this._y=Math.asin(Bs(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Bs(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(l,m),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(Bs(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-Bs(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(Bs(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(l,m));break;case"XZY":this._z=Math.asin(-Bs(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,h),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-u,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,r){return j5.makeRotationFromQuaternion(e),this.setFromRotationMatrix(j5,i,r)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return G5.setFromEuler(this),this.setFromQuaternion(G5,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}jv.DEFAULT_ORDER="XYZ";class Mce{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Tce=0;const H5=new fe,Bg=new ju,yh=new li,Y1=new fe,hA=new fe,Ice=new fe,Rce=new ju,V5=new fe(1,0,0),Q5=new fe(0,1,0),W5=new fe(0,0,1),X5={type:"added"},Pce={type:"removed"},kg={type:"childadded",child:null},QP={type:"childremoved",child:null};class Xn extends z1{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Tce++}),this.uuid=gl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Xn.DEFAULT_UP.clone();const e=new fe,i=new jv,r=new ju,s=new fe(1,1,1);function o(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(o),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new li},normalMatrix:{value:new hu}}),this.matrix=new li,this.matrixWorld=new li,this.matrixAutoUpdate=Xn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Mce,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return Bg.setFromAxisAngle(e,i),this.quaternion.multiply(Bg),this}rotateOnWorldAxis(e,i){return Bg.setFromAxisAngle(e,i),this.quaternion.premultiply(Bg),this}rotateX(e){return this.rotateOnAxis(V5,e)}rotateY(e){return this.rotateOnAxis(Q5,e)}rotateZ(e){return this.rotateOnAxis(W5,e)}translateOnAxis(e,i){return H5.copy(e).applyQuaternion(this.quaternion),this.position.add(H5.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(V5,e)}translateY(e){return this.translateOnAxis(Q5,e)}translateZ(e){return this.translateOnAxis(W5,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(yh.copy(this.matrixWorld).invert())}lookAt(e,i,r){e.isVector3?Y1.copy(e):Y1.set(e,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),hA.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?yh.lookAt(hA,Y1,this.up):yh.lookAt(Y1,hA,this.up),this.quaternion.setFromRotationMatrix(yh),s&&(yh.extractRotation(s.matrixWorld),Bg.setFromRotationMatrix(yh),this.quaternion.premultiply(Bg.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(X5),kg.child=e,this.dispatchEvent(kg),kg.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(Pce),QP.child=e,this.dispatchEvent(QP),QP.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),yh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),yh.multiply(e.parent.matrixWorld)),e.applyMatrix4(yh),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(X5),kg.child=e,this.dispatchEvent(kg),kg.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const o=this.children[r].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,r=[]){this[e]===i&&r.push(this);const s=this.children;for(let o=0,a=s.length;o<a;o++)s[o].getObjectsByProperty(e,i,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hA,e,Ice),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(hA,Rce,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].updateMatrixWorld(e)}updateWorldMatrix(e,i){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const s=this.children;for(let o=0,a=s.length;o<a;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",r={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let h=0,u=c.length;h<u;h++){const d=c[h];o(e.shapes,d)}else o(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,h=this.material.length;c<h;c++)l.push(o(e.materials,this.material[c]));s.material=l}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let l=0;l<this.children.length;l++)s.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];s.animations.push(o(e.animations,c))}}if(i){const l=a(e.geometries),c=a(e.materials),h=a(e.textures),u=a(e.images),d=a(e.shapes),f=a(e.skeletons),m=a(e.animations),g=a(e.nodes);l.length>0&&(r.geometries=l),c.length>0&&(r.materials=c),h.length>0&&(r.textures=h),u.length>0&&(r.images=u),d.length>0&&(r.shapes=d),f.length>0&&(r.skeletons=f),m.length>0&&(r.animations=m),g.length>0&&(r.nodes=g)}return r.object=s,r;function a(l){const c=[];for(const h in l){const u=l[h];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let r=0;r<e.children.length;r++){const s=e.children[r];this.add(s.clone())}return this}}Xn.DEFAULT_UP=new fe(0,1,0),Xn.DEFAULT_MATRIX_AUTO_UPDATE=!0,Xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _l=new fe,Ah=new fe,WP=new fe,bh=new fe,Og=new fe,Dg=new fe,q5=new fe,XP=new fe,qP=new fe,YP=new fe;class qc{constructor(e=new fe,i=new fe,r=new fe){this.a=e,this.b=i,this.c=r}static getNormal(e,i,r,s){s.subVectors(r,i),_l.subVectors(e,i),s.cross(_l);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,i,r,s,o){_l.subVectors(s,i),Ah.subVectors(r,i),WP.subVectors(e,i);const a=_l.dot(_l),l=_l.dot(Ah),c=_l.dot(WP),h=Ah.dot(Ah),u=Ah.dot(WP),d=a*h-l*l;if(d===0)return o.set(0,0,0),null;const f=1/d,m=(h*c-l*u)*f,g=(a*u-l*c)*f;return o.set(1-m-g,g,m)}static containsPoint(e,i,r,s){return this.getBarycoord(e,i,r,s,bh)===null?!1:bh.x>=0&&bh.y>=0&&bh.x+bh.y<=1}static getInterpolation(e,i,r,s,o,a,l,c){return this.getBarycoord(e,i,r,s,bh)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(o,bh.x),c.addScaledVector(a,bh.y),c.addScaledVector(l,bh.z),c)}static isFrontFacing(e,i,r,s){return _l.subVectors(r,i),Ah.subVectors(e,i),_l.cross(Ah).dot(s)<0}set(e,i,r){return this.a.copy(e),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(e,i,r,s){return this.a.copy(e[i]),this.b.copy(e[r]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,r,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _l.subVectors(this.c,this.b),Ah.subVectors(this.a,this.b),_l.cross(Ah).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return qc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return qc.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,r,s,o){return qc.getInterpolation(e,this.a,this.b,this.c,i,r,s,o)}containsPoint(e){return qc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return qc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const r=this.a,s=this.b,o=this.c;let a,l;Og.subVectors(s,r),Dg.subVectors(o,r),XP.subVectors(e,r);const c=Og.dot(XP),h=Dg.dot(XP);if(c<=0&&h<=0)return i.copy(r);qP.subVectors(e,s);const u=Og.dot(qP),d=Dg.dot(qP);if(u>=0&&d<=u)return i.copy(s);const f=c*d-u*h;if(f<=0&&c>=0&&u<=0)return a=c/(c-u),i.copy(r).addScaledVector(Og,a);YP.subVectors(e,o);const m=Og.dot(YP),g=Dg.dot(YP);if(g>=0&&m<=g)return i.copy(o);const v=m*h-c*g;if(v<=0&&h>=0&&g<=0)return l=h/(h-g),i.copy(r).addScaledVector(Dg,l);const y=u*g-m*d;if(y<=0&&d-u>=0&&m-g>=0)return q5.subVectors(o,s),l=(d-u)/(d-u+(m-g)),i.copy(s).addScaledVector(q5,l);const A=1/(y+v+f);return a=v*A,l=f*A,i.copy(r).addScaledVector(Og,a).addScaledVector(Dg,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Y5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Wu={h:0,s:0,l:0},J1={h:0,s:0,l:0};function JP(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*6*(2/3-i):n}class $n{constructor(e,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,r)}set(e,i,r){if(i===void 0&&r===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,i,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Rs){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,qo.toWorkingColorSpace(this,i),this}setRGB(e,i,r,s=qo.workingColorSpace){return this.r=e,this.g=i,this.b=r,qo.toWorkingColorSpace(this,s),this}setHSL(e,i,r,s=qo.workingColorSpace){if(e=OP(e,1),i=Bs(i,0,1),r=Bs(r,0,1),i===0)this.r=this.g=this.b=r;else{const o=r<=.5?r*(1+i):r+i-r*i,a=2*r-o;this.r=JP(a,o,e+1/3),this.g=JP(a,o,e),this.b=JP(a,o,e-1/3)}return qo.toWorkingColorSpace(this,s),this}setStyle(e,i=Rs){function r(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const a=s[1],l=s[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,i);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,i);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=s[1],a=o.length;if(a===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(o,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=Rs){const r=Y5[e.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Eg(e.r),this.g=Eg(e.g),this.b=Eg(e.b),this}copyLinearToSRGB(e){return this.r=UP(e.r),this.g=UP(e.g),this.b=UP(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Rs){return qo.fromWorkingColorSpace(ks.copy(this),e),Math.round(Bs(ks.r*255,0,255))*65536+Math.round(Bs(ks.g*255,0,255))*256+Math.round(Bs(ks.b*255,0,255))}getHexString(e=Rs){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=qo.workingColorSpace){qo.fromWorkingColorSpace(ks.copy(this),i);const r=ks.r,s=ks.g,o=ks.b,a=Math.max(r,s,o),l=Math.min(r,s,o);let c,h;const u=(l+a)/2;if(l===a)c=0,h=0;else{const d=a-l;switch(h=u<=.5?d/(a+l):d/(2-a-l),a){case r:c=(s-o)/d+(s<o?6:0);break;case s:c=(o-r)/d+2;break;case o:c=(r-s)/d+4;break}c/=6}return e.h=c,e.s=h,e.l=u,e}getRGB(e,i=qo.workingColorSpace){return qo.fromWorkingColorSpace(ks.copy(this),i),e.r=ks.r,e.g=ks.g,e.b=ks.b,e}getStyle(e=Rs){qo.fromWorkingColorSpace(ks.copy(this),e);const i=ks.r,r=ks.g,s=ks.b;return e!==Rs?`color(${e} ${i.toFixed(3)} ${r.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(r*255)},${Math.round(s*255)})`}offsetHSL(e,i,r){return this.getHSL(Wu),this.setHSL(Wu.h+e,Wu.s+i,Wu.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,r){return this.r=e.r+(i.r-e.r)*r,this.g=e.g+(i.g-e.g)*r,this.b=e.b+(i.b-e.b)*r,this}lerpHSL(e,i){this.getHSL(Wu),e.getHSL(J1);const r=aA(Wu.h,J1.h,i),s=aA(Wu.s,J1.s,i),o=aA(Wu.l,J1.l,i);return this.setHSL(r,s,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,r=this.g,s=this.b,o=e.elements;return this.r=o[0]*i+o[3]*r+o[6]*s,this.g=o[1]*i+o[4]*r+o[7]*s,this.b=o[2]*i+o[5]*r+o[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ks=new $n;$n.NAMES=Y5;let Bce=0;class Xu extends z1{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Bce++}),this.uuid=gl(),this.name="",this.type="Material",this.blending=y5,this.side=U1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=b5,this.blendDst=x5,this.blendEquation=A5,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new $n(0,0,0),this.blendAlpha=0,this.depthFunc=_5,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=O5,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Cg,this.stencilZFail=Cg,this.stencilZPass=Cg,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const r=e[i];if(r===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const s=this[i];if(s===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(r):s&&s.isVector3&&r&&r.isVector3?s.copy(r):this[i]=r}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==y5&&(r.blending=this.blending),this.side!==U1&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==b5&&(r.blendSrc=this.blendSrc),this.blendDst!==x5&&(r.blendDst=this.blendDst),this.blendEquation!==A5&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==_5&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==O5&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Cg&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Cg&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Cg&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function s(o){const a=[];for(const l in o){const c=o[l];delete c.metadata,a.push(c)}return a}if(i){const o=s(e.textures),a=s(e.images);o.length>0&&(r.textures=o),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let r=null;if(i!==null){const s=i.length;r=new Array(s);for(let o=0;o!==s;++o)r[o]=i[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class Lg extends Xu{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new $n(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new jv,this.combine=Lle,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const er=new fe,K1=new Tn;class Jo{constructor(e,i,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=r,this.usage=BP,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=of,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return U5("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,r){e*=this.itemSize,r*=i.itemSize;for(let s=0,o=this.itemSize;s<o;s++)this.array[e+s]=i.array[r+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)K1.fromBufferAttribute(this,i),K1.applyMatrix3(e),this.setXY(i,K1.x,K1.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)er.fromBufferAttribute(this,i),er.applyMatrix3(e),this.setXYZ(i,er.x,er.y,er.z);return this}applyMatrix4(e){for(let i=0,r=this.count;i<r;i++)er.fromBufferAttribute(this,i),er.applyMatrix4(e),this.setXYZ(i,er.x,er.y,er.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)er.fromBufferAttribute(this,i),er.applyNormalMatrix(e),this.setXYZ(i,er.x,er.y,er.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)er.fromBufferAttribute(this,i),er.transformDirection(e),this.setXYZ(i,er.x,er.y,er.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let r=this.array[e*this.itemSize+i];return this.normalized&&(r=vl(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=Bi(r,this.array)),this.array[e*this.itemSize+i]=r,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=vl(i,this.array)),i}setX(e,i){return this.normalized&&(i=Bi(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=vl(i,this.array)),i}setY(e,i){return this.normalized&&(i=Bi(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=vl(i,this.array)),i}setZ(e,i){return this.normalized&&(i=Bi(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=vl(i,this.array)),i}setW(e,i){return this.normalized&&(i=Bi(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=Bi(i,this.array),r=Bi(r,this.array)),this.array[e+0]=i,this.array[e+1]=r,this}setXYZ(e,i,r,s){return e*=this.itemSize,this.normalized&&(i=Bi(i,this.array),r=Bi(r,this.array),s=Bi(s,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=s,this}setXYZW(e,i,r,s,o){return e*=this.itemSize,this.normalized&&(i=Bi(i,this.array),r=Bi(r,this.array),s=Bi(s,this.array),o=Bi(o,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=s,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==BP&&(e.usage=this.usage),e}}class kce extends Jo{constructor(e,i,r){super(new Uint16Array(e),i,r)}}class Oce extends Jo{constructor(e,i,r){super(new Uint32Array(e),i,r)}}class KP extends Jo{constructor(e,i,r){super(new Float32Array(e),i,r)}}let Dce=0;const Ra=new li,ZP=new Xn,Ug=new fe,Ko=new yl,uA=new yl,Tr=new fe;class Hl extends z1{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Dce++}),this.uuid=gl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(vce(e)?Oce:kce)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,r=0){this.groups.push({start:e,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const o=new hu().getNormalMatrix(e);r.applyNormalMatrix(o),r.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ra.makeRotationFromQuaternion(e),this.applyMatrix4(Ra),this}rotateX(e){return Ra.makeRotationX(e),this.applyMatrix4(Ra),this}rotateY(e){return Ra.makeRotationY(e),this.applyMatrix4(Ra),this}rotateZ(e){return Ra.makeRotationZ(e),this.applyMatrix4(Ra),this}translate(e,i,r){return Ra.makeTranslation(e,i,r),this.applyMatrix4(Ra),this}scale(e,i,r){return Ra.makeScale(e,i,r),this.applyMatrix4(Ra),this}lookAt(e){return ZP.lookAt(e),ZP.updateMatrix(),this.applyMatrix4(ZP.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ug).negate(),this.translate(Ug.x,Ug.y,Ug.z),this}setFromPoints(e){const i=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];i.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new KP(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new yl);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new fe(-1/0,-1/0,-1/0),new fe(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let r=0,s=i.length;r<s;r++){const o=i[r];Ko.setFromBufferAttribute(o),this.morphTargetsRelative?(Tr.addVectors(this.boundingBox.min,Ko.min),this.boundingBox.expandByPoint(Tr),Tr.addVectors(this.boundingBox.max,Ko.max),this.boundingBox.expandByPoint(Tr)):(this.boundingBox.expandByPoint(Ko.min),this.boundingBox.expandByPoint(Ko.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new bl);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new fe,1/0);return}if(e){const r=this.boundingSphere.center;if(Ko.setFromBufferAttribute(e),i)for(let o=0,a=i.length;o<a;o++){const l=i[o];uA.setFromBufferAttribute(l),this.morphTargetsRelative?(Tr.addVectors(Ko.min,uA.min),Ko.expandByPoint(Tr),Tr.addVectors(Ko.max,uA.max),Ko.expandByPoint(Tr)):(Ko.expandByPoint(uA.min),Ko.expandByPoint(uA.max))}Ko.getCenter(r);let s=0;for(let o=0,a=e.count;o<a;o++)Tr.fromBufferAttribute(e,o),s=Math.max(s,r.distanceToSquared(Tr));if(i)for(let o=0,a=i.length;o<a;o++){const l=i[o],c=this.morphTargetsRelative;for(let h=0,u=l.count;h<u;h++)Tr.fromBufferAttribute(l,h),c&&(Ug.fromBufferAttribute(e,h),Tr.add(Ug)),s=Math.max(s,r.distanceToSquared(Tr))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=i.position,s=i.normal,o=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Jo(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),l=[],c=[];for(let R=0;R<r.count;R++)l[R]=new fe,c[R]=new fe;const h=new fe,u=new fe,d=new fe,f=new Tn,m=new Tn,g=new Tn,v=new fe,y=new fe;function A(R,B,E){h.fromBufferAttribute(r,R),u.fromBufferAttribute(r,B),d.fromBufferAttribute(r,E),f.fromBufferAttribute(o,R),m.fromBufferAttribute(o,B),g.fromBufferAttribute(o,E),u.sub(h),d.sub(h),m.sub(f),g.sub(f);const P=1/(m.x*g.y-g.x*m.y);isFinite(P)&&(v.copy(u).multiplyScalar(g.y).addScaledVector(d,-m.y).multiplyScalar(P),y.copy(d).multiplyScalar(m.x).addScaledVector(u,-g.x).multiplyScalar(P),l[R].add(v),l[B].add(v),l[E].add(v),c[R].add(y),c[B].add(y),c[E].add(y))}let b=this.groups;b.length===0&&(b=[{start:0,count:e.count}]);for(let R=0,B=b.length;R<B;++R){const E=b[R],P=E.start,O=E.count;for(let N=P,L=P+O;N<L;N+=3)A(e.getX(N+0),e.getX(N+1),e.getX(N+2))}const x=new fe,_=new fe,w=new fe,T=new fe;function M(R){w.fromBufferAttribute(s,R),T.copy(w);const B=l[R];x.copy(B),x.sub(w.multiplyScalar(w.dot(B))).normalize(),_.crossVectors(T,B);const E=_.dot(c[R])<0?-1:1;a.setXYZW(R,x.x,x.y,x.z,E)}for(let R=0,B=b.length;R<B;++R){const E=b[R],P=E.start,O=E.count;for(let N=P,L=P+O;N<L;N+=3)M(e.getX(N+0)),M(e.getX(N+1)),M(e.getX(N+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Jo(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let f=0,m=r.count;f<m;f++)r.setXYZ(f,0,0,0);const s=new fe,o=new fe,a=new fe,l=new fe,c=new fe,h=new fe,u=new fe,d=new fe;if(e)for(let f=0,m=e.count;f<m;f+=3){const g=e.getX(f+0),v=e.getX(f+1),y=e.getX(f+2);s.fromBufferAttribute(i,g),o.fromBufferAttribute(i,v),a.fromBufferAttribute(i,y),u.subVectors(a,o),d.subVectors(s,o),u.cross(d),l.fromBufferAttribute(r,g),c.fromBufferAttribute(r,v),h.fromBufferAttribute(r,y),l.add(u),c.add(u),h.add(u),r.setXYZ(g,l.x,l.y,l.z),r.setXYZ(v,c.x,c.y,c.z),r.setXYZ(y,h.x,h.y,h.z)}else for(let f=0,m=i.count;f<m;f+=3)s.fromBufferAttribute(i,f+0),o.fromBufferAttribute(i,f+1),a.fromBufferAttribute(i,f+2),u.subVectors(a,o),d.subVectors(s,o),u.cross(d),r.setXYZ(f+0,u.x,u.y,u.z),r.setXYZ(f+1,u.x,u.y,u.z),r.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,r=e.count;i<r;i++)Tr.fromBufferAttribute(e,i),Tr.normalize(),e.setXYZ(i,Tr.x,Tr.y,Tr.z)}toNonIndexed(){function e(l,c){const h=l.array,u=l.itemSize,d=l.normalized,f=new h.constructor(c.length*u);let m=0,g=0;for(let v=0,y=c.length;v<y;v++){l.isInterleavedBufferAttribute?m=c[v]*l.data.stride+l.offset:m=c[v]*u;for(let A=0;A<u;A++)f[g++]=h[m++]}return new Jo(f,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Hl,r=this.index.array,s=this.attributes;for(const l in s){const c=s[l],h=e(c,r);i.setAttribute(l,h)}const o=this.morphAttributes;for(const l in o){const c=[],h=o[l];for(let u=0,d=h.length;u<d;u++){const f=h[u],m=e(f,r);c.push(m)}i.morphAttributes[l]=c}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,c=a.length;l<c;l++){const h=a[l];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const h in c)c[h]!==void 0&&(e[h]=c[h]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const c in r){const h=r[c];e.data.attributes[c]=h.toJSON(e.data)}const s={};let o=!1;for(const c in this.morphAttributes){const h=this.morphAttributes[c],u=[];for(let d=0,f=h.length;d<f;d++){const m=h[d];u.push(m.toJSON(e.data))}u.length>0&&(s[c]=u,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(i));const s=e.attributes;for(const h in s){const u=s[h];this.setAttribute(h,u.clone(i))}const o=e.morphAttributes;for(const h in o){const u=[],d=o[h];for(let f=0,m=d.length;f<m;f++)u.push(d[f].clone(i));this.morphAttributes[h]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let h=0,u=a.length;h<u;h++){const d=a[h];this.addGroup(d.start,d.count,d.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const J5=new li,hf=new X1,Z1=new bl,K5=new fe,Fg=new fe,Ng=new fe,zg=new fe,$P=new fe,$1=new fe,eS=new Tn,tS=new Tn,iS=new Tn,Z5=new fe,$5=new fe,e6=new fe,nS=new fe,rS=new fe;class qu extends Xn{constructor(e=new Hl,i=new Lg){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,i){const r=this.geometry,s=r.attributes.position,o=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(s,e);const l=this.morphTargetInfluences;if(o&&l){$1.set(0,0,0);for(let c=0,h=o.length;c<h;c++){const u=l[c],d=o[c];u!==0&&($P.fromBufferAttribute(d,e),a?$1.addScaledVector($P,u):$1.addScaledVector($P.sub(i),u))}i.add($1)}return i}raycast(e,i){const r=this.geometry,s=this.material,o=this.matrixWorld;s!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),Z1.copy(r.boundingSphere),Z1.applyMatrix4(o),hf.copy(e.ray).recast(e.near),!(Z1.containsPoint(hf.origin)===!1&&(hf.intersectSphere(Z1,K5)===null||hf.origin.distanceToSquared(K5)>(e.far-e.near)**2))&&(J5.copy(o).invert(),hf.copy(e.ray).applyMatrix4(J5),!(r.boundingBox!==null&&hf.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,i,hf)))}_computeIntersections(e,i,r){let s;const o=this.geometry,a=this.material,l=o.index,c=o.attributes.position,h=o.attributes.uv,u=o.attributes.uv1,d=o.attributes.normal,f=o.groups,m=o.drawRange;if(l!==null)if(Array.isArray(a))for(let g=0,v=f.length;g<v;g++){const y=f[g],A=a[y.materialIndex],b=Math.max(y.start,m.start),x=Math.min(l.count,Math.min(y.start+y.count,m.start+m.count));for(let _=b,w=x;_<w;_+=3){const T=l.getX(_),M=l.getX(_+1),R=l.getX(_+2);s=sS(this,A,e,r,h,u,d,T,M,R),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=y.materialIndex,i.push(s))}}else{const g=Math.max(0,m.start),v=Math.min(l.count,m.start+m.count);for(let y=g,A=v;y<A;y+=3){const b=l.getX(y),x=l.getX(y+1),_=l.getX(y+2);s=sS(this,a,e,r,h,u,d,b,x,_),s&&(s.faceIndex=Math.floor(y/3),i.push(s))}}else if(c!==void 0)if(Array.isArray(a))for(let g=0,v=f.length;g<v;g++){const y=f[g],A=a[y.materialIndex],b=Math.max(y.start,m.start),x=Math.min(c.count,Math.min(y.start+y.count,m.start+m.count));for(let _=b,w=x;_<w;_+=3){const T=_,M=_+1,R=_+2;s=sS(this,A,e,r,h,u,d,T,M,R),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=y.materialIndex,i.push(s))}}else{const g=Math.max(0,m.start),v=Math.min(c.count,m.start+m.count);for(let y=g,A=v;y<A;y+=3){const b=y,x=y+1,_=y+2;s=sS(this,a,e,r,h,u,d,b,x,_),s&&(s.faceIndex=Math.floor(y/3),i.push(s))}}}}function Lce(n,e,i,r,s,o,a,l){let c;if(e.side===Ole?c=r.intersectTriangle(a,o,s,!0,l):c=r.intersectTriangle(s,o,a,e.side===U1,l),c===null)return null;rS.copy(l),rS.applyMatrix4(n.matrixWorld);const h=i.ray.origin.distanceTo(rS);return h<i.near||h>i.far?null:{distance:h,point:rS.clone(),object:n}}function sS(n,e,i,r,s,o,a,l,c,h){n.getVertexPosition(l,Fg),n.getVertexPosition(c,Ng),n.getVertexPosition(h,zg);const u=Lce(n,e,i,r,Fg,Ng,zg,nS);if(u){s&&(eS.fromBufferAttribute(s,l),tS.fromBufferAttribute(s,c),iS.fromBufferAttribute(s,h),u.uv=qc.getInterpolation(nS,Fg,Ng,zg,eS,tS,iS,new Tn)),o&&(eS.fromBufferAttribute(o,l),tS.fromBufferAttribute(o,c),iS.fromBufferAttribute(o,h),u.uv1=qc.getInterpolation(nS,Fg,Ng,zg,eS,tS,iS,new Tn)),a&&(Z5.fromBufferAttribute(a,l),$5.fromBufferAttribute(a,c),e6.fromBufferAttribute(a,h),u.normal=qc.getInterpolation(nS,Fg,Ng,zg,Z5,$5,e6,new fe),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const d={a:l,b:c,c:h,normal:new fe,materialIndex:0};qc.getNormal(Fg,Ng,zg,d.normal),u.face=d}return u}let t6=class extends Xn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new li,this.projectionMatrix=new li,this.projectionMatrixInverse=new li,this.coordinateSystem=af}copy(n,e){return super.copy(n,e),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this.coordinateSystem=n.coordinateSystem,this}getWorldDirection(n){return super.getWorldDirection(n).negate()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,e){super.updateWorldMatrix(n,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Yu=new fe,i6=new Tn,n6=new Tn;class eB extends t6{constructor(e=50,i=1,r=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=s,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=oA*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(sA*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return oA*2*Math.atan(Math.tan(sA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,r){Yu.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Yu.x,Yu.y).multiplyScalar(-e/Yu.z),Yu.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Yu.x,Yu.y).multiplyScalar(-e/Yu.z)}getViewSize(e,i){return this.getViewBounds(e,i6,n6),i.subVectors(n6,i6)}setViewOffset(e,i,r,s,o,a){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=s,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(sA*.5*this.fov)/this.zoom,r=2*i,s=this.aspect*r,o=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const c=a.fullWidth,h=a.fullHeight;o+=a.offsetX*s/c,i-=a.offsetY*r/h,s*=a.width/c,r*=a.height/h}const l=this.filmOffset;l!==0&&(o+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+s,i,i-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const tB=new fe,Uce=new fe,Fce=new hu;class jg{constructor(e=new fe(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,r,s){return this.normal.set(e,i,r),this.constant=s,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,r){const s=tB.subVectors(r,i).cross(Uce.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const r=e.delta(tB),s=this.normal.dot(r);if(s===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/s;return o<0||o>1?null:i.copy(e.start).addScaledVector(r,o)}intersectsLine(e){const i=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return i<0&&r>0||r<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const r=i||Fce.getNormalMatrix(e),s=this.coplanarPoint(tB).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-s.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const uf=new bl,oS=new fe;class Nce{constructor(e=new jg,i=new jg,r=new jg,s=new jg,o=new jg,a=new jg){this.planes=[e,i,r,s,o,a]}set(e,i,r,s,o,a){const l=this.planes;return l[0].copy(e),l[1].copy(i),l[2].copy(r),l[3].copy(s),l[4].copy(o),l[5].copy(a),this}copy(e){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,i=af){const r=this.planes,s=e.elements,o=s[0],a=s[1],l=s[2],c=s[3],h=s[4],u=s[5],d=s[6],f=s[7],m=s[8],g=s[9],v=s[10],y=s[11],A=s[12],b=s[13],x=s[14],_=s[15];if(r[0].setComponents(c-o,f-h,y-m,_-A).normalize(),r[1].setComponents(c+o,f+h,y+m,_+A).normalize(),r[2].setComponents(c+a,f+u,y+g,_+b).normalize(),r[3].setComponents(c-a,f-u,y-g,_-b).normalize(),r[4].setComponents(c-l,f-d,y-v,_-x).normalize(),i===af)r[5].setComponents(c+l,f+d,y+v,_+x).normalize();else if(i===kP)r[5].setComponents(l,d,v,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),uf.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),uf.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(uf)}intersectsSprite(e){return uf.center.set(0,0,0),uf.radius=.7071067811865476,uf.applyMatrix4(e.matrixWorld),this.intersectsSphere(uf)}intersectsSphere(e){const i=this.planes,r=e.center,s=-e.radius;for(let o=0;o<6;o++)if(i[o].distanceToPoint(r)<s)return!1;return!0}intersectsBox(e){const i=this.planes;for(let r=0;r<6;r++){const s=i[r];if(oS.x=s.normal.x>0?e.max.x:e.min.x,oS.y=s.normal.y>0?e.max.y:e.min.y,oS.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(oS)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class r6 extends t6{constructor(e=-1,i=1,r=1,s=-1,o=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=r,this.bottom=s,this.near=o,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,r,s,o,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=s,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let o=r-e,a=r+e,l=s+i,c=s-i;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=h*this.view.offsetX,a=o+h*this.view.width,l-=u*this.view.offsetY,c=l-u*this.view.height}this.projectionMatrix.makeOrthographic(o,a,l,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class iB extends Xn{constructor(){super(),this.isGroup=!0,this.type="Group"}}class zce{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=BP,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=gl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return U5("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,r){e*=this.stride,r*=i.stride;for(let s=0,o=this.stride;s<o;s++)this.array[e+s]=i.array[r+s];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=gl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=gl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const io=new fe;class wU{constructor(e,i,r,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=r,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,r=this.data.count;i<r;i++)io.fromBufferAttribute(this,i),io.applyMatrix4(e),this.setXYZ(i,io.x,io.y,io.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)io.fromBufferAttribute(this,i),io.applyNormalMatrix(e),this.setXYZ(i,io.x,io.y,io.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)io.fromBufferAttribute(this,i),io.transformDirection(e),this.setXYZ(i,io.x,io.y,io.z);return this}getComponent(e,i){let r=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(r=vl(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=Bi(r,this.array)),this.data.array[e*this.data.stride+this.offset+i]=r,this}setX(e,i){return this.normalized&&(i=Bi(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=Bi(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=Bi(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=Bi(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=vl(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=vl(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=vl(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=vl(i,this.array)),i}setXY(e,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=Bi(i,this.array),r=Bi(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this}setXYZ(e,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=Bi(i,this.array),r=Bi(r,this.array),s=Bi(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=s,this}setXYZW(e,i,r,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(i=Bi(i,this.array),r=Bi(r,this.array),s=Bi(s,this.array),o=Bi(o,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return new Jo(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new wU(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)i.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const s6=new fe,o6=new il,a6=new il,jce=new fe,l6=new li,aS=new fe,nB=new bl,c6=new li,rB=new X1;class Gce extends qu{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=w5,this.bindMatrix=new li,this.bindMatrixInverse=new li,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new yl),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,aS),this.boundingBox.expandByPoint(aS)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new bl),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,aS),this.boundingSphere.expandByPoint(aS)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const r=this.material,s=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),nB.copy(this.boundingSphere),nB.applyMatrix4(s),e.ray.intersectsSphere(nB)!==!1&&(c6.copy(s).invert(),rB.copy(e.ray).applyMatrix4(c6),!(this.boundingBox!==null&&rB.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,rB)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new il,i=this.geometry.attributes.skinWeight;for(let r=0,s=i.count;r<s;r++){e.fromBufferAttribute(i,r);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),i.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===w5?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Ule?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const r=this.skeleton,s=this.geometry;o6.fromBufferAttribute(s.attributes.skinIndex,e),a6.fromBufferAttribute(s.attributes.skinWeight,e),s6.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let o=0;o<4;o++){const a=a6.getComponent(o);if(a!==0){const l=o6.getComponent(o);l6.multiplyMatrices(r.bones[l].matrixWorld,r.boneInverses[l]),i.addScaledVector(jce.copy(s6).applyMatrix4(l6),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class h6 extends Xn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class sB extends Qr{constructor(e=null,i=1,r=1,s,o,a,l,c,h=eA,u=eA,d,f){super(null,a,l,c,h,u,s,o,d,f),this.isDataTexture=!0,this.image={data:e,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const u6=new li,Hce=new li;class SU{constructor(e=[],i=[]){this.uuid=gl(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,s=this.bones.length;r<s;r++)this.boneInverses.push(new li)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const r=new li;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,i=this.boneInverses,r=this.boneMatrices,s=this.boneTexture;for(let o=0,a=e.length;o<a;o++){const l=e[o]?e[o].matrixWorld:Hce;u6.multiplyMatrices(l,i[o]),u6.toArray(r,o*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new SU(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const r=new sB(i,e,e,zu,of);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this}getBoneByName(e){for(let i=0,r=this.bones.length;i<r;i++){const s=this.bones[i];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let r=0,s=e.bones.length;r<s;r++){const o=e.bones[r];let a=i[o];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),a=new h6),this.bones.push(a),this.boneInverses.push(new li().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let s=0,o=i.length;s<o;s++){const a=i[s];e.bones.push(a.uuid);const l=r[s];e.boneInverses.push(l.toArray())}return e}}class oB extends Jo{constructor(e,i,r,s=1){super(e,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Gg=new li,d6=new li,lS=[],p6=new yl,Vce=new li,dA=new qu,pA=new bl;class Qce extends qu{constructor(e,i,r){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new oB(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<r;s++)this.setMatrixAt(s,Vce)}computeBoundingBox(){const e=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new yl),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,Gg),p6.copy(e.boundingBox).applyMatrix4(Gg),this.boundingBox.union(p6)}computeBoundingSphere(){const e=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new bl),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,Gg),pA.copy(e.boundingSphere).applyMatrix4(Gg),this.boundingSphere.union(pA)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,i){const r=i.morphTargetInfluences,s=this.morphTexture.source.data.data,o=r.length+1,a=e*o+1;for(let l=0;l<r.length;l++)r[l]=s[a+l]}raycast(e,i){const r=this.matrixWorld,s=this.count;if(dA.geometry=this.geometry,dA.material=this.material,dA.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),pA.copy(this.boundingSphere),pA.applyMatrix4(r),e.ray.intersectsSphere(pA)!==!1))for(let o=0;o<s;o++){this.getMatrixAt(o,Gg),d6.multiplyMatrices(r,Gg),dA.matrixWorld=d6,dA.raycast(e,lS);for(let a=0,l=lS.length;a<l;a++){const c=lS[a];c.instanceId=o,c.object=this,i.push(c)}lS.length=0}}setColorAt(e,i){this.instanceColor===null&&(this.instanceColor=new oB(new Float32Array(this.instanceMatrix.count*3),3)),i.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,i){const r=i.morphTargetInfluences,s=r.length+1;this.morphTexture===null&&(this.morphTexture=new sB(new Float32Array(s*this.count),s,this.count,Sg,of));const o=this.morphTexture.source.data.data;let a=0;for(let h=0;h<r.length;h++)a+=r[h];const l=this.geometry.morphTargetsRelative?1:1-a,c=s*e;o[c]=l,o.set(r,c+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class f6 extends Xu{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new $n(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const cS=new fe,hS=new fe,m6=new li,fA=new X1,uS=new bl,aB=new fe,g6=new fe;class lB extends Xn{constructor(e=new Hl,i=new f6){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,r=[0];for(let s=1,o=i.count;s<o;s++)cS.fromBufferAttribute(i,s-1),hS.fromBufferAttribute(i,s),r[s]=r[s-1],r[s]+=cS.distanceTo(hS);e.setAttribute("lineDistance",new KP(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const r=this.geometry,s=this.matrixWorld,o=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),uS.copy(r.boundingSphere),uS.applyMatrix4(s),uS.radius+=o,e.ray.intersectsSphere(uS)===!1)return;m6.copy(s).invert(),fA.copy(e.ray).applyMatrix4(m6);const l=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,h=this.isLineSegments?2:1,u=r.index,d=r.attributes.position;if(u!==null){const f=Math.max(0,a.start),m=Math.min(u.count,a.start+a.count);for(let g=f,v=m-1;g<v;g+=h){const y=u.getX(g),A=u.getX(g+1),b=dS(this,e,fA,c,y,A);b&&i.push(b)}if(this.isLineLoop){const g=u.getX(m-1),v=u.getX(f),y=dS(this,e,fA,c,g,v);y&&i.push(y)}}else{const f=Math.max(0,a.start),m=Math.min(d.count,a.start+a.count);for(let g=f,v=m-1;g<v;g+=h){const y=dS(this,e,fA,c,g,g+1);y&&i.push(y)}if(this.isLineLoop){const g=dS(this,e,fA,c,m-1,f);g&&i.push(g)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function dS(n,e,i,r,s,o){const a=n.geometry.attributes.position;if(cS.fromBufferAttribute(a,s),hS.fromBufferAttribute(a,o),i.distanceSqToSegment(cS,hS,aB,g6)>r)return;aB.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(aB);if(!(l<e.near||l>e.far))return{distance:l,point:g6.clone().applyMatrix4(n.matrixWorld),index:s,face:null,faceIndex:null,object:n}}const v6=new fe,y6=new fe;class Wce extends lB{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,r=[];for(let s=0,o=i.count;s<o;s+=2)v6.fromBufferAttribute(i,s),y6.fromBufferAttribute(i,s+1),r[s]=s===0?0:r[s-1],r[s+1]=r[s]+v6.distanceTo(y6);e.setAttribute("lineDistance",new KP(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Xce extends lB{constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class A6 extends Xu{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new $n(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const b6=new li,cB=new X1,pS=new bl,fS=new fe;class qce extends Xn{constructor(e=new Hl,i=new A6){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,i){const r=this.geometry,s=this.matrixWorld,o=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),pS.copy(r.boundingSphere),pS.applyMatrix4(s),pS.radius+=o,e.ray.intersectsSphere(pS)===!1)return;b6.copy(s).invert(),cB.copy(e.ray).applyMatrix4(b6);const l=o/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,h=r.index,u=r.attributes.position;if(h!==null){const d=Math.max(0,a.start),f=Math.min(h.count,a.start+a.count);for(let m=d,g=f;m<g;m++){const v=h.getX(m);fS.fromBufferAttribute(u,v),x6(fS,v,c,s,e,i,this)}}else{const d=Math.max(0,a.start),f=Math.min(u.count,a.start+a.count);for(let m=d,g=f;m<g;m++)fS.fromBufferAttribute(u,m),x6(fS,m,c,s,e,i,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function x6(n,e,i,r,s,o,a){const l=cB.distanceSqToPoint(n);if(l<i){const c=new fe;cB.closestPointToPoint(n,c),c.applyMatrix4(r);const h=s.ray.origin.distanceTo(c);if(h<s.near||h>s.far)return;o.push({distance:h,distanceToRay:Math.sqrt(l),point:c,index:e,face:null,object:a})}}class mS extends Qr{constructor(e,i,r,s,o,a,l,c,h,u,d,f){super(null,a,l,c,h,u,s,o,d,f),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Yce extends mS{constructor(e,i,r,s,o,a){super(e,i,r,o,a),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=sf,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Jce extends mS{constructor(e,i,r){super(void 0,e[0].width,e[0].height,i,r,Fle),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class gS extends Xu{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new $n(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $n(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$le,this.normalScale=new Tn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new jv,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class oc extends gS{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Tn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Bs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new $n(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new $n(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new $n(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function vS(n,e,i){return!n||!i&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function Kce(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Zce(n){function e(s,o){return n[s]-n[o]}const i=n.length,r=new Array(i);for(let s=0;s!==i;++s)r[s]=s;return r.sort(e),r}function _6(n,e,i){const r=n.length,s=new n.constructor(r);for(let o=0,a=0;a!==r;++o){const l=i[o]*e;for(let c=0;c!==e;++c)s[a++]=n[l+c]}return s}function w6(n,e,i,r){let s=1,o=n[0];for(;o!==void 0&&o[r]===void 0;)o=n[s++];if(o===void 0)return;let a=o[r];if(a!==void 0)if(Array.isArray(a))do a=o[r],a!==void 0&&(e.push(o.time),i.push.apply(i,a)),o=n[s++];while(o!==void 0);else if(a.toArray!==void 0)do a=o[r],a!==void 0&&(e.push(o.time),a.toArray(i,i.length)),o=n[s++];while(o!==void 0);else do a=o[r],a!==void 0&&(e.push(o.time),i.push(a)),o=n[s++];while(o!==void 0)}class mA{constructor(e,i,r,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let r=this._cachedIndex,s=i[r],o=i[r-1];e:{t:{let a;i:{n:if(!(e<s)){for(let l=r+2;;){if(s===void 0){if(e<o)break n;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===l)break;if(o=s,s=i[++r],e<s)break t}a=i.length;break i}if(!(e>=o)){const l=i[1];e<l&&(r=2,o=l);for(let c=r-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===c)break;if(s=o,o=i[--r-1],e>=o)break t}a=r,r=0;break i}break e}for(;r<a;){const l=r+a>>>1;e<i[l]?a=l:r=l+1}if(s=i[r],o=i[r-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,o,s)}return this.interpolate_(r,o,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,r=this.sampleValues,s=this.valueSize,o=e*s;for(let a=0;a!==s;++a)i[a]=r[o+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class $ce extends mA{constructor(e,i,r,s){super(e,i,r,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:E5,endingEnd:E5}}intervalChanged_(e,i,r){const s=this.parameterPositions;let o=e-2,a=e+1,l=s[o],c=s[a];if(l===void 0)switch(this.getSettings_().endingStart){case M5:o=e,l=2*i-r;break;case T5:o=s.length-2,l=i+s[o]-s[o+1];break;default:o=e,l=r}if(c===void 0)switch(this.getSettings_().endingEnd){case M5:a=e,c=2*r-i;break;case T5:a=1,c=r+s[1]-s[0];break;default:a=e-1,c=i}const h=(r-i)*.5,u=this.valueSize;this._weightPrev=h/(i-l),this._weightNext=h/(c-r),this._offsetPrev=o*u,this._offsetNext=a*u}interpolate_(e,i,r,s){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=e*l,h=c-l,u=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,m=this._weightNext,g=(r-i)/(s-i),v=g*g,y=v*g,A=-f*y+2*f*v-f*g,b=(1+f)*y+(-1.5-2*f)*v+(-.5+f)*g+1,x=(-1-m)*y+(1.5+m)*v+.5*g,_=m*y-m*v;for(let w=0;w!==l;++w)o[w]=A*a[u+w]+b*a[h+w]+x*a[c+w]+_*a[d+w];return o}}class ehe extends mA{constructor(e,i,r,s){super(e,i,r,s)}interpolate_(e,i,r,s){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=e*l,h=c-l,u=(r-i)/(s-i),d=1-u;for(let f=0;f!==l;++f)o[f]=a[h+f]*d+a[c+f]*u;return o}}class the extends mA{constructor(e,i,r,s){super(e,i,r,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class ac{constructor(e,i,r,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=vS(i,this.TimeBufferType),this.values=vS(r,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(e);else{r={name:e.name,times:vS(e.times,Array),values:vS(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(r.interpolation=s)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new the(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new ehe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new $ce(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case nA:i=this.InterpolantFactoryMethodDiscrete;break;case rA:i=this.InterpolantFactoryMethodLinear;break;case MP:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return nA;case this.InterpolantFactoryMethodLinear:return rA;case this.InterpolantFactoryMethodSmooth:return MP}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let r=0,s=i.length;r!==s;++r)i[r]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let r=0,s=i.length;r!==s;++r)i[r]*=e}return this}trim(e,i){const r=this.times,s=r.length;let o=0,a=s-1;for(;o!==s&&r[o]<e;)++o;for(;a!==-1&&r[a]>i;)--a;if(++a,o!==0||a!==s){o>=a&&(a=Math.max(a,1),o=a-1);const l=this.getValueSize();this.times=r.slice(o,a),this.values=this.values.slice(o*l,a*l)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,s=this.values,o=r.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let l=0;l!==o;l++){const c=r[l];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,c),e=!1;break}if(a!==null&&a>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,c,a),e=!1;break}a=c}if(s!==void 0&&Kce(s))for(let l=0,c=s.length;l!==c;++l){const h=s[l];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,h),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),r=this.getValueSize(),s=this.getInterpolation()===MP,o=e.length-1;let a=1;for(let l=1;l<o;++l){let c=!1;const h=e[l],u=e[l+1];if(h!==u&&(l!==1||h!==e[0]))if(s)c=!0;else{const d=l*r,f=d-r,m=d+r;for(let g=0;g!==r;++g){const v=i[d+g];if(v!==i[f+g]||v!==i[m+g]){c=!0;break}}}if(c){if(l!==a){e[a]=e[l];const d=l*r,f=a*r;for(let m=0;m!==r;++m)i[f+m]=i[d+m]}++a}}if(o>0){e[a]=e[o];for(let l=o*r,c=a*r,h=0;h!==r;++h)i[c+h]=i[l+h];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=i.slice(0,a*r)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),r=this.constructor,s=new r(this.name,e,i);return s.createInterpolant=this.createInterpolant,s}}ac.prototype.TimeBufferType=Float32Array,ac.prototype.ValueBufferType=Float32Array,ac.prototype.DefaultInterpolation=rA;class Hg extends ac{constructor(e,i,r){super(e,i,r)}}Hg.prototype.ValueTypeName="bool",Hg.prototype.ValueBufferType=Array,Hg.prototype.DefaultInterpolation=nA,Hg.prototype.InterpolantFactoryMethodLinear=void 0,Hg.prototype.InterpolantFactoryMethodSmooth=void 0;class S6 extends ac{}S6.prototype.ValueTypeName="color";class Vg extends ac{}Vg.prototype.ValueTypeName="number";class ihe extends mA{constructor(e,i,r,s){super(e,i,r,s)}interpolate_(e,i,r,s){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=(r-i)/(s-i);let h=e*l;for(let u=h+l;h!==u;h+=4)ju.slerpFlat(o,0,a,h-l,a,h,c);return o}}class Qg extends ac{InterpolantFactoryMethodLinear(e){return new ihe(this.times,this.values,this.getValueSize(),e)}}Qg.prototype.ValueTypeName="quaternion",Qg.prototype.InterpolantFactoryMethodSmooth=void 0;class Wg extends ac{constructor(e,i,r){super(e,i,r)}}Wg.prototype.ValueTypeName="string",Wg.prototype.ValueBufferType=Array,Wg.prototype.DefaultInterpolation=nA,Wg.prototype.InterpolantFactoryMethodLinear=void 0,Wg.prototype.InterpolantFactoryMethodSmooth=void 0;class Xg extends ac{}Xg.prototype.ValueTypeName="vector";class nhe{constructor(e="",i=-1,r=[],s=Kle){this.name=e,this.tracks=r,this.duration=i,this.blendMode=s,this.uuid=gl(),this.duration<0&&this.resetDuration()}static parse(e){const i=[],r=e.tracks,s=1/(e.fps||1);for(let a=0,l=r.length;a!==l;++a)i.push(she(r[a]).scale(s));const o=new this(e.name,e.duration,i,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const i=[],r=e.tracks,s={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,a=r.length;o!==a;++o)i.push(ac.toJSON(r[o]));return s}static CreateFromMorphTargetSequence(e,i,r,s){const o=i.length,a=[];for(let l=0;l<o;l++){let c=[],h=[];c.push((l+o-1)%o,l,(l+1)%o),h.push(0,1,0);const u=Zce(c);c=_6(c,1,u),h=_6(h,1,u),!s&&c[0]===0&&(c.push(o),h.push(h[0])),a.push(new Vg(".morphTargetInfluences["+i[l].name+"]",c,h).scale(1/r))}return new this(e,-1,a)}static findByName(e,i){let r=e;if(!Array.isArray(e)){const s=e;r=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<r.length;s++)if(r[s].name===i)return r[s];return null}static CreateClipsFromMorphTargetSequences(e,i,r){const s={},o=/^([\w-]*?)([\d]+)$/;for(let l=0,c=e.length;l<c;l++){const h=e[l],u=h.name.match(o);if(u&&u.length>1){const d=u[1];let f=s[d];f||(s[d]=f=[]),f.push(h)}}const a=[];for(const l in s)a.push(this.CreateFromMorphTargetSequence(l,s[l],i,r));return a}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(u,d,f,m,g){if(f.length!==0){const v=[],y=[];w6(f,v,y,m),v.length!==0&&g.push(new u(d,v,y))}},s=[],o=e.name||"default",a=e.fps||30,l=e.blendMode;let c=e.length||-1;const h=e.hierarchy||[];for(let u=0;u<h.length;u++){const d=h[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let m;for(m=0;m<d.length;m++)if(d[m].morphTargets)for(let g=0;g<d[m].morphTargets.length;g++)f[d[m].morphTargets[g]]=-1;for(const g in f){const v=[],y=[];for(let A=0;A!==d[m].morphTargets.length;++A){const b=d[m];v.push(b.time),y.push(b.morphTarget===g?1:0)}s.push(new Vg(".morphTargetInfluence["+g+"]",v,y))}c=f.length*a}else{const f=".bones["+i[u].name+"]";r(Xg,f+".position",d,"pos",s),r(Qg,f+".quaternion",d,"rot",s),r(Xg,f+".scale",d,"scl",s)}}return s.length===0?null:new this(o,c,s,l)}resetDuration(){const e=this.tracks;let i=0;for(let r=0,s=e.length;r!==s;++r){const o=this.tracks[r];i=Math.max(i,o.times[o.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function rhe(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Vg;case"vector":case"vector2":case"vector3":case"vector4":return Xg;case"color":return S6;case"quaternion":return Qg;case"bool":case"boolean":return Hg;case"string":return Wg}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function she(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=rhe(n.type);if(n.times===void 0){const i=[],r=[];w6(n.keys,i,r,"value"),n.times=i,n.values=r}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Ju={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class ohe{constructor(e,i,r){const s=this;let o=!1,a=0,l=0,c;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=r,this.itemStart=function(u){l++,o===!1&&s.onStart!==void 0&&s.onStart(u,a,l),o=!0},this.itemEnd=function(u){a++,s.onProgress!==void 0&&s.onProgress(u,a,l),a===l&&(o=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,d){return h.push(u,d),this},this.removeHandler=function(u){const d=h.indexOf(u);return d!==-1&&h.splice(d,2),this},this.getHandler=function(u){for(let d=0,f=h.length;d<f;d+=2){const m=h[d],g=h[d+1];if(m.global&&(m.lastIndex=0),m.test(u))return g}return null}}}const ahe=new ohe;class Ku{constructor(e){this.manager=e!==void 0?e:ahe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const r=this;return new Promise(function(s,o){r.load(e,s,i,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ku.DEFAULT_MATERIAL_NAME="__DEFAULT";const xh={};class lhe extends Error{constructor(e,i){super(e),this.response=i}}class df extends Ku{constructor(e){super(e)}load(e,i,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=Ju.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(o),this.manager.itemEnd(e)},0),o;if(xh[e]!==void 0){xh[e].push({onLoad:i,onProgress:r,onError:s});return}xh[e]=[],xh[e].push({onLoad:i,onProgress:r,onError:s});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,c=this.responseType;fetch(a).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const u=xh[e],d=h.body.getReader(),f=h.headers.get("X-File-Size")||h.headers.get("Content-Length"),m=f?parseInt(f):0,g=m!==0;let v=0;const y=new ReadableStream({start(A){b();function b(){d.read().then(({done:x,value:_})=>{if(x)A.close();else{v+=_.byteLength;const w=new ProgressEvent("progress",{lengthComputable:g,loaded:v,total:m});for(let T=0,M=u.length;T<M;T++){const R=u[T];R.onProgress&&R.onProgress(w)}A.enqueue(_),b()}},x=>{A.error(x)})}}});return new Response(y)}else throw new lhe(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(c){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(u=>new DOMParser().parseFromString(u,l));case"json":return h.json();default:if(l===void 0)return h.text();{const u=/charset="?([^;"\s]*)"?/i.exec(l),d=u&&u[1]?u[1].toLowerCase():void 0,f=new TextDecoder(d);return h.arrayBuffer().then(m=>f.decode(m))}}}).then(h=>{Ju.add(e,h);const u=xh[e];delete xh[e];for(let d=0,f=u.length;d<f;d++){const m=u[d];m.onLoad&&m.onLoad(h)}}).catch(h=>{const u=xh[e];if(u===void 0)throw this.manager.itemError(e),h;delete xh[e];for(let d=0,f=u.length;d<f;d++){const m=u[d];m.onError&&m.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class che extends Ku{constructor(e){super(e)}load(e,i,r,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,a=Ju.get(e);if(a!==void 0)return o.manager.itemStart(e),setTimeout(function(){i&&i(a),o.manager.itemEnd(e)},0),a;const l=LP("img");function c(){u(),Ju.add(e,this),i&&i(this),o.manager.itemEnd(e)}function h(d){u(),s&&s(d),o.manager.itemError(e),o.manager.itemEnd(e)}function u(){l.removeEventListener("load",c,!1),l.removeEventListener("error",h,!1)}return l.addEventListener("load",c,!1),l.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),o.manager.itemStart(e),l.src=e,l}}class C6 extends Ku{constructor(e){super(e)}load(e,i,r,s){const o=new Qr,a=new che(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(l){o.image=l,o.needsUpdate=!0,i!==void 0&&i(o)},r,s),o}}let hB=class extends Xn{constructor(n,e=1){super(),this.isLight=!0,this.type="Light",this.color=new $n(n),this.intensity=e}dispose(){}copy(n,e){return super.copy(n,e),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const e=super.toJSON(n);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}};const uB=new li,E6=new fe,M6=new fe;class dB{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Tn(512,512),this.map=null,this.mapPass=null,this.matrix=new li,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Nce,this._frameExtents=new Tn(1,1),this._viewportCount=1,this._viewports=[new il(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,r=this.matrix;E6.setFromMatrixPosition(e.matrixWorld),i.position.copy(E6),M6.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(M6),i.updateMatrixWorld(),uB.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(uB),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(uB)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class hhe extends dB{constructor(){super(new eB(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,r=oA*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,o=e.distance||i.far;(r!==i.fov||s!==i.aspect||o!==i.far)&&(i.fov=r,i.aspect=s,i.far=o,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class uhe extends hB{constructor(e,i,r=0,s=Math.PI/3,o=0,a=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Xn.DEFAULT_UP),this.updateMatrix(),this.target=new Xn,this.distance=r,this.angle=s,this.penumbra=o,this.decay=a,this.map=null,this.shadow=new hhe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const T6=new li,gA=new fe,pB=new fe;class dhe extends dB{constructor(){super(new eB(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Tn(4,2),this._viewportCount=6,this._viewports=[new il(2,1,1,1),new il(0,1,1,1),new il(3,1,1,1),new il(1,1,1,1),new il(3,0,1,1),new il(1,0,1,1)],this._cubeDirections=[new fe(1,0,0),new fe(-1,0,0),new fe(0,0,1),new fe(0,0,-1),new fe(0,1,0),new fe(0,-1,0)],this._cubeUps=[new fe(0,1,0),new fe(0,1,0),new fe(0,1,0),new fe(0,1,0),new fe(0,0,1),new fe(0,0,-1)]}updateMatrices(e,i=0){const r=this.camera,s=this.matrix,o=e.distance||r.far;o!==r.far&&(r.far=o,r.updateProjectionMatrix()),gA.setFromMatrixPosition(e.matrixWorld),r.position.copy(gA),pB.copy(r.position),pB.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(pB),r.updateMatrixWorld(),s.makeTranslation(-gA.x,-gA.y,-gA.z),T6.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(T6)}}class phe extends hB{constructor(e,i,r=0,s=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=s,this.shadow=new dhe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class fhe extends dB{constructor(){super(new r6(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class mhe extends hB{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Xn.DEFAULT_UP),this.updateMatrix(),this.target=new Xn,this.shadow=new fhe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class vA{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let i="";for(let r=0,s=e.length;r<s;r++)i+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}class ghe extends Ku{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,i,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,a=Ju.get(e);if(a!==void 0){if(o.manager.itemStart(e),a.then){a.then(h=>{i&&i(h),o.manager.itemEnd(e)}).catch(h=>{s&&s(h)});return}return setTimeout(function(){i&&i(a),o.manager.itemEnd(e)},0),a}const l={};l.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",l.headers=this.requestHeader;const c=fetch(e,l).then(function(h){return h.blob()}).then(function(h){return createImageBitmap(h,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(h){return Ju.add(e,h),i&&i(h),o.manager.itemEnd(e),h}).catch(function(h){s&&s(h),Ju.remove(e),o.manager.itemError(e),o.manager.itemEnd(e)});Ju.add(e,c),o.manager.itemStart(e)}}class vhe{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=I6(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=I6();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function I6(){return(typeof performance>"u"?Date:performance).now()}const fB="\\[\\]\\.:\\/",yhe=new RegExp("["+fB+"]","g"),mB="[^"+fB+"]",Ahe="[^"+fB.replace("\\.","")+"]",bhe=/((?:WC+[\/:])*)/.source.replace("WC",mB),xhe=/(WCOD+)?/.source.replace("WCOD",Ahe),_he=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",mB),whe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",mB),She=new RegExp("^"+bhe+xhe+_he+whe+"$"),Che=["material","materials","bones","map"];class Ehe{constructor(e,i,r){const s=r||Di.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,s)}getValue(e,i){this.bind();const r=this._targetGroup.nCachedObjects_,s=this._bindings[r];s!==void 0&&s.getValue(e,i)}setValue(e,i){const r=this._bindings;for(let s=this._targetGroup.nCachedObjects_,o=r.length;s!==o;++s)r[s].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].unbind()}}class Di{constructor(e,i,r){this.path=i,this.parsedPath=r||Di.parseTrackName(i),this.node=Di.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,r){return e&&e.isAnimationObjectGroup?new Di.Composite(e,i,r):new Di(e,i,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(yhe,"")}static parseTrackName(e){const i=She.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const o=r.nodeName.substring(s+1);Che.indexOf(o)!==-1&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=o)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(i);if(r!==void 0)return r}if(e.children){const r=function(o){for(let a=0;a<o.length;a++){const l=o[a];if(l.name===i||l.uuid===i)return l;const c=r(l.children);if(c)return c}return null},s=r(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)e[i++]=r[s]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,r=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(e||(e=Di.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let h=i.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===h){h=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const a=e[s];if(a===void 0){const h=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+s+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?l=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(o!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Di.Composite=Ehe,Di.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Di.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Di.prototype.GetterByBindingType=[Di.prototype._getValue_direct,Di.prototype._getValue_array,Di.prototype._getValue_arrayElement,Di.prototype._getValue_toArray],Di.prototype.SetterByBindingTypeAndVersioning=[[Di.prototype._setValue_direct,Di.prototype._setValue_direct_setNeedsUpdate,Di.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Di.prototype._setValue_array,Di.prototype._setValue_array_setNeedsUpdate,Di.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Di.prototype._setValue_arrayElement,Di.prototype._setValue_arrayElement_setNeedsUpdate,Di.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Di.prototype._setValue_fromArray,Di.prototype._setValue_fromArray_setNeedsUpdate,Di.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:v5}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=v5);function R6(n,e){if(e===Zle)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===TP||e===I5){let i=n.getIndex();if(i===null){const a=[],l=n.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)a.push(c);n.setIndex(a),i=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const r=i.count-2,s=[];if(e===TP)for(let a=1;a<=r;a++)s.push(i.getX(0)),s.push(i.getX(a)),s.push(i.getX(a+1));else for(let a=0;a<r;a++)a%2===0?(s.push(i.getX(a)),s.push(i.getX(a+1)),s.push(i.getX(a+2))):(s.push(i.getX(a+2)),s.push(i.getX(a+1)),s.push(i.getX(a)));s.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=n.clone();return o.setIndex(s),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}let Mhe=class extends Ku{constructor(n){super(n),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Bhe(e)}),this.register(function(e){return new khe(e)}),this.register(function(e){return new Ghe(e)}),this.register(function(e){return new Hhe(e)}),this.register(function(e){return new Vhe(e)}),this.register(function(e){return new Dhe(e)}),this.register(function(e){return new Lhe(e)}),this.register(function(e){return new Uhe(e)}),this.register(function(e){return new Fhe(e)}),this.register(function(e){return new Phe(e)}),this.register(function(e){return new Nhe(e)}),this.register(function(e){return new Ohe(e)}),this.register(function(e){return new jhe(e)}),this.register(function(e){return new zhe(e)}),this.register(function(e){return new Ihe(e)}),this.register(function(e){return new Qhe(e)}),this.register(function(e){return new Whe(e)})}load(n,e,i,r){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=vA.extractUrlBase(n);o=vA.resolveURL(c,this.path)}else o=vA.extractUrlBase(n);this.manager.itemStart(n);const a=function(c){r?r(c):console.error(c),s.manager.itemError(n),s.manager.itemEnd(n)},l=new df(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(n,function(c){try{s.parse(c,o,function(h){e(h),s.manager.itemEnd(n)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(n){return this.dracoLoader=n,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(n){return this.ktx2Loader=n,this}setMeshoptDecoder(n){return this.meshoptDecoder=n,this}register(n){return this.pluginCallbacks.indexOf(n)===-1&&this.pluginCallbacks.push(n),this}unregister(n){return this.pluginCallbacks.indexOf(n)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(n),1),this}parse(n,e,i,r){let s;const o={},a={},l=new TextDecoder;if(typeof n=="string")s=JSON.parse(n);else if(n instanceof ArrayBuffer)if(l.decode(new Uint8Array(n,0,4))===P6){try{o[oi.KHR_BINARY_GLTF]=new Xhe(n)}catch(h){r&&r(h);return}s=JSON.parse(o[oi.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(n));else s=n;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new oue(s,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(s.extensionsUsed)for(let h=0;h<s.extensionsUsed.length;++h){const u=s.extensionsUsed[h],d=s.extensionsRequired||[];switch(u){case oi.KHR_MATERIALS_UNLIT:o[u]=new Rhe;break;case oi.KHR_DRACO_MESH_COMPRESSION:o[u]=new qhe(s,this.dracoLoader);break;case oi.KHR_TEXTURE_TRANSFORM:o[u]=new Yhe;break;case oi.KHR_MESH_QUANTIZATION:o[u]=new Jhe;break;default:d.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,r)}parseAsync(n,e){const i=this;return new Promise(function(r,s){i.parse(n,e,r,s)})}};function The(){let n={};return{get:function(e){return n[e]},add:function(e,i){n[e]=i},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const oi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let Ihe=class{constructor(n){this.parser=n,this.name=oi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser,e=this.parser.json.nodes||[];for(let i=0,r=e.length;i<r;i++){const s=e[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&n._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(n){const e=this.parser,i="light:"+n;let r=e.cache.get(i);if(r)return r;const s=e.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[n];let a;const l=new $n(16777215);o.color!==void 0&&l.setRGB(o.color[0],o.color[1],o.color[2],Eo);const c=o.range!==void 0?o.range:0;switch(o.type){case"directional":a=new mhe(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new phe(l),a.distance=c;break;case"spot":a=new uhe(l),a.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,_h(a,o),o.intensity!==void 0&&(a.intensity=o.intensity),a.name=e.createUniqueName(o.name||"light_"+n),r=Promise.resolve(a),e.cache.add(i,r),r}getDependency(n,e){if(n==="light")return this._loadLight(e)}createNodeAttachment(n){const e=this,i=this.parser,r=i.json.nodes[n],s=(r.extensions&&r.extensions[this.name]||{}).light;return s===void 0?null:this._loadLight(s).then(function(o){return i._getNodeRef(e.cache,s,o)})}},Rhe=class{constructor(){this.name=oi.KHR_MATERIALS_UNLIT}getMaterialType(){return Lg}extendParams(n,e,i){const r=[];n.color=new $n(1,1,1),n.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;n.color.setRGB(o[0],o[1],o[2],Eo),n.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(n,"map",s.baseColorTexture,Rs))}return Promise.all(r)}},Phe=class{constructor(n){this.parser=n,this.name=oi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return r!==void 0&&(e.emissiveIntensity=r),Promise.resolve()}},Bhe=class{constructor(n){this.parser=n,this.name=oi.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:oc}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Tn(a,a)}return Promise.all(s)}};class khe{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oc}extendMaterialParams(e,i){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return i.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}let Ohe=class{constructor(n){this.parser=n,this.name=oi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:oc}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(i.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}},Dhe=class{constructor(n){this.parser=n,this.name=oi.KHR_MATERIALS_SHEEN}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:oc}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];e.sheenColor=new $n(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],Eo)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture,Rs)),o.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}},Lhe=class{constructor(n){this.parser=n,this.name=oi.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:oc}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(i.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(s)}},Uhe=class{constructor(n){this.parser=n,this.name=oi.KHR_MATERIALS_VOLUME}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:oc}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new $n().setRGB(a[0],a[1],a[2],Eo),Promise.all(s)}},Fhe=class{constructor(n){this.parser=n,this.name=oi.KHR_MATERIALS_IOR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:oc}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return e.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},Nhe=class{constructor(n){this.parser=n,this.name=oi.KHR_MATERIALS_SPECULAR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:oc}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new $n().setRGB(a[0],a[1],a[2],Eo),o.specularColorTexture!==void 0&&s.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture,Rs)),Promise.all(s)}},zhe=class{constructor(n){this.parser=n,this.name=oi.EXT_MATERIALS_BUMP}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:oc}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(i.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(s)}},jhe=class{constructor(n){this.parser=n,this.name=oi.KHR_MATERIALS_ANISOTROPY}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:oc}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(i.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}},Ghe=class{constructor(n){this.parser=n,this.name=oi.KHR_TEXTURE_BASISU}loadTexture(n){const e=this.parser,i=e.json,r=i.textures[n];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=e.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(n,s.source,o)}},Hhe=class{constructor(n){this.parser=n,this.name=oi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(n){const e=this.name,i=this.parser,r=i.json,s=r.textures[n];if(!s.extensions||!s.extensions[e])return null;const o=s.extensions[e],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(n,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(n)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(n){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){n(e.height===1)}})),this.isSupported}},Vhe=class{constructor(n){this.parser=n,this.name=oi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(n){const e=this.name,i=this.parser,r=i.json,s=r.textures[n];if(!s.extensions||!s.extensions[e])return null;const o=s.extensions[e],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(n,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(n)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(n){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){n(e.height===1)}})),this.isSupported}},Qhe=class{constructor(n){this.name=oi.EXT_MESHOPT_COMPRESSION,this.parser=n}loadBufferView(n){const e=this.parser.json,i=e.bufferViews[n];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=r.byteOffset||0,c=r.byteLength||0,h=r.count,u=r.byteStride,d=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,u,d,r.mode,r.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(h*u);return o.decodeGltfBuffer(new Uint8Array(f),h,u,d,r.mode,r.filter),f})})}else return null}},Whe=class{constructor(n){this.name=oi.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const e=this.parser.json,i=e.nodes[n];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const r=e.meshes[i.mesh];for(const l of r.primitives)if(l.mode!==Pa.TRIANGLES&&l.mode!==Pa.TRIANGLE_STRIP&&l.mode!==Pa.TRIANGLE_FAN&&l.mode!==void 0)return null;const s=i.extensions[this.name].attributes,o=[],a={};for(const l in s)o.push(this.parser.getDependency("accessor",s[l]).then(c=>(a[l]=c,a[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(n)),Promise.all(o).then(l=>{const c=l.pop(),h=c.isGroup?c.children:[c],u=l[0].count,d=[];for(const f of h){const m=new li,g=new fe,v=new ju,y=new fe(1,1,1),A=new Qce(f.geometry,f.material,u);for(let b=0;b<u;b++)a.TRANSLATION&&g.fromBufferAttribute(a.TRANSLATION,b),a.ROTATION&&v.fromBufferAttribute(a.ROTATION,b),a.SCALE&&y.fromBufferAttribute(a.SCALE,b),A.setMatrixAt(b,m.compose(g,v,y));for(const b in a)if(b==="_COLOR_0"){const x=a[b];A.instanceColor=new oB(x.array,x.itemSize,x.normalized)}else b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&f.geometry.setAttribute(b,a[b]);Xn.prototype.copy.call(A,f),this.parser.assignFinalMaterial(A),d.push(A)}return c.isGroup?(c.clear(),c.add(...d),c):d[0]}))}};const P6="glTF",yA=12,B6={JSON:1313821514,BIN:5130562};let Xhe=class{constructor(n){this.name=oi.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(n,0,yA),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(n.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==P6)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-yA,s=new DataView(n,yA);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const l=s.getUint32(o,!0);if(o+=4,l===B6.JSON){const c=new Uint8Array(n,yA+o,a);this.content=i.decode(c)}else if(l===B6.BIN){const c=yA+o;this.body=n.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},qhe=class{constructor(n,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=oi.KHR_DRACO_MESH_COMPRESSION,this.json=n,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(n,e){const i=this.json,r=this.dracoLoader,s=n.extensions[this.name].bufferView,o=n.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const u=vB[h]||h.toLowerCase();a[u]=o[h]}for(const h in n.attributes){const u=vB[h]||h.toLowerCase();if(o[h]!==void 0){const d=i.accessors[n.attributes[h]],f=qg[d.componentType];c[u]=f.name,l[u]=d.normalized===!0}}return e.getDependency("bufferView",s).then(function(h){return new Promise(function(u,d){r.decodeDracoFile(h,function(f){for(const m in f.attributes){const g=f.attributes[m],v=l[m];v!==void 0&&(g.normalized=v)}u(f)},a,c,Eo,d)})})}},Yhe=class{constructor(){this.name=oi.KHR_TEXTURE_TRANSFORM}extendTexture(n,e){return(e.texCoord===void 0||e.texCoord===n.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(n=n.clone(),e.texCoord!==void 0&&(n.channel=e.texCoord),e.offset!==void 0&&n.offset.fromArray(e.offset),e.rotation!==void 0&&(n.rotation=e.rotation),e.scale!==void 0&&n.repeat.fromArray(e.scale),n.needsUpdate=!0),n}},Jhe=class{constructor(){this.name=oi.KHR_MESH_QUANTIZATION}},k6=class extends mA{constructor(n,e,i,r){super(n,e,i,r)}copySampleValue_(n){const e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=n*r*3+r;for(let o=0;o!==r;o++)e[o]=i[s+o];return e}interpolate_(n,e,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=r-e,u=(i-e)/h,d=u*u,f=d*u,m=n*c,g=m-c,v=-2*f+3*d,y=f-d,A=1-v,b=y-d+u;for(let x=0;x!==a;x++){const _=o[g+x+a],w=o[g+x+l]*h,T=o[m+x+a],M=o[m+x]*h;s[x]=A*_+b*w+v*T+y*M}return s}};const Khe=new ju;let Zhe=class extends k6{interpolate_(n,e,i,r){const s=super.interpolate_(n,e,i,r);return Khe.fromArray(s).normalize().toArray(s),s}};const Pa={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},qg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},O6={9728:eA,9729:tA,9984:Nle,9985:jle,9986:zle,9987:F1},D6={33071:sf,33648:EP,10497:$y},gB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vB={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Zu={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},$he={CUBICSPLINE:void 0,LINEAR:rA,STEP:nA},yB={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function eue(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new gS({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:U1})),n.DefaultMaterial}function pf(n,e,i){for(const r in i.extensions)n[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=i.extensions[r])}function _h(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function tue(n,e,i){let r=!1,s=!1,o=!1;for(let h=0,u=e.length;h<u;h++){const d=e[h];if(d.POSITION!==void 0&&(r=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(o=!0),r&&s&&o)break}if(!r&&!s&&!o)return Promise.resolve(n);const a=[],l=[],c=[];for(let h=0,u=e.length;h<u;h++){const d=e[h];if(r){const f=d.POSITION!==void 0?i.getDependency("accessor",d.POSITION):n.attributes.position;a.push(f)}if(s){const f=d.NORMAL!==void 0?i.getDependency("accessor",d.NORMAL):n.attributes.normal;l.push(f)}if(o){const f=d.COLOR_0!==void 0?i.getDependency("accessor",d.COLOR_0):n.attributes.color;c.push(f)}}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(h){const u=h[0],d=h[1],f=h[2];return r&&(n.morphAttributes.position=u),s&&(n.morphAttributes.normal=d),o&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n})}function iue(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let i=0,r=e.weights.length;i<r;i++)n.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(n.morphTargetInfluences.length===i.length){n.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++)n.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function nue(n){let e;const i=n.extensions&&n.extensions[oi.KHR_DRACO_MESH_COMPRESSION];if(i?e="draco:"+i.bufferView+":"+i.indices+":"+AB(i.attributes):e=n.indices+":"+AB(n.attributes)+":"+n.mode,n.targets!==void 0)for(let r=0,s=n.targets.length;r<s;r++)e+=":"+AB(n.targets[r]);return e}function AB(n){let e="";const i=Object.keys(n).sort();for(let r=0,s=i.length;r<s;r++)e+=i[r]+":"+n[i[r]]+";";return e}function bB(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function rue(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const sue=new li;let oue=class{constructor(n={},e={}){this.json=n,this.extensions={},this.plugins={},this.options=e,this.cache=new The,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=-1,s=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);r=i&&l?parseInt(l[1],10):-1,s=a.indexOf("Firefox")>-1,o=s?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&r<17||s&&o<98?this.textureLoader=new C6(this.options.manager):this.textureLoader=new ghe(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new df(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(n){this.extensions=n}setPlugins(n){this.plugins=n}parse(n,e){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};return pf(s,a,r),_h(a,r),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();n(a)})}).catch(e)}_markDefs(){const n=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=e.length;r<s;r++){const o=e[r].joints;for(let a=0,l=o.length;a<l;a++)n[o[a]].isBone=!0}for(let r=0,s=n.length;r<s;r++){const o=n[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(n,e){e!==void 0&&(n.refs[e]===void 0&&(n.refs[e]=n.uses[e]=0),n.refs[e]++)}_getNodeRef(n,e,i){if(n.refs[e]<=1)return i;const r=i.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())s(h,a.children[c])};return s(i,r),r.name+="_instance_"+n.uses[e]++,r}_invokeOne(n){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const r=n(e[i]);if(r)return r}return null}_invokeAll(n){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let r=0;r<e.length;r++){const s=n(e[r]);s&&i.push(s)}return i}getDependency(n,e){const i=n+":"+e;let r=this.cache.get(i);if(!r){switch(n){case"scene":r=this.loadScene(e);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(e)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(e)});break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(e)});break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(e)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(e)});break;case"skin":r=this.loadSkin(e);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(e)});break;case"camera":r=this.loadCamera(e);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(n,e)}),!r)throw new Error("Unknown type: "+n);break}this.cache.add(i,r)}return r}getDependencies(n){let e=this.cache.get(n);if(!e){const i=this,r=this.json[n+(n==="mesh"?"es":"s")]||[];e=Promise.all(r.map(function(s,o){return i.getDependency(n,o)})),this.cache.add(n,e)}return e}loadBuffer(n){const e=this.json.buffers[n],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&n===0)return Promise.resolve(this.extensions[oi.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(vA.resolveURL(e.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(n){const e=this.json.bufferViews[n];return this.getDependency("buffer",e.buffer).then(function(i){const r=e.byteLength||0,s=e.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(n){const e=this,i=this.json,r=this.json.accessors[n];if(r.bufferView===void 0&&r.sparse===void 0){const o=gB[r.type],a=qg[r.componentType],l=r.normalized===!0,c=new a(r.count*o);return Promise.resolve(new Jo(c,o,l))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=gB[r.type],c=qg[r.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=r.byteOffset||0,f=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,m=r.normalized===!0;let g,v;if(f&&f!==u){const y=Math.floor(d/f),A="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+y+":"+r.count;let b=e.cache.get(A);b||(g=new c(a,y*f,r.count*f/h),b=new zce(g,f/h),e.cache.add(A,b)),v=new wU(b,l,d%f/h,m)}else a===null?g=new c(r.count*l):g=new c(a,d,r.count*l),v=new Jo(g,l,m);if(r.sparse!==void 0){const y=gB.SCALAR,A=qg[r.sparse.indices.componentType],b=r.sparse.indices.byteOffset||0,x=r.sparse.values.byteOffset||0,_=new A(o[1],b,r.sparse.count*y),w=new c(o[2],x,r.sparse.count*l);a!==null&&(v=new Jo(v.array.slice(),v.itemSize,v.normalized));for(let T=0,M=_.length;T<M;T++){const R=_[T];if(v.setX(R,w[T*l]),l>=2&&v.setY(R,w[T*l+1]),l>=3&&v.setZ(R,w[T*l+2]),l>=4&&v.setW(R,w[T*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(n){const e=this.json,i=this.options,r=e.textures[n].source,s=e.images[r];let o=this.textureLoader;if(s.uri){const a=i.manager.getHandler(s.uri);a!==null&&(o=a)}return this.loadTextureImage(n,r,o)}loadTextureImage(n,e,i){const r=this,s=this.json,o=s.textures[n],a=s.images[e],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(e,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const u=(s.samplers||{})[o.sampler]||{};return h.magFilter=O6[u.magFilter]||tA,h.minFilter=O6[u.minFilter]||F1,h.wrapS=D6[u.wrapS]||$y,h.wrapT=D6[u.wrapT]||$y,r.associations.set(h,{textures:n}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(n,e){const i=this,r=this.json,s=this.options;if(this.sourceCache[n]!==void 0)return this.sourceCache[n].then(u=>u.clone());const o=r.images[n],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(u){c=!0;const d=new Blob([u],{type:o.mimeType});return l=a.createObjectURL(d),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(d,f){let m=d;e.isImageBitmapLoader===!0&&(m=function(g){const v=new Qr(g);v.needsUpdate=!0,d(v)}),e.load(vA.resolveURL(u,s.path),m,void 0,f)})}).then(function(u){return c===!0&&a.revokeObjectURL(l),_h(u,o),u.userData.mimeType=o.mimeType||rue(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[n]=h,h}assignTexture(n,e,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),s.extensions[oi.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[oi.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[oi.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return r!==void 0&&(o.colorSpace=r),n[e]=o,o})}assignFinalMaterial(n){const e=n.geometry;let i=n.material;const r=e.attributes.tangent===void 0,s=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(n.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new A6,Xu.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(n.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new f6,Xu.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(r||s||o){let a="ClonedMaterial:"+i.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}n.material=i}getMaterialType(){return gS}loadMaterial(n){const e=this,i=this.json,r=this.extensions,s=i.materials[n];let o;const a={},l=s.extensions||{},c=[];if(l[oi.KHR_MATERIALS_UNLIT]){const u=r[oi.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),c.push(u.extendParams(a,s,e))}else{const u=s.pbrMetallicRoughness||{};if(a.color=new $n(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],Eo),a.opacity=d[3]}u.baseColorTexture!==void 0&&c.push(e.assignTexture(a,"map",u.baseColorTexture,Rs)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(e.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(e.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(n)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(n,a)})))}s.doubleSided===!0&&(a.side=Dle);const h=s.alphaMode||yB.OPAQUE;if(h===yB.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===yB.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==Lg&&(c.push(e.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Tn(1,1),s.normalTexture.scale!==void 0)){const u=s.normalTexture.scale;a.normalScale.set(u,u)}if(s.occlusionTexture!==void 0&&o!==Lg&&(c.push(e.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==Lg){const u=s.emissiveFactor;a.emissive=new $n().setRGB(u[0],u[1],u[2],Eo)}return s.emissiveTexture!==void 0&&o!==Lg&&c.push(e.assignTexture(a,"emissiveMap",s.emissiveTexture,Rs)),Promise.all(c).then(function(){const u=new o(a);return s.name&&(u.name=s.name),_h(u,s),e.associations.set(u,{materials:n}),s.extensions&&pf(r,u,s),u})}createUniqueName(n){const e=Di.sanitizeNodeName(n||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(n){const e=this,i=this.extensions,r=this.primitiveCache;function s(a){return i[oi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(l){return L6(l,a,e)})}const o=[];for(let a=0,l=n.length;a<l;a++){const c=n[a],h=nue(c),u=r[h];if(u)o.push(u.promise);else{let d;c.extensions&&c.extensions[oi.KHR_DRACO_MESH_COMPRESSION]?d=s(c):d=L6(new Hl,c,e),r[h]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(n){const e=this,i=this.json,r=this.extensions,s=i.meshes[n],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?eue(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(e.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let f=0,m=h.length;f<m;f++){const g=h[f],v=o[f];let y;const A=c[f];if(v.mode===Pa.TRIANGLES||v.mode===Pa.TRIANGLE_STRIP||v.mode===Pa.TRIANGLE_FAN||v.mode===void 0)y=s.isSkinnedMesh===!0?new Gce(g,A):new qu(g,A),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),v.mode===Pa.TRIANGLE_STRIP?y.geometry=R6(y.geometry,I5):v.mode===Pa.TRIANGLE_FAN&&(y.geometry=R6(y.geometry,TP));else if(v.mode===Pa.LINES)y=new Wce(g,A);else if(v.mode===Pa.LINE_STRIP)y=new lB(g,A);else if(v.mode===Pa.LINE_LOOP)y=new Xce(g,A);else if(v.mode===Pa.POINTS)y=new qce(g,A);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&iue(y,s),y.name=e.createUniqueName(s.name||"mesh_"+n),_h(y,s),v.extensions&&pf(r,y,v),e.assignFinalMaterial(y),u.push(y)}for(let f=0,m=u.length;f<m;f++)e.associations.set(u[f],{meshes:n,primitives:f});if(u.length===1)return s.extensions&&pf(r,u[0],s),u[0];const d=new iB;s.extensions&&pf(r,d,s),e.associations.set(d,{meshes:n});for(let f=0,m=u.length;f<m;f++)d.add(u[f]);return d})}loadCamera(n){let e;const i=this.json.cameras[n],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new eB(gce.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(e=new r6(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),_h(e,i),Promise.resolve(e)}loadSkin(n){const e=this.json.skins[n],i=[];for(let r=0,s=e.joints.length;r<s;r++)i.push(this._loadNodeShallow(e.joints[r]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const u=o[c];if(u){a.push(u);const d=new li;s!==null&&d.fromArray(s.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[c])}return new SU(a,l)})}loadAnimation(n){const e=this.json,i=this,r=e.animations[n],s=r.name?r.name:"animation_"+n,o=[],a=[],l=[],c=[],h=[];for(let u=0,d=r.channels.length;u<d;u++){const f=r.channels[u],m=r.samplers[f.sampler],g=f.target,v=g.node,y=r.parameters!==void 0?r.parameters[m.input]:m.input,A=r.parameters!==void 0?r.parameters[m.output]:m.output;g.node!==void 0&&(o.push(this.getDependency("node",v)),a.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",A)),c.push(m),h.push(g))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(u){const d=u[0],f=u[1],m=u[2],g=u[3],v=u[4],y=[];for(let A=0,b=d.length;A<b;A++){const x=d[A],_=f[A],w=m[A],T=g[A],M=v[A];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const R=i._createAnimationTracks(x,_,w,T,M);if(R)for(let B=0;B<R.length;B++)y.push(R[B])}return new nhe(s,void 0,y)})}createNodeMesh(n){const e=this.json,i=this,r=e.nodes[n];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=r.weights.length;l<c;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(n){const e=this.json,i=this,r=e.nodes[n],s=i._loadNodeShallow(n),o=[],a=r.children||[];for(let c=0,h=a.length;c<h;c++)o.push(i.getDependency("node",a[c]));const l=r.skin===void 0?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const h=c[0],u=c[1],d=c[2];d!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(d,sue)});for(let f=0,m=u.length;f<m;f++)h.add(u[f]);return h})}_loadNodeShallow(n){const e=this.json,i=this.extensions,r=this;if(this.nodeCache[n]!==void 0)return this.nodeCache[n];const s=e.nodes[n],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(n)});return l&&a.push(l),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(n)}).forEach(function(c){a.push(c)}),this.nodeCache[n]=Promise.all(a).then(function(c){let h;if(s.isBone===!0?h=new h6:c.length>1?h=new iB:c.length===1?h=c[0]:h=new Xn,h!==c[0])for(let u=0,d=c.length;u<d;u++)h.add(c[u]);if(s.name&&(h.userData.name=s.name,h.name=o),_h(h,s),s.extensions&&pf(i,h,s),s.matrix!==void 0){const u=new li;u.fromArray(s.matrix),h.applyMatrix4(u)}else s.translation!==void 0&&h.position.fromArray(s.translation),s.rotation!==void 0&&h.quaternion.fromArray(s.rotation),s.scale!==void 0&&h.scale.fromArray(s.scale);return r.associations.has(h)||r.associations.set(h,{}),r.associations.get(h).nodes=n,h}),this.nodeCache[n]}loadScene(n){const e=this.extensions,i=this.json.scenes[n],r=this,s=new iB;i.name&&(s.name=r.createUniqueName(i.name)),_h(s,i),i.extensions&&pf(e,s,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,u=l.length;h<u;h++)s.add(l[h]);const c=h=>{const u=new Map;for(const[d,f]of r.associations)(d instanceof Xu||d instanceof Qr)&&u.set(d,f);return h.traverse(d=>{const f=r.associations.get(d);f!=null&&u.set(d,f)}),u};return r.associations=c(s),s})}_createAnimationTracks(n,e,i,r,s){const o=[],a=n.name?n.name:n.uuid,l=[];Zu[s.path]===Zu.weights?n.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(a);let c;switch(Zu[s.path]){case Zu.weights:c=Vg;break;case Zu.rotation:c=Qg;break;case Zu.position:case Zu.scale:c=Xg;break;default:switch(i.itemSize){case 1:c=Vg;break;case 2:case 3:default:c=Xg;break}break}const h=r.interpolation!==void 0?$he[r.interpolation]:rA,u=this._getArrayFromAccessor(i);for(let d=0,f=l.length;d<f;d++){const m=new c(l[d]+"."+Zu[s.path],e.array,u,h);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(n){let e=n.array;if(n.normalized){const i=bB(e.constructor),r=new Float32Array(e.length);for(let s=0,o=e.length;s<o;s++)r[s]=e[s]*i;e=r}return e}_createCubicSplineTrackInterpolant(n){n.createInterpolant=function(e){const i=this instanceof Qg?Zhe:k6;return new i(this.times,this.values,this.getValueSize()/3,e)},n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function aue(n,e,i){const r=e.attributes,s=new yl;if(r.POSITION!==void 0){const l=i.json.accessors[r.POSITION],c=l.min,h=l.max;if(c!==void 0&&h!==void 0){if(s.set(new fe(c[0],c[1],c[2]),new fe(h[0],h[1],h[2])),l.normalized){const u=bB(qg[l.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const l=new fe,c=new fe;for(let h=0,u=o.length;h<u;h++){const d=o[h];if(d.POSITION!==void 0){const f=i.json.accessors[d.POSITION],m=f.min,g=f.max;if(m!==void 0&&g!==void 0){if(c.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),c.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),c.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),f.normalized){const v=bB(qg[f.componentType]);c.multiplyScalar(v)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(l)}n.boundingBox=s;const a=new bl;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=a}function L6(n,e,i){const r=e.attributes,s=[];function o(a,l){return i.getDependency("accessor",a).then(function(c){n.setAttribute(l,c)})}for(const a in r){const l=vB[a]||a.toLowerCase();l in n.attributes||s.push(o(r[a],l))}if(e.indices!==void 0&&!n.index){const a=i.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});s.push(a)}return qo.workingColorSpace!==Eo&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${qo.workingColorSpace}" not supported.`),_h(n,e),aue(n,e,i),Promise.all(s).then(function(){return e.targets!==void 0?tue(n,e.targets,i):n})}var lue=function(){var n="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var s=WebAssembly.validate(i)?e:n,o,a=WebAssembly.instantiate(l(s),{}).then(function(A){o=A.instance,o.exports.__wasm_call_ctors()});function l(A){for(var b=new Uint8Array(A.length),x=0;x<A.length;++x){var _=A.charCodeAt(x);b[x]=_>96?_-97:_>64?_-39:_+4}for(var w=0,x=0;x<A.length;++x)b[w++]=b[x]<60?r[b[x]]:(b[x]-60)*64+b[++x];return b.buffer.slice(0,w)}function c(A,b,x,_,w,T){var M=o.exports.sbrk,R=x+3&-4,B=M(R*_),E=M(w.length),P=new Uint8Array(o.exports.memory.buffer);P.set(w,E);var O=A(B,x,_,E,w.length);if(O==0&&T&&T(B,R,_),b.set(P.subarray(B,B+x*_)),M(B-M(0)),O!=0)throw new Error("Malformed buffer data: "+O)}var h={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},d=[],f=0;function m(A){var b={object:new Worker(A),pending:0,requests:{}};return b.object.onmessage=function(x){var _=x.data;b.pending-=_.count,b.requests[_.id][_.action](_.value),delete b.requests[_.id]},b}function g(A){for(var b="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(l(s))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+c.toString()+y.toString(),x=new Blob([b],{type:"text/javascript"}),_=URL.createObjectURL(x),w=0;w<A;++w)d[w]=m(_);URL.revokeObjectURL(_)}function v(A,b,x,_,w){for(var T=d[0],M=1;M<d.length;++M)d[M].pending<T.pending&&(T=d[M]);return new Promise(function(R,B){var E=new Uint8Array(x),P=f++;T.pending+=A,T.requests[P]={resolve:R,reject:B},T.object.postMessage({id:P,count:A,size:b,source:E,mode:_,filter:w},[E.buffer])})}function y(A){a.then(function(){var b=A.data;try{var x=new Uint8Array(b.count*b.size);c(o.exports[b.mode],x,b.count,b.size,b.source,o.exports[b.filter]),self.postMessage({id:b.id,count:b.count,action:"resolve",value:x},[x.buffer])}catch(_){self.postMessage({id:b.id,count:b.count,action:"reject",value:_})}})}return{ready:a,supported:!0,useWorkers:function(A){g(A)},decodeVertexBuffer:function(A,b,x,_,w){c(o.exports.meshopt_decodeVertexBuffer,A,b,x,_,o.exports[h[w]])},decodeIndexBuffer:function(A,b,x,_){c(o.exports.meshopt_decodeIndexBuffer,A,b,x,_)},decodeIndexSequence:function(A,b,x,_){c(o.exports.meshopt_decodeIndexSequence,A,b,x,_)},decodeGltfBuffer:function(A,b,x,_,w,T){c(o.exports[u[w]],A,b,x,_,o.exports[h[T]])},decodeGltfBufferAsync:function(A,b,x,_,w){return d.length>0?v(A,b,x,u[_],h[w]):a.then(function(){var T=new Uint8Array(A*b);return c(o.exports[u[_]],T,A,b,x,o.exports[h[w]]),T})}}}();const xB=new WeakMap;class cue extends Ku{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,r,s){const o=new df(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,a=>{this.parse(a,i,s)},r,s)}parse(e,i,r=()=>{}){this.decodeDracoFile(e,i,null,null,Rs,r).catch(r)}decodeDracoFile(e,i,r,s,o=Eo,a=()=>{}){const l={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:o};return this.decodeGeometry(e,l).then(i).catch(a)}decodeGeometry(e,i){const r=JSON.stringify(i);if(xB.has(e)){const c=xB.get(e);if(c.key===r)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const o=this.workerNextTaskID++,a=e.byteLength,l=this._getWorker(o,a).then(c=>(s=c,new Promise((h,u)=>{s._callbacks[o]={resolve:h,reject:u},s.postMessage({type:"decode",id:o,taskConfig:i,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return l.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),xB.set(e,{key:r,promise:l}),l}_createGeometry(e){const i=new Hl;e.index&&i.setIndex(new Jo(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const s=e.attributes[r],o=s.name,a=s.array,l=s.itemSize,c=new Jo(a,l);o==="color"&&(this._assignVertexColorSpace(c,s.vertexColorSpace),c.normalized=!(a instanceof Float32Array)),i.setAttribute(o,c)}return i}_assignVertexColorSpace(e,i){if(i!==Rs)return;const r=new $n;for(let s=0,o=e.count;s<o;s++)r.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,r.r,r.g,r.b)}_loadLibrary(e,i){const r=new df(this.manager);return r.setPath(this.decoderPath),r.setResponseType(i),r.setWithCredentials(this.withCredentials),new Promise((s,o)=>{r.load(e,s,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return e?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(r=>{const s=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const o=hue.toString(),a=["/* draco decoder */",s,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(o){const a=o.data;switch(a.type){case"decode":s._callbacks[a.id].resolve(a);break;case"error":s._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,o){return s._taskLoad>o._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=i,r._taskLoad+=i,r})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function hue(){let n,e;onmessage=function(a){const l=a.data;switch(l.type){case"init":n=l.decoderConfig,e=new Promise(function(u){n.onModuleLoaded=function(d){u({draco:d})},DracoDecoderModule(n)});break;case"decode":const c=l.buffer,h=l.taskConfig;e.then(u=>{const d=u.draco,f=new d.Decoder;try{const m=i(d,f,new Int8Array(c),h),g=m.attributes.map(v=>v.array.buffer);m.index&&g.push(m.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:m},g)}catch(m){console.error(m),self.postMessage({type:"error",id:l.id,error:m.message})}finally{d.destroy(f)}});break}};function i(a,l,c,h){const u=h.attributeIDs,d=h.attributeTypes;let f,m;const g=l.GetEncodedGeometryType(c);if(g===a.TRIANGULAR_MESH)f=new a.Mesh,m=l.DecodeArrayToMesh(c,c.byteLength,f);else if(g===a.POINT_CLOUD)f=new a.PointCloud,m=l.DecodeArrayToPointCloud(c,c.byteLength,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!m.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+m.error_msg());const v={index:null,attributes:[]};for(const y in u){const A=self[d[y]];let b,x;if(h.useUniqueIDs)x=u[y],b=l.GetAttributeByUniqueId(f,x);else{if(x=l.GetAttributeId(f,a[u[y]]),x===-1)continue;b=l.GetAttribute(f,x)}const _=s(a,l,f,y,A,b);y==="color"&&(_.vertexColorSpace=h.vertexColorSpace),v.attributes.push(_)}return g===a.TRIANGULAR_MESH&&(v.index=r(a,l,f)),a.destroy(f),v}function r(a,l,c){const h=c.num_faces()*3,u=h*4,d=a._malloc(u);l.GetTrianglesUInt32Array(c,u,d);const f=new Uint32Array(a.HEAPF32.buffer,d,h).slice();return a._free(d),{array:f,itemSize:1}}function s(a,l,c,h,u,d){const f=d.num_components(),m=c.num_points()*f,g=m*u.BYTES_PER_ELEMENT,v=o(a,u),y=a._malloc(g);l.GetAttributeDataArrayForAllPoints(c,d,v,g,y);const A=new u(a.HEAPF32.buffer,y,m).slice();return a._free(y),{name:h,array:A,itemSize:f}}function o(a,l){switch(l){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}class uue{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const r=this.workersResolve[e];if(r&&r(i),this.queue.length){const{resolve:s,msg:o,transfer:a}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(o,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(r=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=r,this.workers[s].postMessage(e,i)):this.queue.push({resolve:r,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const due=0,U6=2,pue=1,F6=2,fue=0,mue=1,gue=10,vue=0,N6=9,z6=15,j6=16,G6=22,H6=37,V6=43,Q6=76,W6=83,X6=97,q6=100,Y6=103,J6=109,K6=165,Z6=166;class yue{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class AA{constructor(e,i,r,s){this._dataView=new DataView(e.buffer,e.byteOffset+i,r),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const r=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==i&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,s)}}const no=[171,75,84,88,32,50,48,187,13,10,26,10];function $6(n){return typeof TextDecoder<"u"?new TextDecoder().decode(n):Buffer.from(n).toString("utf8")}function Aue(n){const e=new Uint8Array(n.buffer,n.byteOffset,no.length);if(e[0]!==no[0]||e[1]!==no[1]||e[2]!==no[2]||e[3]!==no[3]||e[4]!==no[4]||e[5]!==no[5]||e[6]!==no[6]||e[7]!==no[7]||e[8]!==no[8]||e[9]!==no[9]||e[10]!==no[10]||e[11]!==no[11])throw new Error("Missing KTX 2.0 identifier.");const i=new yue,r=17*Uint32Array.BYTES_PER_ELEMENT,s=new AA(n,no.length,r,!0);i.vkFormat=s._nextUint32(),i.typeSize=s._nextUint32(),i.pixelWidth=s._nextUint32(),i.pixelHeight=s._nextUint32(),i.pixelDepth=s._nextUint32(),i.layerCount=s._nextUint32(),i.faceCount=s._nextUint32();const o=s._nextUint32();i.supercompressionScheme=s._nextUint32();const a=s._nextUint32(),l=s._nextUint32(),c=s._nextUint32(),h=s._nextUint32(),u=s._nextUint64(),d=s._nextUint64(),f=new AA(n,no.length+r,3*o*8,!0);for(let F=0;F<o;F++)i.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+f._nextUint64(),f._nextUint64()),uncompressedByteLength:f._nextUint64()});const m=new AA(n,a,l,!0),g={vendorId:m._skip(4)._nextUint16(),descriptorType:m._nextUint16(),versionNumber:m._nextUint16(),descriptorBlockSize:m._nextUint16(),colorModel:m._nextUint8(),colorPrimaries:m._nextUint8(),transferFunction:m._nextUint8(),flags:m._nextUint8(),texelBlockDimension:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],bytesPlane:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],samples:[]},v=(g.descriptorBlockSize/4-6)/4;for(let F=0;F<v;F++){const H={bitOffset:m._nextUint16(),bitLength:m._nextUint8(),channelType:m._nextUint8(),samplePosition:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&H.channelType?(H.sampleLower=m._nextInt32(),H.sampleUpper=m._nextInt32()):(H.sampleLower=m._nextUint32(),H.sampleUpper=m._nextUint32()),g.samples[F]=H}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(g);const y=new AA(n,c,h,!0);for(;y._offset<h;){const F=y._nextUint32(),H=y._scan(F),K=$6(H),Z=y._scan(F-H.byteLength);i.keyValue[K]=K.match(/^ktx/i)?$6(Z):Z,y._offset%4&&y._skip(4-y._offset%4)}if(d<=0)return i;const A=new AA(n,u,d,!0),b=A._nextUint16(),x=A._nextUint16(),_=A._nextUint32(),w=A._nextUint32(),T=A._nextUint32(),M=A._nextUint32(),R=[];for(let F=0;F<o;F++)R.push({imageFlags:A._nextUint32(),rgbSliceByteOffset:A._nextUint32(),rgbSliceByteLength:A._nextUint32(),alphaSliceByteOffset:A._nextUint32(),alphaSliceByteLength:A._nextUint32()});const B=u+A._offset,E=B+_,P=E+w,O=P+T,N=new Uint8Array(n.buffer,n.byteOffset+B,_),L=new Uint8Array(n.buffer,n.byteOffset+E,w),Q=new Uint8Array(n.buffer,n.byteOffset+P,T),D=new Uint8Array(n.buffer,n.byteOffset+O,M);return i.globalData={endpointCount:b,selectorCount:x,imageDescs:R,endpointsData:N,selectorsData:L,tablesData:Q,extendedData:D},i}let _B,wh,wB;const SB={env:{emscripten_notify_memory_growth:function(n){wB=new Uint8Array(wh.exports.memory.buffer)}}};class bue{init(){return _B||(_B=typeof fetch<"u"?fetch("data:application/wasm;base64,"+eG).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,SB)).then(this._init):WebAssembly.instantiate(Buffer.from(eG,"base64"),SB).then(this._init),_B)}_init(e){wh=e.instance,SB.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!wh)throw new Error("ZSTDDecoder: Await .init() before decoding.");const r=e.byteLength,s=wh.exports.malloc(r);wB.set(e,s),i=i||Number(wh.exports.ZSTD_findDecompressedSize(s,r));const o=wh.exports.malloc(i),a=wh.exports.ZSTD_decompress(o,i,s,r),l=wB.slice(o,o+a);return wh.exports.free(s),wh.exports.free(o),l}}const eG="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",CB=new WeakMap;let EB=0,MB;class Yc extends Ku{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new uue,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new df(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),r=new df(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const s=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,s]).then(([o,a])=>{const l=Yc.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(Yc.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Yc.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Yc.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const h=new Worker(this.workerSourceURL),u=this.transcoderBinary.slice(0);return h.postMessage({type:"init",config:this.workerConfig,transcoderBinary:u},[u]),h})}),EB>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),EB++}return this.transcoderPending}load(e,i,r,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new df(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(e,a=>{if(CB.has(a))return CB.get(a).promise.then(i).catch(s);this._createTexture(a).then(l=>i?i(l):null).catch(s)},r,s)}_createTextureFrom(e,i){const{faces:r,width:s,height:o,format:a,type:l,error:c,dfdFlags:h}=e;if(l==="error")return Promise.reject(c);let u;if(i.faceCount===6)u=new Jce(r,a,Ia);else{const d=r[0].mipmaps;u=i.layerCount>1?new Yce(d,s,o,i.layerCount,a,Ia):new mS(d,s,o,a,Ia)}return u.minFilter=r[0].mipmaps.length===1?tA:F1,u.magFilter=tA,u.generateMipmaps=!1,u.needsUpdate=!0,u.colorSpace=tG(i),u.premultiplyAlpha=!!(h&pue),u}async _createTexture(e,i={}){const r=Aue(new Uint8Array(e));if(r.vkFormat!==vue)return _ue(r);const s=i,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:s},[e])).then(a=>this._createTextureFrom(a.data,r));return CB.set(e,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),EB--,this}}Yc.BasisFormat={ETC1S:0,UASTC_4x4:1},Yc.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Yc.EngineFormat={RGBAFormat:zu,RGBA_ASTC_4x4_Format:Yle,RGBA_BPTC_Format:Jle,RGBA_ETC2_EAC_Format:qle,RGBA_PVRTC_4BPPV1_Format:Qle,RGBA_S3TC_DXT5_Format:Hle,RGB_ETC1_Format:Wle,RGB_ETC2_Format:Xle,RGB_PVRTC_4BPPV1_Format:Vle,RGBA_S3TC_DXT1_Format:Gle},Yc.BasisWorker=function(){let n,e,i;const r=_EngineFormat,s=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(g){const v=g.data;switch(v.type){case"init":n=v.config,a(v.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:y,buffers:A,width:b,height:x,hasAlpha:_,format:w,dfdFlags:T}=l(v.buffer);self.postMessage({type:"transcode",id:v.id,faces:y,width:b,height:x,hasAlpha:_,format:w,dfdFlags:T},A)}catch(y){console.error(y),self.postMessage({type:"error",id:v.id,error:y.message})}});break}});function a(g){e=new Promise(v=>{i={wasmBinary:g,onRuntimeInitialized:v},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(g){const v=new i.KTX2File(new Uint8Array(g));function y(){v.close(),v.delete()}if(!v.isValid())throw y(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const A=v.isUASTC()?o.UASTC_4x4:o.ETC1S,b=v.getWidth(),x=v.getHeight(),_=v.getLayers()||1,w=v.getLevels(),T=v.getFaces(),M=v.getHasAlpha(),R=v.getDFDFlags(),{transcoderFormat:B,engineFormat:E}=d(A,b,x,M);if(!b||!x||!w)throw y(),new Error("THREE.KTX2Loader:	Invalid texture");if(!v.startTranscoding())throw y(),new Error("THREE.KTX2Loader: .startTranscoding failed");const P=[],O=[];for(let N=0;N<T;N++){const L=[];for(let Q=0;Q<w;Q++){const D=[];let F,H;for(let Z=0;Z<_;Z++){const oe=v.getImageLevelInfo(Q,Z,N);N===0&&Q===0&&Z===0&&(oe.origWidth%4!==0||oe.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),w>1?(F=oe.origWidth,H=oe.origHeight):(F=oe.width,H=oe.height);const we=new Uint8Array(v.getImageTranscodedSizeInBytes(Q,Z,0,B));if(!v.transcodeImage(we,Q,Z,N,B,0,-1,-1))throw y(),new Error("THREE.KTX2Loader: .transcodeImage failed.");D.push(we)}const K=m(D);L.push({data:K,width:F,height:H}),O.push(K.buffer)}P.push({mipmaps:L,width:b,height:x,format:E})}return y(),{faces:P,buffers:O,width:b,height:x,hasAlpha:M,format:E,dfdFlags:R}}const c=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[r.RGBA_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],h=c.sort(function(g,v){return g.priorityETC1S-v.priorityETC1S}),u=c.sort(function(g,v){return g.priorityUASTC-v.priorityUASTC});function d(g,v,y,A){let b,x;const _=g===o.ETC1S?h:u;for(let w=0;w<_.length;w++){const T=_[w];if(n[T.if]&&T.basisFormat.includes(g)&&!(A&&T.transcoderFormat.length<2)&&!(T.needsPowerOfTwo&&!(f(v)&&f(y))))return b=T.transcoderFormat[A?1:0],x=T.engineFormat[A?1:0],{transcoderFormat:b,engineFormat:x}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),b=s.RGBA32,x=r.RGBAFormat,{transcoderFormat:b,engineFormat:x}}function f(g){return g<=2?!0:(g&g-1)===0&&g!==0}function m(g){if(g.length===1)return g[0];let v=0;for(let b=0;b<g.length;b++){const x=g[b];v+=x.byteLength}const y=new Uint8Array(v);let A=0;for(let b=0;b<g.length;b++){const x=g[b];y.set(x,A),A+=x.byteLength}return y}};const xue=new Set([zu,iA,Sg]),TB={[J6]:zu,[X6]:zu,[H6]:zu,[V6]:zu,[Y6]:iA,[W6]:iA,[j6]:iA,[G6]:iA,[q6]:Sg,[Q6]:Sg,[z6]:Sg,[N6]:Sg,[Z6]:C5,[K6]:C5},IB={[J6]:of,[X6]:N1,[H6]:Ia,[V6]:Ia,[Y6]:of,[W6]:N1,[j6]:Ia,[G6]:Ia,[q6]:of,[Q6]:N1,[z6]:Ia,[N6]:Ia,[Z6]:Ia,[K6]:Ia};async function _ue(n){const{vkFormat:e}=n;if(TB[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let i;n.supercompressionScheme===U6&&(MB||(MB=new Promise(async o=>{const a=new bue;await a.init(),o(a)})),i=await MB);const r=[];for(let o=0;o<n.levels.length;o++){const a=Math.max(1,n.pixelWidth>>o),l=Math.max(1,n.pixelHeight>>o),c=n.pixelDepth?Math.max(1,n.pixelDepth>>o):0,h=n.levels[o];let u;if(n.supercompressionScheme===due)u=h.levelData;else if(n.supercompressionScheme===U6)u=i.decode(h.levelData,h.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let d;IB[e]===of?d=new Float32Array(u.buffer,u.byteOffset,u.byteLength/Float32Array.BYTES_PER_ELEMENT):IB[e]===N1?d=new Uint16Array(u.buffer,u.byteOffset,u.byteLength/Uint16Array.BYTES_PER_ELEMENT):d=u,r.push({data:d,width:a,height:l,depth:c})}let s;if(xue.has(TB[e]))s=n.pixelDepth===0?new sB(r[0].data,n.pixelWidth,n.pixelHeight):new wce(r[0].data,n.pixelWidth,n.pixelHeight,n.pixelDepth);else{if(n.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");s=new mS(r,n.pixelWidth,n.pixelHeight)}return s.mipmaps=r,s.type=IB[e],s.format=TB[e],s.colorSpace=tG(n),s.needsUpdate=!0,Promise.resolve(s)}function tG(n){const e=n.dataFormatDescriptor[0];return e.colorPrimaries===mue?e.transferFunction===F6?Rs:Eo:e.colorPrimaries===gue?e.transferFunction===F6?R5:RP:(e.colorPrimaries===fue||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),IP)}let yS="https://www.gstatic.com/draco/versioned/decoders/1.4.1/",RB="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";fetch(yS+"draco_decoder.js",{method:"head"}).catch(n=>{yS="./include/draco/",RB="./include/ktx2/"});function wue(n){yS=n}function Sue(n){RB=n}let Yg,AS,Jg;function iG(n){return Yg||(Yg=new cue,Yg.setDecoderPath(yS),Yg.setDecoderConfig({type:"js"})),Jg||(Jg=new Yc,Jg.setTranscoderPath(RB)),AS||(AS=lue),n?Jg.detectSupport(n):n!==null&&console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures might fail"),{dracoLoader:Yg,ktx2Loader:Jg,meshoptDecoder:AS}}function Cue(n){n.dracoLoader||n.setDRACOLoader(Yg),n.ktx2Loader||n.setKTX2Loader(Jg),n.meshoptDecoder||n.setMeshoptDecoder(AS)}bA("debugprogressive");function bA(n){const e=new URL(window.location.href).searchParams.get(n);return e==null||e==="0"||e==="false"?!1:e===""?!0:e}function Eue(n,e){if(e===void 0||e.startsWith("./")||e.startsWith("http")||n===void 0)return e;const i=n.lastIndexOf("/");if(i>=0){const r=n.substring(0,i+1);for(;r.endsWith("/")&&e.startsWith("/");)e=e.substring(1);return r+e}return e}let bS;function Mue(){return bS!==void 0||(bS=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent),bA("debugprogressive")&&console.log("[glTF Progressive]: isMobileDevice",bS)),bS}const PB=Symbol("needle:raycast-mesh");function xA(n){return n?.[PB]instanceof Hl?n[PB]:null}function Tue(n,e){if((n.type==="Mesh"||n.type==="SkinnedMesh")&&!xA(n)){const i=Iue(e);i.userData={isRaycastMesh:!0},n[PB]=i}}function Iue(n){const e=new Hl;for(const i in n.attributes)e.setAttribute(i,n.getAttribute(i));return e.setIndex(n.getIndex()),e}const $u=new Array,Sh="NEEDLE_progressive",$i=bA("debugprogressive"),BB=Symbol("needle-progressive-texture"),_A=new Map,kB=new Set;if($i){let n=function(){e+=1,console.log("Toggle LOD level",e,_A),_A.forEach((s,o)=>{for(const a of s.keys){const l=o[a];if(l!=null){if(l.isBufferGeometry===!0){const c=mi.getMeshLODInformation(l),h=c?Math.min(e,c.lods.length):0;o["DEBUG:LOD"]=e,mi.assignMeshLOD(o,h),c&&(i=Math.max(i,c.lods.length-1))}else if(o.isMaterial===!0){o["DEBUG:LOD"]=e,mi.assignTextureLOD(o,e);break}}}}),e>=i&&(e=-1)},e=-1,i=2,r=!1;window.addEventListener("keyup",s=>{s.key==="p"&&n(),s.key==="w"&&(r=!r,kB&&kB.forEach(o=>{o.name!="BackgroundCubeMaterial"&&o.glyphMap==null&&"wireframe"in o&&(o.wireframe=r)}))})}function nG(n,e,i){var r;if(!$i)return;_A.has(n)||_A.set(n,{keys:[],sourceId:i});const s=_A.get(n);((r=s?.keys)==null?void 0:r.includes(e))==!1&&s.keys.push(e)}const Ir=class{constructor(n,e){this.loadMesh=i=>{var r,s;if(this._isLoadingMesh)return null;const o=(s=(r=this.parser.json.meshes[i])==null?void 0:r.extensions)==null?void 0:s[Sh];return o?(this._isLoadingMesh=!0,this.parser.getDependency("mesh",i).then(a=>{var l;return this._isLoadingMesh=!1,a&&Ir.registerMesh(this.url,o.guid,a,(l=o.lods)==null?void 0:l.length,void 0,o),a})):null},$i&&console.log("Progressive extension registered for",e),this.parser=n,this.url=e}get name(){return Sh}static getMeshLODInformation(n){const e=this.getAssignedLODInformation(n);return e!=null&&e.key?this.lodInfos.get(e.key):null}static getMaterialMinMaxLODsCount(n,e){const i=this,r="LODS:minmax",s=n[r];if(s!=null)return s;if(e||(e={min_count:1/0,max_count:0,lods:[]}),Array.isArray(n)){for(const a of n)this.getMaterialMinMaxLODsCount(a,e);return n[r]=e,e}if($i==="verbose"&&console.log("getMaterialMinMaxLODsCount",n),n.type==="ShaderMaterial"||n.type==="RawShaderMaterial"){const a=n;for(const l of Object.keys(a.uniforms)){const c=a.uniforms[l].value;c?.isTexture===!0&&o(c,e)}}else if(n.isMaterial)for(const a of Object.keys(n)){const l=n[a];l?.isTexture===!0&&o(l,e)}return n[r]=e,e;function o(a,l){const c=i.getAssignedLODInformation(a);if(c){const h=i.lodInfos.get(c.key);if(h&&h.lods){l.min_count=Math.min(l.min_count,h.lods.length),l.max_count=Math.max(l.max_count,h.lods.length);for(let u=0;u<h.lods.length;u++){const d=h.lods[u];d.width&&(l.lods[u]=l.lods[u]||{min_height:1/0,max_height:0},l.lods[u].min_height=Math.min(l.lods[u].min_height,d.height),l.lods[u].max_height=Math.max(l.lods[u].max_height,d.height))}}}}}static hasLODLevelAvailable(n,e){var i;if(Array.isArray(n)){for(const o of n)if(this.hasLODLevelAvailable(o,e))return!0;return!1}if(n.isMaterial===!0){for(const o of Object.keys(n)){const a=n[o];if(a&&a.isTexture&&this.hasLODLevelAvailable(a,e))return!0}return!1}else if(n.isGroup===!0){for(const o of n.children)if(o.isMesh===!0&&this.hasLODLevelAvailable(o,e))return!0}let r,s;if(n.isMesh?r=n.geometry:(n.isBufferGeometry||n.isTexture)&&(r=n),r&&(i=r?.userData)!=null&&i.LODS){const o=r.userData.LODS;if(s=this.lodInfos.get(o.key),e===void 0)return s!=null;if(s)return Array.isArray(s.lods)?e<s.lods.length:e===0}return!1}static assignMeshLOD(n,e){var i;if(!n)return Promise.resolve(null);if(n instanceof qu||n.isMesh===!0){const r=n.geometry,s=this.getAssignedLODInformation(r);if(!s)return Promise.resolve(null);for(const o of $u)(i=o.onBeforeGetLODMesh)==null||i.call(o,n,e);return n["LOD:requested level"]=e,Ir.getOrLoadLOD(r,e).then(o=>{if(n["LOD:requested level"]===e){if(delete n["LOD:requested level"],Array.isArray(o)){const a=s.index||0;o=o[a]}o&&r!=o&&(o?.isBufferGeometry?(n.geometry=o,$i&&nG(n,"geometry",s.url)):$i&&console.error("Invalid LOD geometry",o))}return o}).catch(o=>(console.error("Error loading mesh LOD",n,o),null))}else $i&&console.error("Invalid call to assignMeshLOD: Request mesh LOD but the object is not a mesh",n);return Promise.resolve(null)}static assignTextureLOD(n,e=0){if(!n)return Promise.resolve(null);if(n instanceof Xu||n.isMaterial===!0){const i=n,r=[],s=new Array;if($i&&kB.add(i),i.uniforms&&i.isRawShaderMaterial||i.isShaderMaterial===!0){const o=i;for(const a of Object.keys(o.uniforms)){const l=o.uniforms[a].value;if(l?.isTexture===!0){const c=this.assignTextureLODForSlot(l,e,i,a);r.push(c),s.push(a)}}}else for(const o of Object.keys(i)){const a=i[o];if(a?.isTexture===!0){const l=this.assignTextureLODForSlot(a,e,i,o);r.push(l),s.push(o)}}return Promise.all(r).then(o=>{const a=new Array;for(let l=0;l<o.length;l++){const c=o[l],h=s[l];c&&c.isTexture===!0?a.push({material:i,slot:h,texture:c,level:e}):a.push({material:i,slot:h,texture:null,level:e})}return a})}if(n instanceof Qr||n.isTexture===!0){const i=n;return this.assignTextureLODForSlot(i,e,null,null)}return Promise.resolve(null)}static assignTextureLODForSlot(n,e,i,r){return n?.isTexture!==!0?Promise.resolve(null):r==="glyphMap"?Promise.resolve(n):Ir.getOrLoadLOD(n,e).then(s=>{if(Array.isArray(s))return null;if(s?.isTexture===!0){if(s!=n){if(i&&r){const o=i[r];if(o){const a=this.getAssignedLODInformation(o);if(a&&a?.level<e)return $i==="verbose"&&console.warn("Assigned texture level is already higher: ",a.level,e,i,o,s),null}i[r]=s}if($i&&r&&i){const o=this.getAssignedLODInformation(n);o&&nG(i,r,o.url)}}return s}else $i=="verbose"&&console.warn("No LOD found for",n,e);return null}).catch(s=>(console.error("Error loading LOD",n,s),null))}afterRoot(n){var e,i;return $i&&console.log("AFTER",this.url,n),(e=this.parser.json.textures)==null||e.forEach((r,s)=>{var o;if(r!=null&&r.extensions){const a=r?.extensions[Sh];if(a){if(!a.lods){$i&&console.warn("Texture has no LODs",a);return}let l=!1;for(const c of this.parser.associations.keys())if(c.isTexture===!0){const h=this.parser.associations.get(c);h?.textures===s&&(l=!0,Ir.registerTexture(this.url,c,(o=a.lods)==null?void 0:o.length,s,a))}l||this.parser.getDependency("texture",s).then(c=>{var h;c&&Ir.registerTexture(this.url,c,(h=a.lods)==null?void 0:h.length,s,a)})}}}),(i=this.parser.json.meshes)==null||i.forEach((r,s)=>{if(r!=null&&r.extensions){const o=r?.extensions[Sh];if(o&&o.lods){for(const a of this.parser.associations.keys())if(a.isMesh){const l=this.parser.associations.get(a);l?.meshes===s&&Ir.registerMesh(this.url,o.guid,a,o.lods.length,l.primitives,o)}}}}),null}static async getOrLoadLOD(n,e){var i,r,s,o;const a=$i=="verbose",l=n.userData.LODS;if(!l)return null;const c=l?.key;let h;if(n.isTexture===!0){const u=n;u.source&&u.source[BB]&&(h=u.source[BB])}if(h||(h=Ir.lodInfos.get(c)),h){if(e>0){let f=!1;const m=Array.isArray(h.lods);if(m&&e>=h.lods.length?f=!0:m||(f=!0),f)return this.lowresCache.get(c)}const u=Array.isArray(h.lods)?(i=h.lods[e])==null?void 0:i.path:h.lods;if(!u)return $i&&!h["missing:uri"]&&(h["missing:uri"]=!0,console.warn("Missing uri for progressive asset for LOD "+e,h)),null;const d=Eue(l.url,u);if(d.endsWith(".glb")||d.endsWith(".gltf")){if(!h.guid)return console.warn("missing pointer for glb/gltf texture",h),null;const f=d+"_"+h.guid,m=this.previouslyLoaded.get(f);if(m!==void 0){a&&console.log(`LOD ${e} was already loading/loaded: ${f}`);let y=await m.catch(b=>(console.error(`Error loading LOD ${e} from ${d}
`,b),null)),A=!1;if(y==null||(y instanceof Qr&&n instanceof Qr?(r=y.image)!=null&&r.data||(s=y.source)!=null&&s.data?y=this.copySettings(n,y):(A=!0,this.previouslyLoaded.delete(f)):y instanceof Hl&&n instanceof Hl&&((o=y.attributes.position)!=null&&o.array||(A=!0,this.previouslyLoaded.delete(f)))),!A)return y}const g=h,v=new Promise(async(y,A)=>{const b=new Mhe;Cue(b),$i&&(await new Promise(M=>setTimeout(M,1e3)),a&&console.warn("Start loading (delayed) "+d,g.guid));let x=d;if(g&&Array.isArray(g.lods)){const M=g.lods[e];M.hash&&(x+="?v="+M.hash)}const _=await b.loadAsync(x).catch(M=>(console.error(`Error loading LOD ${e} from ${d}
`,M),null));if(!_)return null;const w=_.parser;a&&console.log("Loading finished "+d,g.guid);let T=0;if(_.parser.json.textures){let M=!1;for(const R of _.parser.json.textures){if(R!=null&&R.extensions){const B=R?.extensions[Sh];if(B!=null&&B.guid&&B.guid===g.guid){M=!0;break}}T++}if(M){let R=await w.getDependency("texture",T);return R&&Ir.assignLODInformation(l.url,R,c,e,void 0,void 0),a&&console.log('change "'+n.name+'" \u2192 "'+R.name+'"',d,T,R,f),n instanceof Qr&&(R=this.copySettings(n,R)),R&&(R.guid=g.guid),y(R)}else $i&&console.warn("Could not find texture with guid",g.guid,_.parser.json)}if(T=0,_.parser.json.meshes){let M=!1;for(const R of _.parser.json.meshes){if(R!=null&&R.extensions){const B=R?.extensions[Sh];if(B!=null&&B.guid&&B.guid===g.guid){M=!0;break}}T++}if(M){const R=await w.getDependency("mesh",T),B=g;if(a&&console.log(`Loaded Mesh "${R.name}"`,d,T,R,f),R.isMesh===!0){const E=R.geometry;return Ir.assignLODInformation(l.url,E,c,e,void 0,B.density),y(E)}else{const E=new Array;for(let P=0;P<R.children.length;P++){const O=R.children[P];if(O.isMesh===!0){const N=O.geometry;Ir.assignLODInformation(l.url,N,c,e,P,B.density),E.push(N)}}return y(E)}}else $i&&console.warn("Could not find mesh with guid",g.guid,_.parser.json)}return y(null)});return this.previouslyLoaded.set(f,v),await v}else if(n instanceof Qr){a&&console.log("Load texture from uri: "+d);const f=await new C6().loadAsync(d);return f?(f.guid=h.guid,f.flipY=!1,f.needsUpdate=!0,f.colorSpace=n.colorSpace,a&&console.log(h,f)):$i&&console.warn("failed loading",d),f}}else $i&&console.warn(`Can not load LOD ${e}: no LOD info found for "${c}" ${n.name}`,n.type);return null}static assignLODInformation(n,e,i,r,s,o){if(!e)return;e.userData||(e.userData={});const a=new Rue(n,i,r,s,o);e.userData.LODS=a}static getAssignedLODInformation(n){var e;return((e=n?.userData)==null?void 0:e.LODS)||null}static copySettings(n,e){return e=e.clone(),$i&&console.warn(`Copying texture settings
`,n.uuid,`
`,e.uuid),e.offset=n.offset,e.repeat=n.repeat,e.colorSpace=n.colorSpace,e.magFilter=n.magFilter,e.minFilter=n.minFilter,e.wrapS=n.wrapS,e.wrapT=n.wrapT,e.flipY=n.flipY,e.anisotropy=n.anisotropy,e.mipmaps||(e.generateMipmaps=n.generateMipmaps),e}};let mi=Ir;mi.registerTexture=(n,e,i,r,s)=>{if($i&&console.log("> Progressive: register texture",r,e.name,e.uuid,e,s),!e){$i&&console.error("gltf-progressive: Register texture without texture");return}e.source&&(e.source[BB]=s);const o=s.guid;Ir.assignLODInformation(n,e,o,i,r,void 0),Ir.lodInfos.set(o,s),Ir.lowresCache.set(o,e)},mi.registerMesh=(n,e,i,r,s,o)=>{var a;$i&&console.log("> Progressive: register mesh",s,i.name,o,i.uuid,i);const l=i.geometry;if(!l){$i&&console.warn("gltf-progressive: Register mesh without geometry");return}l.userData||(l.userData={}),Ir.assignLODInformation(n,l,e,r,s,o.density),Ir.lodInfos.set(e,o);let c=Ir.lowresCache.get(e);c?c.push(i.geometry):c=[i.geometry],Ir.lowresCache.set(e,c),r>0&&!xA(i)&&Tue(i,l);for(const h of $u)(a=h.onRegisteredNewMesh)==null||a.call(h,i,o)},mi.lodInfos=new Map,mi.previouslyLoaded=new Map,mi.lowresCache=new Map;class Rue{constructor(e,i,r,s,o){this.url=e,this.key=i,this.level=r,s!=null&&(this.index=s),o!=null&&(this.density=o)}}var rG=(n,e,i)=>{if(!e.has(n))throw TypeError("Cannot "+i)},en=(n,e,i)=>(rG(n,e,"read from private field"),i?i.call(n):e.get(n)),ff=(n,e,i)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,i)},Ch=(n,e,i,r)=>(rG(n,e,"write to private field"),r?r.call(n,i):e.set(n,i),i),Mo,ed,OB,Kg,wA,xS,td;const wl=bA("debugprogressive"),Pue=bA("noprogressive"),DB=Symbol("Needle:LODSManager"),LB=Symbol("Needle:LODState"),Zg=Symbol("Needle:CurrentLOD"),Sl={mesh_lod:-1,texture_lod:-1},Ba=class{constructor(n,e){this.projectionScreenMatrix=new li,this.targetTriangleDensity=2e5,this.updateInterval="auto",ff(this,Mo,1),this.pause=!1,this.manual=!1,this._lodchangedlisteners=[],ff(this,ed,void 0),ff(this,OB,new vhe),ff(this,Kg,0),ff(this,wA,0),ff(this,xS,0),ff(this,td,0),this._fpsBuffer=[60,60,60,60,60],this._sphere=new bl,this._tempBox=new yl,this._tempBox2=new yl,this.tempMatrix=new li,this._tempWorldPosition=new fe,this._tempBoxSize=new fe,this._tempBox2Size=new fe,this.renderer=n,this.context={...e}}static getObjectLODState(n){return n[LB]}static addPlugin(n){$u.push(n)}static removePlugin(n){const e=$u.indexOf(n);e>=0&&$u.splice(e,1)}static get(n,e){if(n[DB])return console.debug("[gltf-progressive] LODsManager already exists for this renderer"),n[DB];const i=new Ba(n,{engine:"unknown",...e});return n[DB]=i,i}get plugins(){return $u}addEventListener(n,e){n==="changed"&&this._lodchangedlisteners.push(e)}removeEventListener(n,e){if(n==="changed"){const i=this._lodchangedlisteners.indexOf(e);i>=0&&this._lodchangedlisteners.splice(i,1)}}enable(){if(en(this,ed))return;console.debug("[gltf-progressive] Enabling LODsManager for renderer");let n=0;Ch(this,ed,this.renderer.render);const e=this;iG(this.renderer),this.renderer.render=function(i,r){const s=e.renderer.getRenderTarget();(s==null||"isXRRenderTarget"in s&&s.isXRRenderTarget)&&(n=0,Ch(e,Kg,en(e,Kg)+1),Ch(e,wA,en(e,OB).getDelta()),Ch(e,xS,en(e,xS)+en(e,wA)),e._fpsBuffer.shift(),e._fpsBuffer.push(1/en(e,wA)),Ch(e,td,e._fpsBuffer.reduce((a,l)=>a+l)/e._fpsBuffer.length),wl&&en(e,Kg)%200===0&&console.log("FPS",Math.round(en(e,td)),"Interval:",en(e,Mo)));const o=n++;en(e,ed).call(this,i,r),e.onAfterRender(i,r,o)}}disable(){en(this,ed)&&(this.renderer.render=en(this,ed),Ch(this,ed,void 0))}update(n,e){this.internalUpdate(n,e)}onAfterRender(n,e,i){if(this.pause)return;const r=this.renderer.renderLists.get(n,0).opaque;let s=!0;if(r.length===1){const o=r[0].material;(o.name==="EffectMaterial"||o.name==="CopyShader")&&(s=!1)}if((e.parent&&e.parent.type==="CubeCamera"||i>=1&&e.type==="OrthographicCamera")&&(s=!1),s){if(Pue||(this.updateInterval==="auto"?en(this,td)<40&&en(this,Mo)<10?(Ch(this,Mo,en(this,Mo)+1),wl&&console.warn("\u2193 Reducing LOD updates",en(this,Mo),en(this,td).toFixed(0))):en(this,td)>=60&&en(this,Mo)>1&&(Ch(this,Mo,en(this,Mo)-1),wl&&console.warn("\u2191 Increasing LOD updates",en(this,Mo),en(this,td).toFixed(0))):Ch(this,Mo,this.updateInterval),en(this,Mo)>0&&en(this,Kg)%en(this,Mo)!=0))return;this.internalUpdate(n,e)}}internalUpdate(n,e){var i,r;const s=this.renderer.renderLists.get(n,0),o=s.opaque;this.projectionScreenMatrix.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);const a=this.targetTriangleDensity;for(const h of o){if(h.material&&(((i=h.geometry)==null?void 0:i.type)==="BoxGeometry"||((r=h.geometry)==null?void 0:r.type)==="BufferGeometry")&&(h.material.name==="SphericalGaussianBlur"||h.material.name=="BackgroundCubeMaterial"||h.material.name==="CubemapFromEquirect"||h.material.name==="EquirectangularToCubeUV")){wl&&(h.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]||(h.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]=!0,console.warn("Ignoring skybox or BLIT object",h,h.material.name,h.material.type)));continue}switch(h.material.type){case"LineBasicMaterial":case"LineDashedMaterial":case"PointsMaterial":case"ShadowMaterial":case"MeshDistanceMaterial":case"MeshDepthMaterial":continue}if(wl==="color"&&h.material&&!h.object.progressive_debug_color){h.object.progressive_debug_color=!0;const d=Math.random()*16777215,f=new gS({color:d});h.object.material=f}const u=h.object;(u instanceof qu||u.isMesh)&&this.updateLODs(n,e,u,a)}const l=s.transparent;for(const h of l){const u=h.object;(u instanceof qu||u.isMesh)&&this.updateLODs(n,e,u,a)}const c=s.transmissive;for(const h of c){const u=h.object;(u instanceof qu||u.isMesh)&&this.updateLODs(n,e,u,a)}}updateLODs(n,e,i,r){var s,o;i.userData||(i.userData={});let a=i[LB];if(a||(a=new Bue,i[LB]=a),a.frames++<2)return;for(const c of $u)(s=c.onBeforeUpdateLOD)==null||s.call(c,this.renderer,n,e,i);this.calculateLodLevel(e,i,a,r,Sl),Sl.mesh_lod=Math.round(Sl.mesh_lod),Sl.texture_lod=Math.round(Sl.texture_lod),Sl.mesh_lod>=0&&this.loadProgressiveMeshes(i,Sl.mesh_lod);let l=Sl.texture_lod;if(i.material&&l>=0){const c=i["DEBUG:LOD"];c!=null&&(l=c),this.loadProgressiveTextures(i.material,l)}for(const c of $u)(o=c.onAfterUpdatedLOD)==null||o.call(c,this.renderer,n,e,i,Sl);a.lastLodLevel_Mesh=Sl.mesh_lod,a.lastLodLevel_Texture=Sl.texture_lod}loadProgressiveTextures(n,e){if(!n)return;if(Array.isArray(n)){for(const r of n)this.loadProgressiveTextures(r,e);return}let i=!1;(n[Zg]===void 0||e<n[Zg])&&(i=!0),i&&(n[Zg]=e,mi.assignTextureLOD(n,e).then(r=>{this._lodchangedlisteners.forEach(s=>s({type:"texture",level:e,object:n}))}))}loadProgressiveMeshes(n,e){if(!n)return Promise.resolve(null);if(n[Zg]!==e){n[Zg]=e;const i=n.geometry;return mi.assignMeshLOD(n,e).then(r=>(r&&n[Zg]==e&&i!=n.geometry&&this._lodchangedlisteners.forEach(s=>s({type:"mesh",level:e,object:n})),r))}return Promise.resolve(null)}static isInside(n,e){const i=n.min,r=n.max,s=(i.x+r.x)*.5,o=(i.y+r.y)*.5;return this._tempPtInside.set(s,o,i.z).applyMatrix4(e).z<0}calculateLodLevel(n,e,i,r,s){var o;if(!e){s.mesh_lod=-1,s.texture_lod=-1;return}if(!n){s.mesh_lod=-1,s.texture_lod=-1;return}let a=10+1,l=!1;if(wl&&e["DEBUG:LOD"]!=null)return e["DEBUG:LOD"];const c=mi.getMeshLODInformation(e.geometry),h=c?.lods,u=h&&h.length>0,d=mi.getMaterialMinMaxLODsCount(e.material),f=d?.min_count!=1/0&&d.min_count>0&&d.max_count>0;if(!u&&!f){s.mesh_lod=0,s.texture_lod=0;return}u||(l=!0,a=0);const m=this.renderer.domElement.clientHeight||this.renderer.domElement.height;let g=e.geometry.boundingBox;if(e.type==="SkinnedMesh"){const v=e;if(!v.boundingBox)v.computeBoundingBox();else if(i.frames%30===0){const y=xA(v),A=v.geometry;y&&(v.geometry=y),v.computeBoundingBox(),v.geometry=A}g=v.boundingBox}if(g&&n.isPerspectiveCamera){const v=n;if(e.geometry.attributes.color&&e.geometry.attributes.color.count<100&&e.geometry.boundingSphere){this._sphere.copy(e.geometry.boundingSphere),this._sphere.applyMatrix4(e.matrixWorld);const T=n.getWorldPosition(this._tempWorldPosition);if(this._sphere.containsPoint(T)){s.mesh_lod=0,s.texture_lod=0;return}}if(this._tempBox.copy(g),this._tempBox.applyMatrix4(e.matrixWorld),Ba.isInside(this._tempBox,this.projectionScreenMatrix)){s.mesh_lod=0,s.texture_lod=0;return}if(this._tempBox.applyMatrix4(this.projectionScreenMatrix),this.renderer.xr.enabled&&v.fov>70){const T=this._tempBox.min,M=this._tempBox.max;let R=T.x,B=T.y,E=M.x,P=M.y;const O=2,N=1.5,L=(T.x+M.x)*.5,Q=(T.y+M.y)*.5;R=(R-L)*O+L,B=(B-Q)*O+Q,E=(E-L)*O+L,P=(P-Q)*O+Q;const D=R<0&&E>0?0:Math.min(Math.abs(T.x),Math.abs(M.x)),F=B<0&&P>0?0:Math.min(Math.abs(T.y),Math.abs(M.y)),H=Math.max(D,F);i.lastCentrality=(N-H)*(N-H)*(N-H)}else i.lastCentrality=1;const y=this._tempBox.getSize(this._tempBoxSize);y.multiplyScalar(.5),screen.availHeight>0&&m>0&&y.multiplyScalar(m/screen.availHeight),y.x*=v.aspect;const A=n.matrixWorldInverse,b=this._tempBox2;b.copy(g),b.applyMatrix4(e.matrixWorld),b.applyMatrix4(A);const x=b.getSize(this._tempBox2Size),_=Math.max(x.x,x.y);if(Math.max(y.x,y.y)!=0&&_!=0&&(y.z=x.z/Math.max(x.x,x.y)*Math.max(y.x,y.y)),i.lastScreenCoverage=Math.max(y.x,y.y,y.z),i.lastScreenspaceVolume.copy(y),i.lastScreenCoverage*=i.lastCentrality,wl&&Ba.debugDrawLine){const T=this.tempMatrix.copy(this.projectionScreenMatrix);T.invert();const M=Ba.corner0,R=Ba.corner1,B=Ba.corner2,E=Ba.corner3;M.copy(this._tempBox.min),R.copy(this._tempBox.max),R.x=M.x,B.copy(this._tempBox.max),B.y=M.y,E.copy(this._tempBox.max);const P=(M.z+E.z)*.5;M.z=R.z=B.z=E.z=P,M.applyMatrix4(T),R.applyMatrix4(T),B.applyMatrix4(T),E.applyMatrix4(T),Ba.debugDrawLine(M,R,255),Ba.debugDrawLine(M,B,255),Ba.debugDrawLine(R,E,255),Ba.debugDrawLine(B,E,255)}let w=999;if(h&&i.lastScreenCoverage>0){for(let T=0;T<h.length;T++)if(h[T].density/i.lastScreenCoverage<r){w=T;break}}w<a&&(a=w,l=!0)}if(l?s.mesh_lod=a:s.mesh_lod=i.lastLodLevel_Mesh,wl&&s.mesh_lod!=i.lastLodLevel_Mesh){const v=h?.[s.mesh_lod];v&&console.log(`Mesh LOD changed: ${i.lastLodLevel_Mesh} \u2192 ${s.mesh_lod} (${v.density.toFixed(0)}) - ${e.name}`)}if(f){const v="saveData"in globalThis.navigator&&globalThis.navigator.saveData===!0;if(i.lastLodLevel_Texture<0){if(s.texture_lod=d.max_count-1,wl){const y=d.lods[d.max_count-1];wl&&console.log(`First Texture LOD ${s.texture_lod} (${y.max_height}px) - ${e.name}`)}}else{const y=i.lastScreenspaceVolume.x+i.lastScreenspaceVolume.y+i.lastScreenspaceVolume.z;let A=i.lastScreenCoverage*2;((o=this.context)==null?void 0:o.engine)==="model-viewer"&&(A*=2);const b=m/window.devicePixelRatio*A;for(let x=d.lods.length-1;x>=0;x--){let _=d.lods[x];if(!(v&&_.max_height>=2048)&&!(Mue()&&_.max_height>4096)&&_.max_height>b){if(s.texture_lod=x,s.texture_lod<i.lastLodLevel_Texture){const w=_.max_height;wl&&console.log(`Texture LOD changed: ${i.lastLodLevel_Texture} \u2192 ${s.texture_lod} = ${w}px 
Screensize: ${b.toFixed(0)}px, Coverage: ${(100*i.lastScreenCoverage).toFixed(2)}%, Volume ${y.toFixed(1)} 
${e.name}`)}break}}}}else s.texture_lod=0}};let ka=Ba;Mo=new WeakMap,ed=new WeakMap,OB=new WeakMap,Kg=new WeakMap,wA=new WeakMap,xS=new WeakMap,td=new WeakMap,ka.corner0=new fe,ka.corner1=new fe,ka.corner2=new fe,ka.corner3=new fe,ka._tempPtInside=new fe;class Bue{constructor(){this.frames=0,this.lastLodLevel_Mesh=-1,this.lastLodLevel_Texture=-1,this.lastScreenCoverage=0,this.lastScreenspaceVolume=new fe,this.lastCentrality=0}}const sG=Symbol("NEEDLE_mesh_lod"),_S=Symbol("NEEDLE_texture_lod");let wS=null;function oG(){const n=kue();n&&(n.mapURLs(function(e){return aG(),e}),aG(),wS?.disconnect(),wS=new MutationObserver(e=>{e.forEach(i=>{i.addedNodes.forEach(r=>{r instanceof HTMLElement&&r.tagName.toLowerCase()==="model-viewer"&&cG(r)})})}),wS.observe(document,{childList:!0,subtree:!0}))}function kue(){return typeof customElements>"u"?null:customElements.get("model-viewer")||(customElements.whenDefined("model-viewer").then(()=>{console.debug("[gltf-progressive] model-viewer defined"),oG()}),null)}function aG(){typeof document>"u"||document.querySelectorAll("model-viewer").forEach(n=>{cG(n)})}const lG=new WeakSet;let Oue=0;function cG(n){if(!n||lG.has(n))return null;lG.add(n),console.debug("[gltf-progressive] found new model-viewer..."+ ++Oue+`
`,n.getAttribute("src"));let e=null,i=null,r=null;for(let s=n;s!=null;s=Object.getPrototypeOf(s)){const o=Object.getOwnPropertySymbols(s),a=o.find(h=>h.toString()=="Symbol(renderer)"),l=o.find(h=>h.toString()=="Symbol(scene)"),c=o.find(h=>h.toString()=="Symbol(needsRender)");!e&&a!=null&&(e=n[a].threeRenderer),!i&&l!=null&&(i=n[l]),!r&&c!=null&&(r=n[c])}if(e&&i){let s=function(){if(r){let a=0,l=setInterval(()=>{if(a++>5){clearInterval(l);return}r?.call(n)},300)}};console.debug("[gltf-progressive] setup model-viewer");const o=ka.get(e,{engine:"model-viewer"});return ka.addPlugin(new Due),o.enable(),o.addEventListener("changed",()=>{r?.call(n)}),n.addEventListener("model-visibility",a=>{a.detail.visible&&r?.call(n)}),n.addEventListener("load",()=>{s()}),()=>{o.disable()}}return null}class Due{constructor(){this._didWarnAboutMissingUrl=!1}onBeforeUpdateLOD(e,i,r,s){this.tryParseMeshLOD(i,s),this.tryParseTextureLOD(i,s)}getUrl(e){if(!e)return null;let i=e.getAttribute("src");return i||(i=e.src),i||(this._didWarnAboutMissingUrl||console.warn("No url found in modelviewer",e),this._didWarnAboutMissingUrl=!0),i}tryGetCurrentGLTF(e){return e._currentGLTF}tryGetCurrentModelViewer(e){return e.element}tryParseTextureLOD(e,i){if(i[_S]==!0)return;i[_S]=!0;const r=this.tryGetCurrentGLTF(e),s=this.tryGetCurrentModelViewer(e),o=this.getUrl(s);if(o&&r&&i.material){let a=function(c){var h,u,d;if(c[_S]==!0)return;c[_S]=!0,c.userData&&(c.userData.LOD=-1);const f=Object.keys(c);for(let m=0;m<f.length;m++){const g=f[m],v=c[g];if(v?.isTexture===!0){const y=(u=(h=v.userData)==null?void 0:h.associations)==null?void 0:u.textures;if(y==null)continue;const A=r.parser.json.textures[y];if(!A){console.warn("Texture data not found for texture index "+y);continue}if((d=A?.extensions)!=null&&d[Sh]){const b=A.extensions[Sh];b&&o&&mi.registerTexture(o,v,b.lods.length,y,b)}}}};const l=i.material;if(Array.isArray(l))for(const c of l)a(c);else a(l)}}tryParseMeshLOD(e,i){var r,s;if(i[sG]==!0)return;i[sG]=!0;const o=this.tryGetCurrentModelViewer(e),a=this.getUrl(o);if(!a)return;const l=(s=(r=i.userData)==null?void 0:r.gltfExtensions)==null?void 0:s[Sh];if(l&&a){const c=i.uuid;mi.registerMesh(a,c,i,0,l.lods.length,l)}}}oG();const $g=[];function SS(n){$g.indexOf(n)===-1&&$g.push(n)}function Lue(n){const e=$g.indexOf(n);e!==-1&&$g.splice(e,1)}const e0=[];function UB(n){e0.indexOf(n)===-1&&e0.push(n)}function Uue(n){const e=e0.indexOf(n);e!==-1&&e0.splice(e,1)}function hG(n){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-start",{detail:n}));for(let e=0;e<$g.length;e++)$g[e](n)}function uG(n){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-end",{detail:n}));for(let e=0;e<e0.length;e++)e0[e](n)}const Rr={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function dG(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function Fue(n){if(!n)throw new Error("No basePath supplied");return await dG(`${n}/profilesList.json`)}async function Nue(n,e,i=null,r=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const s=await Fue(e);let o;if(n.profiles.some(c=>{const h=s[c];return h&&(o={profileId:c,profilePath:`${e}/${h.path}`,deprecated:!!h.deprecated}),!!o}),!o){if(!i)throw new Error("No matching profile name found");const c=s[i];if(!c)throw new Error(`No matching profile name found and default profile "${i}" missing.`);o={profileId:i,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}}const a=await dG(o.profilePath);let l;if(r){let c;if(n.handedness==="any"?c=a.layouts[Object.keys(a.layouts)[0]]:c=a.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${o.profileId}`);c.assetPath&&(l=o.profilePath.replace("profile.json",c.assetPath))}return{profile:a,assetPath:l}}const zue={xAxis:0,yAxis:0,button:0,state:Rr.ComponentState.DEFAULT};function jue(n=0,e=0){let i=n,r=e;if(Math.sqrt(n*n+e*e)>1){const s=Math.atan2(e,n);i=Math.cos(s),r=Math.sin(s)}return{normalizedXAxis:i*.5+.5,normalizedYAxis:r*.5+.5}}let Gue=class{constructor(n){this.componentProperty=n.componentProperty,this.states=n.states,this.valueNodeName=n.valueNodeName,this.valueNodeProperty=n.valueNodeProperty,this.valueNodeProperty===Rr.VisualResponseProperty.TRANSFORM&&(this.minNodeName=n.minNodeName,this.maxNodeName=n.maxNodeName),this.value=0,this.updateFromComponent(zue)}updateFromComponent({xAxis:n,yAxis:e,button:i,state:r}){const{normalizedXAxis:s,normalizedYAxis:o}=jue(n,e);switch(this.componentProperty){case Rr.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?s:.5;break;case Rr.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?o:.5;break;case Rr.ComponentProperty.BUTTON:this.value=this.states.includes(r)?i:0;break;case Rr.ComponentProperty.STATE:this.valueNodeProperty===Rr.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},Hue=class{constructor(n,e){if(!n||!e||!e.visualResponses||!e.gamepadIndices||Object.keys(e.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=n,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach(i=>{const r=new Gue(e.visualResponses[i]);this.visualResponses[i]=r}),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:Rr.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(n){if(this.values.state=Rr.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&n.buttons.length>this.gamepadIndices.button){const e=n.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||this.values.button===1?this.values.state=Rr.ComponentState.PRESSED:(e.touched||this.values.button>Rr.ButtonTouchThreshold)&&(this.values.state=Rr.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&n.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=n.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Rr.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Rr.AxisTouchThreshold&&(this.values.state=Rr.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&n.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=n.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Rr.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Rr.AxisTouchThreshold&&(this.values.state=Rr.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}},Vue=class{constructor(n,e,i){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=n,this.assetUrl=i,this.id=e.profileId,this.layoutDescription=e.layouts[n.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{const s=this.layoutDescription.components[r];this.components[r]=new Hue(r,s)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const n=[];return Object.values(this.components).forEach(e=>{n.push(e.data)}),n}updateFromGamepad(){Object.values(this.components).forEach(n=>{n.updateFromGamepad(this.xrInputSource.gamepad)})}};const vr=te("debuginput");var CS=(n=>(n.Mouse="mouse",n.Touch="touch",n.Controller="controller",n.Hand="hand",n))(CS||{}),pn=(n=>(n.PointerDown="pointerdown",n.PointerUp="pointerup",n.PointerMove="pointermove",n.KeyDown="keydown",n.KeyUp="keyup",n.KeyPressed="keypress",n))(pn||{});class Eh extends PointerEvent{constructor(e,i,r){super(e,r),p(this,"clientZ"),p(this,"deviceIndex"),p(this,"origin"),p(this,"source"),p(this,"mode"),p(this,"_ray"),p(this,"space"),p(this,"isClick",!1),p(this,"isDoubleClick",!1),p(this,"_used",!1),p(this,"_pointerid"),p(this,"_pointerType"),p(this,"_type"),p(this,"metadata",{}),p(this,"intersections",new Array),p(this,"_immediatePropagationStopped",!1),p(this,"_propagationStopped",!1),this.clientZ=r.clientZ,this._pointerid=r.pointerId,this._pointerType=r.pointerType,this._type=e,this.deviceIndex=r.deviceIndex,this.origin=r.origin,this.source=i,this.mode=r.mode,this._ray=r.ray,this.space=r.device}get isSpatial(){return this.mode!="screen"}get ray(){return this._ray||(this._ray=new Js(this.space.worldPosition.clone(),this.space.worldForward.clone())),this._ray}set ray(e){this._ray=e}get hasRay(){return this._ray!==void 0}get used(){return this._used}use(){this._used=!0}get pointerId(){return this._pointerid}get pointerType(){return this._pointerType}get type(){return this._type}get immediatePropagationStopped(){return this._immediatePropagationStopped}get propagationStopped(){return this._immediatePropagationStopped||this._propagationStopped}stopImmediatePropagation(){var e;this._immediatePropagationStopped=!0,super.stopImmediatePropagation(),(e=this.source)==null||e.stopImmediatePropagation()}stopPropagation(){var e;this._propagationStopped=!0,super.stopPropagation(),(e=this.source)==null||e.stopPropagation(),vr&&console.warn("Stop propagation...",this.pointerId,this.pointerType)}}class SA extends KeyboardEvent{constructor(e,i,r){super(e,r),p(this,"source"),this.source=i}stopImmediatePropagation(){var e;super.stopImmediatePropagation(),(e=this.source)==null||e.stopImmediatePropagation()}}class Que{constructor(e){p(this,"key"),p(this,"keyType"),p(this,"source"),this.key=e.key,this.keyType=e.type,this.source=e}}var Oa=(n=>(n[n.Early=-100]="Early",n[n.Default=0]="Default",n[n.Late=100]="Late",n))(Oa||{});class pG{constructor(e){p(this,"_eventListeners",{}),p(this,"_doubleClickTimeThreshold",.2),p(this,"_longPressTimeThreshold",1),p(this,"_specialCursorTrigger",0),p(this,"context"),p(this,"_pointerDown",[!1]),p(this,"_pointerUp",[!1]),p(this,"_pointerClick",[!1]),p(this,"_pointerDoubleClick",[!1]),p(this,"_pointerPressed",[!1]),p(this,"_pointerPositions",[new J]),p(this,"_pointerPositionsLastFrame",[new J]),p(this,"_pointerPositionsDelta",[new J]),p(this,"_pointerPositionsRC",[new J]),p(this,"_pointerPositionDown",[new S]),p(this,"_pointerDownTime",[]),p(this,"_pointerUpTime",[]),p(this,"_pointerUpTimestamp",[]),p(this,"_pointerIds",[]),p(this,"_pointerTypes",[""]),p(this,"_mouseWheelChanged",[!1]),p(this,"_mouseWheelDeltaY",[0]),p(this,"_pointerEvent",[]),p(this,"_pointerEventsPressed",[]),p(this,"_pointerSpace",[]),p(this,"_pressedStack",new Map),p(this,"_htmlEventSource"),p(this,"onLostFocus",()=>{for(const i in this.keysPressed)this.keysPressed[i].pressed=!1}),p(this,"onEndOfFrame",()=>{for(let i=0;i<this._pointerUp.length;i++)this._pointerUp[i]=!1;for(let i=0;i<this._pointerDown.length;i++)this._pointerDown[i]=!1;for(let i=0;i<this._pointerClick.length;i++)this._pointerClick[i]=!1;for(let i=0;i<this._pointerDoubleClick.length;i++)this._pointerDoubleClick[i]=!1;for(const i of this._pointerPositionsDelta)i.set(0,0);for(let i=0;i<this._mouseWheelChanged.length;i++)this._mouseWheelChanged[i]=!1;for(let i=0;i<this._mouseWheelDeltaY.length;i++)this._mouseWheelDeltaY[i]=0}),p(this,"onContextMenu",i=>{this.canReceiveInput(i)!==!1&&i instanceof PointerEvent&&i.pointerType}),p(this,"keysPressed",{}),p(this,"onKeyDown",i=>{if(vr&&console.log(`key down ${i.code}, ${this.context.application.hasFocus}`,i),!this.context.application.hasFocus)return;const r=this.keysPressed[i.code];if(r&&r.pressed)return;this.keysPressed[i.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:i.key,code:i.code};const s=new SA("keydown",i,i);this.onDispatchEvent(s)}),p(this,"onKeyPressed",i=>{if(!this.context.application.hasFocus)return;const r=this.keysPressed[i.code];if(!r)return;r.pressed=!0,r.frame=this.context.time.frameCount+1;const s=new SA("keypress",i,i);this.onDispatchEvent(s)}),p(this,"onKeyUp",i=>{if(!this.context.application.hasFocus)return;const r=this.keysPressed[i.code];if(!r)return;r.pressed=!1,r.frame=this.context.time.frameCount+1;const s=new SA("keyup",i,i);this.onDispatchEvent(s)}),p(this,"onWheelWindow",i=>{document.pointerLockElement&&this.onMouseWheel(i)}),p(this,"onMouseWheel",i=>{if(this.canReceiveInput(i)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const r=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=r+i.deltaY}),p(this,"onPointerDown",i=>{if(this.context.isInAR||this.canReceiveInput(i)===!1)return;i.target instanceof HTMLElement&&i.target.setPointerCapture(i.pointerId);const r=this.getPointerId(i);vr&&dn(`pointer down #${r}, identifier:${i.pointerId}`);const s=this.getAndUpdateSpatialObjectForScreenPosition(r,i.clientX,i.clientY),o=new Eh("pointerdown",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:r,button:i.button,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:s,pressure:i.pressure});this.onDown(o)}),p(this,"onPointerMove",i=>{if(this.context.isInAR)return;let r=i.button;i.pointerType==="mouse"&&(r=this.getFirstPressedButtonForPointer(0)??0);const s=this.getPointerId(i,r);r===-1&&(r=s);const o=this.getAndUpdateSpatialObjectForScreenPosition(s,i.clientX,i.clientY),a=new Eh("pointermove",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:s,button:r,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:o,pressure:i.pressure});this.onMove(a)}),p(this,"onPointerCancel",i=>{this.context.isInAR||(vr&&console.log("Pointer cancel",i),this.onPointerUp(i))}),p(this,"onPointerUp",i=>{if(this.context.isInAR)return;i.target instanceof HTMLElement&&i.target.releasePointerCapture(i.pointerId);const r=this.getPointerId(i),s=new Eh("pointerup",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:r,button:i.button,clientX:i.clientX,clientY:i.clientY,pointerType:i.pointerType,buttonName:this.getButtonName(i),device:this.getAndUpdateSpatialObjectForScreenPosition(r,i.clientX,i.clientY),pressure:i.pressure});this.onUp(s),this._pointerIds[r]=-1,vr&&console.log("ID="+r,"PointerId="+i.pointerId,"ALL:",[...this._pointerIds])}),p(this,"onTouchStart",i=>{if(this.context.isInAR)for(let r=0;r<i.changedTouches.length;r++){const s=i.changedTouches[r],o=this.getPointerIndex(s.identifier),a=this.getAndUpdateSpatialObjectForScreenPosition(o,s.clientX,s.clientY),l=new Eh("pointerdown",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:o,button:0,clientX:s.clientX,clientY:s.clientY,pointerType:"touch",buttonName:"unknown",device:a,pressure:s.force});this.onDown(l)}}),p(this,"onTouchMove",i=>{if(this.context.isInAR)for(let r=0;r<i.changedTouches.length;r++){const s=i.changedTouches[r],o=this.getPointerIndex(s.identifier),a=this.getAndUpdateSpatialObjectForScreenPosition(o,s.clientX,s.clientY),l=new Eh("pointermove",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:o,button:0,clientX:s.clientX,clientY:s.clientY,pointerType:"touch",buttonName:"unknown",device:a,pressure:s.force});this.onMove(l)}}),p(this,"onTouchEnd",i=>{if(this.context.isInAR)for(let r=0;r<i.changedTouches.length;r++){const s=i.changedTouches[r],o=this.getPointerIndex(s.identifier),a=new Eh("pointerup",i,{origin:this,mode:"screen",deviceIndex:0,pointerId:o,button:0,clientX:s.clientX,clientY:s.clientY,pointerType:"touch",buttonName:"unknown",device:this.getAndUpdateSpatialObjectForScreenPosition(o,s.clientX,s.clientY),pressure:s.force});this.onUp(a),this._pointerIds[o]=-1}}),p(this,"tempNearPlaneVector",new S),p(this,"tempFarPlaneVector",new S),p(this,"tempLookMatrix",new he),this.context=e,this.context.post_render_callbacks.push(this.onEndOfFrame)}addEventListener(e,i,r){if(this._eventListeners[e]||(this._eventListeners[e]=[]),!i||typeof i!="function"){console.error("Invalid call to addEventListener: callback is required and must be a function!");return}r?r={...r}:r={};let s=0;r?.queue!=null&&(s=r.queue);const o=this._eventListeners[e],a=o.find(l=>l.priority===s);a?a.listeners.push({callback:i,options:r}):(o.push({priority:s,listeners:[{callback:i,options:r}]}),o.sort((l,c)=>l.priority-c.priority))}removeEventListener(e,i,r){if(!this._eventListeners[e]||!i)return;const s=this._eventListeners[e];if(r?.queue!=null){const o=s.find(l=>l.priority===r.queue);if(!o)return;const a=o.listeners.findIndex(l=>l.callback===i);a>=0&&o.listeners.splice(a,1)}else for(const o of s){const a=o.listeners.findIndex(l=>l.callback===i);a>=0&&o.listeners.splice(a,1)}}dispatchEvent(e){var i,r,s,o;let a=!1;if(e instanceof SA){const l=this._eventListeners[e.type];if(l)for(const c of l)for(let h=0;h<c.listeners.length;h++){const u=c.listeners[h];if((r=(i=u.options)==null?void 0:i.signal)!=null&&r.aborted){c.listeners.splice(h,1),h--;continue}u.options.once&&(c.listeners.splice(h,1),h--),u.callback(e)}}if(e instanceof Eh){const l=this._eventListeners[e.type];if(l)for(const c of l){if(a)break;for(let h=0;h<c.listeners.length;h++){const u=c.listeners[h];if((o=(s=u.options)==null?void 0:s.signal)!=null&&o.aborted){c.listeners.splice(h,1),h--;continue}if(e.immediatePropagationStopped){a=!0,vr&&console.log("immediatePropagationStopped",e.type);break}else e.propagationStopped&&(a=!0,vr&&console.log("propagationStopped",e.type));u.options.once&&(c.listeners.splice(h,1),h--),u.callback(e)}}}}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}getIsPointerIdInUse(e){for(const i of this._pointerEventsPressed)if(i.pointerId===e&&i.used)return!0;return!1}getPointerPressedCount(){let e=0;for(let i=0;i<this._pointerPressed.length;i++)this._pointerPressed[i]&&e++;return e}getPointerPosition(e){return e>=this._pointerPositions.length?null:this._pointerPositions[e]}getPointerPositionLastFrame(e){return e>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[e]}getPointerPositionDelta(e){return e>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[e]}getPointerPositionRC(e){return e>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[e]}getPointerDown(e){return e>=this._pointerDown.length?!1:this._pointerDown[e]}getPointerUp(e){return e>=this._pointerUp.length?!1:this._pointerUp[e]}getPointerPressed(e){return e>=this._pointerPressed.length?!1:this._pointerPressed[e]}getPointerClicked(e){return e>=this._pointerClick.length?!1:this._pointerClick[e]}getPointerDoubleClicked(e){return e>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[e]}getPointerDownTime(e){return e>=this._pointerDownTime.length?-1:this._pointerDownTime[e]}getPointerUpTime(e){return e>=this._pointerUpTime.length?-1:this._pointerUpTime[e]}getPointerLongPress(e){return e>=this._pointerDownTime.length?!1:this.getPointerPressed(e)&&this.context.time.time-this._pointerDownTime[e]>this._longPressTimeThreshold}getIsMouse(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]==="mouse"}getIsTouch(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]==="touch"}getTouchesPressedCount(){let e=0;for(let i=0;i<this._pointerPressed.length;i++)this._pointerPressed[i]&&this.getIsTouch(i)&&e++;return e}getMouseWheelChanged(e=0){return e>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[e]}getMouseWheelDeltaY(e=0){return e>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[e]}getPointerEvent(e){if(!(e>=this._pointerEvent.length))return this._pointerEvent[e]??void 0}*foreachPointerId(e){for(let i=0;i<this._pointerTypes.length;i++)if(this._pointerIsActive(i)){if(e!==void 0){const r=this._pointerTypes[i];if(Array.isArray(e)){let s=!1;for(const o of e)if(r===o){s=!0;break}if(!s)continue}else if(e!==r)continue}yield i}}*foreachTouchId(){for(let e=0;e<this._pointerTypes.length;e++)this._pointerTypes[e]==="touch"&&this._pointerIsActive[e]&&(yield e)}_pointerIsActive(e){return e<0?!1:this._pointerPressed[e]||this._pointerDown[e]||this._pointerUp[e]}onDownButton(e,i){let r=this._pressedStack.get(e);r||(r=[],this._pressedStack.set(e,r)),r.push(i)}onReleaseButton(e,i){const r=this._pressedStack.get(e);if(!r)return;const s=r.indexOf(i);s>=0&&r.splice(s,1)}getFirstPressedButtonForPointer(e){const i=this._pressedStack.get(e);if(i)return i[0]}getLatestPressedButtonForPointer(e){const i=this._pressedStack.get(e);if(i)return i[i.length-1]}getKeyDown(){for(const e in this.keysPressed){const i=this.keysPressed[e];if(i.startFrame===this.context.time.frameCount)return i.key}return null}getKeyPressed(){for(const e in this.keysPressed){const i=this.keysPressed[e];if(i.pressed)return i.key}return null}isKeyDown(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const r=this.getCodeForCommonKeyName(e);if(r!==null){for(const s of r)if(this.isKeyDown(s))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.startFrame)===this.context.time.frameCount&&this.keysPressed[e].pressed}isKeyUp(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const r=this.getCodeForCommonKeyName(e);if(r!==null){for(const s of r)if(this.isKeyUp(s))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.frame)===this.context.time.frameCount&&!this.keysPressed[e].pressed}isKeyPressed(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const r=this.getCodeForCommonKeyName(e);if(r!==null){for(const s of r)if(this.isKeyPressed(s))return!0;return!1}return(i=this.keysPressed[e])==null?void 0:i.pressed}getCodeForCommonKeyName(e){if(e.length===1){if(e>="0"&&e<="9")return["Digit"+e];if(e>="a"&&e<="z")return["Key"+e.toUpperCase()];if(e==" ")return["Space"]}switch(e){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createInputEvent(e){switch(e.type){case"pointerdown":vr&&dn("Create Pointer down"),this.onDownButton(e.deviceIndex,e.button),this.onDown(e);break;case"pointermove":vr&&dn("Create Pointer move"),this.onMove(e);break;case"pointerup":vr&&dn("Create Pointer up"),this.onUp(e),this.onReleaseButton(e.deviceIndex,e.button);break}}convertScreenspaceToRaycastSpace(e){return e.x=(e.x-this.context.domX)/this.context.domWidth*2-1,e.y=-((e.y-this.context.domY)/this.context.domHeight)*2+1,e}bindEvents(){this.unbindEvents(),this._htmlEventSource=this.context.renderer.domElement,window.addEventListener("contextmenu",this.onContextMenu),this._htmlEventSource.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),window.addEventListener("pointermove",this.onPointerMove,{passive:!0,capture:!0}),window.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:!0}),window.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this._htmlEventSource.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("wheel",this.onWheelWindow,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}unbindEvents(){var e,i;window.removeEventListener("contextmenu",this.onContextMenu),(e=this._htmlEventSource)==null||e.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),(i=this._htmlEventSource)==null||i.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("wheel",this.onWheelWindow,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}dispose(){const e=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);e>=0&&this.context.post_render_callbacks.splice(e,1),this.unbindEvents()}canReceiveInput(e){var i;return e.target===((i=this.context.renderer)==null?void 0:i.domElement)||e.target===this.context.domElement||this.context.isInAR||this.context.isInAR&&e.target===document.body&&qp()?!0:(vr&&console.warn("CanReceiveInput:False for",e.target),!1)}getPointerId(e,i){return e.pointerType==="mouse"?0+(i??e.button):this.getPointerIndex(e.pointerId)}getButtonName(e){const i=e.button;if(e.pointerType==="mouse")switch(i){case 0:return"left";case 1:return"middle";case 2:return"right"}return"unknown"}getAndUpdateSpatialObjectForScreenPosition(e,i,r){let s=this._pointerSpace[e];s||(s=new ve,this._pointerSpace[e]=s),this._pointerSpace[e]=s;const o=this.context.mainCamera;if(o){const a=this.tempNearPlaneVector.set(i,r,-1);this.convertScreenspaceToRaycastSpace(a);const l=this.tempFarPlaneVector.set(a.x,a.y,1);a.unproject(o),l.unproject(o);const c=o.worldUp||bt(0,1,0).applyQuaternion(Ri(o));this.tempLookMatrix.lookAt(l,a,c),s.position.set(a.x,a.y,a.z),s.quaternion.setFromRotationMatrix(this.tempLookMatrix)}return s}isInRect(e){if(this.context.isInXR)return!0;const i=this.context.domElement.getBoundingClientRect(),r=e.clientX,s=e.clientY,o=r>=i.x&&r<=i.right&&s>=i.y&&s<=i.bottom;return vr&&!o&&console.log("Not in rect",i,r,s),o}onDown(e){const i=e.pointerId;if(this.getPointerPressed(i)&&console.warn(`Received pointerDown for pointerId that is already pressed: ${i}`,vr?e:""),vr&&console.log(e.pointerType,"DOWN",i),!!this.isInRect(e)){for(this.setPointerState(i,this._pointerPressed,!0),this.setPointerState(i,this._pointerDown,!0),this.setPointerStateT(i,this._pointerEvent,e.source);i>=this._pointerTypes.length;)this._pointerTypes.push(e.pointerType);for(this._pointerTypes[i]=e.pointerType;i>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new S);for(this._pointerPositionDown[i].set(e.clientX,e.clientY,e.clientZ??0);i>=this._pointerPositions.length;)this._pointerPositions.push(new J);this._pointerPositions[i].set(e.clientX,e.clientY),i>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[i]=this.context.time.realtimeSinceStartup,this.updatePointerPosition(e),this._pointerEventsPressed.push(e),this.onDispatchEvent(e)}}onMove(e){const i=e.pointerId,r=this.getPointerPressed(i);r===!1&&!this.isInRect(e)||e.pointerType==="touch"&&!r||(this.updatePointerPosition(e),this.setPointerStateT(i,this._pointerEvent,e.source),this.onDispatchEvent(e))}onUp(e){const i=e.pointerId;if(!this.getPointerPressed(i)){vr&&console.log(e.pointerType,"UP",i,"was not down");return}vr&&console.log(e.pointerType,"UP",i),this.setPointerState(i,this._pointerPressed,!1),this.setPointerStateT(i,this._pointerEvent,e.source),this.setPointerState(i,this._pointerUp,!0),this.updatePointerPosition(e);for(let a=this._pointerEventsPressed.length-1;a>=0;a--)if(this._pointerEventsPressed[a].pointerId===i){this._pointerEventsPressed.splice(a,1);break}if(!this._pointerPositionDown[i]){vr&&Pi("Received pointer up event without matching down event for button: "+i),console.warn("Received pointer up event without matching down event for button: "+i);return}const r=this._pointerDownTime[i],s=this.context.time.realtimeSinceStartup,o=s-r;if(i>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),this._pointerUpTime[i]=s,o<1){let a=e.clientX-this._pointerPositionDown[i].x,l=e.clientY-this._pointerPositionDown[i].y,c=0;if(e.isSpatial&&e.clientZ!=null&&(c=e.clientZ-this._pointerPositionDown[i].z,a*=200,l*=200,c*=200),Math.abs(a)<5&&Math.abs(l)<5&&Math.abs(c)<5){vr&&console.log("CLICK",i,a,l,c),this.setPointerState(i,this._pointerClick,!0),e.isClick=!0;const h=this._pointerUpTime[i],u=this.context.time.time-h;u<this._doubleClickTimeThreshold&&u>0&&(this.setPointerState(i,this._pointerDoubleClick,!0),e.isDoubleClick=!0)}}this.onDispatchEvent(e)}updatePointerPosition(e){const i=e.pointerId;for(;i>=this._pointerPositions.length;)this._pointerPositions.push(new J);for(;i>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new J);for(;i>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new J);const r=this._pointerPositionsLastFrame[i];r.copy(this._pointerPositions[i]);const s=this._pointerPositionsDelta[i];let o=e.clientX-r.x,a=e.clientY-r.y;if(e.source instanceof MouseEvent||e.source instanceof TouchEvent){const u=e.source;o===0&&u.movementX!==0&&(o=u.movementX||0),a===0&&u.movementY!==0&&(a=u.movementY||0)}s.x+=o,s.y+=a,this._pointerPositions[i].x=e.clientX,this._pointerPositions[i].y=e.clientY;const l=e.clientX,c=e.clientY;for(;i>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new J);const h=this._pointerPositionsRC[i];h.set(l,c),this.convertScreenspaceToRaycastSpace(h)}getPointerIndex(e){let i=-1;for(let r=0;r<this._pointerIds.length;r++){if(this._pointerIds[r]===e)return r;i===-1&&this._pointerIds[r]===-1&&(i=r)}return i!==-1?(this._pointerIds[i]=e,i):(vr&&console.log("PUSH pointerId:",e),this._pointerIds.push(e),this._pointerIds.length-1)}setPointerState(e,i,r){i[e]=r}setPointerStateT(e,i,r){return i[e]=r,r}onDispatchEvent(e){const i=Ot.Current;try{Ot.Current=this.context,this.dispatchEvent(e)}finally{Ot.Current=i}}}const t0=new he().makeRotationY(Math.PI),lc=new Ce().setFromAxisAngle(new S(0,1,0),Math.PI),Wue=te("debugwebxr");class Xue{constructor(){if(p(this,"priority",-1e5),p(this,"gameObject"),this.gameObject=new ve,this.gameObject.name="Implicit XR Rig",Wue){const e=gk(16733661);e.position.y+=.5,this.gameObject.add(e)}}isXRRig(){return!0}get isActive(){return this.gameObject.visible}}const id=te("debugwebxr"),ES=te("debugcustomgesture"),que="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Yue="generic-trigger";class FB{constructor(e,i,r){p(this,"xr"),p(this,"inputSource"),p(this,"index",0),p(this,"emitEvents",!0),p(this,"_connected",!0),p(this,"_isTracking",!1),p(this,"__gamepad"),p(this,"__hand"),p(this,"__side"),p(this,"_hitTestSource"),p(this,"_hasSelectEvent",!1),p(this,"_handJointPoses",new Map),p(this,"_gripMatrix",new he),p(this,"_gripPosition",new S),p(this,"_gripQuaternion",new Ce),p(this,"_linearVelocity",new S),p(this,"_rayPositionRaw",new S),p(this,"_rayRotationRaw",new Ce),p(this,"_rayMatrix",new he),p(this,"_rayPosition",new S),p(this,"_rayQuaternion",new Ce),p(this,"_gripWorldPosition",new S),p(this,"_gripWorldQuaternion",new Ce),p(this,"_rayWorldPosition",new S),p(this,"_rayWorldQuaternion",new Ce),p(this,"_ray"),p(this,"_hand_wristDotUp"),p(this,"_object"),p(this,"model",null),p(this,"_debugAxesHelper",new Vo(.2)),p(this,"_hitTestSourcePromise",null),p(this,"onPointerHits",s=>{}),p(this,"_needleGamepadButtons",{}),p(this,"_buttonMap",new Map),p(this,"_motioncontroller"),p(this,"_layout"),p(this,"getMotionController"),p(this,"emitPointerDownEvent",!0),p(this,"emitPointerUpEvent",!0),p(this,"emitPointerMoveEvent",!0),p(this,"pointerMoveDistanceThreshold",.03),p(this,"pointerMoveAngleThreshold",.05),p(this,"_selectButtonIndex"),p(this,"_squeezeButtonIndex"),p(this,"onSelectStart",s=>{var o,a,l,c;if(!this.emitPointerDownEvent||this.inputSource!==s.inputSource)return;this.onUpdateFrame(s.frame),this._hasSelectEvent=!0;const h=(o=this._layout)==null?void 0:o.selectComponentId,u=(c=(l=(a=this._layout)==null?void 0:a.components[h])==null?void 0:l.gamepadIndices)==null?void 0:c.button;u!==void 0&&(this._selectButtonIndex=u),!ES&&(id&&yt.DrawDirection(this.rayWorldPosition,bt(0,.01,1).applyQuaternion(this.rayWorldQuaternion),16711680,10),this.emitPointerEvent(pn.PointerDown,this._selectButtonIndex||0,"xr-standard-trigger",!0,s))}),p(this,"onSelectEnd",s=>{this.emitPointerUpEvent&&(ES||this.inputSource===s.inputSource&&this.emitPointerEvent(pn.PointerUp,this._selectButtonIndex||0,"xr-standard-trigger",!0,s))}),p(this,"onSequeezeStart",s=>{var o,a,l;this.emitPointerDownEvent&&this.inputSource===s.inputSource&&(this._squeezeButtonIndex=(l=(a=(o=this._layout)==null?void 0:o.components["xr-standard-squeeze"])==null?void 0:a.gamepadIndices)==null?void 0:l.button,this._squeezeButtonIndex!==void 0&&(id&&yt.DrawDirection(this.rayWorldPosition,bt(0,.01,1).applyQuaternion(this.rayWorldQuaternion),255,10),this.emitPointerEvent(pn.PointerDown,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,s)))}),p(this,"onSequeezeEnd",s=>{this.emitPointerUpEvent&&this.inputSource===s.inputSource&&this._squeezeButtonIndex!==void 0&&this.emitPointerEvent(pn.PointerUp,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,s)}),p(this,"states",{}),p(this,"_didMoveLastFrame",!1),p(this,"_lastPointerMovePosition",new S),p(this,"_lastPointerMoveQuaternion",new Ce),p(this,"pointerInit"),this.xr=e,this.inputSource=i,this.index=r,this._object=new ve,id&&this._object.add(this._debugAxesHelper),this.xr.context.scene.add(this._object),this._ray=new Js,this.pointerInit={origin:this,pointerType:this.hand?"hand":"controller",deviceIndex:this.index,pointerId:-1,mode:this.inputSource.targetRayMode,ray:this._ray,device:this._object,buttonName:"none"},this.initialize(),this.subscribeEvents()}get context(){return this.xr.context}get connected(){return this._connected}get isTracking(){return this._isTracking}get gamepad(){return this.__gamepad??(this.__gamepad=this.inputSource.gamepad)}get isHand(){return this.hand!=null}get hand(){return this.__hand??(this.__hand=this.inputSource.hand)}get handObject(){return this.context.renderer.xr.getHand(this.index)}get profiles(){return this.inputSource.profiles}get layout(){return this._layout}get targetRayMode(){return this.inputSource.targetRayMode}get targetRaySpace(){return this.inputSource.targetRaySpace}get gripSpace(){return this.inputSource.gripSpace}get side(){return this.__side??(this.__side=this.inputSource.handedness)}get isRight(){return this.side==="right"}get isLeft(){return this.side==="left"}getHitTestSource(){return this._hitTestSource||this._requestHitTestSource(),this._hitTestSource}get hasHitTestSource(){return this._hitTestSource}cancelHitTestSource(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}get hasSelectEvent(){return this._hasSelectEvent}getHitTest(){return this.xr.getHitTest(this)}getHandJointPose(e,i){var r;if(i=i||this.xr.frame,!this.hand||!(i!=null&&i.getJointPose)||!this.xr.referenceSpace)return null;let s=(r=this._handJointPoses)==null?void 0:r.get(e);return s||(s=i.getJointPose(e,this.xr.referenceSpace),s&&this._handJointPoses.set(e,s),s)}get gripPosition(){return bt(this._gripPosition)}get gripQuaternion(){return ic(this._gripQuaternion)}get gripMatrix(){return this._gripMatrix}get gripLinearVelocity(){return bt(this._linearVelocity).applyQuaternion(lc)}get rayPosition(){return bt(this._rayPosition)}get rayQuaternion(){return ic(this._rayQuaternion)}get gripWorldPosition(){return bt(this._gripWorldPosition)}get gripWorldQuaternion(){return ic(this._gripWorldQuaternion)}get rayWorldPosition(){return bt(this._rayWorldPosition)}updateRayWorldPosition(){var e;const i=(e=this.xr.context.mainCamera)==null?void 0:e.parent;this._rayWorldPosition.copy(this._rayPositionRaw),i&&this._rayWorldPosition.applyMatrix4(i.matrixWorld)}get rayWorldQuaternion(){return ic(this._rayWorldQuaternion)}updateRayWorldQuaternion(){var e;const i=(e=this.xr.context.mainCamera)==null?void 0:e.parent,r=i?Ri(i):void 0;this._rayWorldQuaternion.copy(this._rayRotationRaw).multiply(lc),r&&this._rayWorldQuaternion.premultiply(r)}get ray(){return this._ray.origin.copy(this.rayWorldPosition),this._ray.direction.copy(bt(0,0,1).applyQuaternion(this.rayWorldQuaternion)),this._ray}get handWristDotUp(){var e;if(this._hand_wristDotUp!==void 0)return this._hand_wristDotUp;const i=(e=this.handObject)==null?void 0:e.joints.wrist;if(i){const r=bt(0,1,0).applyQuaternion(i.quaternion),s=bt(0,1,0).dot(r);return this._hand_wristDotUp=s}}get isHandUpsideDown(){return this.handWristDotUp!==void 0?this.handWristDotUp<-.7:!1}get isTeleportGesture(){return this.isHandUpsideDown}get object(){return this._object}async getModelUrl(){var e;return(e=this.getMotionController)==null?void 0:e.then(i=>i?.assetUrl||null)}_requestHitTestSource(){var e;return this._hitTestSourcePromise?this._hitTestSourcePromise:this.xr.mode==="immersive-ar"&&this.inputSource.targetRayMode==="tracked-pointer"&&this.xr.session.requestHitTestSourceForTransientInput?this._hitTestSourcePromise=((e=this.xr.session.requestHitTestSourceForTransientInput({profile:this.inputSource.profiles[0],offsetRay:new XRRay}))==null?void 0:e.then(i=>(this._hitTestSourcePromise=null,this.connected?this._hitTestSource=i:(i.cancel(),null))))??null:null}onUpdate(e){performance.mark("NeedleXRController onUpdate start"),this.onUpdateFrame(e),this.updateInputEvents(),this.onUpdateMove(),performance.mark("NeedleXRController onUpdate end"),performance.measure("NeedleXRController onUpdate","NeedleXRController onUpdate start","NeedleXRController onUpdate end")}onRenderDebug(){var e;yt.DrawWireSphere(this.rayWorldPosition,.02),yt.DrawDirection(this.rayWorldPosition,bt(0,0,10).applyQuaternion(this.rayWorldQuaternion));const i=this.gripWorldPosition.sub(this.object.worldForward.multiplyScalar(.1)),r=this.inputSource.profiles.join(`
`);let s=`Controller[${this.index}] ${this.side}
C:${this.connected?"yes":"no"} T:${this.isTracking?"yes":"no"} Hand:${this.inputSource.hand?"yes":"no"}`;this.inputSource.hand&&(s+=`
Pinch: ${(e=this.getGesture("pinch"))==null?void 0:e.value.toFixed(3)}`),s+=`
`+r,yt.DrawLabel(i,s,.01)}onUpdateFrame(e){var i,r,s;if(this._handJointPoses.clear(),this._hand_wristDotUp=void 0,!this.xr.referenceSpace){this._isTracking=!1;return}const o=e.getPose(this.inputSource.targetRaySpace,this.xr.referenceSpace);this._isTracking=o!=null;let a=null,l=null,c=null,h=null;if(o){const m=o.transform;this._rayMatrix.fromArray(m.matrix).premultiply(t0),this._rayMatrix.decompose(this._rayPosition,this._rayQuaternion,bt(1,1,1)),c=bt(m.position),h=ic(m.orientation),this._rayPositionRaw.copy(m.position),this._rayRotationRaw.copy(m.orientation)}if(this.inputSource.gripSpace){const m=e.getPose(this.inputSource.gripSpace,this.xr.referenceSpace);if(m){const g=m.transform;if(a=bt(g.position),l=ic(g.orientation),this._gripMatrix.fromArray(g.matrix).premultiply(t0),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,bt(1,1,1)),"linearVelocity"in m&&m.linearVelocity){const v=m.linearVelocity;this._linearVelocity.set(v.x,v.y,v.z)}}}(i=this.xr.context.mainCamera)!=null&&i.parent&&this._object.parent!==((r=this.xr.context.mainCamera)==null?void 0:r.parent)&&this.xr.context.mainCamera.parent.add(this._object);const u=this.hand;if(u){let m=!1;const g=u.get("wrist"),v=g&&this.getHandJointPose(g,e);if(v){m=!0;const b=v.transform.position,x=v.transform.orientation;this._object.position.set(b.x,b.y,b.z),this._object.quaternion.set(x.x,x.y,x.z,x.w).multiply(lc)}m||(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(lc));const y=u.get("middle-finger-metacarpal"),A=y&&this.getHandJointPose(y,e);A&&(this._gripMatrix.fromArray(A.transform.matrix).premultiply(t0),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,bt(1,1,1)))}else this.inputSource.gripSpace&&this.targetRayMode==="transient-pointer"&&a&&l?(this._object.position.copy(a),this._object.quaternion.copy(l).multiply(lc)):c&&h&&(this._object.position.copy(c),this._object.quaternion.copy(h).multiply(lc));const d=(s=this.xr.context.mainCamera)==null?void 0:s.parent,f=d?Ri(d):void 0;a&&l&&(this._gripWorldPosition.copy(a),d&&this._gripWorldPosition.applyMatrix4(d.matrixWorld),this._gripWorldQuaternion.copy(l),this._gripWorldQuaternion.multiply(lc),f&&this._gripWorldQuaternion.premultiply(f)),this.updateRayWorldPosition(),this.updateRayWorldQuaternion()}onDisconnected(){this._connected=!1,id&&console.warn("Controller disconnected",this.index);for(const e of this._object.children)this.xr.context.scene.attach(e);this._object.removeFromParent(),this._debugAxesHelper.removeFromParent(),this.unsubscribeEvents(),this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}getButton(e){var i;if(!this._layout)return;switch(e){case"primary-button":if(this.isLeft)e="x-button";else if(this.isRight)e="a-button";else return;break;case"primary":return this.hand?this.getGesture("pinch"):this.toNeedleGamepadButton(0,e)}if(this._buttonMap.has(e))return this.toNeedleGamepadButton(this._buttonMap.get(e),e);const r=(i=this._layout)==null?void 0:i.components[e];if(r!=null&&r.gamepadIndices)switch(r.type){case"button":case"squeeze":if(this.inputSource.gamepad){const s=r.gamepadIndices.button;return this._buttonMap.set(e,s),this.toNeedleGamepadButton(s,e)}break;default:console.warn("Unsupported component type",r.type);break}this._buttonMap.set(e,void 0)}getGesture(e){const i=this.states[e];if(!i)return null;this.states[e]=i;const r=this._needleGamepadButtons[e]||new mG(void 0,e);return r.pressed=i.pressed,r.value=i.value,r.isDown=i.isDown,r.isUp=i.isUp,this._needleGamepadButtons[e]=r,r}getPointerId(e){if((e==="primary"||e==="pinch")&&(e=0),typeof e!="number"){const i=this._buttonMap.get(e);if(i===void 0)return;e=i}return this.index*10+e}toNeedleGamepadButton(e,i){var r,s;if(!((r=this.inputSource.gamepad)!=null&&r.buttons))return;const o=(s=this.inputSource.gamepad)==null?void 0:s.buttons[e],a=this.states[e],l=this._needleGamepadButtons[e]||new mG(e,i);return o&&(l.pressed=o.pressed,l.value=o.value,l.touched=o.touched),a&&(l.isDown=a.isDown,l.isUp=a.isUp),this._needleGamepadButtons[e]=l,l}getStick(e){var i,r,s,o,a,l,c,h,u;if(!this._layout)return{x:0,y:0,z:0};if(e==="primary"){const f=((i=this.inputSource.gamepad)==null?void 0:i.axes[0])||0,m=((r=this.inputSource.gamepad)==null?void 0:r.axes[1])||0,g=((o=(s=this.inputSource.gamepad)==null?void 0:s.buttons[3])==null?void 0:o.value)||0;return{x:f,y:m,z:g}}const d=(a=this._layout)==null?void 0:a.components[e];if(d!=null&&d.gamepadIndices)switch(d.type){case"thumbstick":if(this.inputSource.gamepad){const f=d.gamepadIndices.xAxis,m=d.gamepadIndices.yAxis;let g=(l=this.inputSource.gamepad)==null?void 0:l.axes[f],v=(c=this.inputSource.gamepad)==null?void 0:c.axes[m];g*=-1,v*=-1;const y=d.gamepadIndices.button,A=(u=(h=this.inputSource.gamepad)==null?void 0:h.buttons[y])==null?void 0:u.value;return{x:g,y:v,z:A}}}return{x:0,y:0,z:0}}initialize(){if(this._hasSelectEvent=this.profiles.includes("generic-hand-select")||this.profiles.some(e=>e.startsWith("generic-trigger")),!this._layout){if(this.inputSource.targetRayMode==="transient-pointer")return;const e=Nue(this.inputSource,que,Yue);this.getMotionController=e.then(i=>{var r;if(!this.connected)return null;this._motioncontroller=new Vue(this.inputSource,i.profile,i.assetPath||"");const s=i.profile.layouts[this.inputSource.handedness];if(this._layout=s,this._layout&&!((r=this._layout.gamepad)!=null&&r.length)){this._layout.gamepad=[];for(const o in this._layout.components){const a=this._layout.components[o];this._layout.gamepad[a.gamepadIndices.button]=o}}return this._motioncontroller}).catch(i=>(this.inputSource&&console.warn("Couldn't initialize motion controller profile for ",this.inputSource,i),null))}}subscribeEvents(){this.xr.session.addEventListener("selectstart",this.onSelectStart),this.xr.session.addEventListener("selectend",this.onSelectEnd),this.xr.session.addEventListener("squeezestart",this.onSequeezeStart),this.xr.session.addEventListener("squeezeend",this.onSequeezeEnd)}unsubscribeEvents(){this.xr.session.removeEventListener("selectstart",this.onSelectStart),this.xr.session.removeEventListener("selectend",this.onSelectEnd),this.xr.session.removeEventListener("squeezestart",this.onSequeezeStart),this.xr.session.removeEventListener("squeezeend",this.onSequeezeEnd)}updateInputEvents(){var e,i;if((e=this.gamepad)!=null&&e.buttons)for(let r=0;r<this.gamepad.buttons.length;r++){const s=this.gamepad.buttons[r],o=this.states[r]||new fG;let a=null;s.pressed&&!o.pressed?(a="pointerdown",o.isDown=!0,o.isUp=!1):!s.pressed&&o.pressed?(a="pointerup",o.isDown=!1,o.isUp=!0):(o.isDown=!1,o.isUp=!1),o.value=s.value,o.pressed=s.pressed,this.states[r]=o;const l=r!==this._selectButtonIndex&&r!==this._squeezeButtonIndex;if(a!=null&&l){const c=(i=this._layout)==null?void 0:i.gamepad[r];(id||ES)&&console.log("Emitting pointer event",a,r,c,s.value,this.gamepad,this._layout),this.emitPointerEvent(a,r,c??"none",!1,null,s.value)}}if(this.hand){const r=this.handObject;if(r){const s=r.joints["index-finger-tip"],o=r.joints["thumb-tip"];if(s&&o){const a=s.position.distanceTo(o.position);if(a!==0){const l=this.states.pinch||new fG,c=(.02+.01)*1.5;l.value=1-(a-.02)/c;const h=a<.02-.01,u=a>.02+.01;h&&!l.pressed?(ES&&console.log("pinch start",a),l.isDown=!0,l.isUp=!1,l.pressed=!0):u&&l.pressed?(l.isDown=!1,l.isUp=!0,l.pressed=!1):(l.isDown=!1,l.isUp=!1),this.states.pinch=l}}}}}onUpdateMove(){var e,i;if(!this.emitPointerMoveEvent)return;let r=!1;if(this._lastPointerMovePosition.distanceTo(this.gripWorldPosition)>this.pointerMoveDistanceThreshold*this.xr.rigScale&&(r=!0),r||this._lastPointerMoveQuaternion.angleTo(this.gripWorldQuaternion)>this.pointerMoveAngleThreshold&&(r=!0),r){this._didMoveLastFrame=!0,this._lastPointerMovePosition.copy(this.gripWorldPosition),this._lastPointerMoveQuaternion.copy(this.gripWorldQuaternion),id&&yt.DrawLabel(this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.1)),"move",.01);let s=this.xr.context.input.getFirstPressedButtonForPointer(this.index);s===void 0&&(s=0);const o=(i=(e=this.gamepad)==null?void 0:e.buttons[s])==null?void 0:i.value;this.emitPointerEvent("pointermove",s,"none",!1,null,o)}else this._didMoveLastFrame=!1}emitPointerEvent(e,i,r,s,o=null,a){if(!this.emitEvents){id&&e!==pn.PointerMove&&console.warn("Pointer events are disabled for this controller",this.index,e,i);return}if(this.xr.mode==="immersive-vr"||this.xr.isPassThrough){this.pointerInit.origin=this,this.pointerInit.pointerId=this.getPointerId(i),this.pointerInit.pointerType=this.hand?"hand":"controller",this.pointerInit.button=i,this.pointerInit.buttonName=r,this.pointerInit.isPrimary=s,this.pointerInit.mode=this.inputSource.targetRayMode,this.pointerInit.ray=this.ray,this.pointerInit.device=this.object,this.pointerInit.pressure=a,this.pointerInit.clientX=this._rayPosition.x/this.xr.rigScale,this.pointerInit.clientY=this._rayPosition.y/this.xr.rigScale,this.pointerInit.clientZ=this._rayPosition.z/this.xr.rigScale;const l=Ot.Current;Ot.Current=this.xr.context,id&&e!=="pointermove"&&console.warn("Pointer event",e,i,r,{...this.pointerInit}),this.xr.context.input.createInputEvent(new Eh(e,o,this.pointerInit)),Ot.Current=l}}}class fG{constructor(){p(this,"isDown",!1),p(this,"isUp",!1),p(this,"pressed",!1),p(this,"value",0)}}class mG{constructor(e,i){p(this,"index"),p(this,"name"),p(this,"touched",!1),p(this,"pressed",!1),p(this,"value",0),p(this,"isDown",!1),p(this,"isUp",!1),this.index=e,this.name=i}}function mf(n,e){try{e?n(e):n()}catch(i){return console.error(i),!1}return!0}const CA=new Map,NB=new WeakSet;function nd(n,e,i){CA.has(e)||CA.set(e,new Array),CA.get(e).push({method:n,options:{once:!1,...i}})}function rd(n,e){const i=CA.get(e);if(i){for(let r=0;r<i.length;r++)if(i[r].method===n){i.splice(r,1);return}}}function cc(n,e){e===Si.ContextCreated&&NB.delete(n);const i=CA.get(e);if(i&&i.length>0){const r=i;if(e===Xi.Start){if(NB.has(n))return;NB.add(n)}Jue(n,r)}}const MS=new Array;function Jue(n,e){var i;MS.length=0;for(let r=0;r<e.length;r++)MS.push(e[r]);for(let r=0;r<MS.length;r++){const s=MS[r];if(mf(s.method,n),(i=s.options)!=null&&i.once){for(let o=0;o<e.length;o++)if(e[o]===s){e.splice(o,1);break}}}}const zB=2,hc=4,Mh=4,jB=4,sd=new Int32Array(2),gG=new Float32Array(sd.buffer),vG=new Float64Array(sd.buffer),TS=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class du{constructor(e,i){this.low=e|0,this.high=i|0}static create(e,i){return e==0&&i==0?du.ZERO:new du(e,i)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(e){return this.low==e.low&&this.high==e.high}}du.ZERO=new du(0,0);var GB;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(GB||(GB={}));class h_{constructor(e){this.bytes_=e,this.position_=0}static allocate(e){return new h_(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return new du(this.readInt32(e),this.readInt32(e+4))}readUint64(e){return new du(this.readUint32(e),this.readUint32(e+4))}readFloat32(e){return sd[0]=this.readInt32(e),gG[0]}readFloat64(e){return sd[TS?0:1]=this.readInt32(e),sd[TS?1:0]=this.readInt32(e+4),vG[0]}writeInt8(e,i){this.bytes_[e]=i}writeUint8(e,i){this.bytes_[e]=i}writeInt16(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8}writeUint16(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8}writeInt32(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8,this.bytes_[e+2]=i>>16,this.bytes_[e+3]=i>>24}writeUint32(e,i){this.bytes_[e]=i,this.bytes_[e+1]=i>>8,this.bytes_[e+2]=i>>16,this.bytes_[e+3]=i>>24}writeInt64(e,i){this.writeInt32(e,i.low),this.writeInt32(e+4,i.high)}writeUint64(e,i){this.writeUint32(e,i.low),this.writeUint32(e+4,i.high)}writeFloat32(e,i){gG[0]=i,this.writeInt32(e,sd[0])}writeFloat64(e,i){vG[0]=i,this.writeInt32(e,sd[TS?0:1]),this.writeInt32(e+4,sd[TS?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+hc+Mh)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let i=0;i<Mh;i++)e+=String.fromCharCode(this.readInt8(this.position_+hc+i));return e}__offset(e,i){const r=e-this.readInt32(e);return i<this.readInt16(r)?this.readInt16(r+i):0}__union(e,i){return e.bb_pos=i+this.readInt32(i),e.bb=this,e}__string(e,i){e+=this.readInt32(e);const r=this.readInt32(e);let s="",o=0;if(e+=hc,i===GB.UTF8_BYTES)return this.bytes_.subarray(e,e+r);for(;o<r;){let a;const l=this.readUint8(e+o++);if(l<192)a=l;else{const c=this.readUint8(e+o++);if(l<224)a=(l&31)<<6|c&63;else{const h=this.readUint8(e+o++);if(l<240)a=(l&15)<<12|(c&63)<<6|h&63;else{const u=this.readUint8(e+o++);a=(l&7)<<18|(c&63)<<12|(h&63)<<6|u&63}}}a<65536?s+=String.fromCharCode(a):(a-=65536,s+=String.fromCharCode((a>>10)+55296,(a&1024-1)+56320))}return s}__union_with_string(e,i){return typeof e=="string"?this.__string(i):this.__union(e,i)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+hc}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Mh)throw new Error("FlatBuffers: file identifier must be length "+Mh);for(let i=0;i<Mh;i++)if(e.charCodeAt(i)!=this.readInt8(this.position()+hc+i))return!1;return!0}createLong(e,i){return du.create(e,i)}createScalarList(e,i){const r=[];for(let s=0;s<i;++s)e(s)!==null&&r.push(e(s));return r}createObjList(e,i){const r=[];for(let s=0;s<i;++s){const o=e(s);o!==null&&r.push(o.unpack())}return r}}class u_{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let i;e?i=e:i=1024,this.bb=h_.allocate(i),this.space=i}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,i){e>this.minalign&&(this.minalign=e);const r=~(this.bb.capacity()-this.space+i)+1&e-1;for(;this.space<r+e+i;){const s=this.bb.capacity();this.bb=u_.growByteBuffer(this.bb),this.space+=this.bb.capacity()-s}this.pad(r)}pad(e){for(let i=0;i<e;i++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,i,r){(this.force_defaults||i!=r)&&(this.addInt8(i),this.slot(e))}addFieldInt16(e,i,r){(this.force_defaults||i!=r)&&(this.addInt16(i),this.slot(e))}addFieldInt32(e,i,r){(this.force_defaults||i!=r)&&(this.addInt32(i),this.slot(e))}addFieldInt64(e,i,r){(this.force_defaults||!i.equals(r))&&(this.addInt64(i),this.slot(e))}addFieldFloat32(e,i,r){(this.force_defaults||i!=r)&&(this.addFloat32(i),this.slot(e))}addFieldFloat64(e,i,r){(this.force_defaults||i!=r)&&(this.addFloat64(i),this.slot(e))}addFieldOffset(e,i,r){(this.force_defaults||i!=r)&&(this.addOffset(i),this.slot(e))}addFieldStruct(e,i,r){i!=r&&(this.nested(i),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const i=e.capacity();if(i&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const r=i<<1,s=h_.allocate(r);return s.setPosition(r-i),s.bytes().set(e.bytes(),r-i),s}addOffset(e){this.prep(hc,0),this.writeInt32(this.offset()-e+hc)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let i=0;i<e;i++)this.vtable[i]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let i=this.vtable_in_use-1;for(;i>=0&&this.vtable[i]==0;i--);const r=i+1;for(;i>=0;i--)this.addInt16(this.vtable[i]!=0?e-this.vtable[i]:0);const s=2;this.addInt16(e-this.object_start);const o=(r+s)*zB;this.addInt16(o);let a=0;const l=this.space;e:for(i=0;i<this.vtables.length;i++){const c=this.bb.capacity()-this.vtables[i];if(o==this.bb.readInt16(c)){for(let h=zB;h<o;h+=zB)if(this.bb.readInt16(l+h)!=this.bb.readInt16(c+h))continue e;a=this.vtables[i];break}}return a?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,a-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,i,r){const s=r?jB:0;if(i){const o=i;if(this.prep(this.minalign,hc+Mh+s),o.length!=Mh)throw new Error("FlatBuffers: file identifier must be length "+Mh);for(let a=Mh-1;a>=0;a--)this.writeInt8(o.charCodeAt(a))}this.prep(this.minalign,hc+s),this.addOffset(e),s&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,i){this.finish(e,i,!0)}requiredField(e,i){const r=this.bb.capacity()-e,s=r-this.bb.readInt32(r);if(this.bb.readInt16(s+i)==0)throw new Error("FlatBuffers: field "+i+" must be set")}startVector(e,i,r){this.notNested(),this.vector_num_elems=i,this.prep(hc,e*i),this.prep(r,e*i)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const i=this.createString(e);return this.string_maps.set(e,i),i}createString(e){if(!e)return 0;let i;if(e instanceof Uint8Array)i=e;else{i=[];let r=0;for(;r<e.length;){let s;const o=e.charCodeAt(r++);if(o<55296||o>=56320)s=o;else{const a=e.charCodeAt(r++);s=(o<<10)+a+(65536-56623104-56320)}s<128?i.push(s):(s<2048?i.push(s>>6&31|192):(s<65536?i.push(s>>12&15|224):i.push(s>>18&7|240,s>>12&63|128),i.push(s>>6&63|128)),i.push(s&63|128))}}this.addInt8(0),this.startVector(1,i.length,1),this.bb.setPosition(this.space-=i.length);for(let r=0,s=this.space,o=this.bb.bytes();r<i.length;r++)o[s++]=i[r];return this.endVector()}createLong(e,i){return du.create(e,i)}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const i=[];for(let r=0;r<e.length;++r){const s=e[r];if(s!==null)i.push(this.createObjectOffset(s));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return i}createStructOffsetList(e,i){return i(this,e.length),this.createObjectOffsetList(e),this.endVector()}}const HB={};function VB(n,e){HB[n]=e}function yG(n){const e=n.getBufferIdentifier(),i=HB[e];return i(n)}function AG(n){return typeof n.guid=="function"?n.guid():null}function IS(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var bG={exports:{}};(function(n){var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),n.exports.binaryFeatures=e;var i=n.exports.BlobBuilder;typeof window<"u"&&(i=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function r(){this._pieces=[],this._parts=[]}r.prototype.append=function(s){typeof s=="number"?this._pieces.push(s):(this.flush(),this._parts.push(s))},r.prototype.flush=function(){if(this._pieces.length>0){var s=new Uint8Array(this._pieces);e.useArrayBufferView||(s=s.buffer),this._parts.push(s),this._pieces=[]}},r.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var s=new i,o=0,a=this._parts.length;o<a;o++)s.append(this._parts[o]);return s.getBlob()}else return new Blob(this._parts)},n.exports.BufferBuilder=r})(bG);var xG=bG.exports,Kue=xG.BufferBuilder,_G=xG.binaryFeatures,Zue={unpack:function(n){var e=new Kr(n);return e.unpack()},pack:function(n){var e=new Zr;e.pack(n);var i=e.getBuffer();return i}},$ue=Zue;function Kr(n){this.index=0,this.dataBuffer=n,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}Kr.prototype.unpack=function(){var n=this.unpack_uint8();if(n<128)return n;if((n^224)<32)return(n^224)-32;var e;if((e=n^160)<=15)return this.unpack_raw(e);if((e=n^176)<=15)return this.unpack_string(e);if((e=n^144)<=15)return this.unpack_array(e);if((e=n^128)<=15)return this.unpack_map(e);switch(n){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},Kr.prototype.unpack_uint8=function(){var n=this.dataView[this.index]&255;return this.index++,n},Kr.prototype.unpack_uint16=function(){var n=this.read(2),e=(n[0]&255)*256+(n[1]&255);return this.index+=2,e},Kr.prototype.unpack_uint32=function(){var n=this.read(4),e=((n[0]*256+n[1])*256+n[2])*256+n[3];return this.index+=4,e},Kr.prototype.unpack_uint64=function(){var n=this.read(8),e=((((((n[0]*256+n[1])*256+n[2])*256+n[3])*256+n[4])*256+n[5])*256+n[6])*256+n[7];return this.index+=8,e},Kr.prototype.unpack_int8=function(){var n=this.unpack_uint8();return n<128?n:n-256},Kr.prototype.unpack_int16=function(){var n=this.unpack_uint16();return n<32768?n:n-65536},Kr.prototype.unpack_int32=function(){var n=this.unpack_uint32();return n<Math.pow(2,31)?n:n-Math.pow(2,32)},Kr.prototype.unpack_int64=function(){var n=this.unpack_uint64();return n<Math.pow(2,63)?n:n-Math.pow(2,64)},Kr.prototype.unpack_raw=function(n){if(this.length<this.index+n)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+n+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+n);return this.index+=n,e},Kr.prototype.unpack_string=function(n){for(var e=this.read(n),i=0,r="",s,o;i<n;)s=e[i],s<128?(r+=String.fromCharCode(s),i++):(s^192)<32?(o=(s^192)<<6|e[i+1]&63,r+=String.fromCharCode(o),i+=2):(o=(s&15)<<12|(e[i+1]&63)<<6|e[i+2]&63,r+=String.fromCharCode(o),i+=3);return this.index+=n,r},Kr.prototype.unpack_array=function(n){for(var e=new Array(n),i=0;i<n;i++)e[i]=this.unpack();return e},Kr.prototype.unpack_map=function(n){for(var e={},i=0;i<n;i++){var r=this.unpack(),s=this.unpack();e[r]=s}return e},Kr.prototype.unpack_float=function(){var n=this.unpack_uint32(),e=n>>31,i=(n>>23&255)-127,r=n&8388607|8388608;return(e===0?1:-1)*r*Math.pow(2,i-23)},Kr.prototype.unpack_double=function(){var n=this.unpack_uint32(),e=this.unpack_uint32(),i=n>>31,r=(n>>20&2047)-1023,s=n&1048575|1048576,o=s*Math.pow(2,r-20)+e*Math.pow(2,r-52);return(i===0?1:-1)*o},Kr.prototype.read=function(n){var e=this.index;if(e+n<=this.length)return this.dataView.subarray(e,e+n);throw new Error("BinaryPackFailure: read index out of range")};function Zr(){this.bufferBuilder=new Kue}Zr.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},Zr.prototype.pack=function(n){var e=typeof n;if(e==="string")this.pack_string(n);else if(e==="number")Math.floor(n)===n?this.pack_integer(n):this.pack_double(n);else if(e==="boolean")n===!0?this.bufferBuilder.append(195):n===!1&&this.bufferBuilder.append(194);else if(e==="undefined")this.bufferBuilder.append(192);else if(e==="object")if(n===null)this.bufferBuilder.append(192);else{var i=n.constructor;if(i==Array)this.pack_array(n);else if(i==Blob||i==File||n instanceof Blob||n instanceof File)this.pack_bin(n);else if(i==ArrayBuffer)_G.useArrayBufferView?this.pack_bin(new Uint8Array(n)):this.pack_bin(n);else if("BYTES_PER_ELEMENT"in n)_G.useArrayBufferView?this.pack_bin(new Uint8Array(n.buffer)):this.pack_bin(n.buffer);else if(i==Object||i.toString().startsWith("class"))this.pack_object(n);else if(i==Date)this.pack_string(n.toString());else if(typeof n.toBinaryPack=="function")this.bufferBuilder.append(n.toBinaryPack());else throw new Error('Type "'+i.toString()+'" not yet supported')}else throw new Error('Type "'+e+'" not yet supported');this.bufferBuilder.flush()},Zr.prototype.pack_bin=function(n){var e=n.length||n.byteLength||n.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)},Zr.prototype.pack_string=function(n){var e=tde(n);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(n)},Zr.prototype.pack_array=function(n){var e=n.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");for(var i=0;i<e;i++)this.pack(n[i])},Zr.prototype.pack_integer=function(n){if(n>=-32&&n<=127)this.bufferBuilder.append(n&255);else if(n>=0&&n<=255)this.bufferBuilder.append(204),this.pack_uint8(n);else if(n>=-128&&n<=127)this.bufferBuilder.append(208),this.pack_int8(n);else if(n>=0&&n<=65535)this.bufferBuilder.append(205),this.pack_uint16(n);else if(n>=-32768&&n<=32767)this.bufferBuilder.append(209),this.pack_int16(n);else if(n>=0&&n<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(n);else if(n>=-2147483648&&n<=2147483647)this.bufferBuilder.append(210),this.pack_int32(n);else if(n>=-9223372036854776e3&&n<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(n);else if(n>=0&&n<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(n);else throw new Error("Invalid integer")},Zr.prototype.pack_double=function(n){var e=0;n<0&&(e=1,n=-n);var i=Math.floor(Math.log(n)/Math.LN2),r=n/Math.pow(2,i)-1,s=Math.floor(r*Math.pow(2,52)),o=Math.pow(2,32),a=e<<31|i+1023<<20|s/o&1048575,l=s%o;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(l)},Zr.prototype.pack_object=function(n){var e=Object.keys(n),i=e.length;if(i<=15)this.pack_uint8(128+i);else if(i<=65535)this.bufferBuilder.append(222),this.pack_uint16(i);else if(i<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(i);else throw new Error("Invalid length");for(var r in n)n.hasOwnProperty(r)&&(this.pack(r),this.pack(n[r]))},Zr.prototype.pack_uint8=function(n){this.bufferBuilder.append(n)},Zr.prototype.pack_uint16=function(n){this.bufferBuilder.append(n>>8),this.bufferBuilder.append(n&255)},Zr.prototype.pack_uint32=function(n){var e=n&4294967295;this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)},Zr.prototype.pack_uint64=function(n){var e=n/Math.pow(2,32),i=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((i&4278190080)>>>24),this.bufferBuilder.append((i&16711680)>>>16),this.bufferBuilder.append((i&65280)>>>8),this.bufferBuilder.append(i&255)},Zr.prototype.pack_int8=function(n){this.bufferBuilder.append(n&255)},Zr.prototype.pack_int16=function(n){this.bufferBuilder.append((n&65280)>>8),this.bufferBuilder.append(n&255)},Zr.prototype.pack_int32=function(n){this.bufferBuilder.append(n>>>24&255),this.bufferBuilder.append((n&16711680)>>>16),this.bufferBuilder.append((n&65280)>>>8),this.bufferBuilder.append(n&255)},Zr.prototype.pack_int64=function(n){var e=Math.floor(n/Math.pow(2,32)),i=n%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((i&4278190080)>>>24),this.bufferBuilder.append((i&16711680)>>>16),this.bufferBuilder.append((i&65280)>>>8),this.bufferBuilder.append(i&255)};function ede(n){var e=n.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function tde(n){return n.length>600?new Blob([n]).size:n.replace(/[^\u0000-\u007F]/g,ede).length}const wG=IS($ue);let SG=!0,CG=!0;function EA(n,e,i){const r=n.match(e);return r&&r.length>=i&&parseInt(r[i],10)}function i0(n,e,i){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(a,l){if(a!==e)return s.apply(this,arguments);const c=h=>{const u=i(h);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),s.apply(this,[a,c])};const o=r.removeEventListener;r.removeEventListener=function(a,l){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function ide(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(SG=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function nde(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(CG=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function QB(){if(typeof window=="object"){if(SG)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function RS(n,e){CG&&console.warn(n+" is deprecated, please use "+e+" instead.")}function rde(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator)return e.browser="Not a browser.",e;const{navigator:i}=n;if(i.mozGetUserMedia)e.browser="firefox",e.version=EA(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)e.browser="chrome",e.version=EA(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.mediaDevices&&i.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=EA(i.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(n.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=EA(i.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function EG(n){return Object.prototype.toString.call(n)==="[object Object]"}function MG(n){return EG(n)?Object.keys(n).reduce(function(e,i){const r=EG(n[i]),s=r?MG(n[i]):n[i],o=r&&!Object.keys(s).length;return s===void 0||o?e:Object.assign(e,{[i]:s})},{}):n}function WB(n,e,i){!e||i.has(e.id)||(i.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?WB(n,n.get(e[r]),i):r.endsWith("Ids")&&e[r].forEach(s=>{WB(n,n.get(s),i)})}))}function TG(n,e,i){const r=i?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const o=[];return n.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{n.forEach(l=>{l.type===r&&l.trackId===a.id&&WB(n,l,s)})}),s}const IG=QB;function RG(n,e){const i=n&&n.navigator;if(!i.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const u=typeof l[h]=="object"?l[h]:{ideal:l[h]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,m){return f?f+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",h)]=u.ideal,c.optional.push(f),f={},f[d("max",h)]=u.ideal,c.optional.push(f)):(f[d("",h)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",h)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(f,h)]=u[f])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},s=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const h=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};l=JSON.parse(JSON.stringify(l)),h(l.audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const u=e.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let d;if(h.exact==="environment"||h.ideal==="environment"?d=["back","rear"]:(h.exact==="user"||h.ideal==="user")&&(d=["front"]),d)return i.mediaDevices.enumerateDevices().then(f=>{f=f.filter(g=>g.kind==="videoinput");let m=f.find(g=>d.some(v=>g.label.toLowerCase().includes(v)));return!m&&f.length&&d.includes("back")&&(m=f[f.length-1]),m&&(l.video.deviceId=h.exact?{exact:m.deviceId}:{ideal:m.deviceId}),l.video=r(l.video),IG("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return IG("chrome: "+JSON.stringify(l)),c(l)},o=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(l,c,h){s(l,u=>{i.webkitGetUserMedia(u,c,d=>{h&&h(o(d))})})};if(i.getUserMedia=a.bind(i),i.mediaDevices.getUserMedia){const l=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(c){return s(c,h=>l(h).then(u=>{if(h.audio&&!u.getAudioTracks().length||h.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(o(u))))}}}function sde(n,e){if(!(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)&&n.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}n.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(r=>{const s=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:a||3}},s&&(i.video.mandatory.maxWidth=s),o&&(i.video.mandatory.maxHeight=o),n.navigator.mediaDevices.getUserMedia(i)})}}}function PG(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function BG(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else i0(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function kG(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(s,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=s.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,l){let c=s.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function OG(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,r,s]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const o=function(l){const c={};return l.result().forEach(h=>{const u={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(d=>{u[d]=h.stat(d)}),c[u.id]=u}),c},a=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){r(a(o(c)))};return e.apply(this,[l,i])}return new Promise((l,c)=>{e.apply(this,[function(h){l(a(o(h)))},c])}).then(r,s)}}function DG(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const i=n.RTCPeerConnection.prototype.getSenders;i&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=i.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>TG(o,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const i=n.RTCPeerConnection.prototype.getReceivers;i&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=i.apply(this,[]);return r.forEach(s=>s._pc=this),r}),i0(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>TG(s,r.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function LG(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(h=>h.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();i.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function UG(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return LG(n);const i=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const h=i.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(u=>this._reverseStreams[u.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(u=>{if(this.getSenders().find(d=>d.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const u=new n.MediaStream(h.getTracks());this._streams[h.id]=u,this._reverseStreams[u.id]=h,h=u}r.apply(this,[h])};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},n.RTCPeerConnection.prototype.addTrack=function(h,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(m=>m===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const f=this._streams[u.id];if(f)f.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new n.MediaStream([h]);this._streams[u.id]=m,this._reverseStreams[m.id]=u,this.addStream(m)}return this.getSenders().find(m=>m.track===h)};function o(h,u){let d=u.sdp;return Object.keys(h._reverseStreams||[]).forEach(f=>{const m=h._reverseStreams[f],g=h._streams[m.id];d=d.replace(new RegExp(g.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function a(h,u){let d=u.sdp;return Object.keys(h._reverseStreams||[]).forEach(f=>{const m=h._reverseStreams[f],g=h._streams[m.id];d=d.replace(new RegExp(m.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(h){const u=n.RTCPeerConnection.prototype[h],d={[h](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[m=>{const g=o(this,m);f[0].apply(null,[g])},m=>{f[1]&&f[1].apply(null,m)},arguments[2]]):u.apply(this,arguments).then(m=>o(this,m))}};n.RTCPeerConnection.prototype[h]=d[h]});const l=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=a(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=c.get.apply(this);return h.type===""?h:o(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let u;Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(f=>h.track===f)&&(u=this._streams[d])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function XB(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const r=n.RTCPeerConnection.prototype[i],s={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=s[i]})}function FG(n,e){i0(n,"negotiationneeded",i=>{const r=i.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return i})}const NG=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:FG,shimAddTrackRemoveTrack:UG,shimAddTrackRemoveTrackWithNative:LG,shimGetDisplayMedia:sde,shimGetSendersWithDtmf:kG,shimGetStats:OG,shimGetUserMedia:RG,shimMediaStream:PG,shimOnTrack:BG,shimPeerConnection:XB,shimSenderReceiverGetStats:DG},Symbol.toStringTag,{value:"Module"}));function ode(n,e){let i=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(r=>{if(r&&(r.urls||r.url)){let s=r.urls||r.url;r.url&&!r.urls&&RS("RTCIceServer.url","RTCIceServer.urls");const o=typeof s=="string";return o&&(s=[s]),s=s.filter(a=>{if(a.indexOf("stun:")===0)return!1;const l=a.startsWith("turn")&&!a.startsWith("turn:[")&&a.includes("transport=udp");return l&&!i?(i=!0,!0):l&&!i}),delete r.url,r.urls=o?s[0]:s,!!s.length}})}var zG={exports:{}};(function(n){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(i){return i.trim().split(`
`).map(function(r){return r.trim()})},e.splitSections=function(i){var r=i.split(`
m=`);return r.map(function(s,o){return(o>0?"m="+s:s).trim()+`\r
`})},e.getDescription=function(i){var r=e.splitSections(i);return r&&r[0]},e.getMediaSections=function(i){var r=e.splitSections(i);return r.shift(),r},e.matchPrefix=function(i,r){return e.splitLines(i).filter(function(s){return s.indexOf(r)===0})},e.parseCandidate=function(i){var r;i.indexOf("a=candidate:")===0?r=i.substring(12).split(" "):r=i.substring(10).split(" ");for(var s={foundation:r[0],component:parseInt(r[1],10),protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]},o=8;o<r.length;o+=2)switch(r[o]){case"raddr":s.relatedAddress=r[o+1];break;case"rport":s.relatedPort=parseInt(r[o+1],10);break;case"tcptype":s.tcpType=r[o+1];break;case"ufrag":s.ufrag=r[o+1],s.usernameFragment=r[o+1];break;default:s[r[o]]=r[o+1];break}return s},e.writeCandidate=function(i){var r=[];r.push(i.foundation),r.push(i.component),r.push(i.protocol.toUpperCase()),r.push(i.priority),r.push(i.address||i.ip),r.push(i.port);var s=i.type;return r.push("typ"),r.push(s),s!=="host"&&i.relatedAddress&&i.relatedPort&&(r.push("raddr"),r.push(i.relatedAddress),r.push("rport"),r.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(r.push("ufrag"),r.push(i.usernameFragment||i.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(i){return i.substr(14).split(" ")},e.parseRtpMap=function(i){var r=i.substr(9).split(" "),s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(i){var r=i.payloadType;i.preferredPayloadType!==void 0&&(r=i.preferredPayloadType);var s=i.channels||i.numChannels||1;return"a=rtpmap:"+r+" "+i.name+"/"+i.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(i){var r=i.substr(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},e.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+`\r
`},e.parseFmtp=function(i){for(var r={},s,o=i.substr(i.indexOf(" ")+1).split(";"),a=0;a<o.length;a++)s=o[a].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(i){var r="",s=i.payloadType;if(i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){var o=[];Object.keys(i.parameters).forEach(function(a){i.parameters[a]?o.push(a+"="+i.parameters[a]):o.push(a)}),r+="a=fmtp:"+s+" "+o.join(";")+`\r
`}return r},e.parseRtcpFb=function(i){var r=i.substr(i.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(i){var r="",s=i.payloadType;return i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(function(o){r+="a=rtcp-fb:"+s+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(i){var r=i.indexOf(" "),s={ssrc:parseInt(i.substr(7,r-7),10)},o=i.indexOf(":",r);return o>-1?(s.attribute=i.substr(r+1,o-r-1),s.value=i.substr(o+1)):s.attribute=i.substr(r+1),s},e.parseSsrcGroup=function(i){var r=i.substr(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(function(s){return parseInt(s,10)})}},e.getMid=function(i){var r=e.matchPrefix(i,"a=mid:")[0];if(r)return r.substr(6)},e.parseFingerprint=function(i){var r=i.substr(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1]}},e.getDtlsParameters=function(i,r){var s=e.matchPrefix(i+r,"a=fingerprint:");return{role:"auto",fingerprints:s.map(e.parseFingerprint)}},e.writeDtlsParameters=function(i,r){var s="a=setup:"+r+`\r
`;return i.fingerprints.forEach(function(o){s+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),s},e.parseCryptoLine=function(i){var r=i.substr(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?e.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;var r=i.substr(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},e.getCryptoParameters=function(i,r){var s=e.matchPrefix(i+r,"a=crypto:");return s.map(e.parseCryptoLine)},e.getIceParameters=function(i,r){var s=e.matchPrefix(i+r,"a=ice-ufrag:")[0],o=e.matchPrefix(i+r,"a=ice-pwd:")[0];return s&&o?{usernameFragment:s.substr(12),password:o.substr(10)}:null},e.writeIceParameters=function(i){return"a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`},e.parseRtpParameters=function(i){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(i),o=s[0].split(" "),a=3;a<o.length;a++){var l=o[a],c=e.matchPrefix(i,"a=rtpmap:"+l+" ")[0];if(c){var h=e.parseRtpMap(c),u=e.matchPrefix(i,"a=fmtp:"+l+" ");switch(h.parameters=u.length?e.parseFmtp(u[0]):{},h.rtcpFeedback=e.matchPrefix(i,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),r.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(h.name.toUpperCase());break}}}return e.matchPrefix(i,"a=extmap:").forEach(function(d){r.headerExtensions.push(e.parseExtmap(d))}),r},e.writeRtpDescription=function(i,r){var s="";s+="m="+i+" ",s+=r.codecs.length>0?"9":"0",s+=" UDP/TLS/RTP/SAVPF ",s+=r.codecs.map(function(a){return a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType}).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(function(a){s+=e.writeRtpMap(a),s+=e.writeFmtp(a),s+=e.writeRtcpFb(a)});var o=0;return r.codecs.forEach(function(a){a.maxptime>o&&(o=a.maxptime)}),o>0&&(s+="a=maxptime:"+o+`\r
`),s+=`a=rtcp-mux\r
`,r.headerExtensions&&r.headerExtensions.forEach(function(a){s+=e.writeExtmap(a)}),s},e.parseRtpEncodingParameters=function(i){var r=[],s=e.parseRtpParameters(i),o=s.fecMechanisms.indexOf("RED")!==-1,a=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(i,"a=ssrc:").map(function(f){return e.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),c=l.length>0&&l[0].ssrc,h,u=e.matchPrefix(i,"a=ssrc-group:FID").map(function(f){var m=f.substr(17).split(" ");return m.map(function(g){return parseInt(g,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(h=u[0][1]),s.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var m={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&h&&(m.rtx={ssrc:h}),r.push(m),o&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(m))}}),r.length===0&&c&&r.push({ssrc:c});var d=e.matchPrefix(i,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substr(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substr(5),10)*1e3*.95-50*40*8:d=void 0,r.forEach(function(f){f.maxBitrate=d})),r},e.parseRtcpParameters=function(i){var r={},s=e.matchPrefix(i,"a=ssrc:").map(function(l){return e.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="cname"})[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);var o=e.matchPrefix(i,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=o.length===0;var a=e.matchPrefix(i,"a=rtcp-mux");return r.mux=a.length>0,r},e.parseMsid=function(i){var r,s=e.matchPrefix(i,"a=msid:");if(s.length===1)return r=s[0].substr(7).split(" "),{stream:r[0],track:r[1]};var o=e.matchPrefix(i,"a=ssrc:").map(function(a){return e.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="msid"});if(o.length>0)return r=o[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(i){var r=e.parseMLine(i),s=e.matchPrefix(i,"a=max-message-size:"),o;s.length>0&&(o=parseInt(s[0].substr(19),10)),isNaN(o)&&(o=65536);var a=e.matchPrefix(i,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:r.fmt,maxMessageSize:o};var l=e.matchPrefix(i,"a=sctpmap:");if(l.length>0){var c=e.matchPrefix(i,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(i,r){var s=[];return i.protocol!=="DTLS/SCTP"?s=["m="+i.kind+" 9 "+i.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+i.kind+" 9 "+i.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(i,r,s){var o,a=r!==void 0?r:2;i?o=i:o=e.generateSessionId();var l=s||"thisisadapterortc";return`v=0\r
o=`+l+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(i,r,s,o){var a=e.writeRtpDescription(i.kind,r);if(a+=e.writeIceParameters(i.iceGatherer.getLocalParameters()),a+=e.writeDtlsParameters(i.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":"active"),a+="a=mid:"+i.mid+`\r
`,i.direction?a+="a="+i.direction+`\r
`:i.rtpSender&&i.rtpReceiver?a+=`a=sendrecv\r
`:i.rtpSender?a+=`a=sendonly\r
`:i.rtpReceiver?a+=`a=recvonly\r
`:a+=`a=inactive\r
`,i.rtpSender){var l="msid:"+o.id+" "+i.rtpSender.track.id+`\r
`;a+="a="+l,a+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" "+l,i.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" "+l,a+="a=ssrc-group:FID "+i.sendEncodingParameters[0].ssrc+" "+i.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return a+="a=ssrc:"+i.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,i.rtpSender&&i.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+i.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),a},e.getDirection=function(i,r){for(var s=e.splitLines(i),o=0;o<s.length;o++)switch(s[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[o].substr(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(i){var r=e.splitLines(i),s=r[0].split(" ");return s[0].substr(2)},e.isRejected=function(i){return i.split(" ",2)[1]==="0"},e.parseMLine=function(i){var r=e.splitLines(i),s=r[0].substr(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(i){var r=e.matchPrefix(i,"o=")[0],s=r.substr(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;for(var r=e.splitLines(i),s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},n.exports=e})(zG);var jG=zG.exports;const PS=IS(jG);var Nt=jG;function ade(n){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type}function GG(n,e,i,r,s){var o=Nt.writeRtpDescription(n.kind,e);if(o+=Nt.writeIceParameters(n.iceGatherer.getLocalParameters()),o+=Nt.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),i==="offer"?"actpass":s||"active"),o+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?o+=`a=sendrecv\r
`:n.rtpSender?o+=`a=sendonly\r
`:n.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,n.rtpSender){var a=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=a;var l="msid:"+(r?r.id:"-")+" "+a+`\r
`;o+="a="+l,o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+l,n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+l,o+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+Nt.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+Nt.localCName+`\r
`),o}function lde(n,e){var i=!1;return n=JSON.parse(JSON.stringify(n)),n.filter(function(r){if(r&&(r.urls||r.url)){var s=r.urls||r.url;r.url&&!r.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o=typeof s=="string";return o&&(s=[s]),s=s.filter(function(a){var l=a.indexOf("turn:")===0&&a.indexOf("transport=udp")!==-1&&a.indexOf("turn:[")===-1&&!i;return l?(i=!0,!0):a.indexOf("stun:")===0&&e>=14393&&a.indexOf("?transport=udp")===-1}),delete r.url,r.urls=o?s[0]:s,!!s.length}})}function BS(n,e){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(o,a){o=parseInt(o,10);for(var l=0;l<a.length;l++)if(a[l].payloadType===o||a[l].preferredPayloadType===o)return a[l]},s=function(o,a,l,c){var h=r(o.parameters.apt,l),u=r(a.parameters.apt,c);return h&&u&&h.name.toLowerCase()===u.name.toLowerCase()};return n.codecs.forEach(function(o){for(var a=0;a<e.codecs.length;a++){var l=e.codecs[a];if(o.name.toLowerCase()===l.name.toLowerCase()&&o.clockRate===l.clockRate){if(o.name.toLowerCase()==="rtx"&&o.parameters&&l.parameters.apt&&!s(o,l,n.codecs,e.codecs))continue;l=JSON.parse(JSON.stringify(l)),l.numChannels=Math.min(o.numChannels,l.numChannels),i.codecs.push(l),l.rtcpFeedback=l.rtcpFeedback.filter(function(c){for(var h=0;h<o.rtcpFeedback.length;h++)if(o.rtcpFeedback[h].type===c.type&&o.rtcpFeedback[h].parameter===c.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(o){for(var a=0;a<e.headerExtensions.length;a++){var l=e.headerExtensions[a];if(o.uri===l.uri){i.headerExtensions.push(l);break}}}),i}function HG(n,e,i){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][n].indexOf(i)!==-1}function qB(n,e){var i=n.getRemoteCandidates().find(function(r){return e.foundation===r.foundation&&e.ip===r.ip&&e.port===r.port&&e.priority===r.priority&&e.protocol===r.protocol&&e.type===r.type});return i||n.addRemoteCandidate(e),!i}function Os(n,e){var i=new Error(e);return i.name=n,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],i}var cde=function(n,e){function i(c,h){h.addTrack(c),h.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:c}))}function r(c,h){h.removeTrack(c),h.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:c}))}function s(c,h,u,d){var f=new Event("track");f.track=h,f.receiver=u,f.transceiver={receiver:u},f.streams=d,n.setTimeout(function(){c._dispatchEvent("track",f)})}var o=function(c){var h=this,u=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(f){h[f]=u[f].bind(u)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",c=JSON.parse(JSON.stringify(c||{})),this.usingBundle=c.bundlePolicy==="max-bundle",c.rtcpMuxPolicy==="negotiate")throw Os("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(c.rtcpMuxPolicy||(c.rtcpMuxPolicy="require"),c.iceTransportPolicy){case"all":case"relay":break;default:c.iceTransportPolicy="all";break}switch(c.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:c.bundlePolicy="balanced";break}if(c.iceServers=lde(c.iceServers||[],e),this._iceGatherers=[],c.iceCandidatePoolSize)for(var d=c.iceCandidatePoolSize;d>0;d--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:c.iceServers,gatherPolicy:c.iceTransportPolicy}));else c.iceCandidatePoolSize=0;this._config=c,this.transceivers=[],this._sdpSessionId=Nt.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(c,h){this._isClosed||(this.dispatchEvent(h),typeof this["on"+c]=="function"&&this["on"+c](h))},o.prototype._emitGatheringStateChange=function(){var c=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",c)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(c,h){var u=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:c,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&u)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();d.iceTransport=f.iceTransport,d.dtlsTransport=f.dtlsTransport}return h||this.transceivers.push(d),d},o.prototype.addTrack=function(c,h){if(this._isClosed)throw Os("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var u=this.transceivers.find(function(m){return m.track===c});if(u)throw Os("InvalidAccessError","Track already exists.");for(var d,f=0;f<this.transceivers.length;f++)!this.transceivers[f].track&&this.transceivers[f].kind===c.kind&&(d=this.transceivers[f]);return d||(d=this._createTransceiver(c.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(h)===-1&&this.localStreams.push(h),d.track=c,d.stream=h,d.rtpSender=new n.RTCRtpSender(c,d.dtlsTransport),d.rtpSender},o.prototype.addStream=function(c){var h=this;if(e>=15025)c.getTracks().forEach(function(d){h.addTrack(d,c)});else{var u=c.clone();c.getTracks().forEach(function(d,f){var m=u.getTracks()[f];d.addEventListener("enabled",function(g){m.enabled=g.enabled})}),u.getTracks().forEach(function(d){h.addTrack(d,u)})}},o.prototype.removeTrack=function(c){if(this._isClosed)throw Os("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(c instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var h=this.transceivers.find(function(f){return f.rtpSender===c});if(!h)throw Os("InvalidAccessError","Sender was not created by this connection.");var u=h.stream;h.rtpSender.stop(),h.rtpSender=null,h.track=null,h.stream=null;var d=this.transceivers.map(function(f){return f.stream});d.indexOf(u)===-1&&this.localStreams.indexOf(u)>-1&&this.localStreams.splice(this.localStreams.indexOf(u),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(c){var h=this;c.getTracks().forEach(function(u){var d=h.getSenders().find(function(f){return f.track===u});d&&h.removeTrack(d)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(c){return!!c.rtpSender}).map(function(c){return c.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(c){return!!c.rtpReceiver}).map(function(c){return c.rtpReceiver})},o.prototype._createIceGatherer=function(c,h){var u=this;if(h&&c>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var d=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(d,"state",{value:"new",writable:!0}),this.transceivers[c].bufferedCandidateEvents=[],this.transceivers[c].bufferCandidates=function(f){var m=!f.candidate||Object.keys(f.candidate).length===0;d.state=m?"completed":"gathering",u.transceivers[c].bufferedCandidateEvents!==null&&u.transceivers[c].bufferedCandidateEvents.push(f)},d.addEventListener("localcandidate",this.transceivers[c].bufferCandidates),d},o.prototype._gather=function(c,h){var u=this,d=this.transceivers[h].iceGatherer;if(!d.onlocalcandidate){var f=this.transceivers[h].bufferedCandidateEvents;this.transceivers[h].bufferedCandidateEvents=null,d.removeEventListener("localcandidate",this.transceivers[h].bufferCandidates),d.onlocalcandidate=function(m){if(!(u.usingBundle&&h>0)){var g=new Event("icecandidate");g.candidate={sdpMid:c,sdpMLineIndex:h};var v=m.candidate,y=!v||Object.keys(v).length===0;if(y)(d.state==="new"||d.state==="gathering")&&(d.state="completed");else{d.state==="new"&&(d.state="gathering"),v.component=1,v.ufrag=d.getLocalParameters().usernameFragment;var A=Nt.writeCandidate(v);g.candidate=Object.assign(g.candidate,Nt.parseCandidate(A)),g.candidate.candidate=A,g.candidate.toJSON=function(){return{candidate:g.candidate.candidate,sdpMid:g.candidate.sdpMid,sdpMLineIndex:g.candidate.sdpMLineIndex,usernameFragment:g.candidate.usernameFragment}}}var b=Nt.getMediaSections(u._localDescription.sdp);y?b[g.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:b[g.candidate.sdpMLineIndex]+="a="+g.candidate.candidate+`\r
`,u._localDescription.sdp=Nt.getDescription(u._localDescription.sdp)+b.join("");var x=u.transceivers.every(function(_){return _.iceGatherer&&_.iceGatherer.state==="completed"});u.iceGatheringState!=="gathering"&&(u.iceGatheringState="gathering",u._emitGatheringStateChange()),y||u._dispatchEvent("icecandidate",g),x&&(u._dispatchEvent("icecandidate",new Event("icecandidate")),u.iceGatheringState="complete",u._emitGatheringStateChange())}},n.setTimeout(function(){f.forEach(function(m){d.onlocalcandidate(m)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var c=this,h=new n.RTCIceTransport(null);h.onicestatechange=function(){c._updateIceConnectionState(),c._updateConnectionState()};var u=new n.RTCDtlsTransport(h);return u.ondtlsstatechange=function(){c._updateConnectionState()},u.onerror=function(){Object.defineProperty(u,"state",{value:"failed",writable:!0}),c._updateConnectionState()},{iceTransport:h,dtlsTransport:u}},o.prototype._disposeIceAndDtlsTransports=function(c){var h=this.transceivers[c].iceGatherer;h&&(delete h.onlocalcandidate,delete this.transceivers[c].iceGatherer);var u=this.transceivers[c].iceTransport;u&&(delete u.onicestatechange,delete this.transceivers[c].iceTransport);var d=this.transceivers[c].dtlsTransport;d&&(delete d.ondtlsstatechange,delete d.onerror,delete this.transceivers[c].dtlsTransport)},o.prototype._transceive=function(c,h,u){var d=BS(c.localCapabilities,c.remoteCapabilities);h&&c.rtpSender&&(d.encodings=c.sendEncodingParameters,d.rtcp={cname:Nt.localCName,compound:c.rtcpParameters.compound},c.recvEncodingParameters.length&&(d.rtcp.ssrc=c.recvEncodingParameters[0].ssrc),c.rtpSender.send(d)),u&&c.rtpReceiver&&d.codecs.length>0&&(c.kind==="video"&&c.recvEncodingParameters&&e<15019&&c.recvEncodingParameters.forEach(function(f){delete f.rtx}),c.recvEncodingParameters.length?d.encodings=c.recvEncodingParameters:d.encodings=[{}],d.rtcp={compound:c.rtcpParameters.compound},c.rtcpParameters.cname&&(d.rtcp.cname=c.rtcpParameters.cname),c.sendEncodingParameters.length&&(d.rtcp.ssrc=c.sendEncodingParameters[0].ssrc),c.rtpReceiver.receive(d))},o.prototype.setLocalDescription=function(c){var h=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(Os("TypeError",'Unsupported type "'+c.type+'"'));if(!HG("setLocalDescription",c.type,h.signalingState)||h._isClosed)return Promise.reject(Os("InvalidStateError","Can not set local "+c.type+" in state "+h.signalingState));var u,d;if(c.type==="offer")u=Nt.splitSections(c.sdp),d=u.shift(),u.forEach(function(m,g){var v=Nt.parseRtpParameters(m);h.transceivers[g].localCapabilities=v}),h.transceivers.forEach(function(m,g){h._gather(m.mid,g)});else if(c.type==="answer"){u=Nt.splitSections(h._remoteDescription.sdp),d=u.shift();var f=Nt.matchPrefix(d,"a=ice-lite").length>0;u.forEach(function(m,g){var v=h.transceivers[g],y=v.iceGatherer,A=v.iceTransport,b=v.dtlsTransport,x=v.localCapabilities,_=v.remoteCapabilities,w=Nt.isRejected(m)&&Nt.matchPrefix(m,"a=bundle-only").length===0;if(!w&&!v.rejected){var T=Nt.getIceParameters(m,d),M=Nt.getDtlsParameters(m,d);f&&(M.role="server"),(!h.usingBundle||g===0)&&(h._gather(v.mid,g),A.state==="new"&&A.start(y,T,f?"controlling":"controlled"),b.state==="new"&&b.start(M));var R=BS(x,_);h._transceive(v,R.codecs.length>0,!1)}})}return h._localDescription={type:c.type,sdp:c.sdp},c.type==="offer"?h._updateSignalingState("have-local-offer"):h._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(c){var h=this;if(["offer","answer"].indexOf(c.type)===-1)return Promise.reject(Os("TypeError",'Unsupported type "'+c.type+'"'));if(!HG("setRemoteDescription",c.type,h.signalingState)||h._isClosed)return Promise.reject(Os("InvalidStateError","Can not set remote "+c.type+" in state "+h.signalingState));var u={};h.remoteStreams.forEach(function(A){u[A.id]=A});var d=[],f=Nt.splitSections(c.sdp),m=f.shift(),g=Nt.matchPrefix(m,"a=ice-lite").length>0,v=Nt.matchPrefix(m,"a=group:BUNDLE ").length>0;h.usingBundle=v;var y=Nt.matchPrefix(m,"a=ice-options:")[0];return y?h.canTrickleIceCandidates=y.substr(14).split(" ").indexOf("trickle")>=0:h.canTrickleIceCandidates=!1,f.forEach(function(A,b){var x=Nt.splitLines(A),_=Nt.getKind(A),w=Nt.isRejected(A)&&Nt.matchPrefix(A,"a=bundle-only").length===0,T=x[0].substr(2).split(" ")[2],M=Nt.getDirection(A,m),R=Nt.parseMsid(A),B=Nt.getMid(A)||Nt.generateIdentifier();if(w||_==="application"&&(T==="DTLS/SCTP"||T==="UDP/DTLS/SCTP")){h.transceivers[b]={mid:B,kind:_,protocol:T,rejected:!0};return}!w&&h.transceivers[b]&&h.transceivers[b].rejected&&(h.transceivers[b]=h._createTransceiver(_,!0));var E,P,O,N,L,Q,D,F,H,K=Nt.parseRtpParameters(A),Z,oe;w||(Z=Nt.getIceParameters(A,m),oe=Nt.getDtlsParameters(A,m),oe.role="client"),D=Nt.parseRtpEncodingParameters(A);var we=Nt.parseRtcpParameters(A),Oe=Nt.matchPrefix(A,"a=end-of-candidates",m).length>0,se=Nt.matchPrefix(A,"a=candidate:").map(function(Ue){return Nt.parseCandidate(Ue)}).filter(function(Ue){return Ue.component===1});if((c.type==="offer"||c.type==="answer")&&!w&&v&&b>0&&h.transceivers[b]&&(h._disposeIceAndDtlsTransports(b),h.transceivers[b].iceGatherer=h.transceivers[0].iceGatherer,h.transceivers[b].iceTransport=h.transceivers[0].iceTransport,h.transceivers[b].dtlsTransport=h.transceivers[0].dtlsTransport,h.transceivers[b].rtpSender&&h.transceivers[b].rtpSender.setTransport(h.transceivers[0].dtlsTransport),h.transceivers[b].rtpReceiver&&h.transceivers[b].rtpReceiver.setTransport(h.transceivers[0].dtlsTransport)),c.type==="offer"&&!w){E=h.transceivers[b]||h._createTransceiver(_),E.mid=B,E.iceGatherer||(E.iceGatherer=h._createIceGatherer(b,v)),se.length&&E.iceTransport.state==="new"&&(Oe&&(!v||b===0)?E.iceTransport.setRemoteCandidates(se):se.forEach(function(Ue){qB(E.iceTransport,Ue)})),F=n.RTCRtpReceiver.getCapabilities(_),e<15019&&(F.codecs=F.codecs.filter(function(Ue){return Ue.name!=="rtx"})),Q=E.sendEncodingParameters||[{ssrc:(2*b+2)*1001}];var _e=!1;if(M==="sendrecv"||M==="sendonly"){if(_e=!E.rtpReceiver,L=E.rtpReceiver||new n.RTCRtpReceiver(E.dtlsTransport,_),_e){var Ee;H=L.track,R&&R.stream==="-"||(R?(u[R.stream]||(u[R.stream]=new n.MediaStream,Object.defineProperty(u[R.stream],"id",{get:function(){return R.stream}})),Object.defineProperty(H,"id",{get:function(){return R.track}}),Ee=u[R.stream]):(u.default||(u.default=new n.MediaStream),Ee=u.default)),Ee&&(i(H,Ee),E.associatedRemoteMediaStreams.push(Ee)),d.push([H,L,Ee])}}else E.rtpReceiver&&E.rtpReceiver.track&&(E.associatedRemoteMediaStreams.forEach(function(Ue){var st=Ue.getTracks().find(function(ge){return ge.id===E.rtpReceiver.track.id});st&&r(st,Ue)}),E.associatedRemoteMediaStreams=[]);E.localCapabilities=F,E.remoteCapabilities=K,E.rtpReceiver=L,E.rtcpParameters=we,E.sendEncodingParameters=Q,E.recvEncodingParameters=D,h._transceive(h.transceivers[b],!1,_e)}else if(c.type==="answer"&&!w){E=h.transceivers[b],P=E.iceGatherer,O=E.iceTransport,N=E.dtlsTransport,L=E.rtpReceiver,Q=E.sendEncodingParameters,F=E.localCapabilities,h.transceivers[b].recvEncodingParameters=D,h.transceivers[b].remoteCapabilities=K,h.transceivers[b].rtcpParameters=we,se.length&&O.state==="new"&&((g||Oe)&&(!v||b===0)?O.setRemoteCandidates(se):se.forEach(function(Ue){qB(E.iceTransport,Ue)})),(!v||b===0)&&(O.state==="new"&&O.start(P,Z,"controlling"),N.state==="new"&&N.start(oe));var et=BS(E.localCapabilities,E.remoteCapabilities),We=et.codecs.filter(function(Ue){return Ue.name.toLowerCase()==="rtx"}).length;!We&&E.sendEncodingParameters[0].rtx&&delete E.sendEncodingParameters[0].rtx,h._transceive(E,M==="sendrecv"||M==="recvonly",M==="sendrecv"||M==="sendonly"),L&&(M==="sendrecv"||M==="sendonly")?(H=L.track,R?(u[R.stream]||(u[R.stream]=new n.MediaStream),i(H,u[R.stream]),d.push([H,L,u[R.stream]])):(u.default||(u.default=new n.MediaStream),i(H,u.default),d.push([H,L,u.default]))):delete E.rtpReceiver}}),h._dtlsRole===void 0&&(h._dtlsRole=c.type==="offer"?"active":"passive"),h._remoteDescription={type:c.type,sdp:c.sdp},c.type==="offer"?h._updateSignalingState("have-remote-offer"):h._updateSignalingState("stable"),Object.keys(u).forEach(function(A){var b=u[A];if(b.getTracks().length){if(h.remoteStreams.indexOf(b)===-1){h.remoteStreams.push(b);var x=new Event("addstream");x.stream=b,n.setTimeout(function(){h._dispatchEvent("addstream",x)})}d.forEach(function(_){var w=_[0],T=_[1];b.id===_[2].id&&s(h,w,T,[b])})}}),d.forEach(function(A){A[2]||s(h,A[0],A[1],[])}),n.setTimeout(function(){h&&h.transceivers&&h.transceivers.forEach(function(A){A.iceTransport&&A.iceTransport.state==="new"&&A.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),A.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(c){c.iceTransport&&c.iceTransport.stop(),c.dtlsTransport&&c.dtlsTransport.stop(),c.rtpSender&&c.rtpSender.stop(),c.rtpReceiver&&c.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(c){this.signalingState=c;var h=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",h)},o.prototype._maybeFireNegotiationNeeded=function(){var c=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,n.setTimeout(function(){if(c.needNegotiation){c.needNegotiation=!1;var h=new Event("negotiationneeded");c._dispatchEvent("negotiationneeded",h)}},0))},o.prototype._updateIceConnectionState=function(){var c,h={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&!d.rejected&&h[d.iceTransport.state]++}),c="new",h.failed>0?c="failed":h.checking>0?c="checking":h.disconnected>0?c="disconnected":h.new>0?c="new":h.connected>0?c="connected":h.completed>0&&(c="completed"),c!==this.iceConnectionState){this.iceConnectionState=c;var u=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",u)}},o.prototype._updateConnectionState=function(){var c,h={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(d){d.iceTransport&&d.dtlsTransport&&!d.rejected&&(h[d.iceTransport.state]++,h[d.dtlsTransport.state]++)}),h.connected+=h.completed,c="new",h.failed>0?c="failed":h.connecting>0?c="connecting":h.disconnected>0?c="disconnected":h.new>0?c="new":h.connected>0&&(c="connected"),c!==this.connectionState){this.connectionState=c;var u=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",u)}},o.prototype.createOffer=function(){var c=this;if(c._isClosed)return Promise.reject(Os("InvalidStateError","Can not call createOffer after close"));var h=c.transceivers.filter(function(g){return g.kind==="audio"}).length,u=c.transceivers.filter(function(g){return g.kind==="video"}).length,d=arguments[0];if(d){if(d.mandatory||d.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");d.offerToReceiveAudio!==void 0&&(d.offerToReceiveAudio===!0?h=1:d.offerToReceiveAudio===!1?h=0:h=d.offerToReceiveAudio),d.offerToReceiveVideo!==void 0&&(d.offerToReceiveVideo===!0?u=1:d.offerToReceiveVideo===!1?u=0:u=d.offerToReceiveVideo)}for(c.transceivers.forEach(function(g){g.kind==="audio"?(h--,h<0&&(g.wantReceive=!1)):g.kind==="video"&&(u--,u<0&&(g.wantReceive=!1))});h>0||u>0;)h>0&&(c._createTransceiver("audio"),h--),u>0&&(c._createTransceiver("video"),u--);var f=Nt.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.transceivers.forEach(function(g,v){var y=g.track,A=g.kind,b=g.mid||Nt.generateIdentifier();g.mid=b,g.iceGatherer||(g.iceGatherer=c._createIceGatherer(v,c.usingBundle));var x=n.RTCRtpSender.getCapabilities(A);e<15019&&(x.codecs=x.codecs.filter(function(w){return w.name!=="rtx"})),x.codecs.forEach(function(w){w.name==="H264"&&w.parameters["level-asymmetry-allowed"]===void 0&&(w.parameters["level-asymmetry-allowed"]="1"),g.remoteCapabilities&&g.remoteCapabilities.codecs&&g.remoteCapabilities.codecs.forEach(function(T){w.name.toLowerCase()===T.name.toLowerCase()&&w.clockRate===T.clockRate&&(w.preferredPayloadType=T.payloadType)})}),x.headerExtensions.forEach(function(w){var T=g.remoteCapabilities&&g.remoteCapabilities.headerExtensions||[];T.forEach(function(M){w.uri===M.uri&&(w.id=M.id)})});var _=g.sendEncodingParameters||[{ssrc:(2*v+1)*1001}];y&&e>=15019&&A==="video"&&!_[0].rtx&&(_[0].rtx={ssrc:_[0].ssrc+1}),g.wantReceive&&(g.rtpReceiver=new n.RTCRtpReceiver(g.dtlsTransport,A)),g.localCapabilities=x,g.sendEncodingParameters=_}),c._config.bundlePolicy!=="max-compat"&&(f+="a=group:BUNDLE "+c.transceivers.map(function(g){return g.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`,c.transceivers.forEach(function(g,v){f+=GG(g,g.localCapabilities,"offer",g.stream,c._dtlsRole),f+=`a=rtcp-rsize\r
`,g.iceGatherer&&c.iceGatheringState!=="new"&&(v===0||!c.usingBundle)&&(g.iceGatherer.getLocalCandidates().forEach(function(y){y.component=1,f+="a="+Nt.writeCandidate(y)+`\r
`}),g.iceGatherer.state==="completed"&&(f+=`a=end-of-candidates\r
`))});var m=new n.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(m)},o.prototype.createAnswer=function(){var c=this;if(c._isClosed)return Promise.reject(Os("InvalidStateError","Can not call createAnswer after close"));if(!(c.signalingState==="have-remote-offer"||c.signalingState==="have-local-pranswer"))return Promise.reject(Os("InvalidStateError","Can not call createAnswer in signalingState "+c.signalingState));var h=Nt.writeSessionBoilerplate(c._sdpSessionId,c._sdpSessionVersion++);c.usingBundle&&(h+="a=group:BUNDLE "+c.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),h+=`a=ice-options:trickle\r
`;var u=Nt.getMediaSections(c._remoteDescription.sdp).length;c.transceivers.forEach(function(f,m){if(!(m+1>u)){if(f.rejected){f.kind==="application"?f.protocol==="DTLS/SCTP"?h+=`m=application 0 DTLS/SCTP 5000\r
`:h+="m=application 0 "+f.protocol+` webrtc-datachannel\r
`:f.kind==="audio"?h+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:f.kind==="video"&&(h+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),h+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+f.mid+`\r
`;return}if(f.stream){var g;f.kind==="audio"?g=f.stream.getAudioTracks()[0]:f.kind==="video"&&(g=f.stream.getVideoTracks()[0]),g&&e>=15019&&f.kind==="video"&&!f.sendEncodingParameters[0].rtx&&(f.sendEncodingParameters[0].rtx={ssrc:f.sendEncodingParameters[0].ssrc+1})}var v=BS(f.localCapabilities,f.remoteCapabilities),y=v.codecs.filter(function(A){return A.name.toLowerCase()==="rtx"}).length;!y&&f.sendEncodingParameters[0].rtx&&delete f.sendEncodingParameters[0].rtx,h+=GG(f,v,"answer",f.stream,c._dtlsRole),f.rtcpParameters&&f.rtcpParameters.reducedSize&&(h+=`a=rtcp-rsize\r
`)}});var d=new n.RTCSessionDescription({type:"answer",sdp:h});return Promise.resolve(d)},o.prototype.addIceCandidate=function(c){var h=this,u;return c&&!(c.sdpMLineIndex!==void 0||c.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(d,f){if(h._remoteDescription)if(!c||c.candidate==="")for(var m=0;m<h.transceivers.length&&!(!h.transceivers[m].rejected&&(h.transceivers[m].iceTransport.addRemoteCandidate({}),u=Nt.getMediaSections(h._remoteDescription.sdp),u[m]+=`a=end-of-candidates\r
`,h._remoteDescription.sdp=Nt.getDescription(h._remoteDescription.sdp)+u.join(""),h.usingBundle));m++);else{var g=c.sdpMLineIndex;if(c.sdpMid){for(var v=0;v<h.transceivers.length;v++)if(h.transceivers[v].mid===c.sdpMid){g=v;break}}var y=h.transceivers[g];if(y){if(y.rejected)return d();var A=Object.keys(c.candidate).length>0?Nt.parseCandidate(c.candidate):{};if(A.protocol==="tcp"&&(A.port===0||A.port===9)||A.component&&A.component!==1)return d();if((g===0||g>0&&y.iceTransport!==h.transceivers[0].iceTransport)&&!qB(y.iceTransport,A))return f(Os("OperationError","Can not add ICE candidate"));var b=c.candidate.trim();b.indexOf("a=")===0&&(b=b.substr(2)),u=Nt.getMediaSections(h._remoteDescription.sdp),u[g]+="a="+(A.type?b:"end-of-candidates")+`\r
`,h._remoteDescription.sdp=Nt.getDescription(h._remoteDescription.sdp)+u.join("")}else return f(Os("OperationError","Can not add ICE candidate"))}else return f(Os("InvalidStateError","Can not add ICE candidate without a remote description"));d()})},o.prototype.getStats=function(c){if(c&&c instanceof n.MediaStreamTrack){var h=null;if(this.transceivers.forEach(function(d){d.rtpSender&&d.rtpSender.track===c?h=d.rtpSender:d.rtpReceiver&&d.rtpReceiver.track===c&&(h=d.rtpReceiver)}),!h)throw Os("InvalidAccessError","Invalid selector.");return h.getStats()}var u=[];return this.transceivers.forEach(function(d){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){d[f]&&u.push(d[f].getStats())})}),Promise.all(u).then(function(d){var f=new Map;return d.forEach(function(m){m.forEach(function(g){f.set(g.id,g)})}),f})};var a=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];a.forEach(function(c){var h=n[c];if(h&&h.prototype&&h.prototype.getStats){var u=h.prototype.getStats;h.prototype.getStats=function(){return u.apply(this).then(function(d){var f=new Map;return Object.keys(d).forEach(function(m){d[m].type=ade(d[m]),f.set(m,d[m])}),f})}}});var l=["createOffer","createAnswer"];return l.forEach(function(c){var h=o.prototype[c];o.prototype[c]=function(){var u=arguments;return typeof u[0]=="function"||typeof u[1]=="function"?h.apply(this,[arguments[2]]).then(function(d){typeof u[0]=="function"&&u[0].apply(null,[d])},function(d){typeof u[1]=="function"&&u[1].apply(null,[d])}):h.apply(this,arguments)}}),l=["setLocalDescription","setRemoteDescription","addIceCandidate"],l.forEach(function(c){var h=o.prototype[c];o.prototype[c]=function(){var u=arguments;return typeof u[1]=="function"||typeof u[2]=="function"?h.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)},function(d){typeof u[2]=="function"&&u[2].apply(null,[d])}):h.apply(this,arguments)}}),["getStats"].forEach(function(c){var h=o.prototype[c];o.prototype[c]=function(){var u=arguments;return typeof u[1]=="function"?h.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)}):h.apply(this,arguments)}}),o};const hde=IS(cde);function VG(n){const e=n&&n.navigator,i=function(s){return{name:{PermissionDeniedError:"NotAllowedError"}[s.name]||s.name,message:s.message,constraint:s.constraint,toString(){return this.name}}},r=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(s){return r(s).catch(o=>Promise.reject(i(o)))}}function QG(n){"getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}function YB(n,e){if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(r){return r}),n.RTCSessionDescription||(n.RTCSessionDescription=function(r){return r}),e.version<15025)){const r=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set(s){r.set.call(this,s);const o=new Event("enabled");o.enabled=s,this.dispatchEvent(o)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);const i=hde(n,e.version);n.RTCPeerConnection=function(r){return r&&r.iceServers&&(r.iceServers=ode(r.iceServers,e.version),QB("ICE servers after filtering:",r.iceServers)),new i(r)},n.RTCPeerConnection.prototype=i.prototype}function WG(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}const XG=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:QG,shimGetUserMedia:VG,shimPeerConnection:YB,shimReplaceTrack:WG},Symbol.toStringTag,{value:"Module"}));function qG(n,e){const i=n&&n.navigator,r=n&&n.MediaStreamTrack;if(i.getUserMedia=function(s,o,a){RS("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(s).then(o,a)},!(e.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const s=function(a,l,c){l in a&&!(c in a)&&(a[c]=a[l],delete a[l])},o=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a.audio,"autoGainControl","mozAutoGainControl"),s(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},r&&r.prototype.getSettings){const a=r.prototype.getSettings;r.prototype.getSettings=function(){const l=a.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function ude(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(i)})}function YG(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function JB(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=n.RTCPeerConnection.prototype[s],a={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=a[s]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=i[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((h,u)=>{l.set(u,Object.assign({},h,{type:i[h.type]||h.type}))})}return l}).then(o,a)}}function JG(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function KG(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),i0(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ZG(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){RS("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&e.getTracks().includes(i.track)&&this.removeTrack(i)})})}function $G(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function eH(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],r=i&&"sendEncodings"in i;r&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function tH(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function iH(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function nH(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const rH=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:eH,shimCreateAnswer:nH,shimCreateOffer:iH,shimGetDisplayMedia:ude,shimGetParameters:tH,shimGetUserMedia:qG,shimOnTrack:YG,shimPeerConnection:JB,shimRTCDataChannel:$G,shimReceiverGetStats:KG,shimRemoveStream:ZG,shimSenderGetStats:JG},Symbol.toStringTag,{value:"Module"}));function sH(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},n.RTCPeerConnection.prototype.addTrack=function(i,...r){return r&&r.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(e);if(i===-1)return;this._localStreams.splice(i,1);const r=e.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function oH(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,this.dispatchEvent(o)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function aH(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,i=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(c,h){const u=arguments.length>=2?arguments[2]:arguments[0],d=i.apply(this,[u]);return h?(d.then(c,h),Promise.resolve()):d},e.createAnswer=function(c,h){const u=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[u]);return h?(d.then(c,h),Promise.resolve()):d};let l=function(c,h,u){const d=s.apply(this,[c]);return u?(d.then(h,u),Promise.resolve()):d};e.setLocalDescription=l,l=function(c,h,u){const d=o.apply(this,[c]);return u?(d.then(h,u),Promise.resolve()):d},e.setRemoteDescription=l,l=function(c,h,u){const d=a.apply(this,[c]);return u?(d.then(h,u),Promise.resolve()):d},e.addIceCandidate=l}function lH(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const i=e.mediaDevices,r=i.getUserMedia.bind(i);e.mediaDevices.getUserMedia=s=>r(cH(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}.bind(e))}function cH(n){return n&&n.video!==void 0?Object.assign({},n,{video:MG(n.video)}):n}function hH(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(RS("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function uH(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dH(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video")}return e.apply(this,arguments)}}function pH(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const fH=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:pH,shimCallbacksAPI:aH,shimConstraints:cH,shimCreateOfferLegacy:dH,shimGetUserMedia:lH,shimLocalStreamsAPI:sH,shimRTCIceServerUrls:hH,shimRemoteStreamsAPI:oH,shimTrackEventTransceiver:uH},Symbol.toStringTag,{value:"Module"}));function kS(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const r=new e(i),s=PS.parseCandidate(i.candidate),o=Object.assign(r,s);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(i)},n.RTCIceCandidate.prototype=e.prototype,i0(n,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new n.RTCIceCandidate(i.candidate),writable:"false"}),i))}function MA(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const i=function(l){if(!l||!l.sdp)return!1;const c=PS.splitSections(l.sdp);return c.shift(),c.some(h=>{const u=PS.parseMLine(h);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const h=parseInt(c[1],10);return h!==h?-1:h},s=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(l,c){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const u=PS.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?h=parseInt(u[0].substr(19),10):e.browser==="firefox"&&c!==-1&&(h=2147483637),h},a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const l=r(arguments[0]),c=s(l),h=o(arguments[0],l);let u;c===0&&h===0?u=Number.POSITIVE_INFINITY:c===0||h===0?u=Math.max(c,h):u=Math.min(c,h);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return u}}),this._sctp=d}return a.apply(this,arguments)}}function TA(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,s){const o=r.send;r.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(r.readyState==="open"&&s.sctp&&l>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return o.apply(r,arguments)}}const i=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const r=i.apply(this,arguments);return e(r,this),r},i0(n,"datachannel",r=>(e(r.channel,r.target),r))}function KB(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const r=e[i];e[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const o=s.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",s);o.dispatchEvent(a)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function ZB(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&r instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return i.apply(this,arguments)}}function OS(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const i=n.RTCPeerConnection.prototype.addIceCandidate;!i||i.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const dde=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:ZB,shimAddIceCandidateNullOrEmpty:OS,shimConnectionState:KB,shimMaxMessageSize:MA,shimRTCIceCandidate:kS,shimSendThrowTypeError:TA},Symbol.toStringTag,{value:"Module"}));function pde({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const i=QB,r=rde(n),s={browserDetails:r,commonShim:dde,extractVersion:EA,disableLog:ide,disableWarnings:nde};switch(r.browser){case"chrome":if(!NG||!XB||!e.shimChrome)return i("Chrome shim is not included in this adapter release."),s;if(r.version===null)return i("Chrome shim can not determine version, not shimming."),s;i("adapter.js shimming chrome."),s.browserShim=NG,OS(n,r),RG(n,r),PG(n),XB(n,r),BG(n),UG(n,r),kG(n),OG(n),DG(n),FG(n,r),kS(n),KB(n),MA(n,r),TA(n),ZB(n,r);break;case"firefox":if(!rH||!JB||!e.shimFirefox)return i("Firefox shim is not included in this adapter release."),s;i("adapter.js shimming firefox."),s.browserShim=rH,OS(n,r),qG(n,r),JB(n,r),YG(n),ZG(n),JG(n),KG(n),$G(n),eH(n),tH(n),iH(n),nH(n),kS(n),KB(n),MA(n,r),TA(n);break;case"edge":if(!XG||!YB||!e.shimEdge)return i("MS edge shim is not included in this adapter release."),s;i("adapter.js shimming edge."),s.browserShim=XG,VG(n),QG(n),YB(n,r),WG(n),MA(n,r),TA(n);break;case"safari":if(!fH||!e.shimSafari)return i("Safari shim is not included in this adapter release."),s;i("adapter.js shimming safari."),s.browserShim=fH,OS(n,r),hH(n),dH(n),aH(n),sH(n),oH(n),uH(n),lH(n),pH(n),kS(n),MA(n,r),TA(n),ZB(n,r);break;default:i("Unsupported browser!");break}return s}const mH=pde({window:typeof window>"u"?void 0:window});function uc(n,e,i,r){Object.defineProperty(n,e,{get:i,set:r,enumerable:!0,configurable:!0})}var $B=mH.default||mH,IA=new(function(){function n(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return n.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},n.prototype.isBrowserSupported=function(){var e=this.getBrowser(),i=this.getVersion(),r=this.supportedBrowsers.includes(e);return r?e==="chrome"?i>=this.minChromeVersion:e==="firefox"?i>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&i>=this.minSafariVersion:!1:!1},n.prototype.getBrowser=function(){return $B.browserDetails.browser},n.prototype.getVersion=function(){return $B.browserDetails.version||0},n.prototype.isUnifiedPlanSupported=function(){var e=this.getBrowser(),i=$B.browserDetails.version||0;if(e==="chrome"&&i<this.minChromeVersion)return!1;if(e==="firefox"&&i>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var r,s=!1;try{r=new RTCPeerConnection,r.addTransceiver("audio"),s=!0}catch{}finally{r&&r.close()}return s},n.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},n}()),gH={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},fde=function(){function n(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=gH,this.browser=IA.getBrowser(),this.browserVersion=IA.getVersion(),this.supports=function(){var e={browser:IA.isBrowserSupported(),webRTC:IA.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;var i;try{i=new RTCPeerConnection(gH),e.audioVideo=!0;var r=void 0;try{r=i.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!r.ordered;try{r.binaryType="blob",e.binaryBlob=!IA.isIOS}catch{}}catch{}finally{r&&r.close()}}catch{}finally{i&&i.close()}return e}(),this.pack=wG.pack,this.unpack=wG.unpack,this._dataCount=1}return n.prototype.noop=function(){},n.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},n.prototype.chunk=function(e){for(var i=[],r=e.size,s=Math.ceil(r/_i.chunkedMTU),o=0,a=0;a<r;){var l=Math.min(r,a+_i.chunkedMTU),c=e.slice(a,l),h={__peerData:this._dataCount,n:o,data:c,total:s};i.push(h),a=l,o++}return this._dataCount++,i},n.prototype.blobToArrayBuffer=function(e,i){var r=new FileReader;return r.onload=function(s){s.target&&i(s.target.result)},r.readAsArrayBuffer(e),r},n.prototype.binaryStringToArrayBuffer=function(e){for(var i=new Uint8Array(e.length),r=0;r<e.length;r++)i[r]=e.charCodeAt(r)&255;return i.buffer},n.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},n.prototype.isSecure=function(){return location.protocol==="https:"},n}(),_i=new fde,vH={};uc(vH,"Peer",()=>sk,n=>sk=n);var RA={},mde=Object.prototype.hasOwnProperty,ro="~";function PA(){}Object.create&&(PA.prototype=Object.create(null),new PA().__proto__||(ro=!1));function gde(n,e,i){this.fn=n,this.context=e,this.once=i||!1}function yH(n,e,i,r,s){if(typeof i!="function")throw new TypeError("The listener must be a function");var o=new gde(i,r||n,s),a=ro?ro+e:e;return n._events[a]?n._events[a].fn?n._events[a]=[n._events[a],o]:n._events[a].push(o):(n._events[a]=o,n._eventsCount++),n}function DS(n,e){--n._eventsCount===0?n._events=new PA:delete n._events[e]}function Ds(){this._events=new PA,this._eventsCount=0}Ds.prototype.eventNames=function(){var n=[],e,i;if(this._eventsCount===0)return n;for(i in e=this._events)mde.call(e,i)&&n.push(ro?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},Ds.prototype.listeners=function(n){var e=ro?ro+n:n,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,s=i.length,o=new Array(s);r<s;r++)o[r]=i[r].fn;return o},Ds.prototype.listenerCount=function(n){var e=ro?ro+n:n,i=this._events[e];return i?i.fn?1:i.length:0},Ds.prototype.emit=function(n,e,i,r,s,o){var a=ro?ro+n:n;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,h,u;if(l.fn){switch(l.once&&this.removeListener(n,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,i),!0;case 4:return l.fn.call(l.context,e,i,r),!0;case 5:return l.fn.call(l.context,e,i,r,s),!0;case 6:return l.fn.call(l.context,e,i,r,s,o),!0}for(u=1,h=new Array(c-1);u<c;u++)h[u-1]=arguments[u];l.fn.apply(l.context,h)}else{var d=l.length,f;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(n,l[u].fn,void 0,!0),c){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,i);break;case 4:l[u].fn.call(l[u].context,e,i,r);break;default:if(!h)for(f=1,h=new Array(c-1);f<c;f++)h[f-1]=arguments[f];l[u].fn.apply(l[u].context,h)}}return!0},Ds.prototype.on=function(n,e,i){return yH(this,n,e,i,!1)},Ds.prototype.once=function(n,e,i){return yH(this,n,e,i,!0)},Ds.prototype.removeListener=function(n,e,i,r){var s=ro?ro+n:n;if(!this._events[s])return this;if(!e)return DS(this,s),this;var o=this._events[s];if(o.fn)o.fn===e&&(!r||o.once)&&(!i||o.context===i)&&DS(this,s);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==e||r&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[s]=l.length===1?l[0]:l:DS(this,s)}return this},Ds.prototype.removeAllListeners=function(n){var e;return n?(e=ro?ro+n:n,this._events[e]&&DS(this,e)):(this._events=new PA,this._eventsCount=0),this},Ds.prototype.off=Ds.prototype.removeListener,Ds.prototype.addListener=Ds.prototype.on,Ds.prefixed=ro,Ds.EventEmitter=Ds,RA=Ds;var pt={};uc(pt,"LogLevel",()=>To,n=>To=n),uc(pt,"default",()=>AH,n=>AH=n);var gf=function(n,e){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var r=i.call(n),s,o=[],a;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(l){a={error:l}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(a)throw a.error}}return o},vf=function(n,e,i){if(i||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},vde="PeerJS: ",To;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(To||(To={}));var yde=function(){function n(){this._logLevel=To.Disabled}return Object.defineProperty(n.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),n.prototype.log=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._logLevel>=To.All&&this._print.apply(this,vf([To.All],gf(e),!1))},n.prototype.warn=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._logLevel>=To.Warnings&&this._print.apply(this,vf([To.Warnings],gf(e),!1))},n.prototype.error=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._logLevel>=To.Errors&&this._print.apply(this,vf([To.Errors],gf(e),!1))},n.prototype.setLogFunction=function(e){this._print=e},n.prototype._print=function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var s=vf([vde],gf(i),!1);for(var o in s)s[o]instanceof Error&&(s[o]="("+s[o].name+") "+s[o].message);e>=To.All?console.log.apply(console,vf([],gf(s),!1)):e>=To.Warnings?console.warn.apply(console,vf(["WARNING"],gf(s),!1)):e>=To.Errors&&console.error.apply(console,vf(["ERROR"],gf(s),!1))},n}(),AH=new yde,bH={};uc(bH,"Socket",()=>xH,n=>xH=n);var Cl;(function(n){n.Data="data",n.Media="media"})(Cl||(Cl={}));var zn;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(zn||(zn={}));var Th;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json"})(Th||(Th={}));var Ih;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(Ih||(Ih={}));var $r;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})($r||($r={}));var ek={};ek=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var Ade=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(r[o]=s[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function r(){this.constructor=e}e.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),bde=function(n,e){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var r=i.call(n),s,o=[],a;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(l){a={error:l}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(a)throw a.error}}return o},xde=function(n,e,i){if(i||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))},_de=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],r=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},xH=function(n){Ade(e,n);function e(i,r,s,o,a,l){l===void 0&&(l=5e3);var c=n.call(this)||this;c.pingInterval=l,c._disconnected=!0,c._messagesQueue=[];var h=i?"wss://":"ws://";return c._baseUrl=h+r+":"+s+o+"peerjs?key="+a,c}return e.prototype.start=function(i,r){var s=this;this._id=i;var o="".concat(this._baseUrl,"&id=").concat(i,"&token=").concat(r);this._socket||!this._disconnected||(this._socket=new WebSocket(o+"&version="+ek.version),this._disconnected=!1,this._socket.onmessage=function(a){var l;try{l=JSON.parse(a.data),pt.default.log("Server message received:",l)}catch{pt.default.log("Invalid server message",a.data);return}s.emit(Ih.Message,l)},this._socket.onclose=function(a){s._disconnected||(pt.default.log("Socket closed.",a),s._cleanup(),s._disconnected=!0,s.emit(Ih.Disconnected))},this._socket.onopen=function(){s._disconnected||(s._sendQueuedMessages(),pt.default.log("Socket open"),s._scheduleHeartbeat())})},e.prototype._scheduleHeartbeat=function(){var i=this;this._wsPingTimer=setTimeout(function(){i._sendHeartbeat()},this.pingInterval)},e.prototype._sendHeartbeat=function(){if(!this._wsOpen()){pt.default.log("Cannot send heartbeat, because socket closed");return}var i=JSON.stringify({type:$r.Heartbeat});this._socket.send(i),this._scheduleHeartbeat()},e.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},e.prototype._sendQueuedMessages=function(){var i,r,s=xde([],bde(this._messagesQueue),!1);this._messagesQueue=[];try{for(var o=_de(s),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}},e.prototype.send=function(i){if(!this._disconnected){if(!this._id){this._messagesQueue.push(i);return}if(!i.type){this.emit(Ih.Error,"Invalid message");return}if(this._wsOpen()){var r=JSON.stringify(i);this._socket.send(r)}}},e.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},e.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},e}(RA.EventEmitter),tk={};uc(tk,"MediaConnection",()=>SH,n=>SH=n);var ik={};uc(ik,"Negotiator",()=>_H,n=>_H=n);var LS=function(){return LS=Object.assign||function(n){for(var e,i=1,r=arguments.length;i<r;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},LS.apply(this,arguments)},US=function(n,e,i,r){function s(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(u){try{h(r.next(u))}catch(d){a(d)}}function c(u){try{h(r.throw(u))}catch(d){a(d)}}function h(u){u.done?o(u.value):s(u.value).then(l,c)}h((r=r.apply(n,e||[])).next())})},FS=function(n,e){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,s,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(u){return c([h,u])}}function c(h){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,s&&(o=h[0]&2?s.return:h[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,h[1])).done)return o;switch(s=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return i.label++,{value:h[1],done:!1};case 5:i.label++,s=h[1],h=[0];continue;case 7:h=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){i=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){i.label=h[1];break}if(h[0]===6&&i.label<o[1]){i.label=o[1],o=h;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(h);break}o[2]&&i.ops.pop(),i.trys.pop();continue}h=e.call(n,i)}catch(u){h=[6,u],s=0}finally{r=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},_H=function(){function n(e){this.connection=e}return n.prototype.startConnection=function(e){var i=this._startPeerConnection();if(this.connection.peerConnection=i,this.connection.type===Cl.Media&&e._stream&&this._addTracksToConnection(e._stream,i),e.originator){if(this.connection.type===Cl.Data){var r=this.connection,s={ordered:!!e.reliable},o=i.createDataChannel(r.label,s);r.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},n.prototype._startPeerConnection=function(){pt.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},n.prototype._setupListeners=function(e){var i=this,r=this.connection.peer,s=this.connection.connectionId,o=this.connection.type,a=this.connection.provider;pt.default.log("Listening for ICE candidates."),e.onicecandidate=function(l){!l.candidate||!l.candidate.candidate||(pt.default.log("Received ICE candidates for ".concat(r,":"),l.candidate),a.socket.send({type:$r.Candidate,payload:{candidate:l.candidate,type:o,connectionId:s},dst:r}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":pt.default.log("iceConnectionState is failed, closing connections to "+r),i.connection.emit("error",new Error("Negotiation of connection to "+r+" failed.")),i.connection.close();break;case"closed":pt.default.log("iceConnectionState is closed, closing connections to "+r),i.connection.emit("error",new Error("Connection to "+r+" closed.")),i.connection.close();break;case"disconnected":pt.default.log("iceConnectionState changed to disconnected on the connection with "+r);break;case"completed":e.onicecandidate=_i.noop;break}i.connection.emit("iceStateChanged",e.iceConnectionState)},pt.default.log("Listening for data channel"),e.ondatachannel=function(l){pt.default.log("Received data channel");var c=l.channel,h=a.getConnection(r,s);h.initialize(c)},pt.default.log("Listening for remote stream"),e.ontrack=function(l){pt.default.log("Received remote stream");var c=l.streams[0],h=a.getConnection(r,s);if(h.type===Cl.Media){var u=h;i._addStreamToMediaConnection(c,u)}}},n.prototype.cleanup=function(){pt.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var i=e.signalingState!=="closed",r=!1;if(this.connection.type===Cl.Data){var s=this.connection,o=s.dataChannel;o&&(r=!!o.readyState&&o.readyState!=="closed")}(i||r)&&e.close()}},n.prototype._makeOffer=function(){return US(this,void 0,Promise,function(){var e,i,r,s,o,a,l;return FS(this,function(c){switch(c.label){case 0:e=this.connection.peerConnection,i=this.connection.provider,c.label=1;case 1:return c.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:r=c.sent(),pt.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,e.setLocalDescription(r)];case 4:return c.sent(),pt.default.log("Set localDescription:",r,"for:".concat(this.connection.peer)),s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:_i.browser},this.connection.type===Cl.Data&&(o=this.connection,s=LS(LS({},s),{label:o.label,reliable:o.reliable,serialization:o.serialization})),i.socket.send({type:$r.Offer,payload:s,dst:this.connection.peer}),[3,6];case 5:return a=c.sent(),a!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(i.emitError(zn.WebRTC,a),pt.default.log("Failed to setLocalDescription, ",a)),[3,6];case 6:return[3,8];case 7:return l=c.sent(),i.emitError(zn.WebRTC,l),pt.default.log("Failed to createOffer, ",l),[3,8];case 8:return[2]}})})},n.prototype._makeAnswer=function(){return US(this,void 0,Promise,function(){var e,i,r,s,o;return FS(this,function(a){switch(a.label){case 0:e=this.connection.peerConnection,i=this.connection.provider,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:r=a.sent(),pt.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,e.setLocalDescription(r)];case 4:return a.sent(),pt.default.log("Set localDescription:",r,"for:".concat(this.connection.peer)),i.socket.send({type:$r.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,browser:_i.browser},dst:this.connection.peer}),[3,6];case 5:return s=a.sent(),i.emitError(zn.WebRTC,s),pt.default.log("Failed to setLocalDescription, ",s),[3,6];case 6:return[3,8];case 7:return o=a.sent(),i.emitError(zn.WebRTC,o),pt.default.log("Failed to create answer, ",o),[3,8];case 8:return[2]}})})},n.prototype.handleSDP=function(e,i){return US(this,void 0,Promise,function(){var r,s,o,a;return FS(this,function(l){switch(l.label){case 0:i=new RTCSessionDescription(i),r=this.connection.peerConnection,s=this.connection.provider,pt.default.log("Setting remote description",i),o=this,l.label=1;case 1:return l.trys.push([1,5,,6]),[4,r.setRemoteDescription(i)];case 2:return l.sent(),pt.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),e!=="OFFER"?[3,4]:[4,o._makeAnswer()];case 3:l.sent(),l.label=4;case 4:return[3,6];case 5:return a=l.sent(),s.emitError(zn.WebRTC,a),pt.default.log("Failed to setRemoteDescription, ",a),[3,6];case 6:return[2]}})})},n.prototype.handleCandidate=function(e){return US(this,void 0,Promise,function(){var i,r,s,o,a,l;return FS(this,function(c){switch(c.label){case 0:pt.default.log("handleCandidate:",e),i=e.candidate,r=e.sdpMLineIndex,s=e.sdpMid,o=this.connection.peerConnection,a=this.connection.provider,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,o.addIceCandidate(new RTCIceCandidate({sdpMid:s,sdpMLineIndex:r,candidate:i}))];case 2:return c.sent(),pt.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return l=c.sent(),a.emitError(zn.WebRTC,l),pt.default.log("Failed to handleCandidate, ",l),[3,4];case 4:return[2]}})})},n.prototype._addTracksToConnection=function(e,i){if(pt.default.log("add tracks from stream ".concat(e.id," to peer connection")),!i.addTrack)return pt.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(r){i.addTrack(r,e)})},n.prototype._addStreamToMediaConnection=function(e,i){pt.default.log("add stream ".concat(e.id," to media connection ").concat(i.connectionId)),i.addStream(e)},n}(),nk={};uc(nk,"BaseConnection",()=>wH,n=>wH=n);var wde=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(r[o]=s[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function r(){this.constructor=e}e.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),wH=function(n){wde(e,n);function e(i,r,s){var o=n.call(this)||this;return o.peer=i,o.provider=r,o.options=s,o._open=!1,o.metadata=s.metadata,o}return Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),e}(RA.EventEmitter),Sde=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(r[o]=s[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function r(){this.constructor=e}e.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),NS=function(){return NS=Object.assign||function(n){for(var e,i=1,r=arguments.length;i<r;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},NS.apply(this,arguments)},Cde=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],r=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},SH=function(n){Sde(e,n);function e(i,r,s){var o=n.call(this,i,r,s)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||e.ID_PREFIX+_i.randomToken(),o._negotiator=new ik.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return Object.defineProperty(e.prototype,"type",{get:function(){return Cl.Media},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),e.prototype.addStream=function(i){pt.default.log("Receiving stream",i),this._remoteStream=i,n.prototype.emit.call(this,"stream",i)},e.prototype.handleMessage=function(i){var r=i.type,s=i.payload;switch(i.type){case $r.Answer:this._negotiator.handleSDP(r,s.sdp),this._open=!0;break;case $r.Candidate:this._negotiator.handleCandidate(s.candidate);break;default:pt.default.warn("Unrecognized message type:".concat(r," from peer:").concat(this.peer));break}},e.prototype.answer=function(i,r){var s,o;if(r===void 0&&(r={}),this._localStream){pt.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=i,r&&r.sdpTransform&&(this.options.sdpTransform=r.sdpTransform),this._negotiator.startConnection(NS(NS({},this.options._payload),{_stream:i}));var a=this.provider._getMessages(this.connectionId);try{for(var l=Cde(a),c=l.next();!c.done;c=l.next()){var h=c.value;this.handleMessage(h)}}catch(u){s={error:u}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(s)throw s.error}}this._open=!0},e.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.ID_PREFIX="mc_",e}(nk.BaseConnection),rk={};uc(rk,"DataConnection",()=>MH,n=>MH=n);var CH={};uc(CH,"EncodingQueue",()=>EH,n=>EH=n);var Ede=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(r[o]=s[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function r(){this.constructor=e}e.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),EH=function(n){Ede(e,n);function e(){var i=n.call(this)||this;return i.fileReader=new FileReader,i._queue=[],i._processing=!1,i.fileReader.onload=function(r){i._processing=!1,r.target&&i.emit("done",r.target.result),i.doNextTask()},i.fileReader.onerror=function(r){pt.default.error("EncodingQueue error:",r),i._processing=!1,i.destroy(),i.emit("error",r)},i}return Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),e.prototype.enque=function(i){this.queue.push(i),!this.processing&&this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(RA.EventEmitter),Mde=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(r[o]=s[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function r(){this.constructor=e}e.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Tde=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],r=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},MH=function(n){Mde(e,n);function e(i,r,s){var o=n.call(this,i,r,s)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new CH.EncodingQueue,o.connectionId=o.options.connectionId||e.ID_PREFIX+_i.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||Th.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",function(a){o._bufferedSend(a)}),o._encodingQueue.on("error",function(){pt.default.error("DC#".concat(o.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),o.close()}),o._negotiator=new ik.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return Object.defineProperty(e.prototype,"type",{get:function(){return Cl.Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),e.prototype.initialize=function(i){this._dc=i,this._configureDataChannel()},e.prototype._configureDataChannel=function(){var i=this;(!_i.supports.binaryBlob||_i.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){pt.default.log("DC#".concat(i.connectionId," dc connection success")),i._open=!0,i.emit("open")},this.dataChannel.onmessage=function(r){pt.default.log("DC#".concat(i.connectionId," dc onmessage:"),r.data),i._handleDataMessage(r)},this.dataChannel.onclose=function(){pt.default.log("DC#".concat(i.connectionId," dc closed for:"),i.peer),i.close()}},e.prototype._handleDataMessage=function(i){var r=this,s=i.data,o=s.constructor,a=this.serialization===Th.Binary||this.serialization===Th.BinaryUTF8,l=s;if(a){if(o===Blob){_i.blobToArrayBuffer(s,function(h){var u=_i.unpack(h);r.emit("data",u)});return}else if(o===ArrayBuffer)l=_i.unpack(s);else if(o===String){var c=_i.binaryStringToArrayBuffer(s);l=_i.unpack(c)}}else this.serialization===Th.JSON&&(l=this.parse(s));if(l.__peerData){this._handleChunk(l);return}n.prototype.emit.call(this,"data",l)},e.prototype._handleChunk=function(i){var r=i.__peerData,s=this._chunkedData[r]||{data:[],count:0,total:i.total};if(s.data[i.n]=i.data,s.count++,this._chunkedData[r]=s,s.total===s.count){delete this._chunkedData[r];var o=new Blob(s.data);this._handleDataMessage({data:o})}},e.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},e.prototype.send=function(i,r){if(!this.open){n.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===Th.JSON)this._bufferedSend(this.stringify(i));else if(this.serialization===Th.Binary||this.serialization===Th.BinaryUTF8){var s=_i.pack(i);if(!r&&s.size>_i.chunkedMTU){this._sendChunks(s);return}_i.supports.binaryBlob?this._bufferedSend(s):this._encodingQueue.enque(s)}else this._bufferedSend(i)},e.prototype._bufferedSend=function(i){(this._buffering||!this._trySend(i))&&(this._buffer.push(i),this._bufferSize=this._buffer.length)},e.prototype._trySend=function(i){var r=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>e.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){r._buffering=!1,r._tryBuffer()},50),!1;try{this.dataChannel.send(i)}catch(s){return pt.default.error("DC#:".concat(this.connectionId," Error when sending:"),s),this._buffering=!0,this.close(),!1}return!0},e.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var i=this._buffer[0];this._trySend(i)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},e.prototype._sendChunks=function(i){var r,s,o=_i.chunk(i);pt.default.log("DC#".concat(this.connectionId," Try to send ").concat(o.length," chunks..."));try{for(var a=Tde(o),l=a.next();!l.done;l=a.next()){var c=l.value;this.send(c,!0)}}catch(h){r={error:h}}finally{try{l&&!l.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}},e.prototype.handleMessage=function(i){var r=i.payload;switch(i.type){case $r.Answer:this._negotiator.handleSDP(i.type,r.sdp);break;case $r.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:pt.default.warn("Unrecognized message type:",i.type,"from peer:",this.peer);break}},e.ID_PREFIX="dc_",e.MAX_BUFFERED_AMOUNT=8388608,e}(nk.BaseConnection),TH={};uc(TH,"API",()=>PH,n=>PH=n);var IH=function(n,e,i,r){function s(o){return o instanceof i?o:new i(function(a){a(o)})}return new(i||(i=Promise))(function(o,a){function l(u){try{h(r.next(u))}catch(d){a(d)}}function c(u){try{h(r.throw(u))}catch(d){a(d)}}function h(u){u.done?o(u.value):s(u.value).then(l,c)}h((r=r.apply(n,e||[])).next())})},RH=function(n,e){var i={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,s,o,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(h){return function(u){return c([h,u])}}function c(h){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,s&&(o=h[0]&2?s.return:h[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,h[1])).done)return o;switch(s=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return i.label++,{value:h[1],done:!1};case 5:i.label++,s=h[1],h=[0];continue;case 7:h=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){i=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){i.label=h[1];break}if(h[0]===6&&i.label<o[1]){i.label=o[1],o=h;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(h);break}o[2]&&i.ops.pop(),i.trys.pop();continue}h=e.call(n,i)}catch(u){h=[6,u],s=0}finally{r=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},PH=function(){function n(e){this._options=e}return n.prototype._buildRequest=function(e){var i=this._options.secure?"https":"http",r=this._options,s=r.host,o=r.port,a=r.path,l=r.key,c=new URL("".concat(i,"://").concat(s,":").concat(o).concat(a).concat(l,"/").concat(e));return c.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),c.searchParams.set("version",ek.version),fetch(c.href,{referrerPolicy:this._options.referrerPolicy})},n.prototype.retrieveId=function(){return IH(this,void 0,Promise,function(){var e,i,r;return RH(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(e=s.sent(),e.status!==200)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw i=s.sent(),pt.default.error("Error retrieving ID",i),r="",this._options.path==="/"&&this._options.host!==_i.CLOUD_HOST&&(r=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+r);case 3:return[2]}})})},n.prototype.listAllPeers=function(){return IH(this,void 0,Promise,function(){var e,i,r;return RH(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(e=s.sent(),e.status!==200)throw e.status===401?(i="",this._options.host===_i.CLOUD_HOST?i="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":i="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+i)):new Error("Error. Status:".concat(e.status));return[2,e.json()];case 2:throw r=s.sent(),pt.default.error("Error retrieving list peers",r),new Error("Could not get list peers from the server."+r);case 3:return[2]}})})},n}(),Ide=function(){var n=function(e,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(r[o]=s[o])},n(e,i)};return function(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(e,i);function r(){this.constructor=e}e.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BA=function(){return BA=Object.assign||function(n){for(var e,i=1,r=arguments.length;i<r;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}return n},BA.apply(this,arguments)},kA=function(n){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&n[e],r=0;if(i)return i.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Rde=function(n,e){var i=typeof Symbol=="function"&&n[Symbol.iterator];if(!i)return n;var r=i.call(n),s,o=[],a;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(l){a={error:l}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(a)throw a.error}}return o},sk=function(n){Ide(e,n);function e(i,r){var s=n.call(this)||this;s._id=null,s._lastServerId=null,s._destroyed=!1,s._disconnected=!1,s._open=!1,s._connections=new Map,s._lostMessages=new Map;var o;return i&&i.constructor==Object?r=i:i&&(o=i.toString()),r=BA({debug:0,host:_i.CLOUD_HOST,port:_i.CLOUD_PORT,path:"/",key:e.DEFAULT_KEY,token:_i.randomToken(),config:_i.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},r),s._options=r,s._options.host==="/"&&(s._options.host=window.location.hostname),s._options.path&&(s._options.path[0]!=="/"&&(s._options.path="/"+s._options.path),s._options.path[s._options.path.length-1]!=="/"&&(s._options.path+="/")),s._options.secure===void 0&&s._options.host!==_i.CLOUD_HOST?s._options.secure=_i.isSecure():s._options.host==_i.CLOUD_HOST&&(s._options.secure=!0),s._options.logFunction&&pt.default.setLogFunction(s._options.logFunction),pt.default.logLevel=s._options.debug||0,s._api=new TH.API(r),s._socket=s._createServerConnection(),!_i.supports.audioVideo&&!_i.supports.data?(s._delayedAbort(zn.BrowserIncompatible,"The current browser does not support WebRTC"),s):o&&!_i.validateId(o)?(s._delayedAbort(zn.InvalidID,'ID "'.concat(o,'" is invalid')),s):(o?s._initialize(o):s._api.retrieveId().then(function(a){return s._initialize(a)}).catch(function(a){return s._abort(zn.ServerError,a)}),s)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){var i,r,s=Object.create(null);try{for(var o=kA(this._connections),a=o.next();!a.done;a=o.next()){var l=Rde(a.value,2),c=l[0],h=l[1];s[c]=h}}catch(u){i={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),e.prototype._createServerConnection=function(){var i=this,r=new bH.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return r.on(Ih.Message,function(s){i._handleMessage(s)}),r.on(Ih.Error,function(s){i._abort(zn.SocketError,s)}),r.on(Ih.Disconnected,function(){i.disconnected||(i.emitError(zn.Network,"Lost connection to server."),i.disconnect())}),r.on(Ih.Close,function(){i.disconnected||i._abort(zn.SocketClosed,"Underlying socket is already closed.")}),r},e.prototype._initialize=function(i){this._id=i,this.socket.start(i,this._options.token)},e.prototype._handleMessage=function(i){var r,s,o=i.type,a=i.payload,l=i.src;switch(o){case $r.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case $r.Error:this._abort(zn.ServerError,a.msg);break;case $r.IdTaken:this._abort(zn.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case $r.InvalidKey:this._abort(zn.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case $r.Leave:pt.default.log("Received leave message from ".concat(l)),this._cleanupPeer(l),this._connections.delete(l);break;case $r.Expire:this.emitError(zn.PeerUnavailable,"Could not connect to peer ".concat(l));break;case $r.Offer:var g=a.connectionId,v=this.getConnection(l,g);if(v&&(v.close(),pt.default.warn("Offer received for existing Connection ID:".concat(g))),a.type===Cl.Media){var c=new tk.MediaConnection(l,this,{connectionId:g,_payload:a,metadata:a.metadata});v=c,this._addConnection(l,v),this.emit("call",c)}else if(a.type===Cl.Data){var h=new rk.DataConnection(l,this,{connectionId:g,_payload:a,metadata:a.metadata,label:a.label,serialization:a.serialization,reliable:a.reliable});v=h,this._addConnection(l,v),this.emit("connection",h)}else{pt.default.warn("Received malformed connection type:".concat(a.type));return}var u=this._getMessages(g);try{for(var d=kA(u),f=d.next();!f.done;f=d.next()){var m=f.value;v.handleMessage(m)}}catch(y){r={error:y}}finally{try{f&&!f.done&&(s=d.return)&&s.call(d)}finally{if(r)throw r.error}}break;default:if(!a){pt.default.warn("You received a malformed message from ".concat(l," of type ").concat(o));return}var g=a.connectionId,v=this.getConnection(l,g);v&&v.peerConnection?v.handleMessage(i):g?this._storeMessage(g,i):pt.default.warn("You received an unrecognized message:",i);break}},e.prototype._storeMessage=function(i,r){this._lostMessages.has(i)||this._lostMessages.set(i,[]),this._lostMessages.get(i).push(r)},e.prototype._getMessages=function(i){var r=this._lostMessages.get(i);return r?(this._lostMessages.delete(i),r):[]},e.prototype.connect=function(i,r){if(r===void 0&&(r={}),this.disconnected){pt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(zn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var s=new rk.DataConnection(i,this,r);return this._addConnection(i,s),s},e.prototype.call=function(i,r,s){if(s===void 0&&(s={}),this.disconnected){pt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(zn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!r){pt.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var o=new tk.MediaConnection(i,this,BA(BA({},s),{_stream:r}));return this._addConnection(i,o),o},e.prototype._addConnection=function(i,r){pt.default.log("add connection ".concat(r.type,":").concat(r.connectionId," to peerId:").concat(i)),this._connections.has(i)||this._connections.set(i,[]),this._connections.get(i).push(r)},e.prototype._removeConnection=function(i){var r=this._connections.get(i.peer);if(r){var s=r.indexOf(i);s!==-1&&r.splice(s,1)}this._lostMessages.delete(i.connectionId)},e.prototype.getConnection=function(i,r){var s,o,a=this._connections.get(i);if(!a)return null;try{for(var l=kA(a),c=l.next();!c.done;c=l.next()){var h=c.value;if(h.connectionId===r)return h}}catch(u){s={error:u}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(s)throw s.error}}return null},e.prototype._delayedAbort=function(i,r){var s=this;setTimeout(function(){s._abort(i,r)},0)},e.prototype._abort=function(i,r){pt.default.error("Aborting!"),this.emitError(i,r),this._lastServerId?this.disconnect():this.destroy()},e.prototype.emitError=function(i,r){pt.default.error("Error:",r);var s;typeof r=="string"?s=new Error(r):s=r,s.type=i,this.emit("error",s)},e.prototype.destroy=function(){this.destroyed||(pt.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},e.prototype._cleanup=function(){var i,r;try{for(var s=kA(this._connections.keys()),o=s.next();!o.done;o=s.next()){var a=o.value;this._cleanupPeer(a),this._connections.delete(a)}}catch(l){i={error:l}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}this.socket.removeAllListeners()},e.prototype._cleanupPeer=function(i){var r,s,o=this._connections.get(i);if(o)try{for(var a=kA(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.close()}}catch(h){r={error:h}}finally{try{l&&!l.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}},e.prototype.disconnect=function(){if(!this.disconnected){var i=this.id;pt.default.log("Disconnect peer with ID:".concat(i)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=i,this._id=null,this.emit("disconnected",i)}},e.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)pt.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)pt.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},e.prototype.listAllPeers=function(i){var r=this;i===void 0&&(i=function(s){}),this._api.listAllPeers().then(function(s){return i(s)}).catch(function(s){return r._abort(zn.ServerError,s)})},e.DEFAULT_KEY="peerjs",e}(RA.EventEmitter),ok=vH.Peer;const Pde=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return sk},default:ok,util:_i},Symbol.toStringTag,{value:"Module"}));let ak;function Bde(){return ak}function kde(n){ak=n}function BH(n,e){return e||(e={}),e={...ak,...e},n?new ok(n,e):new ok(e)}async function kH(){const n=await Promise.resolve().then(()=>Pde);return console.log(n),n.default===void 0?n:n.default}class OH{constructor(){p(this,"_host"),p(this,"_client"),p(this,"_clientData"),this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const e="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(e)}async trySetupHost(e){const i=await kH(),r=new i(e);r.on("error",s=>{console.error(s),this._host=void 0,this.trySetupClient(e)}),r.on("open",s=>{this._host=new Dde(r)})}async trySetupClient(e){const i=await kH();this._client=new i,this._client.on("error",r=>{console.error("Client error",r)}),this._client.on("open",r=>{console.log("client connected",r),this._clientData=this._client.connect(e,{metadata:{id:r}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",s=>{console.log("<<",s)})})}}class Ode{constructor(e){p(this,"_peer"),this._peer=e}}class Dde extends Ode{constructor(e){var i;super(e),p(this,"_connections",[]),console.log("I AM THE HOST"),(i=this._peer)==null||i.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(e){console.log("host connection",e),e.on("open",()=>{this._connections.push(e),this.broadcastConnection(e)})}broadcastConnection(e){const i=this._connections.map(r=>{var s;return(s=r.metadata)==null?void 0:s.id}).filter(r=>r!==void 0);this.broadcast({type:"connection-list",connections:i})}broadcast(e){if(e!=null){console.log(">>",e);for(const i in this._peer.connections){const r=this._peer.connections[i];if(r)if(Array.isArray(r))for(const s of r)s&&s.send(e);else console.warn(r)}}}}var El=(n=>(n[n.OnConnection=0]="OnConnection",n[n.OnRoomJoin=1]="OnRoomJoin",n[n.Queued=2]="Queued",n[n.Immediate=3]="Immediate",n))(El||{});const DH="https://urls.needle.tools/default-networking-backend/index";let Rh="wss://needle-tiny-starter.glitch.me/socket";const so=!!te("debugnet"),OA=!!(so||te("debugowner")),lk=te("debugnetbin");var LH=(n=>(n.ConnectionInfo="connection-start-info",n))(LH||{}),jt=(n=>(n.Join="join-room",n.Leave="leave-room",n.JoinedRoom="joined-room",n.LeftRoom="left-room",n.UserJoinedRoom="user-joined-room",n.UserLeftRoom="user-left-room",n.RoomStateSent="room-state-sent",n))(jt||{});class Lde{constructor(){p(this,"room"),p(this,"viewId"),p(this,"allowEditing"),p(this,"inRoom")}}class Ude{constructor(){p(this,"room")}}class Fde{constructor(){p(this,"userId")}}var UH=(n=>(n.RequestHasOwner="request-has-owner",n.ResponseHasOwner="response-has-owner",n.RequestIsOwner="request-is-owner",n.ResponseIsOwner="response-is-owner",n.RequestOwnership="request-ownership",n.GainedOwnership="gained-ownership",n.RemoveOwnership="remove-ownership",n.LostOwnership="lost-ownership",n.GainedOwnershipBroadcast="gained-ownership-broadcast",n.LostOwnershipBroadcast="lost-ownership-broadcast",n))(UH||{});class ck{constructor(e,i){p(this,"guid"),p(this,"connection"),p(this,"_hasOwnership",!1),p(this,"_isOwned"),p(this,"_gainSubscription"),p(this,"_lostSubscription"),p(this,"_hasOwnerResponse"),p(this,"_isWaitingForOwnershipResponseCallback",null),this.connection=e,this.guid=i,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),e.beginListen("lost-ownership",this._lostSubscription),e.beginListen("gained-ownership-broadcast",this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),e.beginListen("response-has-owner",this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send("request-has-owner",{guid:this.guid})}onHasOwnerResponse(e){e.guid===this.guid&&(this._isOwned=e.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this.connection.send("request-has-owner",{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(e){e.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=e.value,e.value||(OA&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((e,i)=>{this.requestOwnership();let r=0;const s=()=>{if(r++>10)return i("Timeout");setTimeout(()=>{this.hasOwnership?e(this):s()},100)};s()})}requestOwnership(){return OA&&console.log("Request ownership",this.guid),this.connection.send("request-ownership",{guid:this.guid}),this}freeOwnership(){return this.connection.send("remove-ownership",{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen("gained-ownership",this._gainSubscription),this.connection.stopListen("lost-ownership",this._lostSubscription),this.connection.stopListen("response-has-owner",this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(e){e.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===e.owner?(OA&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(e){e===this.guid&&(OA&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class FH{constructor(e){p(this,"context"),p(this,"_peer",null),p(this,"_usersInRoomCopy",[]),p(this,"_defaultMessagesBuffer",[]),p(this,"_defaultMessagesBufferArray",[]),p(this,"netWebSocketUrlProvider"),p(this,"_listeners",{}),p(this,"_listenersBinary",{}),p(this,"connected",!1),p(this,"channelId"),p(this,"_connectionId",null),p(this,"_ws"),p(this,"_waitingForSocket",{}),p(this,"_isInRoom",!1),p(this,"_currentRoomName",null),p(this,"_currentRoomViewId",null),p(this,"_currentRoomAllowEditing",!0),p(this,"_currentInRoom",[]),p(this,"_state",{}),p(this,"_currentDelay",-1),p(this,"_connectingToWebsocketPromise",null),this.context=e}get peer(){return this._peer||(this._peer=new OH),this._peer}tryGetState(e){return e==="invalid"?null:this._state[e]}get connectionId(){return this._connectionId}get isDebugEnabled(){return so}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}getViewOnlyUrl(){if(this.currentRoomViewId===null)return null;const e=new URL(window.location.href);return e.searchParams.set("view",this.currentRoomViewId),e.href}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}get currentServerUrl(){var e;return((e=this._ws)==null?void 0:e.url)??null}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(e){return this._currentInRoom.indexOf(e)!==-1}usersInRoom(e=null){e||(e=this._usersInRoomCopy),e.length=0;for(const i of this._currentInRoom)e.push(i);return e}joinRoom(e,i=!1){return e?e.length>1024?(console.error('Room name too long, can not join: "'+e+'". Max length is 1024 characters.'),!1):(this.connect(),so&&console.log("join: "+e),this.send("join-room",{room:e,viewOnly:i},El.OnConnection),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}leaveRoom(e=null){return e||(e=this.currentRoomName),e?(this.send("leave-room",{room:e}),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}send(e,i=null,r=El.Queued){if(i===null&&(i={}),r===El.Queued){this._defaultMessagesBuffer.push({key:e,value:i});return}return this.sendWithWebsocket(e,i,r)}sendDeleteRemoteState(e){this.send("delete-state",{guid:e,dontSave:!0}),delete this._state[e]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(e){var i;lk&&console.log("<< send binary",this.context.time.frame,e.length/1024+" KB"),(i=this._ws)==null||i.send(e)}sendBufferedMessagesNow(){var e;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const i=Object.keys(this._defaultMessagesBuffer).length;for(const s in this._defaultMessagesBuffer){const o=this._defaultMessagesBuffer[s];if(i<=1){this.sendWithWebsocket(o.key,o.value,El.Immediate);break}const a=this.toMessage(o.key,o.value);this._defaultMessagesBufferArray.push(a)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&so&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const r=JSON.stringify(this._defaultMessagesBufferArray);(e=this._ws)==null||e.send(r)}beginListen(e,i){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(i),i}stopListening(e,i){return this.stopListen(e,i)}stopListen(e,i){if(!i||!this._listeners[e])return;const r=this._listeners[e].indexOf(i);r>=0&&this._listeners[e].splice(r,1)}beginListenBinary(e,i){return this._listenersBinary[e]||(this._listenersBinary[e]=[]),this._listenersBinary[e].push(i),i}stopListenBinary(e,i){if(!this._listenersBinary[e])return;const r=this._listenersBinary[e].indexOf(i);r>=0&&this._listenersBinary[e].splice(r,1)}registerProvider(e){this.netWebSocketUrlProvider=e}async connect(){var e;if(this.connected)return Promise.resolve(!0);so&&console.log("connecting");const i=(e=this.netWebSocketUrlProvider)==null?void 0:e.getWebsocketUrl();return i?Rh=i:t4()&&(Rh="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var e;(e=this._ws)==null||e.close(),this._ws=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(e,i)=>{var r,s;let o=!1;const a=d=>{o||(o=!0,e(d))};if(Rh===void 0&&(console.log("Fetch default backend url: "+DH),Rh=await(await fetch(DH)).text()),Rh===void 0){a(!1);return}console.debug(`\u22A1 Connecting to networking backend on
`+Rh);const l=await Promise.resolve().then(()=>ASe),c=((r=l.default)==null?void 0:r.WebsocketBuilder)??l.WebsocketBuilder,h=((s=l.default)==null?void 0:s.ExponentialBackoff)??l.ExponentialBackoff,u=new c(Rh).withMaxRetries(3).withBackoff(new h(2e3,2)).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=u,this.connected=!0,it()||so?console.log(`\u229E Connected to networking backend
`+Rh):console.debug("\u229E Connected to networking backend",Rh),a(!0),this.onSendQueued(El.OnConnection)}).onClose(d=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,a(!1)}).onError(d=>{console.error("\u22A0 Websocket error"),a(!1)}).onRetry(()=>{console.log("Retry connecting to networking websocket")}).build();u.addEventListener(l.WebsocketEvent.message,(d,f)=>{this.onMessage(d,f)})})}onMessage(e,i){const r=i.data;try{if(typeof r!="string"){r.size&&this.handleIncomingBinaryMessage(r);return}const s=JSON.parse(r);if(Array.isArray(s))for(const o of s)this.handleIncomingStringMessage(o);else this.handleIncomingStringMessage(s);return}catch(s){so&&r==="pong"?console.log("<<",r):it()&&console.error("Failed to parse message",s)}}async handleIncomingBinaryMessage(e){lk&&console.log("<< bin",this.context.time.frame);const i=await e.arrayBuffer();var r=new Uint8Array(i);const s=new h_(r),o=s.getBufferIdentifier(),a=this._listenersBinary[o],l=yG(s),c=AG(l);if(c&&typeof c=="string"&&(this._state[c]=l),!a)return;const h=l??s;for(const u of a)u(h)}handleIncomingStringMessage(e){var i,r;if(so&&console.log("<<",e.key??e),e.key)switch(e.key){case"connection-start-info":if(e.data){const l=e.data;l&&(console.assert(l.id!==void 0&&l.id!==null&&l.id.length>0,"server did not send connection id",l.id),console.debug("Your id is: "+l.id,this.context.alias??""),this._connectionId=l.id)}else console.warn("Expected connection id in "+e.key);break;case"joined-room":if(so&&console.log(e),e){this._isInRoom=!0;const l=e;this._currentRoomName=l.room,this._currentRoomViewId=l.viewId,this._currentRoomAllowEditing=l.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...l.inRoom),(lk||it())&&console.debug("Joined Needle Engine Room: "+l.room);const c=new URL(window.location.href);c.searchParams.has("room")&&c.searchParams.delete("room"),c.searchParams.set("view",this._currentRoomViewId),console.debug(`Room view id: ${this._currentRoomViewId}
${c.href}`)}this.onSendQueued(El.OnRoomJoin);break;case"left-room":e.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case"user-joined-room":if(e.data){const l=e.data;this._currentInRoom.push(l.userId),so&&console.log(l.userId+" joined","now in room:",this._currentInRoom)}break;case"user-left-room":if(e.data){const l=e.data,c=this._currentInRoom.indexOf(l.userId);c>=0&&(so&&console.log(l.userId+" left","now in room:",this._currentInRoom),this._currentInRoom.splice(c,1)),l.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":so&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const a=(i=e.data)==null?void 0:i.time;a&&(this._currentDelay=this.context.time.time-a),so&&console.log("Current latency: "+this._currentDelay.toFixed(4)+" sec","Clients in room: "+((r=this._currentInRoom)==null?void 0:r.length));break}const s=e.data;s&&(this._state[s.guid]=s);let o=this._listeners[e.key];if(o){o=[...o];for(const a of o)try{a(e.data)}catch(l){console.error('Error invoking callback for "'+e.key+'"',l)}}}toMessage(e,i){return{key:e,data:i}}sendWithWebsocket(e,i,r=El.OnRoomJoin){if(!this._ws){const o=this._waitingForSocket[r]||[];o.push(()=>this.sendWithWebsocket(e,i,r)),this._waitingForSocket[r]=o;return}const s=JSON.stringify(this.toMessage(e,i));so&&console.log(">>",e),this._ws.send(s)}onSendQueued(e){const i=this._waitingForSocket[e];if(i){for(const r of i)r();i.length=0}}}const DA=te("debugwebxr");class hk{constructor(e,i){p(this,"controllerStates",[]),p(this,"userId"),p(this,"context"),p(this,"userStateEvtName"),p(this,"onReceivedControllerState",r=>{DA&&console.log(`XRSync: Received change for ${this.userId}: ${r.type} ${r.handedness}; tracked=${r.isTracking}`);let s=!1;for(let o=0;o<this.controllerStates.length;o++)if(this.controllerStates[o].index===r.index){this.controllerStates[o]=r,s=!0;break}s||this.controllerStates.push(r)}),this.userId=e,this.context=i,this.userStateEvtName="xr-sync-user-state-"+e,this.context.connection.beginListen(this.userStateEvtName,this.onReceivedControllerState)}dispose(){this.context.connection.stopListen(this.userStateEvtName,this.onReceivedControllerState)}update(e){if(this.context.connection.isConnected!=!1){for(let i=this.controllerStates.length-1;i>=0;i--){const r=this.controllerStates[i];let s=!1;for(let o=0;o<e.controllers.length;o++)e.controllers[o].index===r.index&&(s=!0);s||(DA&&console.log(`XRSync: ${r.type} ${r.handedness} removed`,r.index),this.controllerStates.splice(i,1),this.sendControllerRemoved(r))}for(const i of e.controllers)this.updateControllerStates(i)}}onExitXR(e){for(const i of this.controllerStates)this.sendControllerRemoved(i);this.controllerStates.length=0}sendControllerRemoved(e){e.isTracking=!1,e.guid="",this.context.connection.send(this.userStateEvtName,e),this.context.connection.sendDeleteRemoteState(e.guid)}updateControllerStates(e){const i=this.controllerStates.find(r=>r.index===e.index);if(i){let r=!1;r||(r=i.isTracking!=e.isTracking),r&&(i.isTracking=e.isTracking,this.context.connection.send(this.userStateEvtName,i))}else{const r={guid:this.userId+"-"+e.index,isTracking:e.isTracking,handedness:e.side,index:e.index,type:e.hand?"hand":"controller"};this.controllerStates.push(r),this.context.connection.send(this.userStateEvtName,r),DA&&console.log(`XRSync: ${r.type} ${r.handedness} added`,r.index)}}}class NH{constructor(e){p(this,"context"),p(this,"onJoinedRoom",()=>{if(this.context.connection.connectionId){this._states.has(this.context.connection.connectionId)||(DA&&console.log("XRSync: Local user joined room",this.context.connection.connectionId),this._states.set(this.context.connection.connectionId,new hk(this.context.connection.connectionId,this.context)));for(const i of this.context.connection.usersInRoom())this._states.has(i)||this._states.set(i,new hk(i,this.context))}}),p(this,"onLeftRoom",()=>{if(this.context.connection.connectionId&&!this._states.has(this.context.connection.connectionId)){const i=this._states.get(this.context.connection.connectionId);i?.dispose(),this._states.delete(this.context.connection.connectionId)}}),p(this,"onOtherUserJoinedRoom",i=>{const r=i.userId;this._states.has(r)||(DA&&console.log("XRSync: Remote user joined room",r),this._states.set(r,new hk(r,this.context)))}),p(this,"onOtherUserLeftRoom",i=>{const r=i.userId;if(!this._states.has(r)){const s=this._states.get(r);s?.dispose(),this._states.delete(r)}}),p(this,"_states",new Map),this.context=e,this.context.connection.beginListen(jt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(jt.LeftRoom,this.onLeftRoom),this.context.connection.beginListen(jt.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.beginListen(jt.UserLeftRoom,this.onOtherUserLeftRoom)}hasState(e){return e?this._states.has(e):!1}isTracking(e,i){if(!e)return;const r=this._states.get(e);if(!r)return;const s=r.controllerStates.find(o=>o.handedness===i);return s?.isTracking||!1}getDeviceType(e,i){if(!e)return;const r=this._states.get(e);if(!r)return;const s=r.controllerStates.find(o=>o.handedness===i);return s?.type||"unknown"}destroy(){this.context.connection.stopListen(jt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(jt.LeftRoom,this.onLeftRoom),this.context.connection.stopListen(jt.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.stopListen(jt.UserLeftRoom,this.onOtherUserLeftRoom)}onUpdate(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const i=this._states.get(this.context.connection.connectionId);i?.update(e)}}onExitXR(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const i=this._states.get(this.context.connection.connectionId);i?.onExitXR(e)}}}class zH{constructor(){p(this,"_fadeToColorQuad"),p(this,"_fadeToColorMaterial"),p(this,"_requestedFadeValue",0),p(this,"_transitionPromise",null),p(this,"_transitionResolve",null),this._fadeToColorMaterial=new Jt({color:0,transparent:!0,depthTest:!1,fog:!1,side:yi}),this._fadeToColorQuad=new pe(new cr(10,10),this._fadeToColorMaterial)}dispose(){this._fadeToColorQuad.geometry.dispose(),this._fadeToColorMaterial.dispose()}update(e,i){const r=this._fadeToColorQuad,s=this._fadeToColorMaterial;r.parent!==e&&s.opacity>0?e.add(r):s.opacity===0&&r.removeFromParent(),r.layers.set(2),r.material=this._fadeToColorMaterial,r.position.z=-1,r.renderOrder=1/0;const o=this._requestedFadeValue;s.opacity=tt.lerp(s.opacity,o,i/.03),Math.abs(s.opacity-o)<=.01&&this._transitionResolve&&(this._transitionResolve(),this._transitionResolve=null,this._transitionPromise=null,this._requestedFadeValue=0)}remove(){this._fadeToColorQuad.removeFromParent()}fadeTransition(){if(this._transitionPromise)return this._transitionPromise;this._requestedFadeValue=1;const e=new Promise(i=>{this._transitionResolve=i});return this._transitionPromise=e,e}}class Nde extends zv{constructor(e,i={}){const r=i.font;if(r===void 0)super();else{const s=r.generateShapes(e,i.size);i.depth=i.height!==void 0?i.height:50,i.bevelThickness===void 0&&(i.bevelThickness=10),i.bevelSize===void 0&&(i.bevelSize=8),i.bevelEnabled===void 0&&(i.bevelEnabled=!1),super(s,i)}this.type="TextGeometry"}}class zde extends Kn{constructor(e){super(e)}load(e,i,r,s){const o=this,a=new Yr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){const c=o.parse(JSON.parse(l));i&&i(c)},r,s)}parse(e){return new jH(e)}}class jH{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,i=100){const r=[],s=jde(e,i,this.data);for(let o=0,a=s.length;o<a;o++)r.push(...s[o].toShapes());return r}}function jde(n,e,i){const r=Array.from(n),s=e/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*s,a=[];let l=0,c=0;for(let h=0;h<r.length;h++){const u=r[h];if(u===`
`)l=0,c-=o;else{const d=Gde(u,s,l,c,i);l+=d.offsetX,a.push(d.path)}}return a}function Gde(n,e,i,r,s){const o=s.glyphs[n]||s.glyphs["?"];if(!o){console.error('THREE.Font: character "'+n+'" does not exists in font family '+s.familyName+".");return}const a=new Zz;let l,c,h,u,d,f,m,g;if(o.o){const v=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let y=0,A=v.length;y<A;)switch(v[y++]){case"m":l=v[y++]*e+i,c=v[y++]*e+r,a.moveTo(l,c);break;case"l":l=v[y++]*e+i,c=v[y++]*e+r,a.lineTo(l,c);break;case"q":h=v[y++]*e+i,u=v[y++]*e+r,d=v[y++]*e+i,f=v[y++]*e+r,a.quadraticCurveTo(d,f,h,u);break;case"b":h=v[y++]*e+i,u=v[y++]*e+r,d=v[y++]*e+i,f=v[y++]*e+r,m=v[y++]*e+i,g=v[y++]*e+r,a.bezierCurveTo(d,f,m,g,h,u);break}}return{offsetX:o.ha*e,path:a}}var yf=(n=>(n[n.Quad=0]="Quad",n[n.Cube=1]="Cube",n[n.Sphere=2]="Sphere",n[n.RoundedCube=10]="RoundedCube",n))(yf||{});const zS=new Map;function Hde(n){let e="";switch(n){default:case"OpenSans":e="https://cdn.needle.tools/static/fonts/facetype/Open Sans_Regular_ascii.json";break;case"Helvetiker":e="https://raw.githubusercontent.com/mrdoob/three.js/master/examples/fonts/helvetiker_regular.typeface.json";break}if(zS.has(e)){const s=zS.get(e);if(s)return s}const i=new zde,r=new Promise((s,o)=>{i.load(e,a=>{zS.set(e,a),s(a)},void 0,o)});return zS.set(e,r),r}var jS,uk;class n0{static createText(e,i){let r=null;const s=i?.font||Hde(i?.familyFamily||null);s instanceof jH?r=Em(this,jS,uk).call(this,e,s,i):r==null&&(r=new dt);const o=i?.color||16777215,a=new pe(r,i?.material??new mr({color:o}));return this.applyDefaultObjectOptions(a,i),s instanceof Promise?s.then(l=>{a.geometry=Em(this,jS,uk).call(this,e,l,i),i!=null&&i.onGeometry&&i.onGeometry(a)}):i!=null&&i.onGeometry&&i.onGeometry(a),a}static createOccluder(e){const i=new mr({colorWrite:!1,depthWrite:!0,side:yi});return this.createPrimitive(e,{material:i})}static createPrimitive(e,i){let r;const s=i?.color||16777215;switch(e){case"Quad":case 0:{const o=new cr(1,1,1,1),a=i?.material??new mr({color:s});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),r=new pe(o,a)}break;case"Cube":case 1:{const o=new Ki(1,1,1),a=i?.material??new mr({color:s});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),r=new pe(o,a)}break;case 10:case"RoundedCube":{const o=Vde(1,1,1,.1,2),a=i?.material??new mr({color:s});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),r=new pe(o,a)}break;case"Sphere":case 2:{const o=new tl(.5,16,16),a=i?.material??new mr({color:s});i!=null&&i.texture&&"map"in a&&(a.map=i.texture),r=new pe(o,a)}break}return this.applyDefaultObjectOptions(r,i),r}static createSprite(e){const i=new gw({color:16777215});e!=null&&e.texture&&"map"in i&&(i.map=e.texture);const r=new gR(i);return this.applyDefaultObjectOptions(r,e),r}static applyDefaultObjectOptions(e,i){e.receiveShadow=!0,e.castShadow=!0,i!=null&&i.name&&(e.name=i.name),i!=null&&i.position&&(Array.isArray(i.position)?e.position.set(i.position[0],i.position[1],i.position[2]):e.position.set(i.position.x,i.position.y,i.position.z)),i!=null&&i.rotation&&(Array.isArray(i.rotation)?e.rotation.set(i.rotation[0],i.rotation[1],i.rotation[2]):e.rotation.set(i.rotation.x,i.rotation.y,i.rotation.z)),i!=null&&i.scale&&(typeof i.scale=="number"?e.scale.set(i.scale,i.scale,i.scale):e.scale.set(i.scale.x,i.scale.y,i.scale.z)),i?.receiveShadow!=null&&(e.receiveShadow=i.receiveShadow),i?.castShadow!=null&&(e.castShadow=i.castShadow),i!=null&&i.parent&&i.parent.add(e)}}jS=new WeakSet,uk=function(n,e,i){const r=i?.depth||.1;return new Nde(n,{font:e,size:1,depth:r,height:r,bevelEnabled:i?.bevel||!1,bevelThickness:.01,bevelOffset:.01,bevelSize:.01})},xa(n0,jS);function Vde(n,e,i,r,s){const o=new Pu,a=1e-5,l=r-a;o.absarc(a,a,a,-Math.PI/2,-Math.PI,!0),o.absarc(a,e-l*2,a,Math.PI,Math.PI/2,!0),o.absarc(n-l*2,e-l*2,a,Math.PI/2,0,!0),o.absarc(n-l*2,a,a,0,-Math.PI/2,!0);const c=new zv(o,{bevelEnabled:!0,bevelSegments:s*2,steps:1,bevelSize:l,bevelThickness:r,curveSegments:s});return c.scale(1,1,1-r),c.center(),c.computeVertexNormals(),c}const GH=class{constructor(n,e,i){p(this,"_session"),p(this,"_mode"),p(this,"_init"),p(this,"_renderer"),p(this,"_camera"),p(this,"_scene"),p(this,"onEnd",()=>{var r;(r=this._session)==null||r.removeEventListener("end",this.onEnd),this._renderer.setAnimationLoop(null),this._renderer.dispose(),this._scene.clear()}),p(this,"_lastTime",0),p(this,"onFrame",(r,s)=>{const o=r-this._lastTime;this.update(r,o),this._camera.parent!==this._scene&&this._scene.add(this._camera),this._renderer.render(this._scene,this._camera)}),p(this,"_objects",[]),this._mode=n,this._init=e,this._session=i,this._session.addEventListener("end",this.onEnd),this._renderer=new lh({alpha:!0}),this._renderer.setAnimationLoop(this.onFrame),this._renderer.xr.setSession(i),this._renderer.xr.enabled=!0,this._camera=new Ft,this._scene=new Er,this._scene.fog=new mw(4473924,10,250),this._scene.add(this._camera),this.setupScene()}static get active(){return this._active}static async start(n,e){if(this._active)return console.error("Cannot start a new XR session while one is already active"),null;if(this._requestInFlight)return console.error("Cannot start a new XR session while a request is already in flight"),null;if("xr"in navigator&&navigator.xr){if(!e)return console.error("XRSessionInit must be provided"),null;this._requestInFlight=!0;const i=await navigator.xr.requestSession(n,e);return i.addEventListener("end",()=>{this._active=null}),this._requestInFlight?(this._requestInFlight=!1,this._active=new GH(n,e,i),this._active):(i.end(),null)}return null}static async handoff(){return this._active?this._active.handoff():null}static async stop(){this._requestInFlight=!1,this._active&&(await this._active.end(),await $l(100)),this._active=null}get isAR(){return this._mode==="immersive-ar"}end(){return this._session?this._session.end():Promise.resolve()}async handoff(){if(!this._session)throw new Error("Cannot handoff a session that has already ended");const n={session:this._session,mode:this._mode,init:this._init};return await this.onBeforeHandoff(),this.onEnd(),this._session=null,n}async onBeforeHandoff(){await $l(1e3),this._scene.clear()}setupScene(){this._scene.background=new be(0),this._scene.add(new Zw(5,10,1118481,1118481));const n=new Gp(16777215,1);n.position.set(0,20,0),n.castShadow=!1,this._scene.add(n);const e=new Gp(16777215,1);e.position.set(0,-1,0),e.castShadow=!1,this._scene.add(e);const i=new jp(16777215,1,100,1);i.position.set(0,2,0),i.castShadow=!1,i.distance=200,this._scene.add(i);const r=50;for(let s=0;s<100;s++){const o=new mr({color:2236962,metalness:1,roughness:.8});this.isAR&&(o.emissive=new be(Math.random(),Math.random(),Math.random()),o.emissiveIntensity=Math.random());const a=tt.random(0,1)>.5?yf.Sphere:yf.Cube,l=n0.createPrimitive(a,{material:o});l.position.x=tt.random(-r,r),l.position.y=tt.random(-2,r),l.position.z=tt.random(-r,r),l.rotation.x=tt.random(0,Math.PI*2),l.rotation.y=tt.random(0,Math.PI*2),l.rotation.z=tt.random(0,Math.PI*2),l.scale.multiplyScalar(.5+Math.random()*10);const c=l.position.distanceTo(this._camera.position)-l.scale.x;c<1&&l.position.multiplyScalar(1+1/c),this._objects.push(l),this._scene.add(l)}}update(n,e){const i=n*4e-4;for(let r=0;r<this._objects.length;r++){const s=this._objects[r];s.position.y+=Math.sin(i+r*.5)*.005,s.rotateY(.002)}}};let r0=GH;p(r0,"_active",null),p(r0,"_requestInFlight",!1);const HH="NeedleXRSession onStart",VH="NeedleXRSession onEnd",tr=te("debugwebxr"),QH=te("stats");let dk=0;function Qde(n){let e=null;const i=n;return i.getAROverlayContainer?e=i.getAROverlayContainer():e=n,e}Wde();async function Wde(){var n;if(te("debugasap")){let e=globalThis["needle:XRSession"];if(e instanceof Promise){delete globalThis["needle:XRSession"],fi.addContextCreatedCallback(async i=>{if(!e)return;$p(!0);const r=await e;if(r){const s=Et.getDefaultSessionInit("immersive-vr");Et.setSession("immersive-vr",r,s,i.context)}else console.error("NeedleXRSession: ASAP session was rejected");e=void 0});return}}if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent)){console.warn("WebXRViewer does not support addEventListener");return}(n=navigator.xr)==null||n.addEventListener("sessiongranted",async()=>{$p(!0),console.log("Received Session Granted..."),await $l(100);const e=sessionStorage.getItem("needle_xr_session_mode"),i=sessionStorage.getItem("needle_xr_session_init")??null,r=i?JSON.parse(i):null;let s=null;if(WH()&&(await r0.start(e||"immersive-vr",r||Et.getDefaultSessionInit("immersive-vr")),await Yde(),s=await r0.handoff()),s)Et.setSession(s.mode,s.session,s.init,Ot.Current);else if(e&&i){console.log("Session Granted: Restore last session");const o=JSON.parse(i);Et.start(e,o).catch(a=>console.warn(a))}else Et.start("immersive-vr").catch(o=>console.warn("Session Granted failed:",o))},{once:!0})}}function Xde(n,e){sessionStorage.setItem("needle_xr_session_mode",n),sessionStorage.setItem("needle_xr_session_init",JSON.stringify(e))}function qde(){sessionStorage.removeItem("needle_xr_session_mode"),sessionStorage.removeItem("needle_xr_session_init")}const pk=new Set;fi.registerCallback(Si.ContextCreationStart,async n=>{pk.add(n.context)}),fi.registerCallback(Si.ContextCreated,async n=>{pk.delete(n.context)});function WH(){return pk.size>0}function Yde(){return new Promise(n=>{const e=Date.now(),i=setInterval(()=>{(!WH()||Date.now()-e>6e4)&&(clearInterval(i),n())},100)})}gg()&&it()&&window.addEventListener("keydown",n=>{(n.key==="x"||n.key==="Escape")&&Et.active&&Et.stop()});const od=class{constructor(n,e,i,r){p(this,"context"),p(this,"session"),p(this,"mode"),p(this,"controllers",[]),p(this,"_rigScale",1),p(this,"_lastRigScaleUpdate",-1),p(this,"_rigs",[]),p(this,"_viewerHitTestSource",null),p(this,"_defaultRig"),p(this,"_xr_scripts"),p(this,"_xr_update_scripts",[]),p(this,"_inactive_scripts",[]),p(this,"_controllerAdded"),p(this,"_controllerRemoved"),p(this,"_originalCameraWorldPosition"),p(this,"_originalCameraWorldRotation"),p(this,"_originalCameraWorldScale"),p(this,"_originalCameraParent"),p(this,"_mainCamera",null),p(this,"onRendererSessionSet",()=>{var a;this.running&&(this.context.renderer.xr.enabled=!0,this.context.renderer.xr.updateCamera(this.context.mainCamera),(a=this.context.mainCameraComponent)==null||a.applyClearFlags())}),p(this,"onInputSourceAdded",a=>{if(a.targetRayMode==="screen")return;let l=0;for(let h=0;h<this.session.inputSources.length;h++)if(this.session.inputSources[h]===a){l=h;break}if(this.controllers.find(h=>h.inputSource===a)){console.warn("Controller already exists for input source",l);return}tr&&console.log("Adding controller",l);const c=new FB(this,a,l);this._newControllers.push(c)}),p(this,"_ended",!1),p(this,"_newControllers",[]),p(this,"onEnd",a=>{var l,c,h;if(this._ended)return;this._ended=!0,tr&&console.log("XR Session ended"),qde(),this.onAfterRender(),this.revertCustomForward(),this._didStart=!1,this._previousCameraParent=null,rd(this.onBefore,Xi.LateUpdate);const u=this.context.pre_render_callbacks.indexOf(this.onBeforeRender);u>=0&&this.context.pre_render_callbacks.splice(u,1);const d=this.context.post_render_callbacks.indexOf(this.onAfterRender);d>=0&&this.context.post_render_callbacks.splice(d,1),this.context.xr=null,this.context.renderer.xr.enabled=!1,this.context.pre_update_oneshot_callbacks.push(()=>{var f,m;(f=this.context.mainCameraComponent)==null||f.applyClearFlags(),(m=this.context.mainCameraComponent)==null||m.applyClippingPlane()}),uG({session:this});for(const f of od._xrEndListeners)f({xr:this});for(let f=0;f<this.controllers.length;f++)this.disconnectInputSource(this.controllers[f].inputSource);for(const f of this._xr_scripts)(l=f?.onLeaveXR)==null||l.call(f,{xr:this});(c=this.sync)==null||c.onExitXR(this),this.context.mainCamera&&((h=this._originalCameraParent)==null||h.add(this.context.mainCamera),this._originalCameraWorldPosition&&gr(this.context.mainCamera,this._originalCameraWorldPosition),this._originalCameraWorldRotation&&Ca(this.context.mainCamera,this._originalCameraWorldRotation),this._originalCameraWorldScale&&bg(this.context.mainCamera,this._originalCameraWorldScale)),this.context.requestSizeUpdate(),this._defaultRig.gameObject.removeFromParent(),$p(!1),performance.mark(VH),performance.measure("NeedleXRSession",HH,VH)}),p(this,"_didStart",!1),p(this,"onBefore",a=>{var l,c,h,u,d,f,m,g;const v=a.xrFrame;if(!v)return;performance.mark("NeedleXRSession onBefore start"),this.context.xr=this,this.context.mainCameraComponent&&this.context.mainCameraComponent!==this._mainCamera&&(this._mainCamera=this.context.mainCameraComponent),((l=this.rig)==null?void 0:l.isActive)==!1&&(tr&&console.warn("Latest rig is not active - trying to activate a different rig",this.rig),this.updateActiveXRRig()),this.rig&&(c=this._mainCamera)!=null&&c.gameObject&&((u=(h=this._mainCamera)==null?void 0:h.gameObject)==null?void 0:u.parent)!==this.rig.gameObject&&this.rig.gameObject.add((d=this._mainCamera)==null?void 0:d.gameObject),this.internalUpdateState(),this.applyCustomForward();const y={xr:this};if(this._didStart){if(this.context.new_scripts_xr.length>0){const A=[...this.context.new_scripts_xr];for(let b=0;b<A.length;b++){const x=this.context.new_scripts_xr[b];if(!x||x.destroyed||((f=x.supportsXR)==null?void 0:f.call(x,this.mode))==!1){this.context.new_scripts_xr.splice(b,1);continue}if(!x.activeAndEnabled){this.context.new_scripts_xr.splice(b,1),this.markInactive(x);continue}if(this.addScript(x)){this.invokeCallback_EnterXR(x);for(const _ of this.controllers)this.invokeCallback_ControllerAdded(x,_)}}}}else{if(this._didStart=!0,this.mode==="immersive-vr"){const b=pl(this.context.scene.children);if(b){const x=b.getSize(bt());if(x.length()>0){const _=this._defaultRig.gameObject;_.position.set(b.min.x+x.x*.5,b.min.y,b.max.z+x.z*.5+1.5);const w=b.getCenter(bt());w.y=_.position.y,_.lookAt(w)}}}hG({session:this});for(const b of od._xrStartListeners)b(y);const A=[...this._xr_scripts];tr&&console.log("NeedleXRSession start, handle scripts:",A);for(const b of A){if(b.destroyed){this._script_to_remove.push(b);continue}if(!b.activeAndEnabled){this.markInactive(b);continue}this.invokeCallback_EnterXR(b);for(const x of this.controllers)this.invokeCallback_ControllerAdded(b,x)}}this.syncCameraCullingMask();for(const A of this.controllers)A.onUpdate(v);if(this._newControllers.length>0){const A=[...this._newControllers];this._newControllers.length=0;for(const b of A){if(!b.connected){console.warn("New controller is not connected",b);continue}this.controllers.push(b);for(const x of this._xr_scripts){if(x.destroyed){this._script_to_remove.push(x);continue}x.activeAndEnabled!==!1&&this.invokeCallback_ControllerAdded(x,b)}}this.controllers.sort((b,x)=>b.index-x.index)}tr&&this.context.time.frame%30===0&&this.controllers.length<=0&&this.session.inputSources.length>0&&($p(!0),console.error("XRControllers are not added but inputSources are present")),performance.mark("NeedleXRSession update scripts start");for(const A of this._xr_update_scripts){if(A.destroyed===!0){this._script_to_remove.push(A);continue}if(A.activeAndEnabled===!1){this.markInactive(A);continue}A.onUpdateXR&&A.onUpdateXR(y)}if(performance.mark("NeedleXRSession update scripts end"),performance.measure("NeedleXRSession update scripts","NeedleXRSession update scripts start","NeedleXRSession update scripts end"),this.handleInactiveScripts(),this._script_to_remove.length>0){const A=[...new Set(this._script_to_remove)];this._script_to_remove.length=0;for(const b of A)!b.destroyed&&this.running&&((m=b.onLeaveXR)==null||m.call(b,y)),this.removeScript(b)}(g=this.sync)==null||g.onUpdate(this),this.onRenderDebug(),performance.mark("NeedleXRSession onBefore end"),performance.measure("NE XR frame","NeedleXRSession onBefore start","NeedleXRSession onBefore end")}),p(this,"onBeforeRender",()=>{this.context.mainCamera&&this.updateFade(this.context.mainCamera)}),p(this,"onAfterRender",()=>{if(this.onUpdateFade_PostRender(),gg()||!this._renderOnceOnDevice){const a=this.context.renderer;if(a.xr.isPresenting&&this.context.mainCamera){this._renderOnceOnDevice=!0;const l=a.xr.enabled,c=a.getRenderTarget(),h=this.context.scene.background;a.xr.enabled=!1,a.setRenderTarget(null),this.isPassThrough&&(this.context.scene.background=null),this.context.composer?this.context.composer.render(this.context.time.deltaTime):a.render(this.context.scene,this.context.mainCamera),a.xr.enabled=l,a.setRenderTarget(c),this.context.scene.background=h}}}),p(this,"_script_to_remove",[]),p(this,"_camera"),p(this,"_cameraRenderParent",new ve().rotateY(Math.PI)),p(this,"_previousCameraParent"),p(this,"_customforward",!0),p(this,"originalCameraNearPlane"),p(this,"_viewerPose"),p(this,"_transformOrientation",new Ce),p(this,"_transformPosition",new S),p(this,"_transition");var s,o;performance.mark(HH),Xde(n,r.init),this.session=e,this.mode=n,this.context=i,(tr||te("console"))&&$p(!0),this._xr_scripts=[...r.scripts],this._xr_update_scripts=this._xr_scripts.filter(a=>typeof a.onUpdateXR=="function"),this._controllerAdded=r.controller_added,this._controllerRemoved=r.controller_removed,nd(this.onBefore,Xi.LateUpdate),this.context.pre_render_callbacks.push(this.onBeforeRender),this.context.post_render_callbacks.push(this.onAfterRender),((s=r.init.optionalFeatures)!=null&&s.includes("hit-test")||(o=r.init.requiredFeatures)!=null&&o.includes("hit-test"))&&e.requestReferenceSpace("viewer").then(a=>{var l,c;return(c=(l=e.requestHitTestSource)==null?void 0:l.call(e,{space:a}))==null?void 0:c.then(h=>this._viewerHitTestSource=h)}).catch(a=>console.warn(a)),this.context.mainCamera&&(this._originalCameraWorldPosition=kt(this.context.mainCamera,new S),this._originalCameraWorldRotation=Ri(this.context.mainCamera,new Ce),this._originalCameraWorldScale=Qi(this.context.mainCamera,new S),this._originalCameraParent=this.context.mainCamera.parent),this._defaultRig=new Xue,this.context.scene.add(this._defaultRig.gameObject),this.addRig(this._defaultRig);for(let a=0;a<e.inputSources.length;a++){const l=e.inputSources[a];if(!l.handedness){console.warn("Input source in xr session has no handedness - ignoring",a);continue}this.onInputSourceAdded(l)}this.session.addEventListener("end",this.onEnd),this.session.addEventListener("inputsourceschange",a=>{for(const l of a.removed)this.disconnectInputSource(l);for(const l of a.added)this.onInputSourceAdded(l)}),this.context.xr=this,this.context.renderer.xr.setSession(this.session).then(this.onRendererSessionSet),"controllerAutoUpdate"in this.context.renderer.xr?(console.debug("Disabling three.js controllerAutoUpdate"),this.context.renderer.xr.controllerAutoUpdate=!1):tr&&console.warn("controllerAutoUpdate is not available in three.js - cannot disable it")}static getXRSync(n){return this._sync||(this._sync=new NH(n)),this._sync}static get currentSessionRequest(){return this._currentSessionRequestMode}static get active(){return this._activeSession}static get activeMode(){var n;return((n=this._activeSession)==null?void 0:n.mode)??null}static get xrSystem(){return"xr"in navigator?navigator.xr:void 0}static isXRSupported(){return Promise.all([this.isVRSupported(),this.isARSupported()]).then(n=>n.some(e=>e)).catch(()=>!1)}static isVRSupported(){return this.isSessionSupported("immersive-vr")}static isARSupported(){return this.isSessionSupported("immersive-ar")}static isSessionSupported(n){var e;return((e=this.xrSystem)==null?void 0:e.isSessionSupported(n).catch(i=>(tr&&console.error(i),!1)))??Promise.resolve(!1)}static onSessionRequestStart(n){this._sessionRequestStartListeners.push(n)}static offSessionRequestStart(n){const e=this._sessionRequestStartListeners.indexOf(n);e>=0&&this._sessionRequestStartListeners.splice(e,1)}static onSessionRequestEnd(n){this._sessionRequestEndListeners.push(n)}static offSessionRequestEnd(n){const e=this._sessionRequestEndListeners.indexOf(n);e>=0&&this._sessionRequestEndListeners.splice(e,1)}static onXRSessionStart(n){this._xrStartListeners.push(n)}static offXRSessionStart(n){const e=this._xrStartListeners.indexOf(n);e>=0&&this._xrStartListeners.splice(e,1)}static onXRSessionEnd(n){this._xrEndListeners.push(n)}static offXRSessionEnd(n){const e=this._xrEndListeners.indexOf(n);e>=0&&this._xrEndListeners.splice(e,1)}static onControllerAdded(n){this._controllerAddedListeners.push(n)}static offControllerAdded(n){const e=this._controllerAddedListeners.indexOf(n);e>=0&&this._controllerAddedListeners.splice(e,1)}static onControllerRemoved(n){this._controllerRemovedListeners.push(n)}static offControllerRemoved(n){const e=this._controllerRemovedListeners.indexOf(n);e>=0&&this._controllerRemovedListeners.splice(e,1)}static offerSession(n,e,i){return"xr"in navigator&&navigator.xr&&"offerSession"in navigator.xr?(typeof navigator.xr.offerSession=="function"&&(console.log("WebXR offerSession is available - requesting mode: "+n),e=="default"&&(e=this.getDefaultSessionInit(n)),navigator.xr.offerSession(n,{...e}).then(r=>od.setSession(n,r,e,i)).catch(r=>{console.log("XRSession offer rejected (perhaps because another call to offerSession was made or a call to requestSession was made)")})),!0):!1}static getDefaultSessionInit(n){switch(n){case"immersive-ar":return{optionalFeatures:["anchors","local-floor","hand-tracking","layers","dom-overlay","hit-test","unbounded"]};case"immersive-vr":return{optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};default:return console.warn("No default session init for mode",n),{}}}static async start(n,e,i){var r,s,o,a;if(it()&&te("debugxrpreroom"))return console.warn("Debug: Starting temporary XR session"),await r0.start(n,e||od.getDefaultSessionInit(n)),null;if(this._currentSessionRequest)return console.warn("A XRSession is already being requested"),(tr||it())&&Pi("A XRSession is already being requested"),this._currentSessionRequest.then(()=>this._activeSession);if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;if(i||(i=Ot.Current),i||(i=fi.All[0]),!i)throw new Error("No Needle Engine Context found");switch(performance.mark("NeedleXRSession start"),e||(e={}),n){case"immersive-ar":{if(await((r=this.xrSystem)==null?void 0:r.isSessionSupported("immersive-ar"))!==!0)return console.error(n+" is not supported by this browser."),null;const u=this.getDefaultSessionInit(n),d=Qde(i.domElement);d&&!c1()&&(u.domOverlay={root:d},u.optionalFeatures.push("dom-overlay")),e={...u,...e}}break;case"immersive-vr":{if(await((s=this.xrSystem)==null?void 0:s.isSessionSupported("immersive-vr"))!==!0)return console.error(n+" is not supported by this browser."),null;e={...this.getDefaultSessionInit(n),...e}}break;default:console.warn("No default session init for mode",n);break}e.optionalFeatures??(e.optionalFeatures=[]),e.requiredFeatures??(e.requiredFeatures=[]),await r0.stop();const l=n=="immersive-ar"?i.scripts_immersive_ar:i.scripts_immersive_vr;tr?console.log(`%cRequesting ${n} session`,"font-weight:bold;",e,l):console.log(`%cRequesting ${n} session`,"font-weight:bold;");for(const u of l)u.onBeforeXR&&u.onBeforeXR(n,e);for(const u of this._sessionRequestStartListeners)u({mode:n,init:e});tr&&dn("Requesting "+n+" session ("+Date.now()+")"),this._currentSessionRequest=(o=navigator.xr)==null?void 0:o.requestSession(n,e),this._currentSessionRequestMode=n;const c=await((a=this._currentSessionRequest)==null?void 0:a.catch(u=>{console.error(u,"Code: "+u.code),u.code===9&&Pi("Make sure your device has the required permissions (e.g. camera access)"),console.log("If the specified XR configuration is not supported (e.g. entering AR doesnt work) - make sure you access the website on a secure connection (HTTPS) and your device has the required permissions (e.g. camera access)"),location.protocol==="http:"&&Pi("XR requires a secure connection (HTTPS)")}));this._currentSessionRequest=void 0,this._currentSessionRequestMode=null;for(const u of this._sessionRequestEndListeners)u({mode:n,init:e,newSession:c||null});if(!c)return console.warn("XR Session request was rejected"),null;const h=this.setSession(n,c,e,i);return performance.mark("NeedleXRSession end"),performance.measure("NeedleXRSession Startup","NeedleXRSession start","NeedleXRSession end"),h}static setSession(n,e,i,r){if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;const s=n=="immersive-ar"?r.scripts_immersive_ar:r.scripts_immersive_vr;return this._activeSession=new od(n,e,r,{scripts:s,controller_added:this._controllerAddedListeners,controller_removed:this._controllerRemovedListeners,init:i}),e.addEventListener("end",this.onEnd),tr?console.log(`%cStarted ${n} session`,"font-weight:bold;",s):console.log(`%cStarted ${n} session`,"font-weight:bold;"),this._activeSession}static stop(){var n;(n=this._activeSession)==null||n.end()}get sync(){return od._sync}get running(){return!this._ended&&this.session!=null}get interactionMode(){return this.session.interactionMode}get visibilityState(){return this.session.visibilityState}get isVisibleBlurred(){return this.session.visibilityState==="visible-blurred"}get isSystemKeyboardSupported(){return this.session.isSystemKeyboardSupported}get environmentBlendMode(){return this.session.environmentBlendMode}get frame(){return this.context.xrFrame}get leftController(){return this.controllers.find(n=>n.side==="left")}get rightController(){return this.controllers.find(n=>n.side==="right")}getController(n){return typeof n=="number"?this.controllers[n]||null:this.controllers.find(e=>e.side===n)||null}get isPassThrough(){return!!(this.environmentBlendMode!=="opaque"&&this.interactionMode==="world-space"||this.mode==="immersive-ar"&&this.environmentBlendMode!=="opaque"&&this.controllers.some(n=>n.inputSource.targetRayMode==="tracked-pointer")||it()&&gg()&&this.mode==="immersive-ar")}get isAR(){return this.mode==="immersive-ar"}get isVR(){return this.mode==="immersive-vr"}get isScreenBasedAR(){return this.isAR&&!this.isPassThrough}get posePosition(){return this._transformPosition}get poseOrientation(){return this._transformOrientation}get referenceSpace(){return this.context.renderer.xr.getReferenceSpace()}get viewerPose(){return this._viewerPose}get isTrackingImages(){if(this.frame&&"getImageTrackingResults"in this.frame&&typeof this.frame.getImageTrackingResults=="function")try{const n=this.frame.getImageTrackingResults();for(const e of n)if(e.trackingState==="tracked")return!0}catch{return!1}return!1}get rig(){const n=this._rigs[0]??null;return n!=null&&n.gameObject&&Ef(n.gameObject)||n?.isActive===!1?(this.updateActiveXRRig(),this._rigs[0]??null):n}get rigScale(){return this._rigs[0]?(this._lastRigScaleUpdate!==this.context.time.frame&&(this._lastRigScaleUpdate=this.context.time.frame,this._rigScale=this._rigs[0].gameObject.worldScale.x),this._rigScale):1}addRig(n){this._rigs.indexOf(n)>=0||(n.priority===void 0&&(n.priority=0),this._rigs.push(n),this.updateActiveXRRig())}removeRig(n){const e=this._rigs.indexOf(n);e!==-1&&(this._rigs.splice(e,1),this.updateActiveXRRig())}setRigActive(n){const e=this._rigs.indexOf(n);this._rigs.splice(e,1),this._rigs.unshift(n),this.updateActiveXRRig()}getUserOffsetInRig(){var n;const e=(n=this.context.mainCamera)==null?void 0:n.position;if(!e||!this.rig)return bt(0,0,0);const i=bt(e);return i.x*=-1,i.z*=-1,i.applyQuaternion(ic(this.rig.gameObject.quaternion)),i}updateActiveXRRig(){const n=this._rigs[0]??null;this._defaultRig.gameObject.parent!==this.context.scene&&this.context.scene.add(this._defaultRig.gameObject),this._defaultRig.gameObject.visible=!0,this._rigs.includes(this._defaultRig)||this._rigs.push(this._defaultRig);let e=this._rigs[0];e&&e.priority===void 0&&(e.priority=0);for(let i=1;i<this._rigs.length;i++){const r=this._rigs[i];if(r.isActive){if(Ef(r.gameObject)){this._rigs.splice(i,1),i--;continue}(!e||e.isActive===!1||r.priority!==void 0&&r.priority>e.priority)&&(e=r)}}if(n!==e){const i=this._rigs.indexOf(e);i>=0&&this._rigs.splice(i,1),this._rigs.unshift(e)}tr&&(n===e?console.log("Updated Active XR Rig:",e,"prev:",n):console.log("Updated Active XRRig:",e," (the same as before)"))}getHitTest(n){if(n)return this.getControllerHitTest(n);if(!this._viewerHitTestSource)return null;const e=this._viewerHitTestSource,i=this.frame.getHitTestResults(e);if(i.length>0){const r=i[0];return this.convertHitTestResult(r)}return null}getControllerHitTest(n){const e=n.getHitTestSource();if(!e)return null;const i=this.frame.getHitTestResultsForTransientInput(e);for(const r of i)if(r.inputSource===n.inputSource)for(const s of r.results)return this.convertHitTestResult(s);return null}convertHitTestResult(n){const e=this.context.renderer.xr.getReferenceSpace(),i=e&&n.getPose(e);if(i){const r=bt(i.transform.position),s=ic(i.transform.orientation),o=this.context.mainCamera;if(o?.parent!==this._cameraRenderParent&&r.applyMatrix4(t0),o!=null&&o.parent){r.applyMatrix4(o.parent.matrixWorld),s.multiply(lc);const a=Ri(o.parent);a.premultiply(lc),s.premultiply(a)}return{hit:n,position:r,quaternion:s}}return null}convertSpace(n){const e=bt(n.position);e.applyMatrix4(t0);const i=ic(n.orientation);return i.premultiply(lc),{position:e,quaternion:i}}disconnectInputSource(n){const e=(i,r,s)=>{if(i.inputSource===n){tr&&console.log("Disconnecting controller",i.index),this.controllers.splice(s,1),this.invokeControllerEvent(i,this._controllerRemoved,"removed");const o={xr:this,controller:i,change:"removed"};for(const a of this._xr_scripts)a.onXRControllerRemoved&&a.onXRControllerRemoved(o);i.onDisconnected()}};for(let i=this.controllers.length-1;i>=0;i--){const r=this.controllers[i];e(r,this.controllers,i)}for(let i=this._newControllers.length-1;i>=0;i--){const r=this._newControllers[i];e(r,this._newControllers,i)}}end(){this._ended||this.session.end().catch(n=>console.warn(n))}onRenderDebug(){if(tr)for(const n of this.controllers)n.onRenderDebug();if((tr||QH)&&this.rig&&(dk++,dk>=20)){const n=this.rig.gameObject.worldPosition,e=this.rig.gameObject.worldForward;n.add(e.multiplyScalar(1.5));const i=this.rig.gameObject.worldUp;n.add(i.multiplyScalar(2.5));let r="";if(r+=`${this.context.time.smoothedFps.toFixed(0)} FPS`,r+=`, calls: ${this.context.renderer.info.render.calls}, tris: ${this.context.renderer.info.render.triangles.toLocaleString()}`,tr||QH)for(const s of this.controllers)r+=`
${s.hand?"hand":"ctrl"} ${s.inputSource.handedness}[${s.index}] con:${s.connected} tr:${s.isTracking} hts:${s.hasHitTestSource?"yes":"no"}`;dk=0,yt.DrawLabel(n,r,void 0,1/60*20)}}addScript(n){return this._xr_scripts.includes(n)?!1:(tr&&console.log("Register new XRScript",n),this._xr_scripts.push(n),typeof n.onUpdateXR=="function"&&this._xr_update_scripts.push(n),!0)}markInactive(n){if(!(this._inactive_scripts.indexOf(n)>=0)){this.removeScript(n,!1),this._inactive_scripts.push(n);for(const e of this.controllers)this.invokeCallback_ControllerRemoved(n,e);this.invokeCallback_LeaveXR(n)}}handleInactiveScripts(){if(this._inactive_scripts.length>0)for(let n=this._inactive_scripts.length-1;n>=0;n--){const e=this._inactive_scripts[n];if(e.activeAndEnabled){this._inactive_scripts.splice(n,1),this.addScript(e),this.invokeCallback_EnterXR(e);for(const i of this.controllers)this.invokeCallback_ControllerAdded(e,i)}}}removeScript(n,e=!0){tr&&console.log("Remove XRScript",n);const i=this._xr_scripts.indexOf(n);i>=0&&this._xr_scripts.splice(i,1);const r=this._xr_update_scripts.indexOf(n);if(r>=0&&this._xr_update_scripts.splice(r,1),e){const s=this._inactive_scripts.indexOf(n);s>=0&&this._inactive_scripts.splice(s,1)}}invokeCallback_EnterXR(n){n.onEnterXR&&n.onEnterXR({xr:this})}invokeCallback_ControllerAdded(n,e){n.onXRControllerAdded&&n.onXRControllerAdded({xr:this,controller:e,change:"added"})}invokeCallback_ControllerRemoved(n,e){n.onXRControllerRemoved&&n.onXRControllerRemoved({xr:this,controller:e,change:"removed"})}invokeCallback_LeaveXR(n){n.onLeaveXR&&!n.destroyed&&n.onLeaveXR({xr:this})}syncCameraCullingMask(){var n;const e=this.context.xrCamera,i=(n=this.context.mainCameraComponent)==null?void 0:n.cullingMask;if(e&&i!==void 0){for(const r of e.cameras)r.layers.mask=i;e.layers.mask=i}else if(e){for(const r of e.cameras)r.layers.enableAll();e.layers.enableAll()}}invokeControllerEvent(n,e,i){for(let r=e.length-1;r>=0;r--){const s=e[r];if(s)try{s({xr:this,controller:n,change:i})}catch(o){console.error(o)}}}applyCustomForward(){var n;if(this.context.mainCamera&&this._customforward){this._camera=this.context.mainCamera,this._camera.parent!==this._cameraRenderParent&&(this._previousCameraParent=this._camera.parent,(n=this._previousCameraParent)==null||n.add(this._cameraRenderParent)),this._cameraRenderParent.name="XR Camera Render Parent",this._cameraRenderParent.add(this._camera);let e=.02;if(this.rig){const i=Qi(this.rig.gameObject);e*=i.x}this._camera instanceof Ft&&this._camera.near>e&&(this.originalCameraNearPlane=this._camera.near,this._camera.near=e)}}revertCustomForward(){this._camera&&this._previousCameraParent&&this._previousCameraParent.add(this._camera),this._previousCameraParent=null,this._camera instanceof Ft&&this.originalCameraNearPlane!=null&&(this._camera.near=this.originalCameraNearPlane)}internalUpdateState(){const n=this.context.renderer.xr.getReferenceSpace();if(!n){this._viewerPose=void 0;return}if(this._viewerPose=this.frame.getViewerPose(n),this._viewerPose){const e=this._viewerPose.transform;this._transformPosition.set(e.position.x,e.position.y,e.position.z),this._transformOrientation.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w)}}get transition(){return this._transition||(this._transition=new zH),this._transition}fadeTransition(){return this._transition||(this._transition=new zH),this._transition.fadeTransition()}updateFade(n){this._transition&&n instanceof Ft&&this._transition.update(n,this.context.time.deltaTime)}onUpdateFade_PostRender(){var n;(n=this._transition)==null||n.remove()}};let Et=od;p(Et,"_sync",null),p(Et,"_currentSessionRequestMode",null),p(Et,"_currentSessionRequest"),p(Et,"_activeSession"),p(Et,"_sessionRequestStartListeners",[]),p(Et,"_sessionRequestEndListeners",[]),p(Et,"_xrStartListeners",[]),p(Et,"_xrEndListeners",[]),p(Et,"_controllerAddedListeners",[]),p(Et,"_controllerRemovedListeners",[]),p(Et,"onEnd",()=>{tr&&console.log("XR Session ended"),od._activeSession=null});const fk=te("debugwebxr");class XH{static tryFindAvatarObjects(e,i,r){if(r.head&&r.leftHand&&r.rightHand)return;const s=e.name.toLocaleLowerCase();!r.head&&s.includes("head")&&(fk&&console.log("FOUND AVATAR HEAD",e.name),r.head=new $t("",i,e)),s.includes("hand")&&(!r.leftHand&&s.includes("left")&&(fk&&console.log("FOUND AVATAR LEFT HAND",e.name),r.leftHand=new $t("",i,e)),!r.rightHand&&s.includes("right")&&(fk&&console.log("FOUND AVATAR RIGHT HAND",e.name),r.rightHand=new $t("",i,e)));for(let o=0;o<e.children.length;o++){if(r.head&&r.leftHand&&r.rightHand)return;const a=e.children[o];this.tryFindAvatarObjects(a,i,r)}}}const Ls=new S,qH=new S,YH=new Ce,Jde=te("debuggizmos"),Ml=8947848,mk=32,Tl=class{constructor(){}static isGizmo(n){return n[vk]!==void 0}static DrawLabel(n,e,i=.05,r=0,s,o,a){var l;if(!Tl.enabled)return null;s||(s=Ml);const c=((l=Et.active)==null?void 0:l.rigScale)??1,h=tn.getTextLabel(r,e,i*c,s,o);return a instanceof ve&&a.add(h),h.position.x=n.x,h.position.y=n.y,h.position.z=n.z,h}static DrawRay(n,e,i=Ml,r=0,s=!0){if(!Tl.enabled)return;const o=tn.getLine(r),a=o.geometry.getAttribute("position");a.setXYZ(0,n.x,n.y,n.z),Ls.set(e.x,e.y,e.z).multiplyScalar(999999999),a.setXYZ(1,n.x+Ls.x,n.y+Ls.y,n.z+Ls.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=s,o.material.depthWrite=!1}static DrawDirection(n,e,i=Ml,r=0,s=!0,o=1){if(!Tl.enabled)return;const a=tn.getLine(r),l=a.geometry.getAttribute("position");l.setXYZ(0,n.x,n.y,n.z),e.w!==void 0?(Ls.set(0,0,-o),YH.set(e.x,e.y,e.z,e.w),Ls.applyQuaternion(YH)):(Ls.set(e.x,e.y,e.z),Ls.multiplyScalar(o)),l.setXYZ(1,n.x+Ls.x,n.y+Ls.y,n.z+Ls.z),l.needsUpdate=!0,a.material.color.set(i),a.material.depthTest=s,a.material.depthWrite=!1}static DrawLine(n,e,i=Ml,r=0,s=!0){if(!Tl.enabled)return;const o=tn.getLine(r),a=o.geometry.getAttribute("position");a.setXYZ(0,n.x,n.y,n.z),a.setXYZ(1,e.x,e.y,e.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=s,o.material.depthWrite=!1,o.material.fog=!1}static DrawCircle(n,e,i,r=Ml,s=0,o=!0){if(!Tl.enabled)return;const a=tn.getCircle(s);a.position.set(n.x,n.y,n.z),a.scale.set(i,i,i),a.quaternion.setFromUnitVectors(this._up,Ls.set(e.x,e.y,e.z).normalize()),a.material.color.set(r),a.material.depthTest=o,a.material.depthWrite=!1,a.material.fog=!1}static DrawWireSphere(n,e,i=Ml,r=0,s=!0){if(!Tl.enabled)return;const o=tn.getSphere(e,r,!0);Kp(o,n.x,n.y,n.z),o.material.color.set(i),o.material.depthTest=s,o.material.depthWrite=!1,o.material.fog=!1}static DrawSphere(n,e,i=Ml,r=0,s=!0){if(!Tl.enabled)return;const o=tn.getSphere(e,r,!1);Kp(o,n.x,n.y,n.z),o.material.color.set(i),o.material.depthTest=s,o.material.depthWrite=!1}static DrawWireBox(n,e,i=Ml,r=0,s=!0){if(!Tl.enabled)return;const o=tn.getBox(r);o.position.set(n.x,n.y,n.z),o.scale.set(e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=s,o.material.wireframe=!0,o.material.depthWrite=!1,o.material.fog=!1}static DrawWireBox3(n,e=Ml,i=0,r=!0){if(!Tl.enabled)return;const s=tn.getBox(i);s.position.copy(n.getCenter(Ls)),s.scale.copy(n.getSize(Ls)),s.material.color.set(e),s.material.depthTest=r,s.material.wireframe=!0,s.material.depthWrite=!1,s.material.fog=!1}static DrawArrow(n,e,i=Ml,r=0,s=!0,o=!1){if(!Tl.enabled)return;const a=tn.getArrowHead(r);a.position.set(e.x,e.y,e.z),a.quaternion.setFromUnitVectors(this._up.set(0,1,0),Ls.set(e.x,e.y,e.z).sub(qH.set(n.x,n.y,n.z)).normalize());const l=Ls.set(e.x,e.y,e.z).sub(qH.set(n.x,n.y,n.z)).length()*.1;a.scale.set(l,l,l),a.material.color.set(i),a.material.depthTest=s,a.material.wireframe=o,this.DrawLine(n,e,i,r,s)}static DrawWireMesh(n){const e=tn.getMesh(n.duration??0);"mesh"in n?(e.geometry=n.mesh.geometry,e.matrix.copy(n.mesh.matrixWorld)):(e.geometry=n.geometry,e.matrix.copy(n.matrix)),e.matrixAutoUpdate=!1,e.matrixWorldAutoUpdate=!1,e.material.color.set(n.color??Ml),e.material.depthTest=n.depthTest??!0,e.material.wireframe=!0}static setVisible(n){for(const e of tn.timedObjectsBuffer)e.visible=n}};let yt=Tl;p(yt,"enabled",!0),p(yt,"_up",new S(0,1,0));const Kde=new Ki(1,1,1);function gk(n=null){const e=new be(n??14540253),i=new UR(Kde);return new Is(i,new zi({color:e}))}const vk=Symbol("GizmoCache");class tn{static ensureFont(){let e=ji.FontLibrary.getFontFamily(this.familyName);if(!e){e=ji.FontLibrary.addFontFamily(this.familyName);const i=e.addVariant("normal","normal","https://uploads.needle.tools/include/font-msdf.json","https://uploads.needle.tools/include/font.png");i?.addEventListener("ready",()=>{ji.update()})}}static getTextLabel(e,i,r,s,o){this.ensureFont();let a=this.textLabelCache.pop(),l=1;o&&typeof o=="string"&&o?.length>=8&&o.startsWith("#")?(l=parseInt(o.substring(7),16)/255,o=o.substring(0,7),Jde&&console.log(o,l)):typeof o=="object"&&o.a!==void 0&&(l=o.a);const c={boxSizing:"border-box",fontFamily:this.familyName,width:"auto",fontSize:r,color:s,lineHeight:1,backgroundColor:o??void 0,backgroundOpacity:l,textContent:i,borderRadius:.5*r,padding:.8*r,whiteSpace:"pre"};if(a)a.set(c);else{a=new J2(c);const h=this,u=a;u.setText=function(d){this.set({textContent:d}),h.tmuiNeedsUpdate=!0}}return this.tmuiNeedsUpdate=!0,this.registerTimedObject(Ot.Current,a,e,this.textLabelCache),a}static getBox(e){let i=this.boxesCache.pop();if(!i){const r=new Ki(1,1,1);i=new pe(r)}return this.registerTimedObject(Ot.Current,i,e,this.boxesCache),i}static getLine(e){let i=this.linesCache.pop();if(!i){i=new hn;let r=i.geometry.getAttribute("position");r||(r=new Ye(new Float32Array(2*3),3),i.geometry.setAttribute("position",r))}return i.frustumCulled=!1,this.registerTimedObject(Ot.Current,i,e,this.linesCache),i}static getCircle(e){let i=this.circlesCache.pop();if(!i){i=new hn;let r=i.geometry.getAttribute("position");if(!r){r=new Ye(new Float32Array(mk*3),3),i.geometry.setAttribute("position",r);const s=bt(0,1,0),o=bt(0,0,1),a=bt(o);a.cross(s).normalize();const l=bt(a),c=Math.PI*2/(mk-1);for(let h=0;h<mk+1;h++){const u=c*h;s.copy(l).multiplyScalar(Math.cos(u)*1),a.copy(o).multiplyScalar(Math.sin(u)*1);const d=s.add(a);r.setXYZ(h,d.x,d.y,d.z)}}}return i.frustumCulled=!1,this.registerTimedObject(Ot.Current,i,e,this.circlesCache),i}static getSphere(e,i,r){let s=this.spheresCache.pop();return s||(s=new pe(new tl(1,8,8))),s.scale.set(e,e,e),s.material.wireframe=r,this.registerTimedObject(Ot.Current,s,i,this.spheresCache),s}static getArrowHead(e){let i=this.arrowHeadsCache.pop();return i||(i=new pe(new Wn(0,.5,1,8))),this.registerTimedObject(Ot.Current,i,e,this.arrowHeadsCache),i}static getMesh(e){let i=this.mesh.pop();return i||(i=new pe,i.material=new Jt),this.registerTimedObject(Ot.Current,i,e,this.mesh),i}static registerTimedObject(e,i,r,s){if(!e){console.error("No Needle Engine context available. Did you call a Gizmos function in global scope?");return}const o=this.contextBeforeRenderCallbacks.get(e),a=this.contextPostRenderCallbacks.get(e);if(o){if(e.pre_render_callbacks[e.pre_render_callbacks.length-1]!==o){const l=e.pre_render_callbacks.indexOf(o);l>=0&&e.pre_render_callbacks.splice(l,1),e.pre_render_callbacks.push(o)}}else{const l=()=>{this.onBeforeRender(e,this.timedObjectsBuffer)};this.contextBeforeRenderCallbacks.set(e,l),e.pre_render_callbacks.push(l)}if(a){if(e.post_render_callbacks[e.post_render_callbacks.length-1]!==a){const l=e.post_render_callbacks.indexOf(a);l>=0&&e.post_render_callbacks.splice(l,1),e.post_render_callbacks.push(a)}}else{const l=()=>{this.onPostRender(e,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(e,l),e.post_render_callbacks.push(l)}i.traverse(l=>{l.layers.disableAll(),l.layers.enable(2)}),i.renderOrder=999999,i[vk]=s,i.castShadow=!1,i.receiveShadow=!1,i.isGizmo=!0,this.timedObjectsBuffer.push(i),r<=0&&e.currentFrameEvent>=Xi.OnBeforeRender?this.timesBuffer.push(0):this.timesBuffer.push(Ot.Current.time.realtimeSinceStartup+r),e.scene.add(i)}static onBeforeRender(e,i){this.tmuiNeedsUpdate&&(this.tmuiNeedsUpdate=!1,ji.update());for(let r=0;r<i.length;r++){const s=i[r];if(e.mainCamera&&s instanceof ji.MeshUIBaseElement){if(Ef(s))continue;const o=e.isInVR,a=!1,l=!o;Hy(s,e.mainCamera,a,l)}}}static onPostRender(e,i,r){const s=e.time.realtimeSinceStartup;for(let o=i.length-1;o>=0;o--){const a=i[o];s>r[o]&&(i.splice(o,1),r.splice(o,1),a.removeFromParent(),Ef(a)!=!0&&a[vk].push(a))}}}p(tn,"familyName","needle-gizmos"),p(tn,"linesCache",[]),p(tn,"circlesCache",[]),p(tn,"spheresCache",[]),p(tn,"boxesCache",[]),p(tn,"arrowHeadsCache",[]),p(tn,"mesh",[]),p(tn,"textLabelCache",[]),p(tn,"timedObjectsBuffer",new Array),p(tn,"timesBuffer",new Array),p(tn,"contextPostRenderCallbacks",new Map),p(tn,"contextBeforeRenderCallbacks",new Map),p(tn,"tmuiNeedsUpdate",!1);const ad=te("debugphysics"),JH=new Cs;class dc{constructor(){p(this,"ray"),p(this,"cam"),p(this,"screenPoint"),p(this,"raycaster"),p(this,"results"),p(this,"targets"),p(this,"recursive",!0),p(this,"minDistance"),p(this,"maxDistance"),p(this,"lineThreshold"),p(this,"layerMask"),p(this,"ignore"),p(this,"testObject"),p(this,"useAcceleratedRaycast")}screenPointFromOffset(e,i){this.screenPoint===void 0&&(this.screenPoint=new J),this.screenPoint.x=e/window.innerWidth*2-1,this.screenPoint.y=-(i/window.innerHeight)*2+1}setLayer(e){JH.set(e),this.layerMask=JH}setMask(e){this.layerMask||(this.layerMask=new Cs);const i=this.layerMask;i?i.mask=e:this.layerMask=e}}p(dc,"AllLayers",4294967295);class yk{constructor(e,i,r){p(this,"distance"),p(this,"point"),p(this,"object"),this.object=e,this.distance=i,this.point=r}}const Ak=class{constructor(n){p(this,"context"),p(this,"engine"),p(this,"raycaster",new ku),p(this,"defaultRaycastOptions",new dc),p(this,"targetBuffer",new Array(1)),p(this,"defaultThresholds",{Mesh:{},Line:{threshold:-1},LOD:{},Points:{threshold:0},Sprite:{}}),p(this,"sphereResults",new Array),p(this,"sphereMask",new Cs),p(this,"sphere",new Zi),p(this,"tempBoundingBox",new Ht),this.context=n}static get raycasting(){return this._raycasting>0}raycastPhysicsFast(n,e=void 0,i=1/0,r=!0){var s;return((s=this.context.physics.engine)==null?void 0:s.raycast(n,e,{maxDistance:i,solid:r}))??null}raycastPhysicsFastAndGetNormal(n,e=void 0,i=1/0,r=!0){var s;return((s=this.context.physics.engine)==null?void 0:s.raycastAndGetNormal(n,e,{maxDistance:i,solid:r}))??null}sphereOverlapPhysics(n,e){var i;return((i=this.context.physics.engine)==null?void 0:i.sphereOverlap(n,e))??null}sphereOverlap(n,e,i=!0,r=!1,s=null){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const o=this.sphereMask;o.enableAll(),o.disable(2);for(const a of this.context.scene.children)this.intersectSphere(a,n,e,o,this.sphereResults,i,r,s);return this.sphereResults.sort((a,l)=>a.distance-l.distance)}raycastFromRay(n,e=null){const i=e??this.defaultRaycastOptions;i.ray=n;const r=this.raycast(i);return i===this.defaultRaycastOptions&&(i.ray=void 0),r}raycast(n=null){ad&&performance.mark("raycast.start"),n||(n=this.defaultRaycastOptions);const e=n.screenPoint??this.context.input.mousePositionRC,i=n.raycaster??this.raycaster;if(i.near=n.minDistance??0,i.far=n.maxDistance??1/0,i.params=this.defaultThresholds,n.lineThreshold===void 0&&(n.lineThreshold=-1),i.params.Line={threshold:n.lineThreshold},n.ray)i.ray.copy(n.ray);else{const a=n.cam??this.context.mainCamera;if(!a)return ad&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];const l=this.context.xrCamera;this.context.isInXR&&l instanceof pR&&l.cameras.length>0?i.setFromCamera(e,l.cameras[0]):i.setFromCamera(e,a)}let r=n.targets;r||(r=this.targetBuffer,r.length=1,r[0]=this.context.scene);let s=n.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),s||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),s=this.defaultRaycastOptions.results),n.layerMask!==void 0?n.layerMask instanceof Cs?i.layers.mask=n.layerMask.mask:i.layers.mask=n.layerMask:(i.layers.enableAll(),i.layers.disable(2)),ad&&(yt.DrawRay(i.ray.origin,i.ray.direction,16711680,2),console.time("raycast")),s.length=0,Ak._raycasting++,this.intersect(this.raycaster,r,s,n),s.sort((a,l)=>a.distance-l.distance);const o=n.ignore;return o!==void 0&&o.length>0&&(s=s.filter(a=>!o.includes(a.object))),Ak._raycasting--,ad&&(console.timeEnd("raycast"),console.warn("#"+this.context.time.frame+", hits:",s!=null&&s.length?[...s]:"nothing"),performance.mark("raycast.end"),performance.measure("raycast","raycast.start","raycast.end")),s}intersect(n,e,i,r){var s,o,a;for(const l of e){if(!l||l.visible===!1||yt.isGizmo(l)||r.lineThreshold!==void 0&&r.lineThreshold<0&&l instanceof hn)continue;const c=(s=r.testObject)==null?void 0:s.call(r,l);if(c!==!1){if(c!=="continue in children"){const h=l,u=h.geometry;if(u){const d=xA(l);d&&(h.geometry=d);const f=i.length;let m=!0;r.precise===!1&&(m=!1),m||(m=((a=(o=u.getAttribute("position"))==null?void 0:o.array)==null?void 0:a.length)<64),h instanceof Ag&&(m=!1),!m&&$de(h,n,i)||(r.useAcceleratedRaycast!==!1?VS.runMeshBVHRaycast(n,h,i,this.context):n.intersectObject(l,!1,i)),ad&&i.length!=f&&yt.DrawWireMesh({mesh:l,depthTest:!1,duration:.2,color:d?8969557:7798784}),h.geometry=u}}r.recursive!==!1&&this.intersect(n,l.children,i,r)}}return i}intersectSphere(n,e,i,r,s,o,a,l){let c=n&&n.isMesh&&n.layers.test(r)&&!yt.isGizmo(n);if(c&&(c=n.visible),c&&(c=!(n instanceof hn)),c&&(c=!(n instanceof Ag)),l){const h=l(n);if(h===!1||h!=="continue in children")return}if(c){const h=n,u=h.geometry;if(u){if(a){const d=this.sphere;d.center.copy(e),d.radius=i;const f=s.length;if(VS.runMeshBVHRaycast(this.sphere,h,s,this.context),f!=s.length&&!o)return}else if(u.boundingBox||u.computeBoundingBox(),u.boundingBox){h.matrixWorldNeedsUpdate&&h.updateWorldMatrix(!1,!1);const d=this.tempBoundingBox.copy(u.boundingBox).applyMatrix4(h.matrixWorld),f=this.sphere;if(f.center.copy(e),f.radius=i,f.intersectsBox(d)){const m=kt(n),g=m.distanceTo(f.center),v=new yk(n,g,m);if(s.push(v),!o)return}}}}if(n.children)for(const h of n.children){const u=s.length;if(this.intersectSphere(h,e,i,r,s,o,a,l),u!=s.length&&!o)return}}};let GS=Ak;p(GS,"_raycasting",0);const Af=new Zi,HS=new dr,Zde=new Lt;function $de(n,e,i){const r=n._computeIntersections;if(!r)return!1;let s=n["_computeIntersections:Needle"];return s||(s=n["_computeIntersections:Needle"]=function(o,a,l){const c=this,h=c.geometry.boundingSphere;if(h){if(c instanceof Ag){HS.setFromNormalAndCoplanarPoint(bt(0,1,0),bt(0,-c.position.y,0)),HS.applyMatrix4(c.matrixWorld,Zde);const d=o.ray.intersectPlane(HS,bt());if(d){Af.copy(h),Af.applyMatrix4(c.matrixWorld);const f=bt(d).sub(o.ray.origin).length(),m=Af.radius*.5;f<m&&a.push({distance:f,point:d,object:c,normal:HS.normal.clone()})}return}Af.copy(h),Af.applyMatrix4(c.matrixWorld);const u=o.ray.intersectSphere(Af,bt());if(u){const d=bt(u).sub(o.ray.origin),f=d.length();if(f>Af.radius){const m=d.clone().normalize();a.push({distance:f,point:u,object:c,normal:m})}}}}),n._computeIntersections=s,e.intersectObject(n,!1,i),n._computeIntersections=r,!0}var VS;(n=>{function e(A,b,x,_){var w,T,M;if(!b.geometry||!b.geometry.hasAttribute("position"))return!1;const R=b.geometry;if(b!=null&&b.isSkinnedMesh){const B=b,E=B.bvhNeedsUpdate;if(!B.staticGenerator)l(),o&&(B.staticGenerator=new o(b),B.staticGenerator.applyWorldTransforms=!1,B.staticGeometry=B.staticGenerator.generate(),R.boundsTree=a?.call(B.staticGeometry),B.staticGeometryLastUpdate=performance.now()+Math.random()*200,B.autoUpdateMeshBVH===void 0&&(B.autoUpdateMeshBVH=!1));else if(R.boundsTree&&(B.autoUpdateMeshBVH===!0||E===!0)){const P=performance.now(),O=P-B.staticGeometryLastUpdate;(E||O>100)&&(B.bvhNeedsUpdate=!1,B.staticGeometryLastUpdate=P,(w=B.staticGenerator)==null||w.generate(B.staticGeometry),R.boundsTree.refit())}}else if(!R.boundsTree){h||y();let B=!0;if((_.xr||R[m]===!1||(T=R.getAttribute("position"))!=null&&T.isInterleavedBufferAttribute||R.index&&(M=R.index)!=null&&M.isInterleavedBufferAttribute)&&(B=!1),B&&d){if(R[f]===void 0){let E=null;if(v.length>0){const P=v.shift();P&&!P.running&&(E=P)}else g.length<1&&(E=new d,g.push(E));E!=null&&!E.running?(R[f]="queued",performance.mark("bvh.create.start"),E.generate(R).then(P=>{R[f]="done",R.boundsTree=P}).catch(P=>{R[f]="failed - "+P?.message,R[m]=!1}).finally(()=>{v.push(E),performance.mark("bvh.create.end"),performance.measure("bvh.create (worker)","bvh.create.start","bvh.create.end")})):ad&&console.warn("No worker available")}}else(!u||!B)&&(l(),s&&(performance.mark("bvh.create.start"),R.boundsTree=new s(R),performance.mark("bvh.create.end"),performance.measure("bvh.create","bvh.create.start","bvh.create.end")))}if(A instanceof ku){const B=A,E=b.raycast;r&&R.boundsTree&&(b.acceleratedRaycast||(b.acceleratedRaycast=r.bind(b)),b.raycast=b.acceleratedRaycast);const P=B.firstHitOnly;return B.firstHitOnly=!1,B.intersectObject(b,!1,x),B.firstHitOnly=P,b.raycast=E,!0}else if(A instanceof Zi){const B=R.boundsTree;if(B){const E=A;if(c.copy(b.matrixWorld).invert(),E.applyMatrix4(c),B.intersectsSphere(E)){const P=kt(b),O=P.distanceTo(E.center),N=new yk(b,O,P);x.push(N)}}return!0}return!1}n.runMeshBVHRaycast=e;let i=!1,r=null,s=null,o=null,a=null;function l(){i||(i=!0,Promise.resolve().then(()=>qCe).then(A=>{r=A.acceleratedRaycast,s=A.MeshBVH,o=A.StaticGeometryGenerator,a=A.computeBoundsTree}).catch(A=>{(ad||it())&&console.warn("Failed to load mesh bvh library")}))}const c=new he;let h=!1,u=!1,d=null;const f=Symbol("Needle:MeshBVH-Worker"),m=Symbol("Needle:MeshBVH-CanUseWorker"),g=[],v=[];function y(){h=!0,u=!0,Promise.resolve().then(()=>ZCe).then(A=>{d=A.GenerateMeshBVHWorker}).catch(A=>{(ad||it())&&console.warn("Failed to setup mesh bvh worker")}).finally(()=>{u=!1})}})(VS||(VS={}));const KH=Symbol("gltf-loader-internal-usage-tracker"),epe=te("debugusers"),QS=class{constructor(n){p(this,"parser"),p(this,"_getDependency"),p(this,"_loadingId"),p(this,"_loadedObjects",new Set),this.parser=n,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(n){return QS._loadingProcesses>0}beforeRoot(){QS._loadingProcesses++;const n=this,e=this._getDependency;return this.parser.getDependency=function(i,r){const s=e.call(this,i,r);return s.then(o=>(o&&(n._loadedObjects.add(o),o[KH]=n._loadingId),o)),s},null}afterRoot(n){QS._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const e of this._loadedObjects)delete e[KH],e instanceof ve&&(e.parent||e instanceof pe&&setTimeout(()=>{epe&&console.warn("> GLTF LOADER: Mesh not used in scene!",e),e.material=null,e.geometry=null},1e3));return null}};let bk=QS;p(bk,"_loadingProcesses",0);class ZH{constructor(){window.addEventListener("unhandledrejection",e=>{var i;if(e.defaultPrevented)return;const r=(i=e?.reason)==null?void 0:i.path;if(r){const s=r[0];s&&s.tagName==="IMG"&&(console.warn(`Could not load image:
`+s.src),e.preventDefault())}})}}const WS=te("trackresources");function $H(){return WS==="dispose"}let bf=!0;WS===0&&(bf=!1);function tpe(n){bf=n}function e8(){return bf}const t8=Symbol("disposable");function xk(n,e){n&&(n[t8]=e,xf&&console.warn("Set disposable",e,n))}const i8=Symbol("disposed");function ipe(n){return n[i8]===!0}function Wi(n){var e;if(n){if(n[t8]===!1){xf&&console.warn("Object is marked as not disposable",n);return}if(n[i8]=!0,n instanceof Er)Wi(n.environment),Wi(n.background),Wi(n.customDepthMaterial),Wi(n.customDistanceMaterial);else if(n instanceof wo)Wi(n.geometry),Wi(n.material),Wi(n.skeleton),Wi(n.bindMatrix),Wi(n.bindMatrixInverse),Wi(n.customDepthMaterial),Wi(n.customDistanceMaterial),n.geometry=null,n.material=null;else if(n instanceof pe)Wi(n.geometry),Wi(n.material),Wi(n.customDepthMaterial),Wi(n.customDistanceMaterial),n.geometry=null,n.material=null;else if(n instanceof dt){s0(n);for(const i of Object.keys(n.attributes)){const r=n.attributes[i];Wi(r)}}else if(n instanceof Ye||n instanceof Go)xf&&console.warn("BufferAttribute dispose not supported",n.count);else if(n instanceof Array)for(const i of n)i instanceof Ut&&Wi(i);else if(n instanceof Ut){s0(n);for(const r of Object.keys(n)){const s=n[r];s instanceof Gt&&(Wi(s),n[r]=null)}const i=n.uniforms;if(i)for(const r of Object.keys(i)){const s=i[r];s instanceof Gt?(Wi(s),i[r]=null):s instanceof Se&&(Wi(s.value),s.value=null)}}else n instanceof Gt?(s0(n),s0(n.source),((e=n.source)==null?void 0:e.data)instanceof ImageBitmap&&s0(n.source.data)):n instanceof _y?(s0(n.boneTexture),n.boneTexture=null):n instanceof Dp||!(n instanceof ve)&&xf&&console.warn("Unknown object type",n)}}function s0(n){n&&((xf||$H()||WS)&&console.warn("\u{1F9E8} FREE",n),n instanceof ImageBitmap?n.close():n instanceof th?n.data=null:n.dispose())}function n8(n){(n instanceof pe||n instanceof wo)&&(n.material=null,n.geometry=null)}const npe=new Set;function _k(n,e,i=null,r){if(r||(r=npe,r.clear()),!n)return r;const s=n[LA];if(s)for(const o of s)r.has(o)||i?.call(null,o)!==!1&&(r.add(o),e&&_k(o,!0,i,r));return r}function rpe(n){return n[UA]}const xf=te("debugresourceusers")||te("debugmemory"),LA=Symbol("needle-resource-users"),UA=Symbol("needle-resource-users-count");function oo(n,e){D1(n,e,function(i,r){bf&&!GS.raycasting&&(XS(LA,this,i,!1),XS(LA,this,r,!0))})}bf&&(oo(pe.prototype,"material"),oo(pe.prototype,"geometry"),oo(Ut.prototype,"map"),oo(Ut.prototype,"bumpMap"),oo(Ut.prototype,"alphaMap"),oo(Ut.prototype,"normalMap"),oo(Ut.prototype,"displacementMap"),oo(Ut.prototype,"roughnessMap"),oo(Ut.prototype,"metalnessMap"),oo(Ut.prototype,"emissiveMap"),oo(Ut.prototype,"specularMap"),oo(Ut.prototype,"envMap"),oo(Ut.prototype,"lightMap"),oo(Ut.prototype,"aoMap"),oo(Ut.prototype,"gradientMap"));function spe(n){if(bf===!1)return;const e=n[LA];if(e)for(const i of e)XS(LA,i,n,!1)}bf&&D1(Ut.prototype,"dispose",function(){spe(this)});let wk=0;function XS(n,e,i,r){if(wk>0)return;if(Array.isArray(i)){for(const o of i)XS(n,e,o,r);return}if(!i)return;let s=i[n];if(s||(s=new Set),r){if(e&&!s.has(e)){s.add(e);let o=i[UA]||0;o+=1,i[UA]=o,xf&&console.warn(`\u{1F7E2} Added user of "${i.type}"`,e,i,o,"users:",s)}}else if(e&&s.has(e)){s.delete(e);let o=i[UA]||0;o>0&&(o-=1,i[UA]=o),xf&&console.warn(`\u{1F534} Removed user of "${i.type}"`,e,i,o,"users:",s),o<=0&&(bk.isLoading(i)||(WS&&console.warn(`\u{1F534} Removed all user of "${i.type}"`,i),$H()&&Wi(i)))}i[n]=s}try{D1(lh.prototype,"render",function(){wk++},function(){wk--})}catch(n){console.warn("Could not wrap WebGLRenderer.render",n)}var FA=(n=>(n.Added="component-added",n.Removing="removing-component",n))(FA||{});const r8=te("debugcomponentevents");class NA{static addComponentLifecylceEventListener(e,i){this.eventListeners.has(e)&&this.eventListeners.set(e,[]);let r=this.eventListeners.get(e);r||(r=[]),r.push(i),this.eventListeners.set(e,r),r8&&console.log("Added event listener for "+e,this.eventListeners)}static removeComponentLifecylceEventListener(e,i){const r=this.eventListeners.get(e);if(!r)return;const s=r.indexOf(i);s<0||r.splice(s,1)}static dispatchComponentLifecycleEvent(e,i){const r=this.eventListeners.get(e);if(r8&&console.log("Dispatching event "+e,r),!!r)for(const s of r)s(i)}}p(NA,"eventListeners",new Map);const zA=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),s8=Symbol("isUsingInstancing"),o8=Symbol("instancingRenderer"),jA=Symbol("instancingAutoUpdateBounds");class rl{static isUsingInstancing(e){return e[s8]===!0}static getRenderer(e){return e[o8]||null}setAutoUpdateBounds(e,i){const r=rl.getRenderer(e);r&&(r[jA]=i)}static markDirty(e,i=!0){if(e&&(this.isUsingInstancing(e)&&(e[zA]=!0,e.matrixWorldNeedsUpdate=!0),i))for(const r of e.children)rl.markDirty(r,!0)}}const Sk=te("debugnewscripts"),ope=te("debughierarchy"),fn=[];function ape(){return fn.length>0}function qS(n){if(!(n.new_scripts.length<=0)){if(Sk&&console.log("Register new components",n.new_scripts.length,[...n.new_scripts],n.alias?"element: "+n.alias:n.hash,n),n.new_scripts_pre_setup_callbacks.length>0){for(const e of n.new_scripts_pre_setup_callbacks)e&&e();n.new_scripts_pre_setup_callbacks.length=0}fn.length=0,n.new_scripts.length>0&&fn.push(...n.new_scripts),n.new_scripts.length=0;for(let e=0;e<fn.length;e++)try{const i=fn[e];if(i.isComponent!==!0){(it()||Sk)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,i),fn.splice(e,1),e--;continue}if(i.destroyed)continue;if(!i.gameObject){console.warn(`Component can not be initialized: no GameObject assigned.
Did you add and remove a component in the same frame?`),fn.splice(e,1),e--;continue}i.context=n,GA(i.gameObject),Ck(i,n)}catch(i){console.error(i),Ph(fn[e],n),fn.splice(e,1),e--}for(let e=0;e<fn.length;e++)try{const i=fn[e];if(i.destroyed){Ph(fn[e],n),fn.splice(e,1),e--;continue}if(i.registering)try{i.registering()}catch(r){console.error(r)}i.__internalAwake!==void 0&&(i.gameObject||console.error("Calling awake for a component without a GameObject",i,i.gameObject),GA(i.gameObject),i.activeAndEnabled&&mf(i.__internalAwake.bind(i)))}catch(i){console.error(i),Ph(fn[e],n),fn.splice(e,1),e--}for(let e=0;e<fn.length;e++)try{const i=fn[e];if(i.destroyed||i.enabled===!1||(GA(i.gameObject),i.activeAndEnabled===!1))continue;i.__internalEnable!==void 0&&(i.enabled=!0,mf(i.__internalEnable.bind(i)))}catch(i){console.error(i),Ph(fn[e],n),fn.splice(e,1),e--}for(let e=0;e<fn.length;e++)try{const i=fn[e];if(i.destroyed||!i.gameObject)continue;n.new_script_start.push(i)}catch(i){console.error(i),Ph(fn[e],n),fn.splice(e,1),e--}fn.length=0;for(const e of n.new_scripts_post_setup_callbacks)e&&e();n.new_scripts_post_setup_callbacks.length=0}}function lpe(n){n&&(n.__internalDisable(!0),Ph(n,n.context))}function a8(n,e){for(let i=0;i<n.new_script_start.length;i++)try{const r=n.new_script_start[i];if(e!==void 0&&r.gameObject!==e||r.destroyed||r.activeAndEnabled===!1)continue;mf(r.__internalAwake.bind(r)),r.enabled&&(mf(r.__internalEnable.bind(r)),mf(r.__internalStart.bind(r)),n.new_script_start.splice(i,1),i--)}catch(r){console.error(r),Ph(n.new_script_start[i],n),n.new_script_start.splice(i,1),i--}}function Ck(n,e){e.scripts.indexOf(n)===-1&&(e.scripts.push(n),n.earlyUpdate&&e.scripts_earlyUpdate.push(n),n.update&&e.scripts_update.push(n),n.lateUpdate&&e.scripts_lateUpdate.push(n),n.onBeforeRender&&e.scripts_onBeforeRender.push(n),n.onAfterRender&&e.scripts_onAfterRender.push(n),n.onPausedChanged&&e.scripts_pausedChanged.push(n),Ek(n,null)&&e.new_scripts_xr.push(n),Ek(n,"immersive-vr")&&e.scripts_immersive_vr.push(n),Ek(n,"immersive-ar")&&e.scripts_immersive_ar.push(n))}function Ph(n,e){Da(n,e.new_scripts),Da(n,e.new_script_start),Da(n,e.scripts),Da(n,e.scripts_earlyUpdate),Da(n,e.scripts_update),Da(n,e.scripts_lateUpdate),Da(n,e.scripts_onBeforeRender),Da(n,e.scripts_onAfterRender),Da(n,e.scripts_pausedChanged),Da(n,e.new_scripts_xr),Da(n,e.scripts_immersive_vr),Da(n,e.scripts_immersive_ar),e.stopAllCoroutinesFrom(n)}function Da(n,e){const i=e.indexOf(n);i>=0&&e.splice(i,1)}function Ek(n,e){var i;if(n){const r=n;if(r.onBeforeXR||r.onEnterXR||r.onUpdateXR||r.onLeaveXR||r.onXRControllerAdded||r.onXRControllerRemoved)return!(e!=null&&((i=r.supportsXR)==null?void 0:i.call(r,e))===!1)}return!1}function YS(n){if(n||(n=fi.Current.scene),!n){console.trace("Invalid call - no current context.");return}const e=l0(n);l8(n,e,!0)||(Sk||it()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,n):console.error('Failed to update active state in hierarchy of "'+n.name+'"',n),console.warn(" \u2191 this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function l8(n,e,i,r=0){if(r>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const s=l0(n);if(e&&(e=s,e&&n.parent)){const l=n.parent;e=l[mh],e===void 0&&(l instanceof Er||(e=!0))}const o=n[mh]!==e;n[mh]=e,o&&(ope&&console.warn("ACTIVE CHANGE",n.name,s,n.visible,e,"changed?"+o,n),i&&cpe(n,l=>{e?l.enabled&&(mf(l.__internalAwake.bind(l)),l.enabled&&(l.__didEnable=!0,l.onEnable())):l.__didAwake&&l.enabled&&(l.__didEnable=!1,l.onDisable())}));let a=!0;if(n.children){const l=r+1;for(const c of n.children)l8(c,e,i,l)===!1&&(a=!1)}return a}function GA(n){let e=!0,i=n,r=!1;for(;i&&i;){if(i.type==="Scene"&&(r=!0),!l0(i)){e=!1;break}i=i.parent}if(!n){console.error("GO is null");return}n[mh]=e&&r}function cpe(n,e){var i;if((i=n.userData)!=null&&i.components)for(const r of n.userData.components)e(r)}const JS=new Map,c8=Symbol("prewarmFlag"),Mk=Symbol("waitingForPrewarm"),Tk=te("debugprewarm");function hpe(n,e){!n||n[c8]===!0||n[Mk]===!0||(JS.has(e)||JS.set(e,[]),n[Mk]=!0,JS.get(e).push(n),Tk&&console.debug("register prewarm",n.name))}let Ik=null,Rk=null;function upe(n){if(!n)return;const e=JS.get(n);if(!(e!=null&&e.length))return;const i=n.mainCamera;if(i){Tk&&console.log("prewarm",e.length,"objects",[...e]);const r=n.renderer;if(r.compile){const s=n.scene;r.compile(s,i),Ik??(Ik=new iR(64)),Rk??(Rk=new tR(.001,9999999,Ik)),Rk.update(r,s);for(const o of e)o[c8]=!0,o[Mk]=!1;e.length=0,Tk&&console.log("prewarm done")}}}const dpe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ppe(n){return typeof n=="string"&&dpe.test(n)}const es=[];for(let n=0;n<256;++n)es.push((n+256).toString(16).slice(1));function fpe(n,e=0){return es[n[e+0]]+es[n[e+1]]+es[n[e+2]]+es[n[e+3]]+"-"+es[n[e+4]]+es[n[e+5]]+"-"+es[n[e+6]]+es[n[e+7]]+"-"+es[n[e+8]]+es[n[e+9]]+"-"+es[n[e+10]]+es[n[e+11]]+es[n[e+12]]+es[n[e+13]]+es[n[e+14]]+es[n[e+15]]}function mpe(n){if(!ppe(n))throw TypeError("Invalid UUID");let e;const i=new Uint8Array(16);return i[0]=(e=parseInt(n.slice(0,8),16))>>>24,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=e&255,i[4]=(e=parseInt(n.slice(9,13),16))>>>8,i[5]=e&255,i[6]=(e=parseInt(n.slice(14,18),16))>>>8,i[7]=e&255,i[8]=(e=parseInt(n.slice(19,23),16))>>>8,i[9]=e&255,i[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,i[11]=e/4294967296&255,i[12]=e>>>24&255,i[13]=e>>>16&255,i[14]=e>>>8&255,i[15]=e&255,i}function gpe(n){n=unescape(encodeURIComponent(n));const e=[];for(let i=0;i<n.length;++i)e.push(n.charCodeAt(i));return e}const vpe="6ba7b810-9dad-11d1-80b4-00c04fd430c8",ype="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Ape(n,e,i){function r(s,o,a,l){var c;if(typeof s=="string"&&(s=gpe(s)),typeof o=="string"&&(o=mpe(o)),((c=o)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let h=new Uint8Array(16+s.length);if(h.set(o),h.set(s,o.length),h=i(h),h[6]=h[6]&15|e,h[8]=h[8]&63|128,a){l=l||0;for(let u=0;u<16;++u)a[l+u]=h[u];return a}return fpe(h)}try{r.name=n}catch{}return r.DNS=vpe,r.URL=ype,r}function bpe(n,e,i,r){switch(n){case 0:return e&i^~e&r;case 1:return e^i^r;case 2:return e&i^e&r^i&r;case 3:return e^i^r}}function Pk(n,e){return n<<e|n>>>32-e}function xpe(n){const e=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){const a=unescape(encodeURIComponent(n));n=[];for(let l=0;l<a.length;++l)n.push(a.charCodeAt(l))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);const r=n.length/4+2,s=Math.ceil(r/16),o=new Array(s);for(let a=0;a<s;++a){const l=new Uint32Array(16);for(let c=0;c<16;++c)l[c]=n[a*64+c*4]<<24|n[a*64+c*4+1]<<16|n[a*64+c*4+2]<<8|n[a*64+c*4+3];o[a]=l}o[s-1][14]=(n.length-1)*8/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=(n.length-1)*8&4294967295;for(let a=0;a<s;++a){const l=new Uint32Array(80);for(let m=0;m<16;++m)l[m]=o[a][m];for(let m=16;m<80;++m)l[m]=Pk(l[m-3]^l[m-8]^l[m-14]^l[m-16],1);let c=i[0],h=i[1],u=i[2],d=i[3],f=i[4];for(let m=0;m<80;++m){const g=Math.floor(m/20),v=Pk(c,5)+bpe(g,h,u,d)+f+e[g]+l[m]>>>0;f=d,d=u,u=Pk(h,30)>>>0,h=c,c=v}i[0]=i[0]+c>>>0,i[1]=i[1]+h>>>0,i[2]=i[2]+u>>>0,i[3]=i[3]+d>>>0,i[4]=i[4]+f>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,i[0]&255,i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,i[1]&255,i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,i[2]&255,i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,i[3]&255,i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,i[4]&255]}const _pe=Ape("v5",80,xpe),h8=_pe;fi.registerCallback(Si.ContextCreated,n=>{const e=n.context;m8(e),p8(e)});const KS=te("debugcomponents"),u8="eff8ba80-635d-11ec-90d6-0242ac120003";class xr{constructor(e){p(this,"_originalSeed"),p(this,"_seed"),typeof e=="string"&&(e=xr.hash(e)),this._originalSeed=e,this._seed=e}get seed(){return this._seed}set seed(e){this._seed=e}reset(){this._seed=this._originalSeed}generateUUID(e){if(typeof e=="string")return h8(e,u8);const i=this._seed;return this._seed-=1,h8(i.toString(),u8)}initialize(e){typeof e=="string"?this._seed=xr.hash(e):this._seed=e}static createFromString(e){return new xr(this.hash(e))}static hash(e){let i=0;for(let r=0;r<e.length;r++)i=e.charCodeAt(r)+((i<<5)-i);return i}}var d8=(n=>(n.NewInstanceCreated="new-instance-created",n.InstanceDestroyed="instance-destroyed",n))(d8||{});class wpe{constructor(e){p(this,"guid"),p(this,"dontSave"),this.guid=e}}function HA(n,e,i=!0,r){if(!n)return;const s=n;if($o(n,i),!e){console.warn("Can not send destroy: No networking connection provided",n.guid);return}if(!e.isConnected){console.warn("Can not send destroy: not connected",n.guid);return}let o=n.guid;if(!o&&s.uuid&&(o=s.uuid),!o){console.warn("Can not send destroy: failed to find guid",n);return}Bk(o,e,r)}function Bk(n,e,i){const r=new wpe(n);i?.saveInRoom===!1&&(r.dontSave=!0),e.send("instance-destroyed",r,El.Queued)}function p8(n){n.connection.beginListen("instance-destroyed",e=>{KS&&console.log("[Remote] Destroyed",n.scene,e);const i=eb(e.guid,n.scene);i&&$o(i)})}class Spe{constructor(e,i,r){p(this,"filename"),p(this,"hash"),p(this,"size"),this.filename=e,this.hash=i,this.size=r}}class f8{constructor(e,i){p(this,"guid"),p(this,"originalGuid"),p(this,"seed"),p(this,"visible"),p(this,"hostData"),p(this,"dontSave"),p(this,"parent"),p(this,"position"),p(this,"rotation"),p(this,"scale"),p(this,"preventCreation"),p(this,"deleteStateOnDisconnect"),this.originalGuid=e,this.guid=i}}function kk(n,e,i,r){var s;const o=n;if(!o.guid)return console.warn("Can not instantiate: No guid",o),null;if(e.context||(e.context=Ot.Current),!e.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const a=e?{...e}:null,{instance:l,seed:c}=Cpe(o,e);if(l){const h=l;if(h.guid){KS&&console.log("[Local] new instance","gameobject:",l?.guid);const u=new f8(o.guid,h.guid);u.seed=c,e.deleteOnDisconnect===!0&&(u.deleteStateOnDisconnect=!0),a&&(a.position&&(u.position={x:a.position.x,y:a.position.y,z:a.position.z}),a.rotation&&(u.rotation={x:a.rotation.x,y:a.rotation.y,z:a.rotation.z,w:a.rotation.w}),a.scale&&(u.scale={x:a.scale.x,y:a.scale.y,z:a.scale.z})),u.position||(u.position={x:h.position.x,y:h.position.y,z:h.position.z}),u.rotation||(u.rotation={x:h.quaternion.x,y:h.quaternion.y,z:h.quaternion.z,w:h.quaternion.w}),u.scale||(u.scale={x:h.scale.x,y:h.scale.y,z:h.scale.z}),u.visible=o.visible,a!=null&&a.parent&&(typeof a.parent=="string"?u.parent=a.parent:u.parent=a.parent.guid),u.hostData=i,r===!1&&(u.dontSave=!0),(s=e?.context)==null||s.connection.send("new-instance-created",u)}else console.warn("Missing guid, can not send new instance event",h)}return l}function ZS(){return Math.random()*9999999}function m8(n){n.connection.beginListen("new-instance-created",async e=>{const i=await Epe(e.originalGuid,n.scene);if(e.preventCreation===!0)return;if(!i){console.warn("could not find object that was instantiated: "+e.guid);return}const r=new Vl;e.position&&(r.position=new S(e.position.x,e.position.y,e.position.z)),e.rotation&&(r.rotation=new Ce(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)),e.scale&&(r.scale=new S(e.scale.x,e.scale.y,e.scale.z)),r.parent=e.parent,e.seed&&(r.idProvider=new xr(e.seed)),r.visible=e.visible,r.context=n,KS&&n.alias&&console.log("[Remote] instantiate in: "+n.alias);const s=c0(i,r);s&&(e.parent==="scene"&&n.scene.add(s),KS&&console.log("[Remote] new instance","gameobject:",s?.guid,i))})}function Cpe(n,e){const i=ZS(),r=e??new Vl;r.idProvider=new xr(i);const s=c0(n,r);return{seed:i,instance:s}}const g8={};function v8(n,e){g8[n]=e}async function Epe(n,e){const i=g8[n];if(i!=null){const r=await i(n);if(r)return r}return y8(n,e)}function y8(n,e){if(e===null||!n)return null;if(e.guid===n)return e;if(e.children)for(const i of e.children){const r=y8(n,i);if(r)return r}return null}const VA=te("gizmos"),Pr=te("debugextension"),Ok=te("debugtypes");class Mpe{constructor(){p(this,"_types",{}),Ok&&console.warn("TypeStore: Created",this)}add(e,i){Ok&&console.warn("ADD TYPE",e);const r=this._types[e];r===void 0?this._types[e]=i:Ok&&r!==i&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",e)}get(e){return this._types[e]}}const Tpe=Symbol("BuiltInType"),q=new Mpe,Ipe=function(n){q.get(n.name)||q.add(n.name,n)},Dk=te("debugresolvedependencies"),Rpe=["/extensions/","extensions/"],Ppe=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function Lk(n,e){Dk&&console.log(n,e);const i=[];Uk(Ppe,n,e,i);const r=await Promise.all(i);return typeof e=="string"&&r.length===1?r[0]:r}function A8(n,e){return!n||!e?!1:n["needle:identifier"]!=null&&e["needle:identifier"]!=null?n["needle:identifier"]===e["needle:identifier"]:!1}function Bpe(n,e){n["needle:identifier"]=e}function Uk(n,e,i,r){if(typeof i=="object"&&i!==void 0&&i!==null)for(const s of Object.keys(i)){const o=i[s];if(typeof o=="string"){const a=b8(e,o);if(a!=null)typeof a.then=="function"?r.push(a.then(l=>i[s]=l)):i[s]=a;else{const l=x8(n,e,o);if(l){r.push(l.then(c=>(i[s]=c,c)));continue}}}else if(Array.isArray(o))for(let a=0;a<o.length;a++){const l=o[a],c=b8(e,l);if(c!==null){typeof c.then=="function"?r.push(c.then(h=>o[a]=h)):o[a]=c;continue}for(const h of n){const u=_8(h.prefix,l);if(u>=0){Dk&&console.log(h,u,h.dependencyName),r.push(e.getDependency(h.dependencyName,u).then(d=>o[a]=d));break}}typeof l=="object"&&Uk(n,e,l,r)}else typeof o=="object"&&Uk(n,e,o,r)}else if(typeof i=="string"){const s=x8(n,e,i);s&&r.push(s)}}function b8(n,e){if(n&&n.plugins&&typeof e=="string"){for(const i of Rpe)if(e.startsWith(i)){let r=e.substring(i.length);const s=r.indexOf("/");s>=0&&(r=r.substring(0,s));const o=n.plugins[r];if(Pr&&console.log(r,o),typeof o?.resolve=="function"){const a=e.substring(i.length+r.length+1);return o.resolve(n,a)}break}}return null}function x8(n,e,i){for(const r of n){const s=_8(r.prefix,i);if(s>=0)return Dk&&console.warn("GET DEPENDENCY",r,s,r.dependencyName),e.getDependency(r.dependencyName,s)}return null}function _8(n,e){if(typeof e=="string"&&e.startsWith(n)){const i=e.substring(n.length),r=Number.parseInt(i);if(r>=0)return r}return-1}const Fk="NEEDLE_persistent_assets";function kpe(n){return n?.___persistentAsset===!0}class Ope{constructor(e){p(this,"parser"),this.parser=e}get name(){return Fk}async afterRoot(e){var i,r;if(!((r=(i=this.parser)==null?void 0:i.json)!=null&&r.extensions))return;const s=this.parser.json.extensions[Fk];if(!s)return;Pr&&console.log(s);const o=new Array;for(const a of s?.assets){const l=Lk(this.parser,a);l&&o.push(l)}await Promise.all(o)}resolve(e,i){const r=Number.parseInt(i);if(r>=0){Pr&&console.log(i);const s=e.json.extensions[Fk];if(s){const o=s?.assets[r];if(o&&typeof o=="object"){o.___persistentAsset=!0;const a=o.__type;a&&q.get(a)}return o}}return null}}const Bh=te("debugserializer");class Dpe{constructor(){p(this,"typeMap",new Map)}register(e,i){if(this.typeMap.has(e)){const r=this.typeMap.get(e);if(r===i)return;console.warn("Type "+e+" is already registered",i,r)}Bh&&console.log("Register type serializer",i.name,i,e),this.typeMap.set(e,i)}getSerializer(e){if(e)return this.typeMap.get(e)}getSerializerForConstructor(e,i=0){if(i>20)return;if(!e||!e.constructor){Bh&&console.log("invalid type");return}const r=e.name,s=this.getSerializer(e);if(s!==void 0)return Bh&&console.log("FOUND SERIALIZER",s?.name,e.name,e.constructor.name,"for type: "+r,s,e,this.typeMap),s;const o=Object.getPrototypeOf(e);if(o&&o!==e){const a=this.getSerializerForConstructor(o,++i);if(a){const l=o.constructor||o.prototype;Bh&&console.log("FOUND SERIALIZER(in constructor) "+l.constructor.name,l.name,l,a),this.register(l,a)}return a}Bh&&console.warn("No serializer found for "+r,e,e.name,e.constructor.name)}}const $S=new Dpe;class La{constructor(e,i){if(p(this,"name"),this.name=i,Array.isArray(e))for(const r of e)$S.register(r,this);else $S.register(e,this)}}class Lpe{constructor(){p(this,"isDevMode",eo()),p(this,"cache",{})}registerDefinedKeys(e,i){if(this.isDevMode&&this.cache[e]===void 0){this.cache[e]=Object.keys(i);const r=i;r.$serializedTypes&&Object.keys(r.$serializedTypes)&&this.cache[e].push(...Object.keys(r.$serializedTypes)),Bh&&console.log("registerDefinedKeys for "+e,this.cache[e],i)}}getDefinedKey(e,i){return this.cache[e]===void 0?!1:this.cache[e].includes(i)}}class Nk{constructor(e){p(this,"root"),p(this,"gltf"),p(this,"gltfId"),p(this,"object"),p(this,"target"),p(this,"nodeId"),p(this,"nodeToObject"),p(this,"objectToNode"),p(this,"context"),p(this,"path"),p(this,"type"),p(this,"serializable"),p(this,"implementationInformation"),this.root=e}}function w8(n,e){const i=n.$serializedTypes;if(i===void 0)return null;const r={};for(const s in i){const o=n[s];if(o!=null&&typeof o=="object"){const a=$S.getSerializerForConstructor(o);if(a){r[s]=a.onSerialize(o,e);continue}}r[s]=o}return r.name=n.constructor.name,typeof n.guid=="string"&&(r.guid=n.guid),r}const eC=[];function S8(n,e){if(!n)return e;typeof n.$serializedTypes=="object"&&(e||(e={}),Object.assign(e,n.$serializedTypes));const i=Object.getPrototypeOf(n);return S8(i,e)}function tC(n,e,i){if(!n)return!1;if(i.target=n,n.onBeforeDeserialize!==void 0){const s=n.onBeforeDeserialize(e,i);if(typeof s=="boolean")return s}const r=S8(n);if(e){if(typeof e.guid=="string"&&(n.guid=e.guid),r)for(const s in r){let o=function(c){const h=c.type;return h?zk(l,h,i,void 0,n[s]):zk(l,c,i,void 0,n[s])};const a=r[s],l=e[s];if(Bh&&console.log(s,l,n,a),!(n[s]!==void 0&&l===void 0)&&(i.type=void 0,i.path=s,i.serializable=a,!(n.onBeforeDeserializeMember!==void 0&&n.onBeforeDeserializeMember(s,l,i)===!0))){if(a===null)n[s]=l;else{if(Array.isArray(a))for(let c=0;c<a.length;c++){const h=a[c],u=o(h);if(u!==void 0||c===a.length-1){n[s]=u;break}}else n[s]=o(a);eC.length=0}n.onAfterDeserializeMember!==void 0&&n.onAfterDeserializeMember(s,l,i)}}Npe(n,e)}return Fpe(n,e,i.implementationInformation),n.onAfterDeserialize!==void 0&&n.onAfterDeserialize(e,i),!0}const Upe=te("noerrors");function Fpe(n,e,i){var r,s;if(Upe||!e||!eo()||!n||n.constructor&&n.constructor[Tpe]===!0)return;const o=(r=n.constructor)==null?void 0:r.name,a=Object.getOwnPropertyNames(e);for(const l of a){if(l==="sourceId")continue;const c=n[l];if(c==null)continue;const h=e[l];if(i?.getDefinedKey(o,l)===!1){const u=l.charAt(0).toUpperCase()+l.slice(1);i.getDefinedKey(o,u)&&(tc(Wo.Warn,'<strong>Please rename</strong> "'+u+'" to "'+l+'" in '+o),console.warn('Please use lowercase for field: "'+u+'" in '+o,h,n));continue}if(h!=null){if(typeof h=="object"&&(c===void 0||!c.isObject3D)){if(typeof h.node=="number"||typeof h.guid=="string"){if(h.could_not_resolve)continue;if(!(c!==void 0&&Object.keys(c).length>1)){tc(Wo.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${l}? : Object3D;

in script ${o}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(o,l,n[l],n);continue}}else if(!Array.isArray(c)){const u=(s=c.constructor)==null?void 0:s.name;if(u==="Object"&&!c.constructor["did_warn:missing_serializable"]){c.constructor["did_warn:missing_serializable"]=!0;const d='You might be missing a @serializable(Type) decorator for field "'+l+'" in '+o+".ts";console.warn(d+`
${l}:`,h,u),tc(Wo.Warn,"Dev Warning: Are you missing a type in @serializable? Please check the browser console for details")}}}if(typeof c=="string"&&(h.endsWith(".gltf")||h.endsWith(".glb"))){tc(Wo.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${l}? : AssetReference;

in script ${o}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(o,l,n[l],n);continue}}}}function Npe(n,e){for(const i of Object.keys(e)){const r=e[i];if(typeof r=="object"&&r!==null&&r!==void 0){const s=n[i];if(!s){Bh&&console.log(i,"is undefined on",n);continue}for(const o of Object.keys(r))if(s[o]===void 0&&C8(r[o])&&!C8(s)){const a=zpe(s,o);if(a&&(a?.writable===void 0||a?.writable===!1)&&a.set===void 0){Bh&&console.warn('Property is not writable "'+o+'"',s,a,r[o],s[o]);continue}s[o]=r[o]}}}}function zpe(n,e){for(;n;){const i=Object.getOwnPropertyDescriptor(n,e);if(i)return i;n=Object.getPrototypeOf(n)}}function C8(n){switch(typeof n){case"number":case"string":case"boolean":return!0}return!1}function zk(n,e,i,r,s){let o=typeof e=="function"&&e.prototype===void 0,a=e;if(o)try{if(a=e?.call(e,s),o=!1,a==null)return}catch(u){console.error("Error in callback",u,n)}if(i.type=a,!o&&s instanceof a)return s;if(r||(r={serializer:$S.getSerializerForConstructor(a)}),s&&typeof s=="object"&&kpe(s)){if(s.__concreteInstance)return s.__concreteInstance;const u=s;if(!u.$serializedTypes&&a.prototype.$serializedTypes&&(u.$serializedTypes=a.prototype.$serializedTypes),u.$serializedTypes&&tC(u,n,i),s&&a!==void 0)try{let d=null;r.serializer&&(d=r.serializer.onDeserialize(n,i)),d||(d=new a,Pr&&console.log("Create concrete instance for persistent asset",s,"instance:",d),o0(d,s)),s.__concreteInstance=d,s=d}catch(d){console.error("Error creating instance or creating values on instance",d,s,a)}return s}if(Array.isArray(n)){const u=[];for(let d=0;d<n.length;d++){const f=n[d],m=zk(f,e,i,r,f);u.push(m)}return u}const l=r?.serializer;if(l)return l.onDeserialize(n,i);let c;if(n&&(n.isMaterial||n.isTexture||n.isObject3D||n instanceof $s))c=n;else{if(n===void 0)return;if(n===null&&(a===Ut||a===Gt||a===pe||a===$s))return null;try{c=new a(...jpe(n))}catch(u){console.error("Error creating "+i.path,i.target,u);return}}const h=c;return h.$serializedTypes&&tC(h,n,i),c}function jpe(n){if(eC.length=0,typeof n=="object"&&n!==null&&n!==void 0)for(const e of Object.keys(n))eC.push(n[e]);return eC}const jk=Symbol("assigned component properties");function o0(n,e,i){var r;if(e==null||n==null)return;n[jk]=!0;const s=((r=n.constructor)==null?void 0:r.name)??"unknown";i?.registerDefinedKeys(s,n);for(const o of Object.keys(e)){const a=Gpe(n,o);typeof a?.value!="function"&&(!a||a.writable===!0||a?.set!==void 0)&&(n[o]=e[o])}delete n[jk]}function Gpe(n,e){let i;do i=Object.getOwnPropertyDescriptor(n,e);while(!i&&(n=Object.getPrototypeOf(n)));return i}const E8=Symbol("customVisibilityFlag");function ld(n,e){n.layers[E8]=e}const M8=Symbol("DidPatchLayers");function Hpe(){const n=Cs.prototype;if(n[M8])return;n[M8]=!0;const e=n.test;n.test=function(i){return this[E8]===!1?!1:e.call(this,i)}}Hpe(),Object.defineProperty(Ft.prototype,"fov",{get:function(){return this._fov},set:function(n){const e=n!==this._fov;this._fov=n,e&&this.view!==void 0&&this.updateProjectionMatrix()}}),Object.defineProperty(Ft.prototype,"near",{get:function(){return this._near},set:function(n){const e=n!==this._near;this._near=n,e&&this.view!==void 0&&this.updateProjectionMatrix()}}),Object.defineProperty(Ft.prototype,"far",{get:function(){return this._far},set:function(n){const e=n!==this._far;this._far=n,e&&this.view!==void 0&&this.updateProjectionMatrix()}});const T8=new Map;function I8(n,e){if(!n)return;if(!e){console.warn("No prototype found",n,n.prototype,n.constructor);return}const i=T8.get(e);i&&i.apply(n)}function R8(n){const e=Vpe(n.prototype);T8.set(n,e)}function Vpe(n){return new Qpe(n)}class Qpe{constructor(e){p(this,"$symbol"),p(this,"extensions"),p(this,"descriptors"),this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(e),this.descriptors=new Array;for(let i=0;i<this.extensions.length;i++){const r=this.extensions[i],s=Object.getOwnPropertyDescriptor(e,r);s&&this.descriptors.push(s)}}apply(e){if(!e[this.$symbol]){e[this.$symbol]=!0;for(let i=0;i<this.extensions.length;i++){const r=this.extensions[i],s=this.descriptors[i];s&&Object.defineProperty(e,r,s)}}}}const _f=new ku,Us=new S,cd=new S,mn=new Ce,P8={X:new S(1,0,0),Y:new S(0,1,0),Z:new S(0,0,1)},Gk={type:"change"},B8={type:"mouseDown"},k8={type:"mouseUp",mode:null},O8={type:"objectChange"};class Wpe extends ve{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const r=new Vk;this._gizmo=r,this.add(r);const s=new Zpe;this._plane=s,this.add(s);const o=this;function a(b,x){let _=x;Object.defineProperty(o,b,{get:function(){return _!==void 0?_:x},set:function(w){_!==w&&(_=w,s[b]=w,r[b]=w,o.dispatchEvent({type:b+"-changed",value:w}),o.dispatchEvent(Gk))}}),o[b]=x,s[b]=x,r[b]=x}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const l=new S,c=new S,h=new Ce,u=new Ce,d=new S,f=new Ce,m=new S,g=new S,v=new S,y=0,A=new S;a("worldPosition",l),a("worldPositionStart",c),a("worldQuaternion",h),a("worldQuaternionStart",u),a("cameraPosition",d),a("cameraQuaternion",f),a("pointStart",m),a("pointEnd",g),a("rotationAxis",v),a("rotationAngle",y),a("eye",A),this._offset=new S,this._startNorm=new S,this._endNorm=new S,this._cameraScale=new S,this._parentPosition=new S,this._parentQuaternion=new Ce,this._parentQuaternionInv=new Ce,this._parentScale=new S,this._worldScaleStart=new S,this._worldQuaternionInv=new Ce,this._worldScale=new S,this._positionStart=new S,this._quaternionStart=new Ce,this._scaleStart=new S,this._getPointer=Xpe.bind(this),this._onPointerDown=Ype.bind(this),this._onPointerHover=qpe.bind(this),this._onPointerMove=Jpe.bind(this),this._onPointerUp=Kpe.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&_f.setFromCamera(e,this.camera);const i=Hk(this._gizmo.picker[this.mode],_f);i?this.axis=i.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&_f.setFromCamera(e,this.camera);const i=Hk(this._plane,_f,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,B8.mode=this.mode,this.dispatchEvent(B8)}}pointerMove(e){const i=this.axis,r=this.mode,s=this.object;let o=this.space;if(r==="scale"?o="local":(i==="E"||i==="XYZE"||i==="XYZ")&&(o="world"),s===void 0||i===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&_f.setFromCamera(e,this.camera);const a=Hk(this._plane,_f,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),r==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(s.position.applyQuaternion(mn.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),o==="world"&&(s.parent&&s.position.add(Us.setFromMatrixPosition(s.parent.matrixWorld)),i.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Us.setFromMatrixPosition(s.parent.matrixWorld))));else if(r==="scale"){if(i.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),cd.set(l,l,l)}else Us.copy(this.pointStart),cd.copy(this.pointEnd),Us.applyQuaternion(this._worldQuaternionInv),cd.applyQuaternion(this._worldQuaternionInv),cd.divide(Us),i.search("X")===-1&&(cd.x=1),i.search("Y")===-1&&(cd.y=1),i.search("Z")===-1&&(cd.z=1);s.scale.copy(this._scaleStart).multiply(cd),this.scaleSnap&&(i.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(r==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(Us.setFromMatrixPosition(this.camera.matrixWorld));let c=!1;i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Us.copy(this.rotationAxis).cross(this.eye))*l):(i==="X"||i==="Y"||i==="Z")&&(this.rotationAxis.copy(P8[i]),Us.copy(P8[i]),o==="local"&&Us.applyQuaternion(this.worldQuaternion),Us.cross(this.eye),Us.length()===0?c=!0:this.rotationAngle=this._offset.dot(Us.normalize())*l),(i==="E"||c)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&i!=="E"&&i!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(mn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(mn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Gk),this.dispatchEvent(O8)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(k8.mode=this.mode,this.dispatchEvent(k8)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Gk),this.dispatchEvent(O8),this.pointStart.copy(this.pointEnd))}getRaycaster(){return _f}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Xpe(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=this.domElement.getBoundingClientRect();return{x:(n.clientX-e.left)/e.width*2-1,y:-(n.clientY-e.top)/e.height*2+1,button:n.button}}}function qpe(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function Ype(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function Jpe(n){this.enabled&&this.pointerMove(this._getPointer(n))}function Kpe(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function Hk(n,e,i){const r=e.intersectObject(n,!0);for(let s=0;s<r.length;s++)if(r[s].object.visible||i)return r[s];return!1}const iC=new ri,Gi=new S(0,1,0),D8=new S(0,0,0),L8=new he,nC=new Ce,rC=new Ce,pc=new S,U8=new he,QA=new S(1,0,0),wf=new S(0,1,0),WA=new S(0,0,1),sC=new S,XA=new S,qA=new S;class Vk extends ve{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Jt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new zi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const s=i.clone();s.opacity=.5;const o=e.clone();o.color.setHex(16711680);const a=e.clone();a.color.setHex(65280);const l=e.clone();l.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const d=e.clone();d.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const g=new Wn(0,.04,.1,12);g.translate(0,.05,0);const v=new Ki(.08,.08,.08);v.translate(0,.04,0);const y=new dt;y.setAttribute("position",new rt([0,0,0,1,0,0],3));const A=new Wn(.0075,.0075,.5,3);A.translate(0,.25,0);function b(L,Q){const D=new lu(L,.0075,3,64,Q*Math.PI*2);return D.rotateY(Math.PI/2),D.rotateX(Math.PI/2),D}function x(){const L=new dt;return L.setAttribute("position",new rt([0,0,0,1,1,1],3)),L}const _={X:[[new pe(g,o),[.5,0,0],[0,0,-Math.PI/2]],[new pe(g,o),[-.5,0,0],[0,0,Math.PI/2]],[new pe(A,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new pe(g,a),[0,.5,0]],[new pe(g,a),[0,-.5,0],[Math.PI,0,0]],[new pe(A,a)]],Z:[[new pe(g,l),[0,0,.5],[Math.PI/2,0,0]],[new pe(g,l),[0,0,-.5],[-Math.PI/2,0,0]],[new pe(A,l),null,[Math.PI/2,0,0]]],XYZ:[[new pe(new au(.1,0),d.clone()),[0,0,0]]],XY:[[new pe(new Ki(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new pe(new Ki(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new Ki(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},w={X:[[new pe(new Wn(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new pe(new Wn(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new pe(new Wn(.2,0,.6,4),r),[0,.3,0]],[new pe(new Wn(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new pe(new Wn(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new pe(new Wn(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new pe(new au(.2,0),r)]],XY:[[new pe(new Ki(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new pe(new Ki(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new Ki(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},T={START:[[new pe(new au(.01,2),s),null,null,null,"helper"]],END:[[new pe(new au(.01,2),s),null,null,null,"helper"]],DELTA:[[new hn(x(),s),null,null,null,"helper"]],X:[[new hn(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new hn(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new hn(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new pe(b(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new pe(b(.5,.5),o)]],Y:[[new pe(b(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new pe(b(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new pe(b(.75,1),f),null,[0,Math.PI/2,0]]]},R={AXIS:[[new hn(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},B={XYZE:[[new pe(new tl(.25,10,8),r)]],X:[[new pe(new lu(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new pe(new lu(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new pe(new lu(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new pe(new lu(.75,.1,2,24),r)]]},E={X:[[new pe(v,o),[.5,0,0],[0,0,-Math.PI/2]],[new pe(A,o),[0,0,0],[0,0,-Math.PI/2]],[new pe(v,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new pe(v,a),[0,.5,0]],[new pe(A,a)],[new pe(v,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new pe(v,l),[0,0,.5],[Math.PI/2,0,0]],[new pe(A,l),[0,0,0],[Math.PI/2,0,0]],[new pe(v,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new pe(new Ki(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new pe(new Ki(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new Ki(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new pe(new Ki(.1,.1,.1),d.clone())]]},P={X:[[new pe(new Wn(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new pe(new Wn(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new pe(new Wn(.2,0,.6,4),r),[0,.3,0]],[new pe(new Wn(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new pe(new Wn(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new pe(new Wn(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new pe(new Ki(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new pe(new Ki(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new pe(new Ki(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new pe(new Ki(.2,.2,.2),r),[0,0,0]]]},O={X:[[new hn(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new hn(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new hn(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function N(L){const Q=new ve;for(const D in L)for(let F=L[D].length;F--;){const H=L[D][F][0].clone(),K=L[D][F][1],Z=L[D][F][2],oe=L[D][F][3],we=L[D][F][4];H.name=D,H.tag=we,K&&H.position.set(K[0],K[1],K[2]),Z&&H.rotation.set(Z[0],Z[1],Z[2]),oe&&H.scale.set(oe[0],oe[1],oe[2]),H.updateMatrix();const Oe=H.geometry.clone();Oe.applyMatrix4(H.matrix),H.geometry=Oe,H.renderOrder=1/0,H.position.set(0,0,0),H.rotation.set(0,0,0),H.scale.set(1,1,1),Q.add(H)}return Q}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=N(_)),this.add(this.gizmo.rotate=N(M)),this.add(this.gizmo.scale=N(E)),this.add(this.picker.translate=N(w)),this.add(this.picker.rotate=N(B)),this.add(this.picker.scale=N(P)),this.add(this.helper.translate=N(T)),this.add(this.helper.rotate=N(R)),this.add(this.helper.scale=N(O)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:rC;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let s=0;s<r.length;s++){const o=r[s];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(mn.setFromEuler(iC.set(0,0,0)),o.quaternion.copy(i).multiply(mn),Math.abs(Gi.copy(QA).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(mn.setFromEuler(iC.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(mn),Math.abs(Gi.copy(wf).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(mn.setFromEuler(iC.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(mn),Math.abs(Gi.copy(WA).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(mn.setFromEuler(iC.set(0,Math.PI/2,0)),Gi.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(L8.lookAt(D8,Gi,wf)),o.quaternion.multiply(mn),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Us.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Us.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Us),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Gi.copy(QA).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Gi.copy(wf).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Gi.copy(WA).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Gi.copy(WA).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Gi.copy(QA).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Gi.copy(wf).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(nC.copy(i),Gi.copy(this.eye).applyQuaternion(mn.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(L8.lookAt(this.eye,D8,wf)),o.name==="X"&&(mn.setFromAxisAngle(QA,Math.atan2(-Gi.y,Gi.z)),mn.multiplyQuaternions(nC,mn),o.quaternion.copy(mn)),o.name==="Y"&&(mn.setFromAxisAngle(wf,Math.atan2(Gi.x,Gi.z)),mn.multiplyQuaternions(nC,mn),o.quaternion.copy(mn)),o.name==="Z"&&(mn.setFromAxisAngle(WA,Math.atan2(Gi.y,Gi.x)),mn.multiplyQuaternions(nC,mn),o.quaternion.copy(mn))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class Zpe extends pe{constructor(){super(new cr(1e5,1e5,2,2),new Jt({visible:!1,wireframe:!0,side:yi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),sC.copy(QA).applyQuaternion(i==="local"?this.worldQuaternion:rC),XA.copy(wf).applyQuaternion(i==="local"?this.worldQuaternion:rC),qA.copy(WA).applyQuaternion(i==="local"?this.worldQuaternion:rC),Gi.copy(XA),this.mode){case"translate":case"scale":switch(this.axis){case"X":Gi.copy(this.eye).cross(sC),pc.copy(sC).cross(Gi);break;case"Y":Gi.copy(this.eye).cross(XA),pc.copy(XA).cross(Gi);break;case"Z":Gi.copy(this.eye).cross(qA),pc.copy(qA).cross(Gi);break;case"XY":pc.copy(qA);break;case"YZ":pc.copy(sC);break;case"XZ":Gi.copy(qA),pc.copy(XA);break;case"XYZ":case"E":pc.set(0,0,0);break}break;case"rotate":default:pc.set(0,0,0)}pc.length()===0?this.quaternion.copy(this.cameraQuaternion):(U8.lookAt(Us.set(0,0,0),pc,Gi),this.quaternion.setFromRotationMatrix(U8)),super.updateMatrixWorld(e)}}const $pe=te("debuggetcomponent"),F8=()=>$pe||globalThis.NEEDLE_DEBUG_GETCOMPONENT===!0;function efe(n){return n==null||n.isObject3D?n:n.object&&n.object.isObject3D?n.object:n}function Qk(n,e){if(!n||!n.userData.components)return e;const i=n.userData.components.indexOf(e);return i<0||(NA.dispatchComponentLifecycleEvent(FA.Removing,e),e.gameObject=null,n.userData.components.splice(i,1)),e}function YA(n,e,i){return Cf(n,e)||Zo(n,e,i)}const N8=new xr("addComponentIdProvider");function Sf(n,e,i=!0){n.userData||(n.userData={}),n.userData.components||(n.userData.components=[]),n.userData.components.push(e),e.gameObject=n,(e.guid===void 0||e.guid==="invalid")&&(e.guid=N8.generateUUID()),lC(n),DC(e,e.context);try{i&&e.__internalAwake&&(GA(n),e.activeAndEnabled&&e.__internalAwake()),NA.dispatchComponentLifecycleEvent(FA.Added,e)}catch(r){console.error(r)}return e}function Zo(n,e,i,r){if(typeof e=="function"){const s=new e;i&&s.__internalNewInstanceCreated(i);let o=!0;return r?.callAwake!=null&&(o=r.callAwake),Sf(n,s,o)}if(e.destroyed)return console.warn("Can not move/add a destroyed component",e),e;if(e.gameObject===n)return e;if(e.gameObject&&e.gameObject.userData.components){const s=e.gameObject.userData.components.indexOf(e);e.gameObject.userData.components.splice(s,1)}if(!n.userData.components)n.userData.components=[];else if(n.userData.components.includes(e))return e;return n.userData.components.push(e),e.gameObject=n,(e.guid===void 0||e.guid==="invalid")&&(e.guid=N8.generateUUID()),i&&e._internalInit(i),DC(e,e.context),e}function z8(n){if(n.gameObject&&n.gameObject.userData.components){const e=n.gameObject.userData.components.indexOf(n);n.gameObject.userData.components.splice(e,1)}n.__internalDisable&&n.__internalDisable(),Ph(n,n.context??Ot.Current),n.destroy(),n.gameObject=null}let j8=!1;function G8(n,e,i){var r;if(n==null)return null;if(!n.isObject3D)return console.error("Object is not object3D"),null;if(!((r=n?.userData)!=null&&r.components)||(typeof e=="string"&&(j8||(j8=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,e))),F8()&&console.log("[onGetComponent] FIND",e),e==null))return null;for(let s=0;s<n.userData.components.length;s++){const o=n.userData.components[s];let a=Object.getPrototypeOf(o);for(;a;){if(a===e.prototype)if(F8()&&console.log("[onGetComponent] MATCH BY PROTOYPE",a),i)i.push(o);else return o;a=Object.getPrototypeOf(a)}}return i||null}function Cf(n,e){const i=G8(n,e);return i?Array.isArray(i)?i[0]:i:null}function JA(n,e,i,r=!0){return i||(i=[]),r&&(i.length=0),G8(n,e,i),i}function KA(n,e,i){var r;const s=Cf(n,e);if(i===!1&&s?.enabled===!1)return null;if(s)return s;for(let o=0;o<((r=n?.children)==null?void 0:r.length);o++){const a=KA(n.children[o],e);if(a)return a}return null}function a0(n,e,i,r=!0){var s;i||(i=[]),r&&(i.length=0),JA(n,e,i,!1);for(let o=0;o<((s=n?.children)==null?void 0:s.length);o++)a0(n.children[o],e,i,!1);return i}function ZA(n,e){if(!n)return null;if(Array.isArray(n)){for(let r=0;r<n.length;r++){const s=efe(n[r]),o=ZA(s,e);if(o)return o}return null}return Cf(n,e)||(n.parent?ZA(n.parent,e):null)}function oC(n,e,i,r=!0){return i||(i=[]),r&&(i.length=0),n?(JA(n,e,i,!1),n.parent?oC(n.parent,e,i,!1):i):i}function aC(n,e=void 0,i=!0){if(!n)return null;if(!e&&(e=Ot.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),null;let r=e;if(r.isScene||(r=e?.scene),!r)return null;for(const s in r.children){const o=r.children[s];if(i===!1&&o[mh]===!1)continue;const a=KA(o,n);if(a)return a}return null}function H8(n,e,i=void 0){if(!n)return e;if(e||(e=[]),e.length=0,!i&&(i=Ot.Current,!i))return console.error("Can not search object without any needle context or scene!!!"),e;"scene"in i&&(i=i.scene);const r=i;if(!r)return e;for(const s in r.children){const o=r.children[s];a0(o,n,e,!1)}return e}function lC(n){n&&n.isObject3D===!0&&I8(n,ve)}ve.prototype.SetActive=function(n){this.visible=n},ve.prototype.setActive=function(n){this.visible=n},ve.prototype.destroy=function(){$o(this)},ve.prototype.addComponent=function(n,e){return Zo(this,n,e)},ve.prototype.addNewComponent=function(n,e){return Zo(this,n,e)},ve.prototype.removeComponent=function(n){return Qk(this,n)},ve.prototype.getOrAddComponent=function(n,e){return YA(this,n,e)},ve.prototype.getComponent=function(n){return Cf(this,n)},ve.prototype.getComponents=function(n,e){return JA(this,n,e)},ve.prototype.getComponentInChildren=function(n){return KA(this,n)},ve.prototype.getComponentsInChildren=function(n,e){return a0(this,n,e)},ve.prototype.getComponentInParent=function(n){return ZA(this,n)},ve.prototype.getComponentsInParent=function(n,e){return oC(this,n,e)},Object.getOwnPropertyDescriptor(ve.prototype,"activeSelf")||Object.defineProperty(ve.prototype,"activeSelf",{get:function(){return l0(this)},set:function(n){$A(this,n)}}),Object.getOwnPropertyDescriptor(ve.prototype,"transform")||Object.defineProperty(ve.prototype,"transform",{get:function(){return this}}),Object.getOwnPropertyDescriptor(ve.prototype,"worldPosition")||Object.defineProperty(ve.prototype,"worldPosition",{get:function(){return this instanceof Vk?kt(this.object):kt(this)},set:function(n){gr(this,n)}}),Object.getOwnPropertyDescriptor(ve.prototype,"worldQuaternion")||Object.defineProperty(ve.prototype,"worldQuaternion",{get:function(){return this instanceof Vk?Ri(this.object):Ri(this)},set:function(n){Ca(this,n)}}),Object.getOwnPropertyDescriptor(ve.prototype,"worldRotation")||Object.defineProperty(ve.prototype,"worldRotation",{get:function(){return Vy(this)},set:function(n){lP(this,n)}}),Object.getOwnPropertyDescriptor(ve.prototype,"worldScale")||Object.defineProperty(ve.prototype,"worldScale",{get:function(){return Qi(this)},set:function(n){bg(this,n)}}),Object.getOwnPropertyDescriptor(ve.prototype,"worldForward")||Object.defineProperty(ve.prototype,"worldForward",{get:function(){return bt().set(0,0,1).applyQuaternion(Ri(this))}}),Object.getOwnPropertyDescriptor(ve.prototype,"worldRight")||Object.defineProperty(ve.prototype,"worldRight",{get:function(){return bt().set(1,0,0).applyQuaternion(Ri(this))}}),Object.getOwnPropertyDescriptor(ve.prototype,"worldUp")||Object.defineProperty(ve.prototype,"worldUp",{get:function(){return bt().set(0,1,0).applyQuaternion(Ri(this))}}),R8(ve);class ki extends be{constructor(e,i,r,s){super(e,i,r),p(this,"alpha",1),this.alpha=s}get isRGBAColor(){return!0}set a(e){this.alpha=e}get a(){return this.alpha}clone(){const e=super.clone();return e.alpha=this.alpha,e}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,"alpha"in e&&typeof e.alpha=="number"?this.alpha=e.alpha:typeof e.a=="number"&&(this.alpha=e.a),this}lerp(e,i){const r=e;return r.alpha!=null&&(this.alpha=tt.lerp(this.alpha,r.alpha,i)),super.lerp(e,i)}lerpColors(e,i,r){const s=e,o=i;return s.alpha!=null&&o.alpha!=null&&(this.alpha=tt.lerp(s.alpha,o.alpha,r)),super.lerpColors(e,i,r)}multiply(e){const i=e;return i.alpha!=null&&(this.alpha=this.alpha*i.alpha),super.multiply(e)}fromArray(e,i=0){return this.alpha=e[i+3],super.fromArray(e,i)}}const cC=te("debuggetcomponent"),hC=te("debuginstantiate");var V8=(n=>(n[n.None=0]="None",n[n.HideInHierarchy=1]="HideInHierarchy",n[n.HideInInspector=2]="HideInInspector",n[n.DontSaveInEditor=4]="DontSaveInEditor",n[n.NotEditable=8]="NotEditable",n[n.DontSaveInBuild=16]="DontSaveInBuild",n[n.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",n[n.DontSave=52]="DontSave",n[n.HideAndDontSave=61]="HideAndDontSave",n))(V8||{});class Vl{constructor(){p(this,"idProvider"),p(this,"parent"),p(this,"keepWorldPosition"),p(this,"position"),p(this,"rotation"),p(this,"scale"),p(this,"visible"),p(this,"context"),p(this,"components")}clone(){var e,i,r;const s=new Vl;return s.idProvider=this.idProvider,s.parent=this.parent,s.keepWorldPosition=this.keepWorldPosition,s.position=(e=this.position)==null?void 0:e.clone(),s.rotation=(i=this.rotation)==null?void 0:i.clone(),s.scale=(r=this.scale)==null?void 0:r.clone(),s.visible=this.visible,s.context=this.context,s.components=this.components,s}cloneAssign(e){var i,r,s;this.idProvider=e.idProvider,this.parent=e.parent,this.keepWorldPosition=e.keepWorldPosition,this.position=(i=e.position)==null?void 0:i.clone(),this.rotation=(r=e.rotation)==null?void 0:r.clone(),this.scale=(s=e.scale)==null?void 0:s.clone(),this.visible=e.visible,this.context=e.context,this.components=e.components}}function l0(n){return n.visible}function $A(n,e){return typeof e=="number"&&(e=e>.5),n.visible=e,n.visible}function Q8(n){return n[mh]||uC(n)}function W8(n,e){n[s8]=e}function uC(n){return rl.isUsingInstancing(n)}function eb(n,e){return fg(n,e,!0,!0)}const X8=Symbol("isDestroyed");function Ef(n){return n[X8]}function q8(n,e){n[X8]=e}const Wk=Symbol("isDontDestroy");function Xk(n,e=!0){n[Wk]=e}const dC=[],pC=[];function $o(n,e=!0,i=!1){dC.length=0,pC.length=0,qk(n,e,!0);for(const r of dC)r.gameObject=null,r.context=null;for(const r of pC)q8(r,!0),i&&Wi(r),n8(r);pC.length=0,dC.length=0}function qk(n,e=!0,i=!0){var r;if(n==null)return;const s=n;if(s.isComponent){if(s[Wk])return;dC.push(s);const l=s.gameObject;s.__internalDisable(),s.__internalDestroy(),s.gameObject=l;return}if(n[Wk])return;const o=n;cC&&console.log(o),pC.push(o);const a=(r=o.userData)==null?void 0:r.components;if(a!=null&&Array.isArray(a)){let l=a.length;for(let c=0;c<a.length;c++){const h=a[c];qk(h,e,!1),a.length<l&&(l=a.length,c--)}}if(e&&o.children)for(const l of o.children)qk(l,e,!1);i&&o.removeFromParent()}function Mf(n,e,i=!0){return Y8(n,e,i)}function*fC(n,e,i=!1,r=999,s=0){if(n!=null&&n.userData.components&&!(s>r)){for(const o of n.userData.components)e&&o?.isComponent===!0&&o instanceof e?yield o:yield o;if(i===!0)for(const o of n.children)yield*fC(o,e,!0,r,s+1)}}function Y8(n,e,i,r=0){var s;if(n){if(n.isObject3D,r>1e3){console.warn("Failed to iterate components: too many levels");return}if((s=n.userData)!=null&&s.components)for(let o=0;o<n.userData.components.length;o++){const a=n.userData.components[o];if(a?.isComponent===!0){const l=e(a);if(l!==void 0)return l}}if(i&&n.children){const o=r+1;for(let a=0;a<n.children.length;a++){const l=n.children[a];if(!l)continue;const c=Y8(l,e,i,o);if(c!==void 0)return c}}}}function c0(n,e=null){let i=null;e!==null&&(e.x!==void 0?(i=new Vl,i.position=e):i=e);let r=Ot.Current;i!=null&&i.context&&(r=i.context),cC&&r.alias&&console.log("context",r.alias),i&&!i.idProvider&&(i.idProvider=new xr(Date.now()));const s=[],o={},a={},l=J8(r,n,i,s,o,a);l&&(ife(o),tfe(a,o)),cC&&(M1(n,!0),M1(l,!0));const c={};if(i?.components!==!1){for(const h in s){const u=s[h],d=u.guid;i&&i.idProvider&&(u.guid=i.idProvider.generateUUID(),c[d]=u.guid,cC&&console.log(u.name,u.guid)),DC(u,r),u.__internalNewInstanceCreated&&u.__internalNewInstanceCreated()}for(const h in s){const u=s[h];u.resolveGuids&&u.resolveGuids(c),u.enabled!==!1&&(u.enabled=!0)}qS(r)}return l}function J8(n,e,i,r,s,o){var a;if(!e)return null;const l=e.userData;e.userData={};const c=e.children;e.children=[];const h=e.clone(!1);if(lC(h),e.userData=l,e.children=c,s[e.uuid]={original:e,clone:h},hC&&console.log("ADD",e,h),e.type==="SkinnedMesh"&&(o[e.uuid]={original:e,clone:h}),i?.visible!==void 0&&(h.visible=i.visible),i!=null&&i.idProvider){h.uuid=i.idProvider.generateUUID();const d=h;d&&(d.guid=h.uuid)}e.animations&&e.animations.length>0&&(h.animations=[...e.animations]);const u=e.parent;if(u&&u.add(h),i!=null&&i.position?gr(h,i.position):h.position.copy(e.position),i!=null&&i.rotation?Ca(h,i.rotation):h.quaternion.copy(e.quaternion),i!=null&&i.scale?h.scale.copy(i.scale):h.scale.copy(e.scale),i!=null&&i.parent&&i.parent!=="scene"){let d=null;if(typeof i.parent=="string"?d=fg(i.parent,n.scene,!0):d=i.parent,d){const f=i.keepWorldPosition===!0?d.attach:d.add;f?f.call(d,h):console.error("Invalid parent object",d,"received when instantiating:",e)}else console.warn("could not find parent:",i.parent)}for(const[d,f]of Object.entries(e.userData))d!=="components"&&(h.userData[d]=f);if((a=e.userData)!=null&&a.components){const d=e.userData.components,f=[];h.userData.components=f;for(let m=0;m<d.length;m++){const g=d[m],v=new g.constructor;o0(v,g),g[Yy]!==void 0&&(v[Yy]=g[Yy]),f.push(v),v.gameObject=h,r.push(v),s[g.guid]={original:g,clone:v},NA.dispatchComponentLifecycleEvent(FA.Added,v)}}i&&(i.position=void 0,i.rotation=void 0,i.scale=void 0,i.parent=void 0);for(const d in e.children){const f=e.children[d],m=J8(n,f,i,r,s,o);m&&h.add(m)}return h}function tfe(n,e){for(const i in n){const r=n[i],s=r.original,o=s.skeleton,a=r.clone;if(!o){console.warn("Skinned mesh has no skeleton?",r);continue}const l=o.bones,c=a.skeleton.clone();a.skeleton=c,a.bindMatrix.clone().copy(s.bindMatrix),a.bindMatrixInverse.copy(s.bindMatrixInverse);const h=[];c.bones=h;for(let u=0;u<l.length;u++){const d=l[u],f=e[d.uuid].clone;h.push(f)}}for(const i in n){const r=n[i].clone;r.skeleton.update(),r.bind(r.skeleton,r.bindMatrix),r.updateMatrixWorld(!0)}}function ife(n){var e;for(const i in n){const r=n[i].clone;if(r!=null&&r.isObject3D&&(e=r?.userData)!=null&&e.components)for(let s=0;s<r.userData.components.length;s++){const o=r.userData.components[s],a=Object.entries(o);for(const[l,c]of a)if(Array.isArray(c)){const h=[];o[l]=h;for(let u=0;u<c.length;u++){const d=c[u];if(typeof d!="object"){h.push(d);continue}const f=K8(o,l,d,n);f!==void 0?h.push(f):h.push(d)}}else if(typeof c=="object"){const h=K8(o,l,c,n);h!==void 0&&(o[l]=h)}}}}function K8(n,e,i,r){var s,o;if(i!=null)if(i.isComponent===!0){const a=i.gameObject;if(a){const l=a.uuid,c=(s=r[l])==null?void 0:s.clone;if(!c){hC&&console.log("reference did not change",e,n,i);return}const h=a.userData.components.indexOf(i);if(h>=0&&c.isObject3D)return hC&&console.log(e,l),c.userData.components[h];console.warn("could not find component",e,i)}}else if(i.isObject3D===!0){if(e==="gameObject")return;const a=i;if(a){const l=a.uuid,c=(o=r[l])==null?void 0:o.clone;if(c)return hC&&console.log(e,"old",i,"new",c),c}}else{if(i.isVector4||i.isVector3||i.isVector2||i.isQuaternion||i.isEuler||i.isColor===!0)return i.clone();if(i.isEventList===!0)return i.__internalOnInstantiate(r)}}var Z8={exports:{}},$8={exports:{}};(function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(i,r){return i<<r|i>>>32-r},rotr:function(i,r){return i<<32-r|i>>>r},endian:function(i){if(i.constructor==Number)return e.rotl(i,8)&16711935|e.rotl(i,24)&4278255360;for(var r=0;r<i.length;r++)i[r]=e.endian(i[r]);return i},randomBytes:function(i){for(var r=[];i>0;i--)r.push(Math.floor(Math.random()*256));return r},bytesToWords:function(i){for(var r=[],s=0,o=0;s<i.length;s++,o+=8)r[o>>>5]|=i[s]<<24-o%32;return r},wordsToBytes:function(i){for(var r=[],s=0;s<i.length*32;s+=8)r.push(i[s>>>5]>>>24-s%32&255);return r},bytesToHex:function(i){for(var r=[],s=0;s<i.length;s++)r.push((i[s]>>>4).toString(16)),r.push((i[s]&15).toString(16));return r.join("")},hexToBytes:function(i){for(var r=[],s=0;s<i.length;s+=2)r.push(parseInt(i.substr(s,2),16));return r},bytesToBase64:function(i){for(var r=[],s=0;s<i.length;s+=3)for(var o=i[s]<<16|i[s+1]<<8|i[s+2],a=0;a<4;a++)s*8+a*6<=i.length*8?r.push(n.charAt(o>>>6*(3-a)&63)):r.push("=");return r.join("")},base64ToBytes:function(i){i=i.replace(/[^A-Z0-9+\/]/ig,"");for(var r=[],s=0,o=0;s<i.length;o=++s%4)o!=0&&r.push((n.indexOf(i.charAt(s-1))&Math.pow(2,-2*o+8)-1)<<o*2|n.indexOf(i.charAt(s))>>>6-o*2);return r}};$8.exports=e})();var nfe=$8.exports,Yk={utf8:{stringToBytes:function(n){return Yk.bin.stringToBytes(unescape(encodeURIComponent(n)))},bytesToString:function(n){return decodeURIComponent(escape(Yk.bin.bytesToString(n)))}},bin:{stringToBytes:function(n){for(var e=[],i=0;i<n.length;i++)e.push(n.charCodeAt(i)&255);return e},bytesToString:function(n){for(var e=[],i=0;i<n.length;i++)e.push(String.fromCharCode(n[i]));return e.join("")}}},eV=Yk;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var rfe=function(n){return n!=null&&(tV(n)||sfe(n)||!!n._isBuffer)};function tV(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function sfe(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&tV(n.slice(0,0))}(function(){var n=nfe,e=eV.utf8,i=rfe,r=eV.bin,s=function(o,a){o.constructor==String?a&&a.encoding==="binary"?o=r.stringToBytes(o):o=e.stringToBytes(o):i(o)?o=Array.prototype.slice.call(o,0):!Array.isArray(o)&&o.constructor!==Uint8Array&&(o=o.toString());for(var l=n.bytesToWords(o),c=o.length*8,h=1732584193,u=-271733879,d=-1732584194,f=271733878,m=0;m<l.length;m++)l[m]=(l[m]<<8|l[m]>>>24)&16711935|(l[m]<<24|l[m]>>>8)&4278255360;l[c>>>5]|=128<<c%32,l[(c+64>>>9<<4)+14]=c;for(var g=s._ff,v=s._gg,y=s._hh,A=s._ii,m=0;m<l.length;m+=16){var b=h,x=u,_=d,w=f;h=g(h,u,d,f,l[m+0],7,-680876936),f=g(f,h,u,d,l[m+1],12,-389564586),d=g(d,f,h,u,l[m+2],17,606105819),u=g(u,d,f,h,l[m+3],22,-1044525330),h=g(h,u,d,f,l[m+4],7,-176418897),f=g(f,h,u,d,l[m+5],12,1200080426),d=g(d,f,h,u,l[m+6],17,-1473231341),u=g(u,d,f,h,l[m+7],22,-45705983),h=g(h,u,d,f,l[m+8],7,1770035416),f=g(f,h,u,d,l[m+9],12,-1958414417),d=g(d,f,h,u,l[m+10],17,-42063),u=g(u,d,f,h,l[m+11],22,-1990404162),h=g(h,u,d,f,l[m+12],7,1804603682),f=g(f,h,u,d,l[m+13],12,-40341101),d=g(d,f,h,u,l[m+14],17,-1502002290),u=g(u,d,f,h,l[m+15],22,1236535329),h=v(h,u,d,f,l[m+1],5,-165796510),f=v(f,h,u,d,l[m+6],9,-1069501632),d=v(d,f,h,u,l[m+11],14,643717713),u=v(u,d,f,h,l[m+0],20,-373897302),h=v(h,u,d,f,l[m+5],5,-701558691),f=v(f,h,u,d,l[m+10],9,38016083),d=v(d,f,h,u,l[m+15],14,-660478335),u=v(u,d,f,h,l[m+4],20,-405537848),h=v(h,u,d,f,l[m+9],5,568446438),f=v(f,h,u,d,l[m+14],9,-1019803690),d=v(d,f,h,u,l[m+3],14,-187363961),u=v(u,d,f,h,l[m+8],20,1163531501),h=v(h,u,d,f,l[m+13],5,-1444681467),f=v(f,h,u,d,l[m+2],9,-51403784),d=v(d,f,h,u,l[m+7],14,1735328473),u=v(u,d,f,h,l[m+12],20,-1926607734),h=y(h,u,d,f,l[m+5],4,-378558),f=y(f,h,u,d,l[m+8],11,-2022574463),d=y(d,f,h,u,l[m+11],16,1839030562),u=y(u,d,f,h,l[m+14],23,-35309556),h=y(h,u,d,f,l[m+1],4,-1530992060),f=y(f,h,u,d,l[m+4],11,1272893353),d=y(d,f,h,u,l[m+7],16,-155497632),u=y(u,d,f,h,l[m+10],23,-1094730640),h=y(h,u,d,f,l[m+13],4,681279174),f=y(f,h,u,d,l[m+0],11,-358537222),d=y(d,f,h,u,l[m+3],16,-722521979),u=y(u,d,f,h,l[m+6],23,76029189),h=y(h,u,d,f,l[m+9],4,-640364487),f=y(f,h,u,d,l[m+12],11,-421815835),d=y(d,f,h,u,l[m+15],16,530742520),u=y(u,d,f,h,l[m+2],23,-995338651),h=A(h,u,d,f,l[m+0],6,-198630844),f=A(f,h,u,d,l[m+7],10,1126891415),d=A(d,f,h,u,l[m+14],15,-1416354905),u=A(u,d,f,h,l[m+5],21,-57434055),h=A(h,u,d,f,l[m+12],6,1700485571),f=A(f,h,u,d,l[m+3],10,-1894986606),d=A(d,f,h,u,l[m+10],15,-1051523),u=A(u,d,f,h,l[m+1],21,-2054922799),h=A(h,u,d,f,l[m+8],6,1873313359),f=A(f,h,u,d,l[m+15],10,-30611744),d=A(d,f,h,u,l[m+6],15,-1560198380),u=A(u,d,f,h,l[m+13],21,1309151649),h=A(h,u,d,f,l[m+4],6,-145523070),f=A(f,h,u,d,l[m+11],10,-1120210379),d=A(d,f,h,u,l[m+2],15,718787259),u=A(u,d,f,h,l[m+9],21,-343485551),h=h+b>>>0,u=u+x>>>0,d=d+_>>>0,f=f+w>>>0}return n.endian([h,u,d,f])};s._ff=function(o,a,l,c,h,u,d){var f=o+(a&l|~a&c)+(h>>>0)+d;return(f<<u|f>>>32-u)+a},s._gg=function(o,a,l,c,h,u,d){var f=o+(a&c|l&~c)+(h>>>0)+d;return(f<<u|f>>>32-u)+a},s._hh=function(o,a,l,c,h,u,d){var f=o+(a^l^c)+(h>>>0)+d;return(f<<u|f>>>32-u)+a},s._ii=function(o,a,l,c,h,u,d){var f=o+(l^(a|~c))+(h>>>0)+d;return(f<<u|f>>>32-u)+a},s._blocksize=16,s._digestsize=16,Z8.exports=function(o,a){if(o==null)throw new Error("Illegal argument "+o);var l=n.wordsToBytes(s(o,a));return a&&a.asBytes?l:a&&a.asString?r.bytesToString(l):n.bytesToHex(l)}})();var ofe=Z8.exports;const afe=IS(ofe);class Jk{constructor(e,i,r,s){p(this,"success"),p(this,"filename"),p(this,"hash"),p(this,"size"),p(this,"url"),this.success=e,this.filename=i,this.hash=r,this.size=s}}async function iV(n,e){const i=await n.arrayBuffer(),r=Kk(i),s=n.name.split(".").pop(),o=r+"."+s,a=n.name.split(".").shift();console.assert(a!==void 0);const l={alias:a,filename:o},c=await(await fetch(e+"/exists",{method:"POST",body:JSON.stringify(l)})).json();if(c.success||console.warn("exists check did fail"),c.exists)return console.log("file already exists",r),new Jk(!0,o,r,n.size);console.log("begin uploading file",a,n.size);const h=new FormData;h.append("file",n);const u={};u.filesize=n.size,a&&(u.alias=a);const d=await(await fetch(e+"/upload/file",{method:"POST",body:h,headers:u})).json();if(d?.success===!1)return d.message!==void 0?console.error("Upload failed:",d.message):console.error("Upload failed"),null;console.assert(d.hash_sum===r,"hash sum did not match","received:",d.hash_sum,"expected:",r),d.success&&console.log("successfully uploaded",r,d.id);const f=new Jk(d.success,o,r,n.size);return f.url=e,f}function Kk(n){return afe(new Uint8Array(n))}async function Zk(n,e,i,r,s=!1){try{const o=await fetch(r+"/download/file",{method:"POST",body:n});if(o.status!==200)return console.error("download failed",o),null;const a=await o.blob(),l=await a.arrayBuffer();s||console.assert(a.size===i,"size mismatch","expected:",i,"got:",a.size);const c=Kk(l);return s||console.assert(c===e,"hash mismatch, downloaded file is invalid"),a.arrayBuffer()}catch(o){console.error(o)}return null}async function nV(n,e){var i;const r=await fetch(n),s=(i=r.body)==null?void 0:i.getReader(),o=r.headers.get("Content-Length"),a=o?parseInt(o):0;if(!s)return null;let l=0;const c=[];for(;;){const{done:d,value:f}=await s.read();if(f&&(c.push(f),l+=f.length,e.call(null,new ProgressEvent("progress",{loaded:l,total:a}))),d)break}const h=new Uint8Array(l);let u=0;for(const d of c)h.set(d,u),u+=d.length;return h}const hd=te("debugaddressables");class rV{constructor(e){p(this,"_context"),p(this,"_assetReferences",{}),p(this,"preUpdate",()=>{}),this._context=e,this._context.pre_update_callbacks.push(this.preUpdate)}dispose(){const e=this._context.pre_update_callbacks.indexOf(this.preUpdate);e>=0&&this._context.pre_update_callbacks.splice(e,1);for(const i in this._assetReferences){const r=this._assetReferences[i];r?.unload()}this._assetReferences={}}findAssetReference(e){return this._assetReferences[e]||null}registerAssetReference(e){return e.uri&&(this._assetReferences[e.uri]?console.warn("Asset reference already registered",e):this._assetReferences[e.uri]=e),e}unregisterAssetReference(e){e.uri&&delete this._assetReferences[e.uri]}}const $k=Symbol("assetReference"),h0=class{constructor(n,e,i=null){p(this,"_loading"),p(this,"_asset"),p(this,"_glbRoot"),p(this,"_url"),p(this,"_progressListeners",[]),p(this,"_hash"),p(this,"_hashedUri"),p(this,"_isLoadingRawBinary",!1),p(this,"_rawBinary"),this._url=n,this._hash=e,n.includes("?v=")?this._hashedUri=n:this._hashedUri=e?n+"?v="+e:n,i!==null&&(this.asset=i),v8(this._url,this.onResolvePrefab.bind(this))}static getOrCreateFromUrl(n,e){if(!e&&(e=Ot.Current,!e))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.');const i=e.addressables,r=i.findAssetReference(n);if(r)return r;const s=new h0(n,e.hash);return i.registerAssetReference(s),s}static getOrCreate(n,e,i){if(typeof n=="string"){if(!i&&(i=Ot.Current,!i))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else i=n.context,n=n.sourceId;const r=Du(n,e);hd&&console.log("GetOrCreate Addressable from",n,e,"FinalPath=",r);const s=i.addressables,o=s.findAssetReference(r);if(o)return o;const a=new h0(r,i.hash);return s.registerAssetReference(a),a}get asset(){return this._glbRoot??this._asset}set asset(n){this._asset=n}get uri(){return this._url}get url(){return this._url}get hasUrl(){return this._url!==void 0&&(this._url.startsWith("http")||this._url.startsWith("blob:")||this._url.startsWith("www.")||this._url.includes("/"))}get rawAsset(){return this._asset}async onResolvePrefab(n){return n===this.uri&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||Ef(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(hd&&console.log("Unload",this.asset),this.asset.scene&&$o(this.asset.scene,!0,!0),$o(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,Ot.Current&&Ot.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,hd&&console.log("Preload",this._hashedUri);const n=await nV(this._hashedUri,e=>{this.raiseProgressEvent(e)});return this._rawBinary=n?.buffer??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(n){if(hd&&console.log("loadAssetAsync",this.uri),!this.mustLoad)return this.asset;if(n&&this._progressListeners.push(n),this._loading!==void 0)return this._loading.then(r=>this.asset);const e=Ot.Current;this._rawBinary?(this._loading=ul().parseSync(e,this._rawBinary,this.uri,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(hd&&console.log("Load async",this.uri),this._loading=ul().loadSync(e,this._hashedUri,this.uri,null,r=>{this.raiseProgressEvent(r)}));const i=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(i),this._loading=void 0,i)return i[$k]=this,this._glbRoot&&(this._glbRoot[$k]=this),this.asset&&(this.asset[$k]=this),qS(e),i.scene!==void 0&&(this.asset=i),this.asset}async instantiate(n){return this.onInstantiate(n,!1)}async instantiateSynced(n,e=!0){return this.onInstantiate(n,!0,e)}beginListenDownload(n){this._progressListeners.indexOf(n)<0&&this._progressListeners.push(n)}endListenDownload(n){const e=this._progressListeners.indexOf(n);e>=0&&this._progressListeners.splice(e,1)}raiseProgressEvent(n){for(const e of this._progressListeners)e(this,n)}async onInstantiate(n,e=!1,i){const r=Ot.Current,s=new Vl;if(n instanceof ve?s.parent=n:n&&(Object.assign(s,n),s.cloneAssign(n)),s.parent||(s.parent=r.scene),this.mustLoad&&await this.loadAssetAsync(),hd&&console.log("Instantiate",this.uri,"parent:",n),this.asset){hd&&console.log("Add to scene",this.asset);let o=h0.currentlyInstantiating.get(this.uri);if(o!==void 0&&o>=1e4)return console.error("Recursive or too many instantiations of "+this.uri+" in the same frame ("+o+")"),null;try{if(o===void 0&&(o=0),o+=1,h0.currentlyInstantiating.set(this.uri,o),e){s.context=r;const a=this.asset;a.guid=this.uri;const l=kk(a,s,void 0,i);if(l)return l}else{const a=c0(this.asset,s);if(a)return a}}finally{r.post_render_callbacks.push(()=>{o===void 0||o<0?o=0:o-=1,h0.currentlyInstantiating.set(this.uri,o)})}}else hd&&console.warn("Failed to load asset",this.uri);return null}tryGetActualGameObjectRoot(n){if(n&&n.scene){const e=n.scene;return e.isGroup&&e.children.length===1&&e.children[0].name+"glb"===e.name?e.children[0]:e}return null}};let $t=h0;p($t,"currentlyInstantiating",new Map);class lfe extends La{constructor(){super([$t],"AssetReferenceSerializer")}onSerialize(e,i){if(e&&e.uri!==void 0&&typeof e.uri=="string")return e.uri}onDeserialize(e,i){if(typeof e=="string")return i.context?i.gltfId?$t.getOrCreate(i.gltfId,e,i.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(e instanceof ve){if(!i.context)return console.error("Missing context"),null;if(!i.gltfId)return console.error("Missing source id"),null;const r=e,s=i.context,o=r.guid??r.uuid,a=s.addressables.findAssetReference(o);if(a)return a;const l=new $t(o,void 0,r);return s.addressables.registerAssetReference(l),l}return null}}new lfe;const cfe=Promise.resolve(null),mC=class{constructor(n){p(this,"url"),p(this,"_bitmap"),p(this,"_bitmapObject"),p(this,"loader",null),this.url=n}static getOrCreate(n){let e=mC.imageReferences.get(n);return e||(e=new mC(n),mC.imageReferences.set(n,e)),e}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const n=new Image;return n.src=this.url,n}createTexture(){return this.url?(this.loader||(this.loader=new Kl),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):cfe}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((n,e)=>{const i=document.createElement("img");i.addEventListener("load",()=>{this._bitmap=createImageBitmap(i).then(r=>(this._bitmapObject=r,n(r),r))}),i.addEventListener("error",r=>{console.error("Failed to load image:"+this.url,r),n(null)}),i.src=this.url}),this._bitmap)}};let gC=mC;p(gC,"imageReferences",new Map);class sV extends La{constructor(){super([gC],"ImageReferenceSerializer")}onSerialize(e,i){return null}onDeserialize(e,i){if(typeof e=="string"){const r=Du(i.gltfId,e);return gC.getOrCreate(r)}}}new sV;const vC=class{constructor(n){p(this,"url"),p(this,"res"),this.url=n}static getOrCreate(n){let e=vC.cache.get(n);return e||(e=new vC(n),vC.cache.set(n,e)),e}async loadRaw(){return this.res||(this.res=fetch(this.url)),this.res.then(n=>n.blob())}async loadText(){return this.res||(this.res=fetch(this.url)),this.res.then(n=>n.text())}};let yC=vC;p(yC,"cache",new Map);class oV extends La{constructor(){super([yC],"FileReferenceSerializer")}onSerialize(e,i){return null}onDeserialize(e,i){if(typeof e=="string"){const r=Du(i.gltfId,e);return yC.getOrCreate(r)}}}new oV;class hfe{constructor(e){p(this,"context"),p(this,"mixers",[]),this.context=e}onDestroy(){this.mixers.forEach(e=>e.stopAllAction()),this.mixers.length=0}registerAnimationMixer(e){if(!e){console.warn("AnimationsRegistry.registerAnimationMixer called with null or undefined mixer");return}this.mixers.includes(e)||this.mixers.push(e)}unregisterAnimationMixer(e){if(!e)return;const i=this.mixers.indexOf(e);i!==-1&&this.mixers.splice(i,1)}}class u0{static tryGetActionsFromMixer(e){return e._actions||null}static tryGetAnimationClipsFromObjectHierarchy(e,i){if(i||(i=new Array),e)e.animations&&i.push(...e.animations);else return i;if(e.children)for(const r of e.children)this.tryGetAnimationClipsFromObjectHierarchy(r,i);return i}static assignAnimationsFromFile(e,i){if(!e||!e.animations)return;for(let s=0;s<e.animations.length;s++){const o=e.animations[s];if(!(!o.tracks||o.tracks.length<=0))for(const a in o.tracks){const l=o.tracks[a],c=Yt.parseTrackName(l.name);let h=Yt.findNode(e.scene,c.nodeName);if(!h){const d=l.__objectName??l.name.substring(0,l.name.indexOf("."));if(h=e.scene.getObjectByProperty("uuid",d),!h)continue}let u=r(h);if(!u){if(!(i!=null&&i.createAnimationComponent)){console.warn("No AnimationComponent found in parent hierarchy of object and no 'createAnimationComponent' callback was provided in options.");continue}u=i.createAnimationComponent(e.scene,o)}u.addClip&&u.addClip(o)}}function r(s){var o;if(!s)return null;const a=(o=s.userData)==null?void 0:o.components;if(a&&a.length>0){for(let l=0;l<a.length;l++)if(a[l].isAnimationComponent===!0)return s}return r(s.parent)}}}var AC=(n=>(n.Visible="application-visible",n.Hidden="application-hidden",n.MuteChanged="application-mutechanged",n))(AC||{});let bC=!1;const d0=[];function Tf(){if(bC)return;it()&&console.debug("User interaction registered: audio can now be played"),bC=!0;const n=[...d0];d0.length=0,n.forEach(e=>e())}document.addEventListener("mousedown",Tf),document.addEventListener("pointerup",Tf),document.addEventListener("click",Tf),document.addEventListener("dragstart",Tf),document.addEventListener("touchend",Tf),document.addEventListener("keydown",Tf),Et.onXRSessionStart(()=>{Tf()});const aV=class extends EventTarget{constructor(n){super(),p(this,"_mute",!1),p(this,"context"),p(this,"_isVisible",!0),this.context=n,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}static get userInteractionRegistered(){return bC}static registerWaitForInteraction(n){if(n!==null){if(bC){n();return}d0.indexOf(n)===-1&&d0.push(n)}}static unregisterWaitForInteraction(n){const e=d0.indexOf(n);e!==-1&&d0.splice(e,1)}get muted(){return this._mute}set muted(n){n!==this._mute&&(this._mute=n,this.dispatchEvent(new Event("application-mutechanged")))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(n){switch(n.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event("application-hidden"));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event("application-visible"));break}}};let kh=aV;p(kh,"registerWaitForAllowAudio",aV.registerWaitForInteraction);function*lV(n,e=null){const i=e?e.time:Ot.Current.time,r=i.time;for(;i.time-r<n;)yield}function*ufe(n){for(let e=0;e<n;e++)yield}function*cV(n){let e=!0;for(n.then(()=>e=!1),n.catch(()=>e=!1);e;)yield}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var hV=function(n){return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))};try{URL.revokeObjectURL(hV(""))}catch{hV=function(n){return"data:application/javascript;charset=UTF-8,"+encodeURI(n)}}var ir=Uint8Array,ao=Uint16Array,p0=Uint32Array,xC=new ir([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_C=new ir([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),eO=new ir([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),uV=function(n,e){for(var i=new ao(31),r=0;r<31;++r)i[r]=e+=1<<n[r-1];for(var s=new p0(i[30]),r=1;r<30;++r)for(var o=i[r];o<i[r+1];++o)s[o]=o-i[r]<<5|r;return[i,s]},dV=uV(xC,2),pV=dV[0],tO=dV[1];pV[28]=258,tO[258]=28;for(var fV=uV(_C,0),dfe=fV[0],mV=fV[1],iO=new ao(32768),sn=0;sn<32768;++sn){var ud=(sn&43690)>>>1|(sn&21845)<<1;ud=(ud&52428)>>>2|(ud&13107)<<2,ud=(ud&61680)>>>4|(ud&3855)<<4,iO[sn]=((ud&65280)>>>8|(ud&255)<<8)>>>1}for(var fc=function(n,e,i){for(var r=n.length,s=0,o=new ao(e);s<r;++s)++o[n[s]-1];var a=new ao(e);for(s=0;s<e;++s)a[s]=a[s-1]+o[s-1]<<1;var l;if(i){l=new ao(1<<e);var c=15-e;for(s=0;s<r;++s)if(n[s])for(var h=s<<4|n[s],u=e-n[s],d=a[n[s]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)l[iO[d]>>>c]=h}else for(l=new ao(r),s=0;s<r;++s)n[s]&&(l[s]=iO[a[n[s]-1]++]>>>15-n[s]);return l},dd=new ir(288),sn=0;sn<144;++sn)dd[sn]=8;for(var sn=144;sn<256;++sn)dd[sn]=9;for(var sn=256;sn<280;++sn)dd[sn]=7;for(var sn=280;sn<288;++sn)dd[sn]=8;for(var tb=new ir(32),sn=0;sn<32;++sn)tb[sn]=5;var pfe=fc(dd,9,0),ffe=fc(dd,9,1),mfe=fc(tb,5,0),gfe=fc(tb,5,1),nO=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},Il=function(n,e,i){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&i},rO=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(e&7)},sO=function(n){return(n/8|0)+(n&7&&1)},oO=function(n,e,i){(e==null||e<0)&&(e=0),(i==null||i>n.length)&&(i=n.length);var r=new(n instanceof ao?ao:n instanceof p0?p0:ir)(i-e);return r.set(n.subarray(e,i)),r},vfe=function(n,e,i){var r=n.length;if(!r||i&&!i.l&&r<5)return e||new ir(0);var s=!e||i,o=!i||i.i;i||(i={}),e||(e=new ir(r*3));var a=function(Ee){var et=e.length;if(Ee>et){var We=new ir(Math.max(et*2,Ee));We.set(e),e=We}},l=i.f||0,c=i.p||0,h=i.b||0,u=i.l,d=i.d,f=i.m,m=i.n,g=r*8;do{if(!u){i.f=l=Il(n,c,1);var v=Il(n,c+1,3);if(c+=3,v)if(v==1)u=ffe,d=gfe,f=9,m=5;else if(v==2){var y=Il(n,c,31)+257,A=Il(n,c+10,15)+4,b=y+Il(n,c+5,31)+1;c+=14;for(var x=new ir(b),_=new ir(19),w=0;w<A;++w)_[eO[w]]=Il(n,c+w*3,7);c+=A*3;for(var T=nO(_),M=(1<<T)-1,R=fc(_,T,1),w=0;w<b;){var B=R[Il(n,c,M)];c+=B&15;var E=B>>>4;if(E<16)x[w++]=E;else{var P=0,O=0;for(E==16?(O=3+Il(n,c,3),c+=2,P=x[w-1]):E==17?(O=3+Il(n,c,7),c+=3):E==18&&(O=11+Il(n,c,127),c+=7);O--;)x[w++]=P}}var N=x.subarray(0,y),L=x.subarray(y);f=nO(N),m=nO(L),u=fc(N,f,1),d=fc(L,m,1)}else throw"invalid block type";else{var E=sO(c)+4,Q=n[E-4]|n[E-3]<<8,D=E+Q;if(D>r){if(o)throw"unexpected EOF";break}s&&a(h+Q),e.set(n.subarray(E,D),h),i.b=h+=Q,i.p=c=D*8;continue}if(c>g){if(o)throw"unexpected EOF";break}}s&&a(h+131072);for(var F=(1<<f)-1,H=(1<<m)-1,K=c;;K=c){var P=u[rO(n,c)&F],Z=P>>>4;if(c+=P&15,c>g){if(o)throw"unexpected EOF";break}if(!P)throw"invalid length/literal";if(Z<256)e[h++]=Z;else if(Z==256){K=c,u=null;break}else{var oe=Z-254;if(Z>264){var w=Z-257,we=xC[w];oe=Il(n,c,(1<<we)-1)+pV[w],c+=we}var Oe=d[rO(n,c)&H],se=Oe>>>4;if(!Oe)throw"invalid distance";c+=Oe&15;var L=dfe[se];if(se>3){var we=_C[se];L+=rO(n,c)&(1<<we)-1,c+=we}if(c>g){if(o)throw"unexpected EOF";break}s&&a(h+131072);for(var _e=h+oe;h<_e;h+=4)e[h]=e[h-L],e[h+1]=e[h+1-L],e[h+2]=e[h+2-L],e[h+3]=e[h+3-L];h=_e}}i.l=u,i.p=K,i.b=h,u&&(l=1,i.m=f,i.d=d,i.n=m)}while(!l);return h==e.length?e:oO(e,0,h)},Oh=function(n,e,i){i<<=e&7;var r=e/8|0;n[r]|=i,n[r+1]|=i>>>8},ib=function(n,e,i){i<<=e&7;var r=e/8|0;n[r]|=i,n[r+1]|=i>>>8,n[r+2]|=i>>>16},aO=function(n,e){for(var i=[],r=0;r<n.length;++r)n[r]&&i.push({s:r,f:n[r]});var s=i.length,o=i.slice();if(!s)return[cO,0];if(s==1){var a=new ir(i[0].s+1);return a[i[0].s]=1,[a,1]}i.sort(function(w,T){return w.f-T.f}),i.push({s:-1,f:25001});var l=i[0],c=i[1],h=0,u=1,d=2;for(i[0]={s:-1,f:l.f+c.f,l,r:c};u!=s-1;)l=i[i[h].f<i[d].f?h++:d++],c=i[h!=u&&i[h].f<i[d].f?h++:d++],i[u++]={s:-1,f:l.f+c.f,l,r:c};for(var f=o[0].s,r=1;r<s;++r)o[r].s>f&&(f=o[r].s);var m=new ao(f+1),g=lO(i[u-1],m,0);if(g>e){var r=0,v=0,y=g-e,A=1<<y;for(o.sort(function(T,M){return m[M.s]-m[T.s]||T.f-M.f});r<s;++r){var b=o[r].s;if(m[b]>e)v+=A-(1<<g-m[b]),m[b]=e;else break}for(v>>>=y;v>0;){var x=o[r].s;m[x]<e?v-=1<<e-m[x]++-1:++r}for(;r>=0&&v;--r){var _=o[r].s;m[_]==e&&(--m[_],++v)}g=e}return[new ir(m),g]},lO=function(n,e,i){return n.s==-1?Math.max(lO(n.l,e,i+1),lO(n.r,e,i+1)):e[n.s]=i},gV=function(n){for(var e=n.length;e&&!n[--e];);for(var i=new ao(++e),r=0,s=n[0],o=1,a=function(c){i[r++]=c},l=1;l<=e;++l)if(n[l]==s&&l!=e)++o;else{if(!s&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(s),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(s);o=1,s=n[l]}return[i.subarray(0,r),e]},nb=function(n,e){for(var i=0,r=0;r<e.length;++r)i+=n[r]*e[r];return i},wC=function(n,e,i){var r=i.length,s=sO(e+2);n[s]=r&255,n[s+1]=r>>>8,n[s+2]=n[s]^255,n[s+3]=n[s+1]^255;for(var o=0;o<r;++o)n[s+o+4]=i[o];return(s+4+r)*8},vV=function(n,e,i,r,s,o,a,l,c,h,u){Oh(e,u++,i),++s[256];for(var d=aO(s,15),f=d[0],m=d[1],g=aO(o,15),v=g[0],y=g[1],A=gV(f),b=A[0],x=A[1],_=gV(v),w=_[0],T=_[1],M=new ao(19),R=0;R<b.length;++R)M[b[R]&31]++;for(var R=0;R<w.length;++R)M[w[R]&31]++;for(var B=aO(M,7),E=B[0],P=B[1],O=19;O>4&&!E[eO[O-1]];--O);var N=h+5<<3,L=nb(s,dd)+nb(o,tb)+a,Q=nb(s,f)+nb(o,v)+a+14+3*O+nb(M,E)+(2*M[16]+3*M[17]+7*M[18]);if(N<=L&&N<=Q)return wC(e,u,n.subarray(c,c+h));var D,F,H,K;if(Oh(e,u,1+(Q<L)),u+=2,Q<L){D=fc(f,m,0),F=f,H=fc(v,y,0),K=v;var Z=fc(E,P,0);Oh(e,u,x-257),Oh(e,u+5,T-1),Oh(e,u+10,O-4),u+=14;for(var R=0;R<O;++R)Oh(e,u+3*R,E[eO[R]]);u+=3*O;for(var oe=[b,w],we=0;we<2;++we)for(var Oe=oe[we],R=0;R<Oe.length;++R){var se=Oe[R]&31;Oh(e,u,Z[se]),u+=E[se],se>15&&(Oh(e,u,Oe[R]>>>5&127),u+=Oe[R]>>>12)}}else D=pfe,F=dd,H=mfe,K=tb;for(var R=0;R<l;++R)if(r[R]>255){var se=r[R]>>>18&31;ib(e,u,D[se+257]),u+=F[se+257],se>7&&(Oh(e,u,r[R]>>>23&31),u+=xC[se]);var _e=r[R]&31;ib(e,u,H[_e]),u+=K[_e],_e>3&&(ib(e,u,r[R]>>>5&8191),u+=_C[_e])}else ib(e,u,D[r[R]]),u+=F[r[R]];return ib(e,u,D[256]),u+F[256]},yfe=new p0([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),cO=new ir(0),Afe=function(n,e,i,r,s,o){var a=n.length,l=new ir(r+a+5*(1+Math.ceil(a/7e3))+s),c=l.subarray(r,l.length-s),h=0;if(!e||a<8)for(var u=0;u<=a;u+=65535){var d=u+65535;d<a?h=wC(c,h,n.subarray(u,d)):(c[u]=o,h=wC(c,h,n.subarray(u,a)))}else{for(var f=yfe[e-1],m=f>>>13,g=f&8191,v=(1<<i)-1,y=new ao(32768),A=new ao(v+1),b=Math.ceil(i/3),x=2*b,_=function(Ie){return(n[Ie]^n[Ie+1]<<b^n[Ie+2]<<x)&v},w=new p0(25e3),T=new ao(288),M=new ao(32),R=0,B=0,u=0,E=0,P=0,O=0;u<a;++u){var N=_(u),L=u&32767,Q=A[N];if(y[L]=Q,A[N]=L,P<=u){var D=a-u;if((R>7e3||E>24576)&&D>423){h=vV(n,c,0,w,T,M,B,E,O,u-O,h),E=R=B=0,O=u;for(var F=0;F<286;++F)T[F]=0;for(var F=0;F<30;++F)M[F]=0}var H=2,K=0,Z=g,oe=L-Q&32767;if(D>2&&N==_(u-oe))for(var we=Math.min(m,D)-1,Oe=Math.min(32767,u),se=Math.min(258,D);oe<=Oe&&--Z&&L!=Q;){if(n[u+H]==n[u+H-oe]){for(var _e=0;_e<se&&n[u+_e]==n[u+_e-oe];++_e);if(_e>H){if(H=_e,K=oe,_e>we)break;for(var Ee=Math.min(oe,_e-2),et=0,F=0;F<Ee;++F){var We=u-oe+F+32768&32767,Ue=y[We],st=We-Ue+32768&32767;st>et&&(et=st,Q=We)}}}L=Q,Q=y[L],oe+=L-Q+32768&32767}if(K){w[E++]=268435456|tO[H]<<18|mV[K];var ge=tO[H]&31,X=mV[K]&31;B+=xC[ge]+_C[X],++T[257+ge],++M[X],P=u+H,++R}else w[E++]=n[u],++T[n[u]]}}h=vV(n,c,o,w,T,M,B,E,O,u-O,h),!o&&h&7&&(h=wC(c,h+1,cO))}return oO(l,0,r+sO(h)+s)},bfe=function(){for(var n=new p0(256),e=0;e<256;++e){for(var i=e,r=9;--r;)i=(i&1&&3988292384)^i>>>1;n[e]=i}return n}(),xfe=function(){var n=-1;return{p:function(e){for(var i=n,r=0;r<e.length;++r)i=bfe[i&255^e[r]]^i>>>8;n=i},d:function(){return~n}}},_fe=function(n,e,i,r,s){return Afe(n,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):12+e.mem,i,r,!s)},yV=function(n,e){var i={};for(var r in n)i[r]=n[r];for(var r in e)i[r]=e[r];return i},ts=function(n,e,i){for(;i;++e)n[e]=i,i>>>=8},wfe=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Sfe(n,e){return _fe(n,e||{},0,0)}function rb(n,e){return vfe((wfe(n),n.subarray(2,-4)),e)}var AV=function(n,e,i,r){for(var s in n){var o=n[s],a=e+s;o instanceof ir?i[a]=[o,r]:Array.isArray(o)?i[a]=[o[0],yV(r,o[1])]:AV(o,a+"/",i,r)}},bV=typeof TextEncoder<"u"&&new TextEncoder,Cfe=typeof TextDecoder<"u"&&new TextDecoder,Efe=0;try{Cfe.decode(cO,{stream:!0}),Efe=1}catch{}function SC(n,e){if(e){for(var i=new ir(n.length),r=0;r<n.length;++r)i[r]=n.charCodeAt(r);return i}if(bV)return bV.encode(n);for(var s=n.length,o=new ir(n.length+(n.length>>1)),a=0,l=function(d){o[a++]=d},r=0;r<s;++r){if(a+5>o.length){var c=new ir(a+8+(s-r<<1));c.set(o),o=c}var h=n.charCodeAt(r);h<128||e?l(h):h<2048?(l(192|h>>6),l(128|h&63)):h>55295&&h<57344?(h=65536+(h&1047552)|n.charCodeAt(++r)&1023,l(240|h>>18),l(128|h>>12&63),l(128|h>>6&63),l(128|h&63)):(l(224|h>>12),l(128|h>>6&63),l(128|h&63))}return oO(o,0,a)}var hO=function(n){var e=0;if(n)for(var i in n){var r=n[i].length;if(r>65535)throw"extra field too long";e+=r+4}return e},xV=function(n,e,i,r,s,o,a,l){var c=r.length,h=i.extra,u=l&&l.length,d=hO(h);ts(n,e,a!=null?33639248:67324752),e+=4,a!=null&&(n[e++]=20,n[e++]=i.os),n[e]=20,e+=2,n[e++]=i.flag<<1|(o==null&&8),n[e++]=s&&8,n[e++]=i.compression&255,n[e++]=i.compression>>8;var f=new Date(i.mtime==null?Date.now():i.mtime),m=f.getFullYear()-1980;if(m<0||m>119)throw"date not in range 1980-2099";if(ts(n,e,m<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,o!=null&&(ts(n,e,i.crc),ts(n,e+4,o),ts(n,e+8,i.size)),ts(n,e+12,c),ts(n,e+14,d),e+=16,a!=null&&(ts(n,e,u),ts(n,e+6,i.attrs),ts(n,e+10,a),e+=14),n.set(r,e),e+=c,d)for(var g in h){var v=h[g],y=v.length;ts(n,e,+g),ts(n,e+2,y),n.set(v,e+4),e+=4+y}return u&&(n.set(l,e),e+=u),e},Mfe=function(n,e,i,r,s){ts(n,e,101010256),ts(n,e+8,i),ts(n,e+10,i),ts(n,e+12,r),ts(n,e+16,s)};function Tfe(n,e){e||(e={});var i={},r=[];AV(n,"",i,e);var s=0,o=0;for(var a in i){var l=i[a],c=l[0],h=l[1],u=h.level==0?0:8,d=SC(a),f=d.length,m=h.comment,g=m&&SC(m),v=g&&g.length,y=hO(h.extra);if(f>65535)throw"filename too long";var A=u?Sfe(c,h):c,b=A.length,x=xfe();x.p(c),r.push(yV(h,{size:c.length,crc:x.d(),c:A,f:d,m:g,u:f!=a.length||g&&m.length!=v,o:s,compression:u})),s+=30+f+y+b,o+=76+2*(f+y)+(v||0)+b}for(var _=new ir(o+22),w=s,T=o-s,M=0;M<r.length;++M){var d=r[M];xV(_,d.o,d,d.f,d.u,d.c.length);var R=30+d.f.length+hO(d.extra);_.set(d.c,d.o+R),xV(_,s,d,d.f,d.u,d.c.length,d.o,d.m),s+=16+R+(d.m?d.m.length:0)}return Mfe(_,s,r.length,T,w),_}class sb extends QR{constructor(e){super(e),this.type=ur}parse(e){const i=Math.pow(2.7182818,2.2);function r(I,k){let G=0;for(let j=0;j<65536;++j)(j==0||I[j>>3]&1<<(j&7))&&(k[G++]=j);const ee=G-1;for(;G<65536;)k[G++]=0;return ee}function s(I){for(let k=0;k<16384;k++)I[k]={},I[k].len=0,I[k].lit=0,I[k].p=null}const o={l:0,c:0,lc:0};function a(I,k,G,ee,j){for(;G<I;)k=k<<8|X(ee,j),G+=8;G-=I,o.l=k>>G&(1<<I)-1,o.c=k,o.lc=G}const l=new Array(59);function c(I){for(let G=0;G<=58;++G)l[G]=0;for(let G=0;G<65537;++G)l[I[G]]+=1;let k=0;for(let G=58;G>0;--G){const ee=k+l[G]>>1;l[G]=k,k=ee}for(let G=0;G<65537;++G){const ee=I[G];ee>0&&(I[G]=ee|l[ee]++<<6)}}function h(I,k,G,ee,j,Y){const W=k;let ae=0,ce=0;for(;ee<=j;ee++){if(W.value-k.value>G)return!1;a(6,ae,ce,I,W);const xe=o.l;if(ae=o.c,ce=o.lc,Y[ee]=xe,xe==63){if(W.value-k.value>G)throw new Error("Something wrong with hufUnpackEncTable");a(8,ae,ce,I,W);let Re=o.l+6;if(ae=o.c,ce=o.lc,ee+Re>j+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Re--;)Y[ee++]=0;ee--}else if(xe>=59){let Re=xe-59+2;if(ee+Re>j+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Re--;)Y[ee++]=0;ee--}}c(Y)}function u(I){return I&63}function d(I){return I>>6}function f(I,k,G,ee){for(;k<=G;k++){const j=d(I[k]),Y=u(I[k]);if(j>>Y)throw new Error("Invalid table entry");if(Y>14){const W=ee[j>>Y-14];if(W.len)throw new Error("Invalid table entry");if(W.lit++,W.p){const ae=W.p;W.p=new Array(W.lit);for(let ce=0;ce<W.lit-1;++ce)W.p[ce]=ae[ce]}else W.p=new Array(1);W.p[W.lit-1]=k}else if(Y){let W=0;for(let ae=1<<14-Y;ae>0;ae--){const ce=ee[(j<<14-Y)+W];if(ce.len||ce.p)throw new Error("Invalid table entry");ce.len=Y,ce.lit=k,W++}}}return!0}const m={c:0,lc:0};function g(I,k,G,ee){I=I<<8|X(G,ee),k+=8,m.c=I,m.lc=k}const v={c:0,lc:0};function y(I,k,G,ee,j,Y,W,ae,ce){if(I==k){ee<8&&(g(G,ee,j,Y),G=m.c,ee=m.lc),ee-=8;let xe=G>>ee;if(xe=new Uint8Array([xe])[0],ae.value+xe>ce)return!1;const Re=W[ae.value-1];for(;xe-- >0;)W[ae.value++]=Re}else if(ae.value<ce)W[ae.value++]=I;else return!1;v.c=G,v.lc=ee}function A(I){return I&65535}function b(I){const k=A(I);return k>32767?k-65536:k}const x={a:0,b:0};function _(I,k){const G=b(I),ee=b(k),j=G+(ee&1)+(ee>>1),Y=j,W=j-ee;x.a=Y,x.b=W}function w(I,k){const G=A(I),ee=A(k),j=G-(ee>>1)&65535,Y=ee+j-32768&65535;x.a=Y,x.b=j}function T(I,k,G,ee,j,Y,W){const ae=W<16384,ce=G>j?j:G;let xe=1,Re,Je;for(;xe<=ce;)xe<<=1;for(xe>>=1,Re=xe,xe>>=1;xe>=1;){Je=0;const Xe=Je+Y*(j-Re),Ze=Y*xe,vt=Y*Re,ot=ee*xe,wt=ee*Re;let ei,Ni,on,_r;for(;Je<=Xe;Je+=vt){let Li=Je;const ci=Je+ee*(G-Re);for(;Li<=ci;Li+=wt){const Ln=Li+ot,yo=Li+Ze,qn=yo+ot;ae?(_(I[Li+k],I[yo+k]),ei=x.a,on=x.b,_(I[Ln+k],I[qn+k]),Ni=x.a,_r=x.b,_(ei,Ni),I[Li+k]=x.a,I[Ln+k]=x.b,_(on,_r),I[yo+k]=x.a,I[qn+k]=x.b):(w(I[Li+k],I[yo+k]),ei=x.a,on=x.b,w(I[Ln+k],I[qn+k]),Ni=x.a,_r=x.b,w(ei,Ni),I[Li+k]=x.a,I[Ln+k]=x.b,w(on,_r),I[yo+k]=x.a,I[qn+k]=x.b)}if(G&xe){const Ln=Li+Ze;ae?_(I[Li+k],I[Ln+k]):w(I[Li+k],I[Ln+k]),ei=x.a,I[Ln+k]=x.b,I[Li+k]=ei}}if(j&xe){let Li=Je;const ci=Je+ee*(G-Re);for(;Li<=ci;Li+=wt){const Ln=Li+ot;ae?_(I[Li+k],I[Ln+k]):w(I[Li+k],I[Ln+k]),ei=x.a,I[Ln+k]=x.b,I[Li+k]=ei}}Re=xe,xe>>=1}return Je}function M(I,k,G,ee,j,Y,W,ae,ce){let xe=0,Re=0;const Je=W,Xe=Math.trunc(ee.value+(j+7)/8);for(;ee.value<Xe;)for(g(xe,Re,G,ee),xe=m.c,Re=m.lc;Re>=14;){const vt=xe>>Re-14&16383,ot=k[vt];if(ot.len)Re-=ot.len,y(ot.lit,Y,xe,Re,G,ee,ae,ce,Je),xe=v.c,Re=v.lc;else{if(!ot.p)throw new Error("hufDecode issues");let wt;for(wt=0;wt<ot.lit;wt++){const ei=u(I[ot.p[wt]]);for(;Re<ei&&ee.value<Xe;)g(xe,Re,G,ee),xe=m.c,Re=m.lc;if(Re>=ei&&d(I[ot.p[wt]])==(xe>>Re-ei&(1<<ei)-1)){Re-=ei,y(ot.p[wt],Y,xe,Re,G,ee,ae,ce,Je),xe=v.c,Re=v.lc;break}}if(wt==ot.lit)throw new Error("hufDecode issues")}}const Ze=8-j&7;for(xe>>=Ze,Re-=Ze;Re>0;){const vt=k[xe<<14-Re&16383];if(vt.len)Re-=vt.len,y(vt.lit,Y,xe,Re,G,ee,ae,ce,Je),xe=v.c,Re=v.lc;else throw new Error("hufDecode issues")}return!0}function R(I,k,G,ee,j,Y){const W={value:0},ae=G.value,ce=ge(k,G),xe=ge(k,G);G.value+=4;const Re=ge(k,G);if(G.value+=4,ce<0||ce>=65537||xe<0||xe>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Je=new Array(65537),Xe=new Array(16384);s(Xe);const Ze=ee-(G.value-ae);if(h(I,G,Ze,ce,xe,Je),Re>8*(ee-(G.value-ae)))throw new Error("Something wrong with hufUncompress");f(Je,ce,xe,Xe),M(Je,Xe,I,G,Re,xe,Y,j,W)}function B(I,k,G){for(let ee=0;ee<G;++ee)k[ee]=I[k[ee]]}function E(I){for(let k=1;k<I.length;k++){const G=I[k-1]+I[k]-128;I[k]=G}}function P(I,k){let G=0,ee=Math.floor((I.length+1)/2),j=0;const Y=I.length-1;for(;!(j>Y||(k[j++]=I[G++],j>Y));)k[j++]=I[ee++]}function O(I){let k=I.byteLength;const G=new Array;let ee=0;const j=new DataView(I);for(;k>0;){const Y=j.getInt8(ee++);if(Y<0){const W=-Y;k-=W+1;for(let ae=0;ae<W;ae++)G.push(j.getUint8(ee++))}else{const W=Y;k-=2;const ae=j.getUint8(ee++);for(let ce=0;ce<W+1;ce++)G.push(ae)}}return G}function N(I,k,G,ee,j,Y){let W=new DataView(Y.buffer);const ae=G[I.idx[0]].width,ce=G[I.idx[0]].height,xe=3,Re=Math.floor(ae/8),Je=Math.ceil(ae/8),Xe=Math.ceil(ce/8),Ze=ae-(Je-1)*8,vt=ce-(Xe-1)*8,ot={value:0},wt=new Array(xe),ei=new Array(xe),Ni=new Array(xe),on=new Array(xe),_r=new Array(xe);for(let ci=0;ci<xe;++ci)_r[ci]=k[I.idx[ci]],wt[ci]=ci<1?0:wt[ci-1]+Je*Xe,ei[ci]=new Float32Array(64),Ni[ci]=new Uint16Array(64),on[ci]=new Uint16Array(Je*64);for(let ci=0;ci<Xe;++ci){let Ln=8;ci==Xe-1&&(Ln=vt);let yo=8;for(let z=0;z<Je;++z){z==Je-1&&(yo=Ze);for(let ne=0;ne<xe;++ne)Ni[ne].fill(0),Ni[ne][0]=j[wt[ne]++],L(ot,ee,Ni[ne]),Q(Ni[ne],ei[ne]),D(ei[ne]);F(ei);for(let ne=0;ne<xe;++ne)H(ei[ne],on[ne],z*64)}let qn=0;for(let z=0;z<xe;++z){const ne=G[I.idx[z]].type;for(let me=8*ci;me<8*ci+Ln;++me){qn=_r[z][me];for(let ye=0;ye<Re;++ye){const le=ye*64+(me&7)*8;W.setUint16(qn+0*2*ne,on[z][le+0],!0),W.setUint16(qn+1*2*ne,on[z][le+1],!0),W.setUint16(qn+2*2*ne,on[z][le+2],!0),W.setUint16(qn+3*2*ne,on[z][le+3],!0),W.setUint16(qn+4*2*ne,on[z][le+4],!0),W.setUint16(qn+5*2*ne,on[z][le+5],!0),W.setUint16(qn+6*2*ne,on[z][le+6],!0),W.setUint16(qn+7*2*ne,on[z][le+7],!0),qn+=8*2*ne}}if(Re!=Je)for(let me=8*ci;me<8*ci+Ln;++me){const ye=_r[z][me]+8*Re*2*ne,le=Re*64+(me&7)*8;for(let $e=0;$e<yo;++$e)W.setUint16(ye+$e*2*ne,on[z][le+$e],!0)}}}const Li=new Uint16Array(ae);W=new DataView(Y.buffer);for(let ci=0;ci<xe;++ci){G[I.idx[ci]].decoded=!0;const Ln=G[I.idx[ci]].type;if(G[ci].type==2)for(let yo=0;yo<ce;++yo){const qn=_r[ci][yo];for(let z=0;z<ae;++z)Li[z]=W.getUint16(qn+z*2*Ln,!0);for(let z=0;z<ae;++z)W.setFloat32(qn+z*2*Ln,Ae(Li[z]),!0)}}}function L(I,k,G){let ee,j=1;for(;j<64;)ee=k[I.value],ee==65280?j=64:ee>>8==255?j+=ee&255:(G[j]=ee,j++),I.value++}function Q(I,k){k[0]=Ae(I[0]),k[1]=Ae(I[1]),k[2]=Ae(I[5]),k[3]=Ae(I[6]),k[4]=Ae(I[14]),k[5]=Ae(I[15]),k[6]=Ae(I[27]),k[7]=Ae(I[28]),k[8]=Ae(I[2]),k[9]=Ae(I[4]),k[10]=Ae(I[7]),k[11]=Ae(I[13]),k[12]=Ae(I[16]),k[13]=Ae(I[26]),k[14]=Ae(I[29]),k[15]=Ae(I[42]),k[16]=Ae(I[3]),k[17]=Ae(I[8]),k[18]=Ae(I[12]),k[19]=Ae(I[17]),k[20]=Ae(I[25]),k[21]=Ae(I[30]),k[22]=Ae(I[41]),k[23]=Ae(I[43]),k[24]=Ae(I[9]),k[25]=Ae(I[11]),k[26]=Ae(I[18]),k[27]=Ae(I[24]),k[28]=Ae(I[31]),k[29]=Ae(I[40]),k[30]=Ae(I[44]),k[31]=Ae(I[53]),k[32]=Ae(I[10]),k[33]=Ae(I[19]),k[34]=Ae(I[23]),k[35]=Ae(I[32]),k[36]=Ae(I[39]),k[37]=Ae(I[45]),k[38]=Ae(I[52]),k[39]=Ae(I[54]),k[40]=Ae(I[20]),k[41]=Ae(I[22]),k[42]=Ae(I[33]),k[43]=Ae(I[38]),k[44]=Ae(I[46]),k[45]=Ae(I[51]),k[46]=Ae(I[55]),k[47]=Ae(I[60]),k[48]=Ae(I[21]),k[49]=Ae(I[34]),k[50]=Ae(I[37]),k[51]=Ae(I[47]),k[52]=Ae(I[50]),k[53]=Ae(I[56]),k[54]=Ae(I[59]),k[55]=Ae(I[61]),k[56]=Ae(I[35]),k[57]=Ae(I[36]),k[58]=Ae(I[48]),k[59]=Ae(I[49]),k[60]=Ae(I[57]),k[61]=Ae(I[58]),k[62]=Ae(I[62]),k[63]=Ae(I[63])}function D(I){const k=.5*Math.cos(.7853975),G=.5*Math.cos(3.14159/16),ee=.5*Math.cos(3.14159/8),j=.5*Math.cos(3*3.14159/16),Y=.5*Math.cos(5*3.14159/16),W=.5*Math.cos(3*3.14159/8),ae=.5*Math.cos(7*3.14159/16),ce=new Array(4),xe=new Array(4),Re=new Array(4),Je=new Array(4);for(let Xe=0;Xe<8;++Xe){const Ze=Xe*8;ce[0]=ee*I[Ze+2],ce[1]=W*I[Ze+2],ce[2]=ee*I[Ze+6],ce[3]=W*I[Ze+6],xe[0]=G*I[Ze+1]+j*I[Ze+3]+Y*I[Ze+5]+ae*I[Ze+7],xe[1]=j*I[Ze+1]-ae*I[Ze+3]-G*I[Ze+5]-Y*I[Ze+7],xe[2]=Y*I[Ze+1]-G*I[Ze+3]+ae*I[Ze+5]+j*I[Ze+7],xe[3]=ae*I[Ze+1]-Y*I[Ze+3]+j*I[Ze+5]-G*I[Ze+7],Re[0]=k*(I[Ze+0]+I[Ze+4]),Re[3]=k*(I[Ze+0]-I[Ze+4]),Re[1]=ce[0]+ce[3],Re[2]=ce[1]-ce[2],Je[0]=Re[0]+Re[1],Je[1]=Re[3]+Re[2],Je[2]=Re[3]-Re[2],Je[3]=Re[0]-Re[1],I[Ze+0]=Je[0]+xe[0],I[Ze+1]=Je[1]+xe[1],I[Ze+2]=Je[2]+xe[2],I[Ze+3]=Je[3]+xe[3],I[Ze+4]=Je[3]-xe[3],I[Ze+5]=Je[2]-xe[2],I[Ze+6]=Je[1]-xe[1],I[Ze+7]=Je[0]-xe[0]}for(let Xe=0;Xe<8;++Xe)ce[0]=ee*I[16+Xe],ce[1]=W*I[16+Xe],ce[2]=ee*I[48+Xe],ce[3]=W*I[48+Xe],xe[0]=G*I[8+Xe]+j*I[24+Xe]+Y*I[40+Xe]+ae*I[56+Xe],xe[1]=j*I[8+Xe]-ae*I[24+Xe]-G*I[40+Xe]-Y*I[56+Xe],xe[2]=Y*I[8+Xe]-G*I[24+Xe]+ae*I[40+Xe]+j*I[56+Xe],xe[3]=ae*I[8+Xe]-Y*I[24+Xe]+j*I[40+Xe]-G*I[56+Xe],Re[0]=k*(I[Xe]+I[32+Xe]),Re[3]=k*(I[Xe]-I[32+Xe]),Re[1]=ce[0]+ce[3],Re[2]=ce[1]-ce[2],Je[0]=Re[0]+Re[1],Je[1]=Re[3]+Re[2],Je[2]=Re[3]-Re[2],Je[3]=Re[0]-Re[1],I[0+Xe]=Je[0]+xe[0],I[8+Xe]=Je[1]+xe[1],I[16+Xe]=Je[2]+xe[2],I[24+Xe]=Je[3]+xe[3],I[32+Xe]=Je[3]-xe[3],I[40+Xe]=Je[2]-xe[2],I[48+Xe]=Je[1]-xe[1],I[56+Xe]=Je[0]-xe[0]}function F(I){for(let k=0;k<64;++k){const G=I[0][k],ee=I[1][k],j=I[2][k];I[0][k]=G+1.5747*j,I[1][k]=G-.1873*ee-.4682*j,I[2][k]=G+1.8556*ee}}function H(I,k,G){for(let ee=0;ee<64;++ee)k[G+ee]=Mp.toHalfFloat(K(I[ee]))}function K(I){return I<=1?Math.sign(I)*Math.pow(Math.abs(I),2.2):Math.sign(I)*Math.pow(i,Math.abs(I)-1)}function Z(I){return new DataView(I.array.buffer,I.offset.value,I.size)}function oe(I){const k=I.viewer.buffer.slice(I.offset.value,I.offset.value+I.size),G=new Uint8Array(O(k)),ee=new Uint8Array(G.length);return E(G),P(G,ee),new DataView(ee.buffer)}function we(I){const k=I.array.slice(I.offset.value,I.offset.value+I.size),G=rb(k),ee=new Uint8Array(G.length);return E(G),P(G,ee),new DataView(ee.buffer)}function Oe(I){const k=I.viewer,G={value:I.offset.value},ee=new Uint16Array(I.width*I.scanlineBlockSize*(I.channels*I.type)),j=new Uint8Array(8192);let Y=0;const W=new Array(I.channels);for(let vt=0;vt<I.channels;vt++)W[vt]={},W[vt].start=Y,W[vt].end=W[vt].start,W[vt].nx=I.width,W[vt].ny=I.lines,W[vt].size=I.type,Y+=W[vt].nx*W[vt].ny*W[vt].size;const ae=nt(k,G),ce=nt(k,G);if(ce>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(ae<=ce)for(let vt=0;vt<ce-ae+1;vt++)j[vt+ae]=ze(k,G);const xe=new Uint16Array(65536),Re=r(j,xe),Je=ge(k,G);R(I.array,k,G,Je,ee,Y);for(let vt=0;vt<I.channels;++vt){const ot=W[vt];for(let wt=0;wt<W[vt].size;++wt)T(ee,ot.start+wt,ot.nx,ot.size,ot.ny,ot.nx*ot.size,Re)}B(xe,ee,Y);let Xe=0;const Ze=new Uint8Array(ee.buffer.byteLength);for(let vt=0;vt<I.lines;vt++)for(let ot=0;ot<I.channels;ot++){const wt=W[ot],ei=wt.nx*wt.size,Ni=new Uint8Array(ee.buffer,wt.end*2,ei*2);Ze.set(Ni,Xe),Xe+=ei*2,wt.end+=ei}return new DataView(Ze.buffer)}function se(I){const k=I.array.slice(I.offset.value,I.offset.value+I.size),G=rb(k),ee=I.lines*I.channels*I.width,j=I.type==1?new Uint16Array(ee):new Uint32Array(ee);let Y=0,W=0;const ae=new Array(4);for(let ce=0;ce<I.lines;ce++)for(let xe=0;xe<I.channels;xe++){let Re=0;switch(I.type){case 1:ae[0]=Y,ae[1]=ae[0]+I.width,Y=ae[1]+I.width;for(let Je=0;Je<I.width;++Je){const Xe=G[ae[0]++]<<8|G[ae[1]++];Re+=Xe,j[W]=Re,W++}break;case 2:ae[0]=Y,ae[1]=ae[0]+I.width,ae[2]=ae[1]+I.width,Y=ae[2]+I.width;for(let Je=0;Je<I.width;++Je){const Xe=G[ae[0]++]<<24|G[ae[1]++]<<16|G[ae[2]++]<<8;Re+=Xe,j[W]=Re,W++}break}}return new DataView(j.buffer)}function _e(I){const k=I.viewer,G={value:I.offset.value},ee=new Uint8Array(I.width*I.lines*(I.channels*I.type*2)),j={version:Ie(k,G),unknownUncompressedSize:Ie(k,G),unknownCompressedSize:Ie(k,G),acCompressedSize:Ie(k,G),dcCompressedSize:Ie(k,G),rleCompressedSize:Ie(k,G),rleUncompressedSize:Ie(k,G),rleRawSize:Ie(k,G),totalAcUncompressedCount:Ie(k,G),totalDcUncompressedCount:Ie(k,G),acCompression:Ie(k,G)};if(j.version<2)throw new Error("EXRLoader.parse: "+Kt.compression+" version "+j.version+" is unsupported");const Y=new Array;let W=nt(k,G)-2;for(;W>0;){const ot=Ee(k.buffer,G),wt=ze(k,G),ei=wt>>2&3,Ni=(wt>>4)-1,on=new Int8Array([Ni])[0],_r=ze(k,G);Y.push({name:ot,index:on,type:_r,compression:ei}),W-=ot.length+3}const ae=Kt.channels,ce=new Array(I.channels);for(let ot=0;ot<I.channels;++ot){const wt=ce[ot]={},ei=ae[ot];wt.name=ei.name,wt.compression=0,wt.decoded=!1,wt.type=ei.pixelType,wt.pLinear=ei.pLinear,wt.width=I.width,wt.height=I.lines}const xe={idx:new Array(3)};for(let ot=0;ot<I.channels;++ot){const wt=ce[ot];for(let ei=0;ei<Y.length;++ei){const Ni=Y[ei];wt.name==Ni.name&&(wt.compression=Ni.compression,Ni.index>=0&&(xe.idx[Ni.index]=ot),wt.offset=ot)}}let Re,Je,Xe;if(j.acCompressedSize>0)switch(j.acCompression){case 0:Re=new Uint16Array(j.totalAcUncompressedCount),R(I.array,k,G,j.acCompressedSize,Re,j.totalAcUncompressedCount);break;case 1:const ot=I.array.slice(G.value,G.value+j.totalAcUncompressedCount),wt=rb(ot);Re=new Uint16Array(wt.buffer),G.value+=j.totalAcUncompressedCount;break}if(j.dcCompressedSize>0){const ot={array:I.array,offset:G,size:j.dcCompressedSize};Je=new Uint16Array(we(ot).buffer),G.value+=j.dcCompressedSize}if(j.rleRawSize>0){const ot=I.array.slice(G.value,G.value+j.rleCompressedSize),wt=rb(ot);Xe=O(wt.buffer),G.value+=j.rleCompressedSize}let Ze=0;const vt=new Array(ce.length);for(let ot=0;ot<vt.length;++ot)vt[ot]=new Array;for(let ot=0;ot<I.lines;++ot)for(let wt=0;wt<ce.length;++wt)vt[wt].push(Ze),Ze+=ce[wt].width*I.type*2;N(xe,vt,ce,Re,Je,ee);for(let ot=0;ot<ce.length;++ot){const wt=ce[ot];if(!wt.decoded)switch(wt.compression){case 2:let ei=0,Ni=0;for(let on=0;on<I.lines;++on){let _r=vt[ot][ei];for(let Li=0;Li<wt.width;++Li){for(let ci=0;ci<2*wt.type;++ci)ee[_r++]=Xe[Ni+ci*wt.width*wt.height];Ni++}ei++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(ee.buffer)}function Ee(I,k){const G=new Uint8Array(I);let ee=0;for(;G[k.value+ee]!=0;)ee+=1;const j=new TextDecoder().decode(G.slice(k.value,k.value+ee));return k.value=k.value+ee+1,j}function et(I,k,G){const ee=new TextDecoder().decode(new Uint8Array(I).slice(k.value,k.value+G));return k.value=k.value+G,ee}function We(I,k){const G=st(I,k),ee=ge(I,k);return[G,ee]}function Ue(I,k){const G=ge(I,k),ee=ge(I,k);return[G,ee]}function st(I,k){const G=I.getInt32(k.value,!0);return k.value=k.value+4,G}function ge(I,k){const G=I.getUint32(k.value,!0);return k.value=k.value+4,G}function X(I,k){const G=I[k.value];return k.value=k.value+1,G}function ze(I,k){const G=I.getUint8(k.value);return k.value=k.value+1,G}const Ie=function(I,k){let G;return"getBigInt64"in DataView.prototype?G=Number(I.getBigInt64(k.value,!0)):G=I.getUint32(k.value+4,!0)+Number(I.getUint32(k.value,!0)<<32),k.value+=8,G};function Te(I,k){const G=I.getFloat32(k.value,!0);return k.value+=4,G}function Ve(I,k){return Mp.toHalfFloat(Te(I,k))}function Ae(I){const k=(I&31744)>>10,G=I&1023;return(I>>15?-1:1)*(k?k===31?G?NaN:1/0:Math.pow(2,k-15)*(1+G/1024):6103515625e-14*(G/1024))}function nt(I,k){const G=I.getUint16(k.value,!0);return k.value+=2,G}function ct(I,k){return Ae(nt(I,k))}function It(I,k,G,ee){const j=G.value,Y=[];for(;G.value<j+ee-1;){const W=Ee(k,G),ae=st(I,G),ce=ze(I,G);G.value+=3;const xe=st(I,G),Re=st(I,G);Y.push({name:W,pixelType:ae,pLinear:ce,xSampling:xe,ySampling:Re})}return G.value+=1,Y}function V(I,k){const G=Te(I,k),ee=Te(I,k),j=Te(I,k),Y=Te(I,k),W=Te(I,k),ae=Te(I,k),ce=Te(I,k),xe=Te(I,k);return{redX:G,redY:ee,greenX:j,greenY:Y,blueX:W,blueY:ae,whiteX:ce,whiteY:xe}}function U(I,k){const G=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],ee=ze(I,k);return G[ee]}function ue(I,k){const G=ge(I,k),ee=ge(I,k),j=ge(I,k),Y=ge(I,k);return{xMin:G,yMin:ee,xMax:j,yMax:Y}}function Me(I,k){const G=["INCREASING_Y"],ee=ze(I,k);return G[ee]}function De(I,k){const G=Te(I,k),ee=Te(I,k);return[G,ee]}function Pe(I,k){const G=Te(I,k),ee=Te(I,k),j=Te(I,k);return[G,ee,j]}function At(I,k,G,ee,j){if(ee==="string"||ee==="stringvector"||ee==="iccProfile")return et(k,G,j);if(ee==="chlist")return It(I,k,G,j);if(ee==="chromaticities")return V(I,G);if(ee==="compression")return U(I,G);if(ee==="box2i")return ue(I,G);if(ee==="lineOrder")return Me(I,G);if(ee==="float")return Te(I,G);if(ee==="v2f")return De(I,G);if(ee==="v3f")return Pe(I,G);if(ee==="int")return st(I,G);if(ee==="rational")return We(I,G);if(ee==="timecode")return Ue(I,G);if(ee==="preview")return G.value+=j,"skipped";G.value+=j}function ht(I,k,G){const ee={};if(I.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");ee.version=I.getUint8(4);const j=I.getUint8(5);ee.spec={singleTile:!!(j&2),longName:!!(j&4),deepFormat:!!(j&8),multiPart:!!(j&16)},G.value=8;let Y=!0;for(;Y;){const W=Ee(k,G);if(W==0)Y=!1;else{const ae=Ee(k,G),ce=ge(I,G),xe=At(I,k,G,ae,ce);xe===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${ae}'.`):ee[W]=xe}}if(j&-5)throw console.error("THREE.EXRHeader:",ee),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return ee}function je(I,k,G,ee,j){const Y={size:0,viewer:k,array:G,offset:ee,width:I.dataWindow.xMax-I.dataWindow.xMin+1,height:I.dataWindow.yMax-I.dataWindow.yMin+1,channels:I.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:I.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:Ii};switch(I.compression){case"NO_COMPRESSION":Y.lines=1,Y.uncompress=Z;break;case"RLE_COMPRESSION":Y.lines=1,Y.uncompress=oe;break;case"ZIPS_COMPRESSION":Y.lines=1,Y.uncompress=we;break;case"ZIP_COMPRESSION":Y.lines=16,Y.uncompress=we;break;case"PIZ_COMPRESSION":Y.lines=32,Y.uncompress=Oe;break;case"PXR24_COMPRESSION":Y.lines=16,Y.uncompress=se;break;case"DWAA_COMPRESSION":Y.lines=32,Y.uncompress=_e;break;case"DWAB_COMPRESSION":Y.lines=256,Y.uncompress=_e;break;default:throw new Error("EXRLoader.parse: "+I.compression+" is unsupported")}if(Y.scanlineBlockSize=Y.lines,Y.type==1)switch(j){case Hi:Y.getter=ct,Y.inputSize=2;break;case ur:Y.getter=nt,Y.inputSize=2;break}else if(Y.type==2)switch(j){case Hi:Y.getter=Te,Y.inputSize=4;break;case ur:Y.getter=Ve,Y.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+Y.type+" for "+I.compression+".");Y.blockCount=(I.dataWindow.yMax+1)/Y.scanlineBlockSize;for(let ae=0;ae<Y.blockCount;ae++)Ie(k,ee);Y.outputChannels=Y.channels==3?4:Y.channels;const W=Y.width*Y.height*Y.outputChannels;switch(j){case Hi:Y.byteArray=new Float32Array(W),Y.channels<Y.outputChannels&&Y.byteArray.fill(1,0,W);break;case ur:Y.byteArray=new Uint16Array(W),Y.channels<Y.outputChannels&&Y.byteArray.fill(15360,0,W);break;default:console.error("THREE.EXRLoader: unsupported type: ",j);break}return Y.bytesPerLine=Y.width*Y.inputSize*Y.channels,Y.outputChannels==4?(Y.format=Ti,Y.colorSpace=Ii):(Y.format=xp,Y.colorSpace=xo),Y}const He=new DataView(e),St=new Uint8Array(e),Fe={value:0},Kt=ht(He,e,Fe),Le=je(Kt,He,St,Fe,this.type),_t={value:0},ut={R:0,G:1,B:2,A:3,Y:0};for(let I=0;I<Le.height/Le.scanlineBlockSize;I++){const k=ge(He,Fe);Le.size=ge(He,Fe),Le.lines=k+Le.scanlineBlockSize>Le.height?Le.height-k:Le.scanlineBlockSize;const G=Le.size<Le.lines*Le.bytesPerLine?Le.uncompress(Le):Z(Le);Fe.value+=Le.size;for(let ee=0;ee<Le.scanlineBlockSize;ee++){const j=ee+I*Le.scanlineBlockSize;if(j>=Le.height)break;for(let Y=0;Y<Le.channels;Y++){const W=ut[Kt.channels[Y].name];for(let ae=0;ae<Le.width;ae++){_t.value=(ee*(Le.channels*Le.width)+Y*Le.width+ae)*Le.inputSize;const ce=(Le.height-1-j)*(Le.width*Le.outputChannels)+ae*Le.outputChannels+W;Le.byteArray[ce]=Le.getter(G,_t)}}}}return{header:Kt,width:Le.width,height:Le.height,data:Le.byteArray,format:Le.format,colorSpace:Le.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,r,s){function o(a,l){a.colorSpace=l.colorSpace,a.minFilter=Dt,a.magFilter=Dt,a.generateMipmaps=!1,a.flipY=!1,i&&i(a,l)}return super.load(e,o,r,s)}}const Ife=Object.freeze(Object.defineProperty({__proto__:null,EXRLoader:sb},Symbol.toStringTag,{value:"Module"}));class CC extends QR{constructor(e){super(e),this.type=ur}parse(e){const i=function(A,b){switch(A){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(b||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(b||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(b||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(b||""))}},r=`
`,s=function(A,b,x){b=b||1024;let _=A.pos,w=-1,T=0,M="",R=String.fromCharCode.apply(null,new Uint16Array(A.subarray(_,_+128)));for(;0>(w=R.indexOf(r))&&T<b&&_<A.byteLength;)M+=R,T+=R.length,_+=128,R+=String.fromCharCode.apply(null,new Uint16Array(A.subarray(_,_+128)));return-1<w?(x!==!1&&(A.pos+=T+w+1),M+R.slice(0,w)):!1},o=function(A){const b=/^#\?(\S+)/,x=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,_=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,w=/^\s*FORMAT=(\S+)\s*$/,T=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,M={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let R,B;for((A.pos>=A.byteLength||!(R=s(A)))&&i(1,"no header found"),(B=R.match(b))||i(3,"bad initial token"),M.valid|=1,M.programtype=B[1],M.string+=R+`
`;R=s(A),R!==!1;){if(M.string+=R+`
`,R.charAt(0)==="#"){M.comments+=R+`
`;continue}if((B=R.match(x))&&(M.gamma=parseFloat(B[1])),(B=R.match(_))&&(M.exposure=parseFloat(B[1])),(B=R.match(w))&&(M.valid|=2,M.format=B[1]),(B=R.match(T))&&(M.valid|=4,M.height=parseInt(B[1],10),M.width=parseInt(B[2],10)),M.valid&2&&M.valid&4)break}return M.valid&2||i(3,"missing format specifier"),M.valid&4||i(3,"missing image size specifier"),M},a=function(A,b,x){const _=b;if(_<8||_>32767||A[0]!==2||A[1]!==2||A[2]&128)return new Uint8Array(A);_!==(A[2]<<8|A[3])&&i(3,"wrong scanline width");const w=new Uint8Array(4*b*x);w.length||i(4,"unable to allocate buffer space");let T=0,M=0;const R=4*_,B=new Uint8Array(4),E=new Uint8Array(R);let P=x;for(;P>0&&M<A.byteLength;){M+4>A.byteLength&&i(1),B[0]=A[M++],B[1]=A[M++],B[2]=A[M++],B[3]=A[M++],(B[0]!=2||B[1]!=2||(B[2]<<8|B[3])!=_)&&i(3,"bad rgbe scanline format");let O=0,N;for(;O<R&&M<A.byteLength;){N=A[M++];const Q=N>128;if(Q&&(N-=128),(N===0||O+N>R)&&i(3,"bad scanline data"),Q){const D=A[M++];for(let F=0;F<N;F++)E[O++]=D}else E.set(A.subarray(M,M+N),O),O+=N,M+=N}const L=_;for(let Q=0;Q<L;Q++){let D=0;w[T]=E[Q+D],D+=_,w[T+1]=E[Q+D],D+=_,w[T+2]=E[Q+D],D+=_,w[T+3]=E[Q+D],T+=4}P--}return w},l=function(A,b,x,_){const w=A[b+3],T=Math.pow(2,w-128)/255;x[_+0]=A[b+0]*T,x[_+1]=A[b+1]*T,x[_+2]=A[b+2]*T,x[_+3]=1},c=function(A,b,x,_){const w=A[b+3],T=Math.pow(2,w-128)/255;x[_+0]=Mp.toHalfFloat(Math.min(A[b+0]*T,65504)),x[_+1]=Mp.toHalfFloat(Math.min(A[b+1]*T,65504)),x[_+2]=Mp.toHalfFloat(Math.min(A[b+2]*T,65504)),x[_+3]=Mp.toHalfFloat(1)},h=new Uint8Array(e);h.pos=0;const u=o(h),d=u.width,f=u.height,m=a(h.subarray(h.pos),d,f);let g,v,y;switch(this.type){case Hi:y=m.length/4;const A=new Float32Array(y*4);for(let x=0;x<y;x++)l(m,x*4,A,x*4);g=A,v=Hi;break;case ur:y=m.length/4;const b=new Uint16Array(y*4);for(let x=0;x<y;x++)c(m,x*4,b,x*4);g=b,v=ur;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:d,height:f,data:g,header:u.string,gamma:u.gamma,exposure:u.exposure,type:v}}setDataType(e){return this.type=e,this}load(e,i,r,s){function o(a,l){switch(a.type){case Hi:case ur:a.colorSpace=Ii,a.minFilter=Dt,a.magFilter=Dt,a.generateMipmaps=!1,a.flipY=!0;break}i&&i(a,l)}return super.load(e,o,r,s)}}const Rfe=Object.freeze(Object.defineProperty({__proto__:null,RGBELoader:CC},Symbol.toStringTag,{value:"Module"})),_V="NEEDLE_lightmaps",ob=te("debuglightmapsextension")||te("debuglightmaps");var pd=(n=>(n[n.Lightmap=0]="Lightmap",n[n.Skybox=1]="Skybox",n[n.Reflection=2]="Reflection",n))(pd||{});class Pfe{constructor(e,i,r){p(this,"parser"),p(this,"registry"),p(this,"source"),this.parser=e,this.registry=i,this.source=r}get name(){return _V}afterRoot(e){const i=this.parser.json.extensions;if(i){const r=i[_V];if(r){const s=r.textures;return s!=null&&s.length?(ob&&console.log(r),new Promise(async(o,a)=>{const l=[];for(const h of s)if(h.pointer){ob&&console.log(h);let u=null;if(h.pointer.startsWith("/textures/"))ob&&console.log("Load texture from gltf",h.pointer),u=Lk(this.parser,h.pointer).then(d=>this.resolveTexture(h,d));else if(typeof h.pointer=="string"){ob&&console.log("Load texture from path",h.pointer);const d=Du(this.source,h.pointer);let f;d.endsWith(".exr")?f=new sb(this.parser.options.manager):d.endsWith(".hdr")?f=new CC(this.parser.options.manager):f=new Kl(this.parser.options.manager),u=f.loadAsync(d,void 0).then(m=>this.resolveTexture(h,m))}else h.pointer;u&&l.push(u)}const c=await h1(l);c!=null&&c.anyFailed&&it()&&console.error("Failed to load lightmap extension",c),o()})):null}}return null}resolveTexture(e,i){const r=i;ob&&console.log("Lightmap loaded:",r),r!=null&&r.isTexture&&(this.registry?(r.colorSpace=Ii,this.registry.registerTexture(this.source,e.type,r,e.index)):console.log(pd[e.type],e.pointer,r))}}const wV=!!te("debuglightmaps");class Bfe{constructor(e){p(this,"_context"),p(this,"_lightmaps",new Map),this._context=e}clear(){this._lightmaps.clear()}registerTexture(e,i,r,s){wV&&console.log("Registering ",pd[i]+' "'+e+'"',r),this._lightmaps.has(e)||this._lightmaps.set(e,new Map);const o=this._lightmaps.get(e),a=o?.get(i)??[];a.length<s&&(a.length=s+1),a[s]=r,o?.set(i,a)}tryGetLightmap(e,i=0){return this.tryGet(e,pd.Lightmap,i)}tryGetSkybox(e){return this.tryGet(e,pd.Skybox,0)}tryGetReflection(e){return this.tryGet(e,pd.Reflection,0)}tryGet(e,i,r){if(!e)return wV&&console.warn("Missing source id"),null;const s=this._lightmaps.get(e);if(!s)return null;const o=s.get(i);return o===void 0||!(o!=null&&o.length)||o.length<=r?null:o[r]}}Ct.lights_fragment_maps=Ct.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `),Ct.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `,Ct.lights_fragment_begin=Ct.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`),Ge.lightmap.lightmapScaleOffset={value:new qe(1,1,0,0)};const uO=te("debugprogressive"),EC=new Ht,MC=new Zi;class kfe{constructor(e){p(this,"context"),p(this,"_lodsManager"),this.context=e}get manager(){return this._lodsManager}get targetTriangleDensity(){var e;return((e=this._lodsManager)==null?void 0:e.targetTriangleDensity)??-1}set targetTriangleDensity(e){this._lodsManager&&(this._lodsManager.targetTriangleDensity=e)}setRenderer(e){var i;(i=this._lodsManager)==null||i.disable(),ka.removePlugin(this),ka.addPlugin(this),ka.debugDrawLine=yt.DrawLine,this._lodsManager=ka.get(e),this._lodsManager.enable()}onAfterUpdatedLOD(e,i,r,s,o){uO&&this.onRenderDebug(r,s,o)}onRenderDebug(e,i,r){var s,o,a;if(!i.geometry||!mi.hasLODLevelAvailable(i.geometry)&&!mi.hasLODLevelAvailable(i.material))return;const l=ka.getObjectLODState(i);if(!l)return;let c=r.mesh_lod;const h=r.mesh_lod!=l.lastLodLevel_Mesh||r.texture_lod!=l.lastLodLevel_Texture;if(uO&&i.geometry.boundingSphere){const u=i.geometry.boundingSphere;MC.copy(u),MC.applyMatrix4(i.matrixWorld);const d=MC.center,f=MC.radius,m=["#76c43e","#bcc43e","#c4ac3e","#c4673e","#ff3e3e"];if(h)yt.DrawWireSphere(d,f,m[c],.1);else{const g=((s=i.geometry.index)==null?void 0:s.count)??0,v=(o=mi.getMeshLODInformation(i.geometry))==null?void 0:o.lods;c=v?Math.min(v?.length-1,c):0;let y="";if(v&&l.lastScreenCoverage>0)for(let x=0;x<v.length;x++){const _=v[x].density,w=x==v.length-1;y+=_.toFixed(0)+">"+(_/l.lastScreenCoverage).toFixed(0)+(w?"":",")}const A=v?(a=v[c])==null?void 0:a.density:-1;let b="LOD "+r.mesh_lod+`
TEX `+r.texture_lod;if(uO=="density"&&(b+=`
`+g+` tris
`+(A/l.lastScreenCoverage).toFixed(0)+` dens
`+(l.lastScreenCoverage*100).toFixed(1)+`% cov
`+(l.lastCentrality*100).toFixed(1)+`% centr
`+(EC.min.x.toFixed(2)+"-"+EC.max.x.toFixed(2)+"x"+EC.min.y.toFixed(2)+"-"+EC.max.y.toFixed(2))+" scr"),l.lastScreenCoverage>.1){const x=e,_=x.worldForward,w=x.worldPosition,T=bt(_).multiplyScalar(f*.7).add(d),M=T.distanceTo(w),R=m[Math.min(m.length-1,Math.max(0,c))]+"88",B=this.context.domHeight>0?screen.height/this.context.domHeight:1,E=e.isPerspectiveCamera?Math.tan(e.fov*Math.PI/180/2):1;yt.DrawLabel(T,b,M*.012*B*E,void 0,16777215,R)}}}}}const Ofe=te("debugplayerview");var fd=(n=>(n.Browser="browser",n.Headset="headset",n.Handheld="handheld",n))(fd||{});class SV{constructor(e,i){p(this,"userId"),p(this,"context"),p(this,"viewDevice","browser"),p(this,"removed",!1),p(this,"_object"),this.userId=e,this.context=i}get currentObject(){return this._object}set currentObject(e){this._object=e}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class CV{constructor(e){p(this,"context"),p(this,"playerViews",new Map),this.context=e}setPlayerView(e,i,r){let s=this.playerViews.get(e);s||(s=new SV(e,this.context),this.playerViews.set(e,s)),s.viewDevice=r,s.currentObject=i,s.removed=!1}getPlayerView(e){if(!!e){if(!this.context.connection.userIsInRoom(e)){this.playerViews.delete(e);return}return this.playerViews.get(e)}}removePlayerView(e,i){const r=this.playerViews.get(e);r?.viewDevice===i&&(Ofe&&console.log("REMOVE",e),r.removed=!0,this.playerViews.delete(e))}}new Yr;const ab=new Uint8Array(4);ab[0]=255,ab[1]=255,ab[2]=255,ab[3]=255;const Dfe=new Ms(ab,1,1,Ti);function dO(n,e=1){const i="alpha"in n,r=e*e,s=new Uint8Array(4*r),o=Math.floor(n.r*255),a=Math.floor(n.g*255),l=Math.floor(n.b*255);for(let h=0;h<r;h++){const u=h*4;s[u+0]=o,s[u+1]=a,s[u+2]=l,i?s[u+3]=Math.floor(n.alpha*255):s[u+3]=255}const c=new Ms(s,e,e);return c.needsUpdate=!0,c}function Lfe(n,e,i,r=1,s=3){const o=r*s,a=[n,e,i],l=a.length,c=new Uint8Array(4*l*o),h=new be;for(let d=0;d<s;d++){const f=Math.floor(d/s*l),m=tt.clamp(f+1,0,l-1),g=a[f],v=a[m],y=d/s*l%1;h.lerpColors(g,v,y);const A=Math.floor(h.r*255),b=Math.floor(h.g*255),x=Math.floor(h.b*255);for(let _=0;_<r;_++){const w=(d*r+_)*4;c[w+0]=A,c[w+1]=b,c[w+2]=x,c[w+3]=255}}const u=new Ms(c,r,s);return u.needsUpdate=!0,u}function TC(n,e){const i=n.elements;e||(e=[]),e.length=0;for(let r=0;r<16;r+=4){const s=i[r],o=i[r+1],a=i[r+2],l=i[r+3],c=new qe(s,o,a,l);e.push(c)}return e}const pO=[],EV=[];function Ufe(n,e){if(pO.length===0)for(let i=0;i<27;i++)pO.push(0);e||(e=pO);for(let i=0;i<27;i++)EV[i]=e[i];e=EV,n.unity_SHAr={value:new qe(e[9],e[3],e[6],e[0])},n.unity_SHBr={value:new qe(e[12],e[15],e[18],e[21])},n.unity_SHAg={value:new qe(e[10],e[4],e[7],e[1])},n.unity_SHBg={value:new qe(e[13],e[16],e[19],e[22])},n.unity_SHAb={value:new qe(e[11],e[5],e[8],e[2])},n.unity_SHBb={value:new qe(e[14],e[17],e[20],e[23])},n.unity_SHC={value:new qe(e[24],e[25],e[26],1)}}class Ffe{constructor(e,i,r){p(this,"vertexShader"),p(this,"fragmentShader"),p(this,"technique"),this.vertexShader=e,this.fragmentShader=i,this.technique=r}}async function Nfe(n,e){if(!n)return console.error("Can not find technique: no shader data"),null;const i=n.programs[e],r=i.vertexShader,s=i.fragmentShader;if(r!==void 0&&s!==void 0){const o=n.shaders[r],a=n.shaders[s];if(o.uri&&a.uri||o.code&&a.code){if(!o.code&&o.uri&&await MV(o),!a.code&&a.uri&&await MV(a),!o.code||!a.code)return null;const l=n.techniques[e];return new Ffe(o.code,a.code,l)}}return console.error("Shader technique not found",e),null}async function MV(n){const e=n.uri;if(e)if(e.endsWith(".glsl")){const i=await new Yr().loadAsync(e);n.code=i.toString()}else n.code=zfe(n.uri)}function zfe(n){return decodeURIComponent(Array.prototype.map.call(atob(n),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const Rl=te("debugenvlight");var f0=(n=>(n[n.Skybox=0]="Skybox",n[n.Trilight=1]="Trilight",n[n.Flat=3]="Flat",n[n.Custom=4]="Custom",n))(f0||{}),IC=(n=>(n[n.Skybox=0]="Skybox",n[n.Custom=1]="Custom",n))(IC||{});class TV{constructor(e){p(this,"context"),p(this,"_currentLightSettingsId"),p(this,"_sceneLightSettings"),p(this,"_timevec4",new qe),p(this,"__currentReflectionId",null),p(this,"_lighting",{}),this.context=e,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const e=this.context.time;this._timevec4.x=e.time,this._timevec4.y=Math.sin(e.time),this._timevec4.z=Math.cos(e.time),this._timevec4.w=e.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const e=this._sceneLightSettings.get(this._currentLightSettingsId);return e?e.ambientIntensity:1}get sceneLightSettings(){var e;return(e=this._sceneLightSettings)==null?void 0:e.values()}enable(e){var i;e instanceof $t&&(e=e.uri);const r=(i=this._sceneLightSettings)==null?void 0:i.get(e);return r?(Rl&&console.log("Enable scene light settings",e,r),e!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=e,r.enabled=!0,!0):(Rl&&console.warn("No light settings found for",e),!1)}disable(e){var i;if(e instanceof $t&&(e=e.uri),e==null)return!1;const r=(i=this._sceneLightSettings)==null?void 0:i.get(e);return r?(Rl&&console.log("Disable scene light settings",e,r),r.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const e=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),e}return null}internalRegisterSceneLightSettings(e){const i=e.sourceId;if(!i){console.error("Missing source id for scene light settings, can not register:",e);return}Rl&&console.log("Register "+e?.sourceId+" lighting",e),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(i,e)}internalUnregisterSceneLightSettings(e){const i=e.sourceId;if(!i){console.error("Missing source id for scene light settings, can not unregister:",e);return}Rl&&console.log("Unregister "+e?.sourceId+" lighting",e),this._sceneLightSettings&&this._sceneLightSettings.delete(i)}internalRegisterReflection(e,i){Rl&&console.log("Register reflection",e,i);const r=new IV(this.context,i,1);this._lighting[e]=r}internalGetReflection(e){return this._lighting[e]}internalEnableReflection(e){var i;this.__currentReflectionId=e;const r=(i=this._sceneLightSettings)==null?void 0:i.get(e);switch(Rl&&console.log("Enable reflection",e,r?f0[r.ambientMode]:"Unknown ambient mode",r),r?.ambientMode){case 0:case 4:const s=this.internalGetReflection(e);if(s&&s.Source){Rl&&console.log("Setting environment reflection",s);const o=this.context.scene,a=s.Source;a.mapping=qs,o.environment=a;return}else Rl&&console.warn("Could not find reflection for source",e);break}if(r?.environmentReflectionSource===1)switch(r?.ambientMode){case 1:if(r.ambientTrilight){const s=r.ambientTrilight,o=Lfe(s[0],s[1],s[2],64,64);o.colorSpace=gt,o.mapping=qs,this.context.scene.environment=o}else console.error("Missing ambient trilight",r.sourceId);return;case 3:if(r.ambientLight){const s=dO(r.ambientLight,64);s.colorSpace=gt,s.mapping=qs,this.context.scene.environment=s}else console.error("Missing ambientlight",r.sourceId);return;default:return}}internalDisableReflection(e){if(e&&e!==this.__currentReflectionId){Rl&&console.log("Not disabling reflection for",e,"because it is not the current light settings id",this.__currentReflectionId);return}Rl&&console.log("Disable reflection",e);const i=this.context.scene;i.environment=null}}class IV{constructor(e,i,r=1){p(this,"_source"),this._source=i,i.mapping=qs}get Source(){return this._source}}const RV=te("timescale");let fO=1;typeof RV=="number"&&(fO=RV);class PV{constructor(){p(this,"_time",0),p(this,"_deltaTime",0),p(this,"_deltaTimeUnscaled",0),p(this,"timeScale",1),p(this,"_frame",0),p(this,"clock",new JR),p(this,"_smoothedFps",0),p(this,"_smoothedDeltaTime",0),p(this,"_fpsSamples",[]),p(this,"_fpsSampleIndex",0),typeof fO=="number"&&(this.timeScale=fO)}get time(){return this._time}set time(e){this._time=e}get deltaTime(){return this._deltaTime}set deltaTime(e){this._deltaTime=e}get deltaTimeUnscaled(){return this._deltaTimeUnscaled}get frame(){return this._frame}set frame(e){this._frame=e}get frameCount(){return this.frame}get realtimeSinceStartup(){return this.clock.elapsedTime}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this._deltaTimeUnscaled=this.deltaTime,this.deltaTime<=0&&(this.deltaTime=1e-12),this.deltaTime*=this.timeScale,this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<60?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%60]=this.deltaTime;let e=0;for(let i=0;i<this._fpsSamples.length;i++)e+=this._fpsSamples[i];this._smoothedDeltaTime=e/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}let BV=!1;function kV(n){BV||(BV=!0,jfe(),Gfe())}kV();function jfe(){const n=`
float startCompression = 0.8;
float desaturation = 0.5;
// Patched tonemapping function
vec3 NeutralToneMapping( vec3 color ) {
    color *= toneMappingExposure;
    
    float d = 1. - startCompression;
    // float peak = dot(color, vec3(0.299, 0.587, 0.114));
    float peak = max(color.r, max(color.g, color.b));
    if (peak < startCompression) return color;
    float newPeak = 1. - d * d / (peak + d - startCompression);
    float invPeak = 1. / peak;
    
    float extraBrightness = dot(color * (1. - startCompression * invPeak), vec3(1, 1, 1));
    
    color *= newPeak * invPeak;
    float g = 1. - 3. / (desaturation * extraBrightness + 3.);
    return mix(color, vec3(1, 1, 1), g);
}
`,e="vec3 NeutralToneMapping( vec3 color ) {",i=`return mix(color, vec3(1, 1, 1), g);
}`,r=Ct.tonemapping_pars_fragment.indexOf(e),s=Ct.tonemapping_pars_fragment.indexOf(i,r);if(r>=0&&s>=0){const o=Ct.tonemapping_pars_fragment.substring(r,s+i.length);Ct.tonemapping_pars_fragment=Ct.tonemapping_pars_fragment.replace(o,n)}}function Gfe(){const n=`
// 0: Default, 1: Golden, 2: Punchy
#define AGX_LOOK 0        

vec3 userSlope = vec3(1.0);
vec3 userOffset = vec3(0.0);
vec3 userPower = vec3(1.0);
float userSaturation = 1.0;

// Mean error^2: 3.6705141e-06
vec3 _agxDefaultContrastApprox(vec3 x) {
    vec3 x2 = x * x;
    vec3 x4 = x2 * x2;
    
    return  + 15.5     * x4 * x2
            - 40.14    * x4 * x
            + 31.96    * x4
            - 6.868    * x2 * x
            + 0.4298   * x2
            + 0.1191   * x
            - 0.00232;
}

vec3 _agx(vec3 val) {
    const mat3 agx_mat = mat3(
        0.842479062253094, 0.0423282422610123, 0.0423756549057051,
        0.0784335999999992,  0.878468636469772,  0.0784336,
        0.0792237451477643, 0.0791661274605434, 0.879142973793104);
    
    const float min_ev = -12.47393f;
    const float max_ev = 4.026069f;

    // val = pow(val, vec3(2.2)); 

    // Input transform (inset)
    val = agx_mat * val;
    
    // Log2 space encoding
    val = clamp(log2(val), min_ev, max_ev);
    val = (val - min_ev) / (max_ev - min_ev);
    
    // Apply sigmoid function approximation
    val = _agxDefaultContrastApprox(val);

    return val;
}

vec3 _agxEotf(vec3 val) {
    const mat3 agx_mat_inv = mat3(
        1.19687900512017, -0.0528968517574562, -0.0529716355144438,
        -0.0980208811401368, 1.15190312990417, -0.0980434501171241,
        -0.0990297440797205, -0.0989611768448433, 1.15107367264116);
        
    // Inverse input transform (outset)
    val = agx_mat_inv * val;
    
    // sRGB IEC 61966-2-1 2.2 Exponent Reference EOTF Display
    // NOTE: We're linearizing the output here. Comment/adjust when
    // *not* using a sRGB render target
    val = pow(val, vec3(2.2)); 

    return val;
}

vec3 _agxLook(vec3 val) {
    const vec3 lw = vec3(0.2126, 0.7152, 0.0722);
    float luma = dot(val, lw);
    
    // Default
    vec3 offset = vec3(0.0);
    vec3 slope = vec3(1.0);
    vec3 power = vec3(1.0);
    float sat = 1.0;
    
    #if AGX_LOOK == 1
    // Golden
    slope = vec3(1.0, 0.9, 0.5);
    power = vec3(0.8);
    sat = 0.8;
    #elif AGX_LOOK == 2
    // Punchy
    slope = vec3(1.0);
    power = vec3(1.35, 1.35, 1.35);
    sat = 1.4;
    #endif        
    
    // Needle
    slope = vec3(1.05);
    power = vec3(1.10, 1.10, 1.10);
    sat = 1.15;

    // User
    // slope = userSlope;
    // offset = userOffset;
    // power = userPower;
    // sat = userSaturation;
    
    // ASC CDL
    val = pow(val * slope + offset, power);
    return luma + sat * (val - luma);
}


vec3 AgXToneMapping( vec3 color ) {
    // apply AGX
    color *= toneMappingExposure;
    color = _agx(color);
    color = _agxLook(color); // Optional
    color = _agxEotf(color);
    return color;
}`,e="vec3 AgXToneMapping( vec3 color ) {",i=`	return color;
}`,r=Ct.tonemapping_pars_fragment.indexOf(e),s=Ct.tonemapping_pars_fragment.indexOf(i,r);if(r>=0&&s>=0){const o=Ct.tonemapping_pars_fragment.substring(r,s+i.length);Ct.tonemapping_pars_fragment=Ct.tonemapping_pars_fragment.replace(o,n)}}function is(n){const e=document.createElement("span");return e.style.maxWidth="48px",e.style.maxHeight="48px",e.style.overflow="hidden",e.classList.add("material-symbols-outlined","notranslate"),e.setAttribute("translate","no"),e.innerText=n,e}function OV(n){var e;return((e=n.classList)==null?void 0:e.contains("material-symbols-outlined"))||!1}const RC=new Map;async function mO(n){const e="Material Symbols Outlined";if(document.fonts.check(`1em '${e}'`)||(console.log("Font not loaded yet"),await document.fonts.ready),RC.has(n))return RC.get(n);const i=document.createElement("canvas"),r=48;i.width=r,i.height=r;const s=i.getContext("2d");if(s){s.font=`${r}px '${e}'`,s.fillStyle="black",s.fillText(n,0,r);const o=i.toDataURL(),a=new Gt;return a.name=n+" icon",a.image=new Image,a.image.src=o,a.needsUpdate=!0,RC.set(n,a),a}return RC.set(n,null),null}const gO=class{constructor(){p(this,"_fullscreenButton"),p(this,"_muteButton"),p(this,"_qrButton")}static getOrCreate(){return this._instance||(this._instance=new gO),this._instance}static create(){return new gO}get fullscreenButton(){return this._fullscreenButton}createFullscreenButton(n){if(this._fullscreenButton)return this._fullscreenButton;if(!document.fullscreenEnabled)return it()&&console.warn("NeedleMenu: Fullscreen button could not be created, device doesn't support the Fullscreen API"),null;const e=document.createElement("button");this._fullscreenButton=e,e.classList.add("fullscreen-button"),e.title="Click to enter fullscreen mode";const i=is("fullscreen"),r=is("fullscreen_exit");return e.appendChild(i),e.onclick=()=>{document.fullscreenElement?document.exitFullscreen():"webkitRequestFullscreen"in n.domElement&&typeof n.domElement.webkitRequestFullscreen=="function"?n.domElement.webkitRequestFullscreen():"requestFullscreen"in n.domElement&&n.domElement.requestFullscreen()},document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(i.remove(),e.appendChild(r),e.title="Click to enter fullscreen mode"):(r.remove(),e.appendChild(i),e.title="Click to exit fullscreen mode")}),globalThis.addEventListener("needle-xrsession-start",()=>{e.style.display="none"}),globalThis.addEventListener("needle-xrsession-end",()=>{e.style.display=""}),e}get muteButton(){return this._muteButton}createMuteButton(n){if(this._muteButton)return this._muteButton;const e=document.createElement("button");this._muteButton=e,e.classList.add("mute-button"),e.title="Click to mute/unmute";const i=is("volume_off"),r=is("volume_up");return n.application.muted?e.appendChild(i):e.appendChild(r),e.onclick=()=>{n.application.muted?(i.remove(),e.appendChild(r),n.application.muted=!1):(r.remove(),e.appendChild(i),n.application.muted=!0)},e}get qrButton(){return this._qrButton}createQRCode(){if(this._qrButton)return this._qrButton;const n=document.createElement("button");this._qrButton=n,n.innerText="QR Code",n.prepend(is("qr_code")),n.title="Scan this QR code with your phone to open this page",this.hideElementDuringXRSession(n);const e=document.createElement("div");e.style.cssText=`
            position: fixed;
            display: inline-block;
            padding: 1rem;
            background-color: white;
            border-radius: 0.4rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        `;const i=document.createElement("div");i.classList.add("qr-code-container"),e.appendChild(i),n.addEventListener("click",()=>{if(e.parentNode)return s();window.location.href.includes("://localhost")&&Pi("To access your website from another device in the same local network you have to use the IP address instead of localhost."),r()});async function r(){await o(),document.body.appendChild(e);const a=i.getBoundingClientRect(),l=n.getBoundingClientRect();e.style.left=l.left+l.width*.5-a.width*.5+"px",l.top<a.height?e.style.top=`calc(${l.bottom}px + ${e.style.padding} * .6)`:e.style.top=`calc(${l.top-a.height}px - ${e.style.padding} * 2.5)`,e.style.opacity="0",e.style.pointerEvents="all",e.style.transition="opacity 0.2s ease-in-out",setTimeout(()=>{e.style.opacity="1",window.addEventListener("click",s,{once:!0})}),window.addEventListener("resize",s),window.addEventListener("scroll",s),document.fullscreenElement?document.fullscreenElement.appendChild(e):document.body.appendChild(e)}function s(){e.style.pointerEvents="none",e.style.transition="opacity 0.2s",e.style.opacity="0",setTimeout(()=>{var a;return(a=e.parentNode)==null?void 0:a.removeChild(e)},500),window.removeEventListener("click",s),window.removeEventListener("resize",s),window.removeEventListener("scroll",s)}async function o(){const a=await p4({text:window.location.href,width:200,height:200});i.innerHTML="",i.appendChild(a)}return n.addEventListener("pointerenter",()=>{o()},{once:!0}),n}hideElementDuringXRSession(n){SS(e=>{n["previous-display"]=n.style.display,n.style.display="none"}),UB(e=>{n["previous-display"]!=null&&(n.style.display=n["previous-display"])})}};let Dh=gO;p(Dh,"_instance");function PC(n,e){const i=e?.element||document.head,r=Array.from(i.querySelectorAll(`link[rel=stylesheet][href*='${n}']`));if(r.length<=0){const s=document.createElement("link");s.href=n,s.rel="stylesheet",i.appendChild(s),r.push(s)}if(e!=null&&e.loadedCallback)for(let s=0;s<r.length;s++)e!=null&&e.loadedCallback&&r[s].addEventListener("load",e.loadedCallback)}function DV(){PC("https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap")}const vO="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0",BC="needle-logo-element";class LV extends HTMLElement{constructor(){super(),p(this,"_root"),p(this,"wrapper"),p(this,"logoElement",document.createElement("img")),p(this,"textElement",document.createElement("span")),this._root=this.attachShadow({mode:"closed"});const e=document.createElement("template");e.innerHTML=`<style>
        :host {
            position: relative;
            min-width: fit-content;
            /* height: 100%; can not have height 100% because of align-items: stretch; in the parent */
            display: flex;
            margin: 0 0.3rem;
        }

        .wrapper {
            position: relative;
            display: grid;
            grid-template-columns: auto auto;
            padding: .1rem;
        }
        .wrapper:hover {
            cursor: pointer;
        }
        img {
            width: 95px;
            height: 100%;
            align-self: end;
        }
        span {
            font-size: 1rem;
            white-space: nowrap;
        }
        </style>
        <div class="wrapper">
            <img class="logo" src=${koe} />
        </div>
        `,this._root.appendChild(e.content.cloneNode(!0)),this.wrapper=this._root.querySelector(".wrapper"),this._root.appendChild(this.wrapper),this.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),this.wrapper.setAttribute("title","Made with Needle Engine")}static get elementName(){return BC}static create(){return document.createElement(BC)}setLogoVisible(e){this.logoElement.style.display=e?"block":"none"}}customElements.get(BC)||customElements.define(BC,LV);const yO=te("debugspatialmenu");class Hfe{constructor(e,i){p(this,"_context"),p(this,"needleMenu"),p(this,"htmlButtonsMap",new Map),p(this,"enabled",!0),p(this,"uiisDirty",!1),p(this,"_showNeedleLogo"),p(this,"_wasInXR",!1),p(this,"preRender",()=>{var o;if(!this.enabled){(o=this.menu)==null||o.removeFromParent();return}yO&&gg()&&this.updateMenu();const a=this._context.xr;if(!(a!=null&&a.running)){this._wasInXR&&(this._wasInXR=!1,this.onExitXR());return}this._wasInXR||(this._wasInXR=!0,this.onEnterXR()),this.updateMenu()}),p(this,"_menuTarget",new ve),p(this,"positionFilter",new K2(90,.5)),p(this,"familyName","Needle Spatial Menu"),p(this,"menu"),p(this,"_poweredByNeedleElement");var r;this._context=e,this._context.pre_render_callbacks.push(this.preRender),this.needleMenu=i;const s=(r=this.needleMenu.shadowRoot)==null?void 0:r.querySelector(".options");s?new MutationObserver(o=>{if(this.enabled&&!(this._context.isInXR==!1&&!yO))for(const a of o)a.type==="childList"&&(a.addedNodes.forEach(l=>{this.createButtonFromHTMLNode(l)}),a.removedNodes.forEach(l=>{const c=l,h=this.htmlButtonsMap.get(c);h&&(this.htmlButtonsMap.delete(c),h.remove(),ji.update())}))}).observe(s,{childList:!0}):console.error("Could not find options container in needle menu")}setEnabled(e){var i;this.enabled=e,e||(i=this.menu)==null||i.removeFromParent()}onDestroy(){const e=this._context.pre_render_callbacks.indexOf(this.preRender);e>-1&&this._context.pre_render_callbacks.splice(e,1)}markDirty(){this.uiisDirty=!0}showNeedleLogo(e){this._showNeedleLogo=e}onEnterXR(){var e;const i=(e=this.needleMenu.shadowRoot)==null?void 0:e.querySelector(".options");i&&i.childNodes.forEach(r=>{this.createButtonFromHTMLNode(r)})}onExitXR(){var e;(e=this.menu)==null||e.removeFromParent()}createButtonFromHTMLNode(e){const i=this.getMenu(),r=this.htmlButtonsMap.get(e);if(r){r.add();return}if(e instanceof HTMLButtonElement){const s=this.createButton(i,e);this.htmlButtonsMap.set(e,s),s.add()}else e instanceof HTMLSlotElement&&e.assignedNodes().forEach(s=>{this.createButtonFromHTMLNode(s)})}updateMenu(){var e,i;performance.mark("NeedleSpatialMenu updateMenu start");const r=this.getMenu();this.handleNeedleWatermark(),this._context.scene.add(r);const s=this._context.mainCamera,o=this._context.xr,a=o?.rigScale||1;if(s){const l=s.worldPosition,c=s.worldForward.multiplyScalar(-1),h=c.y>.6,u=c.y>.4,d=r.visible?u:h,f=!r.visible&&d;r.visible=d||gg()&&yO,c.multiplyScalar(3*a),l.add(c),f&&(r.position.copy(this._menuTarget.position),r.position.y+=1,this._menuTarget.position.copy(r.position),this.positionFilter.reset(r.position),r.quaternion.copy(this._menuTarget.quaternion),this.markDirty());const m=this._menuTarget.position.distanceTo(l);(f||m>1.5*a)&&(this.ensureRenderOnTop(this.menu),this._menuTarget.position.copy(l),this._context.scene.add(this._menuTarget),Hy(this._menuTarget,this._context.mainCamera,!1,!0),this._menuTarget.removeFromParent()),this.positionFilter.filter(this._menuTarget.position,r.position,this._context.time.time);const g=5;(e=this.menu)==null||e.quaternion.slerp(this._menuTarget.quaternion,this._context.time.deltaTime*g),(i=this.menu)==null||i.scale.setScalar(a)}this.uiisDirty&&(performance.mark("SpatialMenu.update.uiisDirty.start"),this.uiisDirty=!1,ji.update(),performance.mark("SpatialMenu.update.uiisDirty.end"),performance.measure("SpatialMenu.update.uiisDirty","SpatialMenu.update.uiisDirty.start","SpatialMenu.update.uiisDirty.end")),performance.mark("NeedleSpatialMenu updateMenu end"),performance.measure("SpatialMenu.update","NeedleSpatialMenu updateMenu start","NeedleSpatialMenu updateMenu end")}ensureRenderOnTop(e,i=0){e instanceof pe&&(e.material.depthTest=!1,e.material.depthWrite=!1),e.renderOrder=1e3+i*2;for(const r of e.children)this.ensureRenderOnTop(r,i+1)}getMenu(){if(this.menu)return this.menu;this.ensureFont(),this.menu=new ji.Block({boxSizing:"border-box",fontFamily:this.familyName,height:"auto",fontSize:.1,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:.55,borderRadius:.04,whiteSpace:"pre-wrap",flexDirection:"row",alignItems:"center",padding:new qe(0,.05,0,.05),borderColor:0,borderOpacity:.05,borderWidth:.005});const e=q.get("ObjectRaycaster");return e&&Sf(this.menu,new e),this.menu}handleNeedleWatermark(){var e;if(!this._poweredByNeedleElement){this._poweredByNeedleElement=new ji.Block({width:"auto",height:"auto",fontSize:.05,whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",margin:.02,borderRadius:.02,padding:.02,backgroundColor:16777215,backgroundOpacity:1}),this._poweredByNeedleElement["needle:use_eventsystem"]=!0;const i=new UV(this._context,()=>globalThis.open("https://needle.tools","_self"));Sf(this._poweredByNeedleElement,i);const r=new ji.Text({textContent:"Powered by",width:"auto",height:"auto"}),s=new ji.Text({textContent:"needle",width:"auto",height:"auto",fontSize:.07,margin:new qe(0,0,0,.02)});this._poweredByNeedleElement.add(r),this._poweredByNeedleElement.add(s),(e=this.menu)==null||e.add(this._poweredByNeedleElement),this.markDirty(),new Kl().load("./include/needle/poweredbyneedle.webp",o=>{var a;i.allowModifyUI=!1,r.removeFromParent(),s.removeFromParent();const l=o.image.width/o.image.height;(a=this._poweredByNeedleElement)==null||a.set({backgroundImage:o,backgroundOpacity:1,width:.1*l,height:.1}),this.markDirty()})}if(this.menu){const i=this.menu.children.indexOf(this._poweredByNeedleElement);if(!this._showNeedleLogo&&md())i>=0&&(this._poweredByNeedleElement.removeFromParent(),this.markDirty());else{this._poweredByNeedleElement.visible=!0,this.menu.add(this._poweredByNeedleElement);const r=this.menu.children.indexOf(this._poweredByNeedleElement);i!==r&&this.markDirty()}}}ensureFont(){let e=ji.FontLibrary.getFontFamily(this.familyName);if(!e){e=ji.FontLibrary.addFontFamily(this.familyName);const i=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");i?.addEventListener("ready",()=>{this.markDirty()})}}createButton(e,i){const r=new ji.Block({width:"auto",height:"auto",whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",backgroundColor:16777215,backgroundOpacity:0,padding:.02,margin:.01,borderRadius:.02,cursor:"pointer",fontSize:.05}),s=new ji.Text({textContent:"",width:"auto",justifyContent:"center",alignItems:"center",backgroundOpacity:0,backgroundColor:16777215,fontFamily:this.familyName,color:0,borderRadius:.02,padding:.01});r.add(s),r["needle:use_eventsystem"]=!0;const o=new UV(this._context,()=>i.click());return Sf(r,o),new Vfe(this,e,i,r,s)}}class Vfe{constructor(e,i,r,s,o){p(this,"menu"),p(this,"root"),p(this,"htmlbutton"),p(this,"spatialContainer"),p(this,"spatialText"),p(this,"spatialIcon"),p(this,"_lastText",""),p(this,"_lastTexture"),this.menu=e,this.root=i,this.htmlbutton=r,this.spatialContainer=s,this.spatialText=o,new MutationObserver(a=>{for(const l of a)l.type==="attributes"?l.attributeName==="style"&&this.updateVisible():l.type==="childList"&&this.updateText()}).observe(r,{attributes:!0,childList:!0}),this.updateText()}add(){this.spatialContainer.parent!=this.root&&(this.root.add(this.spatialContainer),this.menu.markDirty(),this.updateVisible(),this.updateText())}remove(){this.spatialContainer.parent&&(this.spatialContainer.removeFromParent(),this.menu.markDirty())}updateVisible(){const e=this.spatialContainer.visible;this.spatialContainer.visible=this.htmlbutton.style.display!=="none",e!==this.spatialContainer.visible&&this.menu.markDirty()}updateText(){let e="",i="";this.htmlbutton.childNodes.forEach(r=>{r.nodeType===Node.TEXT_NODE?e+=r.textContent:r instanceof HTMLElement&&OV(r)&&r.textContent&&(i=r.textContent)}),this._lastText!==e&&(this._lastText=e,this.spatialText.name=e,this.spatialText.set({textContent:e}),this.menu.markDirty()),e.length<=0?this.spatialText.parent&&(this.spatialText.removeFromParent(),this.menu.markDirty()):this.spatialText.parent||(this.spatialContainer.add(this.spatialText),this.menu.markDirty()),i&&this.createIcon(i)}async createIcon(e){var i;if(!this.spatialIcon){const s=await mO(e);if(s&&!this.spatialIcon){const o=new ji.Block({width:.08,height:.08,backgroundColor:16777215,backgroundImage:s,backgroundOpacity:1,margin:new qe(0,.005,0,0)});this.spatialIcon=o,this.spatialContainer.add(o),this.menu.markDirty()}}if(e!=this._lastTexture){this._lastTexture=e;const s=await mO(e);s&&((i=this.spatialIcon)==null||i.set({backgroundImage:s}),this.menu.markDirty())}const r=this.spatialContainer.children.indexOf(this.spatialIcon);r>0&&(this.spatialContainer.children.splice(r,1),this.spatialContainer.children.unshift(this.spatialIcon),this.menu.markDirty())}}class UV{constructor(e,i){p(this,"isComponent",!0),p(this,"enabled",!0),p(this,"gameObject"),p(this,"allowModifyUI",!0),p(this,"context"),p(this,"onclick"),this.context=e,this.onclick=i}get activeAndEnabled(){return!0}__internalAwake(){}__internalEnable(){}__internalDisable(){}__internalStart(){}onEnable(){}onDisable(){}get element(){return this.gameObject}onPointerEnter(){this.context.input.setCursorPointer(),this.allowModifyUI&&(this.element.set({backgroundOpacity:1}),ji.update())}onPointerExit(){this.context.input.setCursorNormal(),this.allowModifyUI&&(this.element.set({backgroundOpacity:0}),ji.update())}onPointerDown(e){e.use()}onPointerUp(e){e.use()}onPointerClick(e){e.use(),this.onclick()}}const m0="needle-menu",lb=te("debugmenu"),FV=te("debugnoncommercial");let Qfe=class{constructor(n){p(this,"_context"),p(this,"_menu"),p(this,"_spatialMenu"),p(this,"onPostMessage",e=>{if(e.origin===globalThis.location.origin&&typeof e.data=="object"){const i=e.data,r=i.type;if(r==="needle:menu"){const s=i.button;if(s){if(!s.label)return console.error("NeedleMenu: buttoninfo.label is required");if(!s.onclick)return console.error("NeedleMenu: buttoninfo.onclick is required");const o=document.createElement("button");if(o.textContent=s.label,s.icon){const a=is(s.icon);o.prepend(a)}s.priority&&o.setAttribute("priority",s.priority.toString()),o.onclick=()=>{if(s.onclick){const a=s.onclick.startsWith("http")||s.onclick.startsWith("www."),l=s.target||"_blank";a?globalThis.open(s.onclick,l):console.error("NeedleMenu: onclick is not a valid link",s.onclick)}},this._menu.appendChild(o)}else lb&&console.error("NeedleMenu: unknown postMessage event",i)}else lb&&console.warn("NeedleMenu: unknown postMessage type",r,i)}}),p(this,"onStartXR",e=>{e.session.isScreenBasedAR&&(this._menu.previousParent=this._menu.parentNode,this._context.arOverlayElement.appendChild(this._menu),e.session.session.addEventListener("end",this.onExitXR))}),p(this,"onExitXR",()=>{this._menu.previousParent&&(this._menu.previousParent.appendChild(this._menu),delete this._menu.previousParent)}),p(this,"_muteButton"),p(this,"_fullscreenButton"),this._menu=zV.getOrCreate(n.domElement,n),this._context=n,this._spatialMenu=new Hfe(n,this._menu),window.addEventListener("message",this.onPostMessage),SS(this.onStartXR)}onDestroy(){window.removeEventListener("message",this.onPostMessage),this._menu.remove(),this._spatialMenu.onDestroy()}setPosition(n){this._menu.setPosition(n)}setVisible(n){this._menu.setVisible(n)}showNeedleLogo(n){var e;this._menu.showNeedleLogo(n),(e=this._spatialMenu)==null||e.showNeedleLogo(n)}showSpatialMenu(n){this._spatialMenu.setEnabled(n)}showQRCodeButton(n){if(n==="desktop-only"&&(n=!ec()),n){const e=Dh.getOrCreate().createQRCode();return e.style.display="",this._menu.appendChild(e),e}else{const e=Dh.getOrCreate().qrButton;return e&&(e.style.display="none"),e??null}}showAudioPlaybackOption(n){var e;if(!n){(e=this._muteButton)==null||e.remove();return}this._muteButton=Dh.getOrCreate().createMuteButton(this._context),this._muteButton.setAttribute("priority","100"),this._menu.appendChild(this._muteButton)}showFullscreenOption(n){var e;if(!n){(e=this._fullscreenButton)==null||e.remove();return}this._fullscreenButton=Dh.getOrCreate().createFullscreenButton(this._context),this._fullscreenButton&&(this._fullscreenButton.setAttribute("priority","150"),this._menu.appendChild(this._fullscreenButton))}appendChild(n){return this._menu.appendChild(n)}};var kC,OC,AO;const NV=class extends HTMLElement{constructor(){var n,e,i,r,s,o;super(),xa(this,OC),p(this,"_domElement",null),p(this,"_context",null),p(this,"_sizeChangeInterval"),xa(this,kC,m=>{if(!m.defaultPrevented&&m.target==this._domElement&&m instanceof PointerEvent&&m.button===0&&this.root.classList.contains("open")){const g=this.foldout.getBoundingClientRect(),v=m;v.clientX>g.left&&v.clientX<g.right&&v.clientY>g.top&&v.clientY<g.bottom||this.root.classList.toggle("open",!1)}}),p(this,"_userRequestedLogoVisible"),p(this,"_userRequestedMenuVisible"),p(this,"root"),p(this,"wrapper"),p(this,"options"),p(this,"logoContainer"),p(this,"compactMenuButton"),p(this,"foldout"),p(this,"_isHandlingChange",!1),p(this,"_didSort",new Map),p(this,"_lastAvailableWidthChange",0),p(this,"_timeoutHandle",0),p(this,"handleSizeChange",(m,g)=>{if(!this._domElement)return;const v=this._domElement.clientWidth;if(v<500){this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style");return}const y=20*2,A=v-y;if(!g&&Math.abs(A-this._lastAvailableWidthChange)<1)return;this._lastAvailableWidthChange=A,clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{const _=x();_<0?(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")):_>0&&(this.root.classList.remove("compact"),this.foldout.classList.remove("floating-panel-style"),x()<0&&(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")))},5);const b=()=>this.options.clientWidth+this.logoContainer.clientWidth,x=()=>A-b()});const a=document.createElement("template");a.innerHTML=`<style>

        #root {
            position: absolute;
            width: auto;
            max-width: 95%;
            left: 50%;
            transform: translateX(-50%);
            top: min(20px, 10vh);
            padding: 0.3rem;
            display: flex;
            visibility: visible;
            flex-direction: row-reverse; /* if we overflow this should be right aligned so the logo is always visible */
            pointer-events: all;
            z-index: 1000;
        }

        /** hide the menu if it's empty **/
        #root.has-no-options.logo-hidden {
            display: none; 
        }

        /** using a div here because then we can change the class for placement **/
        #root.bottom {
            top: auto;
            bottom: min(30px, 10vh);
        }
        
        .wrapper {
            position: relative;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 0px;
            padding: 0 .3rem;
        }

        .wrapper > *, .options > button, ::slotted(*) {
            position: relative;
            border: none;
            border-radius: 0;
            outline: 1px solid rgba(0,0,0,0);
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 2.3rem;

            /** basic font settings for all entries **/
            font-size: 1rem;
            font-family: 'Roboto Flex', sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-weight: 200;
            font-variation-settings: "wdth" 100;
            color: rgb(20,20,20);
        }

        .floating-panel-style {
            background: rgba(255, 255, 255, .4);
            outline: rgb(0 0 0 / 5%) 1px solid;
            border: 1px solid rgba(255, 255, 255, .1);
            box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);
            border-radius: 1.1999999999999993rem;
            /** 
             * to make nested background filter work 
             * https://stackoverflow.com/questions/60997948/backdrop-filter-not-working-for-nested-elements-in-chrome 
             **/
            &::before {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: -1;
                border-radius: 1.1999999999999993rem;
                -webkit-backdrop-filter: blur(8px);
                backdrop-filter: blur(8px);
            }
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .options {
            display: flex;
            flex-direction: row;
        }

        .options > button, ::slotted(button) {
            height: 2.25rem;
            padding: .4rem .5rem;
        }
        
        :host .options > button, ::slotted(*) {
            background: transparent;
            border: none;
            white-space: nowrap;
            transition: all 0.1s linear .02s;
            border-radius: 0.8rem;
        }
            
        :host .options > *:hover, ::slotted(*:hover) {
            cursor: pointer;
            color: black;
            background: rgba(245, 245, 245, .8);
            box-shadow: inset 0 0 1rem rgba(0,0,30,.2);
            outline: rgba(0,0,0,.1) 1px solid;
        }
        :host .options > *:active, ::slotted(*:active) {
            background: rgba(255, 255, 255, .8);
            box-shadow: inset 0px 1px 1px rgba(255,255,255,.5), inset 0 0 2rem rgba(0,0,30,.2), inset 0px 2px 4px rgba(0,0,20,.5);
            transition: all 0.05s linear;
        }
        :host .options > *:focus, ::slotted(*:focus) {
            outline: rgba(255,255,255,.5) 1px solid;
        }

        :host .options > *:disabled, ::slotted(*:disabled) {
            background: rgba(0,0,0,.05);
            color: rgba(60,60,60,.7);
            pointer-events: none;
        }

        button, ::slotted(button) {
            gap: 0.3rem;
        }

        /** XR button animation **/
        :host button.this-mode-is-requested {
            background: repeating-linear-gradient(to right, #fff 0%, #fff 40%, #aaffff 55%, #fff 80%);
            background-size: 200% auto;
            background-position: 0 100%;
            animation: AnimationName .7s ease infinite forwards;
        }
        :host button.other-mode-is-requested {
            opacity: .5;
        }
        
        @keyframes AnimationName {
            0% { background-position: 0% 0 }
            100% { background-position: -200% 0 }
        }




        .logo {
            cursor: pointer;
            padding-left: 0.6rem;
        }
        .logo-hidden {
            .logo {
                display: none;
            }
        }
        :host .has-options .logo {
            border-left: 1px solid rgba(40,40,40,.4);
            margin-left: 0.3rem;
        }

        .logo > span {
            white-space: nowrap;
        }



        /** COMPACT */

        /** Hide the menu button normally **/
        .compact-menu-button { display: none; }
        /** And show it when we're in compact mode **/
        .compact .compact-menu-button {
            display: block;
            background: none;
            border: none;
            border-radius: 2rem;

            margin: 0;
            padding: 0 .3rem;
            padding-top: .2rem;

            color: #000;

            &:hover {
                background: rgba(255,255,255,.2);
                cursor: pointer;
            }
            &:focus {
                outline: 1px solid rgba(255,255,255,.5);
            }
        }  
        .has-no-options .compact-menu-button {
            display: none;
        }
        .open .compact-menu-button {
            background: rgba(255,255,255,.2);
        }
        .logo-visible .compact-menu-button { 
            margin-left: .2rem;
        }
        
        /** Open and hide menu **/
        .compact .foldout { 
            display: none;
        }
        .open .options, .open .foldout {
            display: flex;
        }
        .compact .wrapper {
            padding: 0;
        }
        .compact .wrapper, .compact .options {
            height: auto;
            max-height: initial;
            flex-direction: row;
            gap: .12rem;
        }
        .compact .options { 
            flex-wrap: wrap;
        }
        .compact .top .options {
            height: auto;
            flex-direction: row;
        }
        .compact .bottom .wrapper {
            height: auto;
            flex-direction: column;
        }

        .compact .foldout {
            max-height: min(100ch, calc(100vh - 100px));
            overflow: auto;
            overflow-x: hidden;
            align-items: center;

            position: fixed;
            bottom: calc(100% + 5px);
            z-index: 100;
            width: auto;
            left: .2rem;
            right: .2rem;
            padding: .2rem;

        }
        .compact.logo-hidden .foldout {
            /** for when there's no logo we want to center the foldout **/
            min-width: 24ch;
            margin-left: 50%;
            transform: translateX(calc(-50% - .2rem));
        }
        
        .compact.top .foldout {
            top: calc(100% + 5px);
            bottom: auto;
        }

        ::-webkit-scrollbar {
            max-width: 7px;
            background: rgba(100,100,100,.2);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .3);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgb(150,150,150);
        }

        .compact .options > * {
            font-size: 1.2rem;
            padding: .6rem .5rem;
        }
        .compact.has-options .logo {
            border: none;
            padding-left: 0;
            margin-left: 1rem;
            margin-bottom: .02rem;
        }
        .compact .options > button {
            display: flex;
            flex-basis: 100%;
        }
        .compact .options > button.row2 {
            //border: 1px solid red !important;
            display: flex;
            flex: 1;
            flex-basis: 30%;
        }

        /** If there's really not enough space then just hide all options **/
        @media (max-width: 100px) or (max-height: 100px){
            .foldout {
                display: none !important;
            }
            .compact-menu-button {
                display: none !important;
            }
        }
        
        /* dark mode */
        /*
        @media (prefers-color-scheme: dark) {
            :host {
                background: rgba(0,0,0, .6);
            }
            :host button {
                color: rgba(200,200,200);
            }
            :host button:hover {
                background: rgba(100,100,100, .8);
            }
        }
        */

        </style>
        
        <div id="root" class="logo-visible floating-panel-style bottom">
            <div class="wrapper">
                <div class="foldout">
                    <div class="options" part="options">
                        <slot></slot>
                    </div>
                    <div class="options" part="options">
                        <slot name="end"></slot>
                    </div>
                </div>
                <div class="logo">
                    <span class="madewith notranslate">powered by</span>
                </div>
            </div>
            <button class="compact-menu-button"></button>
        </div>
        `;const l=this.attachShadow({mode:"open"});DV(),PC(vO,{loadedCallback:()=>{this.handleSizeChange()}}),PC(vO,{element:l});const c=a.content.cloneNode(!0);l?.appendChild(c),this.root=l.querySelector("#root"),this.wrapper=(n=this.root)==null?void 0:n.querySelector(".wrapper"),this.options=(e=this.root)==null?void 0:e.querySelector(".options"),this.logoContainer=(i=this.root)==null?void 0:i.querySelector(".logo"),this.compactMenuButton=(r=this.root)==null?void 0:r.querySelector(".compact-menu-button"),this.compactMenuButton.append(is("more_vert")),this.foldout=(s=this.root)==null?void 0:s.querySelector(".foldout"),(o=this.root)==null||o.appendChild(this.wrapper),this.wrapper.classList.add("wrapper");const h=LV.create();h.style.minHeight="1rem",this.logoContainer.append(h),this.logoContainer.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),Zfe(m=>{if(m==!0&&Lh()&&!FV){let g=this._userRequestedLogoVisible;g===void 0&&(g=!1),Em(this,OC,AO).call(this,g)}}),this.compactMenuButton.addEventListener("click",m=>{m.preventDefault(),this.root.classList.toggle("open")});let u=this._context;setTimeout(()=>u=this._context);let d=0;const f=(m,g)=>{var v,y,A;lb&&console.log("Set menu visible",g),u!=null&&u.isInAR&&u.arOverlayElement?m!=u.arOverlayElement&&u.arOverlayElement.appendChild(this):this.parentNode!=((v=this._domElement)==null?void 0:v.shadowRoot)&&((A=(y=this._domElement)==null?void 0:y.shadowRoot)==null||A.appendChild(this)),this.style.display=g?"flex":"none",this.style.visibility="visible",this.style.opacity="1"};new MutationObserver(m=>{var g;this.onChangeDetected(m);const v=this==null?void 0:this.parentNode;if((this.style.display!="flex"||this.style.visibility!="visible"||this.style.opacity!="1"||v!=((g=this._domElement)==null?void 0:g.shadowRoot))&&!Lh()){const y=d++;eo()&&this._userRequestedMenuVisible===!1?(y===0&&f(v,this._userRequestedMenuVisible),y===1&&console.warn("Needle Menu Warning: You need a PRO license to hide the Needle Engine menu \u2192 The menu will be visible in your deployed website if you don't have a PRO license. See https://needle.tools/pricing for details.")):y===0?f(v,!0):setTimeout(()=>f(v,!0),5)}}).observe(this.root,{childList:!0,subtree:!0,attributes:!0}),lb&&this.___insertDebugOptions()}static create(){return document.createElement(m0,{is:m0})}static getOrCreate(n,e){let i=n.querySelector(m0);return!i&&n.shadowRoot&&(i=n.shadowRoot.querySelector(m0)),i||(i=NV.create(),n.shadowRoot?n.shadowRoot.appendChild(i):n.appendChild(i)),i._domElement=n,i._context=e,i}connectedCallback(){window.addEventListener("resize",this.handleSizeChange),this.handleMenuVisible(),this._sizeChangeInterval=setInterval(()=>this.handleSizeChange(void 0,!0),5e3),setTimeout(()=>{var n,e;(n=this._domElement)==null||n.addEventListener("resize",this.handleSizeChange),(e=this._domElement)==null||e.addEventListener("click",vi(this,kC))},1)}disconnectedCallback(){var n,e;window.removeEventListener("resize",this.handleSizeChange),clearInterval(this._sizeChangeInterval),(n=this._domElement)==null||n.removeEventListener("resize",this.handleSizeChange),(e=this._context)==null||e.domElement.removeEventListener("click",vi(this,kC))}showNeedleLogo(n){this._userRequestedLogoVisible=n,!(!n&&(!Lh()||FV)&&(console.warn("Needle Menu: You need a PRO license to hide the Needle Engine logo."),!eo()))&&Em(this,OC,AO).call(this,n)}setPosition(n){if(n!=="top"&&n!=="bottom")return console.error("NeedleMenu.setPosition: invalid position",n);this.root.classList.remove("top","bottom"),this.root.classList.add(n)}setVisible(n){this._userRequestedMenuVisible=n,this.style.display=n?"flex":"none"}append(...n){for(const e of n)if(typeof e=="string"){const i=document.createTextNode(e);this.options.appendChild(i)}else this.options.appendChild(e)}appendChild(n){var e;if(!(n instanceof Node)){const i=document.createElement("button");if(i.textContent=n.label,i.onclick=n.onClick,i.setAttribute("priority",((e=n.priority)==null?void 0:e.toString())??"0"),n.icon){const r=is(n.icon);n.iconSide==="right"?i.appendChild(r):i.prepend(r)}n.class&&i.classList.add(n.class),n=i}return this.options.appendChild(n)}prepend(...n){for(const e of n)if(typeof e=="string"){const i=document.createTextNode(e);this.options.prepend(i)}else this.options.prepend(e)}onChangeDetected(n){if(!this._isHandlingChange){this._isHandlingChange=!0;try{this.handleMenuVisible();for(const e of n)e.target==this.options&&this.onOptionsChildrenChanged(e)}finally{this._isHandlingChange=!1}}}onOptionsChildrenChanged(n){if(this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions),this.handleSizeChange(void 0,!0),n.type==="childList"){let e=!1;const i=Date.now();for(let r=0;r<n.addedNodes.length;r++){const s=n.addedNodes[r],o=this._didSort.get(s);typeof o=="number"&&i-o<100||(this._didSort.set(s,i),e=!0)}if(e){const r=Array.from(this.options.children);r.sort((s,o)=>{const a=parseInt(s.getAttribute("priority")||"0"),l=parseInt(o.getAttribute("priority")||"0");return a-l});for(const s of r)this.options.appendChild(s)}}}handleMenuVisible(){lb&&console.log("Update VisibleState: Any Content?",this.hasAnyContent),this.hasAnyContent?this.root.style.display="":this.root.style.display="none",this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions)}get hasAnyContent(){return!!(this.logoContainer.style.display!="none"||this.hasAnyVisibleOptions)}get hasAnyVisibleOptions(){for(let n=0;n<this.options.children.length;n++){const e=this.options.children[n];if(e.tagName==="SLOT"){const i=e.assignedNodes();for(const r of i)if(r instanceof HTMLElement&&r.style.display!="none")return!0}else if(e.style.display!="none")return!0}return!1}___insertDebugOptions(){window.addEventListener("keydown",i=>{i.key==="p"&&this.setPosition(this.root.classList.contains("top")?"bottom":"top")});const n=document.createElement("button");n.textContent="Hide Buttons",n.onclick=()=>{const i=new Array(this.options.children.length);for(let r=0;r<this.options.children.length;r++)i[r]=this.options.children[r];for(const r of i)this.options.removeChild(r);setTimeout(()=>{for(const r of i)this.options.appendChild(r)},1e3)},this.appendChild(n);const e=document.createElement("button");e.textContent="Toggle Logo",e.addEventListener("click",()=>{this.logoContainer.style.display=this.logoContainer.style.display==="none"?"":"none"}),this.appendChild(e)}};let zV=NV;kC=new WeakMap,OC=new WeakSet,AO=function(n){this.logoContainer.style.display="",this.logoContainer.style.opacity="1",this.logoContainer.style.visibility="visible",n?(this.root.classList.remove("logo-hidden"),this.root.classList.add("logo-visible")):(this.root.classList.remove("logo-visible"),this.root.classList.add("logo-hidden"))},customElements.get(m0)||customElements.define(m0,zV);const yr=te("debugcontext"),Wfe=te("stats"),Xfe=te("debugactive"),qfe=te("debugframerate"),Yfe=te("debugcoroutine"),Jfe={};class Kfe{constructor(){p(this,"name"),p(this,"alias"),p(this,"hash"),p(this,"runInBackground"),p(this,"domElement"),p(this,"renderer"),p(this,"camera"),p(this,"scene")}}var Xi=(n=>(n[n.Start=-1]="Start",n[n.EarlyUpdate=0]="EarlyUpdate",n[n.Update=1]="Update",n[n.LateUpdate=2]="LateUpdate",n[n.OnBeforeRender=3]="OnBeforeRender",n[n.OnAfterRender=4]="OnAfterRender",n[n.PrePhysicsStep=9]="PrePhysicsStep",n[n.PostPhysicsStep=10]="PostPhysicsStep",n[n.Undefined=-1]="Undefined",n))(Xi||{});function DC(n,e){if(!n)return;if(!n.isComponent){(it()||yr)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,n);return}e||(e=Ot.Current,yr&&console.warn("> Registering component without context"));const i=e?.new_scripts;i.includes(n)||i.push(n)}const nn=class{constructor(n){p(this,"name"),p(this,"alias"),p(this,"isManagedExternally",!1),p(this,"isPaused",!1),p(this,"runInBackground",!1),p(this,"targetFrameRate"),p(this,"physicsSteps",1),p(this,"hash"),p(this,"domElement"),p(this,"_resolutionScaleFactor",1),p(this,"_boundingClientRectFrame",-1),p(this,"_boundingClientRect",null),p(this,"_domX"),p(this,"_domY"),p(this,"xr",null),p(this,"_xrFrame",null),p(this,"_currentFrameEvent",-1),p(this,"scene"),p(this,"renderer"),p(this,"composer",null),p(this,"scripts",[]),p(this,"scripts_pausedChanged",[]),p(this,"scripts_earlyUpdate",[]),p(this,"scripts_update",[]),p(this,"scripts_lateUpdate",[]),p(this,"scripts_onBeforeRender",[]),p(this,"scripts_onAfterRender",[]),p(this,"scripts_WithCorroutines",[]),p(this,"scripts_immersive_vr",[]),p(this,"scripts_immersive_ar",[]),p(this,"coroutines",{}),p(this,"post_setup_callbacks",[]),p(this,"pre_update_callbacks",[]),p(this,"pre_render_callbacks",[]),p(this,"post_render_callbacks",[]),p(this,"pre_update_oneshot_callbacks",[]),p(this,"new_scripts",[]),p(this,"new_script_start",[]),p(this,"new_scripts_pre_setup_callbacks",[]),p(this,"new_scripts_post_setup_callbacks",[]),p(this,"new_scripts_xr",[]),p(this,"mainCameraComponent"),p(this,"_camera",null),p(this,"application"),p(this,"animations"),p(this,"time"),p(this,"input"),p(this,"physics"),p(this,"connection"),p(this,"assets"),p(this,"mainLight",null),p(this,"sceneLighting"),p(this,"addressables"),p(this,"lightmaps"),p(this,"players"),p(this,"lodsManager"),p(this,"menu"),p(this,"_sizeChanged",!1),p(this,"_isCreated",!1),p(this,"_isCreating",!1),p(this,"_isVisible",!1),p(this,"_stats",Wfe?new Rle:null),p(this,"_intersectionObserver",null),p(this,"_disposeCallbacks",[]),p(this,"maxRenderResolution"),p(this,"_originalCreationArgs"),p(this,"onUnhandledRejection",r=>{this.onError(r.reason)}),p(this,"_cameraStack",[]),p(this,"_onBeforeRenderListeners",new Map),p(this,"_onAfterRenderListeners",new Map),p(this,"_requireDepthTexture",!1),p(this,"_requireColorTexture",!1),p(this,"_renderTarget"),p(this,"_isRendering",!1),p(this,"_createId",0),p(this,"_renderlooperrors",0),p(this,"_lastTimestamp",0),p(this,"_accumulatedTime",0),p(this,"_dispatchReadyAfterFrame",!1),p(this,"_wasPaused",!1),this.name=n?.name||"",this.alias=n?.alias,this.domElement=n?.domElement||document.body,this.hash=n?.hash,n!=null&&n.renderer&&(this.renderer=n.renderer,this.isManagedExternally=!0),n?.runInBackground!==void 0&&(this.runInBackground=n.runInBackground),n!=null&&n.scene?this.scene=n.scene:this.scene=new Er,n!=null&&n.camera&&(this._camera=n.camera),this.application=new kh(this),this.time=new PV,this.input=new pG(this),this.physics=new GS(this),this.connection=new FH(this),this.assets=new ZH,this.sceneLighting=new TV(this),this.addressables=new rV(this),this.lightmaps=new Bfe(this),this.players=new CV(this),this.menu=new Qfe(this),this.lodsManager=new kfe(this),this.animations=new hfe(this);const e=()=>this._sizeChanged=!0;window.addEventListener("resize",e),this._disposeCallbacks.push(()=>window.removeEventListener("resize",e));const i=new ResizeObserver(r=>this._sizeChanged=!0);i.observe(this.domElement),this._disposeCallbacks.push(()=>i.disconnect()),this._intersectionObserver=new IntersectionObserver(r=>{this._isVisible=r[0].isIntersecting}),this._disposeCallbacks.push(()=>{var r;return(r=this._intersectionObserver)==null?void 0:r.disconnect()}),fi.register(this)}static get DefaultTargetFrameRate(){return nn._defaultTargetFramerate.value}static set DefaultTargetFrameRate(n){nn._defaultTargetFramerate.value=n}static get DefaultWebGLRendererParameters(){return nn._defaultWebglRendererParameters}get version(){return ml}static get Current(){return fi.Current}static set Current(n){fi.Current=n}appendHTMLElement(n){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(n):this.domElement.appendChild(n)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(n){if(n!==this._resolutionScaleFactor&&typeof n=="number"){if(n<=0){console.error("Invalid resolution scale factor",n);return}this._resolutionScaleFactor=n,this.updateSize()}}calculateBoundingClientRect(){if(this.xr){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var n,e;return((e=(n=this.renderer)==null?void 0:n.xr)==null?void 0:e.isPresenting)||!1}get xrSessionMode(){var n;return(n=this.xr)==null?void 0:n.mode}get isInVR(){return this.xrSessionMode==="immersive-vr"}get isInAR(){return this.xrSessionMode==="immersive-ar"}get isInPassThrough(){return this.xr?this.xr.isPassThrough:!1}get xrSession(){var n,e;return(e=(n=this.renderer)==null?void 0:n.xr)==null?void 0:e.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var n,e;return this.renderer.xr.isPresenting?(e=(n=this.renderer)==null?void 0:n.xr)==null?void 0:e.getCamera():void 0}get arOverlayElement(){const n=this.domElement;return typeof n.getAROverlayContainer=="function"?n.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._camera)return this._camera;if(this.mainCameraComponent){const n=this.mainCameraComponent;return n.cam||n.buildCamera(),n.cam}return null}set mainCamera(n){this._camera=n}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(n){var e,i,r;if((e=this.renderer)==null||e.dispose(),n={...nn.DefaultWebGLRendererParameters,...n},!n.canvas){const s=(r=(i=this.domElement)==null?void 0:i.shadowRoot)==null?void 0:r.querySelector("canvas");s&&(n.canvas=s,yr&&console.log("Using canvas from shadow root",s))}yr&&console.log("Using Renderer Parameters:",n,this.domElement),this.renderer=new lh(n),this.renderer.debug.checkShaderErrors=it()||te("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=Xs,this.renderer.setClearColor(new be("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=VT,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=gt,this.lodsManager.setRenderer(this.renderer),this.input.bindEvents()}internalOnUpdateVisible(){var n,e;(n=this._intersectionObserver)==null||n.disconnect(),(e=this._intersectionObserver)==null||e.observe(this.domElement)}requestSizeUpdate(){this._sizeChanged=!0}updateSize(n=!1){var e,i,r;if(n||!this.isManagedExternally&&((e=this.renderer.xr)==null?void 0:e.isPresenting)===!1){this._sizeChanged=!1;const s=this.resolutionScaleFactor;let o=this.domWidth*s,a=this.domHeight*s;this.maxRenderResolution&&(this.maxRenderResolution.x=Math.max(1,this.maxRenderResolution.x),o=Math.min(this.maxRenderResolution.x,o),this.maxRenderResolution.y=Math.max(1,this.maxRenderResolution.y),a=Math.min(this.maxRenderResolution.y,a));const l=this.mainCamera;this.updateAspect(l),this.renderer.setSize(o,a,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((i=this.composer.setSize)==null||i.call(this.composer,o,a),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((r=this.composer.setPixelRatio)==null||r.call(this.composer,window.devicePixelRatio)))}}updateAspect(n,e,i){if(!n)return;e===void 0&&(e=this.domWidth),i===void 0&&(i=this.domHeight);const r=n.aspect;n.aspect=e/i,r!==n.aspect&&n.updateProjectionMatrix()}recreate(){this.clear(),this.create(this._originalCreationArgs)}async onCreate(n){return this.create(n)}async create(n){try{this._isCreating=!0,n!==this._originalCreationArgs&&(this._originalCreationArgs=Ly(n)),window.addEventListener("unhandledrejection",this.onUnhandledRejection);const e=await this.internalOnCreate(n);return this._isCreated=e,e}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}onError(n){this.domElement.dispatchEvent(new CustomEvent("error",{detail:n}))}clear(){var n,e,i,r;fi.dispatchCallback(Si.ContextClearing,this),cc(this,Si.ContextClearing),$o(this.scene,!0,!0),this.scene=new Er,(n=this.addressables)==null||n.dispose(),(e=this.lightmaps)==null||e.clear(),(r=(i=this.physics)==null?void 0:i.engine)==null||r.clearCaches(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),fi.dispatchCallback(Si.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var n,e;nn.Current=this,fi.dispatchCallback(Si.ContextDestroying,this),cc(this,Si.ContextDestroying),this.clear(),(n=this.renderer)==null||n.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear(),this.isManagedExternally||(yr&&console.log("Disposing renderer"),this.renderer.dispose())),this.scene=null,this.renderer=null,this.input.dispose(),this.menu.onDestroy(),this.animations.onDestroy();for(const i of this._disposeCallbacks)try{i()}catch(r){console.error("Error in on dispose callback:",r,i)}(e=this.domElement)!=null&&e.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this._isCreated=!1,fi.dispatchCallback(Si.ContextDestroyed,this),cc(this,Si.ContextDestroyed),fi.unregister(this),nn.Current===this&&(nn.Current=null)}registerCoroutineUpdate(n,e,i){return typeof e?.next!="function"?(console.error("Registered invalid coroutine function from "+n.name+`
Coroutine functions must be generators: "*myCoroutine() {...}"
Start a coroutine from a component by calling "this.startCoroutine(myCoroutine())"`),e):(this.coroutines[i]||(this.coroutines[i]=[]),this.coroutines[i].push({comp:n,main:e}),e)}unregisterCoroutineUpdate(n,e){if(!this.coroutines[e])return;const i=this.coroutines[e].findIndex(r=>r.main===n);i>=0&&this.coroutines[e].splice(i,1)}stopAllCoroutinesFrom(n){for(const e in this.coroutines){const i=this.coroutines[e];for(let r=i.length-1;r>=0;r--)i[r].comp===n&&i.splice(r,1)}}setCurrentCamera(n){var e;if(!n)return;if(n.cam||n.buildCamera(),!n.cam){console.warn("Camera component is missing camera",n);return}const i=this._cameraStack.indexOf(n);i>=0&&this._cameraStack.splice(i,1),this._cameraStack.push(n),this.mainCameraComponent=n;const r=n.cam;r.isPerspectiveCamera&&this.updateAspect(r),(e=this.mainCameraComponent)==null||e.applyClearFlagsIfIsActiveCamera()}removeCamera(n){if(!n)return;const e=this._cameraStack.indexOf(n);if(e>=0&&this._cameraStack.splice(e,1),this.mainCameraComponent===n&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const i=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(i)}}addBeforeRenderListener(n,e){this._onBeforeRenderListeners.has(n.uuid)||(this._onBeforeRenderListeners.set(n.uuid,[]),n.onBeforeRender=this._createRenderCallbackWrapper(n,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(n.uuid).push(e)}removeBeforeRenderListener(n,e){if(this._onBeforeRenderListeners.has(n.uuid)){const i=this._onBeforeRenderListeners.get(n.uuid),r=i.indexOf(e);r>=0&&i.splice(r,1)}}addAfterRenderListener(n,e){var i;this._onAfterRenderListeners.has(n.uuid)||(this._onAfterRenderListeners.set(n.uuid,[]),n.onAfterRender=this._createRenderCallbackWrapper(n,this._onAfterRenderListeners)),(i=this._onAfterRenderListeners.get(n.uuid))==null||i.push(e)}removeAfterRenderListener(n,e){if(this._onAfterRenderListeners.has(n.uuid)){const i=this._onAfterRenderListeners.get(n.uuid),r=i.indexOf(e);r>=0&&i.splice(r,1)}}_createRenderCallbackWrapper(n,e){return(i,r,s,o,a,l)=>{const c=e.get(n.uuid);if(c)for(let h=0;h<c.length;h++){const u=c[h];u(i,r,s,o,a,l)}}}get isRendering(){return this._isRendering}setRequireDepth(n){this._requireDepthTexture=n}setRequireColor(n){this._requireColorTexture=n}get depthTexture(){var n;return((n=this._renderTarget)==null?void 0:n.depthTexture)||null}get opaqueColorTexture(){var n;return((n=this._renderTarget)==null?void 0:n.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const n=getComputedStyle(this.domElement);return n.visibility!=="hidden"&&n.display!=="none"&&n.opacity!=="0"}async internalOnCreate(n){var e,i,r,s,o,a,l,c;const h=++this._createId;yr&&console.log("Creating context",this.name,n);const u=globalThis["needle:dependencies:ready"];u instanceof Promise&&(yr&&console.log("Waiting for dependencies to be ready"),await u.catch(g=>{if(yr||it()){if(I1("Needle Engine dependencies failed to load. Please check the console for more details"),g instanceof ReferenceError){let v="YourComponentName";const y=g.message.indexOf("'");if(y>0){const A=g.message.indexOf("'",y+1);if(A>0){const b=g.message.substring(y+1,A);b.length>3&&(v=b)}}console.error(`Needle Engine dependencies failed to load:

# Make sure you don't have circular imports in your scripts!
\u2192 Possible solution: Replace @serializable(${v}) in your script with @serializable(Behaviour)

---`,g);return}console.error("Needle Engine dependencies failed to load",g)}}).then(()=>{yr&&console.log("Needle Engine dependencies are ready")})),this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(e=this.renderer)==null||e.setAnimationLoop(null)),await $l(1),nn.Current=this,await fi.dispatchCallback(Si.ContextCreationStart,this);let d=!0,f;try{nn.Current=this,n?f=await this.internalLoadInitialContent(h,n):f=[]}catch(g){console.error(g),d=!1}if(!d)return this.onError("Failed to load initial content"),!1;if(h!==this._createId||(i=n?.abortSignal)!=null&&i.aborted)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return yr&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),nn.Current=this,nn.Current=this;for(let g=0;g<this.new_scripts.length;g++){const v=this.new_scripts[g];if(v.gameObject!==void 0&&v.gameObject!==null){v.gameObject.userData===void 0&&(v.gameObject.userData={}),v.gameObject.userData.components===void 0&&(v.gameObject.userData.components=[]);const y=v.gameObject.userData.components;y.includes(v)||y.push(v)}}if(this.post_setup_callbacks)for(let g=0;g<this.post_setup_callbacks.length;g++)nn.Current=this,await this.post_setup_callbacks[g](this);if(!this.mainCamera){nn.Current=this;let g=null;Mf(this.scene,v=>{const y=v;if(y!=null&&y.isCamera){if(GA(y.gameObject),!y.activeAndEnabled)return;if(y.tag==="MainCamera")return g=y,!0;g=y}}),g?this.setCurrentCamera(g):!fi.dispatchCallback(Si.MissingCamera,this,{files:f})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(this.input.bindEvents(),nn.Current=this,qS(this),this.physics.engine&&((r=this.physics.engine)==null||r.step(0),(s=this.physics.engine)==null||s.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const g=new k1(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(g),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),this._stats.dom.style.position="absolute",(o=this.domElement.shadowRoot)==null||o.appendChild(this._stats.dom)),yr&&M1(this.scene,!0),this.targetFrameRate===void 0?(yr&&console.warn("No target framerate set, using default",nn.DefaultTargetFrameRate),this.targetFrameRate=nn._defaultTargetFramerate):yr&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const m=fi.dispatchCallback(Si.ContextCreated,this,{files:f});return m&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((a=this.domElement)==null||a.internalSetLoadingMessage("finish loading")),await m),(l=n?.abortSignal)!=null&&l.aborted?!1:(cc(this,Si.ContextCreated),yr&&console.log("Context Created...",this.renderer,this.renderer.domElement),this._isCreating=!1,!this.isManagedExternally&&!((c=n?.abortSignal)!=null&&c.aborted)&&this.restartRenderLoop(),!0)}async internalLoadInitialContent(n,e){var i,r,s,o;const a=new Array;if(e.files.length===0)return a;const l=[...e.files],c={name:"",progress:null,index:0,count:l.length},h=ul(),u=0;for(let d=0;d<l.length;d++){if((i=e.abortSignal)!=null&&i.aborted){yr&&console.log("Aborting loading because of abort signal");break}if(n!==this._createId){yr&&console.log("Aborting loading because create id changed",n,this._createId);break}const f=l[d];(r=e?.onLoadingStart)==null||r.call(this,d,f),yr&&console.log("Context Load "+f);const m=await h.loadSync(this,f,f,u,g=>{var v,y;(v=e.abortSignal)!=null&&v.aborted||(c.name=f,c.progress=g,c.index=d,c.count=l.length,(y=e.onLoadingProgress)==null||y.call(this,c))});(s=e?.onLoadingFinished)==null||s.call(this,d,f,m??null),m?a.push({src:f,file:m}):console.warn("Could not load file: "+f)}if(n!==this._createId||(o=e.abortSignal)!=null&&o.aborted){for(const d of a)if(d&&d.file)for(const f of d.file.scenes)$o(f,!0,!0)}else for(const d of a)d&&d.file&&this.scene.add(d.file.scene);return a}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((n,e)=>{this.isManagedExternally||this.update(n,e)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(n,e){if(e===void 0&&(e=null),it()||yr||ape())try{performance.mark("update.start"),this.internalStep(n,e),this._renderlooperrors=0,performance.mark("update.end"),performance.measure("NE Frame","update.start","update.end")}catch(i){this._renderlooperrors+=1,(it()||yr)&&(i instanceof Error||i instanceof TypeError)&&dn("Caught unhandled exception during render-loop - see console for details.",Wo.Error),console.error("Frame #"+this.time.frame+`
`,i),this._renderlooperrors>=3&&(console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null)),this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}else this.internalStep(n,e)}updatePhysics(n){this.internalUpdatePhysics(n)}internalStep(n,e){this.internalOnBeforeRender(n,e)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(n,e){var i;this.renderer.info.autoReset=!0;const r=e!==null&&this._xrFrame===null;if(this._xrFrame=e,r&&this.domElement.dispatchEvent(new CustomEvent("xr-session-started",{detail:{context:this,session:this.xrSession,frame:e}})),this._currentFrameEvent=-1,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=n),this._accumulatedTime+=(n-this._lastTimestamp)/1e3,this._lastTimestamp=n;let s=this.targetFrameRate;if(typeof s=="object"&&(s=s.value),this._accumulatedTime<1/(s+1))return!1;this._accumulatedTime=0}if((i=this._stats)==null||i.begin(),nn.Current=this,this.onHandlePaused())return!1;for(nn.Current=this,this.time.update(),qfe&&console.log("FPS",this.time.smoothedFps.toFixed(0)),qS(this),YS(this.scene),a8(this),cc(this,-1);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const s=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(s)}if(this.pre_update_oneshot_callbacks){for(const s in this.pre_update_oneshot_callbacks)this.pre_update_oneshot_callbacks[s]();this.pre_update_oneshot_callbacks.length=0}if(this.pre_update_callbacks)for(const s in this.pre_update_callbacks)this.pre_update_callbacks[s]();this._currentFrameEvent=0;for(let s=0;s<this.scripts_earlyUpdate.length;s++){const o=this.scripts_earlyUpdate[s];o.activeAndEnabled&&o.earlyUpdate!==void 0&&(nn.Current=this,o.earlyUpdate())}if(this.executeCoroutines(0),cc(this,0),this.onHandlePaused())return!1;this._currentFrameEvent=1;for(let s=0;s<this.scripts_update.length;s++){const o=this.scripts_update[s];o.activeAndEnabled&&o.update!==void 0&&(nn.Current=this,o.update())}if(this.executeCoroutines(1),cc(this,1),this.onHandlePaused())return!1;this._currentFrameEvent=2;for(let s=0;s<this.scripts_lateUpdate.length;s++){const o=this.scripts_lateUpdate[s];o.activeAndEnabled&&o.lateUpdate!==void 0&&(nn.Current=this,o.lateUpdate())}if(this.executeCoroutines(2),cc(this,2),this.onHandlePaused()||(this.physicsSteps===void 0&&(this.physicsSteps=1),this.physics.engine&&this.physicsSteps>0&&this.internalUpdatePhysics(this.physicsSteps),this.onHandlePaused()))return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=3;for(let s=0;s<this.scripts_onBeforeRender.length;s++){const o=this.scripts_onBeforeRender[s];o.activeAndEnabled&&o.onBeforeRender!==void 0&&(nn.Current=this,o.onBeforeRender(e))}if(this.executeCoroutines(3),cc(this,3),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const s in this.pre_render_callbacks)this.pre_render_callbacks[s](e)}return!0}internalUpdatePhysics(n){if(!this.physics.engine)return!1;const e=n,i=this.time.deltaTime/e;for(let r=0;r<e;r++)this._currentFrameEvent=9,this.executeCoroutines(9),this.physics.engine.step(i),this._currentFrameEvent=10,this.executeCoroutines(10);return this.physics.engine.postStep(),!0}internalOnRender(){this.isManagedExternally||(upe(this),this._currentFrameEvent=-1,this.renderNow(),this._currentFrameEvent=4)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let n=0;n<this.scripts_onAfterRender.length;n++){const e=this.scripts_onAfterRender[n];e.activeAndEnabled&&e.onAfterRender!==void 0&&(nn.Current=this,e.onAfterRender())}if(this.executeCoroutines(4),cc(this,4),this.post_render_callbacks)for(const n in this.post_render_callbacks)this.post_render_callbacks[n]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log(this.renderer.info.render.calls+" DrawCalls",`
Render:`,{...this.renderer.info.render},`
Memory:`,{...this.renderer.info.memory},`
Target Framerate: `+this.targetFrameRate)),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")),fi.dispatchCallback(Si.ContextFirstFrameRendered,this))}renderNow(n){return!n&&(n=this.mainCamera,!n)?!1:(this._isRendering=!0,this.renderRequiredTextures(),this.renderer.toneMapping!==Xs&&kV(),this.composer&&!this.isInXR?this.composer.render(this.time.deltaTime):n&&this.renderer.render(this.scene,n),this._isRendering=!1,!0)}onHandlePaused(){const n=this.evaluatePaused();if(this._wasPaused!==n){Xfe&&console.log("Paused?",n,"context:"+this.alias);for(let e=0;e<this.scripts_pausedChanged.length;e++){const i=this.scripts_pausedChanged[e];i.activeAndEnabled&&i.onPausedChanged!==void 0&&(nn.Current=this,i.onPausedChanged(n,this._wasPaused))}}return this._wasPaused=n,n}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new qt(this.domWidth,this.domHeight),this._requireDepthTexture){const i=new tg(this.domWidth,this.domHeight);this._renderTarget.depthTexture=i}this._requireColorTexture&&(this._renderTarget.texture=new Gt,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=Rt,this._renderTarget.texture.magFilter=Rt,this._renderTarget.texture.format=Ti)}const n=this._renderTarget;n.texture&&(n.texture.colorSpace=this.renderer.outputColorSpace);const e=this.renderer.getRenderTarget();this.renderer.setRenderTarget(n),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(e)}executeCoroutines(n){var e;if(this.coroutines[n]){const r=this.coroutines[n];for(let s=0;s<r.length;s++)try{const o=r[s];if(!o.comp||o.comp.destroyed||!o.main||o.comp.enabled===!1){Yfe&&console.log("Removing coroutine",o.comp,o.comp.enabled),r.splice(s,1),--s;continue}const a=o.chained;if(a&&a.length>0){const h=a[a.length-1].next();if(h.done&&a.pop(),i(h)&&(o.chained||(o.chained=[]),o.chained.push(h.value)),!h.done)continue}const l=o.main.next();if(l.done===!0){r.splice(s,1),--s;continue}const c=l.value;if(i(c)){if(c.next().done)continue;o.chained||(o.chained=[]),o.chained.push(c)}else if(c instanceof Promise){const h=c;o.chained||(o.chained=[]);const u=cV(h);(e=o.chained)==null||e.push(u);continue}}catch(o){console.error(o)}}function i(r){return!!(r&&r.next&&r.return)}}};let Ot=nn;p(Ot,"_defaultTargetFramerate",{value:90,toString(){return this.value}}),p(Ot,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1,powerPreference:Lu()||h4()?"default":"high-performance"});const Ua=te("debuglicense");let If="basic";Ua&&console.log("License Type: "+If);function md(){switch(If){case"pro":case"enterprise":return!0}return!1}function bO(){switch(If){case"indie":return!0}return!1}function Lh(){return md()||bO()}const jV=[];function Zfe(n){if(md()||bO())return n(!0);jV.push(n)}function $fe(n){for(const e of jV)try{e(n)}catch{}}fi.registerCallback(Si.ContextRegistered,n=>{ime(n.context),rme(),tme(n.context)});let Rf,xO=!1,LC="";async function eme(){if(Rf)return Rf;if(If==="basic")try{const n="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+ml+"&generator="+encodeURIComponent(R1),e=await fetch(n,{method:"GET"}).catch(i=>{Ua&&console.error("License check failed",i)});e?.status===200?(xO=!1,Ua&&console.log("License check succeeded"),If="pro",$fe(!0)):e?.status===403?(xO=!0,LC=await e.text()):Ua&&console.log("License check failed with status "+e?.status)}catch(n){Ua&&console.error("License check failed",n)}else Ua&&console.log('Runtime license check is skipped because license is already applied as "'+If+'"')}Rf=eme();async function tme(n){function e(){const s=document.createElement("div");s.className="needle-forbidden",s.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        line-height: 1.5;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        `;const o=s.style.cssText,a=document.createElement("div");s.appendChild(a),a.style.cssText=`
        position: absolute;
        left: 0;
        right: 0;
        top:0;
        bottom: 0;
        padding: 10%;
        color: white;
        font-size: 20px;
        font-family: sans-serif;
        text-align: center;
        pointer-events: all;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(0,0,0,.3);
        text-shadow: 0 0 2px black;
        `;const l=a.style.cssText,c=LC?.length>1?LC:"This web application has been paused.<br/>You might be in violation of the Needle Engine terms of use.<br/>Please contact the Needle support if you think this is a mistake.";return a.innerHTML=c,setInterval(()=>{a.innerHTML!==c&&(a.innerHTML=c),a.parentNode!==s&&s.appendChild(a),s.style.cssText!==o&&(s.style.cssText=o),a.style.cssText!==l&&(a.style.cssText=l)},500),s}let i=e();const r=i.style.cssText;setInterval(()=>{var s;xO===!0&&(i.style.cssText!==r&&(i=e()),n.domElement.shadowRoot?i.parentNode!==n.domElement.shadowRoot&&((s=n.domElement.shadowRoot)==null||s.appendChild(i)):i.parentNode!=document.body&&document.body.appendChild(i))},500)}async function ime(n){try{if(Lh()!==!0)return _O(n)}catch(e){return Ua&&console.log("License check failed",e),_O(n)}Ua&&_O(n)}async function _O(n){n.domElement.addEventListener("ready",()=>!0),await Rf?.catch(()=>{}),!Lh()&&nme()}let GV=0;async function nme(n){var e;const i=Date.now();if(i-GV<2e3)return;GV=i;const r=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,s=`Needle Engine \u2014 No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${ml}`;(e=Ot.Current)!=null&&e.xr?console.log(s):console.log("%c "+s,r)}async function rme(){var n;try{const e="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(e){Ua&&console.log("Analytics backend url",e);const i=window.location.href.split("?")[0];let r="api/v2/new/request";e.endsWith("/")||(r="/"+r);const s=If,o=`${e}${r}`;Ua&&console.log("Sending non-commercial usage message to analytics backend",o);const a={license:s,url:i,hostname:window.location.hostname,pathname:window.location.pathname,version:ml,generator:R1,build_time:gP},l=(n=navigator.sendBeacon)==null?void 0:n.call(navigator,o,JSON.stringify(a));Ua&&console.log("Send beacon result",l)}}catch(e){Ua&&console.log("Failed to send non-commercial usage message to analytics backend",e)}}const Pf=te("debugloading"),cb=te("debugloadingrendering"),HV=te("debuglicense");class sme{constructor(){p(this,"className"),p(this,"additionalClasses")}}let hb=0,VV;function wO(n){Pf&&console.log(n.progress.loaded.toFixed(0)+"/"+n.progress.total.toFixed(0),n);const e=n.count,i=n.progress.total;i===0||i===void 0?(VV!==n.name&&(hb=0),VV=n.name,hb+=(1-hb)*.001,Pf&&Pi("Loading "+n.name+" did not report total size")):hb=n.progress.loaded/i;const r=n.index/e+hb/e;return tt.clamp01(r)}const SO=class{constructor(n,e){p(this,"loadingProgress",0),p(this,"_element"),p(this,"_progress",0),p(this,"_allowCustomLoadingElement",!0),p(this,"_loadingElement"),p(this,"_loadingTextContainer",null),p(this,"_loadingBar",null),p(this,"_messageContainer",null),p(this,"_loadingElementOptions"),p(this,"_progressLoop"),this._element=n,this._loadingElementOptions=e}async onLoadingBegin(n){const e=this._element.shadowRoot||this._element;if(Pf&&console.warn("Begin Loading"),!this._loadingElement){for(let i=0;i<e.children.length;i++){const r=e.children[i];if(r.classList.contains(SO.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){Pf&&console.warn("Remove custom loading container"),e.removeChild(r);continue}this._loadingElement=this.createLoadingElement(r)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",e.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(n??"")}onLoadingUpdate(n,e){var i;if(!((i=this._loadingElement)!=null&&i.parentNode))return;let r=0;typeof n=="number"?r=n:("index"in n&&(r=wO(n)),!e&&"name"in n&&this.setMessage("loading "+n.name)),this.loadingProgress=r,e&&this.setMessage(e),this.updateDisplay()}onLoadingFinished(){Pf&&console.warn("Finished Loading"),cb||(this.loadingProgress=1,this.onDoneLoading())}setMessage(n){this._messageContainer&&(this._messageContainer.innerText=n)}smoothProgressLoop(){if(this._progressLoop)return;let n=1/12;cb&&(n=1/500,typeof cb=="number"&&(n*=cb)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!cb&&(n=.9),this._progress=tt.lerp(this._progress,this.loadingProgress,n*this.loadingProgress),this.updateDisplay()},n)}onDoneLoading(){this._loadingElement&&(Pf&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const n=this._progress,e=(n*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=n*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=e)}createLoadingElement(n){var e,i;Pf&&!n&&console.log("Creating loading element"),this._loadingElement=n||document.createElement("div");let r=this._element.getAttribute("loading-style");(!r||r==="auto")&&(window.matchMedia("(prefers-color-scheme: dark)").matches?r="dark":r="light");const s=md();if(!n&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",r==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",this._loadingElement.style.fontFamily='system-ui, Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this._loadingElement.style.fontSize="1rem",r==="light"?this._loadingElement.style.color="rgba(0,0,0,.6)":this._loadingElement.style.color="rgba(255,255,255,.3)",s&&this._element)){const v=this._element.getAttribute("loading-background-color");v&&(this._loadingElement.style.backgroundColor=v);const y=this._element.getAttribute("loading-text-color");y&&(this._loadingElement.style.color=y)}const o=((e=this._loadingElementOptions)==null?void 0:e.className)??SO.LoadingContainerClassName;if(this._loadingElement.classList.add(o),(i=this._loadingElementOptions)!=null&&i.additionalClasses)for(const v of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(v);const a=document.createElement("div");this._loadingElement.appendChild(a);const l=document.createElement("img"),c=120;l.style.width=`${c}px`,l.style.height=`${c}px`,l.style.paddingTop="20px",l.style.paddingBottom="10px",l.style.margin="0px",l.style.userSelect="none",l.style.objectFit="contain",l.style.transition="transform 1.5s ease-out, opacity .3s ease-in-out",l.style.transform="translateY(30px)",l.style.opacity="0.05",setTimeout(()=>{l.style.opacity="1",l.style.transform="translateY(0px)"},1),l.src=Toe;let h=!1;if(s&&this._element){const v=this._element.getAttribute("loading-logo-src");v&&(h=!0,l.src=v)}h||(l.style.cursor="pointer",l.style.pointerEvents="all",l.addEventListener("click",()=>window.open("https://needle.tools","_blank"))),a.appendChild(l);const u=document.createElement("div");u.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out 4s;
        `,setTimeout(()=>{u.style.opacity="1"},1),this._loadingElement.appendChild(u);const d=document.createElement("div"),f=100;d.style.display="flex",d.style.width=f+"%",d.style.height="3px",d.style.position="absolute",d.style.left="0",d.style.bottom="0px",d.style.opacity="0",d.style.transition="opacity 1s ease-in-out 2s",setTimeout(()=>{d.style.opacity="1"},1),r==="light"?d.style.backgroundColor="rgba(0,0,0,.2)":d.style.backgroundColor="rgba(255,255,255,.2)",this._loadingElement.appendChild(d),this._loadingBar=document.createElement("div"),d.appendChild(this._loadingBar);const m=function(v){return tt.lerp(0,f,v)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #204f49 ${m(0)}, #0BA398 ${m(.3)}, #66A22F ${m(.6)}, #D7DB0A ${m(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",s&&this._element){const v=this._element.getAttribute("primary-color"),y=this._element.getAttribute("secondary-color");v&&y?this._loadingBar.style.background=`linear-gradient(90deg, ${v} ${m(0)}, ${y} ${m(1)})`:v?this._loadingBar.style.background=v:y&&(this._loadingBar.style.background=y)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".2rem",u.appendChild(this._loadingTextContainer);const g=document.createElement("div");if(this._messageContainer=g,g.style.display="flex",g.style.fontSize=".8rem",g.style.paddingTop=".1rem",g.style.justifyContent="center",u.appendChild(g),s&&this._element){const v=this._element.getAttribute("loading-text-color");v&&(g.style.color=v)}return this.handleRuntimeLicense(this._loadingElement),this._loadingElement}async handleRuntimeLicense(n){let e=Lh();if(e)return;HV&&console.log("Loading UI has commercial license?",e);const i=document.createElement("div");i.style.paddingTop=".6em",i.style.fontSize=".8em",i.style.textTransform="uppercase",i.innerText=`NEEDLE ENGINE NON COMMERCIAL VERSION
CLICK HERE TO GET A LICENSE`,i.style.cursor="pointer",i.style.userSelect="none",i.style.textAlign="center",i.style.pointerEvents="all",i.addEventListener("click",()=>window.open("https://needle.tools/pricing","_self")),i.style.opacity="0",n.appendChild(i),!it()&&Rf&&(HV&&console.log("Waiting for runtime license check"),await Rf,e=Lh()),!e&&(i.style.transition="opacity .5s ease-in-out",i.style.opacity="1")}};let CO=SO;p(CO,"LoadingContainerClassName","loading");const ub=te("debugoverlay"),QV="ar",ome="quit-ar";class ame{constructor(){p(this,"arContainer",null),p(this,"currentSession",null),p(this,"_createdAROnlyElements",[]),p(this,"_reparentedObjects",[]),p(this,"contentElement",null),p(this,"originalDomOverlayParent",null),p(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(e,i,r){var s;if(this.currentSession=r,this.arContainer=i,qp()){const o=e.domElement.children;for(let a=0;a<o?.length;a++){const l=o[a];if(!l||l===this.arContainer)return;this._reparentedObjects.push({el:l,previousParent:l.parentElement}),(s=this.arContainer)==null||s.appendChild(l)}i?(this.originalDomOverlayParent=i.parentNode,this.originalDomOverlayParent&&(console.log("Reparent DOM Overlay to body",i,i.style.display),i.style.display="",i.style.visibility="",document.body.appendChild(i))):console.warn("WebXRViewer: No DOM Overlay found")}this.ensureQuitARButton(this.arContainer)}onEnd(e){var i;for(const r of this._createdAROnlyElements)r.remove&&r.remove();for(const r of this._reparentedObjects){const s=r.el;(i=r.previousParent)==null||i.appendChild(s)}this._reparentedObjects.length=0,qp()&&setTimeout(()=>{var r;const s=e.renderer.domElement;s&&((r=e.domElement.shadowRoot)==null||r.prepend(s));const o=document.querySelectorAll("*");for(var a=0;a<o.length;a++){const l=o[a];l&&l._displayChanged!==void 0&&l._displayWas!==void 0&&(l.style.display=l._displayWas)}},10)}createOverlayContainer(e){if(this.contentElement)return this.contentElement;ub&&console.log("Setup overlay container");const i=e.shadowRoot.querySelector(".content");this.contentElement=i;const r=e.shadowRoot.querySelector(".overlay-content");return r&&i.appendChild(r),ub&&!ec()&&this.ensureQuitARButton(i),i}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(e){const i=document.createElement("slot");i.setAttribute("name","quit-ar"),this.appendElement(i,e),this._createdAROnlyElements.push(i),i.style.pointerEvents="auto";const r=document.querySelector(`.${ome}`);if(r){r.addEventListener("click",this.requestEndAR),ub&&r.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}i.addEventListener("click",this.requestEndAR),ub&&i.addEventListener("click",()=>console.log("Clicked fallback close button"));const s=document.createElement("div");s.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(s,i);var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.classList.add("quit-ar-button"),o.setAttribute("width","38px"),o.setAttribute("height","38px"),o.style.cssText=`
            background: radial-gradient(circle, rgba(0,0,0,.05) 70%, rgba(0,0,0,0) 100%);
            border-radius: 50%;
        `,s.appendChild(o);var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),a.setAttribute("stroke","#fff"),a.setAttribute("stroke-width","3px"),a.style.cssText=`
            filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));
        `,o.appendChild(a),ub&&console.log("Created fallback close button",o,e)}appendElement(e,i){return i.shadowRoot?i.shadowRoot.appendChild(e):i.appendChild(e)}}const UC=te("debugdecoders");let EO="https://www.gstatic.com/draco/versioned/decoders/1.5.7/";fetch(EO+"draco_decoder.js",{method:"head"}).catch(n=>{it()&&console.warn('Failed to load draco decoder from "'+EO+`".
Falling back to local version at "./include/draco"`),EO="./include/draco/"});let MO,TO=null;function FC(){if(!TO){const n=iG(null);TO={dracoLoader:n.dracoLoader,ktx2Loader:n.ktx2Loader,meshoptDecoder:n.meshoptDecoder}}return TO}function WV(n){if(n!==void 0&&typeof n=="string"){const e=FC();UC&&console.log("Setting draco decoder path to",n),e.dracoLoader.setDecoderPath(n),wue(n)}}function XV(n){if(n!==void 0&&typeof n=="string"){const e=FC();UC&&console.log("Setting draco decoder type to",n),e.dracoLoader.setDecoderConfig({type:n})}}function qV(n){if(n!==void 0&&typeof n=="string"){const e=FC();UC&&console.log("Setting ktx2 transcoder path to",n),e.ktx2Loader.setTranscoderPath(n),Sue(n)}}function NC(n,e){const i=FC();return MO||(MO=i.meshoptDecoder,UC&&console.log("Using the default meshopt decoder")),e.renderer?i.ktx2Loader.detectSupport(e.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),n.dracoLoader||n.setDRACOLoader(i.dracoLoader),n.ktx2Loader||n.setKTX2Loader(i.ktx2Loader),n.meshoptDecoder||n.setMeshoptDecoder(MO),n}function YV(n,e,i){const r=i.length-n-1;if(e>=i[r])return r-1;if(e<=i[n])return n;let s=n,o=r,a=Math.floor((s+o)/2);for(;e<i[a]||e>=i[a+1];)e<i[a]?o=a:s=a,a=Math.floor((s+o)/2);return a}function lme(n,e,i,r){const s=[],o=[],a=[];s[0]=1;for(let l=1;l<=i;++l){o[l]=e-r[n+1-l],a[l]=r[n+l]-e;let c=0;for(let h=0;h<l;++h){const u=a[h+1],d=o[l-h],f=s[h]/(u+d);s[h]=c+u*f,c=d*f}s[l]=c}return s}function cme(n,e,i,r){const s=YV(n,r,e),o=lme(s,r,n,e),a=new qe(0,0,0,0);for(let l=0;l<=n;++l){const c=i[s-n+l],h=o[l],u=c.w*h;a.x+=c.x*u,a.y+=c.y*u,a.z+=c.z*u,a.w+=c.w*h}return a}function hme(n,e,i,r,s){const o=[];for(let d=0;d<=i;++d)o[d]=0;const a=[];for(let d=0;d<=r;++d)a[d]=o.slice(0);const l=[];for(let d=0;d<=i;++d)l[d]=o.slice(0);l[0][0]=1;const c=o.slice(0),h=o.slice(0);for(let d=1;d<=i;++d){c[d]=e-s[n+1-d],h[d]=s[n+d]-e;let f=0;for(let m=0;m<d;++m){const g=h[m+1],v=c[d-m];l[d][m]=g+v;const y=l[m][d-1]/l[d][m];l[m][d]=f+g*y,f=v*y}l[d][d]=f}for(let d=0;d<=i;++d)a[0][d]=l[d][i];for(let d=0;d<=i;++d){let f=0,m=1;const g=[];for(let v=0;v<=i;++v)g[v]=o.slice(0);g[0][0]=1;for(let v=1;v<=r;++v){let y=0;const A=d-v,b=i-v;d>=v&&(g[m][0]=g[f][0]/l[b+1][A],y=g[m][0]*l[A][b]);const x=A>=-1?1:-A,_=d-1<=b?v-1:i-d;for(let T=x;T<=_;++T)g[m][T]=(g[f][T]-g[f][T-1])/l[b+1][A+T],y+=g[m][T]*l[A+T][b];d<=b&&(g[m][v]=-g[f][v-1]/l[b+1][d],y+=g[m][v]*l[d][b]),a[v][d]=y;const w=f;f=m,m=w}}let u=i;for(let d=1;d<=r;++d){for(let f=0;f<=i;++f)a[d][f]*=u;u*=i-d}return a}function ume(n,e,i,r,s){const o=s<n?s:n,a=[],l=YV(n,r,e),c=hme(l,r,n,o,e),h=[];for(let u=0;u<i.length;++u){const d=i[u].clone(),f=d.w;d.x*=f,d.y*=f,d.z*=f,h[u]=d}for(let u=0;u<=o;++u){const d=h[l-n].clone().multiplyScalar(c[u][0]);for(let f=1;f<=n;++f)d.add(h[l-n+f].clone().multiplyScalar(c[u][f]));a[u]=d}for(let u=o+1;u<=s+1;++u)a[u]=new qe(0,0,0);return a}function dme(n,e){let i=1;for(let s=2;s<=n;++s)i*=s;let r=1;for(let s=2;s<=e;++s)r*=s;for(let s=2;s<=n-e;++s)r*=s;return i/r}function pme(n){const e=n.length,i=[],r=[];for(let o=0;o<e;++o){const a=n[o];i[o]=new S(a.x,a.y,a.z),r[o]=a.w}const s=[];for(let o=0;o<e;++o){const a=i[o].clone();for(let l=1;l<=o;++l)a.sub(s[o-l].clone().multiplyScalar(dme(o,l)*r[l]));s[o]=a.divideScalar(r[0])}return s}function fme(n,e,i,r,s){const o=ume(n,e,i,r,s);return pme(o)}class mme extends wa{constructor(e,i,r,s,o){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=s||0,this.endKnot=o||this.knots.length-1;for(let a=0;a<r.length;++a){const l=r[a];this.controlPoints[a]=new qe(l.x,l.y,l.z,l.w)}}getPoint(e,i=new S){const r=i,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=cme(this.degree,this.knots,this.controlPoints,s);return o.w!==1&&o.divideScalar(o.w),r.set(o.x,o.y,o.z)}getTangent(e,i=new S){const r=i,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=fme(this.degree,this.knots,this.controlPoints,s,1);return r.copy(o[1]).normalize(),r}}let ni,jn,lo;class JV extends Kn{constructor(e){super(e)}load(e,i,r,s){const o=this,a=o.path===""?dh.extractUrlBase(e):o.path,l=new Yr(this.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(c){try{i(o.parse(c,a))}catch(h){s?s(h):console.error(h),o.manager.itemError(e)}},r,s)}parse(e,i){if(xme(e))ni=new bme().parse(e);else{const s=iQ(e);if(!_me(s))throw new Error("THREE.FBXLoader: Unknown format.");if($V(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+$V(s));ni=new Ame().parse(s)}const r=new Kl(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new gme(r,this.manager).parse(ni)}}class gme{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){jn=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),r=this.parseMaterials(i),s=this.parseDeformers(),o=new vme().parse(s);return this.parseScene(s,o,r),lo}parseConnections(){const e=new Map;return"Connections"in ni&&ni.Connections.connections.forEach(function(i){const r=i[0],s=i[1],o=i[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:s,relationship:o};e.get(r).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const l={ID:r,relationship:o};e.get(s).children.push(l)}),e}parseImages(){const e={},i={};if("Video"in ni.Objects){const r=ni.Objects.Video;for(const s in r){const o=r[s],a=parseInt(s);if(e[a]=o.RelativeFilename||o.Filename,"Content"in o){const l=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(l||c){const h=this.parseImage(r[s]);i[o.RelativeFilename||o.Filename]=h}}}}for(const r in e){const s=e[r];i[s]!==void 0?e[r]=i[s]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const i=e.Content,r=e.RelativeFilename||e.Filename,s=r.slice(r.lastIndexOf(".")+1).toLowerCase();let o;switch(s){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",r),o="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof i=="string")return"data:"+o+";base64,"+i;{const a=new Uint8Array(i);return window.URL.createObjectURL(new Blob([a],{type:o}))}}parseTextures(e){const i=new Map;if("Texture"in ni.Objects){const r=ni.Objects.Texture;for(const s in r){const o=this.parseTexture(r[s],e);i.set(parseInt(s),o)}}return i}parseTexture(e,i){const r=this.loadTexture(e,i);r.ID=e.id,r.name=e.attrName;const s=e.WrapModeU,o=e.WrapModeV,a=s!==void 0?s.value:0,l=o!==void 0?o.value:0;if(r.wrapS=a===0?Ao:Yn,r.wrapT=l===0?Ao:Yn,"Scaling"in e){const c=e.Scaling.value;r.repeat.x=c[0],r.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;r.offset.x=c[0],r.offset.y=c[1]}return r}loadTexture(e,i){let r;const s=this.textureLoader.path,o=jn.get(e.id).children;o!==void 0&&o.length>0&&i[o[0].ID]!==void 0&&(r=i[o[0].ID],(r.indexOf("blob:")===0||r.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let a;const l=e.FileName.slice(-3).toLowerCase();if(l==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new Gt):(c.setPath(this.textureLoader.path),a=c.load(r))}else if(l==="dds"){const c=this.manager.getHandler(".dds");c===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),a=new Gt):(c.setPath(this.textureLoader.path),a=c.load(r))}else l==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new Gt):a=this.textureLoader.load(r);return this.textureLoader.setPath(s),a}parseMaterials(e){const i=new Map;if("Material"in ni.Objects){const r=ni.Objects.Material;for(const s in r){const o=this.parseMaterial(r[s],e);o!==null&&i.set(parseInt(s),o)}}return i}parseMaterial(e,i){const r=e.id,s=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!jn.has(r))return null;const a=this.parseParameters(e,i,r);let l;switch(o.toLowerCase()){case"phong":l=new dg;break;case"lambert":l=new jR;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),l=new dg;break}return l.setValues(a),l.name=s,l}parseParameters(e,i,r){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new be().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new be().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new be().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new be().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new be().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new be().fromArray(e.SpecularColor.value).convertSRGBToLinear());const o=this;return jn.get(r).children.forEach(function(a){const l=a.relationship;switch(l){case"Bump":s.bumpMap=o.getTexture(i,a.ID);break;case"Maya|TEX_ao_map":s.aoMap=o.getTexture(i,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=o.getTexture(i,a.ID),s.map!==void 0&&(s.map.colorSpace=gt);break;case"DisplacementColor":s.displacementMap=o.getTexture(i,a.ID);break;case"EmissiveColor":s.emissiveMap=o.getTexture(i,a.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=gt);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=o.getTexture(i,a.ID);break;case"ReflectionColor":s.envMap=o.getTexture(i,a.ID),s.envMap!==void 0&&(s.envMap.mapping=qs,s.envMap.colorSpace=gt);break;case"SpecularColor":s.specularMap=o.getTexture(i,a.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=gt);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=o.getTexture(i,a.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l);break}}),s}getTexture(e,i){return"LayeredTexture"in ni.Objects&&i in ni.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=jn.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in ni.Objects){const r=ni.Objects.Deformer;for(const s in r){const o=r[s],a=jn.get(parseInt(s));if(o.attrType==="Skin"){const l=this.parseSkeleton(a,r);l.ID=s,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=a.parents[0].ID,e[s]=l}else if(o.attrType==="BlendShape"){const l={id:s};l.rawTargets=this.parseMorphTargets(a,r),l.id=s,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[s]=l}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const r=[];return e.children.forEach(function(s){const o=i[s.ID];if(o.attrType!=="Cluster")return;const a={ID:s.ID,indices:[],weights:[],transformLink:new he().fromArray(o.TransformLink.a)};"Indexes"in o&&(a.indices=o.Indexes.a,a.weights=o.Weights.a),r.push(a)}),{rawBones:r,bones:[]}}parseMorphTargets(e,i){const r=[];for(let s=0;s<e.children.length;s++){const o=e.children[s],a=i[o.ID],l={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;l.geoID=jn.get(parseInt(o.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,r.push(l)}return r}parseScene(e,i,r){lo=new Cr;const s=this.parseModels(e.skeletons,i,r),o=ni.Objects.Model,a=this;s.forEach(function(c){var h;const u=o[c.ID];a.setLookAtProperties(c,u);const d=(h=jn.get(c.ID))==null?void 0:h.parents;d?.forEach(function(f){const m=s.get(f.ID);m!==void 0&&m.add(c)}),c.parent===null&&lo.add(c)}),this.bindSkeleton(e.skeletons,i,s),this.addGlobalSceneSettings(),lo.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const h=eQ(c.userData.transformData);c.applyMatrix4(h),c.updateWorldMatrix()}});const l=new yme().parse();lo.children.length===1&&lo.children[0].isGroup&&(lo.children[0].animations=l,lo=lo.children[0]),lo.animations=l}parseModels(e,i,r){const s=new Map,o=ni.Objects.Model;for(const a in o){const l=parseInt(a),c=o[a],h=jn.get(l);let u=this.buildSkeleton(h,e,l,c.attrName);if(!u){switch(c.attrType){case"Camera":u=this.createCamera(h);break;case"Light":u=this.createLight(h);break;case"Mesh":u=this.createMesh(h,i,r);break;case"NurbsCurve":u=this.createCurve(h,i);break;case"LimbNode":case"Root":u=new Dp;break;case"Null":default:u=new Cr;break}u.name=c.attrName?Yt.sanitizeNodeName(c.attrName):"",u.userData.originalName=c.attrName,u.ID=l}this.getTransformData(u,c),s.set(l,u)}return s}buildSkeleton(e,i,r,s){let o=null;return e?.parents.forEach(function(a){for(const l in i){const c=i[l];c.rawBones.forEach(function(h,u){if(h.ID===a.ID){const d=o;o=new Dp,o.matrixWorld.copy(h.transformLink),o.name=s?Yt.sanitizeNodeName(s):"",o.userData.originalName=s,o.ID=r,c.bones[u]=o,d!==null&&o.add(d)}})}}),o}createCamera(e){let i,r;if(e.children.forEach(function(s){const o=ni.Objects.NodeAttribute[s.ID];o!==void 0&&(r=o)}),r===void 0)i=new ve;else{let s=0;r.CameraProjectionType!==void 0&&r.CameraProjectionType.value===1&&(s=1);let o=1;r.NearPlane!==void 0&&(o=r.NearPlane.value/1e3);let a=1e3;r.FarPlane!==void 0&&(a=r.FarPlane.value/1e3);let l=window.innerWidth,c=window.innerHeight;r.AspectWidth!==void 0&&r.AspectHeight!==void 0&&(l=r.AspectWidth.value,c=r.AspectHeight.value);const h=l/c;let u=45;r.FieldOfView!==void 0&&(u=r.FieldOfView.value);const d=r.FocalLength?r.FocalLength.value:null;switch(s){case 0:i=new Ft(u,h,o,a),d!==null&&i.setFocalLength(d);break;case 1:i=new Yl(-l/2,l/2,c/2,-c/2,o,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),i=new ve;break}}return i}createLight(e){let i,r;if(e.children.forEach(function(s){const o=ni.Objects.NodeAttribute[s.ID];o!==void 0&&(r=o)}),r===void 0)i=new ve;else{let s;r.LightType===void 0?s=0:s=r.LightType.value;let o=16777215;r.Color!==void 0&&(o=new be().fromArray(r.Color.value).convertSRGBToLinear());let a=r.Intensity===void 0?1:r.Intensity.value/100;r.CastLightOnObject!==void 0&&r.CastLightOnObject.value===0&&(a=0);let l=0;r.FarAttenuationEnd!==void 0&&(r.EnableFarAttenuation!==void 0&&r.EnableFarAttenuation.value===0?l=0:l=r.FarAttenuationEnd.value);const c=1;switch(s){case 0:i=new jp(o,a,l,c);break;case 1:i=new Gp(o,a);break;case 2:let h=Math.PI/3;r.InnerAngle!==void 0&&(h=pi.degToRad(r.InnerAngle.value));let u=0;r.OuterAngle!==void 0&&(u=pi.degToRad(r.OuterAngle.value),u=Math.max(u,1)),i=new ky(o,a,l,h,u,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),i=new jp(o,a);break}r.CastShadows!==void 0&&r.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,r){let s,o=null,a=null;const l=[];return e.children.forEach(function(c){i.has(c.ID)&&(o=i.get(c.ID)),r.has(c.ID)&&l.push(r.get(c.ID))}),l.length>1?a=l:l.length>0?a=l[0]:(a=new dg({name:Kn.DEFAULT_MATERIAL_NAME,color:13421772}),l.push(a)),"color"in o.attributes&&l.forEach(function(c){c.vertexColors=!0}),o.FBX_Deformer?(s=new wo(o,a),s.normalizeSkinWeights()):s=new pe(o,a),s}createCurve(e,i){const r=e.children.reduce(function(o,a){return i.has(a.ID)&&(o=i.get(a.ID)),o},null),s=new zi({name:Kn.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new hn(r,s)}getTransformData(e,i){const r={};"InheritType"in i&&(r.inheritType=parseInt(i.InheritType.value)),"RotationOrder"in i?r.eulerOrder=tQ(i.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in i&&(r.translation=i.Lcl_Translation.value),"PreRotation"in i&&(r.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(r.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(r.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(r.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(r.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(r.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(r.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(r.rotationPivot=i.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,i){"LookAtProperty"in i&&jn.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=ni.Objects.Model[r.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),lo.add(e.target)):e.lookAt(new S().fromArray(o))}}})}bindSkeleton(e,i,r){const s=this.parsePoseNodes();for(const o in e){const a=e[o];jn.get(parseInt(a.ID)).parents.forEach(function(l){if(i.has(l.ID)){const c=l.ID;jn.get(c).parents.forEach(function(h){r.has(h.ID)&&r.get(h.ID).bind(new _y(a.bones),s[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in ni.Objects){const i=ni.Objects.Pose;for(const r in i)if(i[r].attrType==="BindPose"&&i[r].NbPoseNodes>0){const s=i[r].PoseNode;Array.isArray(s)?s.forEach(function(o){e[o.Node]=new he().fromArray(o.Matrix.a)}):e[s.Node]=new he().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in ni){if("AmbientColor"in ni.GlobalSettings){const e=ni.GlobalSettings.AmbientColor.value,i=e[0],r=e[1],s=e[2];if(i!==0||r!==0||s!==0){const o=new be(i,r,s).convertSRGBToLinear();lo.add(new Hw(o,1))}}"UnitScaleFactor"in ni.GlobalSettings&&(lo.userData.unitScaleFactor=ni.GlobalSettings.UnitScaleFactor.value)}}}class vme{constructor(){this.negativeMaterialIndices=!1}parse(e){const i=new Map;if("Geometry"in ni.Objects){const r=ni.Objects.Geometry;for(const s in r){const o=jn.get(parseInt(s)),a=this.parseGeometry(o,r[s],e);i.set(parseInt(s),a)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),i}parseGeometry(e,i,r){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,r);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,r){const s=r.skeletons,o=[],a=e.parents.map(function(d){return ni.Objects.Model[d.ID]});if(a.length===0)return;const l=e.children.reduce(function(d,f){return s[f.ID]!==void 0&&(d=s[f.ID]),d},null);e.children.forEach(function(d){r.morphTargets[d.ID]!==void 0&&o.push(r.morphTargets[d.ID])});const c=a[0],h={};"RotationOrder"in c&&(h.eulerOrder=tQ(c.RotationOrder.value)),"InheritType"in c&&(h.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(h.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(h.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(h.scale=c.GeometricScaling.value);const u=eQ(h);return this.genGeometry(i,l,o,u)}genGeometry(e,i,r,s){const o=new dt;e.attrName&&(o.name=e.attrName);const a=this.parseGeoNode(e,i),l=this.genBuffers(a),c=new rt(l.vertex,3);if(c.applyMatrix4(s),o.setAttribute("position",c),l.colors.length>0&&o.setAttribute("color",new rt(l.colors,3)),i&&(o.setAttribute("skinIndex",new tw(l.weightsIndices,4)),o.setAttribute("skinWeight",new rt(l.vertexWeights,4)),o.FBX_Deformer=i),l.normal.length>0){const h=new Lt().getNormalMatrix(s),u=new rt(l.normal,3);u.applyNormalMatrix(h),o.setAttribute("normal",u)}if(l.uvs.forEach(function(h,u){const d=u===0?"uv":`uv${u}`;o.setAttribute(d,new rt(l.uvs[u],2))}),a.material&&a.material.mappingType!=="AllSame"){let h=l.materialIndex[0],u=0;if(l.materialIndex.forEach(function(d,f){d!==h&&(o.addGroup(u,f-u,h),h=d,u=f)}),o.groups.length>0){const d=o.groups[o.groups.length-1],f=d.start+d.count;f!==l.materialIndex.length&&o.addGroup(f,l.materialIndex.length-f,h)}o.groups.length===0&&o.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(o,e,r,s),o}parseGeoNode(e,i){const r={};if(r.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],r.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return r.weightTable={},i!==null&&(r.skeleton=i,i.rawBones.forEach(function(s,o){s.indices.forEach(function(a,l){r.weightTable[a]===void 0&&(r.weightTable[a]=[]),r.weightTable[a].push({id:o,weight:s.weights[l]})})})),r}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,s=0,o=!1,a=[],l=[],c=[],h=[],u=[],d=[];const f=this;return e.vertexIndices.forEach(function(m,g){let v,y=!1;m<0&&(m=m^-1,y=!0);let A=[],b=[];if(a.push(m*3,m*3+1,m*3+2),e.color){const x=zC(g,r,m,e.color);c.push(x[0],x[1],x[2])}if(e.skeleton){if(e.weightTable[m]!==void 0&&e.weightTable[m].forEach(function(x){b.push(x.weight),A.push(x.id)}),b.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const x=[0,0,0,0],_=[0,0,0,0];b.forEach(function(w,T){let M=w,R=A[T];_.forEach(function(B,E,P){if(M>B){P[E]=M,M=B;const O=x[E];x[E]=R,R=O}})}),A=x,b=_}for(;b.length<4;)b.push(0),A.push(0);for(let x=0;x<4;++x)u.push(b[x]),d.push(A[x])}if(e.normal){const x=zC(g,r,m,e.normal);l.push(x[0],x[1],x[2])}e.material&&e.material.mappingType!=="AllSame"&&(v=zC(g,r,m,e.material)[0],v<0&&(f.negativeMaterialIndices=!0,v=0)),e.uv&&e.uv.forEach(function(x,_){const w=zC(g,r,m,x);h[_]===void 0&&(h[_]=[]),h[_].push(w[0]),h[_].push(w[1])}),s++,y&&(f.genFace(i,e,a,v,l,c,h,u,d,s),r++,s=0,a=[],l=[],c=[],h=[],u=[],d=[])}),i}getNormalNewell(e){const i=new S(0,0,0);for(let r=0;r<e.length;r++){const s=e[r],o=e[(r+1)%e.length];i.x+=(s.y-o.y)*(s.z+o.z),i.y+=(s.z-o.z)*(s.x+o.x),i.z+=(s.x-o.x)*(s.y+o.y)}return i.normalize(),i}getNormalTangentAndBitangent(e){const i=this.getNormalNewell(e),r=(Math.abs(i.z)>.5?new S(0,1,0):new S(0,0,1)).cross(i).normalize(),s=i.clone().cross(r).normalize();return{normal:i,tangent:r,bitangent:s}}flattenVertex(e,i,r){return new J(e.dot(i),e.dot(r))}genFace(e,i,r,s,o,a,l,c,h,u){let d;if(u>3){const f=[];for(let y=0;y<r.length;y+=3)f.push(new S(i.vertexPositions[r[y]],i.vertexPositions[r[y+1]],i.vertexPositions[r[y+2]]));const{tangent:m,bitangent:g}=this.getNormalTangentAndBitangent(f),v=[];for(const y of f)v.push(this.flattenVertex(y,m,g));d=Gl.triangulateShape(v,[])}else d=[[0,1,2]];for(const[f,m,g]of d)e.vertex.push(i.vertexPositions[r[f*3]]),e.vertex.push(i.vertexPositions[r[f*3+1]]),e.vertex.push(i.vertexPositions[r[f*3+2]]),e.vertex.push(i.vertexPositions[r[m*3]]),e.vertex.push(i.vertexPositions[r[m*3+1]]),e.vertex.push(i.vertexPositions[r[m*3+2]]),e.vertex.push(i.vertexPositions[r[g*3]]),e.vertex.push(i.vertexPositions[r[g*3+1]]),e.vertex.push(i.vertexPositions[r[g*3+2]]),i.skeleton&&(e.vertexWeights.push(c[f*4]),e.vertexWeights.push(c[f*4+1]),e.vertexWeights.push(c[f*4+2]),e.vertexWeights.push(c[f*4+3]),e.vertexWeights.push(c[m*4]),e.vertexWeights.push(c[m*4+1]),e.vertexWeights.push(c[m*4+2]),e.vertexWeights.push(c[m*4+3]),e.vertexWeights.push(c[g*4]),e.vertexWeights.push(c[g*4+1]),e.vertexWeights.push(c[g*4+2]),e.vertexWeights.push(c[g*4+3]),e.weightsIndices.push(h[f*4]),e.weightsIndices.push(h[f*4+1]),e.weightsIndices.push(h[f*4+2]),e.weightsIndices.push(h[f*4+3]),e.weightsIndices.push(h[m*4]),e.weightsIndices.push(h[m*4+1]),e.weightsIndices.push(h[m*4+2]),e.weightsIndices.push(h[m*4+3]),e.weightsIndices.push(h[g*4]),e.weightsIndices.push(h[g*4+1]),e.weightsIndices.push(h[g*4+2]),e.weightsIndices.push(h[g*4+3])),i.color&&(e.colors.push(a[f*3]),e.colors.push(a[f*3+1]),e.colors.push(a[f*3+2]),e.colors.push(a[m*3]),e.colors.push(a[m*3+1]),e.colors.push(a[m*3+2]),e.colors.push(a[g*3]),e.colors.push(a[g*3+1]),e.colors.push(a[g*3+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),i.normal&&(e.normal.push(o[f*3]),e.normal.push(o[f*3+1]),e.normal.push(o[f*3+2]),e.normal.push(o[m*3]),e.normal.push(o[m*3+1]),e.normal.push(o[m*3+2]),e.normal.push(o[g*3]),e.normal.push(o[g*3+1]),e.normal.push(o[g*3+2])),i.uv&&i.uv.forEach(function(v,y){e.uvs[y]===void 0&&(e.uvs[y]=[]),e.uvs[y].push(l[y][f*2]),e.uvs[y].push(l[y][f*2+1]),e.uvs[y].push(l[y][m*2]),e.uvs[y].push(l[y][m*2+1]),e.uvs[y].push(l[y][g*2]),e.uvs[y].push(l[y][g*2+1])})}addMorphTargets(e,i,r,s){if(r.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;r.forEach(function(a){a.rawTargets.forEach(function(l){const c=ni.Objects.Geometry[l.geoID];c!==void 0&&o.genMorphGeometry(e,i,c,s,l.name)})})}genMorphGeometry(e,i,r,s,o){const a=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],l=r.Vertices!==void 0?r.Vertices.a:[],c=r.Indexes!==void 0?r.Indexes.a:[],h=e.attributes.position.count*3,u=new Float32Array(h);for(let g=0;g<c.length;g++){const v=c[g]*3;u[v]=l[g*3],u[v+1]=l[g*3+1],u[v+2]=l[g*3+2]}const d={vertexIndices:a,vertexPositions:u},f=this.genBuffers(d),m=new rt(f.vertex,3);m.name=o||r.attrName,m.applyMatrix4(s),e.morphAttributes.position.push(m)}parseNormals(e){const i=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Normals.a;let o=[];return r==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:o,mappingType:i,referenceType:r}}parseUVs(e){const i=e.MappingInformationType,r=e.ReferenceInformationType,s=e.UV.a;let o=[];return r==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:s,indices:o,mappingType:i,referenceType:r}}parseVertexColors(e){const i=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Colors.a;let o=[];r==="IndexToDirect"&&(o=e.ColorIndex.a);for(let a=0,l=new be;a<s.length;a+=4)l.fromArray(s,a).convertSRGBToLinear().toArray(s,a);return{dataSize:4,buffer:s,indices:o,mappingType:i,referenceType:r}}parseMaterialIndices(e){const i=e.MappingInformationType,r=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const s=e.Materials.a,o=[];for(let a=0;a<s.length;++a)o.push(a);return{dataSize:1,buffer:s,indices:o,mappingType:i,referenceType:r}}parseNurbsGeometry(e){const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new dt;const r=i-1,s=e.KnotVector.a,o=[],a=e.Points.a;for(let u=0,d=a.length;u<d;u+=4)o.push(new qe().fromArray(a,u));let l,c;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){l=r,c=s.length-1-l;for(let u=0;u<r;++u)o.push(o[u])}const h=new mme(r,s,o,l,c).getPoints(o.length*12);return new dt().setFromPoints(h)}}class yme{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const r in i){const s=i[r],o=this.addClip(s);e.push(o)}return e}parseClips(){if(ni.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=ni.Objects.AnimationCurveNode,i=new Map;for(const r in e){const s=e[r];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:s.id,attr:s.attrName,curves:{}};i.set(o.id,o)}}return i}parseAnimationCurves(e){const i=ni.Objects.AnimationCurve;for(const r in i){const s={id:i[r].id,times:i[r].KeyTime.a.map(wme),values:i[r].KeyValueFloat.a},o=jn.get(s.id);if(o!==void 0){const a=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?e.get(a).curves.x=s:l.match(/Y/)?e.get(a).curves.y=s:l.match(/Z/)?e.get(a).curves.z=s:l.match(/DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=s)}}}parseAnimationLayers(e){const i=ni.Objects.AnimationLayer,r=new Map;for(const s in i){const o=[],a=jn.get(parseInt(s));a!==void 0&&(a.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(o[c]===void 0){const u=jn.get(l.ID).parents.filter(function(d){return d.relationship!==void 0})[0].ID;if(u!==void 0){const d=ni.Objects.Model[u.toString()];if(d===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const f={modelName:d.attrName?Yt.sanitizeNodeName(d.attrName):"",ID:d.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};lo.traverse(function(m){m.ID===d.id&&(f.transform=m.matrix,m.userData.transformData&&(f.eulerOrder=m.userData.transformData.eulerOrder))}),f.transform||(f.transform=new he),"PreRotation"in d&&(f.preRotation=d.PreRotation.value),"PostRotation"in d&&(f.postRotation=d.PostRotation.value),o[c]=f}}o[c]&&(o[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(o[c]===void 0){const u=jn.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,d=jn.get(u).parents[0].ID,f=jn.get(d).parents[0].ID,m=jn.get(f).parents[0].ID,g=ni.Objects.Model[m],v={modelName:g.attrName?Yt.sanitizeNodeName(g.attrName):"",morphName:ni.Objects.Deformer[u].attrName};o[c]=v}o[c][h.attr]=h}}}),r.set(parseInt(s),o))}return r}parseAnimStacks(e){const i=ni.Objects.AnimationStack,r={};for(const s in i){const o=jn.get(parseInt(s)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(o[0].ID);r[s]={name:i[s].attrName,layer:a}}return r}addClip(e){let i=[];const r=this;return e.layer.forEach(function(s){i=i.concat(r.generateTracks(s))}),new $s(e.name,-1,i)}generateTracks(e){const i=[];let r=new S,s=new S;if(e.transform&&e.transform.decompose(r,new Ce,s),r=r.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");o!==void 0&&i.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&i.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");o!==void 0&&i.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&i.push(o)}return i}generateVectorTrack(e,i,r,s){const o=this.getTimesForAllAxes(i),a=this.getKeyframeTrackValues(o,i,r);return new Jl(e+"."+s,o,a)}generateRotationTrack(e,i,r,s,o){let a,l;if(i.x===void 0||i.y===void 0||i.z===void 0){console.warn("THREE.FBXLoader: Missing rotation curves "+(i.x===void 0?"x ":"")+(i.y===void 0?"y ":"")+(i.z===void 0?"z ":"")+" for animation of "+e+". This is currently not supported.");return}if(i.x!==void 0&&i.y!==void 0&&i.z!==void 0){const d=this.interpolateRotations(i.x,i.y,i.z,o);a=d[0],l=d[1]}r!==void 0&&(r=r.map(pi.degToRad),r.push(o),r=new ri().fromArray(r),r=new Ce().setFromEuler(r)),s!==void 0&&(s=s.map(pi.degToRad),s.push(o),s=new ri().fromArray(s),s=new Ce().setFromEuler(s).invert());const c=new Ce,h=new ri,u=[];if(!(!l||!a)){for(let d=0;d<l.length;d+=3)h.set(l[d],l[d+1],l[d+2],o),c.setFromEuler(h),r!==void 0&&c.premultiply(r),s!==void 0&&c.multiply(s),d>2&&new Ce().fromArray(u,(d-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(u,d/3*4);return new hl(e+".quaternion",a,u)}}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,r=i.values.map(function(o){return o/100}),s=lo.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ch(e.modelName+".morphTargetInfluences["+s+"]",i.times,r)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(r,s){return r-s}),i.length>1){let r=1,s=i[0];for(let o=1;o<i.length;o++){const a=i[o];a!==s&&(i[r]=a,s=a,r++)}i=i.slice(0,r)}return i}getKeyframeTrackValues(e,i,r){const s=r,o=[];let a=-1,l=-1,c=-1;return e.forEach(function(h){if(i.x&&(a=i.x.times.indexOf(h)),i.y&&(l=i.y.times.indexOf(h)),i.z&&(c=i.z.times.indexOf(h)),a!==-1){const u=i.x.values[a];o.push(u),s[0]=u}else o.push(s[0]);if(l!==-1){const u=i.y.values[l];o.push(u),s[1]=u}else o.push(s[1]);if(c!==-1){const u=i.z.values[c];o.push(u),s[2]=u}else o.push(s[2])}),o}interpolateRotations(e,i,r,s){const o=[],a=[];o.push(e.times[0]),a.push(pi.degToRad(e.values[0])),a.push(pi.degToRad(i.values[0])),a.push(pi.degToRad(r.values[0]));for(let l=1;l<e.values.length;l++){const c=[e.values[l-1],i.values[l-1],r.values[l-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const h=c.map(pi.degToRad),u=[e.values[l],i.values[l],r.values[l]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const d=u.map(pi.degToRad),f=[u[0]-c[0],u[1]-c[1],u[2]-c[2]],m=[Math.abs(f[0]),Math.abs(f[1]),Math.abs(f[2])];if(m[0]>=180||m[1]>=180||m[2]>=180){const g=Math.max(...m)/180,v=new ri(...h,s),y=new ri(...d,s),A=new Ce().setFromEuler(v),b=new Ce().setFromEuler(y);A.dot(b)&&b.set(-b.x,-b.y,-b.z,-b.w);const x=e.times[l-1],_=e.times[l]-x,w=new Ce,T=new ri;for(let M=0;M<1;M+=1/g)w.copy(A.clone().slerp(b.clone(),M)),o.push(x+M*_),T.setFromQuaternion(w,s),a.push(T.x),a.push(T.y),a.push(T.z)}else o.push(e.times[l]),a.push(pi.degToRad(e.values[l])),a.push(pi.degToRad(i.values[l])),a.push(pi.degToRad(r.values[l]))}return[o,a]}}class Ame{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new ZV,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,r=e.split(/[\r\n]+/);return r.forEach(function(s,o){const a=s.match(/^[\s\t]*;/),l=s.match(/^[\s\t]*$/);if(a||l)return;const c=s.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),h=s.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=s.match("^\\t{"+(i.currentIndent-1)+"}}");c?i.parseNodeBegin(s,c):h?i.parseNodeProperty(s,h,r[++o]):u?i.popStack():s.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,i){const r=i[1].trim().replace(/^"/,"").replace(/"$/,""),s=i[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:r},a=this.parseNodeAttr(s),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(r,o):r in l?(r==="PoseNode"?l.PoseNode.push(o):l[r].id!==void 0&&(l[r]={},l[r][l[r].id]=l[r]),a.id!==""&&(l[r][a.id]=o)):typeof a.id=="number"?(l[r]={},l[r][a.id]=o):r!=="Properties70"&&(r==="PoseNode"?l[r]=[o]:l[r]=o),typeof a.id=="number"&&(o.id=a.id),a.name!==""&&(o.attrName=a.name),a.type!==""&&(o.attrType=a.type),this.pushStack(o)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let r="",s="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:i,name:r,type:s}}parseNodeProperty(e,i,r){let s=i[1].replace(/^"/,"").replace(/"$/,"").trim(),o=i[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&o===","&&(o=r.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name==="Properties70"){this.parseNodeSpecialProperty(e,s,o);return}if(s==="C"){const l=o.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let u=o.split(",").slice(3);u=u.map(function(d){return d.trim().replace(/^"/,"")}),s="connections",o=[c,h],Cme(o,u),a[s]===void 0&&(a[s]=[])}s==="Node"&&(a.id=o),s in a&&Array.isArray(a[s])?a[s].push(o):s!=="a"?a[s]=o:a.a=o,this.setCurrentProp(a,s),s==="a"&&o.slice(-1)!==","&&(a.a=RO(o))}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=RO(i.a))}parseNodeSpecialProperty(e,i,r){const s=r.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=s[0],a=s[1],l=s[2],c=s[3];let h=s[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=RO(h);break}this.getPrevNode()[o]={type:a,type2:l,flag:c,value:h},this.setCurrentProp(this.getPrevNode(),o)}}class bme{parse(e){const i=new KV(e);i.skip(23);const r=i.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const s=new ZV;for(;!this.endOfContent(i);){const o=this.parseNode(i,r);o!==null&&s.add(o.name,o)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const r={},s=i>=7500?e.getUint64():e.getUint32(),o=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),l=e.getString(a);if(s===0)return null;const c=[];for(let f=0;f<o;f++)c.push(this.parseProperty(e));const h=c.length>0?c[0]:"",u=c.length>1?c[1]:"",d=c.length>2?c[2]:"";for(r.singleProperty=o===1&&e.getOffset()===s;s>e.getOffset();){const f=this.parseNode(e,i);f!==null&&this.parseSubNode(l,r,f)}return r.propertyList=c,typeof h=="number"&&(r.id=h),u!==""&&(r.attrName=u),d!==""&&(r.attrType=d),l!==""&&(r.name=l),r}parseSubNode(e,i,r){if(r.singleProperty===!0){const s=r.propertyList[0];Array.isArray(s)?(i[r.name]=r,r.a=s):i[r.name]=s}else if(e==="Connections"&&r.name==="C"){const s=[];r.propertyList.forEach(function(o,a){a!==0&&s.push(o)}),i.connections===void 0&&(i.connections=[]),i.connections.push(s)}else if(r.name==="Properties70")Object.keys(r).forEach(function(s){i[s]=r[s]});else if(e==="Properties70"&&r.name==="P"){let s=r.propertyList[0],o=r.propertyList[1];const a=r.propertyList[2],l=r.propertyList[3];let c;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?c=[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:c=r.propertyList[4],i[s]={type:o,type2:a,flag:l,value:c}}else i[r.name]===void 0?typeof r.id=="number"?(i[r.name]={},i[r.name][r.id]=r):i[r.name]=r:r.name==="PoseNode"?(Array.isArray(i[r.name])||(i[r.name]=[i[r.name]]),i[r.name].push(r)):i[r.name][r.id]===void 0&&(i[r.name][r.id]=r)}parseProperty(e){const i=e.getString(1);let r;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),o=e.getUint32(),a=e.getUint32();if(o===0)switch(i){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const l=rb(new Uint8Array(e.getArrayBuffer(a))),c=new KV(l.buffer);switch(i){case"b":case"c":return c.getBooleanArray(s);case"d":return c.getFloat64Array(s);case"f":return c.getFloat32Array(s);case"i":return c.getInt32Array(s);case"l":return c.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class KV{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i!==void 0?i:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const i=[];for(let r=0;r<e;r++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let r=0;r<e;r++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i&2147483648?(i=~i&4294967295,e=~e&4294967295,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(i*4294967296+e)):i*4294967296+e}getInt64Array(e){const i=[];for(let r=0;r<e;r++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),i*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let r=0;r<e;r++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let r=0;r<e;r++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){const i=this.offset;let r=new Uint8Array(this.dv.buffer,i,e);this.skip(e);const s=r.indexOf(0);return s>=0&&(r=new Uint8Array(this.dv.buffer,i,s)),this._textDecoder.decode(r)}}class ZV{add(e,i){this[e]=i}}function xme(n){const e="Kaydara FBX Binary  \0";return n.byteLength>=e.length&&e===iQ(n,0,e.length)}function _me(n){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let i=0;function r(s){const o=n[s-1];return n=n.slice(i+s),i++,o}for(let s=0;s<e.length;++s)if(r(1)===e[s])return!1;return!0}function $V(n){const e=/FBXVersion: (\d+)/,i=n.match(e);if(i)return parseInt(i[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function wme(n){return n/46186158e3}const Sme=[];function zC(n,e,i,r){let s;switch(r.mappingType){case"ByPolygonVertex":s=n;break;case"ByPolygon":s=e;break;case"ByVertice":s=i;break;case"AllSame":s=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}r.referenceType==="IndexToDirect"&&(s=r.indices[s]);const o=s*r.dataSize,a=o+r.dataSize;return Eme(Sme,r.buffer,o,a)}const IO=new ri,g0=new S;function eQ(n){const e=new he,i=new he,r=new he,s=new he,o=new he,a=new he,l=new he,c=new he,h=new he,u=new he,d=new he,f=new he,m=n.inheritType?n.inheritType:0;if(n.translation&&e.setPosition(g0.fromArray(n.translation)),n.preRotation){const E=n.preRotation.map(pi.degToRad);E.push(n.eulerOrder||ri.DEFAULT_ORDER),i.makeRotationFromEuler(IO.fromArray(E))}if(n.rotation){const E=n.rotation.map(pi.degToRad);E.push(n.eulerOrder||ri.DEFAULT_ORDER),r.makeRotationFromEuler(IO.fromArray(E))}if(n.postRotation){const E=n.postRotation.map(pi.degToRad);E.push(n.eulerOrder||ri.DEFAULT_ORDER),s.makeRotationFromEuler(IO.fromArray(E)),s.invert()}n.scale&&o.scale(g0.fromArray(n.scale)),n.scalingOffset&&l.setPosition(g0.fromArray(n.scalingOffset)),n.scalingPivot&&a.setPosition(g0.fromArray(n.scalingPivot)),n.rotationOffset&&c.setPosition(g0.fromArray(n.rotationOffset)),n.rotationPivot&&h.setPosition(g0.fromArray(n.rotationPivot)),n.parentMatrixWorld&&(d.copy(n.parentMatrix),u.copy(n.parentMatrixWorld));const g=i.clone().multiply(r).multiply(s),v=new he;v.extractRotation(u);const y=new he;y.copyPosition(u);const A=y.clone().invert().multiply(u),b=v.clone().invert().multiply(A),x=o,_=new he;if(m===0)_.copy(v).multiply(g).multiply(b).multiply(x);else if(m===1)_.copy(v).multiply(b).multiply(g).multiply(x);else{const E=new he().scale(new S().setFromMatrixScale(d)).clone().invert(),P=b.clone().multiply(E);_.copy(v).multiply(g).multiply(P).multiply(x)}const w=h.clone().invert(),T=a.clone().invert();let M=e.clone().multiply(c).multiply(h).multiply(i).multiply(r).multiply(s).multiply(w).multiply(l).multiply(a).multiply(o).multiply(T);const R=new he().copyPosition(M),B=u.clone().multiply(R);return f.copyPosition(B),M=f.clone().multiply(_),M.premultiply(u.invert()),M}function tQ(n){n=n||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[n]}function RO(n){return n.split(",").map(function(e){return parseFloat(e)})}function iQ(n,e,i){return e===void 0&&(e=0),i===void 0&&(i=n.byteLength),new TextDecoder().decode(new Uint8Array(n,e,i))}function Cme(n,e){for(let i=0,r=n.length,s=e.length;i<s;i++,r++)n[r]=e[i]}function Eme(n,e,i,r){for(let s=i,o=0;s<r;s++,o++)n[o]=e[s];return n}function Mme(n,e=1e-4){e=Math.max(e,Number.EPSILON);const i={},r=n.getIndex(),s=n.getAttribute("position"),o=r?r.count:s.count;let a=0;const l=Object.keys(n.attributes),c={},h={},u=[],d=["getX","getY","getZ","getW"],f=["setX","setY","setZ","setW"];for(let b=0,x=l.length;b<x;b++){const _=l[b],w=n.attributes[_];c[_]=new Ye(new w.array.constructor(w.count*w.itemSize),w.itemSize,w.normalized);const T=n.morphAttributes[_];T&&(h[_]=new Ye(new T.array.constructor(T.count*T.itemSize),T.itemSize,T.normalized))}const m=e*.5,g=Math.log10(1/e),v=Math.pow(10,g),y=m*v;for(let b=0;b<o;b++){const x=r?r.getX(b):b;let _="";for(let w=0,T=l.length;w<T;w++){const M=l[w],R=n.getAttribute(M),B=R.itemSize;for(let E=0;E<B;E++)_+=`${~~(R[d[E]](x)*v+y)},`}if(_ in i)u.push(i[_]);else{for(let w=0,T=l.length;w<T;w++){const M=l[w],R=n.getAttribute(M),B=n.morphAttributes[M],E=R.itemSize,P=c[M],O=h[M];for(let N=0;N<E;N++){const L=d[N],Q=f[N];if(P[Q](a,R[L](x)),B)for(let D=0,F=B.length;D<F;D++)O[D][Q](a,B[D][L](x))}}i[_]=a,u.push(a),a++}}const A=n.clone();for(const b in n.attributes){const x=c[b];if(A.setAttribute(b,new Ye(x.array.slice(0,a*x.itemSize),x.itemSize,x.normalized)),b in h)for(let _=0;_<h[b].length;_++){const w=h[b][_];A.morphAttributes[b][_]=new Ye(w.array.slice(0,a*w.itemSize),w.itemSize,w.normalized)}}return A.setIndex(u),A}function nQ(n,e){if(e===sF)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===U_||e===TI){let i=n.getIndex();if(i===null){const a=[],l=n.getAttribute("position");if(l!==void 0){for(let c=0;c<l.count;c++)a.push(c);n.setIndex(a),i=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const r=i.count-2,s=[];if(e===U_)for(let a=1;a<=r;a++)s.push(i.getX(0)),s.push(i.getX(a)),s.push(i.getX(a+1));else for(let a=0;a<r;a++)a%2===0?(s.push(i.getX(a)),s.push(i.getX(a+1)),s.push(i.getX(a+2))):(s.push(i.getX(a+2)),s.push(i.getX(a+1)),s.push(i.getX(a)));s.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=n.clone();return o.setIndex(s),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class gd extends Kn{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new Bme(i)}),this.register(function(i){return new jme(i)}),this.register(function(i){return new Gme(i)}),this.register(function(i){return new Hme(i)}),this.register(function(i){return new Ome(i)}),this.register(function(i){return new Dme(i)}),this.register(function(i){return new Lme(i)}),this.register(function(i){return new Ume(i)}),this.register(function(i){return new Pme(i)}),this.register(function(i){return new Fme(i)}),this.register(function(i){return new kme(i)}),this.register(function(i){return new zme(i)}),this.register(function(i){return new Nme(i)}),this.register(function(i){return new Ime(i)}),this.register(function(i){return new Vme(i)}),this.register(function(i){return new Qme(i)})}load(e,i,r,s){const o=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const h=dh.extractUrlBase(e);a=dh.resolveURL(h,this.path)}else a=dh.extractUrlBase(e);this.manager.itemStart(e);const l=function(h){s?s(h):console.error(h),o.manager.itemError(e),o.manager.itemEnd(e)},c=new Yr(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(h){try{o.parse(h,a,function(u){i(u),o.manager.itemEnd(e)},l)}catch(u){l(u)}},r,l)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,r,s){let o;const a={},l={},c=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===rQ){try{a[ui.KHR_BINARY_GLTF]=new Wme(e)}catch(u){s&&s(u);return}o=JSON.parse(a[ui.KHR_BINARY_GLTF].content)}else o=JSON.parse(c.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new sge(o,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](h);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[d.name]=d,a[d.name]=!0}if(o.extensionsUsed)for(let u=0;u<o.extensionsUsed.length;++u){const d=o.extensionsUsed[u],f=o.extensionsRequired||[];switch(d){case ui.KHR_MATERIALS_UNLIT:a[d]=new Rme;break;case ui.KHR_DRACO_MESH_COMPRESSION:a[d]=new Xme(o,this.dracoLoader);break;case ui.KHR_TEXTURE_TRANSFORM:a[d]=new qme;break;case ui.KHR_MESH_QUANTIZATION:a[d]=new Yme;break;default:f.indexOf(d)>=0&&l[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}h.setExtensions(a),h.setPlugins(l),h.parse(r,s)}parseAsync(e,i){const r=this;return new Promise(function(s,o){r.parse(e,i,s,o)})}}function Tme(){let n={};return{get:function(e){return n[e]},add:function(e,i){n[e]=i},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const ui={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Ime{constructor(e){this.parser=e,this.name=ui.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let r=0,s=i.length;r<s;r++){const o=i[r];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const i=this.parser,r="light:"+e;let s=i.cache.get(r);if(s)return s;const o=i.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let l;const c=new be(16777215);a.color!==void 0&&c.setRGB(a.color[0],a.color[1],a.color[2],Ii);const h=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new Gp(c),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new jp(c),l.distance=h;break;case"spot":l=new ky(c),l.distance=h,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,yd(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=i.createUniqueName(a.name||"light_"+e),s=Promise.resolve(l),i.cache.add(r,s),s}getDependency(e,i){if(e==="light")return this._loadLight(i)}createNodeAttachment(e){const i=this,r=this.parser,s=r.json.nodes[e],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return r._getNodeRef(i.cache,o,a)})}}let Rme=class{constructor(){this.name=ui.KHR_MATERIALS_UNLIT}getMaterialType(){return Jt}extendParams(n,e,i){const r=[];n.color=new be(1,1,1),n.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;n.color.setRGB(o[0],o[1],o[2],Ii),n.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(n,"map",s.baseColorTexture,gt))}return Promise.all(r)}},Pme=class{constructor(n){this.parser=n,this.name=ui.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return r!==void 0&&(e.emissiveIntensity=r),Promise.resolve()}},Bme=class{constructor(n){this.parser=n,this.name=ui.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Co}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new J(a,a)}return Promise.all(s)}},kme=class{constructor(n){this.parser=n,this.name=ui.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Co}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(i.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}},Ome=class{constructor(n){this.parser=n,this.name=ui.KHR_MATERIALS_SHEEN}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Co}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];e.sheenColor=new be(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],Ii)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture,gt)),o.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}},Dme=class{constructor(n){this.parser=n,this.name=ui.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Co}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(i.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(s)}},Lme=class{constructor(n){this.parser=n,this.name=ui.KHR_MATERIALS_VOLUME}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Co}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new be().setRGB(a[0],a[1],a[2],Ii),Promise.all(s)}},Ume=class{constructor(n){this.parser=n,this.name=ui.KHR_MATERIALS_IOR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Co}extendMaterialParams(n,e){const i=this.parser.json.materials[n];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return e.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},Fme=class{constructor(n){this.parser=n,this.name=ui.KHR_MATERIALS_SPECULAR}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Co}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new be().setRGB(a[0],a[1],a[2],Ii),o.specularColorTexture!==void 0&&s.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture,gt)),Promise.all(s)}},Nme=class{constructor(n){this.parser=n,this.name=ui.EXT_MATERIALS_BUMP}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Co}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(i.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(s)}},zme=class{constructor(n){this.parser=n,this.name=ui.KHR_MATERIALS_ANISOTROPY}getMaterialType(n){const e=this.parser.json.materials[n];return!e.extensions||!e.extensions[this.name]?null:Co}extendMaterialParams(n,e){const i=this.parser,r=i.json.materials[n];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(i.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}};class jme{constructor(e){this.parser=e,this.name=ui.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const o=s.extensions[this.name],a=i.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,o.source,a)}}class Gme{constructor(e){this.parser=e,this.name=ui.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,r=this.parser,s=r.json,o=s.textures[e];if(!o.extensions||!o.extensions[i])return null;const a=o.extensions[i],l=s.images[a.source];let c=r.textureLoader;if(l.uri){const h=r.options.manager.getHandler(l.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,a.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class Hme{constructor(e){this.parser=e,this.name=ui.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const i=this.name,r=this.parser,s=r.json,o=s.textures[e];if(!o.extensions||!o.extensions[i])return null;const a=o.extensions[i],l=s.images[a.source];let c=r.textureLoader;if(l.uri){const h=r.options.manager.getHandler(l.uri);h!==null&&(c=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,a.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class Vme{constructor(e){this.name=ui.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,r=i.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const s=r.extensions[this.name],o=this.parser.getDependency("buffer",s.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(l){const c=s.byteOffset||0,h=s.byteLength||0,u=s.count,d=s.byteStride,f=new Uint8Array(l,c,h);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,d,f,s.mode,s.filter).then(function(m){return m.buffer}):a.ready.then(function(){const m=new ArrayBuffer(u*d);return a.decodeGltfBuffer(new Uint8Array(m),u,d,f,s.mode,s.filter),m})})}else return null}}let Qme=class{constructor(n){this.name=ui.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const e=this.parser.json,i=e.nodes[n];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const r=e.meshes[i.mesh];for(const l of r.primitives)if(l.mode!==Fa.TRIANGLES&&l.mode!==Fa.TRIANGLE_STRIP&&l.mode!==Fa.TRIANGLE_FAN&&l.mode!==void 0)return null;const s=i.extensions[this.name].attributes,o=[],a={};for(const l in s)o.push(this.parser.getDependency("accessor",s[l]).then(c=>(a[l]=c,a[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(n)),Promise.all(o).then(l=>{const c=l.pop(),h=c.isGroup?c.children:[c],u=l[0].count,d=[];for(const f of h){const m=new he,g=new S,v=new Ce,y=new S(1,1,1),A=new bR(f.geometry,f.material,u);for(let b=0;b<u;b++)a.TRANSLATION&&g.fromBufferAttribute(a.TRANSLATION,b),a.ROTATION&&v.fromBufferAttribute(a.ROTATION,b),a.SCALE&&y.fromBufferAttribute(a.SCALE,b),A.setMatrixAt(b,m.compose(g,v,y));for(const b in a)if(b==="_COLOR_0"){const x=a[b];A.instanceColor=new So(x.array,x.itemSize,x.normalized)}else b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&f.geometry.setAttribute(b,a[b]);ve.prototype.copy.call(A,f),this.parser.assignFinalMaterial(A),d.push(A)}return c.isGroup?(c.clear(),c.add(...d),c):d[0]}))}};const rQ="glTF",db=12,sQ={JSON:1313821514,BIN:5130562};class Wme{constructor(e){this.name=ui.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,db),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==rQ)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-db,o=new DataView(e,db);let a=0;for(;a<s;){const l=o.getUint32(a,!0);a+=4;const c=o.getUint32(a,!0);if(a+=4,c===sQ.JSON){const h=new Uint8Array(e,db+a,l);this.content=r.decode(h)}else if(c===sQ.BIN){const h=db+a;this.body=e.slice(h,h+l)}a+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Xme{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ui.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const r=this.json,s=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,l={},c={},h={};for(const u in a){const d=BO[u]||u.toLowerCase();l[d]=a[u]}for(const u in e.attributes){const d=BO[u]||u.toLowerCase();if(a[u]!==void 0){const f=r.accessors[e.attributes[u]],m=v0[f.componentType];h[d]=m.name,c[d]=f.normalized===!0}}return i.getDependency("bufferView",o).then(function(u){return new Promise(function(d,f){s.decodeDracoFile(u,function(m){for(const g in m.attributes){const v=m.attributes[g],y=c[g];y!==void 0&&(v.normalized=y)}d(m)},l,h,Ii,f)})})}}class qme{constructor(){this.name=ui.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return(i.texCoord===void 0||i.texCoord===e.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.texCoord!==void 0&&(e.channel=i.texCoord),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class Yme{constructor(){this.name=ui.KHR_MESH_QUANTIZATION}}class oQ extends pg{constructor(e,i,r,s){super(e,i,r,s)}copySampleValue_(e){const i=this.resultBuffer,r=this.sampleValues,s=this.valueSize,o=e*s*3+s;for(let a=0;a!==s;a++)i[a]=r[o+a];return i}interpolate_(e,i,r,s){const o=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=l*2,h=l*3,u=s-i,d=(r-i)/u,f=d*d,m=f*d,g=e*h,v=g-h,y=-2*m+3*f,A=m-f,b=1-y,x=A-f+d;for(let _=0;_!==l;_++){const w=a[v+_+l],T=a[v+_+c]*u,M=a[g+_+l],R=a[g+_]*u;o[_]=b*w+x*T+y*M+A*R}return o}}const Jme=new Ce;class Kme extends oQ{interpolate_(e,i,r,s){const o=super.interpolate_(e,i,r,s);return Jme.fromArray(o).normalize().toArray(o),o}}const Fa={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},v0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},aQ={9728:Rt,9729:Dt,9984:Bm,9985:Ap,9986:$c,9987:bo},lQ={33071:Yn,33648:yp,10497:Ao},PO={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BO={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},vd={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Zme={CUBICSPLINE:void 0,LINEAR:Xl,STEP:Au},kO={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function $me(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new mr({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Fn})),n.DefaultMaterial}function Bf(n,e,i){for(const r in i.extensions)n[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=i.extensions[r])}function yd(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ege(n,e,i){let r=!1,s=!1,o=!1;for(let h=0,u=e.length;h<u;h++){const d=e[h];if(d.POSITION!==void 0&&(r=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(o=!0),r&&s&&o)break}if(!r&&!s&&!o)return Promise.resolve(n);const a=[],l=[],c=[];for(let h=0,u=e.length;h<u;h++){const d=e[h];if(r){const f=d.POSITION!==void 0?i.getDependency("accessor",d.POSITION):n.attributes.position;a.push(f)}if(s){const f=d.NORMAL!==void 0?i.getDependency("accessor",d.NORMAL):n.attributes.normal;l.push(f)}if(o){const f=d.COLOR_0!==void 0?i.getDependency("accessor",d.COLOR_0):n.attributes.color;c.push(f)}}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c)]).then(function(h){const u=h[0],d=h[1],f=h[2];return r&&(n.morphAttributes.position=u),s&&(n.morphAttributes.normal=d),o&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n})}function tge(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let i=0,r=e.weights.length;i<r;i++)n.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(n.morphTargetInfluences.length===i.length){n.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++)n.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ige(n){let e;const i=n.extensions&&n.extensions[ui.KHR_DRACO_MESH_COMPRESSION];if(i?e="draco:"+i.bufferView+":"+i.indices+":"+OO(i.attributes):e=n.indices+":"+OO(n.attributes)+":"+n.mode,n.targets!==void 0)for(let r=0,s=n.targets.length;r<s;r++)e+=":"+OO(n.targets[r]);return e}function OO(n){let e="";const i=Object.keys(n).sort();for(let r=0,s=i.length;r<s;r++)e+=i[r]+":"+n[i[r]]+";";return e}function DO(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function nge(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const rge=new he;class sge{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new Tme,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,s=!1,o=-1;typeof navigator<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,o=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||s&&o<98?this.textureLoader=new Kl(this.options.manager):this.textureLoader=new Iz(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Yr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const r=this,s=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(a){const l={scene:a[0][s.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:s.asset,parser:r,userData:{}};return Bf(o,l,s),yd(l,s),Promise.all(r._invokeAll(function(c){return c.afterRoot&&c.afterRoot(l)})).then(function(){e(l)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],r=this.json.meshes||[];for(let s=0,o=i.length;s<o;s++){const a=i[s].joints;for(let l=0,c=a.length;l<c;l++)e[a[l]].isBone=!0}for(let s=0,o=e.length;s<o;s++){const a=e[s];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(r[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,r){if(e.refs[i]<=1)return r;const s=r.clone(),o=(a,l)=>{const c=this.associations.get(a);c!=null&&this.associations.set(l,c);for(const[h,u]of a.children.entries())o(u,l.children[h])};return o(r,s),s.name+="_instance_"+e.uses[i]++,s}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let r=0;r<i.length;r++){const s=e(i[r]);if(s)return s}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const r=[];for(let s=0;s<i.length;s++){const o=e(i[s]);o&&r.push(o)}return r}getDependency(e,i){const r=e+":"+i;let s=this.cache.get(r);if(!s){switch(e){case"scene":s=this.loadScene(i);break;case"node":s=this._invokeOne(function(o){return o.loadNode&&o.loadNode(i)});break;case"mesh":s=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(i)});break;case"accessor":s=this.loadAccessor(i);break;case"bufferView":s=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(i)});break;case"buffer":s=this.loadBuffer(i);break;case"material":s=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(i)});break;case"texture":s=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(i)});break;case"skin":s=this.loadSkin(i);break;case"animation":s=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(i)});break;case"camera":s=this.loadCamera(i);break;default:if(s=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,i)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(r,s)}return s}getDependencies(e){let i=this.cache.get(e);if(!i){const r=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(s.map(function(o,a){return r.getDependency(e,a)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],r=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[ui.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(o,a){r.load(dh.resolveURL(i.uri,s.path),o,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(r){const s=i.byteLength||0,o=i.byteOffset||0;return r.slice(o,o+s)})}loadAccessor(e){const i=this,r=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const a=PO[s.type],l=v0[s.componentType],c=s.normalized===!0,h=new l(s.count*a);return Promise.resolve(new Ye(h,a,c))}const o=[];return s.bufferView!==void 0?o.push(this.getDependency("bufferView",s.bufferView)):o.push(null),s.sparse!==void 0&&(o.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(o).then(function(a){const l=a[0],c=PO[s.type],h=v0[s.componentType],u=h.BYTES_PER_ELEMENT,d=u*c,f=s.byteOffset||0,m=s.bufferView!==void 0?r.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let v,y;if(m&&m!==d){const A=Math.floor(f/m),b="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+A+":"+s.count;let x=i.cache.get(b);x||(v=new h(l,A*m,s.count*m/u),x=new yy(v,m/u),i.cache.add(b,x)),y=new Go(x,c,f%m/u,g)}else l===null?v=new h(s.count*c):v=new h(l,f,s.count*c),y=new Ye(v,c,g);if(s.sparse!==void 0){const A=PO.SCALAR,b=v0[s.sparse.indices.componentType],x=s.sparse.indices.byteOffset||0,_=s.sparse.values.byteOffset||0,w=new b(a[1],x,s.sparse.count*A),T=new h(a[2],_,s.sparse.count*c);l!==null&&(y=new Ye(y.array.slice(),y.itemSize,y.normalized));for(let M=0,R=w.length;M<R;M++){const B=w[M];if(y.setX(B,T[M*c]),c>=2&&y.setY(B,T[M*c+1]),c>=3&&y.setZ(B,T[M*c+2]),c>=4&&y.setW(B,T[M*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(e){const i=this.json,r=this.options,s=i.textures[e].source,o=i.images[s];let a=this.textureLoader;if(o.uri){const l=r.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,i,r){const s=this,o=this.json,a=o.textures[e],l=o.images[i],c=(l.uri||l.bufferView)+":"+a.sampler;if(this.textureCache[c])return this.textureCache[c];const h=this.loadImageSource(i,r).then(function(u){u.flipY=!1,u.name=a.name||l.name||"",u.name===""&&typeof l.uri=="string"&&l.uri.startsWith("data:image/")===!1&&(u.name=l.uri);const d=(o.samplers||{})[a.sampler]||{};return u.magFilter=aQ[d.magFilter]||Dt,u.minFilter=aQ[d.minFilter]||bo,u.wrapS=lQ[d.wrapS]||Ao,u.wrapT=lQ[d.wrapT]||Ao,u.anisotropy=4,s.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[c]=h,h}loadImageSource(e,i){const r=this,s=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const a=s.images[e],l=self.URL||self.webkitURL;let c=a.uri||"",h=!1;if(a.bufferView!==void 0)c=r.getDependency("bufferView",a.bufferView).then(function(d){h=!0;const f=new Blob([d],{type:a.mimeType});return c=l.createObjectURL(f),c});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(d){return new Promise(function(f,m){let g=f;i.isImageBitmapLoader===!0&&(g=function(v){const y=new Gt(v);y.needsUpdate=!0,f(y)}),i.load(dh.resolveURL(d,o.path),g,void 0,m)})}).then(function(d){return h===!0&&l.revokeObjectURL(c),d.userData.mimeType=a.mimeType||nge(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),d});return this.sourceCache[e]=u,u}assignTexture(e,i,r,s){const o=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(a=a.clone(),a.channel=r.texCoord),o.extensions[ui.KHR_TEXTURE_TRANSFORM]){const l=r.extensions!==void 0?r.extensions[ui.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const c=o.associations.get(a);a=o.extensions[ui.KHR_TEXTURE_TRANSFORM].extendTexture(a,l),o.associations.set(a,c)}}return s!==void 0&&(a.colorSpace=s),e[i]=a,a})}assignFinalMaterial(e){const i=e.geometry;let r=e.material;const s=i.attributes.tangent===void 0,o=i.attributes.color!==void 0,a=i.attributes.normal===void 0;if(e.isPoints){const l="PointsMaterial:"+r.uuid;let c=this.cache.get(l);c||(c=new Iu,Ut.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,c.sizeAttenuation=!1,this.cache.add(l,c)),r=c}else if(e.isLine){const l="LineBasicMaterial:"+r.uuid;let c=this.cache.get(l);c||(c=new zi,Ut.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,this.cache.add(l,c)),r=c}if(s||o||a){let l="ClonedMaterial:"+r.uuid+":";s&&(l+="derivative-tangents:"),o&&(l+="vertex-colors:"),a&&(l+="flat-shading:");let c=this.cache.get(l);c||(c=r.clone(),o&&(c.vertexColors=!0),a&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(l,c),this.associations.set(c,this.associations.get(r))),r=c}e.material=r}getMaterialType(){return mr}loadMaterial(e){const i=this,r=this.json,s=this.extensions,o=r.materials[e];let a;const l={},c=o.extensions||{},h=[];if(c[ui.KHR_MATERIALS_UNLIT]){const d=s[ui.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),h.push(d.extendParams(l,o,i))}else{const d=o.pbrMetallicRoughness||{};if(l.color=new be(1,1,1),l.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;l.color.setRGB(f[0],f[1],f[2],Ii),l.opacity=f[3]}d.baseColorTexture!==void 0&&h.push(i.assignTexture(l,"map",d.baseColorTexture,gt)),l.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,l.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(h.push(i.assignTexture(l,"metalnessMap",d.metallicRoughnessTexture)),h.push(i.assignTexture(l,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,l)})))}o.doubleSided===!0&&(l.side=yi);const u=o.alphaMode||kO.OPAQUE;if(u===kO.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,u===kO.MASK&&(l.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&a!==Jt&&(h.push(i.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new J(1,1),o.normalTexture.scale!==void 0)){const d=o.normalTexture.scale;l.normalScale.set(d,d)}if(o.occlusionTexture!==void 0&&a!==Jt&&(h.push(i.assignTexture(l,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(l.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&a!==Jt){const d=o.emissiveFactor;l.emissive=new be().setRGB(d[0],d[1],d[2],Ii)}return o.emissiveTexture!==void 0&&a!==Jt&&h.push(i.assignTexture(l,"emissiveMap",o.emissiveTexture,gt)),Promise.all(h).then(function(){const d=new a(l);return o.name&&(d.name=o.name),yd(d,o),i.associations.set(d,{materials:e}),o.extensions&&Bf(s,d,o),d})}createUniqueName(e){const i=Yt.sanitizeNodeName(e||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(e){const i=this,r=this.extensions,s=this.primitiveCache;function o(l){return r[ui.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(l,i).then(function(c){return cQ(c,l,i)})}const a=[];for(let l=0,c=e.length;l<c;l++){const h=e[l],u=ige(h),d=s[u];if(d)a.push(d.promise);else{let f;h.extensions&&h.extensions[ui.KHR_DRACO_MESH_COMPRESSION]?f=o(h):f=cQ(new dt,h,i),s[u]={primitive:h,promise:f},a.push(f)}}return Promise.all(a)}loadMesh(e){const i=this,r=this.json,s=this.extensions,o=r.meshes[e],a=o.primitives,l=[];for(let c=0,h=a.length;c<h;c++){const u=a[c].material===void 0?$me(this.cache):this.getDependency("material",a[c].material);l.push(u)}return l.push(i.loadGeometries(a)),Promise.all(l).then(function(c){const h=c.slice(0,c.length-1),u=c[c.length-1],d=[];for(let m=0,g=u.length;m<g;m++){const v=u[m],y=a[m];let A;const b=h[m];if(y.mode===Fa.TRIANGLES||y.mode===Fa.TRIANGLE_STRIP||y.mode===Fa.TRIANGLE_FAN||y.mode===void 0)A=o.isSkinnedMesh===!0?new wo(v,b):new pe(v,b),A.isSkinnedMesh===!0&&A.normalizeSkinWeights(),y.mode===Fa.TRIANGLE_STRIP?A.geometry=nQ(A.geometry,TI):y.mode===Fa.TRIANGLE_FAN&&(A.geometry=nQ(A.geometry,U_));else if(y.mode===Fa.LINES)A=new Is(v,b);else if(y.mode===Fa.LINE_STRIP)A=new hn(v,b);else if(y.mode===Fa.LINE_LOOP)A=new SR(v,b);else if(y.mode===Fa.POINTS)A=new hg(v,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(A.geometry.morphAttributes).length>0&&tge(A,o),A.name=i.createUniqueName(o.name||"mesh_"+e),yd(A,o),y.extensions&&Bf(s,A,y),i.assignFinalMaterial(A),d.push(A)}for(let m=0,g=d.length;m<g;m++)i.associations.set(d[m],{meshes:e,primitives:m});if(d.length===1)return o.extensions&&Bf(s,d[0],o),d[0];const f=new Cr;o.extensions&&Bf(s,f,o),i.associations.set(f,{meshes:e});for(let m=0,g=d.length;m<g;m++)f.add(d[m]);return f})}loadCamera(e){let i;const r=this.json.cameras[e],s=r[r.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?i=new Ft(pi.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):r.type==="orthographic"&&(i=new Yl(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),r.name&&(i.name=this.createUniqueName(r.name)),yd(i,r),Promise.resolve(i)}loadSkin(e){const i=this.json.skins[e],r=[];for(let s=0,o=i.joints.length;s<o;s++)r.push(this._loadNodeShallow(i.joints[s]));return i.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",i.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(s){const o=s.pop(),a=s,l=[],c=[];for(let h=0,u=a.length;h<u;h++){const d=a[h];if(d){l.push(d);const f=new he;o!==null&&f.fromArray(o.array,h*16),c.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[h])}return new _y(l,c)})}loadAnimation(e){const i=this.json,r=this,s=i.animations[e],o=s.name?s.name:"animation_"+e,a=[],l=[],c=[],h=[],u=[];let d=0,f=s.channels.length;for(d=0,f=s.channels.length;d<f;d++){const m=s.channels[d],g=s.samplers[m.sampler],v=m.target,y=v.node,A=s.parameters!==void 0?s.parameters[g.input]:g.input,b=s.parameters!==void 0?s.parameters[g.output]:g.output;v.node!==void 0&&(a.push(this.getDependency("node",y)),l.push(this.getDependency("accessor",A)),c.push(this.getDependency("accessor",b)),h.push(g),u.push(v))}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h),Promise.all(u)]).then(function(m){const g=m[0],v=m[1],y=m[2],A=m[3],b=m[4],x=[];for(d=0,f=g.length;d<f;d++){const _=g[d],w=v[d],T=y[d],M=A[d],R=b[d];if(_===void 0)continue;_.updateMatrix&&_.updateMatrix();const B=r._createAnimationTracks(_,w,T,M,R);if(B)for(let E=0;E<B.length;E++)x.push(B[E])}return new $s(o,void 0,x)})}createNodeMesh(e){const i=this.json,r=this,s=i.nodes[e];return s.mesh===void 0?null:r.getDependency("mesh",s.mesh).then(function(o){const a=r._getNodeRef(r.meshCache,s.mesh,o);return s.weights!==void 0&&a.traverse(function(l){if(l.isMesh)for(let c=0,h=s.weights.length;c<h;c++)l.morphTargetInfluences[c]=s.weights[c]}),a})}loadNode(e){const i=this.json,r=this,s=i.nodes[e],o=r._loadNodeShallow(e),a=[],l=s.children||[];for(let h=0,u=l.length;h<u;h++)a.push(r.getDependency("node",l[h]));const c=s.skin===void 0?Promise.resolve(null):r.getDependency("skin",s.skin);return Promise.all([o,Promise.all(a),c]).then(function(h){const u=h[0],d=h[1],f=h[2];f!==null&&u.traverse(function(m){m.isSkinnedMesh&&m.bind(f,rge)});for(let m=0,g=d.length;m<g;m++)u.add(d[m]);return u})}_loadNodeShallow(e){const i=this.json,r=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=i.nodes[e],a=o.name?s.createUniqueName(o.name):"",l=[],c=s._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return c&&l.push(c),o.camera!==void 0&&l.push(s.getDependency("camera",o.camera).then(function(h){return s._getNodeRef(s.cameraCache,o.camera,h)})),s._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){l.push(h)}),this.nodeCache[e]=Promise.all(l).then(function(h){let u;if(o.isBone===!0?u=new Dp:h.length>1?u=new Cr:h.length===1?u=h[0]:u=new ve,u!==h[0])for(let d=0,f=h.length;d<f;d++)u.add(h[d]);if(o.name&&(u.userData.name=o.name,u.name=a),yd(u,o),o.extensions&&Bf(r,u,o),o.matrix!==void 0){const d=new he;d.fromArray(o.matrix),u.applyMatrix4(d)}else o.translation!==void 0&&u.position.fromArray(o.translation),o.rotation!==void 0&&u.quaternion.fromArray(o.rotation),o.scale!==void 0&&u.scale.fromArray(o.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const i=this.extensions,r=this.json.scenes[e],s=this,o=new Cr;r.name&&(o.name=s.createUniqueName(r.name)),yd(o,r),r.extensions&&Bf(i,o,r);const a=r.nodes||[],l=[];for(let c=0,h=a.length;c<h;c++)l.push(s.getDependency("node",a[c]));return Promise.all(l).then(function(c){for(let u=0,d=c.length;u<d;u++)o.add(c[u]);const h=u=>{const d=new Map;for(const[f,m]of s.associations)(f instanceof Ut||f instanceof Gt)&&d.set(f,m);return u.traverse(f=>{const m=s.associations.get(f);m!=null&&d.set(f,m)}),d};return s.associations=h(o),o})}_createAnimationTracks(e,i,r,s,o){const a=[],l=e.name?e.name:e.uuid,c=[];vd[o.path]===vd.weights?e.traverse(function(f){f.morphTargetInfluences&&c.push(f.name?f.name:f.uuid)}):c.push(l);let h;switch(vd[o.path]){case vd.weights:h=ch;break;case vd.rotation:h=hl;break;case vd.position:case vd.scale:h=Jl;break;default:switch(r.itemSize){case 1:h=ch;break;case 2:case 3:default:h=Jl;break}break}const u=s.interpolation!==void 0?Zme[s.interpolation]:Xl,d=this._getArrayFromAccessor(r);for(let f=0,m=c.length;f<m;f++){const g=new h(c[f]+"."+vd[o.path],i.array,d,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),a.push(g)}return a}_getArrayFromAccessor(e){let i=e.array;if(e.normalized){const r=DO(i.constructor),s=new Float32Array(i.length);for(let o=0,a=i.length;o<a;o++)s[o]=i[o]*r;i=s}return i}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const r=this instanceof hl?Kme:oQ;return new r(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function oge(n,e,i){const r=e.attributes,s=new Ht;if(r.POSITION!==void 0){const l=i.json.accessors[r.POSITION],c=l.min,h=l.max;if(c!==void 0&&h!==void 0){if(s.set(new S(c[0],c[1],c[2]),new S(h[0],h[1],h[2])),l.normalized){const u=DO(v0[l.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const l=new S,c=new S;for(let h=0,u=o.length;h<u;h++){const d=o[h];if(d.POSITION!==void 0){const f=i.json.accessors[d.POSITION],m=f.min,g=f.max;if(m!==void 0&&g!==void 0){if(c.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),c.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),c.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),f.normalized){const v=DO(v0[f.componentType]);c.multiplyScalar(v)}l.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(l)}n.boundingBox=s;const a=new Zi;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=a}function cQ(n,e,i){const r=e.attributes,s=[];function o(a,l){return i.getDependency("accessor",a).then(function(c){n.setAttribute(l,c)})}for(const a in r){const l=BO[a]||a.toLowerCase();l in n.attributes||s.push(o(r[a],l))}if(e.indices!==void 0&&!n.index){const a=i.getDependency("accessor",e.indices).then(function(l){n.setIndex(l)});s.push(a)}return xi.workingColorSpace!==Ii&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${xi.workingColorSpace}" not supported.`),yd(n,e),oge(n,e,i),Promise.all(s).then(function(){return e.targets!==void 0?ege(n,e.targets,i):n})}const age=/^[og]\s*(.+)?/,lge=/^mtllib /,cge=/^usemtl /,hge=/^usemap /,hQ=/\s+/,uQ=new S,LO=new S,dQ=new S,pQ=new S,Na=new S,jC=new be;function uge(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=i!==!1;return}const r=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:i!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,o){const a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);const l={index:this.materials.length,name:s||"",mtllib:Array.isArray(o)&&o.length>0?o[o.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){const h={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return h.clone=this.clone.bind(h),h}};return this.materials.push(l),l},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const o=this.currentMaterial();if(o&&o.groupEnd===-1&&(o.groupEnd=this.geometry.vertices.length/3,o.groupCount=o.groupEnd-o.groupStart,o.inherited=!1),s&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),o}},r&&r.name&&typeof r.clone=="function"){const s=r.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,i){const r=parseInt(e,10);return(r>=0?r-1:r+i/3)*3},parseNormalIndex:function(e,i){const r=parseInt(e,10);return(r>=0?r-1:r+i/3)*3},parseUVIndex:function(e,i){const r=parseInt(e,10);return(r>=0?r-1:r+i/2)*2},addVertex:function(e,i,r){const s=this.vertices,o=this.object.geometry.vertices;o.push(s[e+0],s[e+1],s[e+2]),o.push(s[i+0],s[i+1],s[i+2]),o.push(s[r+0],s[r+1],s[r+2])},addVertexPoint:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,r){const s=this.normals,o=this.object.geometry.normals;o.push(s[e+0],s[e+1],s[e+2]),o.push(s[i+0],s[i+1],s[i+2]),o.push(s[r+0],s[r+1],s[r+2])},addFaceNormal:function(e,i,r){const s=this.vertices,o=this.object.geometry.normals;uQ.fromArray(s,e),LO.fromArray(s,i),dQ.fromArray(s,r),Na.subVectors(dQ,LO),pQ.subVectors(uQ,LO),Na.cross(pQ),Na.normalize(),o.push(Na.x,Na.y,Na.z),o.push(Na.x,Na.y,Na.z),o.push(Na.x,Na.y,Na.z)},addColor:function(e,i,r){const s=this.colors,o=this.object.geometry.colors;s[e]!==void 0&&o.push(s[e+0],s[e+1],s[e+2]),s[i]!==void 0&&o.push(s[i+0],s[i+1],s[i+2]),s[r]!==void 0&&o.push(s[r+0],s[r+1],s[r+2])},addUV:function(e,i,r){const s=this.uvs,o=this.object.geometry.uvs;o.push(s[e+0],s[e+1]),o.push(s[i+0],s[i+1]),o.push(s[r+0],s[r+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,r,s,o,a,l,c,h){const u=this.vertices.length;let d=this.parseVertexIndex(e,u),f=this.parseVertexIndex(i,u),m=this.parseVertexIndex(r,u);if(this.addVertex(d,f,m),this.addColor(d,f,m),l!==void 0&&l!==""){const g=this.normals.length;d=this.parseNormalIndex(l,g),f=this.parseNormalIndex(c,g),m=this.parseNormalIndex(h,g),this.addNormal(d,f,m)}else this.addFaceNormal(d,f,m);if(s!==void 0&&s!==""){const g=this.uvs.length;d=this.parseUVIndex(s,g),f=this.parseUVIndex(o,g),m=this.parseUVIndex(a,g),this.addUV(d,f,m),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const i=this.vertices.length;for(let r=0,s=e.length;r<s;r++){const o=this.parseVertexIndex(e[r],i);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";const r=this.vertices.length,s=this.uvs.length;for(let o=0,a=e.length;o<a;o++)this.addVertexLine(this.parseVertexIndex(e[o],r));for(let o=0,a=i.length;o<a;o++)this.addUVLine(this.parseUVIndex(i[o],s))}};return n.startObject("",!1),n}class UO extends Kn{constructor(e){super(e),this.materials=null}load(e,i,r,s){const o=this,a=new Yr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{i(o.parse(l))}catch(c){s?s(c):console.error(c),o.manager.itemError(e)}},r,s)}setMaterials(e){return this.materials=e,this}parse(e){const i=new uge;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const r=e.split(`
`);let s=[];for(let a=0,l=r.length;a<l;a++){const c=r[a].trimStart();if(c.length===0)continue;const h=c.charAt(0);if(h!=="#")if(h==="v"){const u=c.split(hQ);switch(u[0]){case"v":i.vertices.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])),u.length>=7?(jC.setRGB(parseFloat(u[4]),parseFloat(u[5]),parseFloat(u[6])).convertSRGBToLinear(),i.colors.push(jC.r,jC.g,jC.b)):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));break;case"vt":i.uvs.push(parseFloat(u[1]),parseFloat(u[2]));break}}else if(h==="f"){const u=c.slice(1).trim().split(hQ),d=[];for(let m=0,g=u.length;m<g;m++){const v=u[m];if(v.length>0){const y=v.split("/");d.push(y)}}const f=d[0];for(let m=1,g=d.length-1;m<g;m++){const v=d[m],y=d[m+1];i.addFace(f[0],v[0],y[0],f[1],v[1],y[1],f[2],v[2],y[2])}}else if(h==="l"){const u=c.substring(1).trim().split(" ");let d=[];const f=[];if(c.indexOf("/")===-1)d=u;else for(let m=0,g=u.length;m<g;m++){const v=u[m].split("/");v[0]!==""&&d.push(v[0]),v[1]!==""&&f.push(v[1])}i.addLineGeometry(d,f)}else if(h==="p"){const u=c.slice(1).trim().split(" ");i.addPointGeometry(u)}else if((s=age.exec(c))!==null){const u=(" "+s[0].slice(1).trim()).slice(1);i.startObject(u)}else if(cge.test(c))i.object.startMaterial(c.substring(7).trim(),i.materialLibraries);else if(lge.test(c))i.materialLibraries.push(c.substring(7).trim());else if(hge.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(s=c.split(" "),s.length>1){const d=s[1].trim().toLowerCase();i.object.smooth=d!=="0"&&d!=="off"}else i.object.smooth=!0;const u=i.object.currentMaterial();u&&(u.smooth=i.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}i.finalize();const o=new Cr;if(o.materialLibraries=[].concat(i.materialLibraries),!(i.objects.length===1&&i.objects[0].geometry.vertices.length===0))for(let a=0,l=i.objects.length;a<l;a++){const c=i.objects[a],h=c.geometry,u=c.materials,d=h.type==="Line",f=h.type==="Points";let m=!1;if(h.vertices.length===0)continue;const g=new dt;g.setAttribute("position",new rt(h.vertices,3)),h.normals.length>0&&g.setAttribute("normal",new rt(h.normals,3)),h.colors.length>0&&(m=!0,g.setAttribute("color",new rt(h.colors,3))),h.hasUVIndices===!0&&g.setAttribute("uv",new rt(h.uvs,2));const v=[];for(let A=0,b=u.length;A<b;A++){const x=u[A],_=x.name+"_"+x.smooth+"_"+m;let w=i.materials[_];if(this.materials!==null){if(w=this.materials.create(x.name),d&&w&&!(w instanceof zi)){const T=new zi;Ut.prototype.copy.call(T,w),T.color.copy(w.color),w=T}else if(f&&w&&!(w instanceof Iu)){const T=new Iu({size:10,sizeAttenuation:!1});Ut.prototype.copy.call(T,w),T.color.copy(w.color),T.map=w.map,w=T}}w===void 0&&(d?w=new zi:f?w=new Iu({size:1,sizeAttenuation:!1}):w=new dg,w.name=x.name,w.flatShading=!x.smooth,w.vertexColors=m,i.materials[_]=w),v.push(w)}let y;if(v.length>1){for(let A=0,b=u.length;A<b;A++){const x=u[A];g.addGroup(x.groupStart,x.groupCount,A)}d?y=new Is(g,v):f?y=new hg(g,v):y=new pe(g,v)}else d?y=new Is(g,v[0]):f?y=new hg(g,v[0]):y=new pe(g,v[0]);y.name=c.name,o.add(y)}else if(i.vertices.length>0){const a=new Iu({size:1,sizeAttenuation:!1}),l=new dt;l.setAttribute("position",new rt(i.vertices,3)),i.colors.length>0&&i.colors[0]!==void 0&&(l.setAttribute("color",new rt(i.colors,3)),a.vertexColors=!0);const c=new hg(l,a);o.add(c)}return o}}typeof globalThis!==void 0&&!("OffscreenCanvas"in globalThis)&&(globalThis.OffscreenCanvas=class{constructor(n,e){return p(this,"canvas"),this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=e,this.canvas.convertToBlob=(i,r)=>new Promise(s=>{this.canvas.toBlob(s,i,r)}),this.canvas}});const dge=te("debugprogress");function fQ(n){n=n||new Date;const e=n.getMonth()+1,i=n.getDate(),r=n.getHours(),s=n.getMinutes(),o=n.getSeconds(),a=(e<10?"0":"")+e,l=(i<10?"0":"")+i,c=(r<10?"0":"")+r,h=(s<10?"0":"")+s,u=(o<10?"0":"")+o;return n.getFullYear()+a+l+"-"+c+h+u}class si{static start(e,i){typeof i=="string"&&(i={parentScope:i});const r=new pge(e,i);pb.set(e,r)}static report(e,i){const r=pb.get(e);if(!r){console.warn("Reporting progress for non-existing scope",e);return}typeof i=="string"&&(i={message:i,autoStep:!0}),r.report(i)}static end(e){const i=pb.get(e);i&&(i.end(),pb.delete(e))}}const pb=new Map;class pge{constructor(e,i){p(this,"scopeLabel"),p(this,"parentScope"),p(this,"childScopes",[]),p(this,"parentDepth",0),p(this,"lastStep",0),p(this,"lastAutoStepWeight",1),p(this,"lastTotalSteps",0),p(this,"onProgress"),p(this,"showLogs",!1),p(this,"selfProgress",0),p(this,"totalProgress",0),p(this,"selfReports",0),p(this,"totalReports",0),this.parentScope=i!=null&&i.parentScope?pb.get(i.parentScope):void 0,this.parentScope&&(this.parentScope.childScopes.push(this),this.parentDepth=this.parentScope.parentDepth+1),this.scopeLabel=" ".repeat(this.parentDepth*2)+e,this.showLogs=i?.logTimings??!!dge,this.showLogs&&console.time(this.scopeLabel),this.onProgress=i?.onProgress}report(e,i=!1){if(e){if(e.totalSteps!==void 0&&(this.lastTotalSteps=e.totalSteps),e.currentStep!==void 0&&(this.lastStep=e.currentStep),e.autoStep!==void 0){if(e.currentStep===void 0){this.lastStep===void 0&&(this.lastStep=0);const s=typeof e.autoStep=="number"?e.autoStep:1;this.lastStep+=this.lastAutoStepWeight,this.lastAutoStepWeight=s,e.currentStep=this.lastStep}e.totalSteps=this.lastTotalSteps}e.progress!==void 0?this.selfProgress=e.progress:e.currentStep!==void 0&&e.totalSteps!==void 0&&(this.selfProgress=e.currentStep/e.totalSteps)}if(this.childScopes.length>0){let s=0,o=0;for(const l of this.childScopes)s+=l.selfProgress,o+=1;o>0&&(s/=o);const a=this.lastAutoStepWeight/(this.lastTotalSteps??1);this.totalProgress=this.selfProgress+s*a}else this.totalProgress=this.selfProgress;this.selfProgress=Math.min(1,this.selfProgress),this.totalProgress=Math.min(1,this.totalProgress);let r=(this.totalProgress*100).toFixed(3)+"%";this.childScopes.length>0&&(r+=" ("+(this.selfProgress*100).toFixed(3)+"% self)"),e!=null&&e.message&&(r=e.message+" \u2013 "+r),this.lastStep!==void 0&&this.lastTotalSteps!==void 0&&(r="Step "+(this.lastStep+(this.lastAutoStepWeight!=1?"\u2013"+(this.lastStep+this.lastAutoStepWeight):"")+"/"+this.lastTotalSteps)+" "+r),i?this.totalReports++:(this.selfReports++,this.totalReports++),this.showLogs&&console.timeLog(this.scopeLabel,r),this.onProgress&&this.onProgress(this.totalProgress),this.parentScope&&this.parentScope.report(void 0,!0)}end(){this.report({progress:1,autoStep:!0},!0),this.showLogs&&(console.timeLog(this.scopeLabel,"Total reports: "+this.totalReports,"Self reports: "+this.selfReports),console.timeEnd(this.scopeLabel));let e=!1;for(const i of this.childScopes)if(!(i.selfProgress>=1)){e=!0;break}e&&console.warn("Progress end with child scopes that are still running",this),this.onProgress=void 0}}function Pl(n){return n=n.replace(/[^a-zA-Z0-9_]/g,""),n.match(/^[a-zA-Z_]/)||(n="_"+n),n}function mQ(n){if(n.length===0)return null;const e=n.map(i=>{const r=new Array;for(;i.parent;)r.unshift(i.parent),i=i.parent;return r});return e[0].findLast(i=>e.every(r=>r.includes(i)))||null}function gQ(n){const e=mQ(n),i=new Set;for(const r of n){let s=r.parent;for(;s&&s!==e;)n.includes(s)||i.add(s),s=s.parent}return i}const y0=class{constructor(n,e,i,r=null,s=null,o=null,a=null,l=null){p(this,"uuid"),p(this,"name"),p(this,"type"),p(this,"extraSchemas",[]),p(this,"displayName"),p(this,"visibility"),p(this,"matrix"),p(this,"_isDynamic"),p(this,"geometry"),p(this,"material"),p(this,"camera"),p(this,"parent"),p(this,"skinnedMesh"),p(this,"children",[]),p(this,"animations"),p(this,"_eventListeners"),this.uuid=n,this.name=Pl(e),this.displayName=e,this.matrix=i.clone(),this.geometry=r,this.material=s,this.camera=o,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1,this.skinnedMesh=a,this.animations=l}get isDynamic(){return this._isDynamic}set isDynamic(n){this._isDynamic=n}static createEmptyParent(n){const e=new y0(pi.generateUUID(),n.name+"_empty_"+y0.USDObject_export_id++,n.matrix),i=n.parent;return i&&i.add(e),e.add(n),e.isDynamic=!0,n.matrix=new he().identity(),e}static createEmpty(){const n=new y0(pi.generateUUID(),"Empty_"+y0.USDObject_export_id++,new he);return n.isDynamic=!0,n}is(n){return n?this.uuid===n.uuid:!1}isEmpty(){return!this.geometry}clone(){const n=new y0(pi.generateUUID(),this.name,this.matrix,this.geometry,this.material);return n.isDynamic=this.isDynamic,n}deepClone(){const n=this.clone();for(const e of this.children)e&&n.add(e.deepClone());return n}getPath(){let n=this.parent,e=this.name;for(;n;)e=(n.parent?n.name:n.name+"/Scenes/Scene")+"/"+e,n=n.parent;return"</"+e+">"}add(n){n.parent&&n.parent.remove(n),n.parent=this,this.children.push(n)}remove(n){const e=this.children.indexOf(n);e>=0&&(n.parent===this&&(n.parent=null),this.children.splice(e,1))}addEventListener(n,e){this._eventListeners[n]||(this._eventListeners[n]=[]),this._eventListeners[n].push(e)}removeEventListener(n,e){if(!this._eventListeners[n])return;const i=this._eventListeners[n].indexOf(e);i>=0&&this._eventListeners[n].splice(i,1)}onSerialize(n,e){const i=this._eventListeners.serialize;i&&i.forEach(r=>r(n,e))}};let co=y0;p(co,"USDObject_export_id",0);class vQ extends co{constructor(){super(void 0,"StageRoot",new he,null,null,null),p(this,"stageLength"),this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(e){e.parent=this,this.children.push(e)}remove(e){const i=this.children.indexOf(e);i>=0&&(e.parent===this&&(e.parent=null),this.children.splice(i,1))}traverse(e,i=null){if(i!==null?e(i):i=this,i.children)for(const r of i.children)this.traverse(e,r)}findById(e){let i=!1;function r(s){if(!i){if(s.uuid===e)return i=!0,s;if(s.children)for(const o of s.children){if(!o)continue;const a=r(o);if(a)return a}}}return r(this)}buildHeader(e){var i,r;const s=(i=e.extensions)==null?void 0:i.find(c=>c?.extensionName==="animation"),o=(r=e.extensions)==null?void 0:r.find(c=>c?.extensionName==="Behaviour"),a=s?.getStartTimeCode()??0,l=s?.getEndTimeCode()??0;return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine ${ml}"
		dictionary Needle = {
			bool animations = ${s?1:0}
			bool interactive = ${o?1:0}
			bool quickLookCompatible = ${e.quickLookCompatible?1:0}
		}
	}
	defaultPrim = "${Pl(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = ${a}
	endTimeCode = ${l}
	timeCodesPerSecond = 60
	framesPerSecond = 60
	doc = """Generated by Needle Engine USDZ Exporter ${ml}"""
)
`}}const A0=`
`,Io="</StageRoot/Materials";class yQ{constructor(){p(this,"str"),p(this,"indent"),this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(e=void 0,i="{",r=!0){e!==void 0?(e=this.applyIndent(e),this.str+=e,r?(this.str+=A0,this.str+=this.applyIndent(i)):this.str+=" "+i):this.str+=this.applyIndent(i),this.str+=A0,this.indent+=1}closeBlock(e="}"){this.indent-=1,this.str+=this.applyIndent(e)+A0}beginArray(e){e=this.applyIndent(e+" = ["),this.str+=e,this.str+=A0,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+A0}appendLine(e=""){e=this.applyIndent(e),this.str+=e,this.str+=A0}toString(){return this.str}applyIndent(e){let i="";for(let r=0;r<this.indent;r++)i+="	";return i+e}}class fge{constructor(e,i,r){p(this,"root"),p(this,"exporter"),p(this,"extensions",[]),p(this,"quickLookCompatible"),p(this,"exportInvisible"),p(this,"materials"),p(this,"textures"),p(this,"files"),p(this,"document"),p(this,"output"),p(this,"animations"),this.root=e,this.exporter=i,this.quickLookCompatible=r.quickLookCompatible,this.exportInvisible=r.exportInvisible,r.extensions&&(this.extensions=r.extensions),this.materials=new Map,this.textures={},this.files={},this.document=new vQ,this.output="",this.animations=[]}}class FO{constructor(){p(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}}),p(this,"quickLookCompatible",!1),p(this,"extensions",[]),p(this,"maxTextureSize",4096),p(this,"exportInvisible",!1)}}let AQ=class{constructor(){p(this,"debug"),p(this,"sceneAnchoringOptions",new FO),p(this,"extensions",[]),p(this,"keepObject"),this.debug=!1}async parse(n,e=new FO){e=Object.assign(new FO,e),this.sceneAnchoringOptions=e;const i=new fge(n,this,e);this.extensions=i.extensions;const r=i.files,s="model.usda";r[s]=null;const o=i.materials,a=i.textures;si.report("export-usdz","Invoking onBeforeBuildDocument"),await GC(i,"onBeforeBuildDocument"),si.report("export-usdz","Done onBeforeBuildDocument"),si.report("export-usdz","Reparent bones to common ancestor");const l=[];n?.traverse(m=>{if(!(!e.exportInvisible&&!m.visible)&&m instanceof wo){const g=m.skeleton.bones,v=mQ(g);v&&l.push({object:m,originalParent:m.parent,newParent:v})}});for(const m of l){const{object:g,originalParent:v,newParent:y}=m;y.add(g)}si.report("export-usdz","Traversing hierarchy"),n&&bQ(n,i.document,i,this.keepObject),si.report("export-usdz","Invoking onAfterBuildDocument"),await GC(i,"onAfterBuildDocument"),si.report("export-usdz",{message:"Parsing document",autoStep:10}),await mge(i,()=>(si.report("export-usdz","Building materials"),wge(o,a,e.quickLookCompatible))),si.report("export-usdz","Invoking onAfterSerialize"),await GC(i,"onAfterSerialize");for(const m of l){const{object:g,originalParent:v,newParent:y}=m;v&&v.add(g)}const c=i.document.buildHeader(i)+`
`+i.output;this.debug&&console.log(c),r[s]=SC(c),i.output="",si.report("export-usdz",{message:"Exporting textures",autoStep:10}),si.start("export-usdz-textures","export-usdz");const h=new lh({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),u=Object.keys(a).length;si.report("export-usdz-textures",{totalSteps:u*3,currentStep:0});const d=async m=>{const g=a[m],v=g.texture,y=RQ.includes(v.format);let A={imageData:v.image};si.report("export-usdz-textures",{message:"read back texture",autoStep:!0});const b=g.scale!==void 0&&g.scale.x!==1&&g.scale.y!==1&&g.scale.z!==1&&g.scale.w!==1;(v.isCompressedTexture||v.isRenderTargetTexture||b)&&(A=await gge(v,e.maxTextureSize,h,g.scale)),si.report("export-usdz-textures",{message:"convert texture to canvas",autoStep:!0});const x=await yge(A.imageBitmap||A.imageData,e.maxTextureSize).catch(_=>{console.error("Error converting texture to canvas",v,_)});if(x){si.report("export-usdz-textures",{message:"convert canvas to blob",autoStep:!0});const _=await x.convertToBlob({type:y?"image/png":"image/jpeg",quality:.95});r[`textures/${m}.${y?"png":"jpg"}`]=new Uint8Array(await _.arrayBuffer())}else console.warn("Can`t export texture: ",v)};for(const m in a)await d(m);h.dispose(),si.end("export-usdz-textures");let f=0;for(const m in r){const g=r[m],v=34+m.length;f+=v;const y=f&63;if(y!==4){const A=64-y,b=new Uint8Array(A);r[m]=[g,{extra:{12345:b}}]}f=g.length}return si.report("export-usdz","zip archive"),Tfe(r,{level:0})}};function bQ(n,e,i,r){if(!i.exportInvisible&&!n.visible)return;let s,o,a;if((n instanceof pe||n instanceof wo)&&(o=n.geometry,a=n.material),r&&!r(n)&&(o=void 0,a=void 0),(n instanceof pe||n instanceof wo)&&a&&(a instanceof mr||a instanceof Jt)){const l=QC(n),c=n instanceof wo?n:null;s=new co(n.uuid,l,n.matrix,o,a,void 0,c,n.animations)}else if(n instanceof Ft||n instanceof Yl){const l=QC(n);s=new co(n.uuid,l,n.matrix,void 0,void 0,n)}else{const l=QC(n);s=new co(n.uuid,l,n.matrix,void 0,void 0,void 0,void 0,n.animations)}if(s){if(s.displayName=n.name,s.visibility=n.visible?void 0:"invisible",e&&e.add(s),e=s,i.extensions)for(const l of i.extensions)l.onExportObject&&l.onExportObject.call(l,n,s,i)}else{const l=QC(n),c=new co(n.uuid,l,n.matrix);e&&e.add(c),e=c}for(const l of n.children)bQ(l,e,i,r)}async function mge(n,e){si.start("export-usdz-resources","export-usdz");const i=[];for(const c of n.document.children)xQ(c,n,i);const r=i.length;for(let c=0;c<r;c++)si.report("export-usdz-resources",{totalSteps:r,currentStep:c}),await new Promise((h,u)=>{i[c](),h()});si.end("export-usdz-resources");const s=new yQ,o=n.exporter.sceneAnchoringOptions.ar;s.beginBlock(`def Xform "${n.document.name}"`),s.beginBlock(`def Scope "Scenes" (
		kind = "sceneLibrary"
	)`),s.beginBlock('def Xform "Scene"',"(",!1),s.appendLine('apiSchemas = ["Preliminary_AnchoringAPI"]'),s.appendLine("customData = {"),s.appendLine("	bool preliminary_collidesWithEnvironment = 0"),s.appendLine('	string sceneName = "Scene"'),s.appendLine("}"),s.appendLine('sceneName = "Scene"'),s.closeBlock(")"),s.beginBlock(),s.appendLine(`token preliminary:anchoring:type = "${o.anchoring.type}"`),o.anchoring.type==="plane"&&s.appendLine(`token preliminary:planeAnchoring:alignment = "${o.planeAnchoring.alignment}"`),o.anchoring.type==="image"&&s.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${n.document.name}/Scenes/Scene/AnchoringReferenceImage>`),s.appendLine();const a=c=>{if(!c)return 0;let h=1;for(const u of c.children)h+=a(u);return h},l=a(n.document);si.start("export-usdz-xforms","export-usdz"),si.report("export-usdz-xforms",{totalSteps:l,currentStep:1});for(const c of n.document.children)SQ(c,s,n);si.end("export-usdz-xforms"),si.report("export-usdz","invoke onAfterHierarchy"),GC(n,"onAfterHierarchy",s),s.closeBlock(),s.closeBlock(),s.appendLine(e()),s.closeBlock(),si.report("export-usdz","write to string"),n.output+=s.toString()}function xQ(n,e,i){if(!n)return;const r=n.geometry,s=n.material;if(r)if(s&&("isMeshStandardMaterial"in s&&s.isMeshStandardMaterial||"isMeshBasicMaterial"in s&&s.isMeshBasicMaterial)){const o="geometries/"+zO(r,n.name)+".usda";if(!(o in e.files)){const a=()=>{var l,c;const h=xge(r,(c=(l=n.skinnedMesh)==null?void 0:l.skeleton)==null?void 0:c.bones,e.quickLookCompatible);e.files[o]=bge(h)};i.push(a)}}else console.warn("NeedleUSDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",name);s&&(s.uuid in e.materials||(e.materials[s.uuid]=s));for(const o of n.children)xQ(o,e,i)}async function GC(n,e,i=null){if(n.extensions){for(const r of n.extensions)if(r&&typeof r[e]=="function"){const s=r[e].call(r,n,i);s instanceof Promise&&await s}}}let HC=null,ho=null,NO,b0,VC;async function gge(n,e=1/0,i=null,r=void 0){NO||(NO=new cr(2,2,1,1)),b0||(b0=new Bt({uniforms:{blitTexture:new Se(n),flipY:new Se(!1),scale:new Se(new qe(1,1,1,1))},vertexShader:`
            varying vec2 vUv;
			uniform bool flipY;
            void main(){
                vUv = uv;
				if (flipY)
					vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
			uniform vec4 scale; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
				
				gl_FragColor.rgba *= scale.rgba;
            }`}));const s=b0.uniforms;s.blitTexture.value=n,s.flipY.value=!1,s.scale.value=new qe(1,1,1,1),r!==void 0&&s.scale.value.copy(r),b0.defines.IS_SRGB=n.colorSpace==gt,b0.needsUpdate=!0,VC||(VC=new pe(NO,b0),VC.frustumCulled=!1);const o=new Ft,a=new Er;a.add(VC),i||(i=HC=new lh({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}));const l=Math.min(n.image.width,e),c=Math.min(n.image.height,e);ho&&(ho.width!==l||ho.height!==c)&&(ho.dispose(),ho=null),ho||(ho=new qt(l,c,{format:Ti,type:cn,minFilter:Dt,magFilter:Dt})),i.setRenderTarget(ho),i.setSize(l,c),i.clear(),i.render(a,o),HC&&(HC.dispose(),HC=null);const h=new Uint8ClampedArray(ho.width*ho.height*4);i.readRenderTargetPixels(ho,0,0,ho.width,ho.height,h);const u=new ImageData(h,ho.width,ho.height,void 0),d=await createImageBitmap(u,{premultiplyAlpha:"none"});return{imageData:u,imageBitmap:d}}function vge(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap}async function yge(n,e=4096){const i=e/Math.max(n.width,n.height),r=n.width*Math.min(1,i),s=n.height*Math.min(1,i),o=new OffscreenCanvas(r,s),a={premultiplyAlpha:"none"};n.width!==r&&(a.resizeWidth=r),n.height!==s&&(a.resizeHeight=s);const l=await createImageBitmap(n,a),c=o.getContext("bitmaprenderer");return c&&c.transferFromImageBitmap(l),o}async function _Q(n,e=void 0,i=!1,r=4096){if(vge(n)){const s=r/Math.max(n.width,n.height),o=new OffscreenCanvas(n.width*Math.min(1,s),n.height*Math.min(1,s)),a=o.getContext("2d",{alpha:!0,premultipliedAlpha:!1});if(!a)throw new Error("Could not get canvas 2D context");if(i===!0&&(a.translate(0,o.height),a.scale(1,-1)),a.drawImage(n,0,0,o.width,o.height),e!==void 0){const l=e.x,c=e.y,h=e.z,u=e.w,d=a.getImageData(0,0,o.width,o.height),f=d.data;for(let m=0;m<f.length;m+=4)f[m+0]=f[m+0]*l,f[m+1]=f[m+1]*c,f[m+2]=f[m+2]*h,f[m+3]=f[m+3]*u;a.putImageData(d,0,0)}return o}else throw new Error("NeedleUSDZExporter: No valid image data found. Unable to process texture.")}const Gn=7;function Age(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Needle Engine USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function bge(n,e){let i=Age();return i+=n,SC(i)}function QC(n){return n.name.replace(/[-<>\(\)\[\]$%&\/\\\=\?\,\;]/g,"")+"_"+n.id}function wQ(n){return Pl(n.name||"bone_"+n.uuid)}function zO(n,e){return Pl(n.name||"Geometry")+"_"+n.id}function jO(n){return Pl(n.name||"Material")+"_"+n.id}function x0(n,e){let i=wQ(n),r=n.parent;for(;r&&r!==e;)i=wQ(r)+"/"+i,r=r.parent;return i}function SQ(n,e,i){var r;if(n==null)return;si.report("export-usdz-xforms",{message:"buildXform "+n.displayName||n.name,autoStep:!0});const s=n.matrix,o=n.geometry,a=n.material,l=n.camera,c=n.name;if(n.animations)for(const m of n.animations)i.animations.push(m);const h=_0(s);s.determinant()<0&&console.warn("NeedleUSDZExporter: USDZ does not support negative scales",c);const u=o&&o.isBufferGeometry&&o.attributes.skinIndex!==void 0&&o.attributes.skinIndex.count>0,d=u?"SkelRoot":"Xform",f=new Array;if(e.appendLine(),o?(e.beginBlock(`def ${d} "${c}"`,"(",!1),i.quickLookCompatible&&a&&a.side===yi&&!u?e.appendLine(`prepend references = @./geometries/${zO(o)}.usda@</Geometry_doubleSided>`):e.appendLine(`prepend references = @./geometries/${zO(o)}.usda@</Geometry>`),f.push("MaterialBindingAPI"),u&&f.push("SkelBindingAPI")):l?e.beginBlock(`def Camera "${c}"`,"(",!1):n.type!==void 0?e.beginBlock(`def ${n.type} "${c}"`):e.beginBlock(`def Xform "${c}"`,"(",!1),n.displayName&&e.appendLine(`displayName = "${n.displayName}"`),n.type===void 0&&((r=n.extraSchemas)!=null&&r.length&&f.push(...n.extraSchemas),f.length&&e.appendLine(`prepend apiSchemas = [${f.map(m=>`"${m}"`).join(", ")}]`),e.closeBlock(")"),e.beginBlock()),o&&a){const m=jO(a);e.appendLine(`rel material:binding = </StageRoot/Materials/${m}>`),!i.quickLookCompatible&&a.side===yi&&(e.beginBlock('over "Geometry" '),e.appendLine("uniform bool doubleSided = 1"),e.closeBlock())}if(u?(e.appendLine("rel skel:skeleton = <Rig>"),e.appendLine("rel skel:animationSource = <Rig/_anim>"),e.appendLine(`matrix4d xformOp:transform = ${_0(new he)}`)):n.type===void 0&&e.appendLine(`matrix4d xformOp:transform = ${h}`),n.type===void 0&&e.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]'),n.visibility!==void 0&&e.appendLine(`token visibility = "${n.visibility}"`),l&&("isOrthographicCamera"in l&&l.isOrthographicCamera?(e.appendLine(`float2 clippingRange = (${l.near}, ${l.far})`),e.appendLine(`float horizontalAperture = ${((Math.abs(l.left)+Math.abs(l.right))*10).toPrecision(Gn)}`),e.appendLine(`float verticalAperture = ${((Math.abs(l.top)+Math.abs(l.bottom))*10).toPrecision(Gn)}`),e.appendLine('token projection = "orthographic"')):"isPerspectiveCamera"in l&&l.isPerspectiveCamera&&(e.appendLine(`float2 clippingRange = (${l.near.toPrecision(Gn)}, ${l.far.toPrecision(Gn)})`),e.appendLine(`float focalLength = ${l.getFocalLength().toPrecision(Gn)}`),e.appendLine(`float focusDistance = ${l.focus.toPrecision(Gn)}`),e.appendLine(`float horizontalAperture = ${l.getFilmWidth().toPrecision(Gn)}`),e.appendLine('token projection = "perspective"'),e.appendLine(`float verticalAperture = ${l.getFilmHeight().toPrecision(Gn)}`))),n.onSerialize&&n.onSerialize(e,i),n.children){e.appendLine();for(const m of n.children)SQ(m,e,i)}e.closeBlock()}function Br(n){return Number.isInteger(n)?n.toString():n.toFixed(10)}function _0(n){const e=n.elements;return`( ${WC(e,0)}, ${WC(e,4)}, ${WC(e,8)}, ${WC(e,12)} )`}function WC(n,e){return`(${Br(n[e+0])}, ${Br(n[e+1])}, ${Br(n[e+2])}, ${Br(n[e+3])})`}function xge(n,e=[],i=!0){return`
def "Geometry"
${_ge(n,e,i)}
`}function _ge(n,e=[],i=!0){const r="Geometry",s=n.attributes,o=s.position.count,a=e&&e.length>0,l=[],c=[];let h=new Array,u=s.skinIndex;if(a){const f=[];for(const v of e)v.parent.type!=="Bone"&&(l.push({bone:v,index:e.indexOf(v)}),f.push(v.uuid));for(;f.length<e.length;)for(const v of l){const y=v.bone.children;for(const A of y)f.indexOf(A.uuid)===-1&&e.indexOf(A)!==-1&&(l.push({bone:A,index:e.indexOf(A)}),f.push(A.uuid))}for(const v of gQ(e))l.push({bone:v,index:l.length});const m=l[0].bone.parent;l.sort((v,y)=>x0(v.bone,m)>x0(y.bone,m)?1:-1),l.map(v=>'"'+x0(v.bone,m)+'"').join(", ");for(const v in l)c[l[v].index]=parseInt(v);const g=s.skinIndex;h=new Array;for(let v=0;v<g.count;v++){const y=g.getX(v),A=g.getY(v),b=g.getZ(v),x=g.getW(v);h.push(c[y],c[A],c[b],c[x])}u=new Ye(new Uint16Array(h),4)}const d=s.skinWeight&&s.skinIndex;return`
{	
    def Mesh "${r}" ${d?`(
        prepend apiSchemas = ["SkelBindingAPI"]
    )`:""}
    {
        int[] faceVertexCounts = [${GO(n)}]
        int[] faceVertexIndices = [${HO(n)}]
		${s.normal||i?`normal3f[] normals = [${CQ(s.normal,o)}] (
            interpolation = "vertex"
        )`:""}
        point3f[] points = [${CQ(s.position,o)}]
        ${s.uv?`texCoord2f[] primvars:st = [${MQ(s.uv,o)}] (
            interpolation = "vertex"
        )`:""}
		${s.uv2?`texCoord2f[] primvars:st2 = [${MQ(s.uv2,o)}] (
            interpolation = "vertex"
        )`:""}
		${d?`matrix4d primvars:skel:geomBindTransform = ( (1, 0, 0, 0), (0, 1, 0, 0), (0, 0, 1, 0), (0, 0, 0, 1) ) (
				elementSize = 1
				interpolation = "constant"
			)`:""}
		${s.skinIndex?`int[] primvars:skel:jointIndices = [${EQ(u,!0)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${s.skinWeight?`float[] primvars:skel:jointWeights = [${EQ(s.skinWeight)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
        uniform token subdivisionScheme = "none"
    }
}
${i?`
# This is a workaround for QuickLook/RealityKit not supporting the doubleSided attribute. We're adding a second
# geometry definition here, that uses the same mesh data but appends extra faces with reversed winding order.
def "${r}_doubleSided" (
	prepend references = </Geometry>
)
{
	over "Geometry"
	{
		int[] faceVertexCounts = [${GO(n)+", "+GO(n)}]
		int[] faceVertexIndices = [${HO(n)+", "+HO(n,!0)}]
	}
}
`:""}
`}function GO(n){const e=n.index!==null?n.index.count:n.attributes.position.count;return Array(e/3).fill(3).join(", ")}function HO(n,e=!1){const i=n.index,r=[];if(i!==null)for(let s=0;s<i.count;s++){let o=s;e&&(o=s%3===0?s+2:s%3===2?s-2:s),r.push(i.getX(o))}else{const s=n.attributes.position.count;for(let o=0;o<s;o++){let a=o;e&&(a=o%3===0?o+2:o%3===2?o-2:o),r.push(a)}}return r.join(", ")}function CQ(n,e){if(n===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(e).fill("(0, 0, 1)").join(", ");const i=[];for(let r=0;r<n.count;r++){const s=n.getX(r),o=n.getY(r),a=n.getZ(r);i.push(`(${s.toPrecision(Gn)}, ${o.toPrecision(Gn)}, ${a.toPrecision(Gn)})`)}return i.join(", ")}function EQ(n,e=!1){const i=[];for(let r=0;r<n.count;r++){const s=n.getX(r),o=n.getY(r),a=n.getZ(r),l=n.getW(r);i.push(`${e?s:s.toPrecision(Gn)}`),i.push(`${e?o:o.toPrecision(Gn)}`),i.push(`${e?a:a.toPrecision(Gn)}`),i.push(`${e?l:l.toPrecision(Gn)}`)}return i.join(", ")}function MQ(n,e){if(n===void 0)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const i=[];for(let r=0;r<n.count;r++){const s=n.getX(r),o=n.getY(r);i.push(`(${s.toPrecision(Gn)}, ${1-o.toPrecision(Gn)})`)}return i.join(", ")}function wge(n,e,i=!1){const r=[];for(const s in n){const o=n[s];r.push(Sge(o,e,i))}return`
	def "Materials"
    {
${r.join("")}
    }`}function Sge(n,e,i=!1){var r;const s="                ",o=[],a=[],l=jO(n),c=new Set;function h(g){var v;return Pl(g.name)+"_"+(((v=g.source)==null?void 0:v.id)??g.id)}function u(g,v,y=void 0,A=void 0){const b=h(g),x=b+(A!==void 0&&A!==1?"_"+A:""),_=i&&A!==void 0&&A!==1,w=_?new qe(1,1,1,A):void 0;A===void 0&&(A=1),_&&(A=1),w&&w.w<=.05&&(w.w=.05),e[x]={texture:g,scale:w};const T=g.channel>0?"st"+g.channel:"st";c.add(g.channel);const M=RQ.includes(g.format),R={1e3:"repeat",1001:"clamp",1002:"mirror"},B=g.repeat.clone(),E=g.offset.clone(),P=g.rotation,O=Math.sin(P),N=Math.cos(P);E.y=1-E.y-B.y,i?(B.x===0&&(B.x=1e-4),B.y===0&&(B.y=1e-4),E.x=E.x/B.x,E.y=E.y/B.y,E.x+=O/B.x,E.y+=N-1):(E.x+=O*B.x,E.y+=(1-N)*B.y);const L=B.x!=1||B.y!=1||E.x!=0||E.y!=0||P!=0,Q=`${Io}/${l}/${"uvReader_"+T}.outputs:result>`,D=`${Io}/${l}/Transform2d_${v}.outputs:result>`,F=v!=="normal"&&y&&(y.r!==1||y.g!==1||y.b!==1||A!==1)||!1,H=v==="normal",K=n instanceof mr&&n.normalScale?n.normalScale.x*2:2,Z=K.toFixed(Gn),oe=(-1*(K/2)).toFixed(Gn),we=(1-K).toFixed(Gn);return`
			${L?`def Shader "Transform2d_${v}" (
				sdrMetadata = {
					string role = "math"
				}
			)
			{
				uniform token info:id = "UsdTransform2d"
				float2 inputs:in.connect = ${Q}
				float2 inputs:scale = ${IQ(B)}
				float2 inputs:translation = ${IQ(E)}
				float inputs:rotation = ${(P/Math.PI*180).toFixed(Gn)}
				float2 outputs:result
			}
			`:""}
			def Shader "${b}_${v}"
			{
				uniform token info:id = "UsdUVTexture"
				asset inputs:file = @textures/${x}.${M?"png":"jpg"}@
				token inputs:sourceColorSpace = "${g.colorSpace==="srgb"?"sRGB":"raw"}"
				float2 inputs:st.connect = ${L?D:Q}
				${F?`
				float4 inputs:scale = (${y?y.r+", "+y.g+", "+y.b:"1, 1, 1"}, ${A})
				`:""}
				${H?`
				float4 inputs:scale = (${Z}, ${Z}, ${Z}, 1)
				float4 inputs:bias = (${oe}, ${oe}, ${we}, 0)
				`:""}
				token inputs:wrapS = "${R[g.wrapS]}"
				token inputs:wrapT = "${R[g.wrapT]}"
				float outputs:r
				float outputs:g
				float outputs:b
				float3 outputs:rgb
				${n.transparent||n.alphaTest>0?"float outputs:a":""}
			}`}let d=n.transparent||n.alphaTest?n.opacity:1,f=!1,m=!1;if(n instanceof Co&&n.transmission!==void 0&&(d*=1-n.transmission*(1-n.roughness*.5)),n.map?(o.push(`${s}color3f inputs:diffuseColor.connect = ${Io}/${l}/${h(n.map)}_diffuse.outputs:rgb>`),n instanceof Jt&&n.transparent&&n.alphaTest==0&&i?(o.push(`${s}float inputs:opacity.connect = ${Io}/${l}/${h(n.map)}_diffuse.outputs:a>`),f=!0,o.push(`${s}float inputs:opacityThreshold = ${1e-10}`),m=!0):n.transparent?(o.push(`${s}float inputs:opacity.connect = ${Io}/${l}/${h(n.map)}_diffuse.outputs:a>`),f=!0):n.alphaTest>0&&(o.push(`${s}float inputs:opacity.connect = ${Io}/${l}/${h(n.map)}_diffuse.outputs:a>`),f=!0,o.push(`${s}float inputs:opacityThreshold = ${n.alphaTest}`),m=!0),a.push(u(n.map,"diffuse",n.color,d))):o.push(`${s}color3f inputs:diffuseColor = ${TQ(n.color)}`),n.alphaHash&&i&&(m?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping alphaHash opacity threshold."):(o.push(`${s}float inputs:opacityThreshold = 0.0000000001`),m=!0)),n.aoMap&&(o.push(`${s}float inputs:occlusion.connect = ${Io}/${l}/${h(n.aoMap)}_occlusion.outputs:r>`),a.push(u(n.aoMap,"occlusion"))),n.alphaMap?(o.push(`${s}float inputs:opacity.connect = ${Io}/${l}/${h(n.alphaMap)}_opacity.outputs:r>`),o.push(`${s}float inputs:opacityThreshold = 0.0000000001`),f=!0,m=!0,a.push(u(n.alphaMap,"opacity",new be(1,1,1),d))):(f?console.warn("Opacity for "+n.name+" was already connected. Skipping default opacity."):(o.push(`${s}float inputs:opacity = ${d}`),f=!0),n.alphaTest>0&&(m?console.warn("Opacity threshold for "+n.name+" was already connected. Skipping default opacity threshold."):(o.push(`${s}float inputs:opacityThreshold = ${n.alphaTest}`),m=!0))),n instanceof mr){if(n.emissiveMap){o.push(`${s}color3f inputs:emissiveColor.connect = ${Io}/${l}/${h(n.emissiveMap)}_emissive.outputs:rgb>`);const g=n.emissive.clone();g.multiplyScalar(n.emissiveIntensity),a.push(u(n.emissiveMap,"emissive",g))}else if(((r=n.emissive)==null?void 0:r.getHex())>0){const g=n.emissive.clone();g.multiplyScalar(n.emissiveIntensity),o.push(`${s}color3f inputs:emissiveColor = ${TQ(g)}`)}n.normalMap&&(o.push(`${s}normal3f inputs:normal.connect = ${Io}/${l}/${h(n.normalMap)}_normal.outputs:rgb>`),a.push(u(n.normalMap,"normal"))),n.roughnessMap&&n.roughness===1?(o.push(`${s}float inputs:roughness.connect = ${Io}/${l}/${h(n.roughnessMap)}_roughness.outputs:g>`),a.push(u(n.roughnessMap,"roughness"))):o.push(`${s}float inputs:roughness = ${n.roughness!==void 0?n.roughness:1}`),n.metalnessMap&&n.metalness===1?(o.push(`${s}float inputs:metallic.connect = ${Io}/${l}/${h(n.metalnessMap)}_metallic.outputs:b>`),a.push(u(n.metalnessMap,"metallic"))):o.push(`${s}float inputs:metallic = ${n.metalness!==void 0?n.metalness:0}`)}return n instanceof Co&&(o.push(`${s}float inputs:clearcoat = ${n.clearcoat}`),o.push(`${s}float inputs:clearcoatRoughness = ${n.clearcoatRoughness}`),o.push(`${s}float inputs:ior = ${n.ior}`),!n.transparent&&!(n.alphaTest>0)&&n.transmissionMap&&(o.push(`${s}float inputs:opacity.connect = ${Io}/${l}/${h(n.transmissionMap)}_transmission.outputs:r>`),a.push(u(n.transmissionMap,"transmission")))),c.size>2?console.warn("USDZExporter: Material "+n.name+" uses more than 2 UV channels. Currently, only UV0 and UV1 are supported."):c.size===2&&(!c.has(0)||!c.has(1))&&console.warn("USDZExporter: Material "+n.name+" uses UV channels other than 0 and 1. Currently, only UV0 and UV1 are supported."),`

		def Material "${l}" ${n.name?`(
			displayName = "${n.name}"
		)`:""}
		{
			token outputs:surface.connect = ${Io}/${l}/PreviewSurface.outputs:surface>

			def Shader "PreviewSurface"
			{
				uniform token info:id = "UsdPreviewSurface"
${o.join(`
`)}
				int inputs:useSpecularWorkflow = ${n instanceof Jt?"1":"0"}
				token outputs:surface
			}
${a.length>0?`
${c.has(0)?`
			def Shader "uvReader_st"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${c.has(1)?`
			def Shader "uvReader_st2"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st2"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${a.join(`
`)}`:""}
		}`}function TQ(n){return`(${n.r}, ${n.g}, ${n.b})`}function IQ(n){return`(${n.x}, ${n.y})`}const RQ=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492];te("debugusdz");const PQ=class{constructor(n,e,i){p(this,"id"),p(this,"trigger"),p(this,"action"),p(this,"exclusive",!1),this.id="Behavior_"+Pl(n)+"_"+PQ.global_id++,this.trigger=e,this.action=i}makeExclusive(n){return this.exclusive=n,this}writeTo(n,e,i){if(!this.trigger||!this.action)return;i.beginBlock(`def Preliminary_Behavior "${this.id}"`);let r="";if(Array.isArray(this.trigger)){r="[";for(let s=0;s<this.trigger.length;s++){const o=this.trigger[s];r+="<"+o.id+">",s+1<this.trigger.length&&(r+=", ")}r+="]"}else r=`<${this.trigger.id}>`;if(i.appendLine(`rel triggers = ${r}`),i.appendLine(`rel actions = <${this.action.id}>`),i.appendLine(`uniform bool exclusive = ${this.exclusive?1:0}`),i.appendLine(),Array.isArray(this.trigger))for(const s of this.trigger)s.writeTo(e,i),i.appendLine();else this.trigger.writeTo(e,i);i.appendLine(),this.action.writeTo(e,i),i.closeBlock()}};let kr=PQ;p(kr,"global_id",0);const w0=new Set;function VO(n,e){var i,r;let s="";if(Array.isArray(n)){w0.clear();let o="[ ";for(let a=0;a<n.length;a++){let l=n[a];if(!l){console.warn("Invalid target object in behavior",n+". Is the object exported?");continue}if(typeof l=="string"){if(w0.has(l))continue;o+=l,w0.add(l)}else if(typeof l=="object"){if(l.isObject3D&&(l=e.findById(l.uuid),!l)){console.warn("Invalid target object in behavior",n+". Is the object exported?");continue}const c=(i=l.getPath)==null?void 0:i.call(l);if(w0.has(c))continue;o+=c,w0.add(c)}a+1<n.length&&(o+=", ")}o+=" ]",s=o,w0.clear()}else typeof n=="object"&&(n.isObject3D&&(n=e.findById(n.uuid)),s=(r=n.getPath)==null?void 0:r.call(n));return s}const BQ=class{constructor(n,e){p(this,"id"),p(this,"targetId"),p(this,"tokenId"),p(this,"type"),p(this,"distance"),n&&(this.targetId=n),e?this.id=e:this.id="Trigger_"+BQ.global_id++}writeTo(n,e){e.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=VO(this.targetId,n)),e.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&e.appendLine(`token info:id = "${this.tokenId}"`),this.type&&e.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&e.appendLine(`double distance = ${this.distance}`),e.closeBlock()}};let kf=BQ;p(kf,"global_id",0);function kQ(n,e={direct:!0,indirect:!0}){const i=co.createEmpty();i.name="InputTarget_"+i.name,i.displayName=void 0,i.type="RealityKitComponent",i.onSerialize=r=>{r.appendLine("bool allowsDirectInput = "+(e.direct?1:0)),r.appendLine("bool allowsIndirectInput = "+(e.indirect?1:0)),r.appendLine('uniform token info:id = "RealityKit.InputTarget"')},n.add(i)}class Or{static sceneStartTrigger(){const e=new kf;return e.targetId=void 0,e.tokenId="SceneTransition",e.type="enter",e}static tapTrigger(e,i={direct:!0,indirect:!0}){const r=new kf(e);if(Array.isArray(e)&&e.length>1)for(const s of e)s instanceof co&&kQ(s,i);else e instanceof co&&kQ(e,i);return r.tokenId="TapGesture",r}static isTapTrigger(e){return e?.tokenId==="TapGesture"}static proximityToCameraTrigger(e,i){const r=new kf(e);return r.tokenId="ProximityToCamera",r.distance=i,r}}class Ad{constructor(e,i){p(this,"id"),p(this,"actions"),p(this,"loops",0),p(this,"performCount",1),p(this,"type","serial"),p(this,"multiplePerformOperation"),this.id=e,this.actions=i}static getId(){return this.global_id++}addAction(e){return this.actions.push(e),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this.performCount=0,this}makeRepeat(e){return this.performCount=e,this}writeTo(e,i){i.beginBlock(`def Preliminary_Action "${this.id}"`),i.beginArray("rel actions");for(const r of this.actions){if(!r)continue;const s=r===this.actions[this.actions.length-1];i.appendLine("<"+r.id+">"+(s?"":", "))}i.closeArray(),i.appendLine(),i.appendLine('token info:id = "Group"'),i.appendLine(`bool loops = ${this.loops}`),i.appendLine(`int performCount = ${this.loops>0?0:Math.max(0,this.performCount)}`),i.appendLine(`token type = "${this.type}"`),typeof this.multiplePerformOperation=="string"&&i.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),i.appendLine();for(const r of this.actions)r&&(r.writeTo(e,i),i.appendLine());i.closeBlock()}}p(Ad,"global_id",0);const QO=class{constructor(n,e){p(this,"id"),p(this,"tokenId"),p(this,"affectedObjects"),p(this,"easeType"),p(this,"motionType"),p(this,"duration"),p(this,"moveDistance"),p(this,"style"),p(this,"type"),p(this,"front"),p(this,"up"),p(this,"start"),p(this,"animationSpeed"),p(this,"reversed"),p(this,"pingPong"),p(this,"xFormTarget"),p(this,"audio"),p(this,"gain"),p(this,"auralMode"),p(this,"multiplePerformOperation"),p(this,"velocity"),n&&(this.affectedObjects=n),e?this.id=e:this.id="Action",this.id+="_"+QO.global_id++}clone(){const n=new QO,e=n.id;return Object.assign(n,this),n.id=e,n}writeTo(n,e){e.beginBlock(`def Preliminary_Action "${this.id}"`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=VO(this.affectedObjects,n)),e.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&(typeof this.animationSpeed=="number"&&this.animationSpeed!==1?e.appendLine(`double duration = ${this.duration/this.animationSpeed} `):e.appendLine(`double duration = ${this.duration} `)),this.easeType&&e.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&e.appendLine(`token info:id = "${this.tokenId}"`),this.tokenId==="ChangeScene"&&e.appendLine("rel scene = </StageRoot/Scenes/Scene>"),this.motionType!==void 0&&e.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&e.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&e.appendLine(`token style = "${this.style}"`),this.type&&e.appendLine(`token type = "${this.type}"`),this.front&&e.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&e.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&e.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&e.appendLine(`double animationSpeed = ${this.animationSpeed.toFixed(2)} `),typeof this.reversed=="boolean"&&e.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&e.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=VO(this.xFormTarget,n)),e.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&e.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&e.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&e.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&e.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),typeof this.velocity=="object"&&e.appendLine(`vector3d velocity = (${this.velocity.x}, ${this.velocity.y}, ${this.velocity.z})`),e.closeBlock()}};let za=QO;p(za,"global_id",0);let S0=class Nv{constructor(e,i,r){p(this,"x",0),p(this,"y",0),p(this,"z",0),this.x=e,this.y=i,this.z=r}static get up(){return new Nv(0,1,0)}static get right(){return new Nv(1,0,0)}static get forward(){return new Nv(0,0,1)}static get back(){return new Nv(0,0,-1)}static get zero(){return new Nv(0,0,0)}};class Ai{static sequence(...e){return new Ad("Group_"+Ad.getId(),e).makeSequence()}static parallel(...e){return new Ad("Group_"+Ad.getId(),e).makeParallel()}static fadeAction(e,i,r){const s=new za(e);return s.tokenId="Visibility",s.type=r?"show":"hide",s.duration=i,s.style="basic",s.motionType="none",s.moveDistance=0,s.easeType="none",s}static startAnimationAction(e,i,r=0,s=1,o=!1,a=!1){const l=new za(e);if(l.tokenId="StartAnimation",l.start=i,l.duration=r,l.animationSpeed=s,l.reversed=o,l.pingPong=a,l.multiplePerformOperation="allow",o&&(l.start-=r),a){l.pingPong=!1;const c=l.clone();return c.reversed=!o,c.start=l.start,c.reversed&&(c.start-=r),Ai.sequence(l,c)}return l}static waitAction(e){const i=new za;return i.tokenId="Wait",i.duration=e,i.motionType=void 0,i}static lookAtCameraAction(e,i,r,s){const o=new za(e);return o.tokenId="LookAtCamera",o.duration=i===void 0?9999999999999:i,o.front=r??S0.forward,o.up=s??S0.up,o}static emphasize(e,i,r="bounce",s=1,o="basic"){const a=new za(e);return a.tokenId="Emphasize",a.duration=i,a.style=o??"basic",a.motionType=r,a.moveDistance=s,a}static transformAction(e,i,r,s,o="inout"){const a=new za(e);return a.tokenId="Transform",a.duration=r,a.duration=Math.max(1e-6,r),a.type=s,a.easeType=r>0?o:"none",Array.isArray(i)&&console.error("Transform target must not be an array",i),a.xFormTarget=i,a}static playAudioAction(e,i,r="play",s=1,o="spatial"){const a=new za(e);return a.tokenId="Audio",a.type=r,a.audio=i,a.gain=s,a.auralMode=o,a.multiplePerformOperation="allow",a}static impulseAction(e,i){const r=new za(e);return r.tokenId="Impulse",r.velocity=i,r}}class Cge{constructor(e){p(this,"object"),p(this,"model"),this.object=e}get id(){return this.object.uuid}apply(e){if(!this.model&&(this.model=e.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(e)}}class WO extends Cge{constructor(e,i,r,s){super(e),p(this,"matrix"),p(this,"material"),p(this,"geometry"),p(this,"_enableAction"),p(this,"_disableAction"),this.matrix=i,this.material=r,this.geometry=s}onApply(e){var i,r;const s=this.model;if(!s)return;(i=s.parent)!=null&&i.isDynamic||co.createEmptyParent(s);const o=s.clone();this.matrix&&(o.matrix=this.matrix),this.material&&(o.material=this.material),this.geometry&&(o.geometry=this.geometry),(r=s.parent)==null||r.add(o)}enable(){return this._enableAction?this._enableAction:(this._enableAction=Ai.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=Ai.fadeAction(this.object,0,!1),this._disableAction)}}class XO{constructor(e){p(this,"actions"),p(this,"sortedActions"),this.actions=[...e]}organize(){this.sortedActions={};for(const e of this.actions){const i=e.id;this.sortedActions[i]||(this.sortedActions[i]=[]),this.sortedActions[i].push(e)}}getActions(e){return this.sortedActions||this.organize(),this.sortedActions[e.uuid]}}const C0=function(n){return C(n)},C=function(n){if(n===void 0&&(n=null),!Array.isArray(n))n=OQ(n);else for(let e=0;e<n.length;e++){const i=n[e];n[e]=OQ(i)}return function(e,i){typeof i!="string"&&(i=i.name),Object.getOwnPropertyDescriptor(e,"$serializedTypes")||(e.$serializedTypes={});const r=e.$serializedTypes=e.$serializedTypes||{};r[i]=n}};function OQ(n){var e,i;switch((i=(e=n?.prototype)==null?void 0:e.constructor)==null?void 0:i.name){case"Number":case"String":case"Boolean":return null}return n}class ie extends ve{constructor(){super(...arguments),p(this,"guid")}static isDestroyed(e){return Ef(e)}static setActive(e,i,r=!0){e&&($A(e,i),YS(e),i&&r&&a8(Ot.Current,e))}static isActiveSelf(e){return l0(e)}static isActiveInHierarchy(e){return Q8(e)}static markAsInstancedRendered(e,i){W8(e,i)}static isUsingInstancing(e){return uC(e)}static foreachComponent(e,i,r=!0){return Mf(e,i,r)}static instantiateSynced(e,i){return e?kk(e,i):null}static instantiate(e,i=null){return c0(e,i)}static destroySynced(e,i,r=!0){if(!e)return;const s=e;i=i??Ot.Current,HA(s,i.connection,r)}static destroy(e,i=!0){return $o(e,i)}static add(e,i,r){if(!(!e||!i)){if(e===i){console.warn("Can not add object to self",e);return}r||(r=Ot.Current),i.add(e),$A(e,!0),YS(e),r?ie.foreachComponent(e,s=>{Ck(s,r),!s.__internalDidAwakeAndStart&&r.new_script_start.includes(s)===!1&&r.new_script_start.push(s)},!0):console.warn("Missing context")}}static remove(e){var i;e&&((i=e.parent)==null||i.remove(e),$A(e,!1),YS(e),ie.foreachComponent(e,r=>{lpe(r)},!0))}static invokeOnChildren(e,i,...r){this.invoke(e,i,!0,r)}static invoke(e,i,r=!1,...s){e&&this.foreachComponent(e,o=>{const a=o[i];a&&typeof a=="function"&&a?.call(o,...s)},r)}static addNewComponent(e,i,r,s=!0){return Zo(e,i,r,{callAwake:s})}static addComponent(e,i,r,s){return Zo(e,i,r,s)}static moveComponent(e,i){return Zo(e,i)}static removeComponent(e){return Qk(e.gameObject,e),e}static getOrAddComponent(e,i){return YA(e,i)}static getComponent(e,i){return e===null?null:Cf(e,i)}static getComponents(e,i,r=null){return e===null?r??[]:JA(e,i,r)}static findByGuid(e,i){return eb(e,i)}static findObjectOfType(e,i,r=!0){return aC(e,i??Ot.Current,r)}static findObjectsOfType(e,i){const r=[];return H8(e,r,i),r}static getComponentInChildren(e,i){return KA(e,i)}static getComponentsInChildren(e,i,r=null){return a0(e,i,r??void 0)}static getComponentInParent(e,i){return ZA(e,i)}static getComponentsInParent(e,i,r=null){return oC(e,i,r)}static getAllComponents(e){var i;return[...(i=e.userData)==null?void 0:i.components]}static*iterateComponents(e){var i;const r=(i=e?.userData)==null?void 0:i.components;if(r&&Array.isArray(r))for(let s=0;s<r.length;s++)yield r[s]}}var bd;let Be=(bd=class{constructor(n){p(this,"__context"),p(this,"__name"),p(this,"gameObject"),p(this,"guid","invalid"),p(this,"sourceId"),p(this,"__didAwake",!1),p(this,"__didStart",!1),p(this,"__didEnable",!1),p(this,"__isEnabled"),p(this,"__destroyed",!1),p(this,"_eventListeners",new Map),this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(n)}get isComponent(){return!0}get context(){return this.__context??Ot.Current}set context(n){this.__context=n}get scene(){return this.context.scene}get layer(){var n,e;return(e=(n=this.gameObject)==null?void 0:n.userData)==null?void 0:e.layer}get name(){var n,e;return(n=this.gameObject)!=null&&n.name?this.gameObject.name:(e=this.gameObject)==null?void 0:e.userData.name}set name(n){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=n,this.__name=n):this.__name=n}get tag(){var n;return(n=this.gameObject)==null?void 0:n.userData.tag}set tag(n){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=n)}get static(){var n;return(n=this.gameObject)==null?void 0:n.userData.static}set static(n){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.static=n)}get hideFlags(){var n;return(n=this.gameObject)==null?void 0:n.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const n=this.gameObject[mh];return n===void 0?!0:n}set __isActiveInHierarchy(n){this.gameObject&&(this.gameObject[mh]=n)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(n,e=Xi.Update){return this.context.registerCoroutineUpdate(this,n,e)}stopCoroutine(n,e=Xi.Update){this.context.unregisterCoroutineUpdate(n,e)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(n){return this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(n),this}_internalInit(n){if(typeof n=="object")for(const e of Object.keys(n)){const i=n[e];typeof i!="function"&&(this[e]=i)}}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(n){return this.__destroyed?(it()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(n!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(n){if(this.__didAwake){if(!this.__didEnable){n!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var n;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((n=this.onDestroy)==null||n.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),z8(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(n){if(this.__destroyed){it()&&console.warn(`[Needle Engine Dev] Trying to ${n?"enable":"disable"} destroyed component`);return}if(typeof n=="number"&&(n>=.5?n=!0:n=!1),!this.__didAwake){this.__isEnabled=n;return}n?this.__internalEnable():this.__internalDisable()}get worldPosition(){return kt(this.gameObject)}set worldPosition(n){gr(this.gameObject,n)}setWorldPosition(n,e,i){Kp(this.gameObject,n,e,i)}get worldQuaternion(){return Ri(this.gameObject)}set worldQuaternion(n){Ca(this.gameObject,n)}setWorldQuaternion(n,e,i,r){rP(this.gameObject,n,e,i,r)}get worldEuler(){return oP(this.gameObject)}set worldEuler(n){aP(this.gameObject,n)}get worldRotation(){return this.gameObject.worldRotation}set worldRotation(n){this.setWorldRotation(n.x,n.y,n.z,!0)}setWorldRotation(n,e,i,r=!0){Qy(this.gameObject,n,e,i,r)}get forward(){return bd._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return bd._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return bd._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(n,e){this._eventListeners[n]=this._eventListeners[n]||[],this._eventListeners[n].push(e)}removeEventListener(n,e){if(!this._eventListeners[n])return;const i=this._eventListeners[n].indexOf(e);i>=0&&this._eventListeners[n].splice(i,1)}dispatchEvent(n){if(!n||!this._eventListeners[n.type])return!1;const e=this._eventListeners[n.type];for(let i=0;i<e.length;i++)e[i](n);return!1}},p(bd,"_forward",new S),p(bd,"_right",new S),p(bd,"_up",new S),bd);const Ege=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:Be,Component:Be,GameObject:ie},Symbol.toStringTag,{value:"Module"}));var Mge=Object.defineProperty,Tge=Object.getOwnPropertyDescriptor,DQ=(n,e,i,r)=>{for(var s=r>1?void 0:r?Tge(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Mge(e,i,s),s};class fb extends Be{constructor(){super(...arguments),p(this,"from"),p(this,"to"),p(this,"width",0),p(this,"centered",!0),p(this,"_centerPos")}awake(){this._centerPos=new S}update(){if(!this.from||!this.to)return;const e=kt(this.from).clone(),i=kt(this.to).clone(),r=e.distanceTo(i);this._centerPos.copy(e),this._centerPos.add(i),this._centerPos.multiplyScalar(.5),gr(this.gameObject,this.centered?this._centerPos:e),this.gameObject.lookAt(kt(this.to).clone()),this.gameObject.scale.set(this.width,this.width,r)}}DQ([C(ie)],fb.prototype,"from",2),DQ([C(ie)],fb.prototype,"to",2);var Ige=Object.defineProperty,Rge=Object.getOwnPropertyDescriptor,Of=(n,e,i,r)=>{for(var s=r>1?void 0:r?Rge(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Ige(e,i,s),s};const xd=te("debuganimation");let LQ=class{constructor(){p(this,"x"),p(this,"y")}};class Fs extends Be{constructor(){super(...arguments),p(this,"playAutomatically",!0),p(this,"randomStartTime",!0),p(this,"minMaxSpeed"),p(this,"minMaxOffsetNormalized"),p(this,"loop",!0),p(this,"clampWhenFinished",!1),p(this,"_tempAnimationClipBeforeGameObjectExisted",null),p(this,"_tempAnimationsArray"),p(this,"mixer"),p(this,"_actions"),p(this,"_handles")}get isAnimationComponent(){return!0}addClip(e){this.animations||(this.animations=[]),this.animations.push(e)}get time(){if(this.actions){for(const e of this.actions)if(e.isRunning())return e.time}return 0}set time(e){if(this.actions)for(const i of this.actions)i.time=e}get clip(){var e;return(e=this.animations)!=null&&e.length?this.animations[0]:null}set clip(e){if(!this.__didAwake){xd&&console.warn("Assign clip during serialization",e),this._tempAnimationClipBeforeGameObjectExisted=e;return}e&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(e)&&(this.animations.length>0?this.animations.splice(0,0,e):this.animations.push(e)))}set clips(e){this.animations=e}set animations(e){e==null||!Array.isArray(e)||(this.gameObject?this.gameObject.animations=e:this._tempAnimationsArray=e)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get actions(){return this._actions}set actions(e){this._actions=e}awake(){xd&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.actions=[],this._handles=[]}onEnable(){var e;if(this.playAutomatically&&((e=this.animations)==null?void 0:e.length)>0){const i=Math.floor(Math.random()*this.animations.length),r=this.animations[i];this.play(i,{exclusive:!0,fadeDuration:0,startTime:this.randomStartTime?Math.random()*r.duration:0,loop:this.loop,clampWhenFinished:this.clampWhenFinished})}}update(){this.mixer&&(this.mixer.update(this.context.time.deltaTime),this._handles.forEach(e=>e.update()))}onDisable(){this.mixer&&(this.mixer.stopAllAction(),this.mixer=void 0)}onDestroy(){this.context.animations.unregisterAnimationMixer(this.mixer)}getAction(e){var i;return((i=this.actions)==null?void 0:i.find(r=>r.getClip().name===e))||null}get isPlaying(){if(this.actions){for(let e=0;e<this.actions.length;e++)if(this.actions[e].isRunning())return!0}return!1}stopAll(e){if(this.actions)for(const i of this.actions)e!=null&&e.fadeDuration?i.fadeOut(e.fadeDuration):i.stop()}stop(e,i){if(e===void 0){this.stopAll();return}else if(typeof e=="number"){if(e>=this.animations.length){xd&&console.log("No animation at index",e);return}e=this.animations[e]}else typeof e=="string"&&(e=this.animations.find(s=>s.name===e));if(!e){console.error("Could not find clip",e);return}const r=this.actions.find(s=>s.getClip()===e);if(!r){console.error("Could not find action",e);return}i!=null&&i.fadeDuration?r.fadeOut(i.fadeDuration):r.stop()}pause(e,i=!1){if(e===void 0){for(const s of this.actions)s.paused=!i;return}else if(typeof e=="number"){if(e>=this.animations.length){xd&&console.log("No animation at index",e);return}e=this.animations[e]}else typeof e=="string"&&(e=this.animations.find(s=>s.name===e));if(!e){console.error("Could not find clip",e);return}const r=this.actions.find(s=>s.getClip()===e);if(!r){console.error("Could not find action",e);return}r.paused=!i}resume(){for(const e of this.actions)e.paused=!1}play(e=0,i){if(xd&&console.log("PLAY",e),this.ensureMixer(),!this.mixer){xd&&console.warn("Missing mixer",this);return}e===void 0&&(e=0);let r=e;if(typeof e=="number"){if(e>=this.animations.length){xd&&console.log("No animation at index",e);return}r=this.animations[e]}else typeof e=="string"&&(r=this.animations.find(o=>o.name===e));if(!r){console.error("Could not find clip",e);return}i||(i={});for(const o of this.actions)if(o.getClip()===r)return this.internalOnPlay(o,i);if(!r.tracks){console.warn("Clip is no AnimationClip",r);return}const s=this.mixer.clipAction(r);return this.actions.push(s),this.internalOnPlay(s,i)}internalOnPlay(e,i){var r=this.actions.find(o=>o===e);if(r===e&&r.isRunning()&&r.time<r.getClip().duration){const o=this.tryFindHandle(e);if(r.paused&&(r.paused=!1),o)return o.waitForFinish()}if(i.loop===void 0&&(i.loop=this.loop),i.clampWhenFinished===void 0&&(i.clampWhenFinished=this.clampWhenFinished),i.minMaxOffsetNormalized===void 0&&this.randomStartTime&&(i.minMaxOffsetNormalized=this.minMaxOffsetNormalized),i.minMaxSpeed===void 0&&(i.minMaxSpeed=this.minMaxSpeed),i?.exclusive??!0)for(const o of this.actions)o!=r&&(i.fadeDuration?o.fadeOut(i.fadeDuration):o.stop());if(i!=null&&i.fadeDuration&&e.fadeIn(i.fadeDuration),e.enabled=!0,i?.startTime!=null)e.time=i.startTime;else if(i!=null&&i.minMaxOffsetNormalized&&i.minMaxOffsetNormalized.x!=0&&i.minMaxOffsetNormalized.y!=0){const o=e.getClip();e.time=tt.lerp(i.minMaxOffsetNormalized.x,i.minMaxOffsetNormalized.y,Math.random())*o.duration}else e.time>=e.getClip().duration&&(e.time=0);i!=null&&i.minMaxSpeed?e.timeScale=tt.lerp(i.minMaxSpeed.x,i.minMaxSpeed.y,Math.random()):e.timeScale=i?.speed??1,i?.loop!=null?e.loop=i.loop?EI:ey:e.loop=ey,i!=null&&i.clampWhenFinished&&(e.clampWhenFinished=!0),e.paused=!1,e.play(),xd&&console.log("PLAY",e.getClip().name,e);const s=new Pge(e,this.mixer,i,o=>{this._handles.splice(this._handles.indexOf(s),1)});return this._handles.push(s),s.waitForFinish()}tryFindHandle(e){for(const i of this._handles)if(i.action===e)return i}ensureMixer(){if(!this.mixer){const e="animationMixer";this.gameObject[e]&&(this.mixer=this.gameObject[e]),(!this.mixer||!this.mixer.clipAction)&&(this.mixer=new qw(this.gameObject),this.gameObject[e]=this.mixer)}this.context.animations.registerAnimationMixer(this.mixer)}}Of([C()],Fs.prototype,"playAutomatically",2),Of([C()],Fs.prototype,"randomStartTime",2),Of([C(LQ)],Fs.prototype,"minMaxSpeed",2),Of([C(LQ)],Fs.prototype,"minMaxOffsetNormalized",2),Of([C()],Fs.prototype,"loop",2),Of([C()],Fs.prototype,"clampWhenFinished",2),Of([C($s)],Fs.prototype,"clips",1);class Pge{constructor(e,i,r,s){p(this,"mixer"),p(this,"action"),p(this,"promise",null),p(this,"_options"),p(this,"_resolveCallback",null),p(this,"_resolvedOrRejectedCallback"),p(this,"onLoop",o=>{}),p(this,"onFinished",o=>{o.action===this.action&&this.onResolve()}),this.action=e,this.mixer=i,this._resolvedOrRejectedCallback=s,this._options=r}waitForFinish(){return this.promise?this.promise:(this.promise=new Promise(e=>{this._resolveCallback=e}),this.mixer.addEventListener("loop",this.onLoop),this.mixer.addEventListener("finished",this.onFinished),this.promise)}update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var e,i;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(i=this._resolveCallback)==null||i.call(this,this.action)}dispose(){this.mixer.removeEventListener("loop",this.onLoop),this.mixer.removeEventListener("finished",this.onFinished)}}var Bge=Object.defineProperty,kge=Object.getOwnPropertyDescriptor,_d=(n,e,i,r)=>{for(var s=r>1?void 0:r?kge(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Bge(e,i,s),s};class ja{constructor(){p(this,"time"),p(this,"value"),p(this,"inTangent"),p(this,"inWeight"),p(this,"outTangent"),p(this,"outWeight"),p(this,"weightedMode")}}_d([C()],ja.prototype,"time",2),_d([C()],ja.prototype,"value",2),_d([C()],ja.prototype,"inTangent",2),_d([C()],ja.prototype,"inWeight",2),_d([C()],ja.prototype,"outTangent",2),_d([C()],ja.prototype,"outWeight",2),_d([C()],ja.prototype,"weightedMode",2);const qO=class{constructor(){p(this,"keys")}clone(){var n;const e=new qO;return e.keys=((n=this.keys)==null?void 0:n.map(i=>{const r=new ja;return r.time=i.time,r.value=i.value,r.inTangent=i.inTangent,r.inWeight=i.inWeight,r.outTangent=i.outTangent,r.outWeight=i.outWeight,r.weightedMode=i.weightedMode,r}))||[],e}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(n){if(!this.keys||this.keys.length==0)return 0;if(this.keys[0].time>=n)return this.keys[0].value;for(let e=0;e<this.keys.length;e++){const i=this.keys[e];if(i.time<=n)if(e+1<this.keys.length){const r=this.keys[e+1];if(r.time<n)continue;return!isFinite(i.outTangent)||!isFinite(r.inTangent)?i.value:qO.interpolateValue(n,i,r)}else return i.value}return this.keys[this.keys.length-1].value}static interpolateValue(n,e,i){const r=e.time,s=e.value,o=e.outTangent,a=i.time,l=i.value,c=i.inTangent,h=a-r,u=h*h,d=u*h,f=((o+c)*h-2*(l-s))/d,m=(3*(l-s)-(c+2*o)*h)/u,g=o,v=s,y=n-r,A=y*y,b=A*y;return f*b+m*A+g*y+v}};let Df=qO;_d([C(ja)],Df.prototype,"keys",2);class mc{constructor(e,i,r,s){p(this,"enabled",!0),p(this,"target"),p(this,"methodName"),p(this,"arguments"),this.target=e,this.methodName=i||null,this.arguments=r,s!=null&&(this.enabled=s)}get canClone(){return this.target instanceof Object}invoke(...e){if(this.enabled!==!1){if(typeof this.target=="function")this.arguments?this.target(...this.arguments,...e):this.target(...e);else if(this.methodName!=null){const i=this.target[this.methodName];typeof i=="function"?this.arguments?i.call(this.target,...this.arguments,...e):i.call(this.target,...e):this.arguments?this.target[this.methodName]=this.arguments[0]||e[0]:this.target[this.methodName]=e[0]}}}}const Oge=n=>/^[A-Z]*$/.test(n);class XC extends Event{constructor(){super(...arguments),p(this,"args")}}class An{constructor(e){if(p(this,"isEventList",!0),p(this,"target"),p(this,"key"),p(this,"_isInvoking",!1),p(this,"methods",[]),p(this,"_methodsCopy",[]),this.methods=[],Array.isArray(e))for(const i of e)i instanceof mc?this.methods.push(i):typeof i=="function"&&this.methods.push(new mc(i));else typeof e=="function"&&this.methods.push(new mc(e))}__internalOnInstantiate(e){var i;const r=new Array;for(let s=0;s<this.methods.length;s++){const o=this.methods[s];if(!(o.target instanceof Function)){const a=o.target;let l=a?.uuid;if(a&&(l=a.guid),l){const c=e[l];if(c){const h=(i=o.arguments)==null?void 0:i.map(u=>u instanceof Object&&u.uuid?e[u.uuid]:u!=null&&u.isComponent?e[u.guid]:u);r.push(new mc(c.clone,o.methodName,h,o.enabled))}else it()&&console.warn("Could not find target for event listener")}}}return new An(r)}setEventTarget(e,i){if(this.key=e,this.target=i,this.key!==void 0){let r="",s=!1;for(const o of this.key)s&&Oge(o)&&(r+="-"),s=!0,r+=o.toLowerCase();this.key=r}}get listenerCount(){var e;return((e=this.methods)==null?void 0:e.length)??0}get isInvoking(){return this._isInvoking}static from(...e){return new An(e)}invoke(...e){var i;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((i=this.methods)==null?void 0:i.length)<=0)return!1;this._isInvoking=!0;try{this._methodsCopy.length=0,this._methodsCopy.push(...this.methods);for(const r of this._methodsCopy)r.invoke(...e);if(typeof this.target=="object"&&typeof this.key=="string"){const r=this.target.dispatchEvent;if(typeof r=="function"){const s=new XC(this.key);s.args=e,r.call(this.target,s)}}}finally{this._isInvoking=!1,this._methodsCopy.length=0}return!0}addEventListener(e){return this.methods.push(new mc(e)),e}removeEventListener(e){if(e)for(let i=this.methods.length-1;i>=0;i--)this.methods[i].target===e&&(this.methods[i].enabled=!1,this.methods.splice(i,1))}removeAllEventListeners(){this.methods.length=0}}const UQ=Symbol("previous-visibility"),mb=class extends qt{render(n,e,i){if(i instanceof yP)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const r=i.getRenderTarget(),s=i.xr.enabled;i.xr.enabled=!1,i.setRenderTarget(this),i.clear(!0,!0,!0),i.render(n,e),i.setRenderTarget(r),i.xr.enabled=s,this.onAfterRender()}}onBeforeRender(){mb._userSet.clear();const n=_k(this.texture,!0,null,mb._userSet);for(const e of n)e instanceof pe&&(e[UQ]=e.visible,e.visible=!1)}onAfterRender(){for(const n of mb._userSet)n instanceof pe&&(n.visible=n[UQ]);mb._userSet.clear()}};let E0=mb;p(E0,"_userSet",new Set);class Dge extends La{constructor(){super([be,ki],"ColorSerializer")}onDeserialize(e){if(e!=null)return e.a!==void 0?new ki(e.r,e.g,e.b,e.a):e.alpha!==void 0?new ki(e.r,e.g,e.b,e.alpha):new be(e.r,e.g,e.b)}onSerialize(e){if(e!=null)return e.a!==void 0?{r:e.r,g:e.g,b:e.b,a:e.a}:{r:e.r,g:e.g,b:e.b}}}const Lge=new Dge;class Uge extends La{constructor(){super([ri],"EulerSerializer")}onDeserialize(e,i){if(e!=null){if(e.order)return new ri(e.x,e.y,e.z,e.order);if(e.x!=null)return new ri(e.x,e.y,e.z)}}onSerialize(e,i){return{x:e.x,y:e.y,z:e.z,order:e.order}}}const Fge=new Uge;class Nge extends La{constructor(){super(ve,"ObjectSerializer")}onSerialize(e,i){if(i.objectToNode!==void 0&&e.uuid){const r=i.objectToNode[e.uuid];return Pr&&console.log(r,e.name,e.uuid),{node:r}}}onDeserialize(e,i){var r,s,o;if(typeof e=="string"){if(e.endsWith(".glb")||e.endsWith(".gltf")){if(i.serializable instanceof Array&&i.serializable.includes($t))return;it()&&Pi("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const a=(s=(r=i.target)==null?void 0:r.constructor)==null?void 0:s.name;console.warn(`Wrong usage of @serializable detected in your script "${a}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${i.path}! : AssetReference;
\0`)}return}if(e){if(e.node!==void 0&&i.nodeToObject){const a=i.nodeToObject[e.node];return Pr&&console.log("Deserialized object reference?",e,a,i?.nodeToObject),a||console.warn("Did not find node: "+e.node,i.nodeToObject,i.object),a}else if(e.guid){if(!i.context){console.error("Missing context");return}let a;const l=(o=i.gltf)==null?void 0:o.scene;return l&&(a=ie.findByGuid(e.guid,l)),a||(a=ie.findByGuid(e.guid,i.context.scene)),a?(a&&a.isComponent===!0&&(Pr&&console.warn("Deserialized object reference is a component"),a=a.gameObject),Pr&&console.log("Deserialized object reference?",e,a,i?.nodeToObject)):((it()||Pr)&&console.warn("Could not resolve object reference",i.path,e,i.target,i.context.scene),e.could_not_resolve=!0),a}}}}const FQ=new Nge;class zge extends La{constructor(){super([Be,Be],"ComponentSerializer")}onSerialize(e,i){if(e!=null&&e.guid)return{guid:e.guid}}onDeserialize(e,i){var r;if(e!=null&&e.guid){if(e.___persistentAsset){Pr&&console.log("Skipping component deserialization because it's a persistent asset",e);return}const s=i.path;Pr&&console.log(e.guid,i.root,i.object,i.target);let o=this.findObjectForGuid(e.guid,i.root);if(o||i.context&&(o=this.findObjectForGuid(e.guid,(r=i.context)==null?void 0:r.scene),o))return o;(it()||Pr)&&console.warn('Could not resolve component reference: "'+s+'" using guid '+e.guid,i.target),e.could_not_resolve=!0;return}}findObjectForGuid(e,i){if(i.guid===e)return i;const r=ie.foreachComponent(i,s=>{if(s.guid===e)return s},!1);if(r!==void 0)return r;for(let s=0;s<i.children.length;s++){const o=i.children[s],a=this.findObjectForGuid(e,o);if(a)return a}}}const qC=new zge;class jge extends La{constructor(){super([An])}onSerialize(e,i){console.log("TODO: SERIALIZE EVENT")}onDeserialize(e,i){var r,s,o;if(typeof e=="function")return new An([new mc(e,null,[],!0)]);if(e&&e.type==="EventList"){Pr&&console.log("DESERIALIZE EVENT",e);const a=new Array;if(e.calls&&Array.isArray(e.calls))for(const h of e.calls){let u=function(m){if(typeof m=="object"){let g=FQ.onDeserialize(m,i);if(g||(g=qC.onDeserialize(m,i)),g)return g}return m};Pr&&console.log(h);let d=qC.findObjectForGuid(h.target,i.root);!d&&(r=i.context)!=null&&r.scene&&(d=qC.findObjectForGuid(h.target,(s=i.context)==null?void 0:s.scene));const f=((o=h.method)==null?void 0:o.length)>0;if(d&&f){const m=()=>{const g=h.method[0].toUpperCase()+h.method.slice(1);if(typeof d[g]=="function"){console.warn(`EventList method:
Could not find method ${h.method} on object ${d.name}. Please rename ${h.method} to ${g}?
`,d[g],`
 in script: `,d),Pi("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${h.method} on object ${d.name}`,d,typeof d[h.method])};if(typeof d[h.method]!="function"){let g=!1,v=d;for(;v;){const y=Object.getOwnPropertyDescriptor(v,h.method);if(y&&(y.writable===!0||y.set)){g=!0;break}v=Object.getPrototypeOf(v)}!g&&(it()||Pr)&&m()}}if(d){let m=h.argument;if(m!==void 0?m=u(m):h.arguments!==void 0&&(m=h.arguments.map(u)),!d[h.method])console.warn(`EventList method not found: "${h.method}" on ${d?.name}`);else{Array.isArray(m)||(m=[m]);const g=new mc(d,h.method,m,h.enabled);a.push(g)}}else it()&&console.warn("[Debug] EventList: Could not find event listener in scene",h)}const l=new An(a);Pr&&console.log(l);const c=i.target;return c!==void 0&&i.path!==void 0&&l.setEventTarget(i.path,c),l}}}const Gge=new jge;class NQ extends La{constructor(){super([E0,qt])}onSerialize(e,i){}onDeserialize(e,i){if(e instanceof Gt&&i.type===E0){const r=e,s=new E0(r.image.width,r.image.height,{colorSpace:Ii});return s.texture=r,r.isRenderTargetTexture=!0,r.flipY=!0,r.offset.y=1,r.repeat.y=-1,r.needsUpdate=!0,r.mipmaps=[],r instanceof Ru&&(r.isCompressedTexture=!1,r.format=RGBAFormat),s}}}new NQ;class zQ extends La{constructor(){super([URL])}onSerialize(e,i){return null}onDeserialize(e,i){if(typeof e=="string"&&e.length>0)return Du(i.gltfId,e)}}new zQ;const jQ={type:"change"},YO={type:"start"},GQ={type:"end"},YC=new Js,HQ=new dr,Hge=Math.cos(70*pi.DEG2RAD);let VQ=class extends wr{constructor(n,e){super(),this.object=n,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new S,this.cursor=new S,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:pp.ROTATE,MIDDLE:pp.DOLLY,RIGHT:pp.PAN},this.touches={ONE:fp.ROTATE,TWO:fp.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(I){I.addEventListener("keydown",ht),this._domElementKeyEvents=I},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",ht),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(jQ),i.update(),s=r.NONE},this.update=function(){const I=new S,k=new Ce().setFromUnitVectors(n.up,new S(0,1,0)),G=k.clone().invert(),ee=new S,j=new Ce,Y=new S,W=2*Math.PI;return function(ae=null){const ce=i.object.getWorldPosition(n.position);I.copy(ce).sub(i.target),I.applyQuaternion(k),a.setFromVector3(I),i.autoRotate&&s===r.NONE&&O(E(ae)),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let xe=i.minAzimuthAngle,Re=i.maxAzimuthAngle;isFinite(xe)&&isFinite(Re)&&(xe<-Math.PI?xe+=W:xe>Math.PI&&(xe-=W),Re<-Math.PI?Re+=W:Re>Math.PI&&(Re-=W),xe<=Re?a.theta=Math.max(xe,Math.min(Re,a.theta)):a.theta=a.theta>(xe+Re)/2?Math.max(xe,a.theta):Math.min(Re,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(u,i.dampingFactor):i.target.add(u),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let Je=!1;if(i.zoomToCursor&&T||i.object.isOrthographicCamera)a.radius=Z(a.radius);else{i.enableDamping?h=pi.lerp(h,c,i.dampingFactor):h=c,a.radius=Z(a.radius*h);const Xe=a.radius;a.radius=Z(a.radius*c),Je=Xe!=a.radius}if(I.setFromSpherical(a),I.applyQuaternion(G),ce.copy(i.target).add(I),i.object.parent?i.object.parent.worldToLocal(ce):i.object.position.copy(ce),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,u.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),u.set(0,0,0)),i.zoomToCursor&&T){let Xe=null;if(i.object.isPerspectiveCamera){const Ze=I.length();Xe=Z(Ze*c);const vt=Ze-Xe;i.object.position.addScaledVector(_,vt),i.object.updateMatrixWorld(),Je=!!vt}else if(i.object.isOrthographicCamera){const Ze=new S(w.x,w.y,0);Ze.unproject(i.object);const vt=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),i.object.updateProjectionMatrix(),Je=vt!==i.object.zoom;const ot=new S(w.x,w.y,0);ot.unproject(i.object),i.object.position.sub(ot).add(Ze),i.object.updateMatrixWorld(),Xe=I.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;Xe!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(Xe).add(i.object.position):(YC.origin.copy(i.object.position),YC.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(YC.direction))<Hge?n.lookAt(i.target):(HQ.setFromNormalAndCoplanarPoint(i.object.up,i.target),YC.intersectPlane(HQ,i.target))))}else if(i.object.isOrthographicCamera){const Xe=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),Xe!==i.object.zoom&&(i.object.updateProjectionMatrix(),Je=!0)}return c=1,T=!1,Je||ee.distanceToSquared(i.object.position)>o||8*(1-j.dot(i.object.quaternion))>o||Y.distanceToSquared(i.target)>o?(i.dispatchEvent(jQ),ee.copy(i.object.position),j.copy(i.object.quaternion),Y.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",St),i.domElement.removeEventListener("pointerdown",ct),i.domElement.removeEventListener("pointercancel",V),i.domElement.removeEventListener("wheel",Me),i.domElement.removeEventListener("pointermove",It),window.removeEventListener("pointerup",V),i.domElement.getRootNode().removeEventListener("keydown",Pe,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",ht),i._domElementKeyEvents=null)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const o=1e-6,a=new t2,l=new t2;let c=1,h=1;const u=new S,d=new J,f=new J,m=new J,g=new J,v=new J,y=new J,A=new J,b=new J,x=new J,_=new S,w=new J;let T=!1;const M=[],R={};let B=!1;function E(I){return I!==null?2*Math.PI/60*i.autoRotateSpeed*I:2*Math.PI/60/60*i.autoRotateSpeed}function P(I){const k=Math.abs(I*.01);return Math.pow(.95,i.zoomSpeed*k)}function O(I){l.theta-=I}function N(I){l.phi-=I}const L=function(){const I=new S;return function(k,G){I.setFromMatrixColumn(G,0),I.multiplyScalar(-k),u.add(I)}}(),Q=function(){const I=new S;return function(k,G){i.screenSpacePanning===!0?I.setFromMatrixColumn(G,1):(I.setFromMatrixColumn(G,0),I.crossVectors(i.object.up,I)),I.multiplyScalar(k),u.add(I)}}(),D=function(){const I=new S,k=new S;return function(G,ee){const j=i.domElement;if(i.object.isPerspectiveCamera){i.object.getWorldPosition(k),I.copy(k).sub(i.target);let Y=I.length();Y*=Math.tan(i.object.fov/2*Math.PI/180),L(2*G*Y/j.clientHeight,i.object.matrixWorld),Q(2*ee*Y/j.clientHeight,i.object.matrixWorld)}else i.object.isOrthographicCamera?(L(G*(i.object.right-i.object.left)/i.object.zoom/j.clientWidth,i.object.matrixWorld),Q(ee*(i.object.top-i.object.bottom)/i.object.zoom/j.clientHeight,i.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function F(I){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c/=I:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function H(I){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c*=I:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function K(I,k){if(!i.zoomToCursor)return;T=!0;const G=i.domElement.getBoundingClientRect(),ee=I-G.left,j=k-G.top,Y=G.width,W=G.height;w.x=ee/Y*2-1,w.y=-(j/W)*2+1,_.set(w.x,w.y,1).unproject(i.object).sub(i.object.position).normalize()}function Z(I){return Math.max(i.minDistance,Math.min(i.maxDistance,I))}function oe(I){d.set(I.clientX,I.clientY)}function we(I){K(I.clientX,I.clientX),A.set(I.clientX,I.clientY)}function Oe(I){g.set(I.clientX,I.clientY)}function se(I){f.set(I.clientX,I.clientY),m.subVectors(f,d).multiplyScalar(i.rotateSpeed);const k=i.domElement;O(2*Math.PI*m.x/k.clientHeight),N(2*Math.PI*m.y/k.clientHeight),d.copy(f),i.update()}function _e(I){b.set(I.clientX,I.clientY),x.subVectors(b,A),x.y>0?F(P(x.y)):x.y<0&&H(P(x.y)),A.copy(b),i.update()}function Ee(I){v.set(I.clientX,I.clientY),y.subVectors(v,g).multiplyScalar(i.panSpeed),D(y.x,y.y),g.copy(v),i.update()}function et(I){K(I.clientX,I.clientY),I.deltaY<0?H(P(I.deltaY)):I.deltaY>0&&F(P(I.deltaY)),i.update()}function We(I){let k=!1;switch(I.code){case i.keys.UP:I.ctrlKey||I.metaKey||I.shiftKey?N(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):D(0,i.keyPanSpeed),k=!0;break;case i.keys.BOTTOM:I.ctrlKey||I.metaKey||I.shiftKey?N(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):D(0,-i.keyPanSpeed),k=!0;break;case i.keys.LEFT:I.ctrlKey||I.metaKey||I.shiftKey?O(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):D(i.keyPanSpeed,0),k=!0;break;case i.keys.RIGHT:I.ctrlKey||I.metaKey||I.shiftKey?O(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):D(-i.keyPanSpeed,0),k=!0;break}k&&(I.preventDefault(),i.update())}function Ue(I){if(M.length===1)d.set(I.pageX,I.pageY);else{const k=ut(I),G=.5*(I.pageX+k.x),ee=.5*(I.pageY+k.y);d.set(G,ee)}}function st(I){if(M.length===1)g.set(I.pageX,I.pageY);else{const k=ut(I),G=.5*(I.pageX+k.x),ee=.5*(I.pageY+k.y);g.set(G,ee)}}function ge(I){const k=ut(I),G=I.pageX-k.x,ee=I.pageY-k.y,j=Math.sqrt(G*G+ee*ee);A.set(0,j)}function X(I){i.enableZoom&&ge(I),i.enablePan&&st(I)}function ze(I){i.enableZoom&&ge(I),i.enableRotate&&Ue(I)}function Ie(I){if(M.length==1)f.set(I.pageX,I.pageY);else{const G=ut(I),ee=.5*(I.pageX+G.x),j=.5*(I.pageY+G.y);f.set(ee,j)}m.subVectors(f,d).multiplyScalar(i.rotateSpeed);const k=i.domElement;O(2*Math.PI*m.x/k.clientHeight),N(2*Math.PI*m.y/k.clientHeight),d.copy(f)}function Te(I){if(M.length===1)v.set(I.pageX,I.pageY);else{const k=ut(I),G=.5*(I.pageX+k.x),ee=.5*(I.pageY+k.y);v.set(G,ee)}y.subVectors(v,g).multiplyScalar(i.panSpeed),D(y.x,y.y),g.copy(v)}function Ve(I){const k=ut(I),G=I.pageX-k.x,ee=I.pageY-k.y,j=Math.sqrt(G*G+ee*ee);b.set(0,j),x.set(0,Math.pow(b.y/A.y,i.zoomSpeed)),F(x.y),A.copy(b);const Y=(I.pageX+k.x)*.5,W=(I.pageY+k.y)*.5;K(Y,W)}function Ae(I){i.enableZoom&&Ve(I),i.enablePan&&Te(I)}function nt(I){i.enableZoom&&Ve(I),i.enableRotate&&Ie(I)}function ct(I){i.enabled!==!1&&(M.length===0&&(i.domElement.setPointerCapture(I.pointerId),i.domElement.addEventListener("pointermove",It),window.addEventListener("pointerup",V)),!Le(I)&&(Fe(I),I.pointerType==="touch"?je(I):U(I)))}function It(I){i.enabled!==!1&&(I.pointerType==="touch"?He(I):ue(I))}function V(I){switch(Kt(I),M.length){case 0:i.domElement.releasePointerCapture(I.pointerId),i.domElement.removeEventListener("pointermove",It),i.domElement.removeEventListener("pointerup",V),i.dispatchEvent(GQ),s=r.NONE;break;case 1:const k=M[0],G=R[k];je({pointerId:k,pageX:G.x,pageY:G.y});break}}function U(I){let k;switch(I.button){case 0:k=i.mouseButtons.LEFT;break;case 1:k=i.mouseButtons.MIDDLE;break;case 2:k=i.mouseButtons.RIGHT;break;default:k=-1}switch(k){case pp.DOLLY:if(i.enableZoom===!1)return;we(I),s=r.DOLLY;break;case pp.ROTATE:if(I.ctrlKey||I.metaKey||I.shiftKey){if(i.enablePan===!1)return;Oe(I),s=r.PAN}else{if(i.enableRotate===!1)return;oe(I),s=r.ROTATE}break;case pp.PAN:if(I.ctrlKey||I.metaKey||I.shiftKey){if(i.enableRotate===!1)return;oe(I),s=r.ROTATE}else{if(i.enablePan===!1)return;Oe(I),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(YO)}function ue(I){switch(s){case r.ROTATE:if(i.enableRotate===!1)return;se(I);break;case r.DOLLY:if(i.enableZoom===!1)return;_e(I);break;case r.PAN:if(i.enablePan===!1)return;Ee(I);break}}function Me(I){i.enabled===!1||i.enableZoom===!1||s!==r.NONE||(I.preventDefault(),i.dispatchEvent(YO),et(De(I)),i.dispatchEvent(GQ))}function De(I){const k=I.deltaMode,G={clientX:I.clientX,clientY:I.clientY,deltaY:I.deltaY};switch(k){case 1:G.deltaY*=16;break;case 2:G.deltaY*=100;break}return I.ctrlKey&&!B&&(G.deltaY*=10),G}function Pe(I){I.key==="Control"&&(B=!0,i.domElement.getRootNode().addEventListener("keyup",At,{passive:!0,capture:!0}))}function At(I){I.key==="Control"&&(B=!1,i.domElement.getRootNode().removeEventListener("keyup",At,{passive:!0,capture:!0}))}function ht(I){i.enabled===!1||i.enablePan===!1||We(I)}function je(I){switch(_t(I),M.length){case 1:switch(i.touches.ONE){case fp.ROTATE:if(i.enableRotate===!1)return;Ue(I),s=r.TOUCH_ROTATE;break;case fp.PAN:if(i.enablePan===!1)return;st(I),s=r.TOUCH_PAN;break;default:s=r.NONE}break;case 2:switch(i.touches.TWO){case fp.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;X(I),s=r.TOUCH_DOLLY_PAN;break;case fp.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;ze(I),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(YO)}function He(I){switch(_t(I),s){case r.TOUCH_ROTATE:if(i.enableRotate===!1)return;Ie(I),i.update();break;case r.TOUCH_PAN:if(i.enablePan===!1)return;Te(I),i.update();break;case r.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Ae(I),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;nt(I),i.update();break;default:s=r.NONE}}function St(I){i.enabled!==!1&&I.preventDefault()}function Fe(I){M.push(I.pointerId)}function Kt(I){delete R[I.pointerId];for(let k=0;k<M.length;k++)if(M[k]==I.pointerId){M.splice(k,1);return}}function Le(I){for(let k=0;k<M.length;k++)if(M[k]==I.pointerId)return!0;return!1}function _t(I){let k=R[I.pointerId];k===void 0&&(k=new J,R[I.pointerId]=k),k.set(I.pageX,I.pageY)}function ut(I){const k=I.pointerId===M[0]?M[1]:M[0];return R[k]}i.domElement.addEventListener("contextmenu",St),i.domElement.addEventListener("pointerdown",ct),i.domElement.addEventListener("pointercancel",V),i.domElement.addEventListener("wheel",Me,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",Pe,{passive:!0,capture:!0}),this.update()}};var Vge=Object.defineProperty,Qge=Object.getOwnPropertyDescriptor,gb=(n,e,i,r)=>{for(var s=r>1?void 0:r?Qge(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Vge(e,i,s),s};const QQ=te("debuggroundprojection");class Uh extends Be{constructor(){super(...arguments),p(this,"applyOnAwake",!1),p(this,"autoFit",!0),p(this,"_radius",50),p(this,"_height",3),p(this,"_arblending",0),p(this,"_lastEnvironment"),p(this,"_lastRadius"),p(this,"_lastHeight"),p(this,"_projection"),p(this,"_watcher"),p(this,"_needsTextureUpdate",!1),p(this,"_blurrynessShader",null),p(this,"_lastBlurriness",-1)}set radius(e){this._radius=e,this.updateProjection()}get radius(){return this._radius}set height(e){this._height=e,this.updateProjection()}get height(){return this._height}set arBlending(e){this._arblending=e,this._needsTextureUpdate=!0}get arBlending(){return this._arblending}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new cu(this.context.scene,"environment"),this._watcher.subscribeWrite(e=>{this.updateProjection()}))}onDisable(){var e,i;(e=this._watcher)==null||e.revoke(),(i=this._projection)==null||i.removeFromParent()}onEnterXR(){this.activeAndEnabled&&(this._needsTextureUpdate=!0,this.updateProjection())}async onLeaveXR(){this.activeAndEnabled&&(await r1(1),this.updateProjection())}onBeforeRender(){this._projection&&this.scene.backgroundRotation&&this._projection.rotation.copy(this.scene.backgroundRotation),this.context.scene.backgroundBlurriness!==void 0&&this._lastBlurriness!=this.context.scene.backgroundBlurriness&&this.context.scene.backgroundBlurriness>.001?this.updateProjection():this._needsTextureUpdate&&this.updateBlurriness()}updateAndCreate(){var e;this.updateProjection(),(e=this._watcher)==null||e.apply()}updateProjection(){var e,i,r,s,o;if(!this.context.scene.environment){(e=this._projection)==null||e.removeFromParent();return}if(((i=this.context.xr)!=null&&i.isPassThrough||(r=this.context.xr)!=null&&r.isAR)&&this.arBlending===0){(s=this._projection)==null||s.removeFromParent();return}const a=0;if((!this._projection||this.context.scene.environment!==this._lastEnvironment||this._height!==this._lastHeight||this._radius!==this._lastRadius)&&(QQ&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),(o=this._projection)==null||o.removeFromParent(),this._projection=new Ag(this.context.scene.environment,this._height,this.radius,64),this._projection.position.y=this._height-a,this._projection.name="GroundProjection",cP(this._projection,!1)),this._lastEnvironment=this.context.scene.environment,this._lastHeight=this._height,this._lastRadius=this._radius,this._projection.parent||this.gameObject.add(this._projection),this.autoFit){this._projection.updateWorldMatrix(!0,!0);const l=pl(this.context.scene.children,[this._projection]),c=l.min.y;if(c<1/0){const h=kt(this._projection);h.x=l.min.x+(l.max.x-l.min.x)*.5,h.y=c+this._height-a,h.z=l.min.z+(l.max.z-l.min.z)*.5,gr(this._projection,h)}}(this.context.scene.backgroundBlurriness>.001||this._needsTextureUpdate)&&this.updateBlurriness(),this._needsTextureUpdate=!1}updateBlurriness(){var e;if(this._projection){if(!this.context.scene.environment)return}else return;this._needsTextureUpdate=!1,QQ&&console.log("Update Blurriness",this.context.scene.backgroundBlurriness),this._blurrynessShader??(this._blurrynessShader=new Bt({name:"GroundProjectionBlurriness",uniforms:{map:{value:this.context.scene.environment},blurriness:{value:this.context.scene.backgroundBlurriness},blending:{value:0},alphaFactor:{value:1}},vertexShader:Wge,fragmentShader:Xge})),this._blurrynessShader.depthWrite=!1,this._blurrynessShader.uniforms.blurriness.value=this.context.scene.backgroundBlurriness,this._lastBlurriness=this.context.scene.backgroundBlurriness,this.context.scene.environment.needsPMREMUpdate=!0;const i=this._projection.material.transparent;this._projection.material.transparent=(((e=this.context.xr)==null?void 0:e.isAR)===!0&&this.arBlending>1e-6)??!1,this._projection.material.transparent?this._blurrynessShader.uniforms.blending.value=this.arBlending:this._blurrynessShader.uniforms.blending.value=0,this.context.isInPassThrough?this._blurrynessShader.uniforms.alphaFactor.value=.95:this._blurrynessShader.uniforms.alphaFactor.value=1,i!==this._projection.material.transparent&&(this._projection.material.needsUpdate=!0),this._projection.material.map=Ea.copyTexture(this.context.scene.environment,this._blurrynessShader),this._projection.material.depthTest=!0,this._projection.material.depthWrite=!1}}gb([C()],Uh.prototype,"applyOnAwake",2),gb([C()],Uh.prototype,"autoFit",2),gb([C()],Uh.prototype,"radius",1),gb([C()],Uh.prototype,"height",1),gb([C()],Uh.prototype,"arBlending",1);const Wge=`
  varying vec2 vUv;

  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,Xge=`
  uniform sampler2D map;
  uniform float blurriness;
  uniform float alphaFactor;
  uniform float blending;
  varying vec2 vUv;

  const float PI = 3.14159265359;

  // Gaussian function
  float gaussian(float x, float sigma) {
    return exp(-(x * x) / (2.0 * sigma * sigma)) / (sqrt(2.0 * PI) * sigma);
  }

  // Custom smoothstep function for desired falloff
  float customSmoothstep(float edge0, float edge1, float x) {
    float t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return t * t * (3.0 - 2.0 * t);
  }

  void main() {
    vec2 center = vec2(0.0, 0.0);
    vec2 pos = vUv;
    pos.x = 0.0; // Only consider vertical distance
    float distance = length(pos - center);
    
    // Calculate blur amount based on custom falloff
    float blurAmount = customSmoothstep(0.5, 1.0, distance * 2.0);
    blurAmount = clamp(blurAmount, 0.0, 1.0); // Ensure blur amount is within valid range

    // Gaussian blur
    vec2 pixelSize = 1.0 / vec2(textureSize(map, 0));
    vec4 color = vec4(0.0);
    float totalWeight = 0.0;
    int blurSize = int(60.0 * min(1.0, blurriness) * blurAmount); // Adjust blur size based on distance and blurriness
    float lodLevel = log2(float(blurSize)) * 0.5; // Compute LOD level

    for (int x = -blurSize; x <= blurSize; x++) {
        for (int y = -blurSize; y <= blurSize; y++) {
            vec2 offset = vec2(float(x), float(y)) * pixelSize * blurAmount;
            float weight = gaussian(length(vec2(float(x), float(y))), 1000.0 * blurAmount); // Use a fixed sigma value
            color += textureLod(map, vUv + offset, lodLevel) * weight;
            totalWeight += weight;
        }
    }

    color = totalWeight > 0.0 ? color / totalWeight : texture2D(map, vUv);

    gl_FragColor = color;

    float brightness = dot(gl_FragColor.rgb, vec3(0.299, 0.587, 0.114));
    float stepFactor = blending - brightness * .1;
    gl_FragColor.a = pow(1.0 - blending * customSmoothstep(0.35 * stepFactor, 0.45 * stepFactor, distance), 5.);
    gl_FragColor.a *= alphaFactor;
    // gl_FragColor.rgb = vec3(1.0);

    // #include <tonemapping_fragment>
    // #include <colorspace_fragment>
    
    // Uncomment to visualize blur amount
    // gl_FragColor = vec4(blurAmount, 0.0, 0.0, 1.0);
  }
`;var qge=Object.defineProperty,Yge=Object.getOwnPropertyDescriptor,JO=(n,e,i,r)=>{for(var s=r>1?void 0:r?Yge(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&qge(e,i,s),s};class Lf extends Be{constructor(){super(...arguments),p(this,"constraintActive",!0),p(this,"locked",!1),p(this,"sources",[])}}JO([C()],Lf.prototype,"constraintActive",2),JO([C()],Lf.prototype,"locked",2),JO([C(ve)],Lf.prototype,"sources",2);function Jge(n,e){return nd(n,Si.ContextCreated,e),()=>rd(n,Si.ContextCreated)}function Kge(n,e){return nd(n,Si.ContextClearing,e),()=>rd(n,Si.ContextClearing)}function Zge(n,e){return nd(n,Si.ContextDestroying,e),()=>rd(n,Si.ContextDestroying)}function KO(n,e){return nd(n,Xi.Start,e),()=>rd(n,Xi.Start)}function ZO(n,e){return nd(n,Xi.Update,e),()=>rd(n,Xi.Update)}function WQ(n,e){return nd(n,Xi.OnBeforeRender,e),()=>rd(n,Xi.OnBeforeRender)}function $ge(n,e){return nd(n,Xi.OnAfterRender,e),()=>rd(n,Xi.OnAfterRender)}class Uf{constructor(){p(this,"bb",null),p(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(e,i,r,s){return e.prep(4,12),e.writeFloat32(s),e.writeFloat32(r),e.writeFloat32(i),e.offset()}}class XQ{constructor(){p(this,"bb",null),p(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}position(e){return(e||new Uf).__init(this.bb_pos,this.bb)}rotation(e){return(e||new Uf).__init(this.bb_pos+12,this.bb)}scale(e){return(e||new Uf).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(e,i,r,s,o,a,l,c,h,u){return e.prep(4,36),e.prep(4,12),e.writeFloat32(u),e.writeFloat32(h),e.writeFloat32(c),e.prep(4,12),e.writeFloat32(l),e.writeFloat32(a),e.writeFloat32(o),e.prep(4,12),e.writeFloat32(s),e.writeFloat32(r),e.writeFloat32(i),e.offset()}}class pu{constructor(){p(this,"bb",null),p(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}static getRootAsSyncedTransformModel(e,i){return(i||new pu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedTransformModel(e,i){return e.setPosition(e.position()+jB),(i||new pu).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__string(this.bb_pos+i,e):null}fast(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}transform(e){const i=this.bb.__offset(this.bb_pos,8);return i?(e||new XQ).__init(this.bb_pos+i,this.bb):null}dontSave(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startSyncedTransformModel(e){e.startObject(4)}static addGuid(e,i){e.addFieldOffset(0,i,0)}static addFast(e,i){e.addFieldInt8(1,+i,0)}static addTransform(e,i){e.addFieldStruct(2,i,0)}static addDontSave(e,i){e.addFieldInt8(3,+i,0)}static endSyncedTransformModel(e){return e.endObject()}static finishSyncedTransformModelBuffer(e,i){e.finish(i)}static finishSizePrefixedSyncedTransformModelBuffer(e,i){e.finish(i,void 0,!0)}}var Dr=(n=>(n[n.Average=0]="Average",n[n.Multiply=1]="Multiply",n[n.Minimum=2]="Minimum",n[n.Maximum=3]="Maximum",n))(Dr||{}),JC=(n=>(n[n.Discrete=0]="Discrete",n[n.Continuous=1]="Continuous",n))(JC||{}),Hn=(n=>(n[n.None=0]="None",n[n.FreezePositionX=2]="FreezePositionX",n[n.FreezePositionY=4]="FreezePositionY",n[n.FreezePositionZ=8]="FreezePositionZ",n[n.FreezePosition=14]="FreezePosition",n[n.FreezeRotationX=16]="FreezeRotationX",n[n.FreezeRotationY=32]="FreezeRotationY",n[n.FreezeRotationZ=64]="FreezeRotationZ",n[n.FreezeRotation=112]="FreezeRotation",n[n.FreezeAll=126]="FreezeAll",n))(Hn||{}),M0=(n=>(n[n.None=0]="None",n[n.X=2]="X",n[n.Y=4]="Y",n[n.Z=8]="Z",n[n.All=-1]="All",n))(M0||{});const ns=function(n,e){return function(i,r,s){e0e(i,r,s,n,e)}};function e0e(n,e,i,r,s){if(!s&&!r&&!n.onValidate)return;if(i!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",n,e,i),dn("Invalid usage of validate decorator. Only fields can be validated. Property: "+e,Wo.Error);return}let o="";if(typeof e=="string"?o=e:o=e.name,n.__internalAwake){const a=Symbol(o),l=n.__internalAwake;n.__internalAwake=function(){var c;if(!this.onValidate){it()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((c=n.constructor)==null?void 0:c.name)+'"');return}if(this[a]===void 0){this[a]=this[o];const h=this[o];if(h instanceof J||h instanceof S||h instanceof qe||h instanceof Ce){const u=this[o];o1(u,()=>{this.onValidate(o)})}Object.defineProperty(this,o,{set:function(u){var d;if(this[jk]===!0)this[a]=u;else{r?.call(this,u);const f=this[a];this[a]=u,(d=this.onValidate)==null||d.call(this,o,f)}},get:function(){return s?.call(this),this[a]}})}l.call(this)}}}const t0e=function(n){return function(e,i,r){let s="";typeof i=="string"?s=i:s=i.name;const o=n.prototype,a=Object.getOwnPropertyDescriptor(o,s);if(!(a!=null&&a.value)){console.warn("Can not apply prefix: type does not have method named",i,n);return}const l=a.value,c=e[s];Object.defineProperty(o,s,{value:function(...h){const u=c?.call(this,...h);if(u instanceof Promise){u.then(d=>{if(d!==!1)return l.call(this,...h)});return}if(u!==!1)return l.call(this,...h)}})}};var i0e=Object.defineProperty,n0e=Object.getOwnPropertyDescriptor,ea=(n,e,i,r)=>{for(var s=r>1?void 0:r?n0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&i0e(e,i,s),s};class r0e{constructor(e,i){p(this,"positionChanged",!1),p(this,"rotationChanged",!1),p(this,"position"),p(this,"quaternion"),p(this,"_positionKeys",["x","y","z"]),p(this,"_quaternionKeys",["_x","_y","_z","_w"]),p(this,"mute",!1),p(this,"context"),p(this,"obj"),p(this,"_positionWatch"),p(this,"_rotationWatch"),this.context=i,this.obj=e}get isDirty(){return this.positionChanged||this.rotationChanged}reset(e=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,e){if(this.position)for(const i of this._positionKeys)delete this.position[i];if(this.quaternion)for(const i of this._quaternionKeys)delete this.quaternion[i]}}syncValues(){for(const e of this._positionKeys)this.position[e]=this.obj.position[e];for(const e of this._quaternionKeys)this.quaternion[e]=this.obj.quaternion[e]}applyValues(){if(this.positionChanged&&this.position)for(const e of this._positionKeys){const i=this.position[e];i!==void 0&&(this.obj.position[e]=i)}if(this.rotationChanged&&this.quaternion)for(const e of this._quaternionKeys){const i=this.quaternion[e];i!==void 0&&(this.obj.quaternion[e]=i)}}start(e,i){this.reset(),e&&(this._positionWatch||(this._positionWatch=new cu(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((o,a)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const c=this.position[a];Math.abs(c-o)<1e-5||(this.position[a]=o,this.positionChanged=!0)})),i&&(this._rotationWatch||(this._rotationWatch=new cu(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((o,a)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const c=this.quaternion[a];Math.abs(c-o)<1e-5||(this.quaternion[a]=o,this.rotationChanged=!0)}));const r=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),s=new he;this.obj.matrixWorld.multiplyMatrices=(o,a)=>{var l;return(l=this.context.physics.engine)!=null&&l.isUpdating||this.mute||s.equals(o)||(this.positionChanged=!0,this.rotationChanged=!0,s.copy(o)),r(o,a)}}stop(){var e,i;(e=this._positionWatch)==null||e.revoke(),(i=this._rotationWatch)==null||i.revoke()}}var $O;const eD=($O=class extends Be{constructor(){super(...arguments),p(this,"autoMass",!0),p(this,"_mass",0),p(this,"useGravity",!0),p(this,"centerOfMass",new S(0,0,0)),p(this,"constraints",Hn.None),p(this,"isKinematic",!1),p(this,"drag",0),p(this,"angularDrag",1),p(this,"detectCollisions",!0),p(this,"sleepThreshold",.01),p(this,"collisionDetectionMode",JC.Discrete),p(this,"_gravityScale",1),p(this,"dominanceGroup",0),p(this,"_propertiesChanged",!1),p(this,"_currentVelocity",new S),p(this,"_smoothedVelocity",new S),p(this,"_smoothedVelocityGetter",new S),p(this,"_lastPosition",new S),p(this,"_watch")}set mass(n){n!==this._mass&&(this._mass=n,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var n,e;return this.autoMass?((e=(n=this.context.physics.engine)==null?void 0:n.getBody(this))==null?void 0:e.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&Hn.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&Hn.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&Hn.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&Hn.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&Hn.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&Hn.FreezeRotationZ)!==0}set lockPositionX(n){n?this.constraints|=Hn.FreezePositionX:this.constraints&=~Hn.FreezePositionX}set lockPositionY(n){n?this.constraints|=Hn.FreezePositionY:this.constraints&=~Hn.FreezePositionY}set lockPositionZ(n){n?this.constraints|=Hn.FreezePositionZ:this.constraints&=~Hn.FreezePositionZ}set lockRotationX(n){n?this.constraints|=Hn.FreezeRotationX:this.constraints&=~Hn.FreezeRotationX}set lockRotationY(n){n?this.constraints|=Hn.FreezeRotationY:this.constraints&=~Hn.FreezeRotationY}set lockRotationZ(n){n?this.constraints|=Hn.FreezeRotationZ:this.constraints&=~Hn.FreezeRotationZ}set gravityScale(n){this._gravityScale=n}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){this._watch||(this._watch=new r0e(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),Xi.LateUpdate)}onDisable(){var n,e;(n=this._watch)==null||n.stop(),(e=this.context.physics.engine)==null||e.removeBody(this)}onDestroy(){var n;(n=this.context.physics.engine)==null||n.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){for(var n,e,i,r;;)this._propertiesChanged&&(this._propertiesChanged=!1,(n=this.context.physics.engine)==null||n.updateProperties(this)),(e=this._watch)!=null&&e.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(i=this.context.physics.engine)==null||i.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(r=this._watch)==null||r.syncValues(),this.captureVelocity(),yield}teleport(n,e=!0){var i;(i=this._watch)==null||i.reset(!0),e?this.gameObject.position.set(n.x,n.y,n.z):this.setWorldPosition(n.x,n.y,n.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(n=!0){var e;(e=this.context.physics.engine)==null||e.resetForces(this,n)}resetTorques(n=!0){var e;(e=this.context.physics.engine)==null||e.resetTorques(this,n)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var n;(n=this.context.physics.engine)==null||n.wakeup(this)}get isSleeping(){var n;return(n=this.context.physics.engine)==null?void 0:n.isSleeping(this)}updateProperties(){var n;return this._propertiesChanged=!1,(n=this.context.physics.engine)==null?void 0:n.updateProperties(this)}applyForce(n,e,i=!0){var r;this._propertiesChanged&&this.updateProperties(),(r=this.context.physics.engine)==null||r.addForce(this,n,i)}applyImpulse(n,e=!0){var i;this._propertiesChanged&&this.updateProperties(),(i=this.context.physics.engine)==null||i.applyImpulse(this,n,e)}setForce(n,e,i,r=!0){var s,o,a;(s=this.context.physics.engine)==null||s.resetForces(this,r),typeof n=="number"?(e??(e=0),i??(i=0),(o=this.context.physics.engine)==null||o.addForce(this,{x:n,y:e,z:i},r)):(a=this.context.physics.engine)==null||a.addForce(this,n,r)}getVelocity(){var n;const e=(n=this.context.physics.engine)==null?void 0:n.getLinearVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(n,e,i,r=!0){var s,o;if(n instanceof S){const a=n;(s=this.context.physics.engine)==null||s.setLinearVelocity(this,a,r);return}e===void 0||i===void 0||(o=this.context.physics.engine)==null||o.setLinearVelocity(this,{x:n,y:e,z:i},r)}getAngularVelocity(){var n;const e=(n=this.context.physics.engine)==null?void 0:n.getAngularVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setAngularVelocity(n,e,i,r=!0){var s,o;if(n instanceof S){const a=n;(s=this.context.physics.engine)==null||s.setAngularVelocity(this,a,r);return}e===void 0||i===void 0||(o=this.context.physics.engine)==null||o.setAngularVelocity(this,{x:n,y:e,z:i},r)}setTorque(n,e,i){this.setAngularVelocity(n,e,i)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(n=null){}captureVelocity(){const n=kt(this.gameObject);this.gameObject.matrixWorld.decompose(eD.tempPosition,s0e,o0e);const e=n.sub(this._lastPosition);this._lastPosition.copy(eD.tempPosition),this._smoothedVelocity.lerp(e,this.context.time.deltaTime/.1)}},p($O,"tempPosition",new S),$O);let Oi=eD;ea([ns()],Oi.prototype,"autoMass",2),ea([C()],Oi.prototype,"mass",1),ea([ns(),C()],Oi.prototype,"useGravity",2),ea([C(S)],Oi.prototype,"centerOfMass",2),ea([ns(),C()],Oi.prototype,"constraints",2),ea([ns(),C()],Oi.prototype,"isKinematic",2),ea([ns(),C()],Oi.prototype,"drag",2),ea([ns(),C()],Oi.prototype,"angularDrag",2),ea([ns(),C()],Oi.prototype,"detectCollisions",2),ea([ns(),C()],Oi.prototype,"sleepThreshold",2),ea([ns(),C()],Oi.prototype,"collisionDetectionMode",2),ea([ns()],Oi.prototype,"_gravityScale",2),ea([ns()],Oi.prototype,"dominanceGroup",2),new S;const s0e=new Ce,o0e=new S,wd=te("debugsync"),vb="STRS";VB(vb,pu.getRootAsSyncedTransformModel);const gc=new u_;function qQ(n,e,i=!0){gc.clear();const r=gc.createString(n);pu.startSyncedTransformModel(gc),pu.addGuid(gc,r),pu.addFast(gc,i);const s=e.worldPosition,o=e.worldEuler,a=e.gameObject.scale;pu.addTransform(gc,XQ.createTransform(gc,s.x,s.y,s.z,o.x,o.y,o.z,a.x,a.y,a.z));const l=pu.endSyncedTransformModel(gc);return gc.finish(l,vb),gc.asUint8Array()}let tD=0,yb=0;ZO(n=>{var e;const i=(e=n.connection.currentServerUrl)!=null&&e.includes("glitch")?10:40;yb=Math.floor(tD/i),tD=0,wd&&yb>0&&console.log("Sync Transform Fast Interval",yb)});class vc extends Be{constructor(){super(...arguments),p(this,"overridePhysics",!0),p(this,"interpolatePosition",!0),p(this,"interpolateRotation",!0),p(this,"fastMode",!1),p(this,"syncDestroy",!1),p(this,"_model",null),p(this,"_needsUpdate",!0),p(this,"rb",null),p(this,"_wasKinematic",!1),p(this,"_receivedDataBefore",!1),p(this,"_targetPosition"),p(this,"_targetRotation"),p(this,"_receivedFastUpdate",!1),p(this,"_shouldRequestOwnership",!1),p(this,"joinedRoomCallback",null),p(this,"receivedDataCallback",null),p(this,"tempEuler",new ri),p(this,"receivedUpdate",!1),p(this,"lastWorldPos"),p(this,"lastWorldRotation")}requestOwnership(){wd&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var e;return((e=this._model)==null?void 0:e.hasOwnership)??void 0}isOwned(){var e;return(e=this._model)==null?void 0:e.isOwned}awake(){wd&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new S,this._targetRotation=new Ce,this.lastWorldPos=new S,this.lastWorldRotation=new Ce,this.rb=ie.getComponentInChildren(this.gameObject,Oi),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new ck(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(jt.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(vb,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&Bk(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(jt.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(vb,this.receivedDataCallback)}tryGetLastState(){const e=this.context.connection.tryGetState(this.guid);e&&this.onReceivedData(e)}onReceivedData(e){var i;if(!this.destroyed&&typeof e.guid=="function"&&e.guid()===this.guid){wd&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,e),this.receivedUpdate=!0,this._receivedFastUpdate=e.fast();const r=e.transform();if(r){rl.markDirty(this.gameObject,!0);const s=r.position();s&&(this.interpolatePosition&&((i=this._targetPosition)==null||i.set(s.x(),s.y(),s.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(s.x(),s.y(),s.z()));const o=r.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&aP(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){wd&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const e=this.worldPosition,i=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const o=e.distanceTo(this.lastWorldPos),a=i.angleTo(this.lastWorldRotation),l=this._model.hasOwnership||this.fastMode?1e-4:.001;(o>l||a>l)&&(this._model.hasOwnership?this._needsUpdate=!0:(wd&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,e.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,i.copy(this.lastWorldRotation),rl.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const o=this._receivedFastUpdate||this.fastMode?.5:.3;let a=!1;if(this.interpolatePosition&&this._targetPosition){const l=this.worldPosition;l.lerp(this._targetPosition,o),this.worldPosition=l,a=!0}if(this.interpolateRotation&&this._targetRotation){const l=this.worldQuaternion;l.slerp(this._targetRotation,o),this.worldQuaternion=l,a=!0}a&&rl.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(e),this.lastWorldRotation.copy(i),!this._model||!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership)return;this.rb&&this.overridePhysics&&this._wasKinematic!==void 0&&(wd&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic);const r=10,s=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%r===0||s)){if(tD++,s&&yb>0&&this.context.time.frameCount%yb!==0)return;wd&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this._needsUpdate=!1;const o=qQ(this.guid,this,!!s);this.context.connection.sendBinary(o)}}}const a0e=te("debugshadowcomponents");q2.prototype.interactable={get(){return this.interactive},set(n){this.interactable=n}};const Ga=Symbol("shadowDomOwner");class nl extends Be{constructor(){super(...arguments),p(this,"_shadowComponent",null),p(this,"_controlsChildLayout",!0),p(this,"_root"),p(this,"_parentComponent")}isRoot(){var e;return((e=this.Root)==null?void 0:e.gameObject)===this.gameObject}get canvas(){const e=this.Root;return e!=null&&e.isCanvas?e:null}get Canvas(){return this.canvas}markDirty(){Ha.markUIDirty(this.context)}get shadowComponent(){return this._shadowComponent}set shadowComponent(e){this._shadowComponent=e}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(e){this._controlsChildLayout=e,this.shadowComponent&&(this.shadowComponent.autoLayout=e)}get Root(){return this._root===void 0&&(this._root=ie.getComponentInParent(this.gameObject,Ab)),this._root}__internalNewInstanceCreated(e){return super.__internalNewInstanceCreated(e),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0,this}onEnable(){super.onEnable()}addShadowComponent(e,i){var r;if(!e)return;this.removeShadowComponent();const s=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=ie.getComponentInParent(s,nl),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}e.name=this.name+" ("+(this.constructor.name??"UI")+")",e.autoLayout=this._parentComponent.controlsChildLayout,e[Ga]=this,this.setShadowComponentOwner(e);let o=!1;if(((r=this.Root)==null?void 0:r.gameObject)===this.gameObject)this.gameObject.add(e);else{const a=this._parentComponent.shadowComponent;a&&(a?.add(e),o=!0)}this.shadowComponent=e,i&&i.shadowComponent&&this.shadowComponent&&i.shadowComponent.add(this.shadowComponent),VA&&e.add(new Vo(.5)),this.onAfterAddedToScene(),o&&yj(),a0e&&console.warn("Added shadow component",this.shadowComponent)}setShadowComponentOwner(e){if(e&&(e[Ga]===void 0||e[Ga]===this)&&(e[Ga]=this,e.children))for(const i of e.children)this.setShadowComponentOwner(i)}traverseOwnedShadowComponents(e,i,r){if(e&&e[Ga]===i){r(e);for(const s of e.children)this.traverseOwnedShadowComponents(s,i,r)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(e){this.shadowComponent&&(this.shadowComponent.interactable=e)}}class Ab extends nl{awake(){super.awake()}}class Gv{constructor(e,i){p(this,"event"),p(this,"button"),p(this,"buttonName"),p(this,"_used",!1),p(this,"_propagationStopped",!1),p(this,"z__pointer_ctured",!1),p(this,"z__pointer_cture_rleased",!1),p(this,"inputSource"),p(this,"object"),p(this,"point"),p(this,"normal"),p(this,"face"),p(this,"distance"),p(this,"instanceId"),p(this,"intersection"),p(this,"isDown"),p(this,"isUp"),p(this,"isPressed"),p(this,"isClick"),p(this,"isDoubleClick"),p(this,"input"),this.event=i,this.input=e,this.button=i.button}get deviceIndex(){return this.event.deviceIndex}get pointerId(){return this.event.pointerId}get pressure(){return this.event.pressure}get used(){return this._used}use(){this._used||(this._used=!0,this.event.use())}get propagationStopped(){return this._propagationStopped}stopPropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}stopImmediatePropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}setPointerCapture(){this.z__pointer_ctured=!0}releasePointerCapture(){this.z__pointer_cture_rleased=!0}get mode(){return this.event.mode}clone(){const e=new Gv(this.input,this.event);return Object.assign(e,this),e}Use(){this.use()}StopPropagation(){this.event.stopImmediatePropagation()}}function KC(n,e){return ie.foreachComponent(n,i=>{if(!i.enabled)return;const r=i;if(e)switch(e){case"pointerdown":if(r.onPointerDown)return!0;break;case"pointerup":if(r.onPointerUp||r.onPointerClick)return!0;break;case"pointermove":if(r.onPointerEnter||r.onPointerExit||r.onPointerMove)return!0;break}else if(r.onPointerDown||r.onPointerUp||r.onPointerEnter||r.onPointerExit||r.onPointerClick)return!0},!1)===!0}var l0e=Object.defineProperty,c0e=Object.getOwnPropertyDescriptor,h0e=(n,e,i,r)=>{for(var s=r>1?void 0:r?c0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&l0e(e,i,s),s};class bb extends Be{awake(){Ha.createIfNoneExists(this.context)}onEnable(){var e;(e=Ha.get(this.context))==null||e.register(this)}onDisable(){var e;(e=Ha.get(this.context))==null||e.unregister(this)}}class ta extends bb{constructor(){super(...arguments),p(this,"targets",null),p(this,"raycastHits",[]),p(this,"ignoreSkinnedMeshes",!1)}start(){this.targets=[this.gameObject]}performRaycast(e=null){if(!this.targets)return null;e??(e=new dc),e.targets=this.targets,e.results=this.raycastHits,e.useAcceleratedRaycast=!0;const i=e.testObject;this.ignoreSkinnedMeshes&&(e.testObject=s=>s instanceof wo?"continue in children":i?i(s):!0);const r=this.context.physics.raycast(e);return e.testObject=i,r}}h0e([C()],ta.prototype,"ignoreSkinnedMeshes",2);class ZC extends ta{constructor(){super(),this.ignoreSkinnedMeshes=!0}}const YQ=class extends bb{performRaycast(n){if(!Et.active||!YQ.allow||!(n!=null&&n.ray))return null;const e=n.ray.origin,i=.015;return this.context.physics.sphereOverlap(e,i,!1,!0)}};let T0=YQ;p(T0,"allow",!0);class $C{static getObject(e){const i=e[Ga];return i&&(i.isComponent===!0?e=i.gameObject:e=i),e}static isInteractable(e,i){if(i&&(i.canvasGroup=void 0,i.graphic=void 0),e==null||!e.visible||(e=this.getObject(e),!e.visible))return!1;const r=this.tryFindCanvasGroup(e);if(r?.isCanvasGroup===!0&&(i&&(i.canvasGroup=r),r.blocksRaycasts===!1||r.interactable===!1))return!1;const s=Mf(e,o=>{if(o.isGraphic===!0)return o},!1);return i&&s?.isGraphic===!0&&(i.graphic=s),!(s?.raycastTarget===!1||s?.layer===2)}static tryFindCanvasGroup(e){if(!e)return null;const i=Mf(e,r=>{const s=r;if(s.blocksRaycasts!==void 0&&s.interactable!==void 0)return s},!1);return i!==void 0?i:this.tryFindCanvasGroup(e.parent)}}function iD(n){return n[Ga]||(n.parent?iD(n.parent):null)}function u0e(n){return n.isUI===!0||typeof n[Ga]=="object"}function eE(n,e){if(!n)return;const i=n.material;if(i?.isMaterial===!0){const r=n.parent;r&&r.isText,i.side=e.doubleSided??!0?yi:Fn,i.shadowSide=e.doubleSided?yi:Fn,n.castShadow=e.castShadows?e.castShadows:!1,n.receiveShadow=e.receiveShadows?e.receiveShadows:!1}for(const r of n.children)eE(r,e)}function I0(n,e,i){n[e]===void 0&&console.warn("Field",e,"is undefined on",n);const r=Proxy.revocable(n[e],{set(a,l,c,h){const u=a[l],d=Reflect.set(a,l,c,h);return i(c,u),d}}),s=r.revoke,o=n[e];return r.revoke=()=>{n[e]=o,s()},n[e]=r.proxy,r}const JQ=Symbol("Scheduled action");function d0e(n,e,i=Xi.OnBeforeRender){let r=n[JQ];r||(r=n[JQ]={});const s=e.name;r[i]||(r[i]={});const o=r[i];if(o[s])return;function*a(){e?.call(n),o[s]=null}const l=n.startCoroutine(a(),i);o[s]=l}const Fh=te("debugeventsystem");var nD=(n=>(n.BeforeHandleInput="BeforeHandleInput",n.AfterHandleInput="AfterHandleInput",n))(nD||{});const Nh=class extends Be{constructor(){super(),p(this,"raycaster",[]),p(this,"pressedByID",new Map),p(this,"hoveredByID",new Map),p(this,"onPointerEvent",n=>{if(n===void 0||n.propagationStopped||n.defaultPrevented||n.used)return;const e=new Gv(this.context.input,n);this._currentPointerEventName=n.type,e.inputSource=this.context.input,e.isClick=n.isClick,e.isDoubleClick=n.isDoubleClick,e.isDown=n.type==pn.PointerDown,e.isUp=n.type==pn.PointerUp,e.isPressed=this.context.input.getPointerPressed(n.pointerId),Fh&&(e.isDown?console.log("DOWN",e.pointerId):e.isUp&&console.log("UP",e.pointerId),e.isClick&&console.log("CLICK",e.pointerId));const i=new dc;n.hasRay?i.ray=n.ray:i.screenPoint=this.context.input.getPointerPositionRC(n.pointerId);const r=this.performRaycast(i);if(r){for(const o of r)o.event=n,n.intersections.push(o);n.origin.onPointerHits&&n.origin.onPointerHits({sender:this,event:n,hits:r})}Fh&&e.isClick&&dn("EventSystem: "+e.pointerId+" - "+this.context.time.frame+" - Up:"+e.isUp+", Down:"+e.isDown);const s={sender:this,args:e,hasActiveUI:this.currentActiveMeshUIComponents.length>0};this.dispatchEvent(new CustomEvent("BeforeHandleInput",{detail:s})),this.handleIntersections(r,e),this.dispatchEvent(new CustomEvent("AfterHandleInput",{detail:s}))}),p(this,"_sortedHits",[]),p(this,"_testObjectsCache",new Map),p(this,"_currentlyActiveRaycaster",null),p(this,"_currentPointerEventName",null),p(this,"shouldRaycastObject",n=>{var e;let i=null;if(u0e(n)&&(i=(e=n[Ga])==null?void 0:e.gameObject),this._testObjectsCache.has(n)||i&&this._testObjectsCache.has(i))return this._testObjectsCache.get(n)===!1?"continue in children":!0;{let r=KC(n,this._currentPointerEventName);if(!r&&i&&(r=KC(i,this._currentPointerEventName)),r){this._testObjectsCache.set(n,!0);for(const s of n.children)this.shouldRaycastObject_AddToYesCache(s);return!0}return this._testObjectsCache.set(n,!1),"continue in children"}}),p(this,"_sortingBuffer",[]),p(this,"_noDepthTestingResults",[]),p(this,"out",{}),p(this,"_capturedPointer",{}),p(this,"pointerEnterSymbol",Symbol("pointerEnter")),p(this,"pointerExitSymbol",Symbol("pointerExit")),p(this,"currentActiveMeshUIComponents",[]),Nh.systems.push(this)}static createIfNoneExists(n){this.didSearchEventSystem||(this.didSearchEventSystem=!0,Nh.systems.length<=0&&Nh.systems.push(...ie.findObjectsOfType(Nh,n)));for(const i of Nh.systems)if(i.context===n)return;const e=new ve;ie.addNewComponent(e,Nh),n.scene.add(e)}static get systems(){const n=Ot.Current;return this._eventSystemMap.has(n)||this._eventSystemMap.set(n,[]),this._eventSystemMap.get(n)}static get(n){const e=this._eventSystemMap.get(n);return e&&e.length>0?e[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(n,e,i=!1){Sd.update(n,e,i)}static markUIDirty(n){Sd.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){Nh.systems.splice(Nh.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!ie.findObjectOfType(bb,this.context)){const n=ie.addNewComponent(this.context.scene,ta);this.raycaster.push(n),(it()||Fh)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found.")}}register(n){var e;n&&this.raycaster&&!this.raycaster.includes(n)&&((e=this.raycaster)==null||e.push(n))}unregister(n){var e,i;const r=(e=this.raycaster)==null?void 0:e.indexOf(n);r!==void 0&&r!==-1&&((i=this.raycaster)==null||i.splice(r,1))}onEnable(){this.context.input.addEventListener(pn.PointerDown,this.onPointerEvent),this.context.input.addEventListener(pn.PointerUp,this.onPointerEvent),this.context.input.addEventListener(pn.PointerMove,this.onPointerEvent)}onDisable(){this.context.input.removeEventListener(pn.PointerDown,this.onPointerEvent),this.context.input.removeEventListener(pn.PointerUp,this.onPointerEvent),this.context.input.removeEventListener(pn.PointerMove,this.onPointerEvent)}onBeforeRender(){this.resetMeshUIStates()}shouldRaycastObject_AddToYesCache(n){this._testObjectsCache.set(n,!0);for(const e of n.children)this.shouldRaycastObject_AddToYesCache(e)}performRaycast(n){if(!this.raycaster)return null;this._testObjectsCache.clear(),this._sortedHits.length=0,n||(n=new dc),n.testObject=this.shouldRaycastObject;for(const e of this.raycaster){if(!e.activeAndEnabled)continue;this._currentlyActiveRaycaster=e;const i=e.performRaycast(n);this._currentlyActiveRaycaster=null,i&&i.length>0&&this._sortedHits.push(...i)}return this._sortedHits.sort((e,i)=>e.distance-i.distance),this._sortedHits}assignHitInformation(n,e){e?(n.intersection=e,n.point=e.point,n.normal=e.normal,n.face=e.face,n.distance=e.distance,n.instanceId=e.instanceId):(n.intersection=void 0,n.point=void 0,n.normal=void 0,n.face=void 0,n.distance=void 0,n.instanceId=void 0)}handleIntersections(n,e){var i;if(n!=null&&n.length){n=this.sortCandidates(n);for(const s of n){if(e.event.immediatePropagationStopped)return!1;if(this.assignHitInformation(e,s),this.handleEventOnObject(s.object,e))return!0}}this.assignHitInformation(e,n?.[0]),this.invokePointerCapture(e);const r=this.hoveredByID.get(e.pointerId);return r&&this.propagatePointerExit(r.obj,r.data,null),this.hoveredByID.delete(e.pointerId),e.isUp&&((i=this.pressedByID.get(e.pointerId))==null||i.handlers.forEach(s=>this.invokeOnPointerUp(e,s)),this.pressedByID.delete(e.pointerId)),!1}sortCandidates(n){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let e=0;e<n.length;e++){const i=n[e],r=i.object;if(r.material&&r.material.depthTest===!1){this._noDepthTestingResults.push(i);continue}this._sortingBuffer.push(i)}for(const e of this._sortingBuffer)this._noDepthTestingResults.push(e);return this._noDepthTestingResults}handleEventOnObject(n,e){if(!this.testIsVisible(n))return e.isClick&&Fh&&console.log("not allowed",n),!1;if(e.pointerId===void 0)return Fh&&console.error("Event without pointer can't be handled",e),!1;e.object=n;const i=n.parent,r=e.isClick??!1;let s=null;if(i&&i.isUI){const c=(e.isPressed||e.isClick)??!1;if(i[Ga]){const h=i[Ga].gameObject;if(h){if(!$C.isInteractable(h,this.out))return!1;s=this.out.canvasGroup??null,this.handleMeshUIIntersection(n,c),n=h}}}r&&Fh&&console.log(this.context.time.frame,n);const o=this.hoveredByID.get(e.pointerId),a=o?.obj;a!==n&&a&&this.propagatePointerExit(a,o.data,n);const l=this.hoveredByID.get(e.pointerId);if(l?(l.obj=n,l.data=e):this.hoveredByID.set(e.pointerId,{obj:n,data:e}),e.isDown){const c=this.pressedByID.get(e.pointerId);c?(c.obj=n,c.data=e):this.pressedByID.set(e.pointerId,{obj:n,data:e,handlers:new Set})}return(s===null||s.interactable)&&this.handleMainInteraction(n,e,a??null),!0}propagate(n,e){for(;n;)ie.foreachComponent(n,i=>{e(i)},!1),n=n.parent}handleMainInteraction(n,e,i){const r=this.pressedByID.get(e.pointerId),s=i!==n;let o=!0;switch(e.event.pointerType){case"mouse":case"touch":const a=this.context.input.getPointerPositionLastFrame(e.pointerId),l=this.context.input.getPointerPosition(e.pointerId);o=a&&!tt.approximately(a,l);break}this.propagate(n,a=>{var l;const c=a;c.interactable!==!1&&(!c.activeAndEnabled||!c.enabled||(c.onPointerEnter&&s&&this.handlePointerEnter(c,e),e.isDown&&c.onPointerDown&&(c.onPointerDown(e),r?.handlers.add(c),this.handlePointerCapture(e,c)),c.onPointerMove&&(o&&c.onPointerMove(e),this.handlePointerCapture(e,c)),e.isUp&&(c.onPointerUp&&(this.invokeOnPointerUp(e,c),r?.handlers.delete(c)),c.onPointerExit&&((l=e.event)==null?void 0:l.pointerType)===CS.Touch&&(this.handlePointerExit(c,e),this.hoveredByID.delete(e.pointerId))),e.isClick&&c.onPointerClick&&c.onPointerClick(e)))}),e.isUp&&(r?.handlers.forEach(a=>{this.invokeOnPointerUp(e,a)}),this.pressedByID.delete(e.pointerId))}propagatePointerExit(n,e,i){this.propagate(n,r=>{if(!r.gameObject||r.destroyed)return;const s=r;if(s.onPointerExit||s.onPointerEnter){if(i&&this.isChild(i,r.gameObject))return;this.handlePointerExit(s,e)}})}invokeOnPointerUp(n,e){var i;(i=e.onPointerUp)==null||i.call(e,n),this.releasePointerCapture(n,e)}handlePointerEnter(n,e){n.onPointerEnter&&this.updatePointerState(n,e.pointerId,this.pointerEnterSymbol,!0)&&n.onPointerEnter(e),this.updatePointerState(n,e.pointerId,this.pointerExitSymbol,!1)}handlePointerExit(n,e){n.onPointerExit&&this.updatePointerState(n,e.pointerId,this.pointerExitSymbol,!0)&&n.onPointerExit(e),this.updatePointerState(n,e.pointerId,this.pointerEnterSymbol,!1)}updatePointerState(n,e,i,r){let s=n[i];if(r)return s&&s.includes(e)?!1:(s=s||[],s.push(e),n[i]=s,!0);{if(!s||!s.includes(e))return!1;const o=s.indexOf(e);return o!==-1&&s.splice(o,1),!0}}handlePointerCapture(n,e){if(n.z__pointer_ctured){n.z__pointer_ctured=!1;const i=n.pointerId;if(e.onPointerMove){const r=this._capturedPointer[i]||[];r.push(e),this._capturedPointer[i]=r}else it()&&!e.z__warned_no_pointermove&&(e.z__warned_no_pointermove=!0,console.warn("PointerCapture was requested but the component doesn't implement onPointerMove. It will not receive any pointer events"))}else n.z__pointer_cture_rleased&&(n.z__pointer_cture_rleased=!1,this.releasePointerCapture(n,e))}releasePointerCapture(n,e){const i=n.pointerId;if(this._capturedPointer[i]){const r=this._capturedPointer[i].indexOf(e);r!==-1&&(this._capturedPointer[i].splice(r,1),Fh&&console.log("released pointer capture",i,e,this._capturedPointer))}}invokePointerCapture(n){var e;if(n.event.type===pn.PointerMove){const i=n.pointerId,r=this._capturedPointer[i];if(r){Fh&&console.log("Captured",i,r);for(let s=0;s<r.length;s++){const o=r[s];if(o.destroyed){r.splice(s,1),s--;continue}(e=o.onPointerMove)==null||e.call(o,n)}}}}isChild(n,e){return!n||!e?!1:n===e?!0:n.parent?this.isChild(n.parent,e):!1}handleMeshUiObjectWithoutShadowDom(n,e){return!n||!n.isUI?!0:this.handleMeshUIIntersection(n,e)}handleMeshUIIntersection(n,e){const i=Sd.updateState(n,e);return i&&this.currentActiveMeshUIComponents.push(i),i!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&Sd.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let n=0;n<this.currentActiveMeshUIComponents.length;n++){const e=this.currentActiveMeshUIComponents[n];Sd.resetState(e)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(n){return n?ie.isActiveSelf(n)?this.testIsVisible(n.parent):!1:!0}};let Ha=Nh;p(Ha,"_eventSystemMap",new Map),p(Ha,"didSearchEventSystem",!1);class Sd{static markDirty(){this.needsUpdate=!0}static update(e,i,r=!1){if(r){e.update();return}const s=i.time.frameCount;for(const o of this.lastUpdateFrame)if(o.context===i){if(s===o.frame)return;o.frame=s;let a=this.needsUpdate||s<1;o.nextUpdate<=s&&(a=!0),a&&(Fh&&console.log("Update threemeshui"),this.needsUpdate=!1,o.nextUpdate=s+60,e.update());return}this.lastUpdateFrame=[{context:i,frame:s,nextUpdate:s+60}],e.update(),this.needsUpdate=!1}static updateState(e,i){let r=null;if(e&&(r=this.findBlockInParent(e),r&&r!==this.lastSelected)){if(r.interactable===!1)return null;this.needsUpdate=!0}return r}static resetLastSelected(){const e=this.lastSelected;e&&(this.lastSelected=null,this.resetState(e))}static resetState(e){e&&(this.needsUpdate=!0)}static findBlockInParent(e){return e?e.isBlock?e:this.findBlockInParent(e.parent):null}}p(Sd,"lastSelected",null),p(Sd,"lastUpdateFrame",[]),p(Sd,"needsUpdate",!1);var p0e=Object.defineProperty,f0e=Object.getOwnPropertyDescriptor,gn=(n,e,i,r)=>{for(var s=r>1?void 0:r?f0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&p0e(e,i,s),s};const rD=te("debugorbit"),tE=te("freecam"),iE=te("debugcamerafit"),nE=te("smoothcam"),m0e={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let sD;class xb extends CustomEvent{constructor(e,i){super("target-reached",{detail:{controls:e,type:i}})}}class wi extends Be{constructor(){super(...arguments),p(this,"autoTarget",!0),p(this,"autoFit",!1),p(this,"enableRotate",!0),p(this,"autoRotate",!1),p(this,"autoRotateSpeed",1),p(this,"minAzimuthAngle",1/0),p(this,"maxAzimuthAngle",1/0),p(this,"minPolarAngle",0),p(this,"maxPolarAngle",Math.PI),p(this,"enableKeys",!0),p(this,"enableDamping",!0),p(this,"dampingFactor",.1),p(this,"enableZoom",!0),p(this,"minZoom",0),p(this,"maxZoom",1/0),p(this,"zoomSpeed",1),p(this,"zoomToCursor",!1),p(this,"enablePan",!0),p(this,"lookAtConstraint",null),p(this,"lookAtConstraint01",1),p(this,"allowInterrupt",!0),p(this,"middleClickToFocus",!0),p(this,"doubleClickToFocus",!0),p(this,"clickBackgroundToFitScene",2),p(this,"debugLog",!1),p(this,"targetLerpDuration",1),p(this,"_controls",null),p(this,"_cameraObject",null),p(this,"_lookTargetLerpActive",!1),p(this,"_lookTargetStartPosition",new S),p(this,"_lookTargetEndPosition",new S),p(this,"_lookTargetLerp01",0),p(this,"_lookTargetLerpDuration",0),p(this,"_cameraLerpActive",!1),p(this,"_cameraStartPosition",new S),p(this,"_cameraEndPosition",new S),p(this,"_cameraLerp01",0),p(this,"_cameraLerpDuration",0),p(this,"_inputs",0),p(this,"_enableTime",0),p(this,"_startedListeningToKeyEvents",!1),p(this,"_eventSystem"),p(this,"_afterHandleInputFn"),p(this,"_camera",null),p(this,"_syncedTransform"),p(this,"_didSetTarget",0),p(this,"targetElement",null),p(this,"_activePointerEvents"),p(this,"_lastTimeClickOnBackground",-1),p(this,"_clickOnBackgroundCount",0),p(this,"_onPointerDown",e=>{this._activePointerEvents.push(e)}),p(this,"_onPointerUp",e=>{for(let i=this._activePointerEvents.length-1;i>=0;i--){const r=this._activePointerEvents[i];if(r.pointerId===e.pointerId&&r.button===e.button){this._activePointerEvents.splice(i,1);break}}if(this.clickBackgroundToFitScene>0&&e.isClick&&e.button===0){if(e.hasRay||e.intersections.push(...this.context.physics.raycast()),e.intersections.length<=0){const i=this.context.time.time-this._lastTimeClickOnBackground;this._lastTimeClickOnBackground=this.context.time.time,this.clickBackgroundToFitScene<=1||i<this.clickBackgroundToFitScene*.15?(this._clickOnBackgroundCount+=1,this._clickOnBackgroundCount>=this.clickBackgroundToFitScene-1&&this.fitCamera(this.context.scene.children,{immediate:!1})):this._clickOnBackgroundCount=0}rD&&console.log(this.clickBackgroundToFitScene,e.intersections.length,this._clickOnBackgroundCount)}}),p(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()}),p(this,"_shouldDisable",!1),p(this,"__onPreRender",()=>{const e=this.context.pre_render_callbacks.indexOf(this.__onPreRender);e>=0&&this.context.pre_render_callbacks.splice(e,1),this.autoFit&&(this.autoFit=!1,this.fitCamera(this.scene.children,{centerCamera:"y",immediate:!0}))}),p(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(e){var i;(i=this.controls)==null||i.addEventListener("start",e)}get targetLerpSpeed(){return 5}set targetLerpSpeed(e){this.targetLerpDuration=1/e}awake(){this._didSetTarget=0,this._startedListeningToKeyEvents=!1}start(){this._eventSystem=Ha.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(nD.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var e,i;(e=this._controls)==null||e.dispose(),(i=this._eventSystem)==null||i.removeEventListener(nD.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._didSetTarget=0,this._enableTime=this.context.time.time;const e=ie.getComponent(this.gameObject,Ui);this._camera=e;let i=e?.cam;if(!i&&this.gameObject instanceof Ft&&(i=this.gameObject),i&&Z2(i,this,!0),!this._controls&&i instanceof Ft){this._cameraObject=i;const r=this.targetElement??this.context.renderer.domElement,s=i?.quaternion.clone();this._controls=new VQ(i,r),i?.quaternion.copy(s),sD===void 0&&(sD={...this._controls.keys})}this._controls&&(tE&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,ec()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),i?.type==="PerspectiveCamera"?tE||(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom):tE||(this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom),this._startedListeningToKeyEvents||(this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(window.document.body))),this._syncedTransform=ie.getComponent(this.gameObject,vc)??void 0,this.context.pre_render_callbacks.push(this.__onPreRender),this._activePointerEvents=[],this.context.input.addEventListener("pointerdown",this._onPointerDown,{queue:Oa.Early}),this.context.input.addEventListener("pointerup",this._onPointerUp,{queue:Oa.Early})}onDisable(){var e;(e=this._camera)!=null&&e.cam&&Z2(this._camera.cam,this,!1),this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted)),this._activePointerEvents.length=0,this.context.input.removeEventListener("pointerdown",this._onPointerDown),this.context.input.removeEventListener("pointerup",this._onPointerUp)}afterHandleInput(e){e.detail.args.pointerId===0&&(e.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!e.detail.args.isPressed||e.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var e,i;if(!this._controls)return;if(this._cameraObject!==this.context.mainCamera){this._controls.enabled=!1;return}if(this._controls.enabled=!0,(this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2)||this.context.input.mouseWheelChanged||this.context.input.getPointerPressed(0)&&(e=this.context.input.getPointerPositionDelta(0))!=null&&e.length()||0>.1)&&(this._inputs+=1),this._inputs>0&&this.allowInterrupt&&(this.enableRotate&&(this.autoRotate=!1),this._cameraLerpActive=!1,this._lookTargetLerpActive=!1),this._inputs=0,this.autoTarget&&this._didSetTarget++===0){const s=ie.getComponent(this.gameObject,Ui);if(s&&!this.setLookTargetFromConstraint()){this.debugLog&&console.log("NO TARGET");const o=kt(s.cam),a=Math.max(.01,o.length()),l=new S(0,0,-a).applyMatrix4(s.cam.matrixWorld);this.setLookTargetPosition(l,!0)}if(!this.setLookTargetFromConstraint()){const o=new dc;o.screenPoint=new J(0,0),o.lineThreshold=.1;const a=this.context.physics.raycast(o);a.length>0&&this.setLookTargetPosition(a[0].point,!0),iE&&console.log("OrbitControls hits",...a)}}let r=this.middleClickToFocus&&this.context.input.getPointerClicked(1);if(r||(r=this.doubleClickToFocus&&this.context.input.getPointerDoubleClicked(0)&&this.context.time.time-this._enableTime>.3),r&&this.setTargetFromRaycast(),this._lookTargetLerpActive||this._cameraLerpActive){if(this._cameraLerpActive&&this._cameraObject)if(this._cameraLerp01+=this.context.time.deltaTime/this._cameraLerpDuration,this._cameraLerp01>=1)this._cameraObject.position.copy(this._cameraEndPosition),this._cameraLerpActive=!1,this.dispatchEvent(new xb(this,"camera"));else{const s=tt.easeInOutCubic(this._cameraLerp01);this._cameraObject.position.lerpVectors(this._cameraStartPosition,this._cameraEndPosition,s)}if(this._lookTargetLerpActive)if(this._lookTargetLerp01+=this.context.time.deltaTime/this._lookTargetLerpDuration,this._lookTargetLerp01>=1)this._controls.target.copy(this._lookTargetEndPosition),this._lookTargetLerpActive=!1,this.dispatchEvent(new xb(this,"lookat"));else{const s=tt.easeInOutCubic(this._lookTargetLerp01);this._controls.target.lerpVectors(this._lookTargetStartPosition,this._lookTargetEndPosition,s)}}if(this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR&&!this._activePointerEvents.some(s=>s.used),this._controls.keys=this.enableKeys?sD:m0e,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.zoomSpeed=this.zoomSpeed,this._controls.zoomToCursor=this.zoomToCursor,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,this._controls.minAzimuthAngle=this.minAzimuthAngle,this._controls.maxAzimuthAngle=this.maxAzimuthAngle,this._controls.minPolarAngle=this.minPolarAngle,this._controls.maxPolarAngle=this.maxPolarAngle,typeof nE=="number"||nE===!0){this._controls.enableDamping=!0;const s=typeof nE=="number"?nE:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,s))}this.allowInterrupt||(this._lookTargetLerpActive&&(this._controls.enablePan=!1),this._cameraLerpActive&&(this._controls.enableRotate=!1,this._controls.autoRotate=!1),(this._lookTargetLerpActive||this._cameraLerpActive)&&(this._controls.enableZoom=!1)),this.context.isInXR||(!tE&&(i=this.lookAtConstraint)!=null&&i.locked&&this.setLookTargetFromConstraint(0,this.lookAtConstraint01),this._controls.update(),rD&&yt.DrawWireSphere(this._controls.target,.1,65280))}}setCameraAndLookTarget(e){if(!e||!(e instanceof ve))return;const i=kt(e),r=sP(e);this.setTargetFromRaycast(new Js(i,r)),this.setCameraTargetPosition(i)}setCameraTargetPosition(e,i=!1){var r,s;e&&(e instanceof ve&&(e=kt(e)),this._cameraEndPosition||(this._cameraEndPosition=new S),this._cameraEndPosition.copy(e),i===!0?(this._cameraLerpActive=!1,(r=this.controllerObject)==null||r.position.copy(this._cameraEndPosition)):this._cameraObject&&(this._cameraLerpActive=!0,this._cameraLerp01=0,this._cameraStartPosition.copy((s=this._cameraObject)==null?void 0:s.position),typeof i=="number"?this._cameraLerpDuration=i:this._cameraLerpDuration=this.targetLerpDuration))}get cameraLerpActive(){return this._cameraLerpActive}stopCameraLerp(){this._cameraLerpActive=!1}setLookTargetPosition(e=null,i=!1){this._controls&&e&&(e instanceof ve&&(e=kt(e)),this._lookTargetEndPosition.copy(e),rD&&(console.warn("OrbitControls: setLookTargetPosition",e,i),yt.DrawWireSphere(this._lookTargetEndPosition,.2,16711680,2)),i===!0?this._controls.target.copy(this._lookTargetEndPosition):(this._lookTargetLerpActive=!0,this._lookTargetLerp01=0,this._lookTargetStartPosition.copy(this._controls.target),typeof i=="number"?this._lookTargetLerpDuration=i:this._lookTargetLerpDuration=this.targetLerpDuration))}get lookTargetLerpActive(){return this._lookTargetLerpActive}stopLookTargetLerp(){this._lookTargetLerpActive=!1}setLookTargetFromConstraint(e=0,i=1){var r;if(!this._controls)return!1;const s=(r=this.lookAtConstraint)==null?void 0:r.sources;if(s&&s.length>0){const o=s[e];if(o)return o.getWorldPosition(this._lookTargetEndPosition),this.lerpLookTarget(this._lookTargetEndPosition,i),!0}return!1}lerpTarget(e,i){return this.lerpLookTarget(e,i)}lerpLookTarget(e,i){this._controls&&(i>=1?this._controls.target.copy(e):this._controls.target.lerp(e,i))}setTargetFromRaycast(e){if(!this.controls)return;const i=e?this.context.physics.raycastFromRay(e):this.context.physics.raycast();for(const r of i)if(r.distance>0&&ie.isActiveInHierarchy(r.object)){const s=iD(r.object);if(s){const o=s.canvas;if(o!=null&&o.screenspace)break}this.setLookTargetPosition(r.point);break}}fitCamera(e,i={fitOffset:void 0,immediate:!1}){if(this.context.isInXR)return;const{immediate:r=!1,centerCamera:s}=i;let{fitOffset:o}=i;o==null&&(o=1.1);const a=this._cameraObject,l=this._controls;if(e!=null&&e.length||(e=this.context.scene.children),e.length<=0){console.warn("No objects to fit camera to...");return}if(!a||!l){console.warn("No camera or controls found to fit camera to objects...");return}const c=new S,h=new S,u=pl(e,void 0);a.updateMatrixWorld(),a.updateProjectionMatrix(),u.getCenter(h);const d=new S;if(u.getSize(d),u.applyMatrix4(a.matrixWorldInverse),u.getSize(c),u.setFromCenterAndSize(h,c),Number.isNaN(c.x)||Number.isNaN(c.y)||Number.isNaN(c.z)){console.warn("Camera fit size resultet in NaN",a,u,[...e]);return}if(c.length()<=1e-10){iE&&console.warn("Camera fit size is zero",u,[...e]);return}const f=a.fov,m=2*Math.atan(Math.tan(f*Math.PI/360/2)*a.aspect)/Math.PI*360,g=c.y/(2*Math.atan(Math.PI*f/360)),v=c.x/(2*Math.atan(Math.PI*m/360)),y=o*Math.max(g,v)+c.z/2;iE&&console.log("Fit camera to objects",g,v,"distance",y),l.maxDistance=y*10,l.minDistance=y*.01;const A=.05,b=h.clone();b.y-=c.y*A,this.setLookTargetPosition(b,r),this.autoTarget=!1;const x=ie.findObjectOfType(Uh),_=x?x.radius:0,w=Math.max(d.x,d.y,d.z,_);a.near=y/100,a.far=w+y*10,a.updateMatrixWorld(),a.updateProjectionMatrix();const T=kt(a),M=h.clone();if(M.sub(T),s==="y"&&(M.y=0),M.normalize(),M.multiplyScalar(y),s==="y"&&(M.y+=-A*4*c.y),a.parent){const R=a.parent.worldToLocal(h.clone().sub(M));this.setCameraTargetPosition(R,r)}else console.error(`Can not fit camera ${a.name} because it has no parent`);if(iE){const R=new r2(u);this.context.scene.add(R),lP(R,Vy(a)),setTimeout(()=>{this.context.scene.remove(R)},1e4),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",B=>{B.code==="KeyF"&&this.fitCamera(e,{fitOffset:o,immediate:r})}))}l.update()}}gn([C()],wi.prototype,"autoTarget",2),gn([C()],wi.prototype,"autoFit",2),gn([C()],wi.prototype,"enableRotate",2),gn([C()],wi.prototype,"autoRotate",2),gn([C()],wi.prototype,"autoRotateSpeed",2),gn([C()],wi.prototype,"minAzimuthAngle",2),gn([C()],wi.prototype,"maxAzimuthAngle",2),gn([C()],wi.prototype,"minPolarAngle",2),gn([C()],wi.prototype,"maxPolarAngle",2),gn([C()],wi.prototype,"enableKeys",2),gn([C()],wi.prototype,"enableDamping",2),gn([C()],wi.prototype,"dampingFactor",2),gn([C()],wi.prototype,"enableZoom",2),gn([C()],wi.prototype,"minZoom",2),gn([C()],wi.prototype,"maxZoom",2),gn([C()],wi.prototype,"zoomSpeed",2),gn([C()],wi.prototype,"enablePan",2),gn([C(Lf)],wi.prototype,"lookAtConstraint",2),gn([C()],wi.prototype,"lookAtConstraint01",2),gn([C()],wi.prototype,"allowInterrupt",2),gn([C()],wi.prototype,"middleClickToFocus",2),gn([C()],wi.prototype,"doubleClickToFocus",2),gn([C()],wi.prototype,"clickBackgroundToFitScene",2),gn([C()],wi.prototype,"targetLerpDuration",2);var g0e=Object.defineProperty,v0e=Object.getOwnPropertyDescriptor,uo=(n,e,i,r)=>{for(var s=r>1?void 0:r?v0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&g0e(e,i,s),s},Cd=(n=>(n[n.Skybox=1]="Skybox",n[n.SolidColor=2]="SolidColor",n[n.Uninitialized=4]="Uninitialized",n))(Cd||{});const zh=te("debugcam"),KQ=te("debugscreenpointtoray");var rE;const _b=(rE=class extends Be{constructor(){super(...arguments),p(this,"_nearClipPlane",.1),p(this,"_farClipPlane",1e3),p(this,"orthographic",!1),p(this,"orthographicSize",5),p(this,"ARBackgroundAlpha",0),p(this,"_cullingMask",4294967295),p(this,"_backgroundBlurriness",0),p(this,"_backgroundIntensity",1),p(this,"_backgroundRotation"),p(this,"_environmentIntensity"),p(this,"_targetTexture",null),p(this,"_backgroundColor"),p(this,"_fov"),p(this,"_cam",null),p(this,"_clearFlags",2),p(this,"_skybox"),p(this,"_frustum"),p(this,"_projScreenMatrix",new he)}get isCamera(){return!0}get aspect(){return this._cam instanceof Ft?this._cam.aspect:this.context.domWidth/this.context.domHeight}set aspect(n){this._cam instanceof Ft&&this._cam.aspect!==n&&(this._cam.aspect=n,this._cam.updateProjectionMatrix())}get fieldOfView(){return this._cam instanceof Ft?this._cam.fov:this._fov}set fieldOfView(n){const e=this.fieldOfView!=n;if(this._fov=n,e&&this._cam&&this._cam instanceof Ft){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(n){const e=this._nearClipPlane!=n;this._nearClipPlane=n,this._cam&&(e||this._cam.near!=n)&&(this._cam.near=n,this._cam.updateProjectionMatrix())}applyClippingPlane(){this._cam&&(this._cam.near=this._nearClipPlane,this._cam.far=this._farClipPlane,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(n){const e=this._farClipPlane!=n;this._farClipPlane=n,this._cam&&(e||this._cam.far!=n)&&(this._cam.far=n,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(n){n!==this._clearFlags&&(this._clearFlags=n,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(n){this._cullingMask=n,this._cam&&(this._cam.layers.mask=n)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set cullingLayer(n){this.cullingMask=(1<<n|0)>>>0}set backgroundBlurriness(n){n!==this._backgroundBlurriness&&(n===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(n,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(n){n!==this._backgroundIntensity&&(n===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(n,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set backgroundRotation(n){n!==this._backgroundRotation&&(n===void 0?this._backgroundRotation=void 0:this._backgroundRotation=n,this.applyClearFlagsIfIsActiveCamera())}get backgroundRotation(){return this._backgroundRotation}set environmentIntensity(n){this._environmentIntensity=n}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(n){if(n){if(this._backgroundColor)this._backgroundColor.copy(n);else{if(!n.clone)return;this._backgroundColor=n.clone()}n.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(n){this._targetTexture=n}get targetTexture(){return this._targetTexture}get cam(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(n,e,i){const r=this.cam,s=_b._origin;s.set(n,e,-1),this.context.input.convertScreenspaceToRaycastSpace(s),KQ&&console.log("screenPointToRay",n.toFixed(2),e.toFixed(2),"now:",s.x.toFixed(2),s.y.toFixed(2),"isInXR:"+this.context.isInXR),s.z=-1,s.unproject(r);const o=_b._direction.set(s.x,s.y,s.z),a=kt(r);return o.sub(a),o.normalize(),i?(i.set(a,o),i):new Js(a.clone(),o.clone())}getFrustum(){return this._frustum||(this._frustum=new Rp,this.updateFrustum()),this._frustum}updateFrustum(){this._frustum||(this._frustum=new Rp),this._frustum.setFromProjectionMatrix(this.getProjectionScreenMatrix(this._projScreenMatrix,!0),this.context.renderer.coordinateSystem)}getProjectionScreenMatrix(n,e){return e&&this._projScreenMatrix.multiplyMatrices(this.cam.projectionMatrix,this.cam.matrixWorldInverse),n===this._projScreenMatrix?n:n.copy(this._projScreenMatrix)}awake(){KQ&&window.addEventListener("pointerdown",n=>{const e=n.clientX,i=n.clientY;console.log("touch",e.toFixed(2),i.toFixed(2));const r=this.screenPointToRay(e,i),s="#"+Math.floor(Math.random()*16777215).toString(16);yt.DrawRay(r.origin,r.direction,s,10)})}onEnable(){zh&&console.log(`Camera enabled: "${this.name}". ClearFlags=${Cd[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),A0e(this)),this.applyClearFlagsIfIsActiveCamera({applySkybox:!0})}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&(this._frustum&&this.updateFrustum(),this._clearFlags===2&&this.applyClearFlagsIfIsActiveCamera(),this._targetTexture)){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const n=this.context.renderer;if(n){const e=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,n),e?.applyClearFlags()}}}buildCamera(){if(this._cam)return;const n=this.gameObject.isCamera;let e=null;if(n?(e=this.gameObject,e?.layers.enableAll(),e instanceof Ft&&(this._fov=e.fov)):e=this.gameObject.children[0],e&&e.isCamera)e instanceof Ft&&(this._fov&&(e.fov=this._fov),e.near=this._nearClipPlane,e.far=this._farClipPlane,e.updateProjectionMatrix());else if(!this.orthographic)e=new Ft(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(e.fov=this.fieldOfView),this.gameObject.add(e);else{const i=this.orthographicSize*100;e=new Yl(window.innerWidth/-i,window.innerWidth/i,window.innerHeight/i,window.innerHeight/-i,this._nearClipPlane,this._farClipPlane),this.gameObject.add(e)}this._cam=e,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(n){this.context.mainCameraComponent===this&&this.applyClearFlags(n)}applyClearFlags(n){var e;if(!this._cam){zh&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,zh){const i=`Camera "${this.name}" clear flags: ${Cd[this._clearFlags]}`;console.debug(i)}switch(this._clearFlags){case 1:if(_b.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}(!this.scene.background||!this._skybox||n?.applySkybox===!0)&&this.applySceneSkybox(),this._backgroundBlurriness!==void 0?this.context.scene.backgroundBlurriness=this._backgroundBlurriness:zh&&console.warn(`Camera "${this.name}" has no background blurriness`),this._backgroundIntensity!==void 0&&(this.context.scene.backgroundIntensity=this._backgroundIntensity),this._backgroundRotation!==void 0?this.context.scene.backgroundRotation=this._backgroundRotation:zh&&console.warn(`Camera "${this.name}" has no background intensity`);break;case 2:if(this._backgroundColor){let i=this._backgroundColor.alpha;_b.backgroundShouldBeTransparent(this.context)&&(i=this.ARBackgroundAlpha??0),this.context.scene.background=null,(e=this.context.xr)!=null&&e.isVR?this.context.renderer.setClearColor(wj(this._backgroundColor).convertLinearToSRGB()):this.context.renderer.setClearColor(this._backgroundColor,i)}else zh&&console.warn(`Camera "${this.name}" has no background color`,this);break;case 4:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}applySceneSkybox(){this._skybox||(this._skybox=new y0e(this)),this._skybox.apply()}static backgroundShouldBeTransparent(n){var e,i,r,s;const o=(e=n.renderer.xr)==null?void 0:e.getSession();if(!o)return!1;if(typeof o._transparent=="boolean")return o._transparent;const a=o.environmentBlendMode;zh&&dn("Environment blend mode: "+a+" on "+navigator.userAgent);let l=a==="additive"||a==="alpha-blend";return n.isInAR&&a==="opaque"&&((i=navigator.userAgent)!=null&&i.includes("OculusBrowser")||(r=navigator.userAgent)!=null&&r.includes("Mozilla")&&(s=navigator.userAgent)!=null&&s.includes("Mobile WebXRViewer/v2"))&&(l=!0),o._transparent=l,l}},p(rE,"_origin",new S),p(rE,"_direction",new S),rE);let Ui=_b;uo([C()],Ui.prototype,"aspect",1),uo([C()],Ui.prototype,"fieldOfView",1),uo([C()],Ui.prototype,"nearClipPlane",1),uo([C()],Ui.prototype,"farClipPlane",1),uo([C()],Ui.prototype,"clearFlags",1),uo([C()],Ui.prototype,"orthographic",2),uo([C()],Ui.prototype,"orthographicSize",2),uo([C()],Ui.prototype,"ARBackgroundAlpha",2),uo([C()],Ui.prototype,"cullingMask",1),uo([C()],Ui.prototype,"backgroundBlurriness",1),uo([C()],Ui.prototype,"backgroundIntensity",1),uo([C(ri)],Ui.prototype,"backgroundRotation",1),uo([C()],Ui.prototype,"environmentIntensity",1),uo([C(ki)],Ui.prototype,"backgroundColor",1),uo([C(E0)],Ui.prototype,"targetTexture",1);class y0e{constructor(e){p(this,"_camera"),p(this,"_skybox"),this._camera=e}get context(){var e;return(e=this._camera)==null?void 0:e.context}apply(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(zh&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.mapping=qs,this.context.scene.background=this._skybox):(this._did_log_failed_to_find_skybox||(this._did_log_failed_to_find_skybox=!0,console.warn(`Camera "${this._camera.name}" failed to load/find skybox texture`,this._camera.sourceId,this.context.lightmaps,"Current background: ",this.context.scene.background)),(zh||it())&&Pi(`Camera "${this._camera.name}" has no skybox texture`))}}function A0e(n){te("freecam")&&n.context.mainCameraComponent===n&&ie.getOrAddComponent(n.gameObject,wi)}class Ed extends Be{constructor(){super(...arguments),p(this,"_listener",null),p(this,"onInteraction",()=>{this.destroyed||this.listener==null||this.addListenerIfItExists()})}get listener(){return this._listener==null&&(this._listener=new Oz),this._listener}onEnable(){kh.registerWaitForInteraction(this.onInteraction),this.addListenerIfItExists()}onDisable(){kh.unregisterWaitForInteraction(this.onInteraction),this.removeListenerIfItExists()}addListenerIfItExists(){const e=this._listener;if(!e||e!=null&&e.parent)return;const i=this.context.mainCameraComponent||ie.getComponentInParent(this.gameObject,Ui);i!=null&&i.cam?i.cam.add(e):this.gameObject.add(e),e.filter?(e.gain.connect(e.filter),e.filter.connect(e.context.destination)):e.gain.connect(e.context.destination)}removeListenerIfItExists(){const e=this._listener;e&&(e.removeFromParent(),e.filter&&e.filter.disconnect(),e.gain&&e.gain.disconnect())}}class b0e extends hn{constructor(e,i=1,r=16,s=2){const o=new dt,a=r+s*2,l=new Float32Array((a*3+3)*3);o.setAttribute("position",new Ye(l,3));const c=new zi({color:65280}),h=new zi({color:16776960});super(o,[h,c]),this.audio=e,this.range=i,this.divisionsInnerAngle=r,this.divisionsOuterAngle=s,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,i=this.range,r=this.divisionsInnerAngle,s=this.divisionsOuterAngle,o=pi.degToRad(e.panner.coneInnerAngle),a=pi.degToRad(e.panner.coneOuterAngle),l=o/2,c=a/2;let h=0,u=0,d,f;const m=this.geometry,g=m.attributes.position;m.clearGroups();function v(y,A,b,x){const _=(A-y)/b;for(g.setXYZ(h,0,0,0),u++,d=y;d<A;d+=_)f=h+u,g.setXYZ(f,Math.sin(d)*i,0,Math.cos(d)*i),g.setXYZ(f+1,Math.sin(Math.min(d+_,A))*i,0,Math.cos(Math.min(d+_,A))*i),g.setXYZ(f+2,0,0,0),u+=3;m.addGroup(h,u,x),h+=u,u=0}v(-c,-l,s,0),v(-l,l,r,1),v(l,c,s,0),g.needsUpdate=!0,o===a&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}var x0e=Object.defineProperty,_0e=Object.getOwnPropertyDescriptor,yc=(n,e,i,r)=>{for(var s=r>1?void 0:r?_0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&x0e(e,i,s),s};const Ns=te("debugaudio"),Md=class extends Be{constructor(){super(...arguments),p(this,"clip",""),p(this,"playOnAwake",!1),p(this,"preload",!1),p(this,"playInBackground",!0),p(this,"_spatialBlend",0),p(this,"_minDistance",1),p(this,"_maxDistance",100),p(this,"_volume",1),p(this,"rollOffMode",0),p(this,"_loop",!1),p(this,"sound",null),p(this,"helper",null),p(this,"wasPlaying",!1),p(this,"audioLoader",null),p(this,"shouldPlay",!1),p(this,"_lastClipStartedLoading",null),p(this,"_audioElement",null),p(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||ec())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":Ns&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,Md.userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&Md.userInteractionRegistered&&this.wasPlaying&&this.play();break}}),p(this,"onApplicationMuteChanged",()=>{var n,e;this.context.application.muted?(n=this.sound)==null||n.setVolume(0):(e=this.sound)==null||e.setVolume(this.volume)}),p(this,"createAudio",n=>{Ns&&console.log("AudioBuffer finished loading",n);const e=this.Sound;if(!e){Ns&&console.warn("Failed getting sound?",this.name);return}e.isPlaying&&e.stop(),n&&e.setBuffer(n),e.loop=this._loop,this.context.application.muted?e.setVolume(0):e.setVolume(this.volume),e.autoplay=this.shouldPlay&&Md.userInteractionRegistered,this.applySpatialDistanceSettings(),e.isPlaying&&e.stop(),Md.registerWaitForAllowAudio(this.__onAllowAudioCallback)}),p(this,"__onAllowAudioCallback",()=>{this.shouldPlay&&this.play()}),p(this,"_lastContextTime",0),p(this,"_hasEnded",!0),p(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return kh.userInteractionRegistered}static registerWaitForAllowAudio(n){kh.registerWaitForInteraction(n)}get isPlaying(){var n;return((n=this.sound)==null?void 0:n.isPlaying)??!1}get duration(){var n,e;return(e=(n=this.sound)==null?void 0:n.buffer)==null?void 0:e.duration}get time01(){var n;const e=this.duration;return e&&this.sound?((n=this.sound)==null?void 0:n.context.currentTime)/e:0}set time01(n){const e=this.duration;e&&this.sound&&(this.time=n*e)}get time(){var n,e;return(n=this.sound)!=null&&n.source?((e=this.sound.source)==null?void 0:e.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(n){if(this.sound){if(n===this.sound.offset)return;const e=this.isPlaying;this.stop(),this.sound.offset=n,e&&this.play()}}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(n){this._loop=n,this.sound&&this.sound.setLoop(n)}get spatialBlend(){return this._spatialBlend}set spatialBlend(n){n!==this._spatialBlend&&(this._spatialBlend=n,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(n){this._minDistance!==n&&(this._minDistance=n,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(n){this._maxDistance!==n&&(this._maxDistance=n,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(n){this._volume=n,this.sound&&!this.context.application.muted&&(Ns&&console.log(this.name,"audio set volume",n),this.sound.setVolume(n))}get Sound(){var n;if(!this.sound&&Md.userInteractionRegistered){let e=ie.getComponent(this.context.mainCamera,Ed)??ie.findObjectOfType(Ed,this.context);!e&&this.context.mainCamera&&(e=ie.addNewComponent(this.context.mainCamera,Ed)),e!=null&&e.listener?(this.sound=new Lz(e.listener),(n=this.gameObject)==null||n.add(this.sound)):Ns&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}get audioContext(){var n;return(n=this.sound)==null?void 0:n.context}awake(){Ns&&console.log(this),this.audioLoader=new Xw,this.playOnAwake&&(this.shouldPlay=!0),this.preload&&typeof this.clip=="string"&&this.audioLoader.load(this.clip,this.createAudio,()=>{},console.error)}onEnable(){this.sound&&this.gameObject.add(this.sound),Md.userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():Md.registerWaitForAllowAudio(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(AC.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(AC.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const n=this.sound;if(!n)return;this._needUpdateSpatialDistanceSettings=!1;const e=tt.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(Ns&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+e),n.setRefDistance(e),n.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case 0:n.setDistanceModel("exponential");break;case 1:n.setDistanceModel("linear");break;case 2:console.warn("Custom rolloff for AudioSource is not supported: "+this.name);break}this.spatialBlend>0?Ns&&!this.helper&&(this.helper=new b0e(n,n.getRefDistance()),n.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}async onNewClip(n){if(n&&(this.clip=n),typeof n=="string")if(Ns&&console.log(n),n.endsWith(".mp3")||n.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new Xw),this.shouldPlay=!0,this._lastClipStartedLoading===n){Ns&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=n,Ns&&console.log("load audio",n);const e=await this.audioLoader.loadAsync(n).catch(console.error);this._lastClipStartedLoading=null,e&&this.createAudio(e)}else console.warn("Unsupported audio clip type",n);else this.shouldPlay=!0,this.createAudio()}play(n=void 0){var e,i,r;!n&&this.clip&&(n=this.clip),n!==void 0&&typeof n!="string"&&!(n instanceof MediaStream)&&(it()&&console.warn("Called play on AudioSource with unknown argument type:",n+`
Using the assigned clip instead:`,this.clip),n=this.clip);let s=!this.sound||n&&n!==this.clip;if(typeof n=="string"&&!this.audioLoader&&(s=!0),(n instanceof MediaStream||typeof n=="string")&&(this.clip=n),s){this.shouldPlay=!0,this.onNewClip(n);return}if(this.shouldPlay=!0,this._hasEnded=!1,Ns&&console.log("play",(e=this.sound)==null?void 0:e.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const o=this.context.application.muted;o&&this.sound.setVolume(0),(i=this.gameObject)==null||i.add(this.sound),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(r=this.context.domElement.shadowRoot)==null||r.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(o?.1:0))}}pause(){var n,e;Ns&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(n=this.sound)==null?void 0:n.context.currentTime,this.sound.pause()),(e=this._audioElement)==null||e.remove()}stop(){var n,e;Ns&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(n=this.sound)==null?void 0:n.context.currentTime,Ns&&console.log(this._lastContextTime),this.sound.stop()),(e=this._audioElement)==null||e.remove()}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,Ns&&console.log("Audio clip ended",this.clip),this.dispatchEvent(new CustomEvent("ended",{detail:this})))}};let Pn=Md;yc([C(URL)],Pn.prototype,"clip",2),yc([C()],Pn.prototype,"playOnAwake",2),yc([C()],Pn.prototype,"preload",2),yc([C()],Pn.prototype,"playInBackground",2),yc([C()],Pn.prototype,"loop",1),yc([C()],Pn.prototype,"spatialBlend",1),yc([C()],Pn.prototype,"minDistance",1),yc([C()],Pn.prototype,"maxDistance",1),yc([C()],Pn.prototype,"volume",1),yc([C()],Pn.prototype,"rollOffMode",2);var w0e=Object.defineProperty,S0e=Object.getOwnPropertyDescriptor,sE=(n,e,i,r)=>{for(var s=r>1?void 0:r?S0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&w0e(e,i,s),s};const C0e=te("debugsignals");class wb{constructor(){p(this,"guid")}}sE([C()],wb.prototype,"guid",2);class R0{constructor(){p(this,"signal"),p(this,"reaction")}}sE([C(wb)],R0.prototype,"signal",2),sE([C(An)],R0.prototype,"reaction",2);var oD;const jh=(oD=class extends Be{constructor(){super(...arguments),p(this,"events")}static invoke(n){if(jh.receivers[n]){const e=jh.receivers[n];if(!e)return;for(const i of e)i.invoke(n)}}awake(){C0e&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const n of this.events)jh.receivers[n.signal.guid]||(jh.receivers[n.signal.guid]=[]),jh.receivers[n.signal.guid].push(this)}onDisable(){if(this.events){for(const n of this.events)if(jh.receivers[n.signal.guid]){const e=jh.receivers[n.signal.guid].indexOf(this);e>=0&&jh.receivers[n.signal.guid].splice(e,1)}}}invoke(n){if(!this.events||!Array.isArray(this.events))return;const e=typeof n=="object"?n.guid:n;for(const i of this.events)if(i.signal.guid===e)try{if(i.reaction){if(!i.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",i,this);continue}}else{console.warn("Missing reaction for signal",i,this);continue}i.reaction.invoke()}catch(r){console.error(r)}}},p(oD,"receivers",{}),oD);let P0=jh;sE([C(R0)],P0.prototype,"events",2);var ia=(n=>(n.Activation="ActivationTrack",n.Animation="AnimationTrack",n.Audio="AudioTrack",n.Control="ControlTrack",n.Marker="MarkerTrack",n.Signal="SignalTrack",n))(ia||{}),Ac=(n=>(n[n.None=0]="None",n[n.Hold=1]="Hold",n[n.Loop=2]="Loop",n[n.PingPong=3]="PingPong",n[n.Continue=4]="Continue",n))(Ac||{}),aD=(n=>(n.Signal="SignalEmitter",n))(aD||{});const bc=te("debugtimeline");class Sb{constructor(){p(this,"director"),p(this,"track")}get muted(){return this.track.muted}set muted(e){var i;e!==this.track.muted&&(this.track.muted=e,(i=this.onMuteChanged)==null||i.call(this))}*forEachClip(e=!1){var i;if((i=this.track)!=null&&i.clips)if(e)for(let r=this.track.clips.length-1;r>=0;r--)yield this.track.clips[r];else for(const r of this.track.clips)yield r}getClipTime(e,i){return i.clipIn+(e-i.start)*i.timeScale}getClipTimeNormalized(e,i){return(e-i.start)/i.duration}evaluateWeight(e,i,r,s=!0){if(i<0||i>=r.length)return 0;const o=r[i];if(s||e>=o.start&&e<=o.end){let a=1;const l=!1;if(o.easeInDuration>0){const c=Math.min((e-o.start)/o.easeInDuration,1);a*=c}if(o.easeOutDuration>0&&!l){const c=Math.min((o.end-e)/o.easeOutDuration,1);a*=c}return a}return 0}}class E0e{constructor(e){p(this,"clip"),p(this,"rootPositionOffset"),p(this,"rootQuaternionOffset"),p(this,"rootStartPosition"),p(this,"rootEndPosition"),p(this,"rootStartQuaternion"),p(this,"rootEndQuaternion");const i=e.getClip();this.clip=i;const r=e.getRoot(),s=r.name+".position",o=r.name+".quaternion";bc&&console.log(i.name,i.tracks,s);for(const a of i.tracks)if(!(a.times.length<=0)){if(a.name.endsWith(s))this.rootStartPosition=new S().fromArray(a.values,0),this.rootEndPosition=new S().fromArray(a.values,a.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),bc&&console.log(this.rootPositionOffset);else if(a.name.endsWith(o)&&(this.rootStartQuaternion=new Ce().fromArray(a.values,0),this.rootEndQuaternion=new Ce().fromArray(a.values,a.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),bc)){const l=new ri().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",l)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class oE extends Sb{constructor(){super(...arguments),p(this,"models",[]),p(this,"trackOffset"),p(this,"target"),p(this,"mixer"),p(this,"clips",[]),p(this,"actions",[]),p(this,"_actionOffsets",[]),p(this,"_didBind",!1),p(this,"_animator",null),p(this,"_useclipOffsets",!0),p(this,"_totalOffsetPosition",new S),p(this,"_totalOffsetRotation",new Ce),p(this,"_totalOffsetPosition2",new S),p(this,"_totalOffsetRotation2",new Ce),p(this,"_summedPos",new S),p(this,"_tempPos",new S),p(this,"_summedRot",new Ce),p(this,"_tempRot",new Ce),p(this,"_clipRotQuat",new Ce)}onDisable(){var e;(e=this.mixer)==null||e.stopAllAction()}onDestroy(){this.director.context.animations.unregisterAnimationMixer(this.mixer)}onStateChanged(){this._animator&&$Q(this._animator.gameObject,this,this.director.isPlaying)}createHooks(e,i){var r,s;if(((r=i.tracks)==null?void 0:r.length)<=0){console.warn("No tracks in AnimationClip",i);return}const o=i.tracks[0].name.split("."),a=o[o.length-2],l=a+".position",c=a+".quaternion";let h=!1,u=!1;for(const d of i.tracks)d.name.endsWith(l)?(h=!0,this.createPositionInterpolant(i,e,d)):d.name.endsWith(c)&&(u=!0,this.createRotationInterpolant(i,e,d));if(!h||!u){const d=(s=this.mixer)==null?void 0:s.getRoot(),f=i.tracks[0],m=f.name.lastIndexOf("."),g=f.name.substring(0,m),v=g.substring(g.lastIndexOf(".")+1),y=d.getObjectByName(v);if(y)if(h){if(!u){const A=i.tracks[0].name.substring(0,m)+".quaternion";bc&&console.warn("Create quaternion track",v,y);const b=y.quaternion,x=new hl(A,[0,i.duration],[b.x,b.y,b.z,b.w,b.x,b.y,b.z,b.w]);i.tracks.push(x),this.createRotationInterpolant(i,e,x)}}else{const A=g+".position";bc&&console.warn("Create position track",v,y);const b=y.position,x=new Jl(A,[0,i.duration],[b.x,b.y,b.z,b.x,b.y,b.z]);i.tracks.push(x),this.createPositionInterpolant(i,e,x)}}}bind(){if(!this._didBind){this._didBind=!0,bc&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const e of this.actions){const i=new E0e(e);this._actionOffsets.push(i)}this.target&&(this._animator=ie.getComponent(this.target,rs)??null,this._animator&&$Q(this._animator.gameObject,this,!0));for(const e of this.models){const i=e.asset,r=i.position,s=i.rotation;r&&r.x!==void 0&&(r.isVector3||(i.position=new S(r.x,r.y,r.z)),s.isQuaternion||(i.rotation=new Ce(s.x,s.y,s.z,s.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const e=this.trackOffset.position;e&&(e.isVector3||(this.trackOffset.position=new S(e.x,e.y,e.z)));const i=this.trackOffset.rotation;i&&(i.isQuaternion||(this.trackOffset.rotation=new Ce(i.x,i.y,i.z,i.w)))}}evaluate(e){var i,r,s,o,a,l,c;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let h=0,u=0,d=!1,f=!1,m=0;for(let g=0;g<this.clips.length;g++){const v=this.models[g],y=this.actions[g],A=v.asset;y.weight=0;const b=e>=v.start&&e<=v.end,x=v.preExtrapolationMode,_=v.postExtrapolationMode,w=g<this.clips.length-1?this.models[g+1]:null;let T=b,M=!1;if(!T&&!d&&v.end<e&&_!==Ac.None?(!w||w.start>e)&&(T=!0,d=!0):g==0&&!T&&!f&&v.start>e&&x!==Ac.None&&(!w||w.start<e)&&(T=!0,M=!0,f=!0),T){let R=1;R*=this.evaluateWeight(e,g,this.models,T),R*=this.director.weight;let B=b;if(M)switch(x){case Ac.Hold:break;case Ac.Loop:e+=v.start,B=!0;break;default:e+=v.start,B=!0;break}let E=this.getClipTime(e,v),P=0;const O=A.duration;if(M&&x===Ac.Hold&&(E=0),B){if(A.loop)for(P+=Math.floor(E/(O+1e-6));E>O;)E-=O}else if(!b&&d)switch(_){case Ac.Hold:E=this.getClipTime(v.end,v);break;case Ac.Loop:E%=O;break;case Ac.PingPong:const L=Math.floor(E/O)%2!==0;E%=O,L&&(E=O-E);break}v.reversed===!0?y.time=y.getClip().duration-E:y.time=E,y.timeScale=0;const N=Math.max(0,R);if(y.weight=N,m+=N,y.clampWhenFinished=!1,y.isRunning()||y.play(),this._useclipOffsets){const L=h==0?this._totalOffsetPosition:this._totalOffsetPosition2,Q=h==0?this._totalOffsetRotation:this._totalOffsetRotation2;h<1&&(u=1-R),h+=1;const D=this._summedPos.set(0,0,0),F=this._tempPos.set(0,0,0),H=this._summedRot.identity(),K=this._tempRot.identity(),Z=A.rotation;Z&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(Z,R));const oe=this._actionOffsets[g];if(oe.hasOffsets)for(let we=0;we<P;we++)oe.rootPositionOffset?F.copy(oe.rootPositionOffset):F.set(0,0,0),F.applyQuaternion(H),this._clipRotQuat&&F.applyQuaternion(this._clipRotQuat),oe.rootQuaternionOffset&&(K.copy(oe.rootQuaternionOffset),H.multiply(K)),D.add(F);this._clipRotQuat&&Q.multiply(this._clipRotQuat),Q.multiply(H),A.position&&D.add(A.position),L.add(D)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,u),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,u)),this.__mixerError===void 0&&(bc||it())&&(r=(i=this._animator)==null?void 0:i.runtimeAnimatorController)!=null&&r.mixer&&this.mixer!==((o=(s=this._animator)==null?void 0:s.runtimeAnimatorController)==null?void 0:o.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(a=this._animator)!=null&&a.runtimeAnimatorController){const g=Math.max(0,1-m);(c=(l=this._animator)==null?void 0:l.runtimeAnimatorController)==null||c.update(g)}else this.mixer.update(e)}createRotationInterpolant(e,i,r){var s;const o=r.createInterpolant.bind(r),a=new Ce;this.ensureTrackOffsets();const l=(s=this.trackOffset)==null?void 0:s.rotation;r.createInterpolant=()=>{const c=o(),h=c.evaluate.bind(c);return c.evaluate=u=>{var d;const f=h(u);if(a.set(f[0],f[1],f[2],f[3]),a.premultiply(this._totalOffsetRotation),l&&a.premultiply(l),this.director.animationCallbackReceivers)for(const m of this.director.animationCallbackReceivers)(d=m?.onTimelineRotation)==null||d.call(m,this.director,this.target,u,a);return f[0]=a.x,f[1]=a.y,f[2]=a.z,f[3]=a.w,f},c}}createPositionInterpolant(e,i,r){var s,o;const a=r.createInterpolant.bind(r),l=new S;this.ensureTrackOffsets();const c=(s=this.trackOffset)==null?void 0:s.rotation,h=(o=this.trackOffset)==null?void 0:o.position;let u;r.createInterpolant=()=>{const d=a(),f=d.evaluate.bind(d);return d.evaluate=m=>{var g,v,y;const A=f(m);if(l.set(A[0],A[1],A[2]),i.removeStartOffset&&(u===void 0?(u=null,u=(v=(g=this._actionOffsets.find(b=>b.clip===e))==null?void 0:g.rootStartPosition)==null?void 0:v.clone()):u!=null&&u.isVector3&&l.sub(u)),l.applyQuaternion(this._totalOffsetRotation),l.add(this._totalOffsetPosition),c&&l.applyQuaternion(c),h&&(l.x-=h.x,l.y+=h.y,l.z+=h.z),this.director.animationCallbackReceivers)for(const b of this.director.animationCallbackReceivers)(y=b?.onTimelinePosition)==null||y.call(b,this.director,this.target,m,l);return A[0]=l.x,A[1]=l.y,A[2]=l.z,A},d}}}const M0e=te("mutetimeline"),Cb=class extends Sb{constructor(){super(...arguments),p(this,"models",[]),p(this,"listener"),p(this,"audio",[]),p(this,"audioContextTimeOffset",[]),p(this,"lastTime",0),p(this,"audioSource"),p(this,"_audioLoader",null),p(this,"_playableDirectorResumed",!1)}getAudioFilePath(n){const e=this.director.sourceId;return Du(e,n)}onAllowAudioChanged(n){for(let e=0;e<this.models.length;e++){const i=this.models[e];this.audio[e].setVolume(n?i.asset.volume:0)}}addModel(n){const e=new KR(this.listener);this.audio.push(e);const i=n;i._didTriggerPlay=!1,this.models.push(i)}onDisable(){for(const n of this.audio)n.isPlaying&&n.stop();for(const n of this.models)n._didTriggerPlay=!1}onDestroy(){for(const n of this.audio)n.source&&n?.disconnect();this.audio.length=0}onMuteChanged(){if(this.muted)for(let n=0;n<this.audio.length;n++){const e=this.audio[n];e!=null&&e.isPlaying&&e.stop()}}stop(){for(let n=0;n<this.audio.length;n++){const e=this.audio[n];e!=null&&e.isPlaying&&e.stop()}for(const n of this.models)n._didTriggerPlay=!1}onPauseChanged(){for(let n=0;n<this.audio.length;n++){const e=this.audio[n];e!=null&&e.isPlaying&&e.stop()}this._playableDirectorResumed=this.director.isPlaying}evaluate(n){if(M0e||this.track.muted||this.director.speed<0)return;const e=this.director.context.application.muted,i=this._playableDirectorResumed;this._playableDirectorResumed=!1;const r=e?.1:0;for(let s=0;s<this.models.length;s++){const o=this.models[s],a=this.audio[s],l=o.asset;if((!a||!a.buffer)&&this.isInTimeRange(o,n-1,n+1)&&this.handleAudioLoading(o,a),Pn.userInteractionRegistered!==!1&&!(a===null||!a.buffer))if(a.playbackRate=this.director.context.time.timeScale*this.director.speed,a.loop=l.loop,n>=o.start&&n<=o.end&&n<this.director.duration){if(!a.isPlaying||!this.director.isPlaying)(i||!o._didTriggerPlay&&this.lastTime<n)&&(o.duration*o.timeScale>.3?a.offset=o.clipIn+(n-o.start)*o.timeScale:a.offset=0,bc&&console.log("Timeline Audio ("+this.track.name+") play with offset "+a.offset+" - "+o.asset.clip),a.play(r),o._didTriggerPlay=!0);else{const h=o.clipIn+(n-o.start)*o.timeScale,u=a.context.currentTime-a._startedAt+a.offset;Math.abs(h-u)>.3&&(a.offset=h,a.stop(),a.play(r))}let c=l.volume;if(this.track.volume!==void 0&&(c*=this.track.volume),e&&(c=0),o.easeInDuration>0){const h=Math.min((n-o.start)/o.easeInDuration,1);c*=h}if(o.easeOutDuration>0){const h=Math.min((o.end-n)/o.easeOutDuration,1);c*=h}a.setVolume(c*this.director.weight)}else o._didTriggerPlay=!1,this.director.isPlaying&&a.isPlaying&&a.stop()}this.lastTime=n}loadAudio(n,e=0,i=0){let r=null;const s=n-i,o=n+e;for(const a of this.models)if(this.isInTimeRange(a,s,o)){const l=this.audio[this.models.indexOf(a)],c=this.handleAudioLoading(a,l);c!==null&&(r===null&&(r=[]),r.push(c))}return r!==null?Promise.all(r):null}isInTimeRange(n,e,i){return e<=n.start&&i>=n.end||e>=n.start&&e<=n.end||i>=n.start&&i<=n.end}static dispose(){Cb._audioBuffers.clear()}handleAudioLoading(n,e){this._audioLoader||(this._audioLoader=new Xw);const i=this.getAudioFilePath(n.asset.clip);if(Cb._audioBuffers.get(i)){const s=Cb._audioBuffers.get(i);return s.then(o=>{o&&e.setBuffer(o)}),s}bc&&console.warn("LOAD audio track",i,this.director.sourceId);const r=new Promise((s,o)=>{this._audioLoader.load(i,a=>{e.setBuffer(a),s(a)},void 0,a=>{console.error("Error loading audio",a),s(null)})});return Cb._audioBuffers.set(i,r),r}};let Eb=Cb;p(Eb,"_audioBuffers",new Map);class Mb extends Sb{constructor(){super(...arguments),p(this,"models",[]),p(this,"didTrigger",[]),p(this,"receivers",[])}evaluate(e){var i;if(this.track.muted)return;const r=this.director.context.time.deltaTime*1.5;for(let s=0;s<this.models.length;s++){const o=this.models[s],a=this.didTrigger[s],l=o.time-e;let c=!1;if(o.retroActive)c=l<=1e-6;else{const h=Math.abs(l);(h===0||h>=1e-5&&h<r)&&(c=!0)}if(c){if(!a)if(bc&&console.log("Trigger signal",e,o.time,o),this.didTrigger[s]=!0,((i=this.receivers)==null?void 0:i.length)<=0)P0.invoke(o.asset);else for(const h of this.receivers)h&&h.invoke(o.asset)}else o.emitOnce||(this.didTrigger[s]=!1)}}}class aE extends Sb{constructor(){super(...arguments),p(this,"models",[]),p(this,"timelines",[]),p(this,"_previousActiveModel",null)}resolveSourceObjects(e){for(let i=this.models.length-1;i>=0;i--){const r=this.models[i].asset;if(!r.sourceObject||typeof r.sourceObject!="object"){console.log("no source object, removing model",i,r),this.models.splice(i,1);continue}else{const s=ie.getComponent(r.sourceObject,Td);this.timelines.push(s),s&&r.updateDirector&&(s.playOnAwake=!1)}}}evaluate(e){var i;this._previousActiveModel=null;for(let r=0;r<this.models.length;r++){const s=this.models[r],o=s.asset;if(e>=s.start&&e<=s.end){this._previousActiveModel=s;const a=this.getClipTime(e,s);if(o.controlActivation){const l=o.sourceObject;l.visible=!0}if(o.updateDirector){const l=this.timelines[r];l&&(l.isPlaying&&l.pause(),l.time=a,l.evaluate())}}else{const a=(i=this._previousActiveModel)==null?void 0:i.asset;if(o.controlActivation){const l=o.sourceObject;a?.sourceObject!==l&&(l.visible=!1)}}}}}var T0e=Object.defineProperty,I0e=Object.getOwnPropertyDescriptor,ZQ=(n,e,i,r)=>{for(var s=r>1?void 0:r?I0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&T0e(e,i,s),s};const Gh=te("debugtimeline");var lD;const cD=(lD=class extends Be{constructor(){super(...arguments),p(this,"playableAsset"),p(this,"playOnAwake"),p(this,"extrapolationMode",1),p(this,"waitForAudio",!0),p(this,"_visibilityChangeEvt"),p(this,"_clonedPlayableAsset",!1),p(this,"_speed",1),p(this,"_guidsMap"),p(this,"_isPlaying",!1),p(this,"_internalUpdateRoutine"),p(this,"_isPaused",!1),p(this,"_isStopping",!1),p(this,"_time",0),p(this,"_duration",0),p(this,"_weight",1),p(this,"_animationTracks",[]),p(this,"_audioTracks",[]),p(this,"_signalTracks",[]),p(this,"_controlTracks",[]),p(this,"_customTracks",[]),p(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]),p(this,"animationCallbackReceivers",[])}static registerCreateTrack(n,e){this.createTrackFunctions[n]=e}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(n){typeof n=="number"&&!Number.isNaN(n)?this._time=n:(Gh||eo())&&console.error("INVALID TIMELINE.TIME VALUE",n,this.name)}get duration(){return this._duration}set duration(n){this._duration=n}get weight(){return this._weight}set weight(n){this._weight=n}get speed(){return this._speed}set speed(n){this._speed=n}awake(){var n,e,i,r,s;Gh&&console.log(this,(n=this.playableAsset)==null?void 0:n.tracks),this.rebuildGraph(),!this.isValid()&&(Gh||it())&&(Gh?console.warn("PlayableDirector is not valid","Asset?",this.playableAsset,"Tracks:",(e=this.playableAsset)==null?void 0:e.tracks,"IsArray?",Array.isArray((i=this.playableAsset)==null?void 0:i.tracks),this):(s=(r=this.playableAsset)==null?void 0:r.tracks)!=null&&s.length?console.warn("PlayableDirector is not valid"):console.warn("PlayableDirector has no tracks"))}onEnable(){var n,e,i;for(const r of this._audioTracks)(n=r.onEnable)==null||n.call(r);for(const r of this._customTracks)(e=r.onEnable)==null||e.call(r);for(const r of this._animationTracks)(i=r.onEnable)==null||i.call(r);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var n,e,i;this.stop();for(const r of this._audioTracks)(n=r.onDisable)==null||n.call(r);for(const r of this._customTracks)(e=r.onDisable)==null||e.call(r);for(const r of this._animationTracks)(i=r.onDisable)==null||i.call(r);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var n;for(const e of this._allTracks)for(const i of e)(n=i.onDestroy)==null||n.call(i)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const n=this._isPaused==!0;if(this._isPaused=!1,!this._isPlaying){if(this._isPlaying=!0,n&&this.invokePauseChangedMethodsOnTracks(),this.waitForAudio){const e=[];for(const i of this._audioTracks){const r=i.loadAudio(this._time,1,0);r&&e.push(r)}if(e.length>0&&(await Promise.all(e),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!Pn.userInteractionRegistered&&this.waitForAudio;)await $l(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),Xi.LateUpdate)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const i of this._audioTracks)i.stop();const n=this._isPaused==!0,e=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),n&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,n&&!e&&this.invokePauseChangedMethodsOnTracks(),e&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const n of this._allTracks)for(const e of n)yield e}get audioTracks(){return this._audioTracks}resolveGuids(n){this._guidsMap=n}invokePauseChangedMethodsOnTracks(){var n;for(const e of this.forEachTrack())(n=e.onPauseChanged)==null||n.call(e)}invokeStateChangedMethodsOnTracks(){var n;for(const e of this.forEachTrack())(n=e.onStateChanged)==null||n.call(e,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(n=!1){if(!this.isValid())return;let e=this._time;switch(this.extrapolationMode){case 0:this._speed>0?e=Math.min(e,this._duration):this._speed<0&&(e=Math.max(e,0)),this._time=e;break;case 1:e%=this._duration,this._time=e;break;case 2:if(e>this._duration){this.stop();return}break}const i=this._time;for(const r of this.playableAsset.tracks)if(!r.muted)switch(r.type){case ia.Activation:if(!n&&!this._isPlaying)continue;for(let s=0;s<r.outputs.length;s++){const o=r.outputs[s];if(typeof o=="object"){let a=!1;if(r.clips)for(const c of r.clips)c.start<=i&&i<=c.end&&(a=!0);const l=o;l.visible!==void 0&&l.visible!==a&&(l.visible=a,Gh&&console.warn(this.name,"set ActivationTrack-"+s,l.name,a,i))}}break}if(!this._isStopping)for(const r of this._animationTracks)r.evaluate(i);for(const r of this._audioTracks)r.evaluate(i);for(const r of this._signalTracks)r.evaluate(i);for(const r of this._controlTracks)r.evaluate(i);for(const r of this._customTracks)r.evaluate(i)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=Ly(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const n=this.findRoot(this.gameObject);for(const e of this.playableAsset.tracks){for(let i=e.outputs.length-1;i>=0;i--){let r=e.outputs[i];if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const s=ie.findByGuid(r,n);s===null||typeof s!="object"?(e.outputs.splice(i,1),console.warn("Failed to resolve binding",r,e.name,e.type)):(Gh&&console.log("Resolved binding",r,"to",s),e.outputs[i]=s)}else if(r===null){if(e.outputs.splice(i,1),cD.createTrackFunctions[e.type])continue;e.type!==ia.Audio&&e.type!==ia.Control&&e.type!==ia.Marker&&e.type!==ia.Signal&&console.warn("Missing binding",r,e.name,e.type,this.name,this.playableAsset.name)}}if(e.type===ia.Control&&e.clips)for(let i=0;i<e.clips.length;i++){const r=e.clips[i];let s=r.asset.sourceObject;if(typeof s=="string"){this._guidsMap&&this._guidsMap[s]&&(s=this._guidsMap[s]);const o=ie.findByGuid(s,n);o===null||typeof o!="object"?console.warn("Failed to resolve sourceObject binding",s,e.name,r):(Gh&&console.log("Resolved binding",s,"to",o),r.asset.sourceObject=o)}}}}findRoot(n){return n.parent?this.findRoot(n.parent):n}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const n of this.playableAsset.tracks)if(n.muted!==!0){if(n.clips)for(const e of n.clips)e.end>this._duration&&(this._duration=e.end);if(n.markers)for(const e of n.markers)e.time>this._duration&&(this._duration=e.time+.001)}}}setupAndCreateTrackHandlers(){var n,e,i;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;let r=ie.findObjectOfType(Ed,this.context);for(const s of this.playableAsset.tracks){const o=s.type,a=cD.createTrackFunctions[o];if(a!=null){const l=a(this,s);if(typeof l.evaluate=="function"){l.director=this,l.track=s,this._customTracks.push(l);continue}}if(s.type===ia.Animation){if(!s.clips||s.clips.length<=0){Gh&&console.warn("Animation track has no clips",s);continue}for(let l=s.outputs.length-1;l>=0;l--){let c=s.outputs[l];if(c instanceof ve){const u=ie.getOrAddComponent(c,rs);u&&(c=u)}const h=(n=c?.gameObject)==null?void 0:n.animations;if(h){const u=new oE;u.trackOffset=s.trackOffset,u.director=this,u.track=s;for(let d=0;d<s.clips.length;d++){const f=s.clips[d],m=f.asset;if(!m){console.error(`Timeline ${this.name}: clip #${d} on track "${s.name}" has no animation data`);continue}const g=m.clip;let v=g;if((typeof v=="string"||typeof v=="number")&&(v=h.find(A=>A.name===g)),Gh&&console.log(m,g,"\u2192",v),!v){console.warn("Could not find animationClip for model",f,s.name,this.name,(e=this.playableAsset)==null?void 0:e.name,h,c);continue}c instanceof rs&&c.runtimeAnimatorController&&(c.__internalDidAwakeAndStart||c.initializeRuntimeAnimatorController(),c.runtimeAnimatorController.mixer||c.runtimeAnimatorController.bind(c),u.mixer=c.runtimeAnimatorController.mixer),u.mixer||(u.mixer=new qw(c.gameObject),this.context.animations.registerAnimationMixer(u.mixer)),u.clips.push(v),u.mixer.uncacheAction(v),u.createHooks(f.asset,v);const y=u.mixer.clipAction(v);u.actions.push(y),u.models.push(f)}this._animationTracks.push(u)}}}else if(s.type===ia.Audio){if(!s.clips||s.clips.length<=0)continue;const l=new Eb;l.director=this,l.track=s,l.audioSource=s.outputs.find(c=>c instanceof Pn),this._audioTracks.push(l),r||(r=(i=this.context.mainCameraComponent)==null?void 0:i.gameObject.addNewComponent(Ed)),l.listener=r.listener;for(let c=0;c<s.clips.length;c++){const h=s.clips[c];l.addModel(h)}}else if(s.type===ia.Marker){const l=new Mb;if(l.director=this,l.track=s,s.markers)for(const c of s.markers)switch(c.type){case aD.Signal:l.models.push(c),l.didTrigger.push(!1);break}if(l!==null&&l.models.length>0){const c=ie.getComponent(this.gameObject,P0);c&&(l.receivers.push(c),this._signalTracks.push(l))}}else if(s.type===ia.Signal){const l=new Mb;if(l.director=this,l.track=s,s.markers)for(const c of s.markers)l.models.push(c),l.didTrigger.push(!1);for(const c of s.outputs)l.receivers.push(c);this._signalTracks.push(l)}else if(s.type===ia.Control){const l=new aE;if(l.director=this,l.track=s,s.clips)for(const c of s.clips)l.models.push(c);l.resolveSourceObjects(this.context),this._controlTracks.push(l)}}}setAudioTracksAllowPlaying(n){for(const e of this._audioTracks)e.onAllowAudioChanged(n)}registerAnimationCallback(n){this.animationCallbackReceivers.push(n)}unregisterAnimationCallback(n){const e=this.animationCallbackReceivers.indexOf(n);e!==-1&&this.animationCallbackReceivers.splice(e,1)}},p(lD,"createTrackFunctions",{}),lD);let Td=cD;ZQ([C()],Td.prototype,"playOnAwake",2),ZQ([C()],Td.prototype,"extrapolationMode",2);const lE=Symbol("objectIsAnimatedData");function $Q(n,e,i){if(!n)return;if(n[lE]===void 0){if(!i)return;n[lE]=new Set}const r=n[lE];i?r.add(e):r.has(e)&&r.delete(e)}function R0e(n){if(!n)return!1;const e=n[lE];return e!==void 0&&e.size>0}fi.registerCallback(Si.ContextCreated,n=>{const e=n.context.domElement.getAttribute("autoplay");if(e!==void 0&&(e===""||e==="true"||e==="1")&&n.files)for(const i of n.files)ie.foreachComponent(i.file.scene,r=>{if(r.enabled!==!1){if(r instanceof Fs&&r.playAutomatically||r instanceof rs||r instanceof Td&&r.playOnAwake===!0)return!0;if(r instanceof Fs)return r.playAutomatically=!0,!0;if(r instanceof Td)return r.playOnAwake=!0,!0}},!0)!==!0&&u0.assignAnimationsFromFile(i.file,{createAnimationComponent:(r,s)=>Zo(r,Fs)})});class P0e{constructor(){p(this,"_context")}get context(){return this._context??Ot.Current}get isStateMachineBehaviour(){return!0}}class Tb{constructor(e,i,r,s){p(this,"name"),p(this,"nameHash"),p(this,"normalizedTime"),p(this,"length"),p(this,"speed"),p(this,"action"),p(this,"hasTransitions");var o;this.name=e.name,this.nameHash=e.hash,this.normalizedTime=i,this.length=r,this.speed=s,this.action=e.motion.action||null,this.hasTransitions=((o=e.transitions)==null?void 0:o.length)>0||!1}}function e9(n,e){return{name:"Empty",isLooping:!1,guid:e?.generateUUID()??pi.generateUUID(),index:-1,clip:new $s(n,0,[])}}var Id=(n=>(n[n.If=1]="If",n[n.IfNot=2]="IfNot",n[n.Greater=3]="Greater",n[n.Less=4]="Less",n[n.Equals=6]="Equals",n[n.NotEqual=7]="NotEqual",n))(Id||{}),hD=(n=>(n[n.Float=1]="Float",n[n.Int=3]="Int",n[n.Bool=4]="Bool",n[n.Trigger=9]="Trigger",n))(hD||{});const Lr=te("debuganimatorcontroller"),cE=te("debugrootmotion");class ya{constructor(e){p(this,"_speed",1),p(this,"normalizedStartOffset",0),p(this,"animator"),p(this,"model"),p(this,"_mixer"),p(this,"_activeState"),p(this,"_activeStates",[]),p(this,"_heldActions",[]),p(this,"rootMotionHandler"),this.model=e,Lr&&console.log(this)}static createFromClips(e,i={looping:!1,autoTransition:!0,transitionDuration:0}){const r=[];for(let o=0;o<e.length;o++){const a=e[o],l=[];if(i.autoTransition!==!1){const h=i.transitionDuration??0,u=h/a.duration;let d=o;(i.autoTransition===void 0||i.autoTransition===!0)&&(d=(o+1)%e.length),l.push({exitTime:1-u,offset:0,duration:h,hasExitTime:!0,destinationState:d,conditions:[]})}const c={name:a.name,hash:o,motion:{name:a.name,clip:a,isLooping:i?.looping??!1},transitions:l,behaviours:[]};r.push(c)}const s={name:"AnimatorController",guid:new xr(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:r}}]};return new ya(s)}play(e,i=-1,r=Number.NEGATIVE_INFINITY,s=0){if(i<0)i=0;else if(i>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[i].stateMachine;for(const a of o.states)if(a.name===e||a.hash===e){Lr&&console.log("transition to ",a),this.transitionTo(a,s,r);return}console.warn("Could not find "+e+" to play")}reset(){this.setStartTransition()}setBool(e,i){var r,s;const o=typeof e=="string"?"name":"hash";return(s=(r=this.model)==null?void 0:r.parameters)==null?void 0:s.filter(a=>a[o]===e).forEach(a=>a.value=i)}getBool(e){var i,r,s;const o=typeof e=="string"?"name":"hash";return((s=(r=(i=this.model)==null?void 0:i.parameters)==null?void 0:r.find(a=>a[o]===e))==null?void 0:s.value)??!1}setFloat(e,i){var r,s;const o=typeof e=="string"?"name":"hash",a=(s=(r=this.model)==null?void 0:r.parameters)==null?void 0:s.filter(l=>l[o]===e);return a.forEach(l=>l.value=i),a?.length>0}getFloat(e){var i,r,s;const o=typeof e=="string"?"name":"hash";return((s=(r=(i=this.model)==null?void 0:i.parameters)==null?void 0:r.find(a=>a[o]===e))==null?void 0:s.value)??0}setInteger(e,i){var r,s;const o=typeof e=="string"?"name":"hash";return(s=(r=this.model)==null?void 0:r.parameters)==null?void 0:s.filter(a=>a[o]===e).forEach(a=>a.value=i)}getInteger(e){var i,r,s;const o=typeof e=="string"?"name":"hash";return((s=(r=(i=this.model)==null?void 0:i.parameters)==null?void 0:r.find(a=>a[o]===e))==null?void 0:s.value)??0}setTrigger(e){var i,r;Lr&&console.log("SET TRIGGER",e);const s=typeof e=="string"?"name":"hash";return(r=(i=this.model)==null?void 0:i.parameters)==null?void 0:r.filter(o=>o[s]===e).forEach(o=>o.value=!0)}resetTrigger(e){var i,r;const s=typeof e=="string"?"name":"hash";return(r=(i=this.model)==null?void 0:i.parameters)==null?void 0:r.filter(o=>o[s]===e).forEach(o=>o.value=!1)}getTrigger(e){var i,r,s;const o=typeof e=="string"?"name":"hash";return((s=(r=(i=this.model)==null?void 0:i.parameters)==null?void 0:r.find(a=>a[o]===e))==null?void 0:s.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(e){this._speed=e}FindState(e){return this.findState(e)}findState(e){if(!e)return null;if(Array.isArray(this.model.layers)){for(const i of this.model.layers)for(const r of i.stateMachine.states)if(r.name===e||r.hash==e)return r}return null}getCurrentStateInfo(){if(!this._activeState)return null;const e=this._activeState.motion.action;if(!e)return null;const i=this._activeState.motion.clip.duration,r=i<=0?0:Math.abs(e.time/i);return new Tb(this._activeState,r,i,this._speed)}get currentAction(){return this._activeState&&this._activeState.motion.action||null}get context(){var e;return(e=this.animator)==null?void 0:e.context}get mixer(){return this._mixer}dispose(){var e;if(this._mixer.stopAllAction(),this.animator){this._mixer.uncacheRoot(this.animator.gameObject);for(const i of this._activeStates)i.motion.clip&&this.mixer.uncacheAction(i.motion.clip,this.animator.gameObject)}(e=this.context)==null||e.animations.unregisterAnimationMixer(this._mixer)}bind(e){var i,r;e?this.animator!==e&&(this._mixer&&(this._mixer.stopAllAction(),(i=this.context)==null||i.animations.unregisterAnimationMixer(this._mixer)),this.animator=e,this._mixer=new qw(this.animator.gameObject),(r=this.context)==null||r.animations.registerAnimationMixer(this._mixer),this.createActions(this.animator)):console.error("AnimatorController.bind: animator is null")}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;Lr&&console.warn("AnimatorController clone()",this.model);const e=Ly(this.model,(i,r,s)=>s==null?!0:!(s.type==="Object3D"||s.isObject3D===!0||Ij(s)||s.tracks!==void 0||s instanceof ya));return console.assert(e!==this.model),new ya(e)}update(e){var i,r;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(e);const s=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((i=this.rootMotionHandler)==null||i.onBeforeUpdate(e)),this._mixer.update(s),this.animator.applyRootMotion&&((r=this.rootMotionHandler)==null||r.onAfterUpdate(e))}get activeState(){return this._activeState}updateActiveStates(e){for(let i=0;i<this._activeStates.length;i++){const r=this._activeStates[i],s=r.motion;if(!s.action)this._activeStates.splice(i,1),i--;else{const o=s.action;o.weight=e,o.getEffectiveWeight()<=0&&!o.isRunning()&&(Lr&&console.debug("REMOVE",r.name,o.getEffectiveWeight(),o.isRunning(),o.isScheduled()),this._activeStates.splice(i,1),i--)}}}setStartTransition(){var e;this.model.layers.length>1&&(Lr||it())&&console.warn("Multiple layers are not supported yet "+((e=this.animator)==null?void 0:e.name));for(const i of this.model.layers){const r=i.stateMachine;r.defaultState===void 0&&(Lr&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",i),r.defaultState=0);const s=r.states[r.defaultState];this.transitionTo(s,0,this.normalizedStartOffset);break}}evaluateTransitions(){var e;let i=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;i=!0}const r=this._activeState,s=r.motion.action;for(const a of r.transitions){if(!a.hasExitTime&&a.conditions.length<=0)continue;let l=!0;for(const c of a.conditions)if(!this.evaluateCondition(c)){l=!1;break}if(l)if(s){const c=r.motion.clip.duration,h=c<=0?1:Math.abs(s.time/c);let u=a.exitTime;s.timeScale<0&&(u=1-u);let d=!1;if(a.hasExitTime?s.timeScale>0?d=h>=a.exitTime:s.timeScale<0&&(d=1-h>=a.exitTime):d=!0,d){for(const f of a.conditions){const m=this.model.parameters.find(g=>g.name===f.parameter);m?.type===hD.Trigger&&m.value&&(m.value=!1)}if(s.clampWhenFinished=!0,Lr){const f=this.getState(a.destinationState,0);console.log(`Transition to ${a.destinationState} / ${f?.name}`,a,`
Timescale: `+s.timeScale,`
Normalized time: `+h.toFixed(3),`
Exit Time: `+u,a.hasExitTime)}this.transitionTo(a.destinationState,a.duration,a.offset);return}}else{this.transitionTo(a.destinationState,a.duration,a.offset);return}}s&&this.setTimescale(s,r);let o=!1;if(r.motion.isLooping&&s&&(s.time>=s.getClip().duration?(o=!0,s.reset(),s.time=0,s.play()):s.time<=0&&s.timeScale<0&&(o=!0,s.reset(),s.time=s.getClip().duration,s.play())),!o&&r&&!i&&s&&this.animator&&r.behaviours){const a=s?.getClip().duration,l=s.time/a,c=new Tb(this._activeState,l,a,this._speed);for(const h of r.behaviours)h.instance&&((e=h.instance.onStateUpdate)==null||e.call(h.instance,this.animator,c,0))}}setTimescale(e,i){let r=i.speed??1;i.speedParameter&&(r*=this.getFloat(i.speedParameter)),r!==void 0&&(e.timeScale=r*this._speed)}getState(e,i){return typeof e=="number"&&(e==-1&&(e=this.model.layers[i].stateMachine.defaultState,e===void 0&&(Lr&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+i),e=0)),e=this.model.layers[i].stateMachine.states[e]),e}releaseHeldActions(e){for(const i of this._heldActions)i.fadeOut(e);this._heldActions.length=0}transitionTo(e,i,r){var s,o,a,l,c,h,u,d;if(!this.animator)return;const f=0;if(e=this.getState(e,f),!(e!=null&&e.motion)||!e.motion.clip||!(e.motion.clip instanceof $s))return;const m=this._activeState===e;if(m){const b=e.motion;if(!b.action_loopback&&b.clip){const x=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(b.clip,this.animator.gameObject),x&&x.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),b.action_loopback=this.createAction(b.clip)}}if((s=this._activeState)!=null&&s.behaviours&&this._activeState.motion.action){const b=(o=this._activeState)==null?void 0:o.motion.clip.duration,x=this._activeState.motion.action.time/b,_=new Tb(this._activeState,x,b,this._speed);for(const w of this._activeState.behaviours)(l=(a=w.instance)==null?void 0:a.onStateExit)==null||l.call(w.instance,this.animator,_,f)}const g=(c=this._activeState)==null?void 0:c.motion.action;m&&(e.motion.action=e.motion.action_loopback,e.motion.action_loopback=g);const v=this._activeState;this._activeState=e;const y=(h=e.motion)==null?void 0:h.action,A=e.motion.clip;if(A?.duration<=0&&A.tracks.length<=0?g&&this._heldActions.push(g):g&&(g.fadeOut(i),this.releaseHeldActions(i)),y){if(r=Math.max(0,Math.min(1,r)),e.cycleOffsetParameter){let x=this.getFloat(e.cycleOffsetParameter);typeof x=="number"?(x<0&&(x+=1),r+=x,r%=1):Lr&&console.warn("AnimatorController cycle offset parameter is not a number",e.cycleOffsetParameter)}else typeof e.cycleOffset=="number"&&(r+=e.cycleOffset,r%=1);y.isRunning()&&y.stop(),y.reset(),y.enabled=!0,this.setTimescale(y,e);const b=e.motion.clip.duration;if(y.time=m?0:r*b,y.timeScale<0&&(y.time=b-y.time),y.clampWhenFinished=!0,y.setLoop(ey,0),i>0?y.fadeIn(i):y.weight=1,y.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(y),this._activeStates.includes(e)||this._activeStates.push(e),this._activeState.behaviours){const x=new Tb(e,r,b,this._speed);for(const _ of this._activeState.behaviours)(d=(u=_.instance)==null?void 0:u.onStateEnter)==null||d.call(_.instance,this.animator,x,f)}}else Lr&&(e.__warned_no_motion||(e.__warned_no_motion=!0,console.warn("No action",e.motion,this)));Lr&&console.log("TRANSITION FROM "+v?.name+" TO "+e.name,i,g,y,y?.getEffectiveTimeScale(),y?.getEffectiveWeight(),y?.isRunning(),y?.isScheduled(),y?.paused)}createAction(e){var i,r;if(this._mixer.existingAction(e)&&this._mixer.uncacheAction(e,(i=this.animator)==null?void 0:i.gameObject),(r=this.animator)!=null&&r.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new B0e(this));const s=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,s,e)}else return this._mixer.clipAction(e)}evaluateCondition(e){const i=this.model.parameters.find(r=>r.name===e.parameter);if(!i)return!1;switch(e.mode){case Id.If:return i.value===!0;case Id.IfNot:return i.value===!1;case Id.Greater:return i.value>e.threshold;case Id.Less:return i.value<e.threshold;case Id.Equals:return i.value===e.threshold;case Id.NotEqual:return i.value!==e.threshold}return!1}createActions(e){var i,r,s,o;Lr&&console.log("AnimatorController createActions",this.model);for(const a of this.model.layers){const l=a.stateMachine;for(let c=0;c<l.states.length;c++){const h=l.states[c];h.transitions||(h.transitions=[]);for(const u of h.transitions)u.conditions||(u.conditions=[]);if(h.motion||(Lr&&console.warn("No motion",h),h.motion=e9(h.name)),this.animator&&h.motion.clips){const u=(i=h.motion.clips)==null?void 0:i.find(d=>{var f,m;return d.node.name===((m=(f=this.animator)==null?void 0:f.gameObject)==null?void 0:m.name)});u?h.motion.clip=u.clip:(Lr||it())&&console.warn('Could not find clip for animator "'+((s=(r=this.animator)==null?void 0:r.gameObject)==null?void 0:s.name)+'"',h.motion.clips.map(d=>d.node.name))}if(!h.motion.clip){Lr&&console.warn("No clip assigned to state",h);const u=new $s(void 0,void 0,[]);h.motion.clip=u}if((o=h.motion)!=null&&o.clip){const u=h.motion.clip;if(u instanceof $s){const d=this.createAction(u);h.motion.action=d}else(Lr||it())&&console.warn("No valid animationclip assigned",h)}if(h.behaviours&&Array.isArray(h.behaviours))for(const u of h.behaviours){if(!(u!=null&&u.typeName))continue;const d=q.get(u.typeName),f=new d;f.isStateMachineBehaviour&&(f._context=this.context??void 0,o0(f,u.properties),u.instance=f),Lr&&console.log("Created animator controller behaviour",h.name,u.typeName,u.properties,f)}}}}*enumerateActions(){if(this.model.layers)for(const e of this.model.layers){const i=e.stateMachine;for(let r=0;r<i.states.length;r++){const s=i.states[r];s!=null&&s.motion&&(s.motion.action&&(yield s.motion.action),s.motion.action_loopback&&(yield s.motion.action_loopback))}}}}class t9{constructor(e,i){p(this,"track"),p(this,"createdInterpolant"),p(this,"originalEvaluate"),p(this,"customEvaluate"),this.track=e;const r=e,s=r.createInterpolant.bind(e);r.createInterpolant=()=>(r.createInterpolant=s,this.createdInterpolant=s(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=o=>{if(!this.originalEvaluate)return;const a=this.originalEvaluate(o);return i(o,a)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const Ur=class{constructor(n,e,i,r,s){if(p(this,"_action"),p(this,"root"),p(this,"clip"),p(this,"positionWrapper",null),p(this,"rotationWrapper",null),p(this,"context"),p(this,"positionChange",new S),p(this,"rotationChange",new Ce),p(this,"_prevTime",0),this.context=n,this.root=e,this.clip=i,Ur.firstKeyframeRotation[this.cacheId]||(Ur.firstKeyframeRotation[this.cacheId]=new Ce),s){const o=s.values;Ur.firstKeyframeRotation[this.cacheId].set(o[0],o[1],o[2],o[3])}Ur.spaceRotation[this.cacheId]||(Ur.spaceRotation[this.cacheId]=new Ce),Ur.effectiveSpaceRotation[this.cacheId]||(Ur.effectiveSpaceRotation[this.cacheId]=new Ce),Ur.clipOffsetRotation[this.cacheId]=new Ce,s&&Ur.clipOffsetRotation[this.cacheId].set(s.values[0],s.values[1],s.values[2],s.values[3]).invert(),this.handlePosition(i,r),this.handleRotation(i,s)}set action(n){this._action=n}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(n){if(n.getClip()!==this.clip)return;Ur.lastObjRotation[this.cacheId]||(Ur.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const e=Ur.lastObjRotation[this.cacheId];if(Ur.spaceRotation[this.cacheId].copy(e),cE){const i=new ri().setFromQuaternion(e);console.log("START",this.clip.name,tt.toDegrees(i.y),this.root.position.z)}}getClipRotationOffset(){return Ur.clipOffsetRotation[this.cacheId]}handlePosition(n,e){if(e){const i=this.root;cE&&i.add(new Vo),Ur.lastObjPosition[this.cacheId]||(Ur.lastObjPosition[this.cacheId]=this.root.position.clone());const r=new S,s=new S;this.positionWrapper=new t9(e,(o,a)=>{const l=this.action.getEffectiveWeight();return cE&&i.position.length()>8&&i.position.set(0,i.position.y,0),o>this._prevTime&&(r.set(a[0],a[1],a[2]),r.sub(s),r.multiplyScalar(l),r.applyQuaternion(this.getClipRotationOffset()),r.applyQuaternion(i.quaternion),this.positionChange.copy(r)),s.fromArray(a),this._prevTime=o,a[0]=0,a[1]=0,a[2]=0,a})}}handleRotation(n,e){if(e){if(cE){const o=e.values,a=new ri().setFromQuaternion(new Ce(o[0],o[1],o[2],o[3]));console.log(n.name,e.name,"FIRST ROTATION IN TRACK",tt.toDegrees(a.y));const l=e.values.length-4,c=new Ce().set(o[l],o[l+1],o[l+2],o[l+3]),h=new ri().setFromQuaternion(c);console.log(n.name,e.name,"LAST ROTATION IN TRACK",tt.toDegrees(h.y))}let i=0;const r=new Ce,s=new Ce;this.rotationWrapper=new t9(e,(o,a)=>(o>i&&(s.set(a[0],a[1],a[2],a[3]),r.invert(),s.multiply(r),this.rotationChange.copy(s)),r.fromArray(a),i=o,a[0]=0,a[1]=0,a[2]=0,a[3]=1,a))}}onBeforeUpdate(n){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(n){return!this.action||(n*=this.action.getEffectiveWeight(),n<=0)?!1:(this.positionChange.multiplyScalar(n),this.rotationChange.slerp(Ur.identityQuaternion,1-n),!0)}};let Rd=Ur;p(Rd,"lastObjPosition",{}),p(Rd,"lastObjRotation",{}),p(Rd,"firstKeyframeRotation",{}),p(Rd,"spaceRotation",{}),p(Rd,"effectiveSpaceRotation",{}),p(Rd,"clipOffsetRotation",{}),p(Rd,"identityQuaternion",new Ce);class B0e{constructor(e){p(this,"controller"),p(this,"handler",[]),p(this,"root"),p(this,"basePosition",new S),p(this,"baseQuaternion",new Ce),p(this,"baseRotation",new ri),p(this,"summedPosition",new S),p(this,"summedRotation",new Ce),this.controller=e}createClip(e,i,r){this.root=i,i&&"name"in i&&i.name;const s=this.findRootTrack(r,".position"),o=this.findRootTrack(r,".quaternion"),a=new Rd(this.controller.context,i,r,s,o);this.handler.push(a);const l=e.clipAction(r);return a.action=l,l}onStart(e){for(const i of this.handler)i.onStart(e)}onBeforeUpdate(e){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const i of this.handler)i.onBeforeUpdate(e)}onAfterUpdate(e){if(!(e<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const i of this.handler)i.onAfterUpdate(e)&&(this.summedPosition.add(i.positionChange),this.summedRotation.multiply(i.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(e,i){const r=e.tracks;if(!r)return null;for(const s of r)if(s.name.endsWith(i))return s;return null}}class k0e extends La{onSerialize(e,i){}onDeserialize(e,i){if(i.type===ya&&e?.__type==="AnimatorController")return new ya(e)}}new k0e(ya);var O0e=Object.defineProperty,D0e=Object.getOwnPropertyDescriptor,hE=(n,e,i,r)=>{for(var s=r>1?void 0:r?D0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&O0e(e,i,s),s};const Va=te("debuganimator");class rs extends Be{constructor(){super(...arguments),p(this,"applyRootMotion",!1),p(this,"hasRootMotion",!1),p(this,"keepAnimatorControllerStateOnDisable",!1),p(this,"_parametersAreDirty",!1),p(this,"_isDirty",!1),p(this,"_speed",1),p(this,"_normalizedStartOffset",0),p(this,"_animatorController",null),p(this,"_initializeWithRuntimeAnimatorController")}get isAnimationComponent(){return!0}set runtimeAnimatorController(e){var i;this._animatorController&&this._animatorController.model===e||(e?e instanceof ya?(e.animator&&e.animator!==this&&(console.warn("AnimatorController can not be bound to multiple animators",(i=e.model)==null?void 0:i.name),e.model||console.error("AnimatorController has no model"),e=new ya(e.model)),this._animatorController=e,this._animatorController.bind(this)):(Va&&console.log("Assign animator controller",e,this),this._animatorController=new ya(e),this.__didAwake&&this._animatorController.bind(this)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}getCurrentStateInfo(){var e;return(e=this.runtimeAnimatorController)==null?void 0:e.getCurrentStateInfo()}get currentAction(){var e;return((e=this.runtimeAnimatorController)==null?void 0:e.currentAction)||null}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(e,i=-1,r=Number.NEGATIVE_INFINITY,s=0){this.play(e,i,r,s)}play(e,i=-1,r=Number.NEGATIVE_INFINITY,s=0){var o;(o=this.runtimeAnimatorController)==null||o.play(e,i,r,s),this._isDirty=!0}Reset(){this.reset()}reset(){var e;(e=this._animatorController)==null||e.reset(),this._isDirty=!0}SetBool(e,i){this.setBool(e,i)}setBool(e,i){var r,s;Va&&console.log("setBool",e,i),((r=this.runtimeAnimatorController)==null?void 0:r.getBool(e))!==i&&(this._parametersAreDirty=!0),(s=this.runtimeAnimatorController)==null||s.setBool(e,i)}GetBool(e){return this.getBool(e)}getBool(e){var i;const r=((i=this.runtimeAnimatorController)==null?void 0:i.getBool(e))??!1;return Va&&console.log("getBool",e,r),r}toggleBool(e){this.setBool(e,!this.getBool(e))}SetFloat(e,i){this.setFloat(e,i)}setFloat(e,i){var r,s;((r=this.runtimeAnimatorController)==null?void 0:r.getFloat(e))!==i&&(this._parametersAreDirty=!0),Va&&console.log("setFloat",e,i),(s=this.runtimeAnimatorController)==null||s.setFloat(e,i)}GetFloat(e){return this.getFloat(e)}getFloat(e){var i;const r=((i=this.runtimeAnimatorController)==null?void 0:i.getFloat(e))??-1;return Va&&console.log("getFloat",e,r),r}SetInteger(e,i){this.setInteger(e,i)}setInteger(e,i){var r,s;((r=this.runtimeAnimatorController)==null?void 0:r.getInteger(e))!==i&&(this._parametersAreDirty=!0),Va&&console.log("setInteger",e,i),(s=this.runtimeAnimatorController)==null||s.setInteger(e,i)}GetInteger(e){return this.getInteger(e)}getInteger(e){var i;const r=((i=this.runtimeAnimatorController)==null?void 0:i.getInteger(e))??-1;return Va&&console.log("getInteger",e,r),r}SetTrigger(e){this.setTrigger(e)}setTrigger(e){var i;this._parametersAreDirty=!0,Va&&console.log("setTrigger",e),(i=this.runtimeAnimatorController)==null||i.setTrigger(e)}ResetTrigger(e){this.resetTrigger(e)}resetTrigger(e){var i;this._parametersAreDirty=!0,Va&&console.log("resetTrigger",e),(i=this.runtimeAnimatorController)==null||i.resetTrigger(e)}GetTrigger(e){this.getTrigger(e)}getTrigger(e){var i;const r=(i=this.runtimeAnimatorController)==null?void 0:i.getTrigger(e);return Va&&console.log("getTrigger",e,r),r}IsInTransition(){return this.isInTransition()}isInTransition(){var e;return((e=this.runtimeAnimatorController)==null?void 0:e.isInTransition())??!1}SetSpeed(e){return this.setSpeed(e)}setSpeed(e){var i;e!==this._speed&&(Va&&console.log("setSpeed",e),this._speed=e,((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(e))}set minMaxSpeed(e){var i;this._speed=tt.lerp(e.x,e.y,Math.random()),((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(this._speed)}set minMaxOffsetNormalized(e){var i;this._normalizedStartOffset=tt.lerp(e.x,e.y,Math.random()),((i=this.runtimeAnimatorController)==null?void 0:i.animator)==this&&(this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset)}awake(){Va&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(e=!1){const i=e||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&i){const r=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=r,r?(console.assert(this.runtimeAnimatorController!==r),this.runtimeAnimatorController=r,console.assert(this.runtimeAnimatorController===r),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this._speed),this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var e;this.keepAnimatorControllerStateOnDisable||(e=this._animatorController)==null||e.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!R0e(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}hE([C()],rs.prototype,"applyRootMotion",2),hE([C()],rs.prototype,"hasRootMotion",2),hE([C()],rs.prototype,"keepAnimatorControllerStateOnDisable",2),hE([C()],rs.prototype,"runtimeAnimatorController",1);const xc=te("debugusdzanimation"),uD=te("debugusdzanimationserialization");class uE{constructor(e,i,r){p(this,"_start"),p(this,"ext"),p(this,"root"),p(this,"clip"),p(this,"speed"),this.ext=e,this.root=i,this.clip=r}get start(){return this._start===void 0&&(this._start=this.ext.getStartTime01(this.root,this.clip)),this._start}get duration(){var e;return((e=this.clip)==null?void 0:e.duration)??Fr.restPoseClipDuration}}const i9=class{constructor(n,e,i){p(this,"clip"),p(this,"pos"),p(this,"rot"),p(this,"scale"),p(this,"root"),p(this,"target"),p(this,"duration",0),p(this,"useRootMotion",!1),this.root=n,this.target=e,this.clip=i,i?this.duration=i.duration:this.duration=i9.restPoseClipDuration;const r=ie.getComponent(n,rs);r&&(this.useRootMotion=r.applyRootMotion)}get frameRate(){return 60}addTrack(n){var e,i;if(!this.clip){console.error("This is a rest clip but you're trying to add tracks to it \u2013 this is likely a bug");return}n.name.endsWith("position")?this.pos=n:n.name.endsWith("quaternion")?this.rot=n:n.name.endsWith("scale")?this.scale=n:(n.name.endsWith("activeSelf")?console.warn("[USDZ] Animation of enabled/disabled state is not supported for USDZ export and will NOT be exported: "+n.name+" on "+(((e=this.root)==null?void 0:e.name)??this.target.name)+". Animate scale 0/1 instead."):console.warn("[USDZ] Animation track type not supported for USDZ export and will NOT be exported: "+n.name+" on "+(((i=this.root)==null?void 0:i.name)??this.target.name)+". Only .position, .rotation, .scale are supported."),it()&&Pi("[USDZ] Some animations can't be exported. See console for details."))}getFrames(){var n,e,i,r,s,o;return this.clip?Math.max(((e=(n=this.pos)==null?void 0:n.times)==null?void 0:e.length)??0,((r=(i=this.rot)==null?void 0:i.times)==null?void 0:r.length)??0,((o=(s=this.scale)==null?void 0:s.times)==null?void 0:o.length)??0):2}getDuration(){return this.duration}getSortedTimesArray(n=!0,e=!0,i=!0){var r,s,o;if(!this.clip)return[0,this.duration];const a=(r=this.pos)==null?void 0:r.times,l=(s=this.rot)==null?void 0:s.times,c=(o=this.scale)==null?void 0:o.times,h=[];if(n&&a)for(const u of a)h.push(u);if(e&&l)for(const u of l)h.push(u);if(i&&c)for(const u of c)h.push(u);return h.includes(0)||h.push(0),h.sort((u,d)=>u-d),[...new Set(h)]}*getValues(n,e=!0,i=!0,r=!0){var s,o,a;const l=new S,c=new Ce,h=new S(1,1,1),u=this.target,d=e?(s=this.pos)==null?void 0:s.createInterpolant():void 0,f=i?(o=this.rot)==null?void 0:o.createInterpolant():void 0,m=r?(a=this.scale)==null?void 0:a.createInterpolant():void 0;d||l.set(u.position.x,u.position.y,u.position.z),f||c.set(u.quaternion.x,u.quaternion.y,u.quaternion.z,u.quaternion.w),m||h.set(u.scale.x,u.scale.y,u.scale.z);for(let g=0;g<n.length;g++){const v=n[g];if(d){const y=d.evaluate(v);l.set(y[0],y[1],y[2])}if(f){const y=f.evaluate(v);c.set(y[0],y[1],y[2],y[3])}if(m){const y=m.evaluate(v);h.set(y[0],y[1],y[2])}if(this.useRootMotion&&u===this.root){const y=new he;y.compose(l,c,h),y.multiply(u.matrix),y.decompose(l,c,h)}yield{time:v,translation:l,rotation:c,scale:h,index:g}}}};let Fr=i9;p(Fr,"animationDurationPadding",1/60),p(Fr,"restPoseClipDuration",1/60);class Ib{constructor(e){p(this,"dict",new Map),p(this,"rootTargetMap",new Map),p(this,"rootAndClipToRegisteredAnimationMap",new Map),p(this,"rootToRegisteredClip",new Map),p(this,"serializers",[]),p(this,"injectRestPoses",!1),p(this,"injectImplicitBehaviours",!1),this.injectRestPoses=e,this.injectImplicitBehaviours=e}get extensionName(){return"animation"}getStartTimeCode(){return!this.injectRestPoses||this.rootAndClipToRegisteredAnimationMap.size===0?0:(Fr.restPoseClipDuration+Fr.animationDurationPadding)*60}getEndTimeCode(){let e=0;for(const[i,r]of this.rootAndClipToRegisteredAnimationMap){const s=r.start+r.duration;s>e&&(e=s)}return e*60}getClipCount(e){var i;return((i=this.rootToRegisteredClip.get(e))==null?void 0:i.length)??0??0}getStartTime01(e,i){if(!i)return 0;const r=this.rootTargetMap.get(e);if(!r)return 0;const s=this.dict.get(r[0]);if(!s)return console.error("Trying to get start time for root that has no animation data",e,i,...this.dict),0;let o=0;for(let a=0;a<s.length&&s[a].clip!==i;a++)o+=s[a].getDuration()+Fr.animationDurationPadding;return o}registerAnimation(e,i){var r;if(!e)return null;this.rootTargetMap.has(e)||this.rootTargetMap.set(e,[]);const s=e.uuid+(i?.uuid??"-rest");if(this.rootAndClipToRegisteredAnimationMap.has(s))return this.rootAndClipToRegisteredAnimationMap.get(s);xc&&console.log("registerAnimation",e,i);const o=this.injectRestPoses?1:0,a=(((r=this.rootToRegisteredClip.get(e))==null?void 0:r.length)??0)+o,l=this.rootTargetMap.get(e),c=new Set(l);if(i&&i.tracks)for(const u of i.tracks){const d=Yt.parseTrackName(u.name),f=Yt.findNode(e,d.nodeName);if(!f){console.warn("no object found for track",u.name,"using "+e.name+" instead");continue}this.dict.has(f)||this.dict.set(f,[]);const m=this.dict.get(f);if(!m){console.warn("no transform data found for target ",f,"at slot "+a+", this is likely a bug");continue}c.delete(f),this.injectRestPoses&&!m[0]&&(m[0]=new Fr(null,f,null));let g=m[a];g||(g=new Fr(e,f,i),m[a]=g),g.addTrack(u),l!=null&&l.includes(f)||l==null||l.push(f)}xc&&console.log("Unregistered nodes for this clip",c,"clip",i,"at slot",a,"for root",e,"targets",l);for(const u of c){const d=this.dict.get(u);if(!d)continue;if(this.injectRestPoses&&!d[0]){console.warn("Adding rest pose for ",u,i,"at slot",a,"This is likely a bug, should have been added earlier.");const m=new Fr(null,u,null);d[0]=m}let f=d[a];f||(xc&&console.log("Adding padding clip for ",u,i,"at slot",a),f=new Fr(e,u,i),d[a]=f)}const h=new uE(this,e,i);if(this.rootAndClipToRegisteredAnimationMap.set(s,h),xc&&console.log({root:e,clip:i,info:h}),i){const u=this.rootToRegisteredClip.get(e);u?u.push(i):this.rootToRegisteredClip.set(e,[i])}return h}onAfterHierarchy(e){xc&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(e){var i,r;xc&&console.log("Animation data",{dict:this.dict,rootTargetMap:this.rootTargetMap,rootToRegisteredClip:this.rootToRegisteredClip});for(const s of this.rootTargetMap.keys()){const o=this.rootTargetMap.get(s);if(!o)continue;let a;const l=[];for(const c of o){const h=this.dict.get(c);if(!h){console.error("No data found for target on USDZ export \u2013 please report a bug!",c);continue}a===void 0&&(a=h?.length),a!==h?.length&&console.error("Different array lengths for targets \u2013 please report a bug!",h);for(let u=0;u<h.length;u++){let d=h[u];if(!d){const m=u-(this.injectRestPoses?1:0);h[u]=new Fr(null,c,this.rootToRegisteredClip.get(s)[m]),d=h[u]}const f=d.getDuration();if(l[u]===void 0)l[u]=f;else if(l[u]!==f){console.error("Error during UDSZ export: Encountered different animation durations for animated targets. Please report a bug!",{datas:h,target:c}),l[u]=f;continue}}}}for(const s of this.serializers){const o=(i=s.model)==null?void 0:i.parent,a=o?.isDynamic===!0;uD&&console.log(a,(r=s.model)==null?void 0:r.parent),a&&s.registerCallback(o)}}onExportObject(e,i,r){ie.foreachComponent(e,o=>{const a=o;typeof a.createAnimation=="function"&&a.createAnimation(this,i,r)},!1);const s=new L0e(e,this.dict);this.serializers.push(s),s.registerCallback(i)}}class L0e{constructor(e,i){p(this,"object"),p(this,"dict"),p(this,"model"),p(this,"callback"),this.object=e,this.dict=i}registerCallback(e){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),uD&&console.log("REPARENT",e),this.model=e,this.callback&&this.model.addEventListener("serialize",this.callback)}skinnedMeshExport(e,i){var r;const s=this.model,o=this.dict;if(s&&s.skinnedMesh){let a=function(P){const O=[];for(const[N,L]of P){let Q=`${N} : [`;const D=[];for(const F of L)D.push(`(${Br(F.x)}, ${Br(F.y)}, ${Br(F.z)})`);Q=Q.concat(D.join(", ")),Q=Q.concat("],"),O.push(Q)}return O},l=function(P){const O=[];for(const[N,L]of P){let Q=`${N} : [`;const D=[];for(const F of L)D.push(`(${Br(F.w)}, ${Br(F.x)}, ${Br(F.y)}, ${Br(F.z)})`);Q=Q.concat(D.join(", ")),Q=Q.concat("],"),O.push(Q)}return O},c=function(P){let O,N=!0;const L=new Map;for(const[D,F]of P){O===void 0&&(O=F.length),O!==F.length&&(N=!1);let H=0;for(const K of F)H++,K||(L.has(D)||L.set(D,[]),L.get(D).push(H))}xc&&console.log("Bone count: ",P.size,"TransformData entries per bone: ",O,"Undefined bone entries: ",L),console.assert(N,"All bones should have the same number of TransformData entries",P),console.assert(L.size===0,"All TransformData entries should be set",L);const Q=[];for(const[D,F]of P){const H=new Array;let K=0;for(let Z=0;Z<F.length;Z++)H.push(K),K+=F[Z].getDuration()+Fr.animationDurationPadding;for(let Z=0;Z<F.length;Z++){const oe=F[Z],we=H[Z];Q.length<=Z&&Q.push({pos:[],rot:[],scale:[],timeOffset:we});const Oe=Q[Z];Oe.pos.push(...oe.getSortedTimesArray(!0,!1,!1)),Oe.rot.push(...oe.getSortedTimesArray(!1,!0,!1)),Oe.scale.push(...oe.getSortedTimesArray(!1,!1,!0))}}for(const D of Q)D.pos.sort((F,H)=>F-H),D.rot.sort((F,H)=>F-H),D.scale.sort((F,H)=>F-H),D.pos=[...new Set(D.pos)],D.rot=[...new Set(D.rot)],D.scale=[...new Set(D.scale)];return Q},h=function(P,O,N){const L=new Map,Q=new Map,D=new Map,F=O.length;for(const H of N){const K=P.get(H);let Z;K?console.assert(K.length===F,"We should have the same number of TransformData entries for each bone",K,O):Z=new Fr(null,H,null);for(let oe=0;oe<F;oe++){const we=K?K[oe]:Z,Oe=O[oe];for(const{time:se,translation:_e}of we.getValues(Oe.pos,!0,!1,!1)){const Ee=(se+Oe.timeOffset)*60;L.has(Ee)||L.set(Ee,new Array),L.get(Ee).push(_e.clone())}for(const{time:se,rotation:_e}of we.getValues(Oe.rot,!1,!0,!1)){const Ee=(se+Oe.timeOffset)*60;Q.has(Ee)||Q.set(Ee,new Array),Q.get(Ee).push(_e.clone())}for(const{time:se,scale:_e}of we.getValues(Oe.scale,!1,!1,!0)){const Ee=(se+Oe.timeOffset)*60;D.has(Ee)||D.set(Ee,new Array),D.get(Ee).push(_e.clone())}}}return{position:L.size==0?void 0:L,quaternion:Q.size==0?void 0:Q,scale:D.size==0?void 0:D}},u=function(P){const O=[];for(const N of P)O.push(`(${Br(N.x)}, ${Br(N.y)}, ${Br(N.z)})`);return O.join(", ")},d=function(P){const O=[];for(const N of P)O.push(`(${Br(N.w)}, ${Br(N.x)}, ${Br(N.y)}, ${Br(N.z)})`);return O.join(", ")},f=function(P){const O=new Map;if(xc){const N=new Array;for(const[L,Q]of o)N.push(L.uuid+": "+Q.length+" "+Q.map(D=>{var F;return(F=D.clip)==null?void 0:F.uuid.substring(0,6)}).join(" "));console.log(`getPerBoneTransformData
`+N.join(`
`))}for(const N of P){const L=o.get(N);L&&O.set(N,L)}return O},m=function(P){const O=f(P),N=c(O);return h(O,N,P)};const g=s.skinnedMesh.skeleton,v=new Array,y=[],A=[];for(const P of g.bones)if(P.parent.type!=="Bone"){y.push(P);const O=g.boneInverses[g.bones.indexOf(P)];v.push({bone:P,inverse:O}),A.push(P.uuid)}for(;A.length<g.bones.length;)for(const P of y){const O=P.children;for(const N of O)if(A.indexOf(N.uuid)===-1&&g.bones.indexOf(N)!==-1){y.push(N);const L=g.boneInverses[g.bones.indexOf(N)];v.push({bone:N,inverse:L}),A.push(N.uuid)}}for(const P of gQ(g.bones))v.push({bone:P,inverse:P.matrixWorld.clone().invert()});const b=v[0].bone.parent;b||console.error("No bone parent found for skinned mesh during USDZ export",s.skinnedMesh),v.sort((P,O)=>x0(P.bone,b)>x0(O.bone,b)?1:-1);const x=i.quickLookCompatible,_=[],w=[],T=[],M=[];for(const{bone:P}of v){if(x){const O=P.scale;O.x==0&&(O.x=1e-5),O.y==0&&(O.y=1e-5),O.z==0&&(O.z=1e-5),_.push(new he().compose(P.position,P.quaternion,P.scale))}else _.push(P.matrix.clone());w.push(P.position),T.push(P.quaternion),M.push(P.scale)}const R=v.map(P=>'"'+x0(P.bone,b)+'"').join(", "),B=v.map(P=>_0(P.inverse.clone().invert())).join(", ");e.beginBlock('def Skeleton "Rig"'),e.appendLine(`uniform matrix4d[] bindTransforms = [${B}]`),e.appendLine(`uniform token[] joints = [${R}]`),e.appendLine('uniform token purpose = "guide"'),e.appendLine(`uniform matrix4d[] restTransforms = [${_.map(P=>_0(P)).join(", ")}]`),e.appendLine(`matrix4d xformOp:transform = ${_0(new he)}`),e.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]');const E=m(v.map(P=>P.bone));if(xc){let P=1e7,O=0;for(const N of((r=E.position)==null?void 0:r.keys())??[])P=Math.min(P,N),O=Math.max(O,N);console.log("Time samples",P,O,E)}if(e.beginBlock('def SkelAnimation "_anim"'),e.appendLine(`uniform token[] joints = [${R}]`),e.appendLine(`quatf[] rotations = [${d(T)}]`),E&&E.quaternion){e.beginBlock("quatf[] rotations.timeSamples = {","");const P=l(E.quaternion);for(const O of P)e.appendLine(O);e.closeBlock()}if(e.appendLine(`half3[] scales = [${u(M)}]`),E&&E.scale){e.beginBlock("half3[] scales.timeSamples = {","");const P=a(E.scale);for(const O of P)e.appendLine(O);e.closeBlock()}if(e.appendLine(`float3[] translations = [${u(w)}]`),E&&E.position){e.beginBlock("float3[] translations.timeSamples = {","");const P=a(E.position);for(const O of P)e.appendLine(O);e.closeBlock()}e.closeBlock(),e.closeBlock()}}onSerialize(e,i){var r;if(!this.model)return;const s=this.dict.get(this.object);if(s)for(let d=0;d<s.length;d++)s[d]===void 0&&(s[d]=new Fr(null,this.object,null));this.skinnedMeshExport(e,i);const o=this.object,a=this.dict.get(o);if(!a||o.isSkinnedMesh)return;uD&&console.log("SERIALIZE",this.model.name,this.object.type,a);const l=new he;e.appendLine("matrix4d xformOp:transform.timeSamples = {"),e.indent++;const c=new Array;let h=0;for(let d=0;d<a.length;d++){if(c.push(h),a[d]===void 0){console.error("Got an undefined transform data, this is likely a bug.",o,a);continue}h+=a[d].getDuration()+Fr.animationDurationPadding}const u=Intl.NumberFormat("en-US",{maximumFractionDigits:3,minimumFractionDigits:0,useGrouping:!1});for(let d=0;d<a.length;d++){const f=a[d];if(!f)continue;const m=c[d];{const g=f.getSortedTimesArray();if(!g||g.length===0){console.error("got an animated object but no time values?",o,f);continue}{const v=((r=f.clip)==null?void 0:r.name)??"rest",y=f.getDuration();xc&&console.log("Write .timeSamples:",v,m,y,a),e.appendLine("# "+v+": start="+u.format(m*f.frameRate)+", length="+u.format(y*f.frameRate)+", frames="+f.getFrames())}for(const{time:v,translation:y,rotation:A,scale:b}of f.getValues(g)){l.compose(y,A,b);const x=`${u.format((m+v)*f.frameRate)}: ${_0(l)},`;e.appendLine(x)}}}e.indent--,e.appendLine("}")}}const U0e=te("debugpost");let dD=null;function F0e(n){dD=n}function n9(n){let e=n.gameObject;for(;e;){for(const i of fC(e))if(i.isPostProcessingManager===!0)return i;e=e.parent}return null}function N0e(n){let e=n9(n);if(!e)if(dD){U0e&&console.warn("Adding postprocessing manager to the scene.");const i=n.scene;e=Zo(i,dD)}else it()&&console.warn("No post processing manager found");return e}var z0e=Object.defineProperty,j0e=Object.getOwnPropertyDescriptor,r9=(n,e,i,r)=>{for(var s=r>1?void 0:r?j0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&z0e(e,i,s),s};const G0e=te("debugpost");class Ke{constructor(e){p(this,"isVolumeParameter",!0),p(this,"_isInitialized",!1),p(this,"_active",!0),p(this,"_value"),p(this,"_valueRaw"),p(this,"_defaultValue"),p(this,"valueProcessor"),p(this,"onValueChanged"),e!==void 0&&this.initialize(e)}get isInitialized(){return this._isInitialized}initialize(e){e!==void 0&&(this._value=e,this._defaultValue=e,this._valueRaw=e,this._isInitialized=!0)}get overrideState(){return this._active}set overrideState(e){if(this._active===e)return;this._active=e;const i=e?this._valueRaw:this._defaultValue;this.processValue(i,!0)}get value(){return this._valueRaw}set value(e){this.isInitialized||this.initialize(e),this.processValue(e,!1)}set defaultValue(e){this._defaultValue=e}__init(){this.processValue(this._valueRaw,!0)}processValue(e,i){if(e==null||!i&&this.testIfValueChanged(e)===!1)return;const r=this._value;G0e&&typeof r=="number"&&typeof e=="number"&&(r?.toFixed(4),e?.toFixed(4)),!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,e=this._defaultValue,this._valueRaw=e):(this._valueRaw=e,this._active&&this.valueProcessor&&(e=this.valueProcessor(e)),this._value=e),this.onValueChanged&&this.onValueChanged(e,r,this)}testIfValueChanged(e){return this._valueRaw!==e}}r9([C()],Ke.prototype,"overrideState",1),r9([C()],Ke.prototype,"value",1);class H0e extends La{constructor(){super([Ke])}onSerialize(e,i){}onDeserialize(e,i){const r=i.target,s=i.path;let o;if(r&&s&&(o=r[s]),(typeof o!="object"||typeof o=="object"&&o.isVolumeParameter!==!0)&&(o=new Ke),typeof e=="object"&&"value"in e){const a=e.value;o.initialize(a),o.overrideState=e.overrideState}else o.value=e;return o}}new H0e;var V0e=Object.defineProperty,Q0e=Object.getOwnPropertyDescriptor,W0e=(n,e,i,r)=>{for(var s=r>1?void 0:r?Q0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&V0e(e,i,s),s};const X0e=te("debugpost");class ss extends Be{constructor(e=void 0){if(super(),p(this,"active",!0),p(this,"_manager",null),p(this,"_result"),p(this,"_postprocessingContext",null),e)for(const i of Object.keys(e)){const r=e[i],s=this[i];s instanceof Ke?s.initialize(r):s!==void 0&&(this[i]=r)}}get isPostProcessingEffect(){return!0}onEnable(){this.onEffectEnabled(),this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){var e;(e=this._manager)==null||e.removeEffect(this),this.active=!1}onEffectEnabled(e){var i;e&&e.isPostProcessingManager===!0?this._manager=e:this._manager||(this._manager=N0e(this)),(i=this._manager)==null||i.addEffect(this)}init(){}get postprocessingContext(){return this._postprocessingContext}apply(e){var i;return this._postprocessingContext=e,this._result||(this.initParameters(),this._result=(i=this.onCreateEffect)==null?void 0:i.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){X0e&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(e=>e.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const e=Object.keys(this);for(const i of e){const r=this[i];r instanceof Ke&&r.__init()}}onEditorModification(e){const i=e.propertyName;if(this[i]instanceof Ke){const r=e.value;return this[i].value=r,!0}}}W0e([C()],ss.prototype,"active",2);var q0e=Object.defineProperty,Y0e=Object.getOwnPropertyDescriptor,J0e=(n,e,i,r)=>{for(var s=r>1?void 0:r?Y0e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&q0e(e,i,s),s};const K0e=te("debugpost"),pD={};function Qa(n,e){pD[n]=e}function Z0e(n){return n.__type in pD?pD[n.__type]:(K0e&&n.__type&&console.warn("Unknown postprocessing type",n.__type,n),ss)}class Rb{constructor(){p(this,"components",[])}init(){var e;(e=this.components)==null||e.forEach(i=>i.init())}addEffect(e){this.components.push(e)}removeEffect(e){const i=this.components.indexOf(e);i>=0&&this.components.splice(i,1)}}J0e([C0([n=>Z0e(n),ss])],Rb.prototype,"components",2);var $0e=Object.defineProperty,eve=Object.getOwnPropertyDescriptor,tve=(n,e,i,r)=>{for(var s=r>1?void 0:r?eve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&$0e(e,i,s),s};class Pb extends ss{constructor(){super(...arguments),p(this,"preset",new Ke(rf.HIGH))}get typeName(){return"Antialiasing"}onCreateEffect(){const e=new r5({preset:rf.HIGH,edgeDetectionMode:_P.DEPTH});return this.preset.onValueChanged=i=>{e.applyPreset(i)},e}}tve([C(Ke)],Pb.prototype,"preset",2),Qa("Antialiasing",Pb);const ive=te("debugusdz");class hp{constructor(){p(this,"files",new Array)}static getName(e){var i;const r=e.split(".").pop();let s=(i=e.split(".").slice(0,-1).join(".").split("/").pop())==null?void 0:i.replace(".","_");return s||(s="Audio_"+Math.random().toString(36).substring(2,15)),Pl(s)+"."+r}get extensionName(){return"Audio"}onExportObject(e,i,r){const s=ie.getComponents(e,Pn);if(s.length)for(const o of s){if(!o.clip||typeof o.clip!="string"||!o.playOnAwake)continue;const a=o.clip.split("/").pop()||"Audio",l=hp.getName(o.clip),c=Pl(l);if(!this.files.some(h=>h.path===o.clip)){this.files.push({path:o.clip,name:l});const h=l.toLowerCase();r.quickLookCompatible&&!h.endsWith(".mp3")&&!h.endsWith(".wav")&&!h.endsWith(".m4a")&&console.error("Audio file "+o.clip+" from "+o.name+" is not an MP3 or WAV file. QuickLook may not support playing it.")}r.quickLookCompatible||i.addEventListener("serialize",(h,u)=>{h.appendLine(),h.beginBlock(`def SpatialAudio "${c}"`,"(",!1),h.appendLine(`displayName = "${a}"`),h.closeBlock(")"),h.beginBlock(),h.appendLine(`uniform asset filePath = @audio/${l}@`),h.appendLine(`uniform token auralMode = "${o.spatialBlend>0?"spatial":"nonSpatial"}"`),h.appendLine(`uniform token playbackMode = "${o.loop?"loopFromStage":"onceFromStart"}"`),h.appendLine(`uniform float gain = ${o.volume}`),h.closeBlock()})}}async onAfterSerialize(e){for(const i of this.files){const r="audio/"+i.name;if(e.files[r]){ive&&console.warn("Audio file with name "+r+" already exists in the context. Skipping.");continue}const s=await(await(await fetch(i.path)).blob()).arrayBuffer(),o=new Uint8Array(s);e.files[r]=o}}}const Ff=te("debugautosync"),fD=Symbol("syncerId");class nve{constructor(){p(this,"_syncers",{})}getOrCreateSyncer(e){if(!e.guid)return null;if(this._syncers[e.guid])return this._syncers[e.guid];const i=new rve(e);return i[fD]=e.guid,this._syncers[i[fD]]=i,i}removeSyncer(e){delete this._syncers[e[fD]]}}const mD=new nve;class rve{constructor(e){p(this,"comp"),p(this,"hasChanges",!1),p(this,"changedProperties",{}),p(this,"data",{}),p(this,"_isReceiving",!1),p(this,"_isInit",!1),p(this,"onHandleSending",()=>{if(!this.hasChanges)return;this.hasChanges=!1;const i=this.comp.context.connection;if(!i||!i.isConnected||!i.isInRoom){for(const r in this.changedProperties)delete this.changedProperties[r];return}for(const r in this.data)delete this.data[r];this.data.guid=this.comp.guid;for(const r in this.changedProperties){const s=this.changedProperties[r];delete this.changedProperties[r],this.data[r]=s}i.send(this.networkingKey,this.data,El.Queued)}),p(this,"onHandleReceiving",i=>{if(Ff&&console.log("RECEIVE",this.comp.name,this.comp.guid,i),!this._isInit||!this.comp)return;const r=i.guid;if(!(r&&r!==this.comp.guid)){Ff&&console.log("RECEIVED",this.comp.name,this.comp.guid,i);try{this._isReceiving=!0;for(const s in i){if(s==="guid")continue;const o=i[s];this.comp[s]=o,Ff&&console.log("SET",s,o)}}catch(s){console.error(s)}finally{this._isReceiving=!1}}}),this.comp=e}get networkingKey(){return this.comp.guid}init(e){if(this._isInit)return;this._isInit=!0,this.comp=e,this.comp.context.post_render_callbacks.push(this.onHandleSending),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving);const i=this.comp.context.connection.tryGetState(this.comp.guid);i&&this.onHandleReceiving(i)}destroy(){this._isInit&&(this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this.onHandleSending),1),this.comp.context.connection.stopListen(this.networkingKey,this.onHandleReceiving),this.comp=null,this._isInit=!1)}notifyChanged(e,i){this._isReceiving||(Ff&&console.log("Property changed: "+e,i),this.hasChanges=!0,this.changedProperties[e]=i)}}function sve(n,e){let i=e!==n;return!i&&n&&e&&(Array.isArray(n)&&Array.isArray(e)||typeof n=="object"&&typeof e=="object")&&(i=!0),i}const Bb=Symbol("AutoSyncHandler");function ove(n){if(n[Bb])return n[Bb];const e=mD.getOrCreateSyncer(n);return e?.init(n),n[Bb]=e,e}function ave(n){const e=n[Bb];e&&(mD.removeSyncer(e),e.destroy(),delete n[Bb])}const gD=function(n){return function(e,i){var r;let s="";typeof i=="string"?s=i:s=i.name;let o=null,a;typeof n=="string"?a=e[n]:typeof n=="function"&&(a=n);const l=e,c=l.__internalAwake;if(typeof c!="function"){(Ff||it())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((r=e?.constructor)==null?void 0:r.name)+'" is not supported',e);return}Ff&&console.log(s);const h=Symbol(s);l.__internalAwake=function(){if(this[h]!==void 0)return;this[h]=this[s],o=mD.getOrCreateSyncer(this);const d=Object.getOwnPropertyDescriptor(this,s);if(d?.set===void 0){let f=!1;Object.defineProperty(this,s,{set:function(m){var g;const v=this[h];if(this[h]=m,f){it()&&console.warn("Recursive call detected",s);return}f=!0;try{const y=sve(m,v);Ff&&console.log("SyncField assignment",s,"changed?",y,m),y&&a?.call(this,m,v)!==!1&&((g=ove(this))==null||g.notifyChanged(s,m))}finally{f=!1}},get:function(){return this[h]},configurable:!0,enumerable:!0})}o?.init(this),c.call(this)};const u=l.__internalDestroy;l.__internalDestroy=function(){ave(this),u.call(this)}}};var lve=Object.defineProperty,cve=Object.getOwnPropertyDescriptor,dE=(n,e,i,r)=>{for(var s=r>1?void 0:r?cve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&lve(e,i,s),s};const na=te("debugplayersync"),s9=class extends Be{constructor(){super(...arguments),p(this,"autoSync",!0),p(this,"asset"),p(this,"onPlayerSpawned"),p(this,"_localInstance"),p(this,"onJoinedRoom",()=>{na&&console.log("PlayerSync.joinedRoom. autoSync is set to "+this.autoSync),this.autoSync&&this.getInstance()}),p(this,"destroyInstance",()=>{var n;(n=this._localInstance)==null||n.then(e=>{na&&console.log("PlayerSync.destroyInstance",e),HA(e,this.context.connection,!0,{saveInRoom:!1})}),this._localInstance=void 0})}static async setupFrom(n,e){const i=$t.getOrCreateFromUrl(n);if(!i.asset){const o=await i.loadAssetAsync();ie.getOrAddComponent(o,ra)}const r=new s9;r._internalInit(e),r.asset=i;const s=new ve;return s.guid=n,ie.addComponent(s,r),r}awake(){this.watchTabVisible(),this.onPlayerSpawned||(this.onPlayerSpawned=new An)}onEnable(){this.context.connection.beginListen(jt.RoomStateSent,this.onJoinedRoom),this.context.connection.beginListen(jt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(jt.LeftRoom,this.destroyInstance),this.context.connection.isInRoom&&this.onJoinedRoom()}onDisable(){this.context.connection.stopListen(jt.RoomStateSent,this.onJoinedRoom),this.context.connection.stopListen(jt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(jt.LeftRoom,this.destroyInstance)}async getInstance(){var n,e,i,r,s,o;if(this._localInstance)return this._localInstance;if(na&&console.log("PlayerSync.createInstance",(n=this.asset)==null?void 0:n.uri),!((e=this.asset)!=null&&e.asset)&&!((i=this.asset)!=null&&i.uri))return console.error('PlayerSync: can not create an instance because "asset" is not set and or has no URL!'),null;this.gameObject.guid||console.warn("PlayerSync: gameObject has no guid! This might cause issues with syncing the player state."),this._localInstance=(r=this.asset)==null?void 0:r.instantiateSynced({parent:this.gameObject,deleteOnDisconnect:!0},!0);const a=await this._localInstance;if(a){const l=ie.getComponentsInChildren(a,ra);if(l!=null&&l.length){for(const c of l)c.owner=this.context.connection.connectionId;(s=this.onPlayerSpawned)==null||s.invoke(a)}else this._localInstance=void 0,console.error("<strong>Failed finding PlayerState on "+((o=this.asset)==null?void 0:o.uri)+"</strong>: please make sure the asset has a PlayerState component!"),ie.destroySynced(a)}else this._localInstance=void 0,console.warn("PlayerSync: failed instantiating asset!");return this._localInstance}watchTabVisible(){window.addEventListener("visibilitychange",n=>{if(document.visibilityState==="visible")for(let e=ra.all.length-1;e>=0;e--){const i=ra.all[e];(!i.owner||!this.context.connection.userIsInRoom(i.owner))&&i.doDestroy()}})}};let B0=s9;dE([C()],B0.prototype,"autoSync",2),dE([C($t)],B0.prototype,"asset",2),dE([C(An)],B0.prototype,"onPlayerSpawned",2);var o9=(n=>(n.OwnerChanged="ownerChanged",n))(o9||{}),kb;const os=(kb=class extends Be{constructor(){super(...arguments),p(this,"onOwnerChangeEvent",new An),p(this,"onFirstOwnerChangeEvent",new An),p(this,"hasOwner",!1),p(this,"owner"),p(this,"dontDestroy",!1),p(this,"onUserLeftRoom",n=>{if(n.userId===this.owner){na&&console.log("PLAYERSYNC LEFT",this.owner),this.doDestroy();return}})}static get all(){return os._all}static get local(){return os._local}static getFor(n){if(n instanceof ve)return ie.getComponentInParent(n,os);if(n instanceof Be)return ie.getComponentInParent(n.gameObject,os)}static isLocalPlayer(n){const e=os.getFor(n);return e?.isLocalPlayer??!1}static addEventListener(n,e){return this._callbacks[n]||(this._callbacks[n]=[]),this._callbacks[n].push(e),e}static removeEventListener(n,e){if(!this._callbacks[n])return;const i=this._callbacks[n].indexOf(e);i>=0&&this._callbacks[n].splice(i,1)}static dispatchEvent(n,e){if(this._callbacks[n])for(const i of this._callbacks[n])i(e)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(n,e){var i,r;na&&console.log("PlayerSync.onOwnerChange",this,"newOwner",n,"oldOwner",e);const s=os._local.indexOf(this);s>=0&&os._local.splice(s,1);const o={playerState:this,oldValue:e,newValue:n};if(this.hasOwner||(this.hasOwner=!0,(i=this.onFirstOwnerChangeEvent)==null||i.invoke(o)),(r=this.onOwnerChangeEvent)==null||r.invoke(o),this.owner===this.context.connection.connectionId){os._local.push(this);const l=new CustomEvent("local-owner-changed",{detail:o});this.dispatchEvent(l)}const a=new CustomEvent("owner-changed",{detail:o});this.dispatchEvent(a),os.dispatchEvent("ownerChanged",a)}awake(){os.all.push(this),na&&console.log("Registered new PlayerState",this.guid,os.all.length-1,os.all),this.context.connection.beginListen(jt.UserLeftRoom,this.onUserLeftRoom)}async start(){na&&console.log("PLAYERSTATE.START, owner: "+this.owner,this.context.connection.usersInRoom([])),this.owner?(this.context.connection.isInRoom||await $l(300),this.context.connection.userIsInRoom(this.owner)==!1&&(na&&console.log(`PlayerSync.start \u2192 doDestroy "${this.name}" because user "${this.owner}" is not in room anymore...`,"Currently in room:",...this.context.connection.usersInRoom()),this.doDestroy())):this.owner||(na&&console.warn("PlayerState.start \u2192 owner is undefined!",this.name),setTimeout(()=>{!this.destroyed&&!this.owner?this.dontDestroy?na&&console.warn("PlayerState.start \u2192 owner is still undefined but dontDestroy is set to true",this.name):(na&&console.warn(`PlayerState.start \u2192 owner is still undefined: destroying "${this.name}" instance now`),this.doDestroy()):na&&console.log("PlayerState.start \u2192 owner is assigned",this.owner)},2e3))}doDestroy(){na&&console.log("PlayerSync.doDestroy \u2192 syncDestroy",this.name),HA(this.gameObject,this.context.connection,!0,{saveInRoom:!1})}onDestroy(){if(this.context.connection.stopListen(jt.UserLeftRoom,this.onUserLeftRoom),os.all.splice(os.all.indexOf(this),1),this.isLocalPlayer){const n=os._local.indexOf(this);n>=0&&os._local.splice(n,1)}}},p(kb,"_all",[]),p(kb,"_local",[]),p(kb,"_callbacks",{}),kb);let ra=os;dE([gD(ra.prototype.onOwnerChange)],ra.prototype,"owner",2);const hve=te("debugavatar"),_c=class extends Be{constructor(){super(...arguments),p(this,"connectionId"),p(this,"avatar")}static getAvatar(n){return n>=0&&n<_c.instances.length?_c.instances[n]:null}static onAvatarMarkerCreated(n){return _c._onNewAvatarMarkerAdded.push(n),n}static onAvatarMarkerDestroyed(n){return _c._onAvatarMarkerDestroyed.push(n),n}awake(){_c.instances.push(this),hve&&console.log(this);for(const n of _c._onNewAvatarMarkerAdded)n({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){_c.instances.splice(_c.instances.indexOf(this),1);for(const n of _c._onAvatarMarkerDestroyed)n({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}};let as=_c;p(as,"instances",[]),p(as,"_onNewAvatarMarkerAdded",[]),p(as,"_onAvatarMarkerDestroyed",[]);var uve=Object.defineProperty,dve=Object.getOwnPropertyDescriptor,pve=(n,e,i,r)=>{for(var s=r>1?void 0:r?dve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&uve(e,i,s),s};const k0=te("debugxrflags"),a9=te("disablexrflags");a9&&console.warn("XRFlags are disabled");var wc=(n=>(n[n.Never=0]="Never",n[n.Browser=1]="Browser",n[n.AR=2]="AR",n[n.VR=4]="VR",n[n.FirstPerson=8]="FirstPerson",n[n.ThirdPerson=16]="ThirdPerson",n[n.All=4294967295]="All",n))(wc||{});const l9=class{constructor(){p(this,"Mask",17)}Has(n){return(this.Mask&n)!==0}Set(n){k0&&console.warn("Set XR flag state to",n),this.Mask=n,sa.Apply()}Enable(n){this.Mask|=n,sa.Apply()}Disable(n){this.Mask&=~n,sa.Apply()}Toggle(n){this.Mask^=n,sa.Apply()}EnableAll(){this.Mask=-1,sa.Apply()}DisableAll(){this.Mask=0,sa.Apply()}};let po=l9;p(po,"Global",new l9);var Ob;const Hh=(Ob=class extends Be{constructor(){super(...arguments),p(this,"visibleIn")}static Apply(){for(const n of this.registry)n.UpdateVisible(po.Global)}awake(){Hh.registry.push(this)}onEnable(){Hh.firstApply?this.UpdateVisible(po.Global):(Hh.firstApply=!0,Hh.Apply())}onDestroy(){const n=Hh.registry.indexOf(this);n>=0&&Hh.registry.splice(n,1)}get isOn(){return this.gameObject.visible}UpdateVisible(n=null){if(a9)return;let e;const i=n;if(i&&typeof i=="number"&&(console.assert(typeof i=="number","XRFlag.UpdateVisible: state must be a number",i),k0&&console.log(i),Hh.buffer.Mask=i,n=Hh.buffer),n instanceof po?(k0&&console.warn(this.name,"use passed in mask",n.Mask,this.visibleIn),e=n.Has(this.visibleIn)):(k0&&console.log(this.name,"use global mask"),po.Global.Has(this.visibleIn)),e!==void 0)if(e)k0&&console.log(this.name,"is visible",this.gameObject.uuid),ie.setActive(this.gameObject,!0);else{if(k0&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}},p(Ob,"registry",[]),p(Ob,"firstApply"),p(Ob,"buffer",new po),Ob);let sa=Hh;pve([C()],sa.prototype,"visibleIn",2);var fve=Object.defineProperty,mve=Object.getOwnPropertyDescriptor,vD=(n,e,i,r)=>{for(var s=r>1?void 0:r?mve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&fve(e,i,s),s};const Db=te("debugwebxr"),c9=new Ce().setFromAxisAngle(new S(0,1,0),Math.PI);class Pd extends Be{constructor(){super(...arguments),p(this,"head"),p(this,"leftHand"),p(this,"rightHand"),p(this,"_leftHandMeshes"),p(this,"_rightHandMeshes"),p(this,"_syncTransforms")}async onEnterXR(e){if(!this.activeAndEnabled)return;Db&&console.warn("AVATAR ENTER XR",this.guid,this.sourceId,this,this.activeAndEnabled),this._syncTransforms&&(this._syncTransforms.length=0),await this.prepareAvatar();const i=ra.getFor(this);if(i!=null&&i.owner){const r=this.gameObject.addComponent(as);r.avatar=this.gameObject,r.connectionId=i.owner}else this.context.connection.isConnected?console.error("No player state found for avatar",this):i&&!this.context.connection.isConnected&&(i.dontDestroy=!0)}onLeaveXR(e){const i=this.gameObject.getComponent(as);i&&i.destroy()}onUpdateXR(e){var i,r;if(!this.activeAndEnabled)return;const s=ra.isLocalPlayer(this);if(!s)return;const o=e.xr;if(o.rig&&o.rig.gameObject!==this.gameObject.parent&&(this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),this.gameObject.scale.set(1,1,1),o.rig.gameObject.add(this.gameObject)),this._syncTransforms&&s)for(const u of this._syncTransforms)u.fastMode=!0,u.isOwned()||u.requestOwnership();if(this.head&&this.context.mainCamera){const u=this.head.asset;if(u.position.copy(this.context.mainCamera.position),u.position.x*=-1,u.position.z*=-1,u.quaternion.copy(this.context.mainCamera.quaternion),u.quaternion.x*=-1,this.context.time.frameCount%10===0){const d=ie.getComponentsInChildren(this.head.asset,sa);for(const f of d)f.enabled=!1,f.gameObject.visible=!1}}const a=e.xr.leftController,l=(i=this.leftHand)==null?void 0:i.asset;a&&l?(l.position.copy(a.gripPosition),l.quaternion.copy(a.gripQuaternion),l.quaternion.multiply(c9),l.visible=a.isTracking,this.updateHandVisibility(a,l,this._leftHandMeshes)):l&&l.visible&&(l.visible=!1);const c=e.xr.rightController,h=(r=this.rightHand)==null?void 0:r.asset;c&&h?(h.position.copy(c.gripPosition),h.quaternion.copy(c.gripQuaternion),h.quaternion.multiply(c9),h.visible=c.isTracking,this.updateHandVisibility(c,h,this._rightHandMeshes)):h&&h.visible&&(h.visible=!1)}onBeforeRender(){this.context.xr&&this.context.time.frame%10===0&&this.updateRemoteAvatarVisibility()}updateHandVisibility(e,i,r){if(r){const s=e.model&&e.model.visible&&e.model!==i;r.forEach(o=>{ld(o,!s)})}}updateRemoteAvatarVisibility(){var e,i,r;if(this.context.connection.isConnected){const s=ra.getFor(this);if(s&&s.isLocalPlayer==!1){const o=Et.getXRSync(this.context);if(o&&o.hasState(s.owner)){this.tryFindAvatarObjectsIfMissing();const a=(e=this.leftHand)==null?void 0:e.asset;a&&(a.visible=o?.isTracking(s.owner,"left")??!1);const l=(i=this.rightHand)==null?void 0:i.asset;l&&(l.visible=o?.isTracking(s.owner,"right")??!1)}if((r=this.head)!=null&&r.asset){const a=ie.getComponentsInChildren(this.head.asset,sa);for(const l of a)l.enabled=!1,l.gameObject.visible=!0}}}}tryFindAvatarObjectsIfMissing(){if(!this.head||!this.leftHand||!this.rightHand){const e={head:this.head,leftHand:this.leftHand,rightHand:this.rightHand};XH.tryFindAvatarObjects(this.gameObject,this.sourceId||"",e),e.head&&(this.head=e.head),e.leftHand&&(this.leftHand=e.leftHand),e.rightHand&&(this.rightHand=e.rightHand)}}async prepareAvatar(){if(this.tryFindAvatarObjectsIfMissing(),this.head)this.head instanceof ve&&(this.head=new $t("",this.sourceId,this.head));else{const e=new ve;e.name="Head";const i=n0.createPrimitive(yf.Cube);e.add(i),this.gameObject.add(e),this.head=new $t("",this.sourceId,e),Db&&console.log("Create head",e)}if(this.rightHand)this.rightHand instanceof ve&&(this.rightHand=new $t("",this.sourceId,this.rightHand));else{const e=new ve;e.name="Right Hand",this.gameObject.add(e),this.rightHand=new $t("",this.sourceId,e),Db&&console.log("Create right hand",e)}if(this.leftHand)this.leftHand instanceof ve&&(this.leftHand=new $t("",this.sourceId,this.leftHand));else{const e=new ve;e.name="Left Hand",this.gameObject.add(e),this.leftHand=new $t("",this.sourceId,e),Db&&console.log("Create left hand",e)}await this.loadAvatarObjects(this.head,this.leftHand,this.rightHand),this._leftHandMeshes=[],this.leftHand.asset.traverse(e=>{e!=null&&e.isMesh&&this._leftHandMeshes.push(e)}),this._rightHandMeshes=[],this.rightHand.asset.traverse(e=>{e!=null&&e.isMesh&&this._rightHandMeshes.push(e)}),ra.isLocalPlayer(this.gameObject)&&(this._syncTransforms=ie.getComponentsInChildren(this.gameObject,vc))}async loadAvatarObjects(e,i,r){const s=e.loadAssetAsync(),o=i.loadAssetAsync(),a=r.loadAssetAsync(),l=new Array;s&&l.push(s),o&&l.push(o),a&&l.push(a);const c=await h1(l);Db&&console.log("Avatar loaded results:",c)}}vD([C($t)],Pd.prototype,"head",2),vD([C($t)],Pd.prototype,"leftHand",2),vD([C($t)],Pd.prototype,"rightHand",2);class Sc{static Add(e,i,r=null){if(i){for(const s of this.Pois)if(s.obj===i)return;this.Pois.push({obj:i,avatar:r}),this.LastChangeTime=e.time.time}}static Remove(e,i){var r;if(i){for(const s of this.Pois)if(s.obj===i){this.Pois.splice(this.Pois.indexOf(s),1),this.LastChangeTime=e?.time.time??((r=Ot.Current)==null?void 0:r.time.time);return}}}}p(Sc,"Pois",[]),p(Sc,"LastChangeTime",0);class gve{constructor(){p(this,"guid"),p(this,"position",new S)}}class Lb extends Be{constructor(){super(...arguments),p(this,"target",null),p(this,"avatar",null),p(this,"_model",null),p(this,"_targetModel",new gve),p(this,"_currentTargetObject",null),p(this,"_lastUpdateTime",0),p(this,"_lookDuration",0),p(this,"_lastPoiChangedTime",0)}set controlledTarget(e){this.target=e;const i=q.get("MoveRandom");if(i&&this.target){const r=ie.getComponent(this.target,i);r&&r.destroy()}}awake(){if(this.avatar=ie.getComponentInParent(this.gameObject,as),this.avatar){const e=ie.getComponentInParent(this.gameObject,as);this._model=new ck(this.context.connection,this.guid),e!=null&&e.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen("avatar-look-target-changed",e=>{var i;this.target&&e&&e.guid===((i=this.avatar)==null?void 0:i.guid)&&gr(this.target,e.position)})}update(){var e;if((!this.context.connection.isConnected||(e=this._model)!=null&&e.hasOwnership)&&(Sc.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=Sc.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const i=kt(this._currentTargetObject);gr(this.target,i),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send("avatar-look-target-changed",this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(i))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const e=Sc.Pois;if(e.length>0){const i=e[Math.floor(Math.random()*e.length)];if(i&&i.obj){if(i.avatar&&i.avatar===this.avatar)return;this._currentTargetObject=i.obj}}}}}const Vn=te("debugnetworkingstreams");var Cc=(n=>(n.Connected="peer-user-connected",n.StreamReceived="receive-stream",n.StreamEnded="call-ended",n.Disconnected="peer-user-disconnected",n.UserJoined="user-joined",n))(Cc||{});class yD{constructor(e,i){p(this,"type","call-ended"),p(this,"userId"),p(this,"direction"),this.userId=e,this.direction=i}}class h9{constructor(e,i,r){p(this,"type","receive-stream"),p(this,"userId"),p(this,"stream"),p(this,"target"),this.userId=e,this.stream=i,this.target=r}}class vve{constructor(e,i){p(this,"guid"),p(this,"peerId"),p(this,"dontSave",!0),this.guid=e.id,this.peerId=i}}var u9=(n=>(n.Incoming="incoming",n.Outgoing="outgoing",n))(u9||{});class yve extends wr{constructor(e,i,r,s=null){super(),p(this,"peerId"),p(this,"userId"),p(this,"direction"),p(this,"call"),p(this,"_stream",null),p(this,"_isDisposed",!1),this.peerId=i.peer,this.userId=e,this.call=i,this.direction=r,this._stream=s,i.on("stream",o=>{if(Vn&&console.log("Receive stream",`
Audio:`,o.getAudioTracks(),`
Video:`,o.getVideoTracks()),this._stream=o,r==="incoming"){const a=new h9(e,o,this);this.dispatchEvent(a)}}),i.on("close",()=>{this.dispatchEvent(new yD(e,r))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),Ec(this._stream))}get isOpen(){var e;return((e=this.call.peerConnection)==null?void 0:e.connectionState)==="connected"}get isOpening(){var e;return((e=this.call.peerConnection)==null?void 0:e.connectionState)==="connecting"}get isClosed(){return!this.isOpen||this._isDisposed}}function d9(n){return n=n.replace("a=fmtp:111 minptime=10;useinbandfec=1","a=fmtp:111 ptime=5;useinbandfec=1;stereo=1;maxplaybackrate=48000;maxaveragebitrat=128000;sprop-stereo=1"),n}const Ub=class extends wr{constructor(n,e){super(),p(this,"updateCalls",()=>{var i;for(let r=this._incomingCalls.length-1;r>=0;r--){const s=this._incomingCalls[r];s.isClosed&&!s.isOpening&&this._incomingCalls.splice(r,1)}for(let r=this._outgoingCalls.length-1;r>=0;r--){const s=this._outgoingCalls[r];let o=!1;s.isClosed&&!s.isOpening&&((i=s.stream)!=null&&i.active?Vn&&console.warn("!!! Stream is still active, don't remove call",s.userId,"Your id: "+this.context.connection.connectionId):(Vn&&console.warn("!!! Remove closed call",s.userId),o=!0)),this.context.connection.userIsInRoom(s.userId)===!1&&(Vn&&console.warn("!!! User is not in room anymore, remove call",s.userId),o=!0),o&&(s.close(),this._outgoingCalls.splice(r,1))}}),p(this,"id"),p(this,"context"),p(this,"_incomingCalls",[]),p(this,"_outgoingCalls",[]),p(this,"_peer"),p(this,"_enabled",!1),p(this,"_enabledPeer",!1),p(this,"onConnectRoomFn",this.onConnectRoom.bind(this)),p(this,"onPeerConnect",i=>{if(Vn&&console.log("PEER opened as",i),i===null){console.error("Peer connection failed",i);return}this.context.connection.send("peer-user-connected",new vve(this,i))}),p(this,"onPeerClose",()=>{Vn&&console.log("PEER closed"),this.updateCalls()}),p(this,"onPeerDisconnected",()=>{Vn&&console.log("PEER disconnected"),this.updateCalls()}),p(this,"onPeerError",i=>{Vn&&console.error("PEER error",i)}),p(this,"onPeerReceivingCall",i=>{i.answer(void 0,{sdpTransform:r=>d9(r)}),this.registerCall(i,"incoming",null)}),this.context=n,this.id=e,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(n,e){if(Ub.instances.has(e))return Ub.instances.get(e);const i=new Ub(n,e);return Ub.instances.set(e,i),i}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(n){return this.id+"-"+n}getUserIdFromPeerId(n){return n.substring(this.id.length+1)}makeCall(n,e){var i;if(!(e!=null&&e.id)){Vn?console.warn("Can not make a call: mediastream has no id or is undefined"):console.debug("Can not make a call: mediastream has no id or is undefined");return}const r={metadata:{userId:this.context.connection.connectionId,streamId:e.id},sdpTransform:o=>d9(o)},s=(i=this._peer)==null?void 0:i.call(n,e,r);if(s){const o=this.registerCall(s,"outgoing",e);return Vn&&console.warn(`\u{1F4DE} CALL ${n}`,`
Outgoing:`,this._outgoingCalls,`
Incoming:`,this._incomingCalls),o}else Vn&&console.error("Failed to make call",n,e,this._peer)}closeAll(){for(const n of this._incomingCalls)n.close();for(const n of this._outgoingCalls)n.close();this.updateCalls()}get peer(){return this._peer}get incomingCalls(){return this._incomingCalls}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(jt.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(jt.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const n=this.getMyPeerId();n?this._peer=BH(n):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnect),this._peer.on("close",this.onPeerClose),this._peer.on("call",this.onPeerReceivingCall),this._peer.on("disconnected",this.onPeerDisconnected),this._peer.on("error",this.onPeerError))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnect),this._peer.off("close",this.onPeerClose),this._peer.off("call",this.onPeerReceivingCall),this._peer.off("disconnected",this.onPeerDisconnected),this._peer.off("error",this.onPeerError))}registerCall(n,e,i){const r=n.metadata;(!r||!r.userId)&&console.error("Missing call metadata",n);const s=r.userId;e==="incoming"&&Vn?console.warn("\u2190 Receive call from",n.metadata,n.connectionId):Vn&&console.warn("\u2192 Make call to",n.metadata);const o=e==="incoming"?this._incomingCalls:this._outgoingCalls,a=new yve(s,n,e,i);return o.push(a),n.on("error",l=>{console.error("Call error",l)}),n.on("close",()=>{Vn&&console.log("Call ended",n.metadata);const l=o.indexOf(a);l!==-1&&o.splice(l,1),a.close(),this.dispatchEvent(new yD(s,e))}),a.addEventListener("call-ended",l=>{this.dispatchEvent(l)}),e==="incoming"&&(a.addEventListener("receive-stream",l=>{this.dispatchEvent(l)}),n.on("stream",()=>{Vn&&console.log("Received stream for call",n.metadata);let l=0;const c=setInterval(()=>{const h=l===0;!a.isOpen&&h&&(Vn&&console.warn("Close call because stream is not active",n.metadata),l+=1,clearInterval(c),a.close())},2e3)})),a}};let pE=Ub;p(pE,"instances",new Map);class d_ extends wr{constructor(e,i){super(),p(this,"context"),p(this,"peer"),p(this,"_sendingStreams",new Map),p(this,"debug",!1),p(this,"_enabled",!1),p(this,"_tickIntervalId"),p(this,"tick",()=>{this.updateSendingCalls()}),p(this,"onJoinedRoom",r=>{this._sendingStreams.size>0&&(this.debug&&console.warn(`${r!=null&&r.userId?`User ${r.userId}`:"You"} joined room`,r,this._sendingStreams.size),this.updateSendingCalls())}),p(this,"onLeftRoom",r=>{this.debug&&console.warn(`${r?.userId||"You"} left room`,r),this.stopCallsToUsersThatAreNotInTheRoomAnymore(),this.peer.closeAll()}),p(this,"onCallStreamReceived",r=>{this.debug&&console.log("Call with "+r.userId+" started"),this.dispatchEvent({type:"receive-stream",target:this,stream:r.stream,userId:r.userId}),this.debug&&this.debugLogCurrentState()}),p(this,"onCallEnded",r=>{this.debug&&console.log("Call with "+r.userId+" ended"),this.dispatchEvent(r),this.debug&&this.debugLogCurrentState()}),p(this,"onUserConnected",r=>{if(this.peer.id===r.guid){this.debug&&console.log("PEER USER CONNECTED",r.guid,r,this._sendingStreams.size);const s=this._sendingStreams.keys().next().value;this.peer.makeCall(r.peerId,s)}else Vn&&console.log("Unknown user connected",r.guid,r.peerId)}),p(this,"onUserLeft",r=>{this.debug&&console.log("User left room: "+r.userId),this.stopCallsToUsersThatAreNotInTheRoomAnymore()}),this.context=e,this.peer=i,Vn&&(this.debug=!0)}static create(e,i){const r=pE.getOrCreate(e.context,i||e.context.connection.connectionId||e.guid);return new d_(e.context,r)}startSendingStream(e){this._sendingStreams.has(e)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(e,[]),this.updateSendingCalls())}stopSendingStream(e){if(e){const i=this._sendingStreams.get(e);if(i){for(const r of i)r.close();i.length=0}this._sendingStreams.delete(e),i&&this.debug&&this.debugLogCurrentState()}this.updateSendingCalls()}get enabled(){return this._enabled}enable(){this._enabled||(this._enabled=!0,this.peer.enable(),this.peer.addEventListener("receive-stream",this.onCallStreamReceived),this.peer.addEventListener("call-ended",this.onCallEnded),this.context.connection.beginListen("peer-user-connected",this.onUserConnected),this.context.connection.beginListen(jt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(jt.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(jt.UserLeftRoom,this.onUserLeft),this.context.connection.beginListen(jt.LeftRoom,this.onLeftRoom),this._tickIntervalId=setInterval(this.tick,5e3))}disable(){this._enabled&&(this._enabled=!1,this.peer.disable(),this.peer.removeEventListener("receive-stream",this.onCallStreamReceived),this.peer.removeEventListener("call-ended",this.onCallEnded),this.context.connection.stopListen("peer-user-connected",this.onUserConnected),this.context.connection.stopListen(jt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(jt.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(jt.UserLeftRoom,this.onUserLeft),this.context.connection.stopListen(jt.LeftRoom,this.onLeftRoom),this._tickIntervalId!=null&&(clearInterval(this._tickIntervalId),this._tickIntervalId=void 0))}updateSendingCalls(){const e=this.context.connection.connectionId;for(const i of this._sendingStreams.keys()){const r=this._sendingStreams.get(i)||[];for(const s of this.context.connection.usersInRoom()){if(s===e)continue;const o=this.peer.getPeerIdFromUserId(s);if(r.find(a=>{var l;return a.peerId===o&&a.direction==="outgoing"&&!a.isClosed&&((l=a.stream)==null?void 0:l.active)}))Vn&&console.debug("Already have a call with user "+s+" / peer "+o);else{const a=this.peer.makeCall(o,i);a&&r.push(a)}}this._sendingStreams.set(i,r)}this.stopCallsToUsersThatAreNotInTheRoomAnymore()}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const e of this._sendingStreams.keys()){const i=this._sendingStreams.get(e);if(i)for(let r=i.length-1;r>=0;r--){const s=i[r];this.context.connection.userIsInRoom(s.userId)?Vn&&(this.context.connection.connectionId===s.userId?console.warn(`You are still in the room [${r}] ${s.userId}`):console.log(`User is still in room [${r}] ${s.userId}`)):(Vn&&console.log(`Remove call ${[r]} to user that is not in room anymore ${s.userId}`),s.close(),i.splice(r,1))}}this.peer.updateCalls(),this.debug&&this.debugLogCurrentState()}debugLogCurrentState(){console.warn(`You (${this.context.connection.connectionId}) are currently sending ${this._sendingStreams.size} and receiving ${this.peer.incomingCalls.length} calls (${this.peer.incomingCalls.map(e=>e.userId).join(", ")})`,this.peer.incomingCalls)}}function Ec(n){if(n&&n instanceof MediaStream)for(const e of n.getTracks())e.stop()}var Ave=Object.defineProperty,bve=Object.getOwnPropertyDescriptor,AD=(n,e,i,r)=>{for(var s=r>1?void 0:r?bve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Ave(e,i,s),s};const xve="noVoip",_ve=te("debugvoip");class Bd extends Be{constructor(){super(...arguments),p(this,"autoConnect",!0),p(this,"runInBackground",!0),p(this,"createMenuButton",!0),p(this,"debug",!1),p(this,"_net"),p(this,"_menubutton"),p(this,"_allowSending",!0),p(this,"_outputStream",null),p(this,"onJoinedRoom",async()=>{this.debug&&console.log("VOIP: Joined room"),await $l(300),this.autoConnect&&!this.isSending&&this._allowSending&&this.connect()}),p(this,"onLeftRoom",()=>{this.debug&&console.log("VOIP: Left room"),this.disconnect();for(const e of this._incomingStreams.values())Ec(e.srcObject);this._incomingStreams.clear()}),p(this,"_incomingStreams",new Map),p(this,"onReceiveStream",e=>{const i=e.target.userId,r=e.stream;let s=this._incomingStreams.get(i);s||(s=new Audio,this._incomingStreams.set(i,s)),s.srcObject=r,s.setAttribute("autoplay","true"),kh.registerWaitForInteraction(()=>{s?.play().catch(o=>{console.error("VOIP: Failed to play audio",o)})})}),p(this,"onStreamEnded",e=>{const i=this._incomingStreams.get(e.userId);Ec(i?.srcObject),this._incomingStreams.delete(e.userId)}),p(this,"onEnabledChanged",()=>{for(const e of this._incomingStreams){const i=e[1];i.muted=!this.enabled}}),p(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const e=document.visibilityState!=="visible";this.setMuted(e);for(const i of this._incomingStreams){const r=i[1];r.muted=e}})}awake(){_ve&&(this.debug=!0),this.debug&&(console.log("VOIP debugging: press 'v' to toggle mute or 'c' to toggle connect/disconnect"),window.addEventListener("keydown",async e=>{switch(e.key.toLowerCase()){case"v":console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted);break;case"c":this.isSending?this.disconnect():this.connect();break}}),window.addEventListener("blur",()=>{console.log("VOIP: MUTE ON BLUR"),this.setMuted(!0)}),window.addEventListener("focus",()=>{console.log("VOIP: UNMUTE ON FOCUS"),this.setMuted(!1)}))}onEnable(){this._net||(this._net=d_.create(this)),this.debug&&(this._net.debug=!0),this._net.addEventListener(Cc.StreamReceived,this.onReceiveStream),this._net.addEventListener(Cc.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&this.context.connection.isConnected&&this.connect(),this.context.connection.beginListen(jt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(jt.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var e;this._net&&(this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(Cc.StreamReceived,this.onReceiveStream),this._net.removeEventListener(Cc.StreamEnded,this.onStreamEnded),(e=this._net)==null||e.disable()),this.context.connection.stopListen(jt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(jt.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}onDestroy(){var e;(e=this._menubutton)==null||e.remove(),this._menubutton=void 0}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(e){var i,r;if(!this._net)return console.error("Cannot connect to voice chat - NetworkedStreams not initialized. Make sure the component is enabled before calling this method."),!1;if(this.context.connection.isConnected){if(!await Uy())return console.error("Cannot connect to voice chat - microphone permissions not granted"),this.updateButton(),!1}else return console.error("Cannot connect to voice chat - not connected to server"),this.updateButton(),!1;return this._allowSending=!0,(i=this._net)==null||i.stopSendingStream(this._outputStream),Ec(this._outputStream),this._outputStream=await this.getAudioStream(e),this._outputStream?(this.debug&&console.log("VOIP: Got audio stream"),(r=this._net)==null||r.startSendingStream(this._outputStream),this.updateButton(),!0):(this.updateButton(),await Uy()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):I1("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),(this.debug||it())&&console.log("VOIP: Failed to get audio stream"),!1)}disconnect(e){var i;e!=null&&e.remember&&(this._allowSending=!1),(i=this._net)==null||i.stopSendingStream(this._outputStream),Ec(this._outputStream),this._outputStream=null,this.updateButton()}setMuted(e){var i;const r=(i=this._outputStream)==null?void 0:i.getAudioTracks();if(r)for(const s of r)s.enabled=!e}get isMuted(){var e;if(this._outputStream===null)return!1;const i=(e=this._outputStream)==null?void 0:e.getAudioTracks();if(i){for(const r of i)if(!r.enabled)return!0}return!1}async updateButton(){var e;if(this.createMenuButton){if(this._menubutton||(this._menubutton=document.createElement("button"),this._menubutton.addEventListener("click",()=>{this.isSending?this.disconnect({remember:!0}):this.connect(),Uy().then(i=>{i||Pi("<strong>Microphone permissions not granted</strong>. Please allow your browser to use the microphone to be able to talk. Click on the button on the left side of your browser's address bar to allow microphone permissions.")})})),this._menubutton){this.context.menu.appendChild(this._menubutton),this.activeAndEnabled?this._menubutton.style.display="":this._menubutton.style.display="none",this._menubutton.title=this.isSending?"Click to disable your microphone":"Click to enable your microphone";let i=(this.isSending,""),r=this.isSending?"mic":"mic_off";await Uy()||(i="No Permission",r="mic_off",this._menubutton.title="Microphone permissions not granted. Please allow your browser to use the microphone to be able to talk. This can usually be done in the addressbar of the webpage."),this._menubutton.innerText=i,this._menubutton.prepend(is(r)),this.context.connection.isConnected==!1?this._menubutton.setAttribute("disabled",""):this._menubutton.removeAttribute("disabled")}}else this.activeAndEnabled||(e=this._menubutton)==null||e.remove()}getFrequency(e){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,it()&&Pi("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(e){return navigator.mediaDevices.getUserMedia?await navigator.mediaDevices.getUserMedia({audio:e??!0,video:!1}).catch(i=>(console.warn("VOIP failed getting audio stream",i),null)):(console.error("No getDisplayMedia support"),null)}}AD([C()],Bd.prototype,"autoConnect",2),AD([C()],Bd.prototype,"runInBackground",2),AD([C()],Bd.prototype,"createMenuButton",2);var wve=Object.defineProperty,Sve=Object.getOwnPropertyDescriptor,p9=(n,e,i,r)=>{for(var s=r>1?void 0:r?Sve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&wve(e,i,s),s};const Cve=te("debugmouth");class Fb extends Be{constructor(){super(...arguments),p(this,"idle",[]),p(this,"talking",[]),p(this,"marker",null),p(this,"voip",null),p(this,"lastMouthChangeTime",0),p(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=ie.findObjectOfType(Bd,this.context),this.marker||(this.marker=ie.getComponentInParent(this.gameObject,as))},3e3)}update(){var e;if(!this.voip||this.context.time.frameCount%10!==0)return;let i=((e=this.marker)==null?void 0:e.connectionId)??null;if(!i){Cve&&(i=null);return}const r=this.voip.getFrequency(i)??0;this.updateLips(r)}updateLips(e){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&e>30){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,i)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,i)}}}setMouthShapeActive(e,i){if(e){e!=this.idle?this.idle.map(r=>r.visible=!1):this.talking.map(r=>r.visible=!1);for(let r=0;r<e.length;r++){const s=e[r];s&&(s.visible=r===i)}}}}p9([C(ve)],Fb.prototype,"idle",2),p9([C(ve)],Fb.prototype,"talking",2);class bD extends Be{constructor(){super(...arguments),p(this,"voip",null),p(this,"marker",null),p(this,"_startPosition",null)}awake(){this.voip=ie.findObjectOfType(Bd,this.context),this.marker=ie.getComponentInParent(this.gameObject,as)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const e=this.marker.connectionId,i=this.voip.getFrequency(e);if(i==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const r=i/100;this.gameObject.position.y=this._startPosition.y+r*.07}}var Eve=Object.defineProperty,Mve=Object.getOwnPropertyDescriptor,fE=(n,e,i,r)=>{for(var s=r>1?void 0:r?Mve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Eve(e,i,s),s};class Nf extends Be{constructor(){super(...arguments),p(this,"eyes",[]),p(this,"lastBlinkTime",0),p(this,"blinkLength",0),p(this,"eyesOpen",!0),p(this,"state",null)}awake(){this.state=ie.getComponentInParent(this.gameObject,sa)}update(){if(!(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)&&this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const e of this.eyes)e&&(e.visible=this.eyesOpen)}}}fE([C(ve)],Nf.prototype,"eyes",2),fE([C()],Nf.prototype,"lastBlinkTime",2),fE([C()],Nf.prototype,"blinkLength",2),fE([C()],Nf.prototype,"eyesOpen",2);var Tve=Object.defineProperty,Ive=Object.getOwnPropertyDescriptor,xD=(n,e,i,r)=>{for(var s=r>1?void 0:r?Ive(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Tve(e,i,s),s},_D;const f9=(_D=class extends Be{constructor(){super(...arguments),p(this,"head",null),p(this,"eyes",null),p(this,"target",null),p(this,"brain",null),p(this,"vec",new S),p(this,"currentTargetPoint",new S)}awake(){this.brain||(this.brain=ie.getComponentInParent(this.gameObject,Lb)),this.brain||(console.log("No look at brain found, adding it now"),this.brain=ie.addNewComponent(this.gameObject,Lb)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const n=this.target;if(n&&this.head){const e=this.eyes;if(e){const i=kt(n);this.currentTargetPoint.lerp(i,this.context.time.deltaTime/.1);const r=kt(this.head),s=this.vec.copy(this.currentTargetPoint).sub(r).normalize();if(s.length()<.1)return;const o=f9.forward;if(o.set(0,0,1),o.applyQuaternion(Ri(this.head)),o.dot(s)>.45)for(let a=0;a<e.length;a++)e[a].lookAt(this.currentTargetPoint)}}}},p(_D,"forward",new S(0,0,1)),_D);let O0=f9;xD([C(ve)],O0.prototype,"head",2),xD([C(ve)],O0.prototype,"eyes",2),xD([C(ve)],O0.prototype,"target",2);const Nb=te("debugavatar");class mE{constructor(e,i,r,s){p(this,"root"),p(this,"head"),p(this,"leftHand"),p(this,"rigthHand");var o;this.root=e,this.head=i,this.leftHand=r,this.rigthHand=s,(o=this.root)==null||o.traverse(a=>a.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class wD{constructor(){p(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(e,i){if(!i)return console.error("Can not create avatar: failed to provide id or root object"),null;let r=null;if(typeof i=="string"){if(r=await this.loadAvatar(e,i),!r){const o=new Vl;r=ie.instantiate(fg(i,e.scene),o)}}else r=i;if(!r)return null;const s=this.findAvatar(r);return s.isValid?(Nb&&console.log("[Custom Avatar] valid config",i,Nb?s:""),s):(console.warn("[Custom Avatar] config isn't valid",i,Nb?s:""),null)}async loadAvatar(e,i){if(console.assert(i!=null&&typeof i=="string","Avatar id must not be null"),i.length<=0||!i)return null;if(Nb&&console.log("[Custom Avatar] "+i+", loading..."),i.endsWith(".glb")||(i+=".glb"),this.avatarRegistryUrl===null){const s=await fetch("./"+i);let o=null;if(s.ok){const l=await s.blob();l&&(o=await l.arrayBuffer())}if(!o&&(o=await Zk(i,i,0,"no url here go away",!0),!o))return null;const a=await ul().parseSync(e,o,null,0);return a?.scene??null}const r=new gd;return NC(r,e),new Promise((s,o)=>{const a=this.avatarRegistryUrl+"/"+i;r.load(a,async l=>{await ul().createBuiltinComponents(e,a,l,null,void 0),s(l.scene)},l=>{Nb&&console.log("[Custom Avatar] "+l.loaded/l.total*100+"% loaded of "+l.total/1024+"kB")},l=>{console.error("[Custom Avatar] Error when loading: "+l),s(null)})})}cacheModel(e,i){}findAvatar(e){const i=e;let r=i;r.children.length==1&&(r=e.children[0]);let s=this.findAvatarPart(r,["head"]);const o=this.findAvatarPart(r,["left","hand"]),a=this.findAvatarPart(r,["right","hand"]);if(!s){s=i;const l=new S;new Ht().setFromObject(s).getSize(l);const c=Math.max(l.x,l.y,l.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+c+" meters! Should be < 0.3m"),c>.3&&s.scale.multiplyScalar(1/c*.3)}return new mE(i,s,o,a)}findAvatarPart(e,i){const r=e.name.toLowerCase();let s=!0;for(const o of i){if(!s)break;r.indexOf(o)===-1&&(s=!1)}if(s)return e;if(e.children)for(const o of e.children){const a=this.findAvatarPart(o,i);if(a)return a}return null}handleCustomAvatarErrors(e){if(!e.ok)throw Error(e.statusText);return e}}var Rve=Object.defineProperty,Pve=Object.getOwnPropertyDescriptor,SD=(n,e,i,r)=>{for(var s=r>1?void 0:r?Pve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Rve(e,i,s),s};class D0 extends Be{constructor(){super(...arguments),p(this,"length",1),p(this,"depthTest",!0),p(this,"isGizmo",!1),p(this,"_axes",null)}onEnable(){if(this.isGizmo&&!VA)return;this._axes||(this._axes=new Vo(this.length)),this._axes.layers.disableAll(),this._axes.layers.set(this.layer),this.gameObject.add(this._axes);const e=this._axes.material;e&&e.depthTest!==void 0&&(e.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}SD([C()],D0.prototype,"length",2),SD([C()],D0.prototype,"depthTest",2),SD([C()],D0.prototype,"isGizmo",2);class CD extends Be{constructor(){super(...arguments),p(this,"from"),p(this,"to"),p(this,"hint"),p(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const e=kt(this.to).clone(),i=kt(this.from).clone(),r=e.distanceTo(i),s=e.clone();s.sub(i);const o=i.clone();o.add(e),o.multiplyScalar(.5);const a=kt(this.hint).clone();a.sub(o);const l=new S;l.crossVectors(a,s),l.crossVectors(s,l),l.normalize();const c=r*.5,h=Math.max(this.desiredDistance,c),u=Math.sqrt(h*h-c*c),d=l.clone();d.multiplyScalar(u),d.add(o),gr(this.gameObject,d);const f=o.clone();f.sub(l),this.gameObject.lookAt(f)}}const ED=te("debugusdzbehaviours");class gE{constructor(){p(this,"behaviours",[]),p(this,"behaviourComponents",[]),p(this,"behaviourComponentsCopy",[]),p(this,"audioClips",[]),p(this,"audioClipsCopy",[])}get extensionName(){return"Behaviour"}addBehavior(e){this.behaviours.push(e)}addAudioClip(e){if(!e||typeof e!="string")return"";const i="audio/"+hp.getName(e);return this.audioClips.push({clipUrl:e,filesKey:i}),i}onBeforeBuildDocument(e){if(!e.root)return Promise.resolve();const i=[];return e.root.traverse(r=>{ie.foreachComponent(r,s=>{var o;const a=s;if(typeof a.createBehaviours=="function"||typeof a.beforeCreateDocument=="function"||typeof a.afterCreateDocument=="function"||typeof a.afterSerialize=="function"){this.behaviourComponents.push(a);const l=(o=a.beforeCreateDocument)==null?void 0:o.call(a,this,e);l instanceof Promise&&i.push(l)}},!1)}),ED&&console.log("onBeforeBuildDocument: all components",this.behaviourComponents),Promise.all(i)}onExportObject(e,i,r){var s;for(const o of this.behaviourComponents)ED&&console.log("onExportObject: createBehaviours",o),(s=o.createBehaviours)==null||s.call(o,this,i,r)}onAfterBuildDocument(e){for(const i of this.behaviourComponents)typeof i.afterCreateDocument=="function"&&i.afterCreateDocument(this,e);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0,this.audioClipsCopy=this.audioClips.slice(),this.audioClips.length=0}onAfterHierarchy(e,i){var r;if((r=this.behaviours)!=null&&r.length){i.beginBlock('def Scope "Behaviors"');for(const s of this.behaviours)s.writeTo(this,e.document,i);i.closeBlock()}}async onAfterSerialize(e){ED&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const i of this.behaviourComponentsCopy)typeof i.afterSerialize=="function"&&(i.afterSerialize.constructor.name==="AsyncFunction"?await i.afterSerialize(this,e):i.afterSerialize(this,e));for(const{clipUrl:i,filesKey:r}of this.audioClipsCopy){if(e.files[r])return;const s=await(await(await fetch(i)).blob()).arrayBuffer(),o=new Uint8Array(s);e.files[r]=o}this.behaviourComponentsCopy.length=0,this.audioClipsCopy.length=0}}var Bve=Object.defineProperty,kve=Object.getOwnPropertyDescriptor,MD=(n,e,i,r)=>{for(var s=r>1?void 0:r?kve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Bve(e,i,s),s},TD;const m9=(TD=class extends ss{constructor(){super(...arguments),p(this,"threshold",new Ke(.9)),p(this,"intensity",new Ke(1)),p(this,"scatter",new Ke(.3)),p(this,"selectiveBloom")}get typeName(){return"Bloom"}init(){this.threshold.valueProcessor=n=>n,this.intensity.valueProcessor=n=>n,this.scatter.valueProcessor=n=>n}onCreateEffect(){let n;if(this.selectiveBloom==null&&(this.selectiveBloom=m9.useSelectiveBloom),this.selectiveBloom){const e=n=new t5(this.context.scene,this.context.mainCamera,{blendFunction:Vt.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});e.inverted=!0}else n=new xP({blendFunction:Vt.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});return this.intensity.onValueChanged=e=>{n.intensity=e},this.threshold.onValueChanged=e=>{n.luminanceMaterial.threshold=Math.pow(e,2.2)},this.scatter.onValueChanged=e=>{n.luminancePass.enabled=!0,n.luminanceMaterial.smoothing=e,n.mipmapBlurPass&&(n.mipmapBlurPass.radius=pi.lerp(.1,.9,e))},n}},p(TD,"useSelectiveBloom",!1),TD);let zf=m9;MD([C(Ke)],zf.prototype,"threshold",2),MD([C(Ke)],zf.prototype,"intensity",2),MD([C(Ke)],zf.prototype,"scatter",2),Qa("Bloom",zf);var Ove=Object.defineProperty,Dve=Object.getOwnPropertyDescriptor,Ro=(n,e,i,r)=>{for(var s=r>1?void 0:r?Dve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Ove(e,i,s),s};class oa extends Be{constructor(){super(...arguments),p(this,"attachedRigidbody",null),p(this,"isTrigger",!1),p(this,"sharedMaterial"),p(this,"membership",[0]),p(this,"filter"),p(this,"updateProperties",()=>{var e;(e=this.context.physics.engine)==null||e.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Oi))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Oi))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Oi))}onDisable(){var e;(e=this.context.physics.engine)==null||e.removeBody(this)}get body(){var e;return(e=this.context.physics.engine)==null?void 0:e.getBody(this)}updatePhysicsMaterial(){var e;(e=this.context.physics.engine)==null||e.updatePhysicsMaterial(this)}}Ro([C(Oi)],oa.prototype,"attachedRigidbody",2),Ro([C()],oa.prototype,"isTrigger",2),Ro([C()],oa.prototype,"sharedMaterial",2),Ro([C()],oa.prototype,"membership",2),Ro([C()],oa.prototype,"filter",2);class L0 extends oa{constructor(){super(...arguments),p(this,"radius",.5),p(this,"center",new S(0,0,0))}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addSphereCollider(this),o1(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),u2(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}Ro([ns(),C()],L0.prototype,"radius",2),Ro([C(S)],L0.prototype,"center",2);const g9=class extends oa{constructor(){super(...arguments),p(this,"size",new S(1,1,1)),p(this,"center",new S(0,0,0))}static add(n,e){const i=new g9;n.geometry.boundingBox||n.geometry.computeBoundingBox();const r=n.geometry.boundingBox;return i.size=r.getSize(new S)||new S(1,1,1),i.center=r.getCenter(new S)||new S(0,0,0),Zo(n,i),e?.rigidbody===!0&&Zo(n,Oi,{isKinematic:!1}),i}onEnable(){var n;super.onEnable(),(n=this.context.physics.engine)==null||n.addBoxCollider(this,this.size),o1(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),u2(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}};let U0=g9;Ro([ns(),C(S)],U0.prototype,"size",2),Ro([C(S)],U0.prototype,"center",2);class jf extends oa{constructor(){super(...arguments),p(this,"sharedMesh"),p(this,"convex",!1)}onEnable(){var e,i,r;if(super.onEnable(),!this.context.physics.engine)return;(e=this.sharedMesh)!=null&&e.isMesh||this.gameObject instanceof pe&&(this.sharedMesh=this.gameObject);const s=0;if((i=this.sharedMesh)!=null&&i.isMesh)this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,Qi(this.gameObject)),mi.assignMeshLOD(this.sharedMesh,s).then(o=>{o&&this.activeAndEnabled&&this.context.physics.engine&&this.sharedMesh&&(this.context.physics.engine.removeBody(this),this.sharedMesh.geometry=o,this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,Qi(this.gameObject)))});else{const o=this.sharedMesh;if(o!=null&&o.isGroup){console.warn(`MeshCollider mesh is a group "${((r=this.sharedMesh)==null?void 0:r.name)||this.gameObject.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);const a=new Array;for(const l in o.children){const c=o.children[l];c.isMesh&&(this.context.physics.engine.addMeshCollider(this,c,this.convex,Qi(this.gameObject)),a.push(mi.assignMeshLOD(c,s)))}Promise.all(a).then(l=>{var c,h;if(l.some(d=>d)==!1)return;(c=this.context.physics.engine)==null||c.removeBody(this);const u=new pe;for(const d of l)d&&this.activeAndEnabled&&(u.geometry=d,(h=this.context.physics.engine)==null||h.addMeshCollider(this,u,this.convex,Qi(this.gameObject)))})}}}}Ro([C(pe)],jf.prototype,"sharedMesh",2),Ro([C()],jf.prototype,"convex",2);class Vh extends oa{constructor(){super(...arguments),p(this,"center",new S(0,0,0)),p(this,"radius",.5),p(this,"height",2)}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addCapsuleCollider(this,this.height,this.radius)}}Ro([C(S)],Vh.prototype,"center",2),Ro([C()],Vh.prototype,"radius",2),Ro([C()],Vh.prototype,"height",2);var Lve=Object.defineProperty,Uve=Object.getOwnPropertyDescriptor,ID=(n,e,i,r)=>{for(var s=r>1?void 0:r?Uve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Lve(e,i,s),s};class Gf extends Be{constructor(){super(...arguments),p(this,"objectBounds",!1),p(this,"color"),p(this,"isGizmo",!0),p(this,"_gizmoObject",null),p(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!VA||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new n2(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=gk(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),Xi.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){for(var e;this._boxHelper;)(e=this._boxHelper)==null||e.update(),yield}}ID([C()],Gf.prototype,"objectBounds",2),ID([C(be)],Gf.prototype,"color",2),ID([C()],Gf.prototype,"isGizmo",2);const Fve=te("gizmos"),Nve=te("debugboxhelper"),Bl=class extends Be{constructor(){super(...arguments),p(this,"box",null),p(this,"_lastMatrixUpdateFrame",-1),p(this,"_helper",null),p(this,"_color",null)}isInBox(n,e){var i;if(!n)return;if(this.box||(this.box=new Ht),n.type==="Mesh")Bl.testBox.setFromObject(n);else if(n.type==="Group"){if(Bl.testBox.makeEmpty(),n.children.length>0)for(let s=0;s<n.children.length;s++)n.children[s].type==="Mesh"&&Bl.testBox.expandByObject(n)}else{const s=kt(n,Bl._position),o=Qi(n,Bl._size);e!==void 0&&o.multiplyScalar(e),Bl.testBox.setFromCenterAndSize(s,o)}this.updateBox();const r=(i=this.box)==null?void 0:i.intersectsBox(Bl.testBox);return r&&Nve&&yt.DrawWireBox3(Bl.testBox,16711680,5),r}intersects(n){return n?this.updateBox(!1).intersectsBox(n):!1}updateBox(n=!1){if(this.box||(this.box=new Ht),n||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const e=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const i=e,r=kt(this.gameObject,Bl._position,i),s=Qi(this.gameObject,Bl._size);this.box.setFromCenterAndSize(r,s)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(n=null,e=!1){var i;if(!(!Fve&&!e)){if(this._helper){n&&((i=this._color)==null||i.set(n)),this.gameObject.add(this._helper);return}this._helper=gk(n),this.gameObject.add(this._helper)}}};let Mc=Bl;p(Mc,"testBox",new Ht),p(Mc,"_position",new S),p(Mc,"_size",new S(.01,.01,.01));class zve extends vj{constructor(e,i={}){super(e),e._simpleState__activeStates=[],e._simpleState__normalStyles={},e._simpleState__states=i,e._simpleState__statesProperties={};for(const r in i)for(const s in i[r])e._simpleState__statesProperties[s]||(e._simpleState__statesProperties[s]=[]),e._simpleState__statesProperties[s].push(r);for(const r of e._components)e._simpleState__statesProperties[r.id]&&(e._simpleState__normalStyles[r.id]=r.inline?r.inline:r._value);e.__overridedSet=e.set,e.set=this.storeSet.bind(e),e.renderStates=this.renderStates.bind(e),e.setupState=this.setupState.bind(e),e.setState=this.setState.bind(e),e.activatePseudoState=this.activatePseudoState.bind(e),e.deactivatePseudoState=this.deactivatePseudoState.bind(e),e.togglePseudoState=this.togglePseudoState.bind(e)}act(){}attach(){}detach(){}setupState(e,i){this._simpleState__states[e]=i;const r=[];for(const s in i)this._simpleState__statesProperties[s]||(this._simpleState__statesProperties[s]=[],r.push(s)),this._simpleState__statesProperties[s].push(e);for(const s of this._components)r.indexOf(s.id)>-1&&(this._simpleState__normalStyles[s.id]=s.inline?s.inline:s._value)}renderStates(){let e={...this._simpleState__normalStyles};for(const i in this._simpleState__states)this._simpleState__activeStates.indexOf(i)>-1&&(e={...e,...this._simpleState__states[i]});this.set(e,!1)}storeSet(e,i=!0){if(i)for(const r in e)this._simpleState__statesProperties[r]&&(this._simpleState__normalStyles[r]=e[r]);this.__overridedSet(e)}activatePseudoState(e){this._simpleState__activeStates.indexOf(e)===-1&&(this._simpleState__activeStates.push(e),this.renderStates())}deactivatePseudoState(e){const i=this._simpleState__activeStates.indexOf(e);i>-1&&(this._simpleState__activeStates.splice(i,1),this.renderStates())}togglePseudoState(e){const i=this._simpleState__activeStates.indexOf(e);i>-1?this._simpleState__activeStates.splice(i,1):this._simpleState__activeStates.push(e),this.renderStates()}setState(e){Array.isArray(e)?this._simpleState__activeStates=e:this._simpleState__activeStates=[e],this.renderStates()}}var jve=Object.defineProperty,Gve=Object.getOwnPropertyDescriptor,v9=(n,e,i,r)=>{for(var s=r>1?void 0:r?Gve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&jve(e,i,s),s};class F0 extends Be{constructor(){super(...arguments),p(this,"effectColor"),p(this,"effectDistance")}}v9([C(ki)],F0.prototype,"effectColor",2),v9([C(J)],F0.prototype,"effectDistance",2);var Hve=Object.defineProperty,Vve=Object.getOwnPropertyDescriptor,zb=(n,e,i,r)=>{for(var s=r>1?void 0:r?Vve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Hve(e,i,s),s};const RD=te("debugui"),PD=te("debuguilayout");class BD{constructor(){p(this,"width"),p(this,"height")}}class kD{constructor(){p(this,"x"),p(this,"y"),p(this,"width"),p(this,"height")}}const kl=new S,jb=new he,vE=new Ce,y9=class extends nl{constructor(){super(...arguments),p(this,"_anchoredPosition"),p(this,"sizeDelta",new J(100,100)),p(this,"pivot",new J(.5,.5)),p(this,"anchorMin",new J(0,0)),p(this,"anchorMax",new J(1,1)),p(this,"minWidth"),p(this,"minHeight"),p(this,"lastMatrix"),p(this,"rectBlock"),p(this,"_transformNeedsUpdate",!1),p(this,"_initialPosition"),p(this,"_parentRectTransform"),p(this,"_lastUpdateFrame",-1),p(this,"_lastAnchoring"),p(this,"_createdBlocks",[]),p(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new J),this._anchoredPosition}set anchoredPosition(n){this._anchoredPosition=n}get width(){let n=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const e=this._parentRectTransform.width,i=this.anchorMax.x-this.anchorMin.x;n=e*i,n+=this.sizeDelta.x}return this.minWidth!==void 0&&n<this.minWidth?this.minWidth:n}get height(){let n=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const e=this._parentRectTransform.height,i=this.anchorMax.y-this.anchorMin.y;n=e*i,n+=this.sizeDelta.y}return this.minHeight!==void 0&&n<this.minHeight?this.minHeight:n}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new J),this.lastMatrix=new he,this.rectBlock=new ve,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,I0(this,"_anchoredPosition",()=>{this.markDirty()}),I0(this,"sizeDelta",()=>{this.markDirty()}),I0(this,"pivot",()=>{this.markDirty()}),I0(this,"anchorMin",()=>{this.markDirty()}),I0(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var n;super.onEnable(),this.rectBlock||(this.rectBlock=new ve),this.lastMatrix||(this.lastMatrix=new he),this._lastAnchoring||(this._lastAnchoring=new J),this._initialPosition||(this._initialPosition=new S),this._anchoredPosition||(this._anchoredPosition=new J),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(n=this.canvas)==null||n.registerTransform(this)}onDisable(){var n;super.onDisable(),this.removeShadowComponent(),(n=this.canvas)==null||n.unregisterTransform(this)}onParentRectTransformChanged(n){this._transformNeedsUpdate||this.onApplyTransform(PD?`${n.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(PD&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(n){var e;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const i=this.shadowComponent;if(!i)return;this.gameObject.parent?this._parentRectTransform=ie.getComponentInParent(this.gameObject.parent,y9):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,PD&&console.warn("RectTransform \u2192 ApplyTransform",this.name+" because "+n),this.isRoot()?this.Root.screenspace||(i.rotation.y=Math.PI):(i.matrix.identity(),i.matrixAutoUpdate=!1,kl.set(0,0,0),this.applyPivot(kl),i.matrix.setPosition(kl.x,kl.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(vE.copy(this.gameObject.quaternion),vE.x*=-1,vE.z*=-1,jb.makeRotationFromQuaternion(vE),i.matrix.premultiply(jb)),kl.set(0,0,0),this.applyAnchoring(kl),(e=this.canvas)!=null&&e.screenspace?kl.z+=.1:kl.z+=.01,jb.identity(),jb.setPosition(kl.x,kl.y,kl.z),i.matrix.premultiply(jb),i.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const r=!0;for(const s of fC(this.gameObject,nl,r,1)){if(s===this||!s.activeAndEnabled)continue;const o=s;o.onParentRectTransformChanged&&o.onParentRectTransformChanged(this)}}applyAnchoring(n){this._lastAnchoring||(this._lastAnchoring=new J);const e=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=e.x,this.gameObject.position.y+=e.y,this._lastAnchoring.copy(this._anchoredPosition),n.x+=this._initialPosition.x-this.gameObject.position.x,n.y+=this._initialPosition.y-this.gameObject.position.y,n.z+=this._initialPosition.z-this.gameObject.position.z;const i=this._parentRectTransform;if(i){let r=0;const s=1-this.anchorMax.y-this.anchorMin.y;r-=i.height*.5*s,n.y+=r;let o=0;const a=1-this.anchorMax.x-this.anchorMin.x;o-=i.width*.5*a,n.x+=o}}applyPivot(n){if(this.pivot&&!this.isRoot()){const e=this.pivot.x-.5;n.x-=e*this.sizeDelta.x*this.gameObject.scale.x;const i=this.pivot.y-.5;n.y-=i*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const n={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(n),n}ensureValidSize(n,e=1e-4){return n.width<=0&&(n.width=e),n.height<=0&&(n.height=1e-4),n}createNewBlock(n){n={...this.getBasicOptions(),...n},RD&&console.log(this.name,n);const e=new q2(n);return this._createdBlocks.push(e),e}createNewText(n){RD&&console.log(n),n={...this.getBasicOptions(),...n},RD&&console.log(this.name,n);const e=new J2(n);return this._createdTextBlocks.push(e),e}};let zs=y9;zb([C(J)],zs.prototype,"anchoredPosition",1),zb([C(J)],zs.prototype,"sizeDelta",2),zb([C(J)],zs.prototype,"pivot",2),zb([C(J)],zs.prototype,"anchorMin",2),zb([C(J)],zs.prototype,"anchorMax",2);var Qve=Object.defineProperty,Wve=Object.getOwnPropertyDescriptor,A9=(n,e,i,r)=>{for(var s=r>1?void 0:r?Wve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Qve(e,i,s),s};const yE={backgroundColor:new be(1,1,1),backgroundOpacity:1,borderColor:new be(1,1,1),borderOpacity:1};var OD;const Gb=(OD=class extends nl{constructor(){super(...arguments),p(this,"_alphaFactor",1),p(this,"sRGBColor",new be(1,0,1)),p(this,"raycastTarget",!0),p(this,"uiObject",null),p(this,"_color",null),p(this,"_rect",null),p(this,"_stateManager",null),p(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new ki(1,1,1,1)),this._color}set color(n){(!this._color||this._color.r!==n.r||this._color.g!==n.g||this._color.b!==n.b||this._color.alpha!==n.alpha)&&(this._color||(this._color=new ki(1,1,1,1)),this._color.copy(n),this.onColorChanged())}setAlphaFactor(n){this._alphaFactor=n,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(this.sRGBColor.copy(this._color),this.sRGBColor.convertLinearToSRGB(),yE.backgroundColor=this.sRGBColor,yE.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects(yE,this._alphaFactor),this.uiObject.set(yE),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=ie.getComponent(this.gameObject,zs)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var n;(n=this.uiObject)==null||n.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(n){return super.__internalNewInstanceCreated(n),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone()),this}setState(n){this.makePanel(),this.uiObject&&(this.uiObject.setState(n),this==null||this.markDirty())}setupState(n){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new zve(this.uiObject)),this.uiObject.setupState(n.state,n.attributes))}setOptions(n){this.makePanel(),this.uiObject&&this.uiObject.set(n)}awake(){super.awake(),this.makePanel(),I0(this,"_color",()=>d0e(this,this.onColorChanged))}onEnable(){var n;super.onEnable(),this.uiObject&&((n=this.rectTransform.shadowComponent)==null||n.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const n=.015,e={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:n};this.onBeforeCreate(e),this.applyEffects(e),this.onCreate(e),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated(),this.onColorChanged()}onBeforeCreate(n){}onCreate(n){this.uiObject=this.rectTransform.createNewBlock(n),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(n,e=1){var i;const r=(i=this.gameObject)==null?void 0:i.getComponent(F0);r&&(r.effectDistance&&(n.borderWidth=Math.max(Math.abs(r.effectDistance.x),Math.abs(r.effectDistance.y))),r.effectColor&&(n.borderColor=r.effectColor,n.borderOpacity=r.effectColor.alpha*e))}async setTexture(n){if(this.setOptions({backgroundOpacity:0}),n){if(Gb.textureCache.has(n))n=Gb.textureCache.get(n);else if(!n.isRenderTargetTexture){const e=n.clone();e.colorSpace=Ii,Gb.textureCache.set(n,e),n=e}this.setOptions({backgroundImage:n,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}),mi.assignTextureLOD(n,0).then(e=>{e instanceof Gt&&(n&&Gb.textureCache.set(n,e),this.setOptions({backgroundImage:e}),this.markDirty())})}else this.setOptions({backgroundImage:void 0,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}},p(OD,"textureCache",new Map),OD);let Hf=Gb;A9([C(ki)],Hf.prototype,"color",1),A9([C()],Hf.prototype,"raycastTarget",2);class Hb extends Hf{constructor(){super(...arguments),p(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var Xve=Object.defineProperty,qve=Object.getOwnPropertyDescriptor,AE=(n,e,i,r)=>{for(var s=r>1?void 0:r?qve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Xve(e,i,s),s};let DD=class{constructor(){p(this,"texture",null),p(this,"rect")}};AE([C(Gt)],DD.prototype,"texture",2);let N0=class extends Hb{constructor(){super(...arguments),p(this,"_sprite"),p(this,"pixelsPerUnitMultiplier",1)}set image(n){this.sprite||(this.sprite=new DD),this.sprite.texture=n,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(n){this._sprite!==n&&(this._sprite=n,this.onAfterCreated())}isBuiltinSprite(){var n,e,i,r,s,o,a;const l=this.sprite;switch((n=l?.texture)==null?void 0:n.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return!((i=(e=l?.texture)==null?void 0:e.name)!=null&&i.length)&&((s=(r=l?.texture)==null?void 0:r.image)==null?void 0:s.width)===32&&((a=(o=l?.texture)==null?void 0:o.image)==null?void 0:a.height)===32}onBeforeCreate(n){var e,i;super.onBeforeCreate(n),this.isBuiltinSprite()&&(n.borderRadius=5/this.pixelsPerUnitMultiplier,((i=(e=this.sprite)==null?void 0:e.texture)==null?void 0:i.name)==="Knob"&&(n.borderRadius=999))}onAfterCreated(){var n;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((n=this.sprite)==null?void 0:n.texture))}};AE([C(DD)],N0.prototype,"sprite",1),AE([C()],N0.prototype,"pixelsPerUnitMultiplier",2);class bE extends Hb{constructor(){super(...arguments),p(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(e){this._mainTexture!==e&&(this._mainTexture=e,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}AE([C(Gt)],bE.prototype,"mainTexture",1);var Yve=Object.defineProperty,Jve=Object.getOwnPropertyDescriptor,aa=(n,e,i,r)=>{for(var s=r>1?void 0:r?Jve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Yve(e,i,s),s};const Vf=te("debugbutton");class kd{constructor(){p(this,"colorMultiplier"),p(this,"disabledColor"),p(this,"fadeDuration"),p(this,"highlightedColor"),p(this,"normalColor"),p(this,"pressedColor"),p(this,"selectedColor")}}aa([C()],kd.prototype,"colorMultiplier",2),aa([C(ki)],kd.prototype,"disabledColor",2),aa([C()],kd.prototype,"fadeDuration",2),aa([C(ki)],kd.prototype,"highlightedColor",2),aa([C(ki)],kd.prototype,"normalColor",2),aa([C(ki)],kd.prototype,"pressedColor",2),aa([C(ki)],kd.prototype,"selectedColor",2);class Kve{constructor(){p(this,"disabledTrigger"),p(this,"highlightedTrigger"),p(this,"normalTrigger"),p(this,"pressedTrigger"),p(this,"selectedTrigger")}}class Qh extends Be{constructor(){super(...arguments),p(this,"onClick"),p(this,"_isHovered",0),p(this,"colors"),p(this,"transition"),p(this,"animationTriggers"),p(this,"animator"),p(this,"_interactable",!0),p(this,"_requestedAnimatorTrigger"),p(this,"_isInit",!1),p(this,"_image")}click(){var e;(e=this.onClick)==null||e.invoke()}onPointerEnter(e){var i,r;const s=e.event.pointerType==="mouse"&&e.button===0;s&&(this._isHovered+=1),Vf&&console.warn("Button Enter",s,this._isHovered,(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===1&&this.colors&&((r=this._image)==null||r.setState("hovered")),s&&this.context.input.setCursorPointer())}onPointerExit(){var e,i;this._isHovered-=1,this._isHovered<0&&(this._isHovered=0),Vf&&console.log("Button Exit",this._isHovered,(e=this.animationTriggers)==null?void 0:e.highlightedTrigger,this.animator),this.interactable&&(this._isHovered>0||(this._isHovered=0,this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState("normal")),this.context.input.setCursorNormal()))}onPointerDown(e){var i,r;Vf&&console.log("Button Down",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===1&&this.colors&&((r=this._image)==null||r.setState("pressed")))}onPointerUp(e){var i,r;Vf&&console.warn("Button Up",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((r=this._image)==null||r.setState(this._isHovered?"hovered":"normal")))}onPointerClick(e){if(this.interactable&&!(e.button!==0&&e.event.pointerType===CS.Mouse)&&(Vf&&(console.warn("Button Click",this.onClick),dn("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),e.use(),Vf))){const i=this.gameObject.worldPosition;i.add(this.gameObject.worldUp.multiplyScalar(1+Math.random()*.5)),yt.DrawLabel(i,"CLICK:"+Date.now(),.1,1+Math.random()*.5)}}set interactable(e){this._interactable=e,this._image&&(this._image.setInteractable(e),e?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(e){this.interactable=e}awake(){super.awake(),Vf&&console.log(this),this._isInit=!1,this.init()}start(){var e;(e=this._image)==null||e.setInteractable(this.interactable),this.gameObject.getComponentInParent(bb)||this.gameObject.addComponent(ZC)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(e){var i;this._requestedAnimatorTrigger=e,yield,yield,this._requestedAnimatorTrigger==e&&((i=this.animator)==null||i.SetTrigger(e))}init(){this._isInit||(this._isInit=!0,this._image=ie.getComponent(this.gameObject,N0),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(e){var i,r,s,o,a;e.setInteractable(this.interactable);const l=this.getFinalColor(e.color,(i=this.colors)==null?void 0:i.normalColor),c={state:"normal",attributes:{backgroundColor:l,backgroundOpacity:l.alpha}};e.setupState(c);const h=this.getFinalColor(e.color,(r=this.colors)==null?void 0:r.highlightedColor),u={state:"hovered",attributes:{backgroundColor:h,backgroundOpacity:h.alpha}};e.setupState(u);const d=this.getFinalColor(e.color,(s=this.colors)==null?void 0:s.pressedColor),f={state:"pressed",attributes:{backgroundColor:d,backgroundOpacity:d.alpha}};e.setupState(f);const m=this.getFinalColor(e.color,(o=this.colors)==null?void 0:o.selectedColor),g={state:"selected",attributes:{backgroundColor:m,backgroundOpacity:m.alpha}};e.setupState(g);const v=this.getFinalColor(e.color,(a=this.colors)==null?void 0:a.disabledColor),y={state:"disabled",attributes:{backgroundColor:v,backgroundOpacity:v.alpha}};e.setupState(y)}getFinalColor(e,i){return i?e.clone().multiply(i).convertLinearToSRGB():e.clone().convertLinearToSRGB()}}aa([C(An)],Qh.prototype,"onClick",2),aa([C(kd)],Qh.prototype,"colors",2),aa([C()],Qh.prototype,"transition",2),aa([C(Kve)],Qh.prototype,"animationTriggers",2),aa([C(rs)],Qh.prototype,"animator",2),aa([C()],Qh.prototype,"interactable",1);var Zve=Object.defineProperty,$ve=Object.getOwnPropertyDescriptor,nr=(n,e,i,r)=>{for(var s=r>1?void 0:r?$ve(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Zve(e,i,s),s};const b9=te("debuguilayout");class Od{constructor(){p(this,"left",0),p(this,"right",0),p(this,"top",0),p(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}nr([C()],Od.prototype,"left",2),nr([C()],Od.prototype,"right",2),nr([C()],Od.prototype,"top",2),nr([C()],Od.prototype,"bottom",2);class la extends Be{constructor(){super(...arguments),p(this,"_rectTransform",null),p(this,"_needsUpdate",!1),p(this,"childAlignment",0),p(this,"reverseArrangement",!1),p(this,"spacing",0),p(this,"padding"),p(this,"minWidth",0),p(this,"minHeight",0),p(this,"flexibleHeight",0),p(this,"flexibleWidth",0),p(this,"preferredHeight",0),p(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(e){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&(b9&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){b9&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(zs);const e=this.gameObject.getComponentInParent(ls);e&&e.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const e=this.gameObject.getComponentInParent(ls);e&&e.unregisterLayoutGroup(this)}set m_Spacing(e){e!==this.spacing&&(this._needsUpdate=!0,this.spacing=e)}get m_Spacing(){return this.spacing}}nr([C()],la.prototype,"childAlignment",2),nr([C()],la.prototype,"reverseArrangement",2),nr([C()],la.prototype,"spacing",2),nr([C(Od)],la.prototype,"padding",2),nr([C()],la.prototype,"minWidth",2),nr([C()],la.prototype,"minHeight",2),nr([C()],la.prototype,"flexibleHeight",2),nr([C()],la.prototype,"flexibleWidth",2),nr([C()],la.prototype,"preferredHeight",2),nr([C()],la.prototype,"preferredWidth",2);class Dd extends la{constructor(){super(...arguments),p(this,"childControlHeight",!0),p(this,"childControlWidth",!0),p(this,"childForceExpandHeight",!1),p(this,"childForceExpandWidth",!1),p(this,"childScaleHeight",!1),p(this,"childScaleWidth",!1)}onCalculateLayout(e){var i;const r=this.primaryAxis,s=e.width;let o=s;const a=e.height;let l=a;o-=this.padding.horizontal,l-=this.padding.vertical,r==="x"?this.padding.horizontal:this.padding.vertical;const c=r==="x",h=c?"y":"x",u=c?this.childControlWidth:this.childControlHeight,d=c?this.childControlHeight:this.childControlWidth,f=c?this.childForceExpandWidth:this.childForceExpandHeight,m=c?this.childForceExpandHeight:this.childForceExpandWidth,g=c?l:o,v=c?s:a,y=.5*(c?this.childAlignment%3:Math.floor(this.childAlignment/3));let A=0;c?A+=this.padding.left:A+=this.padding.top;let b=0,x=0;for(let R=0;R<this.gameObject.children.length;R++){const B=this.gameObject.children[R],E=ie.getComponent(B,zs);E!=null&&E.activeAndEnabled&&(x+=1,c?b+=E.width:b+=E.height)}let _=0;const w=this.spacing*(x-1);if(f||u){let R=0;c?R=o-=w:R=l-=w,x>0&&(_=R/x)}let T=0;T+=this.padding.left,T-=this.padding.right,y!==0&&(A=v-b,A*=y,A-=w*y,c?(A-=this.padding.right*y,A+=this.padding.left*(1-y),A<this.padding.left&&(A=this.padding.left)):(A-=this.padding.bottom*y,A+=this.padding.top*(1-y),A<this.padding.top&&(A=this.padding.top)));let M=1;for(let R=0;R<this.gameObject.children.length;R++){const B=this.gameObject.children[R],E=ie.getComponent(B,zs);if(E!=null&&E.activeAndEnabled){(i=E.pivot)==null||i.set(.5,.5),E.anchorMin.set(0,1),E.anchorMax.set(0,1);const P=s*.5+T*.5;E.anchoredPosition.x!==P&&(E.anchoredPosition.x=P);const O=a*-.5;E.anchoredPosition.y!==O&&(E.anchoredPosition.y=O),m&&d&&E.sizeDelta[h]!==g&&(E.sizeDelta[h]=g),f&&u&&E.sizeDelta[r]!==_&&(E.sizeDelta[r]=_);const N=c?E.width:E.height,L=N*.5;if(A+=L,f){const D=_*M-_*.5;D>A&&(A=D-_*.5+N+this.padding.left,A-=L)}let Q=A;r==="y"&&(Q=-Q),E.anchoredPosition[r]!==Q&&(E.anchoredPosition[r]=Q),A+=L,A+=this.spacing,M+=1}}}}nr([C()],Dd.prototype,"childControlHeight",2),nr([C()],Dd.prototype,"childControlWidth",2),nr([C()],Dd.prototype,"childForceExpandHeight",2),nr([C()],Dd.prototype,"childForceExpandWidth",2),nr([C()],Dd.prototype,"childScaleHeight",2),nr([C()],Dd.prototype,"childScaleWidth",2);class LD extends Dd{get primaryAxis(){return"y"}}class UD extends Dd{get primaryAxis(){return"x"}}class FD extends la{onCalculateLayout(){}}var eye=Object.defineProperty,tye=Object.getOwnPropertyDescriptor,Tc=(n,e,i,r)=>{for(var s=r>1?void 0:r?tye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&eye(e,i,s),s},x9=(n=>(n[n.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",n[n.ScreenSpaceCamera=1]="ScreenSpaceCamera",n[n.WorldSpace=2]="WorldSpace",n[n.Undefined=-1]="Undefined",n))(x9||{});const ND=te("debuguilayout"),_9=class extends Ab{constructor(){super(...arguments),p(this,"_renderOnTop"),p(this,"_depthWrite",!1),p(this,"_doubleSided",!0),p(this,"_castShadows",!1),p(this,"_receiveShadows",!1),p(this,"_renderMode",-1),p(this,"_rootCanvas"),p(this,"_scaleFactor",1),p(this,"worldCamera"),p(this,"planeDistance",-1),p(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this)),p(this,"previousParent",null),p(this,"_lastMatrixWorld",null),p(this,"_rectTransforms",[]),p(this,"_layoutGroups",new Map),p(this,"_receivers",[]),p(this,"onBeforeRenderRoutine",()=>{var n,e,i,r;if(this.previousParent=this.gameObject.parent,((n=this.context.xr)!=null&&n.isVR||(e=this.context.xr)!=null&&e.isPassThrough)&&this.screenspace){this.gameObject.visible=!1,this.gameObject.removeFromParent();return}this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(i=this.shadowComponent)==null||i.updateMatrixWorld(!0),(r=this.shadowComponent)==null||r.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),Ha.ensureUpdateMeshUI(Aj,this.context))}),p(this,"onAfterRenderRoutine",()=>{var n,e,i,r,s;if(((n=this.context.xr)!=null&&n.isVR||(e=this.context.xr)!=null&&e.isPassThrough)&&this.screenspace){(i=this.previousParent)==null||i.add(this.gameObject);return}if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const l=this.context.mainCamera;l?.add(this.gameObject)}else this.previousParent.add(this.gameObject);const o=this.context.renderer.autoClear,a=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(r=this.shadowComponent)==null||r.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),Ha.ensureUpdateMeshUI(Aj,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=o,this.context.renderer.autoClearColor=a,this.previousParent.add(this.gameObject)}(s=this._lastMatrixWorld)==null||s.copy(this.gameObject.matrixWorld)}),p(this,"_updateRenderSettingsRoutine"),p(this,"_activeRenderMode",-1),p(this,"_lastWidth",-1),p(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==2}set renderOnTop(n){n!==this._renderOnTop&&(this._renderOnTop=n,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===0)}set depthWrite(n){this._depthWrite!==n&&(this._depthWrite=n,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(n){this._doubleSided!==n&&(this._doubleSided=n,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(n){this._castShadows!==n&&(this._castShadows=n,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(n){this._receiveShadows!==n&&(this._receiveShadows=n,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(n){this._renderMode!==n&&(this._renderMode=n,this.onRenderSettingsChanged())}set rootCanvas(n){this._rootCanvas instanceof _9||(this._rootCanvas=n)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(n){this._scaleFactor=n}awake(){var n;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,ND&&console.log("Canvas.Awake()",((n=this.previousParent)==null?void 0:n.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new he,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const n=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);n!==-1&&this.context.pre_render_callbacks.splice(n,1);const e=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);e!==-1&&this.context.post_render_callbacks.splice(e,1)}registerTransform(n){this._rectTransforms.push(n)}unregisterTransform(n){const e=this._rectTransforms.indexOf(n);e!==-1&&this._rectTransforms.splice(e,1)}registerLayoutGroup(n){const e=n.gameObject;this._layoutGroups.set(e,n)}unregisterLayoutGroup(n){const e=n.gameObject;this._layoutGroups.delete(e)}registerEventReceiver(n){this._receivers.push(n)}unregisterEventReceiver(n){const e=this._receivers.indexOf(n);e!==-1&&this._receivers.splice(e,1)}async onEnterXR(n){this.screenspace?(n.xr.isVR||n.xr.isPassThrough)&&(this.gameObject.visible=!1):(this.gameObject.visible=!1,await r1(1).then(()=>{this.gameObject.visible=!0}))}onLeaveXR(n){this.screenspace&&(n.xr.isVR||n.xr.isPassThrough)&&(this.gameObject.visible=!0)}invokeBeforeRenderEvents(){var n;for(const e of this._receivers)(n=e.onBeforeCanvasRender)==null||n.call(e,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new he);const n=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);ND&&n&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const e=!1;for(const i of this._rectTransforms){n&&i.markDirty();let r=this._layoutGroups.get(i.gameObject);i.isDirty&&!r&&(r=i.gameObject.getComponentInParent(la)),(i.isDirty||r!=null&&r.isDirty)&&(ND&&!e&&console.log("CANVAS UPDATE ### "+i.name+" ##################################### "+this.context.time.frame),r?.updateLayout(),i.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),Xi.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),eE(this.shadowComponent,this);for(const n of ie.getComponentsInChildren(this.gameObject,nl))eE(n.shadowComponent,this)}}onUpdateRenderMode(n=!1){if(!n&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let e=this.context.mainCameraComponent,i=10;switch(e&&e.nearClipPlane>0&&e.farClipPlane>0&&(i=tt.lerp(e.nearClipPlane,e.farClipPlane,.01)),this._renderMode===1&&(this.worldCamera&&(e=this.worldCamera),this.planeDistance>0&&(i=this.planeDistance)),this._renderMode){case 0:case 1:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!e)return;const r=i+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-r,this.gameObject.quaternion.identity();const s=this.gameObject.getComponent(zs);let o=!1;s.sizeDelta.x!==this.context.domWidth&&(o=!0),s.sizeDelta.y!==this.context.domHeight&&(o=!0);const a=e.fieldOfView*Math.PI/180,l=2*Math.tan(a/2)*Math.abs(r);this.gameObject.scale.x=l/this.context.domHeight,this.gameObject.scale.y=l/this.context.domHeight,this.gameObject.scale.z=.01,o&&(s.sizeDelta.x=this.context.domWidth,s.sizeDelta.y=this.context.domHeight,s?.markDirty());break;case 2:this._lastWidth=-1,this._lastHeight=-1;break}}};let ls=_9;Tc([C()],ls.prototype,"renderOnTop",1),Tc([C()],ls.prototype,"depthWrite",1),Tc([C()],ls.prototype,"doubleSided",1),Tc([C()],ls.prototype,"castShadows",1),Tc([C()],ls.prototype,"receiveShadows",1),Tc([C()],ls.prototype,"renderMode",1),Tc([C(ls)],ls.prototype,"rootCanvas",1),Tc([C()],ls.prototype,"scaleFactor",1),Tc([C(Ui)],ls.prototype,"worldCamera",2),Tc([C()],ls.prototype,"planeDistance",2);var iye=Object.defineProperty,nye=Object.getOwnPropertyDescriptor,zD=(n,e,i,r)=>{for(var s=r>1?void 0:r?nye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&iye(e,i,s),s};class Ld extends Be{constructor(){super(...arguments),p(this,"_alpha",1),p(this,"interactable",!0),p(this,"blocksRaycasts",!0),p(this,"_isDirty",!1),p(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(e){e!==this._alpha&&(this._alpha=e,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),Xi.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){this._buffer.length=0;for(const e of ie.getComponentsInChildren(this.gameObject,nl,this._buffer)){const i=e;i.setAlphaFactor&&i.setAlphaFactor(this._alpha)}}}zD([C()],Ld.prototype,"alpha",1),zD([C()],Ld.prototype,"interactable",2),zD([C()],Ld.prototype,"blocksRaycasts",2);var rye=Object.defineProperty,sye=Object.getOwnPropertyDescriptor,_n=(n,e,i,r)=>{for(var s=r>1?void 0:r?sye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&rye(e,i,s),s};const w9=te("debugusdzbehaviours");function Vb(n){n&&(n.getComponentInParent(bb)||(it()&&console.warn("Create Raycaster on "+n.name+" because no raycaster was found in the hierarchy"),n.addNewComponent(ta)))}class Qf extends Be{constructor(){super(...arguments),p(this,"object"),p(this,"target"),p(this,"duration",1),p(this,"relativeMotion",!1),p(this,"coroutine",null),p(this,"targetPos",new S),p(this,"targetRot",new Ce),p(this,"targetScale",new S)}start(){Vb(this.gameObject)}onPointerClick(e){e.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}*moveToTarget(){if(!this.target||!this.object)return;const e=kt(this.object).clone(),i=kt(this.target).clone(),r=Ri(this.object).clone(),s=Ri(this.target).clone(),o=Qi(this.object).clone(),a=Qi(this.target).clone(),l=e.distanceTo(i),c=r.angleTo(s),h=o.distanceTo(a);if(l<.01&&c<.01&&h<.01){gr(this.object,i),Ca(this.object,s),bg(this.object,a),this.coroutine=null;return}let u=0,d=0;for(;u<1;)u+=this.context.time.deltaTime/this.duration,u>1&&(u=1),d=u<.5?4*u*u*u:1-Math.pow(-2*u+2,3)/2,this.targetPos.lerpVectors(e,i,d),this.targetRot.slerpQuaternions(r,s,d),this.targetScale.lerpVectors(o,a,d),gr(this.object,this.targetPos),Ca(this.object,this.targetRot),bg(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const e=this.object.position.clone(),i=this.object.quaternion.clone(),r=this.object.scale.clone(),s=this.target.position.clone(),o=this.target.quaternion.clone(),a=this.target.scale.clone();s.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(s),this.targetRot.copy(this.object.quaternion).multiply(o),this.targetScale.copy(this.object.scale).multiply(a);let l=0,c=0;for(;l<1;)l+=this.context.time.deltaTime/this.duration,l>1&&(l=1),c=l<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,this.object.position.lerpVectors(e,this.targetPos,c),this.object.quaternion.slerpQuaternions(i,this.targetRot,c),this.object.scale.lerpVectors(r,this.targetScale,c),yield;this.coroutine=null}beforeCreateDocument(e){var i;if(this.target&&this.object&&this.gameObject){const r=new kr("Move to "+((i=this.target)==null?void 0:i.name),Or.tapTrigger(this.gameObject),Ai.transformAction(this.object,this.target,this.duration,this.relativeMotion?"relative":"absolute"));e.addBehavior(r)}}}_n([C(ve)],Qf.prototype,"object",2),_n([C(ve)],Qf.prototype,"target",2),_n([C()],Qf.prototype,"duration",2),_n([C()],Qf.prototype,"relativeMotion",2);var xE;const Ic=(xE=class extends Be{constructor(){super(...arguments),p(this,"materialToSwitch"),p(this,"variantMaterial"),p(this,"fadeDuration",0),p(this,"_objectsWithThisMaterial",null),p(this,"selfModel"),p(this,"targetModels")}start(){var n;this._objectsWithThisMaterial=this.objectsWithThisMaterial,Vb(this.gameObject),it()&&this._objectsWithThisMaterial.length<=0&&console.warn('ChangeMaterialOnClick: No objects found with material "'+((n=this.materialToSwitch)==null?void 0:n.name)+'"')}onPointerEnter(n){this.context.input.setCursorPointer()}onPointerExit(n){this.context.input.setCursorNormal()}onPointerClick(n){if(n.use(),!!this.variantMaterial)for(let e=0;e<this.objectsWithThisMaterial.length;e++){const i=this.objectsWithThisMaterial[e];i.material=this.variantMaterial}}get objectsWithThisMaterial(){return this._objectsWithThisMaterial!=null?this._objectsWithThisMaterial:(this._objectsWithThisMaterial=[],this.variantMaterial&&this.materialToSwitch&&this.context.scene.traverse(n=>{if(n instanceof pe)if(Array.isArray(n.material)){for(const e of n.material)if(e===this.materialToSwitch){this.objectsWithThisMaterial.push(n);break}}else n.material===this.materialToSwitch?this.objectsWithThisMaterial.push(n):A8(n.material,this.materialToSwitch)&&this.objectsWithThisMaterial.push(n)}),this._objectsWithThisMaterial)}async beforeCreateDocument(n,e){this.targetModels=[],Ic._materialTriggersPerId={},Ic.variantSwitchIndex=0,this.materialToSwitch&&await mi.assignTextureLOD(this.materialToSwitch,0),this.variantMaterial&&await mi.assignTextureLOD(this.variantMaterial,0)}createBehaviours(n,e,i){this.objectsWithThisMaterial.find(r=>r.uuid===e.uuid)&&this.targetModels.push(e),this.gameObject.uuid===e.uuid&&(this.selfModel=e,this.materialToSwitch&&(Ic._materialTriggersPerId[this.materialToSwitch.uuid]||(Ic._materialTriggersPerId[this.materialToSwitch.uuid]=[]),Ic._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(n,e){if(!this.materialToSwitch)return;const i=Ic._materialTriggersPerId[this.materialToSwitch.uuid];if(i){const r={};for(const s of i){const o=s.createVariants();o&&o.length>0&&(r[s.selfModel.uuid]=o)}for(const s of i){const o=[];for(const a in r)a!==s.selfModel.uuid&&o.push(...r[a]);s.createAndAttachBehaviors(n,r[s.selfModel.uuid],o)}}delete Ic._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(n,e,i){const r=[],s=[],o=Math.max(0,this.fadeDuration);s.push(Ai.fadeAction([...this.targetModels,...i],o,!1)),r.push(Ai.fadeAction(e,o,!1)),s.push(Ai.fadeAction(e,o,!0)),n.addBehavior(new kr("Select_"+this.selfModel.name,Or.tapTrigger(this.selfModel),Ai.parallel(...s))),n.addBehavior(new kr("StartHidden_"+this.selfModel.name,Or.sceneStartTrigger(),Ai.parallel(...r)))}static getMaterialName(n){return Pl(n.name||"Material")+"_"+n.id}createVariants(){if(!this.variantMaterial)return null;const n=[];for(const e of this.targetModels){const i=e.clone();i.name+="_Variant_"+Ic.variantSwitchIndex+++"_"+Ic.getMaterialName(this.variantMaterial),i.displayName=i.displayName+": Variant with material "+this.variantMaterial.name,i.material=this.variantMaterial,i.geometry=e.geometry,i.matrix=e.matrix,(!e.parent||!e.parent.isEmpty())&&co.createEmptyParent(e),e.parent&&e.parent.add(i),n.push(i)}return n}},p(xE,"_materialTriggersPerId",{}),p(xE,"variantSwitchIndex",0),xE);let z0=Ic;_n([C(Ut)],z0.prototype,"materialToSwitch",2),_n([C(Ut)],z0.prototype,"variantMaterial",2),_n([C()],z0.prototype,"fadeDuration",2);var j0;const wn=(j0=class extends Be{constructor(){super(...arguments),p(this,"target"),p(this,"toggleOnClick",!1),p(this,"targetState",!0),p(this,"hideSelf",!0),p(this,"selfModel"),p(this,"selfModelClone"),p(this,"targetModel"),p(this,"toggleModel"),p(this,"stateBeforeCreatingDocument",!1),p(this,"targetStateBeforeCreatingDocument",!1)}start(){Vb(this.gameObject)}onPointerClick(n){n.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(n,e,i){e.uuid===this.gameObject.uuid&&(this.selfModel=e,this.selfModelClone=e.clone())}beforeCreateDocument(){this.target&&(this.gameObject[wn.wasVisible]===void 0&&(this.gameObject[wn.wasVisible]=this.gameObject.activeSelf),this.target[wn.wasVisible]===void 0&&(this.target[wn.wasVisible]=this.target.activeSelf),this.stateBeforeCreatingDocument=this.gameObject[wn.wasVisible],this.targetStateBeforeCreatingDocument=this.target[wn.wasVisible],this.gameObject.visible=!0,this.target.visible=!0)}afterCreateDocument(n,e){if(!this.target)return;this.targetModel=e.document.findById(this.target.uuid);const i=this.selfModel;if(this.selfModel&&this.targetModel){let r=this.selfModel,s=this.targetState;if(this.toggleOnClick)if(s=!this.targetStateBeforeCreatingDocument,!this.selfModelClone.geometry)(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&vQ.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.deepClone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel);else{if(!this.gameObject[wn.toggleClone]){const l=this.selfModelClone.clone();l.matrix.identity(),l.name+="_toggle"+wn.clonedToggleIndex++,i.add(l),this.gameObject[wn.toggleClone]=l,console.warn("USDZExport: Toggle "+this.gameObject.name+" doesn't have geometry. It will be deep cloned and nested behaviours will likely not work.")}const a=this.gameObject[wn.toggleClone];if(!this.gameObject[wn.reverseToggleClone]){const l=this.selfModelClone.clone();l.matrix.identity(),l.name+="_toggleReverse"+wn.clonedToggleIndex++,i.add(l),this.gameObject[wn.reverseToggleClone]=l}this.toggleModel=this.gameObject[wn.reverseToggleClone],(!this.toggleModel.geometry||!a.geometry)&&console.error("triggers without childs and without geometry won't work!",this,i.geometry),r=a,i.geometry=null,i.material=null}if(this.toggleModel){if(this.toggleOnClick){const a=[];a.push(Ai.fadeAction(r,0,!1)),a.push(Ai.fadeAction(this.toggleModel,0,!0)),a.push(Ai.fadeAction(this.targetModel,0,s)),n.addBehavior(new kr("Toggle_"+r.name+"_toggleTo"+(s?"On":"Off"),Or.tapTrigger(r),Ai.parallel(...a)));const l=[];l.push(Ai.fadeAction(this.toggleModel,0,!1)),l.push(Ai.fadeAction(r,0,!0)),l.push(Ai.fadeAction(this.targetModel,0,!s)),n.addBehavior(new kr("Toggle_"+r.name+"_toggleTo"+(s?"Off":"On"),Or.tapTrigger(this.toggleModel),Ai.parallel(...l)))}}else{const a=[];this.hideSelf&&a.push(Ai.fadeAction(r,0,!1)),a.push(Ai.fadeAction(this.targetModel,0,s)),n.addBehavior(new kr("Toggle_"+r.name+"_toggleTo"+(s?"On":"Off"),Or.tapTrigger(r),Ai.parallel(...a)))}const o=new Array;this.targetStateBeforeCreatingDocument||o.push(this.targetModel),this.stateBeforeCreatingDocument||o.push(i),this.toggleModel&&o.push(this.toggleModel),n.addBehavior(new kr("HideOnStart_"+this.gameObject.name,Or.sceneStartTrigger(),Ai.fadeAction(o,0,!1)))}}afterSerialize(n,e){this.gameObject[wn.wasVisible]!==void 0&&(this.gameObject.visible=this.gameObject[wn.wasVisible],delete this.gameObject[wn.wasVisible]),this.target&&this.target[wn.wasVisible]!==void 0&&(this.target.visible=this.target[wn.wasVisible],delete this.target[wn.wasVisible]),delete this.gameObject[wn.toggleClone],delete this.gameObject[wn.reverseToggleClone]}},p(j0,"clonedToggleIndex",0),p(j0,"wasVisible",Symbol("usdz_SetActiveOnClick_wasVisible")),p(j0,"toggleClone",Symbol("clone for toggling")),p(j0,"reverseToggleClone",Symbol("clone for reverse toggling")),j0);let Wf=wn;_n([C(ve)],Wf.prototype,"target",2),_n([C()],Wf.prototype,"toggleOnClick",2),_n([C()],Wf.prototype,"targetState",2),_n([C()],Wf.prototype,"hideSelf",2);class jD extends Be{constructor(){super(...arguments),p(this,"wasVisible",!1)}start(){ie.setActive(this.gameObject,!1)}createBehaviours(e,i,r){i.uuid===this.gameObject.uuid&&(this.wasVisible||e.addBehavior(new kr("HideOnStart_"+this.gameObject.name,Or.sceneStartTrigger(),Ai.fadeAction(i,0,!1))))}beforeCreateDocument(){this.wasVisible=ie.isActiveSelf(this.gameObject)}}class G0 extends Be{constructor(){super(...arguments),p(this,"target"),p(this,"duration",.5),p(this,"motionType","bounce")}beforeCreateDocument(){}createBehaviours(e,i,r){if(this.target&&i.uuid===this.gameObject.uuid){const s=new kr("emphasize "+this.name,Or.tapTrigger(this.gameObject),Ai.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));e.addBehavior(s)}}afterCreateDocument(e,i){}}_n([C()],G0.prototype,"target",2),_n([C()],G0.prototype,"duration",2),_n([C()],G0.prototype,"motionType",2);class Ud extends Be{constructor(){super(...arguments),p(this,"target"),p(this,"clip",""),p(this,"toggleOnClick",!1),p(this,"trigger","tap")}start(){Vb(this.gameObject)}ensureAudioSource(){if(!this.target){const e=this.gameObject.addNewComponent(Pn);e&&(this.target=e,e.spatialBlend=1,e.volume=1,e.loop=!1,e.preload=!0)}}onPointerClick(e){var i;e.use(),!(!((i=this.target)!=null&&i.clip)&&!this.clip)&&(this.ensureAudioSource(),this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play())))}createBehaviours(e,i,r){if(!(!this.target&&!this.clip)&&i.uuid===this.gameObject.uuid){const s=this.clip?this.clip:this.target?this.target.clip:void 0;if(!s||typeof s!="string")return;const o=this.target?this.target.gameObject:this.gameObject;hp.getName(s);const a=this.target?this.target.volume:1,l=this.target&&this.target.spatialBlend==0?"nonSpatial":"spatial";let c=!1;this.gameObject.traverse(f=>{f instanceof pe&&f.visible&&(c=!0)}),c=!0;const h=e.addAudioClip(s);let u=Ai.playAudioAction(o,h,"play",a,l);this.target&&this.target.loop&&(u=Ai.sequence(u).makeLooping());const d=this.name?"_"+this.name:"";if(c&&this.trigger==="tap"){this.toggleOnClick&&(u.multiplePerformOperation="stop");const f=new kr("playAudio"+d,Or.tapTrigger(i),u);e.addBehavior(f)}if(this.target&&this.target.playOnAwake&&this.target.enabled)if(c&&this.trigger==="tap")console.warn("USDZExport: Audio sources that are played on tap can't also auto-play at scene start due to a QuickLook bug.");else{const f=new kr("playAudioOnStart"+d,Or.sceneStartTrigger(),u);e.addBehavior(f)}}}}_n([C(Pn)],Ud.prototype,"target",2),_n([C(URL)],Ud.prototype,"clip",2),_n([C()],Ud.prototype,"toggleOnClick",2);var _E;const Rc=(_E=class extends Be{constructor(){super(...arguments),p(this,"animator"),p(this,"stateName"),p(this,"trigger","tap"),p(this,"animation"),p(this,"selfModel"),p(this,"stateAnimationModel"),p(this,"animationSequence",new Array),p(this,"animationLoopAfterSequence",new Array)}get target(){var n,e;return((n=this.animator)==null?void 0:n.gameObject)||((e=this.animation)==null?void 0:e.gameObject)}start(){Vb(this.gameObject)}onPointerClick(n){var e;n.use(),this.target&&this.stateName&&((e=this.animator)==null||e.play(this.stateName,0,0,.1))}createBehaviours(n,e,i){e.uuid===this.gameObject.uuid&&(this.selfModel=e)}afterSerialize(){if(Rc.rootsWithExclusivePlayback.size>1){const n='Multiple root objects targeted by more than one animation. To work around QuickLook bug FB13410767, animations will be set as "exclusive" and activating them will stop other animations being marked as exclusive.';it()&&Pi(n),console.warn(n,...Rc.rootsWithExclusivePlayback)}Rc.animationActions=[],Rc.rootsWithExclusivePlayback=new Set}afterCreateDocument(n,e){if(this.animationSequence===void 0&&this.animationLoopAfterSequence===void 0||!this.stateAnimationModel||!this.target)return;const i=e.document,r=e.extensions.find(a=>a instanceof Ib);if(!r)return;const s=r.getClipCount(this.target)>1;s&&(it()&&console.warn("Setting exclusive playback for "+this.target.name+"@"+this.stateName+" because it has "+r.getClipCount(this.target)+" animations. This works around QuickLook bug FB13410767."),Rc.rootsWithExclusivePlayback.add(this.target));const o=this.name?this.name:"";i.traverse(a=>{var l,c;if(a.uuid===((l=this.target)==null?void 0:l.uuid)){const h=Rc.getActionForSequences(a,this.animationSequence,this.animationLoopAfterSequence),u=new kr(this.trigger+"_"+o+"_toPlayAnimation_"+this.stateName+"_on_"+((c=this.target)==null?void 0:c.name),this.trigger=="tap"?Or.tapTrigger(this.selfModel):Or.sceneStartTrigger(),h);s&&u.makeExclusive(!0),n.addBehavior(u)}})}static getActionForSequences(n,e,i){const r=(o,a)=>{let l=Rc.animationActions.find(c=>c.affectedObjects==o&&c.start==a.start&&c.duration==a.duration&&c.animationSpeed==a.speed);return l||(l=Ai.startAnimationAction(o,a.start,a.duration,a.speed),Rc.animationActions.push(l)),l},s=Ai.sequence();if(e&&e.length>0)for(const o of e)s.addAction(r(n,o));if(i&&i.length>0){const o=s.actions.length==0?s:Ai.sequence();for(const a of i)o.addAction(r(n,a));o.makeLooping(),s!==o&&s.addAction(o)}return s}static getAndRegisterAnimationSequences(n,e,i){var r,s,o,a,l;if(!e)return;const c=e.getComponent(rs),h=e.getComponent(Fs);if(!c&&!h)return;if(c&&!i)throw new Error("PlayAnimationOnClick: No stateName specified for animator "+c.name+" on "+e.name);let u=[],d=[];if(h){const A=n.registerAnimation(e,h.clip);return A&&(h.loop?d.push(A):u.push(A)),{animationSequence:u,animationLoopAfterSequence:d}}const f=c?.runtimeAnimatorController;let m=f?.findState(i),g=[],v=[];if(f&&m){const A=new Array;A.push(m);let b=!1;for(;A.length<100;){if(!m||m===null||!m.transitions||m.transitions.length===0){(r=m.motion)!=null&&r.isLooping&&(b=!0);break}const x=m.transitions.find(w=>w.conditions.length===0),_=x?f.getState(x.destinationState,0):null;if(_&&A.includes(_)){m=_,b=!0;break}else if(x){if(m=_,!m)break;A.push(m)}else{b=((s=m.motion)==null?void 0:s.isLooping)??!1;break}}if(b&&m){const x=A.indexOf(m);g=A.slice(0,x),v=A.slice(x),w9&&console.log("found loop from "+i,"states until loop",g,"states looping",v)}else g=A,v=[],w9&&console.log("found no loop from "+i,"states",g)}if(g.length===1&&(!((o=g[0].motion)!=null&&o.clip)||((l=(a=g[0].motion)==null?void 0:a.clip.tracks)==null?void 0:l.length)===0)){u=new Array;const A=n.registerAnimation(e,null);A&&u.push(A);return}if(g=g.filter(A=>{var b,x,_;return((b=A.motion)==null?void 0:b.clip)&&((_=(x=A.motion)==null?void 0:x.clip.tracks)==null?void 0:_.length)>0}),v=v.filter(A=>{var b,x,_;return((b=A.motion)==null?void 0:b.clip)&&((_=(x=A.motion)==null?void 0:x.clip.tracks)==null?void 0:_.length)>0}),g.length===0&&v.length===0){console.warn("No clips found for state "+i+" on "+c?.name+", can't export animation data");return}const y=(A,b)=>{if(!e)return;const x=n.registerAnimation(e,A.motion.clip??null);x?(x.speed=A.speed,b.push(x)):console.warn("Couldn't register animation for state "+A.name+" on "+c?.name)};if(g.length>0){u=new Array;for(const A of g)y(A,u)}if(v.length>0){d=new Array;for(const A of v)y(A,d)}return{animationSequence:u,animationLoopAfterSequence:d}}createAnimation(n,e,i){if(!this.target||!this.animator&&!this.animation)return;const r=Rc.getAndRegisterAnimationSequences(n,this.target,this.stateName);r&&(this.animationSequence=r.animationSequence,this.animationLoopAfterSequence=r.animationLoopAfterSequence,this.stateAnimationModel=e)}},p(_E,"animationActions",[]),p(_E,"rootsWithExclusivePlayback",new Set),_E);let Xf=Rc;_n([C(rs)],Xf.prototype,"animator",2),_n([C()],Xf.prototype,"stateName",2);class H0 extends Be{constructor(){super(...arguments),p(this,"target")}getType(){}getDuration(){}}_n([C(ve)],H0.prototype,"target",2);class Qb extends Be{constructor(){super(...arguments),p(this,"target")}}_n([C(H0)],Qb.prototype,"target",2);class Wb extends H0{constructor(){super(...arguments),p(this,"type",1),p(this,"duration",1)}getType(){switch(this.type){case 1:return"hide";case 0:return"show"}}getDuration(){return this.duration}}_n([C()],Wb.prototype,"type",2),_n([C()],Wb.prototype,"duration",2);class GD extends Qb{}var oye=Object.defineProperty,aye=Object.getOwnPropertyDescriptor,Wh=(n,e,i,r)=>{for(var s=r>1?void 0:r?aye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&oye(e,i,s),s};const S9=te("debugcharactercontroller");class qf extends Be{constructor(){super(...arguments),p(this,"center",new S(0,0,0)),p(this,"radius",.5),p(this,"height",2),p(this,"_rigidbody",null),p(this,"_activeGroundCollisions"),p(this,"_contactVelocity",new S)}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(Oi),this._rigidbody||(this._rigidbody=this.gameObject.addNewComponent(Oi)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const e=this.rigidbody;let i=this.gameObject.getComponent(Vh);i||(i=this.gameObject.addNewComponent(Vh)),i.center.copy(this.center),i.radius=this.radius,i.height=this.height;const r=new S(0,0,1),s=new S(1,0,0),o=new S(0,1,0),a=this.gameObject.getWorldDirection(new S);a.y=0;const l=s.dot(a)<0?-1:1,c=r.angleTo(a)*l;this.gameObject.setRotationFromAxisAngle(o,c),e.lockRotationX=!0,e.lockRotationY=!0,e.lockRotationZ=!0}move(e){this.gameObject.position.add(e)}onCollisionEnter(e){(e.contacts.length==0||e.contacts.some(i=>i.normal.y>.2))&&(this._activeGroundCollisions.add(e),S9&&console.log(`Collision(${this._activeGroundCollisions.size}): ${e.contacts.map(i=>i.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(e){this._activeGroundCollisions.delete(e),S9&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}get contactVelocity(){var e;this._contactVelocity.set(0,0,0);for(const i of this._activeGroundCollisions){const r=(e=this.context.physics.engine)==null?void 0:e.getLinearVelocity(i.collider);r&&(this._contactVelocity.x+=r.x,this._contactVelocity.y+=r.y,this._contactVelocity.z+=r.z)}return this._contactVelocity}}Wh([C(S)],qf.prototype,"center",2),Wh([C()],qf.prototype,"radius",2),Wh([C()],qf.prototype,"height",2);class Xh extends Be{constructor(){super(...arguments),p(this,"controller"),p(this,"movementSpeed",2),p(this,"rotationSpeed",2),p(this,"jumpForce",1),p(this,"doubleJumpForce",2),p(this,"animator"),p(this,"lookForward",!0),p(this,"lookInput",new J(0,0)),p(this,"moveInput",new J(0,0)),p(this,"jumpInput",!1),p(this,"_currentSpeed",new S(0,0,0)),p(this,"_currentAngularSpeed",new S(0,0,0)),p(this,"_temp",new S(0,0,0)),p(this,"_jumpCount",0),p(this,"_currentRotation"),p(this,"_raycastOptions",new dc)}awake(){this._currentRotation=new Ce}update(){const e=this.context.input;e.isKeyPressed("KeyW")?this.moveInput.y+=1:e.isKeyPressed("KeyS")&&(this.moveInput.y-=1),e.isKeyPressed("KeyD")?this.lookInput.x+=1:e.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=e.isKeyDown("Space"))}move(e){this.moveInput.add(e)}look(e){this.lookInput.add(e)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(e,i,r){var s,o,a,l,c,h,u,d,f,m,g;if((s=this.controller)!=null&&s.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((o=this.animator)==null||o.setBool("doubleJump",!1))),this._currentSpeed.z+=e.y*this.movementSpeed*this.context.time.deltaTime,(a=this.animator)==null||a.setBool("running",e.length()>.01),(c=this.animator)==null||c.setBool("jumping",((l=this.controller)==null?void 0:l.isGrounded)===!0&&r),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=tt.toRadians(-i.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const v=this.context.mainCameraComponent.forward;v.y=0,v.normalize(),this._currentRotation.setFromUnitVectors(new S(0,0,1),v),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&r&&this.jumpForce>0){let v=(h=this.controller)==null?void 0:h.isGrounded;if(this.doubleJumpForce>0&&!((u=this.controller)!=null&&u.isGrounded)&&this._jumpCount===1&&(v=!0,(d=this.animator)==null||d.setBool("doubleJump",!0)),v){this._jumpCount+=1;const y=this.controller.rigidbody,A=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;y.applyImpulse(new S(0,1,0).multiplyScalar(A))}}if(this.controller){const v=(f=this.controller)==null?void 0:f.rigidbody.getVelocity().y;if(v<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new Js),this._raycastOptions.ray.origin.copy(kt(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const y=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const A=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(y),(A.length&&A[0].distance>2||v<-10)&&((m=this.animator)==null||m.setBool("falling",!0))}else(g=this.animator)==null||g.setBool("falling",!1)}}}Wh([C(qf)],Xh.prototype,"controller",2),Wh([C()],Xh.prototype,"movementSpeed",2),Wh([C()],Xh.prototype,"rotationSpeed",2),Wh([C()],Xh.prototype,"jumpForce",2),Wh([C()],Xh.prototype,"doubleJumpForce",2),Wh([C(rs)],Xh.prototype,"animator",2);var lye=Object.defineProperty,cye=Object.getOwnPropertyDescriptor,hye=(n,e,i,r)=>{for(var s=r>1?void 0:r?cye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&lye(e,i,s),s};class Xb extends ss{constructor(){super(...arguments),p(this,"intensity",new Ke(0))}get typeName(){return"ChromaticAberration"}onCreateEffect(){const e=new Yj;return e.offset=new J(0,0),e.radialModulation=!0,e.modulationOffset=.15,this.intensity.valueProcessor=i=>i*.02,this.intensity.onValueChanged=i=>{e.offset.x=-i,e.offset.y=i},e}}hye([C(Ke)],Xb.prototype,"intensity",2),Qa("ChromaticAberration",Xb);var uye=Object.defineProperty,dye=Object.getOwnPropertyDescriptor,C9=(n,e,i,r)=>{for(var s=r>1?void 0:r?dye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&uye(e,i,s),s};const E9=te("debugpost");var wE=(n=>(n[n.None=0]="None",n[n.Neutral=1]="Neutral",n[n.ACES=2]="ACES",n[n.AgX=3]="AgX",n[n.KhronosNeutral=4]="KhronosNeutral",n))(wE||{});function HD(n){switch(n){case 0:return Tm;case 1:return Jv;case 2:return Kv;case 3:return Im;case 4:return vp;default:return vp}}function pye(n){switch(n){case Tm:return 0;case Kv:return 2;case Im:return 3;case vp:return 1;case Jv:return 1;default:return 0}}function M9(n){switch(n){case Tm:return Mr.LINEAR;case Kv:return Mr.ACES_FILMIC;case Im:return Mr.AGX;case vp:return Mr.NEUTRAL;case Jv:return Mr.REINHARD;default:return Mr.LINEAR}}const T9=class extends ss{constructor(){super(...arguments),p(this,"mode",new Ke(void 0)),p(this,"exposure",new Ke(1))}get typeName(){return"ToneMapping"}setMode(n){const e=wE[n];return e===void 0?(console.error("Invalid ToneMapping mode",n),this):(this.mode.value=e,this)}get isToneMapping(){return!0}onEffectEnabled(){const n=n9(this);n&&super.onEffectEnabled(n)}onCreateEffect(){if(this.postprocessingContext)for(const i of this.postprocessingContext.components){if(i===this)break;if(i!=this&&i instanceof T9){console.warn("Multiple tonemapping effects found in the same postprocessing stack: Please check your scene setup.",{activeEffect:i,ignoredEffect:this});return}}if(this.mode.isInitialized==!1){const i=pye(this.context.renderer.toneMapping);this.mode.initialize(i)}const n=HD(this.mode.value),e=new O1({mode:M9(n)});return this.mode.onValueChanged=i=>{const r=HD(i);e.mode=M9(r),E9&&console.log("ToneMapping mode changed to",wE[i],r,e.mode)},E9&&console.log("Use ToneMapping",wE[this.mode.value],n,e.mode,"renderer.tonemapping: "+this.context.renderer.toneMapping),this.exposure.onValueChanged=i=>{this.context.renderer.toneMappingExposure=i},e}onBeforeRender(){this.mode.overrideState&&(this.context.renderer.toneMapping=HD(this.mode.value)),this.exposure.overrideState&&(this.context.renderer.toneMappingExposure=this.exposure.value)}};let Fd=T9;C9([C(Ke)],Fd.prototype,"mode",2),C9([C(Ke)],Fd.prototype,"exposure",2),Qa("Tonemapping",Fd);var fye=Object.defineProperty,mye=Object.getOwnPropertyDescriptor,SE=(n,e,i,r)=>{for(var s=r>1?void 0:r?mye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&fye(e,i,s),s};class Nd extends ss{constructor(){super(...arguments),p(this,"postExposure",new Ke(0)),p(this,"contrast",new Ke(0)),p(this,"hueShift",new Ke(0)),p(this,"saturation",new Ke(0))}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=e=>(e=Math.pow(2,e),e),this.contrast.valueProcessor=e=>{let i=1;return e>0?i=200:e<0&&(i=100),e/i},this.contrast.defaultValue=0,this.hueShift.valueProcessor=e=>Math.PI*e/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=e=>e<0?e/100:e/(100*Math.PI),this.saturation.defaultValue=0}onCreateEffect(){var e,i;const r=[];this.context.renderer.toneMapping!==Xs&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=Xs);let s=(e=this.postprocessingContext)==null?void 0:e.components.find(l=>l instanceof Fd);s||(s=new Fd,(i=this.postprocessingContext)==null||i.components.push(s)),this.postExposure.onValueChanged=l=>{this.postExposure.overrideState&&(s.exposure.value=l)};const o=new qj;this.contrast.onValueChanged=l=>o.contrast=l;const a=new $j;return r.push(o),r.push(a),this.hueShift.onValueChanged=l=>a.hue=l,this.saturation.onValueChanged=l=>a.saturation=l,r}}SE([C(Ke)],Nd.prototype,"postExposure",2),SE([C(Ke)],Nd.prototype,"contrast",2),SE([C(Ke)],Nd.prototype,"hueShift",2),SE([C(Ke)],Nd.prototype,"saturation",2),Qa("ColorAdjustments",Nd);const gye=(Math.sqrt(5)-1)/4,cs=(5-Math.sqrt(5))/20,CE=n=>Math.floor(n)|0,EE=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function vye(n=Math.random){const e=yye(n),i=new Float64Array(e).map(a=>EE[a%32*4]),r=new Float64Array(e).map(a=>EE[a%32*4+1]),s=new Float64Array(e).map(a=>EE[a%32*4+2]),o=new Float64Array(e).map(a=>EE[a%32*4+3]);return function(a,l,c,h){let u,d,f,m,g;const v=(a+l+c+h)*gye,y=CE(a+v),A=CE(l+v),b=CE(c+v),x=CE(h+v),_=(y+A+b+x)*cs,w=y-_,T=A-_,M=b-_,R=x-_,B=a-w,E=l-T,P=c-M,O=h-R;let N=0,L=0,Q=0,D=0;B>E?N++:L++,B>P?N++:Q++,B>O?N++:D++,E>P?L++:Q++,E>O?L++:D++,P>O?Q++:D++;const F=N>=3?1:0,H=L>=3?1:0,K=Q>=3?1:0,Z=D>=3?1:0,oe=N>=2?1:0,we=L>=2?1:0,Oe=Q>=2?1:0,se=D>=2?1:0,_e=N>=1?1:0,Ee=L>=1?1:0,et=Q>=1?1:0,We=D>=1?1:0,Ue=B-F+cs,st=E-H+cs,ge=P-K+cs,X=O-Z+cs,ze=B-oe+2*cs,Ie=E-we+2*cs,Te=P-Oe+2*cs,Ve=O-se+2*cs,Ae=B-_e+3*cs,nt=E-Ee+3*cs,ct=P-et+3*cs,It=O-We+3*cs,V=B-1+4*cs,U=E-1+4*cs,ue=P-1+4*cs,Me=O-1+4*cs,De=y&255,Pe=A&255,At=b&255,ht=x&255;let je=.6-B*B-E*E-P*P-O*O;if(je<0)u=0;else{const Le=De+e[Pe+e[At+e[ht]]];je*=je,u=je*je*(i[Le]*B+r[Le]*E+s[Le]*P+o[Le]*O)}let He=.6-Ue*Ue-st*st-ge*ge-X*X;if(He<0)d=0;else{const Le=De+F+e[Pe+H+e[At+K+e[ht+Z]]];He*=He,d=He*He*(i[Le]*Ue+r[Le]*st+s[Le]*ge+o[Le]*X)}let St=.6-ze*ze-Ie*Ie-Te*Te-Ve*Ve;if(St<0)f=0;else{const Le=De+oe+e[Pe+we+e[At+Oe+e[ht+se]]];St*=St,f=St*St*(i[Le]*ze+r[Le]*Ie+s[Le]*Te+o[Le]*Ve)}let Fe=.6-Ae*Ae-nt*nt-ct*ct-It*It;if(Fe<0)m=0;else{const Le=De+_e+e[Pe+Ee+e[At+et+e[ht+We]]];Fe*=Fe,m=Fe*Fe*(i[Le]*Ae+r[Le]*nt+s[Le]*ct+o[Le]*It)}let Kt=.6-V*V-U*U-ue*ue-Me*Me;if(Kt<0)g=0;else{const Le=De+1+e[Pe+1+e[At+1+e[ht+1]]];Kt*=Kt,g=Kt*Kt*(i[Le]*V+r[Le]*U+s[Le]*ue+o[Le]*Me)}return 27*(u+d+f+m+g)}}function yye(n){const e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){const r=i+~~(n()*(256-i)),s=e[i];e[i]=e[r],e[r]=s}for(let i=256;i<512;i++)e[i]=e[i-256];return e}const VD=te("debugstencil");function Aye(n,e){return(n&1<<e.layer)!=0}const bye=Symbol("stencils"),V0=class{constructor(n,e){p(this,"parser"),p(this,"source"),this.parser=n,this.source=e}get name(){return"NEEDLE_render_objects"}static applyStencil(n){if(!n)return;const e=n.sourceId;if(VD&&console.log(e,V0.stencils),!e)return;const i=V0.stencils[e];if(i)for(let r=i.length-1;r>=0;r--){const s=i[r];if(Aye(s.layer,n)){VD&&console.log(s),setTimeout(()=>{eo()&&uC(n.gameObject)&&(Pi("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",n))},500);for(let o=0;o<n.sharedMaterials.length;o++){let a=n.sharedMaterials[o];a&&(a=a.clone(),a[bye]=!0,a.stencilWrite=!0,a.stencilWriteMask=255,a.stencilFuncMask=255,a.stencilRef=s.value,a.stencilFunc=s.compareFunc,a.stencilZPass=s.passOp,a.stencilFail=s.failOp,a.stencilZFail=s.zFailOp,n.sharedMaterials[o]=a)}n.gameObject.renderOrder=s.event*1e3+s.index*50;break}}}afterRoot(n){const e=this.parser.json.extensions;if(e){const i=e[_ye];if(i){VD&&console.log(i);const r=i.stencil;if(r&&Array.isArray(r))for(const s of r){const o={...s};o.compareFunc=xye(o.compareFunc),o.passOp=WD(o.passOp),o.failOp=WD(o.failOp),o.zFailOp=WD(o.zFailOp),V0.stencils[this.source]||(V0.stencils[this.source]=[]),V0.stencils[this.source].push(o)}}}return null}};let QD=V0;p(QD,"stencils",{});function WD(n){switch(n){case 0:return xu;case 1:return lF;case 2:return cF;case 3:return hF;case 4:return uF;case 6:return dF;case 7:return pF;case 5:return fF}return 0}function xye(n){switch(n){case 1:return RI;case 2:return mF;case 3:return gF;case 4:return vF;case 5:return yF;case 6:return AF;case 7:return bF;case 8:return z_}return RI}const _ye="NEEDLE_render_objects";var wye=Object.defineProperty,Sye=Object.getOwnPropertyDescriptor,I9=(n,e,i,r)=>{for(var s=r>1?void 0:r?Sye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&wye(e,i,s),s};const qb=te("debugreflectionprobe"),R9=te("noreflectionprobe"),Cye=Symbol("reflectionProbeKey"),Eye=Symbol("original material");var ME;const qh=(ME=class extends Be{constructor(){var n;super(),p(this,"_texture"),p(this,"center"),p(this,"size"),p(this,"_boxHelper"),qh._probes.has(this.context)||qh._probes.set(this.context,[]),(n=qh._probes.get(this.context))==null||n.push(this)}static get(n,e,i,r){if(!n||n.isObject3D!==!0||R9)return null;const s=qh._probes.get(e);if(s){for(const o of s)if(o.__didAwake||o.__internalAwake(),o.enabled){if(r){if(o.gameObject===r)return o}else if(o.isInBox(n,void 0))return qb&&console.log("Found reflection probe",n.name,o.name),o}}return qb&&console.debug("Did not find reflection probe",n.name,i,n),null}set texture(n){if(n&&!(n instanceof Gt)){console.error("ReflectionProbe.texture must be a Texture",n);return}this._texture=n,n&&(n.mapping=qs,n.colorSpace=gt,n.needsUpdate=!0)}get texture(){return this._texture}isInBox(n,e){var i;return(i=this._boxHelper)==null?void 0:i.isInBox(n,e)}awake(){this._boxHelper=this.gameObject.addNewComponent(Mc),this._boxHelper.updateBox(!0),qb&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=qs,this.texture.colorSpace=gt,this.texture.needsUpdate=!0)}onDestroy(){const n=qh._probes.get(this.context);if(n){const e=n.indexOf(this);e>=0&&n.splice(e,1)}}onSet(n){var e;if(R9||!this.enabled||((e=n.sharedMaterials)==null?void 0:e.length)<=0||!this.texture)return;let i=qh._rendererMaterialsCache.get(n);i||(i=[],qh._rendererMaterialsCache.set(n,i));for(let r=0;r<n.sharedMaterials.length;r++){const s=n.sharedMaterials[r];if(!s||s.envMap===void 0||s instanceof Jt)continue;let o=i[r];const a=s===o?.copy,l=!o||o.material.uuid!==s.uuid||o.copy.version!==s.version;if(!a&&l){if(qb){let u="";o?o.material!==s?u="reference changed; cached instance?: "+a:o.copy.version!==s.version&&(u="version changed"):u="not cached",console.warn("Cloning material",s.name,s.version,"Reason:",u,`
`,s.uuid,`
`,o?.copy.uuid,`
`,n.name)}const h=s.clone();h.version=s.version,o?(o.copy=h,o.material=s):(o={material:s,copy:h},i.push(o)),h[Cye]=this,h[Eye]=s,qb&&console.log("Set reflection",n.name,n.guid)}o&&o.copy&&(o.copy.onBeforeCompile=s.onBeforeCompile);const c=o?.copy;c.envMap=this.texture,n.sharedMaterials[r]=c}}onUnset(n){const e=qh._rendererMaterialsCache.get(n);if(e)for(let i=0;i<e.length;i++){const r=e[i];n.sharedMaterials[i]=r.material}}},p(ME,"_probes",new Map),p(ME,"_rendererMaterialsCache",new Map),ME);let Q0=qh;I9([C(S)],Q0.prototype,"center",2),I9([C(S)],Q0.prototype,"size",2);const XD=te("debugexr");class Mye{constructor(e){p(this,"parser"),this.parser=e,XD&&console.log(e)}get name(){return"EXT_texture_exr"}loadTexture(e){const i=this.name,r=this.parser,s=r.json.textures[e];if(XD&&console.log("EXT_texture_exr.loadTexture",e,s),!s.extensions||!s.extensions[i])return null;const o=s.extensions[i],a=new sb(r.options.manager);return XD&&console.log("EXT_texture_exr.loadTexture",o),r.loadTextureImage(e,o.source,a)}}typeof window<"u"&&window.addEventListener("unhandledrejection",n=>{});const Yh=Pr,TE="$___Export_Components",Tye="NEEDLE_components";var P9;class Iye{constructor(){p(this,P9)}}P9=ef;class Rye{constructor(e,i,r){p(this,"node"),p(this,"nodeIndex"),p(this,"nodeDef"),this.node=e,this.nodeIndex=i,this.nodeDef=r}}class Pye{constructor(){p(this,"parser"),p(this,"nodeToObjectMap",{}),p(this,"exportContext"),p(this,"objectToNodeMap",{}),p(this,"context"),p(this,"writer")}get name(){return Tye}registerExport(e){e.register(i=>{if("serializeUserData"in i){const r=i.serializeUserData.bind(i);this.writer=i,i.serializeUserData=(s,o)=>{try{this.serializeUserData(s,o),r(s,o)}finally{this.afterSerializeUserData(s,o)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(e,i){var r;const s=(r=e.userData)==null?void 0:r.components;!s||s.length<=0||(delete e.userData.components,e[TE]=s)}afterSerializeUserData(e,i){if(e.type==="Scene"&&Yh&&console.log("DONE",JSON.stringify(i)),e[TE]===void 0)return;const r=e[TE];delete e[TE],r!==null&&(e.userData.components=r)}writeNode(e,i){const r=this.writer.json.nodes.length;Yh&&console.log(e.name,r,e.uuid);const s=new Rye(e,r,i);this.exportContext[r]=s,this.objectToNodeMap[e.uuid]=r}afterParse(e){var i;Yh&&console.log("AFTER",e);for(const r in this.exportContext){const s=this.exportContext[r],o=s.node,a=s.nodeDef,l=s.nodeIndex,c=(i=o.userData)==null?void 0:i.components;if(!c||c.length<=0)continue;const h=new Iye;a.extensions=a.extensions||{},a.extensions[this.name]=h,this.context.object=o,this.context.nodeId=l,this.context.objectToNode=this.objectToNodeMap;const u=[];for(const d of c){this.context.target=d;const f=ul().writeBuiltinComponentData(d,this.context);f!==null&&u.push(f)}u.length>0&&(h[ef]=u,Yh&&console.log("DID WRITE",o,"nodeIndex",l,u))}}beforeRoot(){return Yh&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(e){const i=e.parser,r=i?.extensions;if(!r)return;const s=r[this.name];Yh&&console.log("After root",e,this.parser,r);const o=[];if(s===!0){const a=i.json.nodes;if(a){for(let l=0;l<a.length;l++){const c=await i.getDependency("node",l);this.nodeToObjectMap[l]=c}for(let l=0;l<a.length;l++){const c=a[l],h=l,u=c.extensions;if(!u)continue;const d=u[this.name];if(!d)continue;Yh&&console.log("NODE",c);const f=this.nodeToObjectMap[h];if(!f){console.error("Could not find object for node index: "+h,c,i);continue}lC(f),o.push(this.createComponents(f,d))}}}await Promise.all(o);for(const a of i.associations.keys()){const l=i.associations.get(a);if(l?.materials!=null){const c="/materials/"+l.materials;Bpe(a,c)}}}async createComponents(e,i){if(!i)return;const r=i[ef];if(r){const s=new Array;Yh&&console.log(e.name,r);for(const o in r){const a=r[o];Yh&&console.log("Serialized data",JSON.parse(JSON.stringify(a))),a&&this.parser&&s.push(Lk(this.parser,a).catch(l=>console.error(`Error while resolving references (see console for details)
`,l,e,a))),e.userData=e.userData||{},e.userData[ef]=e.userData[ef]||[],e.userData[ef].push(a)}await Promise.all(s).catch(o=>{console.error("Error while loading components",o)})}}}const B9="NEEDLE_gameobject_data";class Bye{constructor(e){p(this,"parser"),this.parser=e}get name(){return B9}afterRoot(e){var i;const r=[];for(let s=0;s<((i=this.parser.json.nodes)==null?void 0:i.length);s++){const o=this.parser.json.nodes[s];if(o&&o.extensions){const a=o.extensions[B9];if(a){const l=this.findAndApplyExtensionData(s,a);r.push(l)}}}return Promise.all(r).then(()=>null)}async findAndApplyExtensionData(e,i){const r=await this.parser.getDependency("node",e);r&&this.applyExtensionData(r,i)}applyExtensionData(e,i){i.layers===void 0&&(i.layers=0),e.userData.layer=i.layers,e.layers.disableAll(),e.layers.set(i.layers),e.userData.tag=i.tag??"none",e.userData.hideFlags=i.hideFlags??0,e.userData.static=i.static??!1,e.visible=i.activeSelf??!0,e.guid=i.guid}}const k9="NEEDLE_lighting_settings",W0=te("debugenvlight");class kye{constructor(e,i,r){p(this,"parser"),p(this,"sourceId"),p(this,"context"),this.parser=e,this.sourceId=i,this.context=r}get name(){return k9}afterRoot(e){const i=this.parser.json.extensions;if(i){const r=i[k9];if(r){W0&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',r);let s;if(e.scene.children.length===1){const o=e.scene.children[0];s=ie.addNewComponent(o,IE,{},!1)}else{const o=new ve;o.name="LightSettings "+this.sourceId,e.scene.add(o),s=ie.addNewComponent(o,IE,{},!1)}s.sourceId=this.sourceId,s.ambientIntensity=r.ambientIntensity,s.ambientLight=new be().fromArray(r.ambientLight),Array.isArray(r.ambientTrilight)&&(s.ambientTrilight=r.ambientTrilight.map(o=>new be().fromArray(o))),s.ambientMode=r.ambientMode,s.environmentReflectionSource=r.environmentReflectionSource}}return null}}fi.registerCallback(Si.ContextCreated,n=>{const e=n.context,i=ie.findObjectOfType(IE,e);i!=null&&i.sourceId&&(i.enabled=!0)});class IE extends Be{constructor(){super(...arguments),p(this,"ambientMode",f0.Skybox),p(this,"ambientLight"),p(this,"ambientTrilight"),p(this,"ambientIntensity",1),p(this,"environmentReflectionSource",IC.Skybox),p(this,"_hasReflection",!1),p(this,"_ambientLightObj"),p(this,"_hemisphereLightObj")}awake(){var e;if(this.sourceId){const r=this.environmentReflectionSource===IC.Skybox?pd.Skybox:pd.Reflection,s=this.context.lightmaps.tryGet(this.sourceId,r,0);this._hasReflection=s!=null,s&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,s)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),W0&&window.addEventListener("keydown",r=>{if(!this.destroyed)switch(r.key){case"l":this.enabled=!this.enabled;break}});const i=(e=this.gameObject.userData)==null?void 0:e.components;if(i){const r=i.indexOf(this);i.splice(r,1),i.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(e){const i=Math.max(e.r,e.g,e.b);return 2.2*tt.lerp(0,1.33,i)}onEnable(){if(W0&&console.warn("\u{1F4A1}\u{1F7E1} >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==f0.Flat){if(this.ambientLight&&!this._ambientLightObj){const e=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new Hw(this.ambientLight,this.ambientIntensity*e),W0&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,e)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj)}else if(this.ambientMode===f0.Trilight){if(this.ambientTrilight){const e=this.ambientTrilight[0],i=this.ambientTrilight[this.ambientTrilight.length-1],r=this.calculateIntensityFactor(i);this._hemisphereLightObj=new WR(i,e,this.ambientIntensity*r),this.gameObject.add(this._hemisphereLightObj),W0&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,r)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent();this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){W0&&console.warn("\u{1F4A1}\u26AB <<< Disable lighting:",this.sourceId,this),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}var O9=(n=>(n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_3D=35680]="SAMPLER_3D",n[n.SAMPLER_CUBE=35681]="SAMPLER_CUBE",n[n.UNKNOWN=0]="UNKNOWN",n))(O9||{});const zd=te("debugcustomshader"),X0="NEEDLE_techniques_webgl";class Oye{constructor(){p(this,"objectToWorldMatrix",new he),p(this,"worldToObjectMatrix",new he),p(this,"objectToWorld",new Array),p(this,"worldToObject",new Array)}updateFrom(e){this.objectToWorldMatrix.copy(e.matrixWorld),TC(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(e.matrixWorld).invert(),TC(this.worldToObjectMatrix,this.worldToObject)}}const Sn=class extends Nw{constructor(n,...e){super(...e),p(this,"identifier"),p(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this)),p(this,"_sphericalHarmonicsName","unity_SpecCube0"),p(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld"),p(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject"),p(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP"),p(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV"),p(this,"_rendererData",new Oye),this.identifier=n,zd&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName],(this.depthTextureUniform||this.opaqueTextureUniform)&&Ot.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const n=super.clone();return D9(n),n}dispose(){super.dispose();const n=Ot.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);n>=0&&Ot.Current.pre_render_callbacks.splice(n,1)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&Ot.Current.setRequireColor(!0),this.depthTextureUniform&&Ot.Current.setRequireDepth(!0)}onBeforeRender(n,e,i,r,s,o){r.attributes.tangent||r.computeTangents(),this.onUpdateUniforms(i,s)}onUpdateUniforms(n,e){const i=Ot.Current;if(n&&(Sn.viewProjection&&this.uniforms[this._viewProjectionName]&&(Sn.viewProjection.copy(n.projectionMatrix).multiply(n.matrixWorldInverse),TC(Sn.viewProjection,Sn._viewProjectionValues)),Sn.viewMatrix&&this.uniforms[this._viewMatrixName]&&(Sn.viewMatrix.copy(n.matrixWorldInverse),TC(Sn.viewMatrix,Sn._viewMatrixValues)),this.uniforms[Sn._worldSpaceCameraPosName]&&Sn._worldSpaceCameraPos.setFromMatrixPosition(n.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=i.sceneLighting.timeVec4),this.uniforms._Time){const a=this.uniforms._Time.value;a.x=i.sceneLighting.timeVec4.x/20,a.y=i.sceneLighting.timeVec4.x,a.z=i.sceneLighting.timeVec4.x*2,a.w=i.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const a=this.uniforms._SinTime.value;a.x=Math.sin(i.sceneLighting.timeVec4.x/8),a.y=Math.sin(i.sceneLighting.timeVec4.x/4),a.z=Math.sin(i.sceneLighting.timeVec4.x/2),a.w=Math.sin(i.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const a=this.uniforms._CosTime.value;a.x=Math.cos(i.sceneLighting.timeVec4.x/8),a.y=Math.cos(i.sceneLighting.timeVec4.x/4),a.z=Math.cos(i.sceneLighting.timeVec4.x/2),a.w=Math.cos(i.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const a=this.uniforms.unity_DeltaTime.value;a.x=i.time.deltaTime,a.y=1/i.time.deltaTime,a.z=i.time.smoothedDeltaTime,a.w=1/i.time.smoothedDeltaTime}const r=i.mainLight;if(r){const a=kt(r.gameObject,Sn._mainLightPosition);this.uniforms._MainLightPosition={value:a.normalize()},Sn._mainLightColor.set(r.color.r,r.color.g,r.color.b,0),this.uniforms._MainLightColor={value:Sn._mainLightColor};const l=r.intensity;Sn._lightData.z=l,this.uniforms.unity_LightData={value:Sn._lightData}}if(n&&(Sn.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=Sn._viewProjectionValues),Sn.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=Sn._viewMatrixValues),this.uniforms[Sn._worldSpaceCameraPosName]&&(this.uniforms[Sn._worldSpaceCameraPosName]={value:Sn._worldSpaceCameraPos}),i.mainCameraComponent)){if(this.uniforms._ProjectionParams){const a=this.uniforms._ProjectionParams.value;a.x=1,a.y=i.mainCameraComponent.nearClipPlane,a.z=i.mainCameraComponent.farClipPlane,a.w=1/a.z,this.uniforms._ProjectionParams.value=a}if(this.uniforms._ZBufferParams){const a=this.uniforms._ZBufferParams.value,l=i.mainCameraComponent;a.x=1-l.farClipPlane/l.nearClipPlane,a.y=l.farClipPlane/l.nearClipPlane,a.z=a.x/l.farClipPlane,a.w=a.y/l.farClipPlane,this.uniforms._ZBufferParams.value=a}if(this.uniforms._ScreenParams){const a=this.uniforms._ScreenParams.value;a.x=i.domWidth,a.y=i.domHeight,a.z=1+1/a.x,a.w=1+1/a.y,this.uniforms._ScreenParams.value=a}if(this.uniforms._ScaledScreenParams){const a=this.uniforms._ScaledScreenParams.value;a.x=i.domWidth,a.y=i.domHeight,a.z=1+1/a.x,a.w=1+1/a.y,this.uniforms._ScaledScreenParams.value=a}}const s=this.depthTextureUniform;s&&(s.value=i.depthTexture);const o=this.opaqueTextureUniform;if(o&&(o.value=i.opaqueColorTexture),e){const a=this._rendererData;a.updateFrom(e),this.uniforms[this._worldToObjectName].value=a.worldToObject,this.uniforms[this._objToWorldName].value=a.objectToWorld}this.uniformsNeedUpdate=!0}};let Ol=Sn;p(Ol,"viewProjection",new he),p(Ol,"_viewProjectionValues",[]),p(Ol,"viewMatrix",new he),p(Ol,"_viewMatrixValues",[]),p(Ol,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),p(Ol,"_worldSpaceCameraPos",new S),p(Ol,"_mainLightColor",new qe),p(Ol,"_mainLightPosition",new S),p(Ol,"_lightData",new qe);class Dye{constructor(e,i){p(this,"parser"),p(this,"identifier"),this.parser=e,this.identifier=i}get name(){return X0}loadMaterial(e){const i=this.parser.json.materials[e];if(!i)return zd&&console.log(e,this.parser.json.materials),null;if(!i.extensions||!i.extensions[X0])return zd&&console.log("material "+e+" does not use NEEDLE_techniques_webgl"),null;const r=i.extensions[X0].technique;if(r<0)return null;const s=this.parser.json.extensions[X0];if(!s)return null;zd&&console.log(s);const o=s.techniques[r];return o?new Promise(async(a,l)=>{var c,h,u;const d=await Nfe(s,o.program),f=d?.fragmentShader,m=d?.vertexShader;if(!f||!m)return l();zd&&console.log("loadMaterial",i,d);const g={},v=o.uniforms;(m.includes("_Time")||f.includes("_Time"))&&(g._Time={value:new qe(0,0,0,0)}),(m.includes("_SinTime")||f.includes("_SinTime"))&&(g._SinTime={value:new qe(0,0,0,0)}),(m.includes("_CosTime")||f.includes("_CosTime"))&&(g._CosTime={value:new qe(0,0,0,0)}),(m.includes("unity_DeltaTime")||f.includes("unity_DeltaTime"))&&(g.unity_DeltaTime={value:new qe(0,0,0,0)});for(const b in v){const x=b;switch(x){case"_TimeParameters":const _=new qe;g[x]={value:_};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":g[x]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":g[x]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":g[x]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":g[x]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":g[x]={value:null};break}}let y=!1;if(i.extensions&&i.extensions[X0]){const b=i.extensions[X0];if(b.technique===r){zd&&console.log(i.name,"Material Properties",b);for(const x in b.values){const _=b.values[x];if(typeof _=="string"){if(_.startsWith("/textures/")){const w=_.substring(10),T=Number.parseInt(w);if(T>=0){const M=await this.parser.getDependency("texture",T);M instanceof Gt&&(M.colorSpace=Ii,M.needsUpdate=!0),g[x]={value:M};continue}}switch(x){case"alphaMode":_==="BLEND"&&(y=!0);continue}}if(Array.isArray(_)&&_.length===4){g[x]={value:new qe(_[0],_[1],_[2],_[3])};continue}g[x]={value:_}}}}const A=new Ol(this.identifier,{name:i.name??"",uniforms:g,vertexShader:m,fragmentShader:f,lights:!1});switch(A.glslVersion=j_,A.vertexShader=A.vertexShader.replace("#version 300 es",""),A.fragmentShader=A.fragmentShader.replace("#version 300 es",""),(c=g._Cull)==null?void 0:c.value){case 0:A.side=yi;break;case 1:A.side=an;break;case 2:A.side=Fn;break;default:A.side=Fn;break}switch((h=g._ZTest)==null?void 0:h.value){case 3:A.depthTest=!0,A.depthFunc=Mm;break;case 6:A.depthTest=!0,A.depthFunc=qv;break;case 2:A.depthTest=!0,A.depthFunc=Xv;break;case 4:A.depthTest=!0,A.depthFunc=gp;break;case 5:A.depthTest=!0,A.depthFunc=S_;break;case 7:A.depthTest=!0,A.depthFunc=w_;break;case 8:A.depthTest=!1,A.depthFunc=__;break}A.transparent=y,y&&(A.depthWrite=!1),Ufe(g),A.onUpdateUniforms();for(const b in v){const x=b,_=v[b].type;if(((u=g[x])==null?void 0:u.value)===void 0)switch(_){case O9.SAMPLER_2D:g[x]={value:Dfe},console.warn("Missing/unassigned texture, fallback to white: "+x);break;default:x==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+x,v[b]);break}}zd&&console.log(A.uuid,g),D9(A),a(A)}):null}}function D9(n){if(n.uniforms){zd&&console.log("Uniforms:",n.uniforms);for(const i in n.uniforms)switch(e(i,i),i){case"_Color":e("color",i);break}}function e(i,r){Object.getOwnPropertyDescriptor(n,i)||Object.defineProperty(n,i,{get:()=>n.uniforms[r].value,set:s=>{n.uniforms[r].value=s,n.needsUpdate=!0}})}}const Lye=te("debugextensions");let RE;const Uye=Promise.resolve().then(()=>tEe).then(async n=>(RE=n.GLTFAnimationPointerExtension,RE)).catch(n=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",n)}),Yf=new Array;function Fye(n){Yf.includes(n)||Yf.push(n)}function Nye(n){const e=Yf.indexOf(n);e>=0&&Yf.splice(e,1)}function qD(n){const e=new Pye;return n.register(i=>(e.parser=i,e)),e}class zye{resolvePath(e){return e.includes("/extensions/builtin_components/")?e.replace("/extensions/builtin_components/","/userData/components/"):e.includes("extensions/builtin_components/")?e.replace("extensions/builtin_components/","/userData/components/"):e}}async function YD(n,e,i){const r=i.indexOf("?");r>=0&&(i=i.substring(0,r)),n.register(s=>new Bye(s)),n.register(s=>new Ope(s)),n.register(s=>new Pfe(s,e.lightmaps,i)),n.register(s=>new kye(s,i,e)),n.register(s=>new Dye(s,i)),n.register(s=>new QD(s,i)),n.register(s=>new mi(s,i)),n.register(s=>new Mye(s)),e8()&&n.register(s=>new bk(s)),await Uye.catch(s=>{}),n.register(s=>{if(RE){const o=new RE(s);return o.setAnimationPointerResolver.bind(o)(new zye),o}else return(Lye||it())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}});for(const s of Yf)s.onImport&&s.onImport(n,i,e)}function JD(n,e){for(const i of Yf)i.onExport&&i.onExport(n,e)}function KD(n,e,i){for(const r of Yf)r.onLoaded&&r.onLoaded(n,e,i)}const Dl=te("debuginstancing"),L9=class{constructor(){p(this,"objs",[])}setup(n,e,i,r,s,o=0){n.applySettings(e);const a=this.tryCreateOrAddInstance(e,i,s);if(a)mi.assignTextureLOD(a.renderer.material,0),r===null&&(r=[]),r.push(a);else if(o<=0&&e.type!=="Mesh"){const l=o+1;for(const c of e.children)r=this.setup(n,c,i,r,s,l)}return o===0&&s.useMatrixWorldAutoUpdate&&r&&r.length>=0&&this.autoUpdateInstanceMatrix(e),r}tryCreateOrAddInstance(n,e,i){if(n.type==="Mesh"){const r=i.foundMeshes;if(i.foundMeshes+=1,!i.rend.enableInstancing)return null;if(i.rend.enableInstancing!==!0){if(r>=i.rend.enableInstancing.length)return Dl&&console.error("Something is wrong with instance setup",n,i.rend.enableInstancing,r),null;if(!i.rend.enableInstancing[r])return null}const s=n,o=s.material;for(const h of this.objs)if(!!h.canAdd(s.geometry,o))return h.addInstance(s);const a=16;let l=n.name;l!=null&&l.length||(l=o4());const c=new U9(l,s.geometry,o,a,e);return this.objs.push(c),c.addInstance(s)}return null}autoUpdateInstanceMatrix(n){const e=n.matrixWorld.multiplyMatrices.bind(n.matrixWorld),i=n.matrixWorld.clone(),r=(s,o)=>{const a=e(s,o);return(n[zA]||i.equals(a)===!1)&&(i.copy(a),n[zA]=!0),a};n.matrixWorld.multiplyMatrices=r}};let Yb=L9;p(Yb,"instance",new L9);const PE=class{constructor(n,e){p(this,"object"),p(this,"renderer"),p(this,"__instanceIndex",-1),p(this,"__reservedVertexRange",0),p(this,"__reservedIndexRange",0),p(this,"meshInformation"),this.__instanceIndex=-1,this.object=n,this.renderer=e,n[o8]=e,this.meshInformation=q0(n.geometry),PE.all.push(this)}get name(){return this.object.name}get isActive(){return this.__instanceIndex>=0}get vertexCount(){return this.object.geometry.attributes.position.count}get maxVertexCount(){return this.meshInformation.vertexCount}get reservedVertexCount(){return this.__reservedVertexRange}get indexCount(){return this.object.geometry.index?this.object.geometry.index.count:0}get maxIndexCount(){return this.meshInformation.indexCount}get reservedIndexCount(){return this.__reservedIndexRange}updateInstanceMatrix(n=!1,e=!0){this.__instanceIndex<0||(e&&this.object.updateWorldMatrix(!0,n),this.renderer.updateInstance(this.object.matrixWorld,this.__instanceIndex))}setMatrix(n){this.__instanceIndex<0||this.renderer.updateInstance(n,this.__instanceIndex)}setGeometry(n){return this.__instanceIndex<0?!1:this.vertexCount>this.__reservedVertexRange?(console.error(`Cannot update geometry, reserved range is too small: ${this.__reservedVertexRange} < ${this.vertexCount} vertices for ${this.name}`),!1):this.indexCount>this.__reservedIndexRange?(console.error(`Cannot update geometry, reserved range is too small: ${this.__reservedIndexRange} < ${this.indexCount} indices for ${this.name}`),!1):this.renderer.updateGeometry(n,this.__instanceIndex)}add(){this.__instanceIndex>=0||(this.renderer.add(this),ie.markAsInstancedRendered(this.object,!0))}remove(n){if(!(this.__instanceIndex<0)&&(this.renderer.remove(this,n),ie.markAsInstancedRendered(this.object,!1),n)){const e=PE.all.indexOf(this);e>=0&&PE.all.splice(e,1)}}};let Jb=PE;p(Jb,"all",[]);class U9{constructor(e,i,r,s,o){p(this,"allowResize",!0),p(this,"name",""),p(this,"geometry"),p(this,"material"),p(this,"context"),p(this,"inst"),p(this,"handles",[]),p(this,"maxInstanceCount"),p(this,"_currentInstanceCount",0),p(this,"_currentVertexCount",0),p(this,"_currentIndexCount",0),p(this,"_maxVertexCount"),p(this,"_maxIndexCount"),p(this,"_needUpdateBounds",!1),p(this,"_debugMaterial",null),p(this,"onBeforeRender",()=>{this.inst.layers.enableAll(),this._needUpdateBounds&&this.inst[jA]===!0&&(Dl&&console.log("Update instancing bounds",this.name,this.inst.matrixWorldNeedsUpdate),this.updateBounds())}),p(this,"onAfterRender",()=>{this.inst.layers.disableAll()}),p(this,"_availableBuckets",new Array),p(this,"_usedBuckets",new Array),this.name=e,this.geometry=i,this.material=r,this.context=o,this.maxInstanceCount=Math.max(2,s),Dl&&(this._debugMaterial=F9());const a=this.tryEstimateVertexCountSize(this.maxInstanceCount,[i],s);this._maxVertexCount=a.vertexCount,this._maxIndexCount=a.indexCount,this.inst=new Cw(this.maxInstanceCount,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material),this.inst[jA]=!0,this.inst.visible=!0,this.context.scene.add(this.inst),r instanceof Nw&&(r.defines.USE_INSTANCING=!0,r.needsUpdate=!0),o.pre_render_callbacks.push(this.onBeforeRender),o.post_render_callbacks.push(this.onAfterRender),Dl&&console.log(`Instanced renderer created with ${this.maxInstanceCount} instances, ${this._maxVertexCount} max vertices and ${this._maxIndexCount} max indices for "${e}"`)}get mesh(){return this.inst}get visible(){return this.inst.visible}set visible(e){this.inst.visible=e}get castShadow(){return this.inst.castShadow}set castShadow(e){this.inst.castShadow=e}set receiveShadow(e){this.inst.receiveShadow=e}updateBounds(e=!0,i=!0){this._needUpdateBounds=!1,e&&this.inst.computeBoundingBox(),i&&this.inst.computeBoundingSphere()}get count(){return this._currentInstanceCount}canAdd(e,i){return this._maxVertexCount>1e7||i!==this.material?!1:!!(!this.mustGrow(e)||this.allowResize)}dispose(){Dl&&console.warn("Dispose instanced renderer",this.name),this.context.scene.remove(this.inst),this.inst.dispose(),this.inst=null,this.handles=[]}addInstance(e){const i=new Jb(e,this);e.castShadow===!0&&this.inst.castShadow===!1&&(this.inst.castShadow=!0),e.receiveShadow===!0&&this.inst.receiveShadow===!1&&(this.inst.receiveShadow=!0);try{this.add(i)}catch(r){return console.error(`Failed adding mesh to instancing
`,r),it()&&I1("Failed instancing mesh. See the browser console for details."),null}return i}add(e){const i=e.object.geometry;if(!this.validateGeometry(i)){Dl&&console.error("Cannot add instance, invalid geometry",this.name,i);return}if(this.mustGrow(i))if(this.allowResize)this.grow(i);else{console.error("Cannot add instance, max count reached",this.name,this.count,this.maxInstanceCount);return}e.object.updateWorldMatrix(!0,!0),this.addGeometry(e),this.handles[e.__instanceIndex]=e,this._currentInstanceCount+=1,this.markNeedsUpdate(),this._currentInstanceCount>0&&(this.inst.visible=!0)}remove(e,i){e&&(e.__instanceIndex<0||this.handles[e.__instanceIndex]!=e||this._currentInstanceCount<=0||(this.removeGeometry(e,i),this.handles[e.__instanceIndex]=null,e.__instanceIndex=-1,this._currentInstanceCount>0&&(this._currentInstanceCount-=1),this._currentInstanceCount<=0&&(this.inst.visible=!1),this.markNeedsUpdate()))}updateInstance(e,i){this.inst.setMatrixAt(i,e),this.markNeedsUpdate()}updateGeometry(e,i){return this.validateGeometry(e)?(this.mustGrow()&&this.grow(e),Dl&&console.debug("UPDATE MESH",i,e.name,q0(e),e.attributes.position.count,e.index?e.index.count:0),this.inst.setGeometryAt(i,e),this.markNeedsUpdate(),!0):!1}validateGeometry(e){return this.geometry,!0}markNeedsUpdate(){this._needUpdateBounds=!0}mustGrow(e){if(this.count>=this.maxInstanceCount)return!0;if(!e)return!1;const i=q0(e),r=i.vertexCount,s=i.indexCount;return this._currentVertexCount+r>this._maxVertexCount||this._currentIndexCount+s>this._maxIndexCount}grow(e){const i=this.maxInstanceCount*2,r=this.tryEstimateVertexCountSize(i,[e]),s=Math.max(this._maxVertexCount,r.vertexCount),o=Math.max(this._maxIndexCount,r.indexCount,this._maxVertexCount*2);if(Dl){const l=q0(e);console.warn(`Growing batched mesh for "${this.name}/${e.name}" ${l.vertexCount} vertices, ${l.indexCount} indices
Max count ${this.maxInstanceCount} \u2192 ${i}
Max vertex count ${this._maxVertexCount} -> ${s}
Max index count ${this._maxIndexCount} -> ${o}`),this._debugMaterial=F9()}this._maxVertexCount=s,this._maxIndexCount=o;const a=new Cw(i,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material);a.layers=this.inst.layers,a.castShadow=this.inst.castShadow,a.receiveShadow=this.inst.receiveShadow,a.visible=this.inst.visible,a[jA]=this.inst[jA],a.matrixAutoUpdate=this.inst.matrixAutoUpdate,a.matrixWorldNeedsUpdate=this.inst.matrixWorldNeedsUpdate,a.matrixAutoUpdate=this.inst.matrixAutoUpdate,a.matrixWorld.copy(this.inst.matrixWorld),a.matrix.copy(this.inst.matrix),this.inst.dispose(),this.inst.removeFromParent(),this.inst=a,this.maxInstanceCount=i;for(const l of this.handles)l&&l.__instanceIndex>=0&&this.addGeometry(l);this.context.scene.add(a)}tryEstimateVertexCountSize(e,i,r=1){const s=new Map;for(const h of this.handles)if(h&&h.__instanceIndex>=0)if(s.has(h.object.geometry)){const u=s.get(h.object.geometry);u.count+=1}else{const u={count:1,...q0(h.object.geometry)};s.set(h.object.geometry,u)}let o=0,a=0;for(const[h,u]of s)o+=u.vertexCount*u.count,a+=u.indexCount*u.count;let l=Math.ceil(o/Math.max(1,this._currentInstanceCount))*e,c=Math.ceil(a/Math.max(1,this._currentInstanceCount))*e*2;if(i)for(const h of i){const u=q0(h);l+=u.vertexCount*r,c+=u.indexCount*r}return{vertexCount:l,indexCount:c}}addGeometry(e){let i=null,r=-1;for(let a=this._availableBuckets.length-1;a>=0;a--){const l=this._availableBuckets[a];l.vertexCount>=e.maxVertexCount&&l.indexCount>=e.maxIndexCount&&(i==null||l.vertexCount<i.vertexCount)&&(i=l,r=a)}if(i!=null){const a=i;Dl&&console.debug(`RE-USE SPACE #${a.index}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name}`),this.inst.setGeometryAt(a.index,e.object.geometry),this.inst.setMatrixAt(a.index,e.object.matrixWorld),this.inst.setVisibleAt(a.index,!0),e.__instanceIndex=a.index,this._usedBuckets[a.index]=a,this._availableBuckets.splice(r,1);return}const s=e.object.geometry;Dl&&console.debug("ADD GEOMETRY",s.name,`
vertex:`,`${this._currentVertexCount} + ${e.maxVertexCount} < ${this._maxVertexCount}?`,`
index:`,e.maxIndexCount,this._currentIndexCount,this._maxIndexCount);const o=this.inst.addGeometry(s,e.maxVertexCount,e.maxIndexCount);e.__instanceIndex=o,e.__reservedVertexRange=e.maxVertexCount,e.__reservedIndexRange=e.maxIndexCount,this._currentVertexCount+=e.maxVertexCount,this._currentIndexCount+=e.maxIndexCount,this._usedBuckets[o]={index:o,vertexCount:e.maxVertexCount,indexCount:e.maxIndexCount},this.inst.setMatrixAt(o,e.object.matrixWorld),Dl&&console.debug(`ADD MESH & RESERVE SPACE #${o}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name} ${e.object.uuid}`)}removeGeometry(e,i){e.__instanceIndex<0||(this._usedBuckets.splice(e.__instanceIndex,1),this.inst.setVisibleAt(e.__instanceIndex,!1),this._availableBuckets.push({index:e.__instanceIndex,vertexCount:e.reservedVertexCount,indexCount:e.reservedIndexCount}))}}p(U9,"nullMatrix",new he);function q0(n){let e=n.attributes.position.count,i=n.index?n.index.count:0;const r=mi.getMeshLODInformation(n);if(r){const s=r.lods[0];let o=s.vertexCount,a=s.indexCount;o+=10,o+=o*.05,a+=20,e=Math.max(e,o),i=Math.max(i,a)}return e=Math.ceil(e),i=Math.ceil(i),{vertexCount:e,indexCount:i}}function F9(){const n=new mr({color:new be(Math.random(),Math.random(),Math.random())});return n.emissive=n.color,n.emissiveIntensity=.3,te("wireframe")&&(n.wireframe=!0),n}const Y0=te("debuglightmaps");class Kb{constructor(e,i){p(this,"lightmapIndex",-1),p(this,"lightmapScaleOffset",new qe(1,1,0,0)),p(this,"context"),p(this,"gameObject"),p(this,"lightmapTexture",null),p(this,"lightmapScaleOffsetUniform",{value:new qe(1,1,0,0)}),p(this,"lightmapUniform",{value:null}),p(this,"onBeforeCompile",(r,s)=>{Y0&&console.log(`Lightmaps, before compile
`,r),this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,r.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform}),this.gameObject=e,this.context=i}get lightmap(){return this.lightmapTexture}set lightmap(e){e!==this.lightmapTexture&&(this.lightmapTexture=e,this.applyLightmap(),this.lightmapTexture&&mi.assignTextureLOD(this.lightmapTexture,0).then(i=>{i!=null&&i.isTexture&&(this.lightmapTexture=i)}))}init(e,i,r){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=e,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=i,this.lightmapTexture=r,mi.assignTextureLOD(r,0).then(s=>{s!=null&&s.isTexture&&(this.lightmapTexture=s)}),Y0=="show"?(console.log("Lightmap:",this.gameObject.name,e,`
ScaleOffset:`,i,`
Texture:`,r),this.setLightmapDebugMaterial()):Y0&&console.log("Use debuglightmaps=show to render lightmaps only in the scene."),this.applyLightmap())}updateLightmapUniforms(e){const i=e.uniforms;i&&i.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,i.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){Y0&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){this.gameObject["Needle:Multimaterial-LightmapWarning"]===void 0&&(this.gameObject["Needle:Multimaterial-LightmapWarning"]=!0,console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it"));return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const e=this.gameObject;if(e.geometry.getAttribute("uv1")||e.geometry.setAttribute("uv1",e.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const i=this.gameObject.material;for(let r=0;r<i.length;r++)i[r]=this.ensureLightmapMaterial(i[r])}else this.gameObject.material=this.ensureLightmapMaterial(this.gameObject.material);if(this.lightmapIndex>=0&&this.lightmapTexture){this.lightmapTexture.channel=1;const i=this.gameObject.material;if(Array.isArray(i))for(const r of i)this.assignLightmapTexture(r);else i&&this.assignLightmapTexture(i)}}ensureLightmapMaterial(e){return e.userData||(e.userData={}),e["NEEDLE:lightmap-material-version"]!=e.version&&e["NEEDLE:lightmap-material-version"]==null&&(Y0&&console.warn("Cloning material for lightmap "+e.name),e=e.clone(),e.onBeforeCompile=this.onBeforeCompile),e}assignLightmapTexture(e){!e||e instanceof Co&&e.transmission>0||!(e.lightMap!==this.lightmapTexture||e["NEEDLE:lightmap-material-version"]!==e.version)||(Y0&&console.log("Assigning lightmap",e.name,e.version),e.lightMap=this.lightmapTexture,e["NEEDLE:lightmap-material-version"]=e.version)}setLightmapDebugMaterial(){this.gameObject.material=new Bt({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}var jye=Object.defineProperty,Gye=Object.getOwnPropertyDescriptor,Jh=(n,e,i,r)=>{for(var s=r>1?void 0:r?Gye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&jye(e,i,s),s};const Zb=te("debugrenderer"),N9=te("debugskinnedmesh"),z9=te("noinstancing"),Hye=te("wireframe");class ZD{constructor(){p(this,"path",null),p(this,"asset",null),p(this,"default")}}class Vye{constructor(e,i){p(this,"_renderer"),p(this,"_targets",[]),p(this,"_indexMapMaxIndex"),p(this,"_indexMap"),p(this,"_changed",!1),this._renderer=e;const r=this.setMaterial.bind(this),s=this.getMaterial.bind(this),o=e.gameObject;if(this._targets=[],o)switch(o.type){case"Group":this._targets=[...o.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(o);break}let a=!1,l,c=0;for(let h=0;h<this._targets.length;h++){const u=this._targets[h];if(!u)continue;const d=u.material;if(d){d.shadowSide=d.side;for(let f=0;f<i.length;f++){const m=i[f];if(!m){a=!0;continue}if(d.name===m.name){l===void 0&&(l=new Map),l.set(f,h),c=Math.max(c,f);break}}}}if(a){this._indexMapMaxIndex=c,this._indexMap=l;const h=`Renderer ${e.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(h),eo()&&Pi("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(h,u){if(typeof u=="string"){const d=parseInt(u);if(!isNaN(d))return s(d)}return h[u]},set(h,u,d){return typeof u=="string"&&r(d,Number.parseInt(u)),Reflect.set(h,u,d)?(d instanceof Ut&&(h.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(e){e===!0&&Zb&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=e}is(e){return this._renderer===e}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.getMaterial(e)}resolveIndex(e){const i=this._indexMap;return i&&i.has(e)?i.get(e):e}setMaterial(e,i){if(i=this.resolveIndex(i),i<0||i>=this._targets.length)return;const r=this._targets[i];!r||r.material===void 0||(r.material=e,this.changed=!0)}getMaterial(e){if(e=this.resolveIndex(e),e<0)return null;const i=this._targets;if(e>=i.length)return null;const r=i[e];return r?r.material:null}}const BE=class extends Be{constructor(){super(...arguments),p(this,"receiveShadows",!1),p(this,"shadowCastingMode",0),p(this,"lightmapIndex",-1),p(this,"lightmapScaleOffset",new qe(1,1,0,0)),p(this,"enableInstancing"),p(this,"renderOrder"),p(this,"allowOcclusionWhenDynamic",!0),p(this,"probeAnchor"),p(this,"reflectionProbeUsage",0),p(this,"_lightmaps"),p(this,"_sharedMeshes",[]),p(this,"_sharedMaterials"),p(this,"_originalMaterials"),p(this,"_probeAnchorLastFrame"),p(this,"_lightmapTextureOverride"),p(this,"allowProgressiveLoading",!0),p(this,"_firstFrame",-1),p(this,"_isInstancingEnabled",!1),p(this,"handles"),p(this,"onBeforeRenderThree",(n,e,i,r,s,o)=>{var a;if(s.envMapIntensity!==void 0){const l=this.hasLightmap?Math.PI:1,c=((a=this.context.mainCameraComponent)==null?void 0:a.environmentIntensity)??1;s.envMapIntensity=Math.max(0,c*this.context.sceneLighting.environmentIntensity/l)}if(this._lightmaps)for(const l of this._lightmaps)l.updateLightmapUniforms(s),l.applyLightmap()}),p(this,"_reflectionProbe",null)}static setInstanced(n,e){const i=YA(n,BE);return i.setInstancingEnabled(e),i}static isInstanced(n){const e=Cf(n,BE);return e?e.isInstancingActive:rl.isUsingInstancing(n)}static setVisible(n,e){ld(n,e)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMeshes(){if(this.destroyed||!this.gameObject)return this._sharedMeshes;if(this._sharedMeshes.length=0,this.gameObject.type==="Group")for(const n of this.gameObject.children)(n.type==="Mesh"||n.type==="SkinnedMesh")&&this._sharedMeshes.push(n);else(this.gameObject.type==="Mesh"||this.gameObject.type==="SkinnedMesh")&&this._sharedMeshes.push(this.gameObject);return this._sharedMeshes}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(n){this.sharedMaterials[0]!==n&&(this.sharedMaterials[0]=n,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(n){this.sharedMaterial=n}set sharedMaterials(n){if(!this._originalMaterials)this._originalMaterials=n;else if(n){let e=!1;for(let i=0;i<this._sharedMaterials.length;i++){const r=i<n.length?n[i]:null;r&&r instanceof Ut?this.sharedMaterials[i]=r:e||(e=!0,console.warn("Can not assign null as material: "+this.name,r))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new Vye(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return z9}get lightmap(){var n;return(n=this._lightmaps)!=null&&n.length?this._lightmaps[0].lightmap:null}set lightmap(n){var e;if(this._lightmapTextureOverride=n,n===void 0&&(n=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(e=this._lightmaps)!=null&&e.length)for(const i of this._lightmaps)i.lightmap=n}get hasLightmap(){return this.lightmap!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(this._firstFrame=this.context.time.frame,Zb&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&Zb&&this.probeAnchor.add(new Vo(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const n of this.gameObject.children)this.context.addBeforeRenderListener(n,this.onBeforeRenderThree),n.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let n=0;for(let e=0;e<this.gameObject.children.length;e++){const i=this.gameObject.children[e];if(!(!this.isMeshOrSkinnedMesh(i)||ie.getComponent(i,BE))){if(this.renderOrder.length<=n){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+n,"ChildElement:",i);continue}i.renderOrder=this.renderOrder[n],n+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),Hye)for(let n=0;n<this.sharedMaterials.length;n++){const e=this.sharedMaterials[n];e&&(e.wireframe=!0)}}applyLightmapping(){var n;if(this.lightmapIndex>=0){const e=this.gameObject.type,i=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(i){if(this._lightmaps||(this._lightmaps=[]),e==="Mesh"){const r=this.gameObject.material;if(r!=null&&r.isMeshBasicMaterial)r&&console.warn("Lightmapping is not supported on MeshBasicMaterial",r.name);else{if(this._lightmaps.length<=0){const s=new Kb(this.gameObject,this.context);this._lightmaps.push(s)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,i)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let r=0;r<this.gameObject.children.length;r++){const s=this.gameObject.children[r];if(!((n=s.material)!=null&&n.isMeshBasicMaterial)){let o;r>=this._lightmaps.length?(o=new Kb(s,this.context),this._lightmaps.push(o)):o=this._lightmaps[r],o.init(this.lightmapIndex,this.lightmapScaleOffset,i)}}}else Zb&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}get isInstancingActive(){return this.handles!=null&&this.handles.length>0&&this._isInstancingEnabled}setInstancingEnabled(n){if(this._isInstancingEnabled===n)return n&&(this.handles===void 0||this.handles!=null&&this.handles.length>0);if(this._isInstancingEnabled=n,n){if(this.enableInstancing===void 0&&(this.enableInstancing=!0),this.handles===void 0){if(this.handles=Yb.instance.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this.handles)return ie.markAsInstancedRendered(this.gameObject,!0),!0}else if(this.handles!==null){for(const e of this.handles)e.updateInstanceMatrix(!0),e.add();return ie.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this.handles)for(const e of this.handles)e.remove(this.destroyed);return!0}return!1}clearInstancingState(){this._isInstancingEnabled=!1,this.handles=void 0}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!z9&&(this.setInstancingEnabled(!0),rl.markDirty(this.gameObject)),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let n=0;n<this.gameObject.children.length;n++){const e=this.gameObject.children[n];e.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.sharedMeshes,this.setVisibility(!0),this._isInstancingEnabled||this.enableInstancing==!0||Array.isArray(this.enableInstancing)&&this.enableInstancing.some(n=>n)?this.__internalDidAwakeAndStart&&this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this.handles&&this.handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this.handles=null,this.isMultiMaterialObject(this.gameObject))for(const n of this.gameObject.children)this.context.removeBeforeRenderListener(n,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}onBeforeRender(){var n,e,i;if(this.gameObject){if(this._probeAnchorLastFrame!==this.probeAnchor&&((n=this._reflectionProbe)==null||n.onUnset(this),this.updateReflectionProbe()),Zb==this.name&&this.gameObject instanceof pe){this.gameObject.geometry.computeBoundingSphere();const r=bt(this.gameObject.geometry.boundingSphere.center).applyMatrix4(this.gameObject.matrixWorld);yt.DrawWireSphere(r,this.gameObject.geometry.boundingSphere.radius,56831)}if(this.isMultiMaterialObject(this.gameObject)&&((e=this.gameObject.children)==null?void 0:e.length)>0)for(const r of this.gameObject.children)this.applySettings(r);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(i=this.handles)!=null&&i.length&&this.gameObject[zA]===!0){this.gameObject[zA]=!1;for(let r=this.handles.length-1;r>=0;r--)this.handles[r].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this.handles&&this.handles.length<=0&&ie.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this.handles)for(let r=0;r<this.handles.length;r++){const s=this.handles[r];ld(s.object,!1)}this.reflectionProbeUsage!==0&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this.handles)for(let n=0;n<this.handles.length;n++){const e=this.handles[n];ld(e.object,!0)}this.reflectionProbeUsage!==0&&this._reflectionProbe&&this._reflectionProbe.onUnset(this),this.static&&this.gameObject.matrixAutoUpdate&&(this.gameObject.matrixAutoUpdate=!1)}applyStencil(){QD.applyStencil(this)}applySettings(n){n.receiveShadow=this.receiveShadows,this.shadowCastingMode==1?n.castShadow=!0:n.castShadow=!1}updateReflectionProbe(){this._reflectionProbe=null,this.reflectionProbeUsage!==0&&(this.startCoroutine(this._updateReflectionProbe(),Xi.LateUpdate),this._probeAnchorLastFrame=this.probeAnchor)}*_updateReflectionProbe(){const n=this.probeAnchor||this.gameObject,e=!!this.probeAnchor;this._reflectionProbe=Q0.get(n,this.context,e,this.probeAnchor)}setVisibility(n){if(!this.isMultiMaterialObject(this.gameObject))ld(this.gameObject,n);else for(const e of this.gameObject.children)this.isMeshOrSkinnedMesh(e)&&ld(e,n)}isMultiMaterialObject(n){return n.type==="Group"}isMeshOrSkinnedMesh(n){return n.type==="Mesh"||n.type==="SkinnedMesh"}};let Bn=BE;Jh([C()],Bn.prototype,"receiveShadows",2),Jh([C()],Bn.prototype,"shadowCastingMode",2),Jh([C()],Bn.prototype,"lightmapIndex",2),Jh([C(qe)],Bn.prototype,"lightmapScaleOffset",2),Jh([C()],Bn.prototype,"enableInstancing",2),Jh([C()],Bn.prototype,"renderOrder",2),Jh([C()],Bn.prototype,"allowOcclusionWhenDynamic",2),Jh([C(ve)],Bn.prototype,"probeAnchor",2),Jh([C()],Bn.prototype,"reflectionProbeUsage",2);class $b extends Bn{}class $D extends $b{constructor(){super(...arguments),p(this,"_needUpdateBoundingSphere",!1)}awake(){var e;super.awake(),N9&&console.log('SkinnedMeshRenderer for "'+this.name+'"',this),this.allowOcclusionWhenDynamic=!1;for(const i of this.sharedMeshes)(e=i.parent)==null||e.updateWorldMatrix(!1,!0),this.markBoundsDirty()}onAfterRender(){if(super.onAfterRender(),this._needUpdateBoundingSphere){for(const e of this.sharedMeshes)if(e instanceof wo){this._needUpdateBoundingSphere=!1;const i=e.geometry,r=xA(e);r&&(e.geometry=r),e.computeBoundingSphere(),e.geometry=i}}if(N9){for(const e of this.sharedMeshes)if(e instanceof wo&&e.boundingSphere){const i=bt(e.boundingSphere.center).applyMatrix4(e.matrixWorld);yt.DrawWireSphere(i,e.boundingSphere.radius,"red")}}}markBoundsDirty(){this._needUpdateBoundingSphere=!0}}var Qye=Object.defineProperty,Wye=Object.getOwnPropertyDescriptor,re=(n,e,i,r)=>{for(var s=r>1?void 0:r?Wye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Qye(e,i,s),s};const kE=te("debugparticles");var Kh=(n=>(n[n.Billboard=0]="Billboard",n[n.Stretch=1]="Stretch",n[n.HorizontalBillboard=2]="HorizontalBillboard",n[n.VerticalBillboard=3]="VerticalBillboard",n[n.Mesh=4]="Mesh",n))(Kh||{});let jd=class{constructor(){p(this,"alphaKeys"),p(this,"colorKeys")}get duration(){return 1}evaluate(n,e){let i,r=0,s=null,o=0;for(let a=0;a<this.alphaKeys.length;a++){const l=this.alphaKeys[a];(l.time<n||!i)&&(i=l,r=a)}for(let a=0;a<this.colorKeys.length;a++){const l=this.colorKeys[a];(l.time<n||!s)&&(s=l,o=a)}if(s)if(o+1<this.colorKeys.length){const a=this.colorKeys[o+1],l=tt.remap(n,s.time,a.time,0,1);e.r=tt.lerp(s.color.r,a.color.r,l),e.g=tt.lerp(s.color.g,a.color.g,l),e.b=tt.lerp(s.color.b,a.color.b,l)}else e.r=s.color.r,e.g=s.color.g,e.b=s.color.b;if(i)if(r+1<this.alphaKeys.length){const a=this.alphaKeys[r+1],l=tt.remap(n,i.time,a.time,0,1);e.alpha=tt.lerp(i.alpha,a.alpha,l)}else e.alpha=i.alpha;return e}};re([C()],jd.prototype,"alphaKeys",2),re([C()],jd.prototype,"colorKeys",2);var ex=(n=>(n[n.Local=0]="Local",n[n.World=1]="World",n[n.Custom=2]="Custom",n))(ex||{}),OE=(n=>(n[n.Sphere=0]="Sphere",n[n.SphereShell=1]="SphereShell",n[n.Hemisphere=2]="Hemisphere",n[n.HemisphereShell=3]="HemisphereShell",n[n.Cone=4]="Cone",n[n.Box=5]="Box",n[n.Mesh=6]="Mesh",n[n.ConeShell=7]="ConeShell",n[n.ConeVolume=8]="ConeVolume",n[n.ConeVolumeShell=9]="ConeVolumeShell",n[n.Circle=10]="Circle",n[n.CircleEdge=11]="CircleEdge",n[n.SingleSidedEdge=12]="SingleSidedEdge",n[n.MeshRenderer=13]="MeshRenderer",n[n.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",n[n.BoxShell=15]="BoxShell",n[n.BoxEdge=16]="BoxEdge",n[n.Donut=17]="Donut",n[n.Rectangle=18]="Rectangle",n[n.Sprite=19]="Sprite",n[n.SpriteRenderer=20]="SpriteRenderer",n))(OE||{});const j9=class{constructor(){p(this,"mode"),p(this,"constant"),p(this,"constantMin"),p(this,"constantMax"),p(this,"curve"),p(this,"curveMin"),p(this,"curveMax"),p(this,"curveMultiplier")}clone(){var n,e,i;const r=new j9;return r.mode=this.mode,r.constant=this.constant,r.constantMin=this.constantMin,r.constantMax=this.constantMax,r.curve=(n=this.curve)==null?void 0:n.clone(),r.curveMin=(e=this.curveMin)==null?void 0:e.clone(),r.curveMax=(i=this.curveMax)==null?void 0:i.clone(),r.curveMultiplier=this.curveMultiplier,r}evaluate(n,e){const i=e===void 0?Math.random():e;switch(this.mode){case 0:return this.constant;case 1:return n=tt.clamp01(n),this.curve.evaluate(n)*this.curveMultiplier;case 2:const r=n*this.curveMin.duration,s=n*this.curveMax.duration;return tt.lerp(this.curveMin.evaluate(r),this.curveMax.evaluate(s),i%1)*this.curveMultiplier;case 3:return tt.lerp(this.constantMin,this.constantMax,i%1);default:this.curveMax.evaluate(n)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case 0:return this.constant;case 1:return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case 2:return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case 3:return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(n){if(!n)return 0;let e=Number.MIN_VALUE;for(let i=0;i<n.keys.length;i++){const r=n.keys[i];r.value>e&&(e=r.value)}return e}};let ft=j9;re([C()],ft.prototype,"mode",2),re([C()],ft.prototype,"constant",2),re([C()],ft.prototype,"constantMin",2),re([C()],ft.prototype,"constantMax",2),re([C(Df)],ft.prototype,"curve",2),re([C(Df)],ft.prototype,"curveMin",2),re([C(Df)],ft.prototype,"curveMax",2),re([C()],ft.prototype,"curveMultiplier",2);var DE;const Ll=(DE=class{constructor(){p(this,"mode"),p(this,"color"),p(this,"colorMin"),p(this,"colorMax"),p(this,"gradient"),p(this,"gradientMin"),p(this,"gradientMax")}evaluate(n,e){const i=e===void 0?Math.random():e;switch(this.mode){case 0:return this.color;case 1:return this.gradient.evaluate(n,Ll._temp),Ll._temp;case 2:return Ll._temp.lerpColors(this.colorMin,this.colorMax,i);case 3:return this.gradientMin.evaluate(n,Ll._temp),this.gradientMax.evaluate(n,Ll._temp2),Ll._temp.lerp(Ll._temp2,i)}return Ll._temp.set(16711935),Ll._temp.alpha=1,Ll._temp}},p(DE,"_temp",new ki(0,0,0,1)),p(DE,"_temp2",new ki(0,0,0,1)),DE);let Po=Ll;re([C(ki)],Po.prototype,"color",2),re([C(ki)],Po.prototype,"colorMin",2),re([C(ki)],Po.prototype,"colorMax",2),re([C(jd)],Po.prototype,"gradient",2),re([C(jd)],Po.prototype,"gradientMin",2),re([C(jd)],Po.prototype,"gradientMax",2);var eL=(n=>(n[n.Hierarchy=0]="Hierarchy",n[n.Local=1]="Local",n[n.Shape=2]="Shape",n))(eL||{});class hs{constructor(){p(this,"cullingMode"),p(this,"duration"),p(this,"emitterVelocityMode"),p(this,"flipRotation"),p(this,"gravityModifier"),p(this,"gravityModifierMultiplier"),p(this,"loop"),p(this,"maxParticles"),p(this,"playOnAwake"),p(this,"prewarm"),p(this,"ringBufferLoopRange"),p(this,"ringBufferMode"),p(this,"scalingMode"),p(this,"simulationSpace"),p(this,"simulationSpeed"),p(this,"startColor"),p(this,"startDelay"),p(this,"startDelayMultiplier"),p(this,"startLifetime"),p(this,"startLifetimeMultiplier"),p(this,"startRotation"),p(this,"startRotationMultiplier"),p(this,"startRotation3D"),p(this,"startRotationX"),p(this,"startRotationXMultiplier"),p(this,"startRotationY"),p(this,"startRotationYMultiplier"),p(this,"startRotationZ"),p(this,"startRotationZMultiplier"),p(this,"startSize"),p(this,"startSize3D"),p(this,"startSizeMultiplier"),p(this,"startSizeX"),p(this,"startSizeXMultiplier"),p(this,"startSizeY"),p(this,"startSizeYMultiplier"),p(this,"startSizeZ"),p(this,"startSizeZMultiplier"),p(this,"startSpeed"),p(this,"startSpeedMultiplier"),p(this,"stopAction"),p(this,"useUnscaledTime")}}re([C(ft)],hs.prototype,"gravityModifier",2),re([C(Po)],hs.prototype,"startColor",2),re([C(ft)],hs.prototype,"startDelay",2),re([C(ft)],hs.prototype,"startLifetime",2),re([C(ft)],hs.prototype,"startRotation",2),re([C(ft)],hs.prototype,"startRotationX",2),re([C(ft)],hs.prototype,"startRotationY",2),re([C(ft)],hs.prototype,"startRotationZ",2),re([C(ft)],hs.prototype,"startSize",2),re([C(ft)],hs.prototype,"startSizeX",2),re([C(ft)],hs.prototype,"startSizeY",2),re([C(ft)],hs.prototype,"startSizeZ",2),re([C(ft)],hs.prototype,"startSpeed",2);class tx{constructor(){p(this,"cycleCount"),p(this,"maxCount"),p(this,"minCount"),p(this,"probability"),p(this,"repeatInterval"),p(this,"time"),p(this,"count"),p(this,"_performed",0)}reset(){this._performed=0}run(e){if(e<=this.time)return 0;let i=0;if(this.cycleCount===0||this._performed<this.cycleCount){const r=this.time+this.repeatInterval*this._performed;if(e>=r&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case 0:i=this.count.constant;break;case 3:i=tt.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case 1:i=this.count.curve.evaluate(Math.random());break;case 2:const s=Math.random();i=tt.lerp(this.count.curveMin.evaluate(s),this.count.curveMax.evaluate(s),Math.random());break}}return i}}class Pc{constructor(){p(this,"enabled"),p(this,"bursts"),p(this,"rateOverTime"),p(this,"rateOverTimeMultiplier"),p(this,"rateOverDistance"),p(this,"rateOverDistanceMultiplier"),p(this,"system")}get burstCount(){var e;return((e=this.bursts)==null?void 0:e.length)??0}reset(){var e;(e=this.bursts)==null||e.forEach(i=>i.reset())}getBurst(){let e=0;if(this.burstCount>0)for(let i=0;i<this.burstCount;i++){const r=this.bursts[i];this.system.main.loop&&r.time>=this.system.time&&r.reset(),e+=Math.round(r.run(this.system.time))}return e}}re([C()],Pc.prototype,"enabled",2),re([C()],Pc.prototype,"bursts",2),re([C(ft)],Pc.prototype,"rateOverTime",2),re([C()],Pc.prototype,"rateOverTimeMultiplier",2),re([C(ft)],Pc.prototype,"rateOverDistance",2),re([C()],Pc.prototype,"rateOverDistanceMultiplier",2);class ix{constructor(){p(this,"enabled"),p(this,"color")}}re([C(Po)],ix.prototype,"color",2);class Gd{constructor(){p(this,"enabled"),p(this,"separateAxes"),p(this,"size"),p(this,"sizeMultiplier"),p(this,"x"),p(this,"xMultiplier"),p(this,"y"),p(this,"yMultiplier"),p(this,"z"),p(this,"zMultiplier"),p(this,"_time",0),p(this,"_temp",new S)}evaluate(e,i,r){if(i||(i=this._temp),!this.enabled)return i.x=i.y=i.z=1,i;if(this.separateAxes)i.x=this.x.evaluate(e,r)*this.xMultiplier,i.y=this.y.evaluate(e,r)*this.yMultiplier,i.z=this.z.evaluate(e,r)*this.zMultiplier;else{const s=this.size.evaluate(e,r)*this.sizeMultiplier;i.x=s}return i}}re([C(ft)],Gd.prototype,"size",2),re([C(ft)],Gd.prototype,"x",2),re([C(ft)],Gd.prototype,"y",2),re([C(ft)],Gd.prototype,"z",2);var LE;const nx=(LE=class{constructor(){p(this,"shapeType",5),p(this,"enabled",!0),p(this,"alignToDirection",!1),p(this,"angle",0),p(this,"arc",360),p(this,"arcSpread"),p(this,"arcSpeedMultiplier"),p(this,"arcMode"),p(this,"boxThickness"),p(this,"position"),p(this,"rotation"),p(this,"_rotation",new ri),p(this,"scale"),p(this,"radius"),p(this,"radiusThickness"),p(this,"sphericalDirectionAmount"),p(this,"randomDirectionAmount"),p(this,"randomPositionAmount"),p(this,"meshShapeType"),p(this,"meshRenderer"),p(this,"_meshObj"),p(this,"_meshGeometry"),p(this,"system"),p(this,"_space"),p(this,"_worldSpaceMatrix",new he),p(this,"_worldSpaceMatrixInverse",new he),p(this,"_vector",new S(0,0,0)),p(this,"_temp",new S(0,0,0)),p(this,"_triangle",new Xr),p(this,"_dir",new S),p(this,"_loopTime",0),p(this,"_loopDirection",1),kE&&console.log(this)}get type(){return OE[this.shapeType]}initialize(n){this.onInitialize(n),n.position.copy(this._vector)}toJSON(){return this}clone(){return new nx}setMesh(n){this.meshRenderer=n,n?(this._meshObj=n.sharedMeshes[Math.floor(Math.random()*n.sharedMeshes.length)],this._meshGeometry=this._meshObj.geometry):(this._meshObj=void 0,this._meshGeometry=void 0)}update(n,e,i,r){this.system=n,this._space=i,i===1&&(this._worldSpaceMatrix.copy(r.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(n){const e=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return e&&(this._rotation.x=tt.toRadians(this.rotation.x),this._rotation.y=tt.toRadians(this.rotation.y),this._rotation.z=tt.toRadians(this.rotation.z),this._rotation.order="ZYX",n.applyEuler(this._rotation)),e}onInitialize(n){this._vector.set(0,0,0),n.mesh=void 0,n.mesh_geometry=void 0;const e=this._temp.copy(this.position),i=this._space===1;i&&e.applyQuaternion(this.system.worldQuaternion);let r=this.radius;if(i&&(r*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case 5:kE&&yt.DrawWireBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(e);break;case 4:this.randomConePoint(this.position,this.angle,r,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case 0:this.randomSpherePoint(this.position,r,this.radiusThickness,this.arc,this._vector);break;case 10:this.randomCirclePoint(this.position,r,this.radiusThickness,this.arc,this._vector);break;case 13:const s=this.meshRenderer;s?.destroyed==!1&&this.setMesh(s);const o=n.mesh=this._meshObj,a=n.mesh_geometry=this._meshGeometry;if(o&&a)switch(this.meshShapeType){case 0:{const l=a.getAttribute("position"),c=Math.floor(Math.random()*l.count);this._vector.fromBufferAttribute(l,c),this._vector.applyMatrix4(o.matrixWorld),n.mesh_normal=c}break;case 1:break;case 2:{const l=a.index;if(l){let c=Math.random(),h=Math.random();c+h>1&&(c=1-c,h=1-h);const u=Math.floor(Math.random()*(l.count/3));let d=u*3,f=u*3+1,m=u*3+2;d=l.getX(d),f=l.getX(f),m=l.getX(m);const g=a.getAttribute("position");this._triangle.a.fromBufferAttribute(g,d),this._triangle.b.fromBufferAttribute(g,f),this._triangle.c.fromBufferAttribute(g,m),this._vector.set(0,0,0).addScaledVector(this._triangle.a,c).addScaledVector(this._triangle.b,h).addScaledVector(this._triangle.c,1-(c+h)),this._vector.applyMatrix4(o.matrixWorld),n.mesh_normal=u}}break}break;default:this._vector.set(0,0,0),it()&&!globalThis.__particlesystem_shapetype_unsupported&&(console.warn("ParticleSystem ShapeType is not supported:",OE[this.shapeType]),globalThis.__particlesystem_shapetype_unsupported=!0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),i&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),kE&&yt.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(n,e){var i;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case 5:this._dir.set(0,0,1);break;case 4:this._dir.set(0,0,1);break;case 10:case 0:const r=e.x,s=e.y,o=e.z;this._dir.set(r,s,o),(i=this.system)!=null&&i.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;case 13:const a=n.mesh,l=n.mesh_geometry;if(a&&l)switch(this.meshShapeType){case 0:{const c=l.getAttribute("normal"),h=n.mesh_normal;this._dir.fromBufferAttribute(c,h)}break;case 1:break;case 2:{const c=l.index;if(c){const h=n.mesh_normal,u=c.getX(h*3),d=c.getX(h*3+1),f=c.getX(h*3+2),m=l.getAttribute("position"),g=bt(),v=bt(),y=bt();g.fromBufferAttribute(m,u),v.fromBufferAttribute(m,d),y.fromBufferAttribute(m,f),g.sub(v),y.sub(v),g.cross(y),this._dir.copy(g).multiplyScalar(-1);const A=Ri(a);this._dir.applyQuaternion(A)}}break}break;default:this._dir.set(0,0,1);break}return this._space===1&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),kE&&(yt.DrawSphere(e,.01,8925952,.5,!0),yt.DrawDirection(e,this._dir,8925952,.5,!0)),this._dir}randomizePosition(n,e){if(e<=0)return;const i=nx._tempVec;i.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),i.x*=e*this.scale.x,i.y*=e*this.scale.y,i.z*=e*this.scale.z,n.add(i)}randomizeDirection(n,e){if(e===0)return;const i=nx._randomQuat,r=nx._tempVec;r.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),i.setFromAxisAngle(r,e*Math.random()*Math.PI),n.applyQuaternion(i)}spherizeDirection(n,e){if(e===0)return;const i=Math.random()*Math.PI*2,r=Math.acos(1-Math.random()*2),s=Math.sin(r)*Math.cos(i),o=Math.sin(r)*Math.sin(i),a=Math.cos(r),l=new S(s,o,a);n.lerp(l,e)}randomSpherePoint(n,e,i,r,s){const o=Math.random(),a=Math.random(),l=2*Math.PI*o*(r/360),c=Math.acos(2*a-1),h=tt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*e,u=n.x+this.scale.x*(-h*Math.sin(c)*Math.cos(l)),d=n.y+this.scale.y*(h*Math.sin(c)*Math.sin(l)),f=n.z+this.scale.z*(h*Math.cos(c));s.x=u,s.y=d,s.z=f}randomCirclePoint(n,e,i,r,s){const o=Math.random(),a=2*Math.PI*o*(r/360),l=tt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*e,c=n.x+this.scale.x*l*Math.cos(a),h=n.y+this.scale.y*l*Math.sin(a),u=n.z;s.x=c,s.y=h,s.z=u}randomConePoint(n,e,i,r,s,o,a){let l=0,c=0;switch(o){case 0:l=Math.random(),c=Math.random();break;case 2:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case 1:l=.5,c=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let h=2*Math.PI*l*(s/360);switch(o){case 2:case 1:h+=Math.PI+.5,h+=this._loopTime*Math.PI*2,h%=tt.toRadians(s);break}const u=Math.acos(2*c-1),d=tt.lerp(1,1-Math.pow(1-Math.random(),Math.PI),r)*i,f=n.x+-d*Math.sin(u)*Math.cos(h),m=n.y+d*Math.sin(u)*Math.sin(h),g=n.z;a.x=f*this.scale.x,a.y=m*this.scale.y,a.z=g*this.scale.z}},p(LE,"_randomQuat",new Ce),p(LE,"_tempVec",new S),LE);let Cn=nx;re([C()],Cn.prototype,"shapeType",2),re([C()],Cn.prototype,"enabled",2),re([C()],Cn.prototype,"alignToDirection",2),re([C()],Cn.prototype,"angle",2),re([C()],Cn.prototype,"arc",2),re([C()],Cn.prototype,"arcSpread",2),re([C()],Cn.prototype,"arcSpeedMultiplier",2),re([C()],Cn.prototype,"arcMode",2),re([C(S)],Cn.prototype,"boxThickness",2),re([C(S)],Cn.prototype,"position",2),re([C(S)],Cn.prototype,"rotation",2),re([C(S)],Cn.prototype,"scale",2),re([C()],Cn.prototype,"radius",2),re([C()],Cn.prototype,"radiusThickness",2),re([C()],Cn.prototype,"sphericalDirectionAmount",2),re([C()],Cn.prototype,"randomDirectionAmount",2),re([C()],Cn.prototype,"randomPositionAmount",2),re([C()],Cn.prototype,"meshShapeType",2),re([C($b)],Cn.prototype,"meshRenderer",2);class Mi{constructor(){p(this,"damping"),p(this,"enabled"),p(this,"frequency"),p(this,"octaveCount"),p(this,"octaveMultiplier"),p(this,"octaveScale"),p(this,"positionAmount"),p(this,"quality"),p(this,"remap"),p(this,"remapEnabled"),p(this,"remapMultiplier"),p(this,"remapX"),p(this,"remapXMultiplier"),p(this,"remapY"),p(this,"remapYMultiplier"),p(this,"remapZ"),p(this,"remapZMultiplier"),p(this,"scrollSpeedMultiplier"),p(this,"separateAxes"),p(this,"strengthMultiplier"),p(this,"strengthX"),p(this,"strengthXMultiplier"),p(this,"strengthY"),p(this,"strengthYMultiplier"),p(this,"strengthZ"),p(this,"strengthZMultiplier"),p(this,"_noise"),p(this,"_time",0),p(this,"_temp",new S)}update(e){this._time+=e.time.deltaTime*this.scrollSpeedMultiplier}apply(e,i,r,s,o,a){if(!this.enabled)return;this._noise||(this._noise=vye(()=>0));const l=this._temp.set(i.x,i.y,i.z).multiplyScalar(this.frequency),c=this._noise(l.x,l.y,l.z,this._time),h=this._noise(l.x,l.y,l.z,this._time+1e3*this.frequency),u=this._noise(l.x,l.y,l.z,this._time+2e3*this.frequency);this._temp.set(c,h,u).normalize();const d=o/a;let f=this.positionAmount.evaluate(d);this.separateAxes?(this._temp.x*=f*this.strengthXMultiplier,this._temp.y*=f*this.strengthYMultiplier,this._temp.z*=f*this.strengthZMultiplier):(this.strengthX&&(f*=this.strengthX.evaluate(d)*1.5),this._temp.multiplyScalar(f)),r.x+=this._temp.x,r.y+=this._temp.y,r.z+=this._temp.z}}re([C()],Mi.prototype,"damping",2),re([C()],Mi.prototype,"enabled",2),re([C()],Mi.prototype,"frequency",2),re([C()],Mi.prototype,"octaveCount",2),re([C()],Mi.prototype,"octaveMultiplier",2),re([C()],Mi.prototype,"octaveScale",2),re([C(ft)],Mi.prototype,"positionAmount",2),re([C()],Mi.prototype,"quality",2),re([C(ft)],Mi.prototype,"remap",2),re([C()],Mi.prototype,"remapEnabled",2),re([C()],Mi.prototype,"remapMultiplier",2),re([C(ft)],Mi.prototype,"remapX",2),re([C()],Mi.prototype,"remapXMultiplier",2),re([C(ft)],Mi.prototype,"remapY",2),re([C()],Mi.prototype,"remapYMultiplier",2),re([C(ft)],Mi.prototype,"remapZ",2),re([C()],Mi.prototype,"remapZMultiplier",2),re([C()],Mi.prototype,"scrollSpeedMultiplier",2),re([C()],Mi.prototype,"separateAxes",2),re([C()],Mi.prototype,"strengthMultiplier",2),re([C(ft)],Mi.prototype,"strengthX",2),re([C()],Mi.prototype,"strengthXMultiplier",2),re([C(ft)],Mi.prototype,"strengthY",2),re([C()],Mi.prototype,"strengthYMultiplier",2),re([C(ft)],Mi.prototype,"strengthZ",2),re([C()],Mi.prototype,"strengthZMultiplier",2);class vn{constructor(){p(this,"enabled"),p(this,"attachRibbonToTransform",!1),p(this,"colorOverLifetime"),p(this,"colorOverTrail"),p(this,"dieWithParticles",!0),p(this,"inheritParticleColor",!0),p(this,"lifetime"),p(this,"lifetimeMultiplier"),p(this,"minVertexDistance",.2),p(this,"mode",0),p(this,"ratio",1),p(this,"ribbonCount",1),p(this,"shadowBias",0),p(this,"sizeAffectsLifetime",!1),p(this,"sizeAffectsWidth",!1),p(this,"splitSubEmitterRibbons",!1),p(this,"textureMode",0),p(this,"widthOverTrail"),p(this,"widthOverTrailMultiplier"),p(this,"worldSpace",!1)}getWidth(e,i,r,s){const o=this.widthOverTrail.evaluate(r,s);return e*=o,e}getColor(e,i,r){const s=this.colorOverTrail.evaluate(r),o=this.colorOverLifetime.evaluate(i);e.x*=s.r*o.r,e.y*=s.g*o.g,e.z*=s.b*o.b,e.w*=s.alpha*o.alpha}}re([C()],vn.prototype,"enabled",2),re([C()],vn.prototype,"attachRibbonToTransform",2),re([C(Po)],vn.prototype,"colorOverLifetime",2),re([C(Po)],vn.prototype,"colorOverTrail",2),re([C()],vn.prototype,"dieWithParticles",2),re([C()],vn.prototype,"inheritParticleColor",2),re([C(ft)],vn.prototype,"lifetime",2),re([C()],vn.prototype,"lifetimeMultiplier",2),re([C()],vn.prototype,"minVertexDistance",2),re([C()],vn.prototype,"mode",2),re([C()],vn.prototype,"ratio",2),re([C()],vn.prototype,"ribbonCount",2),re([C()],vn.prototype,"shadowBias",2),re([C()],vn.prototype,"sizeAffectsLifetime",2),re([C()],vn.prototype,"sizeAffectsWidth",2),re([C()],vn.prototype,"splitSubEmitterRibbons",2),re([C()],vn.prototype,"textureMode",2),re([C(ft)],vn.prototype,"widthOverTrail",2),re([C()],vn.prototype,"widthOverTrailMultiplier",2),re([C()],vn.prototype,"worldSpace",2);class En{constructor(){p(this,"enabled"),p(this,"space",0),p(this,"orbitalX"),p(this,"orbitalY"),p(this,"orbitalZ"),p(this,"orbitalXMultiplier"),p(this,"orbitalYMultiplier"),p(this,"orbitalZMultiplier"),p(this,"orbitalOffsetX"),p(this,"orbitalOffsetY"),p(this,"orbitalOffsetZ"),p(this,"speedModifier"),p(this,"speedModifierMultiplier"),p(this,"x"),p(this,"xMultiplier"),p(this,"y"),p(this,"yMultiplier"),p(this,"z"),p(this,"zMultiplier"),p(this,"_system"),p(this,"_temp",new S),p(this,"_temp2",new S),p(this,"_temp3",new S),p(this,"_hasOrbital",!1),p(this,"_index",0),p(this,"_orbitalMatrix",new he)}update(e){this._system=e}init(e){this._index==0&&(e.debug=!0),this._index+=1,e.orbitx=this.orbitalX.evaluate(Math.random()),e.orbity=this.orbitalY.evaluate(Math.random()),e.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=e.orbitx!=0||e.orbity!=0||e.orbitz!=0}apply(e,i,r,s,o,a,l){var c;if(!this.enabled)return;const h=a/l,u=this.speedModifier.evaluate(h)*this.speedModifierMultiplier,d=this.x.evaluate(h),f=this.y.evaluate(h),m=this.z.evaluate(h);if(this._temp.set(-d,f,m),this._system&&this._system.main.simulationSpace===1&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((c=this._system)==null?void 0:c.worldPos)){const g=this._temp2.set(r.x,r.y,r.z),v=this.orbitalXMultiplier,y=this.orbitalYMultiplier,A=this.orbitalZMultiplier,b=u*Math.PI*2*10,x=Math.cos(b*v),_=Math.sin(b*v),w=Math.cos(b*y),T=Math.sin(b*y),M=Math.cos(b*A),R=Math.sin(b*A),B=g.x*(w*M)+g.y*(w*R)+g.z*-T,E=g.x*(_*T*M-x*R)+g.y*(_*T*R+x*M)+g.z*(_*w),P=g.x*(x*T*M+_*R)+g.y*(x*T*R-_*M)+g.z*(x*w),O=this._temp3.set(g.x-B,g.y-E,g.z-P);O.normalize(),O.multiplyScalar(.2/o*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),s.x+=O.x,s.y+=O.y,s.z+=O.z}s.x+=this._temp.x,s.y+=this._temp.y,s.z+=this._temp.z,s.x*=u,s.y*=u,s.z*=u}}re([C()],En.prototype,"enabled",2),re([C()],En.prototype,"space",2),re([C(ft)],En.prototype,"orbitalX",2),re([C(ft)],En.prototype,"orbitalY",2),re([C(ft)],En.prototype,"orbitalZ",2),re([C()],En.prototype,"orbitalXMultiplier",2),re([C()],En.prototype,"orbitalYMultiplier",2),re([C()],En.prototype,"orbitalZMultiplier",2),re([C()],En.prototype,"orbitalOffsetX",2),re([C()],En.prototype,"orbitalOffsetY",2),re([C()],En.prototype,"orbitalOffsetZ",2),re([C(ft)],En.prototype,"speedModifier",2),re([C()],En.prototype,"speedModifierMultiplier",2),re([C(ft)],En.prototype,"x",2),re([C()],En.prototype,"xMultiplier",2),re([C(ft)],En.prototype,"y",2),re([C()],En.prototype,"yMultiplier",2),re([C(ft)],En.prototype,"z",2),re([C()],En.prototype,"zMultiplier",2);class us{constructor(){p(this,"animation"),p(this,"enabled"),p(this,"cycleCount"),p(this,"frameOverTime"),p(this,"frameOverTimeMultiplier"),p(this,"numTilesX"),p(this,"numTilesY"),p(this,"startFrame"),p(this,"startFrameMultiplier"),p(this,"rowMode"),p(this,"rowIndex"),p(this,"spriteCount"),p(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===0)switch(this.frameOverTime.mode){case 0:case 3:case 2:case 1:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(e){if(!this.sampleOnceAtStart())return this.getIndex(e)}getIndex(e){const i=this.numTilesX*this.numTilesY;e=e*this.cycleCount;let r=this.frameOverTime.evaluate(e%1);return r*=this.frameOverTimeMultiplier,r*=i,r=r%i,r=Math.floor(r),r}}re([C()],us.prototype,"animation",2),re([C()],us.prototype,"enabled",2),re([C()],us.prototype,"cycleCount",2),re([C(ft)],us.prototype,"frameOverTime",2),re([C()],us.prototype,"frameOverTimeMultiplier",2),re([C()],us.prototype,"numTilesX",2),re([C()],us.prototype,"numTilesY",2),re([C(ft)],us.prototype,"startFrame",2),re([C()],us.prototype,"startFrameMultiplier",2),re([C()],us.prototype,"rowMode",2),re([C()],us.prototype,"rowIndex",2),re([C()],us.prototype,"spriteCount",2),re([C()],us.prototype,"timeMode",2);class Wa{constructor(){p(this,"enabled"),p(this,"separateAxes"),p(this,"x"),p(this,"xMultiplier"),p(this,"y"),p(this,"yMultiplier"),p(this,"z"),p(this,"zMultiplier")}evaluate(e,i){return this.enabled?this.separateAxes?0:this.z.evaluate(e,i)*-1:0}}re([C()],Wa.prototype,"enabled",2),re([C()],Wa.prototype,"separateAxes",2),re([C(ft)],Wa.prototype,"x",2),re([C()],Wa.prototype,"xMultiplier",2),re([C(ft)],Wa.prototype,"y",2),re([C()],Wa.prototype,"yMultiplier",2),re([C(ft)],Wa.prototype,"z",2),re([C()],Wa.prototype,"zMultiplier",2);class ca{constructor(){p(this,"enabled"),p(this,"range"),p(this,"separateAxes"),p(this,"x"),p(this,"xMultiplier"),p(this,"y"),p(this,"yMultiplier"),p(this,"z"),p(this,"zMultiplier")}evaluate(e,i){if(!this.enabled)return 0;if(!this.separateAxes){const r=tt.lerp(this.range.x,this.range.y,i);return this.z.evaluate(r)*-1}return 0}}re([C()],ca.prototype,"enabled",2),re([C()],ca.prototype,"range",2),re([C()],ca.prototype,"separateAxes",2),re([C(ft)],ca.prototype,"x",2),re([C()],ca.prototype,"xMultiplier",2),re([C(ft)],ca.prototype,"y",2),re([C()],ca.prototype,"yMultiplier",2),re([C(ft)],ca.prototype,"z",2),re([C()],ca.prototype,"zMultiplier",2);class rr{constructor(){p(this,"enabled"),p(this,"dampen"),p(this,"drag"),p(this,"dragMultiplier"),p(this,"limit"),p(this,"limitMultiplier"),p(this,"separateAxes"),p(this,"limitX"),p(this,"limitXMultiplier"),p(this,"limitY"),p(this,"limitYMultiplier"),p(this,"limitZ"),p(this,"limitZMultiplier"),p(this,"multiplyDragByParticleSize",!1),p(this,"multiplyDragByParticleVelocity",!1),p(this,"space"),p(this,"_temp",new S),p(this,"_temp2",new S)}apply(e,i,r,s,o,a,l){if(this.enabled){const c=this.limit.evaluate(o)*this.limitMultiplier;if(i.length()>c){this._temp.copy(i).normalize().multiplyScalar(c);const h=this.dampen*.5;i.x=tt.lerp(i.x,this._temp.x,h),i.y=tt.lerp(i.y,this._temp.y,h),i.z=tt.lerp(i.z,this._temp.z,h),r.x=tt.lerp(r.x,this._temp.x,h),r.y=tt.lerp(r.y,this._temp.y,h),r.z=tt.lerp(r.z,this._temp.z,h)}}}}re([C()],rr.prototype,"enabled",2),re([C()],rr.prototype,"dampen",2),re([C(ft)],rr.prototype,"drag",2),re([C()],rr.prototype,"dragMultiplier",2),re([C(ft)],rr.prototype,"limit",2),re([C()],rr.prototype,"limitMultiplier",2),re([C()],rr.prototype,"separateAxes",2),re([C(ft)],rr.prototype,"limitX",2),re([C()],rr.prototype,"limitXMultiplier",2),re([C(ft)],rr.prototype,"limitY",2),re([C()],rr.prototype,"limitYMultiplier",2),re([C(ft)],rr.prototype,"limitZ",2),re([C()],rr.prototype,"limitZMultiplier",2),re([C()],rr.prototype,"multiplyDragByParticleSize",2),re([C()],rr.prototype,"multiplyDragByParticleVelocity",2),re([C()],rr.prototype,"space",2);const G9=class{constructor(){p(this,"enabled"),p(this,"curve"),p(this,"curveMultiplier"),p(this,"mode"),p(this,"system"),p(this,"_temp",new S),p(this,"_firstUpdate",!0),p(this,"_frames",0)}clone(){var n;const e=new G9;return e.enabled=this.enabled,e.curve=(n=this.curve)==null?void 0:n.clone(),e.curveMultiplier=this.curveMultiplier,e.mode=this.mode,e}get _lastWorldPosition(){return this.system._iv_lastWorldPosition||(this.system._iv_lastWorldPosition=new S),this.system._iv_lastWorldPosition}get _velocity(){return this.system._iv_velocity||(this.system._iv_velocity=new S),this.system._iv_velocity}awake(n){this.system=n,this.reset()}reset(){this._firstUpdate=!0}update(n){this.enabled&&this.system.worldspace!==!1&&(this._firstUpdate?(this._firstUpdate=!1,this._velocity.set(0,0,0),this._lastWorldPosition.copy(this.system.worldPos)):this._lastWorldPosition&&(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)))}applyInitial(n){if(this.enabled&&this.system.worldspace!==!1&&this.mode===0){const e=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(e),n.add(this._temp)}}applyCurrent(n,e,i){if(this.enabled&&this.system&&this.system.worldspace!==!1&&this.mode===1){const r=this.curve.evaluate(e,i);this._temp.copy(this._velocity).multiplyScalar(r),n.add(this._temp)}}};let Hd=G9;re([C()],Hd.prototype,"enabled",2),re([C(ft)],Hd.prototype,"curve",2),re([C()],Hd.prototype,"curveMultiplier",2),re([C()],Hd.prototype,"mode",2);class fo{constructor(){p(this,"enabled"),p(this,"range"),p(this,"separateAxes"),p(this,"size"),p(this,"sizeMultiplier"),p(this,"x"),p(this,"xMultiplier"),p(this,"y"),p(this,"yMultiplier"),p(this,"z"),p(this,"zMultiplier")}evaluate(e,i,r,s){const o=e.length(),a=tt.remap(o,this.range.x,this.range.y,0,1),l=this.size.evaluate(a,r);return s*l}}re([C()],fo.prototype,"enabled",2),re([C(J)],fo.prototype,"range",2),re([C()],fo.prototype,"separateAxes",2),re([C(ft)],fo.prototype,"size",2),re([C()],fo.prototype,"sizeMultiplier",2),re([C(ft)],fo.prototype,"x",2),re([C()],fo.prototype,"xMultiplier",2),re([C(ft)],fo.prototype,"y",2),re([C()],fo.prototype,"yMultiplier",2),re([C(ft)],fo.prototype,"z",2),re([C()],fo.prototype,"zMultiplier",2);class Jf{constructor(){p(this,"enabled"),p(this,"range"),p(this,"color")}evaluate(e,i,r){const s=e.length(),o=tt.remap(s,this.range.x,this.range.y,0,1),a=this.color.evaluate(o,i);r.x*=a.r,r.y*=a.g,r.z*=a.b,r.w*=a.alpha}}re([C()],Jf.prototype,"enabled",2),re([C(J)],Jf.prototype,"range",2),re([C(Po)],Jf.prototype,"color",2);const Xye={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},qye={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var Yye=Object.defineProperty,Jye=Object.getOwnPropertyDescriptor,J0=(n,e,i,r)=>{for(var s=r>1?void 0:r?Jye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Yye(e,i,s),s};const UE=te("debugcontactshadows");KO(n=>{const e=n.domElement.getAttribute("contactshadows");e!=null&&e!="0"&&e!="false"&&Bc.auto(n)});var tL;const H9=(tL=class extends Be{constructor(){super(...arguments),p(this,"autoFit",!1),p(this,"darkness",.5),p(this,"opacity",.5),p(this,"blur",4),p(this,"occludeBelowGround",!1),p(this,"backfaceShadows",!0),p(this,"minSize"),p(this,"shadowsRoot",new ve),p(this,"shadowCamera"),p(this,"shadowGroup",new Cr),p(this,"renderTarget"),p(this,"renderTargetBlur"),p(this,"plane"),p(this,"occluderMesh"),p(this,"blurPlane"),p(this,"depthMaterial"),p(this,"horizontalBlurMaterial"),p(this,"verticalBlurMaterial"),p(this,"textureSize",512)}static auto(n){if(n||(n=Ot.Current),!n)throw new Error("No context provided and no current context set.");let e=this._instances.get(n);if(!e||e.destroyed){const i=new ve;e=Zo(i,H9,{autoFit:!1,occludeBelowGround:!1}),this._instances.set(n,e)}return n.scene.add(e.gameObject),e.fitShadows(),e}fitShadows(){UE&&console.log("Fitting shadows to scene"),eP(this.gameObject,!1);const n=pl(this.context.scene.children,[this.gameObject]),e=Math.max(1,this.blur/32),i=n.max.x-n.min.x,r=n.max.z-n.min.z;n.expandByVector(new S(e*i,0,e*r)),UE&&yt.DrawWireBox3(n,16776960,60),this.gameObject.parent&&n.applyMatrix4(this.gameObject.parent.matrixWorld.clone().invert());const s=n.min,o=Math.max(1e-5,(n.max.y-s.y)*.002);n.max.y+=o,this.shadowsRoot.position.set((s.x+n.max.x)/2,s.y-o,(s.z+n.max.z)/2),this.shadowsRoot.scale.set(n.max.x-s.x,n.max.y-s.y,n.max.z-s.z),this.applyMinSize(),this.shadowsRoot.matrixWorldNeedsUpdate=!0}awake(){eP(this.gameObject,!1)}start(){UE&&console.log("Create ContactShadows on "+this.gameObject.name,this),this.gameObject.add(this.shadowsRoot),this.shadowsRoot.add(this.shadowGroup),this.renderTarget=new qt(this.textureSize,this.textureSize),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new qt(this.textureSize,this.textureSize),this.renderTargetBlur.texture.generateMipmaps=!1;const n=new cr(1,1).rotateX(Math.PI/2);this.gameObject instanceof pe&&(console.warn("ContactShadows can not be added to a Mesh. Please add it to a Group or an empty Object"),ld(this.gameObject,!1));const e=new Jt({map:this.renderTarget.texture,opacity:this.opacity,color:0,transparent:!0,depthWrite:!1,side:Fn});this.plane=new pe(n,e),this.plane.scale.y=-1,this.plane.layers.set(2),this.shadowsRoot.add(this.plane),this.plane&&(this.plane.renderOrder=1),this.occluderMesh=new pe(this.plane.geometry,new Jt({depthWrite:!0,stencilWrite:!0,colorWrite:!1,side:an})).translateY(-1e-4),this.occluderMesh.renderOrder=-100,this.occluderMesh.layers.set(2),this.shadowsRoot.add(this.occluderMesh),this.blurPlane=new pe(n),this.blurPlane.visible=!1,this.shadowGroup.add(this.blurPlane);const i=0,r=1;this.shadowCamera=new Yl(-1/2,1/2,1/2,-1/2,i,r),this.shadowCamera.layers.enableAll(),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.depthMaterial=new vy,this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.blending=XT,this.depthMaterial.blendEquation=A_,this.depthMaterial.onBeforeCompile=s=>{this.depthMaterial&&(s.uniforms.darkness=this.depthMaterial.userData.darkness,s.fragmentShader=`
                uniform float darkness;
                ${s.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 ), ( 1.0 - fragCoordZ ) * darkness * opacity * (gl_FrontFacing ? 1.0 : 0.66) );")}
            `)},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new Bt(Xye),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new Bt(qye),this.verticalBlurMaterial.depthTest=!1,this.shadowGroup.visible=!1,this.autoFit?this.fitShadows():this.applyMinSize()}onDestroy(){var n,e,i,r,s,o,a,l;(n=this.renderTarget)==null||n.dispose(),(e=this.renderTargetBlur)==null||e.dispose(),(i=this.depthMaterial)==null||i.dispose(),(r=this.horizontalBlurMaterial)==null||r.dispose(),(s=this.verticalBlurMaterial)==null||s.dispose(),(o=this.blurPlane)==null||o.geometry.dispose(),(a=this.plane)==null||a.geometry.dispose(),(l=this.occluderMesh)==null||l.geometry.dispose()}onBeforeRender(n){if(!this.renderTarget||!this.renderTargetBlur||!this.depthMaterial||!this.shadowCamera||!this.blurPlane||!this.shadowGroup||!this.plane||!this.horizontalBlurMaterial||!this.verticalBlurMaterial){UE&&console.error("ContactShadows: not initialized yet");return}const e=this.context.scene,i=this.context.renderer,r=i.getRenderTarget();this.shadowGroup.visible=!0,this.occluderMesh&&(this.occluderMesh.visible=!1);const s=this.plane.visible;this.plane.visible=!1,this.gameObject instanceof pe&&ld(this.gameObject,!1);const o=e.background;e.background=null,e.overrideMaterial=this.depthMaterial,this.backfaceShadows?this.depthMaterial.side=yi:this.depthMaterial.side=Fn;const a=i.getClearAlpha();i.setClearAlpha(0);const l=i.xr.enabled;i.xr.enabled=!1;const c=this.context.scene.matrixWorldAutoUpdate;this.context.scene.matrixWorldAutoUpdate=!1;const h=i.renderLists.get(e,0),u=h.transparent;V9.length=0,h.transparent=V9,iL.length=0;for(const f of h.opaque){if(!f.object.visible)continue;const m=f.material;let g=f.material.colorWrite==!1||m.wireframe===!0||Pj(f.object)===!1;!g&&f.material.linewidth!=null&&(g=!0),g&&(iL.push(f.object),f.object["needle:visible"]=f.object.visible,f.object.visible=!1)}i.setRenderTarget(this.renderTarget),i.clear(),i.render(e,this.shadowCamera),h.transparent=u;for(const f of iL)f["needle:visible"]!=null&&(f.visible=f["needle:visible"]);e.overrideMaterial=null;const d=Math.max(this.blur,.05);this.blurShadow(d*2),this.blurShadow(d*.5),this.shadowGroup.visible=!1,this.occluderMesh&&(this.occluderMesh.visible=this.occludeBelowGround),this.plane.visible=s,i.setRenderTarget(r),i.setClearAlpha(a),e.background=o,i.xr.enabled=l,this.context.scene.matrixWorldAutoUpdate=c}blurShadow(n){if(!this.blurPlane||!this.shadowCamera||!this.renderTarget||!this.renderTargetBlur||!this.horizontalBlurMaterial||!this.verticalBlurMaterial)return;this.blurPlane.visible=!0;const e=this.shadowsRoot.worldScale,i=(e.x+e.z)/2,r=e.z/i,s=e.x/i;this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=n*1/this.textureSize*r;const o=this.context.renderer,a=o.getRenderTarget();o.setRenderTarget(this.renderTargetBlur),o.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=n*1/this.textureSize*s,o.setRenderTarget(this.renderTarget),o.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1,o.setRenderTarget(a)}applyMinSize(){this.minSize&&this.shadowsRoot.scale.set(Math.max(this.minSize.x||0,this.shadowsRoot.scale.x),Math.max(this.minSize.y||0,this.shadowsRoot.scale.y),Math.max(this.minSize.z||0,this.shadowsRoot.scale.z))}},p(tL,"_instances",new Map),tL);let Bc=H9;J0([C()],Bc.prototype,"autoFit",2),J0([C()],Bc.prototype,"darkness",2),J0([C()],Bc.prototype,"opacity",2),J0([C()],Bc.prototype,"blur",2),J0([C()],Bc.prototype,"occludeBelowGround",2),J0([C()],Bc.prototype,"backfaceShadows",2);const V9=[],iL=new Array,Q9=class{constructor(){p(this,"_quicklookButton"),p(this,"_arButton"),p(this,"_vrButton"),p(this,"_sendToQuestButton")}static create(){return new Q9}static getOrCreate(){return this._instance||(this._instance=this.create()),this._instance}get isSecureConnection(){return window.location.protocol==="https:"}get quicklookButton(){return this._quicklookButton}get arButton(){return this._arButton}get vrButton(){return this._vrButton}get sendToQuestButton(){return this._sendToQuestButton}get qrButton(){return Dh.getOrCreate().createQRCode()}createQuicklookButton(){if(this._quicklookButton)return this._quicklookButton;const n=document.createElement("button");this._quicklookButton=n,n.dataset.needle="quicklook-button",n.innerText="Open in Quicklook",n.prepend(is("view_in_ar"));let e=!1,i=null;return n.addEventListener("click",()=>{i=aC(Dn),i||(e=!0,i=new Dn),e&&(i.objectToExport=Ot.Current.scene),i?(n.classList.add("this-mode-is-requested"),i.exportAndOpen().then(()=>{n.classList.remove("this-mode-is-requested")}).catch(r=>{n.classList.remove("this-mode-is-requested"),console.error(r)})):console.warn("No USDZExporter component found in the scene")}),this.hideElementDuringXRSession(n),n}createARButton(n){var e;if(this._arButton)return this._arButton;const i="immersive-ar",r=document.createElement("button");return this._arButton=r,r.classList.add("webxr-button"),r.dataset.needle="webxr-ar-button",r.innerText="Enter AR",r.prepend(is("view_in_ar")),r.title="Click to start an AR session",r.addEventListener("click",()=>Et.start(i,n)),this.updateSessionSupported(r,i),this.listenToXRSessionState(r,i),this.hideElementDuringXRSession(r),this.isSecureConnection||(r.disabled=!0,r.title="WebXR requires a secure connection (HTTPS)"),qp()||(e=navigator.xr)==null||e.addEventListener("devicechange",()=>this.updateSessionSupported(r,i)),r}createVRButton(n){var e;if(this._vrButton)return this._vrButton;const i="immersive-vr",r=document.createElement("button");return this._vrButton=r,r.classList.add("webxr-button"),r.dataset.needle="webxr-vr-button",r.innerText="Enter VR",r.prepend(is("panorama_photosphere")),r.title="Click to start a VR session",r.addEventListener("click",()=>Et.start(i,n)),this.updateSessionSupported(r,i),this.listenToXRSessionState(r,i),this.hideElementDuringXRSession(r),this.isSecureConnection||(r.disabled=!0,r.title="WebXR requires a secure connection (HTTPS)"),qp()||(e=navigator.xr)==null||e.addEventListener("devicechange",()=>this.updateSessionSupported(r,i)),r}createSendToQuestButton(){var n;if(this._sendToQuestButton)return this._sendToQuestButton;const e="https://oculus.com/open_url/?url=",i=document.createElement("button");return this._sendToQuestButton=i,i.dataset.needle="webxr-sendtoquest-button",i.innerText="Open on Quest",i.prepend(is("share_windows")),i.title="Click to send this page to the Oculus Browser on your Quest",i.addEventListener("click",()=>{const r=encodeURIComponent(window.location.href),s=e+r;window.open(s)==null&&dn("This page doesn't allow popups. Please paste "+s+" into your browser.")}),this.listenToXRSessionState(i),this.hideElementDuringXRSession(i),qp()||(n=navigator.xr)==null||n.addEventListener("devicechange",()=>{var r;(r=navigator.xr)!=null&&r.isSessionSupported("immersive-vr")?i.style.display="none":i.style.display=""}),i}createQRCode(){return Dh.getOrCreate().createQRCode()}updateSessionSupported(n,e){if(!("xr"in navigator)){n.style.display="none";return}Et.isSessionSupported(e).then(i=>{n.style.display=i?"":"none",it()&&!i&&console.log('[WebXR] "'+e+'" is not supported on this device \u2013 make sure your server runs using HTTPS and you have a device connected that supports '+e)})}hideElementDuringXRSession(n){SS(e=>{n["previous-display"]=n.style.display,n.style.display="none"}),UB(e=>{n["previous-display"]!=null&&(n.style.display=n["previous-display"])})}listenToXRSessionState(n,e){e&&(Et.onSessionRequestStart(i=>{i.mode===e?n.classList.add("this-mode-is-requested"):(n["was-disabled"]=n.disabled,n.disabled=!0,n.classList.add("other-mode-is-requested"))}),Et.onSessionRequestEnd(i=>{n.classList.remove("this-mode-is-requested"),n.classList.remove("other-mode-is-requested"),n.disabled=n["was-disabled"]}))}};let Kf=Q9;p(Kf,"_instance");var Kye=Object.defineProperty,Zye=Object.getOwnPropertyDescriptor,Nr=(n,e,i,r)=>{for(var s=r>1?void 0:r?Zye(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Kye(e,i,s),s};const FE=te("debugspriterenderer"),$ye=te("wireframe"),nL=class{static getOrCreateGeometry(n){if(n.__cached_geometry)return n.__cached_geometry;if(n.guid&&nL.cache[n.guid])return FE&&console.log("Take cached geometry for sprite",n.guid),nL.cache[n.guid];const e=new dt;n.__cached_geometry=e;const i=new Float32Array(n.triangles.length*3),r=new Float32Array(n.triangles.length*2);for(let s=0;s<n.triangles.length;s+=1){const o=n.triangles[s];i[s*3]=-n.vertices[o].x,i[s*3+1]=n.vertices[o].y,i[s*3+2]=0;const a=n.uv[o];r[s*2]=a.x,r[s*2+1]=1-a.y}return e.setAttribute("position",new Ye(i,3)),e.setAttribute("uv",new Ye(r,2)),n.guid&&(this.cache[n.guid]=e),FE&&console.log("Built sprite geometry",n,e),e}};let rx=nL;p(rx,"cache",{});class eAe{constructor(){p(this,"x"),p(this,"y")}}class Zh{constructor(){p(this,"guid"),p(this,"texture"),p(this,"triangles"),p(this,"uv"),p(this,"vertices"),p(this,"__cached_geometry"),p(this,"_mesh"),p(this,"_material")}get mesh(){return this._mesh||(this._mesh=new pe(rx.getOrCreateGeometry(this),this.material)),this._mesh}get material(){return this._material||(this.texture&&(this.texture.colorSpace=gt,this.texture.minFilter==Rt&&this.texture.magFilter==Rt&&(this.texture.anisotropy=1),this.texture.needsUpdate=!0),this._material=new Jt({map:this.texture,color:16777215,side:yi,transparent:!0})),this._material}getGeometry(){return rx.getOrCreateGeometry(this)}}Nr([C()],Zh.prototype,"guid",2),Nr([C(Gt)],Zh.prototype,"texture",2),Nr([C0()],Zh.prototype,"triangles",2),Nr([C0()],Zh.prototype,"uv",2),Nr([C0()],Zh.prototype,"vertices",2);const rL=Symbol("spriteOwner");class sx{constructor(){p(this,"sprites")}}Nr([C(Zh)],sx.prototype,"sprites",2);class K0{constructor(){p(this,"spriteSheet"),p(this,"index",0)}update(e){if(!this.spriteSheet)return;const i=this.index;if(i<0||i>=this.spriteSheet.sprites.length)return;const r=this.spriteSheet.sprites[i],s=r?.texture;if(s&&(s.colorSpace=gt,s.minFilter==Rt&&s.magFilter==Rt&&(s.anisotropy=1),s.needsUpdate=!0,!r.__hasLoadedProgressive)){r.__hasLoadedProgressive=!0;const o=s;mi.assignTextureLOD(s,0).then(a=>{a instanceof Gt&&(r.texture=a,e?.map===o&&(e.map=a,e.needsUpdate=!0))})}}}Nr([C(sx)],K0.prototype,"spriteSheet",2),Nr([C()],K0.prototype,"index",2);class Bo extends Be{constructor(){super(...arguments),p(this,"drawMode",0),p(this,"size",{x:1,y:1}),p(this,"color"),p(this,"sharedMaterial"),p(this,"transparent",!0),p(this,"cutoutThreshold",0),p(this,"castShadows",!1),p(this,"renderOrder",0),p(this,"toneMapped",!0),p(this,"_spriteSheet"),p(this,"_currentSprite")}get sprite(){return this._spriteSheet}set sprite(e){if(e!==this._spriteSheet)if(typeof e=="number"){const i=Math.floor(e);this.spriteIndex=i;return}else this._spriteSheet=e,this.updateSprite()}set spriteIndex(e){this._spriteSheet&&(this._spriteSheet.index=e,this.updateSprite())}get spriteIndex(){var e;return((e=this._spriteSheet)==null?void 0:e.index)??0}get spriteFrames(){var e,i;return((i=(e=this._spriteSheet)==null?void 0:e.spriteSheet)==null?void 0:i.sprites.length)??0}awake(){this._currentSprite=void 0,FE&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(e=!1){var i,r,s;if(!this.__didAwake&&!e||!((r=(i=this.sprite)==null?void 0:i.spriteSheet)!=null&&r.sprites))return;const o=this.sprite.spriteSheet.sprites[this.spriteIndex];if(!o){FE&&console.warn("Sprite not found",this.spriteIndex,this.sprite.spriteSheet.sprites);return}if(this._currentSprite)this._currentSprite.geometry=rx.getOrCreateGeometry(o),this._currentSprite.material.map=o.texture;else{const a=new Jt({color:16777215,side:yi});if(!a)return;if($ye&&(a.wireframe=!0),this.color&&(a.color||(a.color=new be),a.color.copy(this.color),a.opacity=this.color.alpha),a.transparent=!0,a.toneMapped=this.toneMapped,o.texture&&!a.wireframe){let l=o.texture;l[rL]!==void 0&&l[rL]!==this&&this.spriteFrames>1&&(l=o.texture=l.clone()),l[rL]=this,a.map=l}this.sharedMaterial=a,this._currentSprite=new pe(rx.getOrCreateGeometry(o),a),this._currentSprite.renderOrder=Math.round(this.renderOrder),mi.assignTextureLOD(a,0)}this._currentSprite.parent!==this.gameObject&&(this.drawMode===2&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,(s=this._spriteSheet)==null||s.update(this.sharedMaterial)}}Nr([C()],Bo.prototype,"drawMode",2),Nr([C(eAe)],Bo.prototype,"size",2),Nr([C(ki)],Bo.prototype,"color",2),Nr([C(Ut)],Bo.prototype,"sharedMaterial",2),Nr([C()],Bo.prototype,"transparent",2),Nr([C()],Bo.prototype,"cutoutThreshold",2),Nr([C()],Bo.prototype,"castShadows",2),Nr([C()],Bo.prototype,"renderOrder",2),Nr([C()],Bo.prototype,"toneMapped",2),Nr([C(K0)],Bo.prototype,"sprite",1);const W9=te("debugwebxr"),tAe=new he().makeRotationY(Math.PI);class $h extends Be{constructor(){super(...arguments),p(this,"_arScale",1),p(this,"invertForward",!1),p(this,"customReticle"),p(this,"arTouchTransform",!0),p(this,"autoPlace",!1),p(this,"autoCenter",!1),p(this,"useXRAnchor",!1),p(this,"_isPlacing",!0),p(this,"_startOffset",new he),p(this,"_createdPlacementObject",null),p(this,"_reparentedComponents",[]),p(this,"_placementScene",new Er),p(this,"_reticle",[]),p(this,"_hits",[]),p(this,"_placementStartTime",-1),p(this,"_rigPlacementMatrix"),p(this,"_anchor",null),p(this,"userInput"),p(this,"onPlaceScene",e=>{var i;if(this._isPlacing==!1||e!=null&&e.used)return;let r=this._reticle[0];if(!r){console.warn("No reticle to place...");return}if(!r.visible&&!this.autoPlace){console.warn("Reticle is not visible (can not place)");return}if((i=Et.active)!=null&&i.isTrackingImages){console.warn("Scene Placement is disabled while images are being tracked");return}let s=this._hits[0];if(e&&e.origin instanceof FB){const o=this._reticle[e.origin.index];o&&(r=o,s=this._hits[e.origin.index])}if(e&&(e.stopImmediatePropagation(),e.stopPropagation(),e.use()),this._isPlacing=!1,this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),r.position.copy(r.lastPos),r.quaternion.copy(r.lastQuat),this.onApplyPose(r),this.useXRAnchor&&this.onCreateAnchor(Et.active,s),this.context.xr)for(const o of this.context.xr.controllers)o.cancelHitTestSource()}),p(this,"upVec",new S(0,1,0)),p(this,"lookPoint",new S),p(this,"worldUpVec",new S(0,1,0))}static onPlaced(e){const i="placed";return this._eventListeners[i]||(this._eventListeners[i]=[]),this._eventListeners[i].push(e),()=>{const r=this._eventListeners[i].indexOf(e);r>=0&&this._eventListeners[i].splice(r,1)}}get arScale(){return this._arScale}set arScale(e){e!==this._arScale&&(this._arScale=e,this.onScaleChanged())}onEnable(){var e;(e=this.customReticle)==null||e.preload()}supportsXR(e){return e==="immersive-ar"}onEnterXR(e){W9&&console.log("ENTER WEBXR: SessionRoot start..."),this._anchor=null,this.gameObject.updateMatrixWorld(),this._startOffset.copy(this.gameObject.matrixWorld);const i=new ve;this._createdPlacementObject=i,i.name="AR Session Root",this._placementScene.name="AR Placement Scene",this._placementScene.children.length=0;for(let r=this.context.scene.children.length-1;r>=0;r--){const s=this.context.scene.children[r];this._placementScene.add(s)}if(this.context.scene.add(i),this.autoCenter){const r=pl(this._placementScene.children),s=r.getCenter(new S),o=r.getSize(new S),a=new he;a.makeTranslation(s.x,s.y-o.y*.5,s.z),this._startOffset.multiply(a)}this._reparentedComponents.length=0,this._reparentedComponents.push({comp:this,originalObject:this.gameObject}),ie.addComponent(i,this);for(const r of this._reticle)$o(r);this._reticle.length=0,this._isPlacing=!0,this.context.input.addEventListener("pointerup",this.onPlaceScene,{queue:Oa.Early})}onLeaveXR(){this.context.input.removeEventListener("pointerup",this.onPlaceScene,{queue:Oa.Early}),this.onRevertSceneChanges(),this._anchor=null,this._rigPlacementMatrix=void 0}onUpdateXR(e){var i,r,s,o;if(e.xr.isTrackingImages){for(const a of this._reticle)a.visible=!1;return}if(this._isPlacing){const a=(i=e.xr.rig)==null?void 0:i.gameObject;a&&a.parent!==this.context.scene&&this.context.scene.add(a);let l=!1;if(e.xr.isPassThrough&&e.xr.controllers.length>0&&!this.autoPlace)for(const c of e.xr.controllers){const h=c.getHitTest();h&&(l=!0,this.updateReticleAndHits(e.xr,c.index,h,e.xr.rigScale))}if(!l){const c=e.xr.getHitTest();c&&this.updateReticleAndHits(e.xr,0,c,e.xr.rigScale)}}else{if(this._anchor&&e.xr.referenceSpace){const a=e.xr.frame.getPose(this._anchor.anchorSpace,e.xr.referenceSpace);if(a&&this.context.time.frame%20===0){const l=e.xr.convertSpace(a.transform),c=this._reticle[0];c&&(c.position.copy(l.position),c.quaternion.copy(l.quaternion),this.onApplyPose(c))}}if(this.arTouchTransform?(this.userInput||(this.userInput=new NE(this.context)),(r=this.userInput)==null||r.enable()):(s=this.userInput)==null||s.disable(),this.arTouchTransform&&(o=this.userInput)!=null&&o.hasChanged){if(e.xr.rig){const a=e.xr.rig.gameObject;this.userInput.applyMatrixTo(a.matrix,!0),a.matrix.decompose(a.position,a.quaternion,a.scale),this.userInput.factor=a.scale.x}this.userInput.reset()}}}updateReticleAndHits(e,i,r,s){this._hits[i]=r.hit;let o=this._reticle[i];if(!o){if(this.customReticle)if(this.customReticle.asset)o=c0(this.customReticle.asset);else{this.customReticle.loadAssetAsync();return}else o=new pe(new c_(.07,.09,32).rotateX(-Math.PI/2),new Jt({side:yi,depthTest:!1,depthWrite:!1,transparent:!0,opacity:1,color:15658734})),o.name="AR Placement Reticle";if(W9){const a=new Vo(1);a.position.y+=.01,o.add(a)}this._reticle[i]=o,o.matrixAutoUpdate=!1,o.visible=!1}if(o.lastPos=o.lastPos||r.position.clone(),o.lastQuat=o.lastQuat||r.quaternion.clone(),o.position.copy(o.lastPos.lerp(r.position,this.context.time.deltaTime/.1)),o.lastPos.copy(o.position),o.quaternion.copy(o.lastQuat.slerp(r.quaternion,this.context.time.deltaTime/.05)),o.lastQuat.copy(o.quaternion),o.scale.set(s,s,s),this.customReticle&&this.applyViewBasedTransform(o),o.updateMatrix(),o.visible=!0,o.parent!==this.context.scene&&this.context.scene.add(o),this._placementStartTime<0&&(this._placementStartTime=this.context.time.realtimeSinceStartup),this.autoPlace)if(this.upVec.set(0,1,0).applyQuaternion(o.quaternion),this.upVec.dot(bt(0,1,0))>.9){let a=o["autoplace:timer"]||0;a>=1?(o.visible=!1,this.onPlaceScene(null)):(a+=this.context.time.deltaTime,o["autoplace:timer"]=a)}else o["autoplace:timer"]=0}onScaleChanged(){}onRevertSceneChanges(){var e;for(const i of this._reticle)i&&(i.visible=!1,i?.removeFromParent());this._reticle.length=0;for(let i=this._placementScene.children.length-1;i>=0;i--){const r=this._placementScene.children[i];this.context.scene.add(r)}(e=this._createdPlacementObject)==null||e.removeFromParent();for(const i of this._reparentedComponents)ie.addComponent(i.originalObject,i.comp)}async onCreateAnchor(e,i){if(i.createAnchor===void 0){console.warn("Hit does not support creating an anchor",i),it()&&Pi("Hit does not support creating an anchor");return}else{const r=await i.createAnchor(e.viewerPose.transform);e.running&&r&&(this._anchor=r)}}applyViewBasedTransform(e){const i=this.context.mainCamera,r=e,s=i.worldPosition,o=r.worldPosition;this.upVec.set(0,1,0).applyQuaternion(e.quaternion);const a=i.worldPosition;a&&e.position.clone().sub(a).angleTo(this.upVec)<Math.PI/2&&this.upVec.negate();const l=this.upVec.angleTo(this.worldUpVec)*180/Math.PI,c=30;l>c&&l<180-c||l<-c&&l>-180+c?(this.lookPoint.copy(e.position).add(this.upVec),this.lookPoint.y=e.position.y,e.lookAt(this.lookPoint)):(s.y=o.y,e.lookAt(s))}onApplyPose(e){var i,r,s,o;const a=(r=(i=Et.active)==null?void 0:i.rig)==null?void 0:r.gameObject;if(!a){console.warn("No rig object to place");return}(s=Et.active)!=null&&s.rigScale;const l=a.parent||this.context.scene;this._rigPlacementMatrix?(o=this._rigPlacementMatrix)==null||o.decompose(a.position,a.quaternion,a.scale):this._rigPlacementMatrix=a.matrix.clone(),this.applyViewBasedTransform(e),e.updateMatrix(),this.context.scene.add(e),e.attach(a),e.removeFromParent(),a.scale.set(this.arScale,this.arScale,this.arScale),a.position.multiplyScalar(this.arScale),a.updateMatrix(),this.invertForward&&a.matrix.premultiply(tAe),a.matrix.premultiply(this._startOffset),a.matrix.decompose(a.position,a.quaternion,a.scale),l.add(a)}}p($h,"_eventListeners",{});const sL=class{constructor(n){p(this,"oneFingerDrag",!0),p(this,"twoFingerRotate",!0),p(this,"twoFingerScale",!0),p(this,"factor",1),p(this,"context"),p(this,"offset"),p(this,"plane"),p(this,"_scale",1),p(this,"_hasChanged",!1),p(this,"_enabled",!1),p(this,"currentlyUsedPointerIds",new Set),p(this,"currentlyUnusedPointerIds",new Set),p(this,"onPointerDownEarly",e=>{this.isActive&&e.stopPropagation()}),p(this,"onPointerDownLate",e=>{e.used?this.currentlyUsedPointerIds.add(e.pointerId):this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.add(e.pointerId)}),p(this,"onPointerUpEarly",e=>{this.currentlyUsedPointerIds.delete(e.pointerId),this.currentlyUnusedPointerIds.delete(e.pointerId)}),p(this,"prev",new Map),p(this,"_didMultitouch",!1),p(this,"touchStart",e=>{for(let i=0;i<e.changedTouches.length;i++){const r=e.changedTouches[i],s=c4()&&r.clientY<window.innerHeight*.1;this.prev.has(r.identifier)||this.prev.set(r.identifier,{ignore:s,x:0,z:0,screenx:0,screeny:0});const o=this.prev.get(r.identifier);if(o){const a=this.getPositionOnPlane(r.clientX,r.clientY);o.x=a.x,o.z=a.z,o.screenx=r.clientX,o.screeny=r.clientY}}}),p(this,"touchEnd",e=>{e.touches.length<=0&&(this._didMultitouch=!1);for(let i=0;i<e.changedTouches.length;i++){const r=e.changedTouches[i];this.prev.delete(r.identifier)}}),p(this,"touchMove",e=>{if(!e.defaultPrevented&&this.isActive){if(e.touches.length===1){if(this._didMultitouch)return;const i=e.touches[0],r=this.prev.get(i.identifier);if(!r||r.ignore)return;const s=this.getPositionOnPlane(i.clientX,i.clientY),o=s.x-r.x,a=s.z-r.z;if(o===0&&a===0)return;this.oneFingerDrag&&this.addMovement(o,a),r.x=s.x,r.z=s.z,r.screenx=i.clientX,r.screeny=i.clientY;return}else if(e.touches.length===2){this._didMultitouch=!0;const i=e.touches[0],r=e.touches[1],s=this.prev.get(i.identifier),o=this.prev.get(r.identifier);if(!s||!o)return;if(this.twoFingerRotate){const a=Math.atan2(i.clientY-r.clientY,i.clientX-r.clientX),l=Math.atan2(s.screeny-o.screeny,s.screenx-o.screenx),c=a-l;Math.abs(c)>.001&&this.addRotation(c)}if(this.twoFingerScale){const a=i.clientX-r.clientX,l=i.clientY-r.clientY,c=Math.sqrt(a*a+l*l),h=s.screenx-o.screenx,u=s.screeny-o.screeny,d=Math.sqrt(h*h+u*u),f=c-d;Math.abs(f)>2&&this.addScale(f)}s.screenx=i.clientX,s.screeny=i.clientY,o.screenx=r.clientX,o.screeny=r.clientY}}}),p(this,"_raycaster",new ku),p(this,"_intersection",new S),p(this,"_screenPos",new S),p(this,"_tempMatrix",new he),this.context=n,this.offset=new he,this.plane=new dr,this.plane.setFromNormalAndCoplanarPoint(sL.up,sL.zero)}reset(){this._scale=1,this.offset.identity()}get hasChanged(){return this._hasChanged}applyMatrixTo(n,e){this._hasChanged=!1,e?(this.offset.invert(),n.premultiply(this.offset)):n.multiply(this.offset)}get isActive(){return this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.size>0}enable(){this._enabled||(this._enabled=!0,this.context.input.addEventListener("pointerdown",this.onPointerDownEarly,{queue:Oa.Early}),this.context.input.addEventListener("pointerdown",this.onPointerDownLate,{queue:Oa.Late}),this.context.input.addEventListener("pointerup",this.onPointerUpEarly,{queue:Oa.Early}),window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,this.context.input.removeEventListener("pointerdown",this.onPointerDownEarly,{queue:Oa.Early}),this.context.input.removeEventListener("pointerdown",this.onPointerDownLate,{queue:Oa.Late}),this.context.input.removeEventListener("pointerup",this.onPointerUpEarly,{queue:Oa.Early}),window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}getPositionOnPlane(n,e){const i=this.context.mainCamera;return this._screenPos.x=n/window.innerWidth*2-1,this._screenPos.y=-(e/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(i),this._raycaster.set(i.position,this._screenPos.sub(i.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(n,e){n/=this._scale,e/=this._scale,n*=this.factor,e*=this.factor,this.offset.elements[12]+=n,this.offset.elements[14]+=e,(n!==0||e!==0)&&(this._hasChanged=!0)}addScale(n){n/=window.innerWidth,n*=-1,this._scale*=1+n,this._tempMatrix.makeScale(1-n,1-n,1-n),this.offset.premultiply(this._tempMatrix),n!==0&&(this._hasChanged=!0)}addRotation(n){n*=-1,this._tempMatrix.makeRotationY(n),this.offset.premultiply(this._tempMatrix),n!==0&&(this._hasChanged=!0)}};let NE=sL;p(NE,"up",new S(0,1,0)),p(NE,"zero",new S(0,0,0)),p(NE,"one",new S(1,1,1));var iAe=Object.defineProperty,nAe=Object.getOwnPropertyDescriptor,Z0=(n,e,i,r)=>{for(var s=r>1?void 0:r?nAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&iAe(e,i,s),s};class kc extends Be{constructor(){super(...arguments),p(this,"position","bottom"),p(this,"showNeedleLogo",!0),p(this,"showSpatialMenu"),p(this,"createFullscreenButton"),p(this,"createMuteButton"),p(this,"createQRCodeButton")}onEnable(){this.applyOptions()}applyOptions(){this.context.menu.setPosition(this.position),this.context.menu.showNeedleLogo(this.showNeedleLogo),this.createFullscreenButton===!0&&this.context.menu.showFullscreenOption(!0),this.createMuteButton===!0&&this.context.menu.showAudioPlaybackOption(!0),this.showSpatialMenu===!0&&this.context.menu.showSpatialMenu(this.showSpatialMenu),this.createQRCodeButton===!0&&(ec()||this.context.menu.showQRCodeButton(!0))}}Z0([C()],kc.prototype,"position",2),Z0([C()],kc.prototype,"showNeedleLogo",2),Z0([C()],kc.prototype,"showSpatialMenu",2),Z0([C()],kc.prototype,"createFullscreenButton",2),Z0([C()],kc.prototype,"createMuteButton",2),Z0([C()],kc.prototype,"createQRCodeButton",2);const kn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function X9(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function rAe(n){if(!n)throw new Error("No basePath supplied");return await X9(`${n}/profilesList.json`)}async function sAe(n,e,i=null,r=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const s=await rAe(e);let o;if(n.profiles.some(c=>{const h=s[c];return h&&(o={profileId:c,profilePath:`${e}/${h.path}`,deprecated:!!h.deprecated}),!!o}),!o){if(!i)throw new Error("No matching profile name found");const c=s[i];if(!c)throw new Error(`No matching profile name found and default profile "${i}" missing.`);o={profileId:i,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}}const a=await X9(o.profilePath);let l;if(r){let c;if(n.handedness==="any"?c=a.layouts[Object.keys(a.layouts)[0]]:c=a.layouts[n.handedness],!c)throw new Error(`No matching handedness, ${n.handedness}, in profile ${o.profileId}`);c.assetPath&&(l=o.profilePath.replace("profile.json",c.assetPath))}return{profile:a,assetPath:l}}const oAe={xAxis:0,yAxis:0,button:0,state:kn.ComponentState.DEFAULT};function aAe(n=0,e=0){let i=n,r=e;if(Math.sqrt(n*n+e*e)>1){const s=Math.atan2(e,n);i=Math.cos(s),r=Math.sin(s)}return{normalizedXAxis:i*.5+.5,normalizedYAxis:r*.5+.5}}class lAe{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===kn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(oAe)}updateFromComponent({xAxis:e,yAxis:i,button:r,state:s}){const{normalizedXAxis:o,normalizedYAxis:a}=aAe(e,i);switch(this.componentProperty){case kn.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?o:.5;break;case kn.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?a:.5;break;case kn.ComponentProperty.BUTTON:this.value=this.states.includes(s)?r:0;break;case kn.ComponentProperty.STATE:this.valueNodeProperty===kn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class cAe{constructor(e,i){if(!e||!i||!i.visualResponses||!i.gamepadIndices||Object.keys(i.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=i.type,this.rootNodeName=i.rootNodeName,this.touchPointNodeName=i.touchPointNodeName,this.visualResponses={},Object.keys(i.visualResponses).forEach(r=>{const s=new lAe(i.visualResponses[r]);this.visualResponses[r]=s}),this.gamepadIndices=Object.assign({},i.gamepadIndices),this.values={state:kn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=kn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const i=e.buttons[this.gamepadIndices.button];this.values.button=i.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,i.pressed||this.values.button===1?this.values.state=kn.ComponentState.PRESSED:(i.touched||this.values.button>kn.ButtonTouchThreshold)&&(this.values.state=kn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===kn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>kn.AxisTouchThreshold&&(this.values.state=kn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===kn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>kn.AxisTouchThreshold&&(this.values.state=kn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(i=>{i.updateFromComponent(this.values)})}}class hAe{constructor(e,i,r){if(!e)throw new Error("No xrInputSource supplied");if(!i)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=r,this.id=i.profileId,this.layoutDescription=i.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const o=this.layoutDescription.components[s];this.components[s]=new cAe(s,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(i=>{e.push(i.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const uAe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",dAe="generic-trigger";let pAe=class extends ve{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(n){return this.envMap==n?this:(this.envMap=n,this.traverse(e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}),this)}updateMatrixWorld(n){super.updateMatrixWorld(n),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(i=>{const{valueNode:r,minNode:s,maxNode:o,value:a,valueNodeProperty:l}=i;r&&(l===kn.VisualResponseProperty.VISIBILITY?r.visible=a:l===kn.VisualResponseProperty.TRANSFORM&&(r.quaternion.slerpQuaternions(s.quaternion,o.quaternion,a),r.position.lerpVectors(s.position,o.position,a)))})}))}};function fAe(n,e){Object.values(n.components).forEach(i=>{const{type:r,touchPointNodeName:s,visualResponses:o}=i;if(r===kn.ComponentType.TOUCHPAD)if(i.touchPointNode=e.getObjectByName(s),i.touchPointNode){const a=new tl(.001),l=new Jt({color:255}),c=new pe(a,l);i.touchPointNode.add(c)}else console.warn(`Could not find touch dot, ${i.touchPointNodeName}, in touchpad component ${i.id}`);Object.values(o).forEach(a=>{const{valueNodeName:l,minNodeName:c,maxNodeName:h,valueNodeProperty:u}=a;if(u===kn.VisualResponseProperty.TRANSFORM){if(a.minNode=e.getObjectByName(c),a.maxNode=e.getObjectByName(h),!a.minNode){console.warn(`Could not find ${c} in the model`);return}if(!a.maxNode){console.warn(`Could not find ${h} in the model`);return}}a.valueNode=e.getObjectByName(l),a.valueNode||console.warn(`Could not find ${l} in the model`)})})}function q9(n,e){fAe(n.motionController,e),n.envMap&&e.traverse(i=>{i.isMesh&&(i.material.envMap=n.envMap,i.material.needsUpdate=!0)}),n.layers.mask!=0&&e.traverse(i=>{i.layers.mask=n.layers.mask}),n.add(e)}class mAe{constructor(e=null,i=null){this.gltfLoader=e,this.path=uAe,this._assetCache={},this.onLoad=i,this.gltfLoader||(this.gltfLoader=new gd)}setPath(e){return this.path=e,this}createControllerModel(e){const i=new pAe;let r=null;return e.addEventListener("connected",s=>{const o=s.data;o.targetRayMode!=="tracked-pointer"||!o.gamepad||sAe(o,this.path,dAe).then(({profile:a,assetPath:l})=>{i.motionController=new hAe(o,a,l);const c=this._assetCache[i.motionController.assetUrl];if(c)r=c.scene.clone(),q9(i,r),this.onLoad&&this.onLoad(r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(i.motionController.assetUrl,h=>{this._assetCache[i.motionController.assetUrl]=h,r=h.scene.clone(),q9(i,r),this.onLoad&&this.onLoad(r)},null,()=>{throw new Error(`Asset ${i.motionController.assetUrl} missing or malformed.`)})}}).catch(a=>{console.warn(a)})}),e.addEventListener("disconnected",()=>{i.motionController=null,i.remove(r),r=null}),i}}const gAe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class vAe{constructor(e,i,r,s,o=null,a=null){this.controller=i,this.handModel=e,this.bones=[],o===null&&(o=new gd,o.setPath(r||gAe)),o.load(`${s}.glb`,l=>{const c=l.scene.children[0];this.handModel.add(c),c.layers.mask=this.handModel.layers.mask;const h=c.getObjectByProperty("type","SkinnedMesh");h.frustumCulled=!1,h.castShadow=!0,h.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(u=>{const d=c.getObjectByName(u);d!==void 0?d.jointName=u:console.warn(`Couldn't find ${u} in ${s} hand mesh`),this.bones.push(d)}),a&&a(c)})}updateMesh(){const e=this.controller.joints;for(let i=0;i<this.bones.length;i++){const r=this.bones[i];if(r){const s=e[r.jointName];if(s.visible){const o=s.position;r.position.copy(o),r.quaternion.copy(s.quaternion)}}}}}var yAe=Object.defineProperty,AAe=Object.getOwnPropertyDescriptor,zE=(n,e,i,r)=>{for(var s=r>1?void 0:r?AAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&yAe(e,i,s),s};const Oc=te("debugwebxr"),Vd=new Array;class Dc extends Be{constructor(){super(...arguments),p(this,"createControllerModel",!0),p(this,"createHandModel",!0),p(this,"customLeftHand"),p(this,"customRightHand"),p(this,"_models",new Array)}supportsXR(e){return e==="immersive-vr"||e==="immersive-ar"}async onXRControllerAdded(e){var i,r,s;if(!(e.xr.isVR||e.xr.isPassThrough))return;const{controller:o}=e;if(Oc&&console.warn("Add Controller Model for",o.side,o.index),this.createControllerModel||this.createHandModel){if(o.hand){if(this.createHandModel){const a=await this.loadHandModel(o);if(!a||!o.connected||!o.isHand){(i=a?.handObject)==null||i.removeFromParent(),(s=(r=a?.handmesh)==null?void 0:r.controller)==null||s.removeFromParent();return}this._models.push({controller:o,model:a.handObject,handmesh:a.handmesh}),this._models.sort((l,c)=>l.controller.index-c.controller.index),this.scene.add(a.handObject),o.model=a.handObject}}else if(this.createControllerModel){const a=await o.getModelUrl();if(a){const l=await this.loadModel(o,a);if(!l||!o.connected||o.isHand)return;this._models.push({controller:o,model:l}),this._models.sort((c,h)=>c.controller.index-h.controller.index),this.scene.add(l),l.traverse(c=>{c.layers.set(2),c.matrixWorldAutoUpdate=!1,c.matrixAutoUpdate=!1,c.updateMatrix()}),o.model=l}else o.targetRayMode!=="transient-pointer"&&console.warn("XRControllerModel: no model found for "+o.side)}}}onXRControllerRemoved(e){var i;const r=this._models.findIndex(o=>o.controller===e.controller),s=this._models[r];s&&(this._models.splice(r,1),s.handmesh&&((i=s.handmesh.handModel)==null||i.removeFromParent(),s.handmesh=void 0),s.model&&(s.model.removeFromParent(),s.model=void 0))}onBeforeRender(){if(Et.active&&(Oc&&(Vd[0]=Date.now()),this.updateRendering(Et.active),Oc)){const e=Date.now()-Vd[0];if(Vd.push(e),Vd.length>=30){Vd[0]=0;const i=Vd.reduce((r,s)=>r+s,0)/Vd.length;Vd.length=0,console.log("[XRControllerModel] "+i.toFixed(2)+" ms")}}}onLeaveXR(e){var i;for(const r of this._models)r&&((i=r.model)==null||i.removeFromParent(),r.controller.model===r.model&&(r.controller.model=null));this._models.length=0}updateRendering(e){var i,r,s,o,a;for(let l=0;l<this._models.length;l++){const c=this._models[l];if(!c)continue;const h=c.controller;if(!h.connected){Oc&&console.warn("XRControllerModel.onUpdateXR: controller is not connected anymore",h.side,h.hand);continue}if(c.model&&!c.handmesh)c.model.matrixAutoUpdate=!1,c.model.matrixWorldAutoUpdate=!1,c.model.matrix.copy(h.gripMatrix),c.model.visible=h.isTracking,(i=e.rig)==null||i.gameObject.add(c.model);else if(h.inputSource.hand&&c.handmesh){const u=e.referenceSpace,d=this.context.renderer.xr.getHand(h.index);if(u&&e.frame.getJointPose){for(const f of h.inputSource.hand.values()){const m=d.joints[f.jointName];if(m){const g=h.getHandJointPose(f);if(g){const v=g.transform.position,y=g.transform.orientation;m.position.copy(v),m.quaternion.copy(y),m.matrixAutoUpdate=!1,m.matrixWorldAutoUpdate=!1}m.visible=g!=null}}c.model&&(c.model.visible=h.isTracking,c.model.visible&&c.model.parent!==((r=e.rig)==null?void 0:r.gameObject)&&((s=e.rig)==null||s.gameObject.add(c.model))),(o=c.model)!=null&&o.visible&&((a=c.handmesh)==null||a.updateMesh(),c.model.matrixWorldAutoUpdate=!1,c.model.matrixAutoUpdate=!1,c.model.matrix.identity(),c.model.applyMatrix4(t0))}}}}async loadModel(e,i){var r;if(!e.connected)return console.warn("XRControllerModel.onXRControllerAdded: controller is not connected anymore",e.side),null;const s=await $t.getOrCreate("",i).instantiate();return Xk(s),(r=Et.active)!=null&&r.isPassThrough&&s.traverseVisible(o=>{this.makeOccluder(o)}),s}async loadHandModel(e){const i=this.context,r=i.renderer.xr.getHand(e.index);r||(Oc?yt.DrawLabel(e.rayWorldPosition,"No hand found for index "+e.index,.05,5):console.warn("No hand found for index "+e.index));const s=new gd;NC(s,i),await YD(s,i,this.sourceId??""),s.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/");const o=e.side==="left"?"left.":"right.",a=e.side==="left"?this.customLeftHand:this.customRightHand;if(a)if(!a.uri.includes(o))console.warn("XRControllerModel: custom hand model must be named "+o),Pi("Custom Hand: unexpected name, please see the console for details");else{const h=a.uri.substring(0,a.uri.indexOf(o));s.setPath(h),Oc&&console.log("XRControllerModel: loading custom hand model from "+h)}const l=new ve;Xk(l);const c=new vAe(l,r,s.path,e.inputSource.handedness,s,h=>{h.traverse(u=>{var d;u.layers.set(2),(d=Et.active)!=null&&d.isPassThrough&&this.makeOccluder(u),u instanceof pe&&mi.assignMeshLOD(u,0)}),e.connected||(Oc&&yt.DrawLabel(e.rayWorldPosition,"Hand is loaded but not connected anymore",.05,5),h.removeFromParent())});if(Oc&&l.add(new Vo(.5)),e.inputSource.hand){Oc&&console.log(e.inputSource.hand);for(const h of e.inputSource.hand.values())if(r.joints[h.jointName]===void 0){const u=new Cr;u.matrixAutoUpdate=!1,u.visible=!0,r.joints[h.jointName]=u,r.add(u)}}else Oc&&yt.DrawLabel(e.rayWorldPosition,"No inputSource.hand found for index "+e.index,.05,5);return{handObject:l,handmesh:c}}makeOccluder(e){if(e instanceof pe){let i=e.material;i instanceof Ut&&(i=e.material=i.clone(),i.depthWrite=!0,i.depthTest=!0,i.colorWrite=!1,e.receiveShadow=!1,e.renderOrder=-100)}}}p(Dc,"factory",new mAe),zE([C()],Dc.prototype,"createControllerModel",2),zE([C()],Dc.prototype,"createHandModel",2),zE([C($t)],Dc.prototype,"customLeftHand",2),zE([C($t)],Dc.prototype,"customRightHand",2);const Y9=new Ht,jE=new S;class J9 extends Vw{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],i=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new rt(e,3)),this.setAttribute("uv",new rt(i,2))}applyMatrix4(e){const i=this.attributes.instanceStart,r=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),r.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const r=new Yw(i,6,1);return this.setAttribute("instanceStart",new Go(r,3,0)),this.setAttribute("instanceEnd",new Go(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const r=new Yw(i,6,1);return this.setAttribute("instanceColorStart",new Go(r,3,0)),this.setAttribute("instanceColorEnd",new Go(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new zR(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ht);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Y9.setFromBufferAttribute(i),this.boundingBox.union(Y9))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zi),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let s=0;for(let o=0,a=e.count;o<a;o++)jE.fromBufferAttribute(e,o),s=Math.max(s,r.distanceToSquared(jE)),jE.fromBufferAttribute(i,o),s=Math.max(s,r.distanceToSquared(jE));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}Ge.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new J(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},qr.line={uniforms:Jm.merge([Ge.common,Ge.fog,Ge.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class oL extends Bt{constructor(e){super({type:"LineMaterial",uniforms:Jm.clone(qr.line.uniforms),vertexShader:qr.line.vertexShader,fragmentShader:qr.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const K9=new S,Z9=new S,ds=new qe,ps=new qe,Lc=new qe,aL=new S,lL=new he,fs=new Ho,$9=new S,GE=new Ht,HE=new Zi,Uc=new qe;let Fc,Zf;function eW(n,e,i){return Uc.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),Uc.multiplyScalar(1/Uc.w),Uc.x=Zf/i.width,Uc.y=Zf/i.height,Uc.applyMatrix4(n.projectionMatrixInverse),Uc.multiplyScalar(1/Uc.w),Math.abs(Math.max(Uc.x,Uc.y))}function bAe(n,e){const i=n.matrixWorld,r=n.geometry,s=r.attributes.instanceStart,o=r.attributes.instanceEnd,a=Math.min(r.instanceCount,s.count);for(let l=0,c=a;l<c;l++){fs.start.fromBufferAttribute(s,l),fs.end.fromBufferAttribute(o,l),fs.applyMatrix4(i);const h=new S,u=new S;Fc.distanceSqToSegment(fs.start,fs.end,u,h),u.distanceTo(h)<Zf*.5&&e.push({point:u,pointOnLine:h,distance:Fc.origin.distanceTo(u),object:n,face:null,faceIndex:l,uv:null,uv1:null})}}function xAe(n,e,i){const r=e.projectionMatrix,s=n.material.resolution,o=n.matrixWorld,a=n.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,h=Math.min(a.instanceCount,l.count),u=-e.near;Fc.at(1,Lc),Lc.w=1,Lc.applyMatrix4(e.matrixWorldInverse),Lc.applyMatrix4(r),Lc.multiplyScalar(1/Lc.w),Lc.x*=s.x/2,Lc.y*=s.y/2,Lc.z=0,aL.copy(Lc),lL.multiplyMatrices(e.matrixWorldInverse,o);for(let d=0,f=h;d<f;d++){if(ds.fromBufferAttribute(l,d),ps.fromBufferAttribute(c,d),ds.w=1,ps.w=1,ds.applyMatrix4(lL),ps.applyMatrix4(lL),ds.z>u&&ps.z>u)continue;if(ds.z>u){const A=ds.z-ps.z,b=(ds.z-u)/A;ds.lerp(ps,b)}else if(ps.z>u){const A=ps.z-ds.z,b=(ps.z-u)/A;ps.lerp(ds,b)}ds.applyMatrix4(r),ps.applyMatrix4(r),ds.multiplyScalar(1/ds.w),ps.multiplyScalar(1/ps.w),ds.x*=s.x/2,ds.y*=s.y/2,ps.x*=s.x/2,ps.y*=s.y/2,fs.start.copy(ds),fs.start.z=0,fs.end.copy(ps),fs.end.z=0;const m=fs.closestPointToPointParameter(aL,!0);fs.at(m,$9);const g=pi.lerp(ds.z,ps.z,m),v=g>=-1&&g<=1,y=aL.distanceTo($9)<Zf*.5;if(v&&y){fs.start.fromBufferAttribute(l,d),fs.end.fromBufferAttribute(c,d),fs.start.applyMatrix4(o),fs.end.applyMatrix4(o);const A=new S,b=new S;Fc.distanceSqToSegment(fs.start,fs.end,b,A),i.push({point:b,pointOnLine:A,distance:Fc.origin.distanceTo(b),object:n,face:null,faceIndex:d,uv:null,uv1:null})}}}class _Ae extends pe{constructor(e=new J9,i=new oL({color:Math.random()*16777215})){super(e,i),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,r=e.attributes.instanceEnd,s=new Float32Array(2*i.count);for(let a=0,l=0,c=i.count;a<c;a++,l+=2)K9.fromBufferAttribute(i,a),Z9.fromBufferAttribute(r,a),s[l]=l===0?0:s[l-1],s[l+1]=s[l]+K9.distanceTo(Z9);const o=new Yw(s,2,1);return e.setAttribute("instanceDistanceStart",new Go(o,1,0)),e.setAttribute("instanceDistanceEnd",new Go(o,1,1)),this}raycast(e,i){const r=this.material.worldUnits,s=e.camera;s===null&&!r&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const o=e.params.Line2!==void 0&&e.params.Line2.threshold||0;Fc=e.ray;const a=this.matrixWorld,l=this.geometry,c=this.material;Zf=c.linewidth+o,l.boundingSphere===null&&l.computeBoundingSphere(),HE.copy(l.boundingSphere).applyMatrix4(a);let h;if(r)h=Zf*.5;else{const d=Math.max(s.near,HE.distanceToPoint(Fc.origin));h=eW(s,d,c.resolution)}if(HE.radius+=h,Fc.intersectsSphere(HE)===!1)return;l.boundingBox===null&&l.computeBoundingBox(),GE.copy(l.boundingBox).applyMatrix4(a);let u;if(r)u=Zf*.5;else{const d=Math.max(s.near,GE.distanceToPoint(Fc.origin));u=eW(s,d,c.resolution)}GE.expandByScalar(u),Fc.intersectsBox(GE)!==!1&&(r?bAe(this,i):xAe(this,s,i))}}class tW extends J9{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const i=e.length-3,r=new Float32Array(2*i);for(let s=0;s<i;s+=3)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];return super.setPositions(r),this}setColors(e){const i=e.length-3,r=new Float32Array(2*i);for(let s=0;s<i;s+=3)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];return super.setColors(r),this}fromLine(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}}class wAe extends _Ae{constructor(e=new tW,i=new oL({color:Math.random()*16777215})){super(e,i),this.isLine2=!0,this.type="Line2"}}class VE extends Be{}var SAe=Object.defineProperty,CAe=Object.getOwnPropertyDescriptor,Qd=(n,e,i,r)=>{for(var s=r>1?void 0:r?CAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&SAe(e,i,s),s};const cL=te("debugwebxr");class ha extends Be{constructor(){super(...arguments),p(this,"movementSpeed",1.5),p(this,"rotationStep",30),p(this,"useTeleport",!0),p(this,"usePinchToTeleport",!0),p(this,"useTeleportTarget",!1),p(this,"useTeleportFade",!1),p(this,"showRays",!0),p(this,"showHits",!0),p(this,"isXRMovementHandler",!0),p(this,"xrSessionMode","immersive-vr"),p(this,"_didApplyRotation",!1),p(this,"_didTeleport",!1),p(this,"_teleportBuffer",new Array),p(this,"_plane",null),p(this,"_lines",[]),p(this,"_hitDiscs",[]),p(this,"_hitDistances",[]),p(this,"_lastHitDistances",[]),p(this,"hitPointRaycastFilter",e=>e.type==="SkinnedMesh"?"continue in children":!0)}onUpdateXR(e){const i=e.xr.rig;if(!(i!=null&&i.gameObject)||e.xr.isPassThrough)return;const r=e.xr.leftController,s=e.xr.rightController;r&&this.onHandleMovement(r,i.gameObject),s&&(this.onHandleRotation(s,i.gameObject),this.useTeleport&&this.onHandleTeleport(s,i.gameObject))}onLeaveXR(e){for(const i of this._lines)i.removeFromParent();for(const i of this._hitDiscs)i?.removeFromParent()}onBeforeRender(){var e;(e=this.context.xr)!=null&&e.running&&(this.showRays&&this.renderRays(this.context.xr),this.showHits&&this.renderHits(this.context.xr))}onHandleMovement(e,i){const r=e.getStick("xr-standard-thumbstick");if(r.x!=0||r.y!=0){const s=bt(r.x,0,r.y);s.multiplyScalar(this.context.time.deltaTimeUnscaled*this.movementSpeed);const o=Qi(i);s.multiplyScalar(o.x),s.applyQuaternion(e.xr.poseOrientation),s.y=0,s.applyQuaternion(i.worldQuaternion),i.position.add(s),i.updateWorldMatrix(!1,!1);for(const a of i.children)a.updateWorldMatrix(!1,!1)}}onHandleRotation(e,i){const r=e.getStick("xr-standard-thumbstick").x;if(this._didApplyRotation)Math.abs(r)<.3&&(this._didApplyRotation=!1);else if(Math.abs(r)>.5){this._didApplyRotation=!0;const s=r>0?1:-1,o=kt(this.context.mainCamera).clone();i.rotateY(s*tt.toRadians(this.rotationStep));const a=kt(this.context.mainCamera).clone().sub(o);a.y=0,i.position.sub(a)}}onHandleTeleport(e,i){var r,s,o,a,l;let c=0;if(e.hand&&this.usePinchToTeleport&&e.isTeleportGesture){const h=e.getPointerId("primary");if(h!=null&&this.context.input.getIsPointerIdInUse(h))return;const u=e.getGesture("pinch");u&&(c=u.value)}else c=(r=e.getStick("xr-standard-thumbstick"))==null?void 0:r.y;if(this._didTeleport)c>=0&&c<.4?this._didTeleport=!1:c<0&&c>-.4&&(this._didTeleport=!1);else if(c>.8){this._didTeleport=!0;const h=this.context.physics.raycastFromRay(e.ray)[0];if(h&&h.object instanceof Ag){const d=(s=h.normal)==null?void 0:s.dot(bt(0,1,0));if(d!==void 0&&d<.4)return}let u=h?.point;if(!u&&!this.useTeleportTarget){this._plane||(this._plane=new dr(new S(0,1,0),0));const d=i.worldPosition;this._plane.setFromNormalAndCoplanarPoint(new S(0,1,0),d);const f=e.ray;u=d.clone(),this._plane.intersectLine(new Ho(f.origin,bt(f.direction).multiplyScalar(1e4).add(f.origin)),u),u.distanceTo(d)>i.scale.x*10&&(u=null)}if(u){if(this.useTeleportTarget&&!ie.getComponentInParent(h.object,VE))return;const d=u.clone();if(cL&&yt.DrawSphere(u,.025,16711680,5),(o=this.context.mainCamera)==null?void 0:o.position){const f=(a=this.context.xr)==null?void 0:a.getUserOffsetInRig();f&&(f.y=0,d.sub(f),cL&&yt.DrawWireSphere(f.add(d),.025,65280,5))}this._teleportBuffer.push(i.matrix.clone()),this._teleportBuffer.length>10&&this._teleportBuffer.shift(),this.useTeleportFade?(l=e.xr.fadeTransition())==null||l.then(()=>{i.worldPosition=d}):i.worldPosition=d}}else if(c<-.8&&(this._didTeleport=!0,this._teleportBuffer.length>0)){const h=this._teleportBuffer.pop();h&&h.decompose(i.position,i.quaternion,i.scale)}}renderRays(e){var i;for(let r=0;r<this._lines.length;r++){const s=this._lines[r];s&&(s.visible=!1)}for(let r=0;r<e.controllers.length;r++){const s=e.controllers[r];let o=this._lines[r];if(!s.connected||!s.isTracking||!s.ray||s.targetRayMode==="transient-pointer"||!s.hasSelectEvent){o&&(o.visible=!1);continue}o||(o=this.createRayLineObject(),o.scale.z=.5,this._lines[r]=o),s.updateRayWorldPosition(),s.updateRayWorldQuaternion();const a=s.rayWorldPosition,l=s.rayWorldQuaternion;o.position.copy(a),o.quaternion.copy(l);const c=e.rigScale,h=this.usePinchToTeleport&&s.isTeleportGesture,u=this._lastHitDistances[r],d=this._hitDistances[r]!=null,f=u??c;o.scale.set(c,c,f),o.visible=!0,o.layers.disableAll(),o.layers.enable(2);let m=o.material.opacity;h?m=1:this.showHits&&f<e.rigScale*.5?m=0:(i=s.getButton("primary"))!=null&&i.pressed?m=.5:m=d?.2:.1,o.material.opacity=tt.lerp(o.material.opacity,m,this.context.time.deltaTimeUnscaled/.1),o.parent!==this.context.scene&&this.context.scene.add(o)}}renderHits(e){var i;for(const r of this._hitDiscs){if(!r)continue;const s=r.controller;if(!s||!s.connected||!s.isTracking){r.visible=!1;continue}}for(let r=0;r<e.controllers.length;r++){const s=e.controllers[r];if(!s.connected||!s.isTracking||!s.ray||!s.hasSelectEvent)continue;let o=this._hitDiscs[r],a=!0;const l=s.getPointerId("primary");l!=null&&this.context.input.getIsPointerIdInUse(l)&&(o&&(o.visible=!1),this._hitDistances[r]=null,this._lastHitDistances[r]=0,a=!1);const c=this.context.time.smoothedFps>=59?1:10;if((this.context.time.frame+s.index)%c!==0&&(a=!1),!a){const d=this._hitDiscs[r];d&&d.visible&&d.hit&&this.updateHitPointerPosition(s,d,d.hit.distance);continue}const h=this.context.physics.raycastFromRay(s.ray,{testObject:this.hitPointRaycastFilter,precise:!1});let u=h.find(d=>this.usePinchToTeleport&&s.isTeleportGesture?!0:this.isObjectWithInteractiveComponent(d.object));if(u||(u=h[0]),o&&(o.controller=s,o.hit=u),this._hitDistances[r]=u?.distance||null,u){this._lastHitDistances[r]=u.distance;const d=e.rigScale??1;cL&&(yt.DrawWireSphere(u.point,.025*d,16711680),yt.DrawLabel(bt(0,.2,0).add(u.point),u.object.name,.02,0)),o||(o=this.createHitPointObject(),this._hitDiscs[r]=o),o.hit=u,o.visible=u.distance>d*.05;let f=.01*(d+u.distance);const m=(i=s.getButton("primary"))==null?void 0:i.pressed;m&&(f*=1.1),o.scale.set(f,f,f),o.layers.set(2);let g=o.material.opacity;if(m?g=1:g=u.distance<.15*d?.2:.6,o.material.opacity=tt.lerp(o.material.opacity,g,this.context.time.deltaTimeUnscaled/.1),o.visible){if(u.normal){this.updateHitPointerPosition(s,o,u.distance);const v=u.normal.applyQuaternion(Ri(u.object));o.quaternion.setFromUnitVectors(EAe,v)}else this.updateHitPointerPosition(s,o,u.distance);o.parent!==this.context.scene&&this.context.scene.add(o)}}else this._hitDiscs[r]&&(this._hitDiscs[r].visible=!1)}}isObjectWithInteractiveComponent(e,i=0){return KC(e)||e.isUI===!0?!0:e.isScene?!1:e.parent?this.isObjectWithInteractiveComponent(e.parent,i+1):!1}updateHitPointerPosition(e,i,r){const s=bt(e.rayWorldPosition);s.add(bt(0,0,r-.01).applyQuaternion(e.rayWorldQuaternion)),i.position.lerp(s,this.context.time.deltaTimeUnscaled/.05)}createHitPointObject(){const e=new pe(new tl(.3,6,6),new Jt({color:15658734,opacity:.7,transparent:!0,depthTest:!1,depthWrite:!1,side:yi}));return e.layers.disableAll(),e.layers.enable(2),e}createRayLineObject(){const e=new wAe;e.layers.disableAll(),e.layers.enable(2);const i=new tW;e.geometry=i;const r=new Float32Array(9);r.set([0,0,.02,0,0,.4,0,0,1]),i.setPositions(r);const s=new Float32Array(9);s.set([1,1,1,.1,.1,.1,0,0,0]),i.setColors(s);const o=new oL({color:16777215,vertexColors:!0,worldUnits:!0,linewidth:.004,transparent:!0,depthWrite:!1,blending:mp,dashed:!1});return e.material=o,e}}Qd([C()],ha.prototype,"movementSpeed",2),Qd([C()],ha.prototype,"rotationStep",2),Qd([C()],ha.prototype,"useTeleport",2),Qd([C()],ha.prototype,"usePinchToTeleport",2),Qd([C()],ha.prototype,"useTeleportTarget",2),Qd([C()],ha.prototype,"useTeleportFade",2),Qd([C()],ha.prototype,"showRays",2),Qd([C()],ha.prototype,"showHits",2);const EAe=new S(0,1,0);var MAe=Object.defineProperty,TAe=Object.getOwnPropertyDescriptor,zr=(n,e,i,r)=>{for(var s=r>1?void 0:r?TAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&MAe(e,i,s),s};const QE=te("debugwebxr"),IAe=te("debugusdz");var hL;const $0=(hL=class extends Be{constructor(){super(...arguments),p(this,"createVRButton",!0),p(this,"createARButton",!0),p(this,"createSendToQuestButton",!0),p(this,"createQRCode",!0),p(this,"useDefaultControls",!0),p(this,"showControllerModels",!0),p(this,"showHandModels",!0),p(this,"usePlacementReticle",!0),p(this,"customARPlacementReticle"),p(this,"usePlacementAdjustment",!0),p(this,"arScale",1),p(this,"useXRAnchor",!1),p(this,"autoPlace",!0),p(this,"autoCenter",!0),p(this,"useQuicklookExport",!1),p(this,"useDepthSensing",!1),p(this,"useSpatialGrab",!0),p(this,"defaultAvatar"),p(this,"_playerSync"),p(this,"_createdComponentsInSession",[]),p(this,"_usdzExporter"),p(this,"_exitXRMenuButton"),p(this,"_previousXRState",0),p(this,"_spatialGrabRaycaster"),p(this,"onAvatarSpawned",n=>{QE&&console.log("WebXR.onAvatarSpawned",n),ie.getComponentInChildren(n,Pd)??(t=ie.addComponent(n,Pd))}),p(this,"_buttonFactory"),p(this,"_buttons",[])}awake(){Et.getXRSync(this.context)}onEnable(){var n,e;window.location.protocol!=="https:"&&Pi('<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API" target="_blank">WebXR</a> only works on secure connections (https).'),this.useQuicklookExport&&(ie.findObjectOfType(Dn)||(QE&&console.log("WebXR: Adding USDZExporter"),this._usdzExporter=ie.addComponent(this.gameObject,Dn),this._usdzExporter.objectToExport=this.context.scene,this._usdzExporter.autoExportAnimations=!0,this._usdzExporter.autoExportAudioSources=!0)),this.handleCreatingHTML(),this.handleOfferSession(),this.defaultAvatar===!0&&(QE&&console.warn("WebXR: No default avatar set, using static default avatar"),this.defaultAvatar=new $t("https://cdn.needle.tools/static/avatars/DefaultAvatar.glb")),this.defaultAvatar&&(this._playerSync=this.gameObject.getOrAddComponent(B0),this._playerSync.autoSync=!1),this._playerSync&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,(n=this._playerSync.onPlayerSpawned)==null||n.removeEventListener(this.onAvatarSpawned),(e=this._playerSync.onPlayerSpawned)==null||e.addEventListener(this.onAvatarSpawned))}onDisable(){var n;(n=this._usdzExporter)==null||n.destroy(),this.removeButtons()}async handleOfferSession(){return this.createVRButton&&await Et.isVRSupported()&&this.createVRButton?Et.offerSession("immersive-vr","default",this.context):this.createARButton&&await Et.isARSupported()&&this.createARButton?Et.offerSession("immersive-ar","default",this.context):!1}get session(){return Et.active??null}get sessionMode(){return Et.activeMode??null}async enterVR(n){return Et.start("immersive-vr",n,this.context)}async enterAR(n){return Et.start("immersive-ar",n,this.context)}exitXR(){Et.stop()}get isActiveWebXR(){return!$0.activeWebXRComponent||$0.activeWebXRComponent===this}onBeforeXR(n,e){var i;if(!this.isActiveWebXR){console.warn(`WebXR: another WebXR component is already active (${(i=$0.activeWebXRComponent)==null?void 0:i.name}). This is ignored: ${this.name}`);return}$0.activeWebXRComponent=this,n=="immersive-ar"&&this.useDepthSensing&&(e.optionalFeatures=e.optionalFeatures||[],e.optionalFeatures.push("depth-sensing"))}async onEnterXR(n){if(!this.isActiveWebXR)return;QE&&console.log("WebXR onEnterXR"),this._previousXRState=po.Global.Mask;const e=n.xr.isVR;if(po.Global.Set(e?wc.VR:wc.AR),this.usePlacementReticle&&n.xr.isAR){let i=ie.findObjectOfType($h);if(!i){const r=new ve;for(const s of this.context.scene.children)r.add(s);this.context.scene.add(r),i=ie.addComponent(r,$h),this._createdComponentsInSession.push(i)}i.customReticle=this.customARPlacementReticle,i.arScale=this.arScale,i.arTouchTransform=this.usePlacementAdjustment,i.autoPlace=this.autoPlace,i.autoCenter=this.autoCenter,i.useXRAnchor=this.useXRAnchor}this.useDefaultControls&&this.setDefaultMovementEnabled(!0),(this.showControllerModels||this.showHandModels)&&this.setDefaultControllerRenderingEnabled(!0),this.useSpatialGrab&&(this._spatialGrabRaycaster=ie.findObjectOfType(T0)??void 0,this._spatialGrabRaycaster||(this._spatialGrabRaycaster=this.gameObject.addComponent(T0))),this.createLocalAvatar(n.xr),this._exitXRMenuButton=this.context.menu.appendChild({label:"Quit XR",onClick:()=>this.exitXR(),icon:"exit_to_app",priority:2e4})}onUpdateXR(n){this.isActiveWebXR&&this._spatialGrabRaycaster&&(this._spatialGrabRaycaster.enabled=this.useSpatialGrab)}onLeaveXR(n){var e,i;if((e=this._exitXRMenuButton)==null||e.remove(),!!this.isActiveWebXR){po.Global.Set(this._previousXRState),(i=this._playerSync)==null||i.destroyInstance();for(const r of this._createdComponentsInSession)r.destroy();this._createdComponentsInSession.length=0,this.handleOfferSession(),r1(1).then(()=>$0.activeWebXRComponent=null)}}setDefaultMovementEnabled(n){let e=this.gameObject.getComponent(ha);return!e&&n&&(e=this.gameObject.addComponent(ha),this._createdComponentsInSession.push(e)),e&&(e.enabled=n),e}setDefaultControllerRenderingEnabled(n){let e=this.gameObject.getComponent(Dc);return!e&&n&&(e=this.gameObject.addComponent(Dc),this._createdComponentsInSession.push(e),e.createControllerModel=this.showControllerModels,e.createHandModel==this.showHandModels),e&&(e.enabled=n),e}async createLocalAvatar(n){this._playerSync&&n.running&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,await this._playerSync.getInstance())}getButtonsContainer(){return this.getButtonsFactory()}getButtonsFactory(){return this._buttonFactory||(this._buttonFactory=Kf.getOrCreate()),this._buttonFactory}handleCreatingHTML(){if(this.createARButton||this.createVRButton||this.useQuicklookExport){if((Lu()&&vg()||IAe)&&this.useQuicklookExport){const n=ie.findObjectOfType(Dn);if(!n||n&&n.allowCreateQuicklookButton){const e=this.getButtonsFactory().createQuicklookButton();this.addButton(e,50)}}if(this.createARButton){const n=this.getButtonsFactory().createARButton();this.addButton(n,50)}if(this.createVRButton){const n=this.getButtonsFactory().createVRButton();this.addButton(n,50)}}if(this.createSendToQuestButton&&!c1()&&Et.isVRSupported().then(n=>{if(!n){const e=this.getButtonsFactory().createSendToQuestButton();this.addButton(e,50)}}),this.createQRCode){const n=aC(kc);if(n&&n.createQRCodeButton===!1)it()&&console.warn("WebXR: QRCode button is disabled in the Needle Menu component");else{const e=Dh.getOrCreate().createQRCode();this.addButton(e,50)}}}addButton(n,e){this._buttons.push(n),n.setAttribute("priority",e.toString()),this.context.menu.appendChild(n)}removeButtons(){for(const n of this._buttons)n.remove();this._buttons.length=0}},p(hL,"activeWebXRComponent",null),hL);let On=$0;zr([C()],On.prototype,"createVRButton",2),zr([C()],On.prototype,"createARButton",2),zr([C()],On.prototype,"createSendToQuestButton",2),zr([C()],On.prototype,"createQRCode",2),zr([C()],On.prototype,"useDefaultControls",2),zr([C()],On.prototype,"showControllerModels",2),zr([C()],On.prototype,"showHandModels",2),zr([C()],On.prototype,"usePlacementReticle",2),zr([C($t)],On.prototype,"customARPlacementReticle",2),zr([C()],On.prototype,"usePlacementAdjustment",2),zr([C()],On.prototype,"arScale",2),zr([C()],On.prototype,"useXRAnchor",2),zr([C()],On.prototype,"autoPlace",2),zr([C()],On.prototype,"autoCenter",2),zr([C()],On.prototype,"useQuicklookExport",2),zr([C()],On.prototype,"useDepthSensing",2),zr([C()],On.prototype,"useSpatialGrab",2),zr([C($t)],On.prototype,"defaultAvatar",2);class WE{get extensionName(){return"Physics"}onExportObject(e,i,r){const s=ie.getComponents(e,Oi).filter(c=>c.enabled),o=ie.getComponents(e,oa).filter(c=>c.enabled&&!c.isTrigger);let a=s.length>0?s[0]:null;const l=o.length>0?o[0]:null;l&&!a&&(a=new Oi,a.isKinematic=!0),a&&i.addEventListener("serialize",(c,h)=>{var u,d,f;if(a){if(c.appendLine(),c.beginBlock('def RealityKitComponent "RigidBody"',"{",!0),a.useGravity||c.appendLine("bool gravityEnabled = 0"),c.appendLine('uniform token info:id = "RealityKit.RigidBody"'),a.isKinematic&&c.appendLine('token motionType = "Kinematic"'),c.beginBlock('def RealityKitStruct "massFrame"',"{",!0),c.appendLine(`float m_mass = ${a.mass}`),c.beginBlock('def RealityKitStruct "m_pose"',"{",!0),c.appendLine(`float3 position = (${a.centerOfMass.x}, ${a.centerOfMass.y}, ${a.centerOfMass.z})`),c.closeBlock("}"),c.closeBlock("}"),o.length>0){const m=o[0];c.beginBlock('def RealityKitStruct "material"',"{",!0);const g=m.sharedMaterial;g&&g.dynamicFriction!==void 0&&c.appendLine(`double dynamicFriction = ${(u=m.sharedMaterial)==null?void 0:u.dynamicFriction}`),g&&g.bounciness!==void 0&&c.appendLine(`double restitution = ${(d=m.sharedMaterial)==null?void 0:d.bounciness}`),g&&g.staticFriction!==void 0&&c.appendLine(`double staticFriction = ${(f=m.sharedMaterial)==null?void 0:f.staticFriction}`),c.closeBlock("}")}c.closeBlock("}")}}),l&&(i.addEventListener("serialize",(c,h)=>{var u;c.beginBlock('def RealityKitComponent "Collider"',"{",!0),c.appendLine("uint group = 1"),c.appendLine('uniform token info:id = "RealityKit.Collider"'),c.appendLine("uint mask = 4294967295");const d=l.isTrigger?"Trigger":"Default";if(c.appendLine(`token type = "${d}"`),c.beginBlock('def RealityKitStruct "Shape"',"{",!0),l instanceof L0){const f=l;c.appendLine('token shapeType = "Sphere"'),c.appendLine(`float radius = ${f.radius}`)}else if(l instanceof U0){const f=l;c.appendLine('token shapeType = "Box"'),c.appendLine(`float3 extent = (${f.size.x}, ${f.size.y}, ${f.size.z})`)}else if(l instanceof Vh){const f=l;c.appendLine('token shapeType = "Capsule"'),c.appendLine(`float radius = ${f.radius}`),c.appendLine(`float height = ${f.height}`)}else if(l instanceof jf&&(u=l.sharedMesh)!=null&&u.geometry){const f=l.sharedMesh.geometry;f.boundingBox||f.computeBoundingBox();const m=l.sharedMesh.geometry.boundingBox;m&&(c.appendLine('token shapeType = "Box"'),c.appendLine(`float3 extent = (${m.max.x-m.min.x}, ${m.max.y-m.min.y}, ${m.max.z-m.min.z})`),console.log("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. MeshCollider will be exported as Box",l))}else console.warn("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. Ignoring collider:",l);c.beginBlock('def RealityKitStruct "pose"',"{",!0),c.closeBlock("}"),c.closeBlock("}"),c.closeBlock("}")}),o.length>1&&console.log("WARNING: Multiple colliders detected. visionOS / iOS can only support objects with a single collider, only exporting the first collider: ",l))}}var RAe=Object.defineProperty,PAe=Object.getOwnPropertyDescriptor,eu=(n,e,i,r)=>{for(var s=r>1?void 0:r?PAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&RAe(e,i,s),s};const $f=te("debugtext");var Ar=(n=>(n[n.UpperLeft=0]="UpperLeft",n[n.UpperCenter=1]="UpperCenter",n[n.UpperRight=2]="UpperRight",n[n.MiddleLeft=3]="MiddleLeft",n[n.MiddleCenter=4]="MiddleCenter",n[n.MiddleRight=5]="MiddleRight",n[n.LowerLeft=6]="LowerLeft",n[n.LowerCenter=7]="LowerCenter",n[n.LowerRight=8]="LowerRight",n))(Ar||{}),iW=(n=>(n[n.Normal=0]="Normal",n[n.Bold=1]="Bold",n[n.Italic=2]="Italic",n[n.BoldAndItalic=3]="BoldAndItalic",n))(iW||{});class js extends Hf{constructor(){super(...arguments),p(this,"alignment",0),p(this,"verticalOverflow",0),p(this,"horizontalOverflow",0),p(this,"lineSpacing",1),p(this,"supportRichText",!1),p(this,"font"),p(this,"fontStyle",0),p(this,"sRGBTextColor",new be(1,0,1)),p(this,"_text",""),p(this,"_fontSize",12),p(this,"_textMeshUi",null),p(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(e){var i;super.setAlphaFactor(e),(i=this.uiObject)==null||i.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(e){e!==this._text&&(this._text=e,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(e){this.text=e}get fontSize(){return this._fontSize}set fontSize(e){var i;this._fontSize=e,(i=this.uiObject)==null||i.set({fontSize:e})}onColorChanged(){var e;this.sRGBTextColor.copy(this.color),this.sRGBTextColor.convertLinearToSRGB(),(e=this.uiObject)==null||e.set({color:this.sRGBTextColor,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(e){this.updateOverflow()}updateOverflow(){var e;const i=(e=this.uiObject)==null?void 0:e._overflow;i&&(i._needsUpdate=!0)}onCreate(e){$f&&console.log(this),this.horizontalOverflow==1&&(e.whiteSpace="pre"),this.verticalOverflow==0&&(this.context.renderer.localClippingEnabled=!0,e.overflow="hidden"),this.horizontalOverflow==1&&this.verticalOverflow==0,e.lineHeight=this.lineSpacing,delete e.backgroundOpacity,delete e.backgroundColor,$f&&(e.backgroundColor=16750848,e.backgroundOpacity=.5);const i=this.rectTransform;e={...e,...this.getTextOpts()},this.getAlignment(e),$f&&(e.backgroundColor=Math.random()*16777215,e.backgroundOpacity=.1),this.uiObject=i.createNewText(e),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const e=this.fontSize,i={color:this.color,fontOpacity:this.color.alpha,fontSize:e,fontKerning:"normal"};return this.setFont(i,this.fontStyle),i}onEnable(){var e;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(e=this.canvas)==null||e.registerEventReceiver(this)}onDisable(){var e;super.onDisable(),(e=this.canvas)==null||e.unregisterEventReceiver(this)}getAlignment(e){switch(e.flexDirection="column",this.alignment){case 0:case 3:case 6:e.textAlign="left";break;case 1:case 4:case 7:e.textAlign="center";break;case 2:case 5:case 8:e.textAlign="right";break}switch(this.alignment){default:case 0:case 1:case 2:e.alignItems="start";break;case 3:case 4:case 5:e.alignItems="center";break;case 6:case 7:case 8:e.alignItems="end";break}return e}feedText(e,i){var r,s,o;if($f&&console.log("feedText",this.uiObject,e,i),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!i||e.length===0)this.uiObject.textContent=e;else{let a=this.getNextTag(e);if(a){if(a.startIndex>0){for(let h=this.uiObject.children.length-1;h>=0;h--){const u=this.uiObject.children[h];u.isUI&&(this.uiObject.remove(u),u.clear())}const c=new w1({textContent:e.substring(0,a.startIndex),color:"inherit"});this.uiObject.add(c)}}else{this.uiObject.textContent="",this.setOptions({textContent:e});return}const l=[];for(;a;){const c=this.getNextTag(e,a.endIndex),h={fontFamily:(r=this.uiObject)==null?void 0:r.get("fontFamily"),color:"inherit",textContent:""};if(c){h.textContent=this.getText(e,a,c),this.handleTag(a,h,l);const u=new w1(h);(s=this.uiObject)==null||s.add(u)}else{h.textContent=e.substring(a.endIndex),this.handleTag(a,h,l);const u=new w1(h);(o=this.uiObject)==null||o.add(u)}a=c}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const e=[],i=this.canvas,r={renderOnTop:i.renderOnTop,depthWrite:i.depthWrite,doubleSided:i.doubleSided};for(;;){let s=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(e[o]===!0)continue;s=!0;const a=this._textMeshUi[o];a.textContent&&(eE(a,r),e[o]=!0)}if(!s)break;yield}}handleTag(e,i,r){if(!e.isEndTag){if(e.type.includes("color")){const s=new uL(e,{color:i.color});if(r.push(s),e.type.length>6){const o=parseInt("0x"+e.type.substring(7));i.color=o}else i.color=new be(1,1,1)}else if(e.type=="b"){this.setFont(i,1);const s=new uL(e,{fontWeight:700});r.push(s)}else if(e.type=="i"){this.setFont(i,2);const s=new uL(e,{fontStyle:"italic"});r.push(s)}}}getText(e,i,r){return e.substring(i.endIndex,r.startIndex)}getNextTag(e,i=0){const r=e.indexOf("<",i),s=e.indexOf(">",r);if(r>=0&&s>=0){const o=e.substring(r+1,s);return{type:o,startIndex:r,endIndex:s+1,isEndTag:o.startsWith("/")}}return null}setFont(e,i){if(!this.font)return;const r=this.font,s=this.getFamilyNameWithCorrectSuffix(r,i);$f&&console.log("Selected font family:"+s);let o=Y2.getFontFamily(s);switch(o||(o=Y2.addFontFamily(s)),e.fontFamily=o,i){default:case 0:e.fontWeight=400,e.fontStyle="normal";break;case 1:e.fontWeight=700,e.fontStyle="normal";break;case 2:e.fontWeight=400,e.fontStyle="italic";break;case 3:e.fontStyle="italic",e.fontWeight=400}let a=o.getVariant(e.fontWeight,e.fontStyle);if(!a){let l=s;l!=null&&l.endsWith("-msdf.json")||(l+="-msdf.json");let c=s;c!=null&&c.endsWith(".png")||(c+=".png"),a=o.addVariant(e.fontWeight,e.fontStyle,l,c),a?.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(e,i){var r;const s=e.lastIndexOf("-");if(s<0)return e;const o=(r=e.substring(s+1))==null?void 0:r.toLowerCase();if(BAe.includes(o))return $f&&console.warn("Unsupported font style: "+o),e;const a=e.lastIndexOf("/");let l=e;a>=0&&(l=l.substring(a+1));const c=l[0]===l[0].toUpperCase(),h=e.substring(0,s);switch($f&&console.log("Select font: ",e,iW[i],l,c,h),i){case 0:return c?h+"-Regular":h+"-regular";case 1:return c?h+"-Bold":h+"-bold";case 2:return c?h+"-Italic":h+"-italic";case 3:return c?h+"-BoldItalic":h+"-bolditalic";default:return e}}}eu([C()],js.prototype,"alignment",2),eu([C()],js.prototype,"verticalOverflow",2),eu([C()],js.prototype,"horizontalOverflow",2),eu([C()],js.prototype,"lineSpacing",2),eu([C()],js.prototype,"supportRichText",2),eu([C(URL)],js.prototype,"font",2),eu([C()],js.prototype,"fontStyle",2),eu([C()],js.prototype,"text",1),eu([C()],js.prototype,"fontSize",1);class uL{constructor(e,i){p(this,"tag"),p(this,"previousValues"),this.tag=e,this.previousValues=i}}const BAe=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];class Wd{constructor(e){p(this,"id"),p(this,"content",""),p(this,"font",[]),p(this,"pointSize",144),p(this,"width"),p(this,"height"),p(this,"depth"),p(this,"wrapMode"),p(this,"horizontalAlignment"),p(this,"verticalAlignment"),p(this,"material"),this.id=e}static getId(){return this.global_id++}setDepth(e){return this.depth=e,this}setPointSize(e){return this.pointSize=e,this}setHorizontalAlignment(e){return this.horizontalAlignment=e,this}setVerticalAlignment(e){return this.verticalAlignment=e,this}writeTo(e,i){var r;i.beginBlock(`def Preliminary_Text "${this.id}"`,"(",!1),i.appendLine('prepend apiSchemas = ["MaterialBindingAPI"]'),i.closeBlock(")"),i.beginBlock(),this.content&&i.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(r=this.font)==null||r.push("sans-serif"));const s=this.font.map(o=>`"${o}"`).join(", ");i.appendLine(`string[] font = [ ${s} ]`),i.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&i.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&i.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&i.appendLine(`double depth = ${this.depth}`),this.wrapMode&&i.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&i.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&i.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&i.appendLine(`rel material:binding = </StageRoot/Materials/${jO(this.material)}>`),i.closeBlock()}}p(Wd,"global_id",0);class XE{static singleLine(e,i,r){const s=new Wd("text_"+Wd.getId());return s.content=e,i&&(s.pointSize=i),r&&(s.depth=r),s}static multiLine(e,i,r,s,o,a){const l=new Wd("text_"+Wd.getId());return l.content=e,l.width=i,l.height=r,l.horizontalAlignment=s,l.verticalAlignment=o,a!==void 0&&(l.wrapMode=a),l}}const kAe=new he().makeRotationY(Math.PI),OAe=new he().makeScale(-1,1,-1);class ox{get extensionName(){return"text"}exportText(e,i,r){const s=ie.getComponent(e,js);if(!s)return;const o=ie.getComponent(e,zs);let a=100,l=100;o&&(a=o.width,l=o.height),i.matrix=kAe.clone(),o&&i.matrix.premultiply(OAe);const c=s.color.clone();i.material=new mr({color:c,emissive:c}),i.addEventListener("serialize",(h,u)=>{let d=s.text;d=d.replace(/\r/g,""),d=d.replace(/\n/g,"\\n");const f=XE.multiLine(d,a,l,"center","bottom","flowing");this.setTextAlignment(f,s.alignment),this.setOverflow(f,s),i.material&&(f.material=i.material),f.pointSize=this.convertToTextSize(s.fontSize),f.depth=.001,f.writeTo(void 0,h)})}convertToTextSize(e){return 1/.0502*144*e}setOverflow(e,i){i.horizontalOverflow?e.wrapMode="singleLine":e.wrapMode="flowing"}setTextAlignment(e,i){switch(i){case Ar.LowerLeft:case Ar.MiddleLeft:case Ar.UpperLeft:e.horizontalAlignment="left";break;case Ar.LowerCenter:case Ar.MiddleCenter:case Ar.UpperCenter:e.horizontalAlignment="center";break;case Ar.LowerRight:case Ar.MiddleRight:case Ar.UpperRight:e.horizontalAlignment="right";break}switch(i){case Ar.LowerLeft:case Ar.LowerCenter:case Ar.LowerRight:e.verticalAlignment="bottom";break;case Ar.MiddleLeft:case Ar.MiddleCenter:case Ar.MiddleRight:e.verticalAlignment="middle";break;case Ar.UpperLeft:case Ar.UpperCenter:case Ar.UpperRight:e.verticalAlignment="top";break}}}class qE{get extensionName(){return"tmui"}onExportObject(e,i,r){const s=ie.getComponent(e,ls);if(s&&s.enabled&&s.renderMode===x9.WorldSpace){const o=new ox,a=ie.getComponent(e,zs),l=ie.getComponent(e,Ld),c=new Array;if(a){if(!ie.isActiveSelf(e)){const d=ie.isActiveSelf(e);ie.setActive(e,!0),a.onEnable(),a.updateTransform(),c.push(()=>{a.onDisable(),ie.setActive(e,d)})}e.traverse(d=>{if(!ie.isActiveInHierarchy(d)){const f=ie.isActiveSelf(d);ie.setActive(d,!0);const m=ie.getComponent(d,nl);m&&(m.onEnable(),c.push(()=>{m.onDisable()}));const g=ie.getComponent(d,zs);g&&(g.onEnable(),g.updateTransform(),g.onApplyTransform(),c.push(()=>{g.onDisable()}));const v=ie.getComponent(d,js);v&&(v.onEnable(),c.push(()=>{v.onDisable()})),c.push(()=>{ie.setActive(d,f)})}}),a.width,a.height;const h=co.createEmpty(),u=a.shadowComponent;if(i.add(h),u){const d=u.matrix;h.matrix.copy(d);const f=new Map,m=new Map;f.set(u,h),m.set(u,l?l.alpha:1),u.traverse(g=>{if(g===u)return;const v=co.createEmpty();v.matrix.copy(g.matrix);const y=g.parent,A=!!y&&typeof y.textContent=="string"&&y.textContent.length>0;let b=m.get(y)||1;const x=ie.getComponent(g,Ld);if(x&&(b*=x.alpha),g instanceof pe&&A){const w=g[Ga];w?o.exportText(w.gameObject,v,r):console.error("Error when exporting UI: shadow component owner not found. This is likely a bug.",g)}if(g instanceof pe&&!A){const w=g.geometry.clone();w.scale(1,1,-1),this.flipWindingOrder(w),v.geometry=w;const T=new be,M=g.material.opacity;T.copy(g.material.color),v.material=new Jt({color:T,opacity:M*b,map:g.material.map,transparent:!0})}f.set(g,v),m.set(g,b);const _=f.get(y);if(!_){console.error("Error when exporting UI: shadow component parent not found!",g,g.parent);return}_.add(v)})}}for(const h of c)h()}}flipWindingOrder(e){const i=e.index.array;for(let r=0,s=i.length/3;r<s;r++){const o=i[r*3];i[r*3]=i[r*3+2],i[r*3+2]=o}e.index.needsUpdate=!0}}const ax=te("debugusdz");function DAe(n,e){var i;const r=[],s=ie.getComponentsInChildren(n,rs),o=ie.getComponentsInChildren(n,Fs),a=new Array,l=new Array;if(e.injectImplicitBehaviours)for(const c of s){if(!c||!c.runtimeAnimatorController||!c.enabled)continue;const h=c.runtimeAnimatorController.activeState;if(!h||!h.motion||!h.motion.clip||((i=h.motion.clip.tracks)==null?void 0:i.length)<1||a.includes(c))continue;const u=new Xf;u.animator=c,u.stateName=h.name,u.trigger="start",u.name="PlayAnimationOnClick_implicitAtStart_"+u.stateName;const d=new ve;ie.addComponent(d,u),l.push(d),a.push(c),n.add(d)}else for(const c of s){if(!c||!c.runtimeAnimatorController||!c.enabled)continue;ax&&console.log(c);const h=[];for(const u of c.runtimeAnimatorController.enumerateActions()){ax&&console.log(u);const d=u.getClip();h.includes(d)||h.push(d)}r.push({root:c.gameObject,clips:h})}if(e.injectImplicitBehaviours)for(const c of o){if(!c||!c.clip||!c.enabled||!c.playAutomatically||a.includes(c))continue;const h=new Xf;h.animation=c,h.stateName=c.clip.name,h.trigger="start",h.name="PlayAnimationOnClick_implicitAtStart_"+h.stateName;const u=new ve;ie.addComponent(u,h),l.push(u),a.push(c),n.add(u)}else for(const c of o){ax&&console.log(c);const h=[];for(const u of c.animations)h.includes(u)||h.push(u);r.push({root:c.gameObject,clips:h})}ax&&r?.length>0&&console.log("USDZ Animation Clips without behaviours",r);for(const c of r)for(const h of c.clips)e.registerAnimation(c.root,h);return l}function LAe(n,e){const i=ie.getComponentsInChildren(n,Pn),r=ie.getComponentsInChildren(n,Ud),s=new Array,o=new Array;ax&&console.log({audioSources:i,playAudioOnClicks:r});for(const a of r){if(!a.target)continue;const l=i.indexOf(a.target);l>-1&&i.splice(l,1)}for(const a of i){if(!a||!a.clip||a.volume<=0||s.includes(a))continue;const l=new Ud;l.target=a,l.name="PlayAudioOnClick_implicitAtStart_",l.trigger="start";const c=new ve;ie.addComponent(c,l),console.log("implicit PlayAudioOnStart",c,l),o.push(c),s.push(a),n.add(c)}return o}function UAe(n){return new kr("DisableAtStart",Or.sceneStartTrigger(),Ai.fadeAction(n,0,!1))}function nW(n){const e=n.domElement.shadowRoot.querySelector("link[rel='ar']");if(e)return e;const i=document.createElement("div");i.classList.add("menu"),i.classList.add("quicklook-menu"),i.style.display="none",i.style.visibility="hidden";const r=document.createElement("button");r.id="open-in-ar",r.innerText="Open in QuickLook",i.appendChild(r);const s=document.createElement("a");s.id="needle-usdz-link",s.style.display="none",s.rel="ar",s.href="",i.appendChild(s);const o=document.createElement("img");return o.id="button",s.appendChild(o),n.domElement.shadowRoot.appendChild(i),s}var FAe=Object.defineProperty,NAe=Object.getOwnPropertyDescriptor,Gs=(n,e,i,r)=>{for(var s=r>1?void 0:r?NAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&FAe(e,i,s),s};const Xa=te("debugusdz");class Xd{constructor(){p(this,"callToAction"),p(this,"checkoutTitle"),p(this,"checkoutSubtitle"),p(this,"callToActionURL")}}Gs([C()],Xd.prototype,"callToAction",2),Gs([C()],Xd.prototype,"checkoutTitle",2),Gs([C()],Xd.prototype,"checkoutSubtitle",2),Gs([C()],Xd.prototype,"callToActionURL",2);var YE;const dL=(YE=class extends Be{constructor(){super(...arguments),p(this,"objectToExport"),p(this,"autoExportAnimations",!0),p(this,"autoExportAudioSources",!0),p(this,"exportFileName"),p(this,"customUsdzFile"),p(this,"customBranding"),p(this,"anchoringType","plane"),p(this,"maxTextureSize",2048),p(this,"planeAnchoringAlignment","horizontal"),p(this,"interactive",!0),p(this,"allowCreateQuicklookButton",!0),p(this,"quickLookCompatible",!0),p(this,"extensions",[]),p(this,"link"),p(this,"button"),p(this,"onClickedOpenInARElement",n=>{n.preventDefault(),this.exportAndOpen()}),p(this,"_currentExportTasks",new Map),p(this,"_previousTimeScale",1),p(this,"lastCallback"),p(this,"_rootSessionRootWasAppliedTo",null),p(this,"_rootPositionBeforeExport",new S),p(this,"_rootRotationBeforeExport",new Ce),p(this,"_rootScaleBeforeExport",new S)}start(){var n,e,i;Xa&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",r=>{switch(r.key){case"t":this.exportAsync();break}}),ec()&&setTimeout(()=>{this.exportAsync()},2e3)),this.objectToExport||(this.objectToExport=this.gameObject),!((e=(n=this.objectToExport)==null?void 0:n.children)!=null&&e.length)&&!((i=this.objectToExport)!=null&&i.isMesh)&&(this.objectToExport=this.context.scene),this.interactive&&(this.extensions.push(new gE),this.extensions.push(new hp),this.extensions.push(new WE),this.extensions.push(new ox),this.extensions.push(new qE))}onEnable(){var n;const e=Lu(),i=vg();(Xa||e&&i)&&(this.allowCreateQuicklookButton&&(this.button=this.createQuicklookButton()),this.lastCallback=this.quicklookCallback.bind(this),this.link=nW(this.context),this.link.addEventListener("message",this.lastCallback)),Xa&&dn("USDZ Exporter enabled: "+this.name),(n=document.getElementById("open-in-ar"))==null||n.addEventListener("click",this.onClickedOpenInARElement)}onDisable(){var n,e,i;(n=this.button)==null||n.remove(),(e=this.link)==null||e.removeEventListener("message",this.lastCallback),Xa&&dn("USDZ Exporter disabled: "+this.name),(i=document.getElementById("open-in-ar"))==null||i.removeEventListener("click",this.onClickedOpenInARElement)}async exportAsync(){return this.exportAndOpen()}async exportAndOpen(){var n;let e=this.exportFileName??((n=this.objectToExport)==null?void 0:n.name)??this.name;if(e+="-"+fQ(),md()||(e!==""&&(e+="-"),e+="MadeWithNeedle"),this.link||(this.link=nW(this.context)),this.customUsdzFile)return Xa&&console.log("Exporting custom usdz",this.customUsdzFile),this.openInQuickLook(this.customUsdzFile,e),null;if(!this.objectToExport)return console.warn("No object to export",this),null;const i=await this.export(this.objectToExport);return i?(Xa&&console.log("USDZ generation done. Downloading as "+e),this.openInQuickLook(i,e),i):(console.error("USDZ generation failed. Please report a bug",this),null)}async export(n){if(!n)return console.warn("No object to export"),null;const e=this._currentExportTasks.get(n);if(e)return e;const i=this.internalExport(n);return i instanceof Promise?(this._currentExportTasks.set(n,i),i.then(r=>(this._currentExportTasks.delete(n),r)).catch(r=>(this._currentExportTasks.delete(n),console.error("Error during USDZ export \u2013 please report a bug!",r),null))):i}async internalExport(n){si.start("export-usdz",{onProgress:y=>{this.dispatchEvent(new CustomEvent("export-progress",{detail:{progress:y}}))}}),si.report("export-usdz",{message:"Starting export",totalSteps:40,currentStep:0}),si.report("export-usdz",{message:"Load progressive textures",autoStep:5}),si.start("export-usdz-textures","export-usdz");const e=ie.getComponentsInChildren(n,Bo);for(const y of e)y&&y.enabled&&y.updateSprite(!0);const i=ie.getComponentsInChildren(n,Bn),r=new Array;let s=0;for(const y of i){for(const A of y.sharedMeshes)if(A){const b=mi.assignMeshLOD(A,0);b instanceof Promise&&r.push(new Promise((x,_)=>{b.then(()=>{s++,si.report("export-usdz-textures",{message:"Loaded progressive mesh",currentStep:s,totalSteps:r.length}),x()}).catch(w=>_(w))}))}for(const A of y.sharedMaterials)if(A){const b=mi.assignTextureLOD(A,0);b instanceof Promise&&r.push(new Promise((x,_)=>{b.then(()=>{s++,si.report("export-usdz-textures",{message:"Loaded progressive texture",currentStep:s,totalSteps:r.length}),x()}).catch(w=>_(w))}))}}Xa&&dn("Progressive Loading: "+r.length),await Promise.all(r),Xa&&dn("Progressive Loading: done"),si.end("export-usdz-textures");const o=po.Global.Mask;po.Global.Set(wc.AR);const a=new AQ,l=new Ib(this.quickLookCompatible),c=[l,...this.extensions],h={self:this,exporter:a,extensions:c,object:n};si.report("export-usdz","Invoking before-export"),this.dispatchEvent(new CustomEvent("before-export",{detail:h})),this.applyWebARSessionRoot(),this._previousTimeScale=this.context.time.timeScale,this.context.time.timeScale=0,si.report("export-usdz","auto export animations and audio sources");const u=new Array;this.autoExportAnimations&&u.push(...DAe(n,l)),this.extensions.find(y=>y.extensionName==="Audio")&&this.autoExportAudioSources&&u.push(...LAe(n)),a.debug=Xa,a.keepObject=y=>{const A=ie.getComponent(y,Bn);return!(A&&!A.enabled)};const d=new Array;this.objectToExport&&this.quickLookCompatible&&this.interactive&&this.objectToExport.traverse(y=>{y.visible||d.push(y)});const f=this.extensions.find(y=>y.extensionName==="Behaviour");this.interactive&&f&&d.length>0&&f.addBehavior(UAe(d));let m=!0;this.quickLookCompatible&&!this.interactive&&(m=!1),this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal"),si.report("export-usdz","Invoking exporter.parse");const g=await a.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:c,quickLookCompatible:this.quickLookCompatible,maxTextureSize:this.maxTextureSize,exportInvisible:m}),v=new Blob([g],{type:"model/vnd.usdz+zip"});this.revertWebARSessionRoot(),this.context.time.timeScale=this._previousTimeScale,si.report("export-usdz","Invoking after-export"),this.dispatchEvent(new CustomEvent("after-export",{detail:h}));for(const y of u)ie.destroy(y);return po.Global.Set(o),si.end("export-usdz"),v}openInQuickLook(n,e){const i=n instanceof Blob?URL.createObjectURL(n):n,r=this.buildQuicklookOverlay();Xa&&console.log("QuickLook Overlay",r);const s=r.callToAction?encodeURIComponent(r.callToAction):"",o=r.checkoutTitle?encodeURIComponent(r.checkoutTitle):"",a=r.checkoutSubtitle?encodeURIComponent(r.checkoutSubtitle):"";this.link.href=i+`#callToAction=${s}&checkoutTitle=${o}&checkoutSubtitle=${a}&callToActionURL=${r.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=e+".usdz",this.link.click()}download(n,e){dL.save(n,e)}static save(n,e){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof n=="string"?i.href=n:i.href=URL.createObjectURL(n),i.download=e,i.click(),i.remove()}quicklookCallback(n){if(n?.data=="_apple_ar_quicklook_button_tapped"){Xa&&Pi("Quicklook closed via call to action button");var e=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(e),!e.defaultPrevented){const i=new URLSearchParams(this.link.href);if(i){const r=i.get("callToActionURL");Xa&&dn("Quicklook url: "+r),r&&(md()?globalThis.open(r,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",r))}}}}buildQuicklookOverlay(){var n,e,i,r,s,o;const a={};return this.customBranding&&Object.assign(a,this.customBranding),md()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),a.callToAction="Close",a.checkoutTitle="\u{1F335} Made with Needle",a.checkoutSubtitle="_"),(((n=a.callToAction)==null?void 0:n.length)||((e=a.checkoutTitle)==null?void 0:e.length)||((i=a.checkoutSubtitle)==null?void 0:i.length))&&((r=a.callToAction)!=null&&r.length||(a.callToAction="\0"),(s=a.checkoutTitle)!=null&&s.length||(a.checkoutTitle="\0"),(o=a.checkoutSubtitle)!=null&&o.length||(a.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:a})),a}getARScaleAndTarget(){if(!this.objectToExport)return{scale:1,_invertForward:!1,target:this.gameObject,sessionRoot:null};let n=ie.getComponentInParent(this.objectToExport,$h);n||(n=ie.getComponentInChildren(this.objectToExport,$h));let e=1,i=!1;const r=this.objectToExport;if(n)e=n.arScale,i=n.invertForward;else{const s=ie.findObjectOfType(On);s&&(e=s.arScale)}return{scale:1/e,_invertForward:i,target:r,sessionRoot:n?.gameObject??null}}applyWebARSessionRoot(){if(!this.objectToExport)return;const{scale:n,_invertForward:e,target:i,sessionRoot:r}=this.getARScaleAndTarget(),s=r?.matrixWorld.clone().invert();this._rootSessionRootWasAppliedTo=i,this._rootPositionBeforeExport.copy(i.position),this._rootRotationBeforeExport.copy(i.quaternion),this._rootScaleBeforeExport.copy(i.scale),i.scale.multiplyScalar(n),e&&i.quaternion.multiply(dL.invertForwardQuaternion),i.updateMatrix(),i.updateMatrixWorld(!0),r&&s&&i.matrix.premultiply(s)}revertWebARSessionRoot(){if(!this.objectToExport||!this._rootSessionRootWasAppliedTo)return;const n=this._rootSessionRootWasAppliedTo;n.position.copy(this._rootPositionBeforeExport),n.quaternion.copy(this._rootRotationBeforeExport),n.scale.copy(this._rootScaleBeforeExport),n.updateMatrix(),n.updateMatrixWorld(!0),this._rootSessionRootWasAppliedTo=null}createQuicklookButton(){const n=Kf.getOrCreate().createQuicklookButton();return n.parentNode||this.context.menu.appendChild(n),n}},p(YE,"invertForwardMatrix",new he().makeRotationY(Math.PI)),p(YE,"invertForwardQuaternion",new Ce().setFromEuler(new ri(0,Math.PI,0))),YE);let Dn=dL;Gs([C(ve)],Dn.prototype,"objectToExport",2),Gs([C()],Dn.prototype,"autoExportAnimations",2),Gs([C()],Dn.prototype,"autoExportAudioSources",2),Gs([C()],Dn.prototype,"exportFileName",2),Gs([C(URL)],Dn.prototype,"customUsdzFile",2),Gs([C(Xd)],Dn.prototype,"customBranding",2),Gs([C()],Dn.prototype,"anchoringType",2),Gs([C()],Dn.prototype,"maxTextureSize",2),Gs([C()],Dn.prototype,"planeAnchoringAlignment",2),Gs([C()],Dn.prototype,"interactive",2),Gs([C()],Dn.prototype,"allowCreateQuicklookButton",2),Gs([C()],Dn.prototype,"quickLookCompatible",2);class lx extends Be{constructor(){super(...arguments),p(this,"isUsed",!0),p(this,"usedBy",null)}}class pL extends Be{}const rW=te("debugdeletable");class JE extends Mc{}class fL extends Be{constructor(){super(...arguments),p(this,"deleteBoxes",[])}awake(){this.deleteBoxes=ie.findObjectsOfType(JE,this.context)}update(){for(const e of this.deleteBoxes){const i=this.gameObject;if(e.isInBox(i)===!0){const r=ie.getComponentInParent(this.gameObject,lx);r?rW&&console.warn("Can not delete object with usage marker",this.guid,r):(rW&&console.log("DESTROY",this.gameObject),HA(this.gameObject,this.context.connection))}}}}var zAe=Object.defineProperty,jAe=Object.getOwnPropertyDescriptor,em=(n,e,i,r)=>{for(var s=r>1?void 0:r?jAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&zAe(e,i,s),s};const GAe=te("debugpost");class Ul extends ss{constructor(){super(...arguments),p(this,"mode"),p(this,"focusDistance",new Ke(1)),p(this,"focalLength",new Ke(.2)),p(this,"aperture",new Ke(20)),p(this,"gaussianMaxRadius",new Ke),p(this,"resolutionScale",new Ke(1*1/window.devicePixelRatio)),p(this,"bokehScale",new Ke)}get typeName(){return"DepthOfField"}init(){this.focalLength.valueProcessor=i=>{const r=i/300,s=2;return tt.lerp(s,.01,r)};const e=20;this.aperture.valueProcessor=i=>{const r=1-i/32;return tt.lerp(1,e,r)}}onCreateEffect(){if(this.mode===0){GAe&&console.warn("DepthOfField: Mode is set to Off");return}const e=new Zj(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=i=>{e.cocMaterial.worldFocusDistance=i},this.focalLength.onValueChanged=i=>e.cocMaterial.worldFocusRange=i,this.aperture.onValueChanged=i=>e.bokehScale=i,this.resolutionScale&&(this.resolutionScale.onValueChanged=i=>e.resolution.scale=i),[e]}unapply(){}}em([C()],Ul.prototype,"mode",2),em([C(Ke)],Ul.prototype,"focusDistance",2),em([C(Ke)],Ul.prototype,"focalLength",2),em([C(Ke)],Ul.prototype,"aperture",2),em([C(Ke)],Ul.prototype,"gaussianMaxRadius",2),em([C(Ke)],Ul.prototype,"resolutionScale",2),em([C(Ke)],Ul.prototype,"bokehScale",2),Qa("DepthOfField",Ul);var HAe=Object.defineProperty,VAe=Object.getOwnPropertyDescriptor,QAe=(n,e,i,r)=>{for(var s=r>1?void 0:r?VAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&HAe(e,i,s),s};class KE extends Be{constructor(){super(...arguments),p(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||ie.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:ec()?(this.visibleOn&2)!==0:(this.visibleOn&1)!==0}}QAe([C()],KE.prototype,"visibleOn",2);class mL{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(e){}}var WAe=Object.defineProperty,XAe=Object.getOwnPropertyDescriptor,tm=(n,e,i,r)=>{for(var s=r>1?void 0:r?XAe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&WAe(e,i,s),s};const Nc=te("debugdrag");var gL=(n=>(n[n.XZPlane=0]="XZPlane",n[n.Attached=1]="Attached",n[n.HitNormal=2]="HitNormal",n[n.DynamicViewAngle=3]="DynamicViewAngle",n[n.SnapToSurfaces=4]="SnapToSurfaces",n[n.None=5]="None",n))(gL||{}),ZE;const tu=(ZE=class extends Be{constructor(){super(...arguments),p(this,"dragMode",3),p(this,"snapGridResolution",0),p(this,"keepRotation",!0),p(this,"xrDragMode",1),p(this,"xrKeepRotation",!1),p(this,"xrDistanceDragFactor",1),p(this,"showGizmo",!1),p(this,"targetObject",null),p(this,"_dragHelper",null),p(this,"_draggingRigidbodies",[]),p(this,"_potentialDragStartEvt",null),p(this,"_dragHandlers",new Map),p(this,"_totalMovement",new S),p(this,"_marker",null),p(this,"_isDragging",!1),p(this,"_didDrag",!1)}static get HasAnySelected(){return this._active>0}setTargetObject(n){this.targetObject=n;for(const e of this._dragHandlers.values())e.setTargetObject(n)}awake(){this._potentialDragStartEvt=null,this._dragHandlers=new Map,this._totalMovement=new S,this._marker=null,this._isDragging=!1,this._didDrag=!1,this._dragHelper=null,this._draggingRigidbodies=[]}start(){this.gameObject.getComponentInParent(ta)||this.gameObject.addComponent(ta)}allowEdit(n=null){return this.context.connection.allowEditing}onPointerEnter(n){if(!this.allowEdit(this.gameObject)||n.mode!=="screen"||(n.event.mode==="tracked-pointer"||n.event.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===5)return;const e=ie.getComponentInParent(n.object,tu);!e||e!==this||(tu.lastHovered=n.object,this.context.domElement.style.cursor="pointer")}onPointerExit(n){this.allowEdit(this.gameObject)&&n.mode==="screen"&&tu.lastHovered===n.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(n){if(!(!this.allowEdit(this.gameObject)||n.used||(n.mode==="tracked-pointer"||n.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===5)&&(tu.lastHovered=n.object,n.button===0)){this._dragHandlers.size===0&&(this._didDrag=!1,this._totalMovement.set(0,0,0),this._potentialDragStartEvt=n),tu._active+=1;const e=new YAe(this,this.targetObject||this.gameObject);if(this._dragHandlers.set(n.event.space,e),e.onDragStart(n),this._dragHandlers.size===2){const i=this._dragHandlers.values(),r=i.next().value,s=i.next().value,o=new qAe(this,this.targetObject||this.gameObject,r,s);this._dragHandlers.set(this.gameObject,o),o.onDragStart(n)}n.use()}}onPointerMove(n){(this._isDragging||this._potentialDragStartEvt!==null)&&n.use()}onPointerUp(n){if(Nc&&yt.DrawLabel(n.point??this.gameObject.worldPosition,"POINTERUP:"+n.pointerId+", "+n.button,.03,3),!this.allowEdit(this.gameObject)||n.button!==0)return;this._potentialDragStartEvt=null;const e=this._dragHandlers.get(n.event.space),i=this._dragHandlers.get(this.gameObject);i&&(i.handlerA===e||i.handlerB===e)&&(this._dragHandlers.delete(this.gameObject),i.onDragEnd(n)),e&&(tu._active>0&&(tu._active-=1),e.onDragEnd&&e.onDragEnd(n),this._dragHandlers.delete(n.event.space),this._dragHandlers.size===0&&this.onLastDragEnd(n),n.use())}update(){for(const n of this._dragHandlers.values())n.collectMovementInfo&&n.collectMovementInfo(),n.getTotalMovement&&this._totalMovement.add(n.getTotalMovement());if(this._potentialDragStartEvt){if(!this._didDrag)if(this._totalMovement.length()>3e-4)this._didDrag=!0;else return;const n=this._potentialDragStartEvt;this._potentialDragStartEvt=null,this.onFirstDragStart(n)}for(const n of this._dragHandlers.values())n.onDragUpdate&&n.onDragUpdate(this._dragHandlers.size);this._dragHelper&&this._dragHelper.hasSelected&&this.onAnyDragUpdate()}onFirstDragStart(n){if(!n||!n.object)return;const e=ie.getComponentInParent(n.object,tu);if(!e||e!==this&&e._isDragging)return;const i=this.targetObject||this.gameObject;if(!i)return;this._isDragging=!0;const r=ie.getComponentInChildren(i,vc);Nc&&console.log("DRAG START",r,i),r&&(r.fastMode=!0,r?.requestOwnership()),this._marker=ie.addComponent(i,lx),this._draggingRigidbodies.length=0;const s=ie.getComponentsInChildren(i,Oi);s&&this._draggingRigidbodies.push(...s)}onAnyDragUpdate(){if(!this._dragHelper)return;this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.onUpdate(this.context);for(const e of this._draggingRigidbodies)e.wakeUp(),e.resetVelocities(),e.resetForcesAndTorques();const n=this.targetObject||this.gameObject;rl.markDirty(n)}onLastDragEnd(n){if(!this||!this._isDragging||(this._isDragging=!1,!this._dragHelper))return;for(const i of this._draggingRigidbodies)i.setVelocity(i.smoothedVelocity);this._draggingRigidbodies.length=0;const e=this._dragHelper.selected;if(Nc&&console.log("DRAG END",e,e?.visible),this._dragHelper.setSelected(null,this.context),n!=null&&n.object){const i=ie.getComponentInChildren(n.object,vc);i&&(i.fastMode=!1)}this._marker&&this._marker.destroy()}},p(ZE,"_active",0),p(ZE,"lastHovered"),ZE);let ko=tu;tm([C()],ko.prototype,"dragMode",2),tm([C()],ko.prototype,"snapGridResolution",2),tm([C()],ko.prototype,"keepRotation",2),tm([C()],ko.prototype,"xrDragMode",2),tm([C()],ko.prototype,"xrKeepRotation",2),tm([C()],ko.prototype,"xrDistanceDragFactor",2),tm([C()],ko.prototype,"showGizmo",2);class qAe{constructor(e,i,r,s){p(this,"handlerA"),p(this,"handlerB"),p(this,"context"),p(this,"settings"),p(this,"gameObject"),p(this,"_handlerAAttachmentPoint",new S),p(this,"_handlerBAttachmentPoint",new S),p(this,"_followObject"),p(this,"_manipulatorObject"),p(this,"_deviceMode"),p(this,"_followObjectStartWorldQuaternion",new Ce),p(this,"_manipulatorPosOffset",new S),p(this,"_manipulatorRotOffset",new Ce),p(this,"_manipulatorScaleOffset",new S),p(this,"_tempVec1",new S),p(this,"_tempVec2",new S),p(this,"_tempVec3",new S),p(this,"tempLookMatrix",new he),p(this,"_initialScale",new S),p(this,"_initialDistance",0);var o,a;this.context=e.context,this.settings=e,this.gameObject=i,this.handlerA=r,this.handlerB=s,this._followObject=new ve,this._manipulatorObject=new ve,this.context.scene.add(this._manipulatorObject);const l=(a=(o=Et.active)==null?void 0:o.rig)==null?void 0:a.gameObject;if(!this.handlerA||!this.handlerB||!this.handlerA.hitPointInLocalSpace||!this.handlerB.hitPointInLocalSpace){console.error("Invalid: MultiTouchDragHandler needs two valid DragPointerHandlers with hitPointInLocalSpace set.");return}if(this._tempVec1.copy(this.handlerA.hitPointInLocalSpace),this._tempVec2.copy(this.handlerB.hitPointInLocalSpace),this.gameObject.localToWorld(this._tempVec1),this.gameObject.localToWorld(this._tempVec2),l&&(l.worldToLocal(this._tempVec1),l.worldToLocal(this._tempVec2)),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.02?(Nc&&console.log("Finding alternative drag attachment points since initial distance is too low: "+this._initialDistance.toFixed(2)),this.handlerA.followObject.parent.getWorldPosition(this._tempVec1),this.handlerB.followObject.parent.getWorldPosition(this._tempVec2),this._handlerAAttachmentPoint.copy(this._tempVec1),this._handlerBAttachmentPoint.copy(this._tempVec2),this.gameObject.worldToLocal(this._handlerAAttachmentPoint),this.gameObject.worldToLocal(this._handlerBAttachmentPoint),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.001&&(console.warn("Not supported right now \u2013 controller drag points for multitouch are too close!"),this._initialDistance=1)):(this._handlerAAttachmentPoint.copy(this.handlerA.hitPointInLocalSpace),this._handlerBAttachmentPoint.copy(this.handlerB.hitPointInLocalSpace)),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._initialScale.copy(i.scale),Nc){this._followObject.add(new Vo(2)),this._manipulatorObject.add(new Vo(5));const c=h=>`${h.x.toFixed(2)}, ${h.y.toFixed(2)}, ${h.z.toFixed(2)}`;yt.DrawLine(this._tempVec1,this._tempVec2,65535,0,!1),yt.DrawLabel(this._tempVec3,"A:B "+this._initialDistance.toFixed(2)+`
`+c(this._tempVec1)+`
`+c(this._tempVec2),.03,5)}}onDragStart(e){this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.matrix.identity(),this._deviceMode=e.mode,this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this.alignManipulator(),this._manipulatorObject.attach(this._followObject),this._manipulatorPosOffset.copy(this._followObject.position),this._manipulatorRotOffset.copy(this._followObject.quaternion),this._manipulatorScaleOffset.copy(this._followObject.scale)}onDragEnd(e){if(!this.handlerA||!this.handlerB){console.error("onDragEnd called on MultiTouchDragHandler without valid handlers. This is likely a bug.");return}this.handlerA.recenter(),this.handlerB.recenter(),this._manipulatorObject.removeFromParent(),this._followObject.removeFromParent(),this._manipulatorObject.destroy(),this._followObject.destroy()}alignManipulator(){if(!this.handlerA||!this.handlerB){console.error("alignManipulator called on MultiTouchDragHandler without valid handlers. This is likely a bug.",this);return}if(!this.handlerA.followObject||!this.handlerB.followObject){console.error("alignManipulator called on MultiTouchDragHandler without valid follow objects. This is likely a bug.",this.handlerA,this.handlerB);return}this._tempVec1.copy(this._handlerAAttachmentPoint),this._tempVec2.copy(this._handlerBAttachmentPoint),this.handlerA.followObject.localToWorld(this._tempVec1),this.handlerB.followObject.localToWorld(this._tempVec2),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._manipulatorObject.position.copy(this._tempVec3);const e=this.context.mainCamera;this.tempLookMatrix.lookAt(this._tempVec3,this._tempVec2,e.worldUp),this._manipulatorObject.quaternion.setFromRotationMatrix(this.tempLookMatrix);const i=this._tempVec1.distanceTo(this._tempVec2);this._manipulatorObject.scale.copy(this._initialScale).multiplyScalar(i/this._initialDistance),this._manipulatorObject.updateMatrix(),this._manipulatorObject.updateMatrixWorld(!0),Nc&&(yt.DrawLabel(this._tempVec3.clone().add(new S(0,.2,0)),"A:B "+i.toFixed(2),.03),yt.DrawLine(this._tempVec1,this._tempVec2,65280,0,!1))}onDragUpdate(){this.alignManipulator();const e=30,i=1;this._followObject.position.copy(this._manipulatorPosOffset),this._followObject.quaternion.copy(this._manipulatorRotOffset),this._followObject.scale.copy(this._manipulatorScaleOffset);const r=this.gameObject,s=this._followObject;s.updateMatrix(),s.updateMatrixWorld(!0);const o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrKeepRotation:this.settings.keepRotation;if(this.settings.snapGridResolution>0){const u=this._followObject.worldPosition,d=this.settings.snapGridResolution;u.x=Math.round(u.x/d)*d,u.y=Math.round(u.y/d)*d,u.z=Math.round(u.z/d)*d,this._followObject.worldPosition=u,this._followObject.updateMatrix()}o&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const a=tt.clamp01(this.context.time.deltaTime*e*i),l=r.worldPosition;l.lerp(s.worldPosition,a),r.worldPosition=l;const c=r.worldQuaternion;c.slerp(s.worldQuaternion,a),r.worldQuaternion=c;const h=r.worldScale;h.lerp(s.worldScale,a),r.worldScale=h}setTargetObject(e){this.gameObject=e}}class YAe{constructor(e,i){p(this,"context"),p(this,"gameObject"),p(this,"settings"),p(this,"_lastRig"),p(this,"_followObject"),p(this,"_totalMovement",new S),p(this,"_totalMovementAlongRayDirection",0),p(this,"_grabStartDistance",0),p(this,"_deviceMode"),p(this,"_followObjectStartPosition",new S),p(this,"_followObjectStartQuaternion",new Ce),p(this,"_followObjectStartWorldQuaternion",new Ce),p(this,"_lastDragPosRigSpace"),p(this,"_tempVec",new S),p(this,"_tempMat",new he),p(this,"_hitPointInLocalSpace",new S),p(this,"_hitNormalInLocalSpace",new S),p(this,"_bottomCenter",new S),p(this,"_backCenter",new S),p(this,"_backBottomCenter",new S),p(this,"_bounds",new Ht),p(this,"_dragPlane",new dr(new S(0,1,0))),p(this,"_draggedOverObject",null),p(this,"_draggedOverObjectLastSetUp",null),p(this,"_draggedOverObjectLastNormal",new S),p(this,"_draggedOverObjectDuration",0),p(this,"_hasLastSurfaceHitPoint",!1),p(this,"_lastSurfaceHitPoint",new S),this.settings=e,this.context=e.context,this.gameObject=i,this._followObject=new ve}getTotalMovement(){return this._totalMovement}get followObject(){return this._followObject}get hitPointInLocalSpace(){return this._hitPointInLocalSpace}setTargetObject(e){this.gameObject=e}recenter(){var e,i;if(!this._followObject.parent){console.warn("Error: space follow object doesn't have parent but recenter() is called. This is likely a bug");return}const r=this._followObject.parent;this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.position.set(0,0,0),this._followObject.quaternion.set(0,0,0,1),this._followObject.scale.set(1,1,1),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0),r.attach(this._followObject),this._followObjectStartPosition.copy(this._followObject.position),this._followObjectStartQuaternion.copy(this._followObject.quaternion),this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const s=this._hitPointInLocalSpace.clone();this.gameObject.localToWorld(s),this._grabStartDistance=s.distanceTo(r.worldPosition);const o=(i=(e=Et.active)==null?void 0:e.rig)==null?void 0:i.gameObject,a=o?.worldScale.x||1;this._grabStartDistance/=a,this._totalMovementAlongRayDirection=0,this._lastDragPosRigSpace=void 0,Nc&&(yt.DrawLine(s,r.worldPosition,65280,.5,!1),yt.DrawLabel(r.worldPosition.add(new S(0,.1,0)),this._grabStartDistance.toFixed(2),.03,.5))}onDragStart(e){if(e.event.space.add(this._followObject),this._lastDragPosRigSpace=void 0,e.point&&e.normal)this._hitPointInLocalSpace.copy(e.point),this.gameObject.worldToLocal(this._hitPointInLocalSpace),this._hitNormalInLocalSpace.copy(e.normal);else if(e){const m=e.event.space,g=m.worldPosition;this.gameObject.worldToLocal(g),this._hitPointInLocalSpace.copy(g);const v=m.worldUp;this._tempMat.copy(this.gameObject.matrixWorld).invert(),v.transformDirection(this._tempMat),this._hitNormalInLocalSpace.copy(v)}this.recenter(),this._totalMovement.set(0,0,0),this._deviceMode=e.mode;const i=this._followObject.parent.worldForward,r=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrDragMode:this.settings.dragMode,s=this._hitPointInLocalSpace.clone();switch(this.gameObject.localToWorld(s),r){case 0:const m=new S(0,1,0);this.gameObject.parent&&m.transformDirection(this.gameObject.parent.matrixWorld.clone().invert()),this._dragPlane.setFromNormalAndCoplanarPoint(m,s);break;case 2:const g=this._hitNormalInLocalSpace.clone();g.transformDirection(this.gameObject.matrixWorld),this._dragPlane.setFromNormalAndCoplanarPoint(g,s);break;case 1:this._dragPlane.setFromNormalAndCoplanarPoint(i,s);break;case 3:this.setPlaneViewAligned(s,!0);break;case 4:this.setPlaneViewAligned(s,!1);break}const o=this.gameObject.parent,a=this.gameObject.position.clone(),l=this.gameObject.quaternion.clone(),c=this.gameObject.scale.clone(),h=this.gameObject.matrixWorld.clone();o&&o.remove(this.gameObject),this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1),this.gameObject.scale.set(1,1,1);const u=pl([this.gameObject]);u.expandByPoint(this.gameObject.worldPosition);const d=new S;u.getCenter(d);const f=new S;u.getSize(f),this._bottomCenter.copy(d.clone().add(new S(0,-f.y/2,0))),this._backCenter.copy(d.clone().add(new S(0,0,f.z/2))),this._backBottomCenter.copy(d.clone().add(new S(0,-f.y/2,f.z/2))),this._bounds.copy(u),o&&o.add(this.gameObject),this.gameObject.position.copy(a),this.gameObject.quaternion.copy(l),this.gameObject.scale.copy(c),this.gameObject.matrixWorld.copy(h),this._draggedOverObject=null,this._draggedOverObjectLastSetUp=null,this._draggedOverObjectLastNormal.set(0,1,0),this._draggedOverObjectDuration=0}collectMovementInfo(){var e,i;if(!this._followObject.parent)return;const r=this._followObject.parent;this._followObject.updateMatrix();const s=r.worldPosition,o=(i=(e=Et.active)==null?void 0:e.rig)==null?void 0:i.gameObject;o&&o.worldToLocal(s),(this._lastDragPosRigSpace===void 0||o!=this._lastRig)&&(this._lastDragPosRigSpace=s.clone(),this._lastRig=o),this._tempVec.copy(s).sub(this._lastDragPosRigSpace);const a=r.worldForward;if(o&&(this._tempMat.copy(o.matrixWorld).invert(),a.transformDirection(this._tempMat)),this._totalMovementAlongRayDirection+=a.dot(this._tempVec),this._tempVec.x=Math.abs(this._tempVec.x),this._tempVec.y=Math.abs(this._tempVec.y),this._tempVec.z=Math.abs(this._tempVec.z),this._totalMovement.add(this._tempVec),this._lastDragPosRigSpace.copy(s),Nc){let l=s;o&&(l=l.clone(),l.transformDirection(o.matrixWorld)),yt.DrawRay(l,a,255)}}onDragUpdate(e){if(e>1)return;const i=this.gameObject,r=this._followObject.parent;this._followObject.updateMatrix();const s=r.worldPosition,o=r.worldForward,a=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer",l=a?this.settings.xrKeepRotation:this.settings.keepRotation,c=a?this.settings.xrDragMode:this.settings.dragMode;if(c===5)return;const h=10;l&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);let u=1,d=2;if(a&&this._grabStartDistance>.5){const A=1+this._totalMovementAlongRayDirection*(2*this.settings.xrDistanceDragFactor);u=Math.max(0,A),u=u*u*u}else this._grabStartDistance<=.5&&(d=3);this._followObject.position.copy(this._followObjectStartPosition),l||this._followObject.quaternion.copy(this._followObjectStartQuaternion),this._followObject.position.multiplyScalar(u),this._followObject.updateMatrix();const f=this._hasLastSurfaceHitPoint;this._hasLastSurfaceHitPoint=!1;const m=new Js(s,o);if(c==4){const A=this.context.physics.raycastFromRay(m,{testObject:b=>b!==this.followObject&&b!==r&&b!==i});if(A.length>0){const b=A[0];if(this._draggedOverObject===b.object?this._draggedOverObjectDuration+=this.context.time.deltaTime:(this._draggedOverObject=b.object,this._draggedOverObjectDuration=0),b.face){this._hasLastSurfaceHitPoint=!0,this._lastSurfaceHitPoint.copy(b.point);const x=.15,_=this._draggedOverObjectDuration>=x,w=.001,T=this._totalMovement.length()>=w;if((_||T)&&(this._draggedOverObjectLastSetUp!==this._draggedOverObject||this._draggedOverObjectLastNormal.dot(b.face.normal)<.999999||this.context.time.frame%60===0)){this._draggedOverObjectLastSetUp=this._draggedOverObject,this._draggedOverObjectLastNormal.copy(b.face.normal);const M=bt(),R=bt();this._bounds.getCenter(M),this._bounds.getSize(R),M.sub(R.multiplyScalar(.5).multiply(b.face.normal)),this._hitPointInLocalSpace.copy(M),this._hitNormalInLocalSpace.copy(b.face.normal),this._bounds.getCenter(M),this._bounds.getSize(R),M.add(R.multiplyScalar(.5).multiply(b.face.normal));const B=bt(this._hitPointInLocalSpace).add(M);this._followObject.localToWorld(B);const E=b.point;this._dragPlane.setFromNormalAndCoplanarPoint(b.face.normal,E)}else if(!(_||T))return}}else f&&this.setPlaneViewAligned(this.gameObject.worldPosition,!1)}if(c!==1&&m.intersectPlane(this._dragPlane,this._tempVec)){this._followObject.worldPosition=this._tempVec,this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const A=this._hitPointInLocalSpace.clone();this._followObject.localToWorld(A),Nc&&yt.DrawLine(A,this._tempVec,65535,0,!1),this._followObject.worldPosition=this._tempVec.multiplyScalar(2).sub(A),this._followObject.updateMatrix(),this._followObject.updateMatrix()}if(this.settings.snapGridResolution>0){const A=this._followObject.worldPosition,b=this.settings.snapGridResolution;A.x=Math.round(A.x/b)*b,A.y=Math.round(A.y/b)*b,A.z=Math.round(A.z/b)*b,this._followObject.worldPosition=A,this._followObject.updateMatrix()}l&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const g=tt.clamp01(this.context.time.deltaTime*h*d),v=i.worldPosition;v.lerp(this._followObject.worldPosition,g),i.worldPosition=v;const y=i.worldQuaternion;if(y.slerp(this._followObject.worldQuaternion,g),i.worldQuaternion=y,Nc){const A=this._hitPointInLocalSpace.clone();i.localToWorld(A),yt.DrawSphere(A,.02,16711680);const b=this._hitNormalInLocalSpace.clone();b.applyQuaternion(y),yt.DrawRay(A,b,16711680),yt.DrawLabel(v.add(new S(0,.25,0)),`Distance: ${this._totalMovement.length().toFixed(2)}

                Along Ray: ${this._totalMovementAlongRayDirection.toFixed(2)}

                Session: ${!!Et.active}

                Device: ${this._deviceMode}

                `,.03);const x=this._bottomCenter.clone(),_=this._backCenter.clone(),w=this._backBottomCenter.clone();i.localToWorld(x),i.localToWorld(_),i.localToWorld(w),yt.DrawSphere(x,.01,65280,0,!1),yt.DrawSphere(_,.01,255,0,!1),yt.DrawSphere(w,.01,16711935,0,!1),yt.DrawLine(x,w,65535,0,!1),yt.DrawLine(w,_,65535,0,!1)}}onDragEnd(e){console.assert(this._followObject.parent===e.event.space,"Drag end: _followObject is not parented to the space object"),this._followObject.removeFromParent(),this._followObject.destroy(),this._lastDragPosRigSpace=void 0}setPlaneViewAligned(e,i){if(!this._followObject.parent)return!1;const r=this._followObject.parent.worldForward,s=bt(0,1,0),o=r,a=s.angleTo(o),l=.5;return i&&(a>Math.PI/2+l||a<Math.PI/2-l)?this._dragPlane.setFromNormalAndCoplanarPoint(s,e):this._dragPlane.setFromNormalAndCoplanarPoint(r,e),!0}}const sW=class{constructor(n){p(this,"showGizmo",!0),p(this,"useViewAngle",!0),p(this,"_selected",null),p(this,"_context",null),p(this,"_camera"),p(this,"_cameraPlane",new dr),p(this,"_hasGroundPlane",!1),p(this,"_groundPlane",new dr),p(this,"_groundOffset",new S),p(this,"_groundOffsetFactor",0),p(this,"_groundDistance",0),p(this,"_groundPlanePoint",new S),p(this,"_raycaster",new ku),p(this,"_cameraPlaneOffset",new S),p(this,"_intersection",new S),p(this,"_worldPosition",new S),p(this,"_inverseMatrix",new he),p(this,"_rbs",[]),p(this,"_groundLine"),p(this,"_groundMarker"),p(this,"_groundOffsetVector",new S(0,1,0)),p(this,"_requireUpdateGroundPlane",!0),p(this,"_didDragOnGroundPlaneLastFrame",!1),this._camera=n;const e=new hn(sW.geometry),i=e.material;i.color=new be(.4,.4,.4),e.layers.set(2),e.name="line",e.scale.y=1,this._groundLine=e;const r=new tl(.5,22,22),s=new Jt({color:i.color}),o=new pe(r,s);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(n,e){if(this._selected&&e)for(const i of this._rbs)i.wakeUp(),i.setVelocity(0,0,0);if(this._selected&&Sc.Remove(e,this._selected),this._selected=n,this._context=e,this._rbs.length=0,n?(e.scene.add(this._groundLine),e.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!e){console.error("DragHelper: no context");return}Sc.Add(e,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(n){this._selected}onUpdateWorldPosition(n,e,i){if(this._selected){if(i){const r=kt(this._selected);r.y=n.y,n=r}if(gr(this._selected,n),gr(this._groundLine,n),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=e!==null&&this.showGizmo,e){const r=kt(this._camera).distanceTo(e)*.01;this._groundMarker.scale.set(r,r,r),gr(this._groundMarker,e)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const n=this._context.input.getPointerPositionRC(0);n&&(this._raycaster.setFromCamera(n,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const n=kt(this._selected),e=new Js(bt(0,.1,0).add(n),bt(0,-1,0)),i=new dc;i.testObject=s=>s!==this._selected;const r=this._context.physics.raycastFromRay(e,i);for(let s=0;s<r.length;s++){const o=r[s];if(!o.face||this.contains(this._selected,o.object))continue;const a=bt(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(a,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(e.direction.multiplyScalar(-1),e.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(n),this._groundOffset.copy(this._intersection).sub(n)}contains(n,e){if(n===e)return!0;if(n.children){for(const i of n.children)if(this.contains(i,e))return!0}return!1}};let JAe=sW;p(JAe,"geometry",new dt().setFromPoints([new S(0,0,0),new S(0,-1,0)]));var oW=(n=>(n.File_Spawned="file-spawned",n))(oW||{});class aW{constructor(e,i,r,s,o,a,l,c){p(this,"guid"),p(this,"file_name"),p(this,"file_hash"),p(this,"file_size"),p(this,"position"),p(this,"seed"),p(this,"sender"),p(this,"serverUrl"),p(this,"parentGuid"),p(this,"boundsSize"),this.seed=i,this.guid=r,this.file_name=s,this.file_hash=o,this.file_size=a,this.position=l,this.sender=e,this.serverUrl=c}}async function lW(n,e,i){const r=n.name;return r.endsWith(".gltf")||r.endsWith(".glb")||n.type==="model/gltf+json"||n.type==="model/gltf-binary"?new Promise((s,o)=>{const a=new FileReader;a.readAsArrayBuffer(n),a.onloadend=async l=>{const c=a.result,h=ZS(),u=new xr(h),d=await ul().parseSync(e,c,n.name,u);if(d&&d.scene){const f=d.scene;if(!f.guid){const m=new xr(h);f.guid=m.generateUUID()}i&&KAe(e.connection,n,h,f,i),s(d)}}}):(console.warn("Unsupported file type: "+r,n),null)}async function cW(n,e){return new Promise(async(i,r)=>{const s=ZS(),o=new xr(s),a=n.toString(),l=await ul().loadSync(e,a,a,o);l&&l.scene?(l.scene,i(l)):console.warn("Unsupported file type: "+n.toString())})}fi.registerCallback(Si.ContextCreated,n=>{hW(n.context)});function hW(n){n.connection.beginListen("file-spawned",async e=>{if(e.sender!==n.connection.connectionId){console.log("received file event",e),ZAe(e,n);let i=null;try{i=await Zk(e.file_name,e.file_hash,e.file_size,e.serverUrl)}finally{$Ae(e)}if(i){const r=new xr(e.seed),s=await ul().parseSync(n,i,e.file_name,r);if(s&&s.scene){const o=s.scene;if(e.parentGuid){const a=eb(e.parentGuid,n.scene);a&&"add"in a&&a.add(o)}o.parent||n.scene.add(o),e.position!==null&&o.position.copy(e.position)}}else console.error("download didnt return file")}})}async function KAe(n,e,i,r,s){if(!n.connectionId){console.error("Can not upload file - no connection id");return}if(!r.guid){console.error("Can not upload file - no guid",r,r.guid);return}const o=await iV(e,s);if(!o)return;if(!o.filename){console.error("Can not send upload event - no filename",e.name);return}if(!o.hash){console.error("Can not send upload event - no hash",e.name);return}const a=new aW(n.connectionId,i,r.guid,o.filename,o.hash,e.size,r.position,o.url??s);r.parent&&(a.parentGuid=r.parent.guid),n.send("file-spawned",a)}const vL={};function ZAe(n,e){const i=new Ki,r=new pe(i,new Jt({color:65280})),s=new n2(r,5592405);if(vL[n.guid]=s,e.scene.add(s),n.parentGuid){const o=eb(n.parentGuid,e.scene);o&&o.add(s)}n.position&&s.position.copy(n.position)}function $Ae(n,e){const i=n.guid,r=vL[i];r&&(delete vL[i],r.removeFromParent())}var ebe=Object.defineProperty,tbe=Object.getOwnPropertyDescriptor,cx=(n,e,i,r)=>{for(var s=r>1?void 0:r?tbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&ebe(e,i,s),s};const qd=te("debugdroplistener");class Yd extends Be{constructor(){super(...arguments),p(this,"dropArea"),p(this,"fitIntoVolume",!1),p(this,"fitVolumeSize",new S(1,1,1)),p(this,"placeAtHitPosition",!0),p(this,"onDropped",new An),p(this,"onNetworkEvent",e=>{var i;if((i=e.guid)!=null&&i.startsWith(this.guid)){const r=e.url;if(r)if(Array.isArray(r))for(const s of r)this.addFromUrl(s,{screenposition:new J},!0).then(o=>{o?.position.set(e.point.x,e.point.y,e.point.z)});else this.addFromUrl(r,{screenposition:new J},!0).then(s=>{s?.position.set(e.point.x,e.point.y,e.point.z)})}}),p(this,"handlePaste",async e=>{if(this.context.connection.allowEditing!==!1&&(e.ctrlKey||e.metaKey)&&e.key==="v"){const i=await navigator.clipboard.readText().catch(console.warn);if(i&&(i.startsWith("http")||i.startsWith("https")||i.startsWith("blob"))){const r={screenposition:new J(this.context.input.mousePosition.x,this.context.input.mousePosition.y)};this.testIfIsInDropArea(r)&&this.addFromUrl(i,r,!1)}}}),p(this,"onDrag",e=>{this.context.connection.allowEditing!==!1&&e.preventDefault()}),p(this,"onDrop",async e=>{if(this.context.connection.allowEditing===!1||(qd&&console.log(e),!(e!=null&&e.dataTransfer))||e["droplistener:handled"])return;e.preventDefault();const i={screenposition:new J(e.offsetX,e.offsetY)};if(this.dropArea&&this.testIfIsInDropArea(i)===!1)return;e["droplistener:handled"]=!0;const r=e.dataTransfer.items;if(r)for(const s in r){const o=r[s];if(o.kind==="file"){const a=o.getAsFile();if(!a)continue;await this.addFiles([a],i)}else o.kind==="string"&&o.type=="text/plain"&&o.getAsString(a=>{this.addFromUrl(a,i,!1)})}}),p(this,"_addedObjects",new Array)}onEnable(){this.context.renderer.domElement.addEventListener("dragover",this.onDrag),this.context.renderer.domElement.addEventListener("drop",this.onDrop),window.addEventListener("keyup",this.handlePaste),this.context.connection.beginListen("droplistener",this.onNetworkEvent)}onDisable(){this.context.renderer.domElement.removeEventListener("dragover",this.onDrag),this.context.renderer.domElement.removeEventListener("drop",this.onDrop),window.removeEventListener("keyup",this.handlePaste),this.context.connection.stopListen("droplistener",this.onNetworkEvent)}async addFromUrl(e,i,r){qd&&console.log("dropped url",e);try{if(e.startsWith("https://github.com/")){const a=e.split("/"),l=a[3],c=a[4],h=a[6],u=a.slice(7).join("/");e=`https://raw.githubusercontent.com/${l}/${c}/${h}/${u}`}else e.startsWith("https://polyhaven.com/a")&&(e=ibe(e));if(!e)return null;const s=e.toLowerCase();if(s.endsWith(".hdr")||s.endsWith(".hdri")||s.endsWith(".exr")||s.endsWith(".png")||s.endsWith(".jpg")||s.endsWith(".jpeg"))return null;const o=await cW(new URL(e),this.context);if(o)return i.url=e,this.addObject(o,i,r)}catch{console.warn("String is not a valid URL",e)}return null}async addFiles(e,i){if(qd&&console.log("Add files",e),!!Array.isArray(e)&&e.length)for(const r of e){if(!r)continue;qd&&console.log("Register file "+r.name,r);const s=await lW(r,this.context);this.dispatchEvent(new CustomEvent("file-dropped",{detail:r})),s&&this.addObject(s,i,!1)}}addObject(e,i,r){var s,o;if(qd&&console.log(`Dropped ${this.gameObject.name}`,e),!(e!=null&&e.scene))return console.warn("No object specified to add to scene",e),null;for(const c of this._addedObjects)c.parent===this.gameObject&&$o(c,!0,!0);this._addedObjects.length=0;const a=e.scene;this.gameObject.attach(a),a.position.set(0,0,0),a.quaternion.identity(),this._addedObjects.push(a),qd&&a.add(new Vo(1));const l=new Ht().setFromCenterAndSize(new S(0,this.fitVolumeSize.y*.5,0).add(this.gameObject.worldPosition),this.fitVolumeSize);if(qd&&yt.DrawWireBox3(l,255,5),this.fitIntoVolume&&Bj(a,l,{position:!this.placeAtHitPosition}),this.placeAtHitPosition&&i&&i.screenposition){a.visible=!1;const c=this.context.physics.raycast({screenPoint:this.context.input.convertScreenspaceToRaycastSpace(i.screenposition.clone())});if(a.visible=!0,c&&c.length>0)for(const h of c){const u=h.point.clone();qd&&console.log("Place object at hit",h),kj(a,u);break}}if(u0.assignAnimationsFromFile(e,{createAnimationComponent:c=>Zo(c,Fs)}),this.dispatchEvent(new CustomEvent("object-added",{detail:e})),(s=this.onDropped)==null||s.invoke({sender:this,gltf:e}),!r&&(o=i.url)!=null&&o.startsWith("http")&&this.context.connection.isConnected&&a){const c={guid:this.guid,url:i.url,point:a.position.clone()};this.context.connection.send("droplistener",c)}return a}testIfIsInDropArea(e){if(this.dropArea){const i=this.context.input.convertScreenspaceToRaycastSpace(e.screenposition.clone());if(!this.context.physics.raycast({targets:[this.dropArea],screenPoint:i,recursive:!0,testObject:r=>!this._addedObjects.includes(r)}).length)return it()&&console.log(`Dropped outside of drop area for DropListener "${this.name}".`),!1}return!0}}cx([C(ve)],Yd.prototype,"dropArea",2),cx([C()],Yd.prototype,"fitIntoVolume",2),cx([C(S)],Yd.prototype,"fitVolumeSize",2),cx([C()],Yd.prototype,"placeAtHitPosition",2),cx([C(An)],Yd.prototype,"onDropped",2);function ibe(n){if(!n.startsWith("https://polyhaven.com/"))return n;const e="https://dl.polyhaven.org/file/ph-assets/Models/gltf/4k/",i=new URL(n).pathname.split("/").pop(),r=`${e}${i}/${i}_4k.gltf`;return console.log("Resolved polyhaven asset url",n,"\u2192",r),r}var nbe=Object.defineProperty,rbe=Object.getOwnPropertyDescriptor,$E=(n,e,i,r)=>{for(var s=r>1?void 0:r?rbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&nbe(e,i,s),s};const uW=class extends Be{constructor(){super(...arguments),p(this,"parent",null),p(this,"object",null),p(this,"limitCount",10),p(this,"limitInterval",60),p(this,"_currentCount",0),p(this,"_startPosition",null),p(this,"_startQuaternion",null),p(this,"_forwardPointerEvents",new Map)}start(){var n,e;if(this._currentCount=0,this._startPosition=null,this._startQuaternion=null,this.object||(this.object=this.gameObject),this.object){if(this.object===this.gameObject){const r=new xr(this.guid);this.object=ie.instantiate(this.object,{idProvider:r,keepWorldPosition:!1});const s=ie.getComponent(this.object,uW);s?.destroy();let o=this.object.getComponentInChildren(ko);o||(o=this.object.addComponent(ko,{dragMode:gL.SnapToSurfaces}),o.guid=r.generateUUID());let a=ie.getComponent(o.gameObject,vc);a||(a=o.gameObject.addComponent(vc),a.guid=r.generateUUID())}this.object.visible=!1;const i=this.gameObject.getComponent(ko);i&&(i.enabled=!1),this._startPosition=((n=this.object.position)==null?void 0:n.clone())??new S(0,0,0),this._startQuaternion=((e=this.object.quaternion)==null?void 0:e.clone())??new Ce(0,0,0,1)}this.gameObject.getComponentInParent(ta)||this.gameObject.addComponent(ta),this.cloneLimitIntervalFn()}onPointerEnter(n){n.used||this.object&&this.context.connection.allowEditing&&n.button===0&&this.context.input.setCursorPointer()}onPointerExit(n){n.used||this.object&&this.context.connection.allowEditing&&n.button===0&&this.context.input.setCursorNormal()}onPointerDown(n){if(n.used||!this.object||!this.context.connection.allowEditing||n.button!==0)return;const e=this.handleDuplication();if(e){const i=ie.getComponent(e,ko);i?(i.onPointerDown(n),this._forwardPointerEvents.set(n.event.space,i)):console.warn("Duplicated object does not have DragControls")}}onPointerUp(n){if(n.used)return;const e=this._forwardPointerEvents.get(n.event.space);e&&(e.onPointerUp(n),this._forwardPointerEvents.delete(n.event.space))}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(){var n;if(!this.object||this._currentCount>=this.limitCount||this.object===this.gameObject)return null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const e=new Vl;this.parent||(this.parent=this.gameObject.parent),this.parent&&(e.parent=this.parent.guid??((n=this.parent.userData)==null?void 0:n.guid),e.keepWorldPosition=!0),e.position=this.worldPosition,e.rotation=this.worldQuaternion,e.context=this.context,this._currentCount+=1;const i=ie.instantiateSynced(this.object,e);return console.assert(i!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),i}};let im=uW;$E([C(ve)],im.prototype,"parent",2),$E([C(ve)],im.prototype,"object",2),$E([C()],im.prototype,"limitCount",2),$E([C()],im.prototype,"limitInterval",2);class hx extends ss{constructor(e){super(),p(this,"effect"),this.effect=e}get typeName(){return this.effect.constructor.name}onCreateEffect(){return this.effect}}var ev=(n=>(n[n.PointerEnter=0]="PointerEnter",n[n.PointerExit=1]="PointerExit",n[n.PointerDown=2]="PointerDown",n[n.PointerUp=3]="PointerUp",n[n.PointerClick=4]="PointerClick",n[n.Drag=5]="Drag",n[n.Drop=6]="Drop",n[n.Scroll=7]="Scroll",n[n.UpdateSelected=8]="UpdateSelected",n[n.Select=9]="Select",n[n.Deselect=10]="Deselect",n[n.Move=11]="Move",n[n.InitializePotentialDrag=12]="InitializePotentialDrag",n[n.BeginDrag=13]="BeginDrag",n[n.EndDrag=14]="EndDrag",n[n.Submit=15]="Submit",n[n.Cancel=16]="Cancel",n))(ev||{}),sbe=Object.defineProperty,obe=Object.getOwnPropertyDescriptor,yL=(n,e,i,r)=>{for(var s=r>1?void 0:r?obe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&sbe(e,i,s),s};class AL{constructor(){p(this,"eventID"),p(this,"callback",new An)}}yL([C()],AL.prototype,"eventID",2),yL([C(An)],AL.prototype,"callback",2);class eM extends Be{constructor(){super(...arguments),p(this,"triggers",[])}invoke(e){if(this.triggers)for(const i of this.triggers)i.eventID===e&&i.callback.invoke()}onPointerClick(e){this.invoke(ev.PointerClick)}onPointerEnter(e){this.invoke(ev.PointerEnter)}onPointerExit(e){this.invoke(ev.PointerExit)}onPointerDown(e){this.invoke(ev.PointerDown)}onPointerUp(e){this.invoke(ev.PointerUp)}}yL([C(AL)],eM.prototype,"triggers",2);var abe=Object.defineProperty,lbe=Object.getOwnPropertyDescriptor,bL=(n,e,i,r)=>{for(var s=r>1?void 0:r?lbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&abe(e,i,s),s};class xL extends Be{constructor(){super(...arguments),p(this,"connectedBody"),p(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(Oi)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.activeAndEnabled&&this.createJoint(this.rigidBody,this.connectedBody)}}bL([C(Oi)],xL.prototype,"connectedBody",2);class _L extends xL{createJoint(e,i){var r;(r=this.context.physics.engine)==null||r.addFixedJoint(e,i)}}class ux extends xL{constructor(){super(...arguments),p(this,"anchor"),p(this,"axis")}createJoint(e,i){var r;this.axis&&this.anchor&&((r=this.context.physics.engine)==null||r.addHingeJoint(e,i,this.anchor,this.axis))}}bL([C(S)],ux.prototype,"anchor",2),bL([C(S)],ux.prototype,"axis",2);const cbe={type:"change"};let hbe=class extends wr{constructor(n,e){super(),this.object=n,this.domElement=e,this.enabled=!0,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const i=this,r=1e-6,s=new Ce,o=new S;this.tmpQuaternion=new Ce,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new S(0,0,0),this.rotationVector=new S(0,0,0),this.keydown=function(m){if(!(m.altKey||this.enabled===!1)){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(m){if(this.enabled!==!1){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}},this.pointerdown=function(m){if(this.enabled!==!1)if(this.dragToLook)this.status++;else{switch(m.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(m){if(this.enabled!==!1&&(!this.dragToLook||this.status>0)){const g=this.getContainerDimensions(),v=g.size[0]/2,y=g.size[1]/2;this.moveState.yawLeft=-(m.pageX-g.offset[0]-v)/v,this.moveState.pitchDown=(m.pageY-g.offset[1]-y)/y,this.updateRotationVector()}},this.pointerup=function(m){if(this.enabled!==!1){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(m.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}},this.pointercancel=function(){this.enabled!==!1&&(this.dragToLook?(this.status=0,this.moveState.yawLeft=this.moveState.pitchDown=0):(this.moveState.forward=0,this.moveState.back=0,this.updateMovementVector()),this.updateRotationVector())},this.contextMenu=function(m){this.enabled!==!1&&m.preventDefault()},this.update=function(m){if(this.enabled===!1)return;const g=m*i.movementSpeed,v=m*i.rollSpeed;i.object.translateX(i.moveVector.x*g),i.object.translateY(i.moveVector.y*g),i.object.translateZ(i.moveVector.z*g),i.tmpQuaternion.set(i.rotationVector.x*v,i.rotationVector.y*v,i.rotationVector.z*v,1).normalize(),i.object.quaternion.multiply(i.tmpQuaternion),(o.distanceToSquared(i.object.position)>r||8*(1-s.dot(i.object.quaternion))>r)&&(i.dispatchEvent(cbe),s.copy(i.object.quaternion),o.copy(i.object.position))},this.updateMovementVector=function(){const m=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-m+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",a),this.domElement.removeEventListener("pointerdown",c),this.domElement.removeEventListener("pointermove",l),this.domElement.removeEventListener("pointerup",h),this.domElement.removeEventListener("pointercancel",u),window.removeEventListener("keydown",d),window.removeEventListener("keyup",f)};const a=this.contextMenu.bind(this),l=this.pointermove.bind(this),c=this.pointerdown.bind(this),h=this.pointerup.bind(this),u=this.pointercancel.bind(this),d=this.keydown.bind(this),f=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",a),this.domElement.addEventListener("pointerdown",c),this.domElement.addEventListener("pointermove",l),this.domElement.addEventListener("pointerup",h),this.domElement.addEventListener("pointercancel",u),window.addEventListener("keydown",d),window.addEventListener("keyup",f),this.updateMovementVector(),this.updateRotationVector()}};class wL extends Be{constructor(){super(...arguments),p(this,"_controls",null)}onEnable(){var e;const i=(e=ie.getComponent(this.gameObject,Ui))==null?void 0:e.cam;if(!i){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new hbe(i,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var e;(e=this._controls)==null||e.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var ube=Object.defineProperty,dbe=Object.getOwnPropertyDescriptor,SL=(n,e,i,r)=>{for(var s=r>1?void 0:r?dbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&ube(e,i,s),s};class tv extends Be{constructor(){super(...arguments),p(this,"_fog")}get fog(){return this._fog||(this._fog=new mw(0,0,50)),this._fog}get mode(){return 1}set near(e){this.fog.near=e}get near(){return this.fog.near}set far(e){this.fog.far=e}get far(){return this.fog.far}set color(e){this.fog.color.copy(e)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}SL([C()],tv.prototype,"near",1),SL([C()],tv.prototype,"far",1),SL([C(be)],tv.prototype,"color",1);let dx,CL,iv,tM;function EL(n,e=1/0,i=null){CL||(CL=new cr(2,2,1,1)),iv||(iv=new Bt({uniforms:{blitTexture:new Se(n)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),iv.uniforms.blitTexture.value=n,iv.defines.IS_SRGB=n.colorSpace==gt,iv.needsUpdate=!0,tM||(tM=new pe(CL,iv),tM.frustrumCulled=!1);const r=new Ft,s=new Er;s.add(tM),i===null&&(i=dx=new lh({antialias:!1}));const o=Math.min(n.image.width,e),a=Math.min(n.image.height,e);i.setSize(o,a),i.clear(),i.render(s,r);const l=document.createElement("canvas"),c=l.getContext("2d");l.width=o,l.height=a,c.drawImage(i.domElement,0,0,o,a);const h=new ER(l);return h.minFilter=n.minFilter,h.magFilter=n.magFilter,h.wrapS=n.wrapS,h.wrapT=n.wrapT,h.name=n.name,dx&&(dx.forceContextLoss(),dx.dispose(),dx=null),h}const dW={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class iM{constructor(){this.pluginCallbacks=[],this.register(function(e){return new _be(e)}),this.register(function(e){return new wbe(e)}),this.register(function(e){return new Ebe(e)}),this.register(function(e){return new Mbe(e)}),this.register(function(e){return new Tbe(e)}),this.register(function(e){return new Ibe(e)}),this.register(function(e){return new Sbe(e)}),this.register(function(e){return new Cbe(e)}),this.register(function(e){return new Rbe(e)}),this.register(function(e){return new Pbe(e)}),this.register(function(e){return new Bbe(e)}),this.register(function(e){return new kbe(e)}),this.register(function(e){return new Obe(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,r,s){const o=new xbe,a=[];for(let l=0,c=this.pluginCallbacks.length;l<c;l++)a.push(this.pluginCallbacks[l](o));o.setPlugins(a),o.write(e,i,s).catch(r)}parseAsync(e,i){const r=this;return new Promise(function(s,o){r.parse(e,s,o,i)})}}const di={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ML="KHR_mesh_quantization",ua={};ua[Rt]=di.NEAREST,ua[Bm]=di.NEAREST_MIPMAP_NEAREST,ua[$c]=di.NEAREST_MIPMAP_LINEAR,ua[Dt]=di.LINEAR,ua[Ap]=di.LINEAR_MIPMAP_NEAREST,ua[bo]=di.LINEAR_MIPMAP_LINEAR,ua[Yn]=di.CLAMP_TO_EDGE,ua[Ao]=di.REPEAT,ua[yp]=di.MIRRORED_REPEAT;const pW={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},pbe=new be,fW=12,fbe=1179937895,mbe=2,mW=8,gbe=1313821514,vbe=5130562;function px(n,e){return n.length===e.length&&n.every(function(i,r){return i===e[r]})}function ybe(n){return new TextEncoder().encode(n).buffer}function Abe(n){return px(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function bbe(n,e,i){const r={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=e;s<e+i;s++)for(let o=0;o<n.itemSize;o++){let a;n.itemSize>4?a=n.array[s*n.itemSize+o]:(o===0?a=n.getX(s):o===1?a=n.getY(s):o===2?a=n.getZ(s):o===3&&(a=n.getW(s)),n.normalized===!0&&(a=pi.normalize(a,n.array))),r.min[o]=Math.min(r.min[o],a),r.max[o]=Math.max(r.max[o],a)}return r}function gW(n){return Math.ceil(n/4)*4}function TL(n,e=0){const i=gW(n.byteLength);if(i!==n.byteLength){const r=new Uint8Array(i);if(r.set(new Uint8Array(n)),e!==0)for(let s=n.byteLength;s<i;s++)r[s]=e;return r.buffer}return n}function vW(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function yW(n,e){if(n.toBlob!==void 0)return new Promise(r=>n.toBlob(r,e));let i;return e==="image/jpeg"?i=.92:e==="image/webp"&&(i=.8),n.convertToBlob({type:e,quality:i})}class xbe{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,i,r={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},r),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,o=s.buffers,a=s.json;r=s.options;const l=s.extensionsUsed,c=s.extensionsRequired,h=new Blob(o,{type:"application/octet-stream"}),u=Object.keys(l),d=Object.keys(c);if(u.length>0&&(a.extensionsUsed=u),d.length>0&&(a.extensionsRequired=d),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=h.size),r.binary===!0){const f=new FileReader;f.readAsArrayBuffer(h),f.onloadend=function(){const m=TL(f.result),g=new DataView(new ArrayBuffer(mW));g.setUint32(0,m.byteLength,!0),g.setUint32(4,vbe,!0);const v=TL(ybe(JSON.stringify(a)),32),y=new DataView(new ArrayBuffer(mW));y.setUint32(0,v.byteLength,!0),y.setUint32(4,gbe,!0);const A=new ArrayBuffer(fW),b=new DataView(A);b.setUint32(0,fbe,!0),b.setUint32(4,mbe,!0);const x=fW+y.byteLength+v.byteLength+g.byteLength+m.byteLength;b.setUint32(8,x,!0);const _=new Blob([A,y,v,g,m],{type:"application/octet-stream"}),w=new FileReader;w.readAsArrayBuffer(_),w.onloadend=function(){i(w.result)}}}else if(a.buffers&&a.buffers.length>0){const f=new FileReader;f.readAsDataURL(h),f.onloadend=function(){const m=f.result;a.buffers[0].uri=m,i(a)}}else i(a)}serializeUserData(e,i){if(Object.keys(e.userData).length===0)return;const r=this.options,s=this.extensionsUsed;try{const o=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&o.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const a in o.gltfExtensions)i.extensions[a]=o.gltfExtensions[a],s[a]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(i.extras=o)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+o.message)}}getUID(e,i=!1){if(this.uids.has(e)===!1){const r=new Map;r.set(!0,this.uid++),r.set(!1,this.uid++),this.uids.set(e,r)}return this.uids.get(e).get(i)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new S;for(let r=0,s=e.count;r<s;r++)if(Math.abs(i.fromBufferAttribute(e,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const r=e.clone(),s=new S;for(let o=0,a=r.count;o<a;o++)s.fromBufferAttribute(r,o),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),r.setXYZ(o,s.x,s.y,s.z);return i.attributesNormalized.set(e,r),r}applyTextureTransform(e,i){let r=!1;const s={};(i.offset.x!==0||i.offset.y!==0)&&(s.offset=i.offset.toArray(),r=!0),i.rotation!==0&&(s.rotation=i.rotation,r=!0),(i.repeat.x!==1||i.repeat.y!==1)&&(s.scale=i.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function r(f){return f.colorSpace===gt?function(m){return m<.04045?m*.0773993808:Math.pow(m*.9478672986+.0521327014,2.4)}:function(m){return m}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Ru&&(e=EL(e)),i instanceof Ru&&(i=EL(i));const s=e?e.image:null,o=i?i.image:null,a=Math.max(s?s.width:0,o?o.width:0),l=Math.max(s?s.height:0,o?o.height:0),c=vW();c.width=a,c.height=l;const h=c.getContext("2d");h.fillStyle="#00ffff",h.fillRect(0,0,a,l);const u=h.getImageData(0,0,a,l);if(s){h.drawImage(s,0,0,a,l);const f=r(e),m=h.getImageData(0,0,a,l).data;for(let g=2;g<m.length;g+=4)u.data[g]=f(m[g]/256)*256}if(o){h.drawImage(o,0,0,a,l);const f=r(i),m=h.getImageData(0,0,a,l).data;for(let g=1;g<m.length;g+=4)u.data[g]=f(m[g]/256)*256}h.putImageData(u,0,0);const d=(e||i).clone();return d.source=new th(c),d.colorSpace=xo,d.channel=(e||i).channel,e&&i&&e.channel!==i.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),d}processBuffer(e){const i=this.json,r=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),r.push(e),0}processBufferView(e,i,r,s,o){const a=this.json;a.bufferViews||(a.bufferViews=[]);let l;switch(i){case di.BYTE:case di.UNSIGNED_BYTE:l=1;break;case di.SHORT:case di.UNSIGNED_SHORT:l=2;break;default:l=4}const c=gW(s*e.itemSize*l),h=new DataView(new ArrayBuffer(c));let u=0;for(let f=r;f<r+s;f++)for(let m=0;m<e.itemSize;m++){let g;e.itemSize>4?g=e.array[f*e.itemSize+m]:(m===0?g=e.getX(f):m===1?g=e.getY(f):m===2?g=e.getZ(f):m===3&&(g=e.getW(f)),e.normalized===!0&&(g=pi.normalize(g,e.array))),i===di.FLOAT?h.setFloat32(u,g,!0):i===di.INT?h.setInt32(u,g,!0):i===di.UNSIGNED_INT?h.setUint32(u,g,!0):i===di.SHORT?h.setInt16(u,g,!0):i===di.UNSIGNED_SHORT?h.setUint16(u,g,!0):i===di.BYTE?h.setInt8(u,g):i===di.UNSIGNED_BYTE&&h.setUint8(u,g),u+=l}const d={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:c};return o!==void 0&&(d.target=o),o===di.ARRAY_BUFFER&&(d.byteStride=e.itemSize*l),this.byteOffset+=c,a.bufferViews.push(d),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,r=i.json;return r.bufferViews||(r.bufferViews=[]),new Promise(function(s){const o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=function(){const a=TL(o.result),l={buffer:i.processBuffer(a),byteOffset:i.byteOffset,byteLength:a.byteLength};i.byteOffset+=a.byteLength,s(r.bufferViews.push(l)-1)}})}processAccessor(e,i,r,s){const o=this.json,a={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let l;if(e.array.constructor===Float32Array)l=di.FLOAT;else if(e.array.constructor===Int32Array)l=di.INT;else if(e.array.constructor===Uint32Array)l=di.UNSIGNED_INT;else if(e.array.constructor===Int16Array)l=di.SHORT;else if(e.array.constructor===Uint16Array)l=di.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)l=di.BYTE;else if(e.array.constructor===Uint8Array)l=di.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(r===void 0&&(r=0),(s===void 0||s===1/0)&&(s=e.count),s===0)return null;const c=bbe(e,r,s);let h;i!==void 0&&(h=e===i.index?di.ELEMENT_ARRAY_BUFFER:di.ARRAY_BUFFER);const u=this.processBufferView(e,l,r,s,h),d={bufferView:u.id,byteOffset:u.byteOffset,componentType:l,count:s,max:c.max,min:c.min,type:a[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(d)-1}processImage(e,i,r,s="image/png"){if(e!==null){const o=this,a=o.cache,l=o.json,c=o.options,h=o.pending;a.images.has(e)||a.images.set(e,{});const u=a.images.get(e),d=s+":flipY/"+r.toString();if(u[d]!==void 0)return u[d];l.images||(l.images=[]);const f={mimeType:s},m=vW();m.width=Math.min(e.width,c.maxTextureSize),m.height=Math.min(e.height,c.maxTextureSize);const g=m.getContext("2d");if(r===!0&&(g.translate(0,m.height),g.scale(1,-1)),e.data!==void 0){i!==Ti&&console.error("GLTFExporter: Only RGBAFormat is supported.",i),(e.width>c.maxTextureSize||e.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const y=new Uint8ClampedArray(e.height*e.width*4);for(let A=0;A<y.length;A+=4)y[A+0]=e.data[A+0],y[A+1]=e.data[A+1],y[A+2]=e.data[A+2],y[A+3]=e.data[A+3];g.putImageData(new ImageData(y,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)g.drawImage(e,0,0,m.width,m.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");c.binary===!0?h.push(yW(m,s).then(y=>o.processBufferViewImage(y)).then(y=>{f.bufferView=y})):m.toDataURL!==void 0?f.uri=m.toDataURL(s):h.push(yW(m,s).then(y=>new FileReader().readAsDataURL(y)).then(y=>{f.uri=y}));const v=l.images.push(f)-1;return u[d]=v,v}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const i=this.json;i.samplers||(i.samplers=[]);const r={magFilter:ua[e.magFilter],minFilter:ua[e.minFilter],wrapS:ua[e.wrapS],wrapT:ua[e.wrapT]};return i.samplers.push(r)-1}processTexture(e){const i=this.options,r=this.cache,s=this.json;if(r.textures.has(e))return r.textures.get(e);const o={keep:!0,newTexture:null};if(this._invokeAll(function(h){h.beforeWriteTexture&&h.beforeWriteTexture(e,o)}),o.keep===!1)return null;o.newTexture!=null&&(e=o.newTexture),s.textures||(s.textures=[]),e instanceof Ru&&(e=EL(e,i.maxTextureSize));let a=e.userData.mimeType;a==="image/webp"&&(a="image/png");const l={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(l.name=e.name),this._invokeAll(function(h){h.writeTexture&&h.writeTexture(e,l)});const c=s.textures.push(l)-1;return r.textures.set(e,c),c}processMaterial(e){var i,r,s,o,a;const l=this.cache,c=this.json;if(l.materials.has(e))return l.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;c.materials||(c.materials=[]);const h={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const u=e.color.toArray().concat([e.opacity]);px(u,[1,1,1,1])||(h.pbrMetallicRoughness.baseColorFactor=u),e.isMeshStandardMaterial?(h.pbrMetallicRoughness.metallicFactor=e.metalness,h.pbrMetallicRoughness.roughnessFactor=e.roughness):(h.pbrMetallicRoughness.metallicFactor=.5,h.pbrMetallicRoughness.roughnessFactor=.5);const d=(i=e.metalnessMap)!=null&&i.image?e.metalnessMap:void 0,f=(r=e.roughnessMap)!=null&&r.image?e.roughnessMap:void 0;if(d||f){const g=this.buildMetalRoughTexture(d,f),v={index:this.processTexture(g),channel:g.channel};this.applyTextureTransform(v,g),h.pbrMetallicRoughness.metallicRoughnessTexture=v}if(e.map){const g={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(g,e.map),h.pbrMetallicRoughness.baseColorTexture=g}if(e.emissive){const g=e.emissive;if(Math.max(g.r,g.g,g.b)>0&&(h.emissiveFactor=e.emissive.toArray()),(s=e.emissiveMap)!=null&&s.image){const v={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(v,e.emissiveMap),h.emissiveTexture=v}}if((o=e.normalMap)!=null&&o.image){const g={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(g.scale=e.normalScale.x),this.applyTextureTransform(g,e.normalMap),h.normalTexture=g}if((a=e.aoMap)!=null&&a.image){const g={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(g.strength=e.aoMapIntensity),this.applyTextureTransform(g,e.aoMap),h.occlusionTexture=g}e.transparent?h.alphaMode="BLEND":e.alphaTest>0&&(h.alphaMode="MASK",h.alphaCutoff=e.alphaTest),e.side===yi&&(h.doubleSided=!0),e.name!==""&&(h.name=e.name),this.serializeUserData(e,h),this._invokeAll(function(g){g.writeMaterial&&g.writeMaterial(e,h)});const m=c.materials.push(h)-1;return l.materials.set(e,m),m}processMesh(e){const i={keep:!0};if(this._invokeAll(function(w){w.beforeWriteMesh&&w.beforeWriteMesh(e,i)}),i.keep!=!0)return null;const r=this.cache,s=this.json,o=[e.geometry.uuid];if(Array.isArray(e.material))for(let w=0,T=e.material.length;w<T;w++)o.push(e.material[w].uuid);else o.push(e.material.uuid);const a=o.join(":");if(r.meshes.has(a))return r.meshes.get(a);const l=e.geometry;let c;e.isLineSegments?c=di.LINES:e.isLineLoop?c=di.LINE_LOOP:e.isLine?c=di.LINE_STRIP:e.isPoints?c=di.POINTS:c=e.material.wireframe?di.LINES:di.TRIANGLES;const h={},u={},d=[],f=[],m={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},g=l.getAttribute("normal");g!==void 0&&!this.isNormalizedNormalAttribute(g)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),l.setAttribute("normal",this.createNormalizedNormalAttribute(g)));let v=null;for(let w in l.attributes){if(w.slice(0,5)==="morph")continue;const T=l.attributes[w];if(w=m[w]||w.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(w)||(w="_"+w),r.attributes.has(this.getUID(T))){u[w]=r.attributes.get(this.getUID(T));continue}v=null;const M=T.array;w==="JOINTS_0"&&!(M instanceof Uint16Array)&&!(M instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),v=new Ye(new Uint16Array(M),T.itemSize,T.normalized));const R=this.processAccessor(v||T,l);R!==null&&(w.startsWith("_")||this.detectMeshQuantization(w,T),u[w]=R,r.attributes.set(this.getUID(T),R))}if(g!==void 0&&l.setAttribute("normal",g),Object.keys(u).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const w=[],T=[],M={};if(e.morphTargetDictionary!==void 0)for(const R in e.morphTargetDictionary)M[e.morphTargetDictionary[R]]=R;for(let R=0;R<e.morphTargetInfluences.length;++R){const B={};let E=!1;for(const P in l.morphAttributes){if(P!=="position"&&P!=="normal"){E||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),E=!0);continue}const O=l.morphAttributes[P][R],N=P.toUpperCase(),L=l.attributes[P];if(r.attributes.has(this.getUID(O,!0))){B[N]=r.attributes.get(this.getUID(O,!0));continue}const Q=O.clone();if(!l.morphTargetsRelative)for(let D=0,F=O.count;D<F;D++)for(let H=0;H<O.itemSize;H++)H===0&&Q.setX(D,O.getX(D)-L.getX(D)),H===1&&Q.setY(D,O.getY(D)-L.getY(D)),H===2&&Q.setZ(D,O.getZ(D)-L.getZ(D)),H===3&&Q.setW(D,O.getW(D)-L.getW(D));B[N]=this.processAccessor(Q,l),r.attributes.set(this.getUID(L,!0),B[N])}f.push(B),w.push(e.morphTargetInfluences[R]),e.morphTargetDictionary!==void 0&&T.push(M[R])}h.weights=w,T.length>0&&(h.extras={},h.extras.targetNames=T)}const y=Array.isArray(e.material);if(y&&l.groups.length===0)return null;let A=!1;if(y&&l.index===null){const w=[];for(let T=0,M=l.attributes.position.count;T<M;T++)w[T]=T;l.setIndex(w),A=!0}const b=y?e.material:[e.material],x=y?l.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let w=0,T=x.length;w<T;w++){const M={mode:c,attributes:u};if(this.serializeUserData(l,M),f.length>0&&(M.targets=f),l.index!==null){let B=this.getUID(l.index);(x[w].start!==void 0||x[w].count!==void 0)&&(B+=":"+x[w].start+":"+x[w].count),r.attributes.has(B)?M.indices=r.attributes.get(B):(M.indices=this.processAccessor(l.index,l,x[w].start,x[w].count),r.attributes.set(B,M.indices)),M.indices===null&&delete M.indices}const R=this.processMaterial(b[x[w].materialIndex]);R!==null&&(M.material=R),d.push(M)}A===!0&&l.setIndex(null),h.primitives=d,s.meshes||(s.meshes=[]),this._invokeAll(function(w){w.writeMesh&&w.writeMesh(e,h)});const _=s.meshes.push(h)-1;return r.meshes.set(a,_),_}detectMeshQuantization(e,i){if(this.extensionsUsed[ML])return;let r;switch(i.array.constructor){case Int8Array:r="byte";break;case Uint8Array:r="unsigned byte";break;case Int16Array:r="short";break;case Uint16Array:r="unsigned short";break;default:return}i.normalized&&(r+=" normalized");const s=e.split("_",1)[0];dW[s]&&dW[s].includes(r)&&(this.extensionsUsed[ML]=!0,this.extensionsRequired[ML]=!0)}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const r=e.isOrthographicCamera,s={type:r?"orthographic":"perspective"};return r?s.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:pi.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(s.name=e.type),i.cameras.push(s)-1}processAnimation(e,i){const r=this.json,s=this.nodeMap;r.animations||(r.animations=[]),e=iM.Utils.mergeMorphTargetTracks(e.clone(),i);const o=e.tracks,a=[],l=[];for(let c=0;c<o.length;++c){const h=o[c],u=Yt.parseTrackName(h.name);let d=Yt.findNode(i,u.nodeName);const f=pW[u.propertyName];if(u.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(u.objectIndex):d=void 0),!d||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name),null;const m=1;let g=h.values.length/h.times.length;f===pW.morphTargetInfluences&&(g/=d.morphTargetInfluences.length);let v;h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(v="CUBICSPLINE",g/=3):h.getInterpolation()===Au?v="STEP":v="LINEAR",l.push({input:this.processAccessor(new Ye(h.times,m)),output:this.processAccessor(new Ye(h.values,g)),interpolation:v}),a.push({sampler:l.length-1,target:{node:s.get(d),path:f}})}return r.animations.push({name:e.name||"clip_"+r.animations.length,samplers:l,channels:a}),r.animations.length-1}processSkin(e){const i=this.json,r=this.nodeMap,s=i.nodes[r.get(e)],o=e.skeleton;if(o===void 0)return null;const a=e.skeleton.bones[0];if(a===void 0)return null;const l=[],c=new Float32Array(o.bones.length*16),h=new he;for(let u=0;u<o.bones.length;++u)l.push(r.get(o.bones[u])),h.copy(o.boneInverses[u]),h.multiply(e.bindMatrix).toArray(c,u*16);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new Ye(c,16)),joints:l,skeleton:r.get(a)}),s.skin=i.skins.length-1}processNode(e){const i={keep:!0};if(this._invokeAll(function(c){c.beforeWriteNode&&c.beforeWriteNode(e,i)}),i.keep!=!0)return null;const r=this.json,s=this.options,o=this.nodeMap;r.nodes||(r.nodes=[]);const a={};if(s.trs){const c=e.quaternion.toArray(),h=e.position.toArray(),u=e.scale.toArray();px(c,[0,0,0,1])||(a.rotation=c),px(h,[0,0,0])||(a.translation=h),px(u,[1,1,1])||(a.scale=u)}else e.matrixAutoUpdate&&e.updateMatrix(),Abe(e.matrix)===!1&&(a.matrix=e.matrix.elements);if(e.name!==""&&(a.name=String(e.name)),this.serializeUserData(e,a),e.isMesh||e.isLine||e.isPoints){const c=this.processMesh(e);c!==null&&(a.mesh=c)}else e.isCamera&&(a.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const c=[];for(let h=0,u=e.children.length;h<u;h++){const d=e.children[h];if(d.visible||s.onlyVisible===!1){const f=this.processNode(d);f!==null&&c.push(f)}}c.length>0&&(a.children=c)}this._invokeAll(function(c){c.writeNode&&c.writeNode(e,a)});const l=r.nodes.push(a)-1;return o.set(e,l),l}processScene(e){const i=this.json,r=this.options;i.scenes||(i.scenes=[],i.scene=0);const s={};e.name!==""&&(s.name=e.name),i.scenes.push(s);const o=[];for(let a=0,l=e.children.length;a<l;a++){const c=e.children[a];if(c.visible||r.onlyVisible===!1){const h=this.processNode(c);h!==null&&o.push(h)}}o.length>0&&(s.nodes=o),this.serializeUserData(e,s)}processObjects(e){const i=new Er;i.name="AuxScene";for(let r=0;r<e.length;r++)i.children.push(e[r]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(e)});const r=[];for(let s=0;s<e.length;s++)e[s]instanceof Er?this.processScene(e[s]):r.push(e[s]);r.length>0&&this.processObjects(r);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<i.animations.length;++s)this.processAnimation(i.animations[s],e[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(e)})}_invokeAll(e){for(let i=0,r=this.plugins.length;i<r;i++)e(this.plugins[i])}}class _be{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,i){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const r=this.writer,s=r.json,o=r.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},o[this.name]=!0);const l=s.extensions[this.name].lights;l.push(a),i.extensions=i.extensions||{},i.extensions[this.name]={light:l.length-1}}}class wbe{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,i){if(!e.isMeshBasicMaterial)return;const r=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},r[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class Sbe{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const r=this.writer,s=r.extensionsUsed,o={};if(o.clearcoatFactor=e.clearcoat,e.clearcoatMap){const a={index:r.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};r.applyTextureTransform(a,e.clearcoatMap),o.clearcoatTexture=a}if(o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const a={index:r.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};r.applyTextureTransform(a,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=a}if(e.clearcoatNormalMap){const a={index:r.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};r.applyTextureTransform(a,e.clearcoatNormalMap),o.clearcoatNormalTexture=a}i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}class Cbe{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const r=this.writer,s=r.extensionsUsed,o={};if(o.iridescenceFactor=e.iridescence,e.iridescenceMap){const a={index:r.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};r.applyTextureTransform(a,e.iridescenceMap),o.iridescenceTexture=a}if(o.iridescenceIor=e.iridescenceIOR,o.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const a={index:r.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};r.applyTextureTransform(a,e.iridescenceThicknessMap),o.iridescenceThicknessTexture=a}i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}class Ebe{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const r=this.writer,s=r.extensionsUsed,o={};if(o.transmissionFactor=e.transmission,e.transmissionMap){const a={index:r.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};r.applyTextureTransform(a,e.transmissionMap),o.transmissionTexture=a}i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}class Mbe{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const r=this.writer,s=r.extensionsUsed,o={};if(o.thicknessFactor=e.thickness,e.thicknessMap){const a={index:r.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};r.applyTextureTransform(a,e.thicknessMap),o.thicknessTexture=a}o.attenuationDistance=e.attenuationDistance,o.attenuationColor=e.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}class Tbe{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const r=this.writer.extensionsUsed,s={};s.ior=e.ior,i.extensions=i.extensions||{},i.extensions[this.name]=s,r[this.name]=!0}}class Ibe{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(pbe)&&!e.specularIntensityMap&&!e.specularColorMap)return;const r=this.writer,s=r.extensionsUsed,o={};if(e.specularIntensityMap){const a={index:r.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};r.applyTextureTransform(a,e.specularIntensityMap),o.specularTexture=a}if(e.specularColorMap){const a={index:r.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};r.applyTextureTransform(a,e.specularColorMap),o.specularColorTexture=a}o.specularFactor=e.specularIntensity,o.specularColorFactor=e.specularColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}class Rbe{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const r=this.writer,s=r.extensionsUsed,o={};if(e.sheenRoughnessMap){const a={index:r.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};r.applyTextureTransform(a,e.sheenRoughnessMap),o.sheenRoughnessTexture=a}if(e.sheenColorMap){const a={index:r.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};r.applyTextureTransform(a,e.sheenColorMap),o.sheenColorTexture=a}o.sheenRoughnessFactor=e.sheenRoughness,o.sheenColorFactor=e.sheenColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}class Pbe{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const r=this.writer,s=r.extensionsUsed,o={};if(e.anisotropyMap){const a={index:r.processTexture(e.anisotropyMap)};r.applyTextureTransform(a,e.anisotropyMap),o.anisotropyTexture=a}o.anisotropyStrength=e.anisotropy,o.anisotropyRotation=e.anisotropyRotation,i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}class Bbe{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const r=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,i.extensions=i.extensions||{},i.extensions[this.name]=s,r[this.name]=!0}}class kbe{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const r=this.writer,s=r.extensionsUsed,o={};if(e.bumpMap){const a={index:r.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};r.applyTextureTransform(a,e.bumpMap),o.bumpTexture=a}o.bumpFactor=e.bumpScale,i.extensions=i.extensions||{},i.extensions[this.name]=o,s[this.name]=!0}}class Obe{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,i){if(!e.isInstancedMesh)return;const r=this.writer,s=e,o=new Float32Array(s.count*3),a=new Float32Array(s.count*4),l=new Float32Array(s.count*3),c=new he,h=new S,u=new Ce,d=new S;for(let m=0;m<s.count;m++)s.getMatrixAt(m,c),c.decompose(h,u,d),h.toArray(o,m*3),u.toArray(a,m*4),d.toArray(l,m*3);const f={TRANSLATION:r.processAccessor(new Ye(o,3)),ROTATION:r.processAccessor(new Ye(a,4)),SCALE:r.processAccessor(new Ye(l,3))};s.instanceColor&&(f._COLOR_0=r.processAccessor(s.instanceColor)),i.extensions=i.extensions||{},i.extensions[this.name]={attributes:f},r.extensionsUsed[this.name]=!0,r.extensionsRequired[this.name]=!0}}iM.Utils={insertKeyframe:function(n,e){const i=n.getValueSize(),r=new n.TimeBufferType(n.times.length+1),s=new n.ValueBufferType(n.values.length+i),o=n.createInterpolant(new n.ValueBufferType(i));let a;if(n.times.length===0){r[0]=e;for(let l=0;l<i;l++)s[l]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;r[0]=e,r.set(n.times,1),s.set(o.evaluate(e),0),s.set(n.values,i),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;r[r.length-1]=e,r.set(n.times,0),s.set(n.values,0),s.set(o.evaluate(e),n.values.length),a=r.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){r.set(n.times.slice(0,l+1),0),r[l+1]=e,r.set(n.times.slice(l+1),l+2),s.set(n.values.slice(0,(l+1)*i),0),s.set(o.evaluate(e),(l+1)*i),s.set(n.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return n.times=r,n.values=s,a},mergeMorphTargetTracks:function(n,e){const i=[],r={},s=n.tracks;for(let o=0;o<s.length;++o){let a=s[o];const l=Yt.parseTrackName(a.name),c=Yt.findNode(e,l.nodeName);if(l.propertyName!=="morphTargetInfluences"||l.propertyIndex===void 0){i.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(Xl)}const h=c.morphTargetInfluences.length,u=c.morphTargetDictionary[l.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);let d;if(r[c.uuid]===void 0){d=a.clone();const m=new d.ValueBufferType(h*d.times.length);for(let g=0;g<d.times.length;g++)m[g*h+u]=d.values[g];d.name=(l.nodeName||"")+".morphTargetInfluences",d.values=m,r[c.uuid]=d,i.push(d);continue}const f=a.createInterpolant(new a.ValueBufferType(1));d=r[c.uuid];for(let m=0;m<d.times.length;m++)d.values[m*h+u]=f.evaluate(d.times[m]);for(let m=0;m<a.times.length;m++){const g=this.insertKeyframe(d,a.times[m]);d.values[g*h+u]=a.values[m]}}return n.tracks=i,n}};class AW{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,i){if(e.constructor.name!=="InstancedMesh")return;const r=this.writer,s=r.extensionsUsed,o={};i.extensions=i.extensions||{},i.extensions[this.name]=o;let a=new he;const l=new Array,c=new Array,h=new Array;for(let m=0;m<e.count;m++){e.getMatrixAt(m,a);let g=new S,v=new Ce,y=new S;a.decompose(g,v,y),l.push(g.x,g.y,g.z),c.push(v.x,v.y,v.z,v.w),h.push(y.x,y.y,y.z)}const u=new Float32Array(l),d=new Float32Array(c),f=new Float32Array(h);o.attributes={TRANSLATION:r.processAccessor(new Ye(u,3)),ROTATION:r.processAccessor(new Ye(d,4)),SCALE:r.processAccessor(new Ye(f,3))},s[this.name]=!0}}var Dbe=Object.defineProperty,Lbe=Object.getOwnPropertyDescriptor,bW=(n,e,i,r)=>{for(var s=r>1?void 0:r?Lbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Dbe(e,i,s),s};const nM=te("debuggltfexport");class IL extends Mc{constructor(){super(...arguments),p(this,"sceneRoot")}}const nv=class extends Be{constructor(){super(...arguments),p(this,"binary",!0),p(this,"objects",[]),p(this,"ext")}async exportNow(n){nM&&console.log("Exporting objects as glTF",this.objects),n||(n="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const e={binary:this.binary,pivot:nv.calculateCenter(this.objects)},i=await this.export(this.objects,e).catch(r=>(console.error(r),!1));return i===!1?!1:(this.binary?n.endsWith(".glb")||(n+=".glb"):n.endsWith(".gltf")||(n+=".gltf"),this.binary?nv.saveArrayBuffer(i,n):nv.saveJson(i,n),!0)}async export(n,e){if(!n||n.length<=0){console.warn("No objects set to export");return}const i=new iM;i.register(l=>new AW(l)),JD(i,this.context),nv.filterTopmostParent(n);const r={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:e?.animations||nv.collectAnimations(n),...e},s=new ve;e!=null&&e.pivot&&s.position.sub(e.pivot),nM&&console.log("EXPORT",n),n.forEach(l=>{l&&(s.children.push(l),l.matrixAutoUpdate=!1,l.matrix.copy(l.matrixWorld),ie.getComponentsInChildren(l,Bn).forEach(c=>{ie.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))});const o=new Nk(s);return this.ext&&(this.ext.context=o),new Promise((l,c)=>{nM&&console.log("Starting glTF export.");try{i?.parse(s,h=>{a(),l(h)},h=>{a(),c(h)},r)}catch(h){console.error(h),c(h)}finally{nM&&console.log("Finished glTF export.")}});function a(){n.forEach(l=>{l&&(l.matrixAutoUpdate=!0,ie.getComponentsInChildren(l,Bn).forEach(c=>{ie.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(n,e){this.save(new Blob([n],{type:"application/octet-stream"}),e)}static saveJson(n,e){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n)),e)}static save(n,e){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof n=="string"?i.href=n:i.href=URL.createObjectURL(n),i.download=e,i.click(),i.remove()}static collectAnimations(n,e){e=e||[];for(const i of n)i&&i.traverseVisible(r=>{r.animations&&r.animations.length>0&&e.push(...r.animations)});return e}static calculateCenter(n,e){const i=e||new S;return i.set(0,0,0),n.forEach(r=>{i.add(kt(r))}),console.log(i),i.divideScalar(n.length),i}static filterTopmostParent(n){if(!(n.length<=0))for(let e=0;e<n.length;e++){let i=n[e];if(!i){n.splice(e,1),e--;continue}for(;i.parent;){if(n.includes(i.parent)){n.splice(e,1),e--;break}i=i.parent}}}};let fx=nv;bW([C()],fx.prototype,"binary",2),bW([C(ve)],fx.prototype,"objects",2);var Ube=Object.defineProperty,Fbe=Object.getOwnPropertyDescriptor,RL=(n,e,i,r)=>{for(var s=r>1?void 0:r?Fbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Ube(e,i,s),s};class rv extends Be{constructor(){super(...arguments),p(this,"isGizmo",!1),p(this,"color0"),p(this,"color1"),p(this,"gridHelper"),p(this,"size"),p(this,"divisions"),p(this,"offset")}onEnable(){if(this.isGizmo&&!VA)return;const e=this.size,i=this.divisions;this.gridHelper||(this.gridHelper=new Zw(e,i,this.color0??new be(.4,.4,.4),this.color1??new be(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}RL([C()],rv.prototype,"isGizmo",2),RL([C(be)],rv.prototype,"color0",2),RL([C(be)],rv.prototype,"color1",2);var Nbe=Object.defineProperty,zbe=Object.getOwnPropertyDescriptor,rM=(n,e,i,r)=>{for(var s=r>1?void 0:r?zbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Nbe(e,i,s),s};const Jd=te("debuginputfield");var sv;const xt=(sv=class extends Be{constructor(){super(...arguments),p(this,"textComponent"),p(this,"placeholder"),p(this,"onValueChanged"),p(this,"onEndEdit"),p(this,"inputEventFn"),p(this,"_iosEventFn")}get text(){var n;return((n=this.textComponent)==null?void 0:n.text)??""}get isFocused(){return xt.active===this}start(){Jd&&console.log(this.name,this)}onEnable(){var n;xt.htmlField||(xt.htmlField=document.createElement("input"),xt.htmlField.style.width="0px",xt.htmlField.style.height="0px",xt.htmlField.style.padding="0px",xt.htmlField.style.border="none",xt.htmlField.style.overflow="hidden",xt.htmlField.style.caretColor="transparent",xt.htmlField.style.outline="none",xt.htmlField.classList.add("ar"),xt.htmlField.onfocus=()=>xt.htmlFieldFocused=!0,xt.htmlField.onblur=()=>xt.htmlFieldFocused=!1,document.body.append(xt.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),xt.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&(n=this.textComponent)!=null&&n.text.length&&ie.setActive(this.placeholder.gameObject,!1),Lu()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("click",this._iosEventFn))}onDisable(){var n;(n=xt.htmlField)==null||n.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("click",this._iosEventFn)}clear(){xt.active===this&&xt.htmlField?(xt.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&ie.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(n){Jd&&console.log("CLICK",n,xt.active),xt.activeTime=this.context.time.time,xt.active!==this&&this.startCoroutine(this.activeLoop(),Xi.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();xt.active===this&&!(this.context.input.getPointerClicked(0)&&this.context.time.time-xt.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var n,e,i,r;if(xt.active!==this&&(Jd&&console.log("Select",this.name,this,xt.htmlField,this.context.isInXR,this.context.arOverlayElement,(n=this.textComponent)==null?void 0:n.text,(e=xt.htmlField)==null?void 0:e.value),(i=xt.active)==null||i.onDeselected(),xt.active=this,this.placeholder&&ie.setActive(this.placeholder.gameObject,!1),xt.htmlField)){if(xt.htmlField.value=((r=this.textComponent)==null?void 0:r.text)||"",Jd&&console.log("set input field value",xt.htmlField.value),this.context.isInXR){const s=this.context.arOverlayElement;s&&s.append(xt.htmlField)}this.selectInputField()}}onDeselected(){var n;xt.active===this&&(xt.active=null,Jd&&console.log("Deselect",this.name,this),xt.htmlField&&(xt.htmlField.blur(),document.body.append(xt.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&ie.setActive(this.placeholder.gameObject,!0),xt.htmlField&&((n=this.onEndEdit)==null||n.invoke(xt.htmlField.value)))}update(){var n;xt.active===this&&((n=this.textComponent)==null||n.markDirty())}onInput(n){var e,i;if(xt.active===this){if(Jd&&console.log(n.code,n,(e=xt.htmlField)==null?void 0:e.value,(i=this.textComponent)==null?void 0:i.text),n.code==="Escape"||n.code==="Enter"){this.onDeselected();return}xt.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&ie.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var n;if(this.textComponent&&xt.htmlField){if(this.textComponent.text!==xt.htmlField.value){Jd&&console.log("VALUE CHANGED");const e=this.textComponent.text,i=xt.htmlField.value;(n=this.onValueChanged)==null||n.invoke(i,e)}this.textComponent.text=xt.htmlField.value}}selectInputField(){xt.htmlField&&(Jd&&console.log("Focus Inputfield",xt.htmlFieldFocused),xt.htmlField.setSelectionRange(xt.htmlField.value.length,xt.htmlField.value.length),Lu()?xt.htmlField.focus({preventScroll:!0}):setTimeout(()=>{var n;return(n=xt.htmlField)==null?void 0:n.focus()},1))}processInputOniOS(){const n=this.context.physics.raycast();if(!n.length)return;const e=n[0].object,i=iD(e);(i?.gameObject===this.gameObject||i?.gameObject.parent===this.gameObject)&&this.selectInputField()}},p(sv,"active",null),p(sv,"activeTime",-1),p(sv,"htmlField",null),p(sv,"htmlFieldFocused",!1),sv);let nm=xt;rM([C(js)],nm.prototype,"textComponent",2),rM([C(js)],nm.prototype,"placeholder",2),rM([C(An)],nm.prototype,"onValueChanged",2),rM([C(An)],nm.prototype,"onEndEdit",2);var jbe=Object.defineProperty,Gbe=Object.getOwnPropertyDescriptor,zc=(n,e,i,r)=>{for(var s=r>1?void 0:r?Gbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&jbe(e,i,s),s};function PL(n){return n*Math.PI/180}const xW=300,Kd=te("debuglights");class Oo extends Be{constructor(){super(...arguments),p(this,"type",0),p(this,"range",1),p(this,"spotAngle",1),p(this,"innerSpotAngle",1),p(this,"_color",new be(16777215)),p(this,"_shadowNearPlane",.1),p(this,"_shadowBias",0),p(this,"_shadowNormalBias",0),p(this,"_overrideShadowBiasSettings",!1),p(this,"_shadows",1),p(this,"lightmapBakeType",4),p(this,"_intensity",-1),p(this,"_shadowDistance"),p(this,"shadowWidth"),p(this,"shadowHeight"),p(this,"_shadowResolution"),p(this,"light"),p(this,"_webXRStartedListener"),p(this,"_webXREndedListener"),p(this,"_webARRoot")}set color(e){this._color=e,this.light!==void 0&&(this.light.color=e)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(e){var i,r;if(e!==this._shadowNearPlane&&(this._shadowNearPlane=e,((r=(i=this.light)==null?void 0:i.shadow)==null?void 0:r.camera)!==void 0)){const s=this.light.shadow.camera;s.near=e}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(e){var i,r;e!==this._shadowBias&&(this._shadowBias=e,((r=(i=this.light)==null?void 0:i.shadow)==null?void 0:r.bias)!==void 0&&(this.light.shadow.bias=e,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(e){var i,r;e!==this._shadowNormalBias&&(this._shadowNormalBias=e,((r=(i=this.light)==null?void 0:i.shadow)==null?void 0:r.normalBias)!==void 0&&(this.light.shadow.normalBias=e,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(e){this._shadows=e,this.light&&(this.light.castShadow=e!==0,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(e){var i;if(this._intensity=e,this.light){let r=1;if(this.context.isInXR&&this._webARRoot){const s=(i=this._webARRoot)==null?void 0:i.arScale;typeof s=="number"&&s>0&&(r/=s)}this.light.intensity=e*r}Kd&&console.log("Set light intensity to "+this._intensity,e,this)}get intensity(){return this._intensity}get shadowDistance(){const e=this.light;return e!=null&&e.shadow?e.shadow.camera.far:-1}set shadowDistance(e){this._shadowDistance=e;const i=this.light;if(i!=null&&i.shadow){const r=i.shadow.camera;r.far=e,r.updateProjectionMatrix()}}get shadowResolution(){const e=this.light;return e!=null&&e.shadow?e.shadow.mapSize.x:-1}set shadowResolution(e){if(e===this._shadowResolution)return;this._shadowResolution=e;const i=this.light;i!=null&&i.shadow&&(i.shadow.mapSize.set(e,e),i.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===2}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(e){return this.light?this.type===1?this.light.getWorldPosition(e).multiplyScalar(1):this.light.getWorldPosition(e):e}awake(){this.color=new be(this.color??16777215),Kd&&console.log(this.name,this)}onEnable(){Kd&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,Kd&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===1&&this.startCoroutine(this.updateMainLightRoutine(),Xi.LateUpdate))}onDisable(){Kd&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1)}onEnterXR(e){this._webARRoot=ie.getComponentInParent(this.gameObject,$h)??void 0}onLeaveXR(e){}createLight(){const e=this.selfIsLight;if(e&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case 1:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case 1:const i=new Gp(this.color,this.intensity*Math.PI);if(i.position.set(0,0,-xW*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(i.target),Kp(i.target,0,0,0),this.light=i,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),Kd){const a=new Yz(this.light,.2,this.color);this.context.scene.add(a)}break;case 0:const r=new ky(this.color,this.intensity*Math.PI,this.range,PL(this.spotAngle/2),1-PL(this.innerSpotAngle/2)/PL(this.spotAngle/2),2);r.position.set(0,0,0),r.rotation.set(0,0,0),this.light=r;const s=r.target;r.add(s),s.position.set(0,0,this.range),s.rotation.set(0,0,0);break;case 2:const o=new jp(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==0?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),Kd&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const i=this.light.shadow.camera;if(i.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?i.far=this._shadowDistance:i.far=xW*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)i.left=-this.shadowWidth/2,i.right=this.shadowWidth/2;else{const r=this.gameObject.scale.x;i.left*=r,i.right*=r}if(this.shadowHeight!==void 0)i.top=this.shadowHeight/2,i.bottom=-this.shadowHeight/2;else{const r=this.gameObject.scale.y;i.top*=r,i.bottom*=r}this.light.shadow.needsUpdate=!0,Kd&&this.context.scene.add(new Jz(i))}this.isBaked?this.light.removeFromParent():e||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===1&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===2||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(e){e.add(e.target),e.target.position.set(0,0,-1)}}p(Oo,"allowChangingRendererShadowMapType",!0),zc([C()],Oo.prototype,"type",2),zc([C(be)],Oo.prototype,"color",1),zc([C()],Oo.prototype,"shadowNearPlane",1),zc([C()],Oo.prototype,"shadowBias",1),zc([C()],Oo.prototype,"shadowNormalBias",1),zc([C()],Oo.prototype,"shadows",1),zc([C()],Oo.prototype,"lightmapBakeType",2),zc([C()],Oo.prototype,"intensity",1),zc([C()],Oo.prototype,"shadowDistance",1),zc([C()],Oo.prototype,"shadowResolution",1),new S(0,0,0);var Hbe=Object.defineProperty,Vbe=Object.getOwnPropertyDescriptor,mx=(n,e,i,r)=>{for(var s=r>1?void 0:r?Vbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Hbe(e,i,s),s};const BL=te("debuglods"),Qbe=te("nolods");class rm{constructor(){p(this,"screenRelativeTransitionHeight"),p(this,"distance"),p(this,"renderers")}}mx([C()],rm.prototype,"screenRelativeTransitionHeight",2),mx([C()],rm.prototype,"distance",2),mx([C(Bn)],rm.prototype,"renderers",2);class Wbe{constructor(e){p(this,"model"),this.model=e}get renderers(){return this.model.renderers}}class gx extends Be{constructor(){super(...arguments),p(this,"fadeMode",0),p(this,"localReferencePoint"),p(this,"lodCount",0),p(this,"size",0),p(this,"animateCrossFading",!1),p(this,"lodModels"),p(this,"_lods",[]),p(this,"_settings",[]),p(this,"_lodsHandler"),p(this,"_distanceFactor",1)}start(){if(BL&&console.log("LODGROUP",this.name,this.lodModels,this),!Qbe&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const e=[];for(const r of this.lodModels){const s=new Wbe(r);this._lods.push(s);for(const o of s.renderers)e.includes(o)||e.push(o)}this._lodsHandler=new Array;for(let r=0;r<e.length;r++){const s=new vR;this._lodsHandler.push(s),this.gameObject.add(s)}const i=new ve;i.name="Cull "+this.name;for(let r=0;r<e.length;r++){const s=e[r],o=this._lodsHandler[r],a=s.gameObject;BL&&console.log(r,a.name);for(const l of this._lods){const c=l.model.distance;let h=null;if(l.renderers.includes(s)?h=a:h=i,h.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${h.name}`);continue}BL&&console.log("LEVEL",h.name,c),o.autoUpdate=!1,this.onAddLodLevel(o,h,l.model.distance)}}}}onAfterRender(){if(!this.gameObject||!this._lodsHandler)return;const e=this.context.mainCamera;if(e)for(const i of this._lodsHandler){i.update(e);const r=i.getCurrentLevel(),s=i.levels[r];i.layers.mask=s.object.layers.mask}}onAddLodLevel(e,i,r){if(i===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",i.name,i);return}e.addLevel(i,r*this._distanceFactor,.01);const s={lod:e,levelIndex:e.levels.length-1,distance:r};this._settings.push(s)}distanceFactor(e){if(e!==this._distanceFactor){this._distanceFactor=e;for(const i of this._settings){const r=i.lod.levels[i.levelIndex];r.distance=i.distance*e}}}}mx([C(S)],gx.prototype,"localReferencePoint",2),mx([C(rm)],gx.prototype,"lodModels",2);const Xbe=te("logstats");class kL extends Be{onEnable(){console.log(this),Xbe&&this.startCoroutine(this.run(),Xi.OnAfterRender)}*run(){for(;this.enabled;){const e=this.context.renderer.info;console.log(e.memory,e.render,e.programs),yield}}}var qbe=Object.defineProperty,Ybe=Object.getOwnPropertyDescriptor,sM=(n,e,i,r)=>{for(var s=r>1?void 0:r?Ybe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&qbe(e,i,s),s},OL;const _W=(OL=class extends Be{constructor(){super(...arguments),p(this,"target"),p(this,"invertForward",!1),p(this,"keepUpDirection",!0),p(this,"copyTargetRotation",!1)}onBeforeRender(){let n=this.target;n||(n=this.context.mainCamera),n&&(Hy(this.gameObject,n,this.keepUpDirection,this.copyTargetRotation),this.invertForward&&this.gameObject.quaternion.multiply(_W.flipYQuat))}createBehaviours(n,e,i){if(e.uuid===this.gameObject.uuid){let r=e;if(this.keepUpDirection){const o=co.createEmptyParent(e);r=o;const a=this.invertForward?-1:1;o.matrix.multiply(new he().makeRotationZ(Math.PI/2*a)),e.matrix.multiply(new he().makeRotationZ(-Math.PI/2*a))}const s=new kr("lookat "+this.name,Or.sceneStartTrigger(),Ai.lookAtCameraAction(r,void 0,this.invertForward?S0.back:S0.forward,this.keepUpDirection?S0.up:S0.zero));n.addBehavior(s)}}},p(OL,"flipYQuat",new Ce().setFromAxisAngle(new S(0,1,0),Math.PI)),OL);let sm=_W;sM([C(ve)],sm.prototype,"target",2),sM([C()],sm.prototype,"invertForward",2),sM([C()],sm.prototype,"keepUpDirection",2),sM([C()],sm.prototype,"copyTargetRotation",2);var Jbe=Object.defineProperty,Kbe=Object.getOwnPropertyDescriptor,Zbe=(n,e,i,r)=>{for(var s=r>1?void 0:r?Kbe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Jbe(e,i,s),s};const oM=te("debugnestedgltf");class aM extends Be{constructor(){super(...arguments),p(this,"filePath"),p(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(e){var i;(i=this.filePath)==null||i.beginListenDownload(e)}preload(){var e;(e=this.filePath)==null||e.preload()}async start(){var e,i,r,s,o;if(this._isLoadingOrDoneLoading)return;oM&&console.log(this,this.guid);const a=this.gameObject.parent;if(a){this._isLoadingOrDoneLoading=!0;const l=new Vl;l.idProvider=new xr(this.hash(this.guid)),l.parent=a,this.gameObject.updateMatrix();const c=this.gameObject.matrix;oM&&console.log("Load nested:",((e=this.filePath)==null?void 0:e.uri)??this.filePath,this.gameObject.position);const h=await((r=(i=this.filePath)==null?void 0:i.instantiate)==null?void 0:r.call(this.filePath,l));oM&&console.log("Nested loaded:",((s=this.filePath)==null?void 0:s.uri)??this.filePath,h),h&&(h.matrixAutoUpdate=!1,h.matrix.identity(),h.applyMatrix4(c),h.matrixAutoUpdate=!0,h.layers.disableAll(),h.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:h,assetReference:this.filePath}}))),oM&&console.log("Nested loading done:",((o=this.filePath)==null?void 0:o.uri)??this.filePath,h)}}onDestroy(){var e;(e=this.filePath)==null||e.unload()}hash(e){let i=0;for(let r=0;r<e.length;r++)i=e.charCodeAt(r)+((i<<5)-i);return i}}Zbe([C($t)],aM.prototype,"filePath",2);var $be=Object.defineProperty,exe=Object.getOwnPropertyDescriptor,DL=(n,e,i,r)=>{for(var s=r>1?void 0:r?exe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&$be(e,i,s),s};const txe=te("debugnet"),LL=class extends Be{constructor(){super(...arguments),p(this,"url",null),p(this,"urlParameterName",null),p(this,"localhost",null)}awake(){txe&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let n=this.url?LL.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const i=te(this.urlParameterName);i&&typeof i=="string"&&(n=i)}if(!n)return null;const e=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(n);return e!=null&&e.groups?e?.groups.socket_prefix?n:"wss://"+e?.groups.url:null}static GetUrl(n,e){let i=n;const r=LL.IsLocalNetwork()&&e;if(r&&(i=e),n!=null&&n.startsWith("/")){const s=r?i:window.location.origin;s!=null&&s.endsWith("/")&&n.startsWith("/")&&(n=n.substring(1)),i=s+n}return i}static IsLocalNetwork(n=window.location.hostname){return eo(n)}};let ov=LL;DL([C()],ov.prototype,"url",2),DL([C()],ov.prototype,"urlParameterName",2),DL([C()],ov.prototype,"localhost",2);var ixe=Object.defineProperty,nxe=Object.getOwnPropertyDescriptor,lM=(n,e,i,r)=>{for(var s=r>1?void 0:r?nxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&ixe(e,i,s),s};class om extends Be{constructor(){super(...arguments),p(this,"referenceSpace"),p(this,"from"),p(this,"affectPosition",!1),p(this,"affectRotation",!1),p(this,"alignLookDirection",!1),p(this,"levelLookDirection",!1),p(this,"levelPosition",!1),p(this,"positionOffset",new S(0,0,0)),p(this,"rotationOffset",new S(0,0,0)),p(this,"offset",new S(0,0,0))}update(){if(!this.from)return;var e=kt(this.from),i=Ri(this.from);this.offset.copy(this.positionOffset);const r=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(r),e.add(this.offset),this.levelPosition&&this.referenceSpace){const l=new dr(this.gameObject.up,0),c=kt(this.referenceSpace);l.setFromNormalAndCoplanarPoint(this.gameObject.up,c);const h=new S(0,0,0);l.projectPoint(e,h),e.copy(h)}this.affectPosition&&gr(this.gameObject,e);const s=new ri(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new Ce().setFromEuler(s);this.affectRotation&&Ca(this.gameObject,i.multiply(o));const a=new S;this.from.getWorldDirection(a).multiplyScalar(50),this.levelLookDirection&&(a.y=0),this.alignLookDirection&&this.gameObject.lookAt(a)}}lM([C(ie)],om.prototype,"referenceSpace",2),lM([C(ie)],om.prototype,"from",2),lM([C(S)],om.prototype,"positionOffset",2),lM([C(S)],om.prototype,"rotationOffset",2);var rxe=Object.defineProperty,sxe=Object.getOwnPropertyDescriptor,UL=(n,e,i,r)=>{for(var s=r>1?void 0:r?sxe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&rxe(e,i,s),s};class av extends Be{constructor(){super(...arguments),p(this,"url"),p(this,"mode",0),p(this,"clickable",!0)}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}this._validateUrl();let e=this.url;switch(!e.startsWith("mailto:")&&e.includes("@")&&(e="mailto:"+e),it()&&dn("Open URL: "+e),this.mode){case 0:vg(),globalThis.open(e,"_blank");break;case 1:vg()&&Lu()?globalThis.open(e,"_top"):globalThis.open(e,"_self");break;case 2:vg()?globalThis.open(e,"_top"):globalThis.open(e,"_new");break}}start(){this.gameObject.getComponentInParent(ta)||this.gameObject.addComponent(ta)}onPointerEnter(e){!e.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(e){var i;this.clickable&&!e.used&&(i=this.url)!=null&&i.length&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(it()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}UL([C()],av.prototype,"url",2),UL([C()],av.prototype,"mode",2),UL([C()],av.prototype,"clickable",2);function oxe(n,e){var i=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var r,s,o,a,l=[],c=!0,h=!1;try{if(o=(i=i.call(n)).next,e===0){if(Object(i)!==i)return;c=!1}else for(;!(c=(r=o.call(i)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(u){h=!0,s=u}finally{try{if(!c&&i.return!=null&&(a=i.return(),Object(a)!==a))return}finally{if(h)throw s}}return l}}function FL(){FL=function(){return e};var n,e={},i=Object.prototype,r=i.hasOwnProperty,s=Object.defineProperty||function(D,F,H){D[F]=H.value},o=typeof Symbol=="function"?Symbol:{},a=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function h(D,F,H){return Object.defineProperty(D,F,{value:H,enumerable:!0,configurable:!0,writable:!0}),D[F]}try{h({},"")}catch{h=function(D,F,H){return D[F]=H}}function u(D,F,H,K){var Z=F&&F.prototype instanceof A?F:A,oe=Object.create(Z.prototype),we=new L(K||[]);return s(oe,"_invoke",{value:E(D,H,we)}),oe}function d(D,F,H){try{return{type:"normal",arg:D.call(F,H)}}catch(K){return{type:"throw",arg:K}}}e.wrap=u;var f="suspendedStart",m="suspendedYield",g="executing",v="completed",y={};function A(){}function b(){}function x(){}var _={};h(_,a,function(){return this});var w=Object.getPrototypeOf,T=w&&w(w(Q([])));T&&T!==i&&r.call(T,a)&&(_=T);var M=x.prototype=A.prototype=Object.create(_);function R(D){["next","throw","return"].forEach(function(F){h(D,F,function(H){return this._invoke(F,H)})})}function B(D,F){function H(Z,oe,we,Oe){var se=d(D[Z],D,oe);if(se.type!=="throw"){var _e=se.arg,Ee=_e.value;return Ee&&typeof Ee=="object"&&r.call(Ee,"__await")?F.resolve(Ee.__await).then(function(et){H("next",et,we,Oe)},function(et){H("throw",et,we,Oe)}):F.resolve(Ee).then(function(et){_e.value=et,we(_e)},function(et){return H("throw",et,we,Oe)})}Oe(se.arg)}var K;s(this,"_invoke",{value:function(Z,oe){function we(){return new F(function(Oe,se){H(Z,oe,Oe,se)})}return K=K?K.then(we,we):we()}})}function E(D,F,H){var K=f;return function(Z,oe){if(K===g)throw new Error("Generator is already running");if(K===v){if(Z==="throw")throw oe;return{value:n,done:!0}}for(H.method=Z,H.arg=oe;;){var we=H.delegate;if(we){var Oe=P(we,H);if(Oe){if(Oe===y)continue;return Oe}}if(H.method==="next")H.sent=H._sent=H.arg;else if(H.method==="throw"){if(K===f)throw K=v,H.arg;H.dispatchException(H.arg)}else H.method==="return"&&H.abrupt("return",H.arg);K=g;var se=d(D,F,H);if(se.type==="normal"){if(K=H.done?v:m,se.arg===y)continue;return{value:se.arg,done:H.done}}se.type==="throw"&&(K=v,H.method="throw",H.arg=se.arg)}}}function P(D,F){var H=F.method,K=D.iterator[H];if(K===n)return F.delegate=null,H==="throw"&&D.iterator.return&&(F.method="return",F.arg=n,P(D,F),F.method==="throw")||H!=="return"&&(F.method="throw",F.arg=new TypeError("The iterator does not provide a '"+H+"' method")),y;var Z=d(K,D.iterator,F.arg);if(Z.type==="throw")return F.method="throw",F.arg=Z.arg,F.delegate=null,y;var oe=Z.arg;return oe?oe.done?(F[D.resultName]=oe.value,F.next=D.nextLoc,F.method!=="return"&&(F.method="next",F.arg=n),F.delegate=null,y):oe:(F.method="throw",F.arg=new TypeError("iterator result is not an object"),F.delegate=null,y)}function O(D){var F={tryLoc:D[0]};1 in D&&(F.catchLoc=D[1]),2 in D&&(F.finallyLoc=D[2],F.afterLoc=D[3]),this.tryEntries.push(F)}function N(D){var F=D.completion||{};F.type="normal",delete F.arg,D.completion=F}function L(D){this.tryEntries=[{tryLoc:"root"}],D.forEach(O,this),this.reset(!0)}function Q(D){if(D||D===""){var F=D[a];if(F)return F.call(D);if(typeof D.next=="function")return D;if(!isNaN(D.length)){var H=-1,K=function Z(){for(;++H<D.length;)if(r.call(D,H))return Z.value=D[H],Z.done=!1,Z;return Z.value=n,Z.done=!0,Z};return K.next=K}}throw new TypeError(typeof D+" is not iterable")}return b.prototype=x,s(M,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:b,configurable:!0}),b.displayName=h(x,c,"GeneratorFunction"),e.isGeneratorFunction=function(D){var F=typeof D=="function"&&D.constructor;return!!F&&(F===b||(F.displayName||F.name)==="GeneratorFunction")},e.mark=function(D){return Object.setPrototypeOf?Object.setPrototypeOf(D,x):(D.__proto__=x,h(D,c,"GeneratorFunction")),D.prototype=Object.create(M),D},e.awrap=function(D){return{__await:D}},R(B.prototype),h(B.prototype,l,function(){return this}),e.AsyncIterator=B,e.async=function(D,F,H,K,Z){Z===void 0&&(Z=Promise);var oe=new B(u(D,F,H,K),Z);return e.isGeneratorFunction(F)?oe:oe.next().then(function(we){return we.done?we.value:oe.next()})},R(M),h(M,c,"Generator"),h(M,a,function(){return this}),h(M,"toString",function(){return"[object Generator]"}),e.keys=function(D){var F=Object(D),H=[];for(var K in F)H.push(K);return H.reverse(),function Z(){for(;H.length;){var oe=H.pop();if(oe in F)return Z.value=oe,Z.done=!1,Z}return Z.done=!0,Z}},e.values=Q,L.prototype={constructor:L,reset:function(D){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(N),!D)for(var F in this)F.charAt(0)==="t"&&r.call(this,F)&&!isNaN(+F.slice(1))&&(this[F]=n)},stop:function(){this.done=!0;var D=this.tryEntries[0].completion;if(D.type==="throw")throw D.arg;return this.rval},dispatchException:function(D){if(this.done)throw D;var F=this;function H(se,_e){return oe.type="throw",oe.arg=D,F.next=se,_e&&(F.method="next",F.arg=n),!!_e}for(var K=this.tryEntries.length-1;K>=0;--K){var Z=this.tryEntries[K],oe=Z.completion;if(Z.tryLoc==="root")return H("end");if(Z.tryLoc<=this.prev){var we=r.call(Z,"catchLoc"),Oe=r.call(Z,"finallyLoc");if(we&&Oe){if(this.prev<Z.catchLoc)return H(Z.catchLoc,!0);if(this.prev<Z.finallyLoc)return H(Z.finallyLoc)}else if(we){if(this.prev<Z.catchLoc)return H(Z.catchLoc,!0)}else{if(!Oe)throw new Error("try statement without catch or finally");if(this.prev<Z.finallyLoc)return H(Z.finallyLoc)}}}},abrupt:function(D,F){for(var H=this.tryEntries.length-1;H>=0;--H){var K=this.tryEntries[H];if(K.tryLoc<=this.prev&&r.call(K,"finallyLoc")&&this.prev<K.finallyLoc){var Z=K;break}}Z&&(D==="break"||D==="continue")&&Z.tryLoc<=F&&F<=Z.finallyLoc&&(Z=null);var oe=Z?Z.completion:{};return oe.type=D,oe.arg=F,Z?(this.method="next",this.next=Z.finallyLoc,y):this.complete(oe)},complete:function(D,F){if(D.type==="throw")throw D.arg;return D.type==="break"||D.type==="continue"?this.next=D.arg:D.type==="return"?(this.rval=this.arg=D.arg,this.method="return",this.next="end"):D.type==="normal"&&F&&(this.next=F),y},finish:function(D){for(var F=this.tryEntries.length-1;F>=0;--F){var H=this.tryEntries[F];if(H.finallyLoc===D)return this.complete(H.completion,H.afterLoc),N(H),y}},catch:function(D){for(var F=this.tryEntries.length-1;F>=0;--F){var H=this.tryEntries[F];if(H.tryLoc===D){var K=H.completion;if(K.type==="throw"){var Z=K.arg;N(H)}return Z}}throw new Error("illegal catch attempt")},delegateYield:function(D,F,H){return this.delegate={iterator:Q(D),resultName:F,nextLoc:H},this.method==="next"&&(this.arg=n),y}},e}function Mt(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function wW(n,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,MW(r.key),r)}}function Tt(n,e,i){return e&&wW(n.prototype,e),i&&wW(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n}function $(n,e,i){return e=MW(e),e in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function lv(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&NL(n,e)}function cM(n){return cM=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},cM(n)}function NL(n,e){return NL=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},NL(n,e)}function axe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ai(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function lxe(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ai(n)}function cv(n){var e=axe();return function(){var i=cM(n),r;if(e){var s=cM(this).constructor;r=Reflect.construct(i,arguments,s)}else r=i.apply(this,arguments);return lxe(this,r)}}function hv(n,e){return cxe(n)||oxe(n,e)||SW(n,e)||hxe()}function cxe(n){if(Array.isArray(n))return n}function SW(n,e){if(n){if(typeof n=="string")return CW(n,e);var i=Object.prototype.toString.call(n).slice(8,-1);if(i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set")return Array.from(n);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return CW(n,e)}}function CW(n,e){(e==null||e>n.length)&&(e=n.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=n[i];return r}function hxe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EW(n,e){var i=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!i){if(Array.isArray(n)||(i=SW(n))||e&&n&&typeof n.length=="number"){i&&(n=i);var r=0,s=function(){};return{s,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(c){throw c},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,l;return{s:function(){i=i.call(n)},n:function(){var c=i.next();return o=c.done,c},e:function(c){a=!0,l=c},f:function(){try{!o&&i.return!=null&&i.return()}finally{if(a)throw l}}}}function uxe(n,e){if(typeof n!="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var r=i.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function MW(n){var e=uxe(n,"string");return typeof e=="symbol"?e:String(e)}var dxe=function(n){lv(i,n);var e=cv(i);function i(r){var s;return Mt(this,i),s=e.call(this),$(ai(s),"type","ParticleEmitter"),$(ai(s),"system",void 0),s.system=r,s}return Tt(i,[{key:"clone",value:function(){var r=this.system.clone();return r.emitter.copy(this,!0),r.emitter}},{key:"dispose",value:function(){}},{key:"extractFromCache",value:function(r){var s=[];for(var o in r){var a=r[o];delete a.metadata,s.push(a)}return s}},{key:"toJSON",value:function(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r===void 0||typeof r=="string",a={};o&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var l={};if(l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.castShadow===!0&&(l.castShadow=!0),this.receiveShadow===!0&&(l.receiveShadow=!0),this.visible===!1&&(l.visible=!1),this.frustumCulled===!1&&(l.frustumCulled=!1),this.renderOrder!==0&&(l.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(l.matrixAutoUpdate=!1),this.system!==null&&(l.ps=this.system.toJSON(r,s)),this.children.length>0){l.children=[];for(var c=0;c<this.children.length;c++)this.children[c].type!=="ParticleSystemPreview"&&l.children.push(this.children[c].toJSON(r).object)}if(o){var h=this.extractFromCache(r.geometries),u=this.extractFromCache(r.materials),d=this.extractFromCache(r.textures),f=this.extractFromCache(r.images);h.length>0&&(a.geometries=h),u.length>0&&(a.materials=u),d.length>0&&(a.textures=d),f.length>0&&(a.images=f)}return a.object=l,a}}]),i}(ve),zL=function(){function n(e){Mt(this,n),$(this,"data",void 0),$(this,"next",void 0),$(this,"prev",void 0),this.data=e,this.next=null,this.prev=null}return Tt(n,[{key:"hasPrev",value:function(){return this.prev!==null}},{key:"hasNext",value:function(){return this.next!==null}}]),n}(),pxe=function(){function n(){Mt(this,n),$(this,"length",void 0),$(this,"head",void 0),$(this,"tail",void 0),this.length=0,this.head=this.tail=null}return Tt(n,[{key:"isEmpty",value:function(){return this.head===null}},{key:"clear",value:function(){this.length=0,this.head=this.tail=null}},{key:"front",value:function(){return this.head===null?null:this.head.data}},{key:"back",value:function(){return this.tail===null?null:this.tail.data}},{key:"dequeue",value:function(){if(this.head){var e=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}}},{key:"pop",value:function(){if(this.tail){var e=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}}},{key:"queue",value:function(e){var i=new zL(e);this.tail||(this.tail=i),this.head&&(this.head.prev=i,i.next=this.head),this.head=i,this.length++}},{key:"push",value:function(e){var i=new zL(e);this.head||(this.head=i),this.tail&&(this.tail.next=i,i.prev=this.tail),this.tail=i,this.length++}},{key:"insertBefore",value:function(e,i){var r=new zL(i);r.next=e,r.prev=e.prev,r.prev!==null&&(r.prev.next=r),r.next.prev=r,e==this.head&&(this.head=r),this.length++}},{key:"remove",value:function(e){if(!(this.head===null||this.tail===null)){var i=this.head;for(e===this.head.data&&(this.head=this.head.next),e===this.tail.data&&(this.tail=this.tail.prev);i.next!==null&&i.data!==e;)i=i.next;i.data===e&&(i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.length--)}}},{key:"values",value:FL().mark(function e(){var i;return FL().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:i=this.head;case 1:if(i===null){r.next=7;break}return r.next=4,i.data;case 4:i=i.next,r.next=1;break;case 7:case"end":return r.stop()}},e,this)})}]),n}(),vx=function(){function n(){Mt(this,n),$(this,"parentMatrix",void 0),$(this,"startSpeed",0),$(this,"startColor",new qe),$(this,"startSize",1),$(this,"position",new S),$(this,"velocity",new S),$(this,"age",0),$(this,"life",1),$(this,"size",1),$(this,"angularVelocity",void 0),$(this,"rotation",0),$(this,"color",new qe),$(this,"uvTile",0)}return Tt(n,[{key:"died",get:function(){return this.age>=this.life}}]),n}(),fxe=Tt(function n(e,i,r){Mt(this,n),this.position=e,this.size=i,this.color=r}),yx=function(){function n(){Mt(this,n),$(this,"parentMatrix",void 0),$(this,"startSpeed",0),$(this,"startColor",new qe),$(this,"startSize",1),$(this,"position",new S),$(this,"localPosition",void 0),$(this,"velocity",new S),$(this,"age",0),$(this,"life",1),$(this,"size",1),$(this,"length",100),$(this,"color",new qe),$(this,"previous",new pxe),$(this,"uvTile",0)}return Tt(n,[{key:"update",value:function(){for(this.age<=this.life?this.previous.push(new fxe(this.position.clone(),this.size,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}},{key:"died",get:function(){return this.age>=this.life}},{key:"reset",value:function(){this.previous.clear()}}]),n}(),Hs=function(){function n(e){Mt(this,n),$(this,"type",void 0),this.value=e,this.type="value"}return Tt(n,[{key:"genValue",value:function(){return this.value}},{key:"toJSON",value:function(){return{type:"ConstantValue",value:this.value}}},{key:"clone",value:function(){return new n(this.value)}}],[{key:"fromJSON",value:function(e){return new n(e.value)}}]),n}(),hM=function(){function n(e,i){Mt(this,n),$(this,"type",void 0),this.a=e,this.b=i,this.type="value"}return Tt(n,[{key:"genValue",value:function(){return pi.lerp(this.a,this.b,Math.random())}},{key:"toJSON",value:function(){return{type:"IntervalValue",a:this.a,b:this.b}}},{key:"clone",value:function(){return new n(this.a,this.b)}}],[{key:"fromJSON",value:function(e){return new n(e.a,e.b)}}]),n}(),mxe=function(){function n(){Mt(this,n),$(this,"functions",void 0),this.functions=new Array}return Tt(n,[{key:"findFunction",value:function(e){for(var i=0,r=0,s=this.functions.length-1;r+1<s;)if(i=Math.floor((r+s)/2),e<this.getStartX(i))s=i-1;else if(e>this.getEndX(i))r=i+1;else return i;for(var o=r;o<=s;o++)if(e>=this.functions[o][1]&&e<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(e){return this.functions[e][1]}},{key:"setStartX",value:function(e,i){e>0&&(this.functions[e][1]=i)}},{key:"getEndX",value:function(e){return e+1<this.functions.length?this.functions[e+1][1]:1}},{key:"setEndX",value:function(e,i){e+1<this.functions.length&&(this.functions[e+1][1]=i)}},{key:"insertFunction",value:function(e,i){var r=this.findFunction(e);this.functions.splice(r+1,0,[i,e])}},{key:"removeFunction",value:function(e){return this.functions.splice(e,1)[0][0]}},{key:"getFunction",value:function(e){return this.functions[e][0]}},{key:"setFunction",value:function(e,i){this.functions[e][0]=i}},{key:"numOfFunctions",get:function(){return this.functions.length}}]),n}(),jL=function(){function n(e,i,r,s){Mt(this,n),$(this,"p",void 0),this.p=[e,i,r,s]}return Tt(n,[{key:"genValue",value:function(e){var i=e*e,r=e*e*e,s=1-e,o=s*s,a=o*s;return this.p[0]*a+this.p[1]*o*e*3+this.p[2]*s*i*3+this.p[3]*r}},{key:"derivativeCoefficients",value:function(e){for(var i=[],r=e,s=r.length-1;s>0;s--){for(var o=[],a=0;a<s;a++){var l=s*(r[a+1]-r[a]);o.push(l)}i.push(o),r=o}return i}},{key:"getSlope",value:function(e){var i=this.derivativeCoefficients(this.p)[0],r=1-e,s=r*r,o=r*e*2,a=e*e;return s*i[0]+o*i[1]+a*i[2]}},{key:"controlCurve",value:function(e,i){this.p[1]=e/3+this.p[0],this.p[2]=this.p[3]-i/3}},{key:"hull",value:function(e){var i=this.p,r=[],s,o=0,a=0,l=0,c=[];for(c[o++]=i[0],c[o++]=i[1],c[o++]=i[2],c[o++]=i[3];i.length>1;){for(r=[],a=0,l=i.length-1;a<l;a++)s=e*i[a]+(1-e)*i[a+1],c[o++]=s,r.push(s);i=r}return c}},{key:"split",value:function(e){var i=this.hull(e),r={left:new n(i[0],i[4],i[7],i[9]),right:new n(i[9],i[8],i[6],i[3]),span:i};return r}},{key:"clone",value:function(){return new n(this.p[0],this.p[1],this.p[2],this.p[3])}},{key:"toJSON",value:function(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}}],[{key:"fromJSON",value:function(e){return new n(e.p0,e.p1,e.p2,e.p3)}}]),n}(),gxe=function(n){lv(i,n);var e=cv(i);function i(){var r,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new jL(0,.3333333333333333,.6666666666666666,1),0]];return Mt(this,i),r=e.call(this),$(ai(r),"type",void 0),r.type="function",r.functions=s,r}return Tt(i,[{key:"genValue",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,s=this.findFunction(r);return s===-1?0:this.functions[s][0].genValue((r-this.getStartX(s))/(this.getEndX(s)-this.getStartX(s)))}},{key:"toSVG",value:function(r,s){if(s<1)return"";for(var o=["M",0,this.functions[0][0].p[0]].join(" "),a=1/s;a<=1;a+=1/s)o=[o,"L",a*r,this.genValue(a)].join(" ");return o}},{key:"toJSON",value:function(){return{type:"PiecewiseBezier",functions:this.functions.map(function(r){var s=hv(r,2),o=s[0],a=s[1];return{function:o.toJSON(),start:a}})}}},{key:"clone",value:function(){return new i(this.functions.map(function(r){var s=hv(r,2),o=s[0],a=s[1];return[o.clone(),a]}))}}],[{key:"fromJSON",value:function(r){return new i(r.functions.map(function(s){return[jL.fromJSON(s.function),s.start]}))}}]),i}(mxe);function qi(n){switch(n.type){case"ConstantValue":return Hs.fromJSON(n);case"IntervalValue":return hM.fromJSON(n);case"PiecewiseBezier":return gxe.fromJSON(n);default:return new Hs(0)}}var Ax=function(n){return{r:n.x,g:n.y,b:n.z,a:n.w}},bx=function(n){return new qe(n.r,n.g,n.b,n.a)},vxe=function(n,e){switch(e){case"Vector3":return new S(n.x,n.y,n.z);case"Vector4":return new qe(n.x,n.y,n.z,n.w);case"Color":return new S(n.r,n.g,n.b);case"Number":return n;default:return n}},yxe=function(n,e){switch(e){case"Vector3":return{x:n.x,y:n.y,z:n.z};case"Vector4":return{x:n.x,y:n.y,z:n.z,w:n.w};case"Color":return{r:n.x,g:n.y,b:n.z};case"Number":return n;default:return n}},Axe=function(){function n(e,i){Mt(this,n),$(this,"type",void 0),this.a=e,this.b=i,this.type="value"}return Tt(n,[{key:"genColor",value:function(e){var i=Math.random();return e.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"RandomColor",a:Ax(this.a),b:Ax(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(e){return new n(bx(e.a),bx(e.b))}}]),n}(),GL=function(){function n(e,i){Mt(this,n),$(this,"type",void 0),this.a=e,this.b=i,this.type="function"}return Tt(n,[{key:"genColor",value:function(e,i){return e.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"ColorRange",a:Ax(this.a),b:Ax(this.b)}}},{key:"clone",value:function(){return new n(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(e){return new n(bx(e.a),bx(e.b))}}]),n}(),uM=function(){function n(e,i){Mt(this,n),$(this,"keys",void 0),$(this,"type",void 0),$(this,"subType",void 0),this.subType=i,this.type="function",this.keys=e}return Tt(n,[{key:"findKey",value:function(e){for(var i=0,r=0,s=this.keys.length-1;r+1<s;)if(i=Math.floor((r+s)/2),e<this.getStartX(i))s=i-1;else if(e>this.getEndX(i))r=i+1;else return i;for(var o=r;o<=s;o++)if(e>=this.getStartX(o)&&e<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(e){return this.keys[e][1]}},{key:"getEndX",value:function(e){return e+1<this.keys.length?this.keys[e+1][1]:1}},{key:"genValue",value:function(e,i){var r=this.findKey(i);return this.subType==="Number"?r===-1?this.keys[0][0]:r+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[r+1][0]-this.keys[r][0])*((i-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))+this.keys[r][0]:r===-1?e.copy(this.keys[0][0]):r+1>=this.keys.length?e.copy(this.keys[this.keys.length-1][0]):e.copy(this.keys[r][0]).lerp(this.keys[r+1][0],(i-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))}},{key:"toJSON",value:function(){var e=this;return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(function(i){var r=hv(i,2),s=r[0],o=r[1];return{value:yxe(s,e.subType),pos:o}})}}},{key:"clone",value:function(){return this.subType==="Number"?new n(this.keys.map(function(e){var i=hv(e,2),r=i[0],s=i[1];return[r,s]}),this.subType):new n(this.keys.map(function(e){var i=hv(e,2),r=i[0],s=i[1];return[r.clone(),s]}),this.subType)}}],[{key:"fromJSON",value:function(e){return new n(e.keys.map(function(i){return[vxe(i.value,e.subType),i.pos]}),e.subType)}}]),n}(),dM=new S,HL=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new S(0,0,0),0],[new S(1,1,1),0]],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[[1,0],[1,1]];Mt(this,n),$(this,"type",void 0),$(this,"color",void 0),$(this,"alpha",void 0),this.type="function",this.color=new uM(e,"Color"),this.alpha=new uM(i,"Number")}return Tt(n,[{key:"genColor",value:function(e,i){return this.color.genValue(dM,i),e.set(dM.x,dM.y,dM.z,this.alpha.genValue(1,i))}},{key:"toJSON",value:function(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}},{key:"clone",value:function(){var e=new n;return e.alpha=this.alpha.clone(),e.color=this.color.clone(),e}}],[{key:"fromJSON",value:function(e){if(e.functions){var i=e.functions.map(function(s){return[GL.fromJSON(s.function).a,s.start]});return e.functions.length>0&&i.push([GL.fromJSON(e.functions[e.functions.length-1].function).b,1]),new n(i.map(function(s){return[new S(s[0].x,s[0].y,s[0].z),s[1]]}),i.map(function(s){return[s[0].w,s[1]]}))}else{var r=new n;return r.alpha=uM.fromJSON(e.alpha),r.color=uM.fromJSON(e.color),r}}}]),n}(),VL=new qe,bxe=function(){function n(e,i){Mt(this,n),$(this,"gradient1",void 0),$(this,"gradient2",void 0),$(this,"type",void 0),this.type="memorizedFunction",this.gradient1=e,this.gradient2=i}return Tt(n,[{key:"startGen",value:function(e){e.rand=Math.random()}},{key:"genColor",value:function(e,i,r){return this.gradient1.genColor(e,i),this.gradient2.genColor(VL,i),r&&r.rand?e.lerp(VL,r.rand):e.lerp(VL,Math.random()),e}},{key:"toJSON",value:function(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}},{key:"clone",value:function(){return new n(this.gradient1.clone(),this.gradient2.clone())}}],[{key:"fromJSON",value:function(e){return new n(HL.fromJSON(e.gradient1),HL.fromJSON(e.gradient2))}}]),n}(),pM=function(){function n(e){Mt(this,n),$(this,"type",void 0),this.color=e,this.type="value"}return Tt(n,[{key:"genColor",value:function(e){return e.copy(this.color)}},{key:"toJSON",value:function(){return{type:"ConstantColor",color:Ax(this.color)}}},{key:"clone",value:function(){return new n(this.color.clone())}}],[{key:"fromJSON",value:function(e){return new n(bx(e.color))}}]),n}();function QL(n){switch(n.type){case"ConstantColor":return pM.fromJSON(n);case"ColorRange":return GL.fromJSON(n);case"RandomColor":return Axe.fromJSON(n);case"Gradient":return HL.fromJSON(n);case"RandomColorBetweenGradient":return bxe.fromJSON(n);default:return new pM(new qe(1,1,1,1))}}var TW=function(){function n(){Mt(this,n),$(this,"type",void 0),this.type="rotation"}return Tt(n,[{key:"genValue",value:function(e,i){var r,s,o,a,l,c;do r=Math.random()*2-1,s=Math.random()*2-1,o=r*r+s*s;while(o>1);do a=Math.random()*2-1,l=Math.random()*2-1,c=a*a+l*l;while(c>1);var h=Math.sqrt((1-o)/c);return e.set(r,s,h*a,h*l),e}},{key:"toJSON",value:function(){return{type:"RandomQuat"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(e){return new n}}]),n}(),IW=function(){function n(e,i){Mt(this,n),$(this,"type",void 0),this.axis=e,this.angle=i,this.type="rotation"}return Tt(n,[{key:"genValue",value:function(e,i){return e.setFromAxisAngle(this.axis,this.angle.genValue(i))}},{key:"toJSON",value:function(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.axis.clone(),this.angle.clone())}}],[{key:"fromJSON",value:function(e){return new n(e.axis,qi(e.angle))}}]),n}(),xxe=function(){function n(e,i,r){Mt(this,n),$(this,"type",void 0),this.angleX=e,this.angleY=i,this.angleZ=r,this.type="rotation"}return Tt(n,[{key:"genValue",value:function(e,i){return e.setFromEuler(new ri(this.angleX.genValue(i),this.angleY.genValue(i),this.angleZ.genValue(i)))}},{key:"toJSON",value:function(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON()}}},{key:"clone",value:function(){return new n(this.angleX,this.angleY,this.angleZ)}}],[{key:"fromJSON",value:function(e){return new n(qi(e.angleX),qi(e.angleY),qi(e.angleZ))}}]),n}();function RW(n){switch(n.type){case"AxisAngle":return IW.fromJSON(n);case"Euler":return xxe.fromJSON(n);case"RandomQuat":return TW.fromJSON(n);default:return new TW}}function _xe(n){switch(n.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return qi(n);case"AxisAngle":case"RandomQuat":case"Euler":return RW(n);default:return new Hs(0)}}var PW=function(){function n(e){Mt(this,n),$(this,"type","ColorOverLife"),this.color=e}return Tt(n,[{key:"initialize",value:function(e){this.color.type==="memorizedFunction"&&(e.colorOverLifeMemory={},this.color.startGen(e.colorOverLifeMemory))}},{key:"update",value:function(e,i){this.color.type==="memorizedFunction"?this.color.genColor(e.color,e.age/e.life,e.colorOverLifeMemory):this.color.genColor(e.color,e.age/e.life),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(QL(e.color))}}]),n}(),BW=function(){function n(e,i){Mt(this,n),$(this,"type","RotationOverLife"),$(this,"tempQuat",new Ce),this.angularVelocity=e,this.dynamic=i}return Tt(n,[{key:"initialize",value:function(e){!this.dynamic&&e instanceof vx&&(e.angularVelocity=this.angularVelocity.genValue())}},{key:"update",value:function(e,i){this.dynamic?e.rotation+=i*this.angularVelocity.genValue(e.age/e.life):e instanceof vx&&(e.rotation+=i*e.angularVelocity)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qi(e.angularVelocity),e.dynamic)}}]),n}(),kW=function(){function n(e){Mt(this,n),$(this,"type","SizeOverLife"),this.size=e}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){e.size=e.startSize*this.size.genValue(e.age/e.life)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.size.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qi(e.size))}}]),n}(),OW=function(){function n(e){Mt(this,n),$(this,"type","SpeedOverLife"),this.speed=e}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){e.velocity.normalize().multiplyScalar(e.startSpeed*this.speed.genValue(e.age/e.life))}},{key:"toJSON",value:function(){return{type:this.type,speed:this.speed.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.speed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qi(e.speed))}}]),n}(),DW=function(){function n(e,i){Mt(this,n),$(this,"type","RotationBySpeed"),$(this,"tempQuat",new Ce),this.angularVelocity=e,this.speedRange=i}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){var r=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.rotation+=i*this.angularVelocity.genValue(r)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qi(e.angularVelocity),hM.fromJSON(e.speedRange))}}]),n}(),LW=function(){function n(e,i){Mt(this,n),$(this,"type","SizeBySpeed"),this.size=e,this.speedRange=i}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){var i=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.size=e.startSize*this.size.genValue(i)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.size.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qi(e.size),hM.fromJSON(e.speedRange))}}]),n}(),UW=function(){function n(e,i){Mt(this,n),$(this,"type","ColorBySpeed"),this.color=e,this.speedRange=i}return Tt(n,[{key:"initialize",value:function(e){this.color.type==="memorizedFunction"&&(e.colorOverLifeMemory={},this.color.startGen(e.colorOverLifeMemory))}},{key:"update",value:function(e,i){var r=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.type==="memorizedFunction"?this.color.genColor(e.color,r,e.colorOverLifeMemory):this.color.genColor(e.color,r),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"clone",value:function(){return new n(this.color.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(QL(e.color),hM.fromJSON(e.speedRange))}}]),n}(),FW=function(){function n(e){Mt(this,n),$(this,"type","FrameOverLife"),this.frame=e}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){e.uvTile=Math.floor(this.frame.genValue(e.age/e.life))}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,frame:this.frame.toJSON()}}},{key:"clone",value:function(){return new n(this.frame.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qi(e.frame))}}]),n}();new S(0,0,1);var NW=function(){function n(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new S(0,1,0);Mt(this,n),$(this,"type","OrbitOverLife"),$(this,"rotation",void 0),$(this,"line",void 0),$(this,"temp",new S),this.orbitSpeed=e,this.axis=i,this.rotation=new Ce,this.line=new Ho}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){this.line.set(new S(0,0,0),this.axis),this.line.closestPointToPoint(e.position,!1,this.temp),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(e.age/e.life)*i),e.position.sub(this.temp),e.position.applyQuaternion(this.rotation),e.position.add(this.temp)}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}},{key:"clone",value:function(){return new n(this.orbitSpeed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qi(e.orbitSpeed),e.axis?new S(e.axis[0],e.axis[1],e.axis[2]):void 0)}}]),n}(),zW=function(){function n(e,i){Mt(this,n),$(this,"type","ApplyForce"),$(this,"magnitudeValue",void 0),this.direction=e,this.magnitude=i,this.magnitudeValue=this.magnitude.genValue()}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){e.velocity.addScaledVector(this.direction,this.magnitudeValue*i)}},{key:"frameUpdate",value:function(e){this.magnitudeValue=this.magnitude.genValue()}},{key:"toJSON",value:function(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}},{key:"clone",value:function(){return new n(this.direction.clone(),this.magnitude.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){var i;return new n(new S(e.direction[0],e.direction[1],e.direction[2]),qi((i=e.magnitude)!==null&&i!==void 0?i:e.force))}}]),n}(),jW=function(){function n(e,i){Mt(this,n),$(this,"type","GravityForce"),$(this,"temp",new S),this.center=e,this.magnitude=i}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){this.temp.copy(this.center).sub(e.position).normalize(),e.velocity.addScaledVector(this.temp,this.magnitude/e.position.distanceToSquared(this.center)*i)}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}},{key:"clone",value:function(){return new n(this.center.clone(),this.magnitude)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new S(e.center[0],e.center[1],e.center[2]),e.magnitude)}}]),n}(),GW=function(){function n(e){Mt(this,n),$(this,"type","WidthOverLength"),this.width=e}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){if(e instanceof yx)for(var i=e.previous.values(),r=0;r<e.previous.length;r++){var s=i.next();s.value.size=this.width.genValue((e.previous.length-r)/e.length)}}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,width:this.width.toJSON()}}},{key:"clone",value:function(){return new n(this.width.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qi(e.width))}}]),n}();new S(0,0,1);var HW=function(){function n(e){Mt(this,n),$(this,"type","ChangeEmitDirection"),$(this,"_temp",new S),$(this,"_q",new Ce),this.angle=e}return Tt(n,[{key:"initialize",value:function(e){var i=e.velocity.length();i!=0&&(e.velocity.normalize(),e.velocity.x===0&&e.velocity.y===0?this._temp.set(0,e.velocity.z,0):this._temp.set(-e.velocity.y,e.velocity.x,0),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue()),this._temp.copy(e.velocity),e.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),e.velocity.applyQuaternion(this._q),e.velocity.setLength(i))}},{key:"update",value:function(e,i){}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new n(this.angle)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qi(e.angle))}}]),n}(),wxe=new S(1,1,1),VW=new S(0,0,1),QW=function(){function n(e,i,r){Mt(this,n),$(this,"type","EmitSubParticleSystem"),$(this,"q_",new Ce),$(this,"v_",new S),$(this,"v2_",new S),this.particleSystem=e,this.useVelocityAsBasis=i,this.subParticleSystem=r,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}return Tt(n,[{key:"initialize",value:function(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:new he}}},{key:"update",value:function(e,i){if(!(!this.subParticleSystem||!e.emissionState)){var r=e.emissionState.matrix,s;if(e.rotation===void 0||this.useVelocityAsBasis)if(e.velocity.x===0&&e.velocity.y===0&&(e.velocity.z===1||e.velocity.z===0))r.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1);else{this.v_.copy(VW).cross(e.velocity),this.v2_.copy(e.velocity).cross(this.v_);var o=this.v_.length(),a=this.v2_.length();r.set(this.v_.x/o,this.v2_.x/a,e.velocity.x,e.position.x,this.v_.y/o,this.v2_.y/a,e.velocity.y,e.position.y,this.v_.z/o,this.v2_.z/a,e.velocity.z,e.position.z,0,0,0,1)}else e.rotation instanceof Ce?s=e.rotation:(this.q_.setFromAxisAngle(VW,e.rotation),s=this.q_),r.compose(e.position,s,wxe);this.particleSystem.worldSpace||r.multiplyMatrices(this.particleSystem.emitter.matrixWorld,r),this.subParticleSystem.system.emit(i,e.emissionState,r)}}},{key:"frameUpdate",value:function(e){}},{key:"toJSON",value:function(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis}}},{key:"clone",value:function(){return new n(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e,i){return new n(i,e.useVelocityAsBasis,e.subParticleSystem)}}]),n}(),Sxe=.5*(Math.sqrt(3)-1),xx=(3-Math.sqrt(3))/6,Cxe=1/3,jc=1/6,Exe=(Math.sqrt(5)-1)/4,ms=(5-Math.sqrt(5))/20,jr=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),sr=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),WW=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Math.random;Mt(this,n),$(this,"p",void 0),$(this,"perm",void 0),$(this,"permMod12",void 0);var i=typeof e=="function"?e:Txe(e);this.p=Mxe(i),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var r=0;r<512;r++)this.perm[r]=this.p[r&255],this.permMod12[r]=this.perm[r]%12}return Tt(n,[{key:"noise2D",value:function(e,i){var r=this.permMod12,s=this.perm,o=0,a=0,l=0,c=(e+i)*Sxe,h=Math.floor(e+c),u=Math.floor(i+c),d=(h+u)*xx,f=h-d,m=u-d,g=e-f,v=i-m,y,A;g>v?(y=1,A=0):(y=0,A=1);var b=g-y+xx,x=v-A+xx,_=g-1+2*xx,w=v-1+2*xx,T=h&255,M=u&255,R=.5-g*g-v*v;if(R>=0){var B=r[T+s[M]]*3;R*=R,o=R*R*(jr[B]*g+jr[B+1]*v)}var E=.5-b*b-x*x;if(E>=0){var P=r[T+y+s[M+A]]*3;E*=E,a=E*E*(jr[P]*b+jr[P+1]*x)}var O=.5-_*_-w*w;if(O>=0){var N=r[T+1+s[M+1]]*3;O*=O,l=O*O*(jr[N]*_+jr[N+1]*w)}return 70*(o+a+l)}},{key:"noise3D",value:function(e,i,r){var s=this.permMod12,o=this.perm,a,l,c,h,u=(e+i+r)*Cxe,d=Math.floor(e+u),f=Math.floor(i+u),m=Math.floor(r+u),g=(d+f+m)*jc,v=d-g,y=f-g,A=m-g,b=e-v,x=i-y,_=r-A,w,T,M,R,B,E;b>=x?x>=_?(w=1,T=0,M=0,R=1,B=1,E=0):b>=_?(w=1,T=0,M=0,R=1,B=0,E=1):(w=0,T=0,M=1,R=1,B=0,E=1):x<_?(w=0,T=0,M=1,R=0,B=1,E=1):b<_?(w=0,T=1,M=0,R=0,B=1,E=1):(w=0,T=1,M=0,R=1,B=1,E=0);var P=b-w+jc,O=x-T+jc,N=_-M+jc,L=b-R+2*jc,Q=x-B+2*jc,D=_-E+2*jc,F=b-1+3*jc,H=x-1+3*jc,K=_-1+3*jc,Z=d&255,oe=f&255,we=m&255,Oe=.6-b*b-x*x-_*_;if(Oe<0)a=0;else{var se=s[Z+o[oe+o[we]]]*3;Oe*=Oe,a=Oe*Oe*(jr[se]*b+jr[se+1]*x+jr[se+2]*_)}var _e=.6-P*P-O*O-N*N;if(_e<0)l=0;else{var Ee=s[Z+w+o[oe+T+o[we+M]]]*3;_e*=_e,l=_e*_e*(jr[Ee]*P+jr[Ee+1]*O+jr[Ee+2]*N)}var et=.6-L*L-Q*Q-D*D;if(et<0)c=0;else{var We=s[Z+R+o[oe+B+o[we+E]]]*3;et*=et,c=et*et*(jr[We]*L+jr[We+1]*Q+jr[We+2]*D)}var Ue=.6-F*F-H*H-K*K;if(Ue<0)h=0;else{var st=s[Z+1+o[oe+1+o[we+1]]]*3;Ue*=Ue,h=Ue*Ue*(jr[st]*F+jr[st+1]*H+jr[st+2]*K)}return 32*(a+l+c+h)}},{key:"noise4D",value:function(e,i,r,s){var o=this.perm,a,l,c,h,u,d=(e+i+r+s)*Exe,f=Math.floor(e+d),m=Math.floor(i+d),g=Math.floor(r+d),v=Math.floor(s+d),y=(f+m+g+v)*ms,A=f-y,b=m-y,x=g-y,_=v-y,w=e-A,T=i-b,M=r-x,R=s-_,B=0,E=0,P=0,O=0;w>T?B++:E++,w>M?B++:P++,w>R?B++:O++,T>M?E++:P++,T>R?E++:O++,M>R?P++:O++;var N=B>=3?1:0,L=E>=3?1:0,Q=P>=3?1:0,D=O>=3?1:0,F=B>=2?1:0,H=E>=2?1:0,K=P>=2?1:0,Z=O>=2?1:0,oe=B>=1?1:0,we=E>=1?1:0,Oe=P>=1?1:0,se=O>=1?1:0,_e=w-N+ms,Ee=T-L+ms,et=M-Q+ms,We=R-D+ms,Ue=w-F+2*ms,st=T-H+2*ms,ge=M-K+2*ms,X=R-Z+2*ms,ze=w-oe+3*ms,Ie=T-we+3*ms,Te=M-Oe+3*ms,Ve=R-se+3*ms,Ae=w-1+4*ms,nt=T-1+4*ms,ct=M-1+4*ms,It=R-1+4*ms,V=f&255,U=m&255,ue=g&255,Me=v&255,De=.6-w*w-T*T-M*M-R*R;if(De<0)a=0;else{var Pe=o[V+o[U+o[ue+o[Me]]]]%32*4;De*=De,a=De*De*(sr[Pe]*w+sr[Pe+1]*T+sr[Pe+2]*M+sr[Pe+3]*R)}var At=.6-_e*_e-Ee*Ee-et*et-We*We;if(At<0)l=0;else{var ht=o[V+N+o[U+L+o[ue+Q+o[Me+D]]]]%32*4;At*=At,l=At*At*(sr[ht]*_e+sr[ht+1]*Ee+sr[ht+2]*et+sr[ht+3]*We)}var je=.6-Ue*Ue-st*st-ge*ge-X*X;if(je<0)c=0;else{var He=o[V+F+o[U+H+o[ue+K+o[Me+Z]]]]%32*4;je*=je,c=je*je*(sr[He]*Ue+sr[He+1]*st+sr[He+2]*ge+sr[He+3]*X)}var St=.6-ze*ze-Ie*Ie-Te*Te-Ve*Ve;if(St<0)h=0;else{var Fe=o[V+oe+o[U+we+o[ue+Oe+o[Me+se]]]]%32*4;St*=St,h=St*St*(sr[Fe]*ze+sr[Fe+1]*Ie+sr[Fe+2]*Te+sr[Fe+3]*Ve)}var Kt=.6-Ae*Ae-nt*nt-ct*ct-It*It;if(Kt<0)u=0;else{var Le=o[V+1+o[U+1+o[ue+1+o[Me+1]]]]%32*4;Kt*=Kt,u=Kt*Kt*(sr[Le]*Ae+sr[Le+1]*nt+sr[Le+2]*ct+sr[Le+3]*It)}return 27*(a+l+c+h+u)}}]),n}();function Mxe(n){for(var e=new Uint8Array(256),i=0;i<256;i++)e[i]=i;for(var r=0;r<255;r++){var s=r+~~(n()*(256-r)),o=e[r];e[r]=e[s],e[s]=o}return e}function Txe(n){var e=0,i=0,r=0,s=1,o=Ixe();return e=o(" "),i=o(" "),r=o(" "),e-=o(n),e<0&&(e+=1),i-=o(n),i<0&&(i+=1),r-=o(n),r<0&&(r+=1),function(){var a=2091639*e+s*23283064365386963e-26;return e=i,i=r,r=a-(s=a|0)}}function Ixe(){var n=4022871197;return function(e){e=e.toString();for(var i=0;i<e.length;i++){n+=e.charCodeAt(i);var r=.02519603282416938*n;n=r>>>0,r-=n,r*=n,n=r>>>0,r-=n,n+=r*4294967296}return(n>>>0)*23283064365386963e-26}}var XW=function(){function n(e,i,r,s){Mt(this,n),$(this,"type","TurbulenceField"),$(this,"generator",new WW),$(this,"timeOffset",new S),$(this,"temp",new S),$(this,"temp2",new S),this.scale=e,this.octaves=i,this.velocityMultiplier=r,this.timeScale=s,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e,i){var r=e.position.x/this.scale.x,s=e.position.y/this.scale.y,o=e.position.z/this.scale.z;this.temp.set(0,0,0);for(var a=1,l=0;l<this.octaves;l++)this.temp2.set(this.generator.noise4D(r*a,s*a,o*a,this.timeOffset.x*a)/a,this.generator.noise4D(r*a,s*a,o*a,this.timeOffset.y*a)/a,this.generator.noise4D(r*a,s*a,o*a,this.timeOffset.z*a)/a),this.temp.add(this.temp2),a*=2;this.temp.multiply(this.velocityMultiplier),e.velocity.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}},{key:"frameUpdate",value:function(e){this.timeOffset.x+=e*this.timeScale.x,this.timeOffset.y+=e*this.timeScale.y,this.timeOffset.z+=e*this.timeScale.z}},{key:"clone",value:function(){return new n(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new S(e.scale[0],e.scale[1],e.scale[2]),e.octaves,new S(e.velocityMultiplier[0],e.velocityMultiplier[1],e.velocityMultiplier[2]),new S(e.timeScale[0],e.timeScale[1],e.timeScale[2]))}}]),n}(),qW=new Ce,YW=function(){function n(e,i){Mt(this,n),$(this,"type","Rotation3DOverLife"),$(this,"tempQuat",new Ce),this.angularVelocity=e,this.dynamic=i}return Tt(n,[{key:"initialize",value:function(e){!this.dynamic&&e instanceof vx&&(e.angularVelocity=new Ce,this.angularVelocity.genValue(e.angularVelocity))}},{key:"update",value:function(e,i){this.dynamic?(this.angularVelocity.genValue(this.tempQuat,e.age/e.life),this.tempQuat.slerpQuaternions(qW,this.tempQuat,i),e.rotation.multiply(this.tempQuat)):e instanceof vx&&(this.tempQuat.slerpQuaternions(qW,e.angularVelocity,i),e.rotation.multiply(this.tempQuat))}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(RW(e.angularVelocity),e.dynamic)}}]),n}(),JW=function(){function n(e,i,r){Mt(this,n),$(this,"type","ForceOverLife"),$(this,"_temp",new S),this.x=e,this.y=i,this.z=r}return Tt(n,[{key:"initialize",value:function(e){}},{key:"update",value:function(e){this._temp.set(this.x.genValue(e.age/e.life),this.y.genValue(e.age/e.life),this.z.genValue(e.age/e.life)),e.velocity.add(this._temp)}},{key:"toJSON",value:function(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}},{key:"frameUpdate",value:function(e){}},{key:"clone",value:function(){return new n(this.x.clone(),this.y.clone(),this.z.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(qi(e.x),qi(e.y),qi(e.z))}}]),n}(),KW=function(){function n(e,i){Mt(this,n),$(this,"type","Noise"),$(this,"generator",new WW),$(this,"duration",0),$(this,"temp",new S),this.frequency=e,this.power=i}return Tt(n,[{key:"initialize",value:function(e){e.startTime=this.duration}},{key:"update",value:function(e,i){this.temp.set(this.generator.noise2D(e.startTime*this.frequency.x,e.life/e.age*this.frequency.x),this.generator.noise2D(e.startTime*this.frequency.y+100.25,e.life/e.age*this.frequency.y+100.154),this.generator.noise2D(e.startTime*this.frequency.z+200.89,e.life/e.age*this.frequency.z+200.1)).multiply(this.power),e.position.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,frequency:[this.frequency.x,this.frequency.y,this.frequency.z],power:[this.power.x,this.power.y,this.power.z]}}},{key:"frameUpdate",value:function(e){this.duration+=e}},{key:"clone",value:function(){return new n(this.frequency.clone(),this.power.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(e){return new n(new S(e.frequency[0],e.frequency[1],e.frequency[2]),new S(e.power[0],e.power[1],e.power[2]))}}]),n}(),Rxe={ApplyForce:{type:"ApplyForce",constructor:zW,params:[["direction","vec3"],["magnitude","value"]],loadJSON:zW.fromJSON},Noise:{type:"Noise",constructor:KW,params:[["frequency","vec3"],["power","vec3"]],loadJSON:KW.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:XW,params:[["scale","vec3"],["octaves","number"],["velocityMultiplier","vec3"],["timeScale","vec3"]],loadJSON:XW.fromJSON},GravityForce:{type:"GravityForce",constructor:jW,params:[["center","vec3"],["magnitude","number"]],loadJSON:jW.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:PW,params:[["color","colorFunc"]],loadJSON:PW.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:BW,params:[["angularVelocity","valueFunc"],["dynamic","boolean"]],loadJSON:BW.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:YW,params:[["angularVelocity","rotationFunc"],["dynamic","boolean"]],loadJSON:YW.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:kW,params:[["size","valueFunc"]],loadJSON:kW.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:UW,params:[["color","colorFunc"],["speedRange","range"]],loadJSON:UW.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:DW,params:[["angularVelocity","valueFunc"],["speedRange","range"]],loadJSON:DW.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:LW,params:[["size","valueFunc"],["speedRange","range"]],loadJSON:LW.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:OW,params:[["speed","valueFunc"]],loadJSON:OW.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:FW,params:[["frame","valueFunc"]],loadJSON:FW.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:JW,params:[["x","valueFunc"],["y","valueFunc"],["z","valueFunc"]],loadJSON:JW.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:NW,params:[["orbitSpeed","valueFunc"],["axis","vec3"]],loadJSON:NW.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:GW,params:[["width","valueFunc"]],loadJSON:GW.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:HW,params:[["angle","value"]],loadJSON:HW.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:QW,params:[["particleSystem","self"],["useVelocityAsBasis","boolean"],["subParticleSystem","particleSystem"]],loadJSON:QW.fromJSON}};function Pxe(n,e){return Rxe[n.type].loadJSON(n,e)}var ZW=function(){function n(){var e,i,r,s,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Mt(this,n),$(this,"type","cone"),$(this,"radius",void 0),$(this,"arc",void 0),$(this,"thickness",void 0),$(this,"angle",void 0),this.radius=(e=o.radius)!==null&&e!==void 0?e:10,this.arc=(i=o.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(r=o.thickness)!==null&&r!==void 0?r:1,this.angle=(s=o.angle)!==null&&s!==void 0?s:Math.PI/6}return Tt(n,[{key:"initialize",value:function(e){var i=Math.random(),r=pi.lerp(1-this.thickness,1,Math.random()),s=i*this.arc,o=Math.sqrt(r),a=Math.sin(s),l=Math.cos(s);e.position.x=o*l,e.position.y=o*a,e.position.z=0;var c=this.angle*o;e.velocity.set(0,0,Math.cos(c)).addScaledVector(e.position,Math.sin(c)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),$W=function(){function n(){var e,i,r,s,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Mt(this,n),$(this,"type","donut"),$(this,"radius",void 0),$(this,"arc",void 0),$(this,"thickness",void 0),$(this,"angle",void 0),this.radius=(e=o.radius)!==null&&e!==void 0?e:10,this.arc=(i=o.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(r=o.thickness)!==null&&r!==void 0?r:1,this.angle=(s=o.angle)!==null&&s!==void 0?s:Math.PI/6}return Tt(n,[{key:"initialize",value:function(e){var i=Math.random(),r=pi.lerp(this.thickness,1,Math.random()),s=i*this.arc,o=Math.sqrt(r),a=Math.sin(s),l=Math.cos(s);e.position.x=o*l,e.position.y=o*a,e.position.z=0;var c=this.angle*o;e.velocity.set(0,0,Math.cos(c)).addScaledVector(e.position,Math.sin(c)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),e7=function(){function n(){Mt(this,n),$(this,"type","point")}return Tt(n,[{key:"initialize",value:function(e){var i=Math.random(),r=Math.random(),s=i*Math.PI*2,o=Math.acos(2*r-1),a=Math.cbrt(Math.random()),l=Math.sin(s),c=Math.cos(s),h=Math.sin(o),u=Math.cos(o);e.velocity.x=a*h*c,e.velocity.y=a*h*l,e.velocity.z=a*u,e.velocity.multiplyScalar(e.startSpeed),e.position.setScalar(0)}},{key:"toJSON",value:function(){return{type:"point"}}},{key:"clone",value:function(){return new n}}],[{key:"fromJSON",value:function(e){return new n}}]),n}(),WL=function(){function n(){var e,i,r,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Mt(this,n),$(this,"type","sphere"),$(this,"radius",void 0),$(this,"arc",void 0),$(this,"thickness",void 0),this.radius=(e=s.radius)!==null&&e!==void 0?e:10,this.arc=(i=s.arc)!==null&&i!==void 0?i:2*Math.PI,this.thickness=(r=s.thickness)!==null&&r!==void 0?r:1}return Tt(n,[{key:"initialize",value:function(e){var i=Math.random(),r=Math.random(),s=pi.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=Math.acos(2*r-1),l=Math.cbrt(s),c=Math.sin(o),h=Math.cos(o),u=Math.sin(a),d=Math.cos(a);e.position.x=l*u*h,e.position.y=l*u*c,e.position.z=l*d,e.velocity.setScalar(0).addScaledVector(e.position,e.startSpeed),e.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness}}},{key:"clone",value:function(){return new n({radius:this.radius,arc:this.arc,thickness:this.thickness})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),t7=function(){function n(e){Mt(this,n),$(this,"type","mesh_surface"),$(this,"_triangleIndexToArea",[]),$(this,"_geometry",void 0),$(this,"_tempA",new S),$(this,"_tempB",new S),$(this,"_tempC",new S),e&&(this.geometry=e)}return Tt(n,[{key:"geometry",get:function(){return this._geometry},set:function(e){if(this._geometry=e,e!==void 0&&typeof e!="string"){var i=new Xr;this._triangleIndexToArea.length=0;var r=0;if(e.getIndex()){var s=e.getIndex().array,o=s.length/3;this._triangleIndexToArea.push(0);for(var a=0;a<o;a++)i.setFromAttributeAndIndices(e.getAttribute("position"),s[a*3],s[a*3+1],s[a*3+2]),r+=i.getArea(),this._triangleIndexToArea.push(r);e.userData.triangleIndexToArea=this._triangleIndexToArea}}}},{key:"initialize",value:function(e){var i=this._geometry;if(!i||i.getIndex()===null){e.position.set(0,0,0),e.velocity.set(0,0,1).multiplyScalar(e.startSpeed);return}for(var r=this._triangleIndexToArea.length-1,s=0,o=r,a=Math.random()*this._triangleIndexToArea[r];s+1<o;){var l=Math.floor((s+o)/2);a<this._triangleIndexToArea[l]?o=l:s=l}var c=Math.random(),h=Math.random();c+h>1&&(c=1-c,h=1-h);var u=i.getIndex().array[s*3],d=i.getIndex().array[s*3+1],f=i.getIndex().array[s*3+2],m=i.getAttribute("position");this._tempA.fromBufferAttribute(m,u),this._tempB.fromBufferAttribute(m,d),this._tempC.fromBufferAttribute(m,f),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,c).addScaledVector(this._tempC,h),e.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),e.velocity.copy(this._tempA).normalize().multiplyScalar(e.startSpeed)}},{key:"toJSON",value:function(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}},{key:"clone",value:function(){return new n(this._geometry)}}],[{key:"fromJSON",value:function(e,i){return new n(i.geometries[e.geometry])}}]),n}(),i7=function(){function n(){var e,i,r,s,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Mt(this,n),$(this,"type","grid"),$(this,"width",void 0),$(this,"height",void 0),$(this,"column",void 0),$(this,"row",void 0),this.width=(e=o.width)!==null&&e!==void 0?e:1,this.height=(i=o.height)!==null&&i!==void 0?i:1,this.column=(r=o.column)!==null&&r!==void 0?r:10,this.row=(s=o.row)!==null&&s!==void 0?s:10}return Tt(n,[{key:"initialize",value:function(e){var i=Math.floor(Math.random()*this.row),r=Math.floor(Math.random()*this.column);e.position.x=r*this.width/this.column-this.width/2,e.position.y=i*this.height/this.row-this.height/2,e.position.z=0,e.velocity.set(0,0,e.startSpeed)}},{key:"toJSON",value:function(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}},{key:"clone",value:function(){return new n({width:this.width,height:this.height,column:this.column,row:this.row})}}],[{key:"fromJSON",value:function(e){return new n(e)}}]),n}(),Bxe={cone:{type:"cone",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:ZW,loadJSON:ZW.fromJSON},donut:{type:"donut",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:$W,loadJSON:$W.fromJSON},point:{type:"point",params:[],constructor:e7,loadJSON:e7.fromJSON},sphere:{type:"sphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:WL,loadJSON:WL.fromJSON},grid:{type:"grid",params:[["width","number"],["height","number"],["rows","number"],["column","number"]],constructor:i7,loadJSON:i7.fromJSON},mesh_surface:{type:"mesh_surface",params:[["geometry","geometry"]],constructor:t7,loadJSON:t7.fromJSON}};function kxe(n,e){return Bxe[n.type].loadJSON(n,e)}var at=function(n){return n[n.BillBoard=0]="BillBoard",n[n.StretchedBillBoard=1]="StretchedBillBoard",n[n.Mesh=2]="Mesh",n[n.Trail=3]="Trail",n[n.HorizontalBillBoard=4]="HorizontalBillBoard",n[n.VerticalBillBoard=5]="VerticalBillBoard",n}({}),n7=function(n){lv(i,n);var e=cv(i);function i(r){var s;Mt(this,i),s=e.call(this),$(ai(s),"type","VFXBatch"),$(ai(s),"systems",void 0),$(ai(s),"settings",void 0),$(ai(s),"maxParticles",void 0),s.maxParticles=1e3,s.systems=new Set;var o=new Cs;return o.mask=r.layers.mask,s.settings={instancingGeometry:r.instancingGeometry,renderMode:r.renderMode,renderOrder:r.renderOrder,material:r.material.clone(),uTileCount:r.uTileCount,vTileCount:r.vTileCount,layers:o},s.frustumCulled=!1,s.renderOrder=s.settings.renderOrder,s}return Tt(i,[{key:"addSystem",value:function(r){this.systems.add(r)}},{key:"removeSystem",value:function(r){this.systems.delete(r)}}]),i}(pe),Oxe=new S(0,0,1),XL=new Ce,Dxe=new S,Lxe=new S;new S;var r7=60,Uxe=new cr(1,1,1,1),Fxe=function(){function n(e){var i,r,s,o,a,l,c,h,u,d,f,m,g,v,y,A,b,x,_,w,T;Mt(this,n),$(this,"autoDestroy",void 0),$(this,"prewarm",void 0),$(this,"looping",void 0),$(this,"duration",void 0),$(this,"startLife",void 0),$(this,"startSpeed",void 0),$(this,"startRotation",void 0),$(this,"startSize",void 0),$(this,"startColor",void 0),$(this,"startTileIndex",void 0),$(this,"rendererEmitterSettings",void 0),$(this,"emissionOverTime",void 0),$(this,"emissionOverDistance",void 0),$(this,"emissionBursts",void 0),$(this,"onlyUsedByOther",void 0),$(this,"worldSpace",void 0),$(this,"speedFactor",void 0),$(this,"particleNum",void 0),$(this,"paused",void 0),$(this,"particles",void 0),$(this,"emitterShape",void 0),$(this,"emitter",void 0),$(this,"rendererSettings",void 0),$(this,"neededToUpdateRender",void 0),$(this,"behaviors",void 0),$(this,"prewarmed",void 0),$(this,"emissionState",void 0),$(this,"emitEnded",void 0),$(this,"markForDestroy",void 0),$(this,"previousWorldPos",void 0),$(this,"temp",new S),$(this,"travelDistance",0),$(this,"normalMatrix",new Lt),$(this,"_renderer",void 0),this.autoDestroy=e.autoDestroy===void 0?!1:e.autoDestroy,this.duration=(i=e.duration)!==null&&i!==void 0?i:1,this.looping=e.looping===void 0?!0:e.looping,this.prewarm=e.prewarm===void 0?!1:e.prewarm,this.startLife=(r=e.startLife)!==null&&r!==void 0?r:new Hs(5),this.startSpeed=(s=e.startSpeed)!==null&&s!==void 0?s:new Hs(0),this.startRotation=(o=e.startRotation)!==null&&o!==void 0?o:new Hs(0),this.startSize=(a=e.startSize)!==null&&a!==void 0?a:new Hs(1),this.startColor=(l=e.startColor)!==null&&l!==void 0?l:new pM(new qe(1,1,1,1)),this.emissionOverTime=(c=e.emissionOverTime)!==null&&c!==void 0?c:new Hs(10),this.emissionOverDistance=(h=e.emissionOverDistance)!==null&&h!==void 0?h:new Hs(0),this.emissionBursts=(u=e.emissionBursts)!==null&&u!==void 0?u:[],this.onlyUsedByOther=(d=e.onlyUsedByOther)!==null&&d!==void 0?d:!1,this.emitterShape=(f=e.shape)!==null&&f!==void 0?f:new WL,this.behaviors=(m=e.behaviors)!==null&&m!==void 0?m:new Array,this.worldSpace=(g=e.worldSpace)!==null&&g!==void 0?g:!1,this.speedFactor=(v=e.speedFactor)!==null&&v!==void 0?v:0,this.rendererEmitterSettings=(y=e.rendererEmitterSettings)!==null&&y!==void 0?y:{},this.rendererSettings={instancingGeometry:(A=e.instancingGeometry)!==null&&A!==void 0?A:Uxe,renderMode:(b=e.renderMode)!==null&&b!==void 0?b:at.BillBoard,renderOrder:(x=e.renderOrder)!==null&&x!==void 0?x:0,material:e.material,uTileCount:(_=e.uTileCount)!==null&&_!==void 0?_:1,vTileCount:(w=e.vTileCount)!==null&&w!==void 0?w:1,layers:(T=e.layers)!==null&&T!==void 0?T:new Cs},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=e.startTileIndex||new Hs(0),this.emitter=new dxe(this),this.paused=!1,this.particleNum=0,this.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}return Tt(n,[{key:"time",get:function(){return this.emissionState.time},set:function(e){this.emissionState.time=e}},{key:"layers",get:function(){return this.rendererSettings.layers}},{key:"texture",get:function(){return this.rendererSettings.material.map},set:function(e){this.rendererSettings.material.map=e,this.neededToUpdateRender=!0}},{key:"material",get:function(){return this.rendererSettings.material},set:function(e){this.rendererSettings.material=e,this.neededToUpdateRender=!0}},{key:"uTileCount",get:function(){return this.rendererSettings.uTileCount},set:function(e){this.rendererSettings.uTileCount=e,this.neededToUpdateRender=!0}},{key:"vTileCount",get:function(){return this.rendererSettings.vTileCount},set:function(e){this.rendererSettings.vTileCount=e,this.neededToUpdateRender=!0}},{key:"instancingGeometry",get:function(){return this.rendererSettings.instancingGeometry},set:function(e){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=e,this.neededToUpdateRender=!0}},{key:"renderMode",get:function(){return this.rendererSettings.renderMode},set:function(e){if((this.rendererSettings.renderMode!=at.Trail&&e===at.Trail||this.rendererSettings.renderMode==at.Trail&&e!==at.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==e)switch(e){case at.Trail:this.rendererEmitterSettings={startLength:new Hs(30),followLocalOrigin:!1};break;case at.Mesh:this.rendererEmitterSettings={geometry:new cr(1,1)},this.startRotation=new IW(new S(0,1,0),new Hs(0));break;case at.BillBoard:case at.VerticalBillBoard:case at.HorizontalBillBoard:case at.StretchedBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===at.Mesh&&(this.startRotation=new Hs(0));break}this.rendererSettings.renderMode=e,this.neededToUpdateRender=!0}},{key:"renderOrder",get:function(){return this.rendererSettings.renderOrder},set:function(e){this.rendererSettings.renderOrder=e,this.neededToUpdateRender=!0}},{key:"blending",get:function(){return this.rendererSettings.material.blending},set:function(e){this.rendererSettings.material.blending=e,this.neededToUpdateRender=!0}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"spawn",value:function(e,i,r){XL.setFromRotationMatrix(r);var s=Dxe,o=XL,a=Lxe;r.decompose(s,o,a);for(var l=0;l<e;l++){for(this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===at.Trail?this.particles.push(new yx):this.particles.push(new vx);var c=this.particles[this.particleNum-1];if(this.startColor.genColor(c.startColor,this.emissionState.time,{}),c.color.copy(c.startColor),c.startSpeed=this.startSpeed.genValue(i.time/this.duration),c.life=this.startLife.genValue(i.time/this.duration),c.age=0,c.startSize=this.startSize.genValue(i.time/this.duration),c.uvTile=Math.floor(this.startTileIndex.genValue()),c.size=c.startSize,this.rendererSettings.renderMode===at.Mesh||this.rendererSettings.renderMode===at.BillBoard||this.rendererSettings.renderMode===at.VerticalBillBoard||this.rendererSettings.renderMode===at.HorizontalBillBoard||this.rendererSettings.renderMode===at.StretchedBillBoard){var h=c;this.rendererSettings.renderMode===at.Mesh?(h.rotation instanceof Ce||(h.rotation=new Ce),this.startRotation.type==="rotation"?this.startRotation.genValue(h.rotation,i.time/this.duration):h.rotation.setFromAxisAngle(Oxe,this.startRotation.genValue(i.time/this.duration))):this.startRotation.type==="rotation"?h.rotation=0:h.rotation=this.startRotation.genValue(i.time/this.duration)}else if(this.rendererSettings.renderMode===at.Trail){var u=c;u.length=this.rendererEmitterSettings.startLength.genValue(i.time/this.duration),u.reset()}if(this.emitterShape.initialize(c),this.rendererSettings.renderMode===at.Trail&&this.rendererEmitterSettings.followLocalOrigin){var d=c;d.localPosition=new S().copy(d.position)}this.worldSpace?(c.position.applyMatrix4(r),c.startSize=c.startSize*(Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z))/3,c.size=c.startSize,c.velocity.multiply(a).applyMatrix3(this.normalMatrix),c.rotation&&c.rotation instanceof Ce&&c.rotation.multiplyQuaternions(XL,c.rotation)):this.onlyUsedByOther&&(c.parentMatrix=r);for(var f=0;f<this.behaviors.length;f++)this.behaviors[f].initialize(c)}}},{key:"endEmit",value:function(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}},{key:"dispose",value:function(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter)}},{key:"restart",value:function(){this.paused=!1,this.particleNum=0,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(function(e){e.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}},{key:"update",value:function(e){if(!this.paused){for(var i=this.emitter;i.parent;)i=i.parent;if(i.type!=="Scene"){this.dispose();return}if(this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(var r=0;r<this.duration*r7;r++)this.update(1/r7)}e>.1&&(e=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(e,this.emissionState,this.emitter.matrixWorld);for(var s=0;s<this.behaviors.length;s++){for(var o=0;o<this.particleNum;o++)this.particles[o].died||this.behaviors[s].update(this.particles[o],e);this.behaviors[s].frameUpdate(e)}for(var a=0;a<this.particleNum;a++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[a].localPosition?(this.particles[a].position.copy(this.particles[a].localPosition),this.particles[a].parentMatrix?this.particles[a].position.applyMatrix4(this.particles[a].parentMatrix):this.particles[a].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[a].position.addScaledVector(this.particles[a].velocity,e),this.particles[a].age+=e;if(this.rendererSettings.renderMode===at.Trail)for(var l=0;l<this.particleNum;l++){var c=this.particles[l];c.update()}for(var h=0;h<this.particleNum;h++){var u=this.particles[h];u.died&&(!(u instanceof yx)||u.previous.length===0)&&(this.particles[h]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=u,this.particleNum--,h--)}}}},{key:"emit",value:function(e,i,r){i.time>this.duration&&(this.looping?(i.time-=this.duration,i.burstIndex=0,this.behaviors.forEach(function(c){c.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(r);var s=Math.ceil(i.waitEmiting);for(this.spawn(s,i,r),i.waitEmiting-=s;i.burstIndex<this.emissionBursts.length&&this.emissionBursts[i.burstIndex].time<=i.time;){if(Math.random()<this.emissionBursts[i.burstIndex].probability){var o=this.emissionBursts[i.burstIndex].count;this.spawn(o,i,r)}i.burstIndex++}if(!this.emitEnded&&(i.waitEmiting+=e*this.emissionOverTime.genValue(i.time/this.duration),this.previousWorldPos!=null)){this.emitter.getWorldPosition(this.temp),this.travelDistance+=this.previousWorldPos.distanceTo(this.temp);var a=this.emissionOverDistance.genValue(i.time/this.duration);if(this.travelDistance*a>0){var l=Math.floor(this.travelDistance*a);this.travelDistance-=l/a,i.waitEmiting+=l}}this.previousWorldPos===void 0&&(this.previousWorldPos=new S),this.emitter.getWorldPosition(this.previousWorldPos),i.time+=e}},{key:"toJSON",value:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=e===void 0||typeof e=="string";if(r&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),e.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(e),i.useUrlForImage&&this.texture.source!==void 0){var s=this.texture.source;e.images[s.uuid]={uuid:s.uuid,url:this.texture.image.url}}var o;this.renderMode===at.Trail?o={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===at.Mesh?o={}:o={};var a=this.rendererSettings.instancingGeometry;return e.geometries&&!e.geometries[a.uuid]&&(e.geometries[a.uuid]=a.toJSON()),{version:"2.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:o,speedFactor:this.renderMode===at.StretchedBillBoard?this.speedFactor:0,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:this.behaviors.map(function(l){return l.toJSON()}),worldSpace:this.worldSpace}}},{key:"addBehavior",value:function(e){this.behaviors.push(e)}},{key:"getRendererSettings",value:function(){return this.rendererSettings}},{key:"clone",value:function(){var e=[],i=EW(this.emissionBursts),r;try{for(i.s();!(r=i.n()).done;){var s=r.value,o={};Object.assign(o,s),e.push(o)}}catch(f){i.e(f)}finally{i.f()}var a=[],l=EW(this.behaviors),c;try{for(l.s();!(c=l.n()).done;){var h=c.value;a.push(h.clone())}}catch(f){l.e(f)}finally{l.f()}var u;this.renderMode===at.Trail?u={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:u={};var d=new Cs;return d.mask=this.layers.mask,new n({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:e,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:u,speedFactor:this.speedFactor,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:a,worldSpace:this.worldSpace,layers:d})}}],[{key:"fromJSON",value:function(e,i,r){var s,o=kxe(e.shape,i),a;e.renderMode===at.Trail?a={startLength:e.rendererEmitterSettings.startLength!=null?qi(e.rendererEmitterSettings.startLength):new Hs(30),followLocalOrigin:e.rendererEmitterSettings.followLocalOrigin}:e.renderMode===at.Mesh?a={}:a={};var l=new Cs;e.layers&&(l.mask=e.layers);var c=new n({autoDestroy:e.autoDestroy,looping:e.looping,prewarm:e.prewarm,duration:e.duration,shape:o,startLife:qi(e.startLife),startSpeed:qi(e.startSpeed),startRotation:_xe(e.startRotation),startSize:qi(e.startSize),startColor:QL(e.startColor),emissionOverTime:qi(e.emissionOverTime),emissionOverDistance:qi(e.emissionOverDistance),emissionBursts:e.emissionBursts,onlyUsedByOther:e.onlyUsedByOther,instancingGeometry:i.geometries[e.instancingGeometry],renderMode:e.renderMode,rendererEmitterSettings:a,renderOrder:e.renderOrder,speedFactor:e.speedFactor,layers:l,material:e.material?i.materials[e.material]:e.texture?new Jt({map:i.textures[e.texture],transparent:(s=e.transparent)!==null&&s!==void 0?s:!0,blending:e.blending,side:yi}):new Jt({color:16777215,transparent:!0,blending:mp,side:yi}),startTileIndex:typeof e.startTileIndex=="number"?new Hs(e.startTileIndex):qi(e.startTileIndex),uTileCount:e.uTileCount,vTileCount:e.vTileCount,behaviors:[],worldSpace:e.worldSpace});return c.behaviors=e.behaviors.map(function(h){var u=Pxe(h,c);return u.type==="EmitSubParticleSystem"&&(r[h.subParticleSystem]=u),u}),c}}]),n}(),qL=`

#include <common>
#include <uv_pars_fragment>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #ifdef USE_MAP
    diffuseColor *= texture2D( map, vMapUv);
    #endif
    
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    
    #include <tonemapping_fragment>

}
`,Nxe=`
#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEENCOLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEENROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
    #include <clipping_planes_fragment>
    vec4 diffuseColor = vec4( diffuse, opacity );
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
    vec3 totalEmissiveRadiance = emissive;
    #include <logdepthbuf_fragment>
    #include <map_fragment>
    #include <color_fragment>
    #include <alphamap_fragment>
    #include <alphatest_fragment>
    #include <roughnessmap_fragment>
    #include <metalnessmap_fragment>
    #include <normal_fragment_begin>
    #include <normal_fragment_maps>
    #include <clearcoat_normal_fragment_begin>
    #include <clearcoat_normal_fragment_maps>
    #include <emissivemap_fragment>
    // accumulation
    #include <lights_physical_fragment>
    #include <lights_fragment_begin>
    #include <lights_fragment_maps>
    #include <lights_fragment_end>
    // modulation
    #include <aomap_fragment>
    vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
    vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #include <transmission_fragment>
    vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
    #ifdef USE_SHEEN
    // Sheen energy compensation approximation calculation can be found at the end of
        // https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
        float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
        outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
    #endif
    #ifdef USE_CLEARCOAT
        float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
        vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
        outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
    #endif
    #include <output_fragment>
    #include <tonemapping_fragment>
    #include <encodings_fragment>
    #include <fog_fragment>
    #include <premultiplied_alpha_fragment>
    #include <dithering_fragment>
}`,_x=`

    #ifdef UV_TILE
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        mat3 tileTransform = mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    #else
        mat3 tileTransform = mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    #endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif
`,zxe=`
#include <common>
#include <color_pars_vertex>
#include <uv_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(_x,`
	
    vec2 alignedPosition = ( position.xy ) * size;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),jxe=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
// attribute vec4 color;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(_x,`
    
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),Gxe=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
    `.concat(_x,`

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}
`),Hxe=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute vec3 velocity;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

uniform float speedFactor;

void main() {

    `.concat(_x,`
	
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity;

    vec3 scaledPos = vec3(position.xy * size, position.z);
    mvPosition.xyz += scaledPos + dot(scaledPos, viewVelocity) * viewVelocity / length(viewVelocity) * speedFactor;

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`);function YL(n){return n===0?"uv":"uv".concat(n)}new S(0,0,1);var Vxe=function(n){lv(i,n);var e=cv(i);function i(r){var s;return Mt(this,i),s=e.call(this,r),$(ai(s),"offsetBuffer",void 0),$(ai(s),"rotationBuffer",void 0),$(ai(s),"sizeBuffer",void 0),$(ai(s),"colorBuffer",void 0),$(ai(s),"uvTileBuffer",void 0),$(ai(s),"velocityBuffer",void 0),$(ai(s),"vector_",new S),$(ai(s),"vector2_",new S),$(ai(s),"vector3_",new S),$(ai(s),"quaternion_",new Ce),$(ai(s),"quaternion2_",new Ce),$(ai(s),"quaternion3_",new Ce),$(ai(s),"rotationMat_",new Lt),$(ai(s),"rotationMat2_",new Lt),s.maxParticles=1e3,s.setupBuffers(),s.rebuildMaterial(),s}return Tt(i,[{key:"buildExpandableBuffers",value:function(){this.offsetBuffer=new So(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(ws),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new So(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(ws),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===at.Mesh?(this.rotationBuffer=new So(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(ws),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===at.BillBoard||this.settings.renderMode===at.HorizontalBillBoard||this.settings.renderMode===at.VerticalBillBoard||this.settings.renderMode===at.StretchedBillBoard)&&(this.rotationBuffer=new So(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(ws),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new So(new Float32Array(this.maxParticles),1),this.sizeBuffer.setUsage(ws),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new So(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(ws),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===at.StretchedBillBoard&&(this.velocityBuffer=new So(new Float32Array(this.maxParticles*3),3),this.velocityBuffer.setUsage(ws),this.geometry.setAttribute("velocity",this.velocityBuffer))}},{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new Vw,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}},{key:"expandBuffers",value:function(r){for(;r>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var r,s={};if(this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"){var o=this.settings.material;r=Jm.merge([Ge.common,Ge.envmap,Ge.aomap,Ge.lightmap,Ge.emissivemap,Ge.bumpmap,Ge.normalmap,Ge.displacementmap,Ge.roughnessmap,Ge.metalnessmap,Ge.fog,Ge.lights,{emissive:{value:new be(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),r.diffuse.value=o.color,r.opacity.value=o.opacity,r.emissive.value=o.emissive,r.roughness.value=o.roughness,r.metalness.value=o.metalness,o.envMap&&(r.envMap.value=o.envMap,r.envMapIntensity.value=o.envMapIntensity),o.normalMap&&(r.normalMap.value=o.normalMap,r.normalScale.value=o.normalScale),o.roughnessMap&&(r.roughnessMap.value=o.roughnessMap),o.metalnessMap&&(r.metalnessMap.value=o.metalnessMap),o.map&&(r.map=new Se(o.map))}else r={},r.map=new Se(this.settings.material.map);this.settings.material.alphaTest&&(s.USE_ALPHATEST="",r.alphaTest=new Se(this.settings.material.alphaTest)),s.USE_UV="";var a=this.settings.uTileCount,l=this.settings.vTileCount;(a>1||l>1)&&(s.UV_TILE="",r.tileCount=new Se(new J(a,l))),this.settings.material.normalMap&&(s.USE_NORMALMAP="",s.NORMALMAP_UV=YL(this.settings.material.normalMap.channel),r.normalMapTransform=new Se(new Lt().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(s.USE_MAP="",s.MAP_UV=YL(this.settings.material.map.channel),r.mapTransform=new Se(new Lt().copy(this.settings.material.map.matrix))),s.USE_COLOR_ALPHA="";var c=!1;if(this.settings.renderMode===at.BillBoard||this.settings.renderMode===at.VerticalBillBoard||this.settings.renderMode===at.HorizontalBillBoard||this.settings.renderMode===at.Mesh){var h,u;this.settings.renderMode===at.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(s.USE_COLOR="",h=Gxe,u=Nxe,c=!0):(h=jxe,u=qL):(h=zxe,u=qL),this.settings.renderMode===at.VerticalBillBoard?s.VERTICAL="":this.settings.renderMode===at.HorizontalBillBoard&&(s.HORIZONTAL=""),this.material=new Bt({uniforms:r,defines:s,vertexShader:h,fragmentShader:u,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,lights:c})}else if(this.settings.renderMode===at.StretchedBillBoard)r.speedFactor=new Se(1),this.material=new Bt({uniforms:r,defines:s,vertexShader:Hxe,fragmentShader:qL,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var r=this,s=0,o=0;this.systems.forEach(function(a){o+=a.particleNum}),o>this.maxParticles&&this.expandBuffers(o),this.systems.forEach(function(a){var l=a.particles,c=a.particleNum,h=r.quaternion2_,u=r.vector2_,d=r.vector3_;a.emitter.matrixWorld.decompose(u,h,d),r.rotationMat_.setFromMatrix4(a.emitter.matrixWorld);for(var f=0;f<c;f++,s++){var m=l[f];if(r.settings.renderMode===at.Mesh){var g=void 0;if(a.worldSpace)g=m.rotation;else{var v=void 0;m.parentMatrix?v=r.quaternion3_.setFromRotationMatrix(m.parentMatrix):v=h,g=r.quaternion_,g.copy(m.rotation).multiply(v)}r.rotationBuffer.setXYZW(s,g.x,g.y,g.z,g.w)}else(r.settings.renderMode===at.StretchedBillBoard||r.settings.renderMode===at.VerticalBillBoard||r.settings.renderMode===at.HorizontalBillBoard||r.settings.renderMode===at.BillBoard)&&r.rotationBuffer.setX(s,m.rotation);var y=void 0;if(a.worldSpace?y=m.position:(y=r.vector_,m.parentMatrix?y.copy(m.position).applyMatrix4(m.parentMatrix):y.copy(m.position).applyMatrix4(a.emitter.matrixWorld)),r.offsetBuffer.setXYZ(s,y.x,y.y,y.z),r.colorBuffer.setXYZW(s,m.color.x,m.color.y,m.color.z,m.color.w),a.worldSpace||m.parentMatrix?r.sizeBuffer.setX(s,m.size):r.sizeBuffer.setX(s,m.size*(Math.abs(d.x)+Math.abs(d.y)+Math.abs(d.z))/3),r.uvTileBuffer.setX(s,m.uvTile),r.settings.renderMode===at.StretchedBillBoard&&r.velocityBuffer){var A=a.speedFactor,b=void 0;a.worldSpace?b=m.velocity:(b=r.vector_,m.parentMatrix?(r.rotationMat2_.setFromMatrix4(m.parentMatrix),b.copy(m.velocity).applyMatrix3(r.rotationMat2_)):b.copy(m.velocity).applyMatrix3(r.rotationMat_)),r.velocityBuffer.setXYZ(s,b.x*A,b.y*A,b.z*A)}}}),this.geometry.instanceCount=s,s>0&&(this.offsetBuffer.updateRange.count=s*3,this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.updateRange.count=s,this.sizeBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=s*4,this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.updateRange.count=s,this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===at.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.updateRange.count=s*3,this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===at.Mesh?(this.rotationBuffer.updateRange.count=s*4,this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===at.StretchedBillBoard||this.settings.renderMode===at.HorizontalBillBoard||this.settings.renderMode===at.VerticalBillBoard||this.settings.renderMode===at.BillBoard)&&(this.rotationBuffer.updateRange.count=s,this.rotationBuffer.needsUpdate=!0))}},{key:"dispose",value:function(){this.geometry.dispose()}}]),i}(n7),Qxe=`

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 c = vColor;
    
    #ifdef USE_MAP
    c *= texture2D( map, vUv * repeat );
    #endif
    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUv * repeat ).a;
    if( c.a < alphaTest ) discard;
    gl_FragColor = c;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,Wxe=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    `.concat(_x,`
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`);new S(0,0,1);var Xxe=function(n){lv(i,n);var e=cv(i);function i(r){var s;return Mt(this,i),s=e.call(this,r),$(ai(s),"positionBuffer",void 0),$(ai(s),"previousBuffer",void 0),$(ai(s),"nextBuffer",void 0),$(ai(s),"uvBuffer",void 0),$(ai(s),"sideBuffer",void 0),$(ai(s),"widthBuffer",void 0),$(ai(s),"colorBuffer",void 0),$(ai(s),"indexBuffer",void 0),$(ai(s),"vector_",new S),$(ai(s),"vector2_",new S),$(ai(s),"vector3_",new S),$(ai(s),"quaternion_",new Ce),s.maxParticles=1e4,s.setupBuffers(),s.rebuildMaterial(),s}return Tt(i,[{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new dt,this.indexBuffer=new Ye(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(ws),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new Ye(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(ws),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new Ye(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(ws),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new Ye(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(ws),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new Ye(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(ws),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new Ye(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(ws),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new Ye(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(ws),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new Ye(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(ws),this.geometry.setAttribute("color",this.colorBuffer)}},{key:"expandBuffers",value:function(r){for(;r>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var r={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new J(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{value:new J(1,1)}},s={};if(s.USE_UV="",s.USE_COLOR_ALPHA="",this.settings.material.map&&(s.USE_MAP="",s.MAP_UV=YL(this.settings.material.map.channel),r.map=new Se(this.settings.material.map),r.mapTransform=new Se(new Lt().copy(this.settings.material.map.matrix))),this.settings.renderMode===at.Trail)this.material=new Bt({uniforms:r,defines:s,vertexShader:Wxe,fragmentShader:Qxe,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||mp});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var r=this,s=0,o=0,a=0;this.systems.forEach(function(l){for(var c=0;c<l.particleNum;c++)a+=l.particles[c].previous.length*2}),a>this.maxParticles&&this.expandBuffers(a),this.systems.forEach(function(l){var c=r.quaternion_,h=r.vector2_,u=r.vector3_;l.emitter.matrixWorld.decompose(h,c,u);for(var d=l.particles,f=l.particleNum,m=r.settings.uTileCount,g=r.settings.vTileCount,v=1/m,y=1/g,A=0;A<f;A++){var b=d[A],x=b.uvTile%g,_=Math.floor(b.uvTile/g),w=b.previous.values(),T=w.next(),M=T.value,R=M;T.done||(T=w.next());var B=void 0;T.value!==void 0?B=T.value:B=R;for(var E=0;E<b.previous.length;E++,s+=2){if(r.positionBuffer.setXYZ(s,R.position.x,R.position.y,R.position.z),r.positionBuffer.setXYZ(s+1,R.position.x,R.position.y,R.position.z),l.worldSpace?(r.positionBuffer.setXYZ(s,R.position.x,R.position.y,R.position.z),r.positionBuffer.setXYZ(s+1,R.position.x,R.position.y,R.position.z)):(b.parentMatrix?r.vector_.copy(R.position).applyMatrix4(b.parentMatrix):r.vector_.copy(R.position).applyMatrix4(l.emitter.matrixWorld),r.positionBuffer.setXYZ(s,r.vector_.x,r.vector_.y,r.vector_.z),r.positionBuffer.setXYZ(s+1,r.vector_.x,r.vector_.y,r.vector_.z)),l.worldSpace?(r.previousBuffer.setXYZ(s,M.position.x,M.position.y,M.position.z),r.previousBuffer.setXYZ(s+1,M.position.x,M.position.y,M.position.z)):(b.parentMatrix?r.vector_.copy(M.position).applyMatrix4(b.parentMatrix):r.vector_.copy(M.position).applyMatrix4(l.emitter.matrixWorld),r.previousBuffer.setXYZ(s,r.vector_.x,r.vector_.y,r.vector_.z),r.previousBuffer.setXYZ(s+1,r.vector_.x,r.vector_.y,r.vector_.z)),l.worldSpace?(r.nextBuffer.setXYZ(s,B.position.x,B.position.y,B.position.z),r.nextBuffer.setXYZ(s+1,B.position.x,B.position.y,B.position.z)):(b.parentMatrix?r.vector_.copy(B.position).applyMatrix4(b.parentMatrix):r.vector_.copy(B.position).applyMatrix4(l.emitter.matrixWorld),r.nextBuffer.setXYZ(s,r.vector_.x,r.vector_.y,r.vector_.z),r.nextBuffer.setXYZ(s+1,r.vector_.x,r.vector_.y,r.vector_.z)),r.sideBuffer.setX(s,-1),r.sideBuffer.setX(s+1,1),l.worldSpace)r.widthBuffer.setX(s,R.size),r.widthBuffer.setX(s+1,R.size);else if(b.parentMatrix)r.widthBuffer.setX(s,R.size),r.widthBuffer.setX(s+1,R.size);else{var P=(Math.abs(u.x)+Math.abs(u.y)+Math.abs(u.z))/3;r.widthBuffer.setX(s,R.size*P),r.widthBuffer.setX(s+1,R.size*P)}r.uvBuffer.setXY(s,(E/b.previous.length+x)*v,(g-_-1)*y),r.uvBuffer.setXY(s+1,(E/b.previous.length+x)*v,(g-_)*y),r.colorBuffer.setXYZW(s,R.color.x,R.color.y,R.color.z,R.color.w),r.colorBuffer.setXYZW(s+1,R.color.x,R.color.y,R.color.z,R.color.w),E+1<b.previous.length&&(r.indexBuffer.setX(o*3,s),r.indexBuffer.setX(o*3+1,s+1),r.indexBuffer.setX(o*3+2,s+2),o++,r.indexBuffer.setX(o*3,s+2),r.indexBuffer.setX(o*3+1,s+1),r.indexBuffer.setX(o*3+2,s+3),o++),M=R,R=B,T.done||(T=w.next(),T.value!==void 0&&(B=T.value))}}}),this.positionBuffer.updateRange.count=s*3,this.positionBuffer.needsUpdate=!0,this.previousBuffer.updateRange.count=s*3,this.previousBuffer.needsUpdate=!0,this.nextBuffer.updateRange.count=s*3,this.nextBuffer.needsUpdate=!0,this.sideBuffer.updateRange.count=s,this.sideBuffer.needsUpdate=!0,this.widthBuffer.updateRange.count=s,this.widthBuffer.needsUpdate=!0,this.uvBuffer.updateRange.count=s*2,this.uvBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=s*4,this.colorBuffer.needsUpdate=!0,this.indexBuffer.updateRange.count=o*3,this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,o*3)}},{key:"dispose",value:function(){this.geometry.dispose()}}]),i}(n7),qxe=function(n){lv(i,n);var e=cv(i);function i(){var r;return Mt(this,i),r=e.call(this),$(ai(r),"batches",[]),$(ai(r),"systemToBatchIndex",new Map),$(ai(r),"type","BatchedRenderer"),r}return Tt(i,[{key:"addSystem",value:function(r){r._renderer=this;for(var s=r.getRendererSettings(),o=0;o<this.batches.length;o++)if(i.equals(this.batches[o].settings,s)){this.batches[o].addSystem(r),this.systemToBatchIndex.set(r,o);return}var a;switch(s.renderMode){case at.Trail:a=new Xxe(s);break;case at.Mesh:case at.BillBoard:case at.VerticalBillBoard:case at.HorizontalBillBoard:case at.StretchedBillBoard:a=new Vxe(s);break}a.addSystem(r),this.batches.push(a),this.systemToBatchIndex.set(r,this.batches.length-1),this.add(a)}},{key:"deleteSystem",value:function(r){var s=this.systemToBatchIndex.get(r);s!=null&&(this.batches[s].removeSystem(r),this.systemToBatchIndex.delete(r))}},{key:"updateSystem",value:function(r){this.deleteSystem(r),this.addSystem(r)}},{key:"update",value:function(r){this.systemToBatchIndex.forEach(function(o,a){a.update(r)});for(var s=0;s<this.batches.length;s++)this.batches[s].update()}}],[{key:"equals",value:function(r,s){return r.material.side===s.material.side&&r.material.blending===s.material.blending&&r.material.transparent===s.material.transparent&&r.material.type===s.material.type&&r.material.alphaTest===s.material.alphaTest&&r.material.map===s.material.map&&r.renderMode===s.renderMode&&r.uTileCount===s.uTileCount&&r.vTileCount===s.vTileCount&&r.instancingGeometry===s.instancingGeometry&&r.renderOrder===s.renderOrder&&r.layers.mask===s.layers.mask}}]),i}(ve),Yxe=qxe,s7=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new S;Mt(this,n),$(this,"locations",[]),this.scaleX=e,this.scaleY=i,this.position=r}return Tt(n,[{key:"transform",value:function(e,i){e.x=this.locations[i%this.locations.length].x*this.scaleX+this.position.x,e.y=this.locations[i%this.locations.length].y*this.scaleY+this.position.y,e.z=this.position.z}},{key:"clone",value:function(){var e=new n(this.scaleX,this.scaleY,this.position.clone());return e.locations=this.locations.map(function(i){return i.clone()}),e}},{key:"toJSON",value:function(){return{scaleX:this.scaleX,scaleY:this.scaleY,position:this.position,locations:this.locations.map(function(e){return{x:e.x,y:e.y}})}}},{key:"fromImage",value:function(e,i){var r=document.createElement("canvas");r.width=e.width,r.height=e.height;var s=r.getContext("2d");if(s){s.drawImage(e,0,0);var o=s.getImageData(0,0,r.width,r.height,{colorSpace:"srgb"});r.remove(),this.locations.length=0;for(var a=0;a<o.height;a++)for(var l=0;l<o.width;l++)o.data[(a*o.width+l)*4+3]>i&&this.locations.push(new J(l,o.height-a))}}}],[{key:"fromJSON",value:function(e){var i=new n(e.scaleX,e.scaleY,new S(e.position[0],e.position[1],e.position[2]));return i.locations=e.locations.map(function(r){return new J(r.x,r.y)}),i}}]),n}();function Jxe(n){switch(n.type){case"TextureSequencer":return s7.fromJSON(n);default:return new s7}}var Kxe=function(){function n(e){Mt(this,n),$(this,"type","ApplySequences"),$(this,"sequencers",[]),$(this,"time",0),$(this,"index",0),$(this,"pCount",0),$(this,"delay",void 0),$(this,"tempV",new S),this.delay=e}return Tt(n,[{key:"initialize",value:function(e){e.id=this.pCount,e.dst=new S,e.begin=new S,e.inMotion=!1,this.pCount++}},{key:"reset",value:function(){this.time=0,this.index=0,this.pCount=0}},{key:"update",value:function(e,i){var r=this.sequencers[this.index],s=e.id*this.delay;this.time>=r[0].a+s&&this.time<=r[0].b+s?(e.inMotion||(e.inMotion=!0,e.begin.copy(e.position),r[1].transform(e.dst,e.id)),e.position.lerpVectors(e.begin,e.dst,n.BEZIER.genValue((this.time-r[0].a-s)/(r[0].b-r[0].a)))):this.time>r[0].b+s&&(e.inMotion=!1)}},{key:"frameUpdate",value:function(e){for(;this.index+1<this.sequencers.length&&this.time>=this.sequencers[this.index+1][0].a;)this.index++;this.time+=e}},{key:"appendSequencer",value:function(e,i){this.sequencers.push([e,i])}},{key:"toJSON",value:function(){return{type:this.type,delay:this.delay,sequencers:this.sequencers.map(function(e){var i=hv(e,2),r=i[0],s=i[1];return{range:r.toJSON(),sequencer:s.toJSON()}})}}},{key:"clone",value:function(){var e=new n(this.delay);return e.sequencers=this.sequencers.map(function(i){return[i[0].clone(),i[1].clone()]}),e}}],[{key:"fromJSON",value:function(e){var i=new n(e.delay);return e.sequencers.forEach(function(r){i.sequencers.push([qi(r.range),Jxe(r.sequencer)])}),i}}]),n}();$(Kxe,"BEZIER",new jL(0,0,1,1));var de=function(n){return n[n.Number=0]="Number",n[n.Vec2=1]="Vec2",n[n.Vec3=2]="Vec3",n[n.Vec4=3]="Vec4",n[n.Boolean=4]="Boolean",n[n.AnyType=5]="AnyType",n}({}),o7=Tt(function n(e,i,r,s){Mt(this,n),$(this,"input",void 0),$(this,"inputIndex",void 0),$(this,"output",void 0),$(this,"outputIndex",void 0),this.input=e,this.inputIndex=i,this.input.outputs[i].push(this),this.output=r,this.outputIndex=s,this.output.inputs[s]=this}),Zxe=function(){function n(){Mt(this,n),$(this,"visited",new Set),$(this,"graph_",void 0),$(this,"context_",void 0),n.Instance=this}return Tt(n,[{key:"traverse",value:function(e){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");this.visited.add(e.id);for(var i=[],r=0;r<e.inputs.length;r++)if(e.inputs[r]instanceof o7){var s=e.inputs[r].input;this.visited.has(s.id)||this.traverse(s),i.push(s.outputValues[e.inputs[r].inputIndex])}else i.push(e.inputs[r].getValue(this.context_));e.func(this.context_,i,e.outputValues),this.graph_.nodesInOrder.push(e)}},{key:"executeCompiledGraph",value:function(){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");for(var e=this.graph_.nodesInOrder,i=0;i<e.length;i++){for(var r=[],s=e[i],o=0;o<s.inputs.length;o++)if(s.inputs[o]instanceof o7)r.push(s.inputs[o].input.outputValues[s.inputs[o].inputIndex]);else if(s.inputs[o]!==void 0)r.push(s.inputs[o].getValue(this.context_));else throw new Error("miss input for node ".concat(s.id));s.func(this.context_,r,s.outputValues)}}},{key:"run",value:function(e,i){if(this.graph_=e,this.context_=i,e.compiled)this.executeCompiledGraph();else{e.nodesInOrder.length=0,this.visited.clear();for(var r=0;r<e.outputNodes.length;r++){var s=e.outputNodes[r];this.traverse(s)}e.compiled=!0}}}]),n}();$(Zxe,"Instance",void 0);var gi=function(){function n(e){Mt(this,n),$(this,"name",void 0),$(this,"nodeTypeSignatures",[]),this.name=e}return Tt(n,[{key:"addSignature",value:function(e,i,r){this.nodeTypeSignatures.push({inputTypes:e,outputTypes:i,func:r})}}]),n}(),fM=new gi("add");fM.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,r){r[0]=i[0]+i[1]}),fM.addSignature([de.Vec2,de.Vec2],[de.Vec2],function(n,e,i,r){r[0].addVectors(i[0],i[1])}),fM.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(n,e,i,r){r[0].addVectors(i[0],i[1])}),fM.addSignature([de.Vec4,de.Vec4],[de.Vec4],function(n,e,i,r){r[0].addVectors(i[0],i[1])});var mM=new gi("sub");mM.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,r){r[0]=i[0]-i[1]}),mM.addSignature([de.Vec2,de.Vec2],[de.Vec2],function(n,e,i,r){r[0].subVectors(i[0],i[1])}),mM.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(n,e,i,r){r[0].subVectors(i[0],i[1])}),mM.addSignature([de.Vec4,de.Vec4],[de.Vec4],function(n,e,i,r){r[0].subVectors(i[0],i[1])});var gM=new gi("mul");gM.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,r){r[0]=i[0]*i[1]}),gM.addSignature([de.Vec2,de.Number],[de.Vec2],function(n,e,i,r){r[0].copy(i[0]).multiplyScalar(i[1])}),gM.addSignature([de.Vec3,de.Number],[de.Vec3],function(n,e,i,r){r[0].copy(i[0]).multiplyScalar(i[1])}),gM.addSignature([de.Vec4,de.Number],[de.Vec4],function(n,e,i,r){r[0].copy(i[0]).multiplyScalar(i[1])});var vM=new gi("div");vM.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,r){r[0]=i[0]/i[1]}),vM.addSignature([de.Vec2,de.Number],[de.Vec2],function(n,e,i,r){r[0].copy(i[0]).divideScalar(i[1])}),vM.addSignature([de.Vec3,de.Number],[de.Vec3],function(n,e,i,r){r[0].copy(i[0]).divideScalar(i[1])}),vM.addSignature([de.Vec4,de.Number],[de.Vec4],function(n,e,i,r){r[0].copy(i[0]).divideScalar(i[1])});var $xe=new gi("sin");$xe.addSignature([de.Number],[de.Number],function(n,e,i,r){r[0]=Math.sin(i[0])});var e_e=new gi("cos");e_e.addSignature([de.Number],[de.Number],function(n,e,i,r){r[0]=Math.cos(i[0])});var t_e=new gi("tan");t_e.addSignature([de.Number],[de.Number],function(n,e,i,r){r[0]=Math.tan(i[0])});var i_e=new gi("abs");i_e.addSignature([de.Number],[de.Number],function(n,e,i,r){r[0]=Math.abs(i[0])});var n_e=new gi("min");n_e.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,r){r[0]=Math.min(i[0],i[1])});var r_e=new gi("max");r_e.addSignature([de.Number,de.Number],[de.Number],function(n,e,i,r){r[0]=Math.max(i[0],i[1])});var JL=new gi("dot");JL.addSignature([de.Vec2,de.Vec2],[de.Number],function(n,e,i,r){r[0]=i[0].dot(i[1])}),JL.addSignature([de.Vec3,de.Vec3],[de.Number],function(n,e,i,r){r[0]=i[0].dot(i[1])}),JL.addSignature([de.Vec4,de.Vec4],[de.Number],function(n,e,i,r){r[0]=i[0].dot(i[1])});var s_e=new gi("cross");s_e.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(n,e,i,r){r[0].crossVectors(i[0],i[1])});var KL=new gi("length");KL.addSignature([de.Vec2],[de.Number],function(n,e,i,r){r[0]=i[0].length()}),KL.addSignature([de.Vec3],[de.Number],function(n,e,i,r){r[0]=i[0].length()}),KL.addSignature([de.Vec4],[de.Number],function(n,e,i,r){r[0]=i[0].length()});var ZL=new gi("lengthSq");ZL.addSignature([de.Vec2],[de.Number],function(n,e,i,r){r[0]=i[0].lengthSq()}),ZL.addSignature([de.Vec3],[de.Number],function(n,e,i,r){r[0]=i[0].lengthSq()}),ZL.addSignature([de.Vec4],[de.Number],function(n,e,i,r){r[0]=i[0].lengthSq()});var $L=new gi("normalize");$L.addSignature([de.Vec2],[de.Vec2],function(n,e,i,r){r[0].copy(i[0]).normalize()}),$L.addSignature([de.Vec3],[de.Vec3],function(n,e,i,r){r[0].copy(i[0]).normalize()}),$L.addSignature([de.Vec4],[de.Vec4],function(n,e,i,r){r[0].copy(i[0]).normalize()});var a7=new gi("distance");a7.addSignature([de.Vec2,de.Vec2],[de.Number],function(n,e,i,r){r[0]=i[0].distanceTo(i[1])}),a7.addSignature([de.Vec3,de.Vec3],[de.Number],function(n,e,i,r){r[0]=i[0].distanceTo(i[1])});var o_e=new gi("and");o_e.addSignature([de.Boolean,de.Boolean],[de.Boolean],function(n,e,i,r){r[0]=i[0]&&i[1]});var a_e=new gi("or");a_e.addSignature([de.Boolean,de.Boolean],[de.Boolean],function(n,e,i,r){r[0]=i[0]||i[1]});var l_e=new gi("not");l_e.addSignature([de.Boolean],[de.Boolean],function(n,e,i,r){r[0]=!i[0]});var yM=new gi("equal");yM.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,i,r){r[0]=i[0]===i[1]}),yM.addSignature([de.Vec2,de.Vec2],[de.Boolean],function(n,e,i,r){r[0]=i[0].equals(i[1])}),yM.addSignature([de.Vec3,de.Vec3],[de.Boolean],function(n,e,i,r){r[0]=i[0].equals(i[1])}),yM.addSignature([de.Vec4,de.Vec4],[de.Boolean],function(n,e,i,r){r[0]=i[0].equals(i[1])});var c_e=new gi("lessThan");c_e.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,i,r){r[0]=i[0]<i[1]});var h_e=new gi("greaterThan");h_e.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,i,r){r[0]=i[0]>i[1]});var u_e=new gi("lessThanOrEqual");u_e.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,i,r){r[0]=i[0]<=i[1]});var d_e=new gi("greaterThanOrEqual");d_e.addSignature([de.Number,de.Number],[de.Boolean],function(n,e,i,r){r[0]=i[0]>=i[1]});var p_e=new gi("if");p_e.addSignature([de.Boolean,de.AnyType,de.AnyType],[de.AnyType],function(n,e,i,r){r[0]=i[0]?i[1]:i[2]});var f_e=new gi("number");f_e.addSignature([],[de.Number],function(n,e,i,r){r[0]=e.value});var m_e=new gi("vec2");m_e.addSignature([],[de.Vec2],function(n,e,i,r){r[0]=e.value});var g_e=new gi("vec3");g_e.addSignature([],[de.Vec3],function(n,e,i,r){r[0]=e.value});var v_e=new gi("vec4");v_e.addSignature([],[de.Vec4],function(n,e,i,r){r[0]=e.value});var y_e=new gi("bool");y_e.addSignature([],[de.Boolean],function(n,e,i,r){r[0]=e.value});var A_e=new gi("particlePosition");A_e.addSignature([],[de.Vec3],function(n,e,i,r){r[0]=n.particle[e.property]});var b_e=new gi("particleVelocity");b_e.addSignature([],[de.Vec3],function(n,e,i,r){r[0]=n.particle[e.property]});var x_e=new gi("particleRotation");x_e.addSignature([],[de.Number],function(n,e,i,r){r[0]=n.particle[e.property]});var __e=new gi("particleAge");__e.addSignature([],[de.Number],function(n,e,i,r){r[0]=n.particle[e.property]});var wx=new gi("output");wx.addSignature([de.Number],[de.Number],function(n,e,i,r){r[0]=i[0]}),wx.addSignature([de.Vec2],[de.Vec2],function(n,e,i,r){r[0]=i[0]}),wx.addSignature([de.Vec3],[de.Vec3],function(n,e,i,r){r[0]=i[0]}),wx.addSignature([de.Vec4],[de.Vec4],function(n,e,i,r){r[0]=i[0]}),wx.addSignature([de.Boolean],[de.Boolean],function(n,e,i,r){r[0]=i[0]}),console.log("%c Particle system powered by three.quarks. https://quarks.art/","font-size: 16px; font-weight: bold;");var w_e=Object.defineProperty,S_e=Object.getOwnPropertyDescriptor,Mn=(n,e,i,r)=>{for(var s=r>1?void 0:r?S_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&w_e(e,i,s),s};const Sx=te("debugparticles"),C_e=te("noprogressive"),E_e=te("debugprogressive");var e3=(n=>(n[n.Birth=0]="Birth",n[n.Collision=1]="Collision",n[n.Death=2]="Death",n[n.Trigger=3]="Trigger",n[n.Manual=4]="Manual",n))(e3||{});class qa extends Be{constructor(){super(...arguments),p(this,"renderMode"),p(this,"particleMaterial"),p(this,"trailMaterial"),p(this,"particleMesh"),p(this,"maxParticleSize"),p(this,"minParticleSize"),p(this,"velocityScale"),p(this,"cameraVelocityScale"),p(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&it()){const e=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(e)}}get transparent(){var e;return((e=this.particleMaterial)==null?void 0:e.transparent)??!1}getMaterial(e=!1){let i=e===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return i&&e&&i.side===Fn&&(i=i.clone(),i.side=an,e?this.trailMaterial=i:this.particleMaterial=i),i&&!C_e&&i._didRequestTextureLOD===void 0&&(i._didRequestTextureLOD=0,E_e&&console.log("Load material LOD",i.name),mi.assignTextureLOD(i,0)),i}getMesh(e){let i=null;if(!i&&(this.particleMesh instanceof pe&&(i=this.particleMesh.geometry),i===null)){i=new cr(1,1);const r=i.attributes.uv;for(let s=0;s<r.count;s++)r.setX(s,1-r.getX(s))}return new pe(i,this.getMaterial())}}Mn([C()],qa.prototype,"renderMode",2),Mn([C(Ut)],qa.prototype,"particleMaterial",2),Mn([C(Ut)],qa.prototype,"trailMaterial",2),Mn([C()],qa.prototype,"maxParticleSize",2),Mn([C()],qa.prototype,"minParticleSize",2),Mn([C()],qa.prototype,"velocityScale",2),Mn([C()],qa.prototype,"cameraVelocityScale",2),Mn([C()],qa.prototype,"lengthScale",2);class AM{constructor(e,i=1){p(this,"_curve"),p(this,"_factor"),p(this,"type","function"),this._curve=e,this._factor=i}genValue(e){return this._curve.evaluate(e,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class t3{constructor(e){p(this,"type","value"),p(this,"system"),this.system=e}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class M_e extends t3{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class T_e extends t3{constructor(){super(...arguments),p(this,"_lastPosition",new S),p(this,"_lastDistance",0)}update(){const e=kt(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(e),this._lastPosition.copy(e)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let e=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const s=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let o=this._lastDistance/this.system.deltaTime*s;Number.isFinite(o)||(o=0),e+=o}const i=this.system.emission.getBurst();i>0&&(e+=i/this.system.deltaTime);const r=this.system.maxParticles-this.system.currentParticles;return tt.clamp(e,0,r/this.system.deltaTime)}}class I_e extends t3{genValue(){return this.system.isPlaying,0}}class Zd{constructor(e){p(this,"system"),p(this,"type"),this.type=Object.getPrototypeOf(this).constructor.name||"ParticleSystemBaseBehaviour",e&&(this.system=e)}get context(){return this.system.context}initialize(e){}update(e,i){}frameUpdate(e){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class R_e extends Zd{constructor(){super(...arguments),p(this,"type","NeedleTextureSheet")}update(e,i){const r=this.system.textureSheetAnimation;if(r.enabled){const s=e.age/e.life,o=r.evaluate(s);o!==void 0&&(e.uvTile=o)}}}const l7=Symbol("particleRotation");class P_e extends Zd{constructor(){super(...arguments),p(this,"type","NeedleRotation")}initialize(e){e[l7]=Math.random()}update(e,i){if(e.rotation===void 0)return;const r=e.age/e.life;if(typeof e.rotation=="number"&&(this.system.rotationOverLifetime.enabled?e.rotation+=this.system.rotationOverLifetime.evaluate(r,e[l7])*i:this.system.renderer.renderMode===Kh.Billboard&&(e.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const s=e.velocity.length();e.rotation+=this.system.rotationBySpeed.evaluate(r,s)*i}}}const c7=Symbol("sizeLerpFactor"),B_e=new S;class k_e extends Zd{constructor(){super(...arguments),p(this,"type","NeedleSize"),p(this,"_minSize",0),p(this,"_maxSize",1)}initialize(e){e[c7]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(e,i){const r=e.age/e.life;let s=1;this.system.sizeOverLifetime.enabled&&(s*=this.system.sizeOverLifetime.evaluate(r,void 0,e[c7]).x);let o=1;if(this.system.renderer.renderMode!==Kh.Mesh&&(o=this.system.worldScale.x/this.system.cameraScale),e.size=e.startSize*s*o,this.system.localspace){const a=f7(this.system,B_e);e.size*=a.x}}}const uv=Symbol("particleLife"),i3=Symbol("trailLifetime"),h7=Symbol("trailStartLength"),n3=Symbol("trailWidthRandom");class O_e extends Zd{constructor(){super(...arguments),p(this,"type","NeedleTrail")}initialize(e){e instanceof yx&&(e[uv]=e.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(e[i3]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),e.life+=e[i3]),e[h7]=e.length,e[n3]=Math.random())}update(e){var i;if((i=this.system.trails)!=null&&i.enabled&&e instanceof yx){const r=e,s=e.age/e[uv],o=e.previous.values(),a=e.previous.length;for(let l=0;l<a;l++){const c=o.next().value,h=1-l/(a-1);let u=e.size;u<=0&&!this.system.trails.sizeAffectsWidth&&(u=20*this.system.trails.widthOverTrail.evaluate(.5,r[n3])),c.size=this.system.trails.getWidth(u,s,h,r[n3]),c.color.copy(e.color),this.system.trails.getColor(c.color,s,h)}if(e.age>e[uv]){e.velocity.set(0,0,0);const l=(e.age-e[uv])/e[i3];r.length=tt.lerp(e[h7],0,l)}}}}const bM=Symbol("startVelocity"),u7=Symbol("gravityModifier"),r3=Symbol("gravitySpeed"),xM=Symbol("velocity lerp factor"),s3=new S;class D_e extends Zd{constructor(){super(...arguments),p(this,"type","NeedleVelocity"),p(this,"_gravityDirection",new S)}initialize(e){var i,r;const s=this.system.main.simulationSpeed;e.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random()),e.velocity.copy(this.system.shape.getDirection(e,e.position)).multiplyScalar(e.startSpeed),(i=this.system.inheritVelocity)!=null&&i.enabled&&this.system.inheritVelocity.applyInitial(e.velocity),e[bM]?e[bM].copy(e.velocity):e[bM]=e.velocity.clone();const o=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());e[u7]=o*s,e[r3]=o*s*.5,e[xM]=Math.random(),(r=this.system.velocityOverLifetime)==null||r.init(e),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===ex.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(e,i){var r;const s=e[bM],o=e[u7];if(o!==0){const f=o*e[r3];s3.copy(this._gravityDirection).multiplyScalar(f),e[r3]+=i*.05,s.add(s3)}e.velocity.copy(s);const a=e.age/e.life;(r=this.system.inheritVelocity)!=null&&r.enabled&&this.system.inheritVelocity.applyCurrent(e.velocity,a,e[xM]);const l=this.system.noise;l.enabled&&l.apply(0,e.position,e.velocity,i,e.age,e.life);const c=this.system.sizeBySpeed;c!=null&&c.enabled&&(e.size=c.evaluate(e.velocity,a,e[xM],e.size));const h=this.system.colorBySpeed;h!=null&&h.enabled&&h.evaluate(e.velocity,e[xM],e.color);const u=this.system.velocityOverLifetime;u.enabled&&u.apply(e,0,e.position,e.velocity,i,e.age,e.life);const d=this.system.limitVelocityOverLifetime;d.enabled&&d.apply(e.position,s,e.velocity,e.size,a,i,1),this.system.worldspace&&e.velocity.multiply(this.system.worldScale)}}const d7=Symbol("colorLerpFactor"),p7=new ki(1,1,1,1),am=new ki(1,1,1,1);class L_e extends Zd{constructor(){super(...arguments),p(this,"type","NeedleColor")}initialize(e){}_init(e){const i=this.system.renderer.particleMaterial;am.copy(this.system.main.startColor.evaluate(Math.random())),i!=null&&i.color&&(p7.copy(i.color),am.multiply(p7)),am.convertLinearToSRGB(),e.startColor.set(am.r,am.g,am.b,am.alpha),e.color.copy(e.startColor),e[d7]=Math.random()}update(e,i){if(e.age===0&&this._init(e),this.system.colorOverLifetime.enabled){const r=e.age/e.life,s=this.system.colorOverLifetime.color.evaluate(r,e[d7]);e.color.set(s.r,s.g,s.b,s.alpha).multiply(e.startColor)}else e.color.copy(e.startColor)}}class U_e{constructor(e){p(this,"system"),p(this,"emission"),p(this,"autoDestroy"),p(this,"startLength"),p(this,"emissionBursts"),p(this,"onlyUsedByOther"),p(this,"behaviors",[]),p(this,"rendererEmitterSettings",{startLength:new Hs(220),followLocalOrigin:!1}),p(this,"flatWhiteTexture"),p(this,"clonedTexture",{original:void 0,clone:void 0}),this.system=e,this.emission=new T_e(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new AM(this.system.main.startLifetime)}get startSpeed(){return new AM(this.system.main.startSpeed)}get startRotation(){return new AM(this.system.main.startRotation)}get startSize(){return new AM(this.system.main.startSize)}get startColor(){return new pM(new qe(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new I_e(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return at.Trail;switch(this.system.renderer.renderMode){case Kh.Billboard:return at.BillBoard;case Kh.Stretch:return at.StretchedBillBoard;case Kh.HorizontalBillboard:return at.HorizontalBillBoard;case Kh.VerticalBillboard:return at.VerticalBillBoard;case Kh.Mesh:return at.Mesh}return at.BillBoard}get speedFactor(){var e;let i=this.system.main.simulationSpeed;return((e=this.system.renderer)==null?void 0:e.renderMode)===Kh.Stretch&&(i*=this.system.renderer.velocityScale??1),i}get texture(){const e=this.material;if(e&&e.map){const i=e.map;if(this.clonedTexture.original!==i||!this.clonedTexture.clone){const r=i.clone();r.premultiplyAlpha=!1,r.colorSpace=Ii,this.clonedTexture.original=i,this.clonedTexture.clone=r}return this.clonedTexture.clone}return this.flatWhiteTexture||(this.flatWhiteTexture=dO(new ki(1,1,1,1),1)),this.flatWhiteTexture}get startTileIndex(){return new M_e(this.system)}get uTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesX:void 0}get vTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesY:void 0}get renderOrder(){return 1}get blending(){var e;return((e=this.system.renderer.particleMaterial)==null?void 0:e.blending)??fu}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===ex.World}}class F_e{constructor(){p(this,"burstIndex",0),p(this,"burstWaveIndex",0),p(this,"time",0),p(this,"waitEmiting",0)}}const _M=class extends Be{constructor(){super(...arguments),p(this,"_state"),p(this,"colorOverLifetime"),p(this,"main"),p(this,"emission"),p(this,"sizeOverLifetime"),p(this,"shape"),p(this,"noise"),p(this,"trails"),p(this,"velocityOverLifetime"),p(this,"limitVelocityOverLifetime"),p(this,"inheritVelocity"),p(this,"colorBySpeed"),p(this,"textureSheetAnimation"),p(this,"rotationOverLifetime"),p(this,"rotationBySpeed"),p(this,"sizeBySpeed"),p(this,"_cameraScale",1),p(this,"__worldQuaternion",new Ce),p(this,"_worldQuaternionInverted",new Ce),p(this,"_worldScale",new S),p(this,"_worldPositionFrame",-1),p(this,"_worldPos",new S),p(this,"_renderer"),p(this,"_batchSystem"),p(this,"_particleSystem"),p(this,"_interface"),p(this,"_container"),p(this,"_time",0),p(this,"_isPlaying",!0),p(this,"_isUsedAsSubsystem",!1),p(this,"_didPreWarm",!1),p(this,"_bursts"),p(this,"_subEmitterSystems"),p(this,"_lastBatchesCount",-1),p(this,"lastMaterialVersion",-1)}play(n=!1){var e;n&&ie.foreachComponent(this.gameObject,i=>{i instanceof _M&&i!==this&&i.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(e=this.emission)==null||e.reset()}pause(n=!0){n&&ie.foreachComponent(this.gameObject,e=>{e instanceof _M&&e!==this&&e.pause(!1)},!0),this._isPlaying=!1}stop(n=!0,e=!1){n&&ie.foreachComponent(this.gameObject,i=>{i instanceof _M&&i!==this&&i.stop(!1,e)},!0),this._isPlaying=!1,this._time=0,e&&this.reset()}reset(){var n;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(n=this.emission)==null||n.reset())}emit(n){if(this._particleSystem){this.onUpdate(),n=Math.min(n,this.maxParticles-this.currentParticles),this._state||(this._state=new F_e),this._state.waitEmiting=n,this._state.time=0;const e=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=e}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(n){this.main.playOnAwake=n}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var n;return((n=this._particleSystem)==null?void 0:n.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===ex.World}get localspace(){return this.main.simulationSpace===ex.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,kt(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}addBehaviour(n){return this._particleSystem?(n instanceof Zd&&(n.system=this),it()&&console.log("add behaviour",n),this._particleSystem.addBehavior(n),!0):!1}removeBehaviour(n){if(!this._particleSystem)return!1;const e=this._particleSystem.behaviors,i=e.indexOf(n);return i!==-1&&e.splice(i,1),!0}removeAllBehaviours(){return this._particleSystem?(this._particleSystem.behaviors.length=0,!0):!1}get behaviours(){return this._particleSystem?this._particleSystem.behaviors:null}get particleSystem(){return this._particleSystem??null}set bursts(n){for(let e=0;e<n.length;e++){const i=n[e];if(!(i instanceof tx)){const r=new tx;o0(r,i),n[e]=r}}this._bursts=n}set subEmitterSystems(n){for(let e=0;e<n.length;e++){const i=n[e];if(!(i instanceof Cx)){const r=new Cx;o0(r,i),n[e]=r}}Sx&&n.length>0&&console.log("SubEmitters: ",n,this),this._subEmitterSystems=n}onAfterDeserialize(n){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const e of this._subEmitterSystems)e._deserialize(this.context,this.gameObject)}awake(){if(this._worldPositionFrame=-1,this._renderer=this.gameObject.getComponent(qa),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new ve,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new Yxe,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new U_e(this),this._particleSystem=new Fxe(this._interface),this._particleSystem.addBehavior(new k_e(this)),this._particleSystem.addBehavior(new L_e(this)),this._particleSystem.addBehavior(new R_e(this)),this._particleSystem.addBehavior(new P_e(this)),this._particleSystem.addBehavior(new D_e(this)),this._particleSystem.addBehavior(new O_e(this)),this._batchSystem.addSystem(this._particleSystem);const n=this._particleSystem.emitter;this.context.scene.add(n),this.inheritVelocity.system&&this.inheritVelocity.system!==this&&(this.inheritVelocity=this.inheritVelocity.clone()),this.inheritVelocity.awake(this),Sx&&(console.log(this),this.gameObject.add(new Vo(1)))}start(){this.addSubParticleSystems(),this.updateLayers(),this.renderer.particleMesh instanceof pe&&this._interface.renderMode==at.Mesh&&mi.assignMeshLOD(this.renderer.particleMesh,0).then(n=>{n&&this.particleSystem&&this._interface.renderMode==at.Mesh&&(this.particleSystem.instancingGeometry=n)})}onDestroy(){var n,e,i,r;(n=this._container)==null||n.removeFromParent(),(e=this._batchSystem)==null||e.removeFromParent(),(i=this._particleSystem)==null||i.emitter.removeFromParent(),(r=this._particleSystem)==null||r.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var n;this.main&&(this._didPreWarm===!1&&((n=this.main)==null?void 0:n.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var n;if(!((n=this.emission)!=null&&n.enabled)||this.emission.rateOverTime.getMax()<=0)return;const e=1/60,i=this.main.duration,r=this.main.startLifetime.getMax(),s=1e3,o=Math.min(Math.max(i,r)/Math.max(.01,this.main.simulationSpeed),s),a=Math.ceil(o/e),l=Date.now();Sx&&console.log(`Particles ${this.name} - Prewarm for ${a} frames (${o} sec). Duration: ${i}, Lifetime: ${r}`);for(let c=0;c<a&&!(this.currentParticles>=this.maxParticles);c++){const h=Date.now()-l;if(h>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${h}`);break}this.onUpdate(),this.onSimulate(e)}}onSimulate(n){if(this._batchSystem){let e=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,e=!0),e&&this.updateLayers(),this._batchSystem.update(n)}this._time+=n,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let n=0;n<this._batchSystem.batches.length;n++){const e=this._batchSystem.batches[n];e.layers.disableAll();const i=this.layer;e.layers.mask=1<<i}}onUpdate(){var n,e;const i=this.renderer.getMaterial(this.trails.enabled);if(i&&i.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=i.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const r=this.context.mainCamera;if(r){const a=Qi(r);this._cameraScale=a.x}const s=!this.worldspace,o=this.gameObject;if(Ri(o,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),Qi(this.gameObject,this._worldScale),s&&this._container&&(n=this.gameObject)!=null&&n.parent){const a=f7(this,s3);this._container.matrix.makeScale(a.x,a.y,a.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.update(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(e=this.inheritVelocity)==null||e.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var n;if(this._subEmitterSystems&&this._particleSystem)for(const e of this._subEmitterSystems){e.particleSystem&&(e.particleSystem.__internalAwake?e.particleSystem.__internalAwake():it()&&console.warn("SubParticleSystem serialization issue(?)",e.particleSystem,e));const i=(n=e.particleSystem)==null?void 0:n._particleSystem;if(i){e.particleSystem._isUsedAsSubsystem=!0;const r=new wM(this,this._particleSystem,e.particleSystem,i);r.emitterType=e.type,r.emitterProbability=e.emitProbability,this._particleSystem.addBehavior(r)}else Sx&&console.warn("Could not add SubParticleSystem",e,this)}}};let or=_M;Mn([C(ix)],or.prototype,"colorOverLifetime",2),Mn([C(hs)],or.prototype,"main",2),Mn([C(Pc)],or.prototype,"emission",2),Mn([C(Gd)],or.prototype,"sizeOverLifetime",2),Mn([C(Cn)],or.prototype,"shape",2),Mn([C(Mi)],or.prototype,"noise",2),Mn([C(vn)],or.prototype,"trails",2),Mn([C(En)],or.prototype,"velocityOverLifetime",2),Mn([C(rr)],or.prototype,"limitVelocityOverLifetime",2),Mn([C(Hd)],or.prototype,"inheritVelocity",2),Mn([C(Jf)],or.prototype,"colorBySpeed",2),Mn([C(us)],or.prototype,"textureSheetAnimation",2),Mn([C(Wa)],or.prototype,"rotationOverLifetime",2),Mn([C(ca)],or.prototype,"rotationBySpeed",2),Mn([C(fo)],or.prototype,"sizeBySpeed",2);class Cx{constructor(){p(this,"particleSystem"),p(this,"emitProbability",1),p(this,"properties"),p(this,"type")}_deserialize(e,i){const r=this.particleSystem;if(r instanceof or)return;let s="";r&&typeof r.guid=="string"&&(s=r.guid,this.particleSystem=ie.findByGuid(s,i)),Sx&&!(this.particleSystem instanceof or)&&console.warn("Could not find particle system for sub emitter",s,i,this)}}function f7(n,e){if(e.set(1,1,1),n.gameObject.parent&&n.localspace)switch(n.main.scalingMode){case eL.Local:e=Qi(n.gameObject.parent,e),e.x=1/e.x,e.y=1/e.y,e.z=1/e.z;break;default:if(!n.unsupported_scaling_mode){n.unsupported_scaling_mode=!0;const i="ParticleSystem scale mode "+eL[n.main.scalingMode]+" is not supported";it()&&Pi(i),console.warn(i,n.name,n)}e=Qi(n.gameObject,e);break}return e}new S(1,1,1),new S(0,0,1);class wM{constructor(e,i,r,s){p(this,"type","NeedleParticleSubEmitter"),p(this,"emitterType"),p(this,"emitterProbability"),p(this,"q_",new Ce),p(this,"v_",new S),p(this,"v2_",new S),p(this,"_emitterMatrix",new he),p(this,"_circularBuffer"),this.system=e,this.particleSystem=i,this.subSystem=r,this.subParticleSystem=s,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const o=1e3;this._circularBuffer=new Qo(()=>new he,o)}clone(){throw new Error("Method not implemented.")}initialize(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===e3.Birth&&this.run(e)}update(e,i){this.run(e)}frameUpdate(e){}toJSON(){}reset(){}run(e){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!e.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const i=this.system.deltaTime;if(this.emitterType===e3.Death){let s=e.life;if(e[uv]!==void 0&&(s=e[uv]),!(e.age+i*1.2>=s))return;const o=this.subSystem.main.maxParticles-this.subSystem.currentParticles;e.emissionState.waitEmiting=o}const r=new he;r.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1),this.particleSystem.worldSpace||r.multiplyMatrices(this._emitterMatrix,r),this.subParticleSystem.emit(i,e.emissionState,r)}}var N_e=Object.defineProperty,z_e=Object.getOwnPropertyDescriptor,j_e=(n,e,i,r)=>{for(var s=r>1?void 0:r?z_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&N_e(e,i,s),s};class Ex extends ss{constructor(){super(...arguments),p(this,"granularity",new Ke(10))}get typeName(){return"PixelationEffect"}onCreateEffect(){const e=new e5;return this.granularity.onValueChanged=i=>{e.granularity=i},e}}j_e([C(Ke)],Ex.prototype,"granularity",2),Qa("PixelationEffect",Ex);class Qv extends Be{constructor(){super(...arguments),p(this,"_didAssignPlayerColor",!1),p(this,"tryAssignColor",()=>{const e=ie.getComponentInParent(this.gameObject,ra);if(e&&e.owner)return this._didAssignPlayerColor=!0,this.assignUserColor(e.owner),!0;const i=ie.getComponentInParent(this.gameObject,as);return i!=null&&i.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(i.connectionId),!0):!1})}onEnable(){this.context.connection.beginListen(jt.JoinedRoom,this.tryAssignColor),this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}onDisable(){this.context.connection.stopListen(jt.JoinedRoom,this.tryAssignColor)}*waitForConnection(){for(;!this.destroyed&&this.activeAndEnabled&&(yield lV(.2),!this.tryAssignColor()););}assignUserColor(e){const i=Qv.hashCode(e),r=Qv.colorFromHashCode(i);if(this.gameObject.type==="Mesh"){const s=this.gameObject;this.assignColor(r,e,s)}else if(this.gameObject.children)for(const s of this.gameObject.children){const o=s;o.material&&o.material.color&&this.assignColor(r,e,o)}}assignColor(e,i,r){let s=r.material;s&&(s._playerMaterial!==i&&(s=s.clone(),s._playerMaterial=i,r.material=s),s.color=e)}static hashCode(e){var i=0,r,s;if(e.length===0)return i;for(r=0;r<e.length;r++)s=e.charCodeAt(r),i=(i<<5)-i+s,i|=0;return i}static colorFromHashCode(e){const i=(e&16711680)>>16,r=(e&65280)>>8,s=e&255;return new be(i/255,r/255,s/255)}}const Mx=new dt;Mx.setAttribute("position",new Ye(new Float32Array([-1,-1,3,-1,-1,3]),2)),Mx.setAttribute("uv",new Ye(new Float32Array([0,0,2,0,0,2]),2)),Mx.boundingSphere=new Zi,Mx.computeBoundingSphere=function(){};const G_e=new Yl;class lm{constructor(e){this._mesh=new pe(Mx,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,G_e)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const H_e={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new he},viewMat:{value:new he},projViewMat:{value:new he},projectionMatrixInv:{value:new he},viewMatrixInv:{value:new he},cameraPos:{value:new S},resolution:{value:new J},time:{value:0},samples:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1},frame:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform float frame;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

mat3 makeRotationZ(float theta) {
	float c = cos(theta);
	float s = sin(theta);
	return mat3(c, - s, 0,
			s,  c, 0,
			0,  0, 1);
  }

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec2 harmoniousNumbers = vec2(
        1.618033988749895,
        1.324717957244746
      );
      noise.rg += harmoniousNumbers * frame;
      noise.rg = fract(noise.rg);
        vec3 helperVec = vec3(0.0, 1.0, 0.0);
        if (dot(helperVec, normal) > 0.99) {
          helperVec = vec3(1.0, 0.0, 0.0);
        }
        vec3 tangent = normalize(cross(helperVec, normal));
        vec3 bitangent = cross(normal, tangent);
        mat3 tbn = mat3(tangent, bitangent, normal) *  makeRotationZ(noise.r * 2.0 * 3.1415962) ;

      float occluded = 0.0;
      float totalWeight = 0.0;
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : radiusToUse * distanceFalloff * 0.2;
      float bias = (min(
        0.1,
        distanceFalloffToUse * 0.1
      ) / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      float phi = 1.61803398875;
      float offsetMove = 0.0;
      float offsetMoveInv = 1.0 / FSAMPLES;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = tbn * samples[int(i)];

        float moveAmt = fract(noise.g + offsetMove);
        offsetMove += offsetMoveInv;

        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        
        vec2 diff = gl_FragCoord.xy - floor(offset.xy * resolution);
        // From Rabbid76's hbao
        vec2 clipRangeCheck = step(vec2(0.0),offset.xy) * step(offset.xy, vec2(1.0));
          float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;

          #ifdef LOGDEPTH

          float distSample = linearize_depth_log(sampleDepth, near, far);

          #else

          float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);

          #endif

          float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
          
          float rangeCheck = distSample == distWorld ? 0.0 : smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
          
          float sampleValid = (clipRangeCheck.x * clipRangeCheck.y);
          occluded += rangeCheck * float(sampleDepth != depth) * float(distSample + bias < distWorld) * step(
            1.0,
            dot(diff, diff)
          ) * sampleValid;
          
          totalWeight += sampleValid;
      }
      float occ = clamp(1.0 - occluded / (totalWeight == 0.0 ? 1.0 : totalWeight), 0.0, 1.0);
      gl_FragColor = vec4(occ, 0.5 + 0.5 * normal);
}`},V_e={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},transparencyDWFalse:{value:null},transparencyDWTrue:{value:null},transparencyDWTrueDepth:{value:null},transparencyAware:{value:!1},projMat:{value:new he},viewMat:{value:new he},projectionMatrixInv:{value:new he},viewMatrixInv:{value:new he},cameraPos:{value:new S},resolution:{value:new J},color:{value:new S(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform highp sampler2D transparencyDWFalse;
    uniform highp sampler2D transparencyDWTrue;
    uniform highp sampler2D transparencyDWTrueDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform bool transparencyAware;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.gba * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.r = clamp(texel.r, 0.0, 1.0);
        if (texel.r == 0.0) {
          texel.r = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.r, intensity);
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        if (transparencyAware) {
            float transparencyDWOff = texture2D(transparencyDWFalse, vUv).a;
            float transparencyDWOn = texture2D(transparencyDWTrue, vUv).a;
            float adjustmentFactorOff = transparencyDWOff;
            float adjustmentFactorOn = (1.0 - transparencyDWOn) * (
                texture2D(transparencyDWTrueDepth, vUv).r == texture2D(sceneDepth, vUv).r ? 1.0 : 0.0
            );
            float adjustmentFactor = max(adjustmentFactorOff, adjustmentFactorOn);
            finalAo = mix(finalAo, 1.0, adjustmentFactor);
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},Q_e={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new he},viewMat:{value:new he},projectionMatrixInv:{value:new he},viewMatrixInv:{value:new he},cameraPos:{value:new S},resolution:{value:new J},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.r;
        float baseOcc = data.r;
        vec3 normal = data.gba * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
        radiusToUse * distanceFalloff
    : radiusToUse * distanceFalloff * 0.2;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.r;
            vec3 normalSample = dataSample.gba * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
            float rangeCheck = dSample == 1.0 ? 0.0 :exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(occlusion, 0.5 + 0.5 * normal);
    }
    `},W_e={uniforms:{sceneDepth:{value:null},resolution:{value:new J},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new he},projectionMatrixInv:{value:new he},logDepth:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        highp vec2[4] uvSamples;
        uvSamples[0] = uv;
        uvSamples[1] = uv + vec2(pixelSize.x, 0.0);
        uvSamples[2] = uv + vec2(0.0, pixelSize.y);
        uvSamples[3] = uv + pixelSize;
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[4] samples;
        samples[0] = depth00;
        samples[1] = depth10;
        samples[2] = depth01;
        samples[3] = depth11;
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
    }`};var m7="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";const X_e=Uint8Array.from(atob(m7),n=>n.charCodeAt(0));function g7(n,e,i){if(e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE)){const r=e.getQueryParameter(n,e.QUERY_RESULT)/1e6;i.lastTime=r}else setTimeout(()=>{g7(n,e,i)},1)}class v7 extends Jr{constructor(e,i,r=512,s=512){super(),this.width=r,this.height=s,this.clear=!0,this.camera=i,this.scene=e,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new be(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0,transparencyAware:!1,accumulate:!1},{set:(o,a,l)=>{const c=o[a];return o[a]=l,l.equals?l.equals(c)||this.firstFrame():c!==l&&this.firstFrame(),a==="aoSamples"&&c!==l&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),a==="denoiseSamples"&&c!==l&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),a==="halfRes"&&c!==l&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),a==="depthAwareUpsampling"&&c!==l&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),a==="gammaCorrection"&&(this.autosetGamma=!1),a==="transparencyAware"&&c!==l&&(this.autoDetectTransparency=!1,this.configureTransparencyTarget()),!0}}),this.samples=[],this.samplesDenoise=[],this.autoDetectTransparency=!0,this.frames=0,this.lastViewMatrix=new he,this.lastProjectionMatrix=new he,this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.detectTransparency(),this.configureTransparencyTarget(),this.copyQuad=new lm(new Bt({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new qt(this.width,this.height,{minFilter:Dt,magFilter:Dt,depthBuffer:!1}),this.readTargetInternal=new qt(this.width,this.height,{minFilter:Dt,magFilter:Dt,depthBuffer:!1}),this.outputTargetInternal=new qt(this.width,this.height,{minFilter:Dt,magFilter:Dt,depthBuffer:!1}),this.accumulationRenderTarget=new qt(this.width,this.height,{minFilter:Dt,magFilter:Dt,depthBuffer:!1,format:Ti,type:ur,stencilBuffer:!1,depthBuffer:!1,alpha:!0}),this.accumulationQuad=new lm(new Bt({uniforms:{frame:{value:0},tDiffuse:{value:null}},transparent:!0,opacity:1,vertexShader:`
             varying vec2 vUv;
             void main() {
                 vUv = uv;
                 gl_Position = vec4(position, 1);
             }`,fragmentShader:`
             uniform sampler2D tDiffuse;
             uniform float frame;
                varying vec2 vUv;
                void main() {
                    vec4 color = texture2D(tDiffuse, vUv);
                    gl_FragColor = vec4(color.rgb, 1.0 / (frame + 1.0));
                }
                `})),this.bluenoise=new Ms(X_e,128,128),this.bluenoise.colorSpace=xo,this.bluenoise.wrapS=Ao,this.bluenoise.wrapT=Ao,this.bluenoise.minFilter=Rt,this.bluenoise.magFilter=Rt,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new J,this._c=new be}configureHalfResTargets(){this.firstFrame(),this.configuration.halfRes?(this.depthDownsampleTarget=new qt(this.width/2,this.height/2,{count:2}),this.depthDownsampleTarget.textures[0].format=xp,this.depthDownsampleTarget.textures[0].type=Hi,this.depthDownsampleTarget.textures[0].minFilter=Rt,this.depthDownsampleTarget.textures[0].magFilter=Rt,this.depthDownsampleTarget.textures[0].depthBuffer=!1,this.depthDownsampleTarget.textures[1].format=Ti,this.depthDownsampleTarget.textures[1].type=ur,this.depthDownsampleTarget.textures[1].minFilter=Rt,this.depthDownsampleTarget.textures[1].magFilter=Rt,this.depthDownsampleTarget.textures[1].depthBuffer=!1,this.depthDownsampleQuad=new lm(new Bt(W_e))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}detectTransparency(){if(this.autoDetectTransparency){let e=!1;this.scene.traverse(i=>{i.material&&i.material.transparent&&(e=!0)}),e&&(this.configuration.transparencyAware=!0)}}configureTransparencyTarget(){this.configuration.transparencyAware?(this.transparencyRenderTargetDWFalse=new qt(this.width,this.height,{minFilter:Dt,magFilter:Rt,type:ur,format:Ti}),this.transparencyRenderTargetDWTrue=new qt(this.width,this.height,{minFilter:Dt,magFilter:Rt,type:ur,format:Ti}),this.transparencyRenderTargetDWTrue.depthTexture=new tg(this.width,this.height,_s),this.depthCopyPass=new lm(new Bt({uniforms:{depthTexture:{value:this.depthTexture}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }`,fragmentShader:`
            uniform sampler2D depthTexture;
            varying vec2 vUv;
            void main() {
               gl_FragDepth = texture2D(depthTexture, vUv).r + 0.00001;
               gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
            }
            `}))):(this.transparencyRenderTargetDWFalse&&(this.transparencyRenderTargetDWFalse.dispose(),this.transparencyRenderTargetDWFalse=null),this.transparencyRenderTargetDWTrue&&(this.transparencyRenderTargetDWTrue.dispose(),this.transparencyRenderTargetDWTrue=null),this.depthCopyPass&&(this.depthCopyPass.dispose(),this.depthCopyPass=null))}renderTransparency(e){const i=this.scene.background,r=e.getClearColor(new be),s=e.getClearAlpha(),o=new Map,a=e.autoClearDepth;this.scene.traverse(l=>{o.set(l,l.visible)}),this.scene.background=null,e.autoClearDepth=!1,e.setClearColor(new be(0,0,0),0),this.depthCopyPass.material.uniforms.depthTexture.value=this.depthTexture,e.setRenderTarget(this.transparencyRenderTargetDWFalse),this.scene.traverse(l=>{l.material&&(l.visible=o.get(l)&&l.material.transparent&&!l.material.depthWrite&&!l.userData.treatAsOpaque)}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),e.setRenderTarget(this.transparencyRenderTargetDWTrue),this.scene.traverse(l=>{l.material&&(l.visible=o.get(l)&&l.material.transparent&&l.material.depthWrite&&!l.userData.treatAsOpaque)}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),this.scene.traverse(l=>{l.visible=o.get(l)}),e.setClearColor(r,s),this.scene.background=i,e.autoClearDepth=a}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(e=!1){this.firstFrame(),this.samples=this.generateHemisphereSamples(this.configuration.aoSamples);const i={...H_e};i.fragmentShader=i.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),this.configuration.halfRes&&(i.fragmentShader=`#define HALFRES
`+i.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new Bt(i)):this.effectShaderQuad=new lm(new Bt(i))}configureDenoisePass(e=!1){this.firstFrame(),this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const i={...Q_e};i.fragmentShader=i.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new Bt(i)):this.poissonBlurQuad=new lm(new Bt(i))}configureEffectCompositer(e=!1){this.firstFrame();const i={...V_e};e&&(i.fragmentShader=`#define LOGDEPTH
`+i.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(i.fragmentShader=`#define HALFRES
`+i.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new Bt(i)):this.effectCompositerQuad=new lm(new Bt(i))}generateHemisphereSamples(e){const i=[];for(let r=0;r<e;r++){const s=2.399963*r,o=Math.sqrt(r+.5)/Math.sqrt(e),a=o*Math.cos(s),l=o*Math.sin(s),c=Math.sqrt(1-(a*a+l*l));i.push(new S(a,l,c))}return i}generateDenoiseSamples(e,i){const r=2*Math.PI*i/e,s=1/e,o=s,a=[];let l=s,c=0;for(let h=0;h<e;h++)a.push(new J(Math.cos(c),Math.sin(c)).multiplyScalar(Math.pow(l,.75))),l+=o,c+=r;return a}setSize(e,i){this.firstFrame(),this.width=e,this.height=i;const r=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(e*r,i*r),this.readTargetInternal.setSize(e*r,i*r),this.accumulationRenderTarget.setSize(e*r,i*r),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*r,i*r),this.configuration.transparencyAware&&(this.transparencyRenderTargetDWFalse.setSize(e,i),this.transparencyRenderTargetDWTrue.setSize(e,i)),this.outputTargetInternal.setSize(e,i)}setDepthTexture(e){this.depthTexture=e}firstFrame(){this.needsFrame=!0}render(e,i,r){const s=e.xr.enabled;e.xr.enabled=!1,e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer)),this.detectTransparency(),(i.texture.type!==this.outputTargetInternal.texture.type||i.texture.format!==this.outputTargetInternal.texture.format)&&(this.outputTargetInternal.texture.type=i.texture.type,this.outputTargetInternal.texture.format=i.texture.format,this.outputTargetInternal.texture.needsUpdate=!0),this.camera.updateMatrixWorld(),this.lastViewMatrix.equals(this.camera.matrixWorldInverse)&&this.lastProjectionMatrix.equals(this.camera.projectionMatrix)&&this.configuration.accumulate&&!this.needsFrame?this.frame++:(e.setRenderTarget(this.accumulationRenderTarget),e.clear(!0,!0,!0),this.frame=0,this.needsFrame=!1),this.lastViewMatrix.copy(this.camera.matrixWorldInverse),this.lastProjectionMatrix.copy(this.camera.projectionMatrix);let o,a,l;this.debugMode&&(o=e.getContext(),a=o.getExtension("EXT_disjoint_timer_query_webgl2"),a===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(l=o.createQuery(),o.beginQuery(a.TIME_ELAPSED_EXT,l)),this.configuration.transparencyAware&&this.renderTransparency(e),this._r.set(this.width,this.height);let c=this.configuration.aoRadius;if(this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(c*=.5),this.frame<1024/this.configuration.aoSamples){this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=i.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new S),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=c,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectShaderQuad.material.uniforms.frame.value=this.frame,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let u=0;u<this.configuration.denoiseIterations;u++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new S),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=c,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=u,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);e.setRenderTarget(this.accumulationRenderTarget);const h=e.autoClear;e.autoClear=!1,this.accumulationQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.accumulationQuad.material.uniforms.frame.value=this.frame,this.accumulationQuad.render(e),e.autoClear=h}this.configuration.transparencyAware&&(this.effectCompositerQuad.material.uniforms.transparencyDWFalse.value=this.transparencyRenderTargetDWFalse.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrue.value=this.transparencyRenderTargetDWTrue.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrueDepth.value=this.transparencyRenderTargetDWTrue.depthTexture,this.effectCompositerQuad.material.uniforms.transparencyAware.value=!0),this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=i.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=c,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.accumulationRenderTarget.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new S),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),e.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(e),e.setRenderTarget(this.renderToScreen?null:r),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(e),this.debugMode&&(o.endQuery(a.TIME_ELAPSED_EXT),g7(l,o,this)),e.xr.enabled=s}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(m7),n=>n.charCodeAt(0));var q_e=Object.defineProperty,Y_e=Object.getOwnPropertyDescriptor,y7=(n,e,i,r)=>{for(var s=r>1?void 0:r?Y_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&q_e(e,i,s),s};class Tx extends ss{constructor(){super(...arguments),p(this,"_effect")}get typeName(){return"Sharpening"}onCreateEffect(){return this.effect}get effect(){return this._effect??(this._effect=new A7),this._effect}set amount(e){this.effect.uniforms.get("amount").value=e}get amount(){return this.effect.uniforms.get("amount").value}set radius(e){this.effect.uniforms.get("radius").value=e}get radius(){return this.effect.uniforms.get("radius").value}}y7([C()],Tx.prototype,"amount",1),y7([C()],Tx.prototype,"radius",1);const J_e=`
  void mainSupport() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,K_e=`
uniform sampler2D tDiffuse;
uniform float amount;
uniform float radius;

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
    float tx = 1.0 / resolution.x;
    float ty = 1.0 / resolution.y;
    vec2 texelSize = vec2(tx, ty);

    vec4 blurred = vec4(0.0);
    float total = 0.0;

    for (float x = -radius; x <= radius; x++) {
        for (float y = -radius; y <= radius; y++) {
            vec2 offset = vec2(x, y) * texelSize;
            vec4 diffuse = texture2D(tDiffuse, uv + offset);
            float weight = exp(-length(offset) * amount);
            blurred += diffuse * weight;
            total += weight;
        }
    }

    if (total > 0.0) {
        blurred /= total;
    }

    // Calculate the sharpened color using inputColor
    vec4 sharp = inputColor + clamp(inputColor - blurred, 0.0, 1.0) * amount;
    // Keep original alpha
    sharp.a = inputColor.a;

    // Ensure the sharp color does not go below 0 or above 1
    // This means: sharpening must happen AFTER tonemapping.
    sharp = clamp(sharp, 0.0, 1.0);

    outputColor = sharp;
}

`;class A7 extends to{constructor(){super("Sharpening",K_e,{vertexShader:J_e,blendFunction:Vt.NORMAL,uniforms:new Map([["amount",new Se(1)],["radius",new Se(1)]])})}}const cm=te("debugpost"),o3=Symbol("needle:postprocessing-handler"),a3=Symbol("needle:previous-autoclear-state");class SM{constructor(e){p(this,"_composer",null),p(this,"_lastVolumeComponents"),p(this,"_effects",[]),p(this,"_isActive",!1),p(this,"context"),this.context=e}get isActive(){return this._isActive}get composer(){return this._composer}apply(e){this._isActive=!0,this.onApply(this.context,e)}unapply(){var e;if(cm&&console.log("Unapplying postprocessing effects"),this._isActive=!1,this._lastVolumeComponents){for(const r of this._lastVolumeComponents)r.unapply();this._lastVolumeComponents.length=0}const i=this.context;i[o3]===this&&delete i[o3],i.composer===this._composer&&((e=i.composer)==null||e.dispose(),i.composer=null),typeof i.renderer[a3]=="boolean"&&(i.renderer.autoClear=i.renderer[a3])}dispose(){this.unapply();for(const e of this._effects)e.dispose();this._effects.length=0,this._composer=null}onApply(e,i){if(!i)return;e[o3]=this,cm&&console.log("refreshing volume profile",i),this._lastVolumeComponents=[...i],this._effects.length=0;const r={handler:this,components:this._lastVolumeComponents};for(let s=0;s<this._lastVolumeComponents.length;s++){const o=this._lastVolumeComponents[s];if(o.context=e,o.apply){if(o.active){if(!e.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const a=o.apply(r);if(!a)continue;Array.isArray(a)?this._effects.push(...a):this._effects.push(a)}}else o.active&&Pi("Volume component is not a VolumeComponent: "+o.__type)}if(this.context.renderer.toneMapping!=Xs&&!this._effects.find(s=>s instanceof O1)){const s=new O1;this._effects.push(s)}this.applyEffects(e)}applyEffects(e){const i=this._effects;if(i.length<=0)return;const r=e.mainCameraComponent,s=e.renderer,o=e.scene,a=r.cam;s[a3]=s.autoClear;const l=s.capabilities.maxSamples;this._composer||(this._composer=new yP(s,{frameBufferType:ur,stencilBuffer:!0,multisampling:Math.min(ec()?4:8,l)})),e.composer&&e.composer!==this._composer&&console.warn("There's already an active EffectComposer in your scene: replacing it with a new one. This might cause unexpected behaviour. Make sure to only use one PostprocessingManager/Volume in your scene."),e.composer=this._composer;const c=e.composer;c.setMainCamera(a),c.setRenderer(s),c.setMainScene(o);for(const u of c.passes)u.dispose();c.removeAllPasses();const h=new k1(o,a);h.name="Render To Screen",h.mainScene=o,c.addPass(h);try{this.orderEffects();const u=[];for(const d of i)if(d instanceof to)u.push(d);else if(d instanceof Jr){const f=new h5(a,...u);f.mainScene=o,f.name=u.map(m=>m.constructor.name).join(", "),f.enabled=!0,u.length=0,c.addPass(d)}if(u.length>0){const d=new h5(a,...u);d.name=u.map(f=>f.name).join(" "),d.mainScene=o,d.enabled=!0,c.addPass(d)}}catch(u){console.error("Error while applying postprocessing effects",u),c.removeAllPasses()}cm&&console.log("PostProcessing Passes",i,"->",c.passes)}orderEffects(){var e;cm&&console.log("Before ordering effects",[...this._effects]);const i=this._effects;i.sort((r,s)=>{const o=l3.findIndex(l=>r.constructor.name.endsWith(l.name)),a=l3.findIndex(l=>s.constructor.name.endsWith(l.name));return o<0?(cm&&console.warn("Unknown effect found: ",r.constructor.name),-1):a<0?(cm&&console.warn("Unknown effect found: ",s.constructor.name),1):o<0?1:a<0?-1:o-a}),cm&&console.log("After ordering effects",[...this._effects]);for(let r=0;r<i.length;r++){const s=i[r];if(((e=s?.configuration)==null?void 0:e.gammaCorrection)!==void 0){const o=r===i.length-1;s.configuration.gammaCorrection=o}}}}const l3=[u5,wP,r5,o5,v7,a5,Zj,Yj,xP,t5,l5,e5,O1,$j,qj,A7];async function c3(n){const{NeedleEngineHTMLElement:e}=await Promise.resolve().then(()=>D1e);e.observedAttributes.includes(n)||e.observedAttributes.push(n)}var Z_e=Object.defineProperty,$_e=Object.getOwnPropertyDescriptor,Ix=(n,e,i,r)=>{for(var s=r>1?void 0:r?$_e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Z_e(e,i,s),s};const Ya=te("debugskybox");c3("skybox-image"),c3("environment-image");function b7(n,e,i,r,s){const o=new Gc;o.allowDrop=!1,o.allowNetworking=!1,o.background=i,o.environment=r,ie.addComponent(n.scene,o);const a=l=>{typeof l=="string"&&(Ya&&console.log(s,"CHANGED TO",l),o.setSkybox(l))};return u4(n.domElement,s,a),o.addEventListener("destroy",()=>{Ya&&console.log("Destroyed attribute remote skybox",s),d4(n.domElement,s,a)}),o.setSkybox(e)}fi.addContextCreatedCallback(n=>{var e;const i=n.context,r=i.domElement.getAttribute("skybox-image"),s=i.domElement.getAttribute("environment-image"),o=new Array;if(r){Ya&&console.log("Creating remote skybox to load "+r),((e=i.mainCameraComponent)==null?void 0:e.clearFlags)!==Cd.Skybox&&console.warn('"skybox-image" attribute has no effect: camera clearflags are not set to "Skybox"');const a=b7(i,r,!0,!1,"skybox-image");o.push(a)}if(s){Ya&&console.log("Creating remote environment to load "+s);const a=b7(i,s,!1,!0,"environment-image");o.push(a)}return o.length>0?h1(o):Promise.resolve()});function x7(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function _7(n){const e=x7().find(i=>i.src===n);return e?(Ya&&console.log("Skybox: Found previously loaded texture for "+n),e.texture):null}async function ewe(n){const e=await n;xk(e,!0),Wi(e)}function twe(n,e){const i=x7();for(;i.length>5;){const r=i.shift();r&&ewe(r.texture)}e.then(r=>xk(r,!1)),i.push({src:n,texture:e})}class Gc extends Be{constructor(){super(...arguments),p(this,"url"),p(this,"allowDrop",!0),p(this,"background",!0),p(this,"environment",!0),p(this,"allowNetworking",!0),p(this,"_loader"),p(this,"_prevUrl"),p(this,"_prevLoadedEnvironment"),p(this,"_prevEnvironment",null),p(this,"_prevBackground",null),p(this,"validTextureTypes",[".hdr",".exr",".jpg",".jpeg",".png"]),p(this,"onDragOverEvent",e=>{if(this.allowDrop&&e.dataTransfer)for(const i of e.dataTransfer.types)(i==="text/uri-list"||i==="Files")&&e.preventDefault()}),p(this,"onDrop",e=>{var i,r,s,o;if(this.allowDrop&&e.dataTransfer){for(const a of e.dataTransfer.types)if(Ya&&console.log(a),a==="text/uri-list"){const l=e.dataTransfer.getData(a);Ya&&console.log(a,l);let c=(r=(i=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(l))==null?void 0:i.groups)==null?void 0:r.name;if(c||(c=(o=(s=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(l))==null?void 0:s.groups)==null?void 0:o.name),Ya&&console.log(c),c){const h="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+c+"_1k.exr";console.log(`[Remote Skybox] Setting skybox from url: ${h}`),e.preventDefault(),this.setSkybox(h);break}else if(this.isValidTextureType(l)){console.log("[Remote Skybox] Setting skybox from url: "+l),e.preventDefault(),this.setSkybox(l);break}else{console.warn(`[RemoteSkybox] Unknown url ${l}. If you want to load a skybox from a url, make sure it is a valid image url. Url must end with${this.validTextureTypes.join(", ")}.`);const h=new CustomEvent("dropped-unknown-url",{detail:{sender:this,event:e,url:l,apply:u=>{e.preventDefault(),this.setSkybox(u)}}});this.dispatchEvent(h)}}else if(a=="Files"){const l=e.dataTransfer.files.item(0);if(Ya&&console.log(a,l),!l)continue;if(!this.isValidTextureType(l.name)){console.warn(`[RemoteSkybox]: File "${l.name}" is not supported. Supported files are ${this.validTextureTypes.join(", ")}`);return}if(_7(l.name)===null){const c=new Blob([l]),h=URL.createObjectURL(c);e.preventDefault(),this.setSkybox(h,l.name)}else e.preventDefault(),this.setSkybox(l.name);break}}})}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var e;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,Ui.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(e=this.context.mainCameraComponent)==null||e.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.url&&this.isRemoteTexture(this.url)&&this.setSkybox(this.url)}async setSkybox(e,i){var r;if(!this.activeAndEnabled||(e=iwe(e,this.environment,this.background),!e))return!1;if(i??(i=e),this.isValidTextureType(i)||console.warn("Potentially invalid skybox url",i,"on",this.name),Ya&&console.log("Set remote skybox url: "+e),this._prevUrl===e&&this._prevLoadedEnvironment)return this.applySkybox(),!0;(r=this._prevLoadedEnvironment)==null||r.dispose(),this._prevLoadedEnvironment=void 0,this._prevUrl=e;const s=await this.loadTexture(e,i);if(!s||!this.enabled)return!1;this.url=e;const o=e.lastIndexOf("/");return s.name=e.substring(o>=0?o+1:0),this._loader instanceof Kl&&(s.colorSpace=gt),this._prevLoadedEnvironment=s,this.applySkybox(),!0}async loadTexture(e,i){var r,s,o,a,l;if(!e)return Promise.resolve(null);i??(i=e);const c=_7(i);if(c){const f=await c;if(((s=(r=f.source)==null?void 0:r.data)==null?void 0:s.length)>0||(l=(a=(o=f.source)==null?void 0:o.data)==null?void 0:a.data)!=null&&l.length)return f}const h=i.endsWith(".exr"),u=i.endsWith(".hdr");h?this._loader instanceof sb||(this._loader=new sb):u?this._loader instanceof CC||(this._loader=new CC):this._loader instanceof Kl||(this._loader=new Kl),Ya&&console.log("Loading skybox: "+e);const d=this._loader.loadAsync(e);return twe(i,d),await d}applySkybox(){var e;const i=this._prevLoadedEnvironment;i&&(i.mapping=Rm,i.needsUpdate=!0,this.context.scene.background!==i&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==i&&(this._prevEnvironment=this.context.scene.environment),Ya&&console.log("Set remote skybox",this.url,!Ui.backgroundShouldBeTransparent(this.context)),this.environment&&(this.context.scene.environment=i),this.background&&!Ui.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=i),((e=this.context.mainCameraComponent)==null?void 0:e.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}isRemoteTexture(e){return e.startsWith("http://")||e.startsWith("https://")}isValidTextureType(e){for(const i of this.validTextureTypes)if(e.endsWith(i))return!0;return!1}registerDropEvents(){this.unregisterDropEvents(),this.context.domElement.addEventListener("dragover",this.onDragOverEvent),this.context.domElement.addEventListener("drop",this.onDrop)}unregisterDropEvents(){this.context.domElement.removeEventListener("dragover",this.onDragOverEvent),this.context.domElement.removeEventListener("drop",this.onDrop)}}Ix([gD(Gc.prototype.urlChangedSyncField),C(URL)],Gc.prototype,"url",2),Ix([C()],Gc.prototype,"allowDrop",2),Ix([C()],Gc.prototype,"background",2),Ix([C()],Gc.prototype,"environment",2),Ix([C()],Gc.prototype,"allowNetworking",2);function iwe(n,e,i){const r=e&&!i;switch(n?.toLowerCase()){case"studio":return r?"https://cdn.needle.tools/static/skybox/modelviewer-Neutral-small.hdr":"https://cdn.needle.tools/static/skybox/modelviewer-Neutral.hdr";case"blurred-skybox":return r?"https://cdn.needle.tools/static/skybox/blurred-skybox-small.exr":"https://cdn.needle.tools/static/skybox/blurred-skybox.exr";case"quicklook-ar":return r?"https://cdn.needle.tools/static/skybox/QuickLook-ARMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ARMode.exr";case"quicklook":return r?"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode.exr"}return n===void 0?null:n}var nwe=Object.defineProperty,rwe=Object.getOwnPropertyDescriptor,mo=(n,e,i,r)=>{for(var s=r>1?void 0:r?rwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&nwe(e,i,s),s};const Do=te("debugsceneswitcher"),swe=te("sceneswitcher:clearscene"),CM="scene";c3(CM);const $d=Promise.resolve(!1);class Gr extends Be{constructor(){super(...arguments),p(this,"autoLoadFirstScene",!0),p(this,"scenes",[]),p(this,"loadingScene"),p(this,"queryParameterName","scene"),p(this,"useSceneName",!0),p(this,"clamp",!0),p(this,"useHistory",!0),p(this,"useKeyboard",!0),p(this,"useSwipe",!0),p(this,"useSceneLighting",!0),p(this,"useSceneBackground",!0),p(this,"preloadNext",1),p(this,"preloadPrevious",1),p(this,"preloadConcurrent",2),p(this,"createMenuButtons",!1),p(this,"_currentIndex",-1),p(this,"_currentScene"),p(this,"_engineElementOverserver"),p(this,"_preloadScheduler"),p(this,"_menuButtons"),p(this,"onPopState",async e=>{if(!this.useHistory)return;const i=this.useHistory;try{this.useHistory=!1;let r=!1;if(this.queryParameterName&&(r=await this.tryLoadFromQueryParam()),!r){const s=e?.state;if(s&&s.startsWith(this.guid)){const o=s.substr(this.guid.length+2);Do&&console.log("PopState",o),await this.trySelectSceneFromValue(o)}}}finally{this.useHistory=i}}),p(this,"normalizedSwipeThresholdX",.1),p(this,"_didSwipe",!1),p(this,"onInputPointerMove",e=>{if(this.useSwipe&&!this._didSwipe&&e.button===0&&e.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const i=this.context.input.getPointerPositionDelta(e.button);if(i){const r=i.x/this.context.domWidth;r>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):r<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}}),p(this,"onInputPointerUp",e=>{e.button===0&&(this._didSwipe=!1)}),p(this,"onInputKeyDown",e=>{if(!this.useKeyboard||!this.scenes)return;const i=e.key.toLowerCase();if(!i)return;const r=parseInt(i)-1;if(r>=0){this.trySelectSceneFromValue(r);return}switch(i){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}}),p(this,"__lastSwitchScene"),p(this,"__lastSwitchScenePromise"),p(this,"_currentlyLoadingScene"),p(this,"_lastLoadingScene"),p(this,"_loadingScenePromise"),p(this,"_isCurrentlyLoading",!1),p(this,"_currentLoadingProgress")}get currentIndex(){return this._currentIndex}get currentLoadingProgress(){return this._currentLoadingProgress}get currentlyLoadingScene(){return this._currentlyLoadingScene}get currentlyLoadedScene(){return this._currentScene}awake(){this.scenes===void 0&&(this.scenes=[]);for(const e of this.scenes)e&&!e.hasUrl&&e.asset instanceof ve&&e.asset.removeFromParent();Do&&console.log("SceneSwitcher",this)}async onEnable(){if(globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(pn.KeyDown,this.onInputKeyDown),this.context.input.addEventListener(pn.PointerMove,this.onInputPointerMove),this.context.input.addEventListener(pn.PointerUp,this.onInputPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(e=>{for(const i of e)if(i.type==="attributes"&&i.attributeName===CM){const r=this.context.domElement.getAttribute(CM);r!==null&&this.trySelectSceneFromValue(r)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new owe(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin(),this.autoLoadFirstScene&&this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const e=this.context.domElement.getAttribute(CM);try{(e===null||!await this.trySelectSceneFromValue(e))&&this._currentIndex===-1&&this.select(0)}finally{}}this.createMenuButtons&&(this._menuButtons??(this._menuButtons=[]),this._menuButtons.push(this.context.menu.appendChild({label:"Previous",icon:"arrow_back_ios",onClick:()=>this.selectPrev(),priority:-1005,class:"row2"})),this._menuButtons.push(this.context.menu.appendChild({label:"Next",icon:"arrow_forward_ios",iconSide:"right",onClick:()=>this.selectNext(),priority:-1e3,class:"row2"})))}onDisable(){var e;if(globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(pn.KeyDown,this.onInputKeyDown),this.context.input.removeEventListener(pn.PointerMove,this.onInputPointerMove),this.context.input.removeEventListener(pn.PointerUp,this.onInputPointerUp),(e=this._preloadScheduler)==null||e.stop(),this._menuButtons){for(const i of this._menuButtons)i.remove();this._menuButtons=void 0}}addScene(e){if(typeof e=="string"){let i=this.context.addressables.findAssetReference(e);return i||(i=new $t(e),this.context.addressables.registerAssetReference(i)),this.scenes.push(i),i}return this.scenes.push(e),e}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(e){var i,r,s;if(Do&&console.log("select",e),typeof e=="object"&&console.warn('Switching to "'+e+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof e=="string"){const a=(i=this.scenes)==null?void 0:i.find(l=>l.uri===e);if(!a){const l=$t.getOrCreate(this.sourceId??"",e,this.context);return this.switchScene(l)}if(a)e=(r=this.scenes)==null?void 0:r.indexOf(a);else return $d}if(!((s=this.scenes)!=null&&s.length))return $d;if(e<0){if(this.clamp)return $d;e=this.scenes.length-1}else if(e>=this.scenes.length){if(this.clamp)return $d;e=0}const o=this.scenes[e];return this.switchScene(o)}async switchScene(e){if(!(e instanceof $t)){const i=typeof e;return i==="string"?this.select(e):i==="number"?this.select(e):(console.warn("SceneSwitcher: Can't switch to scene",e,"of type",i),!1)}return e.uri===this.sourceId?(console.warn("SceneSwitcher: can't load own scene - prevent recursive loading",this.sourceId),!1):this.__lastSwitchScene===e&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=e,this.__lastSwitchScenePromise=this.__internalSwitchScene(e),await this.__lastSwitchScenePromise)}async __internalSwitchScene(e){var i,r,s;if(this._currentScene){Do&&console.log("UNLOAD",this._currentScene.url,"HasURL?: "+this._currentScene.hasUrl);const a=this.tryGetSceneEventListener(this._currentScene.asset);if(a!=null&&a.sceneClosing){const l=a.sceneClosing();l instanceof Promise&&await l}this._currentScene.hasUrl?this._currentScene.unload():this._currentScene.asset instanceof ve&&this._currentScene.asset.removeFromParent()}this._currentScene=void 0;const o=this._currentIndex=((i=this.scenes)==null?void 0:i.indexOf(e))??-1;try{this._currentlyLoadingScene=e,this._currentLoadingProgress=new ProgressEvent("progress",{loaded:0,total:1});const a=new CustomEvent("loadscene-start",{detail:{scene:e,switcher:this,index:o}});this.dispatchEvent(a),await this.onStartLoading(),await e.loadAssetAsync((c,h)=>{this._currentLoadingProgress=h,this.dispatchEvent(h)}).catch(console.error),await this.onEndLoading();const l=new CustomEvent("loadscene-finished",{detail:{scene:e,switcher:this,index:o}});if(this.dispatchEvent(l),this._currentLoadingProgress=void 0,this._currentlyLoadingScene=void 0,l.defaultPrevented)return Do&&console.warn("Adding loaded scene prevented:",e,l),!1;if(!e.asset)return Do&&console.warn("Failed loading scene:",e),!1;if(this._currentIndex===o){if(Do&&console.log("ADD",e.uri),this._currentScene=e,swe){const u=((r=this.context.mainCameraComponent)==null?void 0:r.gameObject)||this.context.mainCamera;u?.removeFromParent();const d=this.gameObject.removeFromParent();$o(this.context.scene,!0,!0),this.context.scene=new Er,this.context.scene.add(d),u&&this.context.scene.add(u)}if(ie.add(e.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(e),this.useSceneBackground){const u=this.context.lightmaps.tryGetSkybox(e.url);u?(u.mapping=qs,this.context.scene.background=u):Do&&console.warn("SceneSwitcher: Can't find skybox for scene "+e.url)}if(this.useHistory&&o>=0){let u=o.toString();if(this.useSceneName&&(u=w7(e.uri)),(s=this.queryParameterName)!=null&&s.length)n1(this.queryParameterName,u,this.useHistory);else{const d=history.state,f=this.guid+"::"+o;d!==f&&history.pushState(f,"unused",location.href)}}const c=this.tryGetSceneEventListener(e.asset);if(c!=null&&c.sceneOpened){const u=c.sceneOpened(this);u instanceof Promise&&await u}const h=new CustomEvent("scene-opened",{detail:{scene:e,switcher:this,index:o}});return this.dispatchEvent(h),!0}}catch(a){console.error(a)}return!1}preload(e){if(e>=0&&e<this.scenes.length){const i=this.scenes[e];if(i instanceof $t)return i.preload()}return $d}tryLoadFromQueryParam(){var e;if(!((e=this.queryParameterName)!=null&&e.length))return $d;const i=te(this.queryParameterName);return typeof i=="boolean"?$d:this.trySelectSceneFromValue(i)}trySelectSceneFromValue(e){if(typeof e=="string"){const i=parseInt(e);if(i>=0&&i<this.scenes.length)return this.select(i);{const r=e.toLowerCase();for(let s=0;s<this.scenes.length;s++){const o=this.scenes[s];if(o&&w7(o.uri).toLowerCase().includes(r))return this.select(s)}}}else if(typeof e=="number"&&e>=0&&e<this.scenes.length)return this.select(e);return eo()&&console.warn('Can not find scene: "'+e+'"',this),$d}async onStartLoading(){var e,i;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(e=this.loadingScene)==null?void 0:e.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&(i=this.loadingScene)!=null&&i.asset)){Do&&console.log("Add loading scene",this.loadingScene.uri,this.loadingScene.asset);const r=this.loadingScene.asset;ie.add(r,this.gameObject);const s=this.tryGetSceneEventListener(r);if(s!=null&&s.sceneOpened){const o=s.sceneOpened(this);o instanceof Promise&&await o}}if(this._isCurrentlyLoading){const r=this.tryGetSceneEventListener(this.gameObject);if(r&&r.sceneOpened){const s=r.sceneOpened(this);s instanceof Promise&&await s}}}async onEndLoading(){var e;if(this._isCurrentlyLoading=!1,(e=this.loadingScene)!=null&&e.asset){Do&&console.log("Remove loading scene",this.loadingScene.uri);const i=this.loadingScene.asset,r=this.tryGetSceneEventListener(i);if(typeof r?.sceneClosing=="function"){const s=r.sceneClosing();s instanceof Promise&&await s}ie.remove(i)}if(!this._isCurrentlyLoading){const i=this.tryGetSceneEventListener(this.gameObject);if(i&&i.sceneClosing){const r=i.sceneClosing();r instanceof Promise&&await r}}}tryGetSceneEventListener(e,i=0){const r=ie.foreachComponent(e,s=>s.sceneClosing?s:void 0);if(i===0&&!r&&e.children.length)for(const s of e.children){const o=this.tryGetSceneEventListener(s,i+1);if(o)return o}return r||null}}mo([C()],Gr.prototype,"autoLoadFirstScene",2),mo([C($t)],Gr.prototype,"scenes",2),mo([C($t)],Gr.prototype,"loadingScene",2),mo([C()],Gr.prototype,"queryParameterName",2),mo([C()],Gr.prototype,"useSceneName",2),mo([C()],Gr.prototype,"clamp",2),mo([C()],Gr.prototype,"useHistory",2),mo([C()],Gr.prototype,"useKeyboard",2),mo([C()],Gr.prototype,"useSwipe",2),mo([C()],Gr.prototype,"useSceneLighting",2),mo([C()],Gr.prototype,"useSceneBackground",2),mo([C()],Gr.prototype,"preloadNext",2),mo([C()],Gr.prototype,"preloadPrevious",2),mo([C()],Gr.prototype,"preloadConcurrent",2),mo([C()],Gr.prototype,"createMenuButtons",2);function w7(n){const e=n.split("/").pop(),i=e?.split(".").shift();return i!=null&&i.length?i:n}class owe{constructor(e,i=1,r=1,s=2){p(this,"maxLoadAhead"),p(this,"maxLoadBehind"),p(this,"maxConcurrent"),p(this,"_isRunning",!1),p(this,"_switcher"),p(this,"_loadTasks",[]),p(this,"_maxConcurrentLoads",1),this._switcher=e,this.maxLoadAhead=i,this.maxLoadBehind=r,this.maxConcurrent=s}begin(){if(this._isRunning)return;Do&&console.log("Preload begin"),this._isRunning=!0;let e=-1,i,r;const s=this._switcher.scenes,o=setInterval(()=>{if(this.allLoaded()&&(Do&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(o);return}if(this.canLoadNewScene()===!1)return;e!==this._switcher.currentIndex&&(e=this._switcher.currentIndex,r=0,i=0);const a=r%2===0;a&&(i+=1),r+=1;const l=a?this.maxLoadAhead:this.maxLoadBehind;if(i>l)return;const c=a?e+i:e-i;if(c<0||c<0||c>=s.length)return;const h=s[c];new awe(c,h,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const e of this._switcher.scenes)if(e?.isLoaded()===!1)return!1}return!0}}class awe{constructor(e,i,r){p(this,"index"),p(this,"asset"),p(this,"tasks"),this.index=e,this.asset=i,this.tasks=r,r.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(Do&&console.log("Preload start: "+this.asset.uri,this.index),await this.asset.preload(),Do&&console.log("Preload finished: "+this.asset.uri,this.index));const e=this.tasks.indexOf(this);e>=0&&this.tasks.splice(e,1)}}function lwe(){return new Promise((n,e)=>{const i=()=>{i!=null&&(document.removeEventListener("pointerdown",i),document.removeEventListener("click",i),document.removeEventListener("dragstart",i),document.removeEventListener("touchstart",i),n())};document.addEventListener("pointerdown",i),document.addEventListener("click",i),document.addEventListener("dragstart",i),document.addEventListener("touchstart",i)})}async function cwe(n){await lwe(),n()}var hwe=Object.defineProperty,uwe=Object.getOwnPropertyDescriptor,da=(n,e,i,r)=>{for(var s=r>1?void 0:r?uwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&hwe(e,i,s),s};const Hr=te("debugvideo");var S7=(n=>(n[n.None=0]="None",n[n.AdjustHeight=1]="AdjustHeight",n[n.AdjustWidth=2]="AdjustWidth",n))(S7||{}),C7=(n=>(n[n.VideoClip=0]="VideoClip",n[n.Url=1]="Url",n))(C7||{}),E7=(n=>(n[n.CameraFarPlane=0]="CameraFarPlane",n[n.CameraNearPlane=1]="CameraNearPlane",n[n.RenderTexture=2]="RenderTexture",n[n.MaterialOverride=3]="MaterialOverride",n))(E7||{});class br extends Be{constructor(){super(),p(this,"playOnAwake",!0),p(this,"aspectMode",0),p(this,"clip",null),p(this,"source",1),p(this,"_url",null),p(this,"renderMode"),p(this,"targetMaterialProperty"),p(this,"targetMaterialRenderer"),p(this,"targetTexture"),p(this,"time",0),p(this,"_playbackSpeed",1),p(this,"_isLooping",!1),p(this,"_muted",!1),p(this,"_audioOutputMode",2),p(this,"playInBackground",!0),p(this,"_crossOrigin","anonymous"),p(this,"_videoElement",null),p(this,"_videoTexture",null),p(this,"_videoMaterial",null),p(this,"_isPlaying",!1),p(this,"wasPlaying",!1),p(this,"visibilityChanged",e=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}}),p(this,"_receivedInput",!1),p(this,"_overlay",null),p(this,"_targetObjects"),p(this,"_updateAspectRoutineId",-1),p(this,"_hls"),p(this,"onHlsAvailable",()=>{var e;Hr&&console.log("HLS: available",this.clip),!(!this.shouldUseM3U||!this.url)&&(this._hls||(this._hls=new Hls),this.videoElement.autoplay=!0,this._hls.loadSource(this.url),this._hls.attachMedia(this.videoElement),(e=this._videoElement)==null||e.play(),Hr&&console.log("HLS: loaded",this.clip))}),cwe(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],te("videoscreenspace")&&window.addEventListener("keydown",e=>{e.key==="f"&&(this.screenspace=!this.screenspace)})}get url(){return this._url}set url(e){const i=this._url!==e;this.__didAwake?i&&this.setClipURL(e??""):this._url=e}get playbackSpeed(){var e;return((e=this._videoElement)==null?void 0:e.playbackRate)??this._playbackSpeed}set playbackSpeed(e){this._playbackSpeed=e,this._videoElement&&(this._videoElement.playbackRate=e)}get isLooping(){var e;return((e=this._videoElement)==null?void 0:e.loop)??this._isLooping}set isLooping(e){this._isLooping=e,this._videoElement&&(this._videoElement.loop=e)}get currentTime(){var e;return((e=this._videoElement)==null?void 0:e.currentTime)??this.time}set currentTime(e){this._videoElement?this._videoElement.currentTime=e:this.time=e}get isPlaying(){const e=this._videoElement;return!!(e&&(e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>e.HAVE_CURRENT_DATA||e.srcObject&&e.srcObject.active))}get crossOrigin(){var e;return((e=this._videoElement)==null?void 0:e.crossOrigin)??this._crossOrigin}set crossOrigin(e){this._crossOrigin=e,this._videoElement&&(e!==null?this._videoElement.setAttribute("crossorigin",e):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return!this._videoMaterial&&!this.create(!1)?null:this._videoMaterial}get videoTexture(){return!this._videoTexture&&!this.create(!1)?null:this._videoTexture}get videoElement(){return!this._videoElement&&!this.create(!1)?null:this._videoElement}requestPictureInPicture(){return this._videoElement?this._videoElement.requestPictureInPicture():null}get muted(){var e;return((e=this._videoElement)==null?void 0:e.muted)??this._muted}set muted(e){this._muted=e,this._videoElement&&(this._videoElement.muted=e)}get currentVideo(){return this.clip}set audioOutputMode(e){e!==this._audioOutputMode&&(e===1&&it()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=e,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}preloadVideo(){Hr&&console.log("Video Preload: "+this.name,this.clip),this.create(!1)}preload(){this.preloadVideo()}setVideo(e){this.clip=e,this.source=0,this._videoElement?(this._videoElement.srcObject=e,this._isPlaying&&this.play(),this.updateAspect()):this.create(this.playOnAwake)}setClipURL(e){this._url!==e&&(this._url=e,this.source=1,Hr&&console.log("set url",e),this._videoElement?e.endsWith(".m3u8")||e.includes(".m3u")?this.ensureM3UCanBePlayed():(this._videoElement.src=e,this._isPlaying&&(this.stop(),this.play())):this.create(this.playOnAwake))}onEnable(){var e,i;Hr&&console.log("VideoPlayer.onEnable",C7[this.source],this.clip,this.url,this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0?this.create(!0):this.preloadVideo(),this.screenspace?(e=this._overlay)==null||e.start():(i=this._overlay)==null||i.stop()}onDisable(){var e;window.removeEventListener("visibilitychange",this.visibilityChanged),(e=this._overlay)==null||e.stop(),this.pause()}onDestroy(){var e;this._videoElement&&((e=this.videoElement)==null||e.remove(),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var e,i;if(this._videoElement||this.create(!1),!this._videoElement){Hr&&console.warn("Can not play: no video element found",this);return}if(!(this._isPlaying&&!((e=this._videoElement)!=null&&e.ended)&&!((i=this._videoElement)!=null&&i.paused))){if(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.handleBeginPlaying(!1),this.shouldUseM3U){this.ensureM3UCanBePlayed();return}Hr&&console.log("Video Play()",this.clip,this._videoElement,this.time),this._videoElement.currentTime=this.time,this._videoElement.play().catch(r=>{var s;console.log(r),Hr&&console.error("Error playing video",r,"CODE="+r.code,(s=this.videoElement)==null?void 0:s.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),Hr&&console.log("play",this._videoElement,this.time)}}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),Hr&&console.log("STOP",this))}pause(){var e,i;this.time=((e=this._videoElement)==null?void 0:e.currentTime)??0,this._isPlaying=!1,(i=this._videoElement)==null||i.pause(),Hr&&console.log("PAUSE",this,this.currentTime)}create(e){let i;switch(this.source){case 0:i=this.clip;break;case 1:i=this.url,!(i!=null&&i.length)&&typeof this.clip=="string"&&(i=this.clip);break}return i?(this._videoElement||(Hr&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),this.context.domElement.shadowRoot.prepend(this._videoElement),this.updateVideoElementStyles()),typeof i=="string"?(Hr&&console.log("Set Video src",i),this._videoElement.src=i):(Hr&&console.log("Set Video srcObject",i),this._videoElement.srcObject=i),this._videoTexture||(this._videoTexture=new JN(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=gt,e&&this.handleBeginPlaying(e),Hr&&console.log("Video: handle playing done...",i,e),!0):(Hr&&console.warn("No video source set",this),!1)}updateAspect(){this.aspectMode!==0&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var e;return((e=this._overlay)==null?void 0:e.enabled)??!1}set screenspace(e){var i;if(e){if(!this._videoTexture)return;this._overlay||(this._overlay=new dwe(this.context)),this._overlay.add(this._videoTexture)}else(i=this._overlay)==null||i.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=e)}createVideoElement(){const e=document.createElement("video");return this._crossOrigin&&e.setAttribute("crossorigin",this._crossOrigin),Hr&&console.log("created video element",e),e}handleBeginPlaying(e){var i,r;if(!this.activeAndEnabled||!this._videoElement)return;this._targetObjects.length=0;let s=this.gameObject;switch(this.renderMode){case 3:s=(i=this.targetMaterialRenderer)==null?void 0:i.gameObject,s||(s=(r=ie.getComponent(this.gameObject,Bn))==null?void 0:r.gameObject);break;case 2:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!s){console.error("Missing target for video material renderer",this.name,E7[this.renderMode],this);return}const o=s.material;if(o){this._targetObjects.push(s),o!==this._videoMaterial&&(this._videoMaterial=o.clone(),s.material=this._videoMaterial);const a="map",l=this._videoMaterial;if(!this.targetMaterialProperty)l[a]=this._videoTexture;else switch(this.targetMaterialProperty){default:l[a]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),e&&(this.shouldUseM3U&&this.ensureM3UCanBePlayed(),this.play())}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let e=!this._receivedInput||this.audioOutputMode===0;!e&&this._muted&&(e=!0),this._videoElement.muted=e,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const e=++this._updateAspectRoutineId,i=void 0,r=this.clip;for(;e===this._updateAspectRoutineId&&this.aspectMode!==0&&this.clip&&r===this.clip&&this._isPlaying;){if(!r||typeof r=="string")return;let s;for(const o of r.getVideoTracks()){const a=o.getSettings();if(a&&a.width&&a.height){s=a.width/a.height;break}else s=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(s===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(i===s){yield;continue}for(const o of this._targetObjects){let a=1;if(o.parent){const l=Qi(o.parent);a=l.x/l.y}switch(this.aspectMode){case 1:o.scale.y=1/s*o.scale.x*a;break;case 2:o.scale.x=s*o.scale.y*a;break}}for(let o=0;o<3;o++)yield}}get shouldUseM3U(){return this.url!=null&&(this.url.endsWith(".m3u8")||this.url.endsWith(".m3u"))&&this.source===1}ensureM3UCanBePlayed(){if(!this.shouldUseM3U)return;let e=document.head.querySelector("script[data-hls_library]");e?globalThis.Hls?this.onHlsAvailable():e.addEventListener("load",this.onHlsAvailable):(Hr&&console.log("HLS: load script"),e=document.createElement("script"),e.dataset.hls_library="hls.js",e.src="https://cdn.jsdelivr.net/npm/hls.js@1",e.addEventListener("load",this.onHlsAvailable),document.head.append(e))}}da([C()],br.prototype,"playOnAwake",2),da([C()],br.prototype,"aspectMode",2),da([C(URL)],br.prototype,"clip",2),da([C()],br.prototype,"source",2),da([C(URL)],br.prototype,"url",1),da([C()],br.prototype,"renderMode",2),da([C()],br.prototype,"targetMaterialProperty",2),da([C(Bn)],br.prototype,"targetMaterialRenderer",2),da([C(Gt)],br.prototype,"targetTexture",2),da([C()],br.prototype,"time",2),da([C()],br.prototype,"playbackSpeed",1),da([C()],br.prototype,"isLooping",1),da([C()],br.prototype,"audioOutputMode",1);class dwe{constructor(e){p(this,"context"),p(this,"_videos",[]),p(this,"_screenspaceModeQuad"),p(this,"_isInScreenspaceMode",!1),p(this,"_input"),this.context=e,this._input=new pwe(this)}get enabled(){return this._isInScreenspaceMode}set enabled(e){e?this.start():this.stop()}add(e){this._videos.indexOf(e)===-1&&this._videos.push(e)}remove(e){if(!e)return;const i=this._videos.indexOf(e);i>=0&&this._videos.splice(i,1)}start(){var e;if(this._isInScreenspaceMode||this._videos.length<0)return;const i=this._videos[this._videos.length-1];if(!i)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=n0.createPrimitive(yf.Quad,{material:new fwe(i)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const r=this._screenspaceModeQuad;this.context.scene.add(r),this.updateScreenspaceMaterialUniforms();const s=r.material;s?.reset(),(e=this._input)==null||e.enable(s)}stop(){var e;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((e=this._input)==null||e.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var e;const i=(e=this._screenspaceModeQuad)==null?void 0:e.material;i&&(i.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class pwe{constructor(e){p(this,"_onResizeScreenFn"),p(this,"_onKeyUpFn"),p(this,"_onMouseWheelFn"),p(this,"context"),p(this,"overlay"),p(this,"_material"),p(this,"_isPinching",!1),p(this,"_lastPinch",0),this.overlay=e,this.context=e.context}enable(e){this._material=e,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=s=>{s.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=s=>{this.overlay.enabled&&(e.zoom+=s.deltaY*5e-4,s.preventDefault())},{passive:!1});const i=new J;window.addEventListener("mousemove",s=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const o=new J(s.movementX,s.movementY);o.x/=this.context.domElement.clientWidth,o.y/=this.context.domElement.clientHeight,i.set(o.x,o.y),i.multiplyScalar(e.zoom/-this.context.time.deltaTime*.01),e.offset=e.offset.add(i)}}),window.addEventListener("pointermove",s=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(i.set(s.movementX,s.movementY),i.multiplyScalar(e.zoom*-this.context.time.deltaTime*.05),e.offset=e.offset.add(i))});let r=0;window.addEventListener("touchstart",s=>{if(s.touches.length<2){this.context.time.time-r<.3&&this.overlay.stop(),r=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",s=>{if(!this._isPinching||!this._material)return;const o=s.touches[0],a=s.touches[1],l=o.clientX-a.clientX,c=o.clientY-a.clientY,h=Math.sqrt(l*l+c*c);if(this._lastPinch!==0){const u=h-this._lastPinch;this._material.zoom-=u*.004}this._lastPinch=h}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class fwe extends Bt{constructor(e){super(),p(this,"_offset",new J),this.uniforms={map:{value:e},screenAspect:{value:1},offsetScale:{value:new qe(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(e){this.uniforms.screenAspect.value=e,this.needsUpdate=!0}set offset(e){const i=this.uniforms.offsetScale.value;i.x=e.x,i.y=e.y,this.uniforms.offsetScale.value=i,this.needsUpdate=!0}get offset(){const e=this.uniforms.offsetScale.value;return this._offset.set(e.x,e.y),this._offset}set zoom(e){const i=this.uniforms.offsetScale.value;e<.001&&(e=.001),i.z=e,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var mwe=Object.defineProperty,gwe=Object.getOwnPropertyDescriptor,Rx=(n,e,i,r)=>{for(var s=r>1?void 0:r?gwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&mwe(e,i,s),s};const gs=te("debugscreensharing");var M7=(n=>(n[n.Screen=0]="Screen",n[n.Camera=1]="Camera",n[n.Canvas=2]="Canvas",n[n.Microphone=3]="Microphone",n))(M7||{});class ep extends Be{constructor(){super(...arguments),p(this,"allowStartOnClick",!0),p(this,"autoConnect",!1),p(this,"_videoPlayer"),p(this,"_audioSource"),p(this,"device","Screen"),p(this,"deviceName"),p(this,"deviceFilter"),p(this,"_net"),p(this,"_requestOpen",!1),p(this,"_currentStream",null),p(this,"_currentMode",0),p(this,"onJoinedRoom",async()=>{await $l(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()}),p(this,"_activeShareRequest",null),p(this,"onReceiveStream",e=>{var i;((i=e.stream)==null?void 0:i.active)===!0&&this.setStream(e.stream,2)}),p(this,"onCallEnded",e=>{gs&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(e){var i;if(this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&!(e&&e.pointerId!==0)){if(this.isReceiving&&(i=this.videoPlayer)!=null&&i.isPlaying){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(e){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=e,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var e;return((e=this.videoPlayer)==null?void 0:e.screenspace)??!1}set screenspace(e){this.videoPlayer&&(this.videoPlayer.screenspace=e)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var e;return((e=this._currentStream)==null?void 0:e.active)&&this._currentMode===1}get isReceiving(){if(this._currentMode===2){if(!this._currentStream||this._currentStream.active===!1)return!1;const e=this._currentStream.getTracks();for(const i of e)if(i.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!=="Microphone"}awake(){typeof this.device=="number"&&(this.device=M7[this.device]),gs&&console.log("Screensharing",this.name,this),Pn.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===2&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))});const e=pE.getOrCreate(this.context,this.guid);this._net=new d_(this.context,e)}onEnable(){var e,i,r;(e=this._net)==null||e.enable(),(i=this._net)==null||i.addEventListener(Cc.StreamReceived,this.onReceiveStream),(r=this._net)==null||r.addEventListener(Cc.StreamEnded,this.onCallEnded),this.context.connection.beginListen(jt.JoinedRoom,this.onJoinedRoom),this.autoConnect&&$l(1e3).then(()=>(this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share(),0))}onDisable(){var e,i,r;(e=this._net)==null||e.removeEventListener(Cc.StreamReceived,this.onReceiveStream),(i=this._net)==null||i.removeEventListener(Cc.StreamEnded,this.onCallEnded),this.context.connection.stopListen(jt.JoinedRoom,this.onJoinedRoom),(r=this._net)==null||r.disable(),this.close()}_ensureVideoPlayer(){const e=new br;e.aspectMode=S7.AdjustWidth,ie.addComponent(this.gameObject,e),this._videoPlayer=e}async share(e){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(e),this._activeShareRequest.then(()=>this._activeShareRequest=null))}async internalShare(e){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection"),it()&&Pi("Can not start screensharing: requires network connection. Add a SyncedRoom component or join a room first.");return}if(e!=null&&e.device&&(this.device=e.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=ie.getComponent(this.gameObject,br)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const i=e?.constraints??{echoCancellation:!0,autoGainControl:!1},r={video:i,audio:i},s=r.video;switch(s!==void 0&&typeof s!="boolean"&&(s.width||(s.width={max:1920}),s.height||(s.height={max:1920}),s.aspectRatio||(s.aspectRatio={ideal:1.7777777778}),s.frameRate||(s.frameRate={ideal:24}),s.facingMode||(s.facingMode={ideal:"user"})),this.device){case"Camera":this.tryShareUserCamera(r,e);break;case"Screen":{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const l=await navigator.mediaDevices.getDisplayMedia(r);this._requestOpen?this.setStream(l,1):Ec(l)}break;case"Canvas":const o=0,a=this.context.renderer.domElement.captureStream(o);this.setStream(a,1);break;case"Microphone":{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}r.video=!1;const l=await navigator.mediaDevices.getUserMedia(r);this._requestOpen?this.setStream(l,1):Ec(l)}break;default:console.error("Can not start screen sharing: Unknown device type",this.device)}}catch(i){if(i.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",i)}}close(){var e;this._requestOpen=!1,this._currentStream&&(gs&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(e=this._net)==null||e.stopSendingStream(this._currentStream),Ec(this._currentStream),this._currentMode=0,this._currentStream=null)}setStream(e,i){var r,s,o;if(e===this._currentStream||(this.close(),!e))return;this._currentStream=e,this._requestOpen=!0,this._currentMode=i;const a=this.device!=="Microphone",l=i===1;a?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(e):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new Pn,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),l||(gs&&console.log("PLAY",e.getAudioTracks()),this._audioSource.volume=1,(r=this._audioSource)==null||r.play(e))),l&&((s=this._net)==null||s.startSendingStream(e)),l&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(o=this._audioSource)==null||o.stop());for(const c of e.getTracks())c.addEventListener("ended",()=>{gs&&console.log("Track ended",c),this.close()}),gs&&c.kind==="video"&&console.log(l?"Video \u2192":"Video \u2190",c.getSettings())}async tryShareUserCamera(e,i){const r=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");gs&&console.log(`Request camera. These are your kind:videoinput devices:
`,r);let s=!1;for(const o of r)try{if(!this._requestOpen){gs&&console.log("Camera selection cancelled");break}if(o.kind!=="videoinput"){gs&&console.log("Skipping non-video device",o);continue}const a=o.deviceId;if(i?.deviceId!=null||i?.deviceFilter!=null){if(i?.deviceId!==void 0&&a!==i.deviceId){gs&&console.log("Skipping device due to options.deviceId: "+o.label+"; "+o.deviceId);continue}if(i!=null&&i.deviceFilter&&i.deviceFilter(o)===!1){gs&&console.log("Skipping device due to options.deviceFilter: "+o.label+"; "+o.deviceId);continue}}else if(this.deviceFilter)if(this.deviceFilter(o)===!1){gs&&console.log("Skipping device due to ScreenShare.deviceFilter: "+o.label+"; "+o.deviceId);continue}else gs&&console.log("Selected device by filter",o);else if(this.deviceName){const c=o.label.toLowerCase(),h=this.deviceName.toLowerCase(),u=c.includes(h),d=o.deviceId===this.deviceName;if(!u&&!d){gs&&console.log("Skipping device due to ScreenShare.deviceName: "+o.label+"; "+o.deviceId);continue}else gs&&console.log("Selected device by name",o)}e.video!==!1&&((typeof e.video>"u"||typeof e.video=="boolean")&&(e.video={}),e.video.deviceId=a),s=!0;const l=await navigator.mediaDevices.getUserMedia(e).catch(c=>(console.error("Failed to get user media",c),null));if(l===null)continue;this._requestOpen?(this.setStream(l,1),gs&&console.log("Selected camera",o)):(Ec(l),gs&&console.log("Camera selection cancelled"));break}catch(a){if(a.message==="Failed to allocate videosource"||a.message==="Could not start video source"){Pi("Failed to start video: Try another camera (Code "+a.code+")"),console.warn(a);continue}else console.error("Failed to get user media",a.message,a.code,a)}!s&&it()&&(Pi("No camera found for sharing. Please connect a camera (see console for more information)"),console.warn("No camera found for sharing. Please connect a camera",r,this.deviceName,"Using deviceFilter? "+this.deviceFilter!=null,"Using options? "+i!=null,"Using deviceName? "+this.deviceName!=null,"Using options.deviceId? "+i?.deviceId!=null,"Using options.deviceFilter? "+i?.deviceFilter!=null))}}Rx([C()],ep.prototype,"allowStartOnClick",2),Rx([C()],ep.prototype,"autoConnect",2),Rx([C(br)],ep.prototype,"videoPlayer",1),Rx([C()],ep.prototype,"device",2),Rx([C()],ep.prototype,"deviceName",2);var vwe=Object.defineProperty,ywe=Object.getOwnPropertyDescriptor,Px=(n,e,i,r)=>{for(var s=r>1?void 0:r?ywe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&vwe(e,i,s),s};class iu extends ss{constructor(){super(...arguments),p(this,"intensity",new Ke(2)),p(this,"falloff",new Ke(1)),p(this,"samples",new Ke(9)),p(this,"color",new Ke(new be(0,0,0))),p(this,"luminanceInfluence",new Ke(.7)),p(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof Ft){const e=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=e*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const e=this.context.mainCamera,i=new u5(this.context.scene,e),r=new wP({normalBuffer:i.texture,resolutionScale:.5}),s=this._ssao=new o5(e,i.texture,{normalDepthBuffer:r.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:Vt.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=a=>{s.intensity=a},this.falloff.onValueChanged=a=>{s.ssaoMaterial.radius=a*.1},this.samples.onValueChanged=a=>{s.samples=a},this.color.onValueChanged=a=>{s.color||(s.color=new be),s.color.copy(a)},this.luminanceInfluence.onValueChanged=a=>{s.luminanceInfluence=a};const o=new Array;return o.push(i),o.push(r),o.push(s),o}}Px([C(Ke)],iu.prototype,"intensity",2),Px([C(Ke)],iu.prototype,"falloff",2),Px([C(Ke)],iu.prototype,"samples",2),Px([C(Ke)],iu.prototype,"color",2),Px([C(Ke)],iu.prototype,"luminanceInfluence",2),Qa("ScreenSpaceAmbientOcclusion",iu);var Awe=Object.defineProperty,bwe=Object.getOwnPropertyDescriptor,hm=(n,e,i,r)=>{for(var s=r>1?void 0:r?bwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Awe(e,i,s),s},h3=(n=>(n[n.Performance=0]="Performance",n[n.Low=1]="Low",n[n.Medium=2]="Medium",n[n.High=3]="High",n[n.Ultra=4]="Ultra",n))(h3||{});class Fl extends ss{constructor(){super(...arguments),p(this,"gammaCorrection",!0),p(this,"aoRadius",new Ke(1)),p(this,"falloff",new Ke(1)),p(this,"intensity",new Ke(1)),p(this,"color",new Ke(new be(0,0,0))),p(this,"screenspaceRadius",!1),p(this,"quality",2),p(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode(h3[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const e=this.context.mainCamera,i=this._ssao=new v7(this.context.scene,e,this.context.domWidth,this.context.domHeight),r=h3[this.quality];i.setQualityMode(r),i.configuration.gammaCorrection=this.gammaCorrection,i.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=o=>{i.configuration.intensity=o},this.falloff.onValueChanged=o=>{i.configuration.distanceFalloff=o},this.aoRadius.onValueChanged=o=>{i.configuration.aoRadius=o},this.color.onValueChanged=o=>{i.color||(i.color=new be),i.configuration.color.copy(o)};const s=new Array;return s.push(i),s}}hm([ns(),C()],Fl.prototype,"gammaCorrection",2),hm([C(Ke)],Fl.prototype,"aoRadius",2),hm([C(Ke)],Fl.prototype,"falloff",2),hm([C(Ke)],Fl.prototype,"intensity",2),hm([C(Ke)],Fl.prototype,"color",2),hm([ns(),C()],Fl.prototype,"screenspaceRadius",2),hm([ns(),C()],Fl.prototype,"quality",2),Qa("ScreenSpaceAmbientOcclusionN8",Fl);var xwe=Object.defineProperty,_we=Object.getOwnPropertyDescriptor,T7=(n,e,i,r)=>{for(var s=r>1?void 0:r?_we(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&xwe(e,i,s),s};class Bx extends Be{constructor(){super(...arguments),p(this,"mode",0),p(this,"shadowColor",new ki(0,0,0,1)),p(this,"targetMesh")}start(){if(this.gameObject instanceof pe)this.gameObject instanceof pe&&this.gameObject.material&&(this.gameObject.material=this.gameObject.material.clone(),this.targetMesh=this.gameObject,this.targetMesh.receiveShadow=!0);else{const e=n0.createPrimitive(yf.Quad,{name:"ShadowCatcher",material:new mr({color:10066329,roughness:1,metalness:0,transparent:!0})});e.receiveShadow=!0,e.geometry.rotateX(-Math.PI/2),this.gameObject.add(e),this.targetMesh=e}if(!this.targetMesh){console.warn("ShadowCatcher: no mesh to apply shadow catching to. Groups are currently not supported.");return}switch(this.targetMesh.layers.set(2),this.mode){case 0:this.applyShadowMaterial();break;case 1:this.applyLightBlendMaterial();break;case 2:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){if(!this.targetMesh)return;const e=this.targetMesh.material;e.blending=mp,this.applyMaterialOptions(e),e.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
            // diffuse-only lighting with overdrive to somewhat compensate
            // for the loss of indirect lighting and to make it more visible.
            vec3 direct = (reflectedLight.directDiffuse + reflectedLight.directSpecular) * 6.6;
            float max = max(direct.r, max(direct.g, direct.b));
            
            // early out - we're simply returning direct lighting and some alpha based on it so it can 
            // be blended onto the scene.
            gl_FragColor = vec4(direct, max);
            return;
            `)}}applyShadowMaterial(){if(this.targetMesh)if(this.targetMesh.material.type!=="ShadowMaterial"){const e=new Fw;e.color=this.shadowColor,e.opacity=this.shadowColor.alpha,this.applyMaterialOptions(e),this.targetMesh.material=e}else{const e=this.targetMesh.material;e.color=this.shadowColor,e.opacity=this.shadowColor.alpha,this.applyMaterialOptions(e)}}applyOccluderMaterial(){if(this.targetMesh){let e=this.targetMesh.material;if(!e){const i=new Jt;this.targetMesh.material=i,e=i}e.depthWrite=!0,e.stencilWrite=!0,e.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(e){e&&(e.depthWrite=!1,e.stencilWrite=!1)}}T7([C()],Bx.prototype,"mode",2),T7([C(ki)],Bx.prototype,"shadowColor",2);var wwe=Object.defineProperty,Swe=Object.getOwnPropertyDescriptor,EM=(n,e,i,r)=>{for(var s=r>1?void 0:r?Swe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&wwe(e,i,s),s},u3;const I7=(u3=class extends Be{constructor(){super(...arguments),p(this,"target",null),p(this,"followFactor",.1),p(this,"rotateFactor",.1),p(this,"positionAxes",M0.All),p(this,"flipForward",!1),p(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(n){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const e=kt(this.target),i=this._firstUpdate||n?1:tt.clamp01(this.context.time.deltaTime*this.followFactor),r=this.worldPosition;this.positionAxes&M0.X&&(r.x=tt.lerp(r.x,e.x,i)),this.positionAxes&M0.Y&&(r.y=tt.lerp(r.y,e.y,i)),this.positionAxes&M0.Z&&(r.z=tt.lerp(r.z,e.z,i)),this.worldPosition=r}if(this.rotateFactor>0){const e=Ri(this.target);this.flipForward&&e.premultiply(I7._invertForward);const i=this._firstUpdate||n?1:tt.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(e,i)}this._firstUpdate=!1}}},p(u3,"_invertForward",new Ce().setFromAxisAngle(new S(0,1,0),Math.PI)),u3);let tp=I7;EM([C(ve)],tp.prototype,"target",2),EM([C()],tp.prototype,"followFactor",2),EM([C()],tp.prototype,"rotateFactor",2),EM([C()],tp.prototype,"positionAxes",2);class Cwe extends pe{constructor(e){const i=new Ewe(e),r=new cr(i.image.width*.001,i.image.height*.001),s=new Jt({map:i,toneMapped:!1,transparent:!0});super(r,s);function o(a){s.map.dispatchDOMEvent(a)}this.addEventListener("mousedown",o),this.addEventListener("mousemove",o),this.addEventListener("mouseup",o),this.addEventListener("click",o),this.dispose=function(){r.dispose(),s.dispose(),s.map.dispose(),d3.delete(e),this.removeEventListener("mousedown",o),this.removeEventListener("mousemove",o),this.removeEventListener("mouseup",o),this.removeEventListener("click",o)}}}class Ewe extends ER{constructor(e){super(R7(e)),this.dom=e,this.anisotropy=16,this.colorSpace=gt,this.minFilter=Dt,this.magFilter=Dt;const i=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),r={attributes:!0,childList:!0,subtree:!0,characterData:!0};i.observe(e,r),this.observer=i}dispatchDOMEvent(e){e.data&&Mwe(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=R7(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const d3=new WeakMap;function R7(n){const e=document.createRange(),i=new be;function r(f){const m=[];let g=!1;function v(){if(g&&(g=!1,f.restore()),m.length===0)return;let y=-1/0,A=-1/0,b=1/0,x=1/0;for(let _=0;_<m.length;_++){const w=m[_];y=Math.max(y,w.x),A=Math.max(A,w.y),b=Math.min(b,w.x+w.width),x=Math.min(x,w.y+w.height)}f.save(),f.beginPath(),f.rect(y,A,b-y,x-A),f.clip(),g=!0}return{add:function(y){m.push(y),v()},remove:function(){m.pop(),v()}}}function s(f,m,g,v){v!==""&&(f.textTransform==="uppercase"&&(v=v.toUpperCase()),u.font=f.fontWeight+" "+f.fontSize+" "+f.fontFamily,u.textBaseline="top",u.fillStyle=f.color,u.fillText(v,m,g+parseFloat(f.fontSize)*.1))}function o(f,m,g,v,y){g<2*y&&(y=g/2),v<2*y&&(y=v/2),u.beginPath(),u.moveTo(f+y,m),u.arcTo(f+g,m,f+g,m+v,y),u.arcTo(f+g,m+v,f,m+v,y),u.arcTo(f,m+v,f,m,y),u.arcTo(f,m,f+g,m,y),u.closePath()}function a(f,m,g,v,y,A){const b=f[m+"Width"],x=f[m+"Style"],_=f[m+"Color"];b!=="0px"&&x!=="none"&&_!=="transparent"&&_!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=_,u.lineWidth=parseFloat(b),u.beginPath(),u.moveTo(g,v),u.lineTo(g+y,v+A),u.stroke())}function l(f,m){let g=0,v=0,y=0,A=0;if(f.nodeType===Node.TEXT_NODE){e.selectNode(f);const x=e.getBoundingClientRect();g=x.left-c.left-.5,v=x.top-c.top-.5,y=x.width,A=x.height,s(m,g,v,f.nodeValue.trim())}else{if(f.nodeType===Node.COMMENT_NODE)return;if(f instanceof HTMLCanvasElement){if(f.style.display==="none")return;const x=f.getBoundingClientRect();g=x.left-c.left-.5,v=x.top-c.top-.5,u.save();const _=window.devicePixelRatio;u.scale(1/_,1/_),u.drawImage(f,g,v),u.restore()}else if(f instanceof HTMLImageElement){if(f.style.display==="none")return;const x=f.getBoundingClientRect();g=x.left-c.left-.5,v=x.top-c.top-.5,y=x.width,A=x.height,u.drawImage(f,g,v,y,A)}else{if(f.style.display==="none")return;const x=f.getBoundingClientRect();g=x.left-c.left-.5,v=x.top-c.top-.5,y=x.width,A=x.height,m=window.getComputedStyle(f),o(g,v,y,A,parseFloat(m.borderRadius));const _=m.backgroundColor;_!=="transparent"&&_!=="rgba(0, 0, 0, 0)"&&(u.fillStyle=_,u.fill());const w=["borderTop","borderLeft","borderBottom","borderRight"];let T=!0,M=null;for(const R of w){if(M!==null&&(T=m[R+"Width"]===m[M+"Width"]&&m[R+"Color"]===m[M+"Color"]&&m[R+"Style"]===m[M+"Style"]),T===!1)break;M=R}if(T===!0){const R=parseFloat(m.borderTopWidth);m.borderTopWidth!=="0px"&&m.borderTopStyle!=="none"&&m.borderTopColor!=="transparent"&&m.borderTopColor!=="rgba(0, 0, 0, 0)"&&(u.strokeStyle=m.borderTopColor,u.lineWidth=R,u.stroke())}else a(m,"borderTop",g,v,y,0),a(m,"borderLeft",g,v,0,A),a(m,"borderBottom",g,v+A,y,0),a(m,"borderRight",g+y,v,0,A);if(f instanceof HTMLInputElement){let R=m.accentColor;(R===void 0||R==="auto")&&(R=m.color),i.set(R);const B=Math.sqrt(.299*i.r**2+.587*i.g**2+.114*i.b**2)<.5?"white":"#111111";if(f.type==="radio"&&(o(g,v,y,A,A),u.fillStyle="white",u.strokeStyle=R,u.lineWidth=1,u.fill(),u.stroke(),f.checked&&(o(g+2,v+2,y-4,A-4,A),u.fillStyle=R,u.strokeStyle=B,u.lineWidth=2,u.fill(),u.stroke())),f.type==="checkbox"&&(o(g,v,y,A,2),u.fillStyle=f.checked?R:"white",u.strokeStyle=f.checked?B:R,u.lineWidth=1,u.stroke(),u.fill(),f.checked)){const E=u.textAlign;u.textAlign="center";const P={color:B,fontFamily:m.fontFamily,fontSize:A+"px",fontWeight:"bold"};s(P,g+y/2,v,"\u2714"),u.textAlign=E}if(f.type==="range"){const[E,P,O]=["min","max","value"].map(L=>parseFloat(f[L])),N=(O-E)/(P-E)*(y-A);o(g,v+A/4,y,A/2,A/4),u.fillStyle=B,u.strokeStyle=R,u.lineWidth=1,u.fill(),u.stroke(),o(g,v+A/4,N+A/2,A/2,A/4),u.fillStyle=R,u.fill(),o(g+N,v,A,A,A/2),u.fillStyle=R,u.fill()}(f.type==="color"||f.type==="text"||f.type==="number")&&(d.add({x:g,y:v,width:y,height:A}),s(m,g+parseInt(m.paddingLeft),v+parseInt(m.paddingTop),f.value),d.remove())}}}const b=m.overflow==="auto"||m.overflow==="hidden";b&&d.add({x:g,y:v,width:y,height:A});for(let x=0;x<f.childNodes.length;x++)l(f.childNodes[x],m);b&&d.remove()}const c=n.getBoundingClientRect();let h=d3.get(n);h===void 0&&(h=document.createElement("canvas"),h.width=c.width,h.height=c.height,d3.set(n,h));const u=h.getContext("2d"),d=new r(u);return u.clearRect(0,0,h.width,h.height),l(n),h}function Mwe(n,e,i,r){const s={clientX:i*n.offsetWidth+n.offsetLeft,clientY:r*n.offsetHeight+n.offsetTop,view:n.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,s));const o=n.getBoundingClientRect();i=i*o.width+o.left,r=r*o.height+o.top;function a(l){if(l.nodeType!==Node.TEXT_NODE&&l.nodeType!==Node.COMMENT_NODE){const c=l.getBoundingClientRect();if(i>c.left&&i<c.right&&r>c.top&&r<c.bottom&&(l.dispatchEvent(new MouseEvent(e,s)),l instanceof HTMLInputElement&&l.type==="range"&&(e==="mousedown"||e==="click"))){const[h,u]=["min","max"].map(m=>parseFloat(l[m])),d=c.width,f=(i-c.x)/d;l.value=h+(u-h)*f,l.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let h=0;h<l.childNodes.length;h++)a(l.childNodes[h])}}a(n)}const MM=new J,dv={type:"",data:MM},P7=new ku;class Twe extends Cr{listenToPointerEvents(e,i){const r=this,s=new ku,o=e.domElement;function a(l){l.stopPropagation();const c=e.domElement.getBoundingClientRect();MM.x=(l.clientX-c.left)/c.width*2-1,MM.y=-(l.clientY-c.top)/c.height*2+1,s.setFromCamera(MM,i);const h=s.intersectObjects(r.children,!1);if(h.length>0){const u=h[0],d=u.object,f=u.uv;dv.type=l.type,dv.data.set(f.x,1-f.y),d.dispatchEvent(dv)}}o.addEventListener("pointerdown",a),o.addEventListener("pointerup",a),o.addEventListener("pointermove",a),o.addEventListener("mousedown",a),o.addEventListener("mouseup",a),o.addEventListener("mousemove",a),o.addEventListener("click",a)}listenToXRControllerEvents(e){const i=this,r={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function s(o){const a=o.target;P7.setFromXRController(a);const l=P7.intersectObjects(i.children,!1);if(l.length>0){const c=l[0],h=c.object,u=c.uv;dv.type=r[o.type],dv.data.set(u.x,1-u.y),h.dispatchEvent(dv)}}e.addEventListener("move",s),e.addEventListener("select",s),e.addEventListener("selectstart",s),e.addEventListener("selectend",s)}}var Iwe=Object.defineProperty,Rwe=Object.getOwnPropertyDescriptor,B7=(n,e,i,r)=>{for(var s=r>1?void 0:r?Rwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Iwe(e,i,s),s};class kx extends Be{constructor(){super(...arguments),p(this,"id",null),p(this,"keepAspect",!1),p(this,"_object",null)}onEnable(){if(this._object){this.gameObject.add(this._object);return}if(!this.id||!this.context.mainCamera)return;const e=document.getElementById(this.id);if(!e){console.warn('Could not find element with id "'+this.id+'"');return}e.style.display="block",e.style.visibility="hidden";const i=new Twe;i.listenToPointerEvents(this.context.renderer,this.context.mainCamera),this.gameObject.add(i);const r=new Cwe(e);i.add(r),r.visible=!1;const s=r.material;s.transparent=!0,setTimeout(()=>{r.visible=!0;const o=Vy(this.gameObject).clone();Qy(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const a=new Ht;a.setFromObject(i),this.setWorldRotation(o.x,o.y,o.z);const l=a.max.x-a.min.x,c=a.max.y-a.min.y;if(this.keepAspect){const u=l/c;l>c?r.scale.set(1/l,1/c/u,1):r.scale.set(1/l*u,1/c,1)}else r.scale.set(1/l,1/c,1);const h=this.gameObject.scale;r.scale.multiply(h)},1)}onDisable(){var e;(e=this._object)==null||e.removeFromParent()}}B7([C()],kx.prototype,"id",2),B7([C()],kx.prototype,"keepAspect",2);var Pwe=Object.defineProperty,Bwe=Object.getOwnPropertyDescriptor,Ox=(n,e,i,r)=>{for(var s=r>1?void 0:r?Bwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Pwe(e,i,s),s};const Dx=te("debugspatialtrigger"),k7=new Cs,O7=new Cs;function kwe(n,e){return k7.mask=n,O7.mask=e,k7.test(O7)}class Hc extends Be{constructor(){super(...arguments),p(this,"triggerMask",0),p(this,"onEnter"),p(this,"onStay"),p(this,"onExit"),p(this,"currentIntersected",[]),p(this,"lastIntersected",[])}start(){Dx&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const e of Lx.triggers)kwe(e.triggerMask,this.triggerMask)&&e.test(this.gameObject)&&this.currentIntersected.push(e);for(let e=this.lastIntersected.length-1;e>=0;e--){const i=this.lastIntersected[e];this.currentIntersected.indexOf(i)<0&&(this.onExitTrigger(i),this.lastIntersected.splice(e,1))}for(const e of this.currentIntersected)this.lastIntersected.indexOf(e)<0&&this.onEnterTrigger(e),this.onStayTrigger(e);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(e){var i;Dx&&console.log("ENTER TRIGGER",this.name,e.name,this,e),e.raiseOnEnterEvent(this),(i=this.onEnter)==null||i.invoke(this,e)}onExitTrigger(e){var i;Dx&&console.log("EXIT TRIGGER",this.name,e.name,this,e),e.raiseOnExitEvent(this),(i=this.onExit)==null||i.invoke(this,e)}onStayTrigger(e){var i;e.raiseOnStayEvent(this),(i=this.onStay)==null||i.invoke(this,e)}}Ox([C()],Hc.prototype,"triggerMask",2),Ox([C(An)],Hc.prototype,"onEnter",2),Ox([C(An)],Hc.prototype,"onStay",2),Ox([C(An)],Hc.prototype,"onExit",2);var p3;const TM=(p3=class extends Be{constructor(){super(...arguments),p(this,"triggerMask"),p(this,"boxHelper")}start(){Dx&&console.log(this.name,this.triggerMask,this)}onEnable(){var n;TM.triggers.push(this),this.boxHelper||(this.boxHelper=ie.addNewComponent(this.gameObject,Mc),(n=this.boxHelper)==null||n.showHelper(null,Dx))}onDisable(){TM.triggers.splice(TM.triggers.indexOf(this),1)}test(n){return this.boxHelper?this.boxHelper.isInBox(n)??!1:!1}raiseOnEnterEvent(n){ie.foreachComponent(this.gameObject,e=>{e!==n&&e instanceof Hc&&e.onEnterTrigger(this)},!1)}raiseOnStayEvent(n){ie.foreachComponent(this.gameObject,e=>{e!==n&&e instanceof Hc&&e.onStayTrigger(this)},!1)}raiseOnExitEvent(n){ie.foreachComponent(this.gameObject,e=>{e!==n&&e instanceof Hc&&e.onExitTrigger(this)},!1)}},p(p3,"triggers",[]),p3);let Lx=TM;Ox([C()],Lx.prototype,"triggerMask",2);var Owe=Object.defineProperty,Dwe=Object.getOwnPropertyDescriptor,Lwe=(n,e,i,r)=>{for(var s=r>1?void 0:r?Dwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Owe(e,i,s),s};const pa=te("debugspectator");class IM extends Be{constructor(){super(...arguments),p(this,"cam",null),p(this,"useKeys",!0),p(this,"_mode",0),p(this,"orbit",null),p(this,"_handler"),p(this,"eventSub_WebXRRequestStartEvent",null),p(this,"eventSub_WebXRStartEvent",null),p(this,"eventSub_WebXREndEvent",null),p(this,"_debug"),p(this,"_networking")}get mode(){return this._mode}set mode(e){this._mode=e}get isSpectating(){var e;return((e=this._handler)==null?void 0:e.currentTarget)!==void 0}isSpectatingUser(e){var i;return((i=this.target)==null?void 0:i.userId)===e}isFollowedBy(e){var i;return(i=this.followers)==null?void 0:i.includes(e)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(e){var i;if(this._handler){const r=(i=this._handler.currentTarget)==null?void 0:i.userId,s=this.context.players.getPlayerView(this.localId);e===void 0||this.context.isInXR===!1&&s?.currentObject===e.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),ie.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(e,r)):this._handler.currentTarget!==e&&(this._handler.set(e),ie.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(e,r))}}get target(){var e;return(e=this._handler)==null?void 0:e.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var e,i;return this.isSpectating&&((e=this.target)==null?void 0:e.currentObject)===((i=this.context.players.getPlayerView(this.localId))==null?void 0:i.currentObject)}awake(){if(this._debug=new Nwe(this.context,this),this._networking=new Gwe(this.context,this),this._networking.awake(),ie.setActive(this.gameObject,!1),this.cam=ie.getComponent(this.gameObject,Ui),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new Uwe(this.context,this.cam,this)),this.orbit=ie.getComponent(this.context.mainCamera,wi)}onDestroy(){var e,i;this.stopSpectating(),(e=this._handler)==null||e.destroy(),(i=this._networking)==null||i.destroy()}isSupportedPlatform(){const e=window.navigator.userAgent,i=/Windows|MacOS/.test(e),r=/Windows NT/.test(e)&&/Edg/.test(e)&&!/Win64/.test(e);return i&&!r}onBeforeXR(e){this.isSupportedPlatform()&&ie.setActive(this.gameObject,!0)}onEnterXR(e){this.isSupportedPlatform()&&(pa&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onLeaveXR(e){var i,r;this.context.removeCamera(this.cam),ie.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(i=this._handler)==null||i.set(void 0),(r=this._handler)==null||r.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,fd.Headset),this.target=this.context.players.getPlayerView(this.localId)),pa&&console.log("Follow self",this.target)}onAfterRender(){var e,i,r;if(!this.cam)return;const s=this.context.renderer,o=s.xr.enabled;if(!s.xr.isPresenting&&!((e=this._handler)!=null&&e.currentTarget))return;(i=this._handler)==null||i.update(this._mode);const a=s.getRenderTarget();let l=null;const c=s.state;if(!a){if(!s.state.bindFramebuffer||!c.bindXRFramebuffer)return;l=s._framebuffer,c.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const h=this.context.mainCameraComponent;if(h){const f=h.backgroundColor;f&&s.setClearColor(f,f.alpha),this.cam.backgroundColor=f,this.cam.clearFlags=h.clearFlags,this.cam.nearClipPlane=h.nearClipPlane,this.cam.farClipPlane=h.farClipPlane}else s.setClearColor(new be(1,1,1));s.setRenderTarget(null),s.xr.enabled=!1;const u=(r=this.cam)==null?void 0:r.cam;this.context.updateAspect(u);const d=s.xr.isPresenting;s.xr.isPresenting=!1,s.setSize(this.context.domWidth,this.context.domHeight),s.render(this.context.scene,u),s.xr.isPresenting=d,s.xr.enabled=o,a?s.setRenderTarget(a):c.bindXRFramebuffer&&c.bindXRFramebuffer(l),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const e=this._mode===0;for(const i of as.instances)if(i.avatar&&"isLocalAvatar"in i.avatar&&"flags"in i.avatar){let r=wc.All;this.isSpectatingSelf&&(r=e&&i.avatar.isLocalAvatar?wc.FirstPerson:wc.ThirdPerson);const s=i.avatar.flags;if(!s)continue;for(const o of s)o.UpdateVisible(r)}}resetAvatarFlags(){var e;for(const i of as.instances)if(i.avatar&&"flags"in i.avatar){const r=i.avatar.flags;if(!r)continue;for(const s of r)"isLocalAvatar"in i.avatar&&(e=i.avatar)!=null&&e.isLocalAvatar?s.UpdateVisible(wc.FirstPerson):s.UpdateVisible(wc.ThirdPerson)}}}Lwe([C()],IM.prototype,"useKeys",2);class Uwe{constructor(e,i,r){p(this,"context"),p(this,"cam"),p(this,"spectator"),p(this,"follow"),p(this,"target"),p(this,"view"),p(this,"currentObject"),this.context=e,this.cam=i,this.spectator=r}get currentTarget(){return this.view}set(e){const i=e?.currentObject;if(!i){this.spectator.stopSpectating();return}i!==this.currentObject&&(this.currentObject=i,this.view=e,this.follow||(this.follow=ie.addNewComponent(this.cam.gameObject,tp)),this.target||(this.target=new ve),i.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,pa&&console.log("FOLLOW",i),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){pa&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var e;(e=this.target)==null||e.removeFromParent(),this.follow&&ie.destroy(this.follow)}update(e){var i,r,s,o,a,l;if(((i=this.currentTarget)==null?void 0:i.isConnected)===!1||((r=this.currentTarget)==null?void 0:r.removed)===!0){pa&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((s=this.currentTarget)==null?void 0:s.currentObject)!==this.currentObject&&(pa&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const c=this.context.mainCamera;c&&(this.cam.cam.near!==c.near||this.cam.cam.far!==c.far)&&(this.cam.cam.near=c.near,this.cam.cam.far=c.far,this.cam.cam.updateProjectionMatrix());const h=(o=this.follow)==null?void 0:o.target;if(!(!h||!this.follow)){switch(e){case 0:((a=this.view)==null?void 0:a.viewDevice)!==fd.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),h.position.set(0,0,0);break;case 1:this.follow.followFactor=3,this.follow.rotateFactor=2,h.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((l=this.view)==null?void 0:l.viewDevice)!==fd.Browser?h.quaternion.copy(Fwe):h.quaternion.identity()}}}const Fwe=new Ce().setFromAxisAngle(new S(0,1,0),Math.PI);class Nwe{constructor(e,i){p(this,"context"),p(this,"spectator"),this.context=e,this.spectator=i,console.log("Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",s=>{!this.spectator.useKeys||s.key==="Escape"&&this.spectator.stopSpectating()});let r=0;this.context.input.addEventListener(pn.PointerDown,s=>{r=this.context.time.time}),this.context.input.addEventListener(pn.PointerUp,s=>{const o=this.context.time.time-r;o>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&o<.3&&this.trySelectObject()})}trySelectObject(){const e=new dc;e.setMask(16777215);const i=this.context.physics.raycast(e);if(pa&&console.log(...i),i!=null&&i.length)for(const r of i){if(r.distance<.2)continue;const s=r.object,o=ie.getComponentInParent(s,as),a=o?.connectionId;if(a){const l=this.context.players.getPlayerView(a);this.spectator.target=l,pa&&console.log("spectate",a,o);break}}}}class zwe{constructor(e,i,r){p(this,"guid"),p(this,"dontSave",!0),p(this,"targetUserId"),p(this,"stoppedFollowing"),this.guid=e,this.targetUserId=i,this.stoppedFollowing=r}}class jwe{constructor(e,i){p(this,"guid"),p(this,"userId"),this.guid=e.guid,this.userId=i}}class Gwe{constructor(e,i){p(this,"followers",[]),p(this,"context"),p(this,"spectator"),p(this,"_followerEventMethod"),p(this,"_requestFollowMethod"),p(this,"_joinedRoomMethod"),p(this,"_lastRequestFollowUser"),p(this,"_enforceFollowInterval"),this.context=e,this.spectator=i,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(jt.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",e=>{this.spectator.useKeys&&(e.key==="f"?this.onRequestFollowMe():e.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(jt.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(e,i){if(pa&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",e,i),this.context.connection.connectionId){const r=e?.userId===void 0,s=r?i:e?.userId,o=new zwe(this.context.connection.connectionId,s,r);this.context.connection.send("spectator-follower-changed",o)}}onRequestFollowMe(e=!1){if(pa&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const i=e?void 0:this.context.connection.connectionId,r=new jwe(this.spectator,i);this.context.connection.send("spectator-request-follow",r)}}onUserJoinedRoom(){te("followme")&&this.onRequestFollowMe()}onFollowerEvent(e){const i=e.targetUserId,r=e.guid;if(pa&&console.log(e),i===this.context.connection.connectionId)if(e.stoppedFollowing){const s=this.followers.indexOf(r);s!==-1&&(this.followers.splice(s,1),this.removeDisconnectedFollowers(),console.log(r,"unfollows you",this.followers.length))}else this.followers.includes(r)||(this.followers.push(r),this.removeDisconnectedFollowers(),console.log(r,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let e=this.followers.length-1;e>=0;e--){const i=this.followers[e];this.context.connection.userIsInRoom(i)===!1&&this.followers.splice(e,1)}}onRequestFollowEvent(e){if(this._lastRequestFollowUser=e,e.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(e.userId===void 0)this.spectator.stopSpectating();else{const i=this.context.players.getPlayerView(e.userId);if(i)this.spectator.target=i;else return pa&&console.warn("Could not find view",e.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(pa&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}class Xc{constructor(){p(this,"bb",null),p(this,"bb_pos",0)}__init(e,i){return this.bb_pos=e,this.bb=i,this}static getRootAsSyncedCameraModel(e,i){return(i||new Xc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedCameraModel(e,i){return e.setPosition(e.position()+jB),(i||new Xc).__init(e.readInt32(e.position())+e.position(),e)}userId(e){const i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__string(this.bb_pos+i,e):null}guid(e){const i=this.bb.__offset(this.bb_pos,6);return i?this.bb.__string(this.bb_pos+i,e):null}dontSave(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}pos(e){const i=this.bb.__offset(this.bb_pos,10);return i?(e||new Uf).__init(this.bb_pos+i,this.bb):null}rot(e){const i=this.bb.__offset(this.bb_pos,12);return i?(e||new Uf).__init(this.bb_pos+i,this.bb):null}static startSyncedCameraModel(e){e.startObject(5)}static addUserId(e,i){e.addFieldOffset(0,i,0)}static addGuid(e,i){e.addFieldOffset(1,i,0)}static addDontSave(e,i){e.addFieldInt8(2,+i,0)}static addPos(e,i){e.addFieldStruct(3,i,0)}static addRot(e,i){e.addFieldStruct(4,i,0)}static endSyncedCameraModel(e){return e.endObject()}static finishSyncedCameraModelBuffer(e,i){e.finish(i)}static finishSizePrefixedSyncedCameraModelBuffer(e,i){e.finish(i,void 0,!0)}}var Hwe=Object.defineProperty,Vwe=Object.getOwnPropertyDescriptor,Qwe=(n,e,i,r)=>{for(var s=r>1?void 0:r?Vwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Hwe(e,i,s),s};const RM="SCAM";VB(RM,Xc.getRootAsSyncedCameraModel);const fa=new u_;class Wwe{constructor(e,i){p(this,"userId"),p(this,"guid"),this.guid=i,this.userId=e}send(e,i){if(e){fa.clear();const r=fa.createString(this.guid),s=fa.createString(this.userId);Xc.startSyncedCameraModel(fa),Xc.addGuid(fa,r),Xc.addUserId(fa,s);const o=kt(e),a=Vy(e);Xc.addPos(fa,Uf.createVec3(fa,o.x,o.y,o.z)),Xc.addRot(fa,Uf.createVec3(fa,a.x,a.y,a.z));const l=Xc.endSyncedCameraModel(fa);fa.finish(l,RM),i.sendBinary(fa.asUint8Array())}}}var f3;const m3=(f3=class extends Be{constructor(){super(...arguments),p(this,"cameraPrefab",null),p(this,"_lastWorldPosition"),p(this,"_lastWorldQuaternion"),p(this,"_model",null),p(this,"_needsUpdate",!0),p(this,"_lastUpdateTime",0),p(this,"remoteCams",{}),p(this,"userToCamMap",{}),p(this,"_camTimeoutInSeconds",10),p(this,"_receiveCallback",null)}getCameraObject(n){const e=this.userToCamMap[n];return e?this.remoteCams[e].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(RM,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(RM,this._receiveCallback)}update(){for(const r in this.remoteCams){const s=this.remoteCams[r],o=this.context.time.realtimeSinceStartup-s.lastUpdate;if(!s||o>this._camTimeoutInSeconds){it()&&console.log("Remote cam timeout",r),s!=null&&s.obj&&ie.destroy(s.obj),delete this.remoteCams[r],s&&delete this.userToCamMap[s.userId],m3.instances.push(s),this.context.players.removePlayerView(s.userId,fd.Browser);continue}}if(this.context.isInXR)return;const n=this.context.mainCamera;if(n===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new Wwe(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const e=kt(n),i=Ri(n);(e.distanceTo(this._lastWorldPosition)>.001||i.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(e),this._lastWorldQuaternion.copy(i),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(n,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,n,fd.Browser))}onReceivedRemoteCameraInfoBin(n){const e=n.guid();if(!e)return;const i=n.userId();if(!i||!this.context.connection.userIsInRoom(i)||!this.cameraPrefab)return;let r=this.remoteCams[e];if(!r)if("isObject3D"in this.cameraPrefab){const l=new Vl;l.context=this.context;const c=ie.instantiate(this.cameraPrefab,l);r=this.remoteCams[e]={obj:c,lastUpdate:this.context.time.realtimeSinceStartup,userId:i},r.obj.visible=!0,this.gameObject.add(c),this.userToCamMap[i]=e,m3.instances.push(r);const h=ie.getOrAddComponent(c,as);h.connectionId=i,h.avatar=c}else return;const s=r.obj;this.context.players.setPlayerView(i,s,fd.Browser),r.lastUpdate=this.context.time.realtimeSinceStartup,rl.markDirty(s);const o=n.pos();o&&Kp(s,o.x(),o.y(),o.z());const a=n.rot();a&&Qy(s,a.x(),a.y(),a.z())}},p(f3,"instances",[]),f3);let PM=m3;Qwe([C([ve,$t])],PM.prototype,"cameraPrefab",2);var Xwe=Object.defineProperty,qwe=Object.getOwnPropertyDescriptor,ip=(n,e,i,r)=>{for(var s=r>1?void 0:r?qwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Xwe(e,i,s),s};const g3="view",v3=te("debugsyncedroom");class Nl extends Be{constructor(){super(...arguments),p(this,"roomName",""),p(this,"urlParameterName","room"),p(this,"joinRandomRoom"),p(this,"requireRoomParameter",!1),p(this,"autoRejoin",!0),p(this,"createJoinButton",!0),p(this,"createViewOnlyButton",!1),p(this,"_lastJoinedRoom"),p(this,"_roomPrefix",""),p(this,"_lastPingTime",0),p(this,"_lastRoomTime",-1),p(this,"_userWantsToBeInARoom",!1),p(this,"_roomButton"),p(this,"_roomButtonIconJoin"),p(this,"_roomButtonIconLeave"),p(this,"updateRoomButtonState",()=>{var e,i;this._roomButton&&(this.context.connection.isInRoom?(this._roomButton.title="Leave the networked room",this._roomButton.textContent="Leave Room",(e=this._roomButtonIconJoin)==null||e.remove(),this._roomButton.prepend(this._roomButtonIconLeave)):(this._roomButton.title="Create or join a networked room",this._roomButton.textContent="Join Room",(i=this._roomButtonIconLeave)==null||i.remove(),this._roomButton.prepend(this._roomButtonIconJoin)))}),p(this,"_viewOnlyButton"),p(this,"onCreateViewOnlyButton",()=>{if(!this._viewOnlyButton){const e=document.createElement("button");this._viewOnlyButton=e,e.classList.add("view-only-button"),e.setAttribute("priority","90"),e.onclick=()=>{var i;const r=this.getViewOnlyUrl();r!=null&&r.length?navigator.canShare({url:r})?(i=navigator.share({url:r}))==null||i.catch(s=>{console.warn(s)}):(navigator.clipboard.writeText(r),dn("View only URL copied to clipboard")):Pi("Could not create view only URL")},e.title="Copy the view only URL: A page accessed by the view only URL can not be modified by visiting users.",e.textContent="Share View URL",e.prepend(is("visibility"))}this.context.menu.appendChild(this._viewOnlyButton)})}get currentRoomName(){return te(g3)||te(this.urlParameterName)}set roomPrefix(e){this._roomPrefix=e}get roomPrefix(){return this._roomPrefix}awake(){var e;this.joinRandomRoom===void 0&&((e=this.roomName)==null?void 0:e.length)<=0&&(this.joinRandomRoom=!0),v3&&console.log(`SyncedRoom roomName:${this.roomName}, urlParamName:${this.urlParameterName}, joinRandomRoom:${this.joinRandomRoom}`)}onEnable(){const e=te(g3);if(e&&typeof e=="string"&&e.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(e,!0);return}if(this.tryJoinRoom(),this.createJoinButton){const i=this.createRoomButton();this.context.menu.appendChild(i)}this.createViewOnlyButton&&this.onEnableViewOnlyButton()}onDisable(){var e;(e=this._roomButton)==null||e.remove(),this.onDisableViewOnlyButton(),this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}onDestroy(){this.destroyRoomButton()}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(e=0){var i;e===void 0&&(e=0);let r=!1;if(((i=this.urlParameterName)==null?void 0:i.length)>0){const s=te(this.urlParameterName);if(s&&(typeof s=="string"||typeof s=="number")){r=!0;const o=a4(s.toString());this.roomName=o}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),e<1))return this.tryJoinRoom(e+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(this.roomName=this.generateRoomName());return this.requireRoomParameter&&!r?((v3||it())&&console.warn('SyncedRoom: Missing required room parameter "'+this.urlParameterName+`" in url - will not connect.
To allow joining a room without a query parameter you can set "requireRoomParameter" to false.`),!1):(this.context.connection.isConnected||this.context.connection.connect(),this._lastJoinedRoom=this.roomName,this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.roomName.length<=0?(console.warn(`SyncedRoom: Room name is not set so we can not join a networked room.
Please choose one of the following options to fix this:
A) Set a room name in the SyncedRoom component
B) Set a room name in the URL parameter "?`+this.urlParameterName+`=my_room"
C) Set "joinRandomRoom" to true`),!1):(v3&&console.log("Join "+this.roomName),this._userWantsToBeInARoom=!0,this.context.connection.joinRoom(this.roomName),!0))}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?this._userWantsToBeInARoom&&(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):it()&&console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you?)"))}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const e=window.location.search,i=new URLSearchParams(e);return i.has(this.urlParameterName)&&i.delete(this.urlParameterName),i.set(g3,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+i.toString()}return null}setRandomRoomUrlParameter(){const e=Dy(),i=this.generateRoomName();te(this.urlParameterName)?e.set(this.urlParameterName,i):e.append(this.urlParameterName,i),h2(i,e)}generateRoomName(){let e="";for(let i=0;i<6;i++)e+=Math.floor(Math.random()*10).toFixed(0);return e}createRoomButton(){if(this._roomButton)return this._roomButton;const e=document.createElement("button");return this._roomButton=e,e.classList.add("create-room-button"),e.setAttribute("priority","90"),e.onclick=()=>{if(this.context.connection.isInRoom)this.urlParameterName&&n1(this.urlParameterName,null),this.context.connection.leaveRoom(),this._userWantsToBeInARoom=!1;else{if(this.urlParameterName){const i=te(this.urlParameterName);(!i||i===!0)&&(this._lastJoinedRoom?n1(this.urlParameterName,this._lastJoinedRoom):this.setRandomRoomUrlParameter())}this.tryJoinRoom()}},this._roomButtonIconJoin=is("group"),this._roomButtonIconLeave=is("group_off"),this.updateRoomButtonState(),this.context.connection.beginListen(jt.JoinedRoom,this.updateRoomButtonState),this.context.connection.beginListen(jt.LeftRoom,this.updateRoomButtonState),e}destroyRoomButton(){this.context.connection.stopListen(jt.JoinedRoom,this.updateRoomButtonState),this.context.connection.stopListen(jt.LeftRoom,this.updateRoomButtonState)}onEnableViewOnlyButton(){this.context.connection.isConnected?this.onCreateViewOnlyButton():(this.context.connection.stopListen(jt.JoinedRoom,this.onCreateViewOnlyButton),this.context.connection.beginListen(jt.JoinedRoom,this.onCreateViewOnlyButton))}onDisableViewOnlyButton(){var e;this.context.connection.stopListen(jt.JoinedRoom,this.onCreateViewOnlyButton),(e=this._viewOnlyButton)==null||e.remove()}}ip([C()],Nl.prototype,"roomName",2),ip([C()],Nl.prototype,"urlParameterName",2),ip([C()],Nl.prototype,"joinRandomRoom",2),ip([C()],Nl.prototype,"requireRoomParameter",2),ip([C()],Nl.prototype,"autoRejoin",2),ip([C()],Nl.prototype,"createJoinButton",2),ip([C()],Nl.prototype,"createViewOnlyButton",2),ip([C()],Nl.prototype,"roomPrefix",1);function Ywe(){const n=te("testwindowcount")||0;n&&n>0&&Jwe(n)}function Jwe(n){if(te("testwindow"))return null;const e=new URL(window.location.href);c2(e.searchParams,xve,1),c2(e.searchParams,"testwindow",1);const i=e.toString(),r=[];window.onbeforeunload=()=>{for(const c of r)c.close()};const s=.05,o=128;let a=0,l=0;for(let c=0;c<n;c++){a*o+o*.01>=window.innerWidth&&(l+=1,a=0);const h=a*(o*(1+s))+window.screenLeft,u=l*(o*(1+s))+window.screenTop+90+60*l;a+=1;const d=window.open(i,"test window "+c,`popup=yes width=${o} height=${o} top=${u} left=${h}`);if(!d){console.warn("Failed to open window");continue}r.push(d),d.onload=()=>{d.onbeforeunload=()=>{for(let f=0;f<r.length;f++){const m=r[f];m!==d&&m.close()}r.length=0}}}return r}class y3 extends Be{awake(){Ywe()}}class A3 extends Be{constructor(){super(...arguments),p(this,"transformsPerFrame",10),p(this,"interval",0),p(this,"useFlatbuffers",!0),p(this,"builder",null),p(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(vb,e=>{});else{this.models=[];for(let e=0;e<this.transformsPerFrame;e++)this.models.push(new D7(this.context.connection.connectionId+"_simulatedTransform_"+e,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new u_(1024));const e=this.builder;for(let i=0;i<this.transformsPerFrame;i++){e.clear();const r=qQ(this.context.connection.connectionId,this);this.context.connection.sendBinary(r)}}else if(this.models)for(let e=0;e<this.models.length;e++){const i=this.models[e];i.dontSave=!0,i.update(this,null),this.context.connection.send("TestSimulateUserData-"+e,i)}}}}class D7{constructor(e,i){p(this,"guid"),p(this,"fast",!1),p(this,"position"),p(this,"rotation"),p(this,"velocity"),p(this,"dontSave"),this.guid=e,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(i,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(e,i){const r=e.worldPosition;this.position.x=r.x,this.position.y=r.y,this.position.z=r.z;const s=e.worldQuaternion;if(this.rotation.x=s.x,this.rotation.y=s.y,this.rotation.z=s.z,this.rotation.w=s.w,this.fast=!1,i){const o=i.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=o.x,this.velocity.y=o.y,this.velocity.z=o.z}}}p(D7,"temp",new S);var Kwe=Object.defineProperty,Zwe=Object.getOwnPropertyDescriptor,pv=(n,e,i,r)=>{for(var s=r>1?void 0:r?Zwe(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&Kwe(e,i,s),s};class Vc extends ss{constructor(){super(...arguments),p(this,"offset",new Ke(0)),p(this,"rotation",new Ke(0)),p(this,"focusArea",new Ke(.4)),p(this,"feather",new Ke(.3)),p(this,"kernelSize",new Ke(rc.MEDIUM)),p(this,"resolutionScale",new Ke(1/window.devicePixelRatio))}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=rc.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){const e=new a5({kernelSize:rc.VERY_LARGE,offset:this.offset.value,rotation:this.rotation.value,focusArea:this.focusArea.value,feather:this.feather.value});return this.offset.onValueChanged=i=>e.offset=i,this.rotation.onValueChanged=i=>e.rotation=i,this.focusArea.onValueChanged=i=>e.focusArea=i,this.feather.onValueChanged=i=>e.feather=i,this.kernelSize.onValueChanged=i=>e.blurPass.kernelSize=i,this.resolutionScale.onValueChanged=i=>e.resolution.scale=i/window.devicePixelRatio,e}}pv([C(Ke)],Vc.prototype,"offset",2),pv([C(Ke)],Vc.prototype,"rotation",2),pv([C(Ke)],Vc.prototype,"focusArea",2),pv([C(Ke)],Vc.prototype,"feather",2),pv([C(Ke)],Vc.prototype,"kernelSize",2),pv([C(Ke)],Vc.prototype,"resolutionScale",2),Qa("TiltShiftEffect",Vc);var $we=Object.defineProperty,e1e=Object.getOwnPropertyDescriptor,BM=(n,e,i,r)=>{for(var s=r>1?void 0:r?e1e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&$we(e,i,s),s};class um extends Be{constructor(){super(...arguments),p(this,"isGizmo",!1),p(this,"translationSnap",1),p(this,"rotationSnapAngle",15),p(this,"scaleSnap",.25),p(this,"control"),p(this,"orbit"),p(this,"onControlChangedEvent",e=>{const i=this.orbit;if(i&&(i.enabled=!e.value),e.value){const r=ie.getComponentInParent(this.gameObject,vc);r&&r.requestOwnership()}}),p(this,"windowKeyDownListener",e=>{if(this.enabled&&this.control)switch(e.keyCode){case 81:this.control.setSpace(this.control.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:this.control.setMode("translate");break;case 69:this.control.setMode("rotate");break;case 82:this.control.setMode("scale");break;case 187:case 107:this.control.setSize(this.control.size+.1);break;case 189:case 109:this.control.setSize(Math.max(this.control.size-.1,.1));break;case 88:this.control.showX=!this.control.showX;break;case 89:this.control.showY=!this.control.showY;break;case 90:this.control.showZ=!this.control.showZ;break;case 32:this.control.enabled=!this.control.enabled;break}}),p(this,"windowKeyUpListener",e=>{if(this.enabled)switch(e.keyCode){case 16:this.disableSnapping();break}})}onEnable(){var e;this.isGizmo&&!VA||this.context.mainCamera&&(this.control||(this.control=new Wpe(this.context.mainCamera,this.context.renderer.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,this.control.traverse(i=>{const r=i;if(r.layers.set(2),r){const s=r.material;s&&(s.opacity=.3)}}),this.orbit=ie.getComponentInParent(this.context.mainCamera,wi)??void 0),this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject),(e=this.control)==null||e.addEventListener("dragging-changed",this.onControlChangedEvent),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener)))}onDisable(){var e,i;(e=this.control)==null||e.removeFromParent(),(i=this.control)==null||i.removeEventListener("dragging-changed",this.onControlChangedEvent),window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(pi.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}}BM([C()],um.prototype,"isGizmo",2),BM([C()],um.prototype,"translationSnap",2),BM([C()],um.prototype,"rotationSnapAngle",2),BM([C()],um.prototype,"scaleSnap",2);var t1e=Object.defineProperty,i1e=Object.getOwnPropertyDescriptor,b3=(n,e,i,r)=>{for(var s=r>1?void 0:r?i1e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&t1e(e,i,s),s};class dm extends ss{constructor(){super(...arguments),p(this,"color",new Ke({r:0,g:0,b:0,a:1})),p(this,"intensity",new Ke(0)),p(this,"center",new Ke({x:.5,y:.5}))}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const e=new l5;return this.intensity.onValueChanged=i=>{e.offset=i,this.updateDarkness(e)},this.color.onValueChanged=i=>{this.updateDarkness(e)},e}updateDarkness(e){const i=this.intensity.value;e.darkness=i}}b3([C(Ke)],dm.prototype,"color",2),b3([C(Ke)],dm.prototype,"intensity",2),b3([C(Ke)],dm.prototype,"center",2),Qa("Vignette",dm);var n1e=Object.defineProperty,r1e=Object.getOwnPropertyDescriptor,s1e=(n,e,i,r)=>{for(var s=r>1?void 0:r?r1e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&n1e(e,i,s),s};const x3=te("debugpost");class fv extends Be{constructor(){super(...arguments),p(this,"sharedProfile"),p(this,"_postprocessing"),p(this,"_activeEffects",[]),p(this,"_effects",[]),p(this,"_lastApplyTime"),p(this,"_rapidApplyCount",0),p(this,"_isDirty",!1),p(this,"_modificationQueue"),p(this,"_recreateId",-1)}get isPostProcessingManager(){return!0}get effects(){return this._activeEffects}addEffect(e){let i=e;return i instanceof to&&(i=new hx(i)),this._effects.includes(i)||(this._effects.push(i),this._isDirty=!0),e}removeEffect(e){let i=-1;return e instanceof to?i=this._effects.findIndex(r=>r instanceof hx&&r.effect===e):i=this._effects.indexOf(e),i!==-1&&(this._effects.splice(i,1),this._isDirty=!0),e}markDirty(){this._isDirty=!0}awake(){var e;x3&&(console.log("PostprocessingManager Awake",this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",i=>{i.key==="p"&&(this.enabled=!this.enabled,dn("Toggle PostProcessing "+this.name+": Enabled="+this.enabled),this.markDirty())})),(e=this.sharedProfile)==null||e.init()}onEnable(){this._isDirty=!0}onDisable(){var e;(e=this._postprocessing)==null||e.unapply(),this._isDirty=!1}onBeforeRender(){var e;if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof yP)){x3&&console.warn("PostProcessing: The current composer is not an EffectComposer - this is not supported");return}this.context.mainCamera&&this._isDirty&&this.apply(),this.context.composer&&((e=this._postprocessing)==null?void 0:e.composer)===this.context.composer&&(this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera&&this.context.composer.setMainCamera(this.context.mainCamera))}}onDestroy(){var e;(e=this._postprocessing)==null||e.dispose()}apply(){var e;if(x3&&console.log("Apply PostProcessing "+this.name),it()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._activeEffects.length=0,(e=this.sharedProfile)!=null&&e.components){const i=this.sharedProfile.components;for(const r of i)r.active&&!this._activeEffects.includes(r)&&this._activeEffects.push(r)}for(const i of this._effects)i.active&&!this._activeEffects.includes(i)&&this._activeEffects.push(i);this._activeEffects.length>0&&(this._postprocessing||(this._postprocessing=new SM(this.context)),this._postprocessing.apply(this._activeEffects),this._applyPostQueue())}unapply(){var e;(e=this._postprocessing)==null||e.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const e of this._modificationQueue.values())this.onEditorModification(e);this._modificationQueue.clear()}}onEditorModification(e){var i,r;if(e.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(e.propertyName,e),!0;if(!((i=this._activeEffects)!=null&&i.length))return;const s=e.propertyName.split(".");if(s.length===3||s.length===4){const o=s[1],a=s[2];for(const l of this._activeEffects)if(((r=l.typeName)==null?void 0:r.toLowerCase())===o.toLowerCase()){if(a==="active"){l.active=e.value,this.scheduleRecreate();return}if(!kM.has(o)){const c=new Array;kM.set(o,c);const h=Object.keys(l);for(const u of h)l[u]instanceof Ke&&c.push(u)}if(kM.has(o)){const c=a.toLowerCase(),h=kM.get(o);for(const u of h)if(u.toLowerCase()===c){const d=l[u];d instanceof Ke&&(s.length===4&&s[3]==="active"?(d.overrideState=e.value,this.scheduleRecreate()):d&&d.value!==void 0&&(d.value=e.value));return}}console.warn("Unknown modification",a);return}}return!0}return!1}scheduleRecreate(){const e=++this._recreateId;setTimeout(()=>{e===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}s1e([C0(Rb)],fv.prototype,"sharedProfile",2);const kM=new Map;F0e(fv);var o1e=Object.defineProperty,a1e=Object.getOwnPropertyDescriptor,l1e=(n,e,i,r)=>{for(var s=r>1?void 0:r?a1e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&o1e(e,i,s),s};const OM=te("debugarcamera");class DM extends Be{constructor(){super(...arguments),p(this,"backgroundTint",new ki(1,1,1,1)),p(this,"backgroundPlane"),p(this,"threeTexture"),p(this,"forceTextureInitialization",function(){const e=new Jt,i=new cr,r=new Er;r.add(new pe(i,e));const s=new Ft;return function(o,a){e.map=a,o.render(r,s),OM&&console.warn("Force texture initialization")}}()),p(this,"preRender",()=>{if(!this||!this.gameObject)return;const e=this.context.renderer.xr.getFrame();e&&(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new Gt,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0&&(this.backgroundPlane=h1e(this.backgroundTint)),this.backgroundPlane.parent!==this.scene&&this.scene.add(this.backgroundPlane),this.updateFromFrame(e))})}onBeforeXR(e,i){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("camera-access"),OM&&console.warn("Requesting camera-access")}onEnterXR(e){this.backgroundPlane&&(this.context.scene.add(this.backgroundPlane),this.backgroundPlane.visible=!1),this.backgroundPlane&&this.context.scene.add(this.backgroundPlane),this.context.pre_render_callbacks.push(this.preRender)}onLeaveXR(e){this.backgroundPlane&&this.backgroundPlane.removeFromParent();const i=this.context.pre_render_callbacks.indexOf(this.preRender);i>=0&&this.context.pre_render_callbacks.splice(i,1)}get background(){return this.backgroundPlane}onBeforeRender(e){this.updateFromFrame(e)}updateFromFrame(e){if(!e)return;const i=e.session.enabledFeatures;if(i&&!i.some(s=>s==="camera-access")){this.background&&(this.background.visible=!1);return}const r=e.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(r){for(const s of r.views)if("camera"in s&&s.camera){let o=this.context.renderer.xr.getBinding();if(o||(o=new XRWebGLBinding(e.session,this.context.renderer.getContext())),o){let a=null;if("getCameraImage"in o){a=o.getCameraImage(s.camera);const l=this.context.renderer.properties.get(this.threeTexture);l.__webglTexture=a,this.backgroundPlane?(this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0):OM&&console.warn("No background plane to set texture on")}}}}}}l1e([C(ki)],DM.prototype,"backgroundTint",2);const c1e=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * <backgroundTint>;

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;function h1e(n){const e="vec4("+n.r.toFixed(3)+","+n.g.toFixed(3)+","+n.b.toFixed(3)+","+n.a.toFixed(3)+")";OM&&console.log(e);const i=new pe(new cr(2,2),new Bt({name:"BackgroundMaterial",uniforms:Jm.clone(qr.background.uniforms),vertexShader:qr.background.vertexShader,fragmentShader:c1e.replaceAll("<backgroundTint>",e),side:yi,depthTest:!1,depthWrite:!1,fog:!1}));return i.geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.threeTexture}}),i.renderOrder=-1e4,i.layers.set(2),i.frustumCulled=!1,i.setTexture=function(r){i.material.uniforms.t2D.value=r},i}var u1e=Object.defineProperty,d1e=Object.getOwnPropertyDescriptor,pm=(n,e,i,r)=>{for(var s=r>1?void 0:r?d1e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&u1e(e,i,s),s};const L7=te("debugimagetracking"),_3=class{constructor(n,e,i,r,s,o){p(this,"measuredSize"),p(this,"state"),p(this,"_position"),p(this,"_rotation"),p(this,"_trackingComponent"),p(this,"_trackedImage"),p(this,"_bitmap"),p(this,"_pose"),this._trackingComponent=n,this._trackedImage=e,this._bitmap=i,this.measuredSize=r,this.state=s,this._pose=o}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(n){return this.ensureTransformData(),n.copy(this._position),n}getQuaternion(n){return this.ensureTransformData(),n.copy(this._rotation),n}applyToObject(n,e=void 0){this.ensureTransformData();const i=n.position.distanceToSquared(this._position)/.05+n.quaternion.angleTo(this._rotation)/.05;e&&(e*=Math.max(1,i)),e===void 0||e>=1?(n.position.copy(this._position),n.quaternion.copy(this._rotation)):(e=Math.max(0,Math.min(1,e)),n.position.lerp(this._position,e),n.quaternion.slerp(this._rotation,e))}ensureTransformData(){if(!this._position){this._position=_3._positionBuffer.get(),this._rotation=_3._rotationBuffer.get();const n=this._pose.transform,e=Et.active.convertSpace(n);this._position.copy(e?.position),this._rotation.copy(e?.quaternion)}}};let mv=_3;p(mv,"_positionBuffer",new Qo(()=>new S,20)),p(mv,"_rotationBuffer",new Qo(()=>new Ce,20));class Qc{constructor(){p(this,"image"),p(this,"widthInMeters",.25),p(this,"object"),p(this,"createObjectInstance",!1),p(this,"imageDoesNotMove",!1),p(this,"hideWhenTrackingIsLost",!0)}}pm([C(URL)],Qc.prototype,"image",2),pm([C()],Qc.prototype,"widthInMeters",2),pm([C($t)],Qc.prototype,"object",2),pm([C()],Qc.prototype,"createObjectInstance",2),pm([C()],Qc.prototype,"imageDoesNotMove",2),pm([C()],Qc.prototype,"hideWhenTrackingIsLost",2);class p1e{constructor(e,i,r){p(this,"filename"),p(this,"widthInMeters"),p(this,"imageData"),this.filename=e,this.imageData=i,this.widthInMeters=r}get extensionName(){return"image-tracking"}onAfterHierarchy(e,i){i.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),i.appendLine("uniform asset image = @image_tracking/"+this.filename+"@"),i.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),i.closeBlock()}onBeforeBuildDocument(e){const i=ie.findObjectOfType(gv);!i||!i.trackedImages||i.trackedImages.length>1&&(it()&&Pi("USDZ: Only one tracked image is supported."),console.warn("USDZ: Only one tracked image is supported."))}onAfterSerialize(e){e.files["image_tracking/"+this.filename]=this.imageData}onExportObject(e,i,r){var s;const o=ie.findObjectOfType(gv);if(!(!o||!o.trackedImages)){for(const a of o.trackedImages)if(((s=a.object)==null?void 0:s.asset)===e){const l=ie.findObjectOfType(Dn);if(!l)continue;const{scale:c,target:h}=l.getARScaleAndTarget();let u=e;const d=new he;if(e!==h)for(;u.parent&&u.parent!==h;)u=u.parent,d.premultiply(u.matrix);const f=d.clone().invert();i.matrix=f.scale(new S(c,c,c));break}}}}var w3;const Ux=(w3=class extends Be{constructor(){super(...arguments),p(this,"trackedImages"),p(this,"smooth",!0),p(this,"trackedImageIndexMap",new Map),p(this,"imageToObjectMap",new Map),p(this,"currentImages",[]),p(this,"onImageTrackingUpdate",n=>{const e=Et.active;if(e)for(const i of n){const r=i.model,s=i.state==="tracked";if(!r.object)continue;let o=this.imageToObjectMap.get(r);if(o===void 0)o={object:null,frames:0,lastTrackingTime:Date.now()},this.imageToObjectMap.set(r,o),r.object.loadAssetAsync().then(a=>{if(r.createObjectInstance&&a&&(a=ie.instantiate(a)),a){o.object=a;for(const l of a.getComponentsInChildren(Bn))l.setInstancingEnabled(!1);e.rig?(e.rig.gameObject.add(a),i.applyToObject(a),a.activeSelf||ie.setActive(a,!0)):console.warn("XRImageTracking: missing XRRig")}});else{if(o.frames++,s&&(o.lastTrackingTime=Date.now()),r.imageDoesNotMove&&o.frames>10||!o.object)continue;e.rig&&(e.rig.gameObject.add(o.object),i.applyToObject(o.object,this.smooth?this.context.time.deltaTimeUnscaled*3:void 0),o.object.activeSelf||ie.setActive(o.object,!0))}}})}awake(){if(L7&&console.log(this),!!this.trackedImages){for(const n of this.trackedImages)if(n.image&&!Ux._imageElements.has(n.image)){const e=n.image;Ux._imageElements.set(e,null);const i=document.createElement("img");i.src=e,i.addEventListener("load",async()=>{const r=await createImageBitmap(i);Ux._imageElements.set(e,r);const s=await _Q(r);if(s){const o=await(await s.convertToBlob({type:"image/png"})).arrayBuffer(),a=ie.findObjectOfType(Dn);a&&this.trackedImages&&(a.extensions.push(new p1e("marker.png",new Uint8Array(o),this.trackedImages[0].widthInMeters)),a.anchoringType="image")}})}}}onBeforeXR(n,e){var i;if(this.trackedImages){e.optionalFeatures=e.optionalFeatures||[],e.optionalFeatures.includes("image-tracking")||e.optionalFeatures.push("image-tracking"),e.trackedImages=[];for(const r of this.trackedImages)if((i=r.image)!=null&&i.length&&r.widthInMeters>0){const s=Ux._imageElements.get(r.image);s&&(this.trackedImageIndexMap.set(e.trackedImages.length,r),e.trackedImages.push({image:s,widthInMeters:r.widthInMeters}))}}}onEnterXR(n){var e;if(this.trackedImages){for(const i of this.trackedImages)if((e=i.object)!=null&&e.asset){const r=i.object.asset;r.userData||(r.userData={});const s={visible:r.visible,parent:r.parent,matrix:r.matrix.clone()};r.userData["image-tracking"]=s}}for(const i of this.imageToObjectMap.values())i.frames=0}onLeaveXR(n){var e,i;if(this.trackedImages){for(const r of this.trackedImages)if((e=r.object)!=null&&e.asset){const s=r.object.asset;if(s.userData){const o=s.userData["image-tracking"];o&&(s.visible=o.visible,(i=o.parent)==null||i.add(s),s.matrix.copy(o.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale)),delete s.userData["image-tracking"]}}}}onUpdateXR(n){var e;this.currentImages.length=0;const i=n.xr.frame;if(!i)return;if("getImageTrackingResults"in i){if(((e=n.xr.session.enabledFeatures)==null?void 0:e.includes("image-tracking"))===!1)return;if(i.session&&typeof i.getImageTrackingResults=="function"){const s=i.getImageTrackingResults();if(s.length>0){const o=this.context.renderer.xr.getReferenceSpace();if(o){for(const a of s){const l=a.trackingState,c=a.index,h=this.trackedImageIndexMap.get(c);if(h){const u=i.getPose(a.imageSpace,o),d=new mv(this,h,a.image,a.measuredSize,l,u);this.currentImages.push(d)}else L7&&console.warn("No tracked image for index",c)}if(this.currentImages.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:this.currentImages})),this.onImageTrackingUpdate(this.currentImages)}catch(a){console.error(a)}}}}}else{const s=`Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a target="_blank" href="#" onclick="() => console.log('I')">chrome://flags/#webxr-incubations</a> flag.`;this.didPrintWarning||(this.didPrintWarning=!0,console.log(s)),Pi(s);return}const r=1e3;for(const[s,o]of this.imageToObjectMap){if(!o.object||!s||s.hideWhenTrackingIsLost===!1)continue;let a=!1;for(const l of this.currentImages)if(l.model===s){const c=Date.now()-o.lastTrackingTime;if(s.imageDoesNotMove||l.state==="tracked"||c<=r){a=!0;break}}a||ie.setActive(o.object,!1)}}},p(w3,"_imageElements",new Map),w3);let gv=Ux;pm([C(Qc)],gv.prototype,"trackedImages",2);const Fx=new S,Nx=new S,U7=new Lt;class f1e extends Is{constructor(e,i=1,r=16711680){const s=new dt,o=e.geometry.attributes.normal.count,a=new rt(o*2*3,3);s.setAttribute("position",a),super(s,new zi({color:r,toneMapped:!1})),this.object=e,this.size=i,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),U7.getNormalMatrix(this.object.matrixWorld);const e=this.object.matrixWorld,i=this.geometry.attributes.position,r=this.object.geometry;if(r){const s=r.attributes.position,o=r.attributes.normal;let a=0;for(let l=0,c=s.count;l<c;l++)Fx.fromBufferAttribute(s,l).applyMatrix4(e),Nx.fromBufferAttribute(o,l),Nx.applyMatrix3(U7).normalize().multiplyScalar(this.size).add(Fx),i.setXYZ(a,Fx.x,Fx.y,Fx.z),a=a+1,i.setXYZ(a,Nx.x,Nx.y,Nx.z),a=a+1}i.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}var m1e=Object.defineProperty,g1e=Object.getOwnPropertyDescriptor,vv=(n,e,i,r)=>{for(var s=r>1?void 0:r?g1e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&m1e(e,i,s),s};const fm=te("debugplanetracking");class nu extends Be{constructor(){super(...arguments),p(this,"dataTemplate"),p(this,"occluder",!0),p(this,"initiateRoomCaptureIfNoData",!0),p(this,"usePlaneData",!0),p(this,"useMeshData",!0),p(this,"runInVR",!0),p(this,"bounds",new Ht),p(this,"center",new S),p(this,"labelOffset",new S),p(this,"_dataId",1),p(this,"_allPlanes",new Map),p(this,"_allMeshes",new Map),p(this,"firstTimeNoPlanesDetected",-100),p(this,"makeOccluder",(e,i,r=!1)=>{if(i){if(i instanceof Array){for(const s of i)this.makeOccluder(e,s,r);return}!r&&!i.name.toLowerCase().includes("occlu")||(i.colorWrite=!1,i.depthTest=!0,i.depthWrite=!0,i.transparent=!1,i.polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=.1,e.renderOrder=-1e3)}}),p(this,"_flipForwardMatrix",new he().makeRotationY(Math.PI)),p(this,"_verticesCache",new Map)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onBeforeXR(e,i){e==="immersive-vr"&&!this.runInVR||(i.optionalFeatures=i.optionalFeatures||[],this.usePlaneData&&!i.optionalFeatures.includes("plane-detection")&&i.optionalFeatures.push("plane-detection"),this.useMeshData&&!i.optionalFeatures.includes("mesh-detection")&&i.optionalFeatures.push("mesh-detection"))}onEnterXR(e){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onLeaveXR(e){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onUpdateXR(e){if(!this.runInVR&&e.xr.isVR)return;const i=e.xr.rig;if(!i){console.warn("No XR rig found, cannot parent tracked planes to it");return}const r=e.xr.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const s=r.detectedPlanes,o=r.detectedMeshes,a=s!==void 0&&s.size>0,l=o!==void 0&&o.size>0;if(this.initiateRoomCaptureIfNoData&&(!a&&!l&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(a||l)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in r.session&&(r.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),s!==void 0&&this.processFrameData(e.xr,i.gameObject,r,s,this._allPlanes),o!==void 0&&this.processFrameData(e.xr,i.gameObject,r,o,this._allMeshes),fm){const c=this.context.mainCameraComponent.gameObject.worldPosition;for(const h of this._allPlanes.values())!h.mesh||!h.mesh.visible||(this.bounds.makeEmpty(),h.mesh.traverse(u=>{u instanceof pe&&this.bounds.expandByObject(u)}),this.bounds.getCenter(this.center),this.labelOffset.copy(c).sub(this.center).normalize().multiplyScalar(.1),yt.DrawLabel(this.center.add(this.labelOffset),(h.xrData.semanticLabel||"plane").toUpperCase()+`
`+h.xrData.lastChangedTime.toFixed(2),.02))}}removeData(e,i){const r=i.get(e);if(!r)return;i.delete(e),fm&&console.log("Plane no longer tracked, id="+r.id),r.mesh&&(r.mesh.removeFromParent(),r.mesh.traverse(o=>{const a=o.userData.normalsHelper;a?(a.dispose(),a.removeFromParent()):fm&&console.warn("No normals helper found for mesh",r.mesh)}),$o(r.mesh,!0,!0));const s=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:r}});this.dispatchEvent(s)}processFrameData(e,i,r,s,o){const a=this.context.renderer.xr.getReferenceSpace();if(a){for(const l of o.keys())s.has(l)||this.removeData(l,o);for(const l of s){const c="planeSpace"in l?l.planeSpace:"meshSpace"in l?l.meshSpace:void 0;if(!c)continue;const h=r.getPose(c,a);let u;if(o.has(l)){const d=o.get(l);if(u=d.mesh,d.timestamp<l.lastChangedTime){if(d.timestamp=l.lastChangedTime,d.mesh){const m=this.createGeometry(l);if(d.mesh instanceof pe)d.mesh.geometry.dispose(),d.mesh.geometry=m,this.makeOccluder(d.mesh,d.mesh.material);else if(d.mesh instanceof Cr)for(const g of d.mesh.children)g instanceof pe&&(g.geometry.dispose(),g.geometry=m,this.makeOccluder(g,g.material));if(d.collider){const g=d.mesh;d.collider.sharedMesh=g,d.collider.convex=this.checkIfContextShouldBeConvex(g,d.xrData),d.collider.onDisable(),d.collider.onEnable()}fm&&(console.log("Plane updated, id="+d.id,d),d.mesh.traverse(g=>{if(!(g instanceof pe))return;const v=g.userData.normalsHelper;v&&v.update()}))}const f=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:d}});this.dispatchEvent(f)}}else{if(!this.dataTemplate){const d=new pe;fm?d.material=new zw:this.occluder?(d.material=new Jt,this.makeOccluder(d,d.material,!0)):d.material=new Jt({wireframe:!0,opacity:.5,transparent:!0,color:3355443}),this.dataTemplate=new $t("","",d)}if(!this.dataTemplate.asset)this.dataTemplate.loadAssetAsync();else{const d=ie.instantiate(this.dataTemplate.asset);if(d.name="xr-tracked-plane",u=d,cP(d,!1),d instanceof pe)Wi(d.geometry),d.geometry=this.createGeometry(l),this.makeOccluder(d,d.material,this.occluder);else if(d instanceof Cr)for(const g of d.children)g instanceof pe&&(Wi(g.geometry),g.geometry=this.createGeometry(l),this.makeOccluder(g,g.material,this.occluder));const f=d.getComponent(jf);if(f){const g=d;f.sharedMesh=g,f.convex=this.checkIfContextShouldBeConvex(g,l),f.onDisable(),f.onEnable()}d.matrixAutoUpdate=!1,d.matrixWorldNeedsUpdate=!0,i.add(d);const m={id:this._dataId++,xrData:l,timestamp:l.lastChangedTime,mesh:d,collider:f};o.set(l,m),fm&&console.log("New plane detected, id="+m.id,m);try{const g=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:m}});this.dispatchEvent(g)}catch(g){console.error(g)}}}u&&(h?(u.visible=!0,u.matrix.fromArray(h.transform.matrix),u.matrix.premultiply(this._flipForwardMatrix)):u.visible=!1,fm&&u.traverse(d=>{if(d instanceof pe)if(d.userData.normalsHelper)d.userData.normalsHelper.update();else{const f=new f1e(d,.05,255);f.layers.disableAll(),f.layers.set(2),this.context.scene.add(f),d.userData.normalsHelper=f}}))}}}checkIfContextShouldBeConvex(e,i){if(!e)return!0;if(e){const r=new Ht;r.expandByObject(e);const s=new S;r.getSize(s);let o=!0;return s.x>2&&s.y>2&&s.z>1.5&&(o=!1),o&&"semanticLabel"in i&&i.semanticLabel==="wall"&&(o=!0),o}return!0}createGeometry(e){return"polygon"in e?this.createPlaneGeometry(e.polygon):"vertices"in e&&"indices"in e?this.createMeshGeometry(e.vertices,e.indices):new dt}createMeshGeometry(e,i){const r=e.toString()+"_"+i.toString();if(this._verticesCache.has(r))return this._verticesCache.get(r);const s=new dt;s.setIndex(new Ye(i,1)),s.setAttribute("position",new Ye(e,3));const o=Array();for(let a=0;a<e.length;a+=3)o.push(e[a],e[a+2]);return s.setAttribute("uv",new Ye(e,3)),s.computeVertexNormals(),this._verticesCache.set(r,s),s}createPlaneGeometry(e){const i=new dt,r=[],s=[];e.forEach(f=>{r.push(f.x,f.y,f.z),s.push(f.x,f.z)});const o=new S(r[0],r[1],r[2]),a=new S(r[3],r[4],r[5]),l=new S(r[6],r[7],r[8]),c=new S,h=new S;c.subVectors(a,o),h.subVectors(l,o),c.cross(h),c.normalize();const u=[];for(let f=0;f<r.length/3;f++)u.push(c.x,c.y,c.z);const d=[];for(let f=2;f<e.length;++f)d.push(0,f-1,f);return i.setAttribute("position",new Ye(new Float32Array(r),3)),i.setAttribute("uv",new Ye(new Float32Array(s),2)),i.setAttribute("normal",new Ye(new Float32Array(u),3)),i.setIndex(d),i}}vv([C($t)],nu.prototype,"dataTemplate",2),vv([C()],nu.prototype,"occluder",2),vv([C()],nu.prototype,"initiateRoomCaptureIfNoData",2),vv([C()],nu.prototype,"usePlaneData",2),vv([C()],nu.prototype,"useMeshData",2),vv([C()],nu.prototype,"runInVR",2);var v1e=Object.defineProperty,y1e=Object.getOwnPropertyDescriptor,yv=(n,e,i,r)=>{for(var s=r>1?void 0:r?y1e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&v1e(e,i,s),s};class ru extends Be{constructor(){super(...arguments),p(this,"side","none"),p(this,"controller",!0),p(this,"hands",!1),p(this,"controlVisibility",!0),p(this,"useGripSpace",!1),p(this,"resetTransformAfterXRSession",!0),p(this,"_startPosition",new S),p(this,"_startRotation",new Ce),p(this,"_startScale",new S)}get activeAndEnabled(){return!0}onEnterXR(e){this._startPosition.copy(this.gameObject.position),this._startRotation.copy(this.gameObject.quaternion),this._startScale.copy(this.gameObject.scale)}onUpdateXR(e){const i=e.xr.getController(this.side);if(i){if(i.hand&&!this.hands){this.controlVisibility&&(this.gameObject.visible=!1);return}else if(!this.controller){this.controlVisibility&&(this.gameObject.visible=!1);return}this.controlVisibility&&(this.gameObject.visible=!0),this.useGripSpace||i.targetRayMode==="transient-pointer"?(this.gameObject.worldPosition=i.gripWorldPosition,this.gameObject.worldQuaternion=i.gripWorldQuaternion,this.gameObject.worldScale=bt(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale)):(this.gameObject.worldPosition=i.rayWorldPosition,this.gameObject.worldQuaternion=i.rayWorldQuaternion,this.gameObject.worldScale=bt(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale))}}onLeaveXR(e){this.resetTransformAfterXRSession&&(this.gameObject.position.copy(this._startPosition),this.gameObject.quaternion.copy(this._startRotation),this.gameObject.scale.copy(this._startScale))}}yv([C()],ru.prototype,"side",2),yv([C()],ru.prototype,"controller",2),yv([C()],ru.prototype,"hands",2),yv([C()],ru.prototype,"controlVisibility",2),yv([C()],ru.prototype,"useGripSpace",2),yv([C()],ru.prototype,"resetTransformAfterXRSession",2);var A1e=Object.defineProperty,b1e=Object.getOwnPropertyDescriptor,x1e=(n,e,i,r)=>{for(var s=r>1?void 0:r?b1e(e,i):e,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=(r?a(e,i,s):a(s))||s);return r&&s&&A1e(e,i,s),s};const F7=te("debugwebxr");class LM extends Be{constructor(){super(...arguments),p(this,"priority",0),p(this,"_startScale")}get isActive(){return this.activeAndEnabled&&this.gameObject.visible}setAsActiveXRRig(){var e;(e=Et.active)==null||e.setRigActive(this)}awake(){if(F7){const e=new ve;e.position.y+=.5,this.gameObject.add(e);const i=e.addNewComponent(Gf);i&&(i.isGizmo=!1);const r=new Vo(.5);this.gameObject.add(r)}}isXRRig(){return!0}supportsXR(e){return!0}onEnterXR(e){this._startScale=this.gameObject.scale.clone(),e.xr.addRig(this),F7&&console.log("WebXR: add Rig",this.name,this.priority)}onLeaveXR(e){e.xr.removeRig(this),this._startScale&&this.gameObject&&this.gameObject.scale.copy(this._startScale)}}x1e([C()],LM.prototype,"priority",2);class S3{}const _1e=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:Ai,ActionCollection:XO,ActionModel:za,AlignmentConstraint:fb,Animation:Fs,AnimationCurve:Df,AnimationExtension:Ib,AnimationTrackHandler:oE,Animator:rs,AnimatorController:ya,Antialiasing:Pb,AudioExtension:hp,AudioListener:Ed,AudioSource:Pn,AudioTrackHandler:Eb,Avatar:Pd,AvatarBlink_Simple:Nf,AvatarEyeLook_Rotation:O0,AvatarLoader:wD,AvatarMarker:as,AvatarModel:mE,Avatar_Brain_LookAt:Lb,Avatar_MouthShapes:Fb,Avatar_MustacheShake:bD,Avatar_POI:Sc,AxesHelper:D0,BaseUIComponent:nl,BasicIKConstraint:CD,BehaviorExtension:gE,BehaviorModel:kr,BloomEffect:zf,BoxCollider:U0,BoxGizmo:Gf,BoxHelperComponent:Mc,Button:Qh,CallInfo:mc,Camera:Ui,CameraTargetReachedEvent:xb,Canvas:ls,CanvasGroup:Ld,CapsuleCollider:Vh,ChangeMaterialOnClick:z0,ChangeTransformOnClick:Qf,CharacterController:qf,CharacterControllerInput:Xh,ChromaticAberration:Xb,Collider:oa,ColorAdjustments:Nd,ColorBySpeedModule:Jf,ColorOverLifetimeModule:ix,ContactShadows:Bc,ControlTrackHandler:aE,CustomBranding:Xd,Deletable:fL,DeleteBox:JE,DepthOfField:Ul,DeviceFlag:KE,DocumentExtension:mL,DragControls:ko,DropListener:Yd,Duplicatable:im,EffectWrapper:hx,EmissionModule:Pc,EmphasizeOnClick:G0,EventList:An,EventListEvent:XC,EventSystem:Ha,EventTrigger:eM,FieldWithDefault:ZD,FixedJoint:_L,FlyControls:wL,Fog:tv,GltfExport:fx,GltfExportBox:IL,Gradient:jd,Graphic:Hf,GraphicRaycaster:ZC,GridHelper:rv,GridLayoutGroup:FD,GroundProjectedEnv:Uh,GroupActionModel:Ad,HideOnStart:jD,HingeJoint:ux,HorizontalLayoutGroup:UD,Image:N0,InheritVelocityModule:Hd,InputField:nm,InstanceHandle:Jb,InstancingHandler:Yb,Interactable:pL,Keyframe:ja,LODGroup:gx,LODModel:rm,Light:Oo,LimitVelocityOverLifetimeModule:rr,LogStats:kL,LookAt:sm,LookAtConstraint:Lf,MainModule:hs,MaskableGraphic:Hb,MeshCollider:jf,MeshRenderer:$b,MinMaxCurve:ft,MinMaxGradient:Po,NeedleMenu:kc,NestedGltf:aM,Networking:ov,NoiseModule:Mi,ObjectRaycaster:ta,OffsetConstraint:om,OpenURL:av,OrbitControls:wi,Outline:F0,Padding:Od,ParticleBurst:tx,ParticleSubEmitter:wM,ParticleSystem:or,ParticleSystemRenderer:qa,PhysicsExtension:WE,PixelationEffect:Ex,PlayAnimationOnClick:Xf,PlayAudioOnClick:Ud,PlayableDirector:Td,PlayerColor:Qv,PointerEventData:Gv,PostProcessingHandler:SM,PreliminaryAction:H0,PreliminaryTrigger:Qb,RawImage:bE,Rect:kD,RectTransform:zs,ReflectionProbe:Q0,RegisteredAnimationInfo:uE,RemoteSkybox:Gc,Renderer:Bn,RendererLightmap:Kb,Rigidbody:Oi,RotationBySpeedModule:ca,RotationOverLifetimeModule:Wa,SceneSwitcher:Gr,ScreenCapture:ep,ScreenSpaceAmbientOcclusion:iu,ScreenSpaceAmbientOcclusionN8:Fl,SetActiveOnClick:Wf,ShadowCatcher:Bx,ShapeModule:Cn,SharpeningEffect:Tx,SignalAsset:wb,SignalReceiver:P0,SignalReceiverEvent:R0,SignalTrackHandler:Mb,Size:BD,SizeBySpeedModule:fo,SizeOverLifetimeModule:Gd,SkinnedMeshRenderer:$D,SmoothFollow:tp,SpatialGrabRaycaster:T0,SpatialHtml:kx,SpatialTrigger:Lx,SpatialTriggerReceiver:Hc,SpectatorCamera:IM,SphereCollider:L0,Sprite:Zh,SpriteData:K0,SpriteRenderer:Bo,SpriteSheet:sx,SubEmitterSystem:Cx,SyncedCamera:PM,SyncedRoom:Nl,SyncedTransform:vc,TapGestureTrigger:GD,TeleportTarget:VE,TestRunner:y3,TestSimulateUserData:A3,Text:js,TextBuilder:XE,TextExtension:ox,TextureSheetAnimationModule:us,TiltShiftEffect:Vc,ToneMappingEffect:Fd,TrailModule:vn,TransformData:Fr,TransformGizmo:um,TriggerBuilder:Or,TriggerModel:kf,UIRaycastUtils:$C,UIRootComponent:Ab,USDZExporter:Dn,USDZText:Wd,USDZUIExtension:qE,UsageMarker:lx,VariantAction:WO,VelocityOverLifetimeModule:En,VerticalLayoutGroup:LD,VideoPlayer:br,Vignette:dm,VisibilityAction:Wb,Voip:Bd,Volume:fv,VolumeParameter:Ke,VolumeProfile:Rb,WebARCameraBackground:DM,WebARSessionRoot:$h,WebXR:On,WebXRImageTracking:gv,WebXRImageTrackingModel:Qc,WebXRPlaneTracking:nu,WebXRTrackedImage:mv,XRControllerFollow:ru,XRControllerModel:Dc,XRControllerMovement:ha,XRFlag:sa,XRRig:LM,XRState:po,__Ignore:S3},Symbol.toStringTag,{value:"Module"}));class w1e extends Be{constructor(){super(...arguments),p(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}q.add("__Ignore",S3),q.add("ActionBuilder",Ai),q.add("ActionCollection",XO),q.add("ActionModel",za),q.add("AlignmentConstraint",fb),q.add("Animation",Fs),q.add("AnimationCurve",Df),q.add("AnimationExtension",Ib),q.add("AnimationTrackHandler",oE),q.add("Animator",rs),q.add("AnimatorController",ya),q.add("Antialiasing",Pb),q.add("AudioExtension",hp),q.add("AudioListener",Ed),q.add("AudioSource",Pn),q.add("AudioTrackHandler",Eb),q.add("Avatar",Pd),q.add("Avatar_Brain_LookAt",Lb),q.add("Avatar_MouthShapes",Fb),q.add("Avatar_MustacheShake",bD),q.add("Avatar_POI",Sc),q.add("AvatarBlink_Simple",Nf),q.add("AvatarEyeLook_Rotation",O0),q.add("AvatarLoader",wD),q.add("AvatarMarker",as),q.add("AvatarModel",mE),q.add("AxesHelper",D0),q.add("BaseUIComponent",nl),q.add("BasicIKConstraint",CD),q.add("BehaviorExtension",gE),q.add("BehaviorModel",kr),q.add("BloomEffect",zf),q.add("BoxCollider",U0),q.add("BoxGizmo",Gf),q.add("BoxHelperComponent",Mc),q.add("Button",Qh),q.add("CallInfo",mc),q.add("Camera",Ui),q.add("CameraTargetReachedEvent",xb),q.add("Canvas",ls),q.add("CanvasGroup",Ld),q.add("CapsuleCollider",Vh),q.add("ChangeMaterialOnClick",z0),q.add("ChangeTransformOnClick",Qf),q.add("CharacterController",qf),q.add("CharacterControllerInput",Xh),q.add("ChromaticAberration",Xb),q.add("Collider",oa),q.add("ColorAdjustments",Nd),q.add("ColorBySpeedModule",Jf),q.add("ColorOverLifetimeModule",ix),q.add("ContactShadows",Bc),q.add("ControlTrackHandler",aE),q.add("CustomBranding",Xd),q.add("Deletable",fL),q.add("DeleteBox",JE),q.add("DepthOfField",Ul),q.add("DeviceFlag",KE),q.add("DocumentExtension",mL),q.add("DragControls",ko),q.add("DropListener",Yd),q.add("Duplicatable",im),q.add("EffectWrapper",hx),q.add("EmissionModule",Pc),q.add("EmphasizeOnClick",G0),q.add("EventList",An),q.add("EventListEvent",XC),q.add("EventSystem",Ha),q.add("EventTrigger",eM),q.add("FieldWithDefault",ZD),q.add("FixedJoint",_L),q.add("FlyControls",wL),q.add("Fog",tv),q.add("GltfExport",fx),q.add("GltfExportBox",IL),q.add("Gradient",jd),q.add("Graphic",Hf),q.add("GraphicRaycaster",ZC),q.add("GridHelper",rv),q.add("GridLayoutGroup",FD),q.add("GroundProjectedEnv",Uh),q.add("GroupActionModel",Ad),q.add("HideOnStart",jD),q.add("HingeJoint",ux),q.add("HorizontalLayoutGroup",UD),q.add("Image",N0),q.add("InheritVelocityModule",Hd),q.add("InputField",nm),q.add("InstanceHandle",Jb),q.add("InstancingHandler",Yb),q.add("Interactable",pL),q.add("Keyframe",ja),q.add("Light",Oo),q.add("LimitVelocityOverLifetimeModule",rr),q.add("LODGroup",gx),q.add("LODModel",rm),q.add("LogStats",kL),q.add("LookAt",sm),q.add("LookAtConstraint",Lf),q.add("MainModule",hs),q.add("MaskableGraphic",Hb),q.add("MeshCollider",jf),q.add("MeshRenderer",$b),q.add("MinMaxCurve",ft),q.add("MinMaxGradient",Po),q.add("NeedleMenu",kc),q.add("NestedGltf",aM),q.add("Networking",ov),q.add("NoiseModule",Mi),q.add("ObjectRaycaster",ta),q.add("OffsetConstraint",om),q.add("OpenURL",av),q.add("OrbitControls",wi),q.add("Outline",F0),q.add("Padding",Od),q.add("ParticleBurst",tx),q.add("ParticleSubEmitter",wM),q.add("ParticleSystem",or),q.add("ParticleSystemRenderer",qa),q.add("PhysicsExtension",WE),q.add("PixelationEffect",Ex),q.add("PlayableDirector",Td),q.add("PlayAnimationOnClick",Xf),q.add("PlayAudioOnClick",Ud),q.add("PlayerColor",Qv),q.add("PlayerState",ra),q.add("PlayerSync",B0),q.add("PointerEventData",Gv),q.add("PostProcessingHandler",SM),q.add("PreliminaryAction",H0),q.add("PreliminaryTrigger",Qb),q.add("PresentationMode",w1e),q.add("RawImage",bE),q.add("Rect",kD),q.add("RectTransform",zs),q.add("ReflectionProbe",Q0),q.add("RegisteredAnimationInfo",uE),q.add("RemoteSkybox",Gc),q.add("Renderer",Bn),q.add("RendererLightmap",Kb),q.add("Rigidbody",Oi),q.add("RotationBySpeedModule",ca),q.add("RotationOverLifetimeModule",Wa),q.add("SceneSwitcher",Gr),q.add("ScreenCapture",ep),q.add("ScreenSpaceAmbientOcclusion",iu),q.add("ScreenSpaceAmbientOcclusionN8",Fl),q.add("SetActiveOnClick",Wf),q.add("ShadowCatcher",Bx),q.add("ShapeModule",Cn),q.add("SharpeningEffect",Tx),q.add("SignalAsset",wb),q.add("SignalReceiver",P0),q.add("SignalReceiverEvent",R0),q.add("SignalTrackHandler",Mb),q.add("Size",BD),q.add("SizeBySpeedModule",fo),q.add("SizeOverLifetimeModule",Gd),q.add("SkinnedMeshRenderer",$D),q.add("SmoothFollow",tp),q.add("SpatialGrabRaycaster",T0),q.add("SpatialHtml",kx),q.add("SpatialTrigger",Lx),q.add("SpatialTriggerReceiver",Hc),q.add("SpectatorCamera",IM),q.add("SphereCollider",L0),q.add("Sprite",Zh),q.add("SpriteData",K0),q.add("SpriteRenderer",Bo),q.add("SpriteSheet",sx),q.add("SubEmitterSystem",Cx),q.add("SyncedCamera",PM),q.add("SyncedRoom",Nl),q.add("SyncedTransform",vc),q.add("TapGestureTrigger",GD),q.add("TeleportTarget",VE),q.add("TestRunner",y3),q.add("TestSimulateUserData",A3),q.add("Text",js),q.add("TextBuilder",XE),q.add("TextExtension",ox),q.add("TextureSheetAnimationModule",us),q.add("TiltShiftEffect",Vc),q.add("ToneMappingEffect",Fd),q.add("TrailModule",vn),q.add("TransformData",Fr),q.add("TransformGizmo",um),q.add("TriggerBuilder",Or),q.add("TriggerModel",kf),q.add("UIRaycastUtils",$C),q.add("UIRootComponent",Ab),q.add("UsageMarker",lx),q.add("USDZExporter",Dn),q.add("USDZText",Wd),q.add("USDZUIExtension",qE),q.add("VariantAction",WO),q.add("VelocityOverLifetimeModule",En),q.add("VerticalLayoutGroup",LD),q.add("VideoPlayer",br),q.add("Vignette",dm),q.add("VisibilityAction",Wb),q.add("Voip",Bd),q.add("Volume",fv),q.add("VolumeParameter",Ke),q.add("VolumeProfile",Rb),q.add("WebARCameraBackground",DM),q.add("WebARSessionRoot",$h),q.add("WebXR",On),q.add("WebXRImageTracking",gv),q.add("WebXRImageTrackingModel",Qc),q.add("WebXRPlaneTracking",nu),q.add("WebXRTrackedImage",mv),q.add("XRControllerFollow",ru),q.add("XRControllerModel",Dc),q.add("XRControllerMovement",ha),q.add("XRFlag",sa),q.add("XRRig",LM),q.add("XRState",po);const zx=Pr,S1e=te("debugtypestore");S1e&&console.log(q);function C1e(n,e){const i=w8(n,e);return i!==void 0?i:null}const E1e=new Lpe,C3=Symbol("deserialize-queue");async function M1e(n,e,i,r=null,s){if(!i)return;let o=r;typeof o=="number"&&(o=new xr(r));const a=e.indexOf("?");e=a===-1?e:e.substring(0,a);const l=new Nk(i.scene);l.gltfId=e,l.context=n,l.gltf=i,l.nodeToObject=s?.nodeToObjectMap,l.implementationInformation=E1e;let c=n[C3];if(c||(c=n[C3]=[]),i.scenes)for(const h of i.scenes)await T3(l,h,c);if(i.children)for(const h of i.children)await T3(l,h,c);n.new_scripts_pre_setup_callbacks.push(()=>{const h=n[C3];if(h){for(const u of h)T1e(u,l);h.length=0}if(o){const u={},d=[];M3(i,o,u,d);for(const f of i.scenes)M3(f,o,u,d);for(const f of d)f.resolveGuids(u)}})}const E3=Symbol("original-component-name"),Av=new Map;function M3(n,e,i,r){if(e===null||!n)return;const s=n.guid,o=n.guid;o!=null&&o.length&&(Av.has(o)||(zx&&console.log('Creating InstanceIdProvider with key "'+o+'" for object '+n.name),Av.set(o,new xr(o))));const a=o&&Av.get(o)||e;if(n.guid=a.generateUUID(),s&&s!=="invalid"&&(i[s]=n.guid),n&&n.userData&&n.userData.components)for(const l of n.userData.components){if(l===null)continue;const c=l.guid;c?Av.has(c)||(zx&&console.log('Creating InstanceIdProvider with key "'+c+'" for component '+l[E3]),Av.set(c,new xr(c))):zx&&console.warn("Can not create IdProvider: component "+l[E3]+" has no guid",l.guid);const h=Av.get(c)||e,u=l.guid;l.guid=h.generateUUID(),u&&u!=="invalid"&&(i[u]=l.guid),l.resolveGuids&&r.push(l)}if(n.children)for(const l of n.children)M3(l,e,i,r)}const jx=[];async function T3(n,e,i,r){if(!e)return;const s=e.userData;if(s){const o=s.builtin_components;if(o&&o.length>0)for(const a of o)try{if(a===null)continue;const l=q.get(a.name);if(l!=null){const c=new l;c.sourceId=n.gltfId,o0(c,a,n.implementationInformation),c.context=n.context,"guid"in a&&(c[Yy]=a.guid),c[E3]=a.name,Sf(e,c,!1),i.push({instance:c,compData:a,obj:e}),c.isCamera&&n.context&&n.context.mainCamera===null&&c.tag==="MainCamera"&&n.context.setCurrentCamera(c)}else zx&&console.debug("unknown component: "+a.name),jx.includes(a.name)||jx.push(a.name)}catch(l){console.error(a.name+" - "+l.message,l)}if(jx.length>0){const a=jx.join(", ");console.warn("unknown components: "+a),jx.length=0,eo()&&dn(`<strong>Unknown components in scene</strong>:

${a}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,Wo.Warn)}}if(e.children)for(const o of e.children)await T3(n,o,i)}function T1e(n,e){const{instance:i,compData:r,obj:s}=n;e.object=s,e.target=i,tC(i,r,e),zx&&console.debug("add "+r.name,r,i)}const N7=te("debugfileformat");async function z7(n,e=!0){var i;if(e){const s=n,o=new URL(s,globalThis.location.origin);let a=null;const l=o.searchParams.get("filetype");switch(l&&(a=l.toUpperCase()),a!=null&&a.length||(a=(i=o.pathname.split(".").pop())==null?void 0:i.toUpperCase()),a){case"GLTF":return"gltf";case"VRM":return"vrm";case"GLB":return"glb";case"FBX":return"fbx";case"USD":return"usd";case"USDA":return"usda";case"USDZ":return"usdz"}}const r=await fetch(n,{method:"GET",headers:{range:"bytes=0-32"}}).catch(s=>null);if(r!=null&&r.ok){const s=await r.arrayBuffer(),o=j7(s);return N7&&console.log("Determined file type from header: "+o),o}return"unknown"}function j7(n){if(n.byteLength<4)return"unknown";const e=new Uint8Array(n);return N7&&console.warn(`Trying to determine file type from binary data
`,'"'+new TextDecoder().decode(n)+`"
`,e),e[0]==103&&e[1]==108&&e[2]==84&&e[3]==70?"glb":e[0]==80&&e[1]==75&&e[2]==3&&e[3]==4?"usdz":e[0]==80&&e[1]==88&&e[2]==82&&e[3]==45&&e[4]==85&&e[5]==83&&e[6]==68&&e[7]==67?"usd":e[0]==35&&e[1]==117&&e[2]==115&&e[3]==100&&e[4]==97?"usda":e[0]==75&&e[1]==97&&e[2]==121&&e[3]==100&&e[4]==97&&e[5]==114&&e[6]==97&&e[7]==32?"fbx":e[0]==35&&e[1]==32&&e[2]==66&&e[3]==108&&e[4]==101&&e[5]==110&&e[6]==100&&e[7]==101&&e[8]==114&&e[9]==32?"obj":"unknown"}class I3{createBuiltinComponents(e,i,r,s,o){return M1e(e,i,r,s,o)}writeBuiltinComponentData(e,i){return C1e(e,i)}parseSync(e,i,r,s){return W7(e,i,r,s)}loadSync(e,i,r,s,o){return P3(e,i,r,s,o)}}o2(I3);const G7=te("printGltf")||te("printgltf"),H7=te("downloadgltf");var V7=(n=>(n[n.BeforeLoad=0]="BeforeLoad",n[n.AfterLoaded=1]="AfterLoaded",n[n.FinishedSetup=10]="FinishedSetup",n))(V7||{});class mm{constructor(e,i,r,s){p(this,"context"),p(this,"loader"),p(this,"path"),p(this,"gltf"),this.context=e,this.path=i,this.loader=r,this.gltf=s}}const np={};function I1e(n,e){np[n]=np[n]||[],np[n].push(e)}function R1e(n,e){if(np[n]){const i=np[n].indexOf(e);i>=0&&np[n].splice(i,1)}}function bv(n,e){if(np[n])for(const i of np[n])i(e)}async function Q7(n,e,i,r,s){G7&&console.warn("glTF",e,i),e.includes("?")&&(e=e.split("?")[0]),await ul().createBuiltinComponents(n,e,i,r,s)}async function R3(n,e){const i=await z7(n)||"unknown";switch(i){case"unknown":return console.warn("Unknown file type:",n),new gd;case"fbx":return new JV;case"obj":return new UO;case"usd":case"usda":case"usdz":return console.warn("USD files are not supported."),null;default:console.warn("Unknown file type:",i);case"gltf":case"glb":case"vrm":const r=new gd;return await YD(r,e,n),r}}async function W7(n,e,i,r){typeof i!="string"&&(console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",i,typeof i),i=""),G7&&console.log("Parse glTF",i);const s=await R3(i,n);if(!s)return;if(s instanceof UO){typeof e!="string"&&(e=new TextDecoder().decode(e));const a=s.parse(e);return{animations:a.animations,scene:a,scenes:[a]}}if(!(s instanceof gd)){const a=s.parse(e,i);return Y7(s,a),{animations:a.animations,scene:a,scenes:[a]}}const o=qD(s);return new Promise((a,l)=>{try{let c=i.split("?")[0].trimEnd();if(c.endsWith(".glb")||c.endsWith(".gltf")){const u=c.split("/");u.pop(),c=u.join("/"),c.endsWith("/")||(c+="/")}s.resourcePath=c,NC(s,n),bv(0,new mm(n,i,s));const h=n.mainCamera;s.parse(e,"",async u=>{KD(i,u,n),bv(1,new mm(n,i,s,u)),await Q7(n,i,u,r,o),await X7(u.scene,n,h),bv(10,new mm(n,i,s,u)),a(u),H7&&q7(e)},u=>{console.error("failed loading "+i,u),a(void 0)})}catch(c){console.error(c),l(c)}})}async function P3(n,e,i,r,s){P1e(e);const o=await R3(e,n);if(!o)return;if(!(o instanceof gd)){const l=await o.loadAsync(e,s);return Y7(o,l),{animations:l.animations,scene:l,scenes:[l]}}const a=qD(o);return new Promise((l,c)=>{try{NC(o,n),bv(0,new mm(n,e,o));const h=n.mainCamera;o.load(e,async u=>{KD(e,u,n),bv(1,new mm(n,e,o,u)),await Q7(n,i,u,r,a),await X7(u.scene,n,h),bv(10,new mm(n,e,o,u)),l(u),H7&&q7(e)},u=>{s?.call(o,u)},u=>{console.error("failed loading "+e,u),l(void 0)})}catch(h){console.error(h),c(h)}})}async function X7(n,e,i){i||(i=e.mainCamera),i?await e.renderer.compileAsync(n,i,e.scene):hpe(n,e)}function P1e(n){if(new URL(n,window.location.href).href.startsWith("file://")){const e=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;dn(e),console.warn(e)}}function q7(n){if(typeof n=="string"){const e=document.createElement("a");e.href=n,e.download=n.split("/").pop(),e.click()}else{const e=new Blob([n],{type:"application/octet-stream"}),i=window.URL.createObjectURL(e),r=document.createElement("a");r.href=i,r.download="download.glb",r.click()}}function Y7(n,e){if(e!=null&&e.isObject3D){const i=e;n instanceof JV?i.traverse(r=>{const s=r;s!=null&&s.isMesh&&hP(s,s.material)}):n instanceof UO&&i.traverse(r=>{})}}o2(I3);const yn=te("debugwebcomponent"),J7="needle-engine",K7="vr",Z7="desktop",B1e=[QV,K7,Z7],Gx="ar-session-active",Hx="desktop-session-active",k1e=["hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath","tone-mapping","tone-mapping-exposure"];class B3 extends HTMLElement{constructor(){super(),p(this,"_context"),p(this,"_overlay_ar"),p(this,"_loadingProgress01",0),p(this,"_loadingView"),p(this,"_previousSrc",null),p(this,"_didFullyLoad",!1),p(this,"_loadId",0),p(this,"_abortController",null),p(this,"_lastSourceFiles",null),p(this,"_createContextPromise",null),p(this,"onXRSessionStarted",()=>{var i;const r=this.context.xrSessionMode;r==="immersive-ar"?this.onEnterAR(this.context.xrSession):r==="immersive-vr"&&this.onEnterVR(this.context.xrSession),(i=this.context.xrSession)==null||i.addEventListener("end",()=>{this.dispatchEvent(new CustomEvent("xr-session-ended",{detail:{session:this.context.xrSession,context:this._context,sessionMode:r}})),r==="immersive-ar"?this.onExitAR(this.context.xrSession):r==="immersive-vr"&&this.onExitVR(this.context.xrSession)})}),p(this,"onReady",()=>{var i;return(i=this._loadingView)==null?void 0:i.onLoadingFinished()}),p(this,"onError",()=>{var i;return(i=this._loadingView)==null?void 0:i.setMessage("Loading failed!")}),p(this,"_previouslyRegisteredMap",new Map),this._overlay_ar=new ame,this.addEventListener("ready",this.onReady),DV(),this.attachShadow({mode:"open"});const e=document.createElement("template");e.innerHTML=`<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
        touch-action: none;
    }

    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }
    :host canvas {   
        position: absolute;
        user-select: none;
        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
    }
    :host .content {
        position: absolute;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        // top: env(titlebar-area-y); /** this doesnt work **/
        top: 60px; /** camera access needs a bit more space **/
        right: 20px;
        z-index: 9999;
    }
</style>
<div> <!-- this wrapper is necessary for WebXR https://github.com/meta-quest/immersive-web-emulator/issues/55 -->
    <canvas></canvas>
</div>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(e.content.cloneNode(!0)),this._context=new Ot({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return k1e}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const e=this.getAttribute("camera-controls");return e==null?null:!(e===null||e==="False"||e==="false"||e==="0")}getContext(){return new Promise((e,i)=>{if(this._context&&this.loadingFinished)e(this._context);else{const r=()=>{this.removeEventListener("loadfinished",r),this._context&&this.loadingFinished&&e(this._context)};this.addEventListener("loadfinished",r)}})}get context(){return this._context}async connectedCallback(){if(yn&&console.log("<needle-engine> connected"),this.addEventListener("xr-session-started",this.onXRSessionStarted),this.onSetupDesktop(),!this.getAttribute("src")){const i=globalThis["needle:codegen_files"];yn&&console.log('src is null, trying to load from globalThis["needle:codegen_files"]',i),i&&(yn&&console.log('globalThis["needle:codegen_files"]',i),this.setAttribute("src",i))}yn&&console.log("src",this.getAttribute("src"));const e=this._loadId;setTimeout(()=>{this.isConnected!==!1&&e===this._loadId&&this.onLoad()},1),ml!=null&&ml.length&&this.setAttribute("version",ml)}disconnectedCallback(){var e;this.removeEventListener("xr-session-started",this.onXRSessionStarted),this._didFullyLoad=!1;const i=this.getAttribute("keep-alive"),r=i==null||i?.length>0&&i!=="true"&&i!=="1";yn&&console.warn('<needle-engine> disconnected, keep-alive: "'+i+'"',typeof i,"Dispose=",r),r?(yn&&console.warn("<needle-engine> dispose"),(e=this._context)==null||e.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1):yn&&console.warn("<needle-engine> is not disposed because keep-alive is set")}attributeChangedCallback(e,i,r){switch(yn&&console.log("attributeChangedCallback",e,i,r),e){case"src":yn&&console.warn(`<needle-engine src>
changed from "`,i,'" to "',r,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=r);break;case"loadstart":case"progress":case"loadfinished":typeof r=="string"&&r.length>0&&(yn&&console.log(e+" attribute changed",r),this.registerEventFromAttribute(e,r));break;case"dracoDecoderPath":yn&&console.log("dracoDecoderPath",r),WV(r);break;case"dracoDecoderType":r==="wasm"||r==="js"?(yn&&console.log("dracoDecoderType",r),XV(r)):console.error("Invalid dracoDecoderType",r,"expected js or wasm");break;case"ktx2DecoderPath":yn&&console.log("ktx2DecoderPath",r),qV(r);break;case"tone-mapping":{this.applyTonemapping();break}case"tone-mapping-exposure":this.applyTonemapping()}}async onLoad(){var e,i;if(!this.isConnected)return;if(this._context||(yn&&console.warn("Create new context"),this._context=new Ot({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const r=this.getSourceFiles();if(!this.checkIfSourceHasChanged(r,this._lastSourceFiles))return;this._abortController&&(yn&&console.warn("Abort previous loading process"),this._abortController.abort(),this._abortController=null),this._lastSourceFiles=r;const s=++this._loadId;if((r==null||r.length<=0)&&(yn&&console.warn("Clear scene",r),this._context.clear(),s!==this._loadId))return;const o=this.getAttribute("alias");this.classList.add("loading");const a=Lh();this.ensureLoadStartIsRegistered();let l=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:o},cancelable:!0}));if(a){const y=this.getAttribute("hide-loading-overlay");y!=null&&y!=="0"&&(l=!1)}l===!1&&!a&&(it()||(l=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),it()&&Pi('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&l&&(this._loadingView=new CO(this)),l&&(this._didFullyLoad!==!0?(e=this._loadingView)==null||e.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===s&&this._loadingView.onLoadingBegin("begin load")},300)),yn&&console.warn(`--------------
Needle Engine: Begin loading `+s+`
`,r),this.onBeforeBeginLoading();const c=[],h={context:this._context,name:"",progress:{},index:0,count:r.length,totalProgress01:this._loadingProgress01},u=new CustomEvent("progress",{detail:h}),d=new Array,f=new AbortController;this._abortController=f;const m={files:r,abortSignal:f.signal,onLoadingProgress:y=>{var A;if(f.signal.aborted)return;const b=y.index;!d[b]&&y.name&&(d[b]=O1e(y.name)),y.name=d[b],l&&((A=this._loadingView)==null||A.onLoadingUpdate(y)),h.name=y.name,h.progress=y.progress,this._loadingProgress01=wO(y),h.totalProgress01=this._loadingProgress01,this.dispatchEvent(u)},onLoadingFinished:(y,A,b)=>{f.signal.aborted||b&&c.push({src:A,file:b})}},g=this.getAttribute("hash");g!=null&&(this._context.hash=g),this._context.alias=o,this._createContextPromise=this._context.create(m);const v=await this._createContextPromise;if(this.applyTonemapping(),yn&&console.warn(`--------------
Needle Engine: finished loading `+s+`
`,r,`Aborted? ${f.signal.aborted}`),this._loadId!==s||f.signal.aborted){console.log("Loading finished but aborted...");return}this._loadingProgress01=1,l&&v&&((i=this._loadingView)==null||i.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:o,loadedFiles:c}}))}applyTonemapping(){var e;if(!((e=this._context)!=null&&e.renderer))return;const i=this.getAttribute("tonemapping")||this.getAttribute("tone-mapping");switch(i?.toLowerCase()){case"none":this._context.renderer.toneMapping=Xs;break;case"linear":this._context.renderer.toneMapping=Tm;break;case"neutral":this._context.renderer.toneMapping=vp;break;case"agx":this._context.renderer.toneMapping=Im;break;default:i!=null&&console.warn("Invalid tone-mapping attribute: "+i)}const r=this.getAttribute("tone-mapping-exposure");if(r!=null){const s=parseFloat(r);isNaN(s)||(this._context.renderer.toneMappingExposure=s)}}internalSetLoadingMessage(e){var i;(i=this._loadingView)==null||i.setMessage(e)}getSourceFiles(){const e=this.getAttribute("src");if(!e)return[];let i;Array.isArray(e)?i=e:e.startsWith("[")&&e.endsWith("]")?i=JSON.parse(e):e.includes(",")?i=e.split(","):i=[e];for(let r=i.length-1;r>=0;r--){const s=i[r];(s==="null"||s==="undefined"||s?.length<=0)&&i.splice(r,1)}return i}checkIfSourceHasChanged(e,i){if(e?.length!==i?.length||e==null&&i!==null||e!==null&&i==null)return!0;if(e!==null&&i!==null){for(let r=0;r<e?.length;r++)if(e[r]!==i[r])return!0}return!1}ensureLoadStartIsRegistered(){const e=this.getAttribute("loadstart");e&&this.registerEventFromAttribute("loadstart",e)}registerEventFromAttribute(e,i){const r=this._previouslyRegisteredMap.get(e);if(r&&(this._previouslyRegisteredMap.delete(e),this.removeEventListener(e,r)),typeof i=="string"&&i.length>0)try{const s=(0,eval)(i);typeof s=="function"&&(this._previouslyRegisteredMap.set(e,s),this.addEventListener(e,o=>s?.call(globalThis,this._context,o)))}catch(s){console.error("Error registering event "+e+'="'+i+`" failed with the following error:
`,s)}}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let e=0;e<this.children.length;e++){const i=this.children[e];if(i.classList.contains("vr"))return i}return null}onEnterAR(e){var i;this.onSetupAR();const r=this.getAROverlayContainer();this._overlay_ar.onBegin(this._context,r,e),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:e,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onExitAR(e){var i;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:e,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onEnterVR(e){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:e,context:this._context}}))}onExitVR(e){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:e,context:this._context}}))}onSetupAR(){this.classList.add(Gx),this.classList.remove(Hx);const e=this.getAROverlayContainer();yn&&console.warn("onSetupAR:",e),e&&(e.classList.add(Gx),e.classList.remove(Hx)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,QV))}onSetupVR(){this.classList.remove(Gx),this.classList.remove(Hx),this.foreachHtmlElement(e=>this.setupElementsForMode(e,K7))}onSetupDesktop(){this.classList.remove(Gx),this.classList.add(Hx);const e=this.getAROverlayContainer();e&&(e.classList.remove(Gx),e.classList.add(Hx)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,Z7))}setupElementsForMode(e,i,r=null){var s,o;if(!(e===((o=(s=this._context)==null?void 0:s.renderer)==null?void 0:o.domElement)||e.id==="VRButton"||e.id==="ARButton"))if(e.classList.contains(i))e.style.visibility="visible",e.style.display==="none"&&(e.style.display="block");else for(const a of B1e)e.classList.contains(a)&&(e.style.visibility="hidden",e.style.display="none")}foreachHtmlElement(e){for(let i=0;i<this.children.length;i++){const r=this.children[i];r.style&&e(r)}}onBeforeBeginLoading(){const e=this.getAttribute("dracoDecoderPath");e&&(yn&&console.log("using custom draco decoder path",e),WV(e));const i=this.getAttribute("dracoDecoderType");i&&(yn&&console.log("using custom draco decoder type",i),XV(i));const r=this.getAttribute("ktx2DecoderPath");r&&(yn&&console.log("using custom ktx2 decoder path",r),qV(r))}}typeof window<"u"&&!window.customElements.get(J7)&&window.customElements.define(J7,B3);function O1e(n){if(n.startsWith("blob:"))return"blob";const e=n.split("/");let i=e[e.length-1];const r=i.indexOf("?");r>0&&(i=i.substring(0,r));const s=i.indexOf("=");s>0&&(i=i.substring(s));const o=i.split(".").pop();if((o==="glb"||o==="gltf")&&(i=i.substring(0,i.length-4)),i=decodeURIComponent(i),i.length>3){let a="";for(let l=0;l<i.length;l++){let c=i[l];if(c===" "&&a.length<=0)continue;const h=a.length===0,u=c>="0"&&c<="9";h==!1&&c===c.toUpperCase()&&!u?a+=" "+c:(h&&(c=c.toUpperCase()),a+=c)}return yn&&console.log("displayName",i,a),a}return yn&&console.log("displayName",i),i}const D1e=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:B3},Symbol.toStringTag,{value:"Module"}));function L1e(){kh.registerWaitForAllowAudio(()=>{const n=Ww.getContext();n.addEventListener("statechange",()=>{setTimeout(()=>{const e=n.state;(e==="suspended"||e==="interrupted")&&n.resume().then(()=>{console.log("AudioContext resumed successfully")}).catch(i=>{console.log("Failed to resume AudioContext: "+i)})},500)})})}setTimeout(L1e,1e3);const UM=te("debughotreload");let Vx=!1;const Qx=new Map;function U1e(){return Vx}function F1e(n){var e;if(Vx)return;const i=n.constructor.name;Qx.has(i)?(e=Qx.get(i))==null||e.push(n):Qx.set(i,[n])}function N1e(n){if(Vx)return;const e=n.constructor.name,i=Qx.get(e);if(!i)return;const r=i.indexOf(n);r!==-1&&i.splice(r,1)}let $7=!1;function z1e(){if(UM||$7)return;$7=!0;const n=console.error;console.error=(...e)=>{if(e.length){const i=e[0];if(typeof i=="string"&&i.includes("[hmr] Failed to reload ")){console.log("[Needle Engine] Hot reloading failed"),window.location.reload();return}}n.apply(console,e)}}function j1e(n){UM&&console.log("[HMR] Apply changes",n,Object.keys(n)),z1e();for(const e of Object.keys(n))try{Vx=!0;const i=q.get(e);if(!i){UM&&console.log("[HMR] Type not found: "+e);continue}const r=n[e],s=Qx.get(r.name);let o="[Needle Engine] Updating type: "+e;const a=s?.length??-1;a>0?o+=" x"+a:o+=" - no instances",console.log(o);const l=Object.getOwnPropertyNames(i.prototype),c=Object.getOwnPropertyDescriptors(r.prototype);for(const h in c)c[h].writable&&(i.prototype[h]=n[e].prototype[h]);for(const h of l)c[h]||delete i.prototype[h];if(s){const h=new r,u=Object.getOwnPropertyDescriptors(h);for(const d of s){const f=d,m=f.isComponent===!0,g=m?f.activeAndEnabled:!0,v=m?f.context:void 0;try{if(m&&v&&Ph(f,v),m&&g&&(f.enabled=!1),d.onBeforeHotReloadFields&&d.onBeforeHotReloadFields()===!1)continue;for(const y in u)if(u[y].writable){if(d[y]===void 0)d[y]=h[y];else if(typeof d[y]=="function"&&!d[y].prototype){const A=d[y],b=A.name,x="bound ";if(b===x)continue;const _=A.name.substring(x.length),w=r.prototype[_];w&&(d[y]=w.bind(d))}}d.onAfterHotReloadFields&&d.onAfterHotReloadFields()}finally{m&&v&&Ck(f,v),m&&g&&(f.enabled=!0)}}}}catch(i){if(UM)console.error(i);else return!1}finally{Vx=!1,tc(Wo.Log,"Script changes applied (HMR)")}return!0}let Ne;const Wx=new Array(128).fill(void 0);Wx.push(void 0,null,!0,!1),Wx.length;let FM=null;function eX(){return FM!==null&&FM.byteLength!==0||(FM=new Int32Array(Ne.memory.buffer)),FM}const G1e=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&G1e.decode();function mt(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`);return n.ptr}let NM=null;function H1e(){return NM!==null&&NM.byteLength!==0||(NM=new Float32Array(Ne.memory.buffer)),NM}let Xx=128;function tX(n){if(Xx==1)throw new Error("out of js stack");return Wx[--Xx]=n,Xx}let zM=null;function V1e(){return zM!==null&&zM.byteLength!==0||(zM=new Uint32Array(Ne.memory.buffer)),zM}let ma=0;function gm(n,e){const i=e(4*n.length,4)>>>0;return H1e().set(n,i/4),ma=n.length,i}function jM(n,e){const i=e(4*n.length,4)>>>0;return V1e().set(n,i/4),ma=n.length,i}const vs=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"});class Q1e{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ne.__wbg_raweventqueue_free(e)}constructor(e){const i=Ne.raweventqueue_new(e);return this.__wbg_ptr=i>>>0,this}drainCollisionEvents(e){try{Ne.raweventqueue_drainCollisionEvents(this.__wbg_ptr,tX(e))}finally{Wx[Xx++]=void 0}}drainContactForceEvents(e){try{Ne.raweventqueue_drainContactForceEvents(this.__wbg_ptr,tX(e))}finally{Wx[Xx++]=void 0}}clear(){Ne.raweventqueue_clear(this.__wbg_ptr)}}class Ws{static __wrap(e){e>>>=0;const i=Object.create(Ws.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ne.__wbg_rawgenericjoint_free(e)}static generic(e,i,r,s){mt(e,lt),mt(i,lt),mt(r,lt);const o=Ne.rawgenericjoint_generic(e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s);return o===0?void 0:Ws.__wrap(o)}static spring(e,i,r,s,o){mt(s,lt),mt(o,lt);const a=Ne.rawgenericjoint_spring(e,i,r,s.__wbg_ptr,o.__wbg_ptr);return Ws.__wrap(a)}static rope(e,i,r){mt(i,lt),mt(r,lt);const s=Ne.rawgenericjoint_rope(e,i.__wbg_ptr,r.__wbg_ptr);return Ws.__wrap(s)}static spherical(e,i){mt(e,lt),mt(i,lt);const r=Ne.rawgenericjoint_spherical(e.__wbg_ptr,i.__wbg_ptr);return Ws.__wrap(r)}static prismatic(e,i,r,s,o,a){mt(e,lt),mt(i,lt),mt(r,lt);const l=Ne.rawgenericjoint_prismatic(e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s,o,a);return l===0?void 0:Ws.__wrap(l)}static fixed(e,i,r,s){mt(e,lt),mt(i,As),mt(r,lt),mt(s,As);const o=Ne.rawgenericjoint_fixed(e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s.__wbg_ptr);return Ws.__wrap(o)}static revolute(e,i,r){mt(e,lt),mt(i,lt),mt(r,lt);const s=Ne.rawgenericjoint_revolute(e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr);return s===0?void 0:Ws.__wrap(s)}}class CU{static __wrap(e){e>>>=0;const i=Object.create(CU.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ne.__wbg_rawpointprojection_free(e)}point(){const e=Ne.rawpointprojection_point(this.__wbg_ptr);return lt.__wrap(e)}isInside(){return Ne.rawpointprojection_isInside(this.__wbg_ptr)!==0}}class EU{static __wrap(e){e>>>=0;const i=Object.create(EU.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ne.__wbg_rawrayintersection_free(e)}normal(){const e=Ne.rawraycolliderintersection_normal(this.__wbg_ptr);return lt.__wrap(e)}toi(){return Ne.rawraycolliderintersection_toi(this.__wbg_ptr)}featureType(){return Ne.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const r=Ne.__wbindgen_add_to_stack_pointer(-16);Ne.rawpointcolliderprojection_featureId(r,this.__wbg_ptr);var e=eX()[r/4+0],i=eX()[r/4+1];return e===0?void 0:i>>>0}finally{Ne.__wbindgen_add_to_stack_pointer(16)}}}class As{static __wrap(e){e>>>=0;const i=Object.create(As.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ne.__wbg_rawrotation_free(e)}constructor(e,i,r,s){const o=Ne.rawrotation_new(e,i,r,s);return this.__wbg_ptr=o>>>0,this}static identity(){const e=Ne.rawrotation_identity();return As.__wrap(e)}get x(){return Ne.rawrotation_x(this.__wbg_ptr)}get y(){return Ne.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return Ne.rawraycolliderintersection_toi(this.__wbg_ptr)}get w(){return Ne.rawintegrationparameters_erp(this.__wbg_ptr)}}class Wt{static __wrap(e){e>>>=0;const i=Object.create(Wt.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ne.__wbg_rawshape_free(e)}static cuboid(e,i,r){const s=Ne.rawshape_cuboid(e,i,r);return Wt.__wrap(s)}static roundCuboid(e,i,r,s){const o=Ne.rawshape_roundCuboid(e,i,r,s);return Wt.__wrap(o)}static ball(e){const i=Ne.rawshape_ball(e);return Wt.__wrap(i)}static halfspace(e){mt(e,lt);const i=Ne.rawshape_halfspace(e.__wbg_ptr);return Wt.__wrap(i)}static capsule(e,i){const r=Ne.rawshape_capsule(e,i);return Wt.__wrap(r)}static cylinder(e,i){const r=Ne.rawshape_cylinder(e,i);return Wt.__wrap(r)}static roundCylinder(e,i,r){const s=Ne.rawshape_roundCylinder(e,i,r);return Wt.__wrap(s)}static cone(e,i){const r=Ne.rawshape_cone(e,i);return Wt.__wrap(r)}static roundCone(e,i,r){const s=Ne.rawshape_roundCone(e,i,r);return Wt.__wrap(s)}static polyline(e,i){const r=gm(e,Ne.__wbindgen_malloc),s=ma,o=jM(i,Ne.__wbindgen_malloc),a=ma,l=Ne.rawshape_polyline(r,s,o,a);return Wt.__wrap(l)}static trimesh(e,i){const r=gm(e,Ne.__wbindgen_malloc),s=ma,o=jM(i,Ne.__wbindgen_malloc),a=ma,l=Ne.rawshape_trimesh(r,s,o,a);return Wt.__wrap(l)}static heightfield(e,i,r,s){const o=gm(r,Ne.__wbindgen_malloc),a=ma;mt(s,lt);const l=Ne.rawshape_heightfield(e,i,o,a,s.__wbg_ptr);return Wt.__wrap(l)}static segment(e,i){mt(e,lt),mt(i,lt);const r=Ne.rawshape_segment(e.__wbg_ptr,i.__wbg_ptr);return Wt.__wrap(r)}static triangle(e,i,r){mt(e,lt),mt(i,lt),mt(r,lt);const s=Ne.rawshape_triangle(e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr);return Wt.__wrap(s)}static roundTriangle(e,i,r,s){mt(e,lt),mt(i,lt),mt(r,lt);const o=Ne.rawshape_roundTriangle(e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s);return Wt.__wrap(o)}static convexHull(e){const i=gm(e,Ne.__wbindgen_malloc),r=ma,s=Ne.rawshape_convexHull(i,r);return s===0?void 0:Wt.__wrap(s)}static roundConvexHull(e,i){const r=gm(e,Ne.__wbindgen_malloc),s=ma,o=Ne.rawshape_roundConvexHull(r,s,i);return o===0?void 0:Wt.__wrap(o)}static convexMesh(e,i){const r=gm(e,Ne.__wbindgen_malloc),s=ma,o=jM(i,Ne.__wbindgen_malloc),a=ma,l=Ne.rawshape_convexMesh(r,s,o,a);return l===0?void 0:Wt.__wrap(l)}static roundConvexMesh(e,i,r){const s=gm(e,Ne.__wbindgen_malloc),o=ma,a=jM(i,Ne.__wbindgen_malloc),l=ma,c=Ne.rawshape_roundConvexMesh(s,o,a,l,r);return c===0?void 0:Wt.__wrap(c)}castShape(e,i,r,s,o,a,l,c,h){mt(e,lt),mt(i,As),mt(r,lt),mt(s,Wt),mt(o,lt),mt(a,As),mt(l,lt);const u=Ne.rawshape_castShape(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s.__wbg_ptr,o.__wbg_ptr,a.__wbg_ptr,l.__wbg_ptr,c,h);return u===0?void 0:TU.__wrap(u)}intersectsShape(e,i,r,s,o){return mt(e,lt),mt(i,As),mt(r,Wt),mt(s,lt),mt(o,As),Ne.rawshape_intersectsShape(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s.__wbg_ptr,o.__wbg_ptr)!==0}contactShape(e,i,r,s,o,a){mt(e,lt),mt(i,As),mt(r,Wt),mt(s,lt),mt(o,As);const l=Ne.rawshape_contactShape(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s.__wbg_ptr,o.__wbg_ptr,a);return l===0?void 0:MU.__wrap(l)}containsPoint(e,i,r){return mt(e,lt),mt(i,As),mt(r,lt),Ne.rawshape_containsPoint(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr)!==0}projectPoint(e,i,r,s){mt(e,lt),mt(i,As),mt(r,lt);const o=Ne.rawshape_projectPoint(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s);return CU.__wrap(o)}intersectsRay(e,i,r,s,o){return mt(e,lt),mt(i,As),mt(r,lt),mt(s,lt),Ne.rawshape_intersectsRay(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s.__wbg_ptr,o)!==0}castRay(e,i,r,s,o,a){return mt(e,lt),mt(i,As),mt(r,lt),mt(s,lt),Ne.rawshape_castRay(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s.__wbg_ptr,o,a)}castRayAndGetNormal(e,i,r,s,o,a){mt(e,lt),mt(i,As),mt(r,lt),mt(s,lt);const l=Ne.rawshape_castRayAndGetNormal(this.__wbg_ptr,e.__wbg_ptr,i.__wbg_ptr,r.__wbg_ptr,s.__wbg_ptr,o,a);return l===0?void 0:EU.__wrap(l)}}class MU{static __wrap(e){e>>>=0;const i=Object.create(MU.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ne.__wbg_rawshapecontact_free(e)}distance(){return Ne.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const e=Ne.rawpointprojection_point(this.__wbg_ptr);return lt.__wrap(e)}point2(){const e=Ne.rawraycolliderintersection_normal(this.__wbg_ptr);return lt.__wrap(e)}normal1(){const e=Ne.rawshapecollidertoi_witness2(this.__wbg_ptr);return lt.__wrap(e)}normal2(){const e=Ne.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return lt.__wrap(e)}}class TU{static __wrap(e){e>>>=0;const i=Object.create(TU.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ne.__wbg_rawshapetoi_free(e)}toi(){return Ne.rawrotation_x(this.__wbg_ptr)}witness1(){const e=Ne.rawshapetoi_witness1(this.__wbg_ptr);return lt.__wrap(e)}witness2(){const e=Ne.rawcontactforceevent_total_force(this.__wbg_ptr);return lt.__wrap(e)}normal1(){const e=Ne.rawshapetoi_normal1(this.__wbg_ptr);return lt.__wrap(e)}normal2(){const e=Ne.rawshapetoi_normal2(this.__wbg_ptr);return lt.__wrap(e)}}class lt{static __wrap(e){e>>>=0;const i=Object.create(lt.prototype);return i.__wbg_ptr=e,i}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ne.__wbg_rawvector_free(e)}static zero(){const e=Ne.rawvector_zero();return lt.__wrap(e)}constructor(e,i,r){const s=Ne.rawvector_new(e,i,r);return this.__wbg_ptr=s>>>0,this}get x(){return Ne.rawrotation_x(this.__wbg_ptr)}set x(e){Ne.rawvector_set_x(this.__wbg_ptr,e)}get y(){return Ne.rawintegrationparameters_dt(this.__wbg_ptr)}set y(e){Ne.rawintegrationparameters_set_dt(this.__wbg_ptr,e)}get z(){return Ne.rawraycolliderintersection_toi(this.__wbg_ptr)}set z(e){Ne.rawvector_set_z(this.__wbg_ptr,e)}xyz(){const e=Ne.rawvector_xyz(this.__wbg_ptr);return lt.__wrap(e)}yxz(){const e=Ne.rawvector_yxz(this.__wbg_ptr);return lt.__wrap(e)}zxy(){const e=Ne.rawvector_zxy(this.__wbg_ptr);return lt.__wrap(e)}xzy(){const e=Ne.rawvector_xzy(this.__wbg_ptr);return lt.__wrap(e)}yzx(){const e=Ne.rawvector_yzx(this.__wbg_ptr);return lt.__wrap(e)}zyx(){const e=Ne.rawvector_zyx(this.__wbg_ptr);return lt.__wrap(e)}}class W1e{constructor(e,i,r){this.x=e,this.y=i,this.z=r}}class ke{static new(e,i,r){return new W1e(e,i,r)}static intoRaw(e){return new lt(e.x,e.y,e.z)}static zeros(){return ke.new(0,0,0)}static fromRaw(e){if(!e)return null;let i=ke.new(e.x,e.y,e.z);return e.free(),i}static copy(e,i){e.x=i.x,e.y=i.y,e.z=i.z}}class iX{constructor(e,i,r,s){this.x=e,this.y=i,this.z=r,this.w=s}}class Yi{static identity(){return new iX(0,0,0,1)}static fromRaw(e){if(!e)return null;let i=new iX(e.x,e.y,e.z,e.w);return e.free(),i}static intoRaw(e){return new As(e.x,e.y,e.z,e.w)}static copy(e,i){e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w}}class X1e{constructor(e){this.elements=e}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class nX{static fromRaw(e){const i=new X1e(e.elements());return e.free(),i}}var qx,Vs,rX,sX,ar,k3,Qn,oX,GM,O3,aX,HM,xv;(function(n){n[n.Dynamic=0]="Dynamic",n[n.Fixed=1]="Fixed",n[n.KinematicPositionBased=2]="KinematicPositionBased",n[n.KinematicVelocityBased=3]="KinematicVelocityBased"})(qx||(qx={}));class lX{constructor(e,i,r){this.rawSet=e,this.colliderSet=i,this.handle=r}finalizeDeserialization(e){this.colliderSet=e}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(e,i){return this.rawSet.rbLockTranslations(this.handle,e,i)}lockRotations(e,i){return this.rawSet.rbLockRotations(this.handle,e,i)}setEnabledTranslations(e,i,r,s){return this.rawSet.rbSetEnabledTranslations(this.handle,e,i,r,s)}restrictTranslations(e,i,r,s){this.setEnabledTranslations(e,i,r,s)}setEnabledRotations(e,i,r,s){return this.rawSet.rbSetEnabledRotations(this.handle,e,i,r,s)}restrictRotations(e,i,r,s){this.setEnabledRotations(e,i,r,s)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(e){this.rawSet.rbSetDominanceGroup(this.handle,e)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(e){this.rawSet.rbSetAdditionalSolverIterations(this.handle,e)}enableCcd(e){this.rawSet.rbEnableCcd(this.handle,e)}translation(){let e=this.rawSet.rbTranslation(this.handle);return ke.fromRaw(e)}rotation(){let e=this.rawSet.rbRotation(this.handle);return Yi.fromRaw(e)}nextTranslation(){let e=this.rawSet.rbNextTranslation(this.handle);return ke.fromRaw(e)}nextRotation(){let e=this.rawSet.rbNextRotation(this.handle);return Yi.fromRaw(e)}setTranslation(e,i){this.rawSet.rbSetTranslation(this.handle,e.x,e.y,e.z,i)}setLinvel(e,i){let r=ke.intoRaw(e);this.rawSet.rbSetLinvel(this.handle,r,i),r.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(e,i){this.rawSet.rbSetGravityScale(this.handle,e,i)}setRotation(e,i){this.rawSet.rbSetRotation(this.handle,e.x,e.y,e.z,e.w,i)}setAngvel(e,i){let r=ke.intoRaw(e);this.rawSet.rbSetAngvel(this.handle,r,i),r.free()}setNextKinematicTranslation(e){this.rawSet.rbSetNextKinematicTranslation(this.handle,e.x,e.y,e.z)}setNextKinematicRotation(e){this.rawSet.rbSetNextKinematicRotation(this.handle,e.x,e.y,e.z,e.w)}linvel(){return ke.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return ke.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return ke.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return ke.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return ke.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return ke.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return ke.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return Yi.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return nX.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return nX.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(e){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,e))}setEnabled(e){this.rawSet.rbSetEnabled(this.handle,e)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(e,i){return this.rawSet.rbSetBodyType(this.handle,e,i)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(e){this.rawSet.rbSetLinearDamping(this.handle,e)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(e,i){this.rawSet.rbSetAdditionalMass(this.handle,e,i)}setAdditionalMassProperties(e,i,r,s,o){let a=ke.intoRaw(i),l=ke.intoRaw(r),c=Yi.intoRaw(s);this.rawSet.rbSetAdditionalMassProperties(this.handle,e,a,l,c,o),a.free(),l.free(),c.free()}setAngularDamping(e){this.rawSet.rbSetAngularDamping(this.handle,e)}resetForces(e){this.rawSet.rbResetForces(this.handle,e)}resetTorques(e){this.rawSet.rbResetTorques(this.handle,e)}addForce(e,i){const r=ke.intoRaw(e);this.rawSet.rbAddForce(this.handle,r,i),r.free()}applyImpulse(e,i){const r=ke.intoRaw(e);this.rawSet.rbApplyImpulse(this.handle,r,i),r.free()}addTorque(e,i){const r=ke.intoRaw(e);this.rawSet.rbAddTorque(this.handle,r,i),r.free()}applyTorqueImpulse(e,i){const r=ke.intoRaw(e);this.rawSet.rbApplyTorqueImpulse(this.handle,r,i),r.free()}addForceAtPoint(e,i,r){const s=ke.intoRaw(e),o=ke.intoRaw(i);this.rawSet.rbAddForceAtPoint(this.handle,s,o,r),s.free(),o.free()}applyImpulseAtPoint(e,i,r){const s=ke.intoRaw(e),o=ke.intoRaw(i);this.rawSet.rbApplyImpulseAtPoint(this.handle,s,o,r),s.free(),o.free()}}(function(n){n[n.Revolute=0]="Revolute",n[n.Fixed=1]="Fixed",n[n.Prismatic=2]="Prismatic",n[n.Rope=3]="Rope",n[n.Spring=4]="Spring",n[n.Spherical=5]="Spherical",n[n.Generic=6]="Generic"})(Vs||(Vs={})),function(n){n[n.AccelerationBased=0]="AccelerationBased",n[n.ForceBased=1]="ForceBased"}(rX||(rX={})),function(n){n[n.X=1]="X",n[n.Y=2]="Y",n[n.Z=4]="Z",n[n.AngX=8]="AngX",n[n.AngY=16]="AngY",n[n.AngZ=32]="AngZ"}(sX||(sX={}));class uu{constructor(){}static fixed(e,i,r,s){let o=new uu;return o.anchor1=e,o.anchor2=r,o.frame1=i,o.frame2=s,o.jointType=Vs.Fixed,o}static spring(e,i,r,s,o){let a=new uu;return a.anchor1=s,a.anchor2=o,a.length=e,a.stiffness=i,a.damping=r,a.jointType=Vs.Spring,a}static rope(e,i,r){let s=new uu;return s.anchor1=i,s.anchor2=r,s.length=e,s.jointType=Vs.Rope,s}static generic(e,i,r,s){let o=new uu;return o.anchor1=e,o.anchor2=i,o.axis=r,o.axesMask=s,o.jointType=Vs.Generic,o}static spherical(e,i){let r=new uu;return r.anchor1=e,r.anchor2=i,r.jointType=Vs.Spherical,r}static prismatic(e,i,r){let s=new uu;return s.anchor1=e,s.anchor2=i,s.axis=r,s.jointType=Vs.Prismatic,s}static revolute(e,i,r){let s=new uu;return s.anchor1=e,s.anchor2=i,s.axis=r,s.jointType=Vs.Revolute,s}intoRaw(){let e,i,r=ke.intoRaw(this.anchor1),s=ke.intoRaw(this.anchor2),o=!1,a=0,l=0;switch(this.jointType){case Vs.Fixed:let c=Yi.intoRaw(this.frame1),h=Yi.intoRaw(this.frame2);i=Ws.fixed(r,c,s,h),c.free(),h.free();break;case Vs.Spring:i=Ws.spring(this.length,this.stiffness,this.damping,r,s);break;case Vs.Rope:i=Ws.rope(this.length,r,s);break;case Vs.Prismatic:e=ke.intoRaw(this.axis),this.limitsEnabled&&(o=!0,a=this.limits[0],l=this.limits[1]),i=Ws.prismatic(r,s,e,o,a,l),e.free();break;case Vs.Generic:e=ke.intoRaw(this.axis);let u=this.axesMask;i=Ws.generic(r,s,e,u);break;case Vs.Spherical:i=Ws.spherical(r,s);break;case Vs.Revolute:e=ke.intoRaw(this.axis),i=Ws.revolute(r,s,e),e.free()}return r.free(),s.free(),i}}(function(n){n[n.Average=0]="Average",n[n.Min=1]="Min",n[n.Multiply=2]="Multiply",n[n.Max=3]="Max"})(ar||(ar={}));class p_{constructor(e,i,r,s,o){this.distance=e,this.point1=i,this.point2=r,this.normal1=s,this.normal2=o}static fromRaw(e){if(!e)return null;const i=new p_(e.distance(),ke.fromRaw(e.point1()),ke.fromRaw(e.point2()),ke.fromRaw(e.normal1()),ke.fromRaw(e.normal2()));return e.free(),i}}(function(n){n[n.Vertex=0]="Vertex",n[n.Edge=1]="Edge",n[n.Face=2]="Face",n[n.Unknown=3]="Unknown"})(k3||(k3={}));class OT{constructor(e,i){this.point=e,this.isInside=i}static fromRaw(e){if(!e)return null;const i=new OT(ke.fromRaw(e.point()),e.isInside());return e.free(),i}}class q1e{constructor(e,i){this.origin=e,this.dir=i}pointAt(e){return{x:this.origin.x+this.dir.x*e,y:this.origin.y+this.dir.y*e,z:this.origin.z+this.dir.z*e}}}class DT{constructor(e,i,r,s){this.featureType=k3.Unknown,this.featureId=void 0,this.toi=e,this.normal=i,s!==void 0&&(this.featureId=s),r!==void 0&&(this.featureType=r)}static fromRaw(e){if(!e)return null;const i=new DT(e.toi(),ke.fromRaw(e.normal()),e.featureType(),e.featureId());return e.free(),i}}class f_{constructor(e,i,r,s,o){this.toi=e,this.witness1=i,this.witness2=r,this.normal1=s,this.normal2=o}static fromRaw(e,i){if(!i)return null;const r=new f_(i.toi(),ke.fromRaw(i.witness1()),ke.fromRaw(i.witness2()),ke.fromRaw(i.normal1()),ke.fromRaw(i.normal2()));return i.free(),r}}class IU extends f_{constructor(e,i,r,s,o,a){super(i,r,s,o,a),this.collider=e}static fromRaw(e,i){if(!i)return null;const r=new IU(e.get(i.colliderHandle()),i.toi(),ke.fromRaw(i.witness1()),ke.fromRaw(i.witness2()),ke.fromRaw(i.normal1()),ke.fromRaw(i.normal2()));return i.free(),r}}class Vr{static fromRaw(e,i){const r=e.coShapeType(i);let s,o,a,l,c,h,u;switch(r){case vs.Ball:return new D3(e.coRadius(i));case vs.Cuboid:return s=e.coHalfExtents(i),new cX(s.x,s.y,s.z);case vs.RoundCuboid:return s=e.coHalfExtents(i),o=e.coRoundRadius(i),new hX(s.x,s.y,s.z,o);case vs.Capsule:return c=e.coHalfHeight(i),h=e.coRadius(i),new uX(c,h);case vs.Segment:return a=e.coVertices(i),new dX(ke.new(a[0],a[1],a[2]),ke.new(a[3],a[4],a[5]));case vs.Polyline:return a=e.coVertices(i),l=e.coIndices(i),new mX(a,l);case vs.Triangle:return a=e.coVertices(i),new pX(ke.new(a[0],a[1],a[2]),ke.new(a[3],a[4],a[5]),ke.new(a[6],a[7],a[8]));case vs.RoundTriangle:return a=e.coVertices(i),o=e.coRoundRadius(i),new fX(ke.new(a[0],a[1],a[2]),ke.new(a[3],a[4],a[5]),ke.new(a[6],a[7],a[8]),o);case vs.HalfSpace:return u=ke.fromRaw(e.coHalfspaceNormal(i)),new Y1e(u);case vs.TriMesh:return a=e.coVertices(i),l=e.coIndices(i),new gX(a,l);case vs.HeightField:const d=e.coHeightfieldScale(i),f=e.coHeightfieldHeights(i),m=e.coHeightfieldNRows(i),g=e.coHeightfieldNCols(i);return new vX(m,g,f,d);case vs.ConvexPolyhedron:return a=e.coVertices(i),l=e.coIndices(i),new L3(a,l);case vs.RoundConvexPolyhedron:return a=e.coVertices(i),l=e.coIndices(i),o=e.coRoundRadius(i),new U3(a,l,o);case vs.Cylinder:return c=e.coHalfHeight(i),h=e.coRadius(i),new yX(c,h);case vs.RoundCylinder:return c=e.coHalfHeight(i),h=e.coRadius(i),o=e.coRoundRadius(i),new AX(c,h,o);case vs.Cone:return c=e.coHalfHeight(i),h=e.coRadius(i),new bX(c,h);case vs.RoundCone:return c=e.coHalfHeight(i),h=e.coRadius(i),o=e.coRoundRadius(i),new xX(c,h,o);default:throw new Error("unknown shape type: "+r)}}castShape(e,i,r,s,o,a,l,c,h){let u=ke.intoRaw(e),d=Yi.intoRaw(i),f=ke.intoRaw(r),m=ke.intoRaw(o),g=Yi.intoRaw(a),v=ke.intoRaw(l),y=this.intoRaw(),A=s.intoRaw(),b=f_.fromRaw(null,y.castShape(u,d,f,A,m,g,v,c,h));return u.free(),d.free(),f.free(),m.free(),g.free(),v.free(),y.free(),A.free(),b}intersectsShape(e,i,r,s,o){let a=ke.intoRaw(e),l=Yi.intoRaw(i),c=ke.intoRaw(s),h=Yi.intoRaw(o),u=this.intoRaw(),d=r.intoRaw(),f=u.intersectsShape(a,l,d,c,h);return a.free(),l.free(),c.free(),h.free(),u.free(),d.free(),f}contactShape(e,i,r,s,o,a){let l=ke.intoRaw(e),c=Yi.intoRaw(i),h=ke.intoRaw(s),u=Yi.intoRaw(o),d=this.intoRaw(),f=r.intoRaw(),m=p_.fromRaw(d.contactShape(l,c,f,h,u,a));return l.free(),c.free(),h.free(),u.free(),d.free(),f.free(),m}containsPoint(e,i,r){let s=ke.intoRaw(e),o=Yi.intoRaw(i),a=ke.intoRaw(r),l=this.intoRaw(),c=l.containsPoint(s,o,a);return s.free(),o.free(),a.free(),l.free(),c}projectPoint(e,i,r,s){let o=ke.intoRaw(e),a=Yi.intoRaw(i),l=ke.intoRaw(r),c=this.intoRaw(),h=OT.fromRaw(c.projectPoint(o,a,l,s));return o.free(),a.free(),l.free(),c.free(),h}intersectsRay(e,i,r,s){let o=ke.intoRaw(i),a=Yi.intoRaw(r),l=ke.intoRaw(e.origin),c=ke.intoRaw(e.dir),h=this.intoRaw(),u=h.intersectsRay(o,a,l,c,s);return o.free(),a.free(),l.free(),c.free(),h.free(),u}castRay(e,i,r,s,o){let a=ke.intoRaw(i),l=Yi.intoRaw(r),c=ke.intoRaw(e.origin),h=ke.intoRaw(e.dir),u=this.intoRaw(),d=u.castRay(a,l,c,h,s,o);return a.free(),l.free(),c.free(),h.free(),u.free(),d}castRayAndGetNormal(e,i,r,s,o){let a=ke.intoRaw(i),l=Yi.intoRaw(r),c=ke.intoRaw(e.origin),h=ke.intoRaw(e.dir),u=this.intoRaw(),d=DT.fromRaw(u.castRayAndGetNormal(a,l,c,h,s,o));return a.free(),l.free(),c.free(),h.free(),u.free(),d}}(function(n){n[n.Ball=0]="Ball",n[n.Cuboid=1]="Cuboid",n[n.Capsule=2]="Capsule",n[n.Segment=3]="Segment",n[n.Polyline=4]="Polyline",n[n.Triangle=5]="Triangle",n[n.TriMesh=6]="TriMesh",n[n.HeightField=7]="HeightField",n[n.ConvexPolyhedron=9]="ConvexPolyhedron",n[n.Cylinder=10]="Cylinder",n[n.Cone=11]="Cone",n[n.RoundCuboid=12]="RoundCuboid",n[n.RoundTriangle=13]="RoundTriangle",n[n.RoundCylinder=14]="RoundCylinder",n[n.RoundCone=15]="RoundCone",n[n.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",n[n.HalfSpace=17]="HalfSpace"})(Qn||(Qn={}));class D3 extends Vr{constructor(e){super(),this.type=Qn.Ball,this.radius=e}intoRaw(){return Wt.ball(this.radius)}}class Y1e extends Vr{constructor(e){super(),this.type=Qn.HalfSpace,this.normal=e}intoRaw(){let e=ke.intoRaw(this.normal),i=Wt.halfspace(e);return e.free(),i}}class cX extends Vr{constructor(e,i,r){super(),this.type=Qn.Cuboid,this.halfExtents=ke.new(e,i,r)}intoRaw(){return Wt.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class hX extends Vr{constructor(e,i,r,s){super(),this.type=Qn.RoundCuboid,this.halfExtents=ke.new(e,i,r),this.borderRadius=s}intoRaw(){return Wt.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}class uX extends Vr{constructor(e,i){super(),this.type=Qn.Capsule,this.halfHeight=e,this.radius=i}intoRaw(){return Wt.capsule(this.halfHeight,this.radius)}}class dX extends Vr{constructor(e,i){super(),this.type=Qn.Segment,this.a=e,this.b=i}intoRaw(){let e=ke.intoRaw(this.a),i=ke.intoRaw(this.b),r=Wt.segment(e,i);return e.free(),i.free(),r}}class pX extends Vr{constructor(e,i,r){super(),this.type=Qn.Triangle,this.a=e,this.b=i,this.c=r}intoRaw(){let e=ke.intoRaw(this.a),i=ke.intoRaw(this.b),r=ke.intoRaw(this.c),s=Wt.triangle(e,i,r);return e.free(),i.free(),r.free(),s}}class fX extends Vr{constructor(e,i,r,s){super(),this.type=Qn.RoundTriangle,this.a=e,this.b=i,this.c=r,this.borderRadius=s}intoRaw(){let e=ke.intoRaw(this.a),i=ke.intoRaw(this.b),r=ke.intoRaw(this.c),s=Wt.roundTriangle(e,i,r,this.borderRadius);return e.free(),i.free(),r.free(),s}}class mX extends Vr{constructor(e,i){super(),this.type=Qn.Polyline,this.vertices=e,this.indices=i??new Uint32Array(0)}intoRaw(){return Wt.polyline(this.vertices,this.indices)}}class gX extends Vr{constructor(e,i){super(),this.type=Qn.TriMesh,this.vertices=e,this.indices=i}intoRaw(){return Wt.trimesh(this.vertices,this.indices)}}class L3 extends Vr{constructor(e,i){super(),this.type=Qn.ConvexPolyhedron,this.vertices=e,this.indices=i}intoRaw(){return this.indices?Wt.convexMesh(this.vertices,this.indices):Wt.convexHull(this.vertices)}}class U3 extends Vr{constructor(e,i,r){super(),this.type=Qn.RoundConvexPolyhedron,this.vertices=e,this.indices=i,this.borderRadius=r}intoRaw(){return this.indices?Wt.roundConvexMesh(this.vertices,this.indices,this.borderRadius):Wt.roundConvexHull(this.vertices,this.borderRadius)}}class vX extends Vr{constructor(e,i,r,s){super(),this.type=Qn.HeightField,this.nrows=e,this.ncols=i,this.heights=r,this.scale=s}intoRaw(){let e=ke.intoRaw(this.scale),i=Wt.heightfield(this.nrows,this.ncols,this.heights,e);return e.free(),i}}class yX extends Vr{constructor(e,i){super(),this.type=Qn.Cylinder,this.halfHeight=e,this.radius=i}intoRaw(){return Wt.cylinder(this.halfHeight,this.radius)}}class AX extends Vr{constructor(e,i,r){super(),this.type=Qn.RoundCylinder,this.borderRadius=r,this.halfHeight=e,this.radius=i}intoRaw(){return Wt.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class bX extends Vr{constructor(e,i){super(),this.type=Qn.Cone,this.halfHeight=e,this.radius=i}intoRaw(){return Wt.cone(this.halfHeight,this.radius)}}class xX extends Vr{constructor(e,i,r){super(),this.type=Qn.RoundCone,this.halfHeight=e,this.radius=i,this.borderRadius=r}intoRaw(){return Wt.roundCone(this.halfHeight,this.radius,this.borderRadius)}}(function(n){n[n.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",n[n.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",n[n.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",n[n.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",n[n.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",n[n.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",n[n.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",n[n.ONLY_FIXED=6]="ONLY_FIXED"})(oX||(oX={})),function(n){n[n.NONE=0]="NONE",n[n.COLLISION_EVENTS=1]="COLLISION_EVENTS",n[n.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"}(GM||(GM={}));class J1e{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return ke.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return ke.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class K1e{constructor(e,i){this.raw=i||new Q1e(e)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(e){this.raw.drainCollisionEvents(e)}drainContactForceEvents(e){let i=new J1e;this.raw.drainContactForceEvents(r=>{i.raw=r,e(i),i.free()})}clear(){this.raw.clear()}}(function(n){n[n.NONE=0]="NONE",n[n.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",n[n.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(O3||(O3={})),function(n){n[n.EMPTY=0]="EMPTY",n[n.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(aX||(aX={})),function(n){n[n.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",n[n.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",n[n.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",n[n.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",n[n.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",n[n.FIXED_FIXED=32]="FIXED_FIXED",n[n.DEFAULT=15]="DEFAULT",n[n.ALL=60943]="ALL"}(HM||(HM={}));class _X{constructor(e,i,r,s){this.colliderSet=e,this.handle=i,this._parent=r,this._shape=s}finalizeDeserialization(e){this.handle!=null&&(this._parent=e.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=Vr.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return ke.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return Yi.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(e){this.colliderSet.raw.coSetSensor(this.handle,e)}setShape(e){let i=e.intoRaw();this.colliderSet.raw.coSetShape(this.handle,i),i.free(),this._shape=e}setEnabled(e){this.colliderSet.raw.coSetEnabled(this.handle,e)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(e){this.colliderSet.raw.coSetRestitution(this.handle,e)}setFriction(e){this.colliderSet.raw.coSetFriction(this.handle,e)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(e){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,e)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(e){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,e)}setCollisionGroups(e){this.colliderSet.raw.coSetCollisionGroups(this.handle,e)}setSolverGroups(e){this.colliderSet.raw.coSetSolverGroups(this.handle,e)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(e){this.colliderSet.raw.coSetActiveHooks(this.handle,e)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(e){this.colliderSet.raw.coSetActiveEvents(this.handle,e)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(e){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,e)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(e){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,e)}setDensity(e){this.colliderSet.raw.coSetDensity(this.handle,e)}setMass(e){this.colliderSet.raw.coSetMass(this.handle,e)}setMassProperties(e,i,r,s){let o=ke.intoRaw(i),a=ke.intoRaw(r),l=Yi.intoRaw(s);this.colliderSet.raw.coSetMassProperties(this.handle,e,o,a,l),o.free(),a.free(),l.free()}setTranslation(e){this.colliderSet.raw.coSetTranslation(this.handle,e.x,e.y,e.z)}setTranslationWrtParent(e){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,e.x,e.y,e.z)}setRotation(e){this.colliderSet.raw.coSetRotation(this.handle,e.x,e.y,e.z,e.w)}setRotationWrtParent(e){this.colliderSet.raw.coSetRotationWrtParent(this.handle,e.x,e.y,e.z,e.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return ke.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(e){const i=ke.intoRaw(e);this.colliderSet.raw.coSetHalfExtents(this.handle,i)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(e){this.colliderSet.raw.coSetRadius(this.handle,e)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(e){this.colliderSet.raw.coSetRoundRadius(this.handle,e)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(e){this.colliderSet.raw.coSetHalfHeight(this.handle,e)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let e=this.colliderSet.raw.coHeightfieldScale(this.handle);return ke.fromRaw(e)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(e){let i=ke.intoRaw(e),r=this.colliderSet.raw.coContainsPoint(this.handle,i);return i.free(),r}projectPoint(e,i){let r=ke.intoRaw(e),s=OT.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,r,i));return r.free(),s}intersectsRay(e,i){let r=ke.intoRaw(e.origin),s=ke.intoRaw(e.dir),o=this.colliderSet.raw.coIntersectsRay(this.handle,r,s,i);return r.free(),s.free(),o}castShape(e,i,r,s,o,a,l){let c=ke.intoRaw(e),h=ke.intoRaw(r),u=Yi.intoRaw(s),d=ke.intoRaw(o),f=i.intoRaw(),m=f_.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,c,f,h,u,d,a,l));return c.free(),h.free(),u.free(),d.free(),f.free(),m}castCollider(e,i,r,s,o){let a=ke.intoRaw(e),l=ke.intoRaw(r),c=IU.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,a,i.handle,l,s,o));return a.free(),l.free(),c}intersectsShape(e,i,r){let s=ke.intoRaw(i),o=Yi.intoRaw(r),a=e.intoRaw(),l=this.colliderSet.raw.coIntersectsShape(this.handle,a,s,o);return s.free(),o.free(),a.free(),l}contactShape(e,i,r,s){let o=ke.intoRaw(i),a=Yi.intoRaw(r),l=e.intoRaw(),c=p_.fromRaw(this.colliderSet.raw.coContactShape(this.handle,l,o,a,s));return o.free(),a.free(),l.free(),c}contactCollider(e,i){return p_.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,e.handle,i))}castRay(e,i,r){let s=ke.intoRaw(e.origin),o=ke.intoRaw(e.dir),a=this.colliderSet.raw.coCastRay(this.handle,s,o,i,r);return s.free(),o.free(),a}castRayAndGetNormal(e,i,r){let s=ke.intoRaw(e.origin),o=ke.intoRaw(e.dir),a=DT.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,s,o,i,r));return s.free(),o.free(),a}}(function(n){n[n.Density=0]="Density",n[n.Mass=1]="Mass",n[n.MassProps=2]="MassProps"})(xv||(xv={}));class bn{constructor(e){this.enabled=!0,this.shape=e,this.massPropsMode=xv.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=Yi.identity(),this.translation=ke.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=ar.Average,this.restitutionCombineRule=ar.Average,this.activeCollisionTypes=HM.DEFAULT,this.activeEvents=GM.NONE,this.activeHooks=O3.NONE,this.mass=0,this.centerOfMass=ke.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=ke.zeros(),this.angularInertiaLocalFrame=Yi.identity()}static ball(e){const i=new D3(e);return new bn(i)}static capsule(e,i){const r=new uX(e,i);return new bn(r)}static segment(e,i){const r=new dX(e,i);return new bn(r)}static triangle(e,i,r){const s=new pX(e,i,r);return new bn(s)}static roundTriangle(e,i,r,s){const o=new fX(e,i,r,s);return new bn(o)}static polyline(e,i){const r=new mX(e,i);return new bn(r)}static trimesh(e,i){const r=new gX(e,i);return new bn(r)}static cuboid(e,i,r){const s=new cX(e,i,r);return new bn(s)}static roundCuboid(e,i,r,s){const o=new hX(e,i,r,s);return new bn(o)}static heightfield(e,i,r,s){const o=new vX(e,i,r,s);return new bn(o)}static cylinder(e,i){const r=new yX(e,i);return new bn(r)}static roundCylinder(e,i,r){const s=new AX(e,i,r);return new bn(s)}static cone(e,i){const r=new bX(e,i);return new bn(r)}static roundCone(e,i,r){const s=new xX(e,i,r);return new bn(s)}static convexHull(e){const i=new L3(e,null);return new bn(i)}static convexMesh(e,i){const r=new L3(e,i);return new bn(r)}static roundConvexHull(e,i){const r=new U3(e,null,i);return new bn(r)}static roundConvexMesh(e,i,r){const s=new U3(e,i,r);return new bn(s)}setTranslation(e,i,r){if(typeof e!="number"||typeof i!="number"||typeof r!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:i,z:r},this}setRotation(e){return Yi.copy(this.rotation,e),this}setSensor(e){return this.isSensor=e,this}setEnabled(e){return this.enabled=e,this}setDensity(e){return this.massPropsMode=xv.Density,this.density=e,this}setMass(e){return this.massPropsMode=xv.Mass,this.mass=e,this}setMassProperties(e,i,r,s){return this.massPropsMode=xv.MassProps,this.mass=e,ke.copy(this.centerOfMass,i),ke.copy(this.principalAngularInertia,r),Yi.copy(this.angularInertiaLocalFrame,s),this}setRestitution(e){return this.restitution=e,this}setFriction(e){return this.friction=e,this}setFrictionCombineRule(e){return this.frictionCombineRule=e,this}setRestitutionCombineRule(e){return this.restitutionCombineRule=e,this}setCollisionGroups(e){return this.collisionGroups=e,this}setSolverGroups(e){return this.solverGroups=e,this}setActiveHooks(e){return this.activeHooks=e,this}setActiveEvents(e){return this.activeEvents=e,this}setActiveCollisionTypes(e){return this.activeCollisionTypes=e,this}setContactForceEventThreshold(e){return this.contactForceEventThreshold=e,this}}for(var iEe={byteLength:function(n){var e=wX(n),i=e[0],r=e[1];return 3*(i+r)/4-r},toByteArray:function(n){var e,i,r=wX(n),s=r[0],o=r[1],a=new Z1e(function(h,u,d){return 3*(u+d)/4-d}(0,s,o)),l=0,c=o>0?s-4:s;for(i=0;i<c;i+=4)e=Ja[n.charCodeAt(i)]<<18|Ja[n.charCodeAt(i+1)]<<12|Ja[n.charCodeAt(i+2)]<<6|Ja[n.charCodeAt(i+3)],a[l++]=e>>16&255,a[l++]=e>>8&255,a[l++]=255&e;return o===2&&(e=Ja[n.charCodeAt(i)]<<2|Ja[n.charCodeAt(i+1)]>>4,a[l++]=255&e),o===1&&(e=Ja[n.charCodeAt(i)]<<10|Ja[n.charCodeAt(i+1)]<<4|Ja[n.charCodeAt(i+2)]>>2,a[l++]=e>>8&255,a[l++]=255&e),a},fromByteArray:function(n){for(var e,i=n.length,r=i%3,s=[],o=16383,a=0,l=i-r;a<l;a+=o)s.push(eSe(n,a,a+o>l?l:a+o));return r===1?(e=n[i-1],s.push(Wc[e>>2]+Wc[e<<4&63]+"==")):r===2&&(e=(n[i-2]<<8)+n[i-1],s.push(Wc[e>>10]+Wc[e>>4&63]+Wc[e<<2&63]+"=")),s.join("")}},Wc=[],Ja=[],Z1e=typeof Uint8Array<"u"?Uint8Array:Array,F3="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_v=0,$1e=F3.length;_v<$1e;++_v)Wc[_v]=F3[_v],Ja[F3.charCodeAt(_v)]=_v;function wX(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=n.indexOf("=");return i===-1&&(i=e),[i,i===e?0:4-i%4]}function eSe(n,e,i){for(var r,s,o=[],a=e;a<i;a+=3)r=(n[a]<<16&16711680)+(n[a+1]<<8&65280)+(255&n[a+2]),o.push(Wc[(s=r)>>18&63]+Wc[s>>12&63]+Wc[s>>6&63]+Wc[63&s]);return o.join("")}Ja["-".charCodeAt(0)]=62,Ja["_".charCodeAt(0)]=63;const tSe=Symbol("object"),N3=new Qo(()=>new S,20);class SX{constructor(e,i,r,s,o,a){p(this,"_point"),p(this,"_normal"),p(this,"_tangentVelocity"),p(this,"distance"),p(this,"impulse"),p(this,"friction"),this._point=e,this.distance=i,this._normal=r,this.impulse=s,this.friction=o,this._tangentVelocity=a}get point(){return N3.get().set(this._point.x,this._point.y,this._point.z)}get normal(){return N3.get().set(this._normal.x,this._normal.y,this._normal.z)}get tangentVelocity(){return N3.get().set(this._tangentVelocity.x,this._tangentVelocity.y,this._tangentVelocity.z)}}class CX{constructor(e,i,r){p(this,"contacts"),p(this,"me"),p(this,"_collider"),p(this,"_gameObject"),this.me=e,this._collider=i,this._gameObject=i.gameObject,this.contacts=r}get collider(){return this._collider}get gameObject(){return this._gameObject}get rigidBody(){var e;return(e=this.collider)==null?void 0:e.attachedRigidbody}}class EX{constructor(e,i){p(this,"object"),p(this,"collider"),this.object=e,this.collider=i}}const ys=te("debugphysics"),z3=te("debugcolliderplacement"),j3=te("debugcollisions"),iSe=te("showcolliders"),G3=te("debugraycasts"),Lo=Symbol("needle component"),go=Symbol("physics body"),MX=Symbol("rigidbody");let vm;globalThis.false=globalThis.false!==void 0?globalThis.false:!0,ys&&console.log("Use Rapier",!1,globalThis.false);const VM=class{constructor(){p(this,"debugRenderColliders",!1),p(this,"debugRenderRaycasts",!1),p(this,"context"),p(this,"_initializePromise"),p(this,"_isInitialized",!1),p(this,"rapierRay",new q1e({x:0,y:0,z:0},{x:0,y:0,z:1})),p(this,"raycastVectorsBuffer",new Qo(()=>new S,10)),p(this,"rapierSphere",null),p(this,"rapierColliderArray",[]),p(this,"rapierIdentityRotation",{x:0,y:0,z:0,w:1}),p(this,"rapierForwardVector",{x:0,y:0,z:1}),p(this,"enabled",!1),p(this,"_tempPosition",new S),p(this,"_tempQuaternion",new Ce),p(this,"_tempScale",new S),p(this,"_tempMatrix",new he),p(this,"_isUpdatingPhysicsWorld",!1),p(this,"_world"),p(this,"_hasCreatedWorld",!1),p(this,"eventQueue"),p(this,"collisionHandler"),p(this,"objects",[]),p(this,"bodies",[]),p(this,"_meshCache",new Map),p(this,"_gravity",{x:0,y:-9.81,z:0}),p(this,"lines"),p(this,"_tempCenterPos",new S),p(this,"_tempCenterVec",new S),p(this,"_tempCenterQuaternion",new Ce)}removeBody(n){var e,i,r;if(!n)return;this.validate();const s=n[go];if(n[go]=null,s&&this.world){const o=this.objects.findIndex(a=>a===n);if(o>=0){const a=this.bodies[o];if(this.bodies.splice(o,1),this.objects.splice(o,1),a instanceof _X){const l=a;(e=this.world)==null||e.removeCollider(l,!0);const c=l.parent();c&&c.numColliders()<=0&&(c[Lo]||(i=this.world)==null||i.removeRigidBody(c))}else a instanceof lX&&(a.numColliders()<=0?(r=this.world)==null||r.removeRigidBody(a):it()&&(a.did_log_removing||setTimeout(()=>{a.numColliders()>0&&(a.did_log_removing=!0,console.warn("RapierPhysics: removing rigidbody with colliders from the physics world is not possible right now, please remove the colliders first"))},1)))}}}updateBody(n,e,i){if(this.validate(),!!this.enabled&&!(n.destroyed||!n.gameObject)&&!(!e&&!i))if(n.isCollider===!0)console.warn("TODO: implement updating collider position");else{const r=n,s=r[go];s&&this.syncPhysicsBody(r.gameObject,s,e,i)}}updateProperties(n){if(this.validate(),n.isCollider){const e=n,i=e[go];i&&(this.internalUpdateColliderProperties(e,i),e.sharedMaterial&&this.updatePhysicsMaterial(e))}else{const e=n,i=this.internal_getRigidbody(e);i&&this.internalUpdateRigidbodyProperties(e,i)}}addForce(n,e,i){this.validate();const r=this.internal_getRigidbody(n);r?r.addForce(e,i):console.warn("Rigidbody doesn't exist: can not apply force")}addImpulse(n,e,i){this.validate();const r=this.internal_getRigidbody(n);r?r.applyImpulse(e,i):console.warn("Rigidbody doesn't exist: can not apply impulse")}getLinearVelocity(n){this.validate();const e=this.internal_getRigidbody(n);return e?e.linvel():null}getAngularVelocity(n){this.validate();const e=this.internal_getRigidbody(n);return e?e.angvel():null}resetForces(n,e){this.validate();const i=this.internal_getRigidbody(n);i?.resetForces(e)}resetTorques(n,e){this.validate();const i=this.internal_getRigidbody(n);i?.resetTorques(e)}applyImpulse(n,e,i){this.validate();const r=this.internal_getRigidbody(n);r?r.applyImpulse(e,i):console.warn("Rigidbody doesn't exist: can not apply impulse")}wakeup(n){this.validate();const e=this.internal_getRigidbody(n);e?e.wakeUp():console.warn("Rigidbody doesn't exist: can not wake up")}isSleeping(n){this.validate();const e=this.internal_getRigidbody(n);return e?.isSleeping()}setAngularVelocity(n,e,i){this.validate();const r=this.internal_getRigidbody(n);r?r.setAngvel(e,i):console.warn("Rigidbody doesn't exist: can not set angular velocity")}setLinearVelocity(n,e,i){this.validate();const r=this.internal_getRigidbody(n);r?r.setLinvel(e,i):console.warn("Rigidbody doesn't exist: can not set linear velocity")}async initialize(n){return this.context=n,this._initializePromise||(this._initializePromise=this.internalInitialization()),this._initializePromise}async internalInitialization(){return ys&&console.log("Initialize rapier physics engine"),"env"in import.meta&&{}.VITE_NEEDLE_USE_RAPIER==="false"&&ys&&console.log("Rapier disabled"),!1}validate(){this._isInitialized||ys&&(this._lastWarnTime=this._lastWarnTime??0,Date.now()-this._lastWarnTime>1e3&&(this._lastWarnTime=Date.now(),console.warn("Physics engine is not initialized")))}raycast(n,e,i){var r;let s=i?.maxDistance,o=i?.solid;s===void 0&&(s=1/0),o===void 0&&(o=!0);const a=this.getPhysicsRay(this.rapierRay,n,e);if(!a)return null;(this.debugRenderRaycasts||G3)&&yt.DrawRay(a.origin,a.dir,255,1);const l=(r=this.world)==null?void 0:r.castRay(a,s,o,i?.queryFilterFlags,i?.filterGroups,void 0,void 0,c=>{const h=c[Lo];return i!=null&&i.filterPredicate?i.filterPredicate(h):i?.useIgnoreRaycastLayer!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(l){const c=a.pointAt(l.toi),h=this.raycastVectorsBuffer.get();return h.set(c.x,c.y,c.z),{point:h,collider:l.collider[Lo]}}return null}raycastAndGetNormal(n,e,i){var r;let s=i?.maxDistance,o=i?.solid;s===void 0&&(s=1/0),o===void 0&&(o=!0);const a=this.getPhysicsRay(this.rapierRay,n,e);if(!a)return null;(this.debugRenderRaycasts||G3)&&yt.DrawRay(a.origin,a.dir,255,1);const l=(r=this.world)==null?void 0:r.castRayAndGetNormal(a,s,o,i?.queryFilterFlags,i?.filterGroups,void 0,void 0,c=>{const h=c[Lo];return i!=null&&i.filterPredicate?i.filterPredicate(h):i?.useIgnoreRaycastLayer!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(l){const c=a.pointAt(l.toi),h=l.normal,u=this.raycastVectorsBuffer.get(),d=this.raycastVectorsBuffer.get();return u.set(c.x,c.y,c.z),d.set(h.x,h.y,h.z),{point:u,normal:d,collider:l.collider[Lo]}}return null}getPhysicsRay(n,e,i){var r,s,o;const a=(r=this.context)==null?void 0:r.mainCamera;if(e===void 0){const h=(s=this.context)==null?void 0:s.input.getPointerPosition(0);if(h)e=h;else return null}if(e.z===void 0){if(!a)return console.error("Can not perform raycast from 2d point - no main camera found"),null;const h=this.raycastVectorsBuffer.get();h.x=e.x,h.y=e.y,h.z=0,(h.x>1||h.y>1||h.y<-1||h.x<-1)&&(ys&&console.warn("Converting screenspace to raycast space",h),(o=this.context)==null||o.input.convertScreenspaceToRaycastSpace(h)),h.unproject(a),e=h}const l=e;n.origin.x=l.x,n.origin.y=l.y,n.origin.z=l.z;const c=this.raycastVectorsBuffer.get();if(i)c.set(i.x,i.y,i.z);else{if(!a)return console.error("Can not perform raycast - no camera found"),null;c.set(n.origin.x,n.origin.y,n.origin.z);const h=kt(a);c.sub(h)}return c.normalize(),n.dir.x=c.x,n.dir.y=c.y,n.dir.z=c.z,n}sphereOverlap(n,e){return this.rapierColliderArray.length=0,this.world?(this.rapierSphere||(this.rapierSphere=new D3(e)),this.rapierSphere.radius=e,(this.debugRenderRaycasts||G3)&&yt.DrawWireSphere(n,e,3359999,1),this.world.intersectionsWithShape(n,this.rapierIdentityRotation,this.rapierSphere,i=>{const r=i[Lo],s=new EX(r.gameObject,r);return this.rapierColliderArray.push(s),!0},void 0,void 0,void 0,void 0,i=>i.isSensor()?!1:i[Lo].gameObject.layers.isEnabled(2)==!1),this.rapierColliderArray):this.rapierColliderArray}get world(){return this._world}get isUpdating(){return this._isUpdatingPhysicsWorld}get gravity(){var n;return((n=this.world)==null?void 0:n.gravity)??this._gravity}set gravity(n){this.world?this.world.gravity=n:this._gravity=n}clearCaches(){var n,e,i,r;this._meshCache.clear(),(n=this.eventQueue)!=null&&n.raw&&((e=this.eventQueue)==null||e.free()),(i=this.world)!=null&&i.bodies&&((r=this.world)==null||r.free())}async addBoxCollider(n,e){if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){ys&&console.warn("Physics are disabled");return}const i=n.gameObject,r=Qi(i,this._tempPosition).multiply(e);r.multiplyScalar(.5),r.x<0&&(r.x=Math.abs(r.x)),r.y<0&&(r.y=Math.abs(r.y)),r.z<0&&(r.z=Math.abs(r.z)),r.x==0&&(r.x=1e-7),r.y==0&&(r.y=1e-7),r.z==0&&(r.z=1e-7);const s=bn.cuboid(r.x,r.y,r.z);this.createCollider(n,s)}async addSphereCollider(n){if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){ys&&console.warn("Physics are disabled");return}const e=bn.ball(.5);this.createCollider(n,e),this.updateProperties(n)}async addCapsuleCollider(n,e,i){if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){ys&&console.warn("Physics are disabled");return}const r=n.gameObject,s=Qi(r,this._tempPosition);s.x=Math.abs(s.x),s.y=Math.abs(s.y);const o=i*s.x;e=Math.max(e,o*2);const a=tt.clamp(e*.5*s.y-i*s.x,0,Number.MAX_SAFE_INTEGER),l=bn.capsule(a,o);this.createCollider(n,l)}async addMeshCollider(n,e,i,r){var s,o,a;if(this._isInitialized||await this.initialize(n.context),!n.activeAndEnabled)return;if(!this.enabled){ys&&console.warn("Physics are disabled");return}let l=e.geometry;if(!l){ys&&console.warn("Missing mesh geometry",e.name);return}(o=(s=l.index)==null?void 0:s.array)!=null&&o.length||(console.warn(`Your MeshCollider is missing vertices or indices in the assined mesh "${e.name}". Consider providing an indexed geometry.`),l=Mme(l));let c=l.getAttribute("position").array;const h=(a=l.index)==null?void 0:a.array;if(Math.abs(r.x-1)>1e-4||Math.abs(r.y-1)>1e-4||Math.abs(r.z-1)>1e-4){const d=l.uuid+"_"+r.x+"_"+r.y+"_"+r.z+"_"+i;if(this._meshCache.has(d))ys&&console.warn("Use cached mesh collider"),c=this._meshCache.get(d);else{(ys||it())&&console.warn(`Your MeshCollider "${n.name}" is scaled: consider applying the scale to the collider mesh instead (${r.x}, ${r.y}, ${r.z})`);const f=new Float32Array(c.length);for(let m=0;m<c.length;m+=3)f[m]=c[m]*r.x,f[m+1]=c[m+1]*r.y,f[m+2]=c[m+2]*r.z;c=f,this._meshCache.set(d,f)}}const u=i?bn.convexHull(c):bn.trimesh(c,h);u&&this.createCollider(n,u)}updatePhysicsMaterial(n){if(!n)return;const e=n.sharedMaterial,i=n[go];if(i&&e){if(e.bounciness!==void 0&&i.setRestitution(e.bounciness),e.bounceCombine!==void 0)switch(e.bounceCombine){case Dr.Average:i.setRestitutionCombineRule(ar.Average);break;case Dr.Maximum:i.setRestitutionCombineRule(ar.Max);break;case Dr.Minimum:i.setRestitutionCombineRule(ar.Min);break;case Dr.Multiply:i.setRestitutionCombineRule(ar.Multiply);break}if(e.dynamicFriction!==void 0&&i.setFriction(e.dynamicFriction),e.frictionCombine!==void 0)switch(e.frictionCombine){case Dr.Average:i.setFrictionCombineRule(ar.Average);break;case Dr.Maximum:i.setFrictionCombineRule(ar.Max);break;case Dr.Minimum:i.setFrictionCombineRule(ar.Min);break;case Dr.Multiply:i.setFrictionCombineRule(ar.Multiply);break}}}getBody(n){return n?n[go]:null}getComponent(n){return n?n[Lo]:null}createCollider(n,e){var i;if(!this.world)throw new Error("Physics world not initialized");const r=this._tempMatrix;let s;n.attachedRigidbody?s=this.getRigidbody(n,this._tempMatrix):(ys&&console.log("Create collider without rigidbody",n.name),r.makeRotationFromQuaternion(Ri(n.gameObject)),r.setPosition(kt(n.gameObject))),r.decompose(this._tempPosition,this._tempQuaternion,this._tempScale),this.tryApplyCenter(n,this._tempPosition),e.setTranslation(this._tempPosition.x,this._tempPosition.y,this._tempPosition.z),e.setRotation(this._tempQuaternion),e.setSensor(n.isTrigger);const o=n.sharedMaterial;if(o){if(o.bounciness!==void 0&&e.setRestitution(o.bounciness),o.bounceCombine!==void 0)switch(o.bounceCombine){case Dr.Average:e.setRestitutionCombineRule(ar.Average);break;case Dr.Maximum:e.setRestitutionCombineRule(ar.Max);break;case Dr.Minimum:e.setRestitutionCombineRule(ar.Min);break;case Dr.Multiply:e.setRestitutionCombineRule(ar.Multiply);break}if(o.dynamicFriction!==void 0&&e.setFriction(o.dynamicFriction),o.frictionCombine!==void 0)switch(o.frictionCombine){case Dr.Average:e.setFrictionCombineRule(ar.Average);break;case Dr.Maximum:e.setFrictionCombineRule(ar.Max);break;case Dr.Minimum:e.setFrictionCombineRule(ar.Min);break;case Dr.Multiply:e.setFrictionCombineRule(ar.Multiply);break}}((i=n.attachedRigidbody)==null?void 0:i.autoMass)===!1&&(e.setDensity(1e-6),e.setMass(1e-6));try{const a=this.world.createCollider(e,s);return a[Lo]=n,n[go]=a,a.setActiveEvents(GM.COLLISION_EVENTS),a.setActiveCollisionTypes(HM.ALL),this.objects.push(n),this.bodies.push(a),this.updateColliderCollisionGroups(n),a}catch(a){return console.error('Error creating collider "'+n.name+`"
Error:`,a),null}}updateColliderCollisionGroups(n){const e=n[go],i=n.membership;let r=0;if(i==null)r=65535;else for(let a=0;a<i.length;a++){const l=i[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):r|=1<<Math.floor(l)}const s=n.filter;let o=0;if(s==null)o=65535;else for(let a=0;a<s.length;a++){const l=s[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):o|=1<<Math.floor(l)}e.setCollisionGroups(r<<16|o)}getRigidbody(n,e){if(!this.world)throw new Error("Physics world not initialized");let i=null;if(n.attachedRigidbody){const r=n.attachedRigidbody;if(i=r[go],!i){const s=r.isKinematic&&!z3;ys&&console.log("Create rigidbody",s);const o=s?vm.RigidBodyDesc.kinematicPositionBased():vm.RigidBodyDesc.dynamic(),a=kt(n.attachedRigidbody.gameObject);o.setTranslation(a.x,a.y,a.z),o.setRotation(Ri(n.attachedRigidbody.gameObject)),o.centerOfMass=new vm.Vector3(r.centerOfMass.x,r.centerOfMass.y,r.centerOfMass.z),i=this.world.createRigidBody(o),this.bodies.push(i),this.objects.push(r)}i[Lo]=r,r[go]=i,this.internalUpdateRigidbodyProperties(r,i),this.getRigidbodyRelativeMatrix(n.gameObject,r.gameObject,e),n[MX]=i}else{const r=vm.RigidBodyDesc.kinematicPositionBased(),s=kt(n.gameObject);r.setTranslation(s.x,s.y,s.z),r.setRotation(Ri(n.gameObject)),i=this.world.createRigidBody(r),e.identity(),i[Lo]=null}return i}internal_getRigidbody(n){return n.isCollider===!0?n[MX]:n[go]}internalUpdateColliderProperties(n,e){const i=e.shape;let r=!1;switch(i.type){case Qn.Ball:{const d=i,f=n,m=n.gameObject,g=Qi(m,this._tempPosition),v=Math.abs(f.radius*g.x);r=d.radius!==v,d.radius=v,r&&e.setShape(d);break}case Qn.Cuboid:const s=i,o=n,a=n.gameObject,l=Qi(a,this._tempPosition),c=o.size.x*.5*l.x,h=o.size.y*.5*l.y,u=o.size.z*.5*l.z;r=s.halfExtents.x!==c||s.halfExtents.y!==h||s.halfExtents.z!==u,s.halfExtents.x=c,s.halfExtents.y=h,s.halfExtents.z=u,r&&e.setShape(s);break}if(r){const s=n.attachedRigidbody;if(s!=null&&s.autoMass){const o=this.getBody(s);o?.recomputeMassPropertiesFromColliders()}}this.updateColliderCollisionGroups(n),n.isTrigger!==e.isSensor()&&e.setSensor(n.isTrigger)}internalUpdateRigidbodyProperties(n,e){if(e.enableCcd(n.collisionDetectionMode!==JC.Discrete),e.setLinearDamping(n.drag),e.setAngularDamping(n.angularDrag),e.setGravityScale(n.useGravity?n.gravityScale:0,!0),n.dominanceGroup<=127&&n.dominanceGroup>=-127?e.setDominanceGroup(Math.floor(n.dominanceGroup)):e.setDominanceGroup(0),n.autoMass){e.setAdditionalMass(0,!1);for(let i=0;i<e.numColliders();i++)e.collider(i).setDensity(1);e.recomputeMassPropertiesFromColliders()}else{e.setAdditionalMass(n.mass,!1);for(let i=0;i<e.numColliders();i++)e.collider(i).setDensity(1e-7);e.recomputeMassPropertiesFromColliders()}e.setEnabledRotations(!n.lockRotationX,!n.lockRotationY,!n.lockRotationZ,!1),e.setEnabledTranslations(!n.lockPositionX,!n.lockPositionY,!n.lockPositionZ,!1),n.isKinematic?e.setBodyType(vm.RigidBodyType.KinematicPositionBased,!1):e.setBodyType(vm.RigidBodyType.Dynamic,!1)}step(n){if(this.world&&this.enabled){if(this._isUpdatingPhysicsWorld=!0,this.eventQueue||(this.eventQueue=new K1e(!1)),n===void 0||n<=0){this._isUpdatingPhysicsWorld=!1;return}else n!==void 0&&(this.world.timestep=tt.lerp(this.world.timestep,n,.8));try{this.world.step(this.eventQueue)}catch(e){console.warn("Error running physics step",e)}this._isUpdatingPhysicsWorld=!1}}postStep(){this.world&&this.enabled&&(this._isUpdatingPhysicsWorld=!0,this.syncObjects(),this._isUpdatingPhysicsWorld=!1,this.eventQueue&&!this.collisionHandler&&(this.collisionHandler=new nSe(this.world,this.eventQueue)),this.collisionHandler&&(this.collisionHandler.handleCollisionEvents(),this.collisionHandler.update()),this.updateDebugRendering(this.world))}updateDebugRendering(n){var e,i,r,s;if(ys||z3||iSe||this.debugRenderColliders===!0){if(!this.lines){const a=new zi({color:7855479,fog:!1}),l=new dt;this.lines=new Is(l,a),this.lines.layers.disableAll(),this.lines.layers.enable(2)}this.lines.parent!==((e=this.context)==null?void 0:e.scene)&&((i=this.context)==null||i.scene.add(this.lines));const o=n.debugRender();this.lines.geometry.setAttribute("position",new Ye(o.vertices,3)),this.lines.geometry.setAttribute("color",new Ye(o.colors,4)),(this.context.time.frame%30===0||((r=this.lines.geometry.boundingSphere)==null?void 0:r.radius)===0)&&this.lines.geometry.computeBoundingSphere()}else this.lines&&((s=this.context)==null||s.scene.remove(this.lines))}syncObjects(){if(!z3)for(let n=0;n<this.bodies.length;n++){const e=this.objects[n],i=this.bodies[n],r=e;if(r?.isCollider===!0&&!r.attachedRigidbody){const l=i.parent();l?this.syncPhysicsBody(e.gameObject,l,!0,!0):this.syncPhysicsBody(e.gameObject,i,!0,!0);continue}const s=i.translation(),o=i.rotation();if(Number.isNaN(s.x)||Number.isNaN(o.x)){!r.__COLLIDER_NAN&&it()&&(console.warn("Collider has NaN values",r.name,r.gameObject,i),r.__COLLIDER_NAN=!0);continue}const a=e.center;if(a&&a.isVector3){this._tempQuaternion.set(o.x,o.y,o.z,o.w);const l=this._tempPosition.copy(a).applyQuaternion(this._tempQuaternion),c=Qi(e.gameObject);l.multiply(c),s.x-=l.x,s.y-=l.y,s.z-=l.z}Kp(e.gameObject,s.x,s.y,s.z),rP(e.gameObject,o.x,o.y,o.z,o.w)}}syncPhysicsBody(n,e,i,r){if(e instanceof lX){const s=kt(n,this._tempPosition),o=Ri(n,this._tempQuaternion);switch(e.bodyType()){case qx.Fixed:case qx.KinematicPositionBased:case qx.KinematicVelocityBased:i&&e.setNextKinematicTranslation(s),r&&e.setNextKinematicRotation(o);break;default:i&&e.setTranslation(s,!1),r&&e.setRotation(o,!1);break}}else if(e instanceof _X){n.matrixWorldNeedsUpdate&&n.updateWorldMatrix(!0,!1),n.matrixWorld.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const s=this._tempPosition,o=this._tempQuaternion,a=e[Lo];if(this.tryApplyCenter(a,s),i){const l=e.translation();(l.x!==s.x||l.y!==s.y||l.z!==s.z)&&e.setTranslation(s)}if(r){const l=e.rotation();(l.x!==o.x||l.y!==o.y||l.z!==o.z||l.w!==o.w)&&e.setRotation(o)}}}tryApplyCenter(n,e){const i=n.center;i&&n.gameObject&&(i.x!==0||i.y!==0||i.z!==0)&&(this._tempCenterPos.x=i.x,this._tempCenterPos.y=i.y,this._tempCenterPos.z=i.z,Qi(n.gameObject,this._tempCenterVec),this._tempCenterPos.multiply(this._tempCenterVec),n.attachedRigidbody?this._tempCenterPos.applyQuaternion(n.gameObject.quaternion):(Ri(n.gameObject,this._tempCenterQuaternion),this._tempCenterPos.applyQuaternion(this._tempCenterQuaternion)),e.x+=this._tempCenterPos.x,e.y+=this._tempCenterPos.y,e.z+=this._tempCenterPos.z)}getRigidbodyRelativeMatrix(n,e,i,r){if(r===void 0&&(r=VM._matricesBuffer,r.length=0),n===e){const s=Qi(n,this._tempPosition);i.makeScale(s.x,s.y,s.z);for(let o=r.length-1;o>=0;o--)i.multiply(r[o]);return i}return r.push(n.matrix),n.parent&&this.getRigidbodyRelativeMatrix(n.parent,e,i,r),i}addFixedJoint(n,e){if(!this.world){console.error("Physics world not initialized");return}const i=n[go],r=e[go];this.calculateJointRelativeMatrices(n.gameObject,e.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const s=uu.fixed(VM.centerConnectionPos,VM.centerConnectionRot,this._tempPosition,this._tempQuaternion),o=this.world.createImpulseJoint(s,i,r,!0);ys&&console.log("ADD FIXED JOINT",o)}addHingeJoint(n,e,i,r){if(!this.world){console.error("Physics world not initialized");return}const s=n[go],o=e[go];this.calculateJointRelativeMatrices(n.gameObject,e.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const a=vm.JointData.revolute(i,this._tempPosition,r),l=this.world.createImpulseJoint(a,s,o,!0);ys&&console.log("ADD HINGE JOINT",l)}calculateJointRelativeMatrices(n,e,i){n.updateWorldMatrix(!0,!1),e.updateWorldMatrix(!0,!1);const r=n.matrixWorld,s=e.matrixWorld;r.elements[0]=1,r.elements[5]=1,r.elements[10]=1,s.elements[0]=1,s.elements[5]=1,s.elements[10]=1,i.copy(s).premultiply(r.invert()).invert()}};let Yx=VM;p(Yx,"_didLoadPhysicsEngine",!1),p(Yx,"_matricesBuffer",[]),p(Yx,"centerConnectionPos",{x:0,y:0,z:0}),p(Yx,"centerConnectionRot",{x:0,y:0,z:0,w:1});class nSe{constructor(e,i){p(this,"world"),p(this,"eventQueue"),p(this,"activeCollisions",[]),p(this,"activeCollisionsStay",[]),p(this,"activeTriggers",[]),this.world=e,this.eventQueue=i}handleCollisionEvents(){this.eventQueue&&this.world&&this.eventQueue.drainCollisionEvents((e,i,r)=>{const s=this.world.getCollider(e),o=this.world.getCollider(i);if(!s||!o)return;const a=s[Lo],l=o[Lo];j3&&console.log("EVT",a.name,l.name,r,s,o),a&&l&&(r?(this.onCollisionStarted(a,s,l,o),this.onCollisionStarted(l,o,a,s)):(this.onCollisionEnded(a,l),this.onCollisionEnded(l,a)))})}update(){this.onHandleCollisionStay()}onCollisionStarted(e,i,r,s){let o=null;if(e.isTrigger||r.isTrigger)Mf(e.gameObject,a=>{a.onTriggerEnter&&!a.destroyed&&a.onTriggerEnter(r),this.activeTriggers.push({collider:e,component:a,otherCollider:r})});else{const a=e.gameObject;this.world.contactPair(i,s,(l,c)=>{Mf(a,h=>{var u;if(h.destroyed)return;const d=h.onCollisionEnter||h.onCollisionStay||h.onCollisionExit;if(d||j3){if(!o){const f=[],m=l.normal();for(let g=0;g<l.numSolverContacts();g++){const v=l.solverContactPoint(g),y=l.contactImpulse(g);if(v){const A=l.contactDist(g),b=l.solverContactFriction(g),x=l.solverContactTangentVelocity(g),_=new SX(v,A,m,y,b,x);f.push(_),j3&&yt.DrawDirection(v,m,16711680,3,!0)}}o=new CX(a,r,f)}if(d){const f={collider:e,component:h,collision:o};this.activeCollisions.push(f),h.onCollisionStay&&this.activeCollisionsStay.push(f),(u=h.onCollisionEnter)==null||u.call(h,o)}}})})}}onHandleCollisionStay(){for(const e of this.activeCollisionsStay){const i=e.component;if(!i.destroyed&&i.activeAndEnabled&&i.onCollisionStay){if(e.collision.collider.destroyed)continue;const r=e.collision;i.onCollisionStay(r)}}for(const e of this.activeTriggers){const i=e.component;if(!i.destroyed&&i.activeAndEnabled&&i.onTriggerStay){const r=e.otherCollider;if(r.destroyed)continue;i.onTriggerStay(r)}}}onCollisionEnded(e,i){if(!(e.destroyed||i.destroyed)){for(let r=0;r<this.activeCollisions.length;r++){const s=this.activeCollisions[r],o=s.collider;if(o.destroyed||s.collision.collider.destroyed){this.activeCollisions.splice(r,1),r--;continue}if(o===e&&s.collision.collider===i){const a=s.component;if(this.activeCollisions.splice(r,1),r--,a.activeAndEnabled&&a.onCollisionExit){const l=s.collision;a.onCollisionExit(l)}}}for(let r=0;r<this.activeCollisionsStay.length;r++){const s=this.activeCollisionsStay[r],o=s.collider;if(o.destroyed||s.collision.collider.destroyed){this.activeCollisionsStay.splice(r,1),r--;continue}if(o===e&&s.collision.collider===i){const a=s.component;if(this.activeCollisionsStay.splice(r,1),r--,a.activeAndEnabled&&a.onCollisionExit){const l=s.collision;a.onCollisionExit(l)}}}for(let r=0;r<this.activeTriggers.length;r++){const s=this.activeTriggers[r],o=s.collider;if(o.destroyed||s.otherCollider.destroyed){this.activeTriggers.splice(r,1),r--;continue}if(o===e&&s.otherCollider===i){const a=s.component;if(this.activeTriggers.splice(r,1),r--,a.activeAndEnabled&&a.onTriggerExit){const l=s.otherCollider;a.onTriggerExit(l)}}}}}}class rSe{static async createComparisonScene(e){const{files:i}=e,r=await Promise.all(i.map(g=>new $t(g).loadAssetAsync())),s=new Er;let o=0;for(const g of r)if(g instanceof ve){g.position.y=o,s.add(g);const v=pl([g]);o+=v.getSize(new S).y,o+=.1}const a=new Ft(20);s.add(a);const l=e.environment||"https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/studio_small_09_1k.exr";if(l){let g=null;if(l.endsWith(".hdr")){const v=(await Promise.resolve().then(()=>Rfe)).RGBELoader;g=new v}else if(l.endsWith(".exr")){const v=(await Promise.resolve().then(()=>Ife)).EXRLoader;g=new v}if(g){const v=await g.loadAsync(l).catch(y=>(console.error(y),null));v&&(v.mapping=qs,v.needsUpdate=!0,s.background=v,s.environment=v,s.backgroundBlurriness=.75)}else console.warn("Unsupported environment map format",l)}const c=pl(s.children),h=c.getCenter(new S),u=c.getSize(new S),d=Math.max(u.x,u.y,u.z)/(2*Math.tan(Math.PI*a.fov/360));a.position.set(h.x,h.y,d),a.lookAt(h);const f=new VQ(a,e.domElement||document.body);f.target=h,f.update();const m=(e.domElement||document.body).getBoundingClientRect();return a.aspect=m.width/m.height,a.updateProjectionMatrix(),{scene:s,camera:a}}}function sSe(n,e,i,r="image/webp",s){return TX({context:n,width:e,height:i,mimeType:r,camera:s})}function TX(n={mimeType:"image/png",transparent:!1}){n||(n={});let{context:e,width:i,height:r,camera:s}=n;const{mimeType:o}=n;if(!e&&(e=fi.Current,!e))return console.error("Can not save screenshot: No needle-engine context found or provided."),null;if(!s&&(s=e.mainCamera,!s))return console.error("No camera found"),null;const a=e.renderer.domElement.width,l=e.renderer.domElement.height;i||(i=a),r||(r=l);const c=window.devicePixelRatio||1;i/=c,r/=c,e.renderer.domElement.style.width=i+"px",e.renderer.domElement.style.height=r+"px";const h=e.renderer.getClearColor(new be),u=e.renderer.getClearAlpha();try{n!=null&&n.transparent&&e.renderer.setClearColor(0,0);const d=e.renderer.domElement;e.renderer.setSize(i,r,!1),s instanceof Ft&&e.updateAspect(s,i,r);const f=n.render_events!==!1,m=new Array;f&&(a0(e.scene,Bn,m),m.forEach(v=>v?.onBeforeRender())),e.renderNow(),f&&m.forEach(v=>v.onAfterRender());const g=d.toDataURL(o);return n.download_filename&&IX(g,n.download_filename),g}finally{e.renderer.setSize(a,l,!1),e.updateSize(),e.renderer.setClearColor(h,u)}return null}let Jx=null;function IX(n,e){if(n){if(!n.startsWith("data:image")){console.error("Can not save image: Data url is not an image",n);return}Jx||(Jx=document.createElement("a")),Jx.href=n,Jx.download=e,Jx.click()}}let H3=0;function RX(n){n?H3++:H3--}function oSe(){return H3>0}class PX{constructor(e){p(this,"writer"),this.writer=e}writeNode(e){}}class aSe extends PX{beforeWriteNode(e,i){yt.isGizmo(e)&&(i.keep=!1)}}class lSe extends PX{beforeWriteTexture(e,i){e.isRenderTargetTexture&&(i.newTexture=dO(new ki(1,1,1,0)))}}const cSe={binary:!0,animations:!0};async function hSe(n){if(!n.context)throw new Error("No context provided to exportAsGLTF");n.scene||(n.scene=n.context.scene);const e={...cSe,...n},{context:i}=e,r=new iM;r.register(l=>new AW(l)),r.register(l=>new aSe(l)),r.register(l=>new lSe(l)),JD(r,e.context);const s={binary:e.binary,animations:dSe(i,e.scene,[])},o=new uSe;console.log("Exporting GLTF",s),o.onBeforeExport(e),RX(!0);const a=await r.parseAsync(e.scene,s).catch(l=>(console.error(l),null));if(RX(!1),o.onAfterExport(e),!a)throw new Error("Failed to export GLTF");if(e.downloadAs!=null){let l=null;if(a instanceof ArrayBuffer?l=new Blob([a],{type:"application/octet-stream"}):console.error("Can not download GLTF as a blob",a),l){const c=URL.createObjectURL(l),h=document.createElement("a");h.href=c;let u=e.downloadAs;!u.endsWith(".glb")&&!u.endsWith(".gltf")&&(u+=e.binary?".glb":".gltf"),h.download=u,h.click()}}return a}const BX=Symbol("needle:weight");class uSe{constructor(){p(this,"_undo",[])}onBeforeExport(e){e.context.animations.mixers.forEach(i=>{const r=u0.tryGetActionsFromMixer(i);if(r)for(let s=0;s<r.length;s++){const o=r[s];o[BX]=o.weight,o.weight=0,this._undo.push(()=>{o.weight=o[BX]})}i.update(0)})}onAfterExport(e){this._undo.forEach(i=>i()),this._undo.length=0}}function dSe(n,e,i){n.animations.mixers.forEach(s=>{const o=u0.tryGetActionsFromMixer(s);if(o)for(let a=0;a<o.length;a++){const l=o[a].getClip();i.push(l)}}),Array.isArray(e)||(e=[e]);for(const s of e)u0.tryGetAnimationClipsFromObjectHierarchy(s,i);const r=new Set(i);return Array.from(r)}const kX="needle-button",V3=it();var ym,Am,bm,Uo,zl,wv,Q3,OX,W3,DX,QM;class X3 extends HTMLElement{constructor(){super(),xa(this,Q3),xa(this,W3),xa(this,ym,void 0),xa(this,Am,void 0),xa(this,bm,void 0),xa(this,Uo,void 0),xa(this,zl,void 0),xa(this,wv,void 0),xa(this,QM,e=>{V3&&console.log("Needle Button clicked"),!e.defaultPrevented&&vi(this,Uo)&&vi(this,Uo).click()}),this.removeEventListener("click",vi(this,QM)),this.addEventListener("click",vi(this,QM))}attributeChangedCallback(e,i,r){Em(this,Q3,OX).call(this)}}ym=new WeakMap,Am=new WeakMap,bm=new WeakMap,Uo=new WeakMap,zl=new WeakMap,wv=new WeakMap,Q3=new WeakSet,OX=function(){var n,e;if((n=vi(this,Uo))==null||n.remove(),this.getAttribute("ar")!=null)vi(this,zl)??Ql(this,zl,new Kf),Ql(this,Uo,vi(this,zl).createARButton());else if(this.getAttribute("vr")!=null)vi(this,zl)??Ql(this,zl,new Kf),Ql(this,Uo,vi(this,zl).createVRButton());else if(this.getAttribute("quicklook")!=null)vi(this,zl)??Ql(this,zl,new Kf),Ql(this,Uo,vi(this,zl).createQuicklookButton());else{V3?console.warn("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute."):console.debug("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute.");return}vi(this,ym)??Ql(this,ym,this.attachShadow({mode:"open"})),vi(this,Am)??Ql(this,Am,document.createElement("slot")),vi(this,bm)??Ql(this,bm,document.createElement("style")),vi(this,bm).innerHTML=`
            button {
                all: initial;
                cursor: inherit;
                color: inherit;
                font-family: inherit;
                gap: inherit;
                white-space: nowrap;
            }
        `,this.getAttribute("unstyled")!=null||(vi(this,bm).innerHTML+=`
            :host {
                display: inline-block;
                background: rgba(255, 255, 255, .8);
                backdrop-filter: blur(10px);
                width: fit-content;
                transition: background .2s;

                cursor: pointer;
                padding: 0.4rem .5rem;
                border-radius: 0.8rem;
                color: black;
                background: rgba(245, 245, 245, .8);
                outline: rgba(0,0,0,.05) 1px solid;
            }
            :host(:hover) {
                background: rgba(255, 255, 255, 1);
                transition: background .2s;
            }
            slot {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: .5rem;
            }
`),vi(this,Am).innerHTML=vi(this,Uo).innerHTML,vi(this,Am).style.cssText="display: flex; align-items: center; justify-content: center;",vi(this,Uo).innerHTML=vi(this,Am).outerHTML,vi(this,ym).innerHTML=vi(this,Uo).outerHTML,vi(this,ym).prepend(vi(this,bm)),PC(vO,{element:vi(this,ym)}),(e=vi(this,wv))==null||e.disconnect(),vi(this,wv)??Ql(this,wv,new MutationObserver(()=>Em(this,W3,DX).call(this))),vi(this,wv).observe(vi(this,Uo),{attributes:!0}),V3&&console.log("Needle Button updated")},W3=new WeakSet,DX=function(){vi(this,Uo)&&(vi(this,Uo).style.display==="none"?this.style.display="none":this.style.display==="none"&&(this.style.display=""))},QM=new WeakMap,p(X3,"observedAttributes",["ar","vr","quicklook"]),typeof window<"u"&&!window.customElements.get(kX)&&window.customElements.define(kX,X3);const WM=te("debugmissingcamera");fi.registerCallback(Si.MissingCamera,n=>{var e,i,r;WM&&console.warn("Creating missing camera");const s=n.context.scene,o=new Ft;o.name="Default Fallback Camera",s.add(o);const a=new Ui;a.sourceId=((i=(e=n.files)==null?void 0:e[0])==null?void 0:i.src)??"unknown",(r=n.context.domElement.getAttribute("skybox-image"))!=null&&r.length||0>0||n.context.lightmaps.tryGetSkybox(a.sourceId)?a.clearFlags=Cd.Skybox:a.clearFlags=Cd.SolidColor,a.backgroundColor=new ki(.5,.5,.5,1),a.fieldOfView=35,n.context.domElement.getAttribute("transparent")!=null&&(a.clearFlags=Cd.Uninitialized),a.backgroundBlurriness=.2;const l=Sf(o,a,!0);o.position.x=0,o.position.y=1,o.position.z=2;const c=n.context.domElement;return c?.cameraControls!=!1&&LX(n.context,l),l}),fi.registerCallback(Si.ContextCreated,n=>{if(!n.context.mainCamera){WM&&console.log("Will not auto-fit because a default camera exists");return}const e=n.context.domElement;if(e?.cameraControls==!0){const i=xj(n.context.mainCamera);if(i?.isCameraController==!0){WM&&console.log("Will not auto-fit because a camera controller exists");return}LX(n.context)}});function LX(n,e){e=e??n.mainCameraComponent;const i=e?.gameObject;if(WM&&console.log("Creating default camera controls",e?.name),i){const r=YA(i,wi);r.sourceId=e?.sourceId??"unknown";const s=n.domElement.getAttribute("auto-rotate");r.autoRotate=s!==void 0&&(s===""||s==="true"),r.autoRotateSpeed=.5,r.autoFit=!0}else console.warn("Missing camera object, can not add orbit controls")}const xm={Context:Ot,glTF:{loadFromURL:P3}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported"),globalThis.Needle=xm;function UX(n){for(const e in n)xm[e]=n[e]}UX(Ege),UX(_1e),xm.onStart=KO,xm.onUpdate=ZO,xm.onBeforeRender=WQ,xm.NeedleXRSession=Et;for(const n of Object.getOwnPropertyNames(ie))switch(n){case"prototype":case"constructor":case"length":case"name":continue;default:xm[n]=ie[n];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=Zte;class pSe{constructor(e){if(this._retries=0,!Number.isInteger(e)||e<0)throw new Error("Backoff must be a positive integer");this.backoff=e}get retries(){return this._retries}get current(){return this.backoff}next(){return this._retries++,this.backoff}reset(){this._retries=0}}class fSe{constructor(e,i){if(this._retries=0,!Number.isInteger(e)||e<0)throw new Error("Base must be a positive integer or zero");if(i!==void 0&&(!Number.isInteger(i)||i<0))throw new Error("ExpMax must be a undefined, a positive integer or zero");this.base=e,this.expMax=i,this.i=0}get retries(){return this._retries}get current(){return this.base*Math.pow(2,this.i)}next(){return this._retries++,this.i=this.expMax===void 0?this.i+1:Math.min(this.i+1,this.expMax),this.current}reset(){this._retries=0,this.i=0}}class mSe{constructor(e,i,r){if(this.i=0,this._retries=0,e<0)throw new Error("Initial must be a positive number or zero");if(i<0)throw new Error("Increment must be a positive number or zero");if(r!==void 0&&r<0)throw new Error("Max must be undefined, a positive number or zero");if(r!==void 0&&r<e)throw new Error("Max must be undefined or greater than or equal to initial");this.initial=e,this.increment=i,this.max=r}get retries(){return this._retries}get current(){return this.max===void 0?this.initial+this.increment*this.i:Math.min(this.initial+this.increment*this.i,this.max)}next(){return this._retries++,this.i++,this.current}reset(){this._retries=0,this.i=0}}class gSe{constructor(){this.elements=[]}add(e){this.elements.push(e)}clear(){this.elements.length=0}forEach(e){this.elements.forEach(e)}length(){return this.elements.length}isEmpty(){return this.elements.length===0}peek(){return this.elements[0]}read(){return this.elements.shift()}}class vSe{constructor(e){if(!Number.isInteger(e)||e<=0)throw new Error("Capacity must be a positive integer");this.elements=new Array(e+1),this.head=0,this.tail=0}add(e){this.elements[this.head]=e,this.head=(this.head+1)%this.elements.length,this.head===this.tail&&(this.tail=(this.tail+1)%this.elements.length)}clear(){this.head=0,this.tail=0}forEach(e){for(let i=this.tail;i!==this.head;i=(i+1)%this.elements.length)e(this.elements[i])}length(){return this.tail===this.head?0:this.tail<this.head?this.head-this.tail:this.elements.length-this.tail+this.head}isEmpty(){return this.head===this.tail}peek(){return this.isEmpty()?void 0:this.elements[this.tail]}read(){const e=this.peek();return e!==void 0&&(this.tail=(this.tail+1)%this.elements.length),e}}var Fi;(function(n){n.open="open",n.close="close",n.error="error",n.message="message",n.retry="retry",n.reconnect="reconnect"})(Fi||(Fi={}));class FX{constructor(e,i,r){var s,o,a,l,c,h,u,d,f,m,g,v,y,A,b;this._closedByUser=!1,this.handleOpenEvent=x=>this.handleEvent(Fi.open,x),this.handleErrorEvent=x=>this.handleEvent(Fi.error,x),this.handleCloseEvent=x=>this.handleEvent(Fi.close,x),this.handleMessageEvent=x=>this.handleEvent(Fi.message,x),this._url=e,this._protocols=i,this._options={buffer:r?.buffer,retry:{maxRetries:(s=r?.retry)===null||s===void 0?void 0:s.maxRetries,instantReconnect:(o=r?.retry)===null||o===void 0?void 0:o.instantReconnect,backoff:(a=r?.retry)===null||a===void 0?void 0:a.backoff},listeners:{open:[...(c=(l=r?.listeners)===null||l===void 0?void 0:l.open)!==null&&c!==void 0?c:[]],close:[...(u=(h=r?.listeners)===null||h===void 0?void 0:h.close)!==null&&u!==void 0?u:[]],error:[...(f=(d=r?.listeners)===null||d===void 0?void 0:d.error)!==null&&f!==void 0?f:[]],message:[...(g=(m=r?.listeners)===null||m===void 0?void 0:m.message)!==null&&g!==void 0?g:[]],retry:[...(y=(v=r?.listeners)===null||v===void 0?void 0:v.retry)!==null&&y!==void 0?y:[]],reconnect:[...(b=(A=r?.listeners)===null||A===void 0?void 0:A.reconnect)!==null&&b!==void 0?b:[]]}},this._underlyingWebsocket=this.tryConnect()}get url(){return this._url}get protocols(){return this._protocols}get buffer(){return this._options.buffer}get maxRetries(){return this._options.retry.maxRetries}get instantReconnect(){return this._options.retry.instantReconnect}get backoff(){return this._options.retry.backoff}get closedByUser(){return this._closedByUser}get lastConnection(){return this._lastConnection}get underlyingWebsocket(){return this._underlyingWebsocket}get readyState(){return this._underlyingWebsocket.readyState}get bufferedAmount(){return this._underlyingWebsocket.bufferedAmount}get extensions(){return this._underlyingWebsocket.extensions}get binaryType(){return this._underlyingWebsocket.binaryType}set binaryType(e){this._underlyingWebsocket.binaryType=e}send(e){this.closedByUser||(this._underlyingWebsocket.readyState===this._underlyingWebsocket.OPEN?this._underlyingWebsocket.send(e):this.buffer!==void 0&&this.buffer.add(e))}close(e,i){this.cancelScheduledConnectionRetry(),this._closedByUser=!0,this._underlyingWebsocket.close(e,i)}addEventListener(e,i,r){this._options.listeners[e].push({listener:i,options:r})}removeEventListener(e,i,r){const s=o=>o.listener!==i||o.options!==r;this._options.listeners[e]=this._options.listeners[e].filter(s)}tryConnect(){return this._underlyingWebsocket=new WebSocket(this.url,this.protocols),this._underlyingWebsocket.addEventListener(Fi.open,this.handleOpenEvent),this._underlyingWebsocket.addEventListener(Fi.close,this.handleCloseEvent),this._underlyingWebsocket.addEventListener(Fi.error,this.handleErrorEvent),this._underlyingWebsocket.addEventListener(Fi.message,this.handleMessageEvent),this._underlyingWebsocket}clearWebsocket(){this._underlyingWebsocket.removeEventListener(Fi.open,this.handleOpenEvent),this._underlyingWebsocket.removeEventListener(Fi.close,this.handleCloseEvent),this._underlyingWebsocket.removeEventListener(Fi.error,this.handleErrorEvent),this._underlyingWebsocket.removeEventListener(Fi.message,this.handleMessageEvent),this._underlyingWebsocket.close()}dispatchEvent(e,i){const r=this._options.listeners[e],s=[];r.forEach(({listener:o,options:a})=>{o(this,i),(a===void 0||a.once===void 0||!a.once)&&s.push({listener:o,options:a})}),this._options.listeners[e]=s}handleEvent(e,i){switch(e){case Fi.close:this.dispatchEvent(e,i),this.scheduleConnectionRetryIfNeeded();break;case Fi.open:if(this.backoff!==void 0&&this._lastConnection!==void 0){const r={retries:this.backoff.retries,lastConnection:new Date(this._lastConnection)},s=new CustomEvent(Fi.reconnect,{detail:r});this.dispatchEvent(Fi.reconnect,s),this.backoff.reset()}this._lastConnection=new Date,this.dispatchEvent(e,i),this.sendBufferedData();break;case Fi.retry:this.dispatchEvent(e,i),this.clearWebsocket(),this.tryConnect();break;default:this.dispatchEvent(e,i);break}}sendBufferedData(){if(this.buffer!==void 0)for(let e=this.buffer.read();e!==void 0;e=this.buffer.read())this.send(e)}scheduleConnectionRetryIfNeeded(){if(this.closedByUser||this.backoff===void 0)return;const e=r=>{const s=new CustomEvent(Fi.retry,{detail:r});this.handleEvent(Fi.retry,s)},i={backoff:this._options.retry.instantReconnect===!0?0:this.backoff.next(),retries:this._options.retry.instantReconnect===!0?0:this.backoff.retries,lastConnection:this._lastConnection};(this._options.retry.maxRetries===void 0||i.retries<=this._options.retry.maxRetries)&&(this.retryTimeout=globalThis.setTimeout(()=>e(i),i.backoff))}cancelScheduledConnectionRetry(){globalThis.clearTimeout(this.retryTimeout)}}class ySe{constructor(e){this._url=e}get url(){return this._url}withProtocols(e){return this._protocols=e,this}get protocols(){return this._protocols}withMaxRetries(e){var i;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(i=this._options)===null||i===void 0?void 0:i.retry),{maxRetries:e})}),this}get maxRetries(){var e,i;return(i=(e=this._options)===null||e===void 0?void 0:e.retry)===null||i===void 0?void 0:i.maxRetries}withInstantReconnect(e){var i;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(i=this._options)===null||i===void 0?void 0:i.retry),{instantReconnect:e})}),this}get instantReconnect(){var e,i;return(i=(e=this._options)===null||e===void 0?void 0:e.retry)===null||i===void 0?void 0:i.instantReconnect}withBackoff(e){var i;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(i=this._options)===null||i===void 0?void 0:i.retry),{backoff:e})}),this}get backoff(){var e,i;return(i=(e=this._options)===null||e===void 0?void 0:e.retry)===null||i===void 0?void 0:i.backoff}withBuffer(e){return this._options=Object.assign(Object.assign({},this._options),{buffer:e}),this}get buffer(){var e;return(e=this._options)===null||e===void 0?void 0:e.buffer}onOpen(e,i){return this.addListener(Fi.open,e,i),this}onClose(e,i){return this.addListener(Fi.close,e,i),this}onError(e,i){return this.addListener(Fi.error,e,i),this}onMessage(e,i){return this.addListener(Fi.message,e,i),this}onRetry(e,i){return this.addListener(Fi.retry,e,i),this}onReconnect(e,i){return this.addListener(Fi.reconnect,e,i),this}build(){return new FX(this._url,this._protocols,this._options)}addListener(e,i,r){var s,o,a,l,c,h,u,d,f,m,g,v,y,A,b,x,_,w,T,M,R;return this._options=Object.assign(Object.assign({},this._options),{listeners:{open:(a=(o=(s=this._options)===null||s===void 0?void 0:s.listeners)===null||o===void 0?void 0:o.open)!==null&&a!==void 0?a:[],close:(h=(c=(l=this._options)===null||l===void 0?void 0:l.listeners)===null||c===void 0?void 0:c.close)!==null&&h!==void 0?h:[],error:(f=(d=(u=this._options)===null||u===void 0?void 0:u.listeners)===null||d===void 0?void 0:d.error)!==null&&f!==void 0?f:[],message:(v=(g=(m=this._options)===null||m===void 0?void 0:m.listeners)===null||g===void 0?void 0:g.message)!==null&&v!==void 0?v:[],retry:(b=(A=(y=this._options)===null||y===void 0?void 0:y.listeners)===null||A===void 0?void 0:A.retry)!==null&&b!==void 0?b:[],reconnect:(w=(_=(x=this._options)===null||x===void 0?void 0:x.listeners)===null||_===void 0?void 0:_.reconnect)!==null&&w!==void 0?w:[],[e]:[...(R=(M=(T=this._options)===null||T===void 0?void 0:T.listeners)===null||M===void 0?void 0:M[e])!==null&&R!==void 0?R:[],{listener:i,options:r}]}}),this}}const ASe=Object.freeze(Object.defineProperty({__proto__:null,ArrayQueue:gSe,ConstantBackoff:pSe,ExponentialBackoff:fSe,LinearBackoff:mSe,RingQueue:vSe,Websocket:FX,WebsocketBuilder:ySe,get WebsocketEvent(){return Fi}},Symbol.toStringTag,{value:"Module"})),q3=0,NX=1,zX=2,bSe=0,xSe=1,Y3=2,XM=1.25,J3=1,rp=6*4+4+4,qM=65535,_Se=Math.pow(2,-24),K3=Symbol("SKIP_GENERATION");function jX(n){return n.index?n.index.count:n.attributes.position.count}function Sv(n){return jX(n)/3}function GX(n,e=ArrayBuffer){return n>65535?new Uint32Array(new e(4*n)):new Uint16Array(new e(2*n))}function wSe(n,e){if(!n.index){const i=n.attributes.position.count,r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=GX(i,r);n.setIndex(new Ye(s,1));for(let o=0;o<i;o++)s[o]=o}}function HX(n){const e=Sv(n),i=n.drawRange,r=i.start/3,s=(i.start+i.count)/3,o=Math.max(0,r),a=Math.min(e,s)-o;return[{offset:Math.floor(o),count:Math.floor(a)}]}function VX(n){if(!n.groups||!n.groups.length)return HX(n);const e=[],i=new Set,r=n.drawRange,s=r.start/3,o=(r.start+r.count)/3;for(const l of n.groups){const c=l.start/3,h=(l.start+l.count)/3;i.add(Math.max(s,c)),i.add(Math.min(o,h))}const a=Array.from(i.values()).sort((l,c)=>l-c);for(let l=0;l<a.length-1;l++){const c=a[l],h=a[l+1];e.push({offset:Math.floor(c),count:Math.floor(h-c)})}return e}function SSe(n){if(n.groups.length===0)return!1;const e=Sv(n),i=VX(n).sort((o,a)=>o.offset-a.offset),r=i[i.length-1];r.count=Math.min(e-r.offset,r.count);let s=0;return i.forEach(({count:o})=>s+=o),e!==s}function Z3(n,e,i,r,s){let o=1/0,a=1/0,l=1/0,c=-1/0,h=-1/0,u=-1/0,d=1/0,f=1/0,m=1/0,g=-1/0,v=-1/0,y=-1/0;for(let A=e*6,b=(e+i)*6;A<b;A+=6){const x=n[A+0],_=n[A+1],w=x-_,T=x+_;w<o&&(o=w),T>c&&(c=T),x<d&&(d=x),x>g&&(g=x);const M=n[A+2],R=n[A+3],B=M-R,E=M+R;B<a&&(a=B),E>h&&(h=E),M<f&&(f=M),M>v&&(v=M);const P=n[A+4],O=n[A+5],N=P-O,L=P+O;N<l&&(l=N),L>u&&(u=L),P<m&&(m=P),P>y&&(y=P)}r[0]=o,r[1]=a,r[2]=l,r[3]=c,r[4]=h,r[5]=u,s[0]=d,s[1]=f,s[2]=m,s[3]=g,s[4]=v,s[5]=y}function CSe(n,e=null,i=null,r=null){const s=n.attributes.position,o=n.index?n.index.array:null,a=Sv(n),l=s.normalized;let c;e===null?(c=new Float32Array(a*6*4),i=0,r=a):(c=e,i=i||0,r=r||a);const h=s.array,u=s.offset||0;let d=3;s.isInterleavedBufferAttribute&&(d=s.data.stride);const f=["getX","getY","getZ"];for(let m=i;m<i+r;m++){const g=m*3,v=m*6;let y=g+0,A=g+1,b=g+2;o&&(y=o[y],A=o[A],b=o[b]),l||(y=y*d+u,A=A*d+u,b=b*d+u);for(let x=0;x<3;x++){let _,w,T;l?(_=s[f[x]](y),w=s[f[x]](A),T=s[f[x]](b)):(_=h[y+x],w=h[A+x],T=h[b+x]);let M=_;w<M&&(M=w),T<M&&(M=T);let R=_;w>R&&(R=w),T>R&&(R=T);const B=(R-M)/2,E=x*2;c[v+E+0]=M+B,c[v+E+1]=B+(Math.abs(M)+B)*_Se}}return c}function Ji(n,e,i){return i.min.x=e[n],i.min.y=e[n+1],i.min.z=e[n+2],i.max.x=e[n+3],i.max.y=e[n+4],i.max.z=e[n+5],i}function QX(n){let e=-1,i=-1/0;for(let r=0;r<3;r++){const s=n[r+3]-n[r];s>i&&(i=s,e=r)}return e}function WX(n,e){e.set(n)}function XX(n,e,i){let r,s;for(let o=0;o<3;o++){const a=o+3;r=n[o],s=e[o],i[o]=r<s?r:s,r=n[a],s=e[a],i[a]=r>s?r:s}}function YM(n,e,i){for(let r=0;r<3;r++){const s=e[n+2*r],o=e[n+2*r+1],a=s-o,l=s+o;a<i[r]&&(i[r]=a),l>i[r+3]&&(i[r+3]=l)}}function Kx(n){const e=n[3]-n[0],i=n[4]-n[1],r=n[5]-n[2];return 2*(e*i+i*r+r*e)}const su=32,ESe=(n,e)=>n.candidate-e.candidate,sp=new Array(su).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),JM=new Float32Array(6);function MSe(n,e,i,r,s,o){let a=-1,l=0;if(o===q3)a=QX(e),a!==-1&&(l=(e[a]+e[a+3])/2);else if(o===NX)a=QX(n),a!==-1&&(l=TSe(i,r,s,a));else if(o===zX){const c=Kx(n);let h=XM*s;const u=r*6,d=(r+s)*6;for(let f=0;f<3;f++){const m=e[f],g=(e[f+3]-m)/su;if(s<su/4){const v=[...sp];v.length=s;let y=0;for(let b=u;b<d;b+=6,y++){const x=v[y];x.candidate=i[b+2*f],x.count=0;const{bounds:_,leftCacheBounds:w,rightCacheBounds:T}=x;for(let M=0;M<3;M++)T[M]=1/0,T[M+3]=-1/0,w[M]=1/0,w[M+3]=-1/0,_[M]=1/0,_[M+3]=-1/0;YM(b,i,_)}v.sort(ESe);let A=s;for(let b=0;b<A;b++){const x=v[b];for(;b+1<A&&v[b+1].candidate===x.candidate;)v.splice(b+1,1),A--}for(let b=u;b<d;b+=6){const x=i[b+2*f];for(let _=0;_<A;_++){const w=v[_];x>=w.candidate?YM(b,i,w.rightCacheBounds):(YM(b,i,w.leftCacheBounds),w.count++)}}for(let b=0;b<A;b++){const x=v[b],_=x.count,w=s-x.count,T=x.leftCacheBounds,M=x.rightCacheBounds;let R=0;_!==0&&(R=Kx(T)/c);let B=0;w!==0&&(B=Kx(M)/c);const E=J3+XM*(R*_+B*w);E<h&&(a=f,h=E,l=x.candidate)}}else{for(let A=0;A<su;A++){const b=sp[A];b.count=0,b.candidate=m+g+A*g;const x=b.bounds;for(let _=0;_<3;_++)x[_]=1/0,x[_+3]=-1/0}for(let A=u;A<d;A+=6){let b=~~((i[A+2*f]-m)/g);b>=su&&(b=su-1);const x=sp[b];x.count++,YM(A,i,x.bounds)}const v=sp[su-1];WX(v.bounds,v.rightCacheBounds);for(let A=su-2;A>=0;A--){const b=sp[A],x=sp[A+1];XX(b.bounds,x.rightCacheBounds,b.rightCacheBounds)}let y=0;for(let A=0;A<su-1;A++){const b=sp[A],x=b.count,_=b.bounds,w=sp[A+1].rightCacheBounds;x!==0&&(y===0?WX(_,JM):XX(_,JM,JM)),y+=x;let T=0,M=0;y!==0&&(T=Kx(JM)/c);const R=s-y;R!==0&&(M=Kx(w)/c);const B=J3+XM*(T*y+M*R);B<h&&(a=f,h=B,l=b.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:a,pos:l}}function TSe(n,e,i,r){let s=0;for(let o=e,a=e+i;o<a;o++)s+=n[o*6+r*2];return s/i}class $3{constructor(){this.boundingData=new Float32Array(6)}}function ISe(n,e,i,r,s,o){let a=r,l=r+s-1;const c=o.pos,h=o.axis*2;for(;;){for(;a<=l&&i[a*6+h]<c;)a++;for(;a<=l&&i[l*6+h]>=c;)l--;if(a<l){for(let u=0;u<3;u++){let d=e[a*3+u];e[a*3+u]=e[l*3+u],e[l*3+u]=d}for(let u=0;u<6;u++){let d=i[a*6+u];i[a*6+u]=i[l*6+u],i[l*6+u]=d}a++,l--}else return a}}function RSe(n,e,i,r,s,o){let a=r,l=r+s-1;const c=o.pos,h=o.axis*2;for(;;){for(;a<=l&&i[a*6+h]<c;)a++;for(;a<=l&&i[l*6+h]>=c;)l--;if(a<l){let u=n[a];n[a]=n[l],n[l]=u;for(let d=0;d<6;d++){let f=i[a*6+d];i[a*6+d]=i[l*6+d],i[l*6+d]=f}a++,l--}else return a}}function vo(n,e){return e[n+15]===65535}function Fo(n,e){return e[n+6]}function ga(n,e){return e[n+14]}function Ka(n){return n+8}function va(n,e){return e[n+6]}function eU(n,e){return e[n+7]}let qX,Zx,KM,YX;const PSe=Math.pow(2,32);function tU(n){return"count"in n?1:1+tU(n.left)+tU(n.right)}function BSe(n,e,i){return qX=new Float32Array(i),Zx=new Uint32Array(i),KM=new Uint16Array(i),YX=new Uint8Array(i),iU(n,e)}function iU(n,e){const i=n/4,r=n/2,s="count"in e,o=e.boundingData;for(let a=0;a<6;a++)qX[i+a]=o[a];if(s)if(e.buffer){const a=e.buffer;YX.set(new Uint8Array(a),n);for(let l=n,c=n+a.byteLength;l<c;l+=rp){const h=l/2;vo(h,KM)||(Zx[l/4+6]+=i)}return n+a.byteLength}else{const a=e.offset,l=e.count;return Zx[i+6]=a,KM[r+14]=l,KM[r+15]=qM,n+rp}else{const a=e.left,l=e.right,c=e.splitAxis;let h;if(h=iU(n+rp,a),h/4>PSe)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return Zx[i+6]=h/4,h=iU(h,l),Zx[i+7]=c,h}}function kSe(n,e){const i=(n.index?n.index.count:n.attributes.position.count)/3,r=i>2**16,s=r?4:2,o=e?new SharedArrayBuffer(i*s):new ArrayBuffer(i*s),a=r?new Uint32Array(o):new Uint16Array(o);for(let l=0,c=a.length;l<c;l++)a[l]=l;return a}function OSe(n,e,i,r,s){const{maxDepth:o,verbose:a,maxLeafTris:l,strategy:c,onProgress:h,indirect:u}=s,d=n._indirectBuffer,f=n.geometry,m=f.index?f.index.array:null,g=u?RSe:ISe,v=Sv(f),y=new Float32Array(6);let A=!1;const b=new $3;return Z3(e,i,r,b.boundingData,y),_(b,i,r,y),b;function x(w){h&&h(w/v)}function _(w,T,M,R=null,B=0){if(!A&&B>=o&&(A=!0,a&&(console.warn(`MeshBVH: Max depth of ${o} reached when generating BVH. Consider increasing maxDepth.`),console.warn(f))),M<=l||B>=o)return x(T+M),w.offset=T,w.count=M,w;const E=MSe(w.boundingData,R,e,T,M,c);if(E.axis===-1)return x(T+M),w.offset=T,w.count=M,w;const P=g(d,m,e,T,M,E);if(P===T||P===T+M)x(T+M),w.offset=T,w.count=M;else{w.splitAxis=E.axis;const O=new $3,N=T,L=P-T;w.left=O,Z3(e,N,L,O.boundingData,y),_(O,N,L,y,B+1);const Q=new $3,D=P,F=M-L;w.right=Q,Z3(e,D,F,Q.boundingData,y),_(Q,D,F,y,B+1)}return w}}function DSe(n,e){const i=n.geometry;e.indirect&&(n._indirectBuffer=kSe(i,e.useSharedArrayBuffer),SSe(i)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||wSe(i,e);const r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=CSe(i),o=e.indirect?HX(i):VX(i);n._roots=o.map(a=>{const l=OSe(n,s,a.offset,a.count,e),c=tU(l),h=new r(rp*c);return BSe(0,l,h),h})}class ou{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let r=1/0,s=-1/0;for(let o=0,a=e.length;o<a;o++){const l=e[o][i];r=l<r?l:r,s=l>s?l:s}this.min=r,this.max=s}setFromPoints(e,i){let r=1/0,s=-1/0;for(let o=0,a=i.length;o<a;o++){const l=i[o],c=e.dot(l);r=c<r?c:r,s=c>s?c:s}this.min=r,this.max=s}isSeparated(e){return this.min>e.max||e.min>this.max}}ou.prototype.setFromBox=function(){const n=new S;return function(e,i){const r=i.min,s=i.max;let o=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){n.x=r.x*l+s.x*(1-l),n.y=r.y*c+s.y*(1-c),n.z=r.z*h+s.z*(1-h);const u=e.dot(n);o=Math.min(u,o),a=Math.max(u,a)}this.min=o,this.max=a}}();const LSe=function(){const n=new S,e=new S,i=new S;return function(r,s,o){const a=r.start,l=n,c=s.start,h=e;i.subVectors(a,c),n.subVectors(r.end,r.start),e.subVectors(s.end,s.start);const u=i.dot(h),d=h.dot(l),f=h.dot(h),m=i.dot(l),g=l.dot(l)*f-d*d;let v,y;g!==0?v=(u*d-m*f)/g:v=0,y=(u+v*d)/f,o.x=v,o.y=y}}(),nU=function(){const n=new J,e=new S,i=new S;return function(r,s,o,a){LSe(r,s,n);let l=n.x,c=n.y;if(l>=0&&l<=1&&c>=0&&c<=1){r.at(l,o),s.at(c,a);return}else if(l>=0&&l<=1){c<0?s.at(0,a):s.at(1,a),r.closestPointToPoint(a,!0,o);return}else if(c>=0&&c<=1){l<0?r.at(0,o):r.at(1,o),s.closestPointToPoint(o,!0,a);return}else{let h;l<0?h=r.start:h=r.end;let u;c<0?u=s.start:u=s.end;const d=e,f=i;if(r.closestPointToPoint(u,!0,e),s.closestPointToPoint(h,!0,i),d.distanceToSquared(u)<=f.distanceToSquared(h)){o.copy(d),a.copy(u);return}else{o.copy(h),a.copy(f);return}}}}(),USe=function(){const n=new S,e=new S,i=new dr,r=new Ho;return function(s,o){const{radius:a,center:l}=s,{a:c,b:h,c:u}=o;if(r.start=c,r.end=h,r.closestPointToPoint(l,!0,n).distanceTo(l)<=a||(r.start=c,r.end=u,r.closestPointToPoint(l,!0,n).distanceTo(l)<=a)||(r.start=h,r.end=u,r.closestPointToPoint(l,!0,n).distanceTo(l)<=a))return!0;const d=o.getPlane(i);if(Math.abs(d.distanceToPoint(l))<=a){const f=d.projectPoint(l,e);if(o.containsPoint(f))return!0}return!1}}(),FSe=1e-15;function rU(n){return Math.abs(n)<FSe}class Za extends Xr{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new S),this.satBounds=new Array(4).fill().map(()=>new ou),this.points=[this.a,this.b,this.c],this.sphere=new Zi,this.plane=new dr,this.needsUpdate=!0}intersectsSphere(e){return USe(e,this)}update(){const e=this.a,i=this.b,r=this.c,s=this.points,o=this.satAxes,a=this.satBounds,l=o[0],c=a[0];this.getNormal(l),c.setFromPoints(l,s);const h=o[1],u=a[1];h.subVectors(e,i),u.setFromPoints(h,s);const d=o[2],f=a[2];d.subVectors(i,r),f.setFromPoints(d,s);const m=o[3],g=a[3];m.subVectors(r,e),g.setFromPoints(m,s),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(l,e),this.needsUpdate=!1}}Za.prototype.closestPointToSegment=function(){const n=new S,e=new S,i=new Ho;return function(r,s=null,o=null){const{start:a,end:l}=r,c=this.points;let h,u=1/0;for(let d=0;d<3;d++){const f=(d+1)%3;i.start.copy(c[d]),i.end.copy(c[f]),nU(i,r,n,e),h=n.distanceToSquared(e),h<u&&(u=h,s&&s.copy(n),o&&o.copy(e))}return this.closestPointToPoint(a,n),h=a.distanceToSquared(n),h<u&&(u=h,s&&s.copy(n),o&&o.copy(a)),this.closestPointToPoint(l,n),h=l.distanceToSquared(n),h<u&&(u=h,s&&s.copy(n),o&&o.copy(l)),Math.sqrt(u)}}(),Za.prototype.intersectsTriangle=function(){const n=new Za,e=new Array(3),i=new Array(3),r=new ou,s=new ou,o=new S,a=new S,l=new S,c=new S,h=new S,u=new Ho,d=new Ho,f=new Ho,m=new S;function g(v,y,A){const b=v.points;let x=0,_=-1;for(let w=0;w<3;w++){const{start:T,end:M}=u;T.copy(b[w]),M.copy(b[(w+1)%3]),u.delta(a);const R=rU(y.distanceToPoint(T));if(rU(y.normal.dot(a))&&R){A.copy(u),x=2;break}const B=y.intersectLine(u,m);if(!B&&R&&m.copy(T),(B||R)&&!rU(m.distanceTo(M))){if(x<=1)(x===1?A.start:A.end).copy(m),R&&(_=x);else if(x>=2){(_===1?A.start:A.end).copy(m),x=2;break}if(x++,x===2&&_===-1)break}}return x}return function(v,y=null,A=!1){this.needsUpdate&&this.update(),v.isExtendedTriangle?v.needsUpdate&&v.update():(n.copy(v),n.update(),v=n);const b=this.plane,x=v.plane;if(Math.abs(b.normal.dot(x.normal))>1-1e-10){const _=this.satBounds,w=this.satAxes;i[0]=v.a,i[1]=v.b,i[2]=v.c;for(let R=0;R<4;R++){const B=_[R],E=w[R];if(r.setFromPoints(E,i),B.isSeparated(r))return!1}const T=v.satBounds,M=v.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let R=0;R<4;R++){const B=T[R],E=M[R];if(r.setFromPoints(E,e),B.isSeparated(r))return!1}for(let R=0;R<4;R++){const B=w[R];for(let E=0;E<4;E++){const P=M[E];if(o.crossVectors(B,P),r.setFromPoints(o,e),s.setFromPoints(o,i),r.isSeparated(s))return!1}}return y&&(A||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),y.start.set(0,0,0),y.end.set(0,0,0)),!0}else{const _=g(this,x,d);if(_===1&&v.containsPoint(d.end))return y&&(y.start.copy(d.end),y.end.copy(d.end)),!0;if(_!==2)return!1;const w=g(v,b,f);if(w===1&&this.containsPoint(f.end))return y&&(y.start.copy(f.end),y.end.copy(f.end)),!0;if(w!==2)return!1;if(d.delta(l),f.delta(c),l.dot(c)<0){let O=f.start;f.start=f.end,f.end=O}const T=d.start.dot(l),M=d.end.dot(l),R=f.start.dot(l),B=f.end.dot(l),E=M<R,P=T<B;return T!==B&&R!==M&&E===P?!1:(y&&(h.subVectors(d.start,f.start),h.dot(l)>0?y.start.copy(d.start):y.start.copy(f.start),h.subVectors(d.end,f.end),h.dot(l)<0?y.end.copy(d.end):y.end.copy(f.end)),!0)}}}(),Za.prototype.distanceToPoint=function(){const n=new S;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}}(),Za.prototype.distanceToTriangle=function(){const n=new S,e=new S,i=["a","b","c"],r=new Ho,s=new Ho;return function(o,a=null,l=null){const c=a||l?r:null;if(this.intersectsTriangle(o,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let h=1/0;for(let u=0;u<3;u++){let d;const f=i[u],m=o[f];this.closestPointToPoint(m,n),d=m.distanceToSquared(n),d<h&&(h=d,a&&a.copy(n),l&&l.copy(m));const g=this[f];o.closestPointToPoint(g,n),d=g.distanceToSquared(n),d<h&&(h=d,a&&a.copy(g),l&&l.copy(n))}for(let u=0;u<3;u++){const d=i[u],f=i[(u+1)%3];r.set(this[d],this[f]);for(let m=0;m<3;m++){const g=i[m],v=i[(m+1)%3];s.set(o[g],o[v]),nU(r,s,n,e);const y=n.distanceToSquared(e);y<h&&(h=y,a&&a.copy(n),l&&l.copy(e))}}return Math.sqrt(h)}}();class Qs{constructor(e,i,r){this.isOrientedBox=!0,this.min=new S,this.max=new S,this.matrix=new he,this.invMatrix=new he,this.points=new Array(8).fill().map(()=>new S),this.satAxes=new Array(3).fill().map(()=>new S),this.satBounds=new Array(3).fill().map(()=>new ou),this.alignedSatBounds=new Array(3).fill().map(()=>new ou),this.needsUpdate=!1,e&&this.min.copy(e),i&&this.max.copy(i),r&&this.matrix.copy(r)}set(e,i,r){this.min.copy(e),this.max.copy(i),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Qs.prototype.update=function(){return function(){const n=this.matrix,e=this.min,i=this.max,r=this.points;for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)for(let u=0;u<=1;u++){const d=1*c|2*h|4*u,f=r[d];f.x=c?i.x:e.x,f.y=h?i.y:e.y,f.z=u?i.z:e.z,f.applyMatrix4(n)}const s=this.satBounds,o=this.satAxes,a=r[0];for(let c=0;c<3;c++){const h=o[c],u=s[c],d=1<<c,f=r[d];h.subVectors(a,f),u.setFromPoints(h,r)}const l=this.alignedSatBounds;l[0].setFromPointsField(r,"x"),l[1].setFromPointsField(r,"y"),l[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),Qs.prototype.intersectsBox=function(){const n=new ou;return function(e){this.needsUpdate&&this.update();const i=e.min,r=e.max,s=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(n.min=i.x,n.max=r.x,a[0].isSeparated(n)||(n.min=i.y,n.max=r.y,a[1].isSeparated(n))||(n.min=i.z,n.max=r.z,a[2].isSeparated(n)))return!1;for(let l=0;l<3;l++){const c=o[l],h=s[l];if(n.setFromBox(c,e),h.isSeparated(n))return!1}return!0}}(),Qs.prototype.intersectsTriangle=function(){const n=new Za,e=new Array(3),i=new ou,r=new ou,s=new S;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(n.copy(o),n.update(),o=n);const a=this.satBounds,l=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let d=0;d<3;d++){const f=a[d],m=l[d];if(i.setFromPoints(m,e),f.isSeparated(i))return!1}const c=o.satBounds,h=o.satAxes,u=this.points;for(let d=0;d<3;d++){const f=c[d],m=h[d];if(i.setFromPoints(m,u),f.isSeparated(i))return!1}for(let d=0;d<3;d++){const f=l[d];for(let m=0;m<4;m++){const g=h[m];if(s.crossVectors(f,g),i.setFromPoints(s,e),r.setFromPoints(s,u),i.isSeparated(r))return!1}}return!0}}(),Qs.prototype.closestPointToPoint=function(){return function(n,e){return this.needsUpdate&&this.update(),e.copy(n).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}(),Qs.prototype.distanceToPoint=function(){const n=new S;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}}(),Qs.prototype.distanceToBox=function(){const n=["x","y","z"],e=new Array(12).fill().map(()=>new Ho),i=new Array(12).fill().map(()=>new Ho),r=new S,s=new S;return function(o,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(l||c)&&(o.getCenter(s),this.closestPointToPoint(s,r),o.closestPointToPoint(r,s),l&&l.copy(r),c&&c.copy(s)),0;const h=a*a,u=o.min,d=o.max,f=this.points;let m=1/0;for(let v=0;v<8;v++){const y=f[v];s.copy(y).clamp(u,d);const A=y.distanceToSquared(s);if(A<m&&(m=A,l&&l.copy(y),c&&c.copy(s),A<h))return Math.sqrt(A)}let g=0;for(let v=0;v<3;v++)for(let y=0;y<=1;y++)for(let A=0;A<=1;A++){const b=(v+1)%3,x=(v+2)%3,_=y<<b|A<<x,w=1<<v|y<<b|A<<x,T=f[_],M=f[w];e[g].set(T,M);const R=n[v],B=n[b],E=n[x],P=i[g],O=P.start,N=P.end;O[R]=u[R],O[B]=y?u[B]:d[B],O[E]=A?u[E]:d[B],N[R]=d[R],N[B]=y?u[B]:d[B],N[E]=A?u[E]:d[B],g++}for(let v=0;v<=1;v++)for(let y=0;y<=1;y++)for(let A=0;A<=1;A++){s.x=v?d.x:u.x,s.y=y?d.y:u.y,s.z=A?d.z:u.z,this.closestPointToPoint(s,r);const b=s.distanceToSquared(r);if(b<m&&(m=b,l&&l.copy(r),c&&c.copy(s),b<h))return Math.sqrt(b)}for(let v=0;v<12;v++){const y=e[v];for(let A=0;A<12;A++){const b=i[A];nU(y,b,r,s);const x=r.distanceToSquared(s);if(x<m&&(m=x,l&&l.copy(r),c&&c.copy(s),x<h))return Math.sqrt(x)}}return Math.sqrt(m)}}();class sU{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class NSe extends sU{constructor(){super(()=>new Za)}}const $a=new NSe;class zSe{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let i=null;this.setBuffer=r=>{i&&e.push(i),i=r,this.float32Array=new Float32Array(r),this.uint16Array=new Uint16Array(r),this.uint32Array=new Uint32Array(r)},this.clearBuffer=()=>{i=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const rn=new zSe;let op,Cv;const Ev=[],ZM=new sU(()=>new Ht);function jSe(n,e,i,r,s,o){op=ZM.getPrimitive(),Cv=ZM.getPrimitive(),Ev.push(op,Cv),rn.setBuffer(n._roots[e]);const a=oU(0,n.geometry,i,r,s,o);rn.clearBuffer(),ZM.releasePrimitive(op),ZM.releasePrimitive(Cv),Ev.pop(),Ev.pop();const l=Ev.length;return l>0&&(Cv=Ev[l-1],op=Ev[l-2]),a}function oU(n,e,i,r,s=null,o=0,a=0){const{float32Array:l,uint16Array:c,uint32Array:h}=rn;let u=n*2;if(vo(u,c)){const d=Fo(n,h),f=ga(u,c);return Ji(n,l,op),r(d,f,!1,a,o+n,op)}else{let d=function(P){const{uint16Array:O,uint32Array:N}=rn;let L=P*2;for(;!vo(L,O);)P=Ka(P),L=P*2;return Fo(P,N)},f=function(P){const{uint16Array:O,uint32Array:N}=rn;let L=P*2;for(;!vo(L,O);)P=va(P,N),L=P*2;return Fo(P,N)+ga(L,O)};const m=Ka(n),g=va(n,h);let v=m,y=g,A,b,x,_;if(s&&(x=op,_=Cv,Ji(v,l,x),Ji(y,l,_),A=s(x),b=s(_),b<A)){v=g,y=m;const P=A;A=b,b=P,x=_}x||(x=op,Ji(v,l,x));const w=vo(v*2,c),T=i(x,w,A,a+1,o+v);let M;if(T===Y3){const P=d(v),O=f(v)-P;M=r(P,O,!0,a+1,o+v,x)}else M=T&&oU(v,e,i,r,s,o,a+1);if(M)return!0;_=Cv,Ji(y,l,_);const R=vo(y*2,c),B=i(_,R,b,a+1,o+y);let E;if(B===Y3){const P=d(y),O=f(y)-P;E=r(P,O,!0,a+1,o+y,_)}else E=B&&oU(y,e,i,r,s,o,a+1);return!!E}}const $x=new S,aU=new S;function GSe(n,e,i={},r=0,s=1/0){const o=r*r,a=s*s;let l=1/0,c=null;if(n.shapecast({boundsTraverseOrder:u=>($x.copy(e).clamp(u.min,u.max),$x.distanceToSquared(e)),intersectsBounds:(u,d,f)=>f<l&&f<a,intersectsTriangle:(u,d)=>{u.closestPointToPoint(e,$x);const f=e.distanceToSquared($x);return f<l&&(aU.copy($x),l=f,c=d),f<o}}),l===1/0)return null;const h=Math.sqrt(l);return i.point?i.point.copy(aU):i.point=aU.clone(),i.distance=h,i.faceIndex=c,i}const Mv=new S,Tv=new S,Iv=new S,$M=new J,eT=new J,tT=new J,JX=new S,KX=new S,ZX=new S,iT=new S;function HSe(n,e,i,r,s,o,a,l){let c;if(o===an?c=n.intersectTriangle(r,i,e,!0,s):c=n.intersectTriangle(e,i,r,o!==yi,s),c===null)return null;const h=n.origin.distanceTo(s);return h<a||h>l?null:{distance:h,point:s.clone()}}function VSe(n,e,i,r,s,o,a,l,c,h,u){Mv.fromBufferAttribute(e,o),Tv.fromBufferAttribute(e,a),Iv.fromBufferAttribute(e,l);const d=HSe(n,Mv,Tv,Iv,iT,c,h,u);if(d){r&&($M.fromBufferAttribute(r,o),eT.fromBufferAttribute(r,a),tT.fromBufferAttribute(r,l),d.uv=Xr.getInterpolation(iT,Mv,Tv,Iv,$M,eT,tT,new J)),s&&($M.fromBufferAttribute(s,o),eT.fromBufferAttribute(s,a),tT.fromBufferAttribute(s,l),d.uv1=Xr.getInterpolation(iT,Mv,Tv,Iv,$M,eT,tT,new J)),i&&(JX.fromBufferAttribute(i,o),KX.fromBufferAttribute(i,a),ZX.fromBufferAttribute(i,l),d.normal=Xr.getInterpolation(iT,Mv,Tv,Iv,JX,KX,ZX,new S),d.normal.dot(n.direction)>0&&d.normal.multiplyScalar(-1));const f={a:o,b:a,c:l,normal:new S,materialIndex:0};Xr.getNormal(Mv,Tv,Iv,f.normal),d.face=f,d.faceIndex=o}return d}function nT(n,e,i,r,s,o,a){const l=r*3;let c=l+0,h=l+1,u=l+2;const d=n.index;n.index&&(c=d.getX(c),h=d.getX(h),u=d.getX(u));const{position:f,normal:m,uv:g,uv1:v}=n.attributes,y=VSe(i,f,m,g,v,c,h,u,e,o,a);return y?(y.faceIndex=r,s&&s.push(y),y):null}function lr(n,e,i,r){const s=n.a,o=n.b,a=n.c;let l=e,c=e+1,h=e+2;i&&(l=i.getX(l),c=i.getX(c),h=i.getX(h)),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),o.x=r.getX(c),o.y=r.getY(c),o.z=r.getZ(c),a.x=r.getX(h),a.y=r.getY(h),a.z=r.getZ(h)}const rT=new S,sT=new S,oT=new S,$X=new J,eq=new J,tq=new J;function QSe(n,e,i,r){const s=e.getIndex().array,o=e.getAttribute("position"),a=e.getAttribute("uv"),l=s[i*3],c=s[i*3+1],h=s[i*3+2];rT.fromBufferAttribute(o,l),sT.fromBufferAttribute(o,c),oT.fromBufferAttribute(o,h);let u=0;const d=e.groups,f=i*3;for(let g=0,v=d.length;g<v;g++){const y=d[g],{start:A,count:b}=y;if(f>=A&&f<A+b){u=y.materialIndex;break}}let m=null;return a&&($X.fromBufferAttribute(a,l),eq.fromBufferAttribute(a,c),tq.fromBufferAttribute(a,h),r&&r.uv?m=r.uv:m=new J,Xr.getInterpolation(n,rT,sT,oT,$X,eq,tq,m)),r?(r.face||(r.face={}),r.face.a=l,r.face.b=c,r.face.c=h,r.face.materialIndex=u,r.face.normal||(r.face.normal=new S),Xr.getNormal(rT,sT,oT,r.face.normal),m&&(r.uv=m),r):{face:{a:l,b:c,c:h,materialIndex:u,normal:Xr.getNormal(rT,sT,oT,new S)},uv:m}}function WSe(n,e,i,r,s,o,a,l){const{geometry:c,_indirectBuffer:h}=n;for(let u=r,d=r+s;u<d;u++)nT(c,e,i,u,o,a,l)}function XSe(n,e,i,r,s,o,a){const{geometry:l,_indirectBuffer:c}=n;let h=1/0,u=null;for(let d=r,f=r+s;d<f;d++){let m;m=nT(l,e,i,d,null,o,a),m&&m.distance<h&&(u=m,h=m.distance)}return u}function qSe(n,e,i,r,s,o,a){const{geometry:l}=i,{index:c}=l,h=l.attributes.position;for(let u=n,d=e+n;u<d;u++){let f;if(f=u,lr(a,f*3,c,h),a.needsUpdate=!0,r(a,f,s,o))return!0}return!1}function YSe(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=n.geometry,r=i.index?i.index.array:null,s=i.attributes.position;let o,a,l,c,h=0;const u=n._roots;for(let f=0,m=u.length;f<m;f++)o=u[f],a=new Uint32Array(o),l=new Uint16Array(o),c=new Float32Array(o),d(0,h),h+=o.byteLength;function d(f,m,g=!1){const v=f*2;if(l[v+15]===qM){const y=a[f+6],A=l[v+14];let b=1/0,x=1/0,_=1/0,w=-1/0,T=-1/0,M=-1/0;for(let R=3*y,B=3*(y+A);R<B;R++){let E=r[R];const P=s.getX(E),O=s.getY(E),N=s.getZ(E);P<b&&(b=P),P>w&&(w=P),O<x&&(x=O),O>T&&(T=O),N<_&&(_=N),N>M&&(M=N)}return c[f+0]!==b||c[f+1]!==x||c[f+2]!==_||c[f+3]!==w||c[f+4]!==T||c[f+5]!==M?(c[f+0]=b,c[f+1]=x,c[f+2]=_,c[f+3]=w,c[f+4]=T,c[f+5]=M,!0):!1}else{const y=f+8,A=a[f+6],b=y+m,x=A+m;let _=g,w=!1,T=!1;e?_||(w=e.has(b),T=e.has(x),_=!w&&!T):(w=!0,T=!0);const M=_||w,R=_||T;let B=!1;M&&(B=d(y,m,_));let E=!1;R&&(E=d(A,m,_));const P=B||E;if(P)for(let O=0;O<3;O++){const N=y+O,L=A+O,Q=c[N],D=c[N+3],F=c[L],H=c[L+3];c[f+O]=Q<F?Q:F,c[f+O+3]=D>H?D:H}return P}}}function ap(n,e,i,r,s){let o,a,l,c,h,u;const d=1/i.direction.x,f=1/i.direction.y,m=1/i.direction.z,g=i.origin.x,v=i.origin.y,y=i.origin.z;let A=e[n],b=e[n+3],x=e[n+1],_=e[n+3+1],w=e[n+2],T=e[n+3+2];return d>=0?(o=(A-g)*d,a=(b-g)*d):(o=(b-g)*d,a=(A-g)*d),f>=0?(l=(x-v)*f,c=(_-v)*f):(l=(_-v)*f,c=(x-v)*f),o>c||l>a||((l>o||isNaN(o))&&(o=l),(c<a||isNaN(a))&&(a=c),m>=0?(h=(w-y)*m,u=(T-y)*m):(h=(T-y)*m,u=(w-y)*m),o>u||h>a)?!1:((h>o||o!==o)&&(o=h),(u<a||a!==a)&&(a=u),o<=s&&a>=r)}function JSe(n,e,i,r,s,o,a,l){const{geometry:c,_indirectBuffer:h}=n;for(let u=r,d=r+s;u<d;u++){let f=h?h[u]:u;nT(c,e,i,f,o,a,l)}}function KSe(n,e,i,r,s,o,a){const{geometry:l,_indirectBuffer:c}=n;let h=1/0,u=null;for(let d=r,f=r+s;d<f;d++){let m;m=nT(l,e,i,c?c[d]:d,null,o,a),m&&m.distance<h&&(u=m,h=m.distance)}return u}function ZSe(n,e,i,r,s,o,a){const{geometry:l}=i,{index:c}=l,h=l.attributes.position;for(let u=n,d=e+n;u<d;u++){let f;if(f=i.resolveTriangleIndex(u),lr(a,f*3,c,h),a.needsUpdate=!0,r(a,f,s,o))return!0}return!1}function $Se(n,e,i,r,s,o,a){rn.setBuffer(n._roots[e]),lU(0,n,i,r,s,o,a),rn.clearBuffer()}function lU(n,e,i,r,s,o,a){const{float32Array:l,uint16Array:c,uint32Array:h}=rn,u=n*2;if(vo(u,c)){const d=Fo(n,h),f=ga(u,c);WSe(e,i,r,d,f,s,o,a)}else{const d=Ka(n);ap(d,l,r,o,a)&&lU(d,e,i,r,s,o,a);const f=va(n,h);ap(f,l,r,o,a)&&lU(f,e,i,r,s,o,a)}}const eCe=["x","y","z"];function tCe(n,e,i,r,s,o){rn.setBuffer(n._roots[e]);const a=cU(0,n,i,r,s,o);return rn.clearBuffer(),a}function cU(n,e,i,r,s,o){const{float32Array:a,uint16Array:l,uint32Array:c}=rn;let h=n*2;if(vo(h,l)){const u=Fo(n,c),d=ga(h,l);return XSe(e,i,r,u,d,s,o)}else{const u=eU(n,c),d=eCe[u],f=r.direction[d]>=0;let m,g;f?(m=Ka(n),g=va(n,c)):(m=va(n,c),g=Ka(n));const v=ap(m,a,r,s,o)?cU(m,e,i,r,s,o):null;if(v){const A=v.point[d];if(f?A<=a[g+u]:A>=a[g+u+3])return v}const y=ap(g,a,r,s,o)?cU(g,e,i,r,s,o):null;return v&&y?v.distance<=y.distance?v:y:v||y||null}}const aT=new Ht,Rv=new Za,Pv=new Za,e_=new he,iq=new Qs,lT=new Qs;function iCe(n,e,i,r){rn.setBuffer(n._roots[e]);const s=hU(0,n,i,r);return rn.clearBuffer(),s}function hU(n,e,i,r,s=null){const{float32Array:o,uint16Array:a,uint32Array:l}=rn;let c=n*2;if(s===null&&(i.boundingBox||i.computeBoundingBox(),iq.set(i.boundingBox.min,i.boundingBox.max,r),s=iq),vo(c,a)){const h=e.geometry,u=h.index,d=h.attributes.position,f=i.index,m=i.attributes.position,g=Fo(n,l),v=ga(c,a);if(e_.copy(r).invert(),i.boundsTree)return Ji(n,o,lT),lT.matrix.copy(e_),lT.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:y=>lT.intersectsBox(y),intersectsTriangle:y=>{y.a.applyMatrix4(r),y.b.applyMatrix4(r),y.c.applyMatrix4(r),y.needsUpdate=!0;for(let A=g*3,b=(v+g)*3;A<b;A+=3)if(lr(Pv,A,u,d),Pv.needsUpdate=!0,y.intersectsTriangle(Pv))return!0;return!1}});for(let y=g*3,A=(v+g)*3;y<A;y+=3){lr(Rv,y,u,d),Rv.a.applyMatrix4(e_),Rv.b.applyMatrix4(e_),Rv.c.applyMatrix4(e_),Rv.needsUpdate=!0;for(let b=0,x=f.count;b<x;b+=3)if(lr(Pv,b,f,m),Pv.needsUpdate=!0,Rv.intersectsTriangle(Pv))return!0}}else{const h=n+8,u=l[n+6];return Ji(h,o,aT),!!(s.intersectsBox(aT)&&hU(h,e,i,r,s)||(Ji(u,o,aT),s.intersectsBox(aT)&&hU(u,e,i,r,s)))}}const cT=new he,uU=new Qs,t_=new Qs,nCe=new S,rCe=new S,sCe=new S,oCe=new S;function aCe(n,e,i,r={},s={},o=0,a=1/0){e.boundingBox||e.computeBoundingBox(),uU.set(e.boundingBox.min,e.boundingBox.max,i),uU.needsUpdate=!0;const l=n.geometry,c=l.attributes.position,h=l.index,u=e.attributes.position,d=e.index,f=$a.getPrimitive(),m=$a.getPrimitive();let g=nCe,v=rCe,y=null,A=null;s&&(y=sCe,A=oCe);let b=1/0,x=null,_=null;return cT.copy(i).invert(),t_.matrix.copy(cT),n.shapecast({boundsTraverseOrder:w=>uU.distanceToBox(w),intersectsBounds:(w,T,M)=>M<b&&M<a?(T&&(t_.min.copy(w.min),t_.max.copy(w.max),t_.needsUpdate=!0),!0):!1,intersectsRange:(w,T)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:M=>t_.distanceToBox(M),intersectsBounds:(M,R,B)=>B<b&&B<a,intersectsRange:(M,R)=>{for(let B=M,E=M+R;B<E;B++){lr(m,3*B,d,u),m.a.applyMatrix4(i),m.b.applyMatrix4(i),m.c.applyMatrix4(i),m.needsUpdate=!0;for(let P=w,O=w+T;P<O;P++){lr(f,3*P,h,c),f.needsUpdate=!0;const N=f.distanceToTriangle(m,g,y);if(N<b&&(v.copy(g),A&&A.copy(y),b=N,x=P,_=B),N<o)return!0}}}});{const M=Sv(e);for(let R=0,B=M;R<B;R++){lr(m,3*R,d,u),m.a.applyMatrix4(i),m.b.applyMatrix4(i),m.c.applyMatrix4(i),m.needsUpdate=!0;for(let E=w,P=w+T;E<P;E++){lr(f,3*E,h,c),f.needsUpdate=!0;const O=f.distanceToTriangle(m,g,y);if(O<b&&(v.copy(g),A&&A.copy(y),b=O,x=E,_=R),O<o)return!0}}}}}),$a.releasePrimitive(f),$a.releasePrimitive(m),b===1/0?null:(r.point?r.point.copy(v):r.point=v.clone(),r.distance=b,r.faceIndex=x,s&&(s.point?s.point.copy(A):s.point=A.clone(),s.point.applyMatrix4(cT),v.applyMatrix4(cT),s.distance=v.sub(s.point).length(),s.faceIndex=_),r)}function lCe(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=n.geometry,r=i.index?i.index.array:null,s=i.attributes.position;let o,a,l,c,h=0;const u=n._roots;for(let f=0,m=u.length;f<m;f++)o=u[f],a=new Uint32Array(o),l=new Uint16Array(o),c=new Float32Array(o),d(0,h),h+=o.byteLength;function d(f,m,g=!1){const v=f*2;if(l[v+15]===qM){const y=a[f+6],A=l[v+14];let b=1/0,x=1/0,_=1/0,w=-1/0,T=-1/0,M=-1/0;for(let R=y,B=y+A;R<B;R++){const E=3*n.resolveTriangleIndex(R);for(let P=0;P<3;P++){let O=E+P;O=r?r[O]:O;const N=s.getX(O),L=s.getY(O),Q=s.getZ(O);N<b&&(b=N),N>w&&(w=N),L<x&&(x=L),L>T&&(T=L),Q<_&&(_=Q),Q>M&&(M=Q)}}return c[f+0]!==b||c[f+1]!==x||c[f+2]!==_||c[f+3]!==w||c[f+4]!==T||c[f+5]!==M?(c[f+0]=b,c[f+1]=x,c[f+2]=_,c[f+3]=w,c[f+4]=T,c[f+5]=M,!0):!1}else{const y=f+8,A=a[f+6],b=y+m,x=A+m;let _=g,w=!1,T=!1;e?_||(w=e.has(b),T=e.has(x),_=!w&&!T):(w=!0,T=!0);const M=_||w,R=_||T;let B=!1;M&&(B=d(y,m,_));let E=!1;R&&(E=d(A,m,_));const P=B||E;if(P)for(let O=0;O<3;O++){const N=y+O,L=A+O,Q=c[N],D=c[N+3],F=c[L],H=c[L+3];c[f+O]=Q<F?Q:F,c[f+O+3]=D>H?D:H}return P}}}function cCe(n,e,i,r,s,o,a){rn.setBuffer(n._roots[e]),dU(0,n,i,r,s,o,a),rn.clearBuffer()}function dU(n,e,i,r,s,o,a){const{float32Array:l,uint16Array:c,uint32Array:h}=rn,u=n*2;if(vo(u,c)){const d=Fo(n,h),f=ga(u,c);JSe(e,i,r,d,f,s,o,a)}else{const d=Ka(n);ap(d,l,r,o,a)&&dU(d,e,i,r,s,o,a);const f=va(n,h);ap(f,l,r,o,a)&&dU(f,e,i,r,s,o,a)}}const hCe=["x","y","z"];function uCe(n,e,i,r,s,o){rn.setBuffer(n._roots[e]);const a=pU(0,n,i,r,s,o);return rn.clearBuffer(),a}function pU(n,e,i,r,s,o){const{float32Array:a,uint16Array:l,uint32Array:c}=rn;let h=n*2;if(vo(h,l)){const u=Fo(n,c),d=ga(h,l);return KSe(e,i,r,u,d,s,o)}else{const u=eU(n,c),d=hCe[u],f=r.direction[d]>=0;let m,g;f?(m=Ka(n),g=va(n,c)):(m=va(n,c),g=Ka(n));const v=ap(m,a,r,s,o)?pU(m,e,i,r,s,o):null;if(v){const A=v.point[d];if(f?A<=a[g+u]:A>=a[g+u+3])return v}const y=ap(g,a,r,s,o)?pU(g,e,i,r,s,o):null;return v&&y?v.distance<=y.distance?v:y:v||y||null}}const hT=new Ht,Bv=new Za,kv=new Za,i_=new he,nq=new Qs,uT=new Qs;function dCe(n,e,i,r){rn.setBuffer(n._roots[e]);const s=fU(0,n,i,r);return rn.clearBuffer(),s}function fU(n,e,i,r,s=null){const{float32Array:o,uint16Array:a,uint32Array:l}=rn;let c=n*2;if(s===null&&(i.boundingBox||i.computeBoundingBox(),nq.set(i.boundingBox.min,i.boundingBox.max,r),s=nq),vo(c,a)){const h=e.geometry,u=h.index,d=h.attributes.position,f=i.index,m=i.attributes.position,g=Fo(n,l),v=ga(c,a);if(i_.copy(r).invert(),i.boundsTree)return Ji(n,o,uT),uT.matrix.copy(i_),uT.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:y=>uT.intersectsBox(y),intersectsTriangle:y=>{y.a.applyMatrix4(r),y.b.applyMatrix4(r),y.c.applyMatrix4(r),y.needsUpdate=!0;for(let A=g,b=v+g;A<b;A++)if(lr(kv,3*e.resolveTriangleIndex(A),u,d),kv.needsUpdate=!0,y.intersectsTriangle(kv))return!0;return!1}});for(let y=g,A=v+g;y<A;y++){const b=e.resolveTriangleIndex(y);lr(Bv,3*b,u,d),Bv.a.applyMatrix4(i_),Bv.b.applyMatrix4(i_),Bv.c.applyMatrix4(i_),Bv.needsUpdate=!0;for(let x=0,_=f.count;x<_;x+=3)if(lr(kv,x,f,m),kv.needsUpdate=!0,Bv.intersectsTriangle(kv))return!0}}else{const h=n+8,u=l[n+6];return Ji(h,o,hT),!!(s.intersectsBox(hT)&&fU(h,e,i,r,s)||(Ji(u,o,hT),s.intersectsBox(hT)&&fU(u,e,i,r,s)))}}const dT=new he,mU=new Qs,n_=new Qs,pCe=new S,fCe=new S,mCe=new S,gCe=new S;function vCe(n,e,i,r={},s={},o=0,a=1/0){e.boundingBox||e.computeBoundingBox(),mU.set(e.boundingBox.min,e.boundingBox.max,i),mU.needsUpdate=!0;const l=n.geometry,c=l.attributes.position,h=l.index,u=e.attributes.position,d=e.index,f=$a.getPrimitive(),m=$a.getPrimitive();let g=pCe,v=fCe,y=null,A=null;s&&(y=mCe,A=gCe);let b=1/0,x=null,_=null;return dT.copy(i).invert(),n_.matrix.copy(dT),n.shapecast({boundsTraverseOrder:w=>mU.distanceToBox(w),intersectsBounds:(w,T,M)=>M<b&&M<a?(T&&(n_.min.copy(w.min),n_.max.copy(w.max),n_.needsUpdate=!0),!0):!1,intersectsRange:(w,T)=>{if(e.boundsTree){const M=e.boundsTree;return M.shapecast({boundsTraverseOrder:R=>n_.distanceToBox(R),intersectsBounds:(R,B,E)=>E<b&&E<a,intersectsRange:(R,B)=>{for(let E=R,P=R+B;E<P;E++){const O=M.resolveTriangleIndex(E);lr(m,3*O,d,u),m.a.applyMatrix4(i),m.b.applyMatrix4(i),m.c.applyMatrix4(i),m.needsUpdate=!0;for(let N=w,L=w+T;N<L;N++){const Q=n.resolveTriangleIndex(N);lr(f,3*Q,h,c),f.needsUpdate=!0;const D=f.distanceToTriangle(m,g,y);if(D<b&&(v.copy(g),A&&A.copy(y),b=D,x=N,_=E),D<o)return!0}}}})}else{const M=Sv(e);for(let R=0,B=M;R<B;R++){lr(m,3*R,d,u),m.a.applyMatrix4(i),m.b.applyMatrix4(i),m.c.applyMatrix4(i),m.needsUpdate=!0;for(let E=w,P=w+T;E<P;E++){const O=n.resolveTriangleIndex(E);lr(f,3*O,h,c),f.needsUpdate=!0;const N=f.distanceToTriangle(m,g,y);if(N<b&&(v.copy(g),A&&A.copy(y),b=N,x=E,_=R),N<o)return!0}}}}}),$a.releasePrimitive(f),$a.releasePrimitive(m),b===1/0?null:(r.point?r.point.copy(v):r.point=v.clone(),r.distance=b,r.faceIndex=x,s&&(s.point?s.point.copy(A):s.point=A.clone(),s.point.applyMatrix4(dT),v.applyMatrix4(dT),s.distance=v.sub(s.point).length(),s.faceIndex=_),r)}function rq(){return typeof SharedArrayBuffer<"u"}const r_=new rn.constructor,pT=new rn.constructor,lp=new sU(()=>new Ht),Ov=new Ht,Dv=new Ht,gU=new Ht,vU=new Ht;let yU=!1;function yCe(n,e,i,r){if(yU)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");yU=!0;const s=n._roots,o=e._roots;let a,l=0,c=0;const h=new he().copy(i).invert();for(let u=0,d=s.length;u<d;u++){r_.setBuffer(s[u]),c=0;const f=lp.getPrimitive();Ji(0,r_.float32Array,f),f.applyMatrix4(h);for(let m=0,g=o.length;m<g&&(pT.setBuffer(o[u]),a=jl(0,0,i,h,r,l,c,0,0,f),pT.clearBuffer(),c+=o[m].length,!a);m++);if(lp.releasePrimitive(f),r_.clearBuffer(),l+=s[u].length,a)break}return yU=!1,a}function jl(n,e,i,r,s,o=0,a=0,l=0,c=0,h=null,u=!1){let d,f;u?(d=pT,f=r_):(d=r_,f=pT);const m=d.float32Array,g=d.uint32Array,v=d.uint16Array,y=f.float32Array,A=f.uint32Array,b=f.uint16Array,x=n*2,_=e*2,w=vo(x,v),T=vo(_,b);let M=!1;if(T&&w)u?M=s(Fo(e,A),ga(e*2,b),Fo(n,g),ga(n*2,v),c,a+e,l,o+n):M=s(Fo(n,g),ga(n*2,v),Fo(e,A),ga(e*2,b),l,o+n,c,a+e);else if(T){const R=lp.getPrimitive();Ji(e,y,R),R.applyMatrix4(i);const B=Ka(n),E=va(n,g);Ji(B,m,Ov),Ji(E,m,Dv);const P=R.intersectsBox(Ov),O=R.intersectsBox(Dv);M=P&&jl(e,B,r,i,s,a,o,c,l+1,R,!u)||O&&jl(e,E,r,i,s,a,o,c,l+1,R,!u),lp.releasePrimitive(R)}else{const R=Ka(e),B=va(e,A);Ji(R,y,gU),Ji(B,y,vU);const E=h.intersectsBox(gU),P=h.intersectsBox(vU);if(E&&P)M=jl(n,R,i,r,s,o,a,l,c+1,h,u)||jl(n,B,i,r,s,o,a,l,c+1,h,u);else if(E)if(w)M=jl(n,R,i,r,s,o,a,l,c+1,h,u);else{const O=lp.getPrimitive();O.copy(gU).applyMatrix4(i);const N=Ka(n),L=va(n,g);Ji(N,m,Ov),Ji(L,m,Dv);const Q=O.intersectsBox(Ov),D=O.intersectsBox(Dv);M=Q&&jl(R,N,r,i,s,a,o,c,l+1,O,!u)||D&&jl(R,L,r,i,s,a,o,c,l+1,O,!u),lp.releasePrimitive(O)}else if(P)if(w)M=jl(n,B,i,r,s,o,a,l,c+1,h,u);else{const O=lp.getPrimitive();O.copy(vU).applyMatrix4(i);const N=Ka(n),L=va(n,g);Ji(N,m,Ov),Ji(L,m,Dv);const Q=O.intersectsBox(Ov),D=O.intersectsBox(Dv);M=Q&&jl(B,N,r,i,s,a,o,c,l+1,O,!u)||D&&jl(B,L,r,i,s,a,o,c,l+1,O,!u),lp.releasePrimitive(O)}}return M}const fT=new Qs,sq=new Ht,ACe={strategy:q3,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class Hv{static serialize(e,i={}){i={cloneBuffers:!0,...i};const r=e.geometry,s=e._roots,o=e._indirectBuffer,a=r.getIndex();let l;return i.cloneBuffers?l={roots:s.map(c=>c.slice()),index:a?a.array.slice():null,indirectBuffer:o?o.slice():null}:l={roots:s,index:a?a.array:null,indirectBuffer:o},l}static deserialize(e,i,r={}){r={setIndex:!0,indirect:!!e.indirectBuffer,...r};const{index:s,roots:o,indirectBuffer:a}=e,l=new Hv(i,{...r,[K3]:!0});if(l._roots=o,l._indirectBuffer=a||null,r.setIndex){const c=i.getIndex();if(c===null){const h=new Ye(e.index,1,!1);i.setIndex(h)}else c.array!==s&&(c.array.set(s),c.needsUpdate=!0)}return l}get indirect(){return!!this._indirectBuffer}constructor(e,i={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(i=Object.assign({...ACe,[K3]:!1},i),i.useSharedArrayBuffer&&!rq())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,i[K3]||(DSe(this,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Ht))),this.resolveTriangleIndex=i.indirect?r=>this._indirectBuffer[r]:r=>r}refit(e=null){return(this.indirect?lCe:YSe)(this,e)}traverse(e,i=0){const r=this._roots[i],s=new Uint32Array(r),o=new Uint16Array(r);a(0);function a(l,c=0){const h=l*2,u=o[h+15]===qM;if(u){const d=s[l+6],f=o[h+14];e(c,u,new Float32Array(r,l*4,6),d,f)}else{const d=l+rp/4,f=s[l+6],m=s[l+7];e(c,u,new Float32Array(r,l*4,6),m)||(a(d,c+1),a(f,c+1))}}}raycast(e,i=Fn,r=0,s=1/0){const o=this._roots,a=this.geometry,l=[],c=i.isMaterial,h=Array.isArray(i),u=a.groups,d=c?i.side:i,f=this.indirect?cCe:$Se;for(let m=0,g=o.length;m<g;m++){const v=h?i[u[m].materialIndex].side:d,y=l.length;if(f(this,m,v,e,l,r,s),h){const A=u[m].materialIndex;for(let b=y,x=l.length;b<x;b++)l[b].face.materialIndex=A}}return l}raycastFirst(e,i=Fn,r=0,s=1/0){const o=this._roots,a=this.geometry,l=i.isMaterial,c=Array.isArray(i);let h=null;const u=a.groups,d=l?i.side:i,f=this.indirect?uCe:tCe;for(let m=0,g=o.length;m<g;m++){const v=c?i[u[m].materialIndex].side:d,y=f(this,m,v,e,r,s);y!=null&&(h==null||y.distance<h.distance)&&(h=y,c&&(y.face.materialIndex=u[m].materialIndex))}return h}intersectsGeometry(e,i){let r=!1;const s=this._roots,o=this.indirect?dCe:iCe;for(let a=0,l=s.length;a<l&&(r=o(this,a,e,i),!r);a++);return r}shapecast(e){const i=$a.getPrimitive(),r=this.indirect?ZSe:qSe;let{boundsTraverseOrder:s,intersectsBounds:o,intersectsRange:a,intersectsTriangle:l}=e;if(a&&l){const d=a;a=(f,m,g,v,y)=>d(f,m,g,v,y)?!0:r(f,m,this,l,g,v,i)}else a||(l?a=(d,f,m,g)=>r(d,f,this,l,m,g,i):a=(d,f,m)=>m);let c=!1,h=0;const u=this._roots;for(let d=0,f=u.length;d<f;d++){const m=u[d];if(c=jSe(this,d,o,a,s,h),c)break;h+=m.byteLength}return $a.releasePrimitive(i),c}bvhcast(e,i,r){let{intersectsRanges:s,intersectsTriangles:o}=r;const a=$a.getPrimitive(),l=this.geometry.index,c=this.geometry.attributes.position,h=this.indirect?g=>{const v=this.resolveTriangleIndex(g);lr(a,v*3,l,c)}:g=>{lr(a,g*3,l,c)},u=$a.getPrimitive(),d=e.geometry.index,f=e.geometry.attributes.position,m=e.indirect?g=>{const v=e.resolveTriangleIndex(g);lr(u,v*3,d,f)}:g=>{lr(u,g*3,d,f)};if(o){const g=(v,y,A,b,x,_,w,T)=>{for(let M=A,R=A+b;M<R;M++){m(M),u.a.applyMatrix4(i),u.b.applyMatrix4(i),u.c.applyMatrix4(i),u.needsUpdate=!0;for(let B=v,E=v+y;B<E;B++)if(h(B),a.needsUpdate=!0,o(a,u,B,M,x,_,w,T))return!0}return!1};if(s){const v=s;s=function(y,A,b,x,_,w,T,M){return v(y,A,b,x,_,w,T,M)?!0:g(y,A,b,x,_,w,T,M)}}else s=g}return yCe(this,e,i,s)}intersectsBox(e,i){return fT.set(e.min,e.max,i),fT.needsUpdate=!0,this.shapecast({intersectsBounds:r=>fT.intersectsBox(r),intersectsTriangle:r=>fT.intersectsTriangle(r)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,r={},s={},o=0,a=1/0){return(this.indirect?vCe:aCe)(this,e,i,r,s,o,a)}closestPointToPoint(e,i={},r=0,s=1/0){return GSe(this,e,i,r,s)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{Ji(0,new Float32Array(i),sq),e.union(sq)}),e}}const oq=new Ht;class bCe extends ve{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}constructor(e,i,r=10,s=0){super(),this.material=i,this.geometry=new dt,this.name="MeshBVHRootHelper",this.depth=r,this.displayParents=!1,this.bvh=e,this.displayEdges=!0,this._group=s}raycast(){}update(){const e=this.geometry,i=this.bvh,r=this._group;if(e.dispose(),this.visible=!1,i){const s=this.depth-1,o=this.displayParents;let a=0;i.traverse((f,m)=>{if(f>=s||m)return a++,!0;o&&a++},r);let l=0;const c=new Float32Array(8*3*a);i.traverse((f,m,g)=>{const v=f>=s||m;if(v||o){Ji(0,g,oq);const{min:y,max:A}=oq;for(let b=-1;b<=1;b+=2){const x=b<0?y.x:A.x;for(let _=-1;_<=1;_+=2){const w=_<0?y.y:A.y;for(let T=-1;T<=1;T+=2){const M=T<0?y.z:A.z;c[l+0]=x,c[l+1]=w,c[l+2]=M,l+=3}}}return v}},r);let h,u;this.displayEdges?u=new Uint8Array([0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]):u=new Uint8Array([0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),c.length>65535?h=new Uint32Array(u.length*a):h=new Uint16Array(u.length*a);const d=u.length;for(let f=0;f<a;f++){const m=f*8,g=f*d;for(let v=0;v<d;v++)h[g+v]=m+u[v]}e.setIndex(new Ye(h,1,!1)),e.setAttribute("position",new Ye(c,3,!1)),this.visible=!0}}}class RU extends Cr{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(e){this.edgeMaterial.opacity=e,this.meshMaterial.opacity=e}constructor(e=null,i=null,r=10){e instanceof Hv&&(r=i||10,i=e,e=null),typeof i=="number"&&(r=i,i=null),super(),this.name="MeshBVHHelper",this.depth=r,this.mesh=e,this.bvh=i,this.displayParents=!1,this.displayEdges=!0,this._roots=[];const s=new zi({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),o=new Jt({color:65416,transparent:!0,opacity:.3,depthWrite:!1});o.color=s.color,this.edgeMaterial=s,this.meshMaterial=o,this.update()}update(){const e=this.bvh||this.mesh.geometry.boundsTree,i=e?e._roots.length:0;for(;this._roots.length>i;){const r=this._roots.pop();r.geometry.dispose(),this.remove(r)}for(let r=0;r<i;r++){const{depth:s,edgeMaterial:o,meshMaterial:a,displayParents:l,displayEdges:c}=this;if(r>=this._roots.length){const u=new bCe(e,o,s,r);this.add(u),this._roots.push(u)}const h=this._roots[r];h.bvh=e,h.depth=s,h.displayParents=l,h.displayEdges=c,h.material=c?o:a,h.update()}}updateMatrixWorld(...e){const i=this.mesh,r=this.parent;i!==null&&(i.updateWorldMatrix(!0,!1),r?this.matrix.copy(r.matrixWorld).invert().multiply(i.matrixWorld):this.matrix.copy(i.matrixWorld),this.matrix.decompose(this.position,this.quaternion,this.scale)),super.updateMatrixWorld(...e)}copy(e){this.depth=e.depth,this.mesh=e.mesh,this.bvh=e.bvh,this.opacity=e.opacity,this.color.copy(e.color)}clone(){return new RU(this.mesh,this.bvh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();const e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].geometry.dispose()}}const s_=new Ht,aq=new Ht,Lv=new S;function lq(n){switch(typeof n){case"number":return 8;case"string":return n.length*2;case"boolean":return 4;default:return 0}}function xCe(n){return/(Uint|Int|Float)(8|16|32)Array/.test(n.constructor.name)}function _Ce(n,e){const i={nodeCount:0,leafNodeCount:0,depth:{min:1/0,max:-1/0},tris:{min:1/0,max:-1/0},splits:[0,0,0],surfaceAreaScore:0};return n.traverse((r,s,o,a,l)=>{const c=o[3]-o[0],h=o[1+3]-o[1],u=o[2+3]-o[2],d=2*(c*h+h*u+u*c);i.nodeCount++,s?(i.leafNodeCount++,i.depth.min=Math.min(r,i.depth.min),i.depth.max=Math.max(r,i.depth.max),i.tris.min=Math.min(l,i.tris.min),i.tris.max=Math.max(l,i.tris.max),i.surfaceAreaScore+=d*XM*l):(i.splits[a]++,i.surfaceAreaScore+=d*J3)},e),i.tris.min===1/0&&(i.tris.min=0,i.tris.max=0),i.depth.min===1/0&&(i.depth.min=0,i.depth.max=0),i}function wCe(n){return n._roots.map((e,i)=>_Ce(n,i))}function SCe(n){const e=new Set,i=[n];let r=0;for(;i.length;){const s=i.pop();if(!e.has(s)){e.add(s);for(let o in s){if(!Object.hasOwn(s,o))continue;r+=lq(o);const a=s[o];a&&(typeof a=="object"||typeof a=="function")?xCe(a)||rq()&&a instanceof SharedArrayBuffer||a instanceof ArrayBuffer?r+=a.byteLength:i.push(a):r+=lq(a)}}}return r}function CCe(n){const e=n.geometry,i=[],r=e.index,s=e.getAttribute("position");let o=!0;return n.traverse((a,l,c,h,u)=>{const d={depth:a,isLeaf:l,boundingData:c,offset:h,count:u};i[a]=d,Ji(0,c,s_);const f=i[a-1];if(l)for(let m=h,g=h+u;m<g;m++){const v=n.resolveTriangleIndex(m);let y=3*v,A=3*v+1,b=3*v+2;r&&(y=r.getX(y),A=r.getX(A),b=r.getX(b));let x;Lv.fromBufferAttribute(s,y),x=s_.containsPoint(Lv),Lv.fromBufferAttribute(s,A),x=x&&s_.containsPoint(Lv),Lv.fromBufferAttribute(s,b),x=x&&s_.containsPoint(Lv),console.assert(x,"Leaf bounds does not fully contain triangle."),o=o&&x}if(f){Ji(0,c,aq);const m=aq.containsBox(s_);console.assert(m,"Parent bounds does not fully contain child."),o=o&&m}}),o}function ECe(n){const e=[];return n.traverse((i,r,s,o,a)=>{const l={bounds:Ji(0,s,new Ht)};r?(l.count=a,l.offset=o):(l.left=null,l.right=null),e[i]=l;const c=e[i-1];c&&(c.left===null?c.left=l:c.right=l)}),e[0]}function cq(n,e,i){return n===null?null:(n.point.applyMatrix4(e.matrixWorld),n.distance=n.point.distanceTo(i.ray.origin),n.object=e,n)}const mT=new Js,hq=new S,uq=new he,MCe=pe.prototype.raycast,dq=new S;function TCe(n,e){if(this.geometry.boundsTree){if(this.material===void 0)return;uq.copy(this.matrixWorld).invert(),mT.copy(n.ray).applyMatrix4(uq),PCe(this.matrixWorld,dq),hq.copy(mT.direction).multiply(dq);const i=hq.length(),r=n.near/i,s=n.far/i,o=this.geometry.boundsTree;if(n.firstHitOnly===!0){const a=cq(o.raycastFirst(mT,this.material,r,s),this,n);a&&e.push(a)}else{const a=o.raycast(mT,this.material,r,s);for(let l=0,c=a.length;l<c;l++){const h=cq(a[l],this,n);h&&e.push(h)}}}else MCe.call(this,n,e)}function ICe(n){return this.boundsTree=new Hv(this,n),this.boundsTree}function RCe(){this.boundsTree=null}function PCe(n,e){const i=n.elements,r=e.set(i[0],i[1],i[2]).length(),s=e.set(i[4],i[5],i[6]).length(),o=e.set(i[8],i[9],i[10]).length();return e.set(r,s,o)}function BCe(n){switch(n){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function kCe(n){switch(n){case 1:return xp;case 2:return I_;case 3:return Ti;case 4:return Ti}}function pq(n){switch(n){case 1:return T_;case 2:return $v;case 3:return km;case 4:return km}}class gT extends Ms{constructor(){super(),this.minFilter=Rt,this.magFilter=Rt,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const i=this.overrideItemSize,r=e.itemSize,s=e.count;if(i!==null){if(r*s%i!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=i,e.count=s*r/i}const o=e.itemSize,a=e.count,l=e.normalized,c=e.array.constructor,h=c.BYTES_PER_ELEMENT;let u=this._forcedType,d=o;if(u===null)switch(c){case Float32Array:u=Hi;break;case Uint8Array:case Uint16Array:case Uint32Array:u=_s;break;case Int8Array:case Int16Array:case Int32Array:u=bp;break}let f,m,g,v,y=BCe(o);switch(u){case Hi:g=1,m=kCe(o),l&&h===1?(v=c,y+="8",c===Uint8Array?f=cn:(f=E_,y+="_SNORM")):(v=Float32Array,y+="32F",f=Hi);break;case bp:y+=h*8+"I",g=l?Math.pow(2,c.BYTES_PER_ELEMENT*8-1):1,m=pq(o),h===1?(v=Int8Array,f=E_):h===2?(v=Int16Array,f=KT):(v=Int32Array,f=bp);break;case _s:y+=h*8+"UI",g=l?Math.pow(2,c.BYTES_PER_ELEMENT*8-1):1,m=pq(o),h===1?(v=Uint8Array,f=cn):h===2?(v=Uint16Array,f=Zv):(v=Uint32Array,f=_s);break}d===3&&(m===Ti||m===km)&&(d=4);const A=Math.ceil(Math.sqrt(a))||1,b=d*A*A,x=new v(b),_=e.normalized;e.normalized=!1;for(let w=0;w<a;w++){const T=d*w;x[T]=e.getX(w)/g,o>=2&&(x[T+1]=e.getY(w)/g),o>=3&&(x[T+2]=e.getZ(w)/g,d===4&&(x[T+3]=1)),o>=4&&(x[T+3]=e.getW(w)/g)}e.normalized=_,this.internalFormat=y,this.format=m,this.type=f,this.image.width=A,this.image.height=A,this.image.data=x,this.needsUpdate=!0,this.dispose(),e.itemSize=r,e.count=s}}class fq extends gT{constructor(){super(),this._forcedType=_s}}class OCe extends gT{constructor(){super(),this._forcedType=bp}}class mq extends gT{constructor(){super(),this._forcedType=Hi}}class DCe{constructor(){this.index=new fq,this.position=new mq,this.bvhBounds=new Ms,this.bvhContents=new Ms,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:i}=e;if(UCe(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(i.attributes.position),e.indirect){const r=e._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==r.length)if(i.index)this._cachedIndexAttr=i.index.clone();else{const s=GX(jX(i));this._cachedIndexAttr=new Ye(s,1,!1)}LCe(i,r,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(i.index)}dispose(){const{index:e,position:i,bvhBounds:r,bvhContents:s}=this;e&&e.dispose(),i&&i.dispose(),r&&r.dispose(),s&&s.dispose()}}function LCe(n,e,i){const r=i.array,s=n.index?n.index.array:null;for(let o=0,a=e.length;o<a;o++){const l=3*o,c=3*e[o];for(let h=0;h<3;h++)r[l+h]=s?s[c+h]:c+h}}function UCe(n,e,i){const r=n._roots;if(r.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const s=r[0],o=new Uint16Array(s),a=new Uint32Array(s),l=new Float32Array(s),c=s.byteLength/rp,h=2*Math.ceil(Math.sqrt(c/2)),u=new Float32Array(4*h*h),d=Math.ceil(Math.sqrt(c)),f=new Uint32Array(2*d*d);for(let m=0;m<c;m++){const g=m*rp/4,v=g*2,y=g;for(let A=0;A<3;A++)u[8*m+0+A]=l[y+0+A],u[8*m+4+A]=l[y+3+A];if(vo(v,o)){const A=ga(v,o),b=Fo(g,a),x=4294901760|A;f[m*2+0]=x,f[m*2+1]=b}else{const A=4*va(g,a)/rp,b=eU(g,a);f[m*2+0]=b,f[m*2+1]=A}}e.image.data=u,e.image.width=h,e.image.height=h,e.format=Ti,e.type=Hi,e.internalFormat="RGBA32F",e.minFilter=Rt,e.magFilter=Rt,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),i.image.data=f,i.image.width=d,i.image.height=d,i.format=$v,i.type=_s,i.internalFormat="RG32UI",i.minFilter=Rt,i.magFilter=Rt,i.generateMipmaps=!1,i.needsUpdate=!0,i.dispose()}const _m=new S,wm=new S,Sm=new S,gq=new qe,vT=new S,AU=new S,vq=new qe,yq=new qe,yT=new he,Aq=new he;function o_(n,e){if(!n&&!e)return;const i=n.count===e.count,r=n.normalized===e.normalized,s=n.array.constructor===e.array.constructor,o=n.itemSize===e.itemSize;if(!i||!r||!s||!o)throw new Error}function a_(n,e=null){const i=n.array.constructor,r=n.normalized,s=n.itemSize,o=e===null?n.count:e;return new Ye(new i(s*o),s,r)}function bq(n,e,i=0){if(n.isInterleavedBufferAttribute){const r=n.itemSize;for(let s=0,o=n.count;s<o;s++){const a=s+i;e.setX(a,n.getX(s)),r>=2&&e.setY(a,n.getY(s)),r>=3&&e.setZ(a,n.getZ(s)),r>=4&&e.setW(a,n.getW(s))}}else{const r=e.array,s=r.constructor,o=r.BYTES_PER_ELEMENT*n.itemSize*i;new s(r.buffer,o,n.array.length).set(n.array)}}function FCe(n,e,i){const r=n.elements,s=e.elements;for(let o=0,a=s.length;o<a;o++)r[o]+=s[o]*i}function xq(n,e,i){const r=n.skeleton,s=n.geometry,o=r.bones,a=r.boneInverses;vq.fromBufferAttribute(s.attributes.skinIndex,e),yq.fromBufferAttribute(s.attributes.skinWeight,e),yT.elements.fill(0);for(let l=0;l<4;l++){const c=yq.getComponent(l);if(c!==0){const h=vq.getComponent(l);Aq.multiplyMatrices(o[h].matrixWorld,a[h]),FCe(yT,Aq,c)}}return yT.multiply(n.bindMatrix).premultiply(n.bindMatrixInverse),i.transformDirection(yT),i}function bU(n,e,i,r,s){vT.set(0,0,0);for(let o=0,a=n.length;o<a;o++){const l=e[o],c=n[o];l!==0&&(AU.fromBufferAttribute(c,r),i?vT.addScaledVector(AU,l):vT.addScaledVector(AU.sub(s),l))}s.add(vT)}function NCe(n,e={useGroups:!1,updateIndex:!1,skipAttributes:[]},i=new dt){const r=n[0].index!==null,{useGroups:s=!1,updateIndex:o=!1,skipAttributes:a=[]}=e,l=new Set(Object.keys(n[0].attributes)),c={};let h=0;i.clearGroups();for(let u=0;u<n.length;++u){const d=n[u];let f=0;if(r!==(d.index!==null))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const m in d.attributes){if(!l.has(m))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+m+'" attribute exists among all geometries, or in none of them.');c[m]===void 0&&(c[m]=[]),c[m].push(d.attributes[m]),f++}if(f!==l.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(s){let m;if(r)m=d.index.count;else if(d.attributes.position!==void 0)m=d.attributes.position.count;else throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");i.addGroup(h,m,u),h+=m}}if(r){let u=!1;if(!i.index){let d=0;for(let f=0;f<n.length;++f)d+=n[f].index.count;i.setIndex(new Ye(new Uint32Array(d),1,!1)),u=!0}if(o||u){const d=i.index;let f=0,m=0;for(let g=0;g<n.length;++g){const v=n[g],y=v.index;if(a[g]!==!0)for(let A=0;A<y.count;++A)d.setX(f,y.getX(A)+m),f++;m+=v.attributes.position.count}}}for(const u in c){const d=c[u];if(!(u in i.attributes)){let g=0;for(const v in d)g+=d[v].count;i.setAttribute(u,a_(c[u][0],g))}const f=i.attributes[u];let m=0;for(let g=0,v=d.length;g<v;g++){const y=d[g];a[g]!==!0&&bq(y,f,m),m+=y.count}}return i}function zCe(n,e){if(n===null||e===null)return n===e;if(n.length!==e.length)return!1;for(let i=0,r=n.length;i<r;i++)if(n[i]!==e[i])return!1;return!0}function jCe(n){const{index:e,attributes:i}=n;if(e)for(let r=0,s=e.count;r<s;r+=3){const o=e.getX(r),a=e.getX(r+2);e.setX(r,a),e.setX(r+2,o)}else for(const r in i){const s=i[r],o=s.itemSize;for(let a=0,l=s.count;a<l;a+=3)for(let c=0;c<o;c++){const h=s.getComponent(a,c),u=s.getComponent(a+2,c);s.setComponent(a,c,u),s.setComponent(a+2,c,h)}}return n}class GCe{constructor(e){this.matrixWorld=new he,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=e,this.update()}update(){const e=this.mesh,i=e.geometry,r=e.skeleton,s=(i.index?i.index.count:i.attributes.position.count)/3;if(this.matrixWorld.copy(e.matrixWorld),this.geometryHash=i.attributes.position.version,this.primitiveCount=s,r){r.boneTexture||r.computeBoneTexture(),r.update();const o=r.boneMatrices;!this.boneMatrices||this.boneMatrices.length!==o.length?this.boneMatrices=o.slice():this.boneMatrices.set(o)}else this.boneMatrices=null}didChange(){const e=this.mesh,i=e.geometry,r=(i.index?i.index.count:i.attributes.position.count)/3;return!(this.matrixWorld.equals(e.matrixWorld)&&this.geometryHash===i.attributes.position.version&&zCe(e.skeleton&&e.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===r)}}class HCe{constructor(e){Array.isArray(e)||(e=[e]);const i=[];e.forEach(r=>{r.traverseVisible(s=>{s.isMesh&&i.push(s)})}),this.meshes=i,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=new Array(i.length).fill().map(()=>new dt),this._diffMap=new WeakMap}getMaterials(){const e=[];return this.meshes.forEach(i=>{Array.isArray(i.material)?e.push(...i.material):e.push(i.material)}),e}generate(e=new dt){let i=[];const{meshes:r,useGroups:s,_intermediateGeometry:o,_diffMap:a}=this;for(let l=0,c=r.length;l<c;l++){const h=r[l],u=o[l],d=a.get(h);!d||d.didChange(h)?(this._convertToStaticGeometry(h,u),i.push(!1),d?d.update():a.set(h,new GCe(h))):i.push(!0)}if(o.length===0){e.setIndex(null);const l=e.attributes;for(const c in l)e.deleteAttribute(c);for(const c in this.attributes)e.setAttribute(this.attributes[c],new Ye(new Float32Array(0),4,!1))}else NCe(o,{useGroups:s,skipAttributes:i},e);for(const l in e.attributes)e.attributes[l].needsUpdate=!0;return e}_convertToStaticGeometry(e,i=new dt){const r=e.geometry,s=this.applyWorldTransforms,o=this.attributes.includes("normal"),a=this.attributes.includes("tangent"),l=r.attributes,c=i.attributes;!i.index&&r.index&&(i.index=r.index.clone()),c.position||i.setAttribute("position",a_(l.position)),o&&!c.normal&&l.normal&&i.setAttribute("normal",a_(l.normal)),a&&!c.tangent&&l.tangent&&i.setAttribute("tangent",a_(l.tangent)),o_(r.index,i.index),o_(l.position,c.position),o&&o_(l.normal,c.normal),a&&o_(l.tangent,c.tangent);const h=l.position,u=o?l.normal:null,d=a?l.tangent:null,f=r.morphAttributes.position,m=r.morphAttributes.normal,g=r.morphAttributes.tangent,v=r.morphTargetsRelative,y=e.morphTargetInfluences,A=new Lt;A.getNormalMatrix(e.matrixWorld),r.index&&i.index.array.set(r.index.array);for(let b=0,x=l.position.count;b<x;b++)_m.fromBufferAttribute(h,b),u&&wm.fromBufferAttribute(u,b),d&&(gq.fromBufferAttribute(d,b),Sm.fromBufferAttribute(d,b)),y&&(f&&bU(f,y,v,b,_m),m&&bU(m,y,v,b,wm),g&&bU(g,y,v,b,Sm)),e.isSkinnedMesh&&(e.applyBoneTransform(b,_m),u&&xq(e,b,wm),d&&xq(e,b,Sm)),s&&_m.applyMatrix4(e.matrixWorld),c.position.setXYZ(b,_m.x,_m.y,_m.z),u&&(s&&wm.applyNormalMatrix(A),c.normal.setXYZ(b,wm.x,wm.y,wm.z)),d&&(s&&Sm.transformDirection(e.matrixWorld),c.tangent.setXYZW(b,Sm.x,Sm.y,Sm.z,gq.w));for(const b in this.attributes){const x=this.attributes[b];x==="position"||x==="tangent"||x==="normal"||!(x in l)||(c[x]||i.setAttribute(x,a_(l[x])),o_(l[x],c[x]),bq(l[x],c[x]))}return e.matrixWorld.determinant()<0&&jCe(i),i}}const _q=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,wq=`

float dot2( vec3 v ) {

	return dot( v, v );

}

// https://www.shadertoy.com/view/ttfGWl
vec3 closestPointToTriangle( vec3 p, vec3 v0, vec3 v1, vec3 v2, out vec3 barycoord ) {

    vec3 v10 = v1 - v0;
    vec3 v21 = v2 - v1;
    vec3 v02 = v0 - v2;

	vec3 p0 = p - v0;
	vec3 p1 = p - v1;
	vec3 p2 = p - v2;

    vec3 nor = cross( v10, v02 );

    // method 2, in barycentric space
    vec3  q = cross( nor, p0 );
    float d = 1.0 / dot2( nor );
    float u = d * dot( q, v02 );
    float v = d * dot( q, v10 );
    float w = 1.0 - u - v;

	if( u < 0.0 ) {

		w = clamp( dot( p2, v02 ) / dot2( v02 ), 0.0, 1.0 );
		u = 0.0;
		v = 1.0 - w;

	} else if( v < 0.0 ) {

		u = clamp( dot( p0, v10 ) / dot2( v10 ), 0.0, 1.0 );
		v = 0.0;
		w = 1.0 - u;

	} else if( w < 0.0 ) {

		v = clamp( dot( p1, v21 ) / dot2( v21 ), 0.0, 1.0 );
		w = 0.0;
		u = 1.0-v;

	}

	barycoord = vec3( u, v, w );
    return u * v1 + v * v2 + w * v0;

}

float distanceToTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// point and cut off range
	vec3 point, float closestDistanceSquared,

	// outputs
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord, inout float side, inout vec3 outPoint
) {

	bool found = false;
	vec3 localBarycoord;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		// get the closest point and barycoord
		vec3 closestPoint = closestPointToTriangle( point, a, b, c, localBarycoord );
		vec3 delta = point - closestPoint;
		float sqDist = dot2( delta );
		if ( sqDist < closestDistanceSquared ) {

			// set the output results
			closestDistanceSquared = sqDist;
			faceIndices = uvec4( indices.xyz, i );
			faceNormal = normalize( cross( a - b, b - c ) );
			barycoord = localBarycoord;
			outPoint = closestPoint;
			side = sign( dot( faceNormal, delta ) );

		}

	}

	return closestDistanceSquared;

}

float distanceSqToBounds( vec3 point, vec3 boundsMin, vec3 boundsMax ) {

	vec3 clampedPoint = clamp( point, boundsMin, boundsMax );
	vec3 delta = point - clampedPoint;
	return dot( delta, delta );

}

float distanceSqToBVHNodeBoundsPoint( vec3 point, sampler2D bvhBounds, uint currNodeIndex ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return distanceSqToBounds( point, boundsMin, boundsMax );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhClosestPointToPoint(		bvh,		point, faceIndices, faceNormal, barycoord, side, outPoint	)	_bvhClosestPointToPoint(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		point, faceIndices, faceNormal, barycoord, side, outPoint	)

float _bvhClosestPointToPoint(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// point to check
	vec3 point,

	// output variables
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout vec3 outPoint
 ) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float closestDistanceSquared = pow( 100000.0, 2.0 );
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, currNodeIndex );
		if ( boundsHitDistance > closestDistanceSquared ) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );
		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;
			closestDistanceSquared = distanceToTriangles(
				bvh_position, bvh_index, offset, count, point, closestDistanceSquared,

				// outputs
				faceIndices, faceNormal, barycoord, side, outPoint
			);

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;
			bool leftToRight = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, leftIndex ) < distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, rightIndex );//rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;
			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return sqrt( closestDistanceSquared );

}
`,Sq=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,Cq=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,VCe=Object.freeze(Object.defineProperty({__proto__:null,bvh_distance_functions:wq,bvh_ray_functions:Sq,bvh_struct_definitions:Cq,common_functions:_q},Symbol.toStringTag,{value:"Module"})),QCe=Cq,WCe=wq,XCe=`
	${_q}
	${Sq}
`,qCe=Object.freeze(Object.defineProperty({__proto__:null,AVERAGE:NX,BVHShaderGLSL:VCe,CENTER:q3,CONTAINED:Y3,ExtendedTriangle:Za,FloatVertexAttributeTexture:mq,INTERSECTED:xSe,IntVertexAttributeTexture:OCe,MeshBVH:Hv,MeshBVHHelper:RU,MeshBVHUniformStruct:DCe,NOT_INTERSECTED:bSe,OrientedBox:Qs,SAH:zX,StaticGeometryGenerator:HCe,UIntVertexAttributeTexture:fq,VertexAttributeTexture:gT,acceleratedRaycast:TCe,computeBoundsTree:ICe,disposeBoundsTree:RCe,estimateMemoryInBytes:SCe,getBVHExtremes:wCe,getJSONStructure:ECe,getTriangleHitPointInfo:QSe,shaderDistanceFunction:WCe,shaderIntersectFunction:XCe,shaderStructs:QCe,validateBounds:CCe},Symbol.toStringTag,{value:"Module"}));class YCe{constructor(e){this.name="WorkerBase",this.running=!1,this.worker=e,this.worker.onerror=i=>{throw i.message?new Error(`${this.name}: Could not create Web Worker with error "${i.message}"`):new Error(`${this.name}: Could not create Web Worker.`)}}runTask(){}generate(...e){if(this.running)throw new Error("GenerateMeshBVHWorker: Already running job.");if(this.worker===null)throw new Error("GenerateMeshBVHWorker: Worker has been disposed.");this.running=!0;const i=this.runTask(this.worker,...e);return i.finally(()=>{this.running=!1}),i}dispose(){this.worker.terminate(),this.worker=null}}function JCe(){return new Worker("/assets/generateMeshBVH.worker-95425733.js")}class KCe extends YCe{constructor(){super(new JCe),this.name="GenerateMeshBVHWorker"}runTask(e,i,r={}){return new Promise((s,o)=>{if(i.getAttribute("position").isInterleavedBufferAttribute||i.index&&i.index.isInterleavedBufferAttribute)throw new Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");e.onerror=h=>{o(new Error(`GenerateMeshBVHWorker: ${h.message}`))},e.onmessage=h=>{const{data:u}=h;if(u.error)o(new Error(u.error)),e.onmessage=null;else if(u.serialized){const{serialized:d,position:f}=u,m=Hv.deserialize(d,i,{setIndex:!1}),g=Object.assign({setBoundingBox:!0},r);if(i.attributes.position.array=f,d.index)if(i.index)i.index.array=d.index;else{const v=new Ye(d.index,1,!1);i.setIndex(v)}g.setBoundingBox&&(i.boundingBox=m.getBoundingBox(new Ht)),r.onProgress&&r.onProgress(u.progress),s(m),e.onmessage=null}else r.onProgress&&r.onProgress(u.progress)};const a=i.index?i.index.array:null,l=i.attributes.position.array,c=[l];a&&c.push(a),e.postMessage({index:a,position:l,options:{...r,onProgress:null,includedProgressCallback:!!r.onProgress,groups:[...i.groups]}},c.map(h=>h.buffer).filter(h=>typeof SharedArrayBuffer>"u"||!(h instanceof SharedArrayBuffer)))})}}const ZCe=Object.freeze(Object.defineProperty({__proto__:null,GenerateMeshBVHWorker:KCe},Symbol.toStringTag,{value:"Module"})),el={node:"node",material:"material",camera:"camera",light:"light"},Cm="KHR_animation_pointer",$Ce={CUBICSPLINE:void 0,LINEAR:Xl,STEP:Au},Eq=Yt.findNode;let Mq=!1;class eEe{constructor(e){this.parser=e,this.name=Cm,this.animationPointerResolver=null}setAnimationPointerResolver(e){return this.animationPointerResolver=e,this}_patchPropertyBindingFindNode(){Mq||(Mq=!0,Yt.findNode=function(e,i){if(i.startsWith(".materials.")){const r=i.substring(11).substring(i.indexOf(".")),s=r.indexOf("."),o=s<0?r:r.substring(0,s);let a=null;return e.traverse(l=>{a!==null||l.type!=="Mesh"&&l.type!=="SkinnedMesh"||l.material&&(l.material.uuid===o||l.material.name===o)&&(a=l.material,a!==null&&(r.endsWith(".map")?a=a.map:r.endsWith(".emissiveMap")&&(a=a.emissiveMap)))}),a}else if(i.startsWith(".nodes.")||i.startsWith(".lights.")||i.startsWith(".cameras.")){const r=i.split(".");let s;for(let o=1;o<r.length;o++){const a=r[o];if(a.length==36)s=e.getObjectByProperty("uuid",a);else if(s&&s[a]){const l=Number.parseInt(a);let c=a;l>=0&&(c=l),s=s[c]}else{const l=e.getObjectByName(a);l&&(s=l)}}if(!s){const o=Eq(e,r[2]);return o||console.warn(Cm+": Property binding not found",i,e,e.name,r),o}return s}return Eq(e,i)})}loadAnimationTargetFromChannel(e){const i=e.target,r=i.node!==void 0?i.node:i.id;return this.parser.getDependency("node",r)}loadAnimationTargetFromChannelWithAnimationPointer(e){this._havePatchedPropertyBindings||this._patchPropertyBindingFindNode();const i=e.target,r=i.extensions&&i.extensions[Cm]&&i.path&&i.path==="pointer";if(!r)return null;let s,o=el.node,a;if(r){const c=i.extensions[Cm];let h=c.pointer;if(!h){console.warn("Invalid path",c,i);return}if(h.startsWith("/materials/")?o=el.material:h.startsWith("/extensions/KHR_lights_punctual/lights/")?o=el.light:h.startsWith("/cameras/")&&(o=el.camera),a=this._tryResolveTargetId(h,o),a===null||isNaN(a)){console.warn("Failed resolving animation node id: "+a,h);return}switch(o){case el.material:const d=("/materials/"+a.toString()+"/").length,f=h.substring(0,d);switch(s=h.substring(d),s){case"pbrMetallicRoughness/baseColorFactor":s="color";break;case"pbrMetallicRoughness/roughnessFactor":s="roughness";break;case"pbrMetallicRoughness/metallicFactor":s="metalness";break;case"emissiveFactor":s="emissive";break;case"alphaCutoff":s="alphaTest";break;case"occlusionTexture/strength":s="aoMapIntensity";break;case"normalTexture/scale":s="normalScale";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale":s="map/repeat";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset":s="map/offset";break;case"emissiveTexture/extensions/KHR_texture_transform/scale":s="emissiveMap/repeat";break;case"emissiveTexture/extensions/KHR_texture_transform/offset":s="emissiveMap/offset";break;case"extensions/KHR_materials_emissive_strength/emissiveStrength":s="emissiveIntensity";break;case"extensions/KHR_materials_transmission/transmissionFactor":s="transmission";break;case"extensions/KHR_materials_ior/ior":s="ior";break;case"extensions/KHR_materials_volume/thicknessFactor":s="thickness";break;case"extensions/KHR_materials_volume/attenuationColor":s="attenuationColor";break;case"extensions/KHR_materials_volume/attenuationDistance":s="attenuationDistance";break;case"extensions/KHR_materials_iridescence/iridescenceFactor":s="iridescence";break;case"extensions/KHR_materials_iridescence/iridescenceIor":s="iridescenceIOR";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMinimum":s="iridescenceThicknessRange[0]";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMaximum":s="iridescenceThicknessRange[1]";break;case"extensions/KHR_materials_clearcoat/clearcoatFactor":s="clearcoat";break;case"extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor":s="clearcoatRoughness";break;case"extensions/KHR_materials_sheen/sheenColorFactor":s="sheenColor";break;case"extensions/KHR_materials_sheen/sheenRoughnessFactor":s="sheenRoughness";break;case"extensions/KHR_materials_specular/specularFactor":s="specularIntensity";break;case"extensions/KHR_materials_specular/specularColorFactor":s="specularColor";break}h=f+s;break;case el.node:const m=("/nodes/"+a.toString()+"/").length,g=h.substring(0,m);switch(s=h.substring(m),s){case"translation":s="position";break;case"rotation":s="quaternion";break;case"scale":s="scale";break;case"weights":s="morphTargetInfluences";break}h=g+s;break;case el.light:const v=("/extensions/KHR_lights_punctual/lights/"+a.toString()+"/").length;switch(s=h.substring(v),s){case"color":break;case"intensity":break;case"spot/innerConeAngle":s="penumbra";break;case"spot/outerConeAngle":s="angle";break;case"range":s="distance";break}h="/lights/"+a.toString()+"/"+s;break;case el.camera:const y=("/cameras/"+a.toString()+"/").length,A=h.substring(0,y);switch(s=h.substring(y),s){case"perspective/yfov":s="fov";break;case"perspective/znear":case"orthographic/znear":s="near";break;case"perspective/zfar":case"orthographic/zfar":s="far";break;case"perspective/aspect":s="aspect";break;case"orthographic/xmag":s="zoom";break;case"orthographic/ymag":s="zoom";break}h=A+s;break}const u=this.animationPointerResolver;u&&u.resolvePath&&(h=u.resolvePath(h)),i.extensions[Cm].pointer=h}if(a===null||isNaN(a)){console.warn("Failed resolving animation node id: "+a,i);return}let l;return o===el.node?l=this.parser.getDependency("node",a):o===el.material?l=this.parser.getDependency("material",a):o===el.light?l=this.parser.getDependency("light",a):o===el.camera?l=this.parser.getDependency("camera",a):console.error("Unhandled type",o),l}createAnimationTracksWithAnimationPointer(e,i,r,s,o){if(!(o.extensions&&o.extensions[Cm]&&o.path&&o.path==="pointer"))return null;let a=o.extensions[Cm].pointer;if(!a)return null;const l=[];a=a.replaceAll("/",".");const c=a.split(".");var h=e.name!==void 0&&e.name!==null?e.name:e.uuid;if(c[2]=h,c[3]==="morphTargetInfluences"&&e.type==="Group"){for(const d of e.children)d instanceof wo&&d.morphTargetInfluences&&(c[3]=d.name,c[4]="morphTargetInfluences",u(this.parser));return l}u(this.parser);function u(d){a=c.join(".");let f;switch(r.itemSize){case 1:f=ch;break;case 2:case 3:f=Jl;break;case 4:a.endsWith(".quaternion")?f=hl:f=jw;break}const m=s.interpolation!==void 0?$Ce[s.interpolation]:Xl;let g=d._getArrayFromAccessor(r);a.endsWith(".fov")&&(g=g.map(y=>y/Math.PI*180));const v=new f(a,i.array,g,m);if(m==="CUBICSPLINE"&&d._createCubicSplineTrackInterpolant(v),l.push(v),a&&r.itemSize===4&&a.startsWith(".materials.")&&a.endsWith(".color")){const y=new Float32Array(g.length/4);for(let b=0,x=g.length/4;b<x;b+=1)y[b]=g[b*4+3];const A=new f(a.replace(".color",".opacity"),i.array,y,m);m==="CUBICSPLINE"&&d._createCubicSplineTrackInterpolant(v),l.push(A)}}return l}_tryResolveTargetId(e,i){let r="";return i==="node"?r=e.substring(7):i==="material"?r=e.substring(11):i==="light"?r=e.substring(39):i==="camera"&&(r=e.substring(9)),r=r.substring(0,r.indexOf("/")),Number.parseInt(r)}loadAnimation(e){const i=this,r=this.parser.json,s=this.parser,o=r.animations[e],a=o.name?o.name:"animation_"+e,l=[],c=[],h=[],u=[],d=[];for(let f=0,m=o.channels.length;f<m;f++){const g=o.channels[f],v=o.samplers[g.sampler],y=g.target,A=o.parameters!==void 0?o.parameters[v.input]:v.input,b=o.parameters!==void 0?o.parameters[v.output]:v.output;let x=i.loadAnimationTargetFromChannelWithAnimationPointer(g);x||(x=i.loadAnimationTargetFromChannel(g)),l.push(x),c.push(s.getDependency("accessor",A)),h.push(s.getDependency("accessor",b)),u.push(v),d.push(y)}return Promise.all([Promise.all(l),Promise.all(c),Promise.all(h),Promise.all(u),Promise.all(d)]).then(function(f){const m=f[0],g=f[1],v=f[2],y=f[3],A=f[4],b=[];for(let x=0,_=m.length;x<_;x++){const w=m[x],T=g[x],M=v[x],R=y[x],B=A[x];if(w===void 0)continue;w.updateMatrix&&(w.updateMatrix(),w.matrixAutoUpdate=!0);let E=i.createAnimationTracksWithAnimationPointer(w,T,M,R,B);if(E||(E=s._createAnimationTracks(w,T,M,R,B)),E)for(let P=0;P<E.length;P++)b.push(E[P])}return new $s(a,void 0,b)})}}const tEe=Object.freeze(Object.defineProperty({__proto__:null,GLTFAnimationPointerExtension:eEe},Symbol.toStringTag,{value:"Module"}));export{tSe as $physicsKey,Ai as ActionBuilder,XO as ActionCollection,za as ActionModel,rV as Addressables,fb as AlignmentConstraint,f0 as AmbientMode,Fs as Animation,Df as AnimationCurve,Ib as AnimationExtension,oE as AnimationTrackHandler,u0 as AnimationUtils,rs as Animator,Id as AnimatorConditionMode,ya as AnimatorController,hD as AnimatorControllerParameterType,Tb as AnimatorStateInfo,Pb as Antialiasing,kh as Application,AC as ApplicationEvents,ZH as AssetDatabase,$t as AssetReference,hp as AudioExtension,Ed as AudioListener,Pn as AudioSource,Eb as AudioTrackHandler,Pd as Avatar,Nf as AvatarBlink_Simple,O0 as AvatarEyeLook_Rotation,wD as AvatarLoader,as as AvatarMarker,mE as AvatarModel,Lb as Avatar_Brain_LookAt,Fb as Avatar_MouthShapes,bD as Avatar_MustacheShake,Sc as Avatar_POI,M0 as Axes,D0 as AxesHelper,gP as BUILD_TIME,nl as BaseUIComponent,CD as BasicIKConstraint,gE as BehaviorExtension,kr as BehaviorModel,Be as Behaviour,zf as BloomEffect,U0 as BoxCollider,Gf as BoxGizmo,Mc as BoxHelperComponent,Qh as Button,Dh as ButtonsFactory,u9 as CallDirection,mc as CallInfo,Ui as Camera,xb as CameraTargetReachedEvent,ls as Canvas,Ld as CanvasGroup,Vh as CapsuleCollider,z0 as ChangeMaterialOnClick,Qf as ChangeTransformOnClick,qf as CharacterController,Xh as CharacterControllerInput,Xb as ChromaticAberration,Qo as CircularBuffer,Cd as ClearFlags,Ac as ClipExtrapolation,oa as Collider,CX as Collision,JC as CollisionDetectionMode,Nd as ColorAdjustments,Jf as ColorBySpeedModule,ix as ColorOverLifetimeModule,Be as Component,FA as ComponentEvents,NA as ComponentLifecycleEvents,LH as ConnectionEvents,SX as ContactPoint,Bc as ContactShadows,Ot as Context,Kfe as ContextArgs,Si as ContextEvent,fi as ContextRegistry,aE as ControlTrackHandler,Xd as CustomBranding,Ol as CustomShader,IC as DefaultReflectionMode,fL as Deletable,JE as DeleteBox,Ul as DepthOfField,KE as DeviceFlag,mL as DocumentExtension,ko as DragControls,gL as DragMode,Yd as DropListener,im as Duplicatable,hx as EffectWrapper,Pc as EmissionModule,G0 as EmphasizeOnClick,CO as EngineLoadingView,An as EventList,XC as EventListEvent,Ha as EventSystem,eM as EventTrigger,ZD as FieldWithDefault,yC as FileReference,oV as FileReferenceSerializer,aW as FileSpawnModel,oW as File_Event,_L as FixedJoint,wL as FlyControls,tv as Fog,Xi as FrameEvent,R1 as GENERATOR,ie as GameObject,yt as Gizmos,fx as GltfExport,IL as GltfExportBox,mm as GltfLoadEvent,V7 as GltfLoadEventType,jd as Gradient,Hf as Graphic,ZC as GraphicRaycaster,Ea as Graphics,rv as GridHelper,FD as GridLayoutGroup,Uh as GroundProjectedEnv,Ad as GroupActionModel,V8 as HideFlags,jD as HideOnStart,ux as HingeJoint,UD as HorizontalLayoutGroup,Spe as HostData,N0 as Image,gC as ImageReference,sV as ImageReferenceSerializer,Hd as InheritVelocityModule,pG as Input,Oa as InputEventQueue,pn as InputEvents,nm as InputField,Jb as InstanceHandle,Yb as InstancingHandler,rl as InstancingUtil,d8 as InstantiateEvent,xr as InstantiateIdProvider,Vl as InstantiateOptions,pL as Interactable,Lde as JoinedRoomResponse,Que as KeyEventArgs,ja as Keyframe,gx as LODGroup,rm as LODModel,Ude as LeftRoomResponse,Oo as Light,IV as LightData,rr as LimitVelocityOverLifetimeModule,sme as LoadingElementOptions,kL as LogStats,Wo as LogType,sm as LookAt,Lf as LookAtConstraint,hs as MainModule,aD as MarkerType,Hb as MaskableGraphic,tt as Mathf,jf as MeshCollider,$b as MeshRenderer,ft as MinMaxCurve,Po as MinMaxGradient,mi as NEEDLE_progressive,SA as NEKeyboardEvent,Eh as NEPointerEvent,X3 as NeedleButtonElement,fi as NeedleEngine,B3 as NeedleEngineHTMLElement,I3 as NeedleGltfLoader,kc as NeedleMenu,L1 as NeedlePatchesKey,AQ as NeedleUSDZExporter,FB as NeedleXRController,Et as NeedleXRSession,NH as NeedleXRSync,XH as NeedleXRUtils,aM as NestedGltf,FH as NetworkConnection,Cc as NetworkedStreamEvents,d_ as NetworkedStreams,ov as Networking,f8 as NewInstanceModel,Mi as NoiseModule,ta as ObjectRaycaster,n0 as ObjectUtils,om as OffsetConstraint,S1 as OneEuroFilter,K2 as OneEuroFilterXYZ,av as OpenURL,wi as OrbitControls,F0 as Outline,UH as OwnershipEvent,ck as OwnershipModel,Od as Padding,tx as ParticleBurst,wM as ParticleSubEmitter,or as ParticleSystem,Zd as ParticleSystemBaseBehaviour,qa as ParticleSystemRenderer,OE as ParticleSystemShapeType,pE as PeerHandle,OH as PeerNetworking,GS as Physics,WE as PhysicsExtension,Dr as PhysicsMaterialCombine,Ex as PixelationEffect,Xf as PlayAnimationOnClick,Ud as PlayAudioOnClick,Td as PlayableDirector,Qv as PlayerColor,ra as PlayerState,o9 as PlayerStateEvent,B0 as PlayerSync,SV as PlayerView,CV as PlayerViewManager,Gv as PointerEventData,CS as PointerType,ss as PostProcessingEffect,SM as PostProcessingHandler,fv as PostProcessingManager,H0 as PreliminaryAction,Qb as PreliminaryTrigger,yf as PrimitiveType,si as Progress,h1 as PromiseAllWithErrors,f2 as PromiseErrorResult,ki as RGBAColor,Yx as RapierPhysics,bE as RawImage,dc as RaycastOptions,kD as Rect,zs as RectTransform,Q0 as ReflectionProbe,uE as RegisteredAnimationInfo,Gc as RemoteSkybox,E0 as RenderTexture,NQ as RenderTextureSerializer,Bn as Renderer,TV as RendererData,Kb as RendererLightmap,Oi as Rigidbody,Hn as RigidbodyConstraints,jt as RoomEvents,ca as RotationBySpeedModule,Wa as RotationOverLifetimeModule,IE as SceneLightSettings,Gr as SceneSwitcher,ep as ScreenCapture,iu as ScreenSpaceAmbientOcclusion,Fl as ScreenSpaceAmbientOcclusionN8,El as SendQueue,Nk as SerializationContext,Wf as SetActiveOnClick,Bx as ShadowCatcher,Cn as ShapeModule,Tx as SharpeningEffect,wb as SignalAsset,P0 as SignalReceiver,R0 as SignalReceiverEvent,Mb as SignalTrackHandler,BD as Size,fo as SizeBySpeedModule,Gd as SizeOverLifetimeModule,$D as SkinnedMeshRenderer,tp as SmoothFollow,T0 as SpatialGrabRaycaster,kx as SpatialHtml,Lx as SpatialTrigger,Hc as SpatialTriggerReceiver,IM as SpectatorCamera,L0 as SphereCollider,yk as SphereIntersection,EX as SphereOverlapResult,Zh as Sprite,K0 as SpriteData,Bo as SpriteRenderer,sx as SpriteSheet,P0e as StateMachineBehaviour,yD as StreamEndedEvent,h9 as StreamReceivedEvent,Cx as SubEmitterSystem,PM as SyncedCamera,Nl as SyncedRoom,vc as SyncedTransform,GD as TapGestureTrigger,VE as TeleportTarget,y3 as TestRunner,rSe as TestSceneUtils,A3 as TestSimulateUserData,js as Text,XE as TextBuilder,ox as TextExtension,us as TextureSheetAnimationModule,Vc as TiltShiftEffect,PV as Time,Fd as ToneMappingEffect,Sb as TrackHandler,ia as TrackType,vn as TrailModule,Fr as TransformData,um as TransformGizmo,Or as TriggerBuilder,kf as TriggerModel,q as TypeStore,$C as UIRaycastUtils,Ab as UIRootComponent,co as USDObject,yQ as USDWriter,Dn as USDZExporter,Wd as USDZText,qE as USDZUIExtension,Jk as Upload_Result,zQ as UriSerializer,lx as UsageMarker,Fde as UserJoinedOrLeftRoomModel,ml as VERSION,WO as VariantAction,En as VelocityOverLifetimeModule,LD as VerticalLayoutGroup,br as VideoPlayer,fd as ViewDevice,dm as Vignette,Wb as VisibilityAction,Bd as Voip,fv as Volume,Ke as VolumeParameter,Rb as VolumeProfile,ufe as WaitForFrames,cV as WaitForPromise,lV as WaitForSeconds,cu as Watch,DM as WebARCameraBackground,$h as WebARSessionRoot,On as WebXR,Kf as WebXRButtonFactory,gv as WebXRImageTracking,Qc as WebXRImageTrackingModel,nu as WebXRPlaneTracking,mv as WebXRTrackedImage,ru as XRControllerFollow,Dc as XRControllerModel,ha as XRControllerMovement,sa as XRFlag,LM as XRRig,po as XRState,wc as XRStateFlag,S3 as __Ignore,n8 as __internalNotifyObjectDestroyed,mh as activeInHierarchyFieldName,u4 as addAttributeChangeCallback,Zo as addComponent,Fye as addCustomExtensionPlugin,lW as addFile,cW as addFileFromUrl,I1e as addGltfLoadEventListener,Sf as addNewComponent,D1 as addPatch,lC as apply,j1e as applyHMRChanges,I8 as applyPrototypeExtensions,p8 as beginListenDestroy,hW as beginListenFileSpawn,m8 as beginListenInstantiate,HB as binaryIdentifierCasts,Jfe as build_scene_functions,ef as builtinComponentKeyName,wO as calculateProgress01,A4 as clearBalloonMessages,A4 as clearOverlayMessages,Lge as colorSerializer,A8 as compareAssociation,qC as componentSerializer,Rj as copyTexture,R3 as createLoader,e9 as createMotion,so as debugNet,OA as debugOwner,Ly as deepClone,$l as delay,r1 as delayForFrames,tC as deserializeObject,$o as destroy,z8 as destroyComponentInstance,Wi as disposeObjectResources,Ec as disposeStream,nV as download,Zk as download_file,Yy as editorGuidKeyName,l3 as effectsOrder,$p as enableSpatialConsole,Fge as euler,Gge as eventListSerializer,hSe as exportAsGLTF,eb as findByGuid,aC as findObjectOfType,H8 as findObjectsOfType,_k as findResourceUsers,Bj as fitObjectIntoVolume,Mf as foreachComponent,fC as foreachComponentEnumerator,soe as forward,p4 as generateQRCode,ZS as generateSeed,pl as getBoundingBox,xj as getCameraController,Cf as getComponent,KA as getComponentInChildren,ZA as getComponentInParent,JA as getComponents,a0 as getComponentsInChildren,oC as getComponentsInParent,fQ as getFormattedDate,is as getIconElement,mO as getIconTexture,cie as getIp,hie as getIpAndLocation,lie as getIpCloudflare,ul as getLoader,YA as getOrAddComponent,te as getParam,loe as getParentHierarchyPath,rie as getPath,Bde as getPeerOptions,BH as getPeerjsInstance,rpe as getResourceUserCount,wj as getTempColor,ic as getTempQuaternion,bt as getTempVector,Dy as getUrlParams,Pj as getVisibleInCustomShadowRendering,sP as getWorldDirection,oP as getWorldEuler,kt as getWorldPosition,Ri as getWorldQuaternion,Vy as getWorldRotation,Qi as getWorldScale,Lh as hasCommercialLicense,bO as hasIndieLicense,KC as hasPointerEventComponent,md as hasProLicense,Kk as hash,Uj as hideDebugConsole,_Q as imageToCanvas,c0 as instantiate,KD as invokeAfterImportPluginHooks,uG as invokeXRSessionEnd,hG as invokeXRSessionStart,Q8 as isActiveInHierarchy,l0 as isActiveSelf,c4 as isAndroidDevice,Ij as isAnimationAction,eie as isDebugMode,gg as isDesktop,Ef as isDestroyed,it as isDevEnvironment,ipe as isDisposed,oSe as isExporting,t4 as isHostedOnGlitch,U1e as isHotReloading,OV as isIconElement,eo as isLocalNetwork,h4 as isMacOS,ec as isMobileDevice,qp as isMozillaXR,c1 as isQuest,e8 as isResourceTrackingEnabled,vg as isSafari,uC as isUsingInstancing,Lu as isiOS,P3 as loadSync,M1 as logHierarchy,Zse as lookAtInverse,Hy as lookAtObject,iie as makeId,o4 as makeIdFromRandomWords,Pl as makeNameSafeForUSD,W8 as markAsInstancedRendered,Uy as microphonePermissionsGranted,$te as nameof,i4 as nameofFactory,FQ as objectSerializer,Uue as offXRSessionEnd,Lue as offXRSessionStart,$ge as onAfterRender,WQ as onBeforeRender,Kge as onClear,Zge as onDestroy,Jge as onInitialized,KO as onStart,ZO as onUpdate,UB as onXRSessionEnd,SS as onXRSessionStart,W7 as parseSync,kj as placeOnSurface,hP as postprocessFBXMaterials,t0e as prefix,n4 as pushState,nie as randomNumber,VB as registerBinaryType,DC as registerComponent,qD as registerComponentExtension,Qa as registerCustomEffectType,JD as registerExportExtensions,YD as registerExtensions,F1e as registerHotReloadType,o2 as registerLoader,v8 as registerPrefabProvider,R8 as registerPrototypeExtensions,Ipe as registerType,l4 as relativePathPrefix,d4 as removeAttributeChangeCallback,Qk as removeComponent,Nye as removeCustomImportExtensionType,R1e as removeGltfLoadEventListener,Ble as removePatch,Du as resolveUrl,a4 as sanitizeString,IX as saveImage,sSe as screenshot,TX as screenshot2,Bk as sendDestroyed,C as serializable,w8 as serializeObject,C0 as serializeable,$A as setActive,v4 as setAllowBalloonMessages,fie as setAllowOverlayMessages,eP as setAutoFitEnabled,Z2 as setCameraController,q8 as setDestroyed,goe as setDevEnvironment,xk as setDisposable,Xk as setDontDestroy,c2 as setOrAddParamsToUrl,tie as setParam,n1 as setParamWithoutReload,kde as setPeerOptions,tpe as setResourceTrackingEnabled,h2 as setState,cP as setVisibleInCustomShadowRendering,aP as setWorldEuler,gr as setWorldPosition,Kp as setWorldPositionXYZ,Ca as setWorldQuaternion,rP as setWorldQuaternionXYZW,lP as setWorldRotation,Qy as setWorldRotationXYZ,bg as setWorldScale,I1 as showBalloonError,dn as showBalloonMessage,Pi as showBalloonWarning,mP as showDebugConsole,Jse as slerp,HA as syncDestroy,gD as syncField,kk as syncInstantiate,coe as textureToCanvas,yG as tryCastBinary,j7 as tryDetermineFileTypeFromBinary,z7 as tryDetermineFileTypeFromURL,fg as tryFindObject,AG as tryGetGuid,N1e as unregisterHotReloadType,u2 as unwatchWrite,iV as upload_file,_j as useForAutoFit,ns as validate,o1 as watchWrite};
