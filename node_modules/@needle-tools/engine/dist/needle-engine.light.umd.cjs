"use strict";var NX=Object.defineProperty;var zX=(s,e,t)=>e in s?NX(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>(zX(s,typeof e!="symbol"?e+"":e,t),t),tI=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var pi=(s,e,t)=>(tI(s,e,"read from private field"),t?t.call(s):e.get(s)),qo=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},ml=(s,e,t,i)=>(tI(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t);var Cf=(s,e,t)=>(tI(s,e,"access private method"),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var VU=typeof document<"u"?document.currentScript:null;/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const su="162",op={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ap={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},x5=0,UB=1,w5=2,GX=3,HX=0,RO=1,PO=2,cc=3,$n=0,bn=1,_i=2,xn=0,Cd=1,Yp=2,NB=3,zB=4,BO=5,ud=100,S5=101,C5=102,GB=103,I1=104,E5=200,M5=201,T5=202,I5=203,R1=204,P1=205,R5=206,P5=207,B5=208,D5=209,O5=210,L5=211,k5=212,F5=213,U5=214,DO=0,GE=1,x_=2,Kp=3,qy=4,HE=5,VE=6,bb=7,xb=0,N5=1,z5=2,po=0,mv=1,wb=2,G5=3,Sb=4,H5=5,gv=6,Jp=7,HB="attached",V5="detached",QE=300,ru=301,zd=302,mo=303,Xy=304,yv=306,Uo=1e3,as=1001,Zp=1002,Ot=1003,Yy=1004,VX=1004,Nh=1005,QX=1005,Nt=1006,Rp=1007,WX=1007,Do=1008,jX=1008,wn=1009,B1=1010,OO=1011,Cb=1012,Pp=1013,Hr=1014,tn=1015,Cs=1016,LO=1017,kO=1018,Kh=1020,Q5=1021,Li=1023,WE=1024,W5=1025,Ed=1026,Gd=1027,um=1028,jE=1029,qE=1030,Eb=1031,Ky=1033,zC=33776,GC=33777,HC=33778,VC=33779,VB=35840,QB=35841,WB=35842,jB=35843,FO=36196,qB=37492,XB=37496,YB=37808,KB=37809,JB=37810,ZB=37811,$B=37812,e2=37813,t2=37814,i2=37815,n2=37816,s2=37817,r2=37818,o2=37819,a2=37820,l2=37821,QC=36492,c2=36494,h2=36495,j5=36283,u2=36284,d2=36285,f2=36286,w_=2200,UO=2201,q5=2202,Hd=2300,Fc=2301,WC=2302,Ap=2400,_p=2401,S_=2402,XE=2500,NO=2501,X5=0,zO=1,D1=2,Y5=3e3,p2=3001,gr=3200,YE=3201,Zd=0,K5=1,Bo="",bt="srgb",zi="srgb-linear",KE="display-p3",Mb="display-p3-linear",C_="linear",Yi="srgb",E_="rec709",M_="p3",J5=0,sd=7680,Z5=7681,$5=7682,e8=7683,t8=34055,i8=34056,n8=5386,m2=512,s8=513,r8=514,o8=515,a8=516,l8=517,c8=518,O1=519,h8=512,u8=513,d8=514,GO=515,f8=516,p8=517,m8=518,g8=519,T_=35044,Ur=35048,qX=35040,XX=35045,YX=35049,KX=35041,JX=35046,ZX=35050,$X=35042,eY="100",L1="300 es",k1=1035,Sc=2e3,I_=2001;let js=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e);e.target=null}}};const Mr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let QU=1234567;const Bp=Math.PI/180,Jy=180/Math.PI;function pa(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Mr[s&255]+Mr[s>>8&255]+Mr[s>>16&255]+Mr[s>>24&255]+"-"+Mr[e&255]+Mr[e>>8&255]+"-"+Mr[e>>16&15|64]+Mr[e>>24&255]+"-"+Mr[t&63|128]+Mr[t>>8&255]+"-"+Mr[t>>16&255]+Mr[t>>24&255]+Mr[i&255]+Mr[i>>8&255]+Mr[i>>16&255]+Mr[i>>24&255]).toLowerCase()}function zn(s,e,t){return Math.max(e,Math.min(t,s))}function HO(s,e){return(s%e+e)%e}function tY(s,e,t,i,n){return i+(s-e)*(n-i)/(t-e)}function iY(s,e,t){return s!==e?(t-s)/(e-s):0}function HA(s,e,t){return(1-t)*s+t*e}function nY(s,e,t,i){return HA(s,e,1-Math.exp(-t*i))}function sY(s,e=1){return e-Math.abs(HO(s,e*2)-e)}function rY(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function oY(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function aY(s,e){return s+Math.floor(Math.random()*(e-s+1))}function lY(s,e){return s+Math.random()*(e-s)}function cY(s){return s*(.5-Math.random())}function hY(s){s!==void 0&&(QU=s);let e=QU+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function uY(s){return s*Bp}function dY(s){return s*Jy}function g2(s){return(s&s-1)===0&&s!==0}function fY(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function F1(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function pY(s,e,t,i,n){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),u=r((e-i)/2),f=o((e-i)/2),p=r((i-e)/2),m=o((i-e)/2);switch(n){case"XYX":s.set(a*h,l*u,l*f,a*c);break;case"YZY":s.set(l*f,a*h,l*u,a*c);break;case"ZXZ":s.set(l*u,l*f,a*h,a*c);break;case"XZX":s.set(a*h,l*m,l*p,a*c);break;case"YXY":s.set(l*p,a*h,l*m,a*c);break;case"ZYZ":s.set(l*m,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function ho(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function Jt(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const gi={DEG2RAD:Bp,RAD2DEG:Jy,generateUUID:pa,clamp:zn,euclideanModulo:HO,mapLinear:tY,inverseLerp:iY,lerp:HA,damp:nY,pingpong:sY,smoothstep:rY,smootherstep:oY,randInt:aY,randFloat:lY,randFloatSpread:cY,seededRandom:hY,degToRad:uY,radToDeg:dY,isPowerOfTwo:g2,ceilPowerOfTwo:fY,floorPowerOfTwo:F1,setQuaternionFromProperEuler:pY,normalize:Jt,denormalize:ho};let ee=class y8{constructor(e=0,t=0){y8.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(zn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Ut=class v8{constructor(e,t,i,n,r,o,a,l,c){v8.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c)}set(e,t,i,n,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=n,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],u=i[7],f=i[2],p=i[5],m=i[8],v=n[0],g=n[3],y=n[6],A=n[1],_=n[4],b=n[7],x=n[2],E=n[5],M=n[8];return r[0]=o*v+a*A+l*x,r[3]=o*g+a*_+l*E,r[6]=o*y+a*b+l*M,r[1]=c*v+h*A+u*x,r[4]=c*g+h*_+u*E,r[7]=c*y+h*b+u*M,r[2]=f*v+p*A+m*x,r[5]=f*g+p*_+m*E,r[8]=f*y+p*b+m*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+n*r*c-n*o*l}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=h*o-a*c,f=a*l-h*r,p=c*r-o*l,m=t*u+i*f+n*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/m;return e[0]=u*v,e[1]=(n*c-h*i)*v,e[2]=(a*i-n*o)*v,e[3]=f*v,e[4]=(h*t-n*l)*v,e[5]=(n*r-a*t)*v,e[6]=p*v,e[7]=(i*l-c*t)*v,e[8]=(o*t-i*r)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-n*c,n*l,-n*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(iI.makeScale(e,t)),this}rotate(e){return this.premultiply(iI.makeRotation(-e)),this}translate(e,t){return this.premultiply(iI.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const iI=new Ut;function A8(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}const mY={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function dy(s,e){return new mY[s](e)}function R_(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}function _8(){const s=R_("canvas");return s.style.display="block",s}const WU={};function b8(s){s in WU||(WU[s]=!0,console.warn(s))}const jU=new Ut().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),qU=new Ut().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Qx={[zi]:{transfer:C_,primaries:E_,toReference:s=>s,fromReference:s=>s},[bt]:{transfer:Yi,primaries:E_,toReference:s=>s.convertSRGBToLinear(),fromReference:s=>s.convertLinearToSRGB()},[Mb]:{transfer:C_,primaries:M_,toReference:s=>s.applyMatrix3(qU),fromReference:s=>s.applyMatrix3(jU)},[KE]:{transfer:Yi,primaries:M_,toReference:s=>s.convertSRGBToLinear().applyMatrix3(qU),fromReference:s=>s.applyMatrix3(jU).convertLinearToSRGB()}},gY=new Set([zi,Mb]),Ci={enabled:!0,_workingColorSpace:zi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(s){if(!gY.has(s))throw new Error(`Unsupported working color space, "${s}".`);this._workingColorSpace=s},convert:function(s,e,t){if(this.enabled===!1||e===t||!e||!t)return s;const i=Qx[e].toReference,n=Qx[t].fromReference;return n(i(s))},fromWorkingColorSpace:function(s,e){return this.convert(s,this._workingColorSpace,e)},toWorkingColorSpace:function(s,e){return this.convert(s,e,this._workingColorSpace)},getPrimaries:function(s){return Qx[s].primaries},getTransfer:function(s){return s===Bo?C_:Qx[s].transfer}};function Ry(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function nI(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}let Vm,VO=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Vm===void 0&&(Vm=R_("canvas")),Vm.width=e.width,Vm.height=e.height;const i=Vm.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Vm}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=R_("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let o=0;o<r.length;o++)r[o]=Ry(r[o]/255)*255;return i.putImageData(n,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Ry(t[i]/255)*255):t[i]=Ry(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},yY=0,jh=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:yY++}),this.uuid=pa(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let r;if(Array.isArray(n)){r=[];for(let o=0,a=n.length;o<a;o++)n[o].isDataTexture?r.push(sI(n[o].image)):r.push(sI(n[o]))}else r=sI(n);i.url=r}return t||(e.images[this.uuid]=i),i}};function sI(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?VO.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let vY=0,Wt=class jC extends js{constructor(e=jC.DEFAULT_IMAGE,t=jC.DEFAULT_MAPPING,i=as,n=as,r=Nt,o=Do,a=Li,l=wn,c=jC.DEFAULT_ANISOTROPY,h=Bo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:vY++}),this.uuid=pa(),this.name="",this.source=new jh(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new ee(0,0),this.repeat=new ee(1,1),this.center=new ee(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ut,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==QE)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Uo:e.x=e.x-Math.floor(e.x);break;case as:e.x=e.x<0?0:1;break;case Zp:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Uo:e.y=e.y-Math.floor(e.y);break;case as:e.y=e.y<0?0:1;break;case Zp:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Wt.DEFAULT_IMAGE=null;Wt.DEFAULT_MAPPING=QE;Wt.DEFAULT_ANISOTROPY=1;let Je=class x8{constructor(e=0,t=0,i=0,n=1){x8.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const l=e.elements,c=l[0],h=l[4],u=l[8],f=l[1],p=l[5],m=l[9],v=l[2],g=l[6],y=l[10];if(Math.abs(h-f)<.01&&Math.abs(u-v)<.01&&Math.abs(m-g)<.01){if(Math.abs(h+f)<.1&&Math.abs(u+v)<.1&&Math.abs(m+g)<.1&&Math.abs(c+p+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(c+1)/2,b=(p+1)/2,x=(y+1)/2,E=(h+f)/4,M=(u+v)/4,T=(m+g)/4;return _>b&&_>x?_<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(_),n=E/i,r=M/i):b>x?b<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(b),i=E/n,r=T/n):x<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(x),i=M/r,n=T/r),this.set(i,n,r,t),this}let A=Math.sqrt((g-m)*(g-m)+(u-v)*(u-v)+(f-h)*(f-h));return Math.abs(A)<.001&&(A=1),this.x=(g-m)/A,this.y=(u-v)/A,this.z=(f-h)/A,this.w=Math.acos((c+p+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class w8 extends js{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Je(0,0,e,t),this.scissorTest=!1,this.viewport=new Je(0,0,e,t);const n={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Nt,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},i);const r=new Wt(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.textures.length;n<r;n++)this.textures[n].image.width=e,this.textures[n].image.height=t,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,n=e.textures.length;i<n;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new jh(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class $t extends w8{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class JE extends Wt{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Ot,this.minFilter=Ot,this.wrapR=as,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class AY extends $t{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new JE(null,e,t,i),this.texture.isRenderTargetTexture=!0}}let QO=class extends Wt{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=Ot,this.minFilter=Ot,this.wrapR=as,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class _Y extends $t{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new QO(null,e,t,i),this.texture.isRenderTargetTexture=!0}}let Ce=class{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,o,a){let l=i[n+0],c=i[n+1],h=i[n+2],u=i[n+3];const f=r[o+0],p=r[o+1],m=r[o+2],v=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u;return}if(a===1){e[t+0]=f,e[t+1]=p,e[t+2]=m,e[t+3]=v;return}if(u!==v||l!==f||c!==p||h!==m){let g=1-a;const y=l*f+c*p+h*m+u*v,A=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const x=Math.sqrt(_),E=Math.atan2(x,y*A);g=Math.sin(g*E)/x,a=Math.sin(a*E)/x}const b=a*A;if(l=l*g+f*b,c=c*g+p*b,h=h*g+m*b,u=u*g+v*b,g===1-a){const x=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=x,c*=x,h*=x,u*=x}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,n,r,o){const a=i[n],l=i[n+1],c=i[n+2],h=i[n+3],u=r[o],f=r[o+1],p=r[o+2],m=r[o+3];return e[t]=a*m+h*u+l*p-c*f,e[t+1]=l*m+h*f+c*u-a*p,e[t+2]=c*m+h*p+a*f-l*u,e[t+3]=h*m-a*u-l*f-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,n=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(n/2),u=a(r/2),f=l(i/2),p=l(n/2),m=l(r/2);switch(o){case"XYZ":this._x=f*h*u+c*p*m,this._y=c*p*u-f*h*m,this._z=c*h*m+f*p*u,this._w=c*h*u-f*p*m;break;case"YXZ":this._x=f*h*u+c*p*m,this._y=c*p*u-f*h*m,this._z=c*h*m-f*p*u,this._w=c*h*u+f*p*m;break;case"ZXY":this._x=f*h*u-c*p*m,this._y=c*p*u+f*h*m,this._z=c*h*m+f*p*u,this._w=c*h*u-f*p*m;break;case"ZYX":this._x=f*h*u-c*p*m,this._y=c*p*u+f*h*m,this._z=c*h*m-f*p*u,this._w=c*h*u+f*p*m;break;case"YZX":this._x=f*h*u+c*p*m,this._y=c*p*u+f*h*m,this._z=c*h*m-f*p*u,this._w=c*h*u-f*p*m;break;case"XZY":this._x=f*h*u-c*p*m,this._y=c*p*u-f*h*m,this._z=c*h*m+f*p*u,this._w=c*h*u+f*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],u=t[10],f=i+a+u;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(h-l)*p,this._y=(r-c)*p,this._z=(o-n)*p}else if(i>a&&i>u){const p=2*Math.sqrt(1+i-a-u);this._w=(h-l)/p,this._x=.25*p,this._y=(n+o)/p,this._z=(r+c)/p}else if(a>u){const p=2*Math.sqrt(1+a-i-u);this._w=(r-c)/p,this._x=(n+o)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+u-i-a);this._w=(o-n)/p,this._x=(r+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(zn(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+n*c-r*l,this._y=n*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-n*a,this._w=o*h-i*a-n*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,n=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*i+t*this._x,this._y=p*n+t*this._y,this._z=p*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),u=Math.sin((1-t)*h)/c,f=Math.sin(t*h)/c;return this._w=o*u+this._w*f,this._x=i*u+this._x*f,this._y=n*u+this._y*f,this._z=r*u+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(n*Math.sin(e),n*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},S=class S8{constructor(e=0,t=0,i=0){S8.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(XU.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(XU.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*n-a*i),h=2*(a*t-r*n),u=2*(r*i-o*t);return this.x=t+l*c+o*u-a*h,this.y=i+l*h+a*c-r*u,this.z=n+l*u+r*h-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=n*l-r*a,this.y=r*o-i*l,this.z=i*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return rI.copy(this).projectOnVector(e),this.sub(rI)}reflect(e){return this.sub(rI.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(zn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const rI=new S,XU=new Ce;let jt=class{constructor(e=new S(1/0,1/0,1/0),t=new S(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(gl.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(gl.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=gl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,gl):gl.fromBufferAttribute(r,o),gl.applyMatrix4(e.matrixWorld),this.expandByPoint(gl);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Wx.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Wx.copy(i.boundingBox)),Wx.applyMatrix4(e.matrixWorld),this.union(Wx)}const n=e.children;for(let r=0,o=n.length;r<o;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,gl),gl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(h0),jx.subVectors(this.max,h0),Qm.subVectors(e.a,h0),Wm.subVectors(e.b,h0),jm.subVectors(e.c,h0),Cu.subVectors(Wm,Qm),Eu.subVectors(jm,Wm),Ef.subVectors(Qm,jm);let t=[0,-Cu.z,Cu.y,0,-Eu.z,Eu.y,0,-Ef.z,Ef.y,Cu.z,0,-Cu.x,Eu.z,0,-Eu.x,Ef.z,0,-Ef.x,-Cu.y,Cu.x,0,-Eu.y,Eu.x,0,-Ef.y,Ef.x,0];return!oI(t,Qm,Wm,jm,jx)||(t=[1,0,0,0,1,0,0,0,1],!oI(t,Qm,Wm,jm,jx))?!1:(qx.crossVectors(Cu,Eu),t=[qx.x,qx.y,qx.z],oI(t,Qm,Wm,jm,jx))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,gl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(gl).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(sh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),sh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),sh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),sh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),sh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),sh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),sh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),sh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(sh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};const sh=[new S,new S,new S,new S,new S,new S,new S,new S],gl=new S,Wx=new jt,Qm=new S,Wm=new S,jm=new S,Cu=new S,Eu=new S,Ef=new S,h0=new S,jx=new S,qx=new S,Mf=new S;function oI(s,e,t,i,n){for(let r=0,o=s.length-3;r<=o;r+=3){Mf.fromArray(s,r);const a=n.x*Math.abs(Mf.x)+n.y*Math.abs(Mf.y)+n.z*Math.abs(Mf.z),l=e.dot(Mf),c=t.dot(Mf),h=i.dot(Mf);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const bY=new jt,u0=new S,aI=new S;let ln=class{constructor(e=new S,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):bY.setFromPoints(e).getCenter(i);let n=0;for(let r=0,o=e.length;r<o;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;u0.subVectors(e,this.center);const t=u0.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),n=(i-this.radius)*.5;this.center.addScaledVector(u0,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(aI.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(u0.copy(e.center).add(aI)),this.expandByPoint(u0.copy(e.center).sub(aI))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}};const rh=new S,lI=new S,Xx=new S,Mu=new S,cI=new S,Yx=new S,hI=new S;let _o=class{constructor(e=new S,t=new S(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,rh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=rh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(rh.copy(this.origin).addScaledVector(this.direction,t),rh.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){lI.copy(e).add(t).multiplyScalar(.5),Xx.copy(t).sub(e).normalize(),Mu.copy(this.origin).sub(lI);const r=e.distanceTo(t)*.5,o=-this.direction.dot(Xx),a=Mu.dot(this.direction),l=-Mu.dot(Xx),c=Mu.lengthSq(),h=Math.abs(1-o*o);let u,f,p,m;if(h>0)if(u=o*l-a,f=o*a-l,m=r*h,u>=0)if(f>=-m)if(f<=m){const v=1/h;u*=v,f*=v,p=u*(u+o*f+2*a)+f*(o*u+f+2*l)+c}else f=r,u=Math.max(0,-(o*f+a)),p=-u*u+f*(f+2*l)+c;else f=-r,u=Math.max(0,-(o*f+a)),p=-u*u+f*(f+2*l)+c;else f<=-m?(u=Math.max(0,-(-o*r+a)),f=u>0?-r:Math.min(Math.max(-r,-l),r),p=-u*u+f*(f+2*l)+c):f<=m?(u=0,f=Math.min(Math.max(-r,-l),r),p=f*(f+2*l)+c):(u=Math.max(0,-(o*r+a)),f=u>0?r:Math.min(Math.max(-r,-l),r),p=-u*u+f*(f+2*l)+c);else f=o>0?-r:r,u=Math.max(0,-(o*f+a)),p=-u*u+f*(f+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,u),n&&n.copy(lI).addScaledVector(Xx,f),p}intersectSphere(e,t){rh.subVectors(e.center,this.origin);const i=rh.dot(this.direction),n=rh.dot(rh)-i*i,r=e.radius*e.radius;if(n>r)return null;const o=Math.sqrt(r-n),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,f=this.origin;return c>=0?(i=(e.min.x-f.x)*c,n=(e.max.x-f.x)*c):(i=(e.max.x-f.x)*c,n=(e.min.x-f.x)*c),h>=0?(r=(e.min.y-f.y)*h,o=(e.max.y-f.y)*h):(r=(e.max.y-f.y)*h,o=(e.min.y-f.y)*h),i>o||r>n||((r>i||isNaN(i))&&(i=r),(o<n||isNaN(n))&&(n=o),u>=0?(a=(e.min.z-f.z)*u,l=(e.max.z-f.z)*u):(a=(e.max.z-f.z)*u,l=(e.min.z-f.z)*u),i>l||a>n)||((a>i||i!==i)&&(i=a),(l<n||n!==n)&&(n=l),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return this.intersectBox(e,rh)!==null}intersectTriangle(e,t,i,n,r){cI.subVectors(t,e),Yx.subVectors(i,e),hI.crossVectors(cI,Yx);let o=this.direction.dot(hI),a;if(o>0){if(n)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Mu.subVectors(this.origin,e);const l=a*this.direction.dot(Yx.crossVectors(Mu,Yx));if(l<0)return null;const c=a*this.direction.dot(cI.cross(Mu));if(c<0||l+c>o)return null;const h=-a*Mu.dot(hI);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},le=class y2{constructor(e,t,i,n,r,o,a,l,c,h,u,f,p,m,v,g){y2.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c,h,u,f,p,m,v,g)}set(e,t,i,n,r,o,a,l,c,h,u,f,p,m,v,g){const y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=n,y[1]=r,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=h,y[10]=u,y[14]=f,y[3]=p,y[7]=m,y[11]=v,y[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new y2().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/qm.setFromMatrixColumn(e,0).length(),r=1/qm.setFromMatrixColumn(e,1).length(),o=1/qm.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(n),c=Math.sin(n),h=Math.cos(r),u=Math.sin(r);if(e.order==="XYZ"){const f=o*h,p=o*u,m=a*h,v=a*u;t[0]=l*h,t[4]=-l*u,t[8]=c,t[1]=p+m*c,t[5]=f-v*c,t[9]=-a*l,t[2]=v-f*c,t[6]=m+p*c,t[10]=o*l}else if(e.order==="YXZ"){const f=l*h,p=l*u,m=c*h,v=c*u;t[0]=f+v*a,t[4]=m*a-p,t[8]=o*c,t[1]=o*u,t[5]=o*h,t[9]=-a,t[2]=p*a-m,t[6]=v+f*a,t[10]=o*l}else if(e.order==="ZXY"){const f=l*h,p=l*u,m=c*h,v=c*u;t[0]=f-v*a,t[4]=-o*u,t[8]=m+p*a,t[1]=p+m*a,t[5]=o*h,t[9]=v-f*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const f=o*h,p=o*u,m=a*h,v=a*u;t[0]=l*h,t[4]=m*c-p,t[8]=f*c+v,t[1]=l*u,t[5]=v*c+f,t[9]=p*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const f=o*l,p=o*c,m=a*l,v=a*c;t[0]=l*h,t[4]=v-f*u,t[8]=m*u+p,t[1]=u,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=p*u+m,t[10]=f-v*u}else if(e.order==="XZY"){const f=o*l,p=o*c,m=a*l,v=a*c;t[0]=l*h,t[4]=-u,t[8]=c*h,t[1]=f*u+v,t[5]=o*h,t[9]=p*u-m,t[2]=m*u-p,t[6]=a*h,t[10]=v*u+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(xY,e,wY)}lookAt(e,t,i){const n=this.elements;return Xo.subVectors(e,t),Xo.lengthSq()===0&&(Xo.z=1),Xo.normalize(),Tu.crossVectors(i,Xo),Tu.lengthSq()===0&&(Math.abs(i.z)===1?Xo.x+=1e-4:Xo.z+=1e-4,Xo.normalize(),Tu.crossVectors(i,Xo)),Tu.normalize(),Kx.crossVectors(Xo,Tu),n[0]=Tu.x,n[4]=Kx.x,n[8]=Xo.x,n[1]=Tu.y,n[5]=Kx.y,n[9]=Xo.y,n[2]=Tu.z,n[6]=Kx.z,n[10]=Xo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],u=i[5],f=i[9],p=i[13],m=i[2],v=i[6],g=i[10],y=i[14],A=i[3],_=i[7],b=i[11],x=i[15],E=n[0],M=n[4],T=n[8],R=n[12],w=n[1],I=n[5],O=n[9],k=n[13],B=n[2],G=n[6],L=n[10],U=n[14],z=n[3],j=n[7],X=n[11],re=n[15];return r[0]=o*E+a*w+l*B+c*z,r[4]=o*M+a*I+l*G+c*j,r[8]=o*T+a*O+l*L+c*X,r[12]=o*R+a*k+l*U+c*re,r[1]=h*E+u*w+f*B+p*z,r[5]=h*M+u*I+f*G+p*j,r[9]=h*T+u*O+f*L+p*X,r[13]=h*R+u*k+f*U+p*re,r[2]=m*E+v*w+g*B+y*z,r[6]=m*M+v*I+g*G+y*j,r[10]=m*T+v*O+g*L+y*X,r[14]=m*R+v*k+g*U+y*re,r[3]=A*E+_*w+b*B+x*z,r[7]=A*M+_*I+b*G+x*j,r[11]=A*T+_*O+b*L+x*X,r[15]=A*R+_*k+b*U+x*re,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],u=e[6],f=e[10],p=e[14],m=e[3],v=e[7],g=e[11],y=e[15];return m*(+r*l*u-n*c*u-r*a*f+i*c*f+n*a*p-i*l*p)+v*(+t*l*p-t*c*f+r*o*f-n*o*p+n*c*h-r*l*h)+g*(+t*c*u-t*a*p-r*o*u+i*o*p+r*a*h-i*c*h)+y*(-n*a*h-t*l*u+t*a*f+n*o*u-i*o*f+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=e[9],f=e[10],p=e[11],m=e[12],v=e[13],g=e[14],y=e[15],A=u*g*c-v*f*c+v*l*p-a*g*p-u*l*y+a*f*y,_=m*f*c-h*g*c-m*l*p+o*g*p+h*l*y-o*f*y,b=h*v*c-m*u*c+m*a*p-o*v*p-h*a*y+o*u*y,x=m*u*l-h*v*l-m*a*f+o*v*f+h*a*g-o*u*g,E=t*A+i*_+n*b+r*x;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/E;return e[0]=A*M,e[1]=(v*f*r-u*g*r-v*n*p+i*g*p+u*n*y-i*f*y)*M,e[2]=(a*g*r-v*l*r+v*n*c-i*g*c-a*n*y+i*l*y)*M,e[3]=(u*l*r-a*f*r-u*n*c+i*f*c+a*n*p-i*l*p)*M,e[4]=_*M,e[5]=(h*g*r-m*f*r+m*n*p-t*g*p-h*n*y+t*f*y)*M,e[6]=(m*l*r-o*g*r-m*n*c+t*g*c+o*n*y-t*l*y)*M,e[7]=(o*f*r-h*l*r+h*n*c-t*f*c-o*n*p+t*l*p)*M,e[8]=b*M,e[9]=(m*u*r-h*v*r-m*i*p+t*v*p+h*i*y-t*u*y)*M,e[10]=(o*v*r-m*a*r+m*i*c-t*v*c-o*i*y+t*a*y)*M,e[11]=(h*a*r-o*u*r-h*i*c+t*u*c+o*i*p-t*a*p)*M,e[12]=x*M,e[13]=(h*v*n-m*u*n+m*i*f-t*v*f-h*i*g+t*u*g)*M,e[14]=(m*a*n-o*v*n-m*i*l+t*v*l+o*i*g-t*a*g)*M,e[15]=(o*u*n-h*a*n+h*i*l-t*u*l-o*i*f+t*a*f)*M,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-n*l,c*l+n*a,0,c*a+n*l,h*a+i,h*l-n*o,0,c*l-n*a,h*l+n*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,o){return this.set(1,i,r,0,e,1,o,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,u=a+a,f=r*c,p=r*h,m=r*u,v=o*h,g=o*u,y=a*u,A=l*c,_=l*h,b=l*u,x=i.x,E=i.y,M=i.z;return n[0]=(1-(v+y))*x,n[1]=(p+b)*x,n[2]=(m-_)*x,n[3]=0,n[4]=(p-b)*E,n[5]=(1-(f+y))*E,n[6]=(g+A)*E,n[7]=0,n[8]=(m+_)*M,n[9]=(g-A)*M,n[10]=(1-(f+v))*M,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=qm.set(n[0],n[1],n[2]).length();const o=qm.set(n[4],n[5],n[6]).length(),a=qm.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],yl.copy(this);const c=1/r,h=1/o,u=1/a;return yl.elements[0]*=c,yl.elements[1]*=c,yl.elements[2]*=c,yl.elements[4]*=h,yl.elements[5]*=h,yl.elements[6]*=h,yl.elements[8]*=u,yl.elements[9]*=u,yl.elements[10]*=u,t.setFromRotationMatrix(yl),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,n,r,o,a=Sc){const l=this.elements,c=2*r/(t-e),h=2*r/(i-n),u=(t+e)/(t-e),f=(i+n)/(i-n);let p,m;if(a===Sc)p=-(o+r)/(o-r),m=-2*o*r/(o-r);else if(a===I_)p=-o/(o-r),m=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=h,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,n,r,o,a=Sc){const l=this.elements,c=1/(t-e),h=1/(i-n),u=1/(o-r),f=(t+e)*c,p=(i+n)*h;let m,v;if(a===Sc)m=(o+r)*u,v=-2*u;else if(a===I_)m=r*u,v=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=v,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}};const qm=new S,yl=new le,xY=new S(0,0,0),wY=new S(1,1,1),Tu=new S,Kx=new S,Xo=new S,YU=new le,KU=new Ce;let li=class C8{constructor(e=0,t=0,i=0,n=C8.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,r=n[0],o=n[4],a=n[8],l=n[1],c=n[5],h=n[9],u=n[2],f=n[6],p=n[10];switch(t){case"XYZ":this._y=Math.asin(zn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-zn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(zn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-zn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(zn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-zn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return YU.makeRotationFromQuaternion(e),this.setFromRotationMatrix(YU,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return KU.setFromEuler(this),this.setFromQuaternion(KU,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};li.DEFAULT_ORDER="XYZ";let Vr=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},SY=0;const JU=new S,Xm=new Ce,oh=new le,Jx=new S,d0=new S,CY=new S,EY=new Ce,ZU=new S(1,0,0),$U=new S(0,1,0),e3=new S(0,0,1),MY={type:"added"},TY={type:"removed"},uI={type:"childadded",child:null},dI={type:"childremoved",child:null};let ye=class qC extends js{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:SY++}),this.uuid=pa(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=qC.DEFAULT_UP.clone();const e=new S,t=new li,i=new Ce,n=new S(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new le},normalMatrix:{value:new Ut}}),this.matrix=new le,this.matrixWorld=new le,this.matrixAutoUpdate=qC.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=qC.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Vr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Xm.setFromAxisAngle(e,t),this.quaternion.multiply(Xm),this}rotateOnWorldAxis(e,t){return Xm.setFromAxisAngle(e,t),this.quaternion.premultiply(Xm),this}rotateX(e){return this.rotateOnAxis(ZU,e)}rotateY(e){return this.rotateOnAxis($U,e)}rotateZ(e){return this.rotateOnAxis(e3,e)}translateOnAxis(e,t){return JU.copy(e).applyQuaternion(this.quaternion),this.position.add(JU.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ZU,e)}translateY(e){return this.translateOnAxis($U,e)}translateZ(e){return this.translateOnAxis(e3,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(oh.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Jx.copy(e):Jx.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),d0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?oh.lookAt(d0,Jx,this.up):oh.lookAt(Jx,d0,this.up),this.quaternion.setFromRotationMatrix(oh),n&&(oh.extractRotation(n.matrixWorld),Xm.setFromRotationMatrix(oh),this.quaternion.premultiply(Xm.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(MY),uI.child=e,this.dispatchEvent(uI),uI.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(TY),dI.child=e,this.dispatchEvent(dI),dI.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),oh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),oh.multiply(e.parent.matrixWorld)),e.applyMatrix4(oh),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(d0,e,CY),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(d0,EY,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++){const r=t[i];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const n=this.children;for(let r=0,o=n.length;r<o;r++){const a=n[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];r(e.shapes,u)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));n.material=a}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];n.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),u=o(e.shapes),f=o(e.skeletons),p=o(e.animations),m=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),u.length>0&&(i.shapes=u),f.length>0&&(i.skeletons=f),p.length>0&&(i.animations=p),m.length>0&&(i.nodes=m)}return i.object=n,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const n=e.children[i];this.add(n.clone())}return this}};ye.DEFAULT_UP=new S(0,1,0);ye.DEFAULT_MATRIX_AUTO_UPDATE=!0;ye.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const vl=new S,ah=new S,fI=new S,lh=new S,Ym=new S,Km=new S,t3=new S,pI=new S,mI=new S,gI=new S;let pr=class Jg{constructor(e=new S,t=new S,i=new S){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),vl.subVectors(e,t),n.cross(vl);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){vl.subVectors(n,t),ah.subVectors(i,t),fI.subVectors(e,t);const o=vl.dot(vl),a=vl.dot(ah),l=vl.dot(fI),c=ah.dot(ah),h=ah.dot(fI),u=o*c-a*a;if(u===0)return r.set(0,0,0),null;const f=1/u,p=(c*l-a*h)*f,m=(o*h-a*l)*f;return r.set(1-p-m,m,p)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,lh)===null?!1:lh.x>=0&&lh.y>=0&&lh.x+lh.y<=1}static getInterpolation(e,t,i,n,r,o,a,l){return this.getBarycoord(e,t,i,n,lh)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,lh.x),l.addScaledVector(o,lh.y),l.addScaledVector(a,lh.z),l)}static isFrontFacing(e,t,i,n){return vl.subVectors(i,t),ah.subVectors(e,t),vl.cross(ah).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vl.subVectors(this.c,this.b),ah.subVectors(this.a,this.b),vl.cross(ah).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Jg.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Jg.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,n,r){return Jg.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return Jg.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Jg.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,r=this.c;let o,a;Ym.subVectors(n,i),Km.subVectors(r,i),pI.subVectors(e,i);const l=Ym.dot(pI),c=Km.dot(pI);if(l<=0&&c<=0)return t.copy(i);mI.subVectors(e,n);const h=Ym.dot(mI),u=Km.dot(mI);if(h>=0&&u<=h)return t.copy(n);const f=l*u-h*c;if(f<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(Ym,o);gI.subVectors(e,r);const p=Ym.dot(gI),m=Km.dot(gI);if(m>=0&&p<=m)return t.copy(r);const v=p*c-l*m;if(v<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(i).addScaledVector(Km,a);const g=h*m-p*u;if(g<=0&&u-h>=0&&p-m>=0)return t3.subVectors(r,n),a=(u-h)/(u-h+(p-m)),t.copy(n).addScaledVector(t3,a);const y=1/(g+v+f);return o=v*y,a=f*y,t.copy(i).addScaledVector(Ym,o).addScaledVector(Km,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const E8={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Iu={h:0,s:0,l:0},Zx={h:0,s:0,l:0};function yI(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}let Ae=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=bt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ci.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=Ci.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ci.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=Ci.workingColorSpace){if(e=HO(e,1),t=zn(t,0,1),i=zn(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=yI(o,r,e+1/3),this.g=yI(o,r,e),this.b=yI(o,r,e-1/3)}return Ci.toWorkingColorSpace(this,n),this}setStyle(e,t=bt){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=n[1],a=n[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=n[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=bt){const i=E8[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ry(e.r),this.g=Ry(e.g),this.b=Ry(e.b),this}copyLinearToSRGB(e){return this.r=nI(e.r),this.g=nI(e.g),this.b=nI(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=bt){return Ci.fromWorkingColorSpace(Tr.copy(this),e),Math.round(zn(Tr.r*255,0,255))*65536+Math.round(zn(Tr.g*255,0,255))*256+Math.round(zn(Tr.b*255,0,255))}getHexString(e=bt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ci.workingColorSpace){Ci.fromWorkingColorSpace(Tr.copy(this),t);const i=Tr.r,n=Tr.g,r=Tr.b,o=Math.max(i,n,r),a=Math.min(i,n,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=h<=.5?u/(o+a):u/(2-o-a),o){case i:l=(n-r)/u+(n<r?6:0);break;case n:l=(r-i)/u+2;break;case r:l=(i-n)/u+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=Ci.workingColorSpace){return Ci.fromWorkingColorSpace(Tr.copy(this),t),e.r=Tr.r,e.g=Tr.g,e.b=Tr.b,e}getStyle(e=bt){Ci.fromWorkingColorSpace(Tr.copy(this),e);const t=Tr.r,i=Tr.g,n=Tr.b;return e!==bt?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(e,t,i){return this.getHSL(Iu),this.setHSL(Iu.h+e,Iu.s+t,Iu.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Iu),e.getHSL(Zx);const i=HA(Iu.h,Zx.h,t),n=HA(Iu.s,Zx.s,t),r=HA(Iu.l,Zx.l,t);return this.setHSL(i,n,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,n=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*n,this.g=r[1]*t+r[4]*i+r[7]*n,this.b=r[2]*t+r[5]*i+r[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Tr=new Ae;Ae.NAMES=E8;let IY=0,Ht=class extends js{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:IY++}),this.uuid=pa(),this.name="",this.type="Material",this.blending=Cd,this.side=$n,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=R1,this.blendDst=P1,this.blendEquation=ud,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ae(0,0,0),this.blendAlpha=0,this.depthFunc=Kp,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=O1,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=sd,this.stencilZFail=sd,this.stencilZPass=sd,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];if(n===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Cd&&(i.blending=this.blending),this.side!==$n&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==R1&&(i.blendSrc=this.blendSrc),this.blendDst!==P1&&(i.blendDst=this.blendDst),this.blendEquation!==ud&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Kp&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==O1&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==sd&&(i.stencilFail=this.stencilFail),this.stencilZFail!==sd&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==sd&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=n(e.textures),o=n(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const n=t.length;i=new Array(n);for(let r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},ti=class extends Ht{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ae(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new li,this.combine=xb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}};const zh=RY();function RY(){const s=new ArrayBuffer(4),e=new Float32Array(s),t=new Uint32Array(s),i=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,n[l]=24,n[l|256]=24):(i[l]=31744,i[l|256]=64512,n[l]=13,n[l|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(c&8388608);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,r[l]=c|h}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:n,mantissaTable:r,exponentTable:o,offsetTable:a}}function Co(s){Math.abs(s)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),s=zn(s,-65504,65504),zh.floatView[0]=s;const e=zh.uint32View[0],t=e>>23&511;return zh.baseTable[t]+((e&8388607)>>zh.shiftTable[t])}function pA(s){const e=s>>10;return zh.uint32View[0]=zh.mantissaTable[zh.offsetTable[e]+(s&1023)]+zh.exponentTable[e],zh.floatView[0]}const bp={toHalfFloat:Co,fromHalfFloat:pA},ts=new S,$x=new ee;let Ke=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=T_,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=tn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return b8("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)$x.fromBufferAttribute(this,t),$x.applyMatrix3(e),this.setXY(t,$x.x,$x.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)ts.fromBufferAttribute(this,t),ts.applyMatrix3(e),this.setXYZ(t,ts.x,ts.y,ts.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ts.fromBufferAttribute(this,t),ts.applyMatrix4(e),this.setXYZ(t,ts.x,ts.y,ts.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ts.fromBufferAttribute(this,t),ts.applyNormalMatrix(e),this.setXYZ(t,ts.x,ts.y,ts.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ts.fromBufferAttribute(this,t),ts.transformDirection(e),this.setXYZ(t,ts.x,ts.y,ts.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=ho(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Jt(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ho(t,this.array)),t}setX(e,t){return this.normalized&&(t=Jt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ho(t,this.array)),t}setY(e,t){return this.normalized&&(t=Jt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ho(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Jt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ho(t,this.array)),t}setW(e,t){return this.normalized&&(t=Jt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Jt(t,this.array),i=Jt(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=Jt(t,this.array),i=Jt(i,this.array),n=Jt(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=Jt(t,this.array),i=Jt(i,this.array),n=Jt(n,this.array),r=Jt(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==T_&&(e.usage=this.usage),e}};class PY extends Ke{constructor(e,t,i){super(new Int8Array(e),t,i)}}class BY extends Ke{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class DY extends Ke{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class OY extends Ke{constructor(e,t,i){super(new Int16Array(e),t,i)}}let ZE=class extends Ke{constructor(e,t,i){super(new Uint16Array(e),t,i)}};class LY extends Ke{constructor(e,t,i){super(new Int32Array(e),t,i)}}let WO=class extends Ke{constructor(e,t,i){super(new Uint32Array(e),t,i)}};class kY extends Ke{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=pA(this.array[e*this.itemSize]);return this.normalized&&(t=ho(t,this.array)),t}setX(e,t){return this.normalized&&(t=Jt(t,this.array)),this.array[e*this.itemSize]=Co(t),this}getY(e){let t=pA(this.array[e*this.itemSize+1]);return this.normalized&&(t=ho(t,this.array)),t}setY(e,t){return this.normalized&&(t=Jt(t,this.array)),this.array[e*this.itemSize+1]=Co(t),this}getZ(e){let t=pA(this.array[e*this.itemSize+2]);return this.normalized&&(t=ho(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Jt(t,this.array)),this.array[e*this.itemSize+2]=Co(t),this}getW(e){let t=pA(this.array[e*this.itemSize+3]);return this.normalized&&(t=ho(t,this.array)),t}setW(e,t){return this.normalized&&(t=Jt(t,this.array)),this.array[e*this.itemSize+3]=Co(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Jt(t,this.array),i=Jt(i,this.array)),this.array[e+0]=Co(t),this.array[e+1]=Co(i),this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=Jt(t,this.array),i=Jt(i,this.array),n=Jt(n,this.array)),this.array[e+0]=Co(t),this.array[e+1]=Co(i),this.array[e+2]=Co(n),this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=Jt(t,this.array),i=Jt(i,this.array),n=Jt(n,this.array),r=Jt(r,this.array)),this.array[e+0]=Co(t),this.array[e+1]=Co(i),this.array[e+2]=Co(n),this.array[e+3]=Co(r),this}}let rt=class extends Ke{constructor(e,t,i){super(new Float32Array(e),t,i)}},FY=0;const Pa=new le,vI=new ye,Jm=new S,Yo=new jt,f0=new jt,Ps=new S;let yt=class M8 extends js{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:FY++}),this.uuid=pa(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(A8(e)?WO:ZE)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Ut().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Pa.makeRotationFromQuaternion(e),this.applyMatrix4(Pa),this}rotateX(e){return Pa.makeRotationX(e),this.applyMatrix4(Pa),this}rotateY(e){return Pa.makeRotationY(e),this.applyMatrix4(Pa),this}rotateZ(e){return Pa.makeRotationZ(e),this.applyMatrix4(Pa),this}translate(e,t,i){return Pa.makeTranslation(e,t,i),this.applyMatrix4(Pa),this}scale(e,t,i){return Pa.makeScale(e,t,i),this.applyMatrix4(Pa),this}lookAt(e){return vI.lookAt(e),vI.updateMatrix(),this.applyMatrix4(vI.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Jm).negate(),this.translate(Jm.x,Jm.y,Jm.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new rt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new jt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new S(-1/0,-1/0,-1/0),new S(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){const r=t[i];Yo.setFromBufferAttribute(r),this.morphTargetsRelative?(Ps.addVectors(this.boundingBox.min,Yo.min),this.boundingBox.expandByPoint(Ps),Ps.addVectors(this.boundingBox.max,Yo.max),this.boundingBox.expandByPoint(Ps)):(this.boundingBox.expandByPoint(Yo.min),this.boundingBox.expandByPoint(Yo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ln);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new S,1/0);return}if(e){const i=this.boundingSphere.center;if(Yo.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];f0.setFromBufferAttribute(a),this.morphTargetsRelative?(Ps.addVectors(Yo.min,f0.min),Yo.expandByPoint(Ps),Ps.addVectors(Yo.max,f0.max),Yo.expandByPoint(Ps)):(Yo.expandByPoint(f0.min),Yo.expandByPoint(f0.max))}Yo.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)Ps.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(Ps));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Ps.fromBufferAttribute(a,c),l&&(Jm.fromBufferAttribute(e,c),Ps.add(Jm)),n=Math.max(n,i.distanceToSquared(Ps))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,n=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ke(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let T=0;T<i.count;T++)a[T]=new S,l[T]=new S;const c=new S,h=new S,u=new S,f=new ee,p=new ee,m=new ee,v=new S,g=new S;function y(T,R,w){c.fromBufferAttribute(i,T),h.fromBufferAttribute(i,R),u.fromBufferAttribute(i,w),f.fromBufferAttribute(r,T),p.fromBufferAttribute(r,R),m.fromBufferAttribute(r,w),h.sub(c),u.sub(c),p.sub(f),m.sub(f);const I=1/(p.x*m.y-m.x*p.y);isFinite(I)&&(v.copy(h).multiplyScalar(m.y).addScaledVector(u,-p.y).multiplyScalar(I),g.copy(u).multiplyScalar(p.x).addScaledVector(h,-m.x).multiplyScalar(I),a[T].add(v),a[R].add(v),a[w].add(v),l[T].add(g),l[R].add(g),l[w].add(g))}let A=this.groups;A.length===0&&(A=[{start:0,count:e.count}]);for(let T=0,R=A.length;T<R;++T){const w=A[T],I=w.start,O=w.count;for(let k=I,B=I+O;k<B;k+=3)y(e.getX(k+0),e.getX(k+1),e.getX(k+2))}const _=new S,b=new S,x=new S,E=new S;function M(T){x.fromBufferAttribute(n,T),E.copy(x);const R=a[T];_.copy(R),_.sub(x.multiplyScalar(x.dot(R))).normalize(),b.crossVectors(E,R);const I=b.dot(l[T])<0?-1:1;o.setXYZW(T,_.x,_.y,_.z,I)}for(let T=0,R=A.length;T<R;++T){const w=A[T],I=w.start,O=w.count;for(let k=I,B=I+O;k<B;k+=3)M(e.getX(k+0)),M(e.getX(k+1)),M(e.getX(k+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ke(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let f=0,p=i.count;f<p;f++)i.setXYZ(f,0,0,0);const n=new S,r=new S,o=new S,a=new S,l=new S,c=new S,h=new S,u=new S;if(e)for(let f=0,p=e.count;f<p;f+=3){const m=e.getX(f+0),v=e.getX(f+1),g=e.getX(f+2);n.fromBufferAttribute(t,m),r.fromBufferAttribute(t,v),o.fromBufferAttribute(t,g),h.subVectors(o,r),u.subVectors(n,r),h.cross(u),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,v),c.fromBufferAttribute(i,g),a.add(h),l.add(h),c.add(h),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(v,l.x,l.y,l.z),i.setXYZ(g,c.x,c.y,c.z)}else for(let f=0,p=t.count;f<p;f+=3)n.fromBufferAttribute(t,f+0),r.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),h.subVectors(o,r),u.subVectors(n,r),h.cross(u),i.setXYZ(f+0,h.x,h.y,h.z),i.setXYZ(f+1,h.x,h.y,h.z),i.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Ps.fromBufferAttribute(e,t),Ps.normalize(),e.setXYZ(t,Ps.x,Ps.y,Ps.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,u=a.normalized,f=new c.constructor(l.length*h);let p=0,m=0;for(let v=0,g=l.length;v<g;v++){a.isInterleavedBufferAttribute?p=l[v]*a.data.stride+a.offset:p=l[v]*h;for(let y=0;y<h;y++)f[m++]=c[p++]}return new Ke(f,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new M8,i=this.index.array,n=this.attributes;for(const a in n){const l=n[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,u=c.length;h<u;h++){const f=c[h],p=e(f,i);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,f=c.length;u<f;u++){const p=c[u];h.push(p.toJSON(e.data))}h.length>0&&(n[l]=h,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const n=e.attributes;for(const c in n){const h=n[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],u=r[c];for(let f=0,p=u.length;f<p;f++)h.push(u[f].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const i3=new le,Tf=new _o,ew=new ln,n3=new S,Zm=new S,$m=new S,eg=new S,AI=new S,tw=new S,iw=new ee,nw=new ee,sw=new ee,s3=new S,r3=new S,o3=new S,rw=new S,ow=new S;let fe=class extends ye{constructor(e=new yt,t=new ti){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(n,e);const a=this.morphTargetInfluences;if(r&&a){tw.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],u=r[l];h!==0&&(AI.fromBufferAttribute(u,e),o?tw.addScaledVector(AI,h):tw.addScaledVector(AI.sub(t),h))}t.add(tw)}return t}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),ew.copy(i.boundingSphere),ew.applyMatrix4(r),Tf.copy(e.ray).recast(e.near),!(ew.containsPoint(Tf.origin)===!1&&(Tf.intersectSphere(ew,n3)===null||Tf.origin.distanceToSquared(n3)>(e.far-e.near)**2))&&(i3.copy(r).invert(),Tf.copy(e.ray).applyMatrix4(i3),!(i.boundingBox!==null&&Tf.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Tf)))}_computeIntersections(e,t,i){let n;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,u=r.attributes.normal,f=r.groups,p=r.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,v=f.length;m<v;m++){const g=f[m],y=o[g.materialIndex],A=Math.max(g.start,p.start),_=Math.min(a.count,Math.min(g.start+g.count,p.start+p.count));for(let b=A,x=_;b<x;b+=3){const E=a.getX(b),M=a.getX(b+1),T=a.getX(b+2);n=aw(this,y,e,i,c,h,u,E,M,T),n&&(n.faceIndex=Math.floor(b/3),n.face.materialIndex=g.materialIndex,t.push(n))}}else{const m=Math.max(0,p.start),v=Math.min(a.count,p.start+p.count);for(let g=m,y=v;g<y;g+=3){const A=a.getX(g),_=a.getX(g+1),b=a.getX(g+2);n=aw(this,o,e,i,c,h,u,A,_,b),n&&(n.faceIndex=Math.floor(g/3),t.push(n))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,v=f.length;m<v;m++){const g=f[m],y=o[g.materialIndex],A=Math.max(g.start,p.start),_=Math.min(l.count,Math.min(g.start+g.count,p.start+p.count));for(let b=A,x=_;b<x;b+=3){const E=b,M=b+1,T=b+2;n=aw(this,y,e,i,c,h,u,E,M,T),n&&(n.faceIndex=Math.floor(b/3),n.face.materialIndex=g.materialIndex,t.push(n))}}else{const m=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let g=m,y=v;g<y;g+=3){const A=g,_=g+1,b=g+2;n=aw(this,o,e,i,c,h,u,A,_,b),n&&(n.faceIndex=Math.floor(g/3),t.push(n))}}}};function UY(s,e,t,i,n,r,o,a){let l;if(e.side===bn?l=i.intersectTriangle(o,r,n,!0,a):l=i.intersectTriangle(n,r,o,e.side===$n,a),l===null)return null;ow.copy(a),ow.applyMatrix4(s.matrixWorld);const c=t.ray.origin.distanceTo(ow);return c<t.near||c>t.far?null:{distance:c,point:ow.clone(),object:s}}function aw(s,e,t,i,n,r,o,a,l,c){s.getVertexPosition(a,Zm),s.getVertexPosition(l,$m),s.getVertexPosition(c,eg);const h=UY(s,e,t,i,Zm,$m,eg,rw);if(h){n&&(iw.fromBufferAttribute(n,a),nw.fromBufferAttribute(n,l),sw.fromBufferAttribute(n,c),h.uv=pr.getInterpolation(rw,Zm,$m,eg,iw,nw,sw,new ee)),r&&(iw.fromBufferAttribute(r,a),nw.fromBufferAttribute(r,l),sw.fromBufferAttribute(r,c),h.uv1=pr.getInterpolation(rw,Zm,$m,eg,iw,nw,sw,new ee)),o&&(s3.fromBufferAttribute(o,a),r3.fromBufferAttribute(o,l),o3.fromBufferAttribute(o,c),h.normal=pr.getInterpolation(rw,Zm,$m,eg,s3,r3,o3,new S),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const u={a,b:l,c,normal:new S,materialIndex:0};pr.getNormal(Zm,$m,eg,u.normal),h.face=u}return h}class Ki extends yt{constructor(e=1,t=1,i=1,n=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o};const a=this;n=Math.floor(n),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],u=[];let f=0,p=0;m("z","y","x",-1,-1,i,t,e,o,r,0),m("z","y","x",1,-1,i,t,-e,o,r,1),m("x","z","y",1,1,e,i,t,n,o,2),m("x","z","y",1,-1,e,i,-t,n,o,3),m("x","y","z",1,-1,e,t,i,n,r,4),m("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(l),this.setAttribute("position",new rt(c,3)),this.setAttribute("normal",new rt(h,3)),this.setAttribute("uv",new rt(u,2));function m(v,g,y,A,_,b,x,E,M,T,R){const w=b/M,I=x/T,O=b/2,k=x/2,B=E/2,G=M+1,L=T+1;let U=0,z=0;const j=new S;for(let X=0;X<L;X++){const re=X*I-k;for(let ce=0;ce<G;ce++){const Me=ce*w-O;j[v]=Me*A,j[g]=re*_,j[y]=B,c.push(j.x,j.y,j.z),j[v]=0,j[g]=0,j[y]=E>0?1:-1,h.push(j.x,j.y,j.z),u.push(ce/M),u.push(1-X/T),U+=1}}for(let X=0;X<T;X++)for(let re=0;re<M;re++){const ce=f+re+G*X,Me=f+re+G*(X+1),se=f+(re+1)+G*(X+1),ve=f+(re+1)+G*X;l.push(ce,Me,ve),l.push(Me,se,ve),z+=6}a.addGroup(p,z,R),p+=z,f+=U}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ki(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Zy(s){const e={};for(const t in s){e[t]={};for(const i in s[t]){const n=s[t][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=n.clone():Array.isArray(n)?e[t][i]=n.slice():e[t][i]=n}}return e}function ro(s){const e={};for(let t=0;t<s.length;t++){const i=Zy(s[t]);for(const n in i)e[n]=i[n]}return e}function NY(s){const e=[];for(let t=0;t<s.length;t++)e.push(s[t].clone());return e}function T8(s){return s.getRenderTarget()===null?s.outputColorSpace:Ci.workingColorSpace}const vv={clone:Zy,merge:ro};var zY=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,GY=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class kt extends Ht{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=zY,this.fragmentShader=GY,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Zy(e.uniforms),this.uniformsGroups=NY(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const o=this.uniforms[n].value;o&&o.isTexture?t.uniforms[n]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[n]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[n]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[n]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[n]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[n]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[n]={type:"m4",value:o.toArray()}:t.uniforms[n]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}let Tb=class extends ye{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new le,this.projectionMatrix=new le,this.projectionMatrixInverse=new le,this.coordinateSystem=Sc}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Ru=new S,a3=new ee,l3=new ee;let Vt=class extends Tb{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Jy*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Bp*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Jy*2*Math.atan(Math.tan(Bp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Ru.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Ru.x,Ru.y).multiplyScalar(-e/Ru.z),Ru.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Ru.x,Ru.y).multiplyScalar(-e/Ru.z)}getViewSize(e,t){return this.getViewBounds(e,a3,l3),t.subVectors(l3,a3)}setViewOffset(e,t,i,n,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Bp*.5*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*n/l,t-=o.offsetY*i/c,n*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const tg=-90,ig=1;class jO extends ye{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new Vt(tg,ig,e,t);n.layers=this.layers,this.add(n);const r=new Vt(tg,ig,e,t);r.layers=this.layers,this.add(r);const o=new Vt(tg,ig,e,t);o.layers=this.layers,this.add(o);const a=new Vt(tg,ig,e,t);a.layers=this.layers,this.add(a);const l=new Vt(tg,ig,e,t);l.layers=this.layers,this.add(l);const c=new Vt(tg,ig,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,n,r,o,a,l]=t;for(const c of t)this.remove(c);if(e===Sc)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===I_)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,a,l,c,h]=this.children,u=e.getRenderTarget(),f=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const v=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,n),e.render(t,r),e.setRenderTarget(i,1,n),e.render(t,o),e.setRenderTarget(i,2,n),e.render(t,a),e.setRenderTarget(i,3,n),e.render(t,l),e.setRenderTarget(i,4,n),e.render(t,c),i.texture.generateMipmaps=v,e.setRenderTarget(i,5,n),e.render(t,h),e.setRenderTarget(u,f,p),e.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class Ib extends Wt{constructor(e,t,i,n,r,o,a,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:ru,super(e,t,i,n,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class qO extends $t{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];this.texture=new Ib(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Nt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Ki(5,5,5),r=new kt({name:"CubemapFromEquirect",uniforms:Zy(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:bn,blending:xn});r.uniforms.tEquirect.value=t;const o=new fe(n,r),a=t.minFilter;return t.minFilter===Do&&(t.minFilter=Nt),new jO(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,n){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,n);e.setRenderTarget(r)}}const _I=new S,HY=new S,VY=new Ut;let xs=class{constructor(e=new S(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=_I.subVectors(i,t).cross(HY.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(_I),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||VY.getNormalMatrix(e),n=this.coplanarPoint(_I).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const If=new ln,lw=new S;let $p=class{constructor(e=new xs,t=new xs,i=new xs,n=new xs,r=new xs,o=new xs){this.planes=[e,t,i,n,r,o]}set(e,t,i,n,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Sc){const i=this.planes,n=e.elements,r=n[0],o=n[1],a=n[2],l=n[3],c=n[4],h=n[5],u=n[6],f=n[7],p=n[8],m=n[9],v=n[10],g=n[11],y=n[12],A=n[13],_=n[14],b=n[15];if(i[0].setComponents(l-r,f-c,g-p,b-y).normalize(),i[1].setComponents(l+r,f+c,g+p,b+y).normalize(),i[2].setComponents(l+o,f+h,g+m,b+A).normalize(),i[3].setComponents(l-o,f-h,g-m,b-A).normalize(),i[4].setComponents(l-a,f-u,g-v,b-_).normalize(),t===Sc)i[5].setComponents(l+a,f+u,g+v,b+_).normalize();else if(t===I_)i[5].setComponents(a,u,v,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),If.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),If.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(If)}intersectsSprite(e){return If.center.set(0,0,0),If.radius=.7071067811865476,If.applyMatrix4(e.matrixWorld),this.intersectsSphere(If)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(lw.x=n.normal.x>0?e.max.x:e.min.x,lw.y=n.normal.y>0?e.max.y:e.min.y,lw.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(lw)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function I8(){let s=null,e=!1,t=null,i=null;function n(r,o){t(r,o),i=s.requestAnimationFrame(n)}return{start:function(){e!==!0&&t!==null&&(i=s.requestAnimationFrame(n),e=!0)},stop:function(){s.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){s=r}}}function QY(s,e){const t=e.isWebGL2,i=new WeakMap;function n(c,h){const u=c.array,f=c.usage,p=u.byteLength,m=s.createBuffer();s.bindBuffer(h,m),s.bufferData(h,u,f),c.onUploadCallback();let v;if(u instanceof Float32Array)v=s.FLOAT;else if(u instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)v=s.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=s.UNSIGNED_SHORT;else if(u instanceof Int16Array)v=s.SHORT;else if(u instanceof Uint32Array)v=s.UNSIGNED_INT;else if(u instanceof Int32Array)v=s.INT;else if(u instanceof Int8Array)v=s.BYTE;else if(u instanceof Uint8Array)v=s.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)v=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:m,type:v,bytesPerElement:u.BYTES_PER_ELEMENT,version:c.version,size:p}}function r(c,h,u){const f=h.array,p=h._updateRange,m=h.updateRanges;if(s.bindBuffer(u,c),p.count===-1&&m.length===0&&s.bufferSubData(u,0,f),m.length!==0){for(let v=0,g=m.length;v<g;v++){const y=m[v];t?s.bufferSubData(u,y.start*f.BYTES_PER_ELEMENT,f,y.start,y.count):s.bufferSubData(u,y.start*f.BYTES_PER_ELEMENT,f.subarray(y.start,y.start+y.count))}h.clearUpdateRanges()}p.count!==-1&&(t?s.bufferSubData(u,p.offset*f.BYTES_PER_ELEMENT,f,p.offset,p.count):s.bufferSubData(u,p.offset*f.BYTES_PER_ELEMENT,f.subarray(p.offset,p.offset+p.count)),p.count=-1),h.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const h=i.get(c);h&&(s.deleteBuffer(h.buffer),i.delete(c))}function l(c,h){if(c.isGLBufferAttribute){const f=i.get(c);(!f||f.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const u=i.get(c);if(u===void 0)i.set(c,n(c,h));else if(u.version<c.version){if(u.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(u.buffer,c,h),u.version=c.version}}return{get:o,remove:a,update:l}}class ps extends yt{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(n),c=a+1,h=l+1,u=e/a,f=t/l,p=[],m=[],v=[],g=[];for(let y=0;y<h;y++){const A=y*f-o;for(let _=0;_<c;_++){const b=_*u-r;m.push(b,-A,0),v.push(0,0,1),g.push(_/a),g.push(1-y/l)}}for(let y=0;y<l;y++)for(let A=0;A<a;A++){const _=A+c*y,b=A+c*(y+1),x=A+1+c*(y+1),E=A+1+c*y;p.push(_,b,E),p.push(b,x,E)}this.setIndex(p),this.setAttribute("position",new rt(m,3)),this.setAttribute("normal",new rt(v,3)),this.setAttribute("uv",new rt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ps(e.width,e.height,e.widthSegments,e.heightSegments)}}var WY=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,jY=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,qY=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,XY=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,YY=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,KY=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,JY=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ZY=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,$Y=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,eK=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,tK=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,iK=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,nK=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,sK=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,rK=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,oK=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,aK=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,lK=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,cK=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,hK=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,uK=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,dK=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,fK=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,pK=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,mK=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,gK=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,yK=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,vK=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,AK=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,_K=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,bK="gl_FragColor = linearToOutputTexel( gl_FragColor );",xK=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,wK=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,SK=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,CK=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,EK=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,MK=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,TK=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,IK=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,RK=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,PK=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,BK=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,DK=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,OK=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,LK=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,kK=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,FK=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,UK=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,NK=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,zK=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,GK=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,HK=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,VK=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,QK=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,WK=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,jK=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,qK=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,XK=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,YK=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,KK=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,JK=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,ZK=`#ifdef USE_MAP
#ifdef USE_MIPMAP_BIAS
    vec4 sampledDiffuseColor = texture2D( map, vMapUv, mipmapBias );
#else
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
#endif
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,$K=`#ifdef USE_MAP
	uniform sampler2D map;
        
#ifdef USE_MIPMAP_BIAS
    uniform float mipmapBias;
#endif
#endif`,eJ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,tJ=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,iJ=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,nJ=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,sJ=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,rJ=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,oJ=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,aJ=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,lJ=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,cJ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,hJ=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,uJ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,dJ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,fJ=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,pJ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,mJ=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,gJ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,yJ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,vJ=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,AJ=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,_J=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,bJ=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,xJ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,wJ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,SJ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,CJ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,EJ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,MJ=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,TJ=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,IJ=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,RJ=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,PJ=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,BJ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,DJ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,OJ=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,LJ=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,kJ=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,FJ=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,UJ=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	float startCompression = 0.8 - 0.04;
	float desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min(color.r, min(color.g, color.b));
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) return color;
	float d = 1. - startCompression;
	float newPeak = 1. - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	float g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);
	return mix(color, vec3(1, 1, 1), g);
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,NJ=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,zJ=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,GJ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,HJ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,VJ=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,QJ=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const WJ=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,jJ=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,qJ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,XJ=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,YJ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,KJ=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,JJ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,ZJ=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,$J=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,eZ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,tZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,iZ=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,nZ=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sZ=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,rZ=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,oZ=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,aZ=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lZ=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cZ=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,hZ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uZ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,dZ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,fZ=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pZ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mZ=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,gZ=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yZ=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vZ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AZ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,_Z=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,bZ=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xZ=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,wZ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,SZ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,It={alphahash_fragment:WY,alphahash_pars_fragment:jY,alphamap_fragment:qY,alphamap_pars_fragment:XY,alphatest_fragment:YY,alphatest_pars_fragment:KY,aomap_fragment:JY,aomap_pars_fragment:ZY,batching_pars_vertex:$Y,batching_vertex:eK,begin_vertex:tK,beginnormal_vertex:iK,bsdfs:nK,iridescence_fragment:sK,bumpmap_pars_fragment:rK,clipping_planes_fragment:oK,clipping_planes_pars_fragment:aK,clipping_planes_pars_vertex:lK,clipping_planes_vertex:cK,color_fragment:hK,color_pars_fragment:uK,color_pars_vertex:dK,color_vertex:fK,common:pK,cube_uv_reflection_fragment:mK,defaultnormal_vertex:gK,displacementmap_pars_vertex:yK,displacementmap_vertex:vK,emissivemap_fragment:AK,emissivemap_pars_fragment:_K,colorspace_fragment:bK,colorspace_pars_fragment:xK,envmap_fragment:wK,envmap_common_pars_fragment:SK,envmap_pars_fragment:CK,envmap_pars_vertex:EK,envmap_physical_pars_fragment:UK,envmap_vertex:MK,fog_vertex:TK,fog_pars_vertex:IK,fog_fragment:RK,fog_pars_fragment:PK,gradientmap_pars_fragment:BK,lightmap_fragment:DK,lightmap_pars_fragment:OK,lights_lambert_fragment:LK,lights_lambert_pars_fragment:kK,lights_pars_begin:FK,lights_toon_fragment:NK,lights_toon_pars_fragment:zK,lights_phong_fragment:GK,lights_phong_pars_fragment:HK,lights_physical_fragment:VK,lights_physical_pars_fragment:QK,lights_fragment_begin:WK,lights_fragment_maps:jK,lights_fragment_end:qK,logdepthbuf_fragment:XK,logdepthbuf_pars_fragment:YK,logdepthbuf_pars_vertex:KK,logdepthbuf_vertex:JK,map_fragment:ZK,map_pars_fragment:$K,map_particle_fragment:eJ,map_particle_pars_fragment:tJ,metalnessmap_fragment:iJ,metalnessmap_pars_fragment:nJ,morphinstance_vertex:sJ,morphcolor_vertex:rJ,morphnormal_vertex:oJ,morphtarget_pars_vertex:aJ,morphtarget_vertex:lJ,normal_fragment_begin:cJ,normal_fragment_maps:hJ,normal_pars_fragment:uJ,normal_pars_vertex:dJ,normal_vertex:fJ,normalmap_pars_fragment:pJ,clearcoat_normal_fragment_begin:mJ,clearcoat_normal_fragment_maps:gJ,clearcoat_pars_fragment:yJ,iridescence_pars_fragment:vJ,opaque_fragment:AJ,packing:_J,premultiplied_alpha_fragment:bJ,project_vertex:xJ,dithering_fragment:wJ,dithering_pars_fragment:SJ,roughnessmap_fragment:CJ,roughnessmap_pars_fragment:EJ,shadowmap_pars_fragment:MJ,shadowmap_pars_vertex:TJ,shadowmap_vertex:IJ,shadowmask_pars_fragment:RJ,skinbase_vertex:PJ,skinning_pars_vertex:BJ,skinning_vertex:DJ,skinnormal_vertex:OJ,specularmap_fragment:LJ,specularmap_pars_fragment:kJ,tonemapping_fragment:FJ,tonemapping_pars_fragment:UJ,transmission_fragment:NJ,transmission_pars_fragment:zJ,uv_pars_fragment:GJ,uv_pars_vertex:HJ,uv_vertex:VJ,worldpos_vertex:QJ,background_vert:WJ,background_frag:jJ,backgroundCube_vert:qJ,backgroundCube_frag:XJ,cube_vert:YJ,cube_frag:KJ,depth_vert:JJ,depth_frag:ZJ,distanceRGBA_vert:$J,distanceRGBA_frag:eZ,equirect_vert:tZ,equirect_frag:iZ,linedashed_vert:nZ,linedashed_frag:sZ,meshbasic_vert:rZ,meshbasic_frag:oZ,meshlambert_vert:aZ,meshlambert_frag:lZ,meshmatcap_vert:cZ,meshmatcap_frag:hZ,meshnormal_vert:uZ,meshnormal_frag:dZ,meshphong_vert:fZ,meshphong_frag:pZ,meshphysical_vert:mZ,meshphysical_frag:gZ,meshtoon_vert:yZ,meshtoon_frag:vZ,points_vert:AZ,points_frag:_Z,shadow_vert:bZ,shadow_frag:xZ,sprite_vert:wZ,sprite_frag:SZ},ze={common:{diffuse:{value:new Ae(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ut},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ut}},envmap:{envMap:{value:null},envMapRotation:{value:new Ut},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ut}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ut}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ut},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ut},normalScale:{value:new ee(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ut},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ut}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ut}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ut}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ae(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ae(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0},uvTransform:{value:new Ut}},sprite:{diffuse:{value:new Ae(16777215)},opacity:{value:1},center:{value:new ee(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ut},alphaMap:{value:null},alphaMapTransform:{value:new Ut},alphaTest:{value:0}}},ur={basic:{uniforms:ro([ze.common,ze.specularmap,ze.envmap,ze.aomap,ze.lightmap,ze.fog]),vertexShader:It.meshbasic_vert,fragmentShader:It.meshbasic_frag},lambert:{uniforms:ro([ze.common,ze.specularmap,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.fog,ze.lights,{emissive:{value:new Ae(0)}}]),vertexShader:It.meshlambert_vert,fragmentShader:It.meshlambert_frag},phong:{uniforms:ro([ze.common,ze.specularmap,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.fog,ze.lights,{emissive:{value:new Ae(0)},specular:{value:new Ae(1118481)},shininess:{value:30}}]),vertexShader:It.meshphong_vert,fragmentShader:It.meshphong_frag},standard:{uniforms:ro([ze.common,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.roughnessmap,ze.metalnessmap,ze.fog,ze.lights,{emissive:{value:new Ae(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:It.meshphysical_vert,fragmentShader:It.meshphysical_frag},toon:{uniforms:ro([ze.common,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.gradientmap,ze.fog,ze.lights,{emissive:{value:new Ae(0)}}]),vertexShader:It.meshtoon_vert,fragmentShader:It.meshtoon_frag},matcap:{uniforms:ro([ze.common,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.fog,{matcap:{value:null}}]),vertexShader:It.meshmatcap_vert,fragmentShader:It.meshmatcap_frag},points:{uniforms:ro([ze.points,ze.fog]),vertexShader:It.points_vert,fragmentShader:It.points_frag},dashed:{uniforms:ro([ze.common,ze.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:It.linedashed_vert,fragmentShader:It.linedashed_frag},depth:{uniforms:ro([ze.common,ze.displacementmap]),vertexShader:It.depth_vert,fragmentShader:It.depth_frag},normal:{uniforms:ro([ze.common,ze.bumpmap,ze.normalmap,ze.displacementmap,{opacity:{value:1}}]),vertexShader:It.meshnormal_vert,fragmentShader:It.meshnormal_frag},sprite:{uniforms:ro([ze.sprite,ze.fog]),vertexShader:It.sprite_vert,fragmentShader:It.sprite_frag},background:{uniforms:{uvTransform:{value:new Ut},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:It.background_vert,fragmentShader:It.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ut}},vertexShader:It.backgroundCube_vert,fragmentShader:It.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:It.cube_vert,fragmentShader:It.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:It.equirect_vert,fragmentShader:It.equirect_frag},distanceRGBA:{uniforms:ro([ze.common,ze.displacementmap,{referencePosition:{value:new S},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:It.distanceRGBA_vert,fragmentShader:It.distanceRGBA_frag},shadow:{uniforms:ro([ze.lights,ze.fog,{color:{value:new Ae(0)},opacity:{value:1}}]),vertexShader:It.shadow_vert,fragmentShader:It.shadow_frag}};ur.physical={uniforms:ro([ur.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ut},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ut},clearcoatNormalScale:{value:new ee(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ut},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ut},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ut},sheen:{value:0},sheenColor:{value:new Ae(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ut},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ut},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ut},transmissionSamplerSize:{value:new ee},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ut},attenuationDistance:{value:0},attenuationColor:{value:new Ae(0)},specularColor:{value:new Ae(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ut},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ut},anisotropyVector:{value:new ee},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ut}}]),vertexShader:It.meshphysical_vert,fragmentShader:It.meshphysical_frag};const cw={r:0,b:0,g:0},Rf=new li,CZ=new le;function EZ(s,e,t,i,n,r,o){const a=new Ae(0);let l=r===!0?0:1,c,h,u=null,f=0,p=null;function m(g,y){let A=!1,_=y.isScene===!0?y.background:null;_&&_.isTexture&&(_=(y.backgroundBlurriness>0?t:e).get(_)),_===null?v(a,l):_&&_.isColor&&(v(_,1),A=!0);const b=s.xr.getEnvironmentBlendMode();b==="additive"?i.buffers.color.setClear(0,0,0,1,o):b==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(s.autoClear||A)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),_&&(_.isCubeTexture||_.mapping===yv)?(h===void 0&&(h=new fe(new Ki(1,1,1),new kt({name:"BackgroundCubeMaterial",uniforms:Zy(ur.backgroundCube.uniforms),vertexShader:ur.backgroundCube.vertexShader,fragmentShader:ur.backgroundCube.fragmentShader,side:bn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(x,E,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),Rf.copy(y.backgroundRotation),Rf.x*=-1,Rf.y*=-1,Rf.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&(Rf.y*=-1,Rf.z*=-1),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(CZ.makeRotationFromEuler(Rf)),h.material.toneMapped=Ci.getTransfer(_.colorSpace)!==Yi,(u!==_||f!==_.version||p!==s.toneMapping)&&(h.material.needsUpdate=!0,u=_,f=_.version,p=s.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(c===void 0&&(c=new fe(new ps(2,2),new kt({name:"BackgroundMaterial",uniforms:Zy(ur.background.uniforms),vertexShader:ur.background.vertexShader,fragmentShader:ur.background.fragmentShader,side:$n,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=_,c.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,c.material.toneMapped=Ci.getTransfer(_.colorSpace)!==Yi,_.matrixAutoUpdate===!0&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(u!==_||f!==_.version||p!==s.toneMapping)&&(c.material.needsUpdate=!0,u=_,f=_.version,p=s.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function v(g,y){g.getRGB(cw,T8(s)),i.buffers.color.setClear(cw.r,cw.g,cw.b,y,o)}return{getClearColor:function(){return a},setClearColor:function(g,y=1){a.set(g),l=y,v(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,v(a,l)},render:m}}function MZ(s,e,t,i){const n=s.getParameter(s.MAX_VERTEX_ATTRIBS),r=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||r!==null,a={},l=g(null);let c=l,h=!1;function u(B,G,L,U,z){let j=!1;if(o){const X=v(U,L,G);c!==X&&(c=X,p(c.object)),j=y(B,U,L,z),j&&A(B,U,L,z)}else{const X=G.wireframe===!0;(c.geometry!==U.id||c.program!==L.id||c.wireframe!==X)&&(c.geometry=U.id,c.program=L.id,c.wireframe=X,j=!0)}z!==null&&t.update(z,s.ELEMENT_ARRAY_BUFFER),(j||h)&&(h=!1,T(B,G,L,U),z!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t.get(z).buffer))}function f(){return i.isWebGL2?s.createVertexArray():r.createVertexArrayOES()}function p(B){return i.isWebGL2?s.bindVertexArray(B):r.bindVertexArrayOES(B)}function m(B){return i.isWebGL2?s.deleteVertexArray(B):r.deleteVertexArrayOES(B)}function v(B,G,L){const U=L.wireframe===!0;let z=a[B.id];z===void 0&&(z={},a[B.id]=z);let j=z[G.id];j===void 0&&(j={},z[G.id]=j);let X=j[U];return X===void 0&&(X=g(f()),j[U]=X),X}function g(B){const G=[],L=[],U=[];for(let z=0;z<n;z++)G[z]=0,L[z]=0,U[z]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:G,enabledAttributes:L,attributeDivisors:U,object:B,attributes:{},index:null}}function y(B,G,L,U){const z=c.attributes,j=G.attributes;let X=0;const re=L.getAttributes();for(const ce in re)if(re[ce].location>=0){const se=z[ce];let ve=j[ce];if(ve===void 0&&(ce==="instanceMatrix"&&B.instanceMatrix&&(ve=B.instanceMatrix),ce==="instanceColor"&&B.instanceColor&&(ve=B.instanceColor)),se===void 0||se.attribute!==ve||ve&&se.data!==ve.data)return!0;X++}return c.attributesNum!==X||c.index!==U}function A(B,G,L,U){const z={},j=G.attributes;let X=0;const re=L.getAttributes();for(const ce in re)if(re[ce].location>=0){let se=j[ce];se===void 0&&(ce==="instanceMatrix"&&B.instanceMatrix&&(se=B.instanceMatrix),ce==="instanceColor"&&B.instanceColor&&(se=B.instanceColor));const ve={};ve.attribute=se,se&&se.data&&(ve.data=se.data),z[ce]=ve,X++}c.attributes=z,c.attributesNum=X,c.index=U}function _(){const B=c.newAttributes;for(let G=0,L=B.length;G<L;G++)B[G]=0}function b(B){x(B,0)}function x(B,G){const L=c.newAttributes,U=c.enabledAttributes,z=c.attributeDivisors;L[B]=1,U[B]===0&&(s.enableVertexAttribArray(B),U[B]=1),z[B]!==G&&((i.isWebGL2?s:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](B,G),z[B]=G)}function E(){const B=c.newAttributes,G=c.enabledAttributes;for(let L=0,U=G.length;L<U;L++)G[L]!==B[L]&&(s.disableVertexAttribArray(L),G[L]=0)}function M(B,G,L,U,z,j,X){X===!0?s.vertexAttribIPointer(B,G,L,z,j):s.vertexAttribPointer(B,G,L,U,z,j)}function T(B,G,L,U){if(i.isWebGL2===!1&&(B.isInstancedMesh||U.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;_();const z=U.attributes,j=L.getAttributes(),X=G.defaultAttributeValues;for(const re in j){const ce=j[re];if(ce.location>=0){let Me=z[re];if(Me===void 0&&(re==="instanceMatrix"&&B.instanceMatrix&&(Me=B.instanceMatrix),re==="instanceColor"&&B.instanceColor&&(Me=B.instanceColor)),Me!==void 0){const se=Me.normalized,ve=Me.itemSize,xe=t.get(Me);if(xe===void 0)continue;const Fe=xe.buffer,Ge=xe.type,je=xe.bytesPerElement,lt=i.isWebGL2===!0&&(Ge===s.INT||Ge===s.UNSIGNED_INT||Me.gpuType===Pp);if(Me.isInterleavedBufferAttribute){const ot=Me.data,q=ot.stride,He=Me.offset;if(ot.isInstancedInterleavedBuffer){for(let we=0;we<ce.locationSize;we++)x(ce.location+we,ot.meshPerAttribute);B.isInstancedMesh!==!0&&U._maxInstanceCount===void 0&&(U._maxInstanceCount=ot.meshPerAttribute*ot.count)}else for(let we=0;we<ce.locationSize;we++)b(ce.location+we);s.bindBuffer(s.ARRAY_BUFFER,Fe);for(let we=0;we<ce.locationSize;we++)M(ce.location+we,ve/ce.locationSize,Ge,se,q*je,(He+ve/ce.locationSize*we)*je,lt)}else{if(Me.isInstancedBufferAttribute){for(let ot=0;ot<ce.locationSize;ot++)x(ce.location+ot,Me.meshPerAttribute);B.isInstancedMesh!==!0&&U._maxInstanceCount===void 0&&(U._maxInstanceCount=Me.meshPerAttribute*Me.count)}else for(let ot=0;ot<ce.locationSize;ot++)b(ce.location+ot);s.bindBuffer(s.ARRAY_BUFFER,Fe);for(let ot=0;ot<ce.locationSize;ot++)M(ce.location+ot,ve/ce.locationSize,Ge,se,ve*je,ve/ce.locationSize*ot*je,lt)}}else if(X!==void 0){const se=X[re];if(se!==void 0)switch(se.length){case 2:s.vertexAttrib2fv(ce.location,se);break;case 3:s.vertexAttrib3fv(ce.location,se);break;case 4:s.vertexAttrib4fv(ce.location,se);break;default:s.vertexAttrib1fv(ce.location,se)}}}}E()}function R(){O();for(const B in a){const G=a[B];for(const L in G){const U=G[L];for(const z in U)m(U[z].object),delete U[z];delete G[L]}delete a[B]}}function w(B){if(a[B.id]===void 0)return;const G=a[B.id];for(const L in G){const U=G[L];for(const z in U)m(U[z].object),delete U[z];delete G[L]}delete a[B.id]}function I(B){for(const G in a){const L=a[G];if(L[B.id]===void 0)continue;const U=L[B.id];for(const z in U)m(U[z].object),delete U[z];delete L[B.id]}}function O(){k(),h=!0,c!==l&&(c=l,p(c.object))}function k(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:O,resetDefaultState:k,dispose:R,releaseStatesOfGeometry:w,releaseStatesOfProgram:I,initAttributes:_,enableAttribute:b,disableUnusedAttributes:E}}function TZ(s,e,t,i){const n=i.isWebGL2;let r;function o(h){r=h}function a(h,u){s.drawArrays(r,h,u),t.update(u,r,1)}function l(h,u,f){if(f===0)return;let p,m;if(n)p=s,m="drawArraysInstanced";else if(p=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[m](r,h,u,f),t.update(u,r,f)}function c(h,u,f){if(f===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let m=0;m<f;m++)this.render(h[m],u[m]);else{p.multiDrawArraysWEBGL(r,h,0,u,0,f);let m=0;for(let v=0;v<f;v++)m+=u[v];t.update(m,r,1)}}this.setMode=o,this.render=a,this.renderInstances=l,this.renderMultiDraw=c}function IZ(s,e,t){let i;function n(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");i=s.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function r(M){if(M==="highp"){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&s.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),h=t.logarithmicDepthBuffer===!0,u=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),f=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=s.getParameter(s.MAX_TEXTURE_SIZE),m=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),v=s.getParameter(s.MAX_VERTEX_ATTRIBS),g=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),y=s.getParameter(s.MAX_VARYING_VECTORS),A=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),_=f>0,b=o||e.has("OES_texture_float"),x=_&&b,E=o?s.getParameter(s.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:f,maxTextureSize:p,maxCubemapSize:m,maxAttributes:v,maxVertexUniforms:g,maxVaryings:y,maxFragmentUniforms:A,vertexTextures:_,floatFragmentTextures:b,floatVertexTextures:x,maxSamples:E}}function RZ(s){const e=this;let t=null,i=0,n=!1,r=!1;const o=new xs,a=new Ut,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,f){const p=u.length!==0||f||i!==0||n;return n=f,i=u.length,p},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(u,f){t=h(u,f,0)},this.setState=function(u,f,p){const m=u.clippingPlanes,v=u.clipIntersection,g=u.clipShadows,y=s.get(u);if(!n||m===null||m.length===0||r&&!g)r?h(null):c();else{const A=r?0:i,_=A*4;let b=y.clippingState||null;l.value=b,b=h(m,f,_,p);for(let x=0;x!==_;++x)b[x]=t[x];y.clippingState=b,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=A}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(u,f,p,m){const v=u!==null?u.length:0;let g=null;if(v!==0){if(g=l.value,m!==!0||g===null){const y=p+v*4,A=f.matrixWorldInverse;a.getNormalMatrix(A),(g===null||g.length<y)&&(g=new Float32Array(y));for(let _=0,b=p;_!==v;++_,b+=4)o.copy(u[_]).applyMatrix4(A,a),o.normal.toArray(g,b),g[b+3]=o.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,g}}function PZ(s){let e=new WeakMap;function t(o,a){return a===mo?o.mapping=ru:a===Xy&&(o.mapping=zd),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===mo||a===Xy)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new qO(l.height);return c.fromEquirectangularTexture(s,o),e.set(o,c),o.addEventListener("dispose",n),t(c.texture,o.mapping)}else return null}}return o}function n(o){const a=o.target;a.removeEventListener("dispose",n);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}let Qc=class extends Tb{constructor(e=-1,t=1,i=1,n=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=n+t,l=n-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};const fy=4,c3=[.125,.215,.35,.446,.526,.582],up=20,bI=new Qc,h3=new Ae;let xI=null,wI=0,SI=0;const lp=(1+Math.sqrt(5))/2,ng=1/lp,u3=[new S(1,1,1),new S(-1,1,1),new S(1,1,-1),new S(-1,1,-1),new S(0,lp,ng),new S(0,lp,-ng),new S(ng,0,lp),new S(-ng,0,lp),new S(lp,ng,0),new S(-lp,ng,0)];class v2{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){xI=this._renderer.getRenderTarget(),wI=this._renderer.getActiveCubeFace(),SI=this._renderer.getActiveMipmapLevel(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=m3(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=p3(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(xI,wI,SI),e.scissorTest=!1,hw(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ru||e.mapping===zd?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),xI=this._renderer.getRenderTarget(),wI=this._renderer.getActiveCubeFace(),SI=this._renderer.getActiveMipmapLevel();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Nt,minFilter:Nt,generateMipmaps:!1,type:Cs,format:Li,colorSpace:zi,depthBuffer:!1},n=f3(e,t,i),{_lodMax:r}=this;if({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=d3(r),this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=f3(e,t,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=d3(o)),this._blurMaterial=BZ(o,e,t)}return n}_compileMaterial(e){const t=new fe(this._lodPlanes[0],e);this._renderer.compile(t,bI)}_sceneToCubeUV(e,t,i,n){const a=new Vt(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,u=h.autoClear,f=h.toneMapping;h.getClearColor(h3),h.toneMapping=po,h.autoClear=!1;const p=new ti({name:"PMREM.Background",side:bn,depthWrite:!1,depthTest:!1}),m=new fe(new Ki,p);let v=!1;const g=e.background;g?g.isColor&&(p.color.copy(g),e.background=null,v=!0):(p.color.copy(h3),v=!0);for(let y=0;y<6;y++){const A=y%3;A===0?(a.up.set(0,l[y],0),a.lookAt(c[y],0,0)):A===1?(a.up.set(0,0,l[y]),a.lookAt(0,c[y],0)):(a.up.set(0,l[y],0),a.lookAt(0,0,c[y]));const _=this._cubeSize;hw(n,A*_,y>2?_:0,_,_),h.setRenderTarget(n),v&&h.render(m,a),h.render(e,a)}m.geometry.dispose(),m.material.dispose(),h.toneMapping=f,h.autoClear=u,e.background=g}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===ru||e.mapping===zd;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=m3()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=p3());const r=n?this._cubemapMaterial:this._equirectMaterial,o=new fe(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;hw(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,bI)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const r=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),o=u3[(n-1)%u3.length];this._blur(e,n-1,n,r,o)}t.autoClear=i}_blur(e,t,i,n,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,n,"latitudinal",r),this._halfBlur(o,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,u=new fe(this._lodPlanes[n],c),f=c.uniforms,p=this._sizeLods[i]-1,m=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*up-1),v=r/m,g=isFinite(r)?1+Math.floor(h*v):up;g>up&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${up}`);const y=[];let A=0;for(let M=0;M<up;++M){const T=M/v,R=Math.exp(-T*T/2);y.push(R),M===0?A+=R:M<g&&(A+=2*R)}for(let M=0;M<y.length;M++)y[M]=y[M]/A;f.envMap.value=e.texture,f.samples.value=g,f.weights.value=y,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:_}=this;f.dTheta.value=m,f.mipInt.value=_-i;const b=this._sizeLods[n],x=3*b*(n>_-fy?n-_+fy:0),E=4*(this._cubeSize-b);hw(t,x,E,3*b,2*b),l.setRenderTarget(t),l.render(u,bI)}}function d3(s){const e=[],t=[],i=[];let n=s;const r=s-fy+1+c3.length;for(let o=0;o<r;o++){const a=Math.pow(2,n);t.push(a);let l=1/a;o>s-fy?l=c3[o-s+fy-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),h=-c,u=1+c,f=[h,h,u,h,u,u,h,h,u,u,h,u],p=6,m=6,v=3,g=2,y=1,A=new Float32Array(v*m*p),_=new Float32Array(g*m*p),b=new Float32Array(y*m*p);for(let E=0;E<p;E++){const M=E%3*2/3-1,T=E>2?0:-1,R=[M,T,0,M+2/3,T,0,M+2/3,T+1,0,M,T,0,M+2/3,T+1,0,M,T+1,0];A.set(R,v*m*E),_.set(f,g*m*E);const w=[E,E,E,E,E,E];b.set(w,y*m*E)}const x=new yt;x.setAttribute("position",new Ke(A,v)),x.setAttribute("uv",new Ke(_,g)),x.setAttribute("faceIndex",new Ke(b,y)),e.push(x),n>fy&&n--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function f3(s,e,t){const i=new $t(s,e,t);return i.texture.mapping=yv,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function hw(s,e,t,i,n){s.viewport.set(e,t,i,n),s.scissor.set(e,t,i,n)}function BZ(s,e,t){const i=new Float32Array(up),n=new S(0,1,0);return new kt({name:"SphericalGaussianBlur",defines:{n:up,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:XO(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:xn,depthTest:!1,depthWrite:!1})}function p3(){return new kt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:XO(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:xn,depthTest:!1,depthWrite:!1})}function m3(){return new kt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:XO(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:xn,depthTest:!1,depthWrite:!1})}function XO(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function DZ(s){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===mo||l===Xy,h=l===ru||l===zd;if(c||h)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let u=e.get(a);return t===null&&(t=new v2(s)),u=c?t.fromEquirectangular(a,u):t.fromCubemap(a,u),e.set(a,u),u.texture}else{if(e.has(a))return e.get(a).texture;{const u=a.image;if(c&&u&&u.height>0||h&&u&&n(u)){t=new v2(s);const f=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",r),f.texture}else return null}}}return a}function n(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function OZ(s){const e={};function t(i){if(e[i]!==void 0)return e[i];let n;switch(i){case"WEBGL_depth_texture":n=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=s.getExtension(i)}return e[i]=n,n}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const n=t(i);return n===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),n}}}function LZ(s,e,t,i){const n={},r=new WeakMap;function o(u){const f=u.target;f.index!==null&&e.remove(f.index);for(const m in f.attributes)e.remove(f.attributes[m]);for(const m in f.morphAttributes){const v=f.morphAttributes[m];for(let g=0,y=v.length;g<y;g++)e.remove(v[g])}f.removeEventListener("dispose",o),delete n[f.id];const p=r.get(f);p&&(e.remove(p),r.delete(f)),i.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(u,f){return n[f.id]===!0||(f.addEventListener("dispose",o),n[f.id]=!0,t.memory.geometries++),f}function l(u){const f=u.attributes;for(const m in f)e.update(f[m],s.ARRAY_BUFFER);const p=u.morphAttributes;for(const m in p){const v=p[m];for(let g=0,y=v.length;g<y;g++)e.update(v[g],s.ARRAY_BUFFER)}}function c(u){const f=[],p=u.index,m=u.attributes.position;let v=0;if(p!==null){const A=p.array;v=p.version;for(let _=0,b=A.length;_<b;_+=3){const x=A[_+0],E=A[_+1],M=A[_+2];f.push(x,E,E,M,M,x)}}else if(m!==void 0){const A=m.array;v=m.version;for(let _=0,b=A.length/3-1;_<b;_+=3){const x=_+0,E=_+1,M=_+2;f.push(x,E,E,M,M,x)}}else return;const g=new(A8(f)?WO:ZE)(f,1);g.version=v;const y=r.get(u);y&&e.remove(y),r.set(u,g)}function h(u){const f=r.get(u);if(f){const p=u.index;p!==null&&f.version<p.version&&c(u)}else c(u);return r.get(u)}return{get:a,update:l,getWireframeAttribute:h}}function kZ(s,e,t,i){const n=i.isWebGL2;let r;function o(p){r=p}let a,l;function c(p){a=p.type,l=p.bytesPerElement}function h(p,m){s.drawElements(r,m,a,p*l),t.update(m,r,1)}function u(p,m,v){if(v===0)return;let g,y;if(n)g=s,y="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[y](r,m,a,p*l,v),t.update(m,r,v)}function f(p,m,v){if(v===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let y=0;y<v;y++)this.render(p[y]/l,m[y]);else{g.multiDrawElementsWEBGL(r,m,0,a,p,0,v);let y=0;for(let A=0;A<v;A++)y+=m[A];t.update(y,r,1)}}this.setMode=o,this.setIndex=c,this.render=h,this.renderInstances=u,this.renderMultiDraw=f}function FZ(s){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(t.calls++,o){case s.TRIANGLES:t.triangles+=a*(r/3);break;case s.LINES:t.lines+=a*(r/2);break;case s.LINE_STRIP:t.lines+=a*(r-1);break;case s.LINE_LOOP:t.lines+=a*r;break;case s.POINTS:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function n(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:n,update:i}}function UZ(s,e){return s[0]-e[0]}function NZ(s,e){return Math.abs(e[1])-Math.abs(s[1])}function zZ(s,e,t){const i={},n=new Float32Array(8),r=new WeakMap,o=new Je,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,h,u){const f=c.morphTargetInfluences;if(e.isWebGL2===!0){const p=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,m=p!==void 0?p.length:0;let v=r.get(h);if(v===void 0||v.count!==m){let O=function(){w.dispose(),r.delete(h),h.removeEventListener("dispose",O)};v!==void 0&&v.texture.dispose();const g=h.morphAttributes.position!==void 0,y=h.morphAttributes.normal!==void 0,A=h.morphAttributes.color!==void 0,_=h.morphAttributes.position||[],b=h.morphAttributes.normal||[],x=h.morphAttributes.color||[];let E=0;g===!0&&(E=1),y===!0&&(E=2),A===!0&&(E=3);let M=h.attributes.position.count*E,T=1;M>e.maxTextureSize&&(T=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);const R=new Float32Array(M*T*4*m),w=new JE(R,M,T,m);w.type=tn,w.needsUpdate=!0;const I=E*4;for(let k=0;k<m;k++){const B=_[k],G=b[k],L=x[k],U=M*T*4*k;for(let z=0;z<B.count;z++){const j=z*I;g===!0&&(o.fromBufferAttribute(B,z),R[U+j+0]=o.x,R[U+j+1]=o.y,R[U+j+2]=o.z,R[U+j+3]=0),y===!0&&(o.fromBufferAttribute(G,z),R[U+j+4]=o.x,R[U+j+5]=o.y,R[U+j+6]=o.z,R[U+j+7]=0),A===!0&&(o.fromBufferAttribute(L,z),R[U+j+8]=o.x,R[U+j+9]=o.y,R[U+j+10]=o.z,R[U+j+11]=L.itemSize===4?o.w:1)}}v={count:m,texture:w,size:new ee(M,T)},r.set(h,v),h.addEventListener("dispose",O)}if(c.isInstancedMesh===!0&&c.morphTexture!==null)u.getUniforms().setValue(s,"morphTexture",c.morphTexture,t);else{let g=0;for(let A=0;A<f.length;A++)g+=f[A];const y=h.morphTargetsRelative?1:1-g;u.getUniforms().setValue(s,"morphTargetBaseInfluence",y),u.getUniforms().setValue(s,"morphTargetInfluences",f)}u.getUniforms().setValue(s,"morphTargetsTexture",v.texture,t),u.getUniforms().setValue(s,"morphTargetsTextureSize",v.size)}else{const p=f===void 0?0:f.length;let m=i[h.id];if(m===void 0||m.length!==p){m=[];for(let _=0;_<p;_++)m[_]=[_,0];i[h.id]=m}for(let _=0;_<p;_++){const b=m[_];b[0]=_,b[1]=f[_]}m.sort(NZ);for(let _=0;_<8;_++)_<p&&m[_][1]?(a[_][0]=m[_][0],a[_][1]=m[_][1]):(a[_][0]=Number.MAX_SAFE_INTEGER,a[_][1]=0);a.sort(UZ);const v=h.morphAttributes.position,g=h.morphAttributes.normal;let y=0;for(let _=0;_<8;_++){const b=a[_],x=b[0],E=b[1];x!==Number.MAX_SAFE_INTEGER&&E?(v&&h.getAttribute("morphTarget"+_)!==v[x]&&h.setAttribute("morphTarget"+_,v[x]),g&&h.getAttribute("morphNormal"+_)!==g[x]&&h.setAttribute("morphNormal"+_,g[x]),n[_]=E,y+=E):(v&&h.hasAttribute("morphTarget"+_)===!0&&h.deleteAttribute("morphTarget"+_),g&&h.hasAttribute("morphNormal"+_)===!0&&h.deleteAttribute("morphNormal"+_),n[_]=0)}const A=h.morphTargetsRelative?1:1-y;u.getUniforms().setValue(s,"morphTargetBaseInfluence",A),u.getUniforms().setValue(s,"morphTargetInfluences",n)}}return{update:l}}function GZ(s,e,t,i){let n=new WeakMap;function r(l){const c=i.render.frame,h=l.geometry,u=e.get(l,h);if(n.get(u)!==c&&(e.update(u),n.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),n.get(l)!==c&&(t.update(l.instanceMatrix,s.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,s.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const f=l.skeleton;n.get(f)!==c&&(f.update(),n.set(f,c))}return u}function o(){n=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:o}}class Av extends Wt{constructor(e,t,i,n,r,o,a,l,c,h){if(h=h!==void 0?h:Ed,h!==Ed&&h!==Gd)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===Ed&&(i=Hr),i===void 0&&h===Gd&&(i=Kh),super(null,n,r,o,a,l,h,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Ot,this.minFilter=l!==void 0?l:Ot,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const R8=new Wt,P8=new Av(1,1);P8.compareFunction=GO;const B8=new JE,D8=new QO,O8=new Ib,g3=[],y3=[],v3=new Float32Array(16),A3=new Float32Array(9),_3=new Float32Array(4);function _v(s,e,t){const i=s[0];if(i<=0||i>0)return s;const n=e*t;let r=g3[n];if(r===void 0&&(r=new Float32Array(n),g3[n]=r),e!==0){i.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,s[o].toArray(r,a)}return r}function Ts(s,e){if(s.length!==e.length)return!1;for(let t=0,i=s.length;t<i;t++)if(s[t]!==e[t])return!1;return!0}function Is(s,e){for(let t=0,i=e.length;t<i;t++)s[t]=e[t]}function $E(s,e){let t=y3[e];t===void 0&&(t=new Int32Array(e),y3[e]=t);for(let i=0;i!==e;++i)t[i]=s.allocateTextureUnit();return t}function HZ(s,e){const t=this.cache;t[0]!==e&&(s.uniform1f(this.addr,e),t[0]=e)}function VZ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ts(t,e))return;s.uniform2fv(this.addr,e),Is(t,e)}}function QZ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(s.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ts(t,e))return;s.uniform3fv(this.addr,e),Is(t,e)}}function WZ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ts(t,e))return;s.uniform4fv(this.addr,e),Is(t,e)}}function jZ(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ts(t,e))return;s.uniformMatrix2fv(this.addr,!1,e),Is(t,e)}else{if(Ts(t,i))return;_3.set(i),s.uniformMatrix2fv(this.addr,!1,_3),Is(t,i)}}function qZ(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ts(t,e))return;s.uniformMatrix3fv(this.addr,!1,e),Is(t,e)}else{if(Ts(t,i))return;A3.set(i),s.uniformMatrix3fv(this.addr,!1,A3),Is(t,i)}}function XZ(s,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ts(t,e))return;s.uniformMatrix4fv(this.addr,!1,e),Is(t,e)}else{if(Ts(t,i))return;v3.set(i),s.uniformMatrix4fv(this.addr,!1,v3),Is(t,i)}}function YZ(s,e){const t=this.cache;t[0]!==e&&(s.uniform1i(this.addr,e),t[0]=e)}function KZ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ts(t,e))return;s.uniform2iv(this.addr,e),Is(t,e)}}function JZ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ts(t,e))return;s.uniform3iv(this.addr,e),Is(t,e)}}function ZZ(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ts(t,e))return;s.uniform4iv(this.addr,e),Is(t,e)}}function $Z(s,e){const t=this.cache;t[0]!==e&&(s.uniform1ui(this.addr,e),t[0]=e)}function e$(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(s.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ts(t,e))return;s.uniform2uiv(this.addr,e),Is(t,e)}}function t$(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(s.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ts(t,e))return;s.uniform3uiv(this.addr,e),Is(t,e)}}function i$(s,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(s.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ts(t,e))return;s.uniform4uiv(this.addr,e),Is(t,e)}}function n$(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n);const r=this.type===s.SAMPLER_2D_SHADOW?P8:R8;t.setTexture2D(e||r,n)}function s$(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTexture3D(e||D8,n)}function r$(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTextureCube(e||O8,n)}function o$(s,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(s.uniform1i(this.addr,n),i[0]=n),t.setTexture2DArray(e||B8,n)}function a$(s){switch(s){case 5126:return HZ;case 35664:return VZ;case 35665:return QZ;case 35666:return WZ;case 35674:return jZ;case 35675:return qZ;case 35676:return XZ;case 5124:case 35670:return YZ;case 35667:case 35671:return KZ;case 35668:case 35672:return JZ;case 35669:case 35673:return ZZ;case 5125:return $Z;case 36294:return e$;case 36295:return t$;case 36296:return i$;case 35678:case 36198:case 36298:case 36306:case 35682:return n$;case 35679:case 36299:case 36307:return s$;case 35680:case 36300:case 36308:case 36293:return r$;case 36289:case 36303:case 36311:case 36292:return o$}}function l$(s,e){s.uniform1fv(this.addr,e)}function c$(s,e){const t=_v(e,this.size,2);s.uniform2fv(this.addr,t)}function h$(s,e){const t=_v(e,this.size,3);s.uniform3fv(this.addr,t)}function u$(s,e){const t=_v(e,this.size,4);s.uniform4fv(this.addr,t)}function d$(s,e){const t=_v(e,this.size,4);s.uniformMatrix2fv(this.addr,!1,t)}function f$(s,e){const t=_v(e,this.size,9);s.uniformMatrix3fv(this.addr,!1,t)}function p$(s,e){const t=_v(e,this.size,16);s.uniformMatrix4fv(this.addr,!1,t)}function m$(s,e){s.uniform1iv(this.addr,e)}function g$(s,e){s.uniform2iv(this.addr,e)}function y$(s,e){s.uniform3iv(this.addr,e)}function v$(s,e){s.uniform4iv(this.addr,e)}function A$(s,e){s.uniform1uiv(this.addr,e)}function _$(s,e){s.uniform2uiv(this.addr,e)}function b$(s,e){s.uniform3uiv(this.addr,e)}function x$(s,e){s.uniform4uiv(this.addr,e)}function w$(s,e,t){const i=this.cache,n=e.length,r=$E(t,n);Ts(i,r)||(s.uniform1iv(this.addr,r),Is(i,r));for(let o=0;o!==n;++o)t.setTexture2D(e[o]||R8,r[o])}function S$(s,e,t){const i=this.cache,n=e.length,r=$E(t,n);Ts(i,r)||(s.uniform1iv(this.addr,r),Is(i,r));for(let o=0;o!==n;++o)t.setTexture3D(e[o]||D8,r[o])}function C$(s,e,t){const i=this.cache,n=e.length,r=$E(t,n);Ts(i,r)||(s.uniform1iv(this.addr,r),Is(i,r));for(let o=0;o!==n;++o)t.setTextureCube(e[o]||O8,r[o])}function E$(s,e,t){const i=this.cache,n=e.length,r=$E(t,n);Ts(i,r)||(s.uniform1iv(this.addr,r),Is(i,r));for(let o=0;o!==n;++o)t.setTexture2DArray(e[o]||B8,r[o])}function M$(s){switch(s){case 5126:return l$;case 35664:return c$;case 35665:return h$;case 35666:return u$;case 35674:return d$;case 35675:return f$;case 35676:return p$;case 5124:case 35670:return m$;case 35667:case 35671:return g$;case 35668:case 35672:return y$;case 35669:case 35673:return v$;case 5125:return A$;case 36294:return _$;case 36295:return b$;case 36296:return x$;case 35678:case 36198:case 36298:case 36306:case 35682:return w$;case 35679:case 36299:case 36307:return S$;case 35680:case 36300:case 36308:case 36293:return C$;case 36289:case 36303:case 36311:case 36292:return E$}}class T${constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=a$(t.type)}}class I${constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=M$(t.type)}}class R${constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const n=this.seq;for(let r=0,o=n.length;r!==o;++r){const a=n[r];a.setValue(e,t[a.id],i)}}}const CI=/(\w+)(\])?(\[|\.)?/g;function b3(s,e){s.seq.push(e),s.map[e.id]=e}function P$(s,e,t){const i=s.name,n=i.length;for(CI.lastIndex=0;;){const r=CI.exec(i),o=CI.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===n){b3(t,c===void 0?new T$(a,s,e):new I$(a,s,e));break}else{let u=t.map[a];u===void 0&&(u=new R$(a),b3(t,u)),t=u}}}class XC{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const r=e.getActiveUniform(t,n),o=e.getUniformLocation(t,r.name);P$(r,o,this)}}setValue(e,t,i,n){const r=this.map[t];r!==void 0&&r.setValue(e,i,n)}setOptional(e,t,i){const n=t[i];n!==void 0&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,n)}}static seqWithValue(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const o=e[n];o.id in t&&i.push(o)}return i}}function x3(s,e,t){const i=s.createShader(e);return s.shaderSource(i,t),s.compileShader(i),i}const B$=37297;let D$=0;function O$(s,e){const t=s.split(`
`),i=[],n=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=n;o<r;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}function L$(s){const e=Ci.getPrimaries(Ci.workingColorSpace),t=Ci.getPrimaries(s);let i;switch(e===t?i="":e===M_&&t===E_?i="LinearDisplayP3ToLinearSRGB":e===E_&&t===M_&&(i="LinearSRGBToLinearDisplayP3"),s){case zi:case Mb:return[i,"LinearTransferOETF"];case bt:case KE:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",s),[i,"LinearTransferOETF"]}}function w3(s,e,t){const i=s.getShaderParameter(e,s.COMPILE_STATUS),n=s.getShaderInfoLog(e).trim();if(i&&n==="")return"";const r=/ERROR: 0:(\d+)/.exec(n);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+n+`

`+O$(s.getShaderSource(e),o)}else return n}function k$(s,e){const t=L$(e);return`vec4 ${s}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function F$(s,e){let t;switch(e){case mv:t="Linear";break;case wb:t="Reinhard";break;case G5:t="OptimizedCineon";break;case Sb:t="ACESFilmic";break;case gv:t="AgX";break;case Jp:t="Neutral";break;case H5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+s+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function U$(s){return[s.extensionDerivatives||s.envMapCubeUVHeight||s.bumpMap||s.normalMapTangentSpace||s.clearcoatNormalMap||s.flatShading||s.alphaToCoverage||s.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(s.extensionFragDepth||s.logarithmicDepthBuffer)&&s.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",s.extensionDrawBuffers&&s.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(s.extensionShaderTextureLOD||s.envMap||s.transmission)&&s.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(py).join(`
`)}function N$(s){return[s.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",s.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(py).join(`
`)}function z$(s){const e=[];for(const t in s){const i=s[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function G$(s,e){const t={},i=s.getProgramParameter(e,s.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const r=s.getActiveAttrib(e,n),o=r.name;let a=1;r.type===s.FLOAT_MAT2&&(a=2),r.type===s.FLOAT_MAT3&&(a=3),r.type===s.FLOAT_MAT4&&(a=4),t[o]={type:r.type,location:s.getAttribLocation(e,o),locationSize:a}}return t}function py(s){return s!==""}function S3(s,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return s.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function C3(s,e){return s.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const H$=/^[ \t]*#include +<([\w\d./]+)>/gm;function A2(s){return s.replace(H$,Q$)}const V$=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Q$(s,e){let t=It[e];if(t===void 0){const i=V$.get(e);if(i!==void 0)t=It[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return A2(t)}const W$=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function E3(s){return s.replace(W$,j$)}function j$(s,e,t,i){let n="";for(let r=parseInt(e);r<parseInt(t);r++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return n}function M3(s){let e=`precision ${s.precision} float;
	precision ${s.precision} int;
	precision ${s.precision} sampler2D;
	precision ${s.precision} samplerCube;
	`;return s.isWebGL2&&(e+=`precision ${s.precision} sampler3D;
		precision ${s.precision} sampler2DArray;
		precision ${s.precision} sampler2DShadow;
		precision ${s.precision} samplerCubeShadow;
		precision ${s.precision} sampler2DArrayShadow;
		precision ${s.precision} isampler2D;
		precision ${s.precision} isampler3D;
		precision ${s.precision} isamplerCube;
		precision ${s.precision} isampler2DArray;
		precision ${s.precision} usampler2D;
		precision ${s.precision} usampler3D;
		precision ${s.precision} usamplerCube;
		precision ${s.precision} usampler2DArray;
		`),s.precision==="highp"?e+=`
#define HIGH_PRECISION`:s.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:s.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function q$(s){let e="SHADOWMAP_TYPE_BASIC";return s.shadowMapType===RO?e="SHADOWMAP_TYPE_PCF":s.shadowMapType===PO?e="SHADOWMAP_TYPE_PCF_SOFT":s.shadowMapType===cc&&(e="SHADOWMAP_TYPE_VSM"),e}function X$(s){let e="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case ru:case zd:e="ENVMAP_TYPE_CUBE";break;case yv:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Y$(s){let e="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case zd:e="ENVMAP_MODE_REFRACTION";break}return e}function K$(s){let e="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case xb:e="ENVMAP_BLENDING_MULTIPLY";break;case N5:e="ENVMAP_BLENDING_MIX";break;case z5:e="ENVMAP_BLENDING_ADD";break}return e}function J$(s){const e=s.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function Z$(s,e,t,i){const n=s.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=q$(t),c=X$(t),h=Y$(t),u=K$(t),f=J$(t),p=t.isWebGL2?"":U$(t),m=N$(t),v=z$(r),g=n.createProgram();let y,A,_=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(py).join(`
`),y.length>0&&(y+=`
`),A=[p,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(py).join(`
`),A.length>0&&(A+=`
`)):(y=[M3(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(py).join(`
`),A=[p,M3(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+u:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==po?"#define TONE_MAPPING":"",t.toneMapping!==po?It.tonemapping_pars_fragment:"",t.toneMapping!==po?F$("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",It.colorspace_pars_fragment,k$("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(py).join(`
`)),o=A2(o),o=S3(o,t),o=C3(o,t),a=A2(a),a=S3(a,t),a=C3(a,t),o=E3(o),a=E3(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(_=`#version 300 es
`,y=[m,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,A=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===L1?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===L1?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+A);const b=_+y+o,x=_+A+a,E=x3(n,n.VERTEX_SHADER,b),M=x3(n,n.FRAGMENT_SHADER,x);n.attachShader(g,E),n.attachShader(g,M),t.index0AttributeName!==void 0?n.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g);function T(O){if(s.debug.checkShaderErrors){const k=n.getProgramInfoLog(g).trim(),B=n.getShaderInfoLog(E).trim(),G=n.getShaderInfoLog(M).trim();let L=!0,U=!0;if(n.getProgramParameter(g,n.LINK_STATUS)===!1)if(L=!1,typeof s.debug.onShaderError=="function")s.debug.onShaderError(n,g,E,M);else{const z=w3(n,E,"vertex"),j=w3(n,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(g,n.VALIDATE_STATUS)+`

Material Name: `+O.name+`
Material Type: `+O.type+`

Program Info Log: `+k+`
`+z+`
`+j)}else k!==""?console.warn("THREE.WebGLProgram: Program Info Log:",k):(B===""||G==="")&&(U=!1);U&&(O.diagnostics={runnable:L,programLog:k,vertexShader:{log:B,prefix:y},fragmentShader:{log:G,prefix:A}})}n.deleteShader(E),n.deleteShader(M),R=new XC(n,g),w=G$(n,g)}let R;this.getUniforms=function(){return R===void 0&&T(this),R};let w;this.getAttributes=function(){return w===void 0&&T(this),w};let I=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return I===!1&&(I=n.getProgramParameter(g,B$)),I},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=D$++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=E,this.fragmentShader=M,this}let $$=0;class eee{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(n)===!1&&(o.add(n),n.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new tee(e),t.set(e,i)),i}}class tee{constructor(e){this.id=$$++,this.code=e,this.usedTimes=0}}function iee(s,e,t,i,n,r,o){const a=new Vr,l=new eee,c=new Set,h=[],u=n.isWebGL2,f=n.logarithmicDepthBuffer,p=n.vertexTextures;let m=n.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(w){return c.add(w),w===0?"uv":`uv${w}`}function y(w,I,O,k,B){const G=k.fog,L=B.geometry,U=w.isMeshStandardMaterial?k.environment:null,z=(w.isMeshStandardMaterial?t:e).get(w.envMap||U),j=z&&z.mapping===yv?z.image.height:null,X=v[w.type];w.precision!==null&&(m=n.getMaxPrecision(w.precision),m!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",m,"instead."));const re=L.morphAttributes.position||L.morphAttributes.normal||L.morphAttributes.color,ce=re!==void 0?re.length:0;let Me=0;L.morphAttributes.position!==void 0&&(Me=1),L.morphAttributes.normal!==void 0&&(Me=2),L.morphAttributes.color!==void 0&&(Me=3);let se,ve,xe,Fe;if(X){const Mi=ur[X];se=Mi.vertexShader,ve=Mi.fragmentShader}else se=w.vertexShader,ve=w.fragmentShader,l.update(w),xe=l.getVertexShaderID(w),Fe=l.getFragmentShaderID(w);const Ge=s.getRenderTarget(),je=B.isInstancedMesh===!0,lt=B.isBatchedMesh===!0,ot=!!w.map,q=!!w.matcap,He=!!z,we=!!w.aoMap,Ne=!!w.lightMap,Ee=!!w.bumpMap,st=!!w.normalMap,et=!!w.displacementMap,ct=!!w.emissiveMap,zt=!!w.metalnessMap,V=!!w.roughnessMap,F=w.anisotropy>0,ge=w.clearcoat>0,_e=w.iridescence>0,Pe=w.sheen>0,Te=w.transmission>0,xt=F&&!!w.anisotropyMap,ft=ge&&!!w.clearcoatMap,Le=ge&&!!w.clearcoatNormalMap,Qe=ge&&!!w.clearcoatRoughnessMap,St=_e&&!!w.iridescenceMap,ke=_e&&!!w.iridescenceThicknessMap,ni=Pe&&!!w.sheenColorMap,pt=Pe&&!!w.sheenRoughnessMap,Xe=!!w.specularMap,mt=!!w.specularColorMap,at=!!w.specularIntensityMap,Lt=Te&&!!w.transmissionMap,W=Te&&!!w.thicknessMap,ae=!!w.gradientMap,$=!!w.alphaMap,De=w.alphaTest>0,he=!!w.alphaHash,Ve=!!w.extensions;let Ye=po;w.toneMapped&&(Ge===null||Ge.isXRRenderTarget===!0)&&(Ye=s.toneMapping);const si={isWebGL2:u,shaderID:X,shaderType:w.type,shaderName:w.name,vertexShader:se,fragmentShader:ve,defines:w.defines,customVertexShaderID:xe,customFragmentShaderID:Fe,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:m,batching:lt,instancing:je,instancingColor:je&&B.instanceColor!==null,instancingMorph:je&&B.morphTexture!==null,supportsVertexTextures:p,outputColorSpace:Ge===null?s.outputColorSpace:Ge.isXRRenderTarget===!0?Ge.texture.colorSpace:zi,alphaToCoverage:!!w.alphaToCoverage,map:ot,matcap:q,envMap:He,envMapMode:He&&z.mapping,envMapCubeUVHeight:j,aoMap:we,lightMap:Ne,bumpMap:Ee,normalMap:st,displacementMap:p&&et,emissiveMap:ct,normalMapObjectSpace:st&&w.normalMapType===K5,normalMapTangentSpace:st&&w.normalMapType===Zd,metalnessMap:zt,roughnessMap:V,anisotropy:F,anisotropyMap:xt,clearcoat:ge,clearcoatMap:ft,clearcoatNormalMap:Le,clearcoatRoughnessMap:Qe,iridescence:_e,iridescenceMap:St,iridescenceThicknessMap:ke,sheen:Pe,sheenColorMap:ni,sheenRoughnessMap:pt,specularMap:Xe,specularColorMap:mt,specularIntensityMap:at,transmission:Te,transmissionMap:Lt,thicknessMap:W,gradientMap:ae,opaque:w.transparent===!1&&w.blending===Cd&&w.alphaToCoverage===!1,alphaMap:$,alphaTest:De,alphaHash:he,combine:w.combine,mapUv:ot&&g(w.map.channel),aoMapUv:we&&g(w.aoMap.channel),lightMapUv:Ne&&g(w.lightMap.channel),bumpMapUv:Ee&&g(w.bumpMap.channel),normalMapUv:st&&g(w.normalMap.channel),displacementMapUv:et&&g(w.displacementMap.channel),emissiveMapUv:ct&&g(w.emissiveMap.channel),metalnessMapUv:zt&&g(w.metalnessMap.channel),roughnessMapUv:V&&g(w.roughnessMap.channel),anisotropyMapUv:xt&&g(w.anisotropyMap.channel),clearcoatMapUv:ft&&g(w.clearcoatMap.channel),clearcoatNormalMapUv:Le&&g(w.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Qe&&g(w.clearcoatRoughnessMap.channel),iridescenceMapUv:St&&g(w.iridescenceMap.channel),iridescenceThicknessMapUv:ke&&g(w.iridescenceThicknessMap.channel),sheenColorMapUv:ni&&g(w.sheenColorMap.channel),sheenRoughnessMapUv:pt&&g(w.sheenRoughnessMap.channel),specularMapUv:Xe&&g(w.specularMap.channel),specularColorMapUv:mt&&g(w.specularColorMap.channel),specularIntensityMapUv:at&&g(w.specularIntensityMap.channel),transmissionMapUv:Lt&&g(w.transmissionMap.channel),thicknessMapUv:W&&g(w.thicknessMap.channel),alphaMapUv:$&&g(w.alphaMap.channel),vertexTangents:!!L.attributes.tangent&&(st||F),vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!L.attributes.color&&L.attributes.color.itemSize===4,pointsUvs:B.isPoints===!0&&!!L.attributes.uv&&(ot||$),fog:!!G,useFog:w.fog===!0,fogExp2:!!G&&G.isFogExp2,flatShading:w.flatShading===!0,sizeAttenuation:w.sizeAttenuation===!0,logarithmicDepthBuffer:f,skinning:B.isSkinnedMesh===!0,morphTargets:L.morphAttributes.position!==void 0,morphNormals:L.morphAttributes.normal!==void 0,morphColors:L.morphAttributes.color!==void 0,morphTargetsCount:ce,morphTextureStride:Me,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numLightProbes:I.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:w.dithering,shadowMapEnabled:s.shadowMap.enabled&&O.length>0,shadowMapType:s.shadowMap.type,toneMapping:Ye,useLegacyLights:s._useLegacyLights,decodeVideoTexture:ot&&w.map.isVideoTexture===!0&&Ci.getTransfer(w.map.colorSpace)===Yi,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===_i,flipSided:w.side===bn,useDepthPacking:w.depthPacking>=0,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionDerivatives:Ve&&w.extensions.derivatives===!0,extensionFragDepth:Ve&&w.extensions.fragDepth===!0,extensionDrawBuffers:Ve&&w.extensions.drawBuffers===!0,extensionShaderTextureLOD:Ve&&w.extensions.shaderTextureLOD===!0,extensionClipCullDistance:Ve&&w.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:Ve&&w.extensions.multiDraw===!0&&i.has("WEBGL_multi_draw"),rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:w.customProgramCacheKey()};return si.vertexUv1s=c.has(1),si.vertexUv2s=c.has(2),si.vertexUv3s=c.has(3),c.clear(),si}function A(w){const I=[];if(w.shaderID?I.push(w.shaderID):(I.push(w.customVertexShaderID),I.push(w.customFragmentShaderID)),w.defines!==void 0)for(const O in w.defines)I.push(O),I.push(w.defines[O]);return w.isRawShaderMaterial===!1&&(_(I,w),b(I,w),I.push(s.outputColorSpace)),I.push(w.customProgramCacheKey),I.join()}function _(w,I){w.push(I.precision),w.push(I.outputColorSpace),w.push(I.envMapMode),w.push(I.envMapCubeUVHeight),w.push(I.mapUv),w.push(I.alphaMapUv),w.push(I.lightMapUv),w.push(I.aoMapUv),w.push(I.bumpMapUv),w.push(I.normalMapUv),w.push(I.displacementMapUv),w.push(I.emissiveMapUv),w.push(I.metalnessMapUv),w.push(I.roughnessMapUv),w.push(I.anisotropyMapUv),w.push(I.clearcoatMapUv),w.push(I.clearcoatNormalMapUv),w.push(I.clearcoatRoughnessMapUv),w.push(I.iridescenceMapUv),w.push(I.iridescenceThicknessMapUv),w.push(I.sheenColorMapUv),w.push(I.sheenRoughnessMapUv),w.push(I.specularMapUv),w.push(I.specularColorMapUv),w.push(I.specularIntensityMapUv),w.push(I.transmissionMapUv),w.push(I.thicknessMapUv),w.push(I.combine),w.push(I.fogExp2),w.push(I.sizeAttenuation),w.push(I.morphTargetsCount),w.push(I.morphAttributeCount),w.push(I.numDirLights),w.push(I.numPointLights),w.push(I.numSpotLights),w.push(I.numSpotLightMaps),w.push(I.numHemiLights),w.push(I.numRectAreaLights),w.push(I.numDirLightShadows),w.push(I.numPointLightShadows),w.push(I.numSpotLightShadows),w.push(I.numSpotLightShadowsWithMaps),w.push(I.numLightProbes),w.push(I.shadowMapType),w.push(I.toneMapping),w.push(I.numClippingPlanes),w.push(I.numClipIntersection),w.push(I.depthPacking)}function b(w,I){a.disableAll(),I.isWebGL2&&a.enable(0),I.supportsVertexTextures&&a.enable(1),I.instancing&&a.enable(2),I.instancingColor&&a.enable(3),I.instancingMorph&&a.enable(4),I.matcap&&a.enable(5),I.envMap&&a.enable(6),I.normalMapObjectSpace&&a.enable(7),I.normalMapTangentSpace&&a.enable(8),I.clearcoat&&a.enable(9),I.iridescence&&a.enable(10),I.alphaTest&&a.enable(11),I.vertexColors&&a.enable(12),I.vertexAlphas&&a.enable(13),I.vertexUv1s&&a.enable(14),I.vertexUv2s&&a.enable(15),I.vertexUv3s&&a.enable(16),I.vertexTangents&&a.enable(17),I.anisotropy&&a.enable(18),I.alphaHash&&a.enable(19),I.batching&&a.enable(20),w.push(a.mask),a.disableAll(),I.fog&&a.enable(0),I.useFog&&a.enable(1),I.flatShading&&a.enable(2),I.logarithmicDepthBuffer&&a.enable(3),I.skinning&&a.enable(4),I.morphTargets&&a.enable(5),I.morphNormals&&a.enable(6),I.morphColors&&a.enable(7),I.premultipliedAlpha&&a.enable(8),I.shadowMapEnabled&&a.enable(9),I.useLegacyLights&&a.enable(10),I.doubleSided&&a.enable(11),I.flipSided&&a.enable(12),I.useDepthPacking&&a.enable(13),I.dithering&&a.enable(14),I.transmission&&a.enable(15),I.sheen&&a.enable(16),I.opaque&&a.enable(17),I.pointsUvs&&a.enable(18),I.decodeVideoTexture&&a.enable(19),I.alphaToCoverage&&a.enable(20),w.push(a.mask)}function x(w){const I=v[w.type];let O;if(I){const k=ur[I];O=vv.clone(k.uniforms)}else O=w.uniforms;return O}function E(w,I){let O;for(let k=0,B=h.length;k<B;k++){const G=h[k];if(G.cacheKey===I){O=G,++O.usedTimes;break}}return O===void 0&&(O=new Z$(s,I,w,r),h.push(O)),O}function M(w){if(--w.usedTimes===0){const I=h.indexOf(w);h[I]=h[h.length-1],h.pop(),w.destroy()}}function T(w){l.remove(w)}function R(){l.dispose()}return{getParameters:y,getProgramCacheKey:A,getUniforms:x,acquireProgram:E,releaseProgram:M,releaseShaderCache:T,programs:h,dispose:R}}function nee(){let s=new WeakMap;function e(r){let o=s.get(r);return o===void 0&&(o={},s.set(r,o)),o}function t(r){s.delete(r)}function i(r,o,a){s.get(r)[o]=a}function n(){s=new WeakMap}return{get:e,remove:t,update:i,dispose:n}}function see(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.material.id!==e.material.id?s.material.id-e.material.id:s.z!==e.z?s.z-e.z:s.id-e.id}function T3(s,e){return s.groupOrder!==e.groupOrder?s.groupOrder-e.groupOrder:s.renderOrder!==e.renderOrder?s.renderOrder-e.renderOrder:s.z!==e.z?e.z-s.z:s.id-e.id}function I3(){const s=[];let e=0;const t=[],i=[],n=[];function r(){e=0,t.length=0,i.length=0,n.length=0}function o(u,f,p,m,v,g){let y=s[e];return y===void 0?(y={id:u.id,object:u,geometry:f,material:p,groupOrder:m,renderOrder:u.renderOrder,z:v,group:g},s[e]=y):(y.id=u.id,y.object=u,y.geometry=f,y.material=p,y.groupOrder=m,y.renderOrder=u.renderOrder,y.z=v,y.group=g),e++,y}function a(u,f,p,m,v,g){const y=o(u,f,p,m,v,g);p.transmission>0?i.push(y):p.transparent===!0?n.push(y):t.push(y)}function l(u,f,p,m,v,g){const y=o(u,f,p,m,v,g);p.transmission>0?i.unshift(y):p.transparent===!0?n.unshift(y):t.unshift(y)}function c(u,f){t.length>1&&t.sort(u||see),i.length>1&&i.sort(f||T3),n.length>1&&n.sort(f||T3)}function h(){for(let u=e,f=s.length;u<f;u++){const p=s[u];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:i,transparent:n,init:r,push:a,unshift:l,finish:h,sort:c}}function ree(){let s=new WeakMap;function e(i,n){const r=s.get(i);let o;return r===void 0?(o=new I3,s.set(i,[o])):n>=r.length?(o=new I3,r.push(o)):o=r[n],o}function t(){s=new WeakMap}return{get:e,dispose:t}}function oee(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new S,color:new Ae};break;case"SpotLight":t={position:new S,direction:new S,color:new Ae,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new S,color:new Ae,distance:0,decay:0};break;case"HemisphereLight":t={direction:new S,skyColor:new Ae,groundColor:new Ae};break;case"RectAreaLight":t={color:new Ae,position:new S,halfWidth:new S,halfHeight:new S};break}return s[e.id]=t,t}}}function aee(){const s={};return{get:function(e){if(s[e.id]!==void 0)return s[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ee};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ee};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ee,shadowCameraNear:1,shadowCameraFar:1e3};break}return s[e.id]=t,t}}}let lee=0;function cee(s,e){return(e.castShadow?2:0)-(s.castShadow?2:0)+(e.map?1:0)-(s.map?1:0)}function hee(s,e){const t=new oee,i=aee(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)n.probe.push(new S);const r=new S,o=new le,a=new le;function l(h,u){let f=0,p=0,m=0;for(let O=0;O<9;O++)n.probe[O].set(0,0,0);let v=0,g=0,y=0,A=0,_=0,b=0,x=0,E=0,M=0,T=0,R=0;h.sort(cee);const w=u===!0?Math.PI:1;for(let O=0,k=h.length;O<k;O++){const B=h[O],G=B.color,L=B.intensity,U=B.distance,z=B.shadow&&B.shadow.map?B.shadow.map.texture:null;if(B.isAmbientLight)f+=G.r*L*w,p+=G.g*L*w,m+=G.b*L*w;else if(B.isLightProbe){for(let j=0;j<9;j++)n.probe[j].addScaledVector(B.sh.coefficients[j],L);R++}else if(B.isDirectionalLight){const j=t.get(B);if(j.color.copy(B.color).multiplyScalar(B.intensity*w),B.castShadow){const X=B.shadow,re=i.get(B);re.shadowBias=X.bias,re.shadowNormalBias=X.normalBias,re.shadowRadius=X.radius,re.shadowMapSize=X.mapSize,n.directionalShadow[v]=re,n.directionalShadowMap[v]=z,n.directionalShadowMatrix[v]=B.shadow.matrix,b++}n.directional[v]=j,v++}else if(B.isSpotLight){const j=t.get(B);j.position.setFromMatrixPosition(B.matrixWorld),j.color.copy(G).multiplyScalar(L*w),j.distance=U,j.coneCos=Math.cos(B.angle),j.penumbraCos=Math.cos(B.angle*(1-B.penumbra)),j.decay=B.decay,n.spot[y]=j;const X=B.shadow;if(B.map&&(n.spotLightMap[M]=B.map,M++,X.updateMatrices(B),B.castShadow&&T++),n.spotLightMatrix[y]=X.matrix,B.castShadow){const re=i.get(B);re.shadowBias=X.bias,re.shadowNormalBias=X.normalBias,re.shadowRadius=X.radius,re.shadowMapSize=X.mapSize,n.spotShadow[y]=re,n.spotShadowMap[y]=z,E++}y++}else if(B.isRectAreaLight){const j=t.get(B);j.color.copy(G).multiplyScalar(L),j.halfWidth.set(B.width*.5,0,0),j.halfHeight.set(0,B.height*.5,0),n.rectArea[A]=j,A++}else if(B.isPointLight){const j=t.get(B);if(j.color.copy(B.color).multiplyScalar(B.intensity*w),j.distance=B.distance,j.decay=B.decay,B.castShadow){const X=B.shadow,re=i.get(B);re.shadowBias=X.bias,re.shadowNormalBias=X.normalBias,re.shadowRadius=X.radius,re.shadowMapSize=X.mapSize,re.shadowCameraNear=X.camera.near,re.shadowCameraFar=X.camera.far,n.pointShadow[g]=re,n.pointShadowMap[g]=z,n.pointShadowMatrix[g]=B.shadow.matrix,x++}n.point[g]=j,g++}else if(B.isHemisphereLight){const j=t.get(B);j.skyColor.copy(B.color).multiplyScalar(L*w),j.groundColor.copy(B.groundColor).multiplyScalar(L*w),n.hemi[_]=j,_++}}A>0&&(e.isWebGL2?s.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=ze.LTC_FLOAT_1,n.rectAreaLTC2=ze.LTC_FLOAT_2):(n.rectAreaLTC1=ze.LTC_HALF_1,n.rectAreaLTC2=ze.LTC_HALF_2):s.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=ze.LTC_FLOAT_1,n.rectAreaLTC2=ze.LTC_FLOAT_2):s.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=ze.LTC_HALF_1,n.rectAreaLTC2=ze.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=f,n.ambient[1]=p,n.ambient[2]=m;const I=n.hash;(I.directionalLength!==v||I.pointLength!==g||I.spotLength!==y||I.rectAreaLength!==A||I.hemiLength!==_||I.numDirectionalShadows!==b||I.numPointShadows!==x||I.numSpotShadows!==E||I.numSpotMaps!==M||I.numLightProbes!==R)&&(n.directional.length=v,n.spot.length=y,n.rectArea.length=A,n.point.length=g,n.hemi.length=_,n.directionalShadow.length=b,n.directionalShadowMap.length=b,n.pointShadow.length=x,n.pointShadowMap.length=x,n.spotShadow.length=E,n.spotShadowMap.length=E,n.directionalShadowMatrix.length=b,n.pointShadowMatrix.length=x,n.spotLightMatrix.length=E+M-T,n.spotLightMap.length=M,n.numSpotLightShadowsWithMaps=T,n.numLightProbes=R,I.directionalLength=v,I.pointLength=g,I.spotLength=y,I.rectAreaLength=A,I.hemiLength=_,I.numDirectionalShadows=b,I.numPointShadows=x,I.numSpotShadows=E,I.numSpotMaps=M,I.numLightProbes=R,n.version=lee++)}function c(h,u){let f=0,p=0,m=0,v=0,g=0;const y=u.matrixWorldInverse;for(let A=0,_=h.length;A<_;A++){const b=h[A];if(b.isDirectionalLight){const x=n.directional[f];x.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(y),f++}else if(b.isSpotLight){const x=n.spot[m];x.position.setFromMatrixPosition(b.matrixWorld),x.position.applyMatrix4(y),x.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(y),m++}else if(b.isRectAreaLight){const x=n.rectArea[v];x.position.setFromMatrixPosition(b.matrixWorld),x.position.applyMatrix4(y),a.identity(),o.copy(b.matrixWorld),o.premultiply(y),a.extractRotation(o),x.halfWidth.set(b.width*.5,0,0),x.halfHeight.set(0,b.height*.5,0),x.halfWidth.applyMatrix4(a),x.halfHeight.applyMatrix4(a),v++}else if(b.isPointLight){const x=n.point[p];x.position.setFromMatrixPosition(b.matrixWorld),x.position.applyMatrix4(y),p++}else if(b.isHemisphereLight){const x=n.hemi[g];x.direction.setFromMatrixPosition(b.matrixWorld),x.direction.transformDirection(y),g++}}}return{setup:l,setupView:c,state:n}}function R3(s,e){const t=new hee(s,e),i=[],n=[];function r(){i.length=0,n.length=0}function o(u){i.push(u)}function a(u){n.push(u)}function l(u){t.setup(i,u)}function c(u){t.setupView(i,u)}return{init:r,state:{lightsArray:i,shadowsArray:n,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function uee(s,e){let t=new WeakMap;function i(r,o=0){const a=t.get(r);let l;return a===void 0?(l=new R3(s,e),t.set(r,[l])):o>=a.length?(l=new R3(s,e),a.push(l)):l=a[o],l}function n(){t=new WeakMap}return{get:i,dispose:n}}class Rb extends Ht{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=gr,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class YO extends Ht{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const dee=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fee=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function pee(s,e,t){let i=new $p;const n=new ee,r=new ee,o=new Je,a=new Rb({depthPacking:YE}),l=new YO,c={},h=t.maxTextureSize,u={[$n]:bn,[bn]:$n,[_i]:_i},f=new kt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ee},radius:{value:4}},vertexShader:dee,fragmentShader:fee}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const m=new yt;m.setAttribute("position",new Ke(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new fe(m,f),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=RO;let y=this.type;this.render=function(E,M,T){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||E.length===0)return;const R=s.getRenderTarget(),w=s.getActiveCubeFace(),I=s.getActiveMipmapLevel(),O=s.state;O.setBlending(xn),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);const k=y!==cc&&this.type===cc,B=y===cc&&this.type!==cc;for(let G=0,L=E.length;G<L;G++){const U=E[G],z=U.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",U,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;n.copy(z.mapSize);const j=z.getFrameExtents();if(n.multiply(j),r.copy(z.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(r.x=Math.floor(h/j.x),n.x=r.x*j.x,z.mapSize.x=r.x),n.y>h&&(r.y=Math.floor(h/j.y),n.y=r.y*j.y,z.mapSize.y=r.y)),z.map===null||k===!0||B===!0){const re=this.type!==cc?{minFilter:Ot,magFilter:Ot}:{};z.map!==null&&z.map.dispose(),z.map=new $t(n.x,n.y,re),z.map.texture.name=U.name+".shadowMap",z.camera.updateProjectionMatrix()}s.setRenderTarget(z.map),s.clear();const X=z.getViewportCount();for(let re=0;re<X;re++){const ce=z.getViewport(re);o.set(r.x*ce.x,r.y*ce.y,r.x*ce.z,r.y*ce.w),O.viewport(o),z.updateMatrices(U,re),i=z.getFrustum(),b(M,T,z.camera,U,this.type)}z.isPointLightShadow!==!0&&this.type===cc&&A(z,T),z.needsUpdate=!1}y=this.type,g.needsUpdate=!1,s.setRenderTarget(R,w,I)};function A(E,M){const T=e.update(v);f.defines.VSM_SAMPLES!==E.blurSamples&&(f.defines.VSM_SAMPLES=E.blurSamples,p.defines.VSM_SAMPLES=E.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),E.mapPass===null&&(E.mapPass=new $t(n.x,n.y)),f.uniforms.shadow_pass.value=E.map.texture,f.uniforms.resolution.value=E.mapSize,f.uniforms.radius.value=E.radius,s.setRenderTarget(E.mapPass),s.clear(),s.renderBufferDirect(M,null,T,f,v,null),p.uniforms.shadow_pass.value=E.mapPass.texture,p.uniforms.resolution.value=E.mapSize,p.uniforms.radius.value=E.radius,s.setRenderTarget(E.map),s.clear(),s.renderBufferDirect(M,null,T,p,v,null)}function _(E,M,T,R){let w=null;const I=T.isPointLight===!0?E.customDistanceMaterial:E.customDepthMaterial;if(I!==void 0)w=I;else if(w=T.isPointLight===!0?l:a,s.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const O=w.uuid,k=M.uuid;let B=c[O];B===void 0&&(B={},c[O]=B);let G=B[k];G===void 0&&(G=w.clone(),B[k]=G,M.addEventListener("dispose",x)),w=G}if(w.visible=M.visible,w.wireframe=M.wireframe,R===cc?w.side=M.shadowSide!==null?M.shadowSide:M.side:w.side=M.shadowSide!==null?M.shadowSide:u[M.side],w.alphaMap=M.alphaMap,w.alphaTest=M.alphaTest,w.map=M.map,w.clipShadows=M.clipShadows,w.clippingPlanes=M.clippingPlanes,w.clipIntersection=M.clipIntersection,w.displacementMap=M.displacementMap,w.displacementScale=M.displacementScale,w.displacementBias=M.displacementBias,w.wireframeLinewidth=M.wireframeLinewidth,w.linewidth=M.linewidth,T.isPointLight===!0&&w.isMeshDistanceMaterial===!0){const O=s.properties.get(w);O.light=T}return w}function b(E,M,T,R,w){if(E.visible===!1)return;if(E.layers.test(M.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&w===cc)&&(!E.frustumCulled||i.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,E.matrixWorld);const k=e.update(E),B=E.material;if(Array.isArray(B)){const G=k.groups;for(let L=0,U=G.length;L<U;L++){const z=G[L],j=B[z.materialIndex];if(j&&j.visible){const X=_(E,j,R,w);E.onBeforeShadow(s,E,M,T,k,X,z),s.renderBufferDirect(T,null,k,X,E,z),E.onAfterShadow(s,E,M,T,k,X,z)}}}else if(B.visible){const G=_(E,B,R,w);E.onBeforeShadow(s,E,M,T,k,G,null),s.renderBufferDirect(T,null,k,G,E,null),E.onAfterShadow(s,E,M,T,k,G,null)}}const O=E.children;for(let k=0,B=O.length;k<B;k++)b(O[k],M,T,R,w)}function x(E){E.target.removeEventListener("dispose",x);for(const T in c){const R=c[T],w=E.target.uuid;w in R&&(R[w].dispose(),delete R[w])}}}function mee(s,e,t){const i=t.isWebGL2;function n(){let $=!1;const De=new Je;let he=null;const Ve=new Je(0,0,0,0);return{setMask:function(Ye){he!==Ye&&!$&&(s.colorMask(Ye,Ye,Ye,Ye),he=Ye)},setLocked:function(Ye){$=Ye},setClear:function(Ye,si,Mi,hn,un){un===!0&&(Ye*=hn,si*=hn,Mi*=hn),De.set(Ye,si,Mi,hn),Ve.equals(De)===!1&&(s.clearColor(Ye,si,Mi,hn),Ve.copy(De))},reset:function(){$=!1,he=null,Ve.set(-1,0,0,0)}}}function r(){let $=!1,De=null,he=null,Ve=null;return{setTest:function(Ye){Ye?je(s.DEPTH_TEST):lt(s.DEPTH_TEST)},setMask:function(Ye){De!==Ye&&!$&&(s.depthMask(Ye),De=Ye)},setFunc:function(Ye){if(he!==Ye){switch(Ye){case DO:s.depthFunc(s.NEVER);break;case GE:s.depthFunc(s.ALWAYS);break;case x_:s.depthFunc(s.LESS);break;case Kp:s.depthFunc(s.LEQUAL);break;case qy:s.depthFunc(s.EQUAL);break;case HE:s.depthFunc(s.GEQUAL);break;case VE:s.depthFunc(s.GREATER);break;case bb:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}he=Ye}},setLocked:function(Ye){$=Ye},setClear:function(Ye){Ve!==Ye&&(s.clearDepth(Ye),Ve=Ye)},reset:function(){$=!1,De=null,he=null,Ve=null}}}function o(){let $=!1,De=null,he=null,Ve=null,Ye=null,si=null,Mi=null,hn=null,un=null;return{setTest:function(oi){$||(oi?je(s.STENCIL_TEST):lt(s.STENCIL_TEST))},setMask:function(oi){De!==oi&&!$&&(s.stencilMask(oi),De=oi)},setFunc:function(oi,Tn,Fn){(he!==oi||Ve!==Tn||Ye!==Fn)&&(s.stencilFunc(oi,Tn,Fn),he=oi,Ve=Tn,Ye=Fn)},setOp:function(oi,Tn,Fn){(si!==oi||Mi!==Tn||hn!==Fn)&&(s.stencilOp(oi,Tn,Fn),si=oi,Mi=Tn,hn=Fn)},setLocked:function(oi){$=oi},setClear:function(oi){un!==oi&&(s.clearStencil(oi),un=oi)},reset:function(){$=!1,De=null,he=null,Ve=null,Ye=null,si=null,Mi=null,hn=null,un=null}}}const a=new n,l=new r,c=new o,h=new WeakMap,u=new WeakMap;let f={},p={},m=new WeakMap,v=[],g=null,y=!1,A=null,_=null,b=null,x=null,E=null,M=null,T=null,R=new Ae(0,0,0),w=0,I=!1,O=null,k=null,B=null,G=null,L=null;const U=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let z=!1,j=0;const X=s.getParameter(s.VERSION);X.indexOf("WebGL")!==-1?(j=parseFloat(/^WebGL (\d)/.exec(X)[1]),z=j>=1):X.indexOf("OpenGL ES")!==-1&&(j=parseFloat(/^OpenGL ES (\d)/.exec(X)[1]),z=j>=2);let re=null,ce={};const Me=s.getParameter(s.SCISSOR_BOX),se=s.getParameter(s.VIEWPORT),ve=new Je().fromArray(Me),xe=new Je().fromArray(se);function Fe($,De,he,Ve){const Ye=new Uint8Array(4),si=s.createTexture();s.bindTexture($,si),s.texParameteri($,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri($,s.TEXTURE_MAG_FILTER,s.NEAREST);for(let Mi=0;Mi<he;Mi++)i&&($===s.TEXTURE_3D||$===s.TEXTURE_2D_ARRAY)?s.texImage3D(De,0,s.RGBA,1,1,Ve,0,s.RGBA,s.UNSIGNED_BYTE,Ye):s.texImage2D(De+Mi,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,Ye);return si}const Ge={};Ge[s.TEXTURE_2D]=Fe(s.TEXTURE_2D,s.TEXTURE_2D,1),Ge[s.TEXTURE_CUBE_MAP]=Fe(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(Ge[s.TEXTURE_2D_ARRAY]=Fe(s.TEXTURE_2D_ARRAY,s.TEXTURE_2D_ARRAY,1,1),Ge[s.TEXTURE_3D]=Fe(s.TEXTURE_3D,s.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),je(s.DEPTH_TEST),l.setFunc(Kp),et(!1),ct(UB),je(s.CULL_FACE),Ee(xn);function je($){f[$]!==!0&&(s.enable($),f[$]=!0)}function lt($){f[$]!==!1&&(s.disable($),f[$]=!1)}function ot($,De){return p[$]!==De?(s.bindFramebuffer($,De),p[$]=De,i&&($===s.DRAW_FRAMEBUFFER&&(p[s.FRAMEBUFFER]=De),$===s.FRAMEBUFFER&&(p[s.DRAW_FRAMEBUFFER]=De)),!0):!1}function q($,De){let he=v,Ve=!1;if($){he=m.get(De),he===void 0&&(he=[],m.set(De,he));const Ye=$.textures;if(he.length!==Ye.length||he[0]!==s.COLOR_ATTACHMENT0){for(let si=0,Mi=Ye.length;si<Mi;si++)he[si]=s.COLOR_ATTACHMENT0+si;he.length=Ye.length,Ve=!0}}else he[0]!==s.BACK&&(he[0]=s.BACK,Ve=!0);if(Ve)if(t.isWebGL2)s.drawBuffers(he);else if(e.has("WEBGL_draw_buffers")===!0)e.get("WEBGL_draw_buffers").drawBuffersWEBGL(he);else throw new Error("THREE.WebGLState: Usage of gl.drawBuffers() require WebGL2 or WEBGL_draw_buffers extension")}function He($){return g!==$?(s.useProgram($),g=$,!0):!1}const we={[ud]:s.FUNC_ADD,[S5]:s.FUNC_SUBTRACT,[C5]:s.FUNC_REVERSE_SUBTRACT};if(i)we[GB]=s.MIN,we[I1]=s.MAX;else{const $=e.get("EXT_blend_minmax");$!==null&&(we[GB]=$.MIN_EXT,we[I1]=$.MAX_EXT)}const Ne={[E5]:s.ZERO,[M5]:s.ONE,[T5]:s.SRC_COLOR,[R1]:s.SRC_ALPHA,[O5]:s.SRC_ALPHA_SATURATE,[B5]:s.DST_COLOR,[R5]:s.DST_ALPHA,[I5]:s.ONE_MINUS_SRC_COLOR,[P1]:s.ONE_MINUS_SRC_ALPHA,[D5]:s.ONE_MINUS_DST_COLOR,[P5]:s.ONE_MINUS_DST_ALPHA,[L5]:s.CONSTANT_COLOR,[k5]:s.ONE_MINUS_CONSTANT_COLOR,[F5]:s.CONSTANT_ALPHA,[U5]:s.ONE_MINUS_CONSTANT_ALPHA};function Ee($,De,he,Ve,Ye,si,Mi,hn,un,oi){if($===xn){y===!0&&(lt(s.BLEND),y=!1);return}if(y===!1&&(je(s.BLEND),y=!0),$!==BO){if($!==A||oi!==I){if((_!==ud||E!==ud)&&(s.blendEquation(s.FUNC_ADD),_=ud,E=ud),oi)switch($){case Cd:s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case Yp:s.blendFunc(s.ONE,s.ONE);break;case NB:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case zB:s.blendFuncSeparate(s.ZERO,s.SRC_COLOR,s.ZERO,s.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",$);break}else switch($){case Cd:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case Yp:s.blendFunc(s.SRC_ALPHA,s.ONE);break;case NB:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case zB:s.blendFunc(s.ZERO,s.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",$);break}b=null,x=null,M=null,T=null,R.set(0,0,0),w=0,A=$,I=oi}return}Ye=Ye||De,si=si||he,Mi=Mi||Ve,(De!==_||Ye!==E)&&(s.blendEquationSeparate(we[De],we[Ye]),_=De,E=Ye),(he!==b||Ve!==x||si!==M||Mi!==T)&&(s.blendFuncSeparate(Ne[he],Ne[Ve],Ne[si],Ne[Mi]),b=he,x=Ve,M=si,T=Mi),(hn.equals(R)===!1||un!==w)&&(s.blendColor(hn.r,hn.g,hn.b,un),R.copy(hn),w=un),A=$,I=!1}function st($,De){$.side===_i?lt(s.CULL_FACE):je(s.CULL_FACE);let he=$.side===bn;De&&(he=!he),et(he),$.blending===Cd&&$.transparent===!1?Ee(xn):Ee($.blending,$.blendEquation,$.blendSrc,$.blendDst,$.blendEquationAlpha,$.blendSrcAlpha,$.blendDstAlpha,$.blendColor,$.blendAlpha,$.premultipliedAlpha),l.setFunc($.depthFunc),l.setTest($.depthTest),l.setMask($.depthWrite),a.setMask($.colorWrite);const Ve=$.stencilWrite;c.setTest(Ve),Ve&&(c.setMask($.stencilWriteMask),c.setFunc($.stencilFunc,$.stencilRef,$.stencilFuncMask),c.setOp($.stencilFail,$.stencilZFail,$.stencilZPass)),V($.polygonOffset,$.polygonOffsetFactor,$.polygonOffsetUnits),$.alphaToCoverage===!0?je(s.SAMPLE_ALPHA_TO_COVERAGE):lt(s.SAMPLE_ALPHA_TO_COVERAGE)}function et($){O!==$&&($?s.frontFace(s.CW):s.frontFace(s.CCW),O=$)}function ct($){$!==x5?(je(s.CULL_FACE),$!==k&&($===UB?s.cullFace(s.BACK):$===w5?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK))):lt(s.CULL_FACE),k=$}function zt($){$!==B&&(z&&s.lineWidth($),B=$)}function V($,De,he){$?(je(s.POLYGON_OFFSET_FILL),(G!==De||L!==he)&&(s.polygonOffset(De,he),G=De,L=he)):lt(s.POLYGON_OFFSET_FILL)}function F($){$?je(s.SCISSOR_TEST):lt(s.SCISSOR_TEST)}function ge($){$===void 0&&($=s.TEXTURE0+U-1),re!==$&&(s.activeTexture($),re=$)}function _e($,De,he){he===void 0&&(re===null?he=s.TEXTURE0+U-1:he=re);let Ve=ce[he];Ve===void 0&&(Ve={type:void 0,texture:void 0},ce[he]=Ve),(Ve.type!==$||Ve.texture!==De)&&(re!==he&&(s.activeTexture(he),re=he),s.bindTexture($,De||Ge[$]),Ve.type=$,Ve.texture=De)}function Pe(){const $=ce[re];$!==void 0&&$.type!==void 0&&(s.bindTexture($.type,null),$.type=void 0,$.texture=void 0)}function Te(){try{s.compressedTexImage2D.apply(s,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function xt(){try{s.compressedTexImage3D.apply(s,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function ft(){try{s.texSubImage2D.apply(s,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function Le(){try{s.texSubImage3D.apply(s,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function Qe(){try{s.compressedTexSubImage2D.apply(s,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function St(){try{s.compressedTexSubImage3D.apply(s,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function ke(){try{s.texStorage2D.apply(s,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function ni(){try{s.texStorage3D.apply(s,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function pt(){try{s.texImage2D.apply(s,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function Xe(){try{s.texImage3D.apply(s,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function mt($){ve.equals($)===!1&&(s.scissor($.x,$.y,$.z,$.w),ve.copy($))}function at($){xe.equals($)===!1&&(s.viewport($.x,$.y,$.z,$.w),xe.copy($))}function Lt($,De){let he=u.get(De);he===void 0&&(he=new WeakMap,u.set(De,he));let Ve=he.get($);Ve===void 0&&(Ve=s.getUniformBlockIndex(De,$.name),he.set($,Ve))}function W($,De){const Ve=u.get(De).get($);h.get(De)!==Ve&&(s.uniformBlockBinding(De,Ve,$.__bindingPointIndex),h.set(De,Ve))}function ae(){s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SCISSOR_TEST),s.disable(s.STENCIL_TEST),s.disable(s.SAMPLE_ALPHA_TO_COVERAGE),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.blendFuncSeparate(s.ONE,s.ZERO,s.ONE,s.ZERO),s.blendColor(0,0,0,0),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(s.LESS),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.clearStencil(0),s.cullFace(s.BACK),s.frontFace(s.CCW),s.polygonOffset(0,0),s.activeTexture(s.TEXTURE0),s.bindFramebuffer(s.FRAMEBUFFER,null),i===!0&&(s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),s.bindFramebuffer(s.READ_FRAMEBUFFER,null)),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),f={},re=null,ce={},p={},m=new WeakMap,v=[],g=null,y=!1,A=null,_=null,b=null,x=null,E=null,M=null,T=null,R=new Ae(0,0,0),w=0,I=!1,O=null,k=null,B=null,G=null,L=null,ve.set(0,0,s.canvas.width,s.canvas.height),xe.set(0,0,s.canvas.width,s.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:je,disable:lt,bindFramebuffer:ot,drawBuffers:q,useProgram:He,setBlending:Ee,setMaterial:st,setFlipSided:et,setCullFace:ct,setLineWidth:zt,setPolygonOffset:V,setScissorTest:F,activeTexture:ge,bindTexture:_e,unbindTexture:Pe,compressedTexImage2D:Te,compressedTexImage3D:xt,texImage2D:pt,texImage3D:Xe,updateUBOMapping:Lt,uniformBlockBinding:W,texStorage2D:ke,texStorage3D:ni,texSubImage2D:ft,texSubImage3D:Le,compressedTexSubImage2D:Qe,compressedTexSubImage3D:St,scissor:mt,viewport:at,reset:ae}}function gee(s,e,t,i,n,r,o){const a=n.isWebGL2,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),h=new ee,u=new WeakMap;let f;const p=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(V,F){return m?new OffscreenCanvas(V,F):R_("canvas")}function g(V,F,ge,_e){let Pe=1;const Te=zt(V);if((Te.width>_e||Te.height>_e)&&(Pe=_e/Math.max(Te.width,Te.height)),Pe<1||F===!0)if(typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&V instanceof ImageBitmap||typeof VideoFrame<"u"&&V instanceof VideoFrame){const xt=F?F1:Math.floor,ft=xt(Pe*Te.width),Le=xt(Pe*Te.height);f===void 0&&(f=v(ft,Le));const Qe=ge?v(ft,Le):f;return Qe.width=ft,Qe.height=Le,Qe.getContext("2d").drawImage(V,0,0,ft,Le),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Te.width+"x"+Te.height+") to ("+ft+"x"+Le+")."),Qe}else return"data"in V&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Te.width+"x"+Te.height+")."),V;return V}function y(V){const F=zt(V);return g2(F.width)&&g2(F.height)}function A(V){return a?!1:V.wrapS!==as||V.wrapT!==as||V.minFilter!==Ot&&V.minFilter!==Nt}function _(V,F){return V.generateMipmaps&&F&&V.minFilter!==Ot&&V.minFilter!==Nt}function b(V){s.generateMipmap(V)}function x(V,F,ge,_e,Pe=!1){if(a===!1)return F;if(V!==null){if(s[V]!==void 0)return s[V];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+V+"'")}let Te=F;if(F===s.RED&&(ge===s.FLOAT&&(Te=s.R32F),ge===s.HALF_FLOAT&&(Te=s.R16F),ge===s.UNSIGNED_BYTE&&(Te=s.R8)),F===s.RED_INTEGER&&(ge===s.UNSIGNED_BYTE&&(Te=s.R8UI),ge===s.UNSIGNED_SHORT&&(Te=s.R16UI),ge===s.UNSIGNED_INT&&(Te=s.R32UI),ge===s.BYTE&&(Te=s.R8I),ge===s.SHORT&&(Te=s.R16I),ge===s.INT&&(Te=s.R32I)),F===s.RG&&(ge===s.FLOAT&&(Te=s.RG32F),ge===s.HALF_FLOAT&&(Te=s.RG16F),ge===s.UNSIGNED_BYTE&&(Te=s.RG8)),F===s.RG_INTEGER&&(ge===s.UNSIGNED_BYTE&&(Te=s.RG8UI),ge===s.UNSIGNED_SHORT&&(Te=s.RG16UI),ge===s.UNSIGNED_INT&&(Te=s.RG32UI),ge===s.BYTE&&(Te=s.RG8I),ge===s.SHORT&&(Te=s.RG16I),ge===s.INT&&(Te=s.RG32I)),F===s.RGBA){const xt=Pe?C_:Ci.getTransfer(_e);ge===s.FLOAT&&(Te=s.RGBA32F),ge===s.HALF_FLOAT&&(Te=s.RGBA16F),ge===s.UNSIGNED_BYTE&&(Te=xt===Yi?s.SRGB8_ALPHA8:s.RGBA8),ge===s.UNSIGNED_SHORT_4_4_4_4&&(Te=s.RGBA4),ge===s.UNSIGNED_SHORT_5_5_5_1&&(Te=s.RGB5_A1)}return(Te===s.R16F||Te===s.R32F||Te===s.RG16F||Te===s.RG32F||Te===s.RGBA16F||Te===s.RGBA32F)&&e.get("EXT_color_buffer_float"),Te}function E(V,F,ge){return _(V,ge)===!0||V.isFramebufferTexture&&V.minFilter!==Ot&&V.minFilter!==Nt?Math.log2(Math.max(F.width,F.height))+1:V.mipmaps!==void 0&&V.mipmaps.length>0?V.mipmaps.length:V.isCompressedTexture&&Array.isArray(V.image)?F.mipmaps.length:1}function M(V){return V===Ot||V===Yy||V===Nh?s.NEAREST:s.LINEAR}function T(V){const F=V.target;F.removeEventListener("dispose",T),w(F),F.isVideoTexture&&u.delete(F)}function R(V){const F=V.target;F.removeEventListener("dispose",R),O(F)}function w(V){const F=i.get(V);if(F.__webglInit===void 0)return;const ge=V.source,_e=p.get(ge);if(_e){const Pe=_e[F.__cacheKey];Pe.usedTimes--,Pe.usedTimes===0&&I(V),Object.keys(_e).length===0&&p.delete(ge)}i.remove(V)}function I(V){const F=i.get(V);s.deleteTexture(F.__webglTexture);const ge=V.source,_e=p.get(ge);delete _e[F.__cacheKey],o.memory.textures--}function O(V){const F=i.get(V);if(V.depthTexture&&V.depthTexture.dispose(),V.isWebGLCubeRenderTarget)for(let _e=0;_e<6;_e++){if(Array.isArray(F.__webglFramebuffer[_e]))for(let Pe=0;Pe<F.__webglFramebuffer[_e].length;Pe++)s.deleteFramebuffer(F.__webglFramebuffer[_e][Pe]);else s.deleteFramebuffer(F.__webglFramebuffer[_e]);F.__webglDepthbuffer&&s.deleteRenderbuffer(F.__webglDepthbuffer[_e])}else{if(Array.isArray(F.__webglFramebuffer))for(let _e=0;_e<F.__webglFramebuffer.length;_e++)s.deleteFramebuffer(F.__webglFramebuffer[_e]);else s.deleteFramebuffer(F.__webglFramebuffer);if(F.__webglDepthbuffer&&s.deleteRenderbuffer(F.__webglDepthbuffer),F.__webglMultisampledFramebuffer&&s.deleteFramebuffer(F.__webglMultisampledFramebuffer),F.__webglColorRenderbuffer)for(let _e=0;_e<F.__webglColorRenderbuffer.length;_e++)F.__webglColorRenderbuffer[_e]&&s.deleteRenderbuffer(F.__webglColorRenderbuffer[_e]);F.__webglDepthRenderbuffer&&s.deleteRenderbuffer(F.__webglDepthRenderbuffer)}const ge=V.textures;for(let _e=0,Pe=ge.length;_e<Pe;_e++){const Te=i.get(ge[_e]);Te.__webglTexture&&(s.deleteTexture(Te.__webglTexture),o.memory.textures--),i.remove(ge[_e])}i.remove(V)}let k=0;function B(){k=0}function G(){const V=k;return V>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+V+" texture units while this GPU supports only "+n.maxTextures),k+=1,V}function L(V){const F=[];return F.push(V.wrapS),F.push(V.wrapT),F.push(V.wrapR||0),F.push(V.magFilter),F.push(V.minFilter),F.push(V.anisotropy),F.push(V.internalFormat),F.push(V.format),F.push(V.type),F.push(V.generateMipmaps),F.push(V.premultiplyAlpha),F.push(V.flipY),F.push(V.unpackAlignment),F.push(V.colorSpace),F.join()}function U(V,F){const ge=i.get(V);if(V.isVideoTexture&&et(V),V.isRenderTargetTexture===!1&&V.version>0&&ge.__version!==V.version){const _e=V.image;if(_e===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(_e.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{xe(ge,V,F);return}}t.bindTexture(s.TEXTURE_2D,ge.__webglTexture,s.TEXTURE0+F)}function z(V,F){const ge=i.get(V);if(V.version>0&&ge.__version!==V.version){xe(ge,V,F);return}t.bindTexture(s.TEXTURE_2D_ARRAY,ge.__webglTexture,s.TEXTURE0+F)}function j(V,F){const ge=i.get(V);if(V.version>0&&ge.__version!==V.version){xe(ge,V,F);return}t.bindTexture(s.TEXTURE_3D,ge.__webglTexture,s.TEXTURE0+F)}function X(V,F){const ge=i.get(V);if(V.version>0&&ge.__version!==V.version){Fe(ge,V,F);return}t.bindTexture(s.TEXTURE_CUBE_MAP,ge.__webglTexture,s.TEXTURE0+F)}const re={[Uo]:s.REPEAT,[as]:s.CLAMP_TO_EDGE,[Zp]:s.MIRRORED_REPEAT},ce={[Ot]:s.NEAREST,[Yy]:s.NEAREST_MIPMAP_NEAREST,[Nh]:s.NEAREST_MIPMAP_LINEAR,[Nt]:s.LINEAR,[Rp]:s.LINEAR_MIPMAP_NEAREST,[Do]:s.LINEAR_MIPMAP_LINEAR},Me={[h8]:s.NEVER,[g8]:s.ALWAYS,[u8]:s.LESS,[GO]:s.LEQUAL,[d8]:s.EQUAL,[m8]:s.GEQUAL,[f8]:s.GREATER,[p8]:s.NOTEQUAL};function se(V,F,ge){if(F.type===tn&&e.has("OES_texture_float_linear")===!1&&(F.magFilter===Nt||F.magFilter===Rp||F.magFilter===Nh||F.magFilter===Do||F.minFilter===Nt||F.minFilter===Rp||F.minFilter===Nh||F.minFilter===Do)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),ge?(s.texParameteri(V,s.TEXTURE_WRAP_S,re[F.wrapS]),s.texParameteri(V,s.TEXTURE_WRAP_T,re[F.wrapT]),(V===s.TEXTURE_3D||V===s.TEXTURE_2D_ARRAY)&&s.texParameteri(V,s.TEXTURE_WRAP_R,re[F.wrapR]),s.texParameteri(V,s.TEXTURE_MAG_FILTER,ce[F.magFilter]),s.texParameteri(V,s.TEXTURE_MIN_FILTER,ce[F.minFilter])):(s.texParameteri(V,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(V,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),(V===s.TEXTURE_3D||V===s.TEXTURE_2D_ARRAY)&&s.texParameteri(V,s.TEXTURE_WRAP_R,s.CLAMP_TO_EDGE),(F.wrapS!==as||F.wrapT!==as)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),s.texParameteri(V,s.TEXTURE_MAG_FILTER,M(F.magFilter)),s.texParameteri(V,s.TEXTURE_MIN_FILTER,M(F.minFilter)),F.minFilter!==Ot&&F.minFilter!==Nt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),F.compareFunction&&(s.texParameteri(V,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(V,s.TEXTURE_COMPARE_FUNC,Me[F.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(F.magFilter===Ot||F.minFilter!==Nh&&F.minFilter!==Do||F.type===tn&&e.has("OES_texture_float_linear")===!1||a===!1&&F.type===Cs&&e.has("OES_texture_half_float_linear")===!1)return;if(F.anisotropy>1||i.get(F).__currentAnisotropy){const _e=e.get("EXT_texture_filter_anisotropic");s.texParameterf(V,_e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(F.anisotropy,n.getMaxAnisotropy())),i.get(F).__currentAnisotropy=F.anisotropy}}}function ve(V,F){let ge=!1;V.__webglInit===void 0&&(V.__webglInit=!0,F.addEventListener("dispose",T));const _e=F.source;let Pe=p.get(_e);Pe===void 0&&(Pe={},p.set(_e,Pe));const Te=L(F);if(Te!==V.__cacheKey){Pe[Te]===void 0&&(Pe[Te]={texture:s.createTexture(),usedTimes:0},o.memory.textures++,ge=!0),Pe[Te].usedTimes++;const xt=Pe[V.__cacheKey];xt!==void 0&&(Pe[V.__cacheKey].usedTimes--,xt.usedTimes===0&&I(F)),V.__cacheKey=Te,V.__webglTexture=Pe[Te].texture}return ge}function xe(V,F,ge){let _e=s.TEXTURE_2D;(F.isDataArrayTexture||F.isCompressedArrayTexture)&&(_e=s.TEXTURE_2D_ARRAY),F.isData3DTexture&&(_e=s.TEXTURE_3D);const Pe=ve(V,F),Te=F.source;t.bindTexture(_e,V.__webglTexture,s.TEXTURE0+ge);const xt=i.get(Te);if(Te.version!==xt.__version||Pe===!0){t.activeTexture(s.TEXTURE0+ge);const ft=Ci.getPrimaries(Ci.workingColorSpace),Le=F.colorSpace===Bo?null:Ci.getPrimaries(F.colorSpace),Qe=F.colorSpace===Bo||ft===Le?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,F.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,F.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,Qe);const St=A(F)&&y(F.image)===!1;let ke=g(F.image,St,!1,n.maxTextureSize);ke=ct(F,ke);const ni=y(ke)||a,pt=r.convert(F.format,F.colorSpace);let Xe=r.convert(F.type),mt=x(F.internalFormat,pt,Xe,F.colorSpace,F.isVideoTexture);se(_e,F,ni);let at;const Lt=F.mipmaps,W=a&&F.isVideoTexture!==!0&&mt!==FO,ae=xt.__version===void 0||Pe===!0,$=Te.dataReady,De=E(F,ke,ni);if(F.isDepthTexture)mt=s.DEPTH_COMPONENT,a?F.type===tn?mt=s.DEPTH_COMPONENT32F:F.type===Hr?mt=s.DEPTH_COMPONENT24:F.type===Kh?mt=s.DEPTH24_STENCIL8:mt=s.DEPTH_COMPONENT16:F.type===tn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),F.format===Ed&&mt===s.DEPTH_COMPONENT&&F.type!==Cb&&F.type!==Hr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),F.type=Hr,Xe=r.convert(F.type)),F.format===Gd&&mt===s.DEPTH_COMPONENT&&(mt=s.DEPTH_STENCIL,F.type!==Kh&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),F.type=Kh,Xe=r.convert(F.type))),ae&&(W?t.texStorage2D(s.TEXTURE_2D,1,mt,ke.width,ke.height):t.texImage2D(s.TEXTURE_2D,0,mt,ke.width,ke.height,0,pt,Xe,null));else if(F.isDataTexture)if(Lt.length>0&&ni){W&&ae&&t.texStorage2D(s.TEXTURE_2D,De,mt,Lt[0].width,Lt[0].height);for(let he=0,Ve=Lt.length;he<Ve;he++)at=Lt[he],W?$&&t.texSubImage2D(s.TEXTURE_2D,he,0,0,at.width,at.height,pt,Xe,at.data):t.texImage2D(s.TEXTURE_2D,he,mt,at.width,at.height,0,pt,Xe,at.data);F.generateMipmaps=!1}else W?(ae&&t.texStorage2D(s.TEXTURE_2D,De,mt,ke.width,ke.height),$&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,ke.width,ke.height,pt,Xe,ke.data)):t.texImage2D(s.TEXTURE_2D,0,mt,ke.width,ke.height,0,pt,Xe,ke.data);else if(F.isCompressedTexture)if(F.isCompressedArrayTexture){W&&ae&&t.texStorage3D(s.TEXTURE_2D_ARRAY,De,mt,Lt[0].width,Lt[0].height,ke.depth);for(let he=0,Ve=Lt.length;he<Ve;he++)at=Lt[he],F.format!==Li?pt!==null?W?$&&t.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,he,0,0,0,at.width,at.height,ke.depth,pt,at.data,0,0):t.compressedTexImage3D(s.TEXTURE_2D_ARRAY,he,mt,at.width,at.height,ke.depth,0,at.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):W?$&&t.texSubImage3D(s.TEXTURE_2D_ARRAY,he,0,0,0,at.width,at.height,ke.depth,pt,Xe,at.data):t.texImage3D(s.TEXTURE_2D_ARRAY,he,mt,at.width,at.height,ke.depth,0,pt,Xe,at.data)}else{W&&ae&&t.texStorage2D(s.TEXTURE_2D,De,mt,Lt[0].width,Lt[0].height);for(let he=0,Ve=Lt.length;he<Ve;he++)at=Lt[he],F.format!==Li?pt!==null?W?$&&t.compressedTexSubImage2D(s.TEXTURE_2D,he,0,0,at.width,at.height,pt,at.data):t.compressedTexImage2D(s.TEXTURE_2D,he,mt,at.width,at.height,0,at.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):W?$&&t.texSubImage2D(s.TEXTURE_2D,he,0,0,at.width,at.height,pt,Xe,at.data):t.texImage2D(s.TEXTURE_2D,he,mt,at.width,at.height,0,pt,Xe,at.data)}else if(F.isDataArrayTexture)W?(ae&&t.texStorage3D(s.TEXTURE_2D_ARRAY,De,mt,ke.width,ke.height,ke.depth),$&&t.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,ke.width,ke.height,ke.depth,pt,Xe,ke.data)):t.texImage3D(s.TEXTURE_2D_ARRAY,0,mt,ke.width,ke.height,ke.depth,0,pt,Xe,ke.data);else if(F.isData3DTexture)W?(ae&&t.texStorage3D(s.TEXTURE_3D,De,mt,ke.width,ke.height,ke.depth),$&&t.texSubImage3D(s.TEXTURE_3D,0,0,0,0,ke.width,ke.height,ke.depth,pt,Xe,ke.data)):t.texImage3D(s.TEXTURE_3D,0,mt,ke.width,ke.height,ke.depth,0,pt,Xe,ke.data);else if(F.isFramebufferTexture){if(ae)if(W)t.texStorage2D(s.TEXTURE_2D,De,mt,ke.width,ke.height);else{let he=ke.width,Ve=ke.height;for(let Ye=0;Ye<De;Ye++)t.texImage2D(s.TEXTURE_2D,Ye,mt,he,Ve,0,pt,Xe,null),he>>=1,Ve>>=1}}else if(Lt.length>0&&ni){if(W&&ae){const he=zt(Lt[0]);t.texStorage2D(s.TEXTURE_2D,De,mt,he.width,he.height)}for(let he=0,Ve=Lt.length;he<Ve;he++)at=Lt[he],W?$&&t.texSubImage2D(s.TEXTURE_2D,he,0,0,pt,Xe,at):t.texImage2D(s.TEXTURE_2D,he,mt,pt,Xe,at);F.generateMipmaps=!1}else if(W){if(ae){const he=zt(ke);t.texStorage2D(s.TEXTURE_2D,De,mt,he.width,he.height)}$&&t.texSubImage2D(s.TEXTURE_2D,0,0,0,pt,Xe,ke)}else t.texImage2D(s.TEXTURE_2D,0,mt,pt,Xe,ke);_(F,ni)&&b(_e),xt.__version=Te.version,F.onUpdate&&F.onUpdate(F)}V.__version=F.version}function Fe(V,F,ge){if(F.image.length!==6)return;const _e=ve(V,F),Pe=F.source;t.bindTexture(s.TEXTURE_CUBE_MAP,V.__webglTexture,s.TEXTURE0+ge);const Te=i.get(Pe);if(Pe.version!==Te.__version||_e===!0){t.activeTexture(s.TEXTURE0+ge);const xt=Ci.getPrimaries(Ci.workingColorSpace),ft=F.colorSpace===Bo?null:Ci.getPrimaries(F.colorSpace),Le=F.colorSpace===Bo||xt===ft?s.NONE:s.BROWSER_DEFAULT_WEBGL;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,F.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,F.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,Le);const Qe=F.isCompressedTexture||F.image[0].isCompressedTexture,St=F.image[0]&&F.image[0].isDataTexture,ke=[];for(let he=0;he<6;he++)!Qe&&!St?ke[he]=g(F.image[he],!1,!0,n.maxCubemapSize):ke[he]=St?F.image[he].image:F.image[he],ke[he]=ct(F,ke[he]);const ni=ke[0],pt=y(ni)||a,Xe=r.convert(F.format,F.colorSpace),mt=r.convert(F.type),at=x(F.internalFormat,Xe,mt,F.colorSpace),Lt=a&&F.isVideoTexture!==!0,W=Te.__version===void 0||_e===!0,ae=Pe.dataReady;let $=E(F,ni,pt);se(s.TEXTURE_CUBE_MAP,F,pt);let De;if(Qe){Lt&&W&&t.texStorage2D(s.TEXTURE_CUBE_MAP,$,at,ni.width,ni.height);for(let he=0;he<6;he++){De=ke[he].mipmaps;for(let Ve=0;Ve<De.length;Ve++){const Ye=De[Ve];F.format!==Li?Xe!==null?Lt?ae&&t.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,Ve,0,0,Ye.width,Ye.height,Xe,Ye.data):t.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,Ve,at,Ye.width,Ye.height,0,Ye.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Lt?ae&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,Ve,0,0,Ye.width,Ye.height,Xe,mt,Ye.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,Ve,at,Ye.width,Ye.height,0,Xe,mt,Ye.data)}}}else{if(De=F.mipmaps,Lt&&W){De.length>0&&$++;const he=zt(ke[0]);t.texStorage2D(s.TEXTURE_CUBE_MAP,$,at,he.width,he.height)}for(let he=0;he<6;he++)if(St){Lt?ae&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,0,0,ke[he].width,ke[he].height,Xe,mt,ke[he].data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,at,ke[he].width,ke[he].height,0,Xe,mt,ke[he].data);for(let Ve=0;Ve<De.length;Ve++){const si=De[Ve].image[he].image;Lt?ae&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,Ve+1,0,0,si.width,si.height,Xe,mt,si.data):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,Ve+1,at,si.width,si.height,0,Xe,mt,si.data)}}else{Lt?ae&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,0,0,Xe,mt,ke[he]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,at,Xe,mt,ke[he]);for(let Ve=0;Ve<De.length;Ve++){const Ye=De[Ve];Lt?ae&&t.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,Ve+1,0,0,Xe,mt,Ye.image[he]):t.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+he,Ve+1,at,Xe,mt,Ye.image[he])}}}_(F,pt)&&b(s.TEXTURE_CUBE_MAP),Te.__version=Pe.version,F.onUpdate&&F.onUpdate(F)}V.__version=F.version}function Ge(V,F,ge,_e,Pe,Te){const xt=r.convert(ge.format,ge.colorSpace),ft=r.convert(ge.type),Le=x(ge.internalFormat,xt,ft,ge.colorSpace);if(!i.get(F).__hasExternalTextures){const St=Math.max(1,F.width>>Te),ke=Math.max(1,F.height>>Te);Pe===s.TEXTURE_3D||Pe===s.TEXTURE_2D_ARRAY?t.texImage3D(Pe,Te,Le,St,ke,F.depth,0,xt,ft,null):t.texImage2D(Pe,Te,Le,St,ke,0,xt,ft,null)}t.bindFramebuffer(s.FRAMEBUFFER,V),st(F)?l.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,_e,Pe,i.get(ge).__webglTexture,0,Ee(F)):(Pe===s.TEXTURE_2D||Pe>=s.TEXTURE_CUBE_MAP_POSITIVE_X&&Pe<=s.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&s.framebufferTexture2D(s.FRAMEBUFFER,_e,Pe,i.get(ge).__webglTexture,Te),t.bindFramebuffer(s.FRAMEBUFFER,null)}function je(V,F,ge){if(s.bindRenderbuffer(s.RENDERBUFFER,V),F.depthBuffer&&!F.stencilBuffer){let _e=a===!0?s.DEPTH_COMPONENT24:s.DEPTH_COMPONENT16;if(ge||st(F)){const Pe=F.depthTexture;Pe&&Pe.isDepthTexture&&(Pe.type===tn?_e=s.DEPTH_COMPONENT32F:Pe.type===Hr&&(_e=s.DEPTH_COMPONENT24));const Te=Ee(F);st(F)?l.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Te,_e,F.width,F.height):s.renderbufferStorageMultisample(s.RENDERBUFFER,Te,_e,F.width,F.height)}else s.renderbufferStorage(s.RENDERBUFFER,_e,F.width,F.height);s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,V)}else if(F.depthBuffer&&F.stencilBuffer){const _e=Ee(F);ge&&st(F)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,_e,s.DEPTH24_STENCIL8,F.width,F.height):st(F)?l.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,_e,s.DEPTH24_STENCIL8,F.width,F.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,F.width,F.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,V)}else{const _e=F.textures;for(let Pe=0;Pe<_e.length;Pe++){const Te=_e[Pe],xt=r.convert(Te.format,Te.colorSpace),ft=r.convert(Te.type),Le=x(Te.internalFormat,xt,ft,Te.colorSpace),Qe=Ee(F);ge&&st(F)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,Qe,Le,F.width,F.height):st(F)?l.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Qe,Le,F.width,F.height):s.renderbufferStorage(s.RENDERBUFFER,Le,F.width,F.height)}}s.bindRenderbuffer(s.RENDERBUFFER,null)}function lt(V,F){if(F&&F.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(s.FRAMEBUFFER,V),!(F.depthTexture&&F.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(F.depthTexture).__webglTexture||F.depthTexture.image.width!==F.width||F.depthTexture.image.height!==F.height)&&(F.depthTexture.image.width=F.width,F.depthTexture.image.height=F.height,F.depthTexture.needsUpdate=!0),U(F.depthTexture,0);const _e=i.get(F.depthTexture).__webglTexture,Pe=Ee(F);if(F.depthTexture.format===Ed)st(F)?l.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,_e,0,Pe):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,_e,0);else if(F.depthTexture.format===Gd)st(F)?l.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,_e,0,Pe):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,_e,0);else throw new Error("Unknown depthTexture format")}function ot(V){const F=i.get(V),ge=V.isWebGLCubeRenderTarget===!0;if(V.depthTexture&&!F.__autoAllocateDepthBuffer){if(ge)throw new Error("target.depthTexture not supported in Cube render targets");lt(F.__webglFramebuffer,V)}else if(ge){F.__webglDepthbuffer=[];for(let _e=0;_e<6;_e++)t.bindFramebuffer(s.FRAMEBUFFER,F.__webglFramebuffer[_e]),F.__webglDepthbuffer[_e]=s.createRenderbuffer(),je(F.__webglDepthbuffer[_e],V,!1)}else t.bindFramebuffer(s.FRAMEBUFFER,F.__webglFramebuffer),F.__webglDepthbuffer=s.createRenderbuffer(),je(F.__webglDepthbuffer,V,!1);t.bindFramebuffer(s.FRAMEBUFFER,null)}function q(V,F,ge){const _e=i.get(V);F!==void 0&&Ge(_e.__webglFramebuffer,V,V.texture,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,0),ge!==void 0&&ot(V)}function He(V){const F=V.texture,ge=i.get(V),_e=i.get(F);V.addEventListener("dispose",R);const Pe=V.textures,Te=V.isWebGLCubeRenderTarget===!0,xt=Pe.length>1,ft=y(V)||a;if(xt||(_e.__webglTexture===void 0&&(_e.__webglTexture=s.createTexture()),_e.__version=F.version,o.memory.textures++),Te){ge.__webglFramebuffer=[];for(let Le=0;Le<6;Le++)if(a&&F.mipmaps&&F.mipmaps.length>0){ge.__webglFramebuffer[Le]=[];for(let Qe=0;Qe<F.mipmaps.length;Qe++)ge.__webglFramebuffer[Le][Qe]=s.createFramebuffer()}else ge.__webglFramebuffer[Le]=s.createFramebuffer()}else{if(a&&F.mipmaps&&F.mipmaps.length>0){ge.__webglFramebuffer=[];for(let Le=0;Le<F.mipmaps.length;Le++)ge.__webglFramebuffer[Le]=s.createFramebuffer()}else ge.__webglFramebuffer=s.createFramebuffer();if(xt)if(n.drawBuffers)for(let Le=0,Qe=Pe.length;Le<Qe;Le++){const St=i.get(Pe[Le]);St.__webglTexture===void 0&&(St.__webglTexture=s.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&V.samples>0&&st(V)===!1){ge.__webglMultisampledFramebuffer=s.createFramebuffer(),ge.__webglColorRenderbuffer=[],t.bindFramebuffer(s.FRAMEBUFFER,ge.__webglMultisampledFramebuffer);for(let Le=0;Le<Pe.length;Le++){const Qe=Pe[Le];ge.__webglColorRenderbuffer[Le]=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,ge.__webglColorRenderbuffer[Le]);const St=r.convert(Qe.format,Qe.colorSpace),ke=r.convert(Qe.type),ni=x(Qe.internalFormat,St,ke,Qe.colorSpace,V.isXRRenderTarget===!0),pt=Ee(V);s.renderbufferStorageMultisample(s.RENDERBUFFER,pt,ni,V.width,V.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Le,s.RENDERBUFFER,ge.__webglColorRenderbuffer[Le])}s.bindRenderbuffer(s.RENDERBUFFER,null),V.depthBuffer&&(ge.__webglDepthRenderbuffer=s.createRenderbuffer(),je(ge.__webglDepthRenderbuffer,V,!0)),t.bindFramebuffer(s.FRAMEBUFFER,null)}}if(Te){t.bindTexture(s.TEXTURE_CUBE_MAP,_e.__webglTexture),se(s.TEXTURE_CUBE_MAP,F,ft);for(let Le=0;Le<6;Le++)if(a&&F.mipmaps&&F.mipmaps.length>0)for(let Qe=0;Qe<F.mipmaps.length;Qe++)Ge(ge.__webglFramebuffer[Le][Qe],V,F,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+Le,Qe);else Ge(ge.__webglFramebuffer[Le],V,F,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0);_(F,ft)&&b(s.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(xt){for(let Le=0,Qe=Pe.length;Le<Qe;Le++){const St=Pe[Le],ke=i.get(St);t.bindTexture(s.TEXTURE_2D,ke.__webglTexture),se(s.TEXTURE_2D,St,ft),Ge(ge.__webglFramebuffer,V,St,s.COLOR_ATTACHMENT0+Le,s.TEXTURE_2D,0),_(St,ft)&&b(s.TEXTURE_2D)}t.unbindTexture()}else{let Le=s.TEXTURE_2D;if((V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(a?Le=V.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Le,_e.__webglTexture),se(Le,F,ft),a&&F.mipmaps&&F.mipmaps.length>0)for(let Qe=0;Qe<F.mipmaps.length;Qe++)Ge(ge.__webglFramebuffer[Qe],V,F,s.COLOR_ATTACHMENT0,Le,Qe);else Ge(ge.__webglFramebuffer,V,F,s.COLOR_ATTACHMENT0,Le,0);_(F,ft)&&b(Le),t.unbindTexture()}V.depthBuffer&&ot(V)}function we(V){const F=y(V)||a,ge=V.textures;for(let _e=0,Pe=ge.length;_e<Pe;_e++){const Te=ge[_e];if(_(Te,F)){const xt=V.isWebGLCubeRenderTarget?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D,ft=i.get(Te).__webglTexture;t.bindTexture(xt,ft),b(xt),t.unbindTexture()}}}function Ne(V){if(a&&V.samples>0&&st(V)===!1){const F=V.textures,ge=V.width,_e=V.height;let Pe=s.COLOR_BUFFER_BIT;const Te=[],xt=V.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,ft=i.get(V),Le=F.length>1;if(Le)for(let Qe=0;Qe<F.length;Qe++)t.bindFramebuffer(s.FRAMEBUFFER,ft.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Qe,s.RENDERBUFFER,null),t.bindFramebuffer(s.FRAMEBUFFER,ft.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Qe,s.TEXTURE_2D,null,0);t.bindFramebuffer(s.READ_FRAMEBUFFER,ft.__webglMultisampledFramebuffer),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,ft.__webglFramebuffer);for(let Qe=0;Qe<F.length;Qe++){Te.push(s.COLOR_ATTACHMENT0+Qe),V.depthBuffer&&Te.push(xt);const St=ft.__ignoreDepthValues!==void 0?ft.__ignoreDepthValues:!1;if(St===!1&&(V.depthBuffer&&(Pe|=s.DEPTH_BUFFER_BIT),V.stencilBuffer&&(Pe|=s.STENCIL_BUFFER_BIT)),Le&&s.framebufferRenderbuffer(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,ft.__webglColorRenderbuffer[Qe]),St===!0&&(s.invalidateFramebuffer(s.READ_FRAMEBUFFER,[xt]),s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,[xt])),Le){const ke=i.get(F[Qe]).__webglTexture;s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,ke,0)}s.blitFramebuffer(0,0,ge,_e,0,0,ge,_e,Pe,s.NEAREST),c&&s.invalidateFramebuffer(s.READ_FRAMEBUFFER,Te)}if(t.bindFramebuffer(s.READ_FRAMEBUFFER,null),t.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),Le)for(let Qe=0;Qe<F.length;Qe++){t.bindFramebuffer(s.FRAMEBUFFER,ft.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Qe,s.RENDERBUFFER,ft.__webglColorRenderbuffer[Qe]);const St=i.get(F[Qe]).__webglTexture;t.bindFramebuffer(s.FRAMEBUFFER,ft.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+Qe,s.TEXTURE_2D,St,0)}t.bindFramebuffer(s.DRAW_FRAMEBUFFER,ft.__webglMultisampledFramebuffer)}}function Ee(V){return Math.min(n.maxSamples,V.samples)}function st(V){const F=i.get(V);return a&&V.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&F.__useRenderToTexture!==!1}function et(V){const F=o.render.frame;u.get(V)!==F&&(u.set(V,F),V.update())}function ct(V,F){const ge=V.colorSpace,_e=V.format,Pe=V.type;return V.isCompressedTexture===!0||V.isVideoTexture===!0||V.format===k1||ge!==zi&&ge!==Bo&&(Ci.getTransfer(ge)===Yi?a===!1?e.has("EXT_sRGB")===!0&&_e===Li?(V.format=k1,V.minFilter=Nt,V.generateMipmaps=!1):F=VO.sRGBToLinear(F):(_e!==Li||Pe!==wn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ge)),F}function zt(V){return typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement?(h.width=V.naturalWidth||V.width,h.height=V.naturalHeight||V.height):typeof VideoFrame<"u"&&V instanceof VideoFrame?(h.width=V.displayWidth,h.height=V.displayHeight):(h.width=V.width,h.height=V.height),h}this.allocateTextureUnit=G,this.resetTextureUnits=B,this.setTexture2D=U,this.setTexture2DArray=z,this.setTexture3D=j,this.setTextureCube=X,this.rebindTextures=q,this.setupRenderTarget=He,this.updateRenderTargetMipmap=we,this.updateMultisampleRenderTarget=Ne,this.setupDepthRenderbuffer=ot,this.setupFrameBufferTexture=Ge,this.useMultisampledRTT=st}function L8(s,e,t){const i=t.isWebGL2;function n(r,o=Bo){let a;const l=Ci.getTransfer(o);if(r===wn)return s.UNSIGNED_BYTE;if(r===LO)return s.UNSIGNED_SHORT_4_4_4_4;if(r===kO)return s.UNSIGNED_SHORT_5_5_5_1;if(r===B1)return s.BYTE;if(r===OO)return s.SHORT;if(r===Cb)return s.UNSIGNED_SHORT;if(r===Pp)return s.INT;if(r===Hr)return s.UNSIGNED_INT;if(r===tn)return s.FLOAT;if(r===Cs)return i?s.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===Q5)return s.ALPHA;if(r===Li)return s.RGBA;if(r===WE)return s.LUMINANCE;if(r===W5)return s.LUMINANCE_ALPHA;if(r===Ed)return s.DEPTH_COMPONENT;if(r===Gd)return s.DEPTH_STENCIL;if(r===k1)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===um)return s.RED;if(r===jE)return s.RED_INTEGER;if(r===qE)return s.RG;if(r===Eb)return s.RG_INTEGER;if(r===Ky)return s.RGBA_INTEGER;if(r===zC||r===GC||r===HC||r===VC)if(l===Yi)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===zC)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===GC)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===HC)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===VC)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===zC)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===GC)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===HC)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===VC)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===VB||r===QB||r===WB||r===jB)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===VB)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===QB)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===WB)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===jB)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===FO)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===qB||r===XB)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===qB)return l===Yi?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===XB)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===YB||r===KB||r===JB||r===ZB||r===$B||r===e2||r===t2||r===i2||r===n2||r===s2||r===r2||r===o2||r===a2||r===l2)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===YB)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===KB)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===JB)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===ZB)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===$B)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===e2)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===t2)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===i2)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===n2)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===s2)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===r2)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===o2)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===a2)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===l2)return l===Yi?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===QC||r===c2||r===h2)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===QC)return l===Yi?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===c2)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===h2)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===j5||r===u2||r===d2||r===f2)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(r===QC)return a.COMPRESSED_RED_RGTC1_EXT;if(r===u2)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===d2)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===f2)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Kh?i?s.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):s[r]!==void 0?s[r]:null}return{convert:n}}class KO extends Vt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}let Vs=class extends ye{constructor(){super(),this.isGroup=!0,this.type="Group"}};const yee={type:"move"};class EI{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Vs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Vs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new S,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new S),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Vs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new S,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new S),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const v of e.hand.values()){const g=t.getJointPose(v,i),y=this._getHandJoint(c,v);g!==null&&(y.matrix.fromArray(g.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=g.radius),y.visible=g!==null}const h=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],f=h.position.distanceTo(u.position),p=.02,m=.005;c.inputState.pinching&&f>p+m?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=p-m&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(n=t.getPose(e.targetRaySpace,i),n===null&&r!==null&&(n=r),n!==null&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(yee)))}return a!==null&&(a.visible=n!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Vs;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const vee=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Aee=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class _ee{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const n=new Wt,r=e.properties.get(n);r.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=n}}render(e,t){if(this.texture!==null){if(this.mesh===null){const i=t.cameras[0].viewport,n=new kt({extensions:{fragDepth:!0},vertexShader:vee,fragmentShader:Aee,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new fe(new ps(20,20),n)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class bee extends js{constructor(e,t){super();const i=this;let n=null,r=1,o=null,a="local-floor",l=1,c=null,h=null,u=null,f=null,p=null,m=null;const v=new _ee,g=t.getContextAttributes();let y=null,A=null;const _=[],b=[],x=new ee;let E=null;const M=new Vt;M.layers.enable(1),M.viewport=new Je;const T=new Vt;T.layers.enable(2),T.viewport=new Je;const R=[M,T],w=new KO;w.layers.enable(1),w.layers.enable(2);let I=null,O=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.controllerAutoUpdate=!0,this.getController=function(se){let ve=_[se];return ve===void 0&&(ve=new EI,_[se]=ve),ve.getTargetRaySpace()},this.getControllerGrip=function(se){let ve=_[se];return ve===void 0&&(ve=new EI,_[se]=ve),ve.getGripSpace()},this.getHand=function(se){let ve=_[se];return ve===void 0&&(ve=new EI,_[se]=ve),ve.getHandSpace()};function k(se){const ve=b.indexOf(se.inputSource);if(ve===-1)return;const xe=_[ve];xe!==void 0&&(xe.update(se.inputSource,se.frame,c||o),xe.dispatchEvent({type:se.type,data:se.inputSource}))}function B(){var se;n.removeEventListener("select",k),n.removeEventListener("selectstart",k),n.removeEventListener("selectend",k),n.removeEventListener("squeeze",k),n.removeEventListener("squeezestart",k),n.removeEventListener("squeezeend",k),n.removeEventListener("end",B),n.removeEventListener("inputsourceschange",G);for(let ve=0;ve<_.length;ve++){const xe=b[ve];xe!==null&&(b[ve]=null,(se=_[ve])==null||se.disconnect(xe))}I=null,O=null,v.reset(),e.setRenderTarget(y),p=null,f=null,u=null,n=null,A=null,Me.stop(),i.isPresenting=!1,e.setPixelRatio(E),e.setSize(x.width,x.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(se){r=se,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(se){a=se,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(se){c=se},this.getBaseLayer=function(){return f!==null?f:p},this.getBinding=function(){return u},this.getFrame=function(){return m},this.getSession=function(){return n},this.setSession=async function(se){if(n=se,n!==null){if(y=e.getRenderTarget(),n.addEventListener("select",k),n.addEventListener("selectstart",k),n.addEventListener("selectend",k),n.addEventListener("squeeze",k),n.addEventListener("squeezestart",k),n.addEventListener("squeezeend",k),n.addEventListener("end",B),n.addEventListener("inputsourceschange",G),g.xrCompatible!==!0&&await t.makeXRCompatible(),E=e.getPixelRatio(),e.getSize(x),n.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const ve={antialias:n.renderState.layers===void 0?g.antialias:!0,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};p=new XRWebGLLayer(n,t,ve),n.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),A=new $t(p.framebufferWidth,p.framebufferHeight,{format:Li,type:wn,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}else{let ve=null,xe=null,Fe=null;g.depth&&(Fe=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ve=g.stencil?Gd:Ed,xe=g.stencil?Kh:Hr);const Ge={colorFormat:t.RGBA8,depthFormat:Fe,scaleFactor:r};u=new XRWebGLBinding(n,t),f=u.createProjectionLayer(Ge),n.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),A=new $t(f.textureWidth,f.textureHeight,{format:Li,type:wn,depthTexture:new Av(f.textureWidth,f.textureHeight,xe,void 0,void 0,void 0,void 0,void 0,void 0,ve),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0});const je=e.properties.get(A);je.__ignoreDepthValues=f.ignoreDepthValues}A.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await n.requestReferenceSpace(a),Me.setContext(n),Me.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode};function G(se){var ve;for(let xe=0;xe<se.removed.length;xe++){const Fe=se.removed[xe],Ge=b.indexOf(Fe);Ge>=0&&(b[Ge]=null,(ve=_[Ge])==null||ve.disconnect(Fe))}for(let xe=0;xe<se.added.length;xe++){const Fe=se.added[xe];let Ge=b.indexOf(Fe);if(Ge===-1){for(let lt=0;lt<_.length;lt++)if(lt>=b.length){b.push(Fe),Ge=lt;break}else if(b[lt]===null){b[lt]=Fe,Ge=lt;break}if(Ge===-1)break}const je=_[Ge];je&&je.connect(Fe)}}const L=new S,U=new S;function z(se,ve,xe){L.setFromMatrixPosition(ve.matrixWorld),U.setFromMatrixPosition(xe.matrixWorld);const Fe=L.distanceTo(U),Ge=ve.projectionMatrix.elements,je=xe.projectionMatrix.elements,lt=Ge[14]/(Ge[10]-1),ot=Ge[14]/(Ge[10]+1),q=(Ge[9]+1)/Ge[5],He=(Ge[9]-1)/Ge[5],we=(Ge[8]-1)/Ge[0],Ne=(je[8]+1)/je[0],Ee=lt*we,st=lt*Ne,et=Fe/(-we+Ne),ct=et*-we;ve.matrixWorld.decompose(se.position,se.quaternion,se.scale),se.translateX(ct),se.translateZ(et),se.matrixWorld.compose(se.position,se.quaternion,se.scale),se.matrixWorldInverse.copy(se.matrixWorld).invert();const zt=lt+et,V=ot+et,F=Ee-ct,ge=st+(Fe-ct),_e=q*ot/V*zt,Pe=He*ot/V*zt;se.projectionMatrix.makePerspective(F,ge,_e,Pe,zt,V),se.projectionMatrixInverse.copy(se.projectionMatrix).invert()}function j(se,ve){ve===null?se.matrixWorld.copy(se.matrix):se.matrixWorld.multiplyMatrices(ve.matrixWorld,se.matrix),se.matrixWorldInverse.copy(se.matrixWorld).invert()}this.updateCamera=function(se){if(n===null)return;v.texture!==null&&(v.depthNear>0&&(se.near=v.depthNear),v.depthFar>0&&(se.far=v.depthFar)),w.near=T.near=M.near=se.near,w.far=T.far=M.far=se.far,(I!==w.near||O!==w.far)&&(n.updateRenderState({depthNear:w.near,depthFar:w.far}),I=w.near,O=w.far,M.near=I,M.far=O,T.near=I,T.far=O,M.updateProjectionMatrix(),T.updateProjectionMatrix(),se.updateProjectionMatrix());const ve=se.parent,xe=w.cameras;j(w,ve);for(let Fe=0;Fe<xe.length;Fe++)j(xe[Fe],ve);xe.length===2?z(w,M,T):w.projectionMatrix.copy(M.projectionMatrix),X(se,w,ve)};function X(se,ve,xe){xe===null?se.matrix.copy(ve.matrixWorld):(se.matrix.copy(xe.matrixWorld),se.matrix.invert(),se.matrix.multiply(ve.matrixWorld)),se.matrix.decompose(se.position,se.quaternion,se.scale),se.updateMatrixWorld(!0),se.projectionMatrix.copy(ve.projectionMatrix),se.projectionMatrixInverse.copy(ve.projectionMatrixInverse),se.isPerspectiveCamera&&(se.fov=Jy*2*Math.atan(1/se.projectionMatrix.elements[5]),se.zoom=1)}this.getCamera=function(){return w},this.getFoveation=function(){if(!(f===null&&p===null))return l},this.setFoveation=function(se){l=se,f!==null&&(f.fixedFoveation=se),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=se)},this.hasDepthSensing=function(){return v.texture!==null};let re=null;function ce(se,ve){if(h=ve.getViewerPose(c||o),m=ve,h!==null){const xe=h.views;p!==null&&(e.setRenderTargetFramebuffer(A,p.framebuffer),e.setRenderTarget(A));let Fe=!1;xe.length!==w.cameras.length&&(w.cameras.length=0,Fe=!0);for(let je=0;je<xe.length;je++){const lt=xe[je];let ot=null;if(p!==null)ot=p.getViewport(lt);else{const He=u.getViewSubImage(f,lt);ot=He.viewport,je===0&&(e.setRenderTargetTextures(A,He.colorTexture,f.ignoreDepthValues?void 0:He.depthStencilTexture),e.setRenderTarget(A))}let q=R[je];q===void 0&&(q=new Vt,q.layers.enable(je),q.viewport=new Je,R[je]=q),q.matrix.fromArray(lt.transform.matrix),q.matrix.decompose(q.position,q.quaternion,q.scale),q.projectionMatrix.fromArray(lt.projectionMatrix),q.projectionMatrixInverse.copy(q.projectionMatrix).invert(),q.viewport.set(ot.x,ot.y,ot.width,ot.height),je===0&&(w.matrix.copy(q.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),Fe===!0&&w.cameras.push(q)}const Ge=n.enabledFeatures;if(Ge&&Ge.includes("depth-sensing")){const je=u.getDepthInformation(xe[0]);je&&je.isValid&&je.texture&&v.init(e,je,n.renderState)}}if(i.controllerAutoUpdate)for(let xe=0;xe<_.length;xe++){const Fe=b[xe],Ge=_[xe];Fe!==null&&Ge!==void 0&&Ge.update(Fe,ve,c||o)}v.render(e,w),re&&re(se,ve),ve.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:ve}),m=null}const Me=new I8;Me.setAnimationLoop(ce),this.setAnimationLoop=function(se){re=se},this.dispose=function(){}}}const Pf=new li,xee=new le;function wee(s,e){function t(g,y){g.matrixAutoUpdate===!0&&g.updateMatrix(),y.value.copy(g.matrix)}function i(g,y){y.color.getRGB(g.fogColor.value,T8(s)),y.isFog?(g.fogNear.value=y.near,g.fogFar.value=y.far):y.isFogExp2&&(g.fogDensity.value=y.density)}function n(g,y,A,_,b){y.isMeshBasicMaterial||y.isMeshLambertMaterial?r(g,y):y.isMeshToonMaterial?(r(g,y),u(g,y)):y.isMeshPhongMaterial?(r(g,y),h(g,y)):y.isMeshStandardMaterial?(r(g,y),f(g,y),y.isMeshPhysicalMaterial&&p(g,y,b)):y.isMeshMatcapMaterial?(r(g,y),m(g,y)):y.isMeshDepthMaterial?r(g,y):y.isMeshDistanceMaterial?(r(g,y),v(g,y)):y.isMeshNormalMaterial?r(g,y):y.isLineBasicMaterial?(o(g,y),y.isLineDashedMaterial&&a(g,y)):y.isPointsMaterial?l(g,y,A,_):y.isSpriteMaterial?c(g,y):y.isShadowMaterial?(g.color.value.copy(y.color),g.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function r(g,y){g.opacity.value=y.opacity,y.color&&g.diffuse.value.copy(y.color),y.emissive&&g.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(g.map.value=y.map,t(y.map,g.mapTransform)),y.alphaMap&&(g.alphaMap.value=y.alphaMap,t(y.alphaMap,g.alphaMapTransform)),y.bumpMap&&(g.bumpMap.value=y.bumpMap,t(y.bumpMap,g.bumpMapTransform),g.bumpScale.value=y.bumpScale,y.side===bn&&(g.bumpScale.value*=-1)),y.normalMap&&(g.normalMap.value=y.normalMap,t(y.normalMap,g.normalMapTransform),g.normalScale.value.copy(y.normalScale),y.side===bn&&g.normalScale.value.negate()),y.displacementMap&&(g.displacementMap.value=y.displacementMap,t(y.displacementMap,g.displacementMapTransform),g.displacementScale.value=y.displacementScale,g.displacementBias.value=y.displacementBias),y.emissiveMap&&(g.emissiveMap.value=y.emissiveMap,t(y.emissiveMap,g.emissiveMapTransform)),y.specularMap&&(g.specularMap.value=y.specularMap,t(y.specularMap,g.specularMapTransform)),y.alphaTest>0&&(g.alphaTest.value=y.alphaTest);const A=e.get(y),_=A.envMap,b=A.envMapRotation;if(_&&(g.envMap.value=_,Pf.copy(b),Pf.x*=-1,Pf.y*=-1,Pf.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&(Pf.y*=-1,Pf.z*=-1),g.envMapRotation.value.setFromMatrix4(xee.makeRotationFromEuler(Pf)),g.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=y.reflectivity,g.ior.value=y.ior,g.refractionRatio.value=y.refractionRatio),y.lightMap){g.lightMap.value=y.lightMap;const x=s._useLegacyLights===!0?Math.PI:1;g.lightMapIntensity.value=y.lightMapIntensity*x,t(y.lightMap,g.lightMapTransform)}y.aoMap&&(g.aoMap.value=y.aoMap,g.aoMapIntensity.value=y.aoMapIntensity,t(y.aoMap,g.aoMapTransform))}function o(g,y){g.diffuse.value.copy(y.color),g.opacity.value=y.opacity,y.map&&(g.map.value=y.map,t(y.map,g.mapTransform))}function a(g,y){g.dashSize.value=y.dashSize,g.totalSize.value=y.dashSize+y.gapSize,g.scale.value=y.scale}function l(g,y,A,_){g.diffuse.value.copy(y.color),g.opacity.value=y.opacity,g.size.value=y.size*A,g.scale.value=_*.5,y.map&&(g.map.value=y.map,t(y.map,g.uvTransform)),y.alphaMap&&(g.alphaMap.value=y.alphaMap,t(y.alphaMap,g.alphaMapTransform)),y.alphaTest>0&&(g.alphaTest.value=y.alphaTest)}function c(g,y){g.diffuse.value.copy(y.color),g.opacity.value=y.opacity,g.rotation.value=y.rotation,y.map&&(g.map.value=y.map,t(y.map,g.mapTransform)),y.alphaMap&&(g.alphaMap.value=y.alphaMap,t(y.alphaMap,g.alphaMapTransform)),y.alphaTest>0&&(g.alphaTest.value=y.alphaTest)}function h(g,y){g.specular.value.copy(y.specular),g.shininess.value=Math.max(y.shininess,1e-4)}function u(g,y){y.gradientMap&&(g.gradientMap.value=y.gradientMap)}function f(g,y){g.metalness.value=y.metalness,y.metalnessMap&&(g.metalnessMap.value=y.metalnessMap,t(y.metalnessMap,g.metalnessMapTransform)),g.roughness.value=y.roughness,y.roughnessMap&&(g.roughnessMap.value=y.roughnessMap,t(y.roughnessMap,g.roughnessMapTransform)),e.get(y).envMap&&(g.envMapIntensity.value=y.envMapIntensity)}function p(g,y,A){g.ior.value=y.ior,y.sheen>0&&(g.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),g.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(g.sheenColorMap.value=y.sheenColorMap,t(y.sheenColorMap,g.sheenColorMapTransform)),y.sheenRoughnessMap&&(g.sheenRoughnessMap.value=y.sheenRoughnessMap,t(y.sheenRoughnessMap,g.sheenRoughnessMapTransform))),y.clearcoat>0&&(g.clearcoat.value=y.clearcoat,g.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(g.clearcoatMap.value=y.clearcoatMap,t(y.clearcoatMap,g.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,t(y.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(g.clearcoatNormalMap.value=y.clearcoatNormalMap,t(y.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===bn&&g.clearcoatNormalScale.value.negate())),y.iridescence>0&&(g.iridescence.value=y.iridescence,g.iridescenceIOR.value=y.iridescenceIOR,g.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(g.iridescenceMap.value=y.iridescenceMap,t(y.iridescenceMap,g.iridescenceMapTransform)),y.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=y.iridescenceThicknessMap,t(y.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),y.transmission>0&&(g.transmission.value=y.transmission,g.transmissionSamplerMap.value=A.texture,g.transmissionSamplerSize.value.set(A.width,A.height),y.transmissionMap&&(g.transmissionMap.value=y.transmissionMap,t(y.transmissionMap,g.transmissionMapTransform)),g.thickness.value=y.thickness,y.thicknessMap&&(g.thicknessMap.value=y.thicknessMap,t(y.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=y.attenuationDistance,g.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(g.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(g.anisotropyMap.value=y.anisotropyMap,t(y.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=y.specularIntensity,g.specularColor.value.copy(y.specularColor),y.specularColorMap&&(g.specularColorMap.value=y.specularColorMap,t(y.specularColorMap,g.specularColorMapTransform)),y.specularIntensityMap&&(g.specularIntensityMap.value=y.specularIntensityMap,t(y.specularIntensityMap,g.specularIntensityMapTransform))}function m(g,y){y.matcap&&(g.matcap.value=y.matcap)}function v(g,y){const A=e.get(y).light;g.referencePosition.value.setFromMatrixPosition(A.matrixWorld),g.nearDistance.value=A.shadow.camera.near,g.farDistance.value=A.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:n}}function See(s,e,t,i){let n={},r={},o=[];const a=t.isWebGL2?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(A,_){const b=_.program;i.uniformBlockBinding(A,b)}function c(A,_){let b=n[A.id];b===void 0&&(m(A),b=h(A),n[A.id]=b,A.addEventListener("dispose",g));const x=_.program;i.updateUBOMapping(A,x);const E=e.render.frame;r[A.id]!==E&&(f(A),r[A.id]=E)}function h(A){const _=u();A.__bindingPointIndex=_;const b=s.createBuffer(),x=A.__size,E=A.usage;return s.bindBuffer(s.UNIFORM_BUFFER,b),s.bufferData(s.UNIFORM_BUFFER,x,E),s.bindBuffer(s.UNIFORM_BUFFER,null),s.bindBufferBase(s.UNIFORM_BUFFER,_,b),b}function u(){for(let A=0;A<a;A++)if(o.indexOf(A)===-1)return o.push(A),A;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(A){const _=n[A.id],b=A.uniforms,x=A.__cache;s.bindBuffer(s.UNIFORM_BUFFER,_);for(let E=0,M=b.length;E<M;E++){const T=Array.isArray(b[E])?b[E]:[b[E]];for(let R=0,w=T.length;R<w;R++){const I=T[R];if(p(I,E,R,x)===!0){const O=I.__offset,k=Array.isArray(I.value)?I.value:[I.value];let B=0;for(let G=0;G<k.length;G++){const L=k[G],U=v(L);typeof L=="number"||typeof L=="boolean"?(I.__data[0]=L,s.bufferSubData(s.UNIFORM_BUFFER,O+B,I.__data)):L.isMatrix3?(I.__data[0]=L.elements[0],I.__data[1]=L.elements[1],I.__data[2]=L.elements[2],I.__data[3]=0,I.__data[4]=L.elements[3],I.__data[5]=L.elements[4],I.__data[6]=L.elements[5],I.__data[7]=0,I.__data[8]=L.elements[6],I.__data[9]=L.elements[7],I.__data[10]=L.elements[8],I.__data[11]=0):(L.toArray(I.__data,B),B+=U.storage/Float32Array.BYTES_PER_ELEMENT)}s.bufferSubData(s.UNIFORM_BUFFER,O,I.__data)}}}s.bindBuffer(s.UNIFORM_BUFFER,null)}function p(A,_,b,x){const E=A.value,M=_+"_"+b;if(x[M]===void 0)return typeof E=="number"||typeof E=="boolean"?x[M]=E:x[M]=E.clone(),!0;{const T=x[M];if(typeof E=="number"||typeof E=="boolean"){if(T!==E)return x[M]=E,!0}else if(T.equals(E)===!1)return T.copy(E),!0}return!1}function m(A){const _=A.uniforms;let b=0;const x=16;for(let M=0,T=_.length;M<T;M++){const R=Array.isArray(_[M])?_[M]:[_[M]];for(let w=0,I=R.length;w<I;w++){const O=R[w],k=Array.isArray(O.value)?O.value:[O.value];for(let B=0,G=k.length;B<G;B++){const L=k[B],U=v(L),z=b%x;z!==0&&x-z<U.boundary&&(b+=x-z),O.__data=new Float32Array(U.storage/Float32Array.BYTES_PER_ELEMENT),O.__offset=b,b+=U.storage}}}const E=b%x;return E>0&&(b+=x-E),A.__size=b,A.__cache={},this}function v(A){const _={boundary:0,storage:0};return typeof A=="number"||typeof A=="boolean"?(_.boundary=4,_.storage=4):A.isVector2?(_.boundary=8,_.storage=8):A.isVector3||A.isColor?(_.boundary=16,_.storage=12):A.isVector4?(_.boundary=16,_.storage=16):A.isMatrix3?(_.boundary=48,_.storage=48):A.isMatrix4?(_.boundary=64,_.storage=64):A.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",A),_}function g(A){const _=A.target;_.removeEventListener("dispose",g);const b=o.indexOf(_.__bindingPointIndex);o.splice(b,1),s.deleteBuffer(n[_.id]),delete n[_.id],delete r[_.id]}function y(){for(const A in n)s.deleteBuffer(n[A]);o=[],n={},r={}}return{bind:l,update:c,dispose:y}}class hu{constructor(e={}){const{canvas:t=_8(),context:i=null,depth:n=!0,stencil:r=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:u=!1}=e;this.isWebGLRenderer=!0;let f;i!==null?f=i.getContextAttributes().alpha:f=o;const p=new Uint32Array(4),m=new Int32Array(4);let v=null,g=null;const y=[],A=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=bt,this._useLegacyLights=!1,this.toneMapping=po,this.toneMappingExposure=1;const _=this;let b=!1,x=0,E=0,M=null,T=-1,R=null;const w=new Je,I=new Je;let O=null;const k=new Ae(0);let B=0,G=t.width,L=t.height,U=1,z=null,j=null;const X=new Je(0,0,G,L),re=new Je(0,0,G,L);let ce=!1;const Me=new $p;let se=!1,ve=!1,xe=null;const Fe=new le,Ge=new ee,je=new S,lt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ot(){return M===null?U:1}let q=i;function He(P,H){for(let Q=0;Q<P.length;Q++){const Y=P[Q],K=t.getContext(Y,H);if(K!==null)return K}return null}try{const P={alpha:!0,depth:n,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${su}`),t.addEventListener("webglcontextlost",ae,!1),t.addEventListener("webglcontextrestored",$,!1),t.addEventListener("webglcontextcreationerror",De,!1),q===null){const H=["webgl2","webgl","experimental-webgl"];if(_.isWebGL1Renderer===!0&&H.shift(),q=He(H,P),q===null)throw He(H)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&q instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),q.getShaderPrecisionFormat===void 0&&(q.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(P){throw console.error("THREE.WebGLRenderer: "+P.message),P}let we,Ne,Ee,st,et,ct,zt,V,F,ge,_e,Pe,Te,xt,ft,Le,Qe,St,ke,ni,pt,Xe,mt,at;function Lt(){we=new OZ(q),Ne=new IZ(q,we,e),we.init(Ne),Xe=new L8(q,we,Ne),Ee=new mee(q,we,Ne),st=new FZ(q),et=new nee,ct=new gee(q,we,Ee,et,Ne,Xe,st),zt=new PZ(_),V=new DZ(_),F=new QY(q,Ne),mt=new MZ(q,we,F,Ne),ge=new LZ(q,F,st,mt),_e=new GZ(q,ge,F,st),ke=new zZ(q,Ne,ct),Le=new RZ(et),Pe=new iee(_,zt,V,we,Ne,mt,Le),Te=new wee(_,et),xt=new ree,ft=new uee(we,Ne),St=new EZ(_,zt,V,Ee,_e,f,l),Qe=new pee(_,_e,Ne),at=new See(q,st,Ne,Ee),ni=new TZ(q,we,st,Ne),pt=new kZ(q,we,st,Ne),st.programs=Pe.programs,_.capabilities=Ne,_.extensions=we,_.properties=et,_.renderLists=xt,_.shadowMap=Qe,_.state=Ee,_.info=st}Lt();const W=new bee(_,q);this.xr=W,this.getContext=function(){return q},this.getContextAttributes=function(){return q.getContextAttributes()},this.forceContextLoss=function(){const P=we.get("WEBGL_lose_context");P&&P.loseContext()},this.forceContextRestore=function(){const P=we.get("WEBGL_lose_context");P&&P.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(P){P!==void 0&&(U=P,this.setSize(G,L,!1))},this.getSize=function(P){return P.set(G,L)},this.setSize=function(P,H,Q=!0){if(W.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}G=P,L=H,t.width=Math.floor(P*U),t.height=Math.floor(H*U),Q===!0&&(t.style.width=P+"px",t.style.height=H+"px"),this.setViewport(0,0,P,H)},this.getDrawingBufferSize=function(P){return P.set(G*U,L*U).floor()},this.setDrawingBufferSize=function(P,H,Q){G=P,L=H,U=Q,t.width=Math.floor(P*Q),t.height=Math.floor(H*Q),this.setViewport(0,0,P,H)},this.getCurrentViewport=function(P){return P.copy(w)},this.getViewport=function(P){return P.copy(X)},this.setViewport=function(P,H,Q,Y){P.isVector4?X.set(P.x,P.y,P.z,P.w):X.set(P,H,Q,Y),Ee.viewport(w.copy(X).multiplyScalar(U).round())},this.getScissor=function(P){return P.copy(re)},this.setScissor=function(P,H,Q,Y){P.isVector4?re.set(P.x,P.y,P.z,P.w):re.set(P,H,Q,Y),Ee.scissor(I.copy(re).multiplyScalar(U).round())},this.getScissorTest=function(){return ce},this.setScissorTest=function(P){Ee.setScissorTest(ce=P)},this.setOpaqueSort=function(P){z=P},this.setTransparentSort=function(P){j=P},this.getClearColor=function(P){return P.copy(St.getClearColor())},this.setClearColor=function(){St.setClearColor.apply(St,arguments)},this.getClearAlpha=function(){return St.getClearAlpha()},this.setClearAlpha=function(){St.setClearAlpha.apply(St,arguments)},this.clear=function(P=!0,H=!0,Q=!0){let Y=0;if(P){let K=!1;if(M!==null){const me=M.texture.format;K=me===Ky||me===Eb||me===jE}if(K){const me=M.texture.type,ue=me===wn||me===Hr||me===Cb||me===Kh||me===LO||me===kO,be=St.getClearColor(),Be=St.getClearAlpha(),Oe=be.r,We=be.g,$e=be.b;ue?(p[0]=Oe,p[1]=We,p[2]=$e,p[3]=Be,q.clearBufferuiv(q.COLOR,0,p)):(m[0]=Oe,m[1]=We,m[2]=$e,m[3]=Be,q.clearBufferiv(q.COLOR,0,m))}else Y|=q.COLOR_BUFFER_BIT}H&&(Y|=q.DEPTH_BUFFER_BIT),Q&&(Y|=q.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),q.clear(Y)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ae,!1),t.removeEventListener("webglcontextrestored",$,!1),t.removeEventListener("webglcontextcreationerror",De,!1),xt.dispose(),ft.dispose(),et.dispose(),zt.dispose(),V.dispose(),_e.dispose(),mt.dispose(),at.dispose(),Pe.dispose(),W.dispose(),W.removeEventListener("sessionstart",un),W.removeEventListener("sessionend",oi),xe&&(xe.dispose(),xe=null),Tn.stop()};function ae(P){P.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function $(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const P=st.autoReset,H=Qe.enabled,Q=Qe.autoUpdate,Y=Qe.needsUpdate,K=Qe.type;Lt(),st.autoReset=P,Qe.enabled=H,Qe.autoUpdate=Q,Qe.needsUpdate=Y,Qe.type=K}function De(P){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",P.statusMessage)}function he(P){const H=P.target;H.removeEventListener("dispose",he),Ve(H)}function Ve(P){Ye(P),et.remove(P)}function Ye(P){const H=et.get(P).programs;H!==void 0&&(H.forEach(function(Q){Pe.releaseProgram(Q)}),P.isShaderMaterial&&Pe.releaseShaderCache(P))}this.renderBufferDirect=function(P,H,Q,Y,K,me){H===null&&(H=lt);const ue=K.isMesh&&K.matrixWorld.determinant()<0,be=D(P,H,Q,Y,K);Ee.setMaterial(Y,ue);let Be=Q.index,Oe=1;if(Y.wireframe===!0){if(Be=ge.getWireframeAttribute(Q),Be===void 0)return;Oe=2}const We=Q.drawRange,$e=Q.attributes.position;let tt=We.start*Oe,ut=(We.start+We.count)*Oe;me!==null&&(tt=Math.max(tt,me.start*Oe),ut=Math.min(ut,(me.start+me.count)*Oe)),Be!==null?(tt=Math.max(tt,0),ut=Math.min(ut,Be.count)):$e!=null&&(tt=Math.max(tt,0),ut=Math.min(ut,$e.count));const Tt=ut-tt;if(Tt<0||Tt===1/0)return;mt.setup(K,Y,be,Q,Be);let xi,qt=ni;if(Be!==null&&(xi=F.get(Be),qt=pt,qt.setIndex(xi)),K.isMesh)Y.wireframe===!0?(Ee.setLineWidth(Y.wireframeLinewidth*ot()),qt.setMode(q.LINES)):qt.setMode(q.TRIANGLES);else if(K.isLine){let Bt=Y.linewidth;Bt===void 0&&(Bt=1),Ee.setLineWidth(Bt*ot()),K.isLineSegments?qt.setMode(q.LINES):K.isLineLoop?qt.setMode(q.LINE_LOOP):qt.setMode(q.LINE_STRIP)}else K.isPoints?qt.setMode(q.POINTS):K.isSprite&&qt.setMode(q.TRIANGLES);if(K.isBatchedMesh)qt.renderMultiDraw(K._multiDrawStarts,K._multiDrawCounts,K._multiDrawCount);else if(K.isInstancedMesh)qt.renderInstances(tt,Tt,K.count);else if(Q.isInstancedBufferGeometry){const Bt=Q._maxInstanceCount!==void 0?Q._maxInstanceCount:1/0,Bi=Math.min(Q.instanceCount,Bt);qt.renderInstances(tt,Tt,Bi)}else qt.render(tt,Tt)};function si(P,H,Q){P.transparent===!0&&P.side===_i&&P.forceSinglePass===!1?(P.side=bn,P.needsUpdate=!0,ii(P,H,Q),P.side=$n,P.needsUpdate=!0,ii(P,H,Q),P.side=_i):ii(P,H,Q)}this.compile=function(P,H,Q=null){Q===null&&(Q=P),g=ft.get(Q),g.init(),A.push(g),Q.traverseVisible(function(K){K.isLight&&K.layers.test(H.layers)&&(g.pushLight(K),K.castShadow&&g.pushShadow(K))}),P!==Q&&P.traverseVisible(function(K){K.isLight&&K.layers.test(H.layers)&&(g.pushLight(K),K.castShadow&&g.pushShadow(K))}),g.setupLights(_._useLegacyLights);const Y=new Set;return P.traverse(function(K){const me=K.material;if(me)if(Array.isArray(me))for(let ue=0;ue<me.length;ue++){const be=me[ue];si(be,Q,K),Y.add(be)}else si(me,Q,K),Y.add(me)}),A.pop(),g=null,Y},this.compileAsync=function(P,H,Q=null){const Y=this.compile(P,H,Q);return new Promise(K=>{function me(){if(Y.forEach(function(ue){et.get(ue).currentProgram.isReady()&&Y.delete(ue)}),Y.size===0){K(P);return}setTimeout(me,10)}we.get("KHR_parallel_shader_compile")!==null?me():setTimeout(me,10)})};let Mi=null;function hn(P){Mi&&Mi(P)}function un(){Tn.stop()}function oi(){Tn.start()}const Tn=new I8;Tn.setAnimationLoop(hn),typeof self<"u"&&Tn.setContext(self),this.setAnimationLoop=function(P){Mi=P,W.setAnimationLoop(P),P===null?Tn.stop():Tn.start()},W.addEventListener("sessionstart",un),W.addEventListener("sessionend",oi),this.render=function(P,H){if(H!==void 0&&H.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(b===!0)return;P.matrixWorldAutoUpdate===!0&&P.updateMatrixWorld(),H.parent===null&&H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),W.enabled===!0&&W.isPresenting===!0&&(W.cameraAutoUpdate===!0&&W.updateCamera(H),H=W.getCamera()),P.isScene===!0&&P.onBeforeRender(_,P,H,M),g=ft.get(P,A.length),g.init(),A.push(g),Fe.multiplyMatrices(H.projectionMatrix,H.matrixWorldInverse),Me.setFromProjectionMatrix(Fe),ve=this.localClippingEnabled,se=Le.init(this.clippingPlanes,ve),v=xt.get(P,y.length),v.init(),y.push(v),Fn(P,H,0,_.sortObjects),v.finish(),_.sortObjects===!0&&v.sort(z,j),this.info.render.frame++,se===!0&&Le.beginShadows();const Q=g.state.shadowsArray;if(Qe.render(Q,P,H),se===!0&&Le.endShadows(),this.info.autoReset===!0&&this.info.reset(),(W.enabled===!1||W.isPresenting===!1||W.hasDepthSensing()===!1)&&St.render(v,P),g.setupLights(_._useLegacyLights),H.isArrayCamera){const Y=H.cameras;for(let K=0,me=Y.length;K<me;K++){const ue=Y[K];Wo(v,P,ue,ue.viewport)}}else Wo(v,P,H);M!==null&&(ct.updateMultisampleRenderTarget(M),ct.updateRenderTargetMipmap(M)),P.isScene===!0&&P.onAfterRender(_,P,H),mt.resetDefaultState(),T=-1,R=null,A.pop(),A.length>0?g=A[A.length-1]:g=null,y.pop(),y.length>0?v=y[y.length-1]:v=null};function Fn(P,H,Q,Y){if(P.visible===!1)return;if(P.layers.test(H.layers)){if(P.isGroup)Q=P.renderOrder;else if(P.isLOD)P.autoUpdate===!0&&P.update(H);else if(P.isLight)g.pushLight(P),P.castShadow&&g.pushShadow(P);else if(P.isSprite){if(!P.frustumCulled||Me.intersectsSprite(P)){Y&&je.setFromMatrixPosition(P.matrixWorld).applyMatrix4(Fe);const ue=_e.update(P),be=P.material;be.visible&&v.push(P,ue,be,Q,je.z,null)}}else if((P.isMesh||P.isLine||P.isPoints)&&(!P.frustumCulled||Me.intersectsObject(P))){const ue=_e.update(P),be=P.material;if(Y&&(P.boundingSphere!==void 0?(P.boundingSphere===null&&P.computeBoundingSphere(),je.copy(P.boundingSphere.center)):(ue.boundingSphere===null&&ue.computeBoundingSphere(),je.copy(ue.boundingSphere.center)),je.applyMatrix4(P.matrixWorld).applyMatrix4(Fe)),Array.isArray(be)){const Be=ue.groups;for(let Oe=0,We=Be.length;Oe<We;Oe++){const $e=Be[Oe],tt=be[$e.materialIndex];tt&&tt.visible&&v.push(P,ue,tt,Q,je.z,$e)}}else be.visible&&v.push(P,ue,be,Q,je.z,null)}}const me=P.children;for(let ue=0,be=me.length;ue<be;ue++)Fn(me[ue],H,Q,Y)}function Wo(P,H,Q,Y){const K=P.opaque,me=P.transmissive,ue=P.transparent;g.setupLightsView(Q),se===!0&&Le.setGlobalState(_.clippingPlanes,Q),me.length>0&&xu(K,me,H,Q),Y&&Ee.viewport(w.copy(Y)),K.length>0&&jo(K,H,Q),me.length>0&&jo(me,H,Q),ue.length>0&&jo(ue,H,Q),Ee.buffers.depth.setTest(!0),Ee.buffers.depth.setMask(!0),Ee.buffers.color.setMask(!0),Ee.setPolygonOffset(!1)}function xu(P,H,Q,Y){if((Q.isScene===!0?Q.overrideMaterial:null)!==null)return;const me=Ne.isWebGL2;xe===null&&(xe=new $t(1,1,{generateMipmaps:!0,type:we.has("EXT_color_buffer_half_float")?Cs:wn,minFilter:Do,samples:me?4:0})),_.getDrawingBufferSize(Ge),me?xe.setSize(Ge.x,Ge.y):xe.setSize(F1(Ge.x),F1(Ge.y));const ue=_.getRenderTarget();_.setRenderTarget(xe),_.getClearColor(k),B=_.getClearAlpha(),B<1&&_.setClearColor(16777215,.5),_.clear();const be=_.toneMapping;_.toneMapping=po,jo(P,Q,Y),ct.updateMultisampleRenderTarget(xe),ct.updateRenderTargetMipmap(xe);let Be=!1;for(let Oe=0,We=H.length;Oe<We;Oe++){const $e=H[Oe],tt=$e.object,ut=$e.geometry,Tt=$e.material,xi=$e.group;if(Tt.side===_i&&tt.layers.test(Y.layers)){const qt=Tt.side;Tt.side=bn,Tt.needsUpdate=!0,wu(tt,Q,Y,ut,Tt,xi),Tt.side=qt,Tt.needsUpdate=!0,Be=!0}}Be===!0&&(ct.updateMultisampleRenderTarget(xe),ct.updateRenderTargetMipmap(xe)),_.setRenderTarget(ue),_.setClearColor(k,B),_.toneMapping=be}function jo(P,H,Q){const Y=H.isScene===!0?H.overrideMaterial:null;for(let K=0,me=P.length;K<me;K++){const ue=P[K],be=ue.object,Be=ue.geometry,Oe=Y===null?ue.material:Y,We=ue.group;be.layers.test(Q.layers)&&wu(be,H,Q,Be,Oe,We)}}function wu(P,H,Q,Y,K,me){P.onBeforeRender(_,H,Q,Y,K,me),P.modelViewMatrix.multiplyMatrices(Q.matrixWorldInverse,P.matrixWorld),P.normalMatrix.getNormalMatrix(P.modelViewMatrix),K.onBeforeRender(_,H,Q,Y,P,me),K.transparent===!0&&K.side===_i&&K.forceSinglePass===!1?(K.side=bn,K.needsUpdate=!0,_.renderBufferDirect(Q,H,Y,K,P,me),K.side=$n,K.needsUpdate=!0,_.renderBufferDirect(Q,H,Y,K,P,me),K.side=_i):_.renderBufferDirect(Q,H,Y,K,P,me),P.onAfterRender(_,H,Q,Y,K,me)}function ii(P,H,Q){H.isScene!==!0&&(H=lt);const Y=et.get(P),K=g.state.lights,me=g.state.shadowsArray,ue=K.state.version,be=Pe.getParameters(P,K.state,me,H,Q),Be=Pe.getProgramCacheKey(be);let Oe=Y.programs;Y.environment=P.isMeshStandardMaterial?H.environment:null,Y.fog=H.fog,Y.envMap=(P.isMeshStandardMaterial?V:zt).get(P.envMap||Y.environment),Y.envMapRotation=Y.environment!==null&&P.envMap===null?H.environmentRotation:P.envMapRotation,Oe===void 0&&(P.addEventListener("dispose",he),Oe=new Map,Y.programs=Oe);let We=Oe.get(Be);if(We!==void 0){if(Y.currentProgram===We&&Y.lightsStateVersion===ue)return Vx(P,be),We}else be.uniforms=Pe.getUniforms(P),P.onBuild(Q,be,_),P.onBeforeCompile(be,_),We=Pe.acquireProgram(be,Be),Oe.set(Be,We),Y.uniforms=be.uniforms;const $e=Y.uniforms;return(!P.isShaderMaterial&&!P.isRawShaderMaterial||P.clipping===!0)&&($e.clippingPlanes=Le.uniform),Vx(P,be),Y.needsLights=Z(P),Y.lightsStateVersion=ue,Y.needsLights&&($e.ambientLightColor.value=K.state.ambient,$e.lightProbe.value=K.state.probe,$e.directionalLights.value=K.state.directional,$e.directionalLightShadows.value=K.state.directionalShadow,$e.spotLights.value=K.state.spot,$e.spotLightShadows.value=K.state.spotShadow,$e.rectAreaLights.value=K.state.rectArea,$e.ltc_1.value=K.state.rectAreaLTC1,$e.ltc_2.value=K.state.rectAreaLTC2,$e.pointLights.value=K.state.point,$e.pointLightShadows.value=K.state.pointShadow,$e.hemisphereLights.value=K.state.hemi,$e.directionalShadowMap.value=K.state.directionalShadowMap,$e.directionalShadowMatrix.value=K.state.directionalShadowMatrix,$e.spotShadowMap.value=K.state.spotShadowMap,$e.spotLightMatrix.value=K.state.spotLightMatrix,$e.spotLightMap.value=K.state.spotLightMap,$e.pointShadowMap.value=K.state.pointShadowMap,$e.pointShadowMatrix.value=K.state.pointShadowMatrix),Y.currentProgram=We,Y.uniformsList=null,We}function c0(P){if(P.uniformsList===null){const H=P.currentProgram.getUniforms();P.uniformsList=XC.seqWithValue(H.seq,P.uniforms)}return P.uniformsList}function Vx(P,H){const Q=et.get(P);Q.outputColorSpace=H.outputColorSpace,Q.batching=H.batching,Q.instancing=H.instancing,Q.instancingColor=H.instancingColor,Q.instancingMorph=H.instancingMorph,Q.skinning=H.skinning,Q.morphTargets=H.morphTargets,Q.morphNormals=H.morphNormals,Q.morphColors=H.morphColors,Q.morphTargetsCount=H.morphTargetsCount,Q.numClippingPlanes=H.numClippingPlanes,Q.numIntersection=H.numClipIntersection,Q.vertexAlphas=H.vertexAlphas,Q.vertexTangents=H.vertexTangents,Q.toneMapping=H.toneMapping}function D(P,H,Q,Y,K){H.isScene!==!0&&(H=lt),ct.resetTextureUnits();const me=H.fog,ue=Y.isMeshStandardMaterial?H.environment:null,be=M===null?_.outputColorSpace:M.isXRRenderTarget===!0?M.texture.colorSpace:zi,Be=(Y.isMeshStandardMaterial?V:zt).get(Y.envMap||ue),Oe=Y.vertexColors===!0&&!!Q.attributes.color&&Q.attributes.color.itemSize===4,We=!!Q.attributes.tangent&&(!!Y.normalMap||Y.anisotropy>0),$e=!!Q.morphAttributes.position,tt=!!Q.morphAttributes.normal,ut=!!Q.morphAttributes.color;let Tt=po;Y.toneMapped&&(M===null||M.isXRRenderTarget===!0)&&(Tt=_.toneMapping);const xi=Q.morphAttributes.position||Q.morphAttributes.normal||Q.morphAttributes.color,qt=xi!==void 0?xi.length:0,Bt=et.get(Y),Bi=g.state.lights;if(se===!0&&(ve===!0||P!==R)){const In=P===R&&Y.id===T;Le.setState(Y,P,In)}let Ct=!1;Y.version===Bt.__version?(Bt.needsLights&&Bt.lightsStateVersion!==Bi.state.version||Bt.outputColorSpace!==be||K.isBatchedMesh&&Bt.batching===!1||!K.isBatchedMesh&&Bt.batching===!0||K.isInstancedMesh&&Bt.instancing===!1||!K.isInstancedMesh&&Bt.instancing===!0||K.isSkinnedMesh&&Bt.skinning===!1||!K.isSkinnedMesh&&Bt.skinning===!0||K.isInstancedMesh&&Bt.instancingColor===!0&&K.instanceColor===null||K.isInstancedMesh&&Bt.instancingColor===!1&&K.instanceColor!==null||K.isInstancedMesh&&Bt.instancingMorph===!0&&K.morphTexture===null||K.isInstancedMesh&&Bt.instancingMorph===!1&&K.morphTexture!==null||Bt.envMap!==Be||Y.fog===!0&&Bt.fog!==me||Bt.numClippingPlanes!==void 0&&(Bt.numClippingPlanes!==Le.numPlanes||Bt.numIntersection!==Le.numIntersection)||Bt.vertexAlphas!==Oe||Bt.vertexTangents!==We||Bt.morphTargets!==$e||Bt.morphNormals!==tt||Bt.morphColors!==ut||Bt.toneMapping!==Tt||Ne.isWebGL2===!0&&Bt.morphTargetsCount!==qt)&&(Ct=!0):(Ct=!0,Bt.__version=Y.version);let Vi=Bt.currentProgram;Ct===!0&&(Vi=ii(Y,H,K));let Zr=!1,dn=!1,bi=!1;const Yt=Vi.getUniforms(),Js=Bt.uniforms;if(Ee.useProgram(Vi.program)&&(Zr=!0,dn=!0,bi=!0),Y.id!==T&&(T=Y.id,dn=!0),Zr||R!==P){Yt.setValue(q,"projectionMatrix",P.projectionMatrix),Yt.setValue(q,"viewMatrix",P.matrixWorldInverse);const In=Yt.map.cameraPosition;In!==void 0&&In.setValue(q,je.setFromMatrixPosition(P.matrixWorld)),Ne.logarithmicDepthBuffer&&Yt.setValue(q,"logDepthBufFC",2/(Math.log(P.far+1)/Math.LN2)),(Y.isMeshPhongMaterial||Y.isMeshToonMaterial||Y.isMeshLambertMaterial||Y.isMeshBasicMaterial||Y.isMeshStandardMaterial||Y.isShaderMaterial)&&Yt.setValue(q,"isOrthographic",P.isOrthographicCamera===!0),R!==P&&(R=P,dn=!0,bi=!0)}if(K.isSkinnedMesh){Yt.setOptional(q,K,"bindMatrix"),Yt.setOptional(q,K,"bindMatrixInverse");const In=K.skeleton;In&&(Ne.floatVertexTextures?(In.boneTexture===null&&In.computeBoneTexture(),Yt.setValue(q,"boneTexture",In.boneTexture,ct)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}K.isBatchedMesh&&(Yt.setOptional(q,K,"batchingTexture"),Yt.setValue(q,"batchingTexture",K._matricesTexture,ct));const nh=Q.morphAttributes;if((nh.position!==void 0||nh.normal!==void 0||nh.color!==void 0&&Ne.isWebGL2===!0)&&ke.update(K,Q,Vi),(dn||Bt.receiveShadow!==K.receiveShadow)&&(Bt.receiveShadow=K.receiveShadow,Yt.setValue(q,"receiveShadow",K.receiveShadow)),Y.isMeshGouraudMaterial&&Y.envMap!==null&&(Js.envMap.value=Be,Js.flipEnvMap.value=Be.isCubeTexture&&Be.isRenderTargetTexture===!1?-1:1),dn&&(Yt.setValue(q,"toneMappingExposure",_.toneMappingExposure),Bt.needsLights&&N(Js,bi),me&&Y.fog===!0&&Te.refreshFogUniforms(Js,me),Te.refreshMaterialUniforms(Js,Y,U,L,xe),XC.upload(q,c0(Bt),Js,ct)),Y.isShaderMaterial&&Y.uniformsNeedUpdate===!0&&(XC.upload(q,c0(Bt),Js,ct),Y.uniformsNeedUpdate=!1),Y.isSpriteMaterial&&Yt.setValue(q,"center",K.center),Yt.setValue(q,"modelViewMatrix",K.modelViewMatrix),Yt.setValue(q,"normalMatrix",K.normalMatrix),Yt.setValue(q,"modelMatrix",K.matrixWorld),Y.isShaderMaterial||Y.isRawShaderMaterial){const In=Y.uniformsGroups;for(let Su=0,UX=In.length;Su<UX;Su++)if(Ne.isWebGL2){const HU=In[Su];at.update(HU,Vi),at.bind(HU,Vi)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Vi}function N(P,H){P.ambientLightColor.needsUpdate=H,P.lightProbe.needsUpdate=H,P.directionalLights.needsUpdate=H,P.directionalLightShadows.needsUpdate=H,P.pointLights.needsUpdate=H,P.pointLightShadows.needsUpdate=H,P.spotLights.needsUpdate=H,P.spotLightShadows.needsUpdate=H,P.rectAreaLights.needsUpdate=H,P.hemisphereLights.needsUpdate=H}function Z(P){return P.isMeshLambertMaterial||P.isMeshToonMaterial||P.isMeshPhongMaterial||P.isMeshStandardMaterial||P.isShadowMaterial||P.isShaderMaterial&&P.lights===!0}this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(P,H,Q){et.get(P.texture).__webglTexture=H,et.get(P.depthTexture).__webglTexture=Q;const Y=et.get(P);Y.__hasExternalTextures=!0,Y.__autoAllocateDepthBuffer=Q===void 0,Y.__autoAllocateDepthBuffer||we.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Y.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(P,H){const Q=et.get(P);Q.__webglFramebuffer=H,Q.__useDefaultFramebuffer=H===void 0},this.setRenderTarget=function(P,H=0,Q=0){M=P,x=H,E=Q;let Y=!0,K=null,me=!1,ue=!1;if(P){const Be=et.get(P);Be.__useDefaultFramebuffer!==void 0?(Ee.bindFramebuffer(q.FRAMEBUFFER,null),Y=!1):Be.__webglFramebuffer===void 0?ct.setupRenderTarget(P):Be.__hasExternalTextures&&ct.rebindTextures(P,et.get(P.texture).__webglTexture,et.get(P.depthTexture).__webglTexture);const Oe=P.texture;(Oe.isData3DTexture||Oe.isDataArrayTexture||Oe.isCompressedArrayTexture)&&(ue=!0);const We=et.get(P).__webglFramebuffer;P.isWebGLCubeRenderTarget?(Array.isArray(We[H])?K=We[H][Q]:K=We[H],me=!0):Ne.isWebGL2&&P.samples>0&&ct.useMultisampledRTT(P)===!1?K=et.get(P).__webglMultisampledFramebuffer:Array.isArray(We)?K=We[Q]:K=We,w.copy(P.viewport),I.copy(P.scissor),O=P.scissorTest}else w.copy(X).multiplyScalar(U).floor(),I.copy(re).multiplyScalar(U).floor(),O=ce;if(Ee.bindFramebuffer(q.FRAMEBUFFER,K)&&Ne.drawBuffers&&Y&&Ee.drawBuffers(P,K),Ee.viewport(w),Ee.scissor(I),Ee.setScissorTest(O),me){const Be=et.get(P.texture);q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_CUBE_MAP_POSITIVE_X+H,Be.__webglTexture,Q)}else if(ue){const Be=et.get(P.texture),Oe=H||0;q.framebufferTextureLayer(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,Be.__webglTexture,Q||0,Oe)}T=-1},this.readRenderTargetPixels=function(P,H,Q,Y,K,me,ue){if(!(P&&P.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let be=et.get(P).__webglFramebuffer;if(P.isWebGLCubeRenderTarget&&ue!==void 0&&(be=be[ue]),be){Ee.bindFramebuffer(q.FRAMEBUFFER,be);try{const Be=P.texture,Oe=Be.format,We=Be.type;if(Oe!==Li&&Xe.convert(Oe)!==q.getParameter(q.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const $e=We===Cs&&(we.has("EXT_color_buffer_half_float")||Ne.isWebGL2&&we.has("EXT_color_buffer_float"));if(We!==wn&&Xe.convert(We)!==q.getParameter(q.IMPLEMENTATION_COLOR_READ_TYPE)&&!(We===tn&&(Ne.isWebGL2||we.has("OES_texture_float")||we.has("WEBGL_color_buffer_float")))&&!$e){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}H>=0&&H<=P.width-Y&&Q>=0&&Q<=P.height-K&&q.readPixels(H,Q,Y,K,Xe.convert(Oe),Xe.convert(We),me)}finally{const Be=M!==null?et.get(M).__webglFramebuffer:null;Ee.bindFramebuffer(q.FRAMEBUFFER,Be)}}},this.copyFramebufferToTexture=function(P,H,Q=0){const Y=Math.pow(2,-Q),K=Math.floor(H.image.width*Y),me=Math.floor(H.image.height*Y);ct.setTexture2D(H,0),q.copyTexSubImage2D(q.TEXTURE_2D,Q,0,0,P.x,P.y,K,me),Ee.unbindTexture()},this.copyTextureToTexture=function(P,H,Q,Y=0){const K=H.image.width,me=H.image.height,ue=Xe.convert(Q.format),be=Xe.convert(Q.type);ct.setTexture2D(Q,0),q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,Q.flipY),q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),q.pixelStorei(q.UNPACK_ALIGNMENT,Q.unpackAlignment),H.isDataTexture?q.texSubImage2D(q.TEXTURE_2D,Y,P.x,P.y,K,me,ue,be,H.image.data):H.isCompressedTexture?q.compressedTexSubImage2D(q.TEXTURE_2D,Y,P.x,P.y,H.mipmaps[0].width,H.mipmaps[0].height,ue,H.mipmaps[0].data):q.texSubImage2D(q.TEXTURE_2D,Y,P.x,P.y,ue,be,H.image),Y===0&&Q.generateMipmaps&&q.generateMipmap(q.TEXTURE_2D),Ee.unbindTexture()},this.copyTextureToTexture3D=function(P,H,Q,Y,K=0){if(_.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const me=Math.round(P.max.x-P.min.x),ue=Math.round(P.max.y-P.min.y),be=P.max.z-P.min.z+1,Be=Xe.convert(Y.format),Oe=Xe.convert(Y.type);let We;if(Y.isData3DTexture)ct.setTexture3D(Y,0),We=q.TEXTURE_3D;else if(Y.isDataArrayTexture||Y.isCompressedArrayTexture)ct.setTexture2DArray(Y,0),We=q.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,Y.flipY),q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Y.premultiplyAlpha),q.pixelStorei(q.UNPACK_ALIGNMENT,Y.unpackAlignment);const $e=q.getParameter(q.UNPACK_ROW_LENGTH),tt=q.getParameter(q.UNPACK_IMAGE_HEIGHT),ut=q.getParameter(q.UNPACK_SKIP_PIXELS),Tt=q.getParameter(q.UNPACK_SKIP_ROWS),xi=q.getParameter(q.UNPACK_SKIP_IMAGES),qt=Q.isCompressedTexture?Q.mipmaps[K]:Q.image;q.pixelStorei(q.UNPACK_ROW_LENGTH,qt.width),q.pixelStorei(q.UNPACK_IMAGE_HEIGHT,qt.height),q.pixelStorei(q.UNPACK_SKIP_PIXELS,P.min.x),q.pixelStorei(q.UNPACK_SKIP_ROWS,P.min.y),q.pixelStorei(q.UNPACK_SKIP_IMAGES,P.min.z),Q.isDataTexture||Q.isData3DTexture?q.texSubImage3D(We,K,H.x,H.y,H.z,me,ue,be,Be,Oe,qt.data):Y.isCompressedArrayTexture?q.compressedTexSubImage3D(We,K,H.x,H.y,H.z,me,ue,be,Be,qt.data):q.texSubImage3D(We,K,H.x,H.y,H.z,me,ue,be,Be,Oe,qt),q.pixelStorei(q.UNPACK_ROW_LENGTH,$e),q.pixelStorei(q.UNPACK_IMAGE_HEIGHT,tt),q.pixelStorei(q.UNPACK_SKIP_PIXELS,ut),q.pixelStorei(q.UNPACK_SKIP_ROWS,Tt),q.pixelStorei(q.UNPACK_SKIP_IMAGES,xi),K===0&&Y.generateMipmaps&&q.generateMipmap(We),Ee.unbindTexture()},this.initTexture=function(P){P.isCubeTexture?ct.setTextureCube(P,0):P.isData3DTexture?ct.setTexture3D(P,0):P.isDataArrayTexture||P.isCompressedArrayTexture?ct.setTexture2DArray(P,0):ct.setTexture2D(P,0),Ee.unbindTexture()},this.resetState=function(){x=0,E=0,M=null,Ee.reset(),mt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Sc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===KE?"display-p3":"srgb",t.unpackColorSpace=Ci.workingColorSpace===Mb?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===bt?p2:Y5}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===p2?bt:zi}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class k8 extends hu{}k8.prototype.isWebGL1Renderer=!0;class eM{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ae(e),this.density=t}clone(){return new eM(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}let tM=class F8{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Ae(e),this.near=t,this.far=i}clone(){return new F8(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}};class Ws extends ye{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new li,this.environmentRotation=new li,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),t.object.environmentRotation=this.environmentRotation.toArray(),t}}let Pb=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=T_,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=pa()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return b8("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=pa()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=pa()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const $r=new S;let aa=class U8{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)$r.fromBufferAttribute(this,t),$r.applyMatrix4(e),this.setXYZ(t,$r.x,$r.y,$r.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)$r.fromBufferAttribute(this,t),$r.applyNormalMatrix(e),this.setXYZ(t,$r.x,$r.y,$r.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)$r.fromBufferAttribute(this,t),$r.transformDirection(e),this.setXYZ(t,$r.x,$r.y,$r.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=ho(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Jt(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=Jt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Jt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Jt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Jt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ho(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ho(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ho(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ho(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Jt(t,this.array),i=Jt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Jt(t,this.array),i=Jt(i,this.array),n=Jt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Jt(t,this.array),i=Jt(i,this.array),n=Jt(n,this.array),r=Jt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return new Ke(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new U8(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};class iM extends Ht{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ae(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let sg;const p0=new S,rg=new S,og=new S,ag=new ee,m0=new ee,N8=new le,uw=new S,g0=new S,dw=new S,P3=new ee,MI=new ee,B3=new ee;let JO=class extends ye{constructor(e=new iM){if(super(),this.isSprite=!0,this.type="Sprite",sg===void 0){sg=new yt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Pb(t,5);sg.setIndex([0,1,2,0,2,3]),sg.setAttribute("position",new aa(i,3,0,!1)),sg.setAttribute("uv",new aa(i,2,3,!1))}this.geometry=sg,this.material=e,this.center=new ee(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),rg.setFromMatrixScale(this.matrixWorld),N8.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),og.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&rg.multiplyScalar(-og.z);const i=this.material.rotation;let n,r;i!==0&&(r=Math.cos(i),n=Math.sin(i));const o=this.center;fw(uw.set(-.5,-.5,0),og,o,rg,n,r),fw(g0.set(.5,-.5,0),og,o,rg,n,r),fw(dw.set(.5,.5,0),og,o,rg,n,r),P3.set(0,0),MI.set(1,0),B3.set(1,1);let a=e.ray.intersectTriangle(uw,g0,dw,!1,p0);if(a===null&&(fw(g0.set(-.5,.5,0),og,o,rg,n,r),MI.set(0,1),a=e.ray.intersectTriangle(uw,dw,g0,!1,p0),a===null))return;const l=e.ray.origin.distanceTo(p0);l<e.near||l>e.far||t.push({distance:l,point:p0.clone(),uv:pr.getInterpolation(p0,uw,g0,dw,P3,MI,B3,new ee),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};function fw(s,e,t,i,n,r){ag.subVectors(s,t).addScalar(.5).multiply(i),n!==void 0?(m0.x=r*ag.x-n*ag.y,m0.y=n*ag.x+r*ag.y):m0.copy(ag),s.copy(e),s.x+=m0.x,s.y+=m0.y,s.applyMatrix4(N8)}const pw=new S,D3=new S;let ZO=class extends ye{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,n=t.length;i<n;i++){const r=t[i];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n;i++){let r=t[i].distance;if(t[i].object.visible&&(r-=r*t[i].hysteresis),e<r)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){pw.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(pw);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){pw.setFromMatrixPosition(e.matrixWorld),D3.setFromMatrixPosition(this.matrixWorld);const i=pw.distanceTo(D3)/e.zoom;t[0].object.visible=!0;let n,r;for(n=1,r=t.length;n<r;n++){let o=t[n].distance;if(t[n].object.visible&&(o-=o*t[n].hysteresis),i>=o)t[n-1].object.visible=!1,t[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let n=0,r=i.length;n<r;n++){const o=i[n];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}};const O3=new S,L3=new Je,k3=new Je,Cee=new S,F3=new le,mw=new S,TI=new ln,U3=new le,II=new _o;let Fo=class extends fe{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=HB,this.bindMatrix=new le,this.bindMatrixInverse=new le,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new jt),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,mw),this.boundingBox.expandByPoint(mw)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new ln),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,mw),this.boundingSphere.expandByPoint(mw)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,n=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),TI.copy(this.boundingSphere),TI.applyMatrix4(n),e.ray.intersectsSphere(TI)!==!1&&(U3.copy(n).invert(),II.copy(e.ray).applyMatrix4(U3),!(this.boundingBox!==null&&II.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,II)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Je,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===HB?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===V5?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,n=this.geometry;L3.fromBufferAttribute(n.attributes.skinIndex,e),k3.fromBufferAttribute(n.attributes.skinWeight,e),O3.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=k3.getComponent(r);if(o!==0){const a=L3.getComponent(r);F3.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(Cee.copy(O3).applyMatrix4(F3),o)}}return t.applyMatrix4(this.bindMatrixInverse)}},em=class extends ye{constructor(){super(),this.isBone=!0,this.type="Bone"}},Qr=class extends Wt{constructor(e=null,t=1,i=1,n,r,o,a,l,c=Ot,h=Ot,u,f){super(null,o,a,l,c,h,n,r,u,f),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const N3=new le,Eee=new le;let Bb=class z8{constructor(e=[],t=[]){this.uuid=pa(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new le)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new le;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:Eee;N3.multiplyMatrices(a,t[r]),N3.toArray(i,r*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new z8(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Qr(t,e,e,Li,tn);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new em),this.bones.push(o),this.boneInverses.push(new le().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){const o=t[n];e.bones.push(o.uuid);const a=i[n];e.boneInverses.push(a.toArray())}return e}},Po=class extends Ke{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};const lg=new le,z3=new le,gw=[],G3=new jt,Mee=new le,y0=new fe,v0=new ln;let $O=class extends fe{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Po(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<i;n++)this.setMatrixAt(n,Mee)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new jt),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,lg),G3.copy(e.boundingBox).applyMatrix4(lg),this.boundingBox.union(G3)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new ln),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,lg),v0.copy(e.boundingSphere).applyMatrix4(lg),this.boundingSphere.union(v0)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,n=this.morphTexture.source.data.data,r=i.length+1,o=e*r+1;for(let a=0;a<i.length;a++)i[a]=n[o+a]}raycast(e,t){const i=this.matrixWorld,n=this.count;if(y0.geometry=this.geometry,y0.material=this.material,y0.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),v0.copy(this.boundingSphere),v0.applyMatrix4(i),e.ray.intersectsSphere(v0)!==!1))for(let r=0;r<n;r++){this.getMatrixAt(r,lg),z3.multiplyMatrices(i,lg),y0.matrixWorld=z3,y0.raycast(e,gw);for(let o=0,a=gw.length;o<a;o++){const l=gw[o];l.instanceId=r,l.object=this,t.push(l)}gw.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Po(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,n=i.length+1;this.morphTexture===null&&(this.morphTexture=new Qr(new Float32Array(n*this.count),n,this.count,um,tn));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=n*e;r[l]=a,r.set(i,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};function Tee(s,e){return s.z-e.z}function Iee(s,e){return e.z-s.z}class Ree{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const i=this.pool,n=this.list;this.index>=i.length&&i.push({start:-1,count:-1,z:-1});const r=i[this.index];n.push(r),this.index++,r.start=e.start,r.count=e.count,r.z=t}reset(){this.list.length=0,this.index=0}}const cg="batchId",Pu=new le,H3=new le,Pee=new le,V3=new le,RI=new $p,yw=new jt,Bf=new ln,A0=new S,PI=new Ree,Ir=new fe,vw=[];function Bee(s,e,t=0){const i=e.itemSize;if(s.isInterleavedBufferAttribute||s.array.constructor!==e.array.constructor){const n=s.count;for(let r=0;r<n;r++)for(let o=0;o<i;o++)e.setComponent(r+t,o,s.getComponent(r,o))}else e.array.set(s.array,t*i);e.needsUpdate=!0}class U1 extends fe{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,i=t*2,n){super(new yt,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new Qr(t,e,e,Li,tn);this._matricesTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,n=this._maxGeometryCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const a in e.attributes){const l=e.getAttribute(a),{array:c,itemSize:h,normalized:u}=l,f=new c.constructor(i*h),p=new Ke(f,h,u);t.setAttribute(a,p)}if(e.getIndex()!==null){const a=i>65536?new Uint32Array(r):new Uint16Array(r);t.setIndex(new Ke(a,1))}const o=n>65536?new Uint32Array(i):new Uint16Array(i);t.setAttribute(cg,new Ke(o,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(cg))throw new Error(`BatchedMesh: Geometry cannot use attribute "${cg}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(i===cg)continue;if(!e.hasAttribute(i))throw new Error(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const n=e.getAttribute(i),r=t.getAttribute(i);if(n.itemSize!==r.itemSize||n.normalized!==r.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new jt);const e=this._geometryCount,t=this.boundingBox,i=this._active;t.makeEmpty();for(let n=0;n<e;n++)i[n]!==!1&&(this.getMatrixAt(n,Pu),this.getBoundingBoxAt(n,yw).applyMatrix4(Pu),t.union(yw))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ln);const e=this._geometryCount,t=this.boundingSphere,i=this._active;t.makeEmpty();for(let n=0;n<e;n++)i[n]!==!1&&(this.getMatrixAt(n,Pu),this.getBoundingSphereAt(n,Bf).applyMatrix4(Pu),t.union(Bf))}addGeometry(e,t=-1,i=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const n={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let r=null;const o=this._reservedRanges,a=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(r=o[o.length-1]),t===-1?n.vertexCount=e.getAttribute("position").count:n.vertexCount=t,r===null?n.vertexStart=0:n.vertexStart=r.vertexStart+r.vertexCount;const c=e.getIndex(),h=c!==null;if(h&&(i===-1?n.indexCount=c.count:n.indexCount=i,r===null?n.indexStart=0:n.indexStart=r.indexStart+r.indexCount),n.indexStart!==-1&&n.indexStart+n.indexCount>this._maxIndexCount||n.vertexStart+n.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const u=this._visibility,f=this._active,p=this._matricesTexture,m=this._matricesTexture.image.data;u.push(!0),f.push(!0);const v=this._geometryCount;this._geometryCount++,Pee.toArray(m,v*16),p.needsUpdate=!0,o.push(n),a.push({start:h?n.indexStart:n.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new jt,sphereInitialized:!1,sphere:new ln});const g=this.geometry.getAttribute(cg);for(let y=0;y<n.vertexCount;y++)g.setX(n.vertexStart+y,v);return g.needsUpdate=!0,this.setGeometryAt(v,e),v}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,n=i.getIndex()!==null,r=i.getIndex(),o=t.getIndex(),a=this._reservedRanges[e];if(n&&o.count>a.indexCount||t.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,c=a.vertexCount;for(const p in i.attributes){if(p===cg)continue;const m=t.getAttribute(p),v=i.getAttribute(p);Bee(m,v,l);const g=m.itemSize;for(let y=m.count,A=c;y<A;y++){const _=l+y;for(let b=0;b<g;b++)v.setComponent(_,b,0)}v.needsUpdate=!0,v.addUpdateRange(l*g,c*g)}if(n){const p=a.indexStart;for(let m=0;m<o.count;m++)r.setX(p+m,l+o.getX(m));for(let m=o.count,v=a.indexCount;m<v;m++)r.setX(p+m,l);r.needsUpdate=!0,r.addUpdateRange(p,a.indexCount)}const h=this._bounds[e];t.boundingBox!==null?(h.box.copy(t.boundingBox),h.boxInitialized=!0):h.boxInitialized=!1,t.boundingSphere!==null?(h.sphere.copy(t.boundingSphere),h.sphereInitialized=!0):h.sphereInitialized=!1;const u=this._drawRanges[e],f=t.getAttribute("position");return u.count=n?o.count:f.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1?this:(t[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(this._active[e]===!1)return null;const n=this._bounds[e],r=n.box,o=this.geometry;if(n.boxInitialized===!1){r.makeEmpty();const a=o.index,l=o.attributes.position,c=this._drawRanges[e];for(let h=c.start,u=c.start+c.count;h<u;h++){let f=h;a&&(f=a.getX(f)),r.expandByPoint(A0.fromBufferAttribute(l,f))}n.boxInitialized=!0}return t.copy(r),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return null;const n=this._bounds[e],r=n.sphere,o=this.geometry;if(n.sphereInitialized===!1){r.makeEmpty(),this.getBoundingBoxAt(e,yw),yw.getCenter(r.center);const a=o.index,l=o.attributes.position,c=this._drawRanges[e];let h=0;for(let u=c.start,f=c.start+c.count;u<f;u++){let p=u;a&&(p=a.getX(p)),A0.fromBufferAttribute(l,p),h=Math.max(h,r.center.distanceToSquared(A0))}r.radius=Math.sqrt(h),n.sphereInitialized=!0}return t.copy(r),t}setMatrixAt(e,t){const i=this._active,n=this._matricesTexture,r=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||i[e]===!1?this:(t.toArray(r,e*16),n.needsUpdate=!0,this)}getMatrixAt(e,t){const i=this._active,n=this._matricesTexture.image.data,r=this._geometryCount;return e>=r||i[e]===!1?null:t.fromArray(n,e*16)}setVisibleAt(e,t){const i=this._visibility,n=this._active,r=this._geometryCount;return e>=r||n[e]===!1||i[e]===t?this:(i[e]=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._visibility,i=this._active,n=this._geometryCount;return e>=n||i[e]===!1?!1:t[e]}raycast(e,t){const i=this._visibility,n=this._active,r=this._drawRanges,o=this._geometryCount,a=this.matrixWorld,l=this.geometry;Ir.material=this.material,Ir.geometry.index=l.index,Ir.geometry.attributes=l.attributes,Ir.geometry.boundingBox===null&&(Ir.geometry.boundingBox=new jt),Ir.geometry.boundingSphere===null&&(Ir.geometry.boundingSphere=new ln);for(let c=0;c<o;c++){if(!i[c]||!n[c])continue;const h=r[c];Ir.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(c,Ir.matrixWorld).premultiply(a),this.getBoundingBoxAt(c,Ir.geometry.boundingBox),this.getBoundingSphereAt(c,Ir.geometry.boundingSphere),Ir.raycast(e,vw);for(let u=0,f=vw.length;u<f;u++){const p=vw[u];p.object=this,p.batchId=c,t.push(p)}vw.length=0}Ir.material=null,Ir.geometry.index=null,Ir.geometry.attributes={},Ir.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,i,n,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=n.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._active,c=this._visibility,h=this._multiDrawStarts,u=this._multiDrawCounts,f=this._drawRanges,p=this.perObjectFrustumCulled;p&&(V3.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),RI.setFromProjectionMatrix(V3,e.coordinateSystem));let m=0;if(this.sortObjects){H3.copy(this.matrixWorld).invert(),A0.setFromMatrixPosition(i.matrixWorld).applyMatrix4(H3);for(let y=0,A=c.length;y<A;y++)if(c[y]&&l[y]){this.getMatrixAt(y,Pu),this.getBoundingSphereAt(y,Bf).applyMatrix4(Pu);let _=!1;if(p&&(_=!RI.intersectsSphere(Bf)),!_){const b=A0.distanceTo(Bf.center);PI.push(f[y],b)}}const v=PI.list,g=this.customSort;g===null?v.sort(r.transparent?Iee:Tee):g.call(this,v,i);for(let y=0,A=v.length;y<A;y++){const _=v[y];h[m]=_.start*a,u[m]=_.count,m++}PI.reset()}else for(let v=0,g=c.length;v<g;v++)if(c[v]&&l[v]){let y=!1;if(p&&(this.getMatrixAt(v,Pu),this.getBoundingSphereAt(v,Bf).applyMatrix4(Pu),y=!RI.intersectsSphere(Bf)),!y){const A=f[v];h[m]=A.start*a,u[m]=A.count,m++}}this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(e,t,i,n,r,o){this.onBeforeRender(e,null,n,r,o)}}let ji=class extends Ht{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ae(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}};const Q3=new S,W3=new S,j3=new le,BI=new _o,Aw=new ln;let An=class extends ye{constructor(e=new yt,t=new ji){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let n=1,r=t.count;n<r;n++)Q3.fromBufferAttribute(t,n-1),W3.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=Q3.distanceTo(W3);e.setAttribute("lineDistance",new rt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Aw.copy(i.boundingSphere),Aw.applyMatrix4(n),Aw.radius+=r,e.ray.intersectsSphere(Aw)===!1)return;j3.copy(n).invert(),BI.copy(e.ray).applyMatrix4(j3);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new S,h=new S,u=new S,f=new S,p=this.isLineSegments?2:1,m=i.index,g=i.attributes.position;if(m!==null){const y=Math.max(0,o.start),A=Math.min(m.count,o.start+o.count);for(let _=y,b=A-1;_<b;_+=p){const x=m.getX(_),E=m.getX(_+1);if(c.fromBufferAttribute(g,x),h.fromBufferAttribute(g,E),BI.distanceSqToSegment(c,h,f,u)>l)continue;f.applyMatrix4(this.matrixWorld);const T=e.ray.origin.distanceTo(f);T<e.near||T>e.far||t.push({distance:T,point:u.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{const y=Math.max(0,o.start),A=Math.min(g.count,o.start+o.count);for(let _=y,b=A-1;_<b;_+=p){if(c.fromBufferAttribute(g,_),h.fromBufferAttribute(g,_+1),BI.distanceSqToSegment(c,h,f,u)>l)continue;f.applyMatrix4(this.matrixWorld);const E=e.ray.origin.distanceTo(f);E<e.near||E>e.far||t.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}};const q3=new S,X3=new S;let jr=class extends An{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let n=0,r=t.count;n<r;n+=2)q3.fromBufferAttribute(t,n),X3.fromBufferAttribute(t,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+q3.distanceTo(X3);e.setAttribute("lineDistance",new rt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},eL=class extends An{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}},md=class extends Ht{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ae(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}};const Y3=new le,_2=new _o,_w=new ln,bw=new S;let Py=class extends ye{constructor(e=new yt,t=new md){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),_w.copy(i.boundingSphere),_w.applyMatrix4(n),_w.radius+=r,e.ray.intersectsSphere(_w)===!1)return;Y3.copy(n).invert(),_2.copy(e.ray).applyMatrix4(Y3);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,u=i.attributes.position;if(c!==null){const f=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let m=f,v=p;m<v;m++){const g=c.getX(m);bw.fromBufferAttribute(u,g),K3(bw,g,l,n,e,t,this)}}else{const f=Math.max(0,o.start),p=Math.min(u.count,o.start+o.count);for(let m=f,v=p;m<v;m++)bw.fromBufferAttribute(u,m),K3(bw,m,l,n,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}};function K3(s,e,t,i,n,r,o){const a=_2.distanceSqToPoint(s);if(a<t){const l=new S;_2.closestPointToPoint(s,l),l.applyMatrix4(i);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class G8 extends Wt{constructor(e,t,i,n,r,o,a,l,c){super(e,t,i,n,r,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Nt,this.magFilter=r!==void 0?r:Nt,this.generateMipmaps=!1;const h=this;function u(){h.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Dee extends Wt{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Ot,this.minFilter=Ot,this.generateMipmaps=!1,this.needsUpdate=!0}}let Md=class extends Wt{constructor(e,t,i,n,r,o,a,l,c,h,u,f){super(null,o,a,l,c,h,n,r,u,f),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}},Oee=class extends Md{constructor(e,t,i,n,r,o){super(e,t,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=as}},Lee=class extends Md{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,ru),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}};class tL extends Wt{constructor(e,t,i,n,r,o,a,l,c){super(e,t,i,n,r,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ll{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let a=0,l=r-1,c;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),c=i[n]-o,c<0)a=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,i[n]===o)return n/(r-1);const h=i[n],f=i[n+1]-h,p=(o-h)/f;return(n+p)/(r-1)}getTangent(e,t){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);const o=this.getPoint(n),a=this.getPoint(r),l=t||(o.isVector2?new ee:new S);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new S,n=[],r=[],o=[],a=new S,l=new le;for(let p=0;p<=e;p++){const m=p/e;n[p]=this.getTangentAt(m,new S)}r[0]=new S,o[0]=new S;let c=Number.MAX_VALUE;const h=Math.abs(n[0].x),u=Math.abs(n[0].y),f=Math.abs(n[0].z);h<=c&&(c=h,i.set(1,0,0)),u<=c&&(c=u,i.set(0,1,0)),f<=c&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),o[0].crossVectors(n[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(n[p-1],n[p]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(zn(n[p-1].dot(n[p]),-1,1));r[p].applyMatrix4(l.makeRotationAxis(a,m))}o[p].crossVectors(n[p],r[p])}if(t===!0){let p=Math.acos(zn(r[0].dot(r[e]),-1,1));p/=e,n[0].dot(a.crossVectors(r[0],r[e]))>0&&(p=-p);for(let m=1;m<=e;m++)r[m].applyMatrix4(l.makeRotationAxis(n[m],p*m)),o[m].crossVectors(n[m],r[m])}return{tangents:n,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class nM extends ll{constructor(e=0,t=0,i=1,n=1,r=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new ee){const i=t,n=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(o?r=0:r=n),this.aClockwise===!0&&!o&&(r===n?r=-n:r=r-n);const a=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),f=l-this.aX,p=c-this.aY;l=f*h-p*u+this.aX,c=f*u+p*h+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class H8 extends nM{constructor(e,t,i,n,r,o){super(e,t,i,i,n,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function iL(){let s=0,e=0,t=0,i=0;function n(r,o,a,l){s=r,e=a,t=-3*r+3*o-2*a-l,i=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,c){n(o,a,c*(a-r),c*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,c,h,u){let f=(o-r)/c-(a-r)/(c+h)+(a-o)/h,p=(a-o)/h-(l-o)/(h+u)+(l-a)/u;f*=h,p*=h,n(o,a,f,p)},calc:function(r){const o=r*r,a=o*r;return s+e*r+t*o+i*a}}}const xw=new S,DI=new iL,OI=new iL,LI=new iL;class V8 extends ll{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new S){const i=t,n=this.points,r=n.length,o=(r-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,h;this.closed||a>0?c=n[(a-1)%r]:(xw.subVectors(n[0],n[1]).add(n[0]),c=xw);const u=n[a%r],f=n[(a+1)%r];if(this.closed||a+2<r?h=n[(a+2)%r]:(xw.subVectors(n[r-1],n[r-2]).add(n[r-1]),h=xw),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let m=Math.pow(c.distanceToSquared(u),p),v=Math.pow(u.distanceToSquared(f),p),g=Math.pow(f.distanceToSquared(h),p);v<1e-4&&(v=1),m<1e-4&&(m=v),g<1e-4&&(g=v),DI.initNonuniformCatmullRom(c.x,u.x,f.x,h.x,m,v,g),OI.initNonuniformCatmullRom(c.y,u.y,f.y,h.y,m,v,g),LI.initNonuniformCatmullRom(c.z,u.z,f.z,h.z,m,v,g)}else this.curveType==="catmullrom"&&(DI.initCatmullRom(c.x,u.x,f.x,h.x,this.tension),OI.initCatmullRom(c.y,u.y,f.y,h.y,this.tension),LI.initCatmullRom(c.z,u.z,f.z,h.z,this.tension));return i.set(DI.calc(l),OI.calc(l),LI.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new S().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function J3(s,e,t,i,n){const r=(i-e)*.5,o=(n-t)*.5,a=s*s,l=s*a;return(2*t-2*i+r+o)*l+(-3*t+3*i-2*r-o)*a+r*s+t}function kee(s,e){const t=1-s;return t*t*e}function Fee(s,e){return 2*(1-s)*s*e}function Uee(s,e){return s*s*e}function VA(s,e,t,i){return kee(s,e)+Fee(s,t)+Uee(s,i)}function Nee(s,e){const t=1-s;return t*t*t*e}function zee(s,e){const t=1-s;return 3*t*t*s*e}function Gee(s,e){return 3*(1-s)*s*s*e}function Hee(s,e){return s*s*s*e}function QA(s,e,t,i,n){return Nee(s,e)+zee(s,t)+Gee(s,i)+Hee(s,n)}class nL extends ll{constructor(e=new ee,t=new ee,i=new ee,n=new ee){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new ee){const i=t,n=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(QA(e,n.x,r.x,o.x,a.x),QA(e,n.y,r.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Q8 extends ll{constructor(e=new S,t=new S,i=new S,n=new S){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new S){const i=t,n=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(QA(e,n.x,r.x,o.x,a.x),QA(e,n.y,r.y,o.y,a.y),QA(e,n.z,r.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class sL extends ll{constructor(e=new ee,t=new ee){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ee){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ee){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class W8 extends ll{constructor(e=new S,t=new S){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new S){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new S){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class rL extends ll{constructor(e=new ee,t=new ee,i=new ee){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ee){const i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(VA(e,n.x,r.x,o.x),VA(e,n.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class oL extends ll{constructor(e=new S,t=new S,i=new S){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new S){const i=t,n=this.v0,r=this.v1,o=this.v2;return i.set(VA(e,n.x,r.x,o.x),VA(e,n.y,r.y,o.y),VA(e,n.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class aL extends ll{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ee){const i=t,n=this.points,r=(n.length-1)*e,o=Math.floor(r),a=r-o,l=n[o===0?o:o-1],c=n[o],h=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return i.set(J3(a,l.x,c.x,h.x,u.x),J3(a,l.y,c.y,h.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new ee().fromArray(n))}return this}}var N1=Object.freeze({__proto__:null,ArcCurve:H8,CatmullRomCurve3:V8,CubicBezierCurve:nL,CubicBezierCurve3:Q8,EllipseCurve:nM,LineCurve:sL,LineCurve3:W8,QuadraticBezierCurve:rL,QuadraticBezierCurve3:oL,SplineCurve:aL});class j8 extends ll{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new N1[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const o=n[r]-i,a=this.curves[r],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const o=r[n],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const h=l[c];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(new N1[n.type]().fromJSON(n))}return this}}class P_ extends j8{constructor(e){super(),this.type="Path",this.currentPoint=new ee,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new sL(this.currentPoint.clone(),new ee(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const r=new rL(this.currentPoint.clone(),new ee(e,t),new ee(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,o){const a=new nL(this.currentPoint.clone(),new ee(e,t),new ee(i,n),new ee(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new aL(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,n,r,o),this}absarc(e,t,i,n,r,o){return this.absellipse(e,t,i,i,n,r,o),this}ellipse(e,t,i,n,r,o,a,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,i,n,r,o,a,l),this}absellipse(e,t,i,n,r,o,a,l){const c=new nM(e,t,i,n,r,o,a,l);if(this.curves.length>0){const u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Db extends yt{constructor(e=[new ee(0,-.5),new ee(.5,0),new ee(0,.5)],t=12,i=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=zn(n,0,Math.PI*2);const r=[],o=[],a=[],l=[],c=[],h=1/t,u=new S,f=new ee,p=new S,m=new S,v=new S;let g=0,y=0;for(let A=0;A<=e.length-1;A++)switch(A){case 0:g=e[A+1].x-e[A].x,y=e[A+1].y-e[A].y,p.x=y*1,p.y=-g,p.z=y*0,v.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(v.x,v.y,v.z);break;default:g=e[A+1].x-e[A].x,y=e[A+1].y-e[A].y,p.x=y*1,p.y=-g,p.z=y*0,m.copy(p),p.x+=v.x,p.y+=v.y,p.z+=v.z,p.normalize(),l.push(p.x,p.y,p.z),v.copy(m)}for(let A=0;A<=t;A++){const _=i+A*h*n,b=Math.sin(_),x=Math.cos(_);for(let E=0;E<=e.length-1;E++){u.x=e[E].x*b,u.y=e[E].y,u.z=e[E].x*x,o.push(u.x,u.y,u.z),f.x=A/t,f.y=E/(e.length-1),a.push(f.x,f.y);const M=l[3*E+0]*b,T=l[3*E+1],R=l[3*E+0]*x;c.push(M,T,R)}}for(let A=0;A<t;A++)for(let _=0;_<e.length-1;_++){const b=_+A*e.length,x=b,E=b+e.length,M=b+e.length+1,T=b+1;r.push(x,E,T),r.push(M,T,E)}this.setIndex(r),this.setAttribute("position",new rt(o,3)),this.setAttribute("uv",new rt(a,2)),this.setAttribute("normal",new rt(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Db(e.points,e.segments,e.phiStart,e.phiLength)}}class sM extends Db{constructor(e=1,t=1,i=4,n=8){const r=new P_;r.absarc(0,-t/2,e,Math.PI*1.5,0),r.absarc(0,t/2,e,0,Math.PI*.5),super(r.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:n}}static fromJSON(e){return new sM(e.radius,e.length,e.capSegments,e.radialSegments)}}class rM extends yt{constructor(e=1,t=32,i=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);const r=[],o=[],a=[],l=[],c=new S,h=new ee;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let u=0,f=3;u<=t;u++,f+=3){const p=i+u/t*n;c.x=e*Math.cos(p),c.y=e*Math.sin(p),o.push(c.x,c.y,c.z),a.push(0,0,1),h.x=(o[f]/e+1)/2,h.y=(o[f+1]/e+1)/2,l.push(h.x,h.y)}for(let u=1;u<=t;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new rt(o,3)),this.setAttribute("normal",new rt(a,3)),this.setAttribute("uv",new rt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new rM(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Xn extends yt{constructor(e=1,t=1,i=1,n=32,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;n=Math.floor(n),r=Math.floor(r);const h=[],u=[],f=[],p=[];let m=0;const v=[],g=i/2;let y=0;A(),o===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new rt(u,3)),this.setAttribute("normal",new rt(f,3)),this.setAttribute("uv",new rt(p,2));function A(){const b=new S,x=new S;let E=0;const M=(t-e)/i;for(let T=0;T<=r;T++){const R=[],w=T/r,I=w*(t-e)+e;for(let O=0;O<=n;O++){const k=O/n,B=k*l+a,G=Math.sin(B),L=Math.cos(B);x.x=I*G,x.y=-w*i+g,x.z=I*L,u.push(x.x,x.y,x.z),b.set(G,M,L).normalize(),f.push(b.x,b.y,b.z),p.push(k,1-w),R.push(m++)}v.push(R)}for(let T=0;T<n;T++)for(let R=0;R<r;R++){const w=v[R][T],I=v[R+1][T],O=v[R+1][T+1],k=v[R][T+1];h.push(w,I,k),h.push(I,O,k),E+=6}c.addGroup(y,E,0),y+=E}function _(b){const x=m,E=new ee,M=new S;let T=0;const R=b===!0?e:t,w=b===!0?1:-1;for(let O=1;O<=n;O++)u.push(0,g*w,0),f.push(0,w,0),p.push(.5,.5),m++;const I=m;for(let O=0;O<=n;O++){const B=O/n*l+a,G=Math.cos(B),L=Math.sin(B);M.x=R*L,M.y=g*w,M.z=R*G,u.push(M.x,M.y,M.z),f.push(0,w,0),E.x=G*.5+.5,E.y=L*.5*w+.5,p.push(E.x,E.y),m++}for(let O=0;O<n;O++){const k=x+O,B=I+O;b===!0?h.push(B,B+1,k):h.push(B+1,B,k),T+=3}c.addGroup(y,T,b===!0?1:2),y+=T}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xn(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class oM extends Xn{constructor(e=1,t=1,i=32,n=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,i,n,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new oM(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class $d extends yt{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};const r=[],o=[];a(n),c(i),h(),this.setAttribute("position",new rt(r,3)),this.setAttribute("normal",new rt(r.slice(),3)),this.setAttribute("uv",new rt(o,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function a(A){const _=new S,b=new S,x=new S;for(let E=0;E<t.length;E+=3)p(t[E+0],_),p(t[E+1],b),p(t[E+2],x),l(_,b,x,A)}function l(A,_,b,x){const E=x+1,M=[];for(let T=0;T<=E;T++){M[T]=[];const R=A.clone().lerp(b,T/E),w=_.clone().lerp(b,T/E),I=E-T;for(let O=0;O<=I;O++)O===0&&T===E?M[T][O]=R:M[T][O]=R.clone().lerp(w,O/I)}for(let T=0;T<E;T++)for(let R=0;R<2*(E-T)-1;R++){const w=Math.floor(R/2);R%2===0?(f(M[T][w+1]),f(M[T+1][w]),f(M[T][w])):(f(M[T][w+1]),f(M[T+1][w+1]),f(M[T+1][w]))}}function c(A){const _=new S;for(let b=0;b<r.length;b+=3)_.x=r[b+0],_.y=r[b+1],_.z=r[b+2],_.normalize().multiplyScalar(A),r[b+0]=_.x,r[b+1]=_.y,r[b+2]=_.z}function h(){const A=new S;for(let _=0;_<r.length;_+=3){A.x=r[_+0],A.y=r[_+1],A.z=r[_+2];const b=g(A)/2/Math.PI+.5,x=y(A)/Math.PI+.5;o.push(b,1-x)}m(),u()}function u(){for(let A=0;A<o.length;A+=6){const _=o[A+0],b=o[A+2],x=o[A+4],E=Math.max(_,b,x),M=Math.min(_,b,x);E>.9&&M<.1&&(_<.2&&(o[A+0]+=1),b<.2&&(o[A+2]+=1),x<.2&&(o[A+4]+=1))}}function f(A){r.push(A.x,A.y,A.z)}function p(A,_){const b=A*3;_.x=e[b+0],_.y=e[b+1],_.z=e[b+2]}function m(){const A=new S,_=new S,b=new S,x=new S,E=new ee,M=new ee,T=new ee;for(let R=0,w=0;R<r.length;R+=9,w+=6){A.set(r[R+0],r[R+1],r[R+2]),_.set(r[R+3],r[R+4],r[R+5]),b.set(r[R+6],r[R+7],r[R+8]),E.set(o[w+0],o[w+1]),M.set(o[w+2],o[w+3]),T.set(o[w+4],o[w+5]),x.copy(A).add(_).add(b).divideScalar(3);const I=g(x);v(E,w+0,A,I),v(M,w+2,_,I),v(T,w+4,b,I)}}function v(A,_,b,x){x<0&&A.x===1&&(o[_]=A.x-1),b.x===0&&b.z===0&&(o[_]=x/2/Math.PI+.5)}function g(A){return Math.atan2(A.z,-A.x)}function y(A){return Math.atan2(-A.y,Math.sqrt(A.x*A.x+A.z*A.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $d(e.vertices,e.indices,e.radius,e.details)}}class aM extends $d{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new aM(e.radius,e.detail)}}const ww=new S,Sw=new S,kI=new S,Cw=new pr;class lL extends yt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const n=Math.pow(10,4),r=Math.cos(Bp*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],h=["a","b","c"],u=new Array(3),f={},p=[];for(let m=0;m<l;m+=3){o?(c[0]=o.getX(m),c[1]=o.getX(m+1),c[2]=o.getX(m+2)):(c[0]=m,c[1]=m+1,c[2]=m+2);const{a:v,b:g,c:y}=Cw;if(v.fromBufferAttribute(a,c[0]),g.fromBufferAttribute(a,c[1]),y.fromBufferAttribute(a,c[2]),Cw.getNormal(kI),u[0]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,u[1]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,u[2]=`${Math.round(y.x*n)},${Math.round(y.y*n)},${Math.round(y.z*n)}`,!(u[0]===u[1]||u[1]===u[2]||u[2]===u[0]))for(let A=0;A<3;A++){const _=(A+1)%3,b=u[A],x=u[_],E=Cw[h[A]],M=Cw[h[_]],T=`${b}_${x}`,R=`${x}_${b}`;R in f&&f[R]?(kI.dot(f[R].normal)<=r&&(p.push(E.x,E.y,E.z),p.push(M.x,M.y,M.z)),f[R]=null):T in f||(f[T]={index0:c[A],index1:c[_],normal:kI.clone()})}}for(const m in f)if(f[m]){const{index0:v,index1:g}=f[m];ww.fromBufferAttribute(a,v),Sw.fromBufferAttribute(a,g),p.push(ww.x,ww.y,ww.z),p.push(Sw.x,Sw.y,Sw.z)}this.setAttribute("position",new rt(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Td extends P_{constructor(e){super(e),this.uuid=pa(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const n=e.holes[t];this.holes.push(new P_().fromJSON(n))}return this}}const Vee={triangulate:function(s,e,t=2){const i=e&&e.length,n=i?e[0]*t:s.length;let r=q8(s,0,n,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,u,f,p;if(i&&(r=Xee(s,e,r,t)),s.length>80*t){a=c=s[0],l=h=s[1];for(let m=t;m<n;m+=t)u=s[m],f=s[m+1],u<a&&(a=u),f<l&&(l=f),u>c&&(c=u),f>h&&(h=f);p=Math.max(c-a,h-l),p=p!==0?32767/p:0}return B_(r,o,t,a,l,p,0),o}};function q8(s,e,t,i,n){let r,o;if(n===rte(s,e,t,i)>0)for(r=e;r<t;r+=i)o=Z3(r,s[r],s[r+1],o);else for(r=t-i;r>=e;r-=i)o=Z3(r,s[r],s[r+1],o);return o&&lM(o,o.next)&&(O_(o),o=o.next),o}function tm(s,e){if(!s)return s;e||(e=s);let t=s,i;do if(i=!1,!t.steiner&&(lM(t,t.next)||Pn(t.prev,t,t.next)===0)){if(O_(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function B_(s,e,t,i,n,r,o){if(!s)return;!o&&r&&$ee(s,i,n,r);let a=s,l,c;for(;s.prev!==s.next;){if(l=s.prev,c=s.next,r?Wee(s,i,n,r):Qee(s)){e.push(l.i/t|0),e.push(s.i/t|0),e.push(c.i/t|0),O_(s),s=c.next,a=c.next;continue}if(s=c,s===a){o?o===1?(s=jee(tm(s),e,t),B_(s,e,t,i,n,r,2)):o===2&&qee(s,e,t,i,n,r):B_(tm(s),e,t,i,n,r,1);break}}}function Qee(s){const e=s.prev,t=s,i=s.next;if(Pn(e,t,i)>=0)return!1;const n=e.x,r=t.x,o=i.x,a=e.y,l=t.y,c=i.y,h=n<r?n<o?n:o:r<o?r:o,u=a<l?a<c?a:c:l<c?l:c,f=n>r?n>o?n:o:r>o?r:o,p=a>l?a>c?a:c:l>c?l:c;let m=i.next;for(;m!==e;){if(m.x>=h&&m.x<=f&&m.y>=u&&m.y<=p&&my(n,a,r,l,o,c,m.x,m.y)&&Pn(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Wee(s,e,t,i){const n=s.prev,r=s,o=s.next;if(Pn(n,r,o)>=0)return!1;const a=n.x,l=r.x,c=o.x,h=n.y,u=r.y,f=o.y,p=a<l?a<c?a:c:l<c?l:c,m=h<u?h<f?h:f:u<f?u:f,v=a>l?a>c?a:c:l>c?l:c,g=h>u?h>f?h:f:u>f?u:f,y=b2(p,m,e,t,i),A=b2(v,g,e,t,i);let _=s.prevZ,b=s.nextZ;for(;_&&_.z>=y&&b&&b.z<=A;){if(_.x>=p&&_.x<=v&&_.y>=m&&_.y<=g&&_!==n&&_!==o&&my(a,h,l,u,c,f,_.x,_.y)&&Pn(_.prev,_,_.next)>=0||(_=_.prevZ,b.x>=p&&b.x<=v&&b.y>=m&&b.y<=g&&b!==n&&b!==o&&my(a,h,l,u,c,f,b.x,b.y)&&Pn(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=v&&_.y>=m&&_.y<=g&&_!==n&&_!==o&&my(a,h,l,u,c,f,_.x,_.y)&&Pn(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=A;){if(b.x>=p&&b.x<=v&&b.y>=m&&b.y<=g&&b!==n&&b!==o&&my(a,h,l,u,c,f,b.x,b.y)&&Pn(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function jee(s,e,t){let i=s;do{const n=i.prev,r=i.next.next;!lM(n,r)&&X8(n,i,i.next,r)&&D_(n,r)&&D_(r,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(r.i/t|0),O_(i),O_(i.next),i=s=r),i=i.next}while(i!==s);return tm(i)}function qee(s,e,t,i,n,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&ite(o,a)){let l=Y8(o,a);o=tm(o,o.next),l=tm(l,l.next),B_(o,e,t,i,n,r,0),B_(l,e,t,i,n,r,0);return}a=a.next}o=o.next}while(o!==s)}function Xee(s,e,t,i){const n=[];let r,o,a,l,c;for(r=0,o=e.length;r<o;r++)a=e[r]*i,l=r<o-1?e[r+1]*i:s.length,c=q8(s,a,l,i,!1),c===c.next&&(c.steiner=!0),n.push(tte(c));for(n.sort(Yee),r=0;r<n.length;r++)t=Kee(n[r],t);return t}function Yee(s,e){return s.x-e.x}function Kee(s,e){const t=Jee(s,e);if(!t)return e;const i=Y8(t,s);return tm(i,i.next),tm(t,t.next)}function Jee(s,e){let t=e,i=-1/0,n;const r=s.x,o=s.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const f=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=r&&f>i&&(i=f,n=t.x<t.next.x?t:t.next,f===r))return n}t=t.next}while(t!==e);if(!n)return null;const a=n,l=n.x,c=n.y;let h=1/0,u;t=n;do r>=t.x&&t.x>=l&&r!==t.x&&my(o<c?r:i,o,l,c,o<c?i:r,o,t.x,t.y)&&(u=Math.abs(o-t.y)/(r-t.x),D_(t,s)&&(u<h||u===h&&(t.x>n.x||t.x===n.x&&Zee(n,t)))&&(n=t,h=u)),t=t.next;while(t!==a);return n}function Zee(s,e){return Pn(s.prev,s,e.prev)<0&&Pn(e.next,s,s.next)<0}function $ee(s,e,t,i){let n=s;do n.z===0&&(n.z=b2(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==s);n.prevZ.nextZ=null,n.prevZ=null,ete(n)}function ete(s){let e,t,i,n,r,o,a,l,c=1;do{for(t=s,s=null,r=null,o=0;t;){for(o++,i=t,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,a--):(n=i,i=i.nextZ,l--),r?r.nextZ=n:s=n,n.prevZ=r,r=n;t=i}r.nextZ=null,c*=2}while(o>1);return s}function b2(s,e,t,i,n){return s=(s-t)*n|0,e=(e-i)*n|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function tte(s){let e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function my(s,e,t,i,n,r,o,a){return(n-o)*(e-a)>=(s-o)*(r-a)&&(s-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(n-o)*(i-a)}function ite(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!nte(s,e)&&(D_(s,e)&&D_(e,s)&&ste(s,e)&&(Pn(s.prev,s,e.prev)||Pn(s,e.prev,e))||lM(s,e)&&Pn(s.prev,s,s.next)>0&&Pn(e.prev,e,e.next)>0)}function Pn(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function lM(s,e){return s.x===e.x&&s.y===e.y}function X8(s,e,t,i){const n=Mw(Pn(s,e,t)),r=Mw(Pn(s,e,i)),o=Mw(Pn(t,i,s)),a=Mw(Pn(t,i,e));return!!(n!==r&&o!==a||n===0&&Ew(s,t,e)||r===0&&Ew(s,i,e)||o===0&&Ew(t,s,i)||a===0&&Ew(t,e,i))}function Ew(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function Mw(s){return s>0?1:s<0?-1:0}function nte(s,e){let t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&X8(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function D_(s,e){return Pn(s.prev,s,s.next)<0?Pn(s,e,s.next)>=0&&Pn(s,s.prev,e)>=0:Pn(s,e,s.prev)<0||Pn(s,s.next,e)<0}function ste(s,e){let t=s,i=!1;const n=(s.x+e.x)/2,r=(s.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&n<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==s);return i}function Y8(s,e){const t=new x2(s.i,s.x,s.y),i=new x2(e.i,e.x,e.y),n=s.next,r=e.prev;return s.next=e,e.prev=s,t.next=n,n.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function Z3(s,e,t,i){const n=new x2(s,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function O_(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function x2(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function rte(s,e,t,i){let n=0;for(let r=e,o=t-i;r<t;r+=i)n+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return n}class kl{static area(e){const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return i*.5}static isClockWise(e){return kl.area(e)<0}static triangulateShape(e,t){const i=[],n=[],r=[];$3(e),eN(i,e);let o=e.length;t.forEach($3);for(let l=0;l<t.length;l++)n.push(o),o+=t[l].length,eN(i,t[l]);const a=Vee.triangulate(i,n);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function $3(s){const e=s.length;e>2&&s[e-1].equals(s[0])&&s.pop()}function eN(s,e){for(let t=0;t<e.length;t++)s.push(e[t].x),s.push(e[t].y)}class bv extends yt{constructor(e=new Td([new ee(.5,.5),new ee(-.5,.5),new ee(-.5,-.5),new ee(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],r=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new rt(n,3)),this.setAttribute("uv",new rt(r,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,u=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,p=t.bevelThickness!==void 0?t.bevelThickness:.2,m=t.bevelSize!==void 0?t.bevelSize:p-.1,v=t.bevelOffset!==void 0?t.bevelOffset:0,g=t.bevelSegments!==void 0?t.bevelSegments:3;const y=t.extrudePath,A=t.UVGenerator!==void 0?t.UVGenerator:ote;let _,b=!1,x,E,M,T;y&&(_=y.getSpacedPoints(h),b=!0,f=!1,x=y.computeFrenetFrames(h,!1),E=new S,M=new S,T=new S),f||(g=0,p=0,m=0,v=0);const R=a.extractPoints(c);let w=R.shape;const I=R.holes;if(!kl.isClockWise(w)){w=w.reverse();for(let q=0,He=I.length;q<He;q++){const we=I[q];kl.isClockWise(we)&&(I[q]=we.reverse())}}const k=kl.triangulateShape(w,I),B=w;for(let q=0,He=I.length;q<He;q++){const we=I[q];w=w.concat(we)}function G(q,He,we){return He||console.error("THREE.ExtrudeGeometry: vec does not exist"),q.clone().addScaledVector(He,we)}const L=w.length,U=k.length;function z(q,He,we){let Ne,Ee,st;const et=q.x-He.x,ct=q.y-He.y,zt=we.x-q.x,V=we.y-q.y,F=et*et+ct*ct,ge=et*V-ct*zt;if(Math.abs(ge)>Number.EPSILON){const _e=Math.sqrt(F),Pe=Math.sqrt(zt*zt+V*V),Te=He.x-ct/_e,xt=He.y+et/_e,ft=we.x-V/Pe,Le=we.y+zt/Pe,Qe=((ft-Te)*V-(Le-xt)*zt)/(et*V-ct*zt);Ne=Te+et*Qe-q.x,Ee=xt+ct*Qe-q.y;const St=Ne*Ne+Ee*Ee;if(St<=2)return new ee(Ne,Ee);st=Math.sqrt(St/2)}else{let _e=!1;et>Number.EPSILON?zt>Number.EPSILON&&(_e=!0):et<-Number.EPSILON?zt<-Number.EPSILON&&(_e=!0):Math.sign(ct)===Math.sign(V)&&(_e=!0),_e?(Ne=-ct,Ee=et,st=Math.sqrt(F)):(Ne=et,Ee=ct,st=Math.sqrt(F/2))}return new ee(Ne/st,Ee/st)}const j=[];for(let q=0,He=B.length,we=He-1,Ne=q+1;q<He;q++,we++,Ne++)we===He&&(we=0),Ne===He&&(Ne=0),j[q]=z(B[q],B[we],B[Ne]);const X=[];let re,ce=j.concat();for(let q=0,He=I.length;q<He;q++){const we=I[q];re=[];for(let Ne=0,Ee=we.length,st=Ee-1,et=Ne+1;Ne<Ee;Ne++,st++,et++)st===Ee&&(st=0),et===Ee&&(et=0),re[Ne]=z(we[Ne],we[st],we[et]);X.push(re),ce=ce.concat(re)}for(let q=0;q<g;q++){const He=q/g,we=p*Math.cos(He*Math.PI/2),Ne=m*Math.sin(He*Math.PI/2)+v;for(let Ee=0,st=B.length;Ee<st;Ee++){const et=G(B[Ee],j[Ee],Ne);Fe(et.x,et.y,-we)}for(let Ee=0,st=I.length;Ee<st;Ee++){const et=I[Ee];re=X[Ee];for(let ct=0,zt=et.length;ct<zt;ct++){const V=G(et[ct],re[ct],Ne);Fe(V.x,V.y,-we)}}}const Me=m+v;for(let q=0;q<L;q++){const He=f?G(w[q],ce[q],Me):w[q];b?(M.copy(x.normals[0]).multiplyScalar(He.x),E.copy(x.binormals[0]).multiplyScalar(He.y),T.copy(_[0]).add(M).add(E),Fe(T.x,T.y,T.z)):Fe(He.x,He.y,0)}for(let q=1;q<=h;q++)for(let He=0;He<L;He++){const we=f?G(w[He],ce[He],Me):w[He];b?(M.copy(x.normals[q]).multiplyScalar(we.x),E.copy(x.binormals[q]).multiplyScalar(we.y),T.copy(_[q]).add(M).add(E),Fe(T.x,T.y,T.z)):Fe(we.x,we.y,u/h*q)}for(let q=g-1;q>=0;q--){const He=q/g,we=p*Math.cos(He*Math.PI/2),Ne=m*Math.sin(He*Math.PI/2)+v;for(let Ee=0,st=B.length;Ee<st;Ee++){const et=G(B[Ee],j[Ee],Ne);Fe(et.x,et.y,u+we)}for(let Ee=0,st=I.length;Ee<st;Ee++){const et=I[Ee];re=X[Ee];for(let ct=0,zt=et.length;ct<zt;ct++){const V=G(et[ct],re[ct],Ne);b?Fe(V.x,V.y+_[h-1].y,_[h-1].x+we):Fe(V.x,V.y,u+we)}}}se(),ve();function se(){const q=n.length/3;if(f){let He=0,we=L*He;for(let Ne=0;Ne<U;Ne++){const Ee=k[Ne];Ge(Ee[2]+we,Ee[1]+we,Ee[0]+we)}He=h+g*2,we=L*He;for(let Ne=0;Ne<U;Ne++){const Ee=k[Ne];Ge(Ee[0]+we,Ee[1]+we,Ee[2]+we)}}else{for(let He=0;He<U;He++){const we=k[He];Ge(we[2],we[1],we[0])}for(let He=0;He<U;He++){const we=k[He];Ge(we[0]+L*h,we[1]+L*h,we[2]+L*h)}}i.addGroup(q,n.length/3-q,0)}function ve(){const q=n.length/3;let He=0;xe(B,He),He+=B.length;for(let we=0,Ne=I.length;we<Ne;we++){const Ee=I[we];xe(Ee,He),He+=Ee.length}i.addGroup(q,n.length/3-q,1)}function xe(q,He){let we=q.length;for(;--we>=0;){const Ne=we;let Ee=we-1;Ee<0&&(Ee=q.length-1);for(let st=0,et=h+g*2;st<et;st++){const ct=L*st,zt=L*(st+1),V=He+Ne+ct,F=He+Ee+ct,ge=He+Ee+zt,_e=He+Ne+zt;je(V,F,ge,_e)}}}function Fe(q,He,we){l.push(q),l.push(He),l.push(we)}function Ge(q,He,we){lt(q),lt(He),lt(we);const Ne=n.length/3,Ee=A.generateTopUV(i,n,Ne-3,Ne-2,Ne-1);ot(Ee[0]),ot(Ee[1]),ot(Ee[2])}function je(q,He,we,Ne){lt(q),lt(He),lt(Ne),lt(He),lt(we),lt(Ne);const Ee=n.length/3,st=A.generateSideWallUV(i,n,Ee-6,Ee-3,Ee-2,Ee-1);ot(st[0]),ot(st[1]),ot(st[3]),ot(st[1]),ot(st[2]),ot(st[3])}function lt(q){n.push(l[q*3+0]),n.push(l[q*3+1]),n.push(l[q*3+2])}function ot(q){r.push(q.x),r.push(q.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return ate(t,i,e)}static fromJSON(e,t){const i=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=t[e.shapes[r]];i.push(a)}const n=e.options.extrudePath;return n!==void 0&&(e.options.extrudePath=new N1[n.type]().fromJSON(n)),new bv(i,e.options)}}const ote={generateTopUV:function(s,e,t,i,n){const r=e[t*3],o=e[t*3+1],a=e[i*3],l=e[i*3+1],c=e[n*3],h=e[n*3+1];return[new ee(r,o),new ee(a,l),new ee(c,h)]},generateSideWallUV:function(s,e,t,i,n,r){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[i*3],h=e[i*3+1],u=e[i*3+2],f=e[n*3],p=e[n*3+1],m=e[n*3+2],v=e[r*3],g=e[r*3+1],y=e[r*3+2];return Math.abs(a-h)<Math.abs(o-c)?[new ee(o,1-l),new ee(c,1-u),new ee(f,1-m),new ee(v,1-y)]:[new ee(a,1-l),new ee(h,1-u),new ee(p,1-m),new ee(g,1-y)]}};function ate(s,e,t){if(t.shapes=[],Array.isArray(s))for(let i=0,n=s.length;i<n;i++){const r=s[i];t.shapes.push(r.uuid)}else t.shapes.push(s.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class cM extends $d{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new cM(e.radius,e.detail)}}class qh extends $d{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,n,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new qh(e.radius,e.detail)}}class Ob extends yt{constructor(e=.5,t=1,i=32,n=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},i=Math.max(3,i),n=Math.max(1,n);const a=[],l=[],c=[],h=[];let u=e;const f=(t-e)/n,p=new S,m=new ee;for(let v=0;v<=n;v++){for(let g=0;g<=i;g++){const y=r+g/i*o;p.x=u*Math.cos(y),p.y=u*Math.sin(y),l.push(p.x,p.y,p.z),c.push(0,0,1),m.x=(p.x/t+1)/2,m.y=(p.y/t+1)/2,h.push(m.x,m.y)}u+=f}for(let v=0;v<n;v++){const g=v*(i+1);for(let y=0;y<i;y++){const A=y+g,_=A,b=A+i+1,x=A+i+2,E=A+1;a.push(_,b,E),a.push(b,x,E)}}this.setIndex(a),this.setAttribute("position",new rt(l,3)),this.setAttribute("normal",new rt(c,3)),this.setAttribute("uv",new rt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ob(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class hM extends yt{constructor(e=new Td([new ee(0,.5),new ee(-.5,-.5),new ee(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],r=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(a,l,h),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new rt(n,3)),this.setAttribute("normal",new rt(r,3)),this.setAttribute("uv",new rt(o,2));function c(h){const u=n.length/3,f=h.extractPoints(t);let p=f.shape;const m=f.holes;kl.isClockWise(p)===!1&&(p=p.reverse());for(let g=0,y=m.length;g<y;g++){const A=m[g];kl.isClockWise(A)===!0&&(m[g]=A.reverse())}const v=kl.triangulateShape(p,m);for(let g=0,y=m.length;g<y;g++){const A=m[g];p=p.concat(A)}for(let g=0,y=p.length;g<y;g++){const A=p[g];n.push(A.x,A.y,0),r.push(0,0,1),o.push(A.x,A.y)}for(let g=0,y=v.length;g<y;g++){const A=v[g],_=A[0]+u,b=A[1]+u,x=A[2]+u;i.push(_,b,x),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return lte(t,e)}static fromJSON(e,t){const i=[];for(let n=0,r=e.shapes.length;n<r;n++){const o=t[e.shapes[n]];i.push(o)}return new hM(i,e.curveSegments)}}function lte(s,e){if(e.shapes=[],Array.isArray(s))for(let t=0,i=s.length;t<i;t++){const n=s[t];e.shapes.push(n.uuid)}else e.shapes.push(s.uuid);return e}class cl extends yt{constructor(e=1,t=32,i=16,n=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const h=[],u=new S,f=new S,p=[],m=[],v=[],g=[];for(let y=0;y<=i;y++){const A=[],_=y/i;let b=0;y===0&&o===0?b=.5/t:y===i&&l===Math.PI&&(b=-.5/t);for(let x=0;x<=t;x++){const E=x/t;u.x=-e*Math.cos(n+E*r)*Math.sin(o+_*a),u.y=e*Math.cos(o+_*a),u.z=e*Math.sin(n+E*r)*Math.sin(o+_*a),m.push(u.x,u.y,u.z),f.copy(u).normalize(),v.push(f.x,f.y,f.z),g.push(E+b,1-_),A.push(c++)}h.push(A)}for(let y=0;y<i;y++)for(let A=0;A<t;A++){const _=h[y][A+1],b=h[y][A],x=h[y+1][A],E=h[y+1][A+1];(y!==0||o>0)&&p.push(_,b,E),(y!==i-1||l<Math.PI)&&p.push(b,x,E)}this.setIndex(p),this.setAttribute("position",new rt(m,3)),this.setAttribute("normal",new rt(v,3)),this.setAttribute("uv",new rt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cl(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class uM extends $d{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,n,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new uM(e.radius,e.detail)}}class Gh extends yt{constructor(e=1,t=.4,i=12,n=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],l=[],c=[],h=new S,u=new S,f=new S;for(let p=0;p<=i;p++)for(let m=0;m<=n;m++){const v=m/n*r,g=p/i*Math.PI*2;u.x=(e+t*Math.cos(g))*Math.cos(v),u.y=(e+t*Math.cos(g))*Math.sin(v),u.z=t*Math.sin(g),a.push(u.x,u.y,u.z),h.x=e*Math.cos(v),h.y=e*Math.sin(v),f.subVectors(u,h).normalize(),l.push(f.x,f.y,f.z),c.push(m/n),c.push(p/i)}for(let p=1;p<=i;p++)for(let m=1;m<=n;m++){const v=(n+1)*p+m-1,g=(n+1)*(p-1)+m-1,y=(n+1)*(p-1)+m,A=(n+1)*p+m;o.push(v,g,A),o.push(g,y,A)}this.setIndex(o),this.setAttribute("position",new rt(a,3)),this.setAttribute("normal",new rt(l,3)),this.setAttribute("uv",new rt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Gh(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class dM extends yt{constructor(e=1,t=.4,i=64,n=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:o},i=Math.floor(i),n=Math.floor(n);const a=[],l=[],c=[],h=[],u=new S,f=new S,p=new S,m=new S,v=new S,g=new S,y=new S;for(let _=0;_<=i;++_){const b=_/i*r*Math.PI*2;A(b,r,o,e,p),A(b+.01,r,o,e,m),g.subVectors(m,p),y.addVectors(m,p),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize();for(let x=0;x<=n;++x){const E=x/n*Math.PI*2,M=-t*Math.cos(E),T=t*Math.sin(E);u.x=p.x+(M*y.x+T*v.x),u.y=p.y+(M*y.y+T*v.y),u.z=p.z+(M*y.z+T*v.z),l.push(u.x,u.y,u.z),f.subVectors(u,p).normalize(),c.push(f.x,f.y,f.z),h.push(_/i),h.push(x/n)}}for(let _=1;_<=i;_++)for(let b=1;b<=n;b++){const x=(n+1)*(_-1)+(b-1),E=(n+1)*_+(b-1),M=(n+1)*_+b,T=(n+1)*(_-1)+b;a.push(x,E,T),a.push(E,M,T)}this.setIndex(a),this.setAttribute("position",new rt(l,3)),this.setAttribute("normal",new rt(c,3)),this.setAttribute("uv",new rt(h,2));function A(_,b,x,E,M){const T=Math.cos(_),R=Math.sin(_),w=x/b*_,I=Math.cos(w);M.x=E*(2+I)*.5*T,M.y=E*(2+I)*R*.5,M.z=E*Math.sin(w)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dM(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class fM extends yt{constructor(e=new oL(new S(-1,-1,0),new S(-1,1,0),new S(1,1,0)),t=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new S,l=new S,c=new ee;let h=new S;const u=[],f=[],p=[],m=[];v(),this.setIndex(m),this.setAttribute("position",new rt(u,3)),this.setAttribute("normal",new rt(f,3)),this.setAttribute("uv",new rt(p,2));function v(){for(let _=0;_<t;_++)g(_);g(r===!1?t:0),A(),y()}function g(_){h=e.getPointAt(_/t,h);const b=o.normals[_],x=o.binormals[_];for(let E=0;E<=n;E++){const M=E/n*Math.PI*2,T=Math.sin(M),R=-Math.cos(M);l.x=R*b.x+T*x.x,l.y=R*b.y+T*x.y,l.z=R*b.z+T*x.z,l.normalize(),f.push(l.x,l.y,l.z),a.x=h.x+i*l.x,a.y=h.y+i*l.y,a.z=h.z+i*l.z,u.push(a.x,a.y,a.z)}}function y(){for(let _=1;_<=t;_++)for(let b=1;b<=n;b++){const x=(n+1)*(_-1)+(b-1),E=(n+1)*_+(b-1),M=(n+1)*_+b,T=(n+1)*(_-1)+b;m.push(x,E,T),m.push(E,M,T)}}function A(){for(let _=0;_<=t;_++)for(let b=0;b<=n;b++)c.x=_/t,c.y=b/n,p.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new fM(new N1[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class cL extends yt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,n=new S,r=new S;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,h=l.length;c<h;++c){const u=l[c],f=u.start,p=u.count;for(let m=f,v=f+p;m<v;m+=3)for(let g=0;g<3;g++){const y=a.getX(m+g),A=a.getX(m+(g+1)%3);n.fromBufferAttribute(o,y),r.fromBufferAttribute(o,A),tN(n,r,i)===!0&&(t.push(n.x,n.y,n.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const h=3*a+c,u=3*a+(c+1)%3;n.fromBufferAttribute(o,h),r.fromBufferAttribute(o,u),tN(n,r,i)===!0&&(t.push(n.x,n.y,n.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new rt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function tN(s,e,t){const i=`${s.x},${s.y},${s.z}-${e.x},${e.y},${e.z}`,n=`${e.x},${e.y},${e.z}-${s.x},${s.y},${s.z}`;return t.has(i)===!0||t.has(n)===!0?!1:(t.add(i),t.add(n),!0)}var iN=Object.freeze({__proto__:null,BoxGeometry:Ki,CapsuleGeometry:sM,CircleGeometry:rM,ConeGeometry:oM,CylinderGeometry:Xn,DodecahedronGeometry:aM,EdgesGeometry:lL,ExtrudeGeometry:bv,IcosahedronGeometry:cM,LatheGeometry:Db,OctahedronGeometry:qh,PlaneGeometry:ps,PolyhedronGeometry:$d,RingGeometry:Ob,ShapeGeometry:hM,SphereGeometry:cl,TetrahedronGeometry:uM,TorusGeometry:Gh,TorusKnotGeometry:dM,TubeGeometry:fM,WireframeGeometry:cL});class pM extends Ht{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ae(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class mM extends kt{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}let ws=class extends Ht{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ae(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zd,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new li,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},No=class extends ws{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ee(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return zn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ae(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ae(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ae(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}};class By extends Ht{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ae(16777215),this.specular=new Ae(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zd,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new li,this.combine=xb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class K8 extends Ht{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ae(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zd,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class gM extends Ht{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zd,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class hL extends Ht{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ae(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zd,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new li,this.combine=xb,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class J8 extends Ht{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ae(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zd,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Z8 extends ji{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function xp(s,e,t){return!s||!t&&s.constructor===e?s:typeof e.BYTES_PER_ELEMENT=="number"?new e(s):Array.prototype.slice.call(s)}function $8(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function e6(s){function e(n,r){return s[n]-s[r]}const t=s.length,i=new Array(t);for(let n=0;n!==t;++n)i[n]=n;return i.sort(e),i}function w2(s,e,t){const i=s.length,n=new s.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let l=0;l!==e;++l)n[o++]=s[a+l]}return n}function uL(s,e,t,i){let n=1,r=s[0];for(;r!==void 0&&r[i]===void 0;)r=s[n++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=s[n++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=s[n++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=s[n++];while(r!==void 0)}function cte(s,e,t,i,n=30){const r=s.clone();r.name=e;const o=[];for(let l=0;l<r.tracks.length;++l){const c=r.tracks[l],h=c.getValueSize(),u=[],f=[];for(let p=0;p<c.times.length;++p){const m=c.times[p]*n;if(!(m<t||m>=i)){u.push(c.times[p]);for(let v=0;v<h;++v)f.push(c.values[p*h+v])}}u.length!==0&&(c.times=xp(u,c.times.constructor),c.values=xp(f,c.values.constructor),o.push(c))}r.tracks=o;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r}function hte(s,e=0,t=s,i=30){i<=0&&(i=30);const n=t.tracks.length,r=e/i;for(let o=0;o<n;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=s.tracks.find(function(y){return y.name===a.name&&y.ValueTypeName===l});if(c===void 0)continue;let h=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=u/3);let f=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=p/3);const m=a.times.length-1;let v;if(r<=a.times[0]){const y=h,A=u-h;v=a.values.slice(y,A)}else if(r>=a.times[m]){const y=m*u+h,A=y+u-h;v=a.values.slice(y,A)}else{const y=a.createInterpolant(),A=h,_=u-h;y.evaluate(r),v=y.resultBuffer.slice(A,_)}l==="quaternion"&&new Ce().fromArray(v).normalize().conjugate().toArray(v);const g=c.times.length;for(let y=0;y<g;++y){const A=y*p+f;if(l==="quaternion")Ce.multiplyQuaternionsFlat(c.values,A,v,0,c.values,A);else{const _=p-f*2;for(let b=0;b<_;++b)c.values[A+b]-=v[b]}}}return s.blendMode=NO,s}const ute={convertArray:xp,isTypedArray:$8,getKeyframeOrder:e6,sortedArray:w2,flattenJSON:uL,subclip:cte,makeClipAdditive:hte};let xv=class{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let o;i:{n:if(!(e<n)){for(let a=i+2;;){if(n===void 0){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=n,n=t[++i],e<n)break t}o=t.length;break i}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(n=r,r=t[--i-1],e>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(n=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let o=0;o!==n;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},t6=class extends xv{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ap,endingEnd:Ap}}intervalChanged_(e,t,i){const n=this.parameterPositions;let r=e-2,o=e+1,a=n[r],l=n[o];if(a===void 0)switch(this.getSettings_().endingStart){case _p:r=e,a=2*t-i;break;case S_:r=n.length-2,a=t+n[r]-n[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case _p:o=e,l=2*i-t;break;case S_:o=1,l=i+n[1]-n[0];break;default:o=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,u=this._offsetNext,f=this._weightPrev,p=this._weightNext,m=(i-t)/(n-t),v=m*m,g=v*m,y=-f*g+2*f*v-f*m,A=(1+f)*g+(-1.5-2*f)*v+(-.5+f)*m+1,_=(-1-p)*g+(1.5+p)*v+.5*m,b=p*g-p*v;for(let x=0;x!==a;++x)r[x]=y*o[h+x]+A*o[c+x]+_*o[l+x]+b*o[u+x];return r}},dL=class extends xv{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(i-t)/(n-t),u=1-h;for(let f=0;f!==a;++f)r[f]=o[c+f]*u+o[l+f]*h;return r}},i6=class extends xv{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}},jl=class{constructor(e,t,i,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=xp(t,this.TimeBufferType),this.values=xp(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:xp(e.times,Array),values:xp(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new i6(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new dL(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new t6(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Hd:t=this.InterpolantFactoryMethodDiscrete;break;case Fc:t=this.InterpolantFactoryMethodLinear;break;case WC:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Hd;case this.InterpolantFactoryMethodLinear:return Fc;case this.InterpolantFactoryMethodSmooth:return WC}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,o=n-1;for(;r!==n&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(n!==void 0&&$8(n))for(let a=0,l=n.length;a!==l;++a){const c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),n=this.getInterpolation()===WC,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(n)l=!0;else{const u=a*i,f=u-i,p=u+i;for(let m=0;m!==i;++m){const v=t[u+m];if(v!==t[f+m]||v!==t[p+m]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const u=a*i,f=o*i;for(let p=0;p!==i;++p)t[f+p]=t[u+p]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,n=new i(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}};jl.prototype.TimeBufferType=Float32Array;jl.prototype.ValueBufferType=Float32Array;jl.prototype.DefaultInterpolation=Fc;let dm=class extends jl{};dm.prototype.ValueTypeName="bool";dm.prototype.ValueBufferType=Array;dm.prototype.DefaultInterpolation=Hd;dm.prototype.InterpolantFactoryMethodLinear=void 0;dm.prototype.InterpolantFactoryMethodSmooth=void 0;let yM=class extends jl{};yM.prototype.ValueTypeName="color";let ou=class extends jl{};ou.prototype.ValueTypeName="number";let n6=class extends xv{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(n-t);let c=e*a;for(let h=c+a;c!==h;c+=4)Ce.slerpFlat(r,0,o,c-a,o,c,l);return r}},zl=class extends jl{InterpolantFactoryMethodLinear(e){return new n6(this.times,this.values,this.getValueSize(),e)}};zl.prototype.ValueTypeName="quaternion";zl.prototype.DefaultInterpolation=Fc;zl.prototype.InterpolantFactoryMethodSmooth=void 0;let fm=class extends jl{};fm.prototype.ValueTypeName="string";fm.prototype.ValueBufferType=Array;fm.prototype.DefaultInterpolation=Hd;fm.prototype.InterpolantFactoryMethodLinear=void 0;fm.prototype.InterpolantFactoryMethodSmooth=void 0;let Uc=class extends jl{};Uc.prototype.ValueTypeName="vector";let go=class{constructor(e,t=-1,i,n=XE){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=pa(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(fte(i[o]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(jl.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=e6(l);l=w2(l,1,h),c=w2(c,1,h),!n&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new ou(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const n=e;i=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const u=h[1];let f=n[u];f||(n[u]=f=[]),f.push(c)}}const o=[];for(const a in n)o.push(this.CreateFromMorphTargetSequence(a,n[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(u,f,p,m,v){if(p.length!==0){const g=[],y=[];uL(p,g,y,m),g.length!==0&&v.push(new u(f,g,y))}},n=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let u=0;u<c.length;u++){const f=c[u].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let m;for(m=0;m<f.length;m++)if(f[m].morphTargets)for(let v=0;v<f[m].morphTargets.length;v++)p[f[m].morphTargets[v]]=-1;for(const v in p){const g=[],y=[];for(let A=0;A!==f[m].morphTargets.length;++A){const _=f[m];g.push(_.time),y.push(_.morphTarget===v?1:0)}n.push(new ou(".morphTargetInfluence["+v+"]",g,y))}l=p.length*o}else{const p=".bones["+t[u].name+"]";i(Uc,p+".position",f,"pos",n),i(zl,p+".quaternion",f,"rot",n),i(Uc,p+".scale",f,"scl",n)}}return n.length===0?null:new this(r,l,n,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,n=e.length;i!==n;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function dte(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ou;case"vector":case"vector2":case"vector3":case"vector4":return Uc;case"color":return yM;case"quaternion":return zl;case"bool":case"boolean":return dm;case"string":return fm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function fte(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=dte(s.type);if(s.times===void 0){const t=[],i=[];uL(s.keys,t,i,"value"),s.times=t,s.values=i}return e.parse!==void 0?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const Xh={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(this.files[s]=e)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};let vM=class{constructor(e,t,i){const n=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,r===!1&&n.onStart!==void 0&&n.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,n.onProgress!==void 0&&n.onProgress(h,o,a),o===a&&(r=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,f=c.length;u<f;u+=2){const p=c[u],m=c[u+1];if(p.global&&(p.lastIndex=0),p.test(h))return m}return null}}};const s6=new vM;let ds=class{constructor(e){this.manager=e!==void 0?e:s6,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(n,r){i.load(e,n,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};ds.DEFAULT_MATERIAL_NAME="__DEFAULT";const ch={};let pte=class extends Error{constructor(e,t){super(e),this.response=t}},yr=class extends ds{constructor(e){super(e)}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Xh.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(ch[e]!==void 0){ch[e].push({onLoad:t,onProgress:i,onError:n});return}ch[e]=[],ch[e].push({onLoad:t,onProgress:i,onError:n});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=ch[e],u=c.body.getReader(),f=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),p=f?parseInt(f):0,m=p!==0;let v=0;const g=new ReadableStream({start(y){A();function A(){u.read().then(({done:_,value:b})=>{if(_)y.close();else{v+=b.byteLength;const x=new ProgressEvent("progress",{lengthComputable:m,loaded:v,total:p});for(let E=0,M=h.length;E<M;E++){const T=h[E];T.onProgress&&T.onProgress(x)}y.enqueue(b),A()}})}}});return new Response(g)}else throw new pte(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),f=u&&u[1]?u[1].toLowerCase():void 0,p=new TextDecoder(f);return c.arrayBuffer().then(m=>p.decode(m))}}}).then(c=>{Xh.add(e,c);const h=ch[e];delete ch[e];for(let u=0,f=h.length;u<f;u++){const p=h[u];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=ch[e];if(h===void 0)throw this.manager.itemError(e),c;delete ch[e];for(let u=0,f=h.length;u<f;u++){const p=h[u];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};class mte extends ds{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new yr(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}parse(e){const t=[];for(let i=0;i<e.length;i++){const n=go.parse(e[i]);t.push(n)}return t}}class gte extends ds{constructor(e){super(e)}load(e,t,i,n){const r=this,o=[],a=new Md,l=new yr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let c=0;function h(u){l.load(e[u],function(f){const p=r.parse(f,!0);o[u]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(a.minFilter=Nt),a.image=o,a.format=p.format,a.needsUpdate=!0,t&&t(a))},i,n)}if(Array.isArray(e))for(let u=0,f=e.length;u<f;++u)h(u);else l.load(e,function(u){const f=r.parse(u,!0);if(f.isCubemap){const p=f.mipmaps.length/f.mipmapCount;for(let m=0;m<p;m++){o[m]={mipmaps:[]};for(let v=0;v<f.mipmapCount;v++)o[m].mipmaps.push(f.mipmaps[m*f.mipmapCount+v]),o[m].format=f.format,o[m].width=f.width,o[m].height=f.height}a.image=o}else a.image.width=f.width,a.image.height=f.height,a.mipmaps=f.mipmaps;f.mipmapCount===1&&(a.minFilter=Nt),a.format=f.format,a.needsUpdate=!0,t&&t(a)},i,n);return a}}let L_=class extends ds{constructor(e){super(e)}load(e,t,i,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Xh.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=R_("img");function l(){h(),Xh.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(u){h(),n&&n(u),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}};class yte extends ds{constructor(e){super(e)}load(e,t,i,n){const r=new Ib;r.colorSpace=bt;const o=new L_(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(h){r.images[c]=h,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,n)}for(let c=0;c<e.length;++c)l(c);return r}}class fL extends ds{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new Qr,a=new yr(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(l){let c;try{c=r.parse(l)}catch(h){if(n!==void 0)n(h);else{console.error(h);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:as,o.wrapT=c.wrapT!==void 0?c.wrapT:as,o.magFilter=c.magFilter!==void 0?c.magFilter:Nt,o.minFilter=c.minFilter!==void 0?c.minFilter:Nt,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(o.colorSpace=c.colorSpace),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=Do),c.mipmapCount===1&&(o.minFilter=Nt),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},i,n),o}}let Bc=class extends ds{constructor(e){super(e)}load(e,t,i,n){const r=new Wt,o=new L_(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,n),r}},ef=class extends ye{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ae(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};class pL extends ef{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ye.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ae(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const FI=new le,nN=new S,sN=new S;let mL=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ee(512,512),this.map=null,this.mapPass=null,this.matrix=new le,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new $p,this._frameExtents=new ee(1,1),this._viewportCount=1,this._viewports=[new Je(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;nN.setFromMatrixPosition(e.matrixWorld),t.position.copy(nN),sN.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(sN),t.updateMatrixWorld(),FI.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(FI),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(FI)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},vte=class extends mL{constructor(){super(new Vt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=Jy*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},Lb=class extends ef{constructor(e,t,i=0,n=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ye.DEFAULT_UP),this.updateMatrix(),this.target=new ye,this.distance=i,this.angle=n,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new vte}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};const rN=new le,_0=new S,UI=new S;let Ate=class extends mL{constructor(){super(new Vt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ee(4,2),this._viewportCount=6,this._viewports=[new Je(2,1,1,1),new Je(0,1,1,1),new Je(3,1,1,1),new Je(1,1,1,1),new Je(3,0,1,1),new Je(1,0,1,1)],this._cubeDirections=[new S(1,0,0),new S(-1,0,0),new S(0,0,1),new S(0,0,-1),new S(0,1,0),new S(0,-1,0)],this._cubeUps=[new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,0,1),new S(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),_0.setFromMatrixPosition(e.matrixWorld),i.position.copy(_0),UI.copy(i.position),UI.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(UI),i.updateMatrixWorld(),n.makeTranslation(-_0.x,-_0.y,-_0.z),rN.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(rN)}},im=class extends ef{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Ate}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},_te=class extends mL{constructor(){super(new Qc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},nm=class extends ef{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ye.DEFAULT_UP),this.updateMatrix(),this.target=new ye,this.shadow=new _te}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};class AM extends ef{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class r6 extends ef{constructor(e,t,i=10,n=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class o6{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new S)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*n),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*n)),t.addScaledVector(o[5],1.092548*(n*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(i*r)),t.addScaledVector(o[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*n),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*n),t.addScaledVector(o[5],2*.429043*n*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*i*r),t.addScaledVector(o[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+n*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+n*3);return e}static getBasisAt(e,t){const i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}class a6 extends ef{constructor(e=new o6,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class _M extends ds{constructor(e){super(e),this.textures={}}load(e,t,i,n){const r=this,o=new yr(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}parse(e){const t=this.textures;function i(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const n=_M.createMaterialFromType(e.type);if(e.uuid!==void 0&&(n.uuid=e.uuid),e.name!==void 0&&(n.name=e.name),e.color!==void 0&&n.color!==void 0&&n.color.setHex(e.color),e.roughness!==void 0&&(n.roughness=e.roughness),e.metalness!==void 0&&(n.metalness=e.metalness),e.sheen!==void 0&&(n.sheen=e.sheen),e.sheenColor!==void 0&&(n.sheenColor=new Ae().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(n.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(e.emissive),e.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(e.specular),e.specularIntensity!==void 0&&(n.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(n.shininess=e.shininess),e.clearcoat!==void 0&&(n.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(n.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(n.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(n.transmission=e.transmission),e.thickness!==void 0&&(n.thickness=e.thickness),e.attenuationDistance!==void 0&&(n.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(n.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(n.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.combine!==void 0&&(n.combine=e.combine),e.side!==void 0&&(n.side=e.side),e.shadowSide!==void 0&&(n.shadowSide=e.shadowSide),e.opacity!==void 0&&(n.opacity=e.opacity),e.transparent!==void 0&&(n.transparent=e.transparent),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(n.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(n.depthFunc=e.depthFunc),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(n.blendSrc=e.blendSrc),e.blendDst!==void 0&&(n.blendDst=e.blendDst),e.blendEquation!==void 0&&(n.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(n.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(n.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(n.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&n.blendColor!==void 0&&n.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(n.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(n.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(n.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(n.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(n.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(n.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(n.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(n.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(n.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.linewidth!==void 0&&(n.linewidth=e.linewidth),e.dashSize!==void 0&&(n.dashSize=e.dashSize),e.gapSize!==void 0&&(n.gapSize=e.gapSize),e.scale!==void 0&&(n.scale=e.scale),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(n.dithering=e.dithering),e.alphaToCoverage!==void 0&&(n.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(n.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(n.visible=e.visible),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.userData!==void 0&&(n.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(n.uniforms[r]={},o.type){case"t":n.uniforms[r].value=i(o.value);break;case"c":n.uniforms[r].value=new Ae().setHex(o.value);break;case"v2":n.uniforms[r].value=new ee().fromArray(o.value);break;case"v3":n.uniforms[r].value=new S().fromArray(o.value);break;case"v4":n.uniforms[r].value=new Je().fromArray(o.value);break;case"m3":n.uniforms[r].value=new Ut().fromArray(o.value);break;case"m4":n.uniforms[r].value=new le().fromArray(o.value);break;default:n.uniforms[r].value=o.value}}if(e.defines!==void 0&&(n.defines=e.defines),e.vertexShader!==void 0&&(n.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(n.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(n.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)n.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(n.lights=e.lights),e.clipping!==void 0&&(n.clipping=e.clipping),e.size!==void 0&&(n.size=e.size),e.sizeAttenuation!==void 0&&(n.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(n.map=i(e.map)),e.matcap!==void 0&&(n.matcap=i(e.matcap)),e.alphaMap!==void 0&&(n.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(n.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(n.bumpScale=e.bumpScale),e.normalMap!==void 0&&(n.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(n.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),n.normalScale=new ee().fromArray(r)}return e.displacementMap!==void 0&&(n.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(n.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(n.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(n.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(n.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(n.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(n.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(n.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(n.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(n.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(n.envMap=i(e.envMap)),e.envMapRotation!==void 0&&n.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(n.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(n.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(n.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(n.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(n.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(n.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(n.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(n.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(n.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new ee().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(n.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(n.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(n.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(n.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(n.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=i(e.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:pM,SpriteMaterial:iM,RawShaderMaterial:mM,ShaderMaterial:kt,PointsMaterial:md,MeshPhysicalMaterial:No,MeshStandardMaterial:ws,MeshPhongMaterial:By,MeshToonMaterial:K8,MeshNormalMaterial:gM,MeshLambertMaterial:hL,MeshDepthMaterial:Rb,MeshDistanceMaterial:YO,MeshBasicMaterial:ti,MeshMatcapMaterial:J8,LineDashedMaterial:Z8,LineBasicMaterial:ji,Material:Ht};return new t[e]}}let Jh=class{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}};class bM extends yt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class l6 extends ds{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new yr(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}parse(e){const t={},i={};function n(p,m){if(t[m]!==void 0)return t[m];const g=p.interleavedBuffers[m],y=r(p,g.buffer),A=dy(g.type,y),_=new Pb(A,g.stride);return _.uuid=g.uuid,t[m]=_,_}function r(p,m){if(i[m]!==void 0)return i[m];const g=p.arrayBuffers[m],y=new Uint32Array(g).buffer;return i[m]=y,y}const o=e.isInstancedBufferGeometry?new bM:new yt,a=e.data.index;if(a!==void 0){const p=dy(a.type,a.array);o.setIndex(new Ke(p,1))}const l=e.data.attributes;for(const p in l){const m=l[p];let v;if(m.isInterleavedBufferAttribute){const g=n(e.data,m.data);v=new aa(g,m.itemSize,m.offset,m.normalized)}else{const g=dy(m.type,m.array),y=m.isInstancedBufferAttribute?Po:Ke;v=new y(g,m.itemSize,m.normalized)}m.name!==void 0&&(v.name=m.name),m.usage!==void 0&&v.setUsage(m.usage),o.setAttribute(p,v)}const c=e.data.morphAttributes;if(c)for(const p in c){const m=c[p],v=[];for(let g=0,y=m.length;g<y;g++){const A=m[g];let _;if(A.isInterleavedBufferAttribute){const b=n(e.data,A.data);_=new aa(b,A.itemSize,A.offset,A.normalized)}else{const b=dy(A.type,A.array);_=new Ke(b,A.itemSize,A.normalized)}A.name!==void 0&&(_.name=A.name),v.push(_)}o.morphAttributes[p]=v}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let p=0,m=u.length;p!==m;++p){const v=u[p];o.addGroup(v.start,v.count,v.materialIndex)}const f=e.data.boundingSphere;if(f!==void 0){const p=new S;f.center!==void 0&&p.fromArray(f.center),o.boundingSphere=new ln(p,f.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class bte extends ds{constructor(e){super(e)}load(e,t,i,n){const r=this,o=this.path===""?Jh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new yr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(u){n!==void 0&&n(u),console.error("THREE:ObjectLoader: Can't parse "+e+".",u.message);return}const h=c.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(c,t)},i,n)}async loadAsync(e,t){const i=this,n=this.path===""?Jh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new yr(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,r,l,a,i),h=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,h),t!==void 0){let u=!1;for(const f in o)if(o[f].data instanceof HTMLImageElement){u=!0;break}u===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,n,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,n=e.length;i<n;i++){const r=new Td().fromJSON(e[i]);t[r.uuid]=r}return t}parseSkeletons(e,t){const i={},n={};if(t.traverse(function(r){r.isBone&&(n[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=new Bb().fromJSON(e[r],n);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(e!==void 0){const n=new l6;for(let r=0,o=e.length;r<o;r++){let a;const l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(l);break;default:l.type in iN?a=iN[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,t){const i={},n={};if(e!==void 0){const r=new _M;r.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];i[l.uuid]===void 0&&(i[l.uuid]=r.parse(l)),n[l.uuid]=i[l.uuid]}}return n}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const n=e[i],r=go.parse(n);t[r.uuid]=r}return t}parseImages(e,t){const i=this,n={};let r;function o(l){return i.manager.itemStart(l),r.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return o(h)}else return l.data?{data:dy(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new vM(t);r=new L_(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,h=e.length;c<h;c++){const u=e[c],f=u.url;if(Array.isArray(f)){const p=[];for(let m=0,v=f.length;m<v;m++){const g=f[m],y=a(g);y!==null&&(y instanceof HTMLImageElement?p.push(y):p.push(new Qr(y.data,y.width,y.height)))}n[u.uuid]=new jh(p)}else{const p=a(u.url);n[u.uuid]=new jh(p)}}}return n}async parseImagesAsync(e){const t=this,i={};let n;async function r(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await n.loadAsync(l)}else return o.data?{data:dy(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){n=new L_(this.manager),n.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const h=[];for(let u=0,f=c.length;u<f;u++){const p=c[u],m=await r(p);m!==null&&(m instanceof HTMLImageElement?h.push(m):h.push(new Qr(m.data,m.width,m.height)))}i[l.uuid]=new jh(h)}else{const h=await r(l.url);i[l.uuid]=new jh(h)}}}return i}parseTextures(e,t){function i(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const n={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=e[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let h;Array.isArray(c)?(h=new Ib,c.length===6&&(h.needsUpdate=!0)):(c&&c.data?h=new Qr:h=new Wt,c&&(h.needsUpdate=!0)),h.source=l,h.uuid=a.uuid,a.name!==void 0&&(h.name=a.name),a.mapping!==void 0&&(h.mapping=i(a.mapping,xte)),a.channel!==void 0&&(h.channel=a.channel),a.offset!==void 0&&h.offset.fromArray(a.offset),a.repeat!==void 0&&h.repeat.fromArray(a.repeat),a.center!==void 0&&h.center.fromArray(a.center),a.rotation!==void 0&&(h.rotation=a.rotation),a.wrap!==void 0&&(h.wrapS=i(a.wrap[0],oN),h.wrapT=i(a.wrap[1],oN)),a.format!==void 0&&(h.format=a.format),a.internalFormat!==void 0&&(h.internalFormat=a.internalFormat),a.type!==void 0&&(h.type=a.type),a.colorSpace!==void 0&&(h.colorSpace=a.colorSpace),a.minFilter!==void 0&&(h.minFilter=i(a.minFilter,aN)),a.magFilter!==void 0&&(h.magFilter=i(a.magFilter,aN)),a.anisotropy!==void 0&&(h.anisotropy=a.anisotropy),a.flipY!==void 0&&(h.flipY=a.flipY),a.generateMipmaps!==void 0&&(h.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(h.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(h.compareFunction=a.compareFunction),a.userData!==void 0&&(h.userData=a.userData),n[a.uuid]=h}return n}parseObject(e,t,i,n,r){let o;function a(f){return t[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",f),t[f]}function l(f){if(f!==void 0){if(Array.isArray(f)){const p=[];for(let m=0,v=f.length;m<v;m++){const g=f[m];i[g]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",g),p.push(i[g])}return p}return i[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),i[f]}}function c(f){return n[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",f),n[f]}let h,u;switch(e.type){case"Scene":o=new Ws,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new Ae(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new tM(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new eM(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&o.backgroundRotation.fromArray(e.backgroundRotation),e.environmentRotation!==void 0&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new Vt(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Qc(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new AM(e.color,e.intensity);break;case"DirectionalLight":o=new nm(e.color,e.intensity);break;case"PointLight":o=new im(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new r6(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Lb(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new pL(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new a6().fromJSON(e);break;case"SkinnedMesh":h=a(e.geometry),u=l(e.material),o=new Fo(h,u),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":h=a(e.geometry),u=l(e.material),o=new fe(h,u);break;case"InstancedMesh":h=a(e.geometry),u=l(e.material);const f=e.count,p=e.instanceMatrix,m=e.instanceColor;o=new $O(h,u,f),o.instanceMatrix=new Po(new Float32Array(p.array),16),m!==void 0&&(o.instanceColor=new Po(new Float32Array(m.array),m.itemSize));break;case"BatchedMesh":h=a(e.geometry),u=l(e.material),o=new U1(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,u),o.geometry=h,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(v=>{const g=new jt;g.min.fromArray(v.boxMin),g.max.fromArray(v.boxMax);const y=new ln;return y.radius=v.sphereRadius,y.center.fromArray(v.sphereCenter),{boxInitialized:v.boxInitialized,box:g,sphereInitialized:v.sphereInitialized,sphere:y}}),o._maxGeometryCount=e.maxGeometryCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=c(e.matricesTexture.uuid);break;case"LOD":o=new ZO;break;case"Line":o=new An(a(e.geometry),l(e.material));break;case"LineLoop":o=new eL(a(e.geometry),l(e.material));break;case"LineSegments":o=new jr(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new Py(a(e.geometry),l(e.material));break;case"Sprite":o=new JO(l(e.material));break;case"Group":o=new Vs;break;case"Bone":o=new em;break;default:o=new ye}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let p=0;p<f.length;p++)o.add(this.parseObject(f[p],t,i,n,r))}if(e.animations!==void 0){const f=e.animations;for(let p=0;p<f.length;p++){const m=f[p];o.animations.push(r[m])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const f=e.levels;for(let p=0;p<f.length;p++){const m=f[p],v=o.getObjectByProperty("uuid",m.object);v!==void 0&&o.addLevel(v,m.distance,m.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const n=t[i.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(n,i.bindMatrix)}})}}const xte={UVMapping:QE,CubeReflectionMapping:ru,CubeRefractionMapping:zd,EquirectangularReflectionMapping:mo,EquirectangularRefractionMapping:Xy,CubeUVReflectionMapping:yv},oN={RepeatWrapping:Uo,ClampToEdgeWrapping:as,MirroredRepeatWrapping:Zp},aN={NearestFilter:Ot,NearestMipmapNearestFilter:Yy,NearestMipmapLinearFilter:Nh,LinearFilter:Nt,LinearMipmapNearestFilter:Rp,LinearMipmapLinearFilter:Do};let c6=class extends ds{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Xh.get(e);if(o!==void 0){if(r.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),r.manager.itemEnd(e)}).catch(c=>{n&&n(c)});return}return setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return Xh.add(e,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){n&&n(c),Xh.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});Xh.add(e,l),r.manager.itemStart(e)}},Tw;class xM{static getContext(){return Tw===void 0&&(Tw=new(window.AudioContext||window.webkitAudioContext)),Tw}static setContext(e){Tw=e}}class z1 extends ds{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new yr(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);xM.getContext().decodeAudioData(c,function(u){t(u)}).catch(a)}catch(c){a(c)}},i,n);function a(l){n?n(l):console.error(l),r.manager.itemError(e)}}}const lN=new le,cN=new le,Df=new le;class wte{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Vt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Vt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Df.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,o=t.near*Math.tan(Bp*t.fov*.5)/t.zoom;let a,l;cN.elements[12]=-n,lN.elements[12]=n,a=-o*t.aspect+r,l=o*t.aspect+r,Df.elements[0]=2*t.near/(l-a),Df.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Df),a=-o*t.aspect-r,l=o*t.aspect-r,Df.elements[0]=2*t.near/(l-a),Df.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Df)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(cN),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(lN)}}let gL=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=hN(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=hN();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function hN(){return(typeof performance>"u"?Date:performance).now()}const Zl=new S,uN=new Ce,Ste=new S,Of=new S;let h6=class extends ye{constructor(){super(),this.type="AudioListener",this.context=xM.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new gL}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Zl,uN,Ste),!(!Number.isFinite(Zl.x)||!Number.isFinite(Zl.y)||!Number.isFinite(Zl.z)))if(Of.set(0,0,-1).applyQuaternion(uN),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Zl.x,n),t.positionY.linearRampToValueAtTime(Zl.y,n),t.positionZ.linearRampToValueAtTime(Zl.z,n),t.forwardX.linearRampToValueAtTime(Of.x,n),t.forwardY.linearRampToValueAtTime(Of.y,n),t.forwardZ.linearRampToValueAtTime(Of.z,n),t.upX.linearRampToValueAtTime(i.x,n),t.upY.linearRampToValueAtTime(i.y,n),t.upZ.linearRampToValueAtTime(i.z,n)}else t.setPosition(Zl.x,Zl.y,Zl.z),t.setOrientation(Of.x,Of.y,Of.z,i.x,i.y,i.z)}},yL=class extends ye{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||(this.buffer?this.buffer.duration:Number.MAX_VALUE))),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};const Lf=new S,dN=new Ce,Cte=new S,kf=new S;class u6 extends yL{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Lf,dN,Cte),kf.set(0,0,1).applyQuaternion(dN);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Lf.x,i),t.positionY.linearRampToValueAtTime(Lf.y,i),t.positionZ.linearRampToValueAtTime(Lf.z,i),t.orientationX.linearRampToValueAtTime(kf.x,i),t.orientationY.linearRampToValueAtTime(kf.y,i),t.orientationZ.linearRampToValueAtTime(kf.z,i)}else t.setPosition(Lf.x,Lf.y,Lf.z),t.setOrientation(kf.x,kf.y,kf.z)}}class Ete{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class d6{constructor(e,t,i){this.binding=e,this.valueSize=i;let n,r,o;switch(t){case"quaternion":n=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:n=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,r=e*n+n;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==n;++a)i[r+a]=i[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(i,r,0,a,n)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=t*this._origIndex;this._mixBufferRegion(i,n,l,1-r,t)}o>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){a.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let r=i,o=n;r!==o;++r)t[r]=t[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let o=0;o!==r;++o)e[t+o]=e[i+o]}_slerp(e,t,i,n){Ce.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){const o=this._workIndex*r;Ce.multiplyQuaternionsFlat(e,o,e,t,e,i),Ce.slerpFlat(e,t,e,t,e,o,n)}_lerp(e,t,i,n,r){const o=1-n;for(let a=0;a!==r;++a){const l=t+a;e[l]=e[l]*o+e[i+a]*n}}_lerpAdditive(e,t,i,n,r){for(let o=0;o!==r;++o){const a=t+o;e[a]=e[a]+e[i+o]*n}}}const vL="\\[\\]\\.:\\/",Mte=new RegExp("["+vL+"]","g"),AL="[^"+vL+"]",Tte="[^"+vL.replace("\\.","")+"]",Ite=/((?:WC+[\/:])*)/.source.replace("WC",AL),Rte=/(WCOD+)?/.source.replace("WCOD",Tte),Pte=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",AL),Bte=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",AL),Dte=new RegExp("^"+Ite+Rte+Pte+Bte+"$"),Ote=["material","materials","bones","map"];let Lte=class{constructor(e,t,i){const n=i||Zt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Zt=class Zg{constructor(e,t,i){this.path=t,this.parsedPath=i||Zg.parseTrackName(t),this.node=Zg.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Zg.Composite(e,t,i):new Zg(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Mte,"")}static parseTrackName(e){const t=Dte.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const r=i.nodeName.substring(n+1);Ote.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r,o){for(let a=0;a<r.length;a++){const l=r[a];if(!o&&(l.name===t||l.uuid===t))return l;if(o&&l.userData&&l.userData.name===t)return l;const c=i(l.children,o);if(c)return c}return null},n=i(e.children);if(n)return n;{const r=i(e.children,!0);if(r)return r}}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=Zg.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[n];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Zt.Composite=Lte;Zt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Zt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Zt.prototype.GetterByBindingType=[Zt.prototype._getValue_direct,Zt.prototype._getValue_array,Zt.prototype._getValue_arrayElement,Zt.prototype._getValue_toArray];Zt.prototype.SetterByBindingTypeAndVersioning=[[Zt.prototype._setValue_direct,Zt.prototype._setValue_direct_setNeedsUpdate,Zt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Zt.prototype._setValue_array,Zt.prototype._setValue_array_setNeedsUpdate,Zt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Zt.prototype._setValue_arrayElement,Zt.prototype._setValue_arrayElement_setNeedsUpdate,Zt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Zt.prototype._setValue_fromArray,Zt.prototype._setValue_fromArray_setNeedsUpdate,Zt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class kte{constructor(){this.isAnimationObjectGroup=!0,this.uuid=pa(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,o=r.length;let a,l=e.length,c=this.nCachedObjects_;for(let h=0,u=arguments.length;h!==u;++h){const f=arguments[h],p=f.uuid;let m=t[p];if(m===void 0){m=l++,t[p]=m,e.push(f);for(let v=0,g=o;v!==g;++v)r[v].push(new Zt(f,i[v],n[v]))}else if(m<c){a=e[m];const v=--c,g=e[v];t[g.uuid]=m,e[m]=g,t[p]=v,e[v]=f;for(let y=0,A=o;y!==A;++y){const _=r[y],b=_[v];let x=_[m];_[m]=b,x===void 0&&(x=new Zt(f,i[y],n[y])),_[v]=x}}else e[m]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,h=t[c];if(h!==void 0&&h>=r){const u=r++,f=e[u];t[f.uuid]=h,e[h]=f,t[c]=u,e[u]=l;for(let p=0,m=n;p!==m;++p){const v=i[p],g=v[u],y=v[h];v[h]=g,v[u]=y}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],h=c.uuid,u=t[h];if(u!==void 0)if(delete t[h],u<r){const f=--r,p=e[f],m=--o,v=e[m];t[p.uuid]=u,e[u]=p,t[v.uuid]=f,e[f]=v,e.pop();for(let g=0,y=n;g!==y;++g){const A=i[g],_=A[f],b=A[m];A[u]=_,A[f]=b,A.pop()}}else{const f=--o,p=e[f];f>0&&(t[p.uuid]=u),e[u]=p,e.pop();for(let m=0,v=n;m!==v;++m){const g=i[m];g[u]=g[f],g.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const i=this._bindingsIndicesByPath;let n=i[e];const r=this._bindings;if(n!==void 0)return r[n];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,h=this.nCachedObjects_,u=new Array(c);n=r.length,i[e]=n,o.push(e),a.push(t),r.push(u);for(let f=h,p=l.length;f!==p;++f){const m=l[f];u[f]=new Zt(m,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const n=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=i,o[i]=l,o.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}}class f6{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const r=t.tracks,o=r.length,a=new Array(o),l={endingStart:Ap,endingEnd:Ap};for(let c=0;c!==o;++c){const h=r[c].createInterpolant(null);a[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=UO,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const n=this._clip.duration,r=e._clip.duration,o=r/n,a=n/r;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,r=n.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+i,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case NO:for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(o),c[h].accumulateAdditive(a);break;case XE:default:for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(o),c[h].accumulate(n,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,r=this._loopCount;const o=i===q5;if(e===0)return r===-1?n:o&&(r&1)===1?t-n:n;if(i===w_){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),n>=t||n<0){const a=Math.floor(n/t);n-=t*a,r+=Math.abs(a);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=n;if(o&&(r&1)===1)return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=_p,n.endingEnd=_p):(e?n.endingStart=this.zeroSlopeAtStart?_p:Ap:n.endingStart=S_,t?n.endingEnd=this.zeroSlopeAtEnd?_p:Ap:n.endingEnd=S_)}_scheduleFading(e,t,i){const n=this._mixer,r=n.time;let o=this._weightInterpolant;o===null&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=i,this}}const Fte=new Float32Array(1);class wM extends js{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let u=0;u!==r;++u){const f=n[u],p=f.name;let m=h[p];if(m!==void 0)++m.referenceCount,o[u]=m;else{if(m=o[u],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,l,p));continue}const v=t&&t._propertyBindings[u].binding.parsedPath;m=new d6(Zt.create(i,p,v),f.ValueTypeName,f.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,l,p),o[u]=m}a[u].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,i)}const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const r=t[i];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const r=t[i];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,a=o[r],l=a.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null;const u=a.actionByRoot,f=(e._localRoot||this._root).uuid;delete u[f],l.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const r=t[i];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,r=this._bindings;let o=n[t];o===void 0&&(o={},n[t]=o),o[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[n],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[r],Object.keys(a).length===0&&delete o[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new dL(new Float32Array(2),new Float32Array(2),1,Fte),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const n=t||this._root,r=n.uuid;let o=typeof e=="string"?go.findByName(n,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(i===void 0&&(o!==null?i=o.blendMode:i=XE),l!==void 0){const u=l.actionByRoot[r];if(u!==void 0&&u.blendMode===i)return u;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const h=new f6(this,o,t,i);return this._bindAction(h,c),this._addInactiveAction(h,a,r),h}existingAction(e,t){const i=t||this._root,n=i.uuid,r=typeof e=="string"?go.findByName(i,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[n]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(n,e,r,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(r!==void 0){const o=r.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const h=c._cacheIndex,u=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,u._cacheIndex=h,t[h]=u,t.pop(),this._removeInactiveBindingsForAction(c)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,r=n[t];if(r!==void 0)for(const o in r){const a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Se{constructor(e){this.value=e}clone(){return new Se(this.value.clone===void 0?this.value:this.value.clone())}}let Ute=0;class Nte extends js{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Ute++}),this.name="",this.usage=T_,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,n=t.length;i<n;i++){const r=Array.isArray(t[i])?t[i]:[t[i]];for(let o=0;o<r.length;o++)this.uniforms.push(r[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class G1 extends Pb{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class zte{constructor(e,t,i,n,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const fN=new le;let tf=class{constructor(e,t,i=0,n=1/0){this.ray=new _o(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new Vr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return fN.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(fN),this}intersectObject(e,t=!0,i=[]){return S2(e,this,i,t),i.sort(pN),i}intersectObjects(e,t=!0,i=[]){for(let n=0,r=e.length;n<r;n++)S2(e[n],this,i,t);return i.sort(pN),i}};function pN(s,e){return s.distance-e.distance}function S2(s,e,t,i){if(s.layers.test(e.layers)&&s.raycast(e,t),i===!0){const n=s.children;for(let r=0,o=n.length;r<o;r++)S2(n[r],e,t,!0)}}class C2{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(zn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Gte{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}const mN=new ee;class Hte{constructor(e=new ee(1/0,1/0),t=new ee(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=mN.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,mN).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const gN=new S,Iw=new S;class ma{constructor(e=new S,t=new S){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){gN.subVectors(e,this.start),Iw.subVectors(this.end,this.start);const i=Iw.dot(Iw);let r=Iw.dot(gN)/i;return t&&(r=zn(r,0,1)),r}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const yN=new S;class Vte extends ye{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new yt,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,h=a/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}i.setAttribute("position",new rt(n,3));const r=new ji({fog:!1,toneMapped:!1});this.cone=new jr(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),yN.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(yN),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Bu=new S,Rw=new le,NI=new le;class Qte extends jr{constructor(e){const t=p6(e),i=new yt,n=[],r=[],o=new Ae(0,0,1),a=new Ae(0,1,0);for(let c=0;c<t.length;c++){const h=t[c];h.parent&&h.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new rt(n,3)),i.setAttribute("color",new rt(r,3));const l=new ji({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");NI.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const a=t[r];a.parent&&a.parent.isBone&&(Rw.multiplyMatrices(NI,a.matrixWorld),Bu.setFromMatrixPosition(Rw),n.setXYZ(o,Bu.x,Bu.y,Bu.z),Rw.multiplyMatrices(NI,a.parent.matrixWorld),Bu.setFromMatrixPosition(Rw),n.setXYZ(o+1,Bu.x,Bu.y,Bu.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function p6(s){const e=[];s.isBone===!0&&e.push(s);for(let t=0;t<s.children.length;t++)e.push.apply(e,p6(s.children[t]));return e}class Wte extends fe{constructor(e,t,i){const n=new cl(t,4,2),r=new ti({wireframe:!0,fog:!1,toneMapped:!1});super(n,r),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const jte=new S,vN=new Ae,AN=new Ae;class qte extends ye{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const n=new qh(t);n.rotateY(Math.PI*.5),this.material=new ti({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),o=new Float32Array(r.count*3);n.setAttribute("color",new Ke(o,3)),this.add(new fe(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");vN.copy(this.light.color),AN.copy(this.light.groundColor);for(let i=0,n=t.count;i<n;i++){const r=i<n/2?vN:AN;t.setXYZ(i,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(jte.setFromMatrixPosition(this.light.matrixWorld).negate())}}let SM=class extends jr{constructor(e=10,t=10,i=4473924,n=8947848){i=new Ae(i),n=new Ae(n);const r=t/2,o=e/t,a=e/2,l=[],c=[];for(let f=0,p=0,m=-a;f<=t;f++,m+=o){l.push(-a,0,m,a,0,m),l.push(m,0,-a,m,0,a);const v=f===r?i:n;v.toArray(c,p),p+=3,v.toArray(c,p),p+=3,v.toArray(c,p),p+=3,v.toArray(c,p),p+=3}const h=new yt;h.setAttribute("position",new rt(l,3)),h.setAttribute("color",new rt(c,3));const u=new ji({vertexColors:!0,toneMapped:!1});super(h,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}};class Xte extends jr{constructor(e=10,t=16,i=8,n=64,r=4473924,o=8947848){r=new Ae(r),o=new Ae(o);const a=[],l=[];if(t>1)for(let u=0;u<t;u++){const f=u/t*(Math.PI*2),p=Math.sin(f)*e,m=Math.cos(f)*e;a.push(0,0,0),a.push(p,0,m);const v=u&1?r:o;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(let u=0;u<i;u++){const f=u&1?r:o,p=e-e/i*u;for(let m=0;m<n;m++){let v=m/n*(Math.PI*2),g=Math.sin(v)*p,y=Math.cos(v)*p;a.push(g,0,y),l.push(f.r,f.g,f.b),v=(m+1)/n*(Math.PI*2),g=Math.sin(v)*p,y=Math.cos(v)*p,a.push(g,0,y),l.push(f.r,f.g,f.b)}}const c=new yt;c.setAttribute("position",new rt(a,3)),c.setAttribute("color",new rt(l,3));const h=new ji({vertexColors:!0,toneMapped:!1});super(c,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _N=new S,Pw=new S,bN=new S;class m6 extends ye{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let n=new yt;n.setAttribute("position",new rt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new ji({fog:!1,toneMapped:!1});this.lightPlane=new An(n,r),this.add(this.lightPlane),n=new yt,n.setAttribute("position",new rt([0,0,0,0,0,1],3)),this.targetLine=new An(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_N.setFromMatrixPosition(this.light.matrixWorld),Pw.setFromMatrixPosition(this.light.target.matrixWorld),bN.subVectors(Pw,_N),this.lightPlane.lookAt(Pw),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Pw),this.targetLine.scale.z=bN.length()}}const Bw=new S,Un=new Tb;class g6 extends jr{constructor(e){const t=new yt,i=new ji({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(m,v){l(m),l(v)}function l(m){n.push(0,0,0),r.push(0,0,0),o[m]===void 0&&(o[m]=[]),o[m].push(n.length/3-1)}t.setAttribute("position",new rt(n,3)),t.setAttribute("color",new rt(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new Ae(16755200),h=new Ae(16711680),u=new Ae(43775),f=new Ae(16777215),p=new Ae(3355443);this.setColors(c,h,u,f,p)}setColors(e,t,i,n,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,n.r,n.g,n.b),a.setXYZ(39,n.r,n.g,n.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,n=1;Un.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Wn("c",t,e,Un,0,0,-1),Wn("t",t,e,Un,0,0,1),Wn("n1",t,e,Un,-i,-n,-1),Wn("n2",t,e,Un,i,-n,-1),Wn("n3",t,e,Un,-i,n,-1),Wn("n4",t,e,Un,i,n,-1),Wn("f1",t,e,Un,-i,-n,1),Wn("f2",t,e,Un,i,-n,1),Wn("f3",t,e,Un,-i,n,1),Wn("f4",t,e,Un,i,n,1),Wn("u1",t,e,Un,i*.7,n*1.1,-1),Wn("u2",t,e,Un,-i*.7,n*1.1,-1),Wn("u3",t,e,Un,0,n*2,-1),Wn("cf1",t,e,Un,-i,0,1),Wn("cf2",t,e,Un,i,0,1),Wn("cf3",t,e,Un,0,-n,1),Wn("cf4",t,e,Un,0,n,1),Wn("cn1",t,e,Un,-i,0,-1),Wn("cn2",t,e,Un,i,0,-1),Wn("cn3",t,e,Un,0,-n,-1),Wn("cn4",t,e,Un,0,n,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Wn(s,e,t,i,n,r,o){Bw.set(n,r,o).unproject(i);const a=e[s];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],Bw.x,Bw.y,Bw.z)}}const Dw=new jt;class _L extends jr{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),r=new yt;r.setIndex(new Ke(i,1)),r.setAttribute("position",new Ke(n,3)),super(r,new ji({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Dw.setFromObject(this.object),Dw.isEmpty())return;const t=Dw.min,i=Dw.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class bL extends jr{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new yt;r.setIndex(new Ke(i,1)),r.setAttribute("position",new rt(n,3)),super(r,new ji({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Yte extends An{constructor(e,t=1,i=16776960){const n=i,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new yt;o.setAttribute("position",new rt(r,3)),o.computeBoundingSphere(),super(o,new ji({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new yt;l.setAttribute("position",new rt(a,3)),l.computeBoundingSphere(),this.add(new fe(l,new ti({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const xN=new S;let Ow,zI;class Kte extends ye{constructor(e=new S(0,0,1),t=new S(0,0,0),i=1,n=16776960,r=i*.2,o=r*.2){super(),this.type="ArrowHelper",Ow===void 0&&(Ow=new yt,Ow.setAttribute("position",new rt([0,0,0,0,1,0],3)),zI=new Xn(0,.5,1,5,1),zI.translate(0,-.5,0)),this.position.copy(t),this.line=new An(Ow,new ji({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new fe(zI,new ti({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{xN.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(xN,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}let _a=class extends jr{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new yt;n.setAttribute("position",new rt(t,3)),n.setAttribute("color",new rt(i,3));const r=new ji({vertexColors:!0,toneMapped:!1});super(n,r),this.type="AxesHelper"}setColors(e,t,i){const n=new Ae,r=this.geometry.attributes.color.array;return n.set(e),n.toArray(r,0),n.toArray(r,3),n.set(t),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};class y6{constructor(){this.type="ShapePath",this.color=new Ae,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new P_,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,o){return this.currentPath.bezierCurveTo(e,t,i,n,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(y){const A=[];for(let _=0,b=y.length;_<b;_++){const x=y[_],E=new Td;E.curves=x.curves,A.push(E)}return A}function i(y,A){const _=A.length;let b=!1;for(let x=_-1,E=0;E<_;x=E++){let M=A[x],T=A[E],R=T.x-M.x,w=T.y-M.y;if(Math.abs(w)>Number.EPSILON){if(w<0&&(M=A[E],R=-R,T=A[x],w=-w),y.y<M.y||y.y>T.y)continue;if(y.y===M.y){if(y.x===M.x)return!0}else{const I=w*(y.x-M.x)-R*(y.y-M.y);if(I===0)return!0;if(I<0)continue;b=!b}}else{if(y.y!==M.y)continue;if(T.x<=y.x&&y.x<=M.x||M.x<=y.x&&y.x<=T.x)return!0}}return b}const n=kl.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,a,l;const c=[];if(r.length===1)return a=r[0],l=new Td,l.curves=a.curves,c.push(l),c;let h=!n(r[0].getPoints());h=e?!h:h;const u=[],f=[];let p=[],m=0,v;f[m]=void 0,p[m]=[];for(let y=0,A=r.length;y<A;y++)a=r[y],v=a.getPoints(),o=n(v),o=e?!o:o,o?(!h&&f[m]&&m++,f[m]={s:new Td,p:v},f[m].s.curves=a.curves,h&&m++,p[m]=[]):p[m].push({h:a,p:v[0]});if(!f[0])return t(r);if(f.length>1){let y=!1,A=0;for(let _=0,b=f.length;_<b;_++)u[_]=[];for(let _=0,b=f.length;_<b;_++){const x=p[_];for(let E=0;E<x.length;E++){const M=x[E];let T=!0;for(let R=0;R<f.length;R++)i(M.p,f[R].p)&&(_!==R&&A++,T?(T=!1,u[R].push(M)):y=!0);T&&u[_].push(M)}}A>0&&y===!1&&(p=u)}let g;for(let y=0,A=f.length;y<A;y++){l=f[y].s,c.push(l),g=p[y];for(let _=0,b=g.length;_<b;_++)l.holes.push(g[_].h)}return c}}class Jte extends $t{constructor(e=1,t=1,i=1,n={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,t,{...n,count:i}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:su}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported. Existing: "+window.__THREE__+", new: "+su):window.__THREE__=su);const Zte=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Sb,AddEquation:ud,AddOperation:z5,AdditiveAnimationBlendMode:NO,AdditiveBlending:Yp,AgXToneMapping:gv,AlphaFormat:Q5,AlwaysCompare:g8,AlwaysDepth:GE,AlwaysStencilFunc:O1,AmbientLight:AM,AnimationAction:f6,AnimationClip:go,AnimationLoader:mte,AnimationMixer:wM,AnimationObjectGroup:kte,AnimationUtils:ute,ArcCurve:H8,ArrayCamera:KO,ArrowHelper:Kte,AttachedBindMode:HB,Audio:yL,AudioAnalyser:Ete,AudioContext:xM,AudioListener:h6,AudioLoader:z1,AxesHelper:_a,BackSide:bn,BasicDepthPacking:gr,BasicShadowMap:HX,BatchedMesh:U1,Bone:em,BooleanKeyframeTrack:dm,Box2:Hte,Box3:jt,Box3Helper:bL,BoxGeometry:Ki,BoxHelper:_L,BufferAttribute:Ke,BufferGeometry:yt,BufferGeometryLoader:l6,ByteType:B1,Cache:Xh,Camera:Tb,CameraHelper:g6,CanvasTexture:tL,CapsuleGeometry:sM,CatmullRomCurve3:V8,CineonToneMapping:G5,CircleGeometry:rM,ClampToEdgeWrapping:as,Clock:gL,Color:Ae,ColorKeyframeTrack:yM,ColorManagement:Ci,CompressedArrayTexture:Oee,CompressedCubeTexture:Lee,CompressedTexture:Md,CompressedTextureLoader:gte,ConeGeometry:oM,ConstantAlphaFactor:F5,ConstantColorFactor:L5,CubeCamera:jO,CubeReflectionMapping:ru,CubeRefractionMapping:zd,CubeTexture:Ib,CubeTextureLoader:yte,CubeUVReflectionMapping:yv,CubicBezierCurve:nL,CubicBezierCurve3:Q8,CubicInterpolant:t6,CullFaceBack:UB,CullFaceFront:w5,CullFaceFrontBack:GX,CullFaceNone:x5,Curve:ll,CurvePath:j8,CustomBlending:BO,CustomToneMapping:H5,CylinderGeometry:Xn,Cylindrical:Gte,Data3DTexture:QO,DataArrayTexture:JE,DataTexture:Qr,DataTextureLoader:fL,DataUtils:bp,DecrementStencilOp:e8,DecrementWrapStencilOp:i8,DefaultLoadingManager:s6,DepthFormat:Ed,DepthStencilFormat:Gd,DepthTexture:Av,DetachedBindMode:V5,DirectionalLight:nm,DirectionalLightHelper:m6,DiscreteInterpolant:i6,DisplayP3ColorSpace:KE,DodecahedronGeometry:aM,DoubleSide:_i,DstAlphaFactor:R5,DstColorFactor:B5,DynamicCopyUsage:ZX,DynamicDrawUsage:Ur,DynamicReadUsage:YX,EdgesGeometry:lL,EllipseCurve:nM,EqualCompare:d8,EqualDepth:qy,EqualStencilFunc:r8,EquirectangularReflectionMapping:mo,EquirectangularRefractionMapping:Xy,Euler:li,EventDispatcher:js,ExtrudeGeometry:bv,FileLoader:yr,Float16BufferAttribute:kY,Float32BufferAttribute:rt,FloatType:tn,Fog:tM,FogExp2:eM,FramebufferTexture:Dee,FrontSide:$n,Frustum:$p,GLBufferAttribute:zte,GLSL1:eY,GLSL3:L1,GreaterCompare:f8,GreaterDepth:VE,GreaterEqualCompare:m8,GreaterEqualDepth:HE,GreaterEqualStencilFunc:c8,GreaterStencilFunc:a8,GridHelper:SM,Group:Vs,HalfFloatType:Cs,HemisphereLight:pL,HemisphereLightHelper:qte,IcosahedronGeometry:cM,ImageBitmapLoader:c6,ImageLoader:L_,ImageUtils:VO,IncrementStencilOp:$5,IncrementWrapStencilOp:t8,InstancedBufferAttribute:Po,InstancedBufferGeometry:bM,InstancedInterleavedBuffer:G1,InstancedMesh:$O,Int16BufferAttribute:OY,Int32BufferAttribute:LY,Int8BufferAttribute:PY,IntType:Pp,InterleavedBuffer:Pb,InterleavedBufferAttribute:aa,Interpolant:xv,InterpolateDiscrete:Hd,InterpolateLinear:Fc,InterpolateSmooth:WC,InvertStencilOp:n8,KeepStencilOp:sd,KeyframeTrack:jl,LOD:ZO,LatheGeometry:Db,Layers:Vr,LessCompare:u8,LessDepth:x_,LessEqualCompare:GO,LessEqualDepth:Kp,LessEqualStencilFunc:o8,LessStencilFunc:s8,Light:ef,LightProbe:a6,Line:An,Line3:ma,LineBasicMaterial:ji,LineCurve:sL,LineCurve3:W8,LineDashedMaterial:Z8,LineLoop:eL,LineSegments:jr,LinearDisplayP3ColorSpace:Mb,LinearEncoding:Y5,LinearFilter:Nt,LinearInterpolant:dL,LinearMipMapLinearFilter:jX,LinearMipMapNearestFilter:WX,LinearMipmapLinearFilter:Do,LinearMipmapNearestFilter:Rp,LinearSRGBColorSpace:zi,LinearToneMapping:mv,LinearTransfer:C_,Loader:ds,LoaderUtils:Jh,LoadingManager:vM,LoopOnce:w_,LoopPingPong:q5,LoopRepeat:UO,LuminanceAlphaFormat:W5,LuminanceFormat:WE,MOUSE:op,Material:Ht,MaterialLoader:_M,MathUtils:gi,Matrix3:Ut,Matrix4:le,MaxEquation:I1,Mesh:fe,MeshBasicMaterial:ti,MeshDepthMaterial:Rb,MeshDistanceMaterial:YO,MeshLambertMaterial:hL,MeshMatcapMaterial:J8,MeshNormalMaterial:gM,MeshPhongMaterial:By,MeshPhysicalMaterial:No,MeshStandardMaterial:ws,MeshToonMaterial:K8,MinEquation:GB,MirroredRepeatWrapping:Zp,MixOperation:N5,MultiplyBlending:zB,MultiplyOperation:xb,NearestFilter:Ot,NearestMipMapLinearFilter:QX,NearestMipMapNearestFilter:VX,NearestMipmapLinearFilter:Nh,NearestMipmapNearestFilter:Yy,NeutralToneMapping:Jp,NeverCompare:h8,NeverDepth:DO,NeverStencilFunc:m2,NoBlending:xn,NoColorSpace:Bo,NoToneMapping:po,NormalAnimationBlendMode:XE,NormalBlending:Cd,NotEqualCompare:p8,NotEqualDepth:bb,NotEqualStencilFunc:l8,NumberKeyframeTrack:ou,Object3D:ye,ObjectLoader:bte,ObjectSpaceNormalMap:K5,OctahedronGeometry:qh,OneFactor:M5,OneMinusConstantAlphaFactor:U5,OneMinusConstantColorFactor:k5,OneMinusDstAlphaFactor:P5,OneMinusDstColorFactor:D5,OneMinusSrcAlphaFactor:P1,OneMinusSrcColorFactor:I5,OrthographicCamera:Qc,P3Primaries:M_,PCFShadowMap:RO,PCFSoftShadowMap:PO,PMREMGenerator:v2,Path:P_,PerspectiveCamera:Vt,Plane:xs,PlaneGeometry:ps,PlaneHelper:Yte,PointLight:im,PointLightHelper:Wte,Points:Py,PointsMaterial:md,PolarGridHelper:Xte,PolyhedronGeometry:$d,PositionalAudio:u6,PropertyBinding:Zt,PropertyMixer:d6,QuadraticBezierCurve:rL,QuadraticBezierCurve3:oL,Quaternion:Ce,QuaternionKeyframeTrack:zl,QuaternionLinearInterpolant:n6,RED_GREEN_RGTC2_Format:d2,RED_RGTC1_Format:j5,REVISION:su,RGBADepthPacking:YE,RGBAFormat:Li,RGBAIntegerFormat:Ky,RGBA_ASTC_10x10_Format:o2,RGBA_ASTC_10x5_Format:n2,RGBA_ASTC_10x6_Format:s2,RGBA_ASTC_10x8_Format:r2,RGBA_ASTC_12x10_Format:a2,RGBA_ASTC_12x12_Format:l2,RGBA_ASTC_4x4_Format:YB,RGBA_ASTC_5x4_Format:KB,RGBA_ASTC_5x5_Format:JB,RGBA_ASTC_6x5_Format:ZB,RGBA_ASTC_6x6_Format:$B,RGBA_ASTC_8x5_Format:e2,RGBA_ASTC_8x6_Format:t2,RGBA_ASTC_8x8_Format:i2,RGBA_BPTC_Format:QC,RGBA_ETC2_EAC_Format:XB,RGBA_PVRTC_2BPPV1_Format:jB,RGBA_PVRTC_4BPPV1_Format:WB,RGBA_S3TC_DXT1_Format:GC,RGBA_S3TC_DXT3_Format:HC,RGBA_S3TC_DXT5_Format:VC,RGB_BPTC_SIGNED_Format:c2,RGB_BPTC_UNSIGNED_Format:h2,RGB_ETC1_Format:FO,RGB_ETC2_Format:qB,RGB_PVRTC_2BPPV1_Format:QB,RGB_PVRTC_4BPPV1_Format:VB,RGB_S3TC_DXT1_Format:zC,RGFormat:qE,RGIntegerFormat:Eb,RawShaderMaterial:mM,Ray:_o,Raycaster:tf,Rec709Primaries:E_,RectAreaLight:r6,RedFormat:um,RedIntegerFormat:jE,ReinhardToneMapping:wb,RenderTarget:w8,RepeatWrapping:Uo,ReplaceStencilOp:Z5,ReverseSubtractEquation:C5,RingGeometry:Ob,SIGNED_RED_GREEN_RGTC2_Format:f2,SIGNED_RED_RGTC1_Format:u2,SRGBColorSpace:bt,SRGBTransfer:Yi,Scene:Ws,ShaderChunk:It,ShaderLib:ur,ShaderMaterial:kt,ShadowMaterial:pM,Shape:Td,ShapeGeometry:hM,ShapePath:y6,ShapeUtils:kl,ShortType:OO,Skeleton:Bb,SkeletonHelper:Qte,SkinnedMesh:Fo,Source:jh,Sphere:ln,SphereGeometry:cl,Spherical:C2,SphericalHarmonics3:o6,SplineCurve:aL,SpotLight:Lb,SpotLightHelper:Vte,Sprite:JO,SpriteMaterial:iM,SrcAlphaFactor:R1,SrcAlphaSaturateFactor:O5,SrcColorFactor:T5,StaticCopyUsage:JX,StaticDrawUsage:T_,StaticReadUsage:XX,StereoCamera:wte,StreamCopyUsage:$X,StreamDrawUsage:qX,StreamReadUsage:KX,StringKeyframeTrack:fm,SubtractEquation:S5,SubtractiveBlending:NB,TOUCH:ap,TangentSpaceNormalMap:Zd,TetrahedronGeometry:uM,Texture:Wt,TextureLoader:Bc,TorusGeometry:Gh,TorusKnotGeometry:dM,Triangle:pr,TriangleFanDrawMode:D1,TriangleStripDrawMode:zO,TrianglesDrawMode:X5,TubeGeometry:fM,UVMapping:QE,Uint16BufferAttribute:ZE,Uint32BufferAttribute:WO,Uint8BufferAttribute:BY,Uint8ClampedBufferAttribute:DY,Uniform:Se,UniformsGroup:Nte,UniformsLib:ze,UniformsUtils:vv,UnsignedByteType:wn,UnsignedInt248Type:Kh,UnsignedIntType:Hr,UnsignedShort4444Type:LO,UnsignedShort5551Type:kO,UnsignedShortType:Cb,VSMShadowMap:cc,Vector2:ee,Vector3:S,Vector4:Je,VectorKeyframeTrack:Uc,VideoTexture:G8,WebGL1Renderer:k8,WebGL3DRenderTarget:_Y,WebGLArrayRenderTarget:AY,WebGLCoordinateSystem:Sc,WebGLCubeRenderTarget:qO,WebGLMultipleRenderTargets:Jte,WebGLRenderTarget:$t,WebGLRenderer:hu,WebGLUtils:L8,WebGPUCoordinateSystem:I_,WireframeGeometry:cL,WrapAroundEnding:S_,ZeroCurvatureEnding:Ap,ZeroFactor:E5,ZeroSlopeEnding:_p,ZeroStencilOp:J5,_SRGBAFormat:k1,createCanvasElement:_8,sRGBEncoding:p2},Symbol.toStringTag,{value:"Module"}));let v6,wN=null;function Gl(){return v6}function xL(s){if(s==null){console.warn("Oh no: someone tried registering a non-existend gltf-loader. When you see this log it might mean that needle-engine is being imported multiple times. Please check your project setup.");return}wN!==s&&(wN=s,v6=new s)}const GI=new Map;function yo(s=(e=>(e=globalThis.location)==null?void 0:e.hostname)()){if(GI.has(s))return GI.get(s);const t=/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|localhost/.test(s);return GI.set(s,t),t===!0}function A6(){return window.location.hostname.includes("glitch.me")}var Ti=(s=>(s.ContextRegistered="ContextRegistered",s.ContextCreationStart="ContextCreationStart",s.ContextCreated="ContextCreated",s.ContextFirstFrameRendered="ContextFirstFrameRendered",s.ContextDestroying="ContextDestroying",s.ContextDestroyed="ContextDestroyed",s.MissingCamera="MissingCamera",s.ContextClearing="ContextClearing",s.ContextCleared="ContextCleared",s))(Ti||{});class mi{static get Current(){return globalThis["NeedleEngine.Context.Current"]}static set Current(e){globalThis["NeedleEngine.Context.Current"]=e}static get All(){return this.Registered}static register(e){this.Registered.push(e),this.dispatchCallback("ContextRegistered",e)}static unregister(e){const t=this.Registered.indexOf(e);t!==-1&&this.Registered.splice(t,1)}static registerCallback(e,t){this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t)}static unregisterCallback(e,t){if(!this._callbacks[e])return;const i=this._callbacks[e].indexOf(t);i!==-1&&this._callbacks[e].splice(i,1)}static dispatchCallback(e,t,i){if(!this._callbacks[e])return!0;const n={event:e,context:t};if(i)for(const o in i)n[o]=i[o];const r=new Array;return this._callbacks[e].forEach(o=>{const a=o(n);a instanceof Promise&&r.push(a)}),Promise.all(r)}static addContextCreatedCallback(e){this.registerCallback("ContextCreated",e)}static addContextDestroyedCallback(e){this.registerCallback("ContextDestroyed",e)}}d(mi,"Registered",[]),d(mi,"_callbacks",{});const _6=()=>s=>s;function $te(s){return _6()(s)}function eie(){return!!ie("debug")}class ba{constructor(e,t){d(this,"_factory");d(this,"_cache",[]);d(this,"_maxSize");d(this,"_index",0);this._factory=e,this._maxSize=t}get(){const e=this._index%this._maxSize;return this._index++,this._cache.length<=e&&(this._cache[e]=this._factory()),this._cache[e]}}let dp=!1;const E2=new Array;typeof window<"u"&&setTimeout(()=>{if(dp){const s={},e=new URL(window.location.href),t=new URL(e);t.searchParams.append("console","");const i=t.toString().replace(/=$|=(?=&)/g,"");for(const r of E2){const o=new URL(e);o.searchParams.append(r,""),s[r]=o.toString().replace(/=$|=(?=&)/g,"")}console.log(` ?help: Debug Options for Needle Engine.
Append any of these parameters to the URL to enable specific debug options.
Example: ${i} will show an onscreen console window.`);const n=dp===!0?"":` (containing "${dp}")`;console.group("Available URL parameters:"+n);for(const r in s)typeof dp=="string"&&!r.toLowerCase().includes(dp.toLowerCase())||(console.groupCollapsed(r),console.log("Reload with this flag enabled:"),console.log(s[r]),console.groupEnd());console.groupEnd()}},100);function kb(){var s;return new URLSearchParams((s=globalThis.location)==null?void 0:s.search)}function ie(s){dp&&!E2.includes(s)&&E2.push(s);const e=kb();if(e.has(s)){const t=e.get(s);if(t){const i=Number(t);return isNaN(i)?t:i}else return!0}return!1}dp=ie("help");function tie(s,e){const t=kb();t.has(s)?t.set(s,e):t.append(s,e),document.location.search=t.toString()}function H1(s,e,t=!0){const i=kb();i.has(s)?e===null?i.delete(s):i.set(s,e):e!==null&&i.append(s,e),t?b6(s,i):wL(s,i)}function M2(s,e,t){s.has(e)?s.set(e,t.toString()):s.append(e,t.toString())}function b6(s,e,t){window.history.pushState(t,s,"?"+e.toString())}function wL(s,e,t){window.history.replaceState(t,s,"?"+e.toString())}function iie(s){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=t.length,n=0;n<s;n++)e+=t.charAt(Math.floor(Math.random()*i));return e}function nie(s,e){return Math.floor(Math.random()*(e-s+1))+s}const SN=["smol","tiny","giant","interesting","smart","bright","dull","extreme","beautiful","pretty","dark","epic","salty","silly","funny","lame","lazy","loud","lucky","mad","mean","mighty","mysterious","nasty","odd","old","powerful","quiet","rapid","scary","shiny","shy","silly","smooth","sour","spicy","stupid","sweet","tasty","terrible","ugly","unusual","vast","wet","wild","witty","wrong","zany","zealous","zippy","zombie","zorro"],CN=["cat","dog","mouse","pig","cow","horse","sheep","chicken","duck","goat","panda","tiger","lion","elephant","monkey","bird","fish","snake","frog","turtle","hamster","penguin","kangaroo","whale","dolphin","crocodile","snail","ant","bee","beetle","butterfly","dragon","eagle","fish","giraffe","lizard","panda","penguin","rabbit","snake","spider","tiger","zebra"];function x6(){const s=SN[Math.floor(Math.random()*SN.length)],e=CN[Math.floor(Math.random()*CN.length)];return s+"_"+e}function w6(s){return s=s.replace(/[^a-z0-9 \.,_-]/gim,""),s.trim()}function $y(s,e,t=!0,i=!1){var n;if(e==null)return null;if(e.userData&&e.userData.guid===s)return e;if(e.guid==s)return e;if(i&&(n=e.userData)!=null&&n.components){for(const r of e.userData.components)if(r.guid===s)return r}if(t){if(e.scenes)for(const r in e.scenes){const o=e.scenes[r],a=$y(s,o,t,i);if(a)return a}if(e.children)for(const r in e.children){const o=e.children[r],a=$y(s,o,t,i);if(a)return a}}}function Fb(s,e){if(s!=null&&typeof s=="object"){let t;Array.isArray(s)?t=[]:(t=Object.create(s),Object.assign(t,s));for(const i of Object.keys(s)){const n=s[i];e&&!e(s,i,n)?t[i]=n:(n==null?void 0:n.clone)!==void 0&&typeof n.clone=="function"?t[i]=n.clone():t[i]=Fb(n,e)}return t}return s}function Nc(s){return new Promise((e,t)=>{setTimeout(e,s)})}function CM(s,e){if(s<=0)return Promise.resolve();if(e||(e=mi.Current),!e)return Promise.reject("No context");const t=e.time.frameCount+s;return new Promise((i,n)=>{if(!e)return n("No context");const r=()=>{e.time.frameCount>=t&&(e.pre_update_callbacks.splice(e.pre_update_callbacks.indexOf(r),1),i())};e.pre_update_callbacks.push(r)})}const Lw=ie("debugresolveurl"),S6="rel:";function sie(s,e){return nf(s,e)}function nf(s,e){if(e===void 0)return Lw&&console.warn("getPath: uri is undefined, returning uri",e),e;if(e.startsWith("./"))return e;if(e.startsWith("http"))return Lw&&console.warn("getPath: uri is absolute, returning uri",e),e;if(s===void 0)return Lw&&console.warn("getPath: source is undefined, returning uri",e),e;e.startsWith(S6)&&(e=e.substring(4));const t=s.lastIndexOf("/");if(t>=0){const i=s.substring(0,t+1);for(;i.endsWith("/")&&e.startsWith("/");)e=e.substring(1);const n=i+e;return Lw&&console.log("source:",s,`changed uri 
from`,e,`
to `,n,`
basePath: `+i),n}return e}class rie{constructor(e,t){d(this,"writeCallbacks",[]);d(this,"_applied",!1);d(this,"_object");d(this,"_prop");d(this,"_wrapperProp");this._object=e,this._prop=t,this._wrapperProp=Symbol("$"+t),this.apply()}subscribeWrite(e){this.writeCallbacks.push(e)}unsubscribeWrite(e){const t=this.writeCallbacks.indexOf(e);t!==-1&&this.writeCallbacks.splice(t,1)}apply(){if(this._applied||!this._object)return;const e=this._object,t=this._prop;if(e[t]===void 0)return;this._applied=!0,e[this._wrapperProp]!==void 0&&console.warn("Watcher is being applied to an object that already has a wrapper property. This is not (yet) supported");const i=e[t];e[this._wrapperProp]=i,Object.defineProperty(e,t,{get:()=>e[this._wrapperProp],set:o=>{e[this._wrapperProp]=o;for(const a of this.writeCallbacks)a(o,this._prop)}})}revoke(){if(!this._applied||!this._object)return;this._applied=!1;const e=this._object,t=this._prop;Reflect.deleteProperty(e,t);const i=e[this._wrapperProp];e[t]=i,Reflect.deleteProperty(e,this._wrapperProp)}dispose(){this.revoke(),this.writeCallbacks.length=0,this._object=null}}class Zh{constructor(e,t){d(this,"_watches",[]);if(Array.isArray(t))for(const i of t)this._watches.push(new Zh(e,i));else this._watches.push(new rie(e,t))}subscribeWrite(e){for(const t of this._watches)t.subscribeWrite(e)}unsubscribeWrite(e){for(const t of this._watches)t.unsubscribeWrite(e)}apply(){for(const e of this._watches)e.apply()}revoke(){for(const e of this._watches)e.revoke()}dispose(){for(const e of this._watches)e.dispose();this._watches.length=0}}const $g=Symbol("needle:watches");function EM(s,e){if(!s[$g])if(s instanceof ee)s[$g]=new Zh(s,["x","y"]);else if(s instanceof S)s[$g]=new Zh(s,["x","y","z"]);else if(s instanceof Je||s instanceof Ce)s[$g]=new Zh(s,["x","y","z","w"]);else return!1;return s[$g].subscribeWrite(e),!0}function SL(s,e){if(!s)return;const t=s[$g];t&&t.unsubscribeWrite(e)}let HI;function ev(){if(HI!==void 0)return HI;const s=window.navigator.userAgent,e=/Windows|MacOS|Mac OS/.test(s),t=/Windows NT/.test(s)&&/Edg/.test(s)&&!/Win64/.test(s);return HI=e&&!t&&!Vd()}let kw;function Wc(){return kw!==void 0?kw:typeof window.orientation<"u"||navigator.userAgent.indexOf("IEMobile")!==-1?kw=!0:kw=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent)}function C6(){return/Android/.test(navigator.userAgent)}function Dp(){return/WebXRViewer\//i.test(navigator.userAgent)}let Fw;function E6(){if(Fw!==void 0)return Fw;if(navigator.userAgentData)return Fw=navigator.userAgentData.platform==="macOS";{const s=navigator.userAgent.toLowerCase();return Fw=s.includes("mac os x")||s.includes("macintosh")}}let VI;const oie=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function Vd(){return VI!==void 0?VI:VI=oie.includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Dy(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function MM(){return navigator.userAgent.includes("OculusBrowser")}async function mA(){try{return(await navigator.permissions.query({name:"microphone"})).state!=="denied"}catch(s){return console.error("Error querying `microphone` permissions.",s),!1}}const aie=/ip=(?<ip>.+?)\n/s;async function lie(){const e=await(await fetch("https://www.cloudflare.com/cdn-cgi/trace")).text(),t=aie.exec(e);return t?t[1]:null}async function cie(){return(await(await fetch("https://api.db-ip.com/v2/free/self")).json()).ipAddress}async function hie(){return await(await fetch("https://api.db-ip.com/v2/free/self").catch(()=>null)).json()}const gd=new WeakMap;function M6(s,e,t){if(!gd.get(s)){const n=new MutationObserver(r=>{uie(s,r)});gd.set(s,{observer:n,attributeChangedListeners:new Map}),n.observe(s,{attributes:!0})}const i=gd.get(s).attributeChangedListeners;i.has(e)||i.set(e,[]),i.get(e).push(t)}function T6(s,e,t){if(!gd.get(s))return;const i=gd.get(s).attributeChangedListeners;if(!i.has(e))return;const n=i.get(e),r=n.indexOf(t);if(r!==-1&&(n.splice(r,1),n.length<=0)){i.delete(e);const o=gd.get(s);o==null||o.observer.disconnect(),gd.delete(s)}}function uie(s,e){const t=gd.get(s).attributeChangedListeners;for(const i of e)if(i.type==="attributes"){const n=i.attributeName,r=s.getAttribute(n);if(t.has(n))for(const o of t.get(n))o(r)}}class T2{constructor(e){d(this,"reason");this.reason=e}}async function TM(s){const e=await Promise.allSettled(s).catch(n=>[new T2(n.message)]);let t=!1;const i=e.map(n=>"value"in n?n.value:(t=!0,new T2(n.reason)));return{anyFailed:t,results:i}}async function I6(s){if(!globalThis.QRCode){const i="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js";let n=document.head.querySelector(`script[src="${i}"]`);n||(n=document.createElement("script"),n.src=i,document.head.appendChild(n)),await new Promise((r,o)=>{n.addEventListener("load",()=>{r(!0)})})}const e=globalThis.QRCode,t=s.domElement??document.createElement("div");return new e(t,{width:s.width??256,height:s.height??256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:e.CorrectLevel.M,...s}),t}const R6=ie("debugdebug");let k_=!1;(ie("noerrors")||ie("nooverlaymessages"))&&(k_=!0);const QI="needle_engine_global_error_container";var la=(s=>(s[s.Log=0]="Log",s[s.Warn=1]="Warn",s[s.Error=2]="Error",s))(la||{});function CL(){return O6}const I2=new Array;function die(s){I2.push(s)}let WI=!1;function fie(...s){if(!WI){WI=!0;try{for(let e=0;e<I2.length;e++)I2[e](...s)}catch(e){console.error(e)}WI=!1}}const P6=console.error,B6=function(...s){P6.apply(console,s),gie(s),Cc(2,s),R2(...s)};function D6(s){k_=!s,s?console.error=B6:console.error=P6}function pie(s){return D6(s)}function mie(){k_||(R6&&console.warn("Patch console",window.location.hostname),console.error=B6,window.addEventListener("error",s=>{if(!s)return;const e=s.error;if(e===void 0){yo()&&console.warn("Received unknown error",s,s.target);return}Cc(2,e,s.filename,s.lineno),R2(s)},!0),window.addEventListener("unhandledrejection",s=>{k_||s&&(s.reason?Cc(2,s.reason.message,s.reason.stack):Cc(2,"unhandled rejection"),R2(s))}))}let O6=0;function R2(...s){O6+=1,fie(...s)}function gie(s){if(Array.isArray(s))for(let e=0;e<s.length;e++){const t=s[e];typeof t=="string"&&t.startsWith("THREE.PropertyBinding: Trying to update node for track:")&&(s[e]="Some animated objects couldn't be found: see console for details")}}function Cc(s,e,t,i){if(k_)return;const n=mi.Current,r=(n==null?void 0:n.domElement)??document.querySelector("needle-engine");if(r){if(Array.isArray(e)){let o="";for(let a=0;a<e.length;a++){let l=e[a];l instanceof Error&&(l=l.message),typeof l!="object"&&(a>0&&(o+=" "),o+=l)}e=o}!e||e.length<=0||yie(s,r,e)}}const WA=new Map;function yie(s,e,t){if(t==null)return;const i=Aie(e);if(i.childElementCount>=20){const a=i.lastElementChild;EN(a)}t.length>400&&(t=t.substring(0,400)+"...");const n=t;if(WA.has(n))return;const r=_ie(s,t);i.prepend(r);const o=()=>{WA.delete(n),EN(r)};WA.set(n,o),setTimeout(o,1e4)}function L6(){R6&&console.log("Clearing messages");for(const s of WA.values())s==null||s.call(s);WA.clear()}const vie=`

@import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

div[data-needle_engine_debug_overlay] {
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 400;
}

div[data-needle_engine_debug_overlay] strong {
    font-weight: 700;
}

div[data-needle_engine_debug_overlay] a {
    color: white;
    text-decoration: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

div[data-needle_engine_debug_overlay] a:hover {
    text-decoration: none;
    border: none;
}

div[data-needle_engine_debug_overlay] .log strong {
    color: rgba(200,200,200,.9);
}

div[data-needle_engine_debug_overlay] .warn strong {
    color: rgba(255,255,230, 1);
}

div[data-needle_engine_debug_overlay] .error strong {
    color: rgba(255,100,120, 1);
}
`;function Aie(s){globalThis[QI]||(globalThis[QI]=new Map);const e=globalThis[QI];if(e.has(s))return e.get(s);{const t=document.createElement("div");e.set(s,t),t.setAttribute("data-needle_engine_debug_overlay",""),t.classList.add("debug-container"),t.style.cssText=`
            position: absolute;
            top: 0;
            right: 5px;
            padding-top: 0px;
            max-width: 70%;
            max-height: calc(100% - 5px);
            z-index: 9999999999;
            pointer-events: scroll;
            display: flex;
            align-items: end;
            flex-direction: column;
            color: white;
            overflow: auto;
            word-break: break-word;
        `,s.shadowRoot?s.shadowRoot.appendChild(t):s.appendChild(t);const i=document.createElement("style");return i.innerHTML=vie,t.appendChild(i),t}}const k6=Symbol("logtype"),V1=new Map;function EN(s){s.remove();const e=s[k6],t=V1.get(e)??[];t.push(s),V1.set(e,t)}function _ie(s,e){if(V1.has(s)){const i=V1.get(s);if(i.length>0){const n=i.pop();return n.innerHTML=e,n}}const t=document.createElement("div");switch(t.setAttribute("data-id","__needle_engine_debug_overlay"),t.style.marginRight="5px",t.style.padding=".5em",t.style.backgroundColor="rgba(0,0,0,.9)",t.style.marginTop="5px",t.style.marginBottom="3px",t.style.borderRadius="8px",t.style.pointerEvents="all",t.style.userSelect="text",t.style.maxWidth="250px",t.style.whiteSpace="pre-wrap",t.style["backdrop-filter"]="blur(10px)",t.style["-webkit-backdrop-filter"]="blur(10px)",t.style.backgroundColor="rgba(20,20,20,.8)",t.style.boxShadow="inset 0 0 80px rgba(0,0,0,.2), 0 0 5px rgba(0,0,0,.2)",t.style.border="1px solid rgba(160,160,160,.2)",t[k6]=s,s){case 0:t.classList.add("log"),t.style.color="rgba(200,200,200,.7)",t.style.backgroundColor="rgba(40,40,40,.7)";break;case 1:t.classList.add("warn"),t.style.color="rgb(255, 255, 150)",t.style.backgroundColor="rgba(50,50,20,.8)";break;case 2:t.classList.add("error"),t.style.color="rgb(255, 50, 50",t.style.backgroundColor="rgba(50,20,20,.8)";break}return t.title="Open the browser console (F12) for more information",t.innerHTML=e,t}var Fl={};Fl.d=(s,e)=>{for(var t in e)Fl.o(e,t)&&!Fl.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})};Fl.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e);Fl.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var ms={};Fl.d(ms,{ti:()=>Ri,nS:()=>bQ,eB:()=>N_,Yp:()=>EL,VB:()=>sm,BC:()=>Ub,zN:()=>pm,cV:()=>iv,hW:()=>G_,k2:()=>z6,K6:()=>Wa,M7:()=>ML,ls:()=>Nb,Hi:()=>nQ,EY:()=>z_,MR:()=>Y6,zf:()=>N6,Ay:()=>Lre,yo:()=>xQ});var EL={};Fl.r(EL);Fl.d(EL,{get:()=>F6,set:()=>bie});var ML={};Fl.r(ML);Fl.d(ML,{alphaTestTransformer:()=>RM,asPreprocessorValueTransformer:()=>K6,toPreprocessorTriggerTransformer:()=>UL,toUserDataTransformer:()=>Bne,uniformOrUserDataTransformer:()=>Ha});const P2={fontFamily:null,fontSize:.05,fontKerning:"auto",fontStyle:"normal",fontWeight:"normal",offset:.005,lineHeight:1.2,lineBreak:`- ,.:?!
`,whiteSpace:"pre-line",flexDirection:"column",justifyContent:"start",alignItems:"start",backgroundImage:null,textAlign:"left",boxSizing:"content-box",position:"static",color:16777215,fontColor:16777215,fontOpacity:1,opacity:1,fontPXRange:4,fontSupersampling:!0,fontSmooth:"antialiased",borderRadius:0,borderWidth:0,borderColor:"black",borderOpacity:1,backgroundSize:"cover",backgroundColor:0,backgroundOpacity:0,overflow:"visible",letterSpacing:0,invertAlpha:!1,segments:1},bie=function(s){for(const e in s)P2[e]=s[e]},F6=function(s){return Object.prototype.hasOwnProperty.call(P2,s)||console.warn(`ThreeMeshUI::DefaultValues is trying to retrieve non-existing property '${s}'`),P2[s]};class Ri{constructor(e,t=null,i=!0){this._id=e,this._value=t,this._needsUpdate=!0,this._needsProcess=!1,this._needsRender=!1,this._isPrimitive=i}get id(){return this._id}get value(){return this._value}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,t){this.output(t)}output(e){}_outputValue(e){e[this._id]=this._value}process(e){}render(e){}getInheritedInput(e){if(this._value!=="inherit")return this._value;const t=e._parent._value;return t&&t[`_${this._id}`]?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return F6(this._id)}isValid(e){return!0}emptyStrategyLogic(){throw new Error(`ThreeMeshUI::${this.constructor.name} has empty strategy. Update has not been processed.`)}requestUpdate(){this._needsUpdate=!0}requestProcess(){this._needsProcess=!1}requestRender(){this._needsRender=!1}}class xie extends Ri{constructor(){super("renderOrder","auto",!0),this.output=this._outputValue,this._actualValue=0}set value(e){this.isValid(e)&&(this._value=e,this._needsUpdate=!0)}update(e,t){if(this._value!=="auto")this._actualValue=this._value;else{const i=e._parent._value;if(i!==null){const n=i._renderOrder._actualValue,r=1+i._children._uis.indexOf(e);this._actualValue=n+r}}for(const i of e._children._uis)i._renderOrder._value==="auto"&&(i._renderOrder._needsUpdate=!0);this._outputValue(t)}_outputValue(e){e[this._id]=this._actualValue}get value(){return this._value}}class pm extends Ri{constructor(e,t=null,i=!0){super(e,t,i),this.output=this._outputValue,this._notInheritedValue=null}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),this.propagate(e),this._outputValue(t)}propagate(e){for(const t of e._children._uis){const i=t[`_${this._id}`];i!==void 0&&i._value==="inherit"&&(t[`_${this._id}`]._needsUpdate=!0)}}_outputValue(e){e[this._id]=this._notInheritedValue}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class wie extends pm{constructor(){super("offset","inherit",!1)}update(e,t){super.update(e,t),e._parent._value!==null&&(e.position.z=this._notInheritedValue)}}class Sie extends pm{constructor(){super("fontSmooth","inherit",!0),this._needsUpdate=!1,this.isValid=Eie,this.output=this._outputValue}}const Cie=["inherit","none","antialiased"];function Eie(s){return Cie.indexOf(s)===-1?(console.warn(`.fontSmoothing value '${s}' is not valid. Aborted`),!1):!0}var Mie=s=>{var e={};return Fl.d(e,s),e};const qe=Mie({BackSide:()=>bn,BufferAttribute:()=>Ke,BufferGeometry:()=>yt,Color:()=>Ae,DoubleSide:()=>_i,EventDispatcher:()=>js,FileLoader:()=>yr,FrontSide:()=>$n,LinearFilter:()=>Nt,Mesh:()=>fe,MeshBasicMaterial:()=>ti,Object3D:()=>ye,Plane:()=>xs,PlaneGeometry:()=>ps,ShaderMaterial:()=>kt,Texture:()=>Wt,TextureLoader:()=>Bc,Vector2:()=>ee,Vector3:()=>S,Vector4:()=>Je});class Cn extends Ri{constructor(e,t,i=!0){super(e,"unset",i),this._input="inherit",this._allowsInherit=!0,this._inheritedInput=void 0,this._inline=void 0}update(e,t){this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis){const n=i[`_${this._id}`];(n._input?n._input:n._value)==="inherit"&&(i[`_${this._id}`]._needsUpdate=!0)}this.output(t)}computeOutputValue(e){this._value=this._input}_computeFromInherited(e){this._value=this._inheritedInput}set value(e){console.warn(".(style) sub-property cannot be directly set. It must comes from inline or computed setter.")}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._input=this._inline=e,this._needsUpdate=!0)}get inline(){return this._inline}isValidValue(e){return!0}getInheritedInput(e){if(this._input!=="inherit")return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class IM extends Cn{constructor(e,t){super(e,t,!1),this._input=new qe.Vector4(0,0,0,0),this._inline=null,this._value=new qe.Vector4(0,0,0,0)}get value(){return this._value}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input)}set inline(e){this._vector4ValueSetter(this._input,e),!this._input.equals(this._value)&&(this._needsUpdate=!0)}set top(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get top(){return this._input.x}set right(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get right(){return this._input.y}set bottom(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottom(){return this._input.z}set left(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get left(){return this._input.w}dispose(){this._computed=null,this._inline=null,this._input=null,this._output=null}_vector4ValueSetter(e,t){if(t instanceof qe.Vector4){e.copy(t);return}if((typeof t=="string"||t instanceof String)&&(t=t.split(" ")),Array.isArray(t))switch(t=t.map(i=>parseFloat(i)),t.length){case 1:e.setScalar(t[0]);return;case 2:e.x=e.z=t[0],e.y=e.w=t[1];return;case 3:e.x=t[0],e.y=t[1],e.z=t[2];return;case 4:e.x=t[0],e.y=t[1],e.z=t[2],e.w=t[3];return;default:console.error("StyleVector4Property::set() Four Dimension property had more than four values");return}isNaN(t)||e.setScalar(t)}}class Tie extends IM{constructor(){super("padding",new qe.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._bounds._needsUpdate=!0,e._bounds._needsRender=!0,e._layouter._needsProcess=!0,e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}class Iie extends IM{constructor(){super("margin",new qe.Vector4(0,0,0,0))}computeOutputValue(e){super.computeOutputValue(e),e._renderer._needsRender=!0,e._parent._value&&(e._parent._value._flexDirection._needsProcess=!0)}}const MN=function(s,e,t){s[e]=t},Rie=function(s,e,t){t!==null&&(s[e]=t)};class Uw{constructor(e){this._definition=e}set definition(e){this._definition=e}mediate(e,t,i,n=null){for(const r in this._definition){const o=this._definition[r];if(i[r]!==void 0){const a=o.t?o.t:MN;a(t,o.m,i[r]),n&&a(n,o.m,i[r])}}}static mediate(e,t,i,n,r=null){if(t)for(const o in n){const a=n[o];if(i[o]!==void 0){const l=a.t?a.t:MN;l(t,a.m,i[o]),r&&l(r,a.m,i[o])}}}}class Pie extends Ri{constructor(){super("parent",null,!1)}update(e,t){e.parent&&e.parent.isUI?this._value=e.parent:this._value=null}set value(e){console.warn("ParentProperty is readonly")}get value(){return this._value}find(e){return this._value?e(this._value)?this._value:this._value._parent.find(e):null}dispose(){this._value=null}}const B2=function(s,e,t=6){return s.toFixed(t)===e.toFixed(t)};class TN extends Ri{constructor(e,t){super(e,t,!0),this.output=this._outputValue}set value(e){this.isValid(e)&&(B2(this._value,e)||(this._value=e,this._needsUpdate=!0))}get value(){return this._value}}class IN extends pm{constructor(e){super(e,"inherit",!0),this.isValid=Die}}const Bie=[qe.FrontSide,qe.BackSide,qe.DoubleSide];function Die(s){return Bie.indexOf(s)===-1?(console.warn(`SideProperty value '${s}' is not valid. Abort`),!1):!0}class U6{constructor(){this._offsetX=0,this._offsetY=0,this._lineBreak=null,this._kerning=0,this._fontFactor=1,this._fontSize=0,this._cumulativeWidth=0,this._paddingLeft=0,this._paddingRight=0,this._marginLeft=0,this._marginRight=0}resetOffsets(){this._offsetX=this._offsetY=0,this._cumulativeWidth=0}get xadvance(){return 0}get xoffset(){return 0}get yoffset(){return 0}get width(){return 0}get height(){return 0}set lineBreak(e){this._lineBreak=e}get lineBreak(){return this._lineBreak}get anchor(){return 0}get kerning(){return this._kerning*this._fontFactor}set kerning(e){this._kerning=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get lineHeight(){return 0}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e}get cumulativeWidth(){return this._cumulativeWidth}set cumulativeWidth(e){this._cumulativeWidth=e}get marginLeft(){return this._marginLeft}set marginLeft(e){this._marginLeft=e}get marginRight(){return this._marginRight}set marginRight(e){this._marginRight=e}get paddingLeft(){return this._paddingLeft}set paddingLeft(e){this._paddingLeft=e}get paddingRight(){return this._paddingRight}set paddingRight(e){this._paddingRight=e}get lineBase(){return 0}set fontFactor(e){this._fontFactor=e}get fontFactor(){return this._fontFactor}}class N6{constructor(e){this._char="",this._width=1,this._heigth=1,this._xadvance=1,this._xoffset=0,this._yoffset=0,this._font=e}get font(){return this._font}get char(){return this._char}get width(){return this._width}get height(){return this._heigth}get xadvance(){return this._xadvance}get xoffset(){return this._xoffset}get yoffset(){return this._yoffset}set yoffset(e){this._yoffset=e}clone(e){throw new Error("Abstract... Need to be implemented")}asInlineGlyph(){throw new Error("Abstract... Need to be implemented")}}class z6 extends U6{constructor(e){super(),this._typographic=e}get typographic(){return this._typographic}get xadvance(){return this._typographic.xadvance*this._fontFactor}get xoffset(){return this._typographic.xoffset*this._fontFactor}get yoffset(){return this._typographic.yoffset*this._fontFactor}get width(){return this._typographic.width*this._fontFactor}get height(){return this._typographic.height*this._fontFactor}get char(){return this._typographic.char}get anchor(){return this.yoffset}get lineHeight(){return this._typographic.font.lineHeight*this._fontFactor}get lineBase(){return this._typographic.font.lineBase*this._fontFactor}}const Oie={light:"100",normal:"400",bold:"700",bolder:"900"};function TL(s){if(!isNaN(s))return s.toString();const e=Oie[s];return e||s}class Lie extends qe.EventDispatcher{constructor(e,t){super(),this._isReady=!1,this._weight=TL(e),this._style=t,this._size=42,this._lineHeight=42,this._lineBase=42,this._font=null}get typographic(){return this._font}get isReady(){return this._isReady}get weight(){return this._weight}get style(){return this._style}get texture(){return this._texture}set fontMaterial(e){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get fontMaterial(){throw Error(`FontVariant('${this.id}')::fontMaterial - is abstract.`)}get id(){return`${this._name}(w:${this.weight},s:${this.style})`}getTypographicGlyph(e){let t=this._chars[e];if(t)return t;if(e.match(/\s/))return this._chars[" "];const i=this._getFallbackCharacter(e);if(i&&(t=this._chars[i],t))return t;throw Error(`FontVariant('${this.id}')::getTypographicGlyph() - character('${e}') and/or fallback character were not found in provided msdf charset.`)}_getFallbackCharacter(e){throw new Error(`FontVariant(${typeof this})::_getFallbackCharacter() is abstract and should therefore be overridden.`)}getGeometricGlyph(e,t){throw new Error(`FontVariant(${typeof this})::getGeometryCharacter() is abstract and should therefore be overridden.`)}getKerningAmount(e){return this._kernings[e]?this._kernings[e]:0}adjustTypographicGlyphs(e){for(const t in e){const i=this.getTypographicGlyph(t),n=e[t];for(const r in n)i["_"+r]=e[t][r]}}_checkReadiness(){this._readyCondition()&&Fie(this)}_alterElementProperties(e){throw new Error(`FontVariant(${typeof this})::_alterElementProperties() is abstract and should therefore be overridden.`)}_readyCondition(){throw new Error(`FontVariant(${typeof this})::_readyCondition() is abstract and should therefore be overridden.`)}}const kie={type:"ready"};function Fie(s){s._isReady=!0,s.dispatchEvent(kie)}const Ub=Lie;class Uie extends Ri{constructor(e=null){super("font",e,!1),this._needsUpdate=!1,this._fontVariant=null,this._handleFontReadyClosure=null,this.isValid=Nie}output(e){e[this._id]=this._fontVariant}update(e,t){if(this._fontVariant&&!this._fontVariant.isReady&&this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._value&&this._value instanceof Ub)this._fontVariant=this._value;else{const i=e._fontFamily._value;i&&(this._fontVariant=i.getVariant(e._fontWeight._value,e._fontStyle._value))}this._fontVariant&&(this._fontVariant._alterElementProperties(e),this._handleFontReadyClosure=zie(e,this),this._fontVariant.isReady?this._handleFontReadyClosure():this._fontVariant.addEventListener("ready",this._handleFontReadyClosure),(!e._fontMaterial._defaultMaterial||!(e._fontMaterial._defaultMaterial instanceof this._fontVariant.fontMaterial))&&(e._fontMaterial._defaultMaterial=new this._fontVariant.fontMaterial,e._fontMaterial._needsUpdate=!0))}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}get fontVariant(){return this._fontVariant}dispose(){this._handleFontReadyClosure&&(this._fontVariant.removeEventListener("ready",this._handleFontReadyClosure),this._handleFontReadyClosure=null),this._value=null,this._fontVariant=null}}function Nie(s){return s instanceof Ub?!0:(console.warn(`.font value '${s}' is not valid. It requires a FontVariant instance. Aborted`),!1)}function zie(s,e){return function(){e._needsUpdate=!0,s._glyphs._needsProcess=!0,e._fontVariant.removeEventListener("ready",e._handleFontReadyClosure),e._handleFontReadyClosure=null}}class Gie extends Cn{constructor(e){super("display",e),this._value="flex",this._allowsInherit=!1,this._needsUpdate=!1,this.isValidValue=Vie}computeOutputValue(e){e._visible._value=this._output!=="none"}}const Hie=["none","flex"];function Vie(s){return Hie.indexOf(s)===-1?(console.warn(`(.style) display value '${s}' is not valid. Aborted`),!1):!0}class Qie extends Cn{constructor(e){super("boxSizing",e),this._allowsInherit=!1,this.isValidValue=jie}computeOutputValue(e){this._value=this._inheritedInput,e._bounds._needsUpdate=!0}}const Wie=["border-box","content-box"];function jie(s){return Wie.indexOf(s)===-1?(console.warn(`(.style) boxSizing value '${s}' is not valid. Aborted`),!1):!0}class F_ extends Cn{constructor(e,t){super(e,t,!1),this._value=new qe.Color,this.output=this._outputValue}computeOutputValue(e){this._input!=="inherit"&&this._value.set(this._input)}set inline(e){this._input=this._inline=e,this._needsUpdate=!0}}class jI extends Cn{constructor(e,t){super(e,t,!0),this.isValidValue=qie,this._allowsInherit=!1,this._input=t,this._value=t,this.output=this._outputValue,this.computeOutputValue=this._computeFromInherited}_outputValue(e){e[this._id]=this._inheritedInput}}function qie(s){return s<0&&s>1?(console.warn(`(.style) styleFactorProperty('${this.id}') value '${s}' is not valid)`),!1):!0}class Xie extends Cn{constructor(e){super("backgroundImage",e,!0),this._input=null,this._allowsInherit=!1,this._textureSize=new qe.Vector2(1,1),this.isValidValue=Yie}get value(){return this._value}output(e){e[this._id]=this._value,e.tSize=this._textureSize}computeOutputValue(e){if(this._value=this._inheritedInput,this._value instanceof qe.Texture&&!this._value.image){console.warn("ThreeMeshUI - .backgroundImage :: Please provide preloaded texture in order to have accurate sizing.");return}this._needsProcess=!0}process(e){this._value?this._textureSize.set(this._value.image.width,this._value.image.height):this._textureSize.set(1,1)}}function Yie(s){return!0}class Kie extends Cn{constructor(e){super("backgroundSize",e,!0),this.isValidValue=Zie,this.output=this._outputValue}}const Jie=["cover","contain","stretch"];function Zie(s){return Jie.indexOf(s)===-1?(console.warn(`(.style) backgroundSize value '${s}' is not valid. Aborted`),!1):!0}class $ie extends Cn{constructor(e){super("overflow",e,!0),this.isValidValue=tne,this._clippingPlanes=null,this._renderStrategy=this._emptyRender}update(e,t){this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0&&(this._input=this._computed),this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis)i._overflow._needsUpdate=!0;this.output(t)}output(e){e.clippingPlanes=this._clippingPlanes}computeOutputValue(e){super.computeOutputValue(e),this._value==="hidden"?this._renderStrategy=this._propagateRender:(this._renderStrategy=this._emptyRender,this._clippingPlanes=null);const t=e._parent._value;if(t!==null){const i=t._overflow;if((i._value==="hidden"||i._clippingPlanes!==null)&&!this._clippingPlanes){this._clippingPlanes=[new qe.Plane(new qe.Vector3(0,-1,0),1),new qe.Plane(new qe.Vector3(-1,0,0),1),new qe.Plane(new qe.Vector3(0,1,0),1),new qe.Plane(new qe.Vector3(1,0,0),1)];for(let n=0;n<this._clippingPlanes.length;n++)this._clippingPlanes[n].parent=t;i._clippingPlanes!==null&&this._clippingPlanes.push(...i._clippingPlanes),this._renderStrategy=this._hiddenRender,this._needsRender=!0}else(i._value==="visible"||i._clippingPlanes===null)&&this._clippingPlanes!==null&&(this._clippingPlanes=null,this._renderStrategy=this._emptyRender,this._needsRender=!0)}}render(e){this._renderStrategy(e)}_emptyRender(e){}_hiddenRender(e){const t=e._parent._value,i=t._bounds._offsetHeight,n=t._bounds._offsetWidth,r=t._padding._value,o=t._borderWidth._value;for(let a=0;a<4&&a<this._clippingPlanes.length;a++){const l=this._clippingPlanes[a];switch(a%4){case 0:l.constant=i/2-(r.x+o.x);break;case 1:l.constant=n/2-(r.y+o.y);break;case 2:l.constant=i/2-(r.z+o.z);break;case 3:l.constant=n/2-(r.w+o.w);break}l.applyMatrix4(t.matrixWorld)}for(let a=0;a<e._children._uis.length;a++){const l=e._children._uis[a];l._overflow._needsRender=!0}}_propagateRender(e){for(let t=0;t<e._children._uis.length;t++){const i=e._children._uis[t];i._overflow._needsRender=!0}}}const ene=["visible","hidden"];function tne(s){return ene.indexOf(s)===-1?(console.warn(`(.style) overflow value '${s}' is not valid. Aborted`),!1):!0}const tv="rem",G6="em",Q1="%",ine=[tv,G6,Q1],H6=function(s){return ine.indexOf(s)===-1?tv:s};class nne extends IM{constructor(e){super("borderRadius",e),this._valueUV=this._value.clone(),this._input=new qe.Vector4(0,0,0,0),this._mediation=!0,this._cornerTL=new qe.Vector2(0,1),this._cornerTR=new qe.Vector2(1,1),this._cornerBR=new qe.Vector2(1,0),this._cornerBL=new qe.Vector2(0,0);const t=new Nw(this._valueUV,["x","y"]),i=new Nw(this._valueUV,["z","w"]),n=new Nw(this._valueUV,["x","w"]),r=new Nw(this._valueUV,["y","z"]);t.complementaryMediation=i,i.complementaryMediation=t,n.complementaryMediation=r,r.complementaryMediation=n,this._sideMediators=[t,i,n,r],this._units=tv}set units(e){this._units=H6(e),this._needsProcess=!0}get units(){return this._units}set mediation(e){e!==this._mediation&&(this._mediation=e,this._needsUpdate=!0)}get mediation(){return this._mediation}output(e){e.cornerTL=this._cornerTL,e.cornerTR=this._cornerTR,e.cornerBR=this._cornerBR,e.cornerBL=this._cornerBL}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0}process(e){this._needsRender=!0}render(e){this._valueUV.copy(this._value);const t=e._bounds._offsetWidth,i=e._bounds._offsetHeight;if(this._units===Q1&&this._valueUV.divideScalar(100),this._units===tv&&this._valueUV.divideScalar(Math.min(t,i)),this._mediation)do this._sideMediators.forEach(o=>o.computeValue()),this._sideMediators.sort((o,a)=>o.value<a.value?1:-1),this._sideMediators[0].value>1&&this._sideMediators[0].mediate();while(this._sideMediators[0].value>1);let n=t>i?i/t:1,r=t<i?t/i:1;this._units===Q1&&(n=r=1),this._cornerTL.x=this._valueUV.x*n,this._cornerTL.y=1-this._valueUV.x*r,this._cornerTR.x=1-this._valueUV.y*n,this._cornerTR.y=1-this._valueUV.y*r,this._cornerBR.x=1-this._valueUV.z*n,this._cornerBR.y=this._valueUV.z*r,this._cornerBL.x=this._valueUV.w*n,this._cornerBL.y=this._valueUV.w*r}dispose(){for(const e of this._sideMediators)e.dispose();this._sideMediators=null,this._cornerTL=null,this._cornerTR=null,this._cornerBR=null,this._cornerBL=null,super.dispose()}set topLeft(e){this._input.x!==e&&(this._input.x=e,this._needsUpdate=!0)}get topLeft(){return this._input.x}set topRight(e){this._input.y!==e&&(this._input.y=e,this._needsUpdate=!0)}get topRight(){return this._input.y}set bottomRight(e){this._input.z!==e&&(this._input.z=e,this._needsUpdate=!0)}get bottomRight(){return this._input.z}set bottomLeft(e){this._input.w!==e&&(this._input.w=e,this._needsUpdate=!0)}get bottomLeft(){return this._input.w}set top(e){this._input.x===e&&this._input.y===e||(this._input.x=this._input.y=e,this._needsUpdate=!0)}get top(){return(this._input.x+this._input.y)/2}set right(e){this._input.y===e&&this._input.z===e||(this._input.y=this._input.z=e,this._needsUpdate=!0)}get right(){return(this._input.y+this._input.z)/2}set bottom(e){this._input.z===e&&this._input.w===e||(this._input.z=this._input.w=e,this._needsUpdate=!0)}get bottom(){return(this._input.z+this._input.w)/2}set left(e){this._input.w===e&&this._input.x===e||(this._input.w=this._input.x=e,this._needsUpdate=!0)}get left(){return(this._input.w+this._input.x)/2}}class Nw{constructor(e,t){this._borderRadiuses=e,this._sideProperties=t,this._complementaryMediation=null,this._value=0}get value(){return this._value}set complementaryMediation(e){this._complementaryMediation=e}computeValue(){let e=0;for(const t of this._sideProperties)e+=this._borderRadiuses[t];this._value=e}mediate(e=!0){if(!(this._value<1)){for(const t of this._sideProperties)this._borderRadiuses[t]/=this._value;e&&this._complementaryMediation.mediate(!1)}}dispose(){this._complementaryMediation=null,this._borderRadiuses=null}}class sne extends IM{constructor(e){super("borderWidth",e,!1),this._valueUV=this._value.clone(),this.output=this._outputValue,this._units=tv}set units(e){this._units=H6(e),this._needsUpdate=!0}get units(){return this._units}computeOutputValue(e){this._vector4ValueSetter(this._value,this._input),this._needsProcess=!0,e._bounds._needsUpdate=!0,e._layouter._needsUpdate=!0}_outputValue(e){e[this._id]=this._valueUV}process(e){this._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._valueUV.copy(this._value);const t=e._bounds._offsetWidth,i=e._bounds._offsetHeight;if(this._units===Q1&&(console.log("Percent"),console.log(this._valueUV)),this._units===tv)t!==0&&(this._valueUV.w/=t,this._valueUV.y/=t),i!==0&&(this._valueUV.x/=i,this._valueUV.z/=i);else if(this._units===G6){if(t!==0){const n=t>i?i/t:1;this._valueUV.y*=n,this._valueUV.w*=n}if(i!==0){const n=t<i?t/i:1;this._valueUV.x*=n,this._valueUV.z*=n}}}}class rne extends Ri{constructor(e,t=!0){super("visible",t,!0),this._needsUpdate=!1}update(e,t){e.visible=this._value,e._parent._value&&(e._parent._value._children._needsUpdate=!0)}set value(e){this.isValid(e)&&this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value}}class V6 extends F_{constructor(e){super("backgroundColor",e,!1),this._input="transparent",this._allowsInherit=!1}computeOutputValue(e){e._backgroundMesh.visible=!(this._input==="none"||this._input==="transparent"),this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._input==="transparent"||this._input==="none"||this._value.set(this._input)}}class xh extends Ri{constructor(e="untitled"){super(e,void 0,!1)}update(e,t){}output(e){}}class one extends Ri{constructor(){super("inlineJustificator",null,!1),this._value=null}update(e,t){}process(e){const t=e._bounds._innerHeight,i=e._layouter._value,n=Math.abs(i.height);let r=(()=>{switch(e._alignItems._value){case"inherit":case"start":return t/2;case"end":return n-t/2;case"stretch":case"center":return n/2}})();const o=e._padding._value,a=e._borderWidth._value;r+=(-o.x+o.z)/2+(-a.x+a.z)/2,i.forEach(l=>{l.y+=r,l.forEach(c=>{c.offsetY+=r})})}}const ane=["start","center","end","stretch"],lne=function(s){return ane.indexOf(s)===-1?(console.warn(`(.style) alignItems value '${s}' is not valid. Aborted`),!1):!0};class IL extends Cn{constructor(){super("alignItems","inherit",!0),this.isValidValue=lne}}class RL extends Cn{constructor(){super("textAlign","inherit",!0),this.isValidValue=hne}}const cne=["left","right","center","justify","justify-left","justify-right","justify-center"],hne=function(s){return cne.indexOf(s)===-1?(console.warn(`(.style) textAlign value '${s}' is not valid. Aborted`),!1):!0};class PL extends Cn{constructor(){super("flexDirection","inherit",!0),this.isValid=dne}}const une=["row","row-reverse","column","column-reverse"];function dne(s){return une.indexOf(s)===-1?(console.warn(`(.style) flexDirection value '${s}' is not valid. Aborted`),!1):!0}class BL extends Cn{constructor(){super("justifyContent","inherit",!0),this.isValidValue=pne}}const fne=["start","center","end","space-between","space-around","space-evenly"];function pne(s){return fne.indexOf(s)===-1?(console.warn(`(.style) justifyContent value '${s}' is not valid. Aborted`),!1):!0}class mne extends Cn{constructor(){super("order",0,!0),this._value=0,this._input=0,this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._parent._value&&(e._parent._value._children._needsProcess=!0)}}class Q6 extends Cn{constructor(){super("position","static",!0),this._allowsInherit=!1,this._value="static",this._needsUpdate=!1,this.computeOutputValue=this._computeFromInherited,this.isValidValue=yne}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value&&(e._parent._value._children._needsProcess=!0)}}const gne=["static","absolute"];function yne(s){return gne.indexOf(s)===-1?(console.warn(`(.style) position value '${s}' is not valid. Aborted`),!1):!0}class W6 extends Cn{constructor(e,t=null){super(e,t,!0),this._input="auto",this._auto=!0,this._relative=!1,this._updateRequired=!0}set inline(e){this.isValidValue(e)&&e!==this._inline&&(this._inline=e,this._input!==this._inline&&this._parseInput())}get inline(){return this._inline}_parseInput(){let e=!0;if(this._inline!==void 0&&this._inline!=="unset"?this._input=this._inline:this._computed!==void 0?(this._computed===this._input&&(e=!1),this._input=this._computed):e=this._input==="inherit",e){if(this._auto=!this._input||this._input==="auto",this._auto)this._relative=!1;else if((typeof this._input=="string"||this._input instanceof String)&&this._input.endsWith("%")){this._relative=!0,this._value=0;const t=parseFloat(this._input.replace("%","").trim());isNaN(t)||(this._value=t/100)}else this._relative=!1,this._value=this._input;this._needsUpdate=this._updateRequired=e}}update(e,t){if(this._updateRequired){this._updateRequired=!1,this._allowsInherit||(this._inheritedInput=this.getInheritedInput(e)),this.computeOutputValue(e);for(const i of e._children._uis)i[`_${this._id}`]._needsUpdate=!0;this.output(t),e._parent._value&&(e._parent._value._layouter._needsProcess=!0)}}computeOutputValue(e){e._bounds._needsUpdate=!0,e._renderer._needsRender=!0}getInheritedInput(e){if(this._input!=="inherit"&&!this._auto)return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}getDefaultValue(){return 0}get value(){return this._value}}class vne extends W6{constructor(){super("width")}}class Ane extends W6{constructor(){super("height")}computeOutputValue(e){super.computeOutputValue(e)}}class j6 extends xh{constructor(){super("textContent"),this._needsUpdate=!1}set value(e){}process(e){let t="";for(let i=0;i<e.children.length;i++){const n=e.children[i];n.isUI&&(t+=n.textContent)}this._value=t}}class q6 extends Cn{constructor(e){super("fontStyle",e,!0),this.isValidValue=bne}}const _ne=["normal","italic"];function bne(s){return _ne.indexOf(s)===-1?(console.warn(`(.style) fontStyle value '${s}' is not valid. Aborted`),!1):!0}class X6 extends Cn{constructor(){super("fontWeight","inherit",!0),this.isValid=wne}}const xne=["100","200","300","400","500","600","700","800","900","light","normal","bold","bolder"];function wne(s){return xne.indexOf(s.toString())===-1?(console.warn(`(.style) fontWeight value '${s}' is not valid. Aborted`),!1):!0}class Y6{constructor(){this._size=42,this._lineHeight=42,this._lineBase=38,this._name="-",this._charset=""}get size(){return this._size}get lineHeight(){return this._lineHeight}get lineBase(){return this._lineBase}get name(){return this._name}get charset(){return this._charset}}class Sne extends Y6{constructor(e){super(),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._name=e.info.face,this._textureWidth=e.common.scaleW,this._textureHeight=e.common.scaleH,this._charset=e.chars.map(t=>t.char).join("")}get textureWidth(){return this._textureWidth}get textureHeight(){return this._textureHeight}}class Cne extends z6{constructor(e){super(e)}get uv(){return this.typographic.uv}}class W1 extends N6{constructor(e,t){super(e),this._char=t.char,this._width=t.width,this._heigth=t.height,this._xadvance=t.xadvance?t.xadvance:this._width,this._xoffset=t.xoffset?t.xoffset:0,this._yoffset=t.yoffset?t.yoffset:0,this._uv=t.uv?t.uv:null,isNaN(t.x)||(this._uv={left:t.x/e.textureWidth,right:(t.x+t.width)/e.textureWidth,top:1-(t.y+t.height)/e.textureHeight,bottom:1-t.y/e.textureHeight})}get uv(){return this._uv}clone(e){return new W1(this._font,{char:e,width:this._width,height:this._heigth,xadvance:this._xadvance,xoffset:this._xoffset,yoffset:this._yoffset,uv:null})}asInlineGlyph(){return new Cne(this)}}class Ene extends qe.PlaneGeometry{constructor(e,t){let i=1,n=1;const r=e.typographic.font.size,o=t._segments.value;i=Math.ceil(e.typographic.width/r*o),n=Math.ceil(e.typographic.height/r*o),super(e.width,e.height,i,n),e.uv?(this._mapUVs(e),this._transformGeometry(e)):(this._nullifyUVs(),this.scale(0,0,1),this.translate(0,e.fontSize/2,0)),this.name="GlyphGeometry"}_mapUVs(e){const t=e.uv.right-e.uv.left,i=e.uv.bottom-e.uv.top,n=this.getAttribute("uv").array.slice(),r=[];for(let o=0;o<n.length;o+=2){const a=n[o],l=n[o+1];r.push(e.uv.left+t*a),r.push(e.uv.top+i*l)}this.setAttribute("uvG",new qe.BufferAttribute(new Float32Array(r),2))}_nullifyUVs(){const e=[],t=this.getAttribute("uv").array.length;for(let i=0;i<t;i++)e.push(0);this.setAttribute("uvG",new qe.BufferAttribute(new Float32Array(e),2))}_transformGeometry(e){this.translate(e.width/2,-e.height/2,0)}}const Mne=`
attribute vec2 uvG;
varying vec2 vUvG;
`,DL=Mne,Tne=`
vUvG = uvG;
`,OL=Tne,Ine=`
gl_Position.z -= 0.00001;
`,LL=Ine,Rne=`
varying vec2 vUvG;
uniform sampler2D glyphMap;
uniform vec2 unitRange;
// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field
float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}
float screenPxRange() {

	// precomputed unitRange as recommended by Chlumsky
	// vec2 unitRange = vec2(pxRange)/vec2(textureSize(glyphMap, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUvG);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}
float tap(vec2 offsetUV) {
	vec3 msd = texture( glyphMap, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}
`,kL=Rne,Pne=`
	float alpha;
#ifdef NO_RGSS

	alpha = tap( vUvG );

#else

	// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
	// per pixel partial derivatives
	vec2 dx = dFdx(vUvG);
	vec2 dy = dFdy(vUvG);
	// rotated grid uv offsets
	vec2 uvOffsets = vec2(0.125, 0.375);
	vec2 offsetUV = vec2(0.0, 0.0);
	// supersampled using 2x2 rotated grid
	alpha = 0.0;
	offsetUV.xy = vUvG + uvOffsets.x * dx + uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.x * dx - uvOffsets.y * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG + uvOffsets.y * dx - uvOffsets.x * dy;
	alpha += tap(offsetUV);
	offsetUV.xy = vUvG - uvOffsets.y * dx + uvOffsets.x * dy;
	alpha += tap(offsetUV);
	alpha *= 0.25;

#endif

	alpha = clamp( alpha, 0.0, 1.0 );

#ifdef INVERT_ALPHA

	alpha = 1.0 - alpha;

#endif

	diffuseColor.a *= alpha;
`,FL=Pne,RM=function(s,e,t){s.alphaTest=t,UL(s,"USE_ALPHATEST",t>0)},UL=function(s,e,t){s.defines&&(t?s.defines[e]===void 0&&(s.defines[e]="",s.needsUpdate=!0):s.defines[e]!==void 0&&(delete s.defines[e],s.needsUpdate=!0))},K6=function(s,e,t){s.defines[e]&&s.defines[e]===t||(s.defines[e]=t,s.needsUpdate=!0)},Ha=function(s,e,t){s.userData[e]?s.userData[e].value=t:s.uniforms[e].value=t},Bne=function(s,e,t){s.userData[e].value=t};class Wa{static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,t){e.userData.glyphMap={value:t.glyphMap},e.userData.unitRange={value:new qe.Vector2}}static bindUniformsWithUserData(e,t){e.uniforms.glyphMap=t.userData.glyphMap,e.uniforms.unitRange=t.userData.unitRange}static injectShaderChunks(e){Wa.injectVertexShaderChunks(e),Wa.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+DL),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+OL),e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
`+LL)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <uv_pars_fragment>",`#include <uv_pars_fragment>
`+kL),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",`#include <alphamap_fragment>
`+FL)}static from(e){return class extends e{constructor(i={}){Wa.ensureMaterialOptions(i);super(i);d(this,"_cumulativeOnBeforeCompile",i=>{Wa.bindUniformsWithUserData(i,this),Wa.injectShaderChunks(i),this._userDefinedOnBeforeCompile(i)});Wa.ensureDefines(this),Wa.ensureUserData(this,i),this._userDefinedOnBeforeCompile=n=>{},this._onBeforeCompile=this._cumulativeOnBeforeCompile}static get fontMaterialProperties(){return Wa.mediation}set onBeforeCompile(i){this._userDefinedOnBeforeCompile=i}get onBeforeCompile(){return this._onBeforeCompile}}}static get mediation(){return Lne}}const Dne=function(s,e,t){const i=t?t.texture:null,n=t?t.unitRange:new qe.Vector2;if(s[e]!==void 0){s.glyphMap=i,s.unitRange=n;return}s.userData&&s.userData.glyphMap&&(s.userData.glyphMap.value=i,s.userData.unitRange.value=n)},One=function(s,e,t){t&&t!=="antialiased"?s.defines.NO_RGSS="":delete s.defines.NO_RGSS,s.needsUpdate=!0},Lne={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:RM},fontSide:{m:"side"},font:{m:"glyphMap",t:Dne},color:{m:"color"},fontOpacity:{m:"opacity"},fontSmooth:{m:"NO_RGSS",t:One},invertAlpha:{m:"INVERT_ALPHA",t:UL}},kne=`
${DL}
#include <clipping_planes_pars_vertex>
void main() {
	${OL}
	#include <begin_vertex>
	#include <project_vertex>
	${LL}
	#include <clipping_planes_vertex>
}
`,Fne=`
uniform vec3 diffuse;
uniform float opacity;
${kL}
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	// instead of <color_fragment> : vec4 diffuseColor
	vec4 diffuseColor = vec4( diffuse, opacity );
	${FL}
	#include <alphatest_fragment>
	// instead of <output_fragment>
	gl_FragColor = diffuseColor;
	#include <clipping_planes_fragment>
}
`,Une=.02;class NL extends qe.ShaderMaterial{static get mediation(){return Wa.mediation}constructor(e={}){super({uniforms:{glyphMap:{value:null},diffuse:{value:null},opacity:{value:1},unitRange:{value:new qe.Vector2(0,0)},alphaTest:{value:Une}},transparent:!0,clipping:!0,vertexShader:kne,fragmentShader:Fne,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0,this.noRGSS=e.noRGSS||!1}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get unitRange(){return this.uniforms.unitRange.value}set unitRange(e){this.uniforms.unitRange.value.copy(e)}get glyphMap(){return this.uniforms.glyphMap.value}set glyphMap(e){this.uniforms.glyphMap.value=e}get isDefault(){return this.constructor===NL}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}}class Nne extends Ub{constructor(e,t,i,n){if(super(e,t),this._unitRange=new qe.Vector2(1,1),i.pages?this._buildData(i):zne(this,i),n instanceof qe.Texture)this._texture=n,this._buildTexture(n);else if(typeof n=="string"||n instanceof String)Gne(this,n);else throw new Error(`ThreeMeshUI::MSDFVariant provided 'texture' parameter is '${typeof n}'. Only Texture and String allowed.`);this._defaultMaterialClass=NL,this._checkReadiness()}get texture(){return this._texture}get unitRange(){return this._unitRange}set fontMaterial(e){this._defaultMaterialClass=e}get fontMaterial(){return this._defaultMaterialClass}_buildData(e){this._font=new Sne(e),this._kernings=this._buildKerningPairs(e),this._chars=this._buildCharacters(e),this._chars[" "]=this._buildCharacterWhite(e),this._chars[`
`]=this._buildCharacterWhite(e,`
`,.001,1),this._chars["	"]=this._buildCharacterWhite(e,"	",4,1),this._size=e.info.size,this._lineHeight=e.common.lineHeight,this._lineBase=e.common.base,this._distanceRange=e.distanceField.distanceRange,this._unitRange=new qe.Vector2(this._distanceRange,this._distanceRange).divide(new qe.Vector2(e.common.scaleW,e.common.scaleH))}_buildTexture(e){e.generateMipmaps=!1,e.minFilter=qe.LinearFilter,e.magFilter=qe.LinearFilter,e.needsUpdate=!0}_getFallbackCharacter(e){return sm.missingCharacter(this,e)}getGeometricGlyph(e,t){return new Ene(e,t)}_readyCondition(){return this._chars&&this._texture&&this._texture.image}_buildKerningPairs(e){const t={};for(let i=0;i<e.kernings.length;i++){const n=e.kernings[i];if(n.amount===0)continue;const r=String.fromCharCode(n.first,n.second);t[r]=n.amount}return t}_buildCharacters(e){const t={};for(let i=0;i<e.chars.length;i++){const n=e.chars[i];t[n.char]=new W1(this._font,n)}return t}_buildCharacterWhite(e,t=" ",i=1,n=1){return new W1(this._font,{char:t,width:e.info.size/3*i,height:e.info.size*.7*n})}_alterElementProperties(e){}}function zne(s,e){new qe.FileLoader().setResponseType("json").load(e,t=>{s._buildData(t),s._checkReadiness()})}function Gne(s,e){s._texture=new qe.TextureLoader().load(e,t=>{s._buildTexture(t),s._checkReadiness()})}class PM extends qe.EventDispatcher{constructor(t){super();d(this,"_checkReadiness",()=>{this._variants.every(t=>t.isReady)&&Vne(this)});this._name=t,this._variants=[],this._isReady=!1}get isReady(){return this._isReady}addVariant(t,i,n,r,o=!1){if(o||!this.getVariant(t,i)){this._isReady=!1;const a=new Nne(t,i,n,r);this._variants.push(a),a.isReady?this._checkReadiness():a.addEventListener("ready",this._checkReadiness)}else console.warn(`FontFamily('${this._name}')::addVariant() - Variant(${t}, ${i}) already exists.`);return this}addCustomImplementationVariant(t,i=!1){return i||!this.getVariant(t.weight,t.style)?(this._isReady=!1,this._variants.push(t),t.isReady?this._checkReadiness():t.addEventListener("ready",this._checkReadiness)):console.warn(`FontFamily('${this._name}')::addCustomImplementationVariant() - Variant(${t.weight}, ${t.style}) already exists.`),this}getVariant(t,i){return t=TL(t),this._variants.find(n=>n.weight===t&&n.style===i)}get name(){return this._name}}const Hne={type:"ready"};function Vne(s){s._isReady=!0,s.dispatchEvent(Hne)}const YC={},Qne=function(s){const e=[...arguments];e.forEach(i=>{if(!(i instanceof PM))throw new Error(`FontLibrary::prepare() - One of the provided parameter is not a FontFamily. Instead ${typeof i} given.`)});const t=function(){return e.every(i=>i.isReady)};return new Promise((i,n)=>{if(t())i();else for(let r=0;r<e.length;r++){const o=e[r];o.isReady||o.addEventListener("ready",()=>{t()&&i()})}})},Wne=function(s){return YC[s]&&console.error(`FontLibrary::addFontFamily - Font('${s}') is already registered`),YC[s]=new PM(s),YC[s]},jne=function(s){return YC[s]},qne=function(s){J6=s};let J6=function(s,e){return console.error(`The character '${e}' is not included in the font characters set.`)," "};function Xne(s,e){return J6(s,e)}const Yne={addFontFamily:Wne,getFontFamily:jne,prepare:Qne,setMissingCharacterHandler:qne,missingCharacter:Xne},sm=Yne;class Z6 extends Cn{constructor(){super("fontFamily","inherit",!0)}computeOutputValue(e){if(this._input instanceof PM)this._value=this._input;else if(this._input!=="inherit")if(typeof this._input=="string"){const t=sm.getFontFamily(this._input);t?this._value=t:console.warn(`(.style) fontFamily, the font '${this._input}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}getInheritedInput(e){if(this._input!=="inherit")return this._input;const t=e._parent._value;return t?t[`_${this._id}`].getInheritedInput(t):this.getDefaultValue()}}class $6 extends Cn{constructor(){super("lineHeight","inherit",!0)}update(e,t){super.update(e,t),e._layouter._needsProcess=!0}}class eQ extends Cn{constructor(){super("whiteSpace","inherit"),this.isValidValue=Jne}}const Kne=["normal","nowrap","pre","pre-line","pre-wrap"];function Jne(s){return Kne.indexOf(s)===-1?(console.warn(`(.style) whiteSpace value '${s}' is not valid. Aborted`),!1):!0}class tQ extends Cn{constructor(){super("letterSpacing","inherit",!0)}}class Zne extends Cn{constructor(){super("fontSize","inherit",!0)}}class iQ extends Ri{constructor(){super("segments",1,!1)}}class $ne extends pm{constructor(){super("invertAlpha","inherit")}}class BM extends Cn{constructor(){super("fontKerning","inherit"),this.isValidValue=tse}}const ese=["normal","none","inherit"];function tse(s){return ese.indexOf(s)===-1?(console.warn(`(.style) fontKerning value '${s}' is not valid. Aborted`),!1):!0}class zw extends pm{constructor(e){super(e,"inherit",!0)}}class RN extends pm{constructor(e){super(e,"inherit",!1),this._mediation={},this._defaultMaterial=null}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"?this._notInheritedValue=this.getInheritedInput(e):this.propagate(e),this._notInheritedValue?this._notInheritedValue.constructor.mediation?this._mediation={...this._notInheritedValue.constructor.mediation}:this._mediation={clippingPlanes:{m:"clippingPlanes"},fontAlphaTest:{m:"alphaTest",t:RM},fontSide:{m:"side"},color:{m:"color"},fontOpacity:{m:"opacity"}}:this._mediation={},e._transferToFontMaterial(),this._outputValue(t)}getInheritedInput(e){if(this._value!=="inherit")return this._value;let t=e,i=null;for(;t._parent._value;)if(t=t._parent._value,t[`_${this._id}`]._value!=="inherit"){i=t[`_${this._id}`]._value;break}return i!==null?i:this.getDefaultValue()}getDefaultValue(){return this._defaultMaterial}}const ise=function(s,e,t){s.traverse(i=>{i.renderOrder=t})};class Nb extends qe.Object3D{constructor(t,i){super();d(this,"_rebuildParentUI",()=>{this._parent._needsUpdate=!0,this.parent&&!this.parent.isUI?(j1.register(this),this.activatePseudoState("root")):(j1.remove(this),this.deactivatePseudoState("root"))});Object.defineProperties(this,{isUI:{configurable:!1,enumerable:!0,value:!0}}),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundCustomDepthMaterial=null,this._backgroundMaterialMediation={},this._backgroundMeshMediation={backgroundCastShadow:{m:"castShadow"},backgroundReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder",t:ise}},this._fontMesh=null,this._fontMaterial=new RN("fontMaterial"),this._fontCustomDepthMaterial=new RN("fontCustomDepthMaterial"),this._fontMeshMediation={fontMaterial:{m:"material"},fontCustomDepthMaterial:{m:"customDepthMaterial",t:Rie},fontCastShadow:{m:"castShadow"},fontReceiveShadow:{m:"receiveShadow"},renderOrder:{m:"renderOrder"}},this._children=t.children?new t.children:new xh("children"),this._parent=new Pie,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI),this._backgroundSide=new IN("backgroundSide"),this._fontSide=new IN("fontSide"),this._backgroundAlphaTest=new TN("backgroundAlphaTest",.02),this._fontAlphaTest=new TN("fontAlphaTest",.02),this._visible=new rne("visible",!0),this._backgroundCastShadow=new zw("backgroundCastShadow"),this._fontCastShadow=new zw("fontCastShadow"),this._backgroundReceiveShadow=new zw("backgroundReceiveShadow"),this._fontReceiveShadow=new zw("fontReceiveShadow"),this._renderOrder=new xie,this._segments=t.segments?new t.segments:new iQ,this._bounds=t.bounds?new t.bounds:new xh("bounds"),this._order=new mne,this._padding=new Tie,this._margin=new Iie,this._position=new Q6,this._flexDirection=t.flexDirection?new t.flexDirection:new PL,this._justifyContent=t.justifyContent?new t.justifyContent:new BL,this._alignItems=t.alignItems?new t.alignItems:new IL,this._display=new Gie("flex"),this._boxSizing=new Qie("border-box"),this._width=new vne,this._height=new Ane,this._backgroundColor=t.backgroundColor?new t.backgroundColor:new V6,this._backgroundOpacity=new jI("backgroundOpacity",.5),this._backgroundImage=new Xie,this._backgroundSize=new Kie("cover"),this._color=t.color?new t.color:new F_("color","inherit"),this._fontOpacity=new jI("fontOpacity","inherit"),this._whiteSpace=t.whiteSpace?new t.whiteSpace:new eQ,this._fontFamily=t.fontFamily?new t.fontFamily:new Z6,this._fontStyle=t.fontStyle?new t.fontStyle:new q6("normal"),this._fontWeight=t.fontWeight?new t.fontWeight:new X6,this._fontSize=t.fontSize?new t.fontSize:new Zne,this._lineHeight=t.lineHeight?new t.lineHeight:new $6,this._fontKerning=t.fontKerning?new t.fontKerning:new BM,this._letterSpacing=t.letterSpacing?new t.letterSpacing:new tQ,this._overflow=new $ie("visible"),this._borderRadius=new nne(0),this._borderWidth=new sne(0),this._borderColor=new F_("borderColor",16711935),this._borderOpacity=new jI("borderOpacity",1),this._font=new Uie,this._lineBreak=t.lineBreak?new t.lineBreak:new xh("lineBreak"),this._textContent=t.textContent?new t.textContent:new j6,this._glyphs=t.glyphs?new t.glyphs:new xh("glyphs"),this._inlines=t.inlines?new t.inlines:new xh("inlines"),this._layouter=t.layouter?new t.layouter:new xh("layouter"),this._inlineJustificator=new one,this._textAlign=t.textAlign?new t.textAlign:new RL,this._autoSize=t.autoSize?new t.autoSize:new xh("autoSize"),this._renderer=t.renderer?new t.renderer:new xh("renderer"),this._offset=new wie,this._invertAlpha=new $ne,this._fontSmooth=t.fontSmooth?new t.fontSmooth:new Sie,this._components=[this._textContent,this._children,this._parent,this._autoSize,this._fontFamily,this._fontStyle,this._fontWeight,this._font,this._whiteSpace,this._glyphs,this._inlines,this._visible,this._backgroundSide,this._fontSide,this._backgroundAlphaTest,this._fontAlphaTest,this._backgroundCastShadow,this._fontCastShadow,this._backgroundReceiveShadow,this._fontReceiveShadow,this._renderOrder,this._segments,this._padding,this._margin,this._width,this._height,this._borderWidth,this._boxSizing,this._bounds,this._position,this._flexDirection,this._justifyContent,this._alignItems,this._order,this._display,this._backgroundColor,this._backgroundOpacity,this._backgroundImage,this._backgroundSize,this._fontOpacity,this._color,this._fontSize,this._lineHeight,this._fontKerning,this._letterSpacing,this._borderRadius,this._borderColor,this._borderOpacity,this._lineBreak,this._offset,this._layouter,this._inlineJustificator,this._textAlign,this._invertAlpha,this._fontSmooth,this._fontMaterial,this._fontCustomDepthMaterial,this._overflow,this._renderer],this._onAfterUpdates=[],i.backgroundSide||(i.backgroundSide=0),i&&this.set(i)}update(){const t={};for(const i of this._components)i._needsUpdate&&(i.update(this,t),i._needsUpdate=!1);this._transferToBackgroundMesh(t),this._transferToFontMesh(t),this._transferToBackgroundMaterial(t),this._transferToFontMaterial(t);for(const i of this._children._uis)i.update()}process(){for(const t of this._children._uis)t.process();for(const t of this._components)t._needsProcess&&(t.process(this),t._needsProcess=!1)}render(){for(let t=0;t<this._components.length;t++){const i=this._components[t];i._needsRender&&(i.render(this),i._needsRender=!1)}for(const t of this._children._uis)t.render()}set(t){if(t.fontTexture&&(console.warn("ThreeMeshUI::set( {fontTexture} ) is deprecated. Please use fontLibrary to register font families and variants."),t.fontFamily)){const i=t.fontFamily.pages?t.fontFamily.info.face:t.fontFamily;let n=sm.getFontFamily(i);if(!n){const r=t.fontStyle?t.fontStyle:"normal",o=t.fontWeight?t.fontWeight:"400";n=sm.addFontFamily(i).addVariant(o,r,t.fontFamily,t.fontTexture)}t.fontFamily=n,delete t.fontTexture}for(let i of Object.keys(t)){const n=t[i];switch(i){case"contentDirection":console.warn("ThreeMeshUI v7xx: property `contentDirection` is deprecated and has been renamed as `flexDirection`"),i="flexDirection";break;case"interLine":console.warn("ThreeMeshUI v7xx: property `interLine` is deprecated and has been renamed as `lineHeight`"),i="lineHeight";break;case"content":console.warn("ThreeMeshUI v7xx: property `content` is deprecated and has been renamed as `textContent`"),i="textContent";break;case"fontColor":console.warn("ThreeMeshUI v7xx: property `fontColor` is deprecated and has been renamed as `color`"),i="color";break;case"hiddenOverflow":console.warn("ThreeMeshUI v7xx: property `hiddenOverflow` is deprecated and has been renamed as `overflow`"),i="overflow";break;case"backgroundTexture":console.warn("ThreeMeshUI v7xx: property `backgroundTexture` is deprecated and has been renamed as `backgroundImage`"),i="backgroundImage";break;case"alignContent":console.warn("ThreeMeshUI v7xx: property `alignContent` is deprecated and has been renamed as `alignItems`"),i="alignItems";break;case"borderTopColor":case"borderBottomColor":case"borderLeftColor":case"borderRightColor":i="borderColor";break}switch(i){case"fontSmooth":case"renderOrder":case"segments":case"visible":case"offset":this[`_${i}`].value=n;break;case"flexDirection":case"justifyContent":case"alignItems":case"color":case"fontFamily":case"fontOpacity":case"fontKerning":case"fontSize":case"fontStyle":case"fontWeight":case"textAlign":case"letterSpacing":case"lineHeight":case"whiteSpace":case"breakOn":case"width":case"height":case"padding":case"margin":case"backgroundColor":case"backgroundOpacity":case"backgroundImage":case"backgroundSize":case"borderColor":case"borderOpacity":case"borderRadius":case"borderWidth":case"overflow":case"order":case"boxSizing":this[`_${i}`]&&(this[`_${i}`].inline=n);break;case"paddingTop":this._padding.top=n;break;case"paddingRight":this._padding.right=n;break;case"paddingBottom":this._padding.bottom=n;break;case"paddingLeft":this._padding.left=n;break;case"marginTop":this._margin.top=n;break;case"marginRight":this._margin.right=n;break;case"marginBottom":this._margin.bottom=n;break;case"marginLeft":this._margin.left=n;break;case"borderTopWidth":this._borderWidth.top=n;break;case"borderRightWidth":this._borderWidth.right=n;break;case"borderBottomWidth":this._borderWidth.bottom=n;break;case"borderLeftWidth":this._borderWidth.left=n;break;case"borderTopLeftRadius":this._borderRadius.topLeft=n;break;case"borderTopRightRadius":this._borderRadius.topRight=n;break;case"borderBottomRightRadius":this._borderRadius.bottomRight=n;break;case"borderBottomLeftRadius":this._borderRadius.bottomLeft=n;break;case"side":case"castShadow":case"receiveShadow":const r=i.charAt(0).toUpperCase()+i.substr(1);this[`_background${r}`].value=n,this[`_font${r}`].value=n;break;case"fontSide":case"backgroundSide":case"fontCastShadow":case"backgroundCastShadow":case"fontReceiveShadow":case"backgroundReceiveShadow":case"fontMaterial":case"fontCustomDepthMaterial":this[`_${i}`].value=n;break;default:this[`_${i}`]!==void 0?this[`_${i}`].value=n:this[i]=n}}}get(t){switch(t){case"overflow":case"width":case"height":return this[`_${t}`].inline}}_rebuildChildrenLists(){this._children._needsUpdate=!0}add(t){let i=!1;for(let n=0;n<arguments.length;n++)super.add(arguments[n]),arguments[n].isUI&&(i=!0);return i&&this._rebuildChildrenLists(),this}remove(t){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);return super.remove(...arguments),this._rebuildChildrenLists(),this}clear(){return this.removeFromParent(),this.traverse(t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose()}),super.clear(),this._backgroundMesh=null,this._backgroundMaterial=null,this._backgroundMaterialMediation=null,this._backgroundMeshMediation=null,this._children.dispose(),this._children=null,this._parent.dispose(),this._parent=null,this._backgroundSide=null,this._backgroundAlphaTest=null,this._visible=null,this._backgroundCastShadow=null,this._backgroundReceiveShadow=null,this._renderOrder=null,this._segments=null,this._bounds=null,this._boxSizing=null,this._padding=null,this._margin=null,this._position=null,this._flexDirection=null,this._justifyContent=null,this._alignItems=null,this._display=null,this._backgroundColor=null,this._backgroundOpacity=null,this._backgroundSize=null,this._fontOpacity=null,this._color=null,this._whiteSpace=null,this._fontFamily=null,this._fontStyle=null,this._fontWeight=null,this._lineHeight=null,this._fontKerning=null,this._letterSpacing=null,this._overflow=null,this._textAlign=null,this._font=null,this._lineBreak=null,this._layouter=null,this}get textContent(){return this._textContent.process(this),this._textContent._value}get backgroundMaterial(){return this._backgroundMaterial}set backgroundMaterial(t){this._backgroundMaterial=t,this._backgroundMaterialMediation={...t.constructor.mediation},this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.material=this._backgroundMaterial,Ha(t,"frameSize",this._backgroundMesh.scale))}set backgroundCustomDepthMaterial(t){this._backgroundCustomDepthMaterial=t,this._transferToBackgroundMaterial(),this._backgroundMesh&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial)}get backgroundCustomDepthMaterial(){return this._backgroundCustomDepthMaterial}_transferToBackgroundMaterial(t=null){if(!t){t={};for(const i of this._components)i.output(t)}Uw.mediate(this,this._backgroundMaterial,t,this._backgroundMaterialMediation,this._backgroundCustomDepthMaterial)}set backgroundSide(t){this._backgroundSide.value=t,this._backgroundMaterial&&(this._backgroundMaterial.side=t)}get backgroundSide(){return this._backgroundSide.value}set backgroundAlphaTest(t){this._backgroundAlphaTest.value=t,this._backgroundMaterial&&(this._backgroundMaterial.alphaTest=t)}get backgroundAlphaTest(){return this._backgroundAlphaTest.value}get fontMaterial(){return this._fontMaterial.value}set fontMaterial(t){this._fontMaterial.value=t}set fontCustomDepthMaterial(t){this._fontCustomDepthMaterial.value=t}get fontCustomDepthMaterial(){return this._fontCustomDepthMaterial.value}_transferToFontMaterial(t=null){const i=this._fontMaterial.value;if(i){if(!t){t={};for(const n of this._components)n.output(t)}Uw.mediate(this,i,t,this._fontMaterial._mediation,this._fontCustomDepthMaterial.value)}}set fontSide(t){this._fontSide.value=t}get fontSide(){return this._fontSide.value}set fontAlphaTest(t){this._fontAlphaTest.value=t}get fontAlphaTest(){return this._fontAlphaTest.value}_transferToBackgroundMesh(t=null){if(!t){t={};for(const i of this._components)i.output(t)}Uw.mediate(this,this._backgroundMesh,t,this._backgroundMeshMediation)}setBackgroundMesh(t){this._backgroundMesh&&(this.remove(this._backgroundMesh),this.unbindBackgroundMeshProperties()),this._backgroundMesh=t,this._backgroundMesh&&(this.bindBackgroundMeshProperties(),this._backgroundCustomDepthMaterial&&(this._backgroundMesh.customDepthMaterial=this._backgroundCustomDepthMaterial),this._backgroundMaterial&&Ha(this._backgroundMaterial,"frameSize",this._backgroundMesh.scale),this._transferToBackgroundMesh(),this.add(this._backgroundMesh))}bindBackgroundMeshProperties(){}unbindBackgroundMeshProperties(){}activatePseudoState(t){}deactivatePseudoState(t){}togglePseudoState(t){}hasPseudoState(t){return!1}set borderRadiusMediation(t){this._borderRadius.mediation=t}set backgroundCastShadow(t){this._backgroundCastShadow&&(this._backgroundCastShadow.value=t)}get backgroundCastShadow(){return this._backgroundCastShadow}set backgroundReceiveShadow(t){this._backgroundReceiveShadow&&(this._backgroundReceiveShadow.value=t)}get backgroundReceiveShadow(){return this._backgroundReceiveShadow}set renderOrder(t){this._renderOrder&&(this._renderOrder.value=t)}get renderOrder(){return this._renderOrder.value}_transferToFontMesh(t=null){if(this._fontMesh){if(!t){t={};for(const i of this._components)i.output(t)}Uw.mediate(this,this._fontMesh,t,this._fontMeshMediation)}}setFontMesh(t){this._fontMesh&&(this.remove(this._fontMesh),this._fontMesh.material&&this._fontMesh.material.dispose(),this._fontMesh.geometry&&this._fontMesh.geometry.dispose(),this._fontMesh=null,this.unbindFontMeshProperties()),this._fontMesh=t,this._fontMesh&&(this._fontMesh.raycast=()=>{},this.bindFontMeshProperties(),this._transferToFontMaterial(),this._transferToFontMesh(),this.add(this._fontMesh))}bindFontMeshProperties(){}unbindFontMeshProperties(){}set fontCastShadow(t){this._fontCastShadow&&(this._fontCastShadow.value=t)}get fontCastShadow(){return this._fontCastShadow}set fontReceiveShadow(t){this._fontReceiveShadow&&(this._fontReceiveShadow.value=t)}get fontReceiveShadow(){return this._fontReceiveShadow}set segments(t){this._segments.value=t}get segments(){return this._segments.value}set onAfterUpdate(t){console.warn("ThreeMeshUI v7xx : `onAfterUpdate()` property has been deprecated, please rely on `addAfterUpdate` instead."),this.addAfterUpdate(t)}addAfterUpdate(t){this._onAfterUpdates.push(t)}removeAfterUpdate(t){const i=this._onAfterUpdates.indexOf(t);i!==-1&&this._onAfterUpdates.splice(i,1)}performAfterUpdate(){for(let t=0;t<this._onAfterUpdates.length;t++)this._onAfterUpdates[t]()}getProperty(t){return this[`_${t}`]?this[`_${t}`]:null}appendProperty(t,i){this[`_${t}`]=i,this._components.push(i)}replaceProperty(t,i){const n=this[`_${t}`],r=this._components.indexOf(n);return this._components[r]=this[`_${t}`]=i,i.needsUpdate=!0,n}}class j1{static register(e){this.elements.includes(e)||this.elements.push(e)}static remove(e){const t=this.elements.indexOf(e);t!==-1&&this.elements.splice(t,1)}static update(){for(const e of this.elements)e.update(),e.process(),e.process(),e.render()}}j1.elements=[];const nse=`

// FrameBorder vertex pars
attribute vec2 uvB;
varying vec2 vUvB;

`,zL=nse,sse=`

	// FrameBorder vertex shader
	vUvB = uvB;

`,GL=sse,rse=`

// borders sequences are : x:TOP, y:RIGHT, z:BOTTOM, w:LEFT
uniform vec4 borderWidth;
uniform vec3 borderColor;
uniform float borderOpacity;
uniform vec4 borderRadius;

uniform vec2 cornerTL;
uniform vec2 cornerTR;
uniform vec2 cornerBR;
uniform vec2 cornerBL;

varying vec2 vUvB;

float getEllipticFactor( vec2 uv, vec2 center, float radiusX, float radiusY )
{

		float edx = uv.x - center.x;
		float edy = uv.y - center.y;

		float ddx = (edx * edx) / (radiusX * radiusX);
		float ddy = (edy * edy) / (radiusY * radiusY);

		return ddx + ddy;

}

`,HL=rse,ose=`

vec4 borderColor = vec4( borderColor, borderOpacity );

// This could be tweak to produce more smoothing
float mult = 1.0;

// Step 1 ----------------------------------------------
// Draw the four borders ( top - right - bottom - left )
// Without worrying about radiuses ( Straight boorders )

// Top
float topBorderUVy = 1.0 - borderWidth.x;
if( borderWidth.x > 0.0 && vUvB.y > topBorderUVy )
{

	float w = fwidth( 1.0 - vUvB.y ) * mult;
	float step = smoothstep( topBorderUVy , topBorderUVy + w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Left
float leftBorderUVx = borderWidth.w;
if( borderWidth.w > 0.0 && vUvB.x < leftBorderUVx )
{

	float w = fwidth( vUvB.x ) * mult ;
	float step = smoothstep( leftBorderUVx , leftBorderUVx - w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );

}

// Bottom
float bottomBorderUVy = borderWidth.z;
if( borderWidth.z > 0.0 && vUvB.y < bottomBorderUVy )
{
	float w = fwidth( vUvB.y ) * mult;
	float step = smoothstep( bottomBorderUVy , bottomBorderUVy - w , vUvB.y );
	diffuseColor = mix( diffuseColor, borderColor, step );
}

// Right
float rightBorderUVx = 1.0 - borderWidth.y;
if( borderWidth.y > 0.0 && vUvB.x > rightBorderUVx )
{
	float w = fwidth( 1.0 - vUvB.x ) * mult;
	float step = smoothstep( rightBorderUVx , rightBorderUVx + w , vUvB.x );
	diffuseColor = mix( diffuseColor, borderColor, step );
}


// Step 2 ----------------------------------------------
// Process each corners ( topLeft, topRight, bottomRight, bottomLeft )
// To transparentize outside radiuses
// To draw ellipse border on the corner


// Top Left corner
if( vUvB.x < cornerTL.x && vUvB.y > cornerTL.y ) {

		// Only draw border if width is set
		if( borderWidth.w + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x - borderWidth.w,  ( 1.0 - cornerTL.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		// Then then radius
		float radiusFactor = getEllipticFactor( vUvB, cornerTL, cornerTL.x, 1.0 - cornerTL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Left
if( vUvB.x < cornerBL.x && vUvB.y < cornerBL.y ) {

		if( borderWidth.w + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x - borderWidth.w,  cornerBL.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}


		float radiusFactor = getEllipticFactor( vUvB, cornerBL, cornerBL.x, cornerBL.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Top Right
if( vUvB.x > cornerTR.x && vUvB.y > cornerTR.y ) {

		if( borderWidth.y + borderWidth.x > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerTR, ( 1.0 - cornerTR.x ) - borderWidth.y,  ( 1.0 - cornerTR.y ) - borderWidth.x );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerTR, 1.0 - cornerTR.x, 1.0 - cornerTR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}
// Bottom Right
if( vUvB.x > cornerBR.x && vUvB.y < cornerBR.y ) {

		if( borderWidth.y + borderWidth.z > 0.0 ){

			float borderFactor = getEllipticFactor( vUvB, cornerBR, ( 1.0 - cornerBR.x ) - borderWidth.y,  cornerBR.y - borderWidth.z );
			float step = smoothstep( 1.0, 1.0 + fwidth( borderFactor ) * mult, borderFactor );
			diffuseColor = mix( diffuseColor, borderColor, step );

		}

		float radiusFactor = getEllipticFactor( vUvB, cornerBR, 1.0 - cornerBR.x, cornerBR.y );
		float alphaStep = smoothstep( 1.0 , 1.0 + fwidth(radiusFactor) * mult , radiusFactor );
		diffuseColor.a = mix( diffuseColor.a, 0.0, alphaStep );

}

`,VL=ose,ase=`

// To be removed - required for both border and background
uniform vec3 frameSize;
uniform vec2 textureSize;

`,QL=ase,lse=`

#ifdef USE_MAP

vec4 sampleTexture() {

	vec2 uv = vUv;

	// default stretch
	#if BACKGROUND_MAPPING != 0

	float textureRatio = textureSize.x / textureSize.y;
	float panelRatio = frameSize.x / frameSize.y;
	float ratio = panelRatio / textureRatio;
	float ratio2 = textureRatio / panelRatio;

		// contain
		#if BACKGROUND_MAPPING == 1
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		}
		#else
		// cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ratio2;
			newY += 0.5 - 0.5 * ratio2;
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ratio;
			newX += 0.5 - 0.5 * ratio;
			uv.x = newX;
		}

		#endif

	#endif

	return texture2D( map, uv );

}
#endif
`,WL=lse,cse=`
#ifdef USE_MAP

	vec4 textureSample = sampleTexture();
	diffuseColor *= textureSample;

#endif
`,jL=cse,nQ={msdfAlphaglyphParsVertexGlsl:DL,msdfAlphaglyphVertexGlsl:OL,msdfOffsetglyphVertexGlsl:LL,msdfAlphaglyphParsFragmentGlsl:kL,msdfAlphaglyphFragmentGlsl:FL,frameBorderParsVertexGlsl:zL,frameBorderVertexGlsl:GL,frameCommonParsFragmentGlsl:QL,frameBorderParsFragmentGlsl:HL,frameBorderFragmentGlsl:VL,frameBackgroundParsFragmentGlsl:WL,frameBackgroundFragmentGlsl:jL},hse=`
// Would be automatic on three materials and from USE_UV
#ifdef USE_MAP
varying vec2 vUv;
#endif

${zL}

#include <clipping_planes_pars_vertex>

void main() {

	#ifdef USE_MAP
	vUv = uv;
	#endif

	${GL}

	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,use=`

// Basic
uniform vec3 diffuse;
uniform float opacity;

#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif

${QL}

${HL}


#ifdef USE_MAP
varying vec2 vUv;
uniform sampler2D map;
#endif

${WL}

#include <clipping_planes_pars_fragment>

void main() {

	vec4 diffuseColor = vec4( diffuse, opacity );

	// map
	${jL}

	${VL}

	#ifdef USE_ALPHATEST

	if ( diffuseColor.a < alphaTest ) discard;

	#endif

	// output
	gl_FragColor = diffuseColor;


	#include <clipping_planes_fragment>
}
`;class q1{static get mediation(){return fse}static ensureMaterialOptions(e){e.transparent=!0,e.alphaTest=e.alphaTest||.02}static ensureDefines(e){e.defines||(e.defines={})}static ensureUserData(e,t){e.userData.borderColor={value:null},e.userData.borderRadius={value:new qe.Vector4(0,0,0,0)},e.userData.cornerTL={value:new qe.Vector2(0,1)},e.userData.cornerTR={value:new qe.Vector2(1,1)},e.userData.cornerBR={value:new qe.Vector2(1,0)},e.userData.cornerBL={value:new qe.Vector2(0,0)},e.userData.borderWidth={value:new qe.Vector4(0,0,0,0)},e.userData.borderOpacity={value:null},e.userData.frameSize={value:new qe.Vector3(1,1,1)},e.userData.textureSize={value:new qe.Vector2(1,1)}}static bindUniformsWithUserData(e,t){e.uniforms.borderColor=t.userData.borderColor,e.uniforms.borderRadius=t.userData.borderRadius,e.uniforms.cornerTL=t.userData.cornerTL,e.uniforms.cornerTR=t.userData.cornerTR,e.uniforms.cornerBR=t.userData.cornerBR,e.uniforms.cornerBL=t.userData.cornerBL,e.uniforms.borderWidth=t.userData.borderWidth,e.uniforms.borderOpacity=t.userData.borderOpacity,e.uniforms.frameSize=t.userData.frameSize,e.uniforms.textureSize=t.userData.textureSize}static injectShaderChunks(e){q1.injectVertexShaderChunks(e),q1.injectFragmentShaderChunks(e)}static injectVertexShaderChunks(e){e.vertexShader=e.vertexShader.replace("#include <uv_pars_vertex>",`#include <uv_pars_vertex>
`+zL),e.vertexShader=e.vertexShader.replace("#include <uv_vertex>",`#include <uv_vertex>
`+GL)}static injectFragmentShaderChunks(e){e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+WL),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+HL),e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>",`#include <map_pars_fragment>
`+QL),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",jL),e.fragmentShader=e.fragmentShader.replace("#include <alphamap_fragment>",VL+`
#include <alphamap_fragment>`)}}const dse=function(s,e,t){t=["stretch","contain","cover"].indexOf(t),K6(s,"BACKGROUND_MAPPING",t)},fse={clippingPlanes:{m:"clippingPlanes"},backgroundAlphaTest:{m:"alphaTest",t:RM},backgroundSide:{m:"side"},backgroundImage:{m:"map"},backgroundColor:{m:"color"},backgroundOpacity:{m:"opacity"},backgroundSize:{m:"computedBackgroundSize",t:dse},borderWidth:{m:"borderWidth",t:Ha},borderColor:{m:"borderColor",t:Ha},cornerTL:{m:"cornerTL",t:Ha},cornerTR:{m:"cornerTR",t:Ha},cornerBR:{m:"cornerBR",t:Ha},cornerBL:{m:"cornerBL",t:Ha},borderOpacity:{m:"borderOpacity",t:Ha},size:{m:"frameSize",t:Ha},tSize:{m:"textureSize",t:Ha}};class sQ extends qe.ShaderMaterial{static get mediation(){return q1.mediation}constructor(){super({uniforms:{alphaTest:{value:.02},map:{value:null},diffuse:{value:new qe.Color(16777215)},opacity:{value:1},borderColor:{value:new qe.Color(0)},borderOpacity:{value:0},borderRadius:{value:new qe.Vector4(0,0,0,0)},cornerTL:{value:new qe.Vector2(0,1)},cornerTR:{value:new qe.Vector2(1,1)},cornerBR:{value:new qe.Vector2(1,0)},cornerBL:{value:new qe.Vector2(0,0)},borderWidth:{value:new qe.Vector4(0,0,0,0)},frameSize:{value:new qe.Vector3(1,1,1)},textureSize:{value:new qe.Vector2(1,1)}},side:qe.FrontSide,transparent:!0,clipping:!0,vertexShader:hse,fragmentShader:use,extensions:{derivatives:!0}}),this.defines.USE_ALPHATEST="",this.needsUpdate=!0}set map(e){this.uniforms.map.value=e,e?this.defines.USE_UV===void 0&&(this.defines.USE_UV="",this.needsUpdate=!0):this.defines.USE_UV!==void 0&&(delete this.defines.USE_UV,this.needsUpdate=!0),this.needsUpdate=!0}get map(){return this.uniforms.map.value}get alphaTest(){return this.uniforms.alphaTest.value}set alphaTest(e){this.uniforms.alphaTest.value=e}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get opacity(){return this.uniforms.opacity.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}}class pse extends Ri{constructor(){super("children",null,!1);d(this,"_sortOrder",(t,i)=>t._order._value<i._order._value?-1:t._order._value>i._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(i)?-1:1);this._uis=[],this._boxes=[]}update(t,i){this._compute(t),t._layouter._needsUpdate=!0,t._renderOrder._needsUpdate=!0}process(t){this._compute(t),t._flexDirection._needsProcess=!0,t._layouter._needsProcess=!0,t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(i=>i.visible&&i.isUI),this._boxes=this._uis.filter(i=>i.isBox).sort(this._sortOrder)}dispose(){this._uis=null,this._boxes=null}}class rQ extends Ri{constructor(){super("bounds",null,!1),this._size=new qe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0,this._centerX=.5,this._centerY=.5,this._needsProcess=!0}setReferenceWidth(e,t){const i=e._width,n=e._padding._value,r=e._borderWidth._value,o=e._margin._value,a=i._auto?1:i._value,l=t*a-(o.y+o.w);B2(l,this._offsetWidth)||(this._offsetWidth=l,this._innerWidth=this._offsetWidth-(n.y+n.w+r.y+r.w),this._centerX=qI(e),this._propagateWidth(e),this._triggerCascadingDependencies(e))}setReferenceHeight(e,t){const i=e._height,n=e._padding._value,r=e._borderWidth._value,o=e._margin._value,a=i._auto?1:i._value,l=t*a-(o.x+o.z);B2(l,this._offsetHeight)||(this._offsetHeight=l,this._innerHeight=this._offsetHeight-(n.x+n.z+r.x+r.z),this._centerY=XI(e),this._propagateHeight(e),this._triggerCascadingDependencies(e))}setChildrenWidth(e,t){const i=e._padding._value,n=e._borderWidth._value;this._innerWidth=t,this._offsetWidth=this._innerWidth+(i.y+i.w+n.y+n.w),this._centerX=qI(e),this._propagateWidth(e),this._triggerCascadingDependencies(e)}setChildrenHeight(e,t){const i=e._padding._value,n=e._borderWidth._value;this._innerHeight=t,this._offsetHeight=this._innerHeight+(i.x+i.z+n.x+n.z),this._centerY=XI(e),this._propagateHeight(e),this._triggerCascadingDependencies(e)}update(e,t){const i=e._padding._value,n=e._borderWidth._value,r=e._width;!r._auto&&!r._relative&&(e._boxSizing._value==="content-box"?(this._innerWidth=r._value,this._offsetWidth=this._innerWidth+i.y+i.w+n.y+n.w):(this._offsetWidth=r._value,this._innerWidth=this._offsetWidth-(i.y+i.w+n.y+n.w)),this._centerX=qI(e),this._needsProcess=!0,this._propagateWidth(e),this._triggerCascadingDependencies(e));const o=e._height;!o._auto&&!o._relative&&(e._boxSizing._value==="content-box"?(this._innerHeight=o._value,this._offsetHeight=this._innerHeight+i.x+i.z+n.x+n.z):(this._offsetHeight=o._value,this._innerHeight=this._offsetHeight-(i.x+i.z+n.x+n.z)),this._centerY=XI(e),this._needsProcess=!0,this._propagateHeight(e),this._triggerCascadingDependencies(e))}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight,e._backgroundMesh&&e._backgroundMesh.updateScale(),e._renderer._needsRender=!0}output(e){e.size=this._size}process(e){e._overflow._needsRender=!0}_computeChildrenSideWidth(e){return mse(e)}_computeChildrenSideHeight(e){return gse(e)}_propagateWidth(e){for(let t=0;t<e._children._boxes.length;t++){const i=e._children._boxes[t];i._width._relative&&i._bounds.setReferenceWidth(i,this._innerWidth)}}_propagateHeight(e){for(let t=0;t<e._children._boxes.length;t++){const i=e._children._boxes[t];i._height._relative&&i._bounds.setReferenceHeight(i,this._innerHeight)}}_triggerCascadingDependencies(e){e._parent._value&&(e._parent._value._autoSize._needsProcess=!0),e._flexDirection._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0,e._overflow._needsRender=!0}}function qI(s){const e=s._padding._value,t=s._borderWidth._value,i=e.w+t.w,n=e.y+t.y;return(i-n)/2}function XI(s){const e=s._padding._value,t=s._borderWidth._value,i=e.x+t.x;return(e.z+t.z-i)/2}function mse(s){return s._children._boxes.reduce((e,t)=>{const i=t._margin._value,n=t._bounds._offsetWidth+i.y+i.w;return e+n},0)}function gse(s){return s._children._boxes.reduce((e,t)=>{const i=t._margin._value,n=t._bounds._offsetHeight+i.x+i.z;return e+n},0)}class yse extends IL{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._process=this.emptyStrategyLogic,this._childAlign=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"row":case"row-reverse":switch(this._process=wse,this._value){case"start":this._childAlign=Ase;break;case"end":this._childAlign=vse;break;default:this._childAlign=PN}break;case"column":case"column-reverse":switch(this._process=xse,this._value){case"start":this._childAlign=bse;break;case"end":this._childAlign=_se;break;default:this._childAlign=PN}break}this._needsProcess=!0,e._autoSize._needsProcess=!0,e._flexDirection._needsProcess=!0,e._justifyContent._needsProcess=!0,this._needsProcess=!0,e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}process(e){this._process(e,this._childAlign);let t="center",i="center",n="center";const r=e._padding._value,o=e._borderWidth._value;e._flexDirection._value.indexOf("column")!==-1?this._value==="start"?t=i="left":this._value==="end"?t=i="right":t="centerX":this._value==="start"?t=n="top":this._value==="end"?t=n="bottom":t="centerY";let a=-(r.x-r.z)/2-(o.x-o.z)/2,l=-(r.y-r.w)/2-(o.y-o.w)/2;i==="left"?l=(r.w-r.y)/2+(o.w-o.y)/2:i==="right"&&(l=-(r.y-r.w)/2-(o.y-o.w)/2),n==="top"?a=-(r.x-r.z)/2-(o.x-o.z)/2:n==="bottom"&&(a=(r.z-r.x)/2+(o.z-o.x)/2),e._children._boxes.forEach(c=>{let h=0,u=0;t==="top"?u=-c._margin._value.x:t==="bottom"?u=c._margin._value.z:t==="left"?h=c._margin._value.w:t==="right"?h=-c._margin._value.y:t==="centerX"?h=(c._margin._value.w-c._margin._value.y)/2:t==="centerY"&&(u=(-c._margin._value.x+c._margin._value.z)/2),e._layouter._childrenPos[c.id].x+=l+h,e._layouter._childrenPos[c.id].y+=a+u})}}function PN(){return 0}function vse(s,e){return-e+s._bounds._offsetHeight/2}function Ase(s,e){return e-s._bounds._offsetHeight/2}function _se(s,e){return e-s._bounds._offsetWidth/2}function bse(s,e){return-e+s._bounds._offsetWidth/2}function xse(s,e){const t=s._bounds._innerWidth/2;s._children._boxes.forEach(i=>{s._layouter._childrenPos[i.id].x=e(i,t)})}function wse(s,e){const t=s._bounds._innerHeight/2;s._children._boxes.forEach(i=>{s._layouter._childrenPos[i.id].y=e(i,t)})}class Sse extends PL{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0,this._offset=0,this._reverse=1,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,this._value){case"row":this._process=Cse;break;case"row-reverse":this._process=Ese;break;case"column":this._process=Mse;break;case"column-reverse":this._process=Tse;break}e._justifyContent._needsUpdate||e._justifyContent.computeOutputValue(e),e._alignItems._needsUpdate||e._alignItems.computeOutputValue(e),this._needsProcess=!0}process(e){switch(this._value){case"row":this._offset=-e._bounds._innerWidth/2;break;case"row-reverse":this._offset=e._bounds._innerWidth/2;break;case"column":this._offset=e._bounds._innerHeight/2;break;case"column-reverse":this._offset=-e._bounds._innerHeight/2;break}this._reverse=-Math.sign(this._offset),this._reverse===0&&(this._reverse=1),this._process(e),e._justifyContent._needsProcess=!0,e._layouter._needsProcess=!0}}function Cse(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetWidth;e+=r._margin._value.w*t;const l=s._layouter._childrenPos[o];l.x=e+a/2*t,l.y=0,e+=t*(a+r._margin._value.y)}}function Ese(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetWidth;e+=r._margin._value.y*t;const l=s._layouter._childrenPos[o];l.x=e+a/2*t,l.y=0,e+=(a+r._margin._value.w)*t}}function Mse(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetHeight;e+=r._margin._value.x*t;const l=s._layouter._childrenPos[o];l.x=0,l.y=e+a/2*t,e+=(a+r._margin._value.z)*t}}function Tse(s){let e=s._flexDirection._offset;const t=s._flexDirection._reverse,i=s._children._boxes;for(let n=0;n<i.length;n++){const r=i[n],o=r.id,a=r._bounds._offsetHeight;e+=r._margin._value.z*t;const l=s._layouter._childrenPos[o];l.x=0,l.y=e+a/2*t,e+=(a+r._margin._value.x)*t}}class Ise extends BL{constructor(e){super("justifyContent",e,!0),this._allowsInherit=!1,this._needsUpdate=!0,this._computeOffset=this.emptyStrategyLogic,this._computeMargin=this.emptyStrategyLogic,this._process=this.emptyStrategyLogic}computeOutputValue(e){switch(this._value=this._inheritedInput,e._flexDirection._value){case"column-reverse":case"column":this._process=Pse.bind(this);break;case"row-reverse":case"row":this._process=Rse.bind(this);break}switch(this._value){case"end":this._computeOffset=Ose,this._computeMargin=YI;break;case"center":this._computeOffset=Lse,this._computeMargin=YI;break;case"start":this._computeOffset=Gw,this._computeMargin=YI;break;case"space-between":this._computeOffset=Gw,this._computeMargin=kse;break;case"space-around":this._computeOffset=Gw,this._computeMargin=Use;break;case"space-evenly":this._computeOffset=Gw,this._computeMargin=Fse;break}e._flexDirection._needsProcess=!0}process(e){this._process(e),e._alignItems._needsProcess=!0}}function Rse(s){const e=s._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:i}=Bse(s),n=e*2-t*Math.sign(e),r=this._computeOffset(n),o=this._computeMargin(s,i,s._flexDirection._reverse);s._children._boxes.forEach((a,l)=>{s._layouter._childrenPos[a.id].x-=r-o[l]})}function Pse(s){const e=s._flexDirection._offset,{usedDirectionSpace:t,remainingSpace:i}=Dse(s),n=e*2-t*Math.sign(e),r=this._computeOffset(n),o=this._computeMargin(s,i,s._flexDirection._reverse);s._children._boxes.forEach((a,l)=>{s._layouter._childrenPos[a.id].y-=r-o[l]})}function Bse(s){const e=s._bounds._computeChildrenSideWidth(s);return{usedDirectionSpace:e,remainingSpace:s._bounds._innerWidth-e}}function Dse(s){const e=s._bounds._computeChildrenSideHeight(s);return{usedDirectionSpace:e,remainingSpace:s._bounds._innerHeight-e}}function Gw(s){return 0}function Ose(s){return s}function Lse(s){return s/2}function YI(s,e=0,t=1){return Array(s._children._boxes.length).fill(0)}function kse(s,e=0,t=1){const n=s._children._boxes.length,r=Array(n).fill(0);if(e>0&&n>1){const o=e/(n-1)*t;r[0]=0;for(let a=1;a<n;a++)r[a]=o*a}return r}function Fse(s,e=0,t=1){const n=s._children._boxes.length,r=Array(n).fill(0);if(e>0){const o=e/(n+1)*t;for(let a=0;a<n;a++)r[a]=o*(a+1)}return r}function Use(s,e=0,t=1){const n=s._children._boxes.length,r=Array(n).fill(0);if(e>0){const o=e/n*t,a=o/2;r[0]=a;for(let l=1;l<n;l++)r[l]=a+o*l}return r}let KI;class oQ extends qe.Mesh{constructor(e){const t=e.slice,i={};let n=1,r=1;if(t){if(n=t.width?t.width:1,r=t.height?t.height:1,t.top){if(t.left){const f=new qe.PlaneGeometry(t.left*n,t.top*r,1,1);hh(f,0,t.left,1-t.top,1),f.translate(t.left*n/2,-t.top*r/2,0),i.topLeft=f}const u=new qe.PlaneGeometry(1,t.top*r,1,1);if(hh(u,t.left,1-t.right,1-t.top,1),u.translate(0,-t.top*r/2,0),i.top=u,t.right){const f=new qe.PlaneGeometry(t.right*n,t.top*r,1,1);hh(f,1-t.right,1,1-t.top,1),f.translate(-t.right*n/2,-t.top*r/2,0),i.topRight=f}}if(t.left){const u=new qe.PlaneGeometry(t.left*n,1,1,1);hh(u,0,t.left,t.bottom,1-t.top),u.translate(t.left*n/2,0,0),i.left=u}const h=new qe.PlaneGeometry(1,1,1,1);if(hh(h,t.left,1-t.right,t.bottom,1-t.top),i.middle=h,t.right){const u=new qe.PlaneGeometry(t.right*n,1,1,1);hh(u,1-t.right,1,t.bottom,1-t.top),u.translate(-t.right*n/2,0,0),i.right=u}if(t.bottom){if(t.left){const f=new qe.PlaneGeometry(t.left*n,t.bottom*r,1,1);hh(f,0,t.left,0,t.bottom),f.translate(t.left*n/2,t.bottom*r/2,0),i.bottomLeft=f}const u=new qe.PlaneGeometry(1,t.bottom*r,1,1);if(hh(u,t.left,1-t.right,0,t.bottom),u.translate(0,t.bottom*r/2,0),i.bottom=u,t.right){const f=new qe.PlaneGeometry(t.right*n,t.bottom*r,1,1);hh(f,1-t.right,1,0,t.bottom),f.translate(-t.right*n/2,t.bottom*r/2,0),i.bottomRight=f}}}let o=e.backgroundMaterial;t&&(KI||(KI=new qe.MeshBasicMaterial({alphaTest:1.1})),o=KI);const a=new qe.PlaneGeometry(1,1,e._segments.value,e._segments.value),l=new qe.BufferAttribute(new Float32Array(a.getAttribute("uv").array),2);if(a.setAttribute("uvB",l).name="uvB",super(a,o),this.name="UIBackgroundBox",t){this.slice=t,this.sliceSize=new qe.Vector3(1-(t.left+t.right),1-(t.bottom+t.top),1),this.sliceScale=new qe.Vector3(n,r,1);for(const c in i){const h=new qe.Mesh(i[c],e.backgroundMaterial);this.add(h),i[c]=h}this.updateScale=this.updateScaleSlice,this.slices=i}}updateScale(){}updateScaleSlice(){const e=new qe.Vector3(1,1,1);this.scale.x<(this.slice.left+this.slice.right)*this.sliceScale.x&&(e.x=this.scale.x/((this.slice.left+this.slice.right)*this.sliceScale.x)),this.scale.y<(this.slice.bottom+this.slice.top)*this.sliceScale.y&&(e.y=this.scale.y/((this.slice.bottom+this.slice.top)*this.sliceScale.y));for(const t in this.slices){const i=this.slices[t];i.scale.set(1/this.scale.x,1/this.scale.y,this.scale.y);const n=Nse[t];for(const o in n)i.position[o]=this.scale[o]*n[o]*i.scale[o];const r=zse[t];if(r){r.x&&(i.position.x=this.sliceScale.x*.5*(this.slice.left-this.slice.right)*(1/this.scale.x)),r.y&&(i.position.y=this.sliceScale.y*.5*(this.slice.bottom-this.slice.top)*(1/this.scale.y));for(const o in r){const a=this.scale[o]-(1-this.sliceSize[o])*this.sliceScale[o];i.scale[o]=Math.max(0,a*(1/this.scale[o]))}}}e.x!==1&&(this.slices.left.scale.x*=e.x,this.slices.topLeft.scale.x*=e.x,this.slices.bottomLeft.scale.x*=e.x,this.slices.right.scale.x*=e.x,this.slices.topRight.scale.x*=e.x,this.slices.bottomRight.scale.x*=e.x),e.y!==1&&(this.slices.top.scale.y*=e.y,this.slices.topLeft.scale.y*=e.y,this.slices.topRight.scale.y*=e.y,this.slices.bottom.scale.y*=e.y,this.slices.bottomLeft.scale.y*=e.y,this.slices.bottomRight.scale.y*=e.y)}}const Nse={topLeft:{x:-.5,y:.5},top:{y:.5},topRight:{x:.5,y:.5},left:{x:-.5},right:{x:.5},bottomLeft:{x:-.5,y:-.5},bottom:{y:-.5},bottomRight:{x:.5,y:-.5}},zse={top:{x:1},left:{y:1},right:{y:1},bottom:{x:1},middle:{x:1,y:1}};function hh(s,e,t,i,n){const r=t-e,o=n-i,a=s.attributes.uv;for(let c=0;c<a.count;c++){const h=a.getX(c),u=a.getY(c);a.setXY(c,e+h*r,i+u*o)}const l=new qe.BufferAttribute(new Float32Array(s.getAttribute("uv").array),2);s.setAttribute("uvB",l).name="uvB"}class aQ extends Ri{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new oQ(e)),e.performAfterUpdate()}}class Gse extends Q6{constructor(){super("position")}update(e,t){super.update(e,t),this._needsProcess=!0}}class Hse extends Ri{constructor(){super("autosize"),this._needsProcess=!0}process(e){e._width._auto&&Vse(e),e._height._auto&&Qse(e);const t=e._alignItems._value==="stretch",i=t&&e._flexDirection._value.indexOf("column")!==-1,n=t&&!i;for(const r of e._children._boxes)(r._width._auto&&i||r._width._relative)&&r._bounds.setReferenceWidth(r,e._bounds._innerWidth),(r._height._auto&&n||r._height._relative)&&r._bounds.setReferenceHeight(r,e._bounds._innerHeight)}}function Vse(s){s._bounds.setChildrenWidth(s,jse(s))}function Qse(s){s._bounds.setChildrenHeight(s,Wse(s))}function Wse(s){switch(s._flexDirection._value){case"row":case"row-reverse":return Kse(s);case"column":case"column-reverse":return Xse(s)}}function jse(s){switch(s._flexDirection._value){case"row":case"row-reverse":return qse(s);case"column":case"column-reverse":return Yse(s)}}function qse(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetWidth+i.y+i.w;e+=n}return e}function Xse(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetHeight+i.x+i.z;e+=n}return e}function Yse(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetWidth+i.y+i.w;n>e&&(e=n)}return e}function Kse(s){let e=0;for(const t of s._children._boxes){if(t._position._value!=="static")continue;const i=t._margin._value,n=t._bounds._offsetHeight+i.x+i.z;n>e&&(e=n)}return e}class U_ extends Nb{constructor(e,t){U_.definePropertiesValues(e,t),super(e,t),U_.init(this)}bindBackgroundMeshProperties(){this._bounds._size=this._backgroundMesh.scale,this._bounds._needsProcess=!0}unbindBackgroundMeshProperties(){this._bounds._size=new qe.Vector3(1,1,1),this._bounds._needsProcess=!0}static definePropertiesValues(e,t){e.children||(e.children=pse),e.bounds||(e.bounds=rQ),e.flexDirection||(e.flexDirection=Sse),e.justifyContent||(e.justifyContent=Ise),e.alignItems||(e.alignItems=yse),e.position||(e.position=Gse),e.autoSize||(e.autoSize=Hse),e.renderer||(e.renderer=aQ),t.fontSide||(t.fontSide=0),t.invertAlpha||(t.invertAlpha=!1),t.fontCastShadow||(t.fontCastShadow=!1),t.fontReceiveShadow||(t.fontReceiveShadow=!1),t.backgroundCastShadow||(t.backgroundCastShadow=!1),t.backgroundReceiveShadow||(t.backgroundReceiveShadow=!1)}static init(e){Object.defineProperties(e,{isBox:{configurable:!1,enumerable:!0,value:!0}}),e.backgroundMaterial=new sQ,e._renderer.render(e),e._backgroundMesh.visible=!1}}let BN=class extends Array{constructor(...e){super(...e),this.width=0,this.lineBase=0,this.lineHeight=0,this.y=0}};class Jse extends Ri{constructor(){super("layouter",null,!1),this._needsUpdate=!0,this._childrenPos={}}update(e,t){this._childrenPos={};for(const i of e._children._boxes)i._position._value==="static"&&(this._childrenPos[i.id]=i.position)}process(e){}}class N_ extends U_{constructor(e={}){const t={};N_.definePropertiesValues(t,e),super(t,e),N_.init(this)}add(e){const t=[];for(let i=0;i<arguments.length;i++){const n=arguments[i];!n.isUI||n.isBox?t.push(n):console.warn("Block element can only contain Box elements.",n)}return super.add(...t)}static definePropertiesValues(e,t){e.layouter=Jse}static init(e){Object.defineProperties(e,{isBlock:{configurable:!1,enumerable:!0,value:!0}})}}class Zse extends Ri{constructor(){super("textContent",null,!1)}update(e,t){e._glyphs._needsUpdate=!0,e._whiteSpace._needsProcess=!0}}class $se extends Ri{constructor(){super("inlines",null,!1),this._value=null}process(e){if(this._value=e._glyphs._value.map(t=>t.asInlineGlyph()),this._value.length){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=e._padding._value.y,this._value[t].marginRight=e._margin._value.y}e._fontSize._needsProcess=!0,e._lineBreak._needsProcess=!0,e._fontKerning._needsProcess=!0,e._layouter._needsProcess=!0}get value(){return this._value}}class ere extends Ri{constructor(){super("glyphs",null,!1),this._needsUpdate=!1,this._value=null}process(e){e._font._fontVariant&&e._font._fontVariant.isReady&&(this._value=e._whiteSpace._whiteSpacedContent.split("").map(t=>e._font._fontVariant.getTypographicGlyph(t)),this._value&&(e._inlines._needsProcess=!0))}get value(){return this._value}}class tre extends F_{constructor(){super("color","inherit",!1),this.output=this._outputValue}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class lQ extends Ri{constructor(e=`- ,.:?!
`){super("lineBreak",e,!0),this._newLineBreakability=null}update(e,t){this._needsProcess=!0}process(e){const t=e._whiteSpace._newLineBreakability;if(e._inlines._value)for(let i=0;i<e._inlines._value.length;i++){const n=e._inlines._value[i],r=n.char;let o=null;r!==void 0&&(t!=="nowrap"&&(this._value.includes(r)||r.match(/\s/g))&&(o="possible"),r.match(/\n/g)&&(o=t)),n.lineBreak=o}}get value(){return this._value}}class cQ extends Ri{constructor(){super("layouter",null,!1),this._value=null}update(e,t){this._value=e._parent.find(i=>i.isUI&&i.isText),this._needsProcess=!0}process(e){this._value&&(this._value._layouter._needsProcess=!0)}}class ire extends F_{constructor(e){super("backgroundColor",e,!1),this._allowsInherit=!1,this._input=0}computeOutputValue(e){this._input==="inherit"?this._value.set(this.getInheritedInput(e)):this._value.set(this._input)}}class hQ extends q6{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class uQ extends X6{constructor(){super()}computeOutputValue(e){this._value=TL(this.getInheritedInput(e))}}class dQ extends Z6{constructor(){super("fontFamily","inherit",!0),this._input="inherit",this._needsUpdate=!0,this._allowsInherit=!1}computeOutputValue(e){let t=this._inheritedInput;if(t==="inherit"&&(t=this.getInheritedInput(e)),t instanceof PM)this._value=t,e._font._needsUpdate=!0;else if(typeof t=="string"){const i=sm.getFontFamily(t);i?(this._value=i,e._font._needsUpdate=!0):console.warn(`(.style) fontFamily, the font '${t}' is not registered. Aborted.`)}else console.warn("(.style) fontFamily requires a registered fontFamily instance, or the id of a registered fontFamily."),console.warn("If you want to set a specific font, please use .font property instead.")}get value(){return this._value}}class qL extends eQ{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited,this._whiteSpacedContent="",this._stringCollapser=this.emptyStrategyLogic,this._inlineCollapser=this.emptyStrategyLogic,this._inlineWrapper=this.emptyStrategyLogic}_computeFromInherited(e){switch(super._computeFromInherited(e),this._newLineBreakability=nre(this._value),this._value){case"nowrap":case"normal":this._stringCollapser=sre;break;case"pre-line":this._stringCollapser=fQ;break;default:this._stringCollapser=rre}switch(this._value){case"pre-line":case"nowrap":case"normal":this._inlineCollapser=hre;break;case"pre-wrap":this._inlineCollapser=cre;break;default:this._inlineCollapser=ure}switch(this._value){case"pre-line":case"pre-wrap":case"normal":this._inlineWrapper=ore;break;case"pre":this._inlineWrapper=are;break;default:this._inlineWrapper=lre}this._needsProcess=!0}process(e){e.isInline&&!e.isInlineBlock&&(this._whiteSpacedContent=this._stringCollapser(e._textContent._value),e._glyphs._needsProcess=!0)}}const DN={"	":"	","\n":`
`,"\r":"\r"," ":" "},nre=function(s){switch(s){case"pre":case"pre-wrap":case"pre-line":return"mandatory"}return null};function sre(s){return fQ(s.replace(/\n/g," "))}function fQ(s){return s.replace(/[ ]{2,}/g," ")}function rre(s){return s}function ore(s,e,t,i){const n=s[e];if(n.lineBreak==="mandatory"||t+n.xadvance+n.xoffset+n.kerning>i.INNER_WIDTH)return!0;const r=gQ(s,e,i);return dre(s[e-1],t,r,i)}function are(s,e,t,i){return s[e].lineBreak==="mandatory"}function lre(){return!1}function cre(s){if(!s[0])return 0;const e=s[0],t=s[s.length-1];return e.char&&e.char===`
`&&s.length>1&&mQ([e],s[1]),t.char&&t.char===`
`&&s.length>1&&pQ([t],s[s.length-2]),e.offsetX}function hre(s){if(!s[0])return 0;let e=[],t;for(let i=0;i<s.length;i++){const n=s[i];if(n.char&&DN[n.char]&&s.length>i){e.push(n),t=s[i+1];continue}break}mQ(e,t),e=[],t=null;for(let i=s.length-1;i>0;i--){const n=s[i];if(n.char&&DN[n.char]&&i>0){e.push(n),t=s[i-1];continue}break}return pQ(e,t),s[0].offsetX}function ure(s){return s[0]?s[0].offsetX:0}function pQ(s,e){if(e)for(let t=0;t<s.length;t++){const i=s[t];i.fontFactor=0,i.offsetX=e.offsetX+e.cumulativeWidth,i.cumulativeWidth=0}}function mQ(s,e){if(e)for(let t=0;t<s.length;t++){const i=s[t];i.fontFactor=0,i.offsetX=e.offsetX,i.cumulativeWidth=0}}function gQ(s,e,t,i){if(i=i||0,!s[e])return i;const n=s[e];return n.lineBreak?i+n.xadvance:gQ(s,e+1,t,i+n.xadvance+n.xoffset+n.kerning+t.LETTERSPACING)}function dre(s,e,t,i){return!s||!s.char||e+t<i.INNER_WIDTH?!1:i.BREAKON.indexOf(s.char)>-1}class yQ extends tQ{constructor(){super(),this._input="inherit",this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._fontSize._needsProcess=!0,e._layouter._needsProcess=!0}}class vQ extends Cn{constructor(){super("fontSize","inherit",!0),this._allowsInherit=!1}computeOutputValue(e){this._value=this._inheritedInput,e._font._fontVariant&&(e._bounds._needsProcess=!0,e._layouter._needsProcess=!0)}process(e){if(!e._font._fontVariant||!e._font._fontVariant.isReady)return;const t=this._value/e._font._fontVariant.typographic.size,i=e._inlines._value;for(let n=0;n<i.length;n++){const r=i[n];r.resetOffsets(),r.fontSize=this._value,r.fontFactor=t}}get value(){return this._value}}class AQ extends iQ{constructor(){super("segments",1,!1),this._notInheritedValue=void 0}update(e,t){this._notInheritedValue=this._value,this._notInheritedValue==="inherit"&&(this._notInheritedValue=this.getInheritedInput(e)),e._layouter._needsUpdate=!0}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}get value(){return this._value==="inherit"?this._notInheritedValue:this._value}}class fre extends AQ{constructor(){super(),this._value="inherit"}}class pre extends BM{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e),e._parent._value._layouter._needsProcess=!1}process(e){if(this._value!=="none"){const t=e._whiteSpace._whiteSpacedContent,i=e._inlines._value;for(let n=1;n<i.length;n++){const r=t[n-1]+t[n];i[n].kerning=e._font._fontVariant.getKerningAmount(r)}}}}class _Q extends Ri{constructor(){super("children",null,!1),this._uis=[]}update(e,t){}process(e){}_compute(e){}dispose(){}}function mre(s,e=!1){const t=s[0].index!==null,i=new Set(Object.keys(s[0].attributes)),n=new Set(Object.keys(s[0].morphAttributes)),r={},o={},a=s[0].morphTargetsRelative,l=new qe.BufferGeometry;let c=0;for(let h=0;h<s.length;++h){const u=s[h];let f=0;if(t!==(u.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const p in u.attributes){if(!i.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;r[p]===void 0&&(r[p]=[]),r[p].push(u.attributes[p]),f++}if(f!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(a!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const p in u.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;o[p]===void 0&&(o[p]=[]),o[p].push(u.morphAttributes[p])}if(e){let p;if(t)p=u.index.count;else if(u.attributes.position!==void 0)p=u.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,h),c+=p}}if(t){let h=0;const u=[];for(let f=0;f<s.length;++f){const p=s[f].index;for(let m=0;m<p.count;++m)u.push(p.getX(m)+h);h+=s[f].attributes.position.count}l.setIndex(u)}for(const h in r){const u=ON(r[h]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,u)}for(const h in o){const u=o[h][0].length;if(u===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let f=0;f<u;++f){const p=[];for(let v=0;v<o[h].length;++v)p.push(o[h][v][f]);const m=ON(p);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(m)}}return l}function ON(s){let e,t,i,n=-1,r=0;for(let c=0;c<s.length;++c){const h=s[c];if(e===void 0&&(e=h.array.constructor),e!==h.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=h.itemSize),t!==h.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=h.normalized),i!==h.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(n===-1&&(n=h.gpuType),n!==h.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;r+=h.count*t}const o=new e(r),a=new qe.BufferAttribute(o,t,i);let l=0;for(let c=0;c<s.length;++c){const h=s[c];if(h.isInterleavedBufferAttribute){const u=l/t;for(let f=0,p=h.count;f<p;f++)for(let m=0;m<t;m++){const v=h.getComponent(f,m);a.setComponent(f+u,m,v)}}else o.set(h.array,l);l+=h.count*t}return n!==void 0&&(a.gpuType=n),a}class gre extends Ri{constructor(){super("renderer")}render(e){if(!e._inlines._value||!e._inlines._value.length)return;const t=e._inlines._value.map(n=>e._font._fontVariant.getGeometricGlyph(n,e).translate(n.offsetX,n.offsetY,0)),i=mre(t);e.setFontMesh(new qe.Mesh(i,e.fontMaterial)),e._fontMesh.renderOrder=1/0}}class yre extends RL{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!1}computeOutputValue(e){this._value=this._inheritedInput,e._layouter._needsProcess=!0}}class iv extends Nb{constructor(t={}){const i={};iv.definePropertiesValues(i,t);super(i,t);d(this,"_rebuildParentUI",()=>{super._rebuildParentUI(),this._layouter._needsUpdate=!0});iv.init(this)}add(t){const i=[];for(let n=0;n<arguments.length;n++){const r=arguments[n];!r.isUI||r.isInline?(i.push(r),r.position.z=.005):console.warn("Block element can only contain Box elements.",r)}return super.add(...i)}set textContent(t){this._textContent.value=t}get textContent(){return this._textContent._value}set invertAlpha(t){this._invertAlpha.value=t}get invertAlpha(){return this._invertAlpha._value}static definePropertiesValues(t,i){t.children||(t.children=_Q),t.textContent||(t.textContent=Zse),t.glyphs||(t.glyphs=ere),t.inlines||(t.inlines=$se),t.layouter||(t.layouter=cQ),t.renderer||(t.renderer=gre),t.fontFamily||(t.fontFamily=dQ),t.fontWeight||(t.fontWeight=uQ),t.fontStyle||(t.fontStyle=hQ),t.fontSize||(t.fontSize=vQ),t.color||(t.color=tre),t.backgroundColor||(t.backgroundColor=ire),t.lineBreak||(t.lineBreak=lQ),t.letterSpacing||(t.letterSpacing=yQ),t.whiteSpace||(t.whiteSpace=qL),t.segments||(t.segments=fre),t.textAlign||(t.textAlign=yre),t.fontKerning||(t.fontKerning=pre)}static init(t){Object.defineProperties(t,{isInline:{configurable:!1,enumerable:!0,value:!0}})}}class vre extends j6{constructor(){super("textContent",null,!1),this._needsUpdate=!1}set value(e){this._value!==e&&(this._value=e,this._needsUpdate=!0)}update(e,t){this._needsUpdate=!1;for(let i=e.children.length-1;i>=0;i--){const n=e.children[i];n.isUI&&(e.remove(n),n.clear())}e._children._uis=[],this._value&&e.add(new iv({name:"anonymousInline",textContent:this._value}))}}class Are extends Array{constructor(...e){super(...e),this.width=0,this.height=0}}class _re extends Ri{constructor(){super("layouter",null,!1),this._value=null}update(e,t){}process(e){let t=e._width._value;e._width._auto?t=1/0:t=e._bounds._innerWidth;const i=e._lineHeight._value,n=new Are(new BN);let r=0;e._children._inlines.forEach(u=>{if(!u._inlines.value)return;this._resetInlines(u);const f=u._fontSize._value,p=u._letterSpacing._value*f,m=u._whiteSpace._value,v=u._lineBreak._value,g={WHITESPACE:m,LETTERSPACING:p,BREAKON:v,INNER_WIDTH:t},y=u._whiteSpace._inlineWrapper;r+=u._margin._value.w+u._padding._value.w,u._inlines.value.forEach((A,_,b)=>{const x=n[n.length-1];if(y(b,_,r,g)){if(n.push(new BN(A)),A.offsetX=A.xoffset,A.width===0){r=0;return}A.cumulativeWidth=A.xadvance+p,r=A.cumulativeWidth;return}n[n.length-1].push(A),A.offsetX=r+A.xoffset+A.kerning,A.cumulativeWidth=A.xadvance+A.kerning+p,r+=A.cumulativeWidth,x.length-1===1&&x[x.length-2].width===0&&(A.offsetX-=A.xoffset,r-=A.xoffset)}),r+=u._margin._value.y+u._padding._value.y});const o=e._whiteSpace._inlineCollapser;let a=0,l=0,c=0;n.forEach((u,f)=>{const p=o(u);let m=0,v=0;if(u.forEach(g=>{m=Math.max(m,g.lineHeight),v=Math.max(v,g.lineBase),g.offsetX-=p}),u.lineHeight=m,u.lineBase=v,f===0?c=-(m*i-m)*.5:c-=n[f-1].lineHeight*i,u.y=c,u.x=0,u.forEach(g=>{g.offsetY=c-g.anchor,g.lineHeight<u.lineHeight&&(g.offsetY-=u.lineBase-g.lineBase)}),l+=u.lineHeight*i,u.width=0,u[0]){const g=u[u.length-1];u.width=g.offsetX+g.cumulativeWidth+g.paddingRight+g.marginRight+u[0].offsetX,a=Math.max(a,u.width)}}),n.height=l,n.width=a,this._value=n,t===1/0&&e._bounds.setChildrenWidth(e,n.width),e._height._auto&&e._bounds.setChildrenHeight(e,n.height);const h=e._parent._value;h&&(h._autoSize._needsProcess=!0,h._flexDirection._needsProcess=!0),e._inlineJustificator._needsProcess=!0,e._textAlign._needsProcess=!0,e._overflow._needsUpdate=!0}_resetInlines(e){e._fontSize.process(e)}}class bre extends RL{constructor(){super(),this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput,this._needsProcess=!0}process(e){xre(e),e._renderer._needsRender=!0}}function xre(s){const e=s._layouter._value,t=s._textAlign._value,i=s._bounds._innerWidth;for(let n=0;n<e.length;n++){const r=e[n],o=wre(s,r,n===e.length-1),a=s._padding._value,l=s._borderWidth._value,c=(-a.w+a.y)/2+(-l.w+l.y)/2;r.x+=o;for(let h=0;h<r.length;h++)r[h].offsetX+=o-c}if(t.indexOf("justify")===0)for(let n=0;n<e.length;n++){const r=e[n];if(t.indexOf("-")!==-1&&n===e.length-1)return;const o=i-r.width;if(o<=0)return;let a=0;for(let u=1;u<r.length-1;u++)a+=r[u].char===" "?1:0;const l=o/a;let c=1;t==="justify-right"&&(r.reverse(),c=-1);let h=0;for(let u=1;u<=r.length-1;u++){const f=r[u];f.offsetX+=h*c,h+=f.char===" "?l:0}t==="justify-right"&&r.reverse()}}function wre(s,e,t){switch(s._textAlign._value){case"justify-left":case"justify":case"left":return-s._bounds._innerWidth/2;case"justify-right":case"right":return-e.width+s._bounds._innerWidth/2;case"center":return-e.width/2;case"justify-center":return t?-e.width/2:-s._bounds._innerWidth/2;default:console.warn(`textAlign: '${s._textAlign._value}' is not valid`)}}class Sre extends PL{constructor(){super(),this._value=this._input="column",this._allowsInherit=!1,this._needsUpdate=!0}computeOutputValue(e){this._value=this._inheritedInput}}class Cre extends $6{constructor(){super(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}}class Ere extends BM{constructor(){super(),this._value=this._input=this.getDefaultValue(),this._allowsInherit=!1,this.computeOutputValue=this._computeFromInherited}_computeFromInherited(e){super._computeFromInherited(e)}}class Mre extends rQ{constructor(){super(),this._innerWidth=1/0,this._innerHeight=0}}class Tre extends Ri{constructor(){super("children",null,!1);d(this,"_sortOrder",(t,i)=>t._order._value<i._order._value?-1:t._order._value>i._order._value?1:this._uis.indexOf(t)<this._uis.indexOf(i)?-1:1);this._uis=[],this._inlines=[],this._boxes=[]}update(t,i){this._compute(t),this._needsProcess=!0}process(t){this._compute(t),t._overflow._needsRender=!0}_compute(t){this._uis=t.children.filter(i=>i.visible&&i.isUI),this._inlines=this._uis.filter(i=>i.isInline).sort(this._sortOrder)}dispose(){this._inlines=null}}class Ire extends Ri{constructor(){super("autosize")}process(e){if(e._layouter._value&&e._layouter._value.length){const t=e._layouter._value,i=e._padding._value,n=e._borderWidth._value;e._width._auto&&e._bounds.setOffsetWidth(e,t.width+i.w+i.y+n.w+n.y),e._height._auto&&e._bounds.setOffsetHeight(e,t.height+i.x+i.z+n.x+n.z)}}}class Rre extends aQ{constructor(){super("renderer"),this._needsUpdate=!1}render(e){super.render(e);for(const t of e._children._inlines)t._renderer.render(t);e.performAfterUpdate()}}class z_ extends U_{constructor(e={},t={}){z_.definePropertiesValues(t,e),super(t,e),z_.init(this)}add(e){const t=[];let i=!1;for(let n=0;n<arguments.length;n++){const r=arguments[n];!r.isUI||r.isInline?(r.isInline&&(i=!0),t.push(r)):console.warn("Block element can only contain Box elements.",r)}return t.length>0&&super.add(...t),i&&(this._children._needsUpdate=!0,this._layouter._needsProcess=!0),this}set textContent(e){this._textContent.value=e}get textContent(){return super.textContent}set invertAlpha(e){this._invertAlpha.value=e}get invertAlpha(){return this._invertAlpha._value}get lines(){return this._layouter._value}static definePropertiesValues(e,t){e.flexDirection=Sre,e.justifyContent=BL,e.alignItems=IL,e.bounds=Mre,e.autoSize=Ire,e.renderer=Rre,e.children||(e.children=Tre),e.textContent||(e.textContent=vre),e.layouter||(e.layouter=_re),e.lineHeight||(e.lineHeight=Cre),e.textAlign||(e.textAlign=bre),e.whiteSpace||(e.whiteSpace=qL),e.fontKerning||(e.fontKerning=Ere),e.segments||(e.segments=AQ),t.width||(t.width="100%"),t.fontSide||(t.fontSide=0)}static init(e){Object.defineProperties(e,{isText:{configurable:!1,enumerable:!0,value:!0}})}}class Pre extends Ri{constructor(){super("inlines",null,!1),this._value=[]}process(e){this._value[0].paddingLeft=e._padding._value.w,this._value[0].marginLeft=e._margin._value.w;const t=this._value.length-1;this._value[t].paddingRight=e._padding._value.y,this._value[t].marginRight=e._margin._value.y}}class Bre extends Ri{constructor(){super("renderer")}render(e){e._backgroundMesh||e.setBackgroundMesh(new oQ(e)),e._backgroundMesh.position.x=e._inlines._value[0].offsetX+e._inlines._value[0].width/2,e._backgroundMesh.position.y=e._inlines._value[0].offsetY+e._inlines._value[0].lineBase/2,e._bounds.render(e)}}class Dre extends Ri{constructor(){super("bounds",null,!1),this._size=new qe.Vector3(1,1,1),this._offsetWidth=0,this._offsetHeight=0,this._innerWidth=0,this._innerHeight=0}update(e,t){this.output(t),this._needsProcess=!0}process(e){this._offsetWidth=this._innerWidth=e._inlines._value[0].width,this._offsetHeight=this._innerHeight=e._inlines._value[0].height,this._needsRender=!0,e._borderWidth._needsRender=!0,e._borderRadius._needsRender=!0}render(e){this._size.x=this._offsetWidth,this._size.y=this._offsetHeight}output(e){e.size=this._size}}class G_ extends Nb{constructor(e={}){const t={};G_.definePropertiesValues(t,e),super(t,e),G_.init(this)}clear(){for(const e of this._inlines._value)e.clear();return super.clear()}bindBackgroundMeshProperties(){this._backgroundMesh.raycast=()=>{},this._bounds._size=this._backgroundMesh.scale,this._bounds._needsUpdate=!0}unbindBackgroundMeshProperties(){this._bounds._size=new qe.Vector3(1,1,1),this._bounds._needsUpdate=!0}add(e){const t=[];for(let i=0;i<arguments.length;i++){const n=arguments[i];n.isUI?console.warn("ThreeMeshUI::InlineBlockElement cannot contains UI Elements.",n):(t.push(n),n.position.z=.005)}return super.add(...t)}static definePropertiesValues(e,t){e.children||(e.children=_Q),e.bounds||(e.bounds=Dre),e.inlines||(e.inlines=Pre),e.layouter||(e.layouter=cQ),e.renderer||(e.renderer=Bre),e.fontFamily||(e.fontFamily=dQ),e.fontWeight||(e.fontWeight=uQ),e.fontStyle||(e.fontStyle=hQ),e.fontSize||(e.fontSize=vQ),e.backgroundColor||(e.backgroundColor=V6),e.lineBreak||(e.lineBreak=lQ),e.letterSpacing||(e.letterSpacing=yQ),e.whiteSpace||(e.whiteSpace=qL),e.fontKerning||(e.fontKerning=BM),t.backgroundSize||(t.backgroundSize="cover"),t.width||(t.width="100%"),t.height||(t.height="100%"),t.boxSizing||(t.boxSizing="border-box")}static init(e){Object.defineProperties(e,{isInline:{configurable:!1,enumerable:!0,value:!0},isInlineBlock:{configurable:!1,enumerable:!0,value:!0}}),e._inlines._value=[new Ore(e)],e.backgroundMaterial=new sQ,e._renderer.render(e)}}class Ore extends U6{constructor(e){super(),this._uiElement=e}get xadvance(){const e=this._uiElement._padding._value,t=this._uiElement._width;return t._relative?t._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.w+e.y+t.value}get width(){const e=this._uiElement._width;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get height(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get anchor(){return this.height}get lineHeight(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}get lineBase(){const e=this._uiElement._height;return e._relative?e._value*this._uiElement._fontSize.getInheritedInput(this._uiElement):e.value}clear(){this._uiElement=null}}class bQ{constructor(e){this._subject=e}attach(){console.error(`Behavior::attach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}act(){throw new Error(`Behavior::act() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}detach(){console.error(`Behavior::detach() - Is abstract and therefore should be overridden in ${this.constructor.name}`)}clear(){}}const xQ=()=>j1.update(),wQ={BaseProperty:Ri,Block:N_,Text:z_,Inline:iv,InlineBlock:G_,MeshUIBaseElement:Nb,FontLibrary:sm,update:xQ,MSDFFontMaterialUtils:Wa,ShaderChunkUI:nQ,Behavior:bQ,FontVariant:Ub};typeof global<"u"&&(global.ThreeMeshUI=wQ);const Lre=wQ;var kre=ms.ti,SQ=ms.nS,XL=ms.eB,Fre=ms.Yp,D2=ms.VB,Ure=ms.BC,Nre=ms.zN,KC=ms.cV,zre=ms.hW,Gre=ms.k2,Hre=ms.K6,Vre=ms.M7,Qre=ms.ls,Wre=ms.Hi,YL=ms.EY,jre=ms.MR,qre=ms.zf,Wi=ms.Ay,CQ=ms.yo;const LN=Object.freeze(Object.defineProperty({__proto__:null,BaseProperty:kre,Behavior:SQ,Block:XL,DefaultValues:Fre,FontLibrary:D2,FontVariant:Ure,InheritableProperty:Nre,Inline:KC,InlineBlock:zre,InlineGlyph:Gre,MSDFFontMaterialUtils:Hre,MaterialTransformers:Vre,MeshUIBaseElement:Qre,ShaderChunkUI:Wre,Text:YL,TypographicFont:jre,TypographicGlyph:qre,default:Wi,update:CQ},Symbol.toStringTag,{value:"Module"}));class Xre{constructor(){d(this,"Rad2Deg",180/Math.PI);d(this,"Deg2Rad",Math.PI/180);d(this,"Epsilon",1e-5)}random(e,t){return e!==void 0&&t!==void 0?Math.random()*(t-e)+e:Math.random()}randomVector3(e,t=0,i=1){e.x=this.random(t,i),e.y=this.random(t,i),e.z=this.random(t,i)}clamp(e,t,i){return e<t?t:e>i?i:e}clamp01(e){return this.clamp(e,0,1)}lerp(e,t,i){return i=i<0?0:i,i=i>1?1:i,e+(t-e)*i}inverseLerp(e,t,i){return(i-e)/(t-e)}remap(e,t,i,n,r){return n+(r-n)*(e-t)/(i-t)}moveTowards(e,t,i){return e+=i,(i<0&&e<t||i>0&&e>t)&&(e=t),e}toDegrees(e){return e*180/Math.PI}toRadians(e){return e*Math.PI/180}tan(e){return Math.tan(e)}gammaToLinear(e){return Math.pow(e,2.2)}linearToGamma(e){return Math.pow(e,1/2.2)}approximately(e,t,i=Number.EPSILON){for(const n of Yre){const r=e[n],o=t[n];if(r===void 0||o===void 0)break;if(Math.abs(r-o)>i)return!1}return!0}easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}}const Yre=["x","y","z","w"],it=new Xre;class kN{constructor(e){d(this,"y");d(this,"s");d(this,"alpha",0);this.setAlpha(e),this.y=null,this.s=null}setAlpha(e){if(e<=0||e>1)throw new Error;this.alpha=e}filter(e,t){t&&this.setAlpha(t);let i;return this.y?i=this.alpha*e+(1-this.alpha)*this.s:i=e,this.y=e,this.s=i,i}lastValue(){return this.y}reset(e){this.y=e,this.s=e}}class JC{constructor(e,t=1,i=0,n=1){d(this,"freq");d(this,"minCutOff");d(this,"beta");d(this,"dCutOff");d(this,"x");d(this,"dx");d(this,"lasttime");if(e<=0||t<=0||n<=0)throw new Error;this.freq=e,this.minCutOff=t,this.beta=i,this.dCutOff=n,this.x=new kN(this.alpha(this.minCutOff)),this.dx=new kN(this.alpha(this.dCutOff)),this.lasttime=null}alpha(e){const t=1/this.freq;return 1/(1+1/(2*Math.PI*e)/t)}filter(e,t=null){this.lasttime&&t&&(this.freq=1/(t-this.lasttime)),this.lasttime=t;const i=this.x.lastValue(),n=i?(e-i)*this.freq:0,r=this.dx.filter(n,this.alpha(this.dCutOff)),o=this.minCutOff+this.beta*Math.abs(r);return this.x.filter(e,this.alpha(o))}reset(e){e!=null&&this.x.reset(e),this.x.alpha=this.alpha(this.minCutOff),this.dx.alpha=this.alpha(this.dCutOff),this.lasttime=null}}class KL{constructor(e,t=1,i=0,n=1){d(this,"x");d(this,"y");d(this,"z");this.x=new JC(e,t,i,n),this.y=new JC(e,t,i,n),this.z=new JC(e,t,i,n)}filter(e,t,i=null){t.x=this.x.filter(e.x,i),t.y=this.y.filter(e.y,i),t.z=this.z.filter(e.z,i)}reset(e){this.x.reset(e==null?void 0:e.x),this.y.reset(e==null?void 0:e.y),this.z.reset(e==null?void 0:e.z)}}class nv extends fe{constructor(e,t,i,n=128){if(t<=0||i<=0||n<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const r=new cl(i,2*n,n);r.scale(1,1,-1);const o=r.getAttribute("position"),a=new S;for(let l=0;l<o.count;++l)if(a.fromBufferAttribute(o,l),a.y<0){const c=-t*3/2,h=a.y<c?-t/a.y:1-a.y*a.y/(3*c*c);a.multiplyScalar(h),a.toArray(o.array,3*l)}o.needsUpdate=!0,super(r,new ti({map:e,depthWrite:!1}))}}const ZC="needle:cameraController";function EQ(s){return s[ZC]}function O2(s,e,t){t?s[ZC]=e:s[ZC]===e&&(s[ZC]=null)}const L2="needle:autofit";function MQ(s){return s[L2]===void 0?!0:s[L2]!==!1}function k2(s,e){s[L2]=e}function Kre(s,e,t){const i=s.length(),n=e.length(),r=it.lerp(i,n,t);return s.lerp(e,t).normalize().multiplyScalar(r)}const JI=new Ce,Jre=new Ce().setFromAxisAngle(new S(0,1,0),Math.PI);function Zre(s,e){s.lookAt(e),s.quaternion.multiply(Jre)}function zb(s,e,t=!0,i=!1){if(s===e)return;JI.copy(s.quaternion);const n=Ft(e),r=Ft(s);if(i){if(rl(s,ki(e)),t){const o=r.y,a=r.sub($L(s));a.y=o,s.lookAt(a)}Number.isNaN(s.quaternion.x)&&s.quaternion.copy(JI);return}t&&(n.y=r.y),s.lookAt(n),Number.isNaN(s.quaternion.x)&&s.quaternion.copy(JI)}const $re=new ba(()=>new S,100);function wt(s,e,t){const i=$re.get();return i.set(0,0,0),s instanceof S?i.copy(s):s instanceof DOMPointReadOnly?i.set(s.x,s.y,s.z):(typeof s=="number"&&(i.x=s),typeof e=="number"&&(i.y=e),typeof t=="number"&&(i.z=t)),i}const eoe=new ba(()=>new Ae,30);function TQ(s){const e=eoe.get();return s?e.copy(s):e.set(0,0,0),e}const toe=new ba(()=>new Ce,100);function fc(s){const e=toe.get();return e.identity(),s instanceof Ce?e.copy(s):s instanceof DOMPointReadOnly&&e.set(s.x,s.y,s.z,s.w),e}const JL=new ba(()=>new S,100),FN=Symbol("lastMatrixWorldUpdateKey");function Ft(s,e=null,t=!0){const i=e??JL.get();return s?s.parent?(t&&s.updateWorldMatrix(!0,!1),s.matrixWorldNeedsUpdate&&s[FN]!==Date.now()&&(s[FN]=Date.now(),s.updateMatrixWorld()),i.setFromMatrixPosition(s.matrixWorld),i):i.copy(s.position):i.set(0,0,0)}function Es(s,e){if(!s)return s;const t=JL.get();return e!==t&&t.copy(e),((s==null?void 0:s.parent)??s).worldToLocal(t),s.position.set(t.x,t.y,t.z),s}function rm(s,e,t,i){const n=JL.get();return n.set(e,t,i),Es(s,n),s}const X1=new ba(()=>new Ce,100),Op=new Ce,ZI=new Ce;function ki(s,e=null){if(!s)return X1.get().identity();const t=e??X1.get();return s.parent?(s.getWorldQuaternion(t),t):t.copy(s.quaternion)}function rl(s,e){if(!s)return;e!==Op&&Op.copy(e);const t=Op,i=s==null?void 0:s.parent;i==null||i.getWorldQuaternion(ZI),ZI.invert();const n=ZI.multiply(t);s.quaternion.set(n.x,n.y,n.z,n.w)}function ZL(s,e,t,i,n){Op.set(e,t,i,n),rl(s,Op)}const ioe=new ba(()=>new S,100),noe=new S;function $i(s,e=null){return e||(e=ioe.get()),s?s.parent?(s.getWorldScale(e),e):e.copy(s.scale):e.set(0,0,0)}function sv(s,e){if(!s)return;if(!s.parent){s.scale.copy(e);return}const t=noe;s.parent.getWorldScale(t),s.scale.copy(e),s.scale.divide(t)}const soe=new S,UN=new Ce;function roe(s){return ki(s,UN),soe.set(0,0,1).applyQuaternion(UN)}const ooe=new ba(()=>new S,100),NN=new Ce;function $L(s,e){return e||(e=ooe.get().set(0,0,1)),ki(s,NN),e.applyQuaternion(NN)}const zN=new li,GN=new li,aoe=new S;function ek(s){const e=X1.get();return s.getWorldQuaternion(e),GN.setFromQuaternion(e),GN}function tk(s,e){const t=X1.get();rl(s,t.setFromEuler(e))}function Gb(s){const e=ek(s),t=aoe;return t.set(e.x,e.y,e.z),t.x=it.toDegrees(t.x),t.y=it.toDegrees(t.y),t.z=it.toDegrees(t.z),t}function ik(s,e){Hb(s,e.x,e.y,e.z,!0)}function Hb(s,e,t,i,n=!0){n&&(e=it.toRadians(e),t=it.toRadians(t),i=it.toRadians(i)),zN.set(e,t,i),Op.setFromEuler(zN),rl(s,Op)}function Y1(s,e=!0){s&&(e?function t(i){console.groupCollapsed((i.name?i.name:"(no name : "+i.type+")")+" %o",i),i.children.forEach(t),console.groupEnd()}(s):s.traverse(function(t){for(var i="|___",n=t;n.parent!==null;)i="	"+i,n=n.parent;console.log(i+t.name+" <"+t.type+">")}))}function loe(s){let e=(s==null?void 0:s.name)||"";if(!s)return e;let t=s.parent;for(;t;)e=t.name+"/"+e,t=t.parent;return e}function IQ(s){if(s){const e=s;return e.blendMode!==void 0&&e.clampWhenFinished!==void 0&&e.enabled!==void 0&&e.fadeIn!==void 0&&e.getClip!==void 0}return!1}class ja{static createBlitMaterial(e){return new kt({uniforms:{map:new Se(null)},vertexShader:this.vertex,fragmentShader:e})}static copyTexture(e,t){const i=t??this.blipMaterial;i.uniforms.map.value=e,i.needsUpdate=!0,i.uniformsNeedUpdate=!0,this.blipMaterial||(this.blipMaterial=new kt({uniforms:{map:new Se(null)},vertexShader:this.vertex,fragmentShader:this.fragment}));const n=i.vertexShader;i.vertexShader=this.vertex,this.mesh||(this.mesh=new fe(this.planeGeometry,this.blipMaterial));const r=this.mesh;r.material=i,r.frustumCulled=!1,this.scene.children.length=0,this.scene.add(r),this.renderer||(this.renderer=new hu({antialias:!1})),this.renderer.setSize(e.image.width,e.image.height),this.renderer.clear(),this.renderer.render(this.scene,this.perspectiveCam);const o=new Wt(this.renderer.domElement);return o.name="Copy",o.needsUpdate=!0,i.vertexShader=n,o}static textureToCanvas(e,t){if(!e)return null;(t===!0||e.isCompressedTexture===!0)&&(e=RQ(e));const i=e.image;if(hoe(i)){const n=document.createElement("canvas");n.width=i.width,n.height=i.height;const r=n.getContext("2d");return r?(r.drawImage(i,0,0,i.width,i.height,0,0,n.width,n.height),n):(console.error("Failed getting canvas 2d context"),null)}return null}}d(ja,"planeGeometry",new ps(2,2,1,1)),d(ja,"renderer"),d(ja,"perspectiveCam",new Vt),d(ja,"scene",new Ws),d(ja,"vertex",`
    varying vec2 vUv;
    void main(){
        vUv = uv;
        gl_Position = vec4(position.xy * 1.0,0.,.999999);
    }`),d(ja,"fragment",`
    uniform sampler2D map; 
    varying vec2 vUv;
    void main(){ 
        vec2 uv = vUv;
        uv.y = 1.0 - uv.y;
        gl_FragColor = texture2D( map, uv);
        // gl_FragColor = vec4(uv.xy, 0, 1);
    }`),d(ja,"blipMaterial"),d(ja,"mesh");function RQ(s){return ja.copyTexture(s)}function coe(s,e=!1){return ja.textureToCanvas(s,e)}function hoe(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&s instanceof ImageBitmap}function uoe(s){const e=s.type;return e==="Mesh"||e==="SkinnedMesh"}function nk(s,e){e?s["needle:rendercustomshadow"]=!0:s["needle:rendercustomshadow"]=!1}function PQ(s){if(s){if(s["needle:rendercustomshadow"]===!0)return!0;if(s["needle:rendercustomshadow"]==null)return!0}return!1}function Hl(s,e=void 0){const t=new jt;t.makeEmpty();const i=[];function n(o){let a=!0;if(o.visible&&MQ(o)!==!1&&!(o.type==="TransformControlsGizmo"||o.type==="TransformControlsPlane")){if(o instanceof bL&&(a=!1),o instanceof SM&&(a=!1),o instanceof nv&&(a=!1),o.isGizmo===!0&&(a=!1),o.material instanceof pM&&(a=!1),uoe(o)||(a=!1),a){if(e&&Array.isArray(e)&&(e!=null&&e.includes(o)))return;if(typeof e=="function"&&e(o)===!0)return}if(o.isUI!==!0){if(a){const l=o.children;o.children=i;const c=o.position,h=o.scale;if(Number.isNaN(c.x)||Number.isNaN(c.y)||Number.isNaN(c.z)){console.warn(`Object "${o.name}" has NaN values in position or scale.... will ignore it`,c,h);return}t.expandByObject(o,!0),o.children=l}for(const l of o.children)n(l)}}}let r=!1;for(const o of s)o&&(r=!0,o.updateMatrixWorld(),n(o));return r||console.warn("No objects to fit camera to..."),t}function BQ(s,e,t){const i=Hl([s],t==null?void 0:t.ignore),n=new S;i.getSize(n);const r=new S;i.getCenter(r);const o=new S;e.getSize(o);const a=new S;e.getCenter(a);const l=new S;l.set(o.x/n.x,o.y/n.y,o.z/n.z);const c=Math.min(l.x,l.y,l.z),h=(t==null?void 0:t.scale)!==!1;if(h&&sv(s,$i(s).multiplyScalar(c)),(t==null?void 0:t.position)!==!1){const u=new S;i.getCenter(u),u.y=i.min.y;const f=new S;e.getCenter(f),f.y=e.min.y;const p=f.clone().sub(u);h&&p.multiplyScalar(c),Es(s,Ft(s).add(p))}return{boundsBefore:i,scale:l}}function DQ(s,e){const t=Hl([s]),i=new S;t.getCenter(i),i.y=t.min.y;const n=e.clone().sub(i),r=Ft(s);return Es(s,r.add(n)),{offset:n,bounds:t}}function sk(s,e,t,i){if(Array.isArray(e)){let o=!0;for(let a=0;a<e.length;a++)sk(s,e[a],a,e)||(o=!1);return o}if(e.type==="MeshStandardMaterial")return!1;if(e["material:fbx"]!=null)return!0;const n=new ws;n["material:fbx"]=e;const r=e;return r&&(r.map?n.color.set(1,1,1):n.color.copyLinearToSRGB(r.color),n.emissive.copyLinearToSRGB(r.emissive),n.emissiveIntensity=r.emissiveIntensity,n.opacity=r.opacity,n.displacementScale=r.displacementScale,n.transparent=r.transparent,n.bumpMap=r.bumpMap,n.aoMap=r.aoMap,n.map=r.map,n.displacementMap=r.displacementMap,n.emissiveMap=r.emissiveMap,n.normalMap=r.normalMap,n.envMap=r.envMap,n.alphaMap=r.alphaMap,n.metalness=r.reflectivity,r.shininess&&(n.roughness=1-Math.sqrt(r.shininess)/10),n.needsUpdate=!0),t===void 0?s.material=n:i[t]=n,!0}let Hw=!1;die((...s)=>{var e;nt()&&((e=mi.Current)!=null&&e.isInXR)&&(Lp(!0),OQ("error",...s))});function Lp(s){if(s){if(Hw)return;Hw=!0,foe()}else{if(!Hw)return;Hw=!1,poe()}}const jA={log:void 0,warn:void 0,error:void 0};class doe{constructor(){d(this,"familyName","needle-xr");d(this,"root",null);d(this,"context",null);d(this,"defaultFontSize",.06);d(this,"targetObject",new ye);d(this,"userForwardViewPoint",new S);d(this,"oneEuroFilter",new KL(90,.8));d(this,"_lastElementRemoveTime",0);d(this,"onBeforeRender",()=>{var t,i;const e=(t=this.context)==null?void 0:t.mainCamera;if(this.context&&e instanceof Vt){const n=this.getRoot();Number.isNaN(n.position.x)&&n.position.set(0,0,0),Number.isNaN(n.quaternion.x)&&n.quaternion.set(0,0,0,1),this.context.scene.add(this.targetObject);const r=((i=this.context.xr)==null?void 0:i.rigScale)??1,o=3.5*r,a=e.worldForward;a.y=0,a.normalize().multiplyScalar(o),this.userForwardViewPoint.copy(e.worldPosition).sub(a),this.targetObject.position.distanceTo(this.userForwardViewPoint)>2*r&&(this.targetObject.position.copy(this.userForwardViewPoint),zb(this.targetObject,e,!0,!0),this.targetObject.rotateY(Math.PI)),this.oneEuroFilter.filter(this.targetObject.position,n.position,this.context.time.time);const c=this.context.time.deltaTime;if(n.quaternion.slerp(this.targetObject.quaternion,c*5),n.scale.setScalar(r),this.targetObject.removeFromParent(),this.context.scene.add(n),this.context.time.time-this._lastElementRemoveTime>.1){this._lastElementRemoveTime=this.context.time.time;const h=Date.now();for(let u=0;u<this._activeTexts.length;u++){const f=this._activeTexts[u];if(f instanceof Wi.Text&&h-f._activatedTime>2e4){f.removeFromParent(),this._textBuffer.push(f),this._activeTexts.splice(u,1);break}}}}});d(this,"textOptions",{fontSize:this.defaultFontSize,fontFamily:this.familyName,padding:.03,margin:.005,color:0,backgroundColor:16777215,backgroundOpacity:.4,borderRadius:.03,offset:.025});d(this,"_textBuffer",[]);d(this,"_activeTexts",[]);this.ensureFont()}onEnable(){this.context=mi.Current||mi.All[0],this.context.pre_render_callbacks.push(this.onBeforeRender)}onDisable(){var e,t,i;(t=this.context)==null||t.pre_render_callbacks.splice((e=this.context)==null?void 0:e.pre_render_callbacks.indexOf(this.onBeforeRender),1),(i=this.root)==null||i.removeFromParent()}addLog(e,t){const i=this.getRoot(),n=this.getText();let r=16777215,o=0;switch(e){case"log":r=16777215,o=0;break;case"warn":r=16772761,o=4465152;break;case"error":r=16755370,o=7798784;break}t.length>1e3&&(t=t.substring(0,1e3)+"...");const a=new Date().toISOString().split("T")[1].split(".")[0];n.textContent="["+a+"] "+t,n.visible=!0,n._activatedTime=Date.now(),i.add(n),this._activeTexts.push(n),this.context&&this.context.scene.add(i),n.set({backgroundColor:r,color:o}),Wi.update()}ensureFont(){let e=Wi.FontLibrary.getFontFamily(this.familyName);if(!e){e=Wi.FontLibrary.addFontFamily(this.familyName);const t=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");t==null||t.addEventListener("ready",()=>{Wi.update()})}}getText(){const e=this.getRoot();if(this._textBuffer.length>0){const i=this._textBuffer.pop();return i.visible=!0,setTimeout(()=>this.disableDepthTestRecursive(i),100),i}if(e.children.length>20&&this._activeTexts.length>0)return this._activeTexts.shift();const t=new Wi.Text(this.textOptions);return setTimeout(()=>this.disableDepthTestRecursive(t),500),setTimeout(()=>this.disableDepthTestRecursive(t),1500),t}disableDepthTestRecursive(e,t=0){for(let n=0;n<e.children.length;n++){const r=e.children[n];r instanceof ye&&this.disableDepthTestRecursive(r,t+1)}e.renderOrder=10*t,e.layers.set(2);const i=e.material;i&&(i.depthWrite=!1,i.depthTest=!1,i.transparent=!0),t===0&&Wi.update()}getRoot(){if(this.root)return this.root;const e=this.defaultFontSize,t={boxSizing:"border-box",fontFamily:this.familyName,width:"2.6",fontSize:e,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:0,whiteSpace:"pre-wrap",flexDirection:"column-reverse"};return this.root=new Wi.Block(t),this.root}}let co=null;function foe(){co||(co=new doe),co.onEnable();for(const s in jA){jA[s]=console[s];let e=!1;console[s]=function(){var t;if((t=jA[s])==null||t.apply(console,arguments),!e)try{e=!0,OQ(s,...arguments)}finally{e=!1}}}}function poe(){co==null||co.onDisable();for(const s in jA)console[s]=jA[s]}const b0=new Map;function OQ(s,...e){try{switch(b0.clear(),s){case"log":co==null||co.addLog("log",t());break;case"warn":co==null||co.addLog("warn",t());break;case"error":co==null||co.addLog("error",t());break}}catch(r){console.error("Error in spatial console",r)}finally{b0.clear()}function t(){let r="";for(let o=0;o<e.length;o++){const a=e[o];r+=i(a),o<e.length-1&&(r+=", ")}return r}function i(r,o=0){if(typeof r=="string")return'"'+r+'"';if(typeof r=="number"){if(r%1!==0){const l=r.toFixed(5),c=l.indexOf(".");let h=l.length-1;for(;h>c&&l[h]==="0";)h--;return l.substring(0,h+1)}return r.toString()}else if(Array.isArray(r)){let a="[";for(let l=0;l<r.length;l++){const c=r[l];a+=i(c,o+1),l<r.length-1&&(a+=", ")}return a+="]",a}else{if(r===null)return"null";if(r===void 0)return"undefined";if(typeof r=="function")return r.name+"()"}if(r instanceof ee)return`(${i(r.x)}, ${i(r.y)})`;if(r instanceof S)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)})`;if(r instanceof Je)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)}, ${i(r.w)})`;if(r instanceof Ce)return`(${i(r.x)}, ${i(r.y)}, ${i(r.z)}, ${i(r.w)})`;if(r instanceof Ht||r instanceof Wt)return r.name;if(r instanceof Ut)return`[${r.elements.join(", ")}]`;if(r instanceof le)return`[${r.elements.join(", ")}]`;if(r instanceof Vr)return r.mask.toString();if(typeof r=="object"){if(b0.has(r))return"*";let a=`{
`;a+=n(o);const l=Object.keys(r);let c="";for(let h=0;h<l.length;h++){const u=l[h],f=r[u];if(b0.has(f)){c+="";continue}b0.set(f,!0),c+=u+":"+i(f,o+1),h<l.length-1&&(c+=", "),c.length>=60&&(c+=`
`,c+=n(o),a+=c,c="")}return a+=c,a+=`
}`,a}return r}function n(r){let o="";for(let a=0;a<r;a++)o+=" ";return o}}const moe=ie("nodevlogs");function _n(s,e=la.Log){Cc(e,s)}function Fi(s){_n(s,la.Warn)}function DM(s){_n(s,la.Error)}let F2,$I;function nt(){if(moe)return!1;if(F2!==void 0)return F2;if($I!==void 0)return $I;let s=yo();return s||(s=window.location.hostname.endsWith(".local-credentialless.webcontainer.io")),$I=s,s}function goe(s){F2=s}let ca=null,sa=null,Ec=null,eR=!1,HN=null;const LQ="terminal",gA=ie("console"),yoe=ie("noerrors")||ie("noconsole");gA&&rk();if(!yoe&&(gA||yo())){if(yo()&&!gA){const e=new URL(window.location.href);e.searchParams.set("console","1"),console.log(' Tip: You can add the "?console" query parameter to the url to show the debug console (on mobile it will automatically open in the bottom right corner when your get errors during development. In VR a spatial console will appear.)',`
Open this page to get the console: `+e.toString())}const s=Wc()||MM()&&nt();if((s||gA)&&(mie(),FQ(),UQ(!0),s)){const e=document.querySelector("needle-engine");e==null||e.addEventListener("enter-ar",()=>{(gA||ca||CL()>0)&&ie("noerrors")}),e==null||e.addEventListener("exit-ar",()=>{boe()})}}const U2=Symbol("consoleParent");function rk(){if(ca!==null){ca.showSwitch();return}UQ()}function kQ(){ca!==null&&(ca.hide(),ca.hideSwitch())}function FQ(){HN||(HN=setInterval(voe,500))}let VN=0;function voe(){const s=CL(),e=s!==VN;VN=s,e&&Aoe()}function Aoe(){rk(),Ec&&(Ec.setAttribute("error","true"),Ec.innerText="")}function _oe(){Ec&&(Ec.removeAttribute("error"),Ec.innerText=LQ)}function boe(){sa&&sa[U2]&&sa[U2].appendChild(sa)}function UQ(s=!1){if(ca||eR)return;eR=!0;const e=document.createElement("script");e.onload=()=>{eR=!1,FQ(),ca=new VConsole({pluginOrder:["default","needle-console"]});const t=globalThis["needle:codegen_files"];if(t&&t.length>0&&ca.addPlugin(xoe()),sa=Soe(),sa&&(sa[U2]=sa.parentElement,sa.style.position="absolute",sa.style.zIndex=Number.MAX_SAFE_INTEGER.toString()),ca.setSwitchPosition(20,30),Ec=woe(),Ec){Ec.innerText=LQ,Ec.addEventListener("click",_oe);const i=document.createElement("style"),n=40;i.innerHTML=`
                #__vconsole .vc-switch {
                    border: 1px solid rgba(255, 255, 255, .1);
                    border-radius: 50%;
                    width: ${n}px;
                    height: ${n}px;
                    padding: 0;
                    line-height: ${n}px;
                    font-size: ${n*.4}px;
                    text-align: center;
                    background: #ffffff5c;
                    backdrop-filter: blur(16px);
                    -webkit-backdrop-filter: blur(16px);
                    user-select: none;
                    pointer-events: auto;
                    transition: transform .2s ease-in-out;
                    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);

                    font-family: 'Material Symbols Outlined';
                    color: black;
                    font-size: 2.3em;
                    font-weight: 100;
                }
                #__vconsole .vc-switch:hover {
                    cursor: pointer;
                    transform: scale(1.1);
                    transition: transform .1s ease-in-out, background .1s linear;
                    background: rgba(245, 245, 245, .8);
                    outline: rgba(0, 0, 0, .05) 1px solid;
                }
                #__vconsole .vc-switch[error] {
                    background: rgba(255,0,0,.2);
                    animation: vconsole-notify 1s ease-in-out;
                    line-height: 35px;
                }
                @keyframes vconsole-notify {
                    from {
                        transform: scale(1, 1);
                    }
                    10% {
                        transform: scale(1.3, 1.3);
                    }
                    70% {
                        transform: scale(1.4, 1.4);
                    }
                    to {
                        transform: scale(1, 1);
                    }
                }
                #__vconsole .vc-panel {
                    font-family: monospace;
                    font-size: 11px;
                }
                #__vconsole .vc-plugin-box.vc-actived {
                    height: 100%;
                }
                #__vconsole .vc-mask {
                    overflow: hidden;
                }
            `,sa==null||sa.prepend(i),s===!0&&CL()<=0&&kQ(),console.log(" Debug console has loaded")}},e.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",document.body.appendChild(e)}function xoe(){const s=new VConsole.VConsolePlugin("needle-console"," Inspect glTF"),e=()=>document.querySelector("#__vc_plug_"+s._id+" iframe");return s.on("renderTab",function(t){const i=globalThis["needle:codegen_files"];if(!i||i.length===0)return;let n=globalThis["needle:codegen_files"][0];const r=n.indexOf("?");r>-1&&(n=n.substring(0,r));const a=location.protocol+"//"+location.host+location.pathname+"/"+n,l=encodeURIComponent(a);s.fullUrl="https://viewer.needle.tools?inspect&file="+l;var c='<iframe src="" style="width: 100%; height: 99%; border: none;"></iframe>';t(c)}),s.on("show",function(){const t=e();t&&t.src!==s.fullUrl&&(t.src=s.fullUrl)}),s.on("hide",function(){const t=e();t&&(t.src="")}),s.on("addTopBar",function(t){var i=new Array;i.push({name:"Open in new window ",onClick:function(n){window.open(s.fullUrl,"_blank"),ca==null||ca.hide()}}),i.push({name:"Reload",onClick:function(n){const r=e();r&&(r.src=s.fullUrl)}}),i.push({name:"Fullscreen",onClick:function(n){const r=e();r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen instanceof Function&&r.webkitRequestFullscreen()}}),t(i)}),s}function woe(){const s=document.querySelector("#__vconsole .vc-switch");return s||null}function Soe(){const s=document.querySelector("#__vconsole");return s||null}const NQ=ie("debugdefines");wv('if(!globalThis[""3.47.2-beta.3""]) globalThis[""3.47.2-beta.3""] = "0.0.0";');wv('if(!globalThis[""undefined""]) globalThis[""undefined""] = "unknown";');wv('if(!globalThis[""Thu Aug 08 2024 15:10:59 GMT+0200 (Central European Summer Time)""]) globalThis[""Thu Aug 08 2024 15:10:59 GMT+0200 (Central European Summer Time)""] = "unknown";');wv('globalThis["__NEEDLE_ENGINE_VERSION__"] = "3.47.2-beta.3";');wv('globalThis["__NEEDLE_ENGINE_GENERATOR__"] = "undefined";');wv('globalThis["__NEEDLE_PROJECT_BUILD_TIME__"] = "Thu Aug 08 2024 15:10:59 GMT+0200 (Central European Summer Time)";');const tl="3.47.2-beta.3",OM="undefined",ok="Thu Aug 08 2024 15:10:59 GMT+0200 (Central European Summer Time)";NQ&&console.log(`Engine version: ${tl} (generator: ${OM})
Project built at ${ok}`);const $h="needle_isActiveInHierarchy",fp="builtin_components",qA="needle_editor_guid";function wv(s){try{(0,eval)(s)}catch(e){NQ&&console.error(e)}}const Coe='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 160 187.74"><defs><linearGradient id="a" x1="89.64" y1="184.81" x2="90.48" y2="21.85" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#62d399"/><stop offset=".51" stop-color="#acd842"/><stop offset=".9" stop-color="#d7db0a"/></linearGradient><linearGradient id="b" x1="69.68" y1="178.9" x2="68.08" y2="16.77" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0ba398"/><stop offset=".5" stop-color="#4ca352"/><stop offset="1" stop-color="#76a30a"/></linearGradient><linearGradient id="c" x1="36.6" y1="152.17" x2="34.7" y2="84.19" gradientUnits="userSpaceOnUse"><stop offset=".19" stop-color="#36a382"/><stop offset=".54" stop-color="#49a459"/><stop offset="1" stop-color="#76a30b"/></linearGradient><linearGradient id="d" x1="15.82" y1="153.24" x2="18" y2="90.86" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#267880"/><stop offset=".51" stop-color="#457a5c"/><stop offset="1" stop-color="#717516"/></linearGradient><linearGradient id="e" x1="135.08" y1="135.43" x2="148.93" y2="63.47" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b0d939"/><stop offset="1" stop-color="#eadb04"/></linearGradient><linearGradient id="f" x1="-4163.25" y1="2285.12" x2="-4160.81" y2="2215.34" gradientTransform="rotate(20 4088.49 13316.712)" gradientUnits="userSpaceOnUse"><stop offset=".17" stop-color="#74af52"/><stop offset=".48" stop-color="#99be32"/><stop offset="1" stop-color="#c0c40a"/></linearGradient><symbol id="g" viewBox="0 0 160 187.74"><path style="fill:url(#a)" d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75z"/><path style="fill:url(#b)" d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98z"/><path style="fill:url(#c)" d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z"/><path style="fill:url(#d)" d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04z"/><path style="fill:#9c3" d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5z"/><path style="fill:url(#e)" d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59z"/><path style="fill:url(#f)" d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z"/><path style="fill:#ffe113" d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1z"/><path style="fill:#f3e600" d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75z"/></symbol></defs><use width="160" height="187.74" xlink:href="#g"/></svg>',Eoe=btoa(Coe),Moe="data:image/svg+xml;base64,"+Eoe,Toe=Moe,Ioe=`<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'> <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" version="1.1" viewBox="0 0 1014 282" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m665.95 132.73v44.88l-10.56-8.4c-0.8-0.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18 0.4-6.06 1.2s-3.54 1.8-4.98 3-2.56 2.5-3.36 3.9-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c0.32 0.24 0.56 0.44 0.72 0.6s0.36 0.32 0.6 0.48c0.96-1.2 2.14-2.28 3.54-3.24s2.92-1.76 4.56-2.4 3.34-1.14 5.1-1.5 3.44-0.54 5.04-0.54c1.44 0 2.92 0.04 4.44 0.12s2.84 0.28 3.96 0.6c4.56 1.12 7.8 3.12 9.72 6s2.88 6.56 2.88 11.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m732.38 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m795.93 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m858.57 97.21c0.64 0.48 0.96 1.16 0.96 2.04v74.88c-0.08 1.04-0.12 2.12-0.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18s-2.06-1.66-2.46-1.98c-1.76 2.48-4.26 4.44-7.5 5.88s-7.02 2.16-11.34 2.16c-3.84 0-7.4-0.7-10.68-2.1s-6.14-3.44-8.58-6.12-4.34-5.94-5.7-9.78-2.04-8.16-2.04-12.96c0-4.32 0.78-8.34 2.34-12.06s3.6-6.92 6.12-9.6 5.38-4.78 8.58-6.3 6.48-2.28 9.84-2.28c2.56 0 4.82 0.22 6.78 0.66s3.68 1.06 5.16 1.86 2.78 1.74 3.9 2.82 2.16 2.22 3.12 3.42v-35.04l10.68 8.64zm-27.96 67.92c3.6 0 6.52-0.68 8.76-2.04s3.98-3.06 5.22-5.1 2.1-4.22 2.58-6.54 0.72-4.44 0.72-6.36v-1.2c0-1.12-0.22-2.7-0.66-4.74s-1.28-4.06-2.52-6.06-3-3.7-5.28-5.1-5.22-2.02-8.82-1.86c-3.44 0-6.26 0.74-8.46 2.22s-3.96 3.26-5.28 5.34-2.24 4.2-2.76 6.36-0.78 3.92-0.78 5.28c0 1.84 0.24 3.92 0.72 6.24s1.36 4.48 2.64 6.48 3.04 3.68 5.28 5.04 5.12 2.04 8.64 2.04z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m882.81 97.09c0.64 0.48 0.96 1.12 0.96 1.92l-0.12 41.04v37.08l-10.56-8.4c-0.72-0.64-1.08-1.44-1.08-2.4v-77.88l10.8 8.64z" fill-rule="nonzero"/> </g> <g transform="matrix(1.008 0 0 1.008 -2.239 .61874)"> <path d="m950.36 146.05c0 0.88 0.02 1.5 0.06 1.86s-0.02 0.98-0.18 1.86h-7.08c-2.08 0-4.44-0.02-7.08-0.06s-5.36-0.06-8.16-0.06h-22.08c0 2.88 0.56 5.36 1.68 7.44s2.6 3.8 4.44 5.16 3.94 2.36 6.3 3 4.74 0.96 7.14 0.96c3.04 0 5.9-0.76 8.58-2.28s4.94-3.52 6.78-6c0.64 0.56 1.54 1.48 2.7 2.76s2.94 3.2 5.34 5.76c-2.8 3.36-6.22 6.02-10.26 7.98s-8.42 2.94-13.14 2.94-8.92-0.64-12.84-1.92-7.32-3.24-10.2-5.88-5.12-5.98-6.72-10.02-2.4-8.82-2.4-14.34c0-4.96 0.66-9.42 1.98-13.38s3.22-7.32 5.7-10.08 5.44-4.9 8.88-6.42 7.32-2.28 11.64-2.28c5.76 0 10.52 0.88 14.28 2.64s6.72 4.16 8.88 7.2 3.66 6.54 4.5 10.5 1.26 8.18 1.26 12.66zm-29.4-22.8c-2.16 0.16-4.16 0.72-6 1.68s-3.42 2.2-4.74 3.72-2.36 3.28-3.12 5.28-1.14 4.12-1.14 6.36h33.12c0-2-0.22-4.06-0.66-6.18s-1.3-4.02-2.58-5.7-3.1-3.02-5.46-4.02-5.5-1.38-9.42-1.14z" fill-rule="nonzero"/> </g> <g transform="matrix(1.8559 0 0 .7642 45.348 36.475)"> <g transform="translate(2.7114)"> <path d="m3.935 173.02c-0.331 0-0.497-0.402-0.497-1.207v-51.002c0-0.738 0.138-1.107 0.414-1.107h1.781c0.277 0 0.415 0.335 0.415 1.006v5.935c0 0.336 0.027 0.553 0.083 0.654 0.055 0.101 0.151-0.017 0.289-0.352 0.912-1.744 1.754-3.236 2.527-4.477 0.773-1.24 1.554-2.179 2.341-2.816s1.65-0.956 2.588-0.956c1.685 0 3.011 0.922 3.977 2.766 0.967 1.845 1.602 3.84 1.905 5.986 0.056 0.268 0.139 0.369 0.249 0.302s0.221-0.235 0.331-0.503c0.939-1.811 1.802-3.353 2.589-4.628 0.787-1.274 1.581-2.246 2.382-2.917s1.671-1.006 2.61-1.006c2.016 0 3.569 1.392 4.66 4.175 1.09 2.783 1.636 6.421 1.636 10.915v37.925c0 0.871-0.18 1.307-0.539 1.307h-1.739c-0.138 0-0.249-0.1-0.332-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.338-6.321-1.015-8.3-0.676-1.978-1.76-2.967-3.251-2.967-0.884 0-1.726 0.386-2.527 1.157s-1.519 1.727-2.154 2.867-1.201 2.213-1.699 3.219c-0.248 0.469-0.421 0.905-0.517 1.308-0.097 0.402-0.145 0.972-0.145 1.71v37.221c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.166 0-0.29-0.1-0.373-0.301-0.083-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.332-6.321-0.994-8.3-0.663-1.978-1.754-2.967-3.273-2.967-1.242 0-2.375 0.704-3.396 2.112-1.022 1.409-2.223 3.555-3.604 6.439v39.031c0 0.805-0.18 1.207-0.539 1.207h-1.698z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m53.642 166.28c-1.077 2.549-2.237 4.477-3.479 5.785-1.243 1.307-2.61 1.961-4.101 1.961-2.154 0-3.853-1.324-5.095-3.973-1.243-2.649-1.864-6.187-1.864-10.613 0-3.488 0.4-6.489 1.201-9.004s1.988-4.51 3.562-5.985c1.574-1.476 3.521-2.414 5.841-2.817l3.686-0.704c0.221-0.067 0.394-0.218 0.518-0.453 0.124-0.234 0.187-0.587 0.187-1.056v-2.917c0-3.89-0.504-6.975-1.512-9.255s-2.354-3.42-4.039-3.42c-1.298 0-2.472 0.72-3.521 2.162s-2.002 3.572-2.858 6.388c-0.083 0.268-0.159 0.453-0.228 0.554-0.069 0.1-0.172 0.083-0.311-0.051l-1.698-1.71c-0.083-0.134-0.138-0.285-0.166-0.453-0.027-0.167 0.014-0.452 0.125-0.855 0.856-3.353 2.009-6.052 3.459-8.098 1.449-2.045 3.224-3.068 5.322-3.068 1.74 0 3.211 0.687 4.412 2.062s2.112 3.37 2.734 5.986c0.621 2.615 0.932 5.7 0.932 9.255v35.712c0 0.536-0.035 0.888-0.104 1.056s-0.2 0.251-0.393 0.251h-1.533c-0.166 0-0.29-0.117-0.373-0.352-0.083-0.234-0.124-0.553-0.124-0.955l-0.083-5.231c-0.055-0.939-0.221-1.006-0.497-0.202zm0.456-19.314c0-1.14-0.194-1.643-0.58-1.509l-3.107 0.603c-1.436 0.202-2.686 0.638-3.749 1.308-1.063 0.671-1.953 1.543-2.671 2.616s-1.257 2.33-1.616 3.772-0.538 3.102-0.538 4.98c0 3.152 0.455 5.616 1.367 7.393 0.911 1.778 2.14 2.666 3.686 2.666 0.939 0 1.85-0.419 2.734-1.257s1.671-1.895 2.361-3.169c0.663-1.408 1.181-2.85 1.553-4.326 0.373-1.475 0.56-2.883 0.56-4.225v-8.852z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m79.034 173.02c-0.166 0-0.297-0.117-0.394-0.352-0.096-0.234-0.145-0.553-0.145-0.955v-4.628c0-0.536-0.041-0.838-0.124-0.905s-0.207 0.1-0.373 0.503c-0.276 0.67-0.69 1.593-1.242 2.766-0.553 1.174-1.271 2.23-2.154 3.169-0.884 0.939-1.961 1.408-3.231 1.408-1.74 0-3.314-0.989-4.722-2.967-1.409-1.979-2.534-4.963-3.376-8.953-0.843-3.991-1.264-8.937-1.264-14.838 0-5.701 0.415-10.68 1.243-14.939s1.988-7.595 3.479-10.009c1.492-2.415 3.204-3.622 5.137-3.622 1.436 0 2.616 0.57 3.541 1.71 0.926 1.14 1.719 2.381 2.382 3.722 0.249 0.47 0.414 0.637 0.497 0.503s0.125-0.536 0.125-1.207v-23.841c0-0.805 0.151-1.208 0.455-1.208h1.864c0.276 0 0.414 0.369 0.414 1.107v72.128c0 0.537-0.041 0.905-0.124 1.107-0.083 0.201-0.235 0.301-0.455 0.301h-1.533zm-0.621-42.049c-0.939-2.213-1.885-3.94-2.838-5.181s-2.009-1.861-3.169-1.861c-1.463 0-2.768 0.889-3.914 2.666s-2.044 4.376-2.693 7.796-0.973 7.578-0.973 12.474c0 5.097 0.338 9.272 1.015 12.524 0.676 3.253 1.567 5.651 2.672 7.193 1.104 1.543 2.305 2.314 3.603 2.314 1.188 0 2.258-0.704 3.211-2.113 0.952-1.408 1.705-3.118 2.257-5.13s0.829-3.957 0.829-5.835v-24.847z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m89.514 149.38c0 3.42 0.345 6.606 1.035 9.557 0.691 2.951 1.609 5.315 2.755 7.092s2.437 2.666 3.873 2.666c1.519 0 2.837-0.738 3.956-2.213 1.118-1.476 2.064-3.655 2.837-6.539 0.083-0.336 0.166-0.52 0.249-0.554 0.083-0.033 0.179 0.017 0.29 0.151l1.408 1.912c0.221 0.268 0.235 0.67 0.041 1.207-0.69 2.548-1.47 4.661-2.34 6.337-0.87 1.677-1.857 2.935-2.962 3.773-1.104 0.838-2.319 1.257-3.645 1.257-2.043 0-3.838-1.14-5.385-3.42-1.546-2.28-2.761-5.482-3.645-9.607-0.884-4.124-1.325-8.836-1.325-14.134 0-5.901 0.455-10.931 1.367-15.089 0.911-4.158 2.14-7.377 3.686-9.658 1.547-2.28 3.3-3.42 5.261-3.42 1.988 0 3.714 1.073 5.178 3.219 1.463 2.146 2.595 5.231 3.396 9.255s1.201 8.886 1.201 14.587c0 0.469-0.02 0.939-0.062 1.408-0.041 0.469-0.214 0.704-0.517 0.704h-16.362c-0.083 0-0.152 0.151-0.207 0.453-0.056 0.302-0.083 0.654-0.083 1.056zm13.752-6.237c0.304 0 0.497-0.1 0.58-0.302 0.083-0.201 0.124-0.57 0.124-1.106 0-3.219-0.283-6.187-0.849-8.903s-1.367-4.896-2.402-6.539c-1.036-1.643-2.272-2.464-3.708-2.464-1.629 0-2.996 0.955-4.101 2.867-1.104 1.911-1.94 4.342-2.506 7.293s-0.849 6.002-0.849 9.154h13.711z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m148.54 119.7c0.165 0 0.283 0.117 0.352 0.352s0.076 0.52 0.02 0.855l-6.254 50.902c-0.028 0.47-0.104 0.788-0.228 0.956s-0.297 0.251-0.518 0.251h-1.615c-0.442 0-0.718-0.402-0.829-1.207l-5.26-40.138c-0.111-0.604-0.201-0.905-0.27-0.905s-0.131 0.301-0.186 0.905l-5.012 40.138c-0.028 0.47-0.097 0.788-0.207 0.956-0.111 0.168-0.277 0.251-0.497 0.251h-1.74c-0.442 0-0.718-0.402-0.829-1.207l-6.503-50.801c-0.055-0.403-0.048-0.721 0.021-0.956s0.2-0.352 0.393-0.352h1.823c0.166 0 0.297 0.067 0.393 0.201 0.097 0.134 0.159 0.403 0.187 0.805l5.302 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.219-41.949c0.055-0.268 0.124-0.47 0.207-0.604s0.193-0.201 0.331-0.201h1.533c0.138 0 0.262 0.067 0.373 0.201 0.11 0.134 0.179 0.403 0.207 0.805l5.468 41.848c0.083 0.671 0.179 0.989 0.29 0.956 0.11-0.034 0.207-0.386 0.29-1.056l5.053-41.849c0.055-0.335 0.138-0.57 0.249-0.704 0.11-0.134 0.234-0.201 0.373-0.201h1.284z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m156.49 171.51c0 0.604-0.042 1.006-0.125 1.208-0.082 0.201-0.262 0.301-0.538 0.301h-1.533c-0.221 0-0.366-0.083-0.435-0.251s-0.103-0.486-0.103-0.956v-50.902c0-0.805 0.152-1.207 0.456-1.207h1.822c0.304 0 0.456 0.402 0.456 1.207v50.6zm0.165-63.979c0 1.207-0.207 1.811-0.621 1.811h-1.905c-0.221 0-0.366-0.135-0.435-0.403s-0.104-0.67-0.104-1.207v-7.847c0-1.006 0.18-1.509 0.539-1.509h1.988c0.359 0 0.538 0.47 0.538 1.409v7.746z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m168.3 124.83c-0.221 0-0.331 0.269-0.331 0.805v33.801c0 3.42 0.221 5.667 0.663 6.74 0.441 1.073 1.09 1.609 1.946 1.609h3.024c0.138 0 0.242 0.084 0.311 0.252 0.069 0.167 0.103 0.419 0.103 0.754v2.716c0 0.537-0.138 0.906-0.414 1.107-0.248 0.067-0.614 0.134-1.098 0.201-0.483 0.067-0.959 0.118-1.429 0.151-0.469 0.034-0.828 0.05-1.077 0.05-1.712 0-2.934-0.955-3.665-2.867-0.732-1.911-1.098-5.013-1.098-9.305v-35.108c0-0.604-0.124-0.906-0.373-0.906h-3.521c-0.248 0-0.373-0.268-0.373-0.804v-3.521c0-0.537 0.111-0.805 0.332-0.805h3.686c0.166 0 0.263-0.268 0.29-0.805l0.415-16.095c0-0.805 0.124-1.207 0.372-1.207h1.492c0.303 0 0.455 0.436 0.455 1.307v15.995c0 0.537 0.097 0.805 0.29 0.805h5.468c0.221 0 0.331 0.268 0.331 0.805v3.521c0 0.536-0.124 0.804-0.373 0.804h-5.426z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> <g transform="translate(2.7114)"> <path d="m179.4 173.02c-0.331 0-0.497-0.402-0.497-1.207v-72.329c0-0.738 0.138-1.107 0.414-1.107h1.782c0.276 0 0.414 0.336 0.414 1.006v27.162c0 0.335 0.034 0.536 0.103 0.603s0.159-0.033 0.27-0.302c0.994-1.81 1.898-3.319 2.713-4.526 0.814-1.208 1.629-2.113 2.444-2.717 0.814-0.603 1.691-0.905 2.63-0.905 2.182 0 3.839 1.375 4.971 4.125 1.132 2.749 1.698 6.404 1.698 10.965v37.925c0 0.871-0.166 1.307-0.497 1.307h-1.74c-0.165 0-0.29-0.1-0.373-0.301-0.082-0.202-0.124-0.503-0.124-0.906v-36.315c0-3.555-0.366-6.321-1.097-8.3-0.732-1.978-1.899-2.967-3.501-2.967-0.883 0-1.705 0.318-2.464 0.956-0.76 0.637-1.526 1.576-2.299 2.816-0.773 1.241-1.643 2.834-2.61 4.779v39.031c0 0.805-0.179 1.207-0.538 1.207h-1.699z" fill-rule="nonzero" stroke="#000" stroke-width=".7px"/> </g> </g> <g transform="matrix(.80638 0 0 .80638 452.53 65.421)" fill-rule="nonzero"> <path d="m79.32 36.98v150.76l15.68-13.2 6.59-156.31-22.27 18.75z" fill="url(#f)"/> <path d="m79.32 36.98-22.27-18.75 6.59 156.31 15.68 13.2v-150.76z" fill="url(#e)"/> <path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33z" fill="url(#d)"/> <path d="m25.19 104.83-25.19-14.59 16.97 53.86 16.85 9.77-8.63-49.04z" fill="url(#c)"/> <path d="M43.86,82.5L18.69,67.98L0,90.24L25.18,104.83L43.86,82.5Z" fill="#9c3"/> <path d="m134.82 78.69-9.97 56.5 15.58-9.04 19.57-62.05-25.18 14.59z" fill="url(#b)"/> <path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5z" fill="url(#a)"/> <path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33 25.19-14.59z" fill="#ffe113"/> <path d="M101.59,18.23L79.32,0L57.05,18.23L79.32,36.98L101.59,18.23Z" fill="#f3e600"/> </g> <defs> <linearGradient id="f" x2="1" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)" gradientUnits="userSpaceOnUse"><stop stop-color="#62d399" offset="0"/><stop stop-color="#acd842" offset=".51"/><stop stop-color="#d7db0a" offset=".9"/><stop stop-color="#d7db0a" offset="1"/></linearGradient> <linearGradient id="e" x2="1" gradientTransform="matrix(-1.6,-162.13,162.13,-1.6,69.68,178.9)" gradientUnits="userSpaceOnUse"><stop stop-color="#0ba398" offset="0"/><stop stop-color="#4ca352" offset=".5"/><stop stop-color="#76a30a" offset="1"/></linearGradient> <linearGradient id="d" x2="1" gradientTransform="matrix(-1.9,-67.98,67.98,-1.9,36.6,152.17)" gradientUnits="userSpaceOnUse"><stop stop-color="#36a382" offset="0"/><stop stop-color="#36a382" offset=".19"/><stop stop-color="#49a459" offset=".54"/><stop stop-color="#76a30b" offset="1"/></linearGradient> <linearGradient id="c" x2="1" gradientTransform="matrix(2.18,-62.38,62.38,2.18,15.82,153.24)" gradientUnits="userSpaceOnUse"><stop stop-color="#267880" offset="0"/><stop stop-color="#457a5c" offset=".51"/><stop stop-color="#717516" offset="1"/></linearGradient> <linearGradient id="b" x2="1" gradientTransform="matrix(13.85,-71.96,71.96,13.85,135.08,135.43)" gradientUnits="userSpaceOnUse"><stop stop-color="#b0d939" offset="0"/><stop stop-color="#eadb04" offset="1"/></linearGradient> <linearGradient id="a" x2="1" gradientTransform="matrix(26.159 -64.737 64.737 26.159 107.42 128.14)" gradientUnits="userSpaceOnUse"><stop stop-color="#74af52" offset="0"/><stop stop-color="#74af52" offset=".17"/><stop stop-color="#99be32" offset=".48"/><stop stop-color="#c0c40a" offset="1"/></linearGradient> </defs> </svg>`;btoa(Ioe);const Roe='<svg viewBox="0 0 509 154" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M665.95 132.73v44.88l-10.56-8.4c-.8-.64-1.2-1.44-1.2-2.4v-32.4c0-6.48-4.12-9.72-12.36-9.72-2.16 0-4.18.4-6.06 1.2-1.88.8-3.54 1.8-4.98 3-1.44 1.2-2.56 2.5-3.36 3.9-.8 1.4-1.2 2.7-1.2 3.9v40.92l-10.68-8.4c-.72-.64-1.08-1.44-1.08-2.4v-53.76l10.92 8.52c.32.24.56.44.72.6.16.16.36.32.6.48.96-1.2 2.14-2.28 3.54-3.24 1.4-.96 2.92-1.76 4.56-2.4 1.64-.64 3.34-1.14 5.1-1.5 1.76-.36 3.44-.54 5.04-.54 1.44 0 2.92.04 4.44.12 1.52.08 2.84.28 3.96.6 4.56 1.12 7.8 3.12 9.72 6 1.92 2.88 2.88 6.56 2.88 11.04ZM732.38 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM795.93 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14ZM858.57 97.21c.64.48.96 1.16.96 2.04v74.88c-.08 1.04-.12 2.12-.12 3.24-1.84-1.52-3.56-2.92-5.16-4.2-1.36-1.12-2.66-2.18-3.9-3.18-1.24-1-2.06-1.66-2.46-1.98-1.76 2.48-4.26 4.44-7.5 5.88-3.24 1.44-7.02 2.16-11.34 2.16-3.84 0-7.4-.7-10.68-2.1-3.28-1.4-6.14-3.44-8.58-6.12-2.44-2.68-4.34-5.94-5.7-9.78-1.36-3.84-2.04-8.16-2.04-12.96 0-4.32.78-8.34 2.34-12.06 1.56-3.72 3.6-6.92 6.12-9.6 2.52-2.68 5.38-4.78 8.58-6.3 3.2-1.52 6.48-2.28 9.84-2.28 2.56 0 4.82.22 6.78.66 1.96.44 3.68 1.06 5.16 1.86s2.78 1.74 3.9 2.82a35.92 35.92 0 0 1 3.12 3.42V88.57l10.68 8.64Zm-27.96 67.92c3.6 0 6.52-.68 8.76-2.04 2.24-1.36 3.98-3.06 5.22-5.1a20.5 20.5 0 0 0 2.58-6.54c.48-2.32.72-4.44.72-6.36v-1.2c0-1.12-.22-2.7-.66-4.74-.44-2.04-1.28-4.06-2.52-6.06s-3-3.7-5.28-5.1c-2.28-1.4-5.22-2.02-8.82-1.86-3.44 0-6.26.74-8.46 2.22-2.2 1.48-3.96 3.26-5.28 5.34-1.32 2.08-2.24 4.2-2.76 6.36-.52 2.16-.78 3.92-.78 5.28 0 1.84.24 3.92.72 6.24.48 2.32 1.36 4.48 2.64 6.48s3.04 3.68 5.28 5.04c2.24 1.36 5.12 2.04 8.64 2.04ZM882.81 97.09c.64.48.96 1.12.96 1.92l-.12 41.04v37.08l-10.56-8.4c-.72-.64-1.08-1.44-1.08-2.4V88.45l10.8 8.64ZM950.36 146.05c0 .88.02 1.5.06 1.86.04.36-.02.98-.18 1.86h-7.08c-2.08 0-4.44-.02-7.08-.06-2.64-.04-5.36-.06-8.16-.06h-22.08c0 2.88.56 5.36 1.68 7.44 1.12 2.08 2.6 3.8 4.44 5.16 1.84 1.36 3.94 2.36 6.3 3 2.36.64 4.74.96 7.14.96 3.04 0 5.9-.76 8.58-2.28 2.68-1.52 4.94-3.52 6.78-6 .64.56 1.54 1.48 2.7 2.76 1.16 1.28 2.94 3.2 5.34 5.76-2.8 3.36-6.22 6.02-10.26 7.98-4.04 1.96-8.42 2.94-13.14 2.94-4.72 0-8.92-.64-12.84-1.92-3.92-1.28-7.32-3.24-10.2-5.88-2.88-2.64-5.12-5.98-6.72-10.02-1.6-4.04-2.4-8.82-2.4-14.34 0-4.96.66-9.42 1.98-13.38 1.32-3.96 3.22-7.32 5.7-10.08s5.44-4.9 8.88-6.42c3.44-1.52 7.32-2.28 11.64-2.28 5.76 0 10.52.88 14.28 2.64 3.76 1.76 6.72 4.16 8.88 7.2 2.16 3.04 3.66 6.54 4.5 10.5.84 3.96 1.26 8.18 1.26 12.66Zm-29.4-22.8c-2.16.16-4.16.72-6 1.68-1.84.96-3.42 2.2-4.74 3.72-1.32 1.52-2.36 3.28-3.12 5.28-.76 2-1.14 4.12-1.14 6.36h33.12c0-2-.22-4.06-.66-6.18-.44-2.12-1.3-4.02-2.58-5.7-1.28-1.68-3.1-3.02-5.46-4.02-2.36-1-5.5-1.38-9.42-1.14Z" style="fill-rule:nonzero" transform="translate(-452.406 -63.709) scale(1.00797)"/><path d="M79.32 36.98v150.76L95 174.54l6.59-156.31-22.27 18.75Z" style="fill:url(#a);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M79.32 36.98 57.05 18.23l6.59 156.31 15.68 13.2V36.98Z" style="fill:url(#b);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m25.19 104.83 8.63 49.04 12.5-14.95-2.46-56.42-18.67 22.33Z" style="fill:url(#c);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M25.19 104.83 0 90.24l16.97 53.86 16.85 9.77-8.63-49.04Z" style="fill:url(#d);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M43.86 82.5 18.69 67.98 0 90.24l25.18 14.59L43.86 82.5Z" style="fill:#9c3;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-9.97 56.5 15.58-9.04L160 64.1l-25.18 14.59Z" style="fill:url(#e);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m134.82 78.69-18.68-22.33-2.86 65 11.57 13.83 9.97-56.5Z" style="fill:url(#f);fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="m160 64.1-18.69-22.26-25.17 14.52 18.67 22.33L160 64.1Z" style="fill:#ffe113;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><path d="M101.59 18.23 79.32 0 57.05 18.23l22.27 18.75 22.27-18.75Z" style="fill:#f3e600;fill-rule:nonzero" transform="matrix(.80638 0 0 .80638 2.361 1.094)"/><defs><linearGradient id="a" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="matrix(.84 -162.96 162.96 .84 89.64 184.81)"><stop offset="0" style="stop-color:#62d399;stop-opacity:1"/><stop offset=".51" style="stop-color:#acd842;stop-opacity:1"/><stop offset=".9" style="stop-color:#d7db0a;stop-opacity:1"/><stop offset="1" style="stop-color:#d7db0a;stop-opacity:1"/></linearGradient><linearGradient id="b" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-90.565 123.412 54.953) scale(162.14)"><stop offset="0" style="stop-color:#0ba398;stop-opacity:1"/><stop offset=".5" style="stop-color:#4ca352;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30a;stop-opacity:1"/></linearGradient><linearGradient id="c" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="scale(-68) rotate(88.4 .881 -1.396)"><stop offset="0" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".19" style="stop-color:#36a382;stop-opacity:1"/><stop offset=".54" style="stop-color:#49a459;stop-opacity:1"/><stop offset="1" style="stop-color:#76a30b;stop-opacity:1"/></linearGradient><linearGradient id="d" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-88 87.255 68.431) scale(62.42)"><stop offset="0" style="stop-color:#267880;stop-opacity:1"/><stop offset=".51" style="stop-color:#457a5c;stop-opacity:1"/><stop offset="1" style="stop-color:#717516;stop-opacity:1"/></linearGradient><linearGradient id="e" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-79.1 149.53 -14.065) scale(73.28)"><stop offset="0" style="stop-color:#b0d939;stop-opacity:1"/><stop offset="1" style="stop-color:#eadb04;stop-opacity:1"/></linearGradient><linearGradient id="f" x1="0" y1="0" x2="1" y2="0" gradientUnits="userSpaceOnUse" gradientTransform="rotate(-67.997 148.705 -15.558) scale(69.8226)"><stop offset="0" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".17" style="stop-color:#74af52;stop-opacity:1"/><stop offset=".48" style="stop-color:#99be32;stop-opacity:1"/><stop offset="1" style="stop-color:#c0c40a;stop-opacity:1"/></linearGradient></defs></svg>',Poe=btoa(Roe),Boe="data:image/svg+xml;charset=utf-8;base64,"+Poe,Doe=Boe;/**
 * postprocessing v6.35.5 build Sat Jun 01 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rschen
 * @license Zlib
 */var tR=1/1e3,Ooe=1e3,Loe=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(s){typeof document<"u"&&document.hidden!==void 0&&(s?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=s)}get delta(){return this._delta*tR}get fixedDelta(){return this._fixedDelta*tR}set fixedDelta(s){this._fixedDelta=s*Ooe}get elapsed(){return this._elapsed*tR}update(s){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(s!==void 0?s:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(s){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},koe=new Tb,Du=null;function Foe(){if(Du===null){const s=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);Du=new yt,Du.setAttribute!==void 0?(Du.setAttribute("position",new Ke(s,3)),Du.setAttribute("uv",new Ke(e,2))):(Du.addAttribute("position",new Ke(s,3)),Du.addAttribute("uv",new Ke(e,2)))}return Du}var _r=class zQ{constructor(e="Pass",t=new Ws,i=koe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new fe(Foe(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Ws),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=gr){}render(e,t,i,n,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof $t||t instanceof Ht||t instanceof Wt||t instanceof zQ)&&this[e].dispose()}}},Uoe=class extends _r{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(s,e,t,i,n){const r=s.state.buffers.stencil;r.setLocked(!1),r.setTest(!1)}},Noe=Number(su.replace(/\D+/g,""));function Sv(s){return Noe<154?s.replace("colorspace_fragment","encodings_fragment"):s}var zoe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,mm="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",GQ=class extends kt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Se(null),opacity:new Se(1)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zoe,vertexShader:mm}),this.fragmentShader=Sv(this.fragmentShader)}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}getOpacity(s){return this.uniforms.opacity.value}setOpacity(s){this.uniforms.opacity.value=s}},HQ=class extends _r{constructor(s,e=!0){super("CopyPass"),this.fullscreenMaterial=new GQ,this.needsSwap=!1,this.renderTarget=s,s===void 0&&(this.renderTarget=new $t(1,1,{minFilter:Nt,magFilter:Nt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(s){this.autoResize=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(s){this.autoResize=s}render(s,e,t,i,n){this.fullscreenMaterial.inputBuffer=e.texture,s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,e){this.autoResize&&this.renderTarget.setSize(s,e)}initialize(s,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==wn?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":s!==null&&s.outputColorSpace===bt&&(this.renderTarget.texture.colorSpace=bt))}},QN=new Ae,LM=class extends _r{constructor(s=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=s,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(s,e,t){this.color=s,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(s){this.overrideClearColor=s}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(s){this.overrideClearAlpha=s}render(s,e,t,i,n){const r=this.overrideClearColor,o=this.overrideClearAlpha,a=s.getClearAlpha(),l=r!==null,c=o>=0;l?(s.getClearColor(QN),s.setClearColor(r,c?o:a)):c&&s.setClearAlpha(o),s.setRenderTarget(this.renderToScreen?null:e),s.clear(this.color,this.depth,this.stencil),l?s.setClearColor(QN,a):c&&s.setClearAlpha(a)}},Goe=class extends _r{constructor(s,e){super("MaskPass",s,e),this.needsSwap=!1,this.clearPass=new LM(!1,!1,!0),this.inverse=!1}set mainScene(s){this.scene=s}set mainCamera(s){this.camera=s}get inverted(){return this.inverse}set inverted(s){this.inverse=s}get clear(){return this.clearPass.enabled}set clear(s){this.clearPass.enabled=s}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(s){this.inverted=s}render(s,e,t,i,n){const r=s.getContext(),o=s.state.buffers,a=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,u=1-h;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.stencil.setFunc(r.ALWAYS,h,4294967295),o.stencil.setClear(u),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(s,null):(c.render(s,e),c.render(s,t))),this.renderToScreen?(s.setRenderTarget(null),s.render(a,l)):(s.setRenderTarget(e),s.render(a,l),s.setRenderTarget(t),s.render(a,l)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(r.EQUAL,1,4294967295),o.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.stencil.setLocked(!0)}},ak=class{constructor(s=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:i=0,frameBufferType:n}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,n,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new HQ,this.depthTexture=null,this.passes=[],this.timer=new Loe,this.autoRenderToScreen=!0,this.setRenderer(s)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(s){const e=this.inputBuffer,t=this.multisampling;t>0&&s>0?(this.inputBuffer.samples=s,this.outputBuffer.samples=s,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==s&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,s),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(s){if(this.renderer=s,s!==null){const e=s.getSize(new ee),t=s.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===wn&&s.outputColorSpace===bt&&(this.inputBuffer.texture.colorSpace=bt,this.outputBuffer.texture.colorSpace=bt,this.inputBuffer.dispose(),this.outputBuffer.dispose()),s.autoClear=!1,this.setSize(e.width,e.height);for(const n of this.passes)n.initialize(s,t,i)}}replaceRenderer(s,e=!0){const t=this.renderer,i=t.domElement.parentNode;return this.setRenderer(s),e&&i!==null&&(i.removeChild(t.domElement),i.appendChild(s.domElement)),t}createDepthTexture(){const s=this.depthTexture=new Av;return this.inputBuffer.depthTexture=s,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(s.format=Gd,s.type=Kh):s.type=Hr,s}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const s of this.passes)s.setDepthTexture(null)}}createBuffer(s,e,t,i){const n=this.renderer,r=n===null?new ee:n.getDrawingBufferSize(new ee),o={minFilter:Nt,magFilter:Nt,stencilBuffer:e,depthBuffer:s,type:t},a=new $t(r.width,r.height,o);return i>0&&(a.ignoreDepthForMultisampleCopy=!1,a.samples=i),t===wn&&n!==null&&n.outputColorSpace===bt&&(a.texture.colorSpace=bt),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(s){for(const e of this.passes)e.mainScene=s}setMainCamera(s){for(const e of this.passes)e.mainCamera=s}addPass(s,e){const t=this.passes,i=this.renderer,n=i.getDrawingBufferSize(new ee),r=i.getContext().getContextAttributes().alpha,o=this.inputBuffer.texture.type;if(s.setRenderer(i),s.setSize(n.width,n.height),s.initialize(i,r,o),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),s.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,s):t.push(s),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),s.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const a=this.createDepthTexture();for(s of t)s.setDepthTexture(a)}else s.setDepthTexture(this.depthTexture)}removePass(s){const e=this.passes,t=e.indexOf(s);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const r=(a,l)=>a||l.needsDepthTexture;e.reduce(r,!1)||(s.getDepthTexture()===this.depthTexture&&s.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(s.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const s=this.passes;this.deleteDepthTexture(),s.length>0&&(this.autoRenderToScreen&&(s[s.length-1].renderToScreen=!1),this.passes=[])}render(s){const e=this.renderer,t=this.copyPass;let i=this.inputBuffer,n=this.outputBuffer,r=!1,o,a,l;s===void 0&&(this.timer.update(),s=this.timer.getDelta());for(const c of this.passes)c.enabled&&(c.render(e,i,n,s,r),c.needsSwap&&(r&&(t.renderToScreen=c.renderToScreen,o=e.getContext(),a=e.state.buffers.stencil,a.setFunc(o.NOTEQUAL,1,4294967295),t.render(e,i,n,s,r),a.setFunc(o.EQUAL,1,4294967295)),l=i,i=n,n=l),c instanceof Goe?r=!0:c instanceof Uoe&&(r=!1))}setSize(s,e,t){const i=this.renderer,n=i.getSize(new ee);(s===void 0||e===void 0)&&(s=n.width,e=n.height),(n.width!==s||n.height!==e)&&i.setSize(s,e,t);const r=i.getDrawingBufferSize(new ee);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height);for(const o of this.passes)o.setSize(r.width,r.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const s of this.passes)s.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},ga={NONE:0,DEPTH:1,CONVOLUTION:2},wi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Hoe=class{constructor(){this.shaderParts=new Map([[wi.FRAGMENT_HEAD,null],[wi.FRAGMENT_MAIN_UV,null],[wi.FRAGMENT_MAIN_IMAGE,null],[wi.VERTEX_HEAD,null],[wi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=ga.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=zi}},iR=!1,WN=class{constructor(s=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(s),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case _i:t=this.materialsFlatShadedDoubleSide;break;case bn:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case _i:t=this.materialsDoubleSide;break;case bn:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(s){if(!(s instanceof kt))return s.clone();const e=s.uniforms,t=new Map;for(const n in e){const r=e[n].value;r.isRenderTargetTexture&&(e[n].value=null,t.set(n,r))}const i=s.clone();for(const n of t)e[n[0]].value=n[1],i.uniforms[n[0]].value=n[1];return i}setMaterial(s){if(this.disposeMaterials(),this.material=s,s!==null){const e=this.materials=[this.cloneMaterial(s),this.cloneMaterial(s),this.cloneMaterial(s)];for(const t of e)t.uniforms=Object.assign({},s.uniforms),t.side=$n;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.side=bn,i}),this.materialsDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.side=_i,i}),this.materialsFlatShaded=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.flatShading=!0,i.side=bn,i}),this.materialsFlatShadedDoubleSide=e.map(t=>{const i=this.cloneMaterial(t);return i.uniforms=Object.assign({},s.uniforms),i.flatShading=!0,i.side=_i,i})}}render(s,e,t){const i=s.shadowMap.enabled;if(s.shadowMap.enabled=!1,iR){const n=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),s.render(e,t);for(const r of n)r[0].material=r[1];this.meshCount!==n.size&&n.clear()}else{const n=e.overrideMaterial;e.overrideMaterial=this.material,s.render(e,t),e.overrideMaterial=n}s.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const s=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of s)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return iR}static set workaroundEnabled(s){iR=s}},Ou=-1,Ii=class extends js{constructor(s,e=Ou,t=Ou,i=1){super(),this.resizable=s,this.baseSize=new ee(1,1),this.preferredSize=new ee(e,t),this.target=this.preferredSize,this.s=i,this.effectiveSize=new ee,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const s=this.baseSize,e=this.preferredSize,t=this.effectiveSize,i=this.scale;e.width!==Ou?t.width=e.width:e.height!==Ou?t.width=Math.round(e.height*(s.width/Math.max(s.height,1))):t.width=Math.round(s.width*i),e.height!==Ou?t.height=e.height:e.width!==Ou?t.height=Math.round(e.width/Math.max(s.width/Math.max(s.height,1),1)):t.height=Math.round(s.height*i)}get width(){return this.effectiveSize.width}set width(s){this.preferredWidth=s}get height(){return this.effectiveSize.height}set height(s){this.preferredHeight=s}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(s){this.s!==s&&(this.s=s,this.preferredSize.setScalar(Ou),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(s){this.scale=s}get baseWidth(){return this.baseSize.width}set baseWidth(s){this.baseSize.width!==s&&(this.baseSize.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(s){this.baseWidth=s}get baseHeight(){return this.baseSize.height}set baseHeight(s){this.baseSize.height!==s&&(this.baseSize.height=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(s){this.baseHeight=s}setBaseSize(s,e){(this.baseSize.width!==s||this.baseSize.height!==e)&&(this.baseSize.set(s,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(s){this.preferredSize.width!==s&&(this.preferredSize.width=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(s){this.preferredWidth=s}get preferredHeight(){return this.preferredSize.height}set preferredHeight(s){this.preferredSize.height!==s&&(this.preferredSize.height=s,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(s){this.preferredHeight=s}setPreferredSize(s,e){(this.preferredSize.width!==s||this.preferredSize.height!==e)&&(this.preferredSize.set(s,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(s){this.s=s.scale,this.baseSize.set(s.baseWidth,s.baseHeight),this.preferredSize.set(s.preferredWidth,s.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Ou}},Voe=class extends Set{constructor(s,e=10){super(),this.l=e,this.exclusive=!1,s!==void 0&&this.set(s)}get layer(){return this.l}set layer(s){const e=this.l;for(const t of this)t.layers.disable(e),t.layers.enable(s);this.l=s}getLayer(){return this.layer}setLayer(s){this.layer=s}isExclusive(){return this.exclusive}setExclusive(s){this.exclusive=s}clear(){const s=this.layer;for(const e of this)e.layers.disable(s);return super.clear()}set(s){this.clear();for(const e of s)this.add(e);return this}indexOf(s){return this.has(s)?0:-1}add(s){return this.exclusive?s.layers.set(this.layer):s.layers.enable(this.layer),super.add(s)}delete(s){return this.has(s)&&s.layers.disable(this.layer),super.delete(s)}toggle(s){let e;return this.has(s)?(this.delete(s),e=!1):(this.add(s),e=!0),e}setVisible(s){for(const e of this)s?e.layers.enable(0):e.layers.disable(0);return this}},Xt={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Qoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Woe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",joe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",qoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Xoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Yoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",Koe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",Joe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Zoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",$oe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",eae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",tae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",iae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",nae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",sae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",rae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",oae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",aae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",lae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",cae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",hae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",uae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",dae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",fae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",pae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",mae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",gae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",yae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",vae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",Aae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",_ae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",bae="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",xae=new Map([[Xt.ADD,Qoe],[Xt.ALPHA,Woe],[Xt.AVERAGE,joe],[Xt.COLOR,qoe],[Xt.COLOR_BURN,Xoe],[Xt.COLOR_DODGE,Yoe],[Xt.DARKEN,Koe],[Xt.DIFFERENCE,Joe],[Xt.DIVIDE,Zoe],[Xt.DST,null],[Xt.EXCLUSION,$oe],[Xt.HARD_LIGHT,eae],[Xt.HARD_MIX,tae],[Xt.HUE,iae],[Xt.INVERT,nae],[Xt.INVERT_RGB,sae],[Xt.LIGHTEN,rae],[Xt.LINEAR_BURN,oae],[Xt.LINEAR_DODGE,aae],[Xt.LINEAR_LIGHT,lae],[Xt.LUMINOSITY,cae],[Xt.MULTIPLY,hae],[Xt.NEGATION,uae],[Xt.NORMAL,dae],[Xt.OVERLAY,fae],[Xt.PIN_LIGHT,pae],[Xt.REFLECT,mae],[Xt.SATURATION,gae],[Xt.SCREEN,yae],[Xt.SOFT_LIGHT,vae],[Xt.SRC,Aae],[Xt.SUBTRACT,_ae],[Xt.VIVID_LIGHT,bae]]),wae=class extends js{constructor(s,e=1){super(),this._blendFunction=s,this.opacity=new Se(e)}getOpacity(){return this.opacity.value}setOpacity(s){this.opacity.value=s}get blendFunction(){return this._blendFunction}set blendFunction(s){this._blendFunction=s,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(s){this.blendFunction=s}getShaderCode(){return xae.get(this.blendFunction)}},Dc={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Sae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Cae="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Eae=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],VQ=class extends kt{constructor(s=new Je){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Se(null),texelSize:new Se(new Je),scale:new Se(1),kernel:new Se(0)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Sae,vertexShader:Cae}),this.fragmentShader=Sv(this.fragmentShader),this.setTexelSize(s.x,s.y),this.kernelSize=Dc.MEDIUM}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.inputBuffer=s}get kernelSequence(){return Eae[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(s){this.uniforms.scale.value=s}getScale(){return this.uniforms.scale.value}setScale(s){this.uniforms.scale.value=s}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(s){this.uniforms.kernel.value=s}setKernel(s){this.kernel=s}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e,s*.5,e*.5)}setSize(s,e){const t=1/s,i=1/e;this.uniforms.texelSize.value.set(t,i,t*.5,i*.5)}},lk=class extends _r{constructor({kernelSize:s=Dc.MEDIUM,resolutionScale:e=.5,width:t=Ii.AUTO_SIZE,height:i=Ii.AUTO_SIZE,resolutionX:n=t,resolutionY:r=i}={}){super("KawaseBlurPass"),this.renderTargetA=new $t(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new Ii(this,n,r,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new VQ,this._blurMaterial.kernelSize=s,this.copyMaterial=new GQ}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(s){this._blurMaterial=s}get dithering(){return this.copyMaterial.dithering}set dithering(s){this.copyMaterial.dithering=s}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(s){this.blurMaterial.kernelSize=s}get width(){return this.resolution.width}set width(s){this.resolution.preferredWidth=s}get height(){return this.resolution.height}set height(s){this.resolution.preferredHeight=s}get scale(){return this.blurMaterial.scale}set scale(s){this.blurMaterial.scale=s}getScale(){return this.blurMaterial.scale}setScale(s){this.blurMaterial.scale=s}getKernelSize(){return this.kernelSize}setKernelSize(s){this.kernelSize=s}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,e,t,i,n){const r=this.scene,o=this.camera,a=this.renderTargetA,l=this.renderTargetB,c=this.blurMaterial,h=c.kernelSequence;let u=e;this.fullscreenMaterial=c;for(let f=0,p=h.length;f<p;++f){const m=f&1?l:a;c.kernel=h[f],c.inputBuffer=u.texture,s.setRenderTarget(m),s.render(r,o),u=m}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=u.texture,s.setRenderTarget(this.renderToScreen?null:t),s.render(r,o)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e);const i=t.width,n=t.height;this.renderTargetA.setSize(i,n),this.renderTargetB.setSize(i,n),this.blurMaterial.setSize(s,e)}initialize(s,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==wn?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):s!==null&&s.outputColorSpace===bt&&(this.renderTargetA.texture.colorSpace=bt,this.renderTargetB.texture.colorSpace=bt))}static get AUTO_SIZE(){return Ii.AUTO_SIZE}},Mae=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,Tae=class extends kt{constructor(s=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:su.replace(/\D+/g,"")},uniforms:{inputBuffer:new Se(null),threshold:new Se(0),smoothing:new Se(1),range:new Se(null)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Mae,vertexShader:mm}),this.colorOutput=s,this.luminanceRange=e}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get threshold(){return this.uniforms.threshold.value}set threshold(s){this.smoothing>0||s>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=s}getThreshold(){return this.threshold}setThreshold(s){this.threshold=s}get smoothing(){return this.uniforms.smoothing.value}set smoothing(s){this.threshold>0||s>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=s}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(s){this.smoothing=s}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(s){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(s){s?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(s){return this.colorOutput}setColorOutputEnabled(s){this.colorOutput=s}get useRange(){return this.luminanceRange!==null}set useRange(s){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(s){s!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=s,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(s){this.luminanceRange=s}},QQ=class extends _r{constructor({renderTarget:s,luminanceRange:e,colorOutput:t,resolutionScale:i=1,width:n=Ii.AUTO_SIZE,height:r=Ii.AUTO_SIZE,resolutionX:o=n,resolutionY:a=r}={}){super("LuminancePass"),this.fullscreenMaterial=new Tae(t,e),this.needsSwap=!1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new $t(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const l=this.resolution=new Ii(this,o,a,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(s,e,t,i,n){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height)}initialize(s,e,t){t!==void 0&&t!==wn&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Iae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Rae="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Pae=class extends kt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Se(null),texelSize:new Se(new ee)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Iae,vertexShader:Rae}),this.fragmentShader=Sv(this.fragmentShader)}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},Bae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,Dae="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Oae=class extends kt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Se(null),supportBuffer:new Se(null),texelSize:new Se(new ee),radius:new Se(.85)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Bae,vertexShader:Dae}),this.fragmentShader=Sv(this.fragmentShader)}set inputBuffer(s){this.uniforms.inputBuffer.value=s}set supportBuffer(s){this.uniforms.supportBuffer.value=s}get radius(){return this.uniforms.radius.value}set radius(s){this.uniforms.radius.value=s}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},Lae=class extends _r{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new $t(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Pae,this.upsamplingMaterial=new Oae,this.resolution=new ee}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(s){if(this.levels!==s){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<s;++t){const i=e.clone();i.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(e);for(let t=1,i=s-1;t<i;++t){const n=e.clone();n.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(n)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(s){this.upsamplingMaterial.radius=s}render(s,e,t,i,n){const{scene:r,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:l}=this,{downsamplingMipmaps:c,upsamplingMipmaps:h}=this;let u=e;this.fullscreenMaterial=a;for(let f=0,p=c.length;f<p;++f){const m=c[f];a.setSize(u.width,u.height),a.inputBuffer=u.texture,s.setRenderTarget(m),s.render(r,o),u=m}this.fullscreenMaterial=l;for(let f=h.length-1;f>=0;--f){const p=h[f];l.setSize(u.width,u.height),l.inputBuffer=u.texture,l.supportBuffer=c[f].texture,s.setRenderTarget(p),s.render(r,o),u=p}}setSize(s,e){const t=this.resolution;t.set(s,e);let i=t.width,n=t.height;for(let r=0,o=this.downsamplingMipmaps.length;r<o;++r)i=Math.round(i*.5),n=Math.round(n*.5),this.downsamplingMipmaps[r].setSize(i,n),r<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[r].setSize(i,n)}initialize(s,e,t){if(t!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const n of i)n.texture.type=t;if(t!==wn)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(s!==null&&s.outputColorSpace===bt)for(const n of i)n.texture.colorSpace=bt}}dispose(){super.dispose();for(const s of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))s.dispose()}},vo=class extends js{constructor(s,e,{attributes:t=ga.NONE,blendFunction:i=Xt.NORMAL,defines:n=new Map,uniforms:r=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=s,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=n,this.uniforms=r,this.extensions=o,this.blendMode=new wae(i),this.blendMode.addEventListener("change",l=>this.setChanged()),this._inputColorSpace=zi,this._outputColorSpace=Bo}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(s){this._inputColorSpace=s,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(s){this._outputColorSpace=s,this.setChanged()}set mainScene(s){}set mainCamera(s){}getName(){return this.name}setRenderer(s){this.renderer=s}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(s){this.attributes=s,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(s){this.fragmentShader=s,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(s){this.vertexShader=s,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(s,e=gr){}update(s,e,t){}setSize(s,e){}initialize(s,e,t){}dispose(){for(const s of Object.keys(this)){const e=this[s];(e instanceof $t||e instanceof Ht||e instanceof Wt||e instanceof _r)&&this[s].dispose()}}},kae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,ck=class extends vo{constructor({blendFunction:e=Xt.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,mipmapBlur:n=!1,intensity:r=1,radius:o=.85,levels:a=8,kernelSize:l=Dc.LARGE,resolutionScale:c=.5,width:h=Ii.AUTO_SIZE,height:u=Ii.AUTO_SIZE,resolutionX:f=h,resolutionY:p=u}={}){super("BloomEffect",kae,{blendFunction:e,uniforms:new Map([["map",new Se(null)],["intensity",new Se(r)]])}),this.renderTarget=new $t(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new lk({kernelSize:l}),this.luminancePass=new QQ({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=i,this.mipmapBlurPass=new Lae,this.mipmapBlurPass.enabled=n,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=n?this.mipmapBlurPass.texture:this.renderTarget.texture;const m=this.resolution=new Ii(this,f,p,c);m.addEventListener("change",v=>this.setSize(m.baseWidth,m.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){const n=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,r.renderTarget):this.blurPass.render(e,r.renderTarget,n)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,n)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,i){this.blurPass.initialize(e,t,i),this.luminancePass.initialize(e,t,i),this.mipmapBlurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e!==null&&e.outputColorSpace===bt&&(this.renderTarget.texture.colorSpace=bt))}},Fae="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",WQ=class extends vo{constructor({blendFunction:s=Xt.SRC,brightness:e=0,contrast:t=0}={}){super("BrightnessContrastEffect",Fae,{blendFunction:s,uniforms:new Map([["brightness",new Se(e)],["contrast",new Se(t)]])}),this.inputColorSpace=bt}get brightness(){return this.uniforms.get("brightness").value}set brightness(s){this.uniforms.get("brightness").value=s}getBrightness(){return this.brightness}setBrightness(s){this.brightness=s}get contrast(){return this.uniforms.get("contrast").value}set contrast(s){this.uniforms.get("contrast").value=s}getContrast(){return this.contrast}setContrast(s){this.contrast=s}},Uae=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,Nae="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",jQ=class extends vo{constructor({offset:s=new ee(.001,5e-4),radialModulation:e=!1,modulationOffset:t=.15}={}){super("ChromaticAberrationEffect",Uae,{vertexShader:Nae,attributes:ga.CONVOLUTION,uniforms:new Map([["offset",new Se(s)],["modulationOffset",new Se(t)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(s){this.uniforms.get("offset").value=s}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(s){s?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(s){this.uniforms.get("modulationOffset").value=s}getOffset(){return this.offset}setOffset(s){this.offset=s}},qQ={RED:0,GREEN:1,BLUE:2,ALPHA:3},XQ={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},zae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Vw=class extends kt{constructor(s=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:s?"2":"1"},uniforms:{inputBuffer:new Se(null),cocBuffer:new Se(null),texelSize:new Se(new ee),kernel64:new Se(null),kernel16:new Se(null),scale:new Se(1)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:zae,vertexShader:mm}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}set cocBuffer(s){this.uniforms.cocBuffer.value=s}setCoCBuffer(s){this.uniforms.cocBuffer.value=s}get scale(){return this.uniforms.scale.value}set scale(s){this.uniforms.scale.value=s}getScale(s){return this.scale}setScale(s){this.scale=s}generateKernel(){const s=2.39996323,e=new Float64Array(128),t=new Float64Array(32);let i=0,n=0;for(let r=0,o=Math.sqrt(80);r<80;++r){const a=r*s,l=Math.sqrt(r)/o,c=l*Math.cos(a),h=l*Math.sin(a);r%5===0?(t[n++]=c,t[n++]=h):(e[i++]=c,e[i++]=h)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=t}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e)}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}};function gy(s,e,t){return s*(e-t)-e}function wp(s,e,t){return Math.min(Math.max((s+e)/(e-t),0),1)}var Gae=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Hae=class extends kt{constructor(s){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Se(null),focusDistance:new Se(0),focusRange:new Se(0),cameraNear:new Se(.3),cameraFar:new Se(1e3)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Gae,vertexShader:mm}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(s)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=gr){this.depthBuffer=s,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(s){this.uniforms.focusDistance.value=s}get worldFocusDistance(){return-gy(this.focusDistance,this.near,this.far)}set worldFocusDistance(s){this.focusDistance=wp(-s,this.near,this.far)}getFocusDistance(s){this.uniforms.focusDistance.value=s}setFocusDistance(s){this.uniforms.focusDistance.value=s}get focalLength(){return this.focusRange}set focalLength(s){this.focusRange=s}get focusRange(){return this.uniforms.focusRange.value}set focusRange(s){this.uniforms.focusRange.value=s}get worldFocusRange(){return-gy(this.focusRange,this.near,this.far)}set worldFocusRange(s){this.focusRange=wp(-s,this.near,this.far)}getFocalLength(s){return this.focusRange}setFocalLength(s){this.focusRange=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNear.value=s.near,this.uniforms.cameraFar.value=s.far,s instanceof Vt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Vae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,Qae=class extends kt{constructor(s=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Se(s),inputBuffer:new Se(null),strength:new Se(1)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Vae,vertexShader:mm}),this.colorChannel=qQ.RED,this.maskFunction=XQ.DISCARD}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}set maskTexture(s){this.uniforms.maskTexture.value=s,delete this.defines.MASK_PRECISION_HIGH,s.type!==wn&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(s){this.maskTexture=s}set colorChannel(s){this.defines.COLOR_CHANNEL=s.toFixed(0),this.needsUpdate=!0}setColorChannel(s){this.colorChannel=s}set maskFunction(s){this.defines.MASK_FUNCTION=s.toFixed(0),this.needsUpdate=!0}setMaskFunction(s){this.maskFunction=s}get inverted(){return this.defines.INVERTED!==void 0}set inverted(s){this.inverted&&!s?delete this.defines.INVERTED:s&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(s){this.inverted=s}get strength(){return this.uniforms.strength.value}set strength(s){this.uniforms.strength.value=s}getStrength(){return this.strength}setStrength(s){this.strength=s}},pc=class extends _r{constructor(s,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=s,this.input=e}setInput(s){this.input=s}render(s,e,t,i,n){const r=this.fullscreenMaterial.uniforms;e!==null&&r!==void 0&&r[this.input]!==void 0&&(r[this.input].value=e.texture),s.setRenderTarget(this.renderToScreen?null:t),s.render(this.scene,this.camera)}initialize(s,e,t){t!==void 0&&t!==wn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Wae=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,YQ=class extends vo{constructor(s,{blendFunction:e,worldFocusDistance:t,worldFocusRange:i,focusDistance:n=0,focalLength:r=.1,focusRange:o=r,bokehScale:a=1,resolutionScale:l=1,width:c=Ii.AUTO_SIZE,height:h=Ii.AUTO_SIZE,resolutionX:u=c,resolutionY:f=h}={}){super("DepthOfFieldEffect",Wae,{blendFunction:e,attributes:ga.DEPTH,uniforms:new Map([["nearColorBuffer",new Se(null)],["farColorBuffer",new Se(null)],["nearCoCBuffer",new Se(null)],["farCoCBuffer",new Se(null)],["scale",new Se(1)]])}),this.camera=s,this.renderTarget=new $t(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new pc(new Hae(s));const p=this.cocMaterial;p.focusDistance=n,p.focusRange=o,t!==void 0&&(p.worldFocusDistance=t),i!==void 0&&(p.worldFocusRange=i),this.blurPass=new lk({resolutionScale:l,resolutionX:u,resolutionY:f,kernelSize:Dc.MEDIUM}),this.maskPass=new pc(new Qae(this.renderTargetCoC.texture));const m=this.maskPass.fullscreenMaterial;m.colorChannel=qQ.GREEN,this.maskFunction=XQ.MULTIPLY_RGB,this.bokehNearBasePass=new pc(new Vw(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new pc(new Vw(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new pc(new Vw(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new pc(new Vw(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const v=this.resolution=new Ii(this,u,f,l);v.addEventListener("change",g=>this.setSize(v.baseWidth,v.baseHeight)),this.bokehScale=a}set mainCamera(s){this.camera=s,this.cocMaterial.copyCameraSettings(s)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(s){this.maskFunction!==s&&(this.defines.set("MASK_FUNCTION",s.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=s,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(s){this.bokehNearBasePass.fullscreenMaterial.scale=s,this.bokehNearFillPass.fullscreenMaterial.scale=s,this.bokehFarBasePass.fullscreenMaterial.scale=s,this.bokehFarFillPass.fullscreenMaterial.scale=s,this.maskPass.fullscreenMaterial.strength=s,this.uniforms.get("scale").value=s}getBokehScale(){return this.bokehScale}setBokehScale(s){this.bokehScale=s}getTarget(){return this.target}setTarget(s){this.target=s}calculateFocusDistance(s){const e=this.camera,t=e.position.distanceTo(s);return wp(-t,e.near,e.far)}setDepthTexture(s,e=gr){this.cocMaterial.depthBuffer=s,this.cocMaterial.depthPacking=e}update(s,e,t){const i=this.renderTarget,n=this.renderTargetCoC,r=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(s,null,n),this.blurPass.render(s,n,r),this.maskPass.render(s,e,o),this.bokehFarBasePass.render(s,o,i),this.bokehFarFillPass.render(s,i,this.renderTargetFar),this.bokehNearBasePass.render(s,e,i),this.bokehNearFillPass.render(s,i,this.renderTargetNear)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e);const i=t.width,n=t.height;this.cocPass.setSize(s,e),this.blurPass.setSize(s,e),this.maskPass.setSize(s,e),this.renderTargetFar.setSize(s,e),this.renderTargetCoC.setSize(s,e),this.renderTargetMasked.setSize(s,e),this.renderTarget.setSize(i,n),this.renderTargetNear.setSize(i,n),this.renderTargetCoCBlurred.setSize(i,n),this.bokehNearBasePass.fullscreenMaterial.setSize(s,e),this.bokehNearFillPass.fullscreenMaterial.setSize(s,e),this.bokehFarBasePass.fullscreenMaterial.setSize(s,e),this.bokehFarFillPass.fullscreenMaterial.setSize(s,e)}initialize(s,e,t){this.cocPass.initialize(s,e,t),this.maskPass.initialize(s,e,t),this.bokehNearBasePass.initialize(s,e,t),this.bokehNearFillPass.initialize(s,e,t),this.bokehFarBasePass.initialize(s,e,t),this.bokehFarFillPass.initialize(s,e,t),this.blurPass.initialize(s,e,wn),s.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTarget.texture.type=t,this.renderTargetNear.texture.type=t,this.renderTargetFar.texture.type=t,this.renderTargetMasked.texture.type=t,s!==null&&s.outputColorSpace===bt&&(this.renderTarget.texture.colorSpace=bt,this.renderTargetNear.texture.colorSpace=bt,this.renderTargetFar.texture.colorSpace=bt,this.renderTargetMasked.texture.colorSpace=bt))}};function jae(s,e,t){const i=new Map([[WE,1],[um,1],[qE,2],[Li,4]]);let n;if(i.has(e)||console.error("Invalid noise texture format"),t===wn){n=new Uint8Array(s*i.get(e));for(let r=0,o=n.length;r<o;++r)n[r]=Math.random()*255+.5}else{n=new Float32Array(s*i.get(e));for(let r=0,o=n.length;r<o;++r)n[r]=Math.random()}return n}var qae=class extends Qr{constructor(s,e,t=WE,i=wn){super(jae(s*e,t,i),s,e,t,i),this.needsUpdate=!0}},XA={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},Xae=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,Yae=class extends kt{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:XA.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new Se(null),depthBuffer0:new Se(null),depthBuffer1:new Se(null),cameraNearFar:new Se(new ee(1,1))},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Xae,vertexShader:mm}),this.depthMode=x_}set depthBuffer0(s){this.uniforms.depthBuffer0.value=s}set depthPacking0(s){this.defines.DEPTH_PACKING_0=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(s,e=gr){this.depthBuffer0=s,this.depthPacking0=e}set depthBuffer1(s){this.uniforms.depthBuffer1.value=s}set depthPacking1(s){this.defines.DEPTH_PACKING_1=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(s,e=gr){this.depthBuffer1=s,this.depthPacking1=e}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(s){this.defines.DEPTH_TEST_STRATEGY=s.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(s){this.maxDepthStrategy=s?XA.KEEP_MAX_DEPTH:XA.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(s){this.maxDepthStrategy=s}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(s){this.defines.DEPTH_EPSILON=s.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(s){this.epsilon=s}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(s){let e;switch(s){case DO:e="false";break;case GE:e="true";break;case qy:e="abs(d1 - d0) <= DEPTH_EPSILON";break;case bb:e="abs(d1 - d0) > DEPTH_EPSILON";break;case x_:e="d0 > d1";break;case Kp:e="d0 >= d1";break;case HE:e="d0 <= d1";break;case VE:default:e="d0 < d1";break}this.defines.DEPTH_MODE=s.toFixed(0),this.defines["depthTest(d0, d1)"]=e,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(s){this.depthMode=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNearFar.value.set(s.near,s.far),s instanceof Vt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},kM=class extends _r{constructor(s,e,t=null){super("RenderPass",s,e),this.needsSwap=!1,this.clearPass=new LM,this.overrideMaterialManager=t===null?null:new WN(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(s){this.scene=s}set mainCamera(s){this.camera=s}get renderToScreen(){return super.renderToScreen}set renderToScreen(s){super.renderToScreen=s,this.clearPass.renderToScreen=s}get overrideMaterial(){const s=this.overrideMaterialManager;return s!==null?s.material:null}set overrideMaterial(s){const e=this.overrideMaterialManager;s!==null?e!==null?e.setMaterial(s):this.overrideMaterialManager=new WN(s):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(s){this.overrideMaterial=s}get clear(){return this.clearPass.enabled}set clear(s){this.clearPass.enabled=s}getSelection(){return this.selection}setSelection(s){this.selection=s}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(s){this.ignoreBackground=s}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(s){this.skipShadowMapUpdate=s}getClearPass(){return this.clearPass}render(s,e,t,i,n){const r=this.scene,o=this.camera,a=this.selection,l=o.layers.mask,c=r.background,h=s.shadowMap.autoUpdate,u=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(s.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(r.background=null),this.clearPass.enabled&&this.clearPass.render(s,e),s.setRenderTarget(u),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(s,r,o):s.render(r,o),o.layers.mask=l,r.background=c,s.shadowMap.autoUpdate=h}},Kae="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",KQ=class extends vo{constructor({blendFunction:s=Xt.SRC,hue:e=0,saturation:t=0}={}){super("HueSaturationEffect",Kae,{blendFunction:s,uniforms:new Map([["hue",new Se(new S)],["saturation",new Se(t)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(s){this.uniforms.get("saturation").value=s}getSaturation(){return this.saturation}setSaturation(s){this.saturation=s}get hue(){const s=this.uniforms.get("hue").value;return Math.acos((s.x*3-1)/2)}set hue(s){const e=Math.sin(s),t=Math.cos(s);this.uniforms.get("hue").value.set((2*t+1)/3,(-Math.sqrt(3)*e-t+1)/3,(Math.sqrt(3)*e-t+1)/3)}getHue(){return this.hue}setHue(s){this.hue=s}},hk={DEPTH:0,LUMA:1,COLOR:2},Jae={DISABLED:0,DEPTH:1,CUSTOM:2},pp={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},Us={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},x0={DEFAULT:0,ESKIL:1},Zae=class extends _r{constructor(s,e,{renderTarget:t,resolutionScale:i=1,width:n=Ii.AUTO_SIZE,height:r=Ii.AUTO_SIZE,resolutionX:o=n,resolutionY:a=r}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new kM(s,e,new Rb({depthPacking:YE}));const l=this.renderPass;l.skipShadowMapUpdate=!0,l.ignoreBackground=!0;const c=l.clearPass;c.overrideClearColor=new Ae(16777215),c.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new $t(1,1,{minFilter:Ot,magFilter:Ot}),this.renderTarget.texture.name="DepthPass.Target");const h=this.resolution=new Ii(this,o,a,i);h.addEventListener("change",u=>this.setSize(h.baseWidth,h.baseHeight))}set mainScene(s){this.renderPass.mainScene=s}set mainCamera(s){this.renderPass.mainCamera=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,e,t,i,n){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(s,r)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height)}},$ae="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",JQ=class extends vo{constructor(e=30){super("PixelationEffect",$ae,{uniforms:new Map([["active",new Se(!1)],["d",new Se(new Je)]])}),this.resolution=new ee,this._granularity=0,this.granularity=e}get granularity(){return this._granularity}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this._granularity=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){const i=this.resolution;i.set(e,t);const n=this.granularity,r=n/i.x,o=n/i.y;this.uniforms.get("d").value.set(r,o,1/r,1/o)}},ZQ=class extends ck{constructor(s,e,t){super(t),this.setAttributes(this.getAttributes()|ga.DEPTH),this.camera=e,this.depthPass=new Zae(s,e),this.clearPass=new LM(!0,!1,!1),this.clearPass.overrideClearColor=new Ae(0),this.depthMaskPass=new pc(new Yae);const i=this.depthMaskMaterial;i.copyCameraSettings(e),i.depthBuffer1=this.depthPass.texture,i.depthPacking1=YE,i.depthMode=qy,this.renderTargetMasked=new $t(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new Voe,this.selection.layer=11,this._inverted=!1,this._ignoreBackground=!1}set mainScene(s){this.depthPass.mainScene=s}set mainCamera(s){this.camera=s,this.depthPass.mainCamera=s,this.depthMaskMaterial.copyCameraSettings(s)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(s){this._inverted=s,this.depthMaskMaterial.depthMode=s?bb:qy}isInverted(){return this.inverted}setInverted(s){this.inverted=s}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(s){this._ignoreBackground=s,this.depthMaskMaterial.maxDepthStrategy=s?XA.DISCARD_MAX_DEPTH:XA.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(s){this.ignoreBackground=s}setDepthTexture(s,e=gr){this.depthMaskMaterial.depthBuffer0=s,this.depthMaskMaterial.depthPacking0=e}update(s,e,t){const i=this.camera,n=this.selection,r=this.inverted;let o=e;if(this.ignoreBackground||!r||n.size>0){const a=i.layers.mask;i.layers.set(n.layer),this.depthPass.render(s),i.layers.mask=a,o=this.renderTargetMasked,this.clearPass.render(s,o),this.depthMaskPass.render(s,e,o)}super.update(s,o,t)}setSize(s,e){super.setSize(s,e),this.renderTargetMasked.setSize(s,e),this.depthPass.setSize(s,e)}initialize(s,e,t){super.initialize(s,e,t),this.clearPass.initialize(s,e,t),this.depthPass.initialize(s,e,t),this.depthMaskPass.initialize(s,e,t),s!==null&&s.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTargetMasked.texture.type=t,s!==null&&s.outputColorSpace===bt&&(this.renderTargetMasked.texture.colorSpace=bt))}},ele=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,tle=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,ile=class extends kt{constructor(s=new ee,e=hk.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:su.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Se(null),depthBuffer:new Se(null),predicationBuffer:new Se(null),texelSize:new Se(s)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ele,vertexShader:tle}),this.edgeDetectionMode=e}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=gr){this.depthBuffer=s,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(s){this.defines.EDGE_DETECTION_MODE=s.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(s){this.edgeDetectionMode=s}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(s){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=s.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(s){this.localContrastAdaptationFactor=s}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(s){this.defines.EDGE_THRESHOLD=s.toFixed("6"),this.defines.DEPTH_THRESHOLD=(s*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(s){this.edgeDetectionThreshold=s}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(s){this.defines.PREDICATION_MODE=s.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(s){this.predicationMode=s}set predicationBuffer(s){this.uniforms.predicationBuffer.value=s}setPredicationBuffer(s){this.uniforms.predicationBuffer.value=s}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(s){this.defines.PREDICATION_THRESHOLD=s.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(s){this.predicationThreshold=s}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(s){this.defines.PREDICATION_SCALE=s.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(s){this.predicationScale=s}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(s){this.defines.PREDICATION_STRENGTH=s.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(s){this.predicationStrength=s}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},nle=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,sle="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",rle=class extends kt{constructor(s=new ee,e=new ee){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Se(null),searchTexture:new Se(null),areaTexture:new Se(null),resolution:new Se(e),texelSize:new Se(s)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:nle,vertexShader:sle})}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(s){this.uniforms.searchTexture.value=s}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(s){this.uniforms.areaTexture.value=s}setLookupTextures(s,e){this.searchTexture=s,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(s){const e=Math.min(Math.max(s,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(s){this.orthogonalSearchSteps=s}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(s){const e=Math.min(Math.max(s,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(s){this.diagonalSearchSteps=s}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(s){s?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(s){this.diagonalDetection=s}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(s){const e=Math.min(Math.max(s,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(s){this.cornerRounding=s}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(s){s?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(s){this.cornerDetection=s}setSize(s,e){const t=this.uniforms;t.texelSize.value.set(1/s,1/e),t.resolution.value.set(s,e)}},jN="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",qN="data:image/png;base64,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",ole="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",ale="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",$Q=class extends vo{constructor({blendFunction:s=Xt.SRC,preset:e=pp.MEDIUM,edgeDetectionMode:t=hk.COLOR,predicationMode:i=Jae.DISABLED}={}){super("SMAAEffect",ole,{vertexShader:ale,blendFunction:s,attributes:ga.CONVOLUTION|ga.DEPTH,uniforms:new Map([["weightMap",new Se(null)]])});let n,r;arguments.length>1&&(n=arguments[0],r=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new $t(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new LM(!0,!1,!1),this.clearPass.overrideClearColor=new Ae(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new pc(new ile),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new pc(new rle);const o=new vM;o.onLoad=()=>{const a=new Wt(n);a.name="SMAA.Search",a.magFilter=Ot,a.minFilter=Ot,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;const l=new Wt(r);l.name="SMAA.Area",l.magFilter=Nt,l.minFilter=Nt,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!1,this.weightsMaterial.areaTexture=l,this.dispatchEvent({type:"load"})},o.itemStart("search"),o.itemStart("area"),n!==void 0&&r!==void 0?(o.itemEnd("search"),o.itemEnd("area")):typeof Image<"u"&&(n=new Image,r=new Image,n.addEventListener("load",()=>o.itemEnd("search")),r.addEventListener("load",()=>o.itemEnd("area")),n.src=jN,r.src=qN),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(s){this.edgeDetectionMaterial.edgeDetectionThreshold=s}setOrthogonalSearchSteps(s){this.weightsMaterial.orthogonalSearchSteps=s}applyPreset(s){const e=this.edgeDetectionMaterial,t=this.weightsMaterial;switch(s){case pp.LOW:e.edgeDetectionThreshold=.15,t.orthogonalSearchSteps=4,t.diagonalDetection=!1,t.cornerDetection=!1;break;case pp.MEDIUM:e.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=8,t.diagonalDetection=!1,t.cornerDetection=!1;break;case pp.HIGH:e.edgeDetectionThreshold=.1,t.orthogonalSearchSteps=16,t.diagonalSearchSteps=8,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break;case pp.ULTRA:e.edgeDetectionThreshold=.05,t.orthogonalSearchSteps=32,t.diagonalSearchSteps=16,t.cornerRounding=25,t.diagonalDetection=!0,t.cornerDetection=!0;break}}setDepthTexture(s,e=gr){this.edgeDetectionMaterial.depthBuffer=s,this.edgeDetectionMaterial.depthPacking=e}update(s,e,t){this.clearPass.render(s,this.renderTargetEdges),this.edgeDetectionPass.render(s,e,this.renderTargetEdges),this.weightsPass.render(s,this.renderTargetEdges,this.renderTargetWeights)}setSize(s,e){this.edgeDetectionMaterial.setSize(s,e),this.weightsMaterial.setSize(s,e),this.renderTargetEdges.setSize(s,e),this.renderTargetWeights.setSize(s,e)}dispose(){const{searchTexture:s,areaTexture:e}=this.weightsMaterial;s!==null&&e!==null&&(s.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return jN}static get areaImageDataURL(){return qN}},lle=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,cle="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",hle=class extends kt{constructor(s){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Se(null),normalBuffer:new Se(null),normalDepthBuffer:new Se(null),noiseTexture:new Se(null),inverseProjectionMatrix:new Se(new le),projectionMatrix:new Se(new le),texelSize:new Se(new ee),cameraNearFar:new Se(new ee),distanceCutoff:new Se(new ee),proximityCutoff:new Se(new ee),noiseScale:new Se(new ee),minRadiusScale:new Se(.33),intensity:new Se(1),fade:new Se(.01),bias:new Se(0)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:lle,vertexShader:cle}),this.copyCameraSettings(s),this.resolution=new ee,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(s){this.uniforms.normalDepthBuffer.value=s,s!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(s){this.normalDepthBuffer=s}set normalBuffer(s){this.uniforms.normalBuffer.value=s}setNormalBuffer(s){this.uniforms.normalBuffer.value=s}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=gr){this.depthBuffer=s,this.depthPacking=e}set noiseTexture(s){this.uniforms.noiseTexture.value=s}setNoiseTexture(s){this.uniforms.noiseTexture.value=s}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(s){this.defines.SAMPLES_INT=s.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/s).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(s){this.samples=s}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(s){this.defines.SPIRAL_TURNS=s.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(s){this.rings=s}get intensity(){return this.uniforms.intensity.value}set intensity(s){this.uniforms.intensity.value=s,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(s){this.uniforms.intensity.value=s}get fade(){return this.uniforms.fade.value}set fade(s){this.uniforms.fade.value=s}getFade(){return this.uniforms.fade.value}setFade(s){this.uniforms.fade.value=s}get bias(){return this.uniforms.bias.value}set bias(s){this.uniforms.bias.value=s}getBias(){return this.uniforms.bias.value}setBias(s){this.uniforms.bias.value=s}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(s){this.uniforms.minRadiusScale.value=s}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(s){this.uniforms.minRadiusScale.value=s}updateRadius(){const s=this.r*this.resolution.height;this.defines.RADIUS=s.toFixed(11),this.defines.RADIUS_SQ=(s*s).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(s){this.r=Math.min(Math.max(s,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(s){this.radius=s}get distanceScaling(){return!0}set distanceScaling(s){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(s){this.distanceScaling=s}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(s){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-gy(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(s){this.distanceThreshold=wp(-s,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(s){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+s,0),1)}get worldDistanceFalloff(){return-gy(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(s){this.distanceFalloff=wp(-s,this.near,this.far)}setDistanceCutoff(s,e){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+e,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(s){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-gy(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(s){this.proximityThreshold=wp(-s,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(s){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+s,0),1)}get worldProximityFalloff(){return-gy(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(s){this.proximityFalloff=wp(-s,this.near,this.far)}setProximityCutoff(s,e){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(s,0),1),Math.min(Math.max(s+e,0),1))}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e)}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNearFar.value.set(s.near,s.far),this.uniforms.projectionMatrix.value.copy(s.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(s.projectionMatrix).invert(),s instanceof Vt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(s,e){const t=this.uniforms,i=t.noiseTexture.value;i!==null&&t.noiseScale.value.set(s/i.image.width,e/i.image.height),t.texelSize.value.set(1/s,1/e),this.resolution.set(s,e),this.updateRadius()}},ule=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,dle="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",fle=class extends kt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Se(null),normalBuffer:new Se(null),texelSize:new Se(new ee)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ule,vertexShader:dle})}set depthBuffer(s){this.uniforms.depthBuffer.value=s}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=gr){this.depthBuffer=s,this.depthPacking=e}set normalBuffer(s){this.uniforms.normalBuffer.value=s,s!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(s){this.normalBuffer=s}setTexelSize(s,e){this.uniforms.texelSize.value.set(s,e)}setSize(s,e){this.uniforms.texelSize.value.set(1/s,1/e)}},uk=class extends _r{constructor({normalBuffer:s=null,resolutionScale:e=.5,width:t=Ii.AUTO_SIZE,height:i=Ii.AUTO_SIZE,resolutionX:n=t,resolutionY:r=i}={}){super("DepthDownsamplingPass");const o=new fle;o.normalBuffer=s,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new $t(1,1,{minFilter:Ot,magFilter:Ot,depthBuffer:!1,type:tn}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new Ii(this,n,r,e);a.addEventListener("change",l=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(s,e=gr){this.fullscreenMaterial.depthBuffer=s,this.fullscreenMaterial.depthPacking=e}render(s,e,t,i,n){s.setRenderTarget(this.renderToScreen?null:this.renderTarget),s.render(this.scene,this.camera)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height),this.fullscreenMaterial.setSize(s,e)}initialize(s,e,t){const i=s.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},ple=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,XN=64,eW=class extends vo{constructor(s,e,{blendFunction:t=Xt.MULTIPLY,samples:i=9,rings:n=7,normalDepthBuffer:r=null,depthAwareUpsampling:o=!0,worldDistanceThreshold:a,worldDistanceFalloff:l,worldProximityThreshold:c,worldProximityFalloff:h,distanceThreshold:u=.97,distanceFalloff:f=.03,rangeThreshold:p=5e-4,rangeFalloff:m=.001,minRadiusScale:v=.1,luminanceInfluence:g=.7,radius:y=.1825,intensity:A=1,bias:_=.025,fade:b=.01,color:x=null,resolutionScale:E=1,width:M=Ii.AUTO_SIZE,height:T=Ii.AUTO_SIZE,resolutionX:R=M,resolutionY:w=T}={}){super("SSAOEffect",ple,{blendFunction:t,attributes:ga.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new Se(null)],["normalDepthBuffer",new Se(r)],["luminanceInfluence",new Se(g)],["color",new Se(null)],["intensity",new Se(A)],["scale",new Se(0)]])}),this.renderTarget=new $t(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const I=this.resolution=new Ii(this,R,w,E);I.addEventListener("change",B=>this.setSize(I.baseWidth,I.baseHeight)),this.camera=s,this.depthDownsamplingPass=new uk({normalBuffer:e,resolutionScale:E}),this.depthDownsamplingPass.enabled=r===null,this.ssaoPass=new pc(new hle(s));const O=new qae(XN,XN,Li);O.wrapS=O.wrapT=Uo;const k=this.ssaoMaterial;k.normalBuffer=e,k.noiseTexture=O,k.minRadiusScale=v,k.samples=i,k.radius=y,k.rings=n,k.fade=b,k.bias=_,k.distanceThreshold=u,k.distanceFalloff=f,k.proximityThreshold=p,k.proximityFalloff=m,a!==void 0&&(k.worldDistanceThreshold=a),l!==void 0&&(k.worldDistanceFalloff=l),c!==void 0&&(k.worldProximityThreshold=c),h!==void 0&&(k.worldProximityFalloff=h),r!==null&&(this.ssaoMaterial.normalDepthBuffer=r,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=o,this.color=x}set mainCamera(s){this.camera=s,this.ssaoMaterial.copyCameraSettings(s)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(s){this.ssaoMaterial.normalBuffer=s,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=s}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(s){this.ssaoMaterial.samples=s}get rings(){return this.ssaoMaterial.rings}set rings(s){this.ssaoMaterial.rings=s}get radius(){return this.ssaoMaterial.radius}set radius(s){this.ssaoMaterial.radius=s}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(s){this.depthAwareUpsampling!==s&&(s?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(s){this.depthAwareUpsampling=s}get distanceScaling(){return!0}set distanceScaling(s){}get color(){return this.uniforms.get("color").value}set color(s){const e=this.uniforms,t=this.defines;s!==null?t.has("COLORIZE")?e.get("color").value.set(s):(t.set("COLORIZE","1"),e.get("color").value=new Ae(s),this.setChanged()):t.has("COLORIZE")&&(t.delete("COLORIZE"),e.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(s){this.uniforms.get("luminanceInfluence").value=s}get intensity(){return this.uniforms.get("intensity").value}set intensity(s){this.uniforms.get("intensity").value=s}getColor(){return this.color}setColor(s){this.color=s}setDistanceCutoff(s,e){this.ssaoMaterial.distanceThreshold=s,this.ssaoMaterial.distanceFalloff=e}setProximityCutoff(s,e){this.ssaoMaterial.proximityThreshold=s,this.ssaoMaterial.proximityFalloff=e}setDepthTexture(s,e=gr){this.depthDownsamplingPass.setDepthTexture(s,e),this.ssaoMaterial.depthBuffer=s,this.ssaoMaterial.depthPacking=e}update(s,e,t){const i=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(s),this.ssaoPass.render(s,null,i)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e);const i=t.width,n=t.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(i,n),this.renderTarget.setSize(i,n),this.depthDownsamplingPass.resolution.scale=t.scale,this.depthDownsamplingPass.setSize(s,e)}initialize(s,e,t){try{let i=this.uniforms.get("normalDepthBuffer").value;i===null&&(this.depthDownsamplingPass.initialize(s,e,t),i=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=i,this.ssaoMaterial.normalDepthBuffer=i,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},mle=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,gle="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",yle=class extends VQ{constructor({kernelSize:s=Dc.MEDIUM,offset:e=0,rotation:t=0,focusArea:i=.4,feather:n=.3}={}){super(),this.fragmentShader=mle,this.vertexShader=gle,this.kernelSize=s,this.fragmentShader=Sv(this.fragmentShader),this.uniforms.aspect=new Se(1),this.uniforms.rotation=new Se(new ee),this.uniforms.maskParams=new Se(new Je),this._offset=e,this._focusArea=i,this._feather=n,this.rotation=t,this.updateParams()}updateParams(){const s=this.uniforms.maskParams.value,e=Math.max(this.focusArea,0),t=Math.max(e-this.feather,0);s.set(this.offset-e,this.offset-t,this.offset+e,this.offset+t)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(s){this.uniforms.rotation.value.set(Math.cos(s),Math.sin(s))}get offset(){return this._offset}set offset(s){this._offset=s,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(s){this._focusArea=s,this.updateParams()}get feather(){return this._feather}set feather(s){this._feather=s,this.updateParams()}setSize(s,e){super.setSize(s,e),this.uniforms.aspect.value=s/e}},vle=class extends lk{constructor({offset:s=0,rotation:e=0,focusArea:t=.4,feather:i=.3,kernelSize:n=Dc.MEDIUM,resolutionScale:r=.5,resolutionX:o=Ii.AUTO_SIZE,resolutionY:a=Ii.AUTO_SIZE}={}){super({kernelSize:n,resolutionScale:r,resolutionX:o,resolutionY:a}),this.blurMaterial=new yle({kernelSize:n,offset:s,rotation:e,focusArea:t,feather:i})}},Ale=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,_le="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",tW=class extends vo{constructor({blendFunction:e,offset:t=0,rotation:i=0,focusArea:n=.4,feather:r=.3,kernelSize:o=Dc.MEDIUM,resolutionScale:a=.5,resolutionX:l=Ii.AUTO_SIZE,resolutionY:c=Ii.AUTO_SIZE}={}){super("TiltShiftEffect",Ale,{vertexShader:_le,blendFunction:e,uniforms:new Map([["rotation",new Se(new ee)],["maskParams",new Se(new ee)],["map",new Se(null)]])}),this._offset=t,this._focusArea=n,this._feather=r,this.renderTarget=new $t(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new vle({kernelSize:o,resolutionScale:a,resolutionX:l,resolutionY:c,offset:t,rotation:i,focusArea:n,feather:r});const h=this.resolution=new Ii(this,l,c,a);h.addEventListener("change",u=>this.setSize(h.baseWidth,h.baseHeight)),this.rotation=i,this.updateParams()}updateParams(){const e=this.uniforms.get("maskParams").value,t=Math.max(this.focusArea-this.feather,0);e.set(this.offset-t,this.offset+t)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(e){this.uniforms.get("rotation").value.set(Math.cos(e),Math.sin(e)),this.blurPass.blurMaterial.rotation=e}get offset(){return this._offset}set offset(e){this._offset=e,this.blurPass.blurMaterial.offset=e,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(e){this._focusArea=e,this.blurPass.blurMaterial.focusArea=e,this.updateParams()}get feather(){return this._feather}set feather(e){this._feather=e,this.blurPass.blurMaterial.feather=e,this.updateParams()}get bias(){return 0}set bias(e){}update(e,t,i){this.blurPass.render(e,t,this.renderTarget)}setSize(e,t){const i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.blurPass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e!==null&&e.outputColorSpace===bt&&(this.renderTarget.texture.colorSpace=bt))}},ble=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,xle=class extends kt{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new Se(null),luminanceBuffer1:new Se(null),minLuminance:new Se(.01),deltaTime:new Se(0),tau:new Se(1)},extensions:{shaderTextureLOD:!0},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ble,vertexShader:mm})}set luminanceBuffer0(s){this.uniforms.luminanceBuffer0.value=s}setLuminanceBuffer0(s){this.uniforms.luminanceBuffer0.value=s}set luminanceBuffer1(s){this.uniforms.luminanceBuffer1.value=s}setLuminanceBuffer1(s){this.uniforms.luminanceBuffer1.value=s}set mipLevel1x1(s){this.defines.MIP_LEVEL_1X1=s.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(s){this.mipLevel1x1=s}set deltaTime(s){this.uniforms.deltaTime.value=s}setDeltaTime(s){this.uniforms.deltaTime.value=s}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(s){this.uniforms.minLuminance.value=s}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(s){this.uniforms.minLuminance.value=s}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(s){this.uniforms.tau.value=s}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(s){this.uniforms.tau.value=s}},wle=class extends _r{constructor(s,{minLuminance:e=.01,adaptationRate:t=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new xle,this.needsSwap=!1,this.renderTargetPrevious=new $t(1,1,{minFilter:Ot,magFilter:Ot,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const i=this.fullscreenMaterial;i.luminanceBuffer0=this.renderTargetPrevious.texture,i.luminanceBuffer1=s,i.minLuminance=e,i.adaptationRate=t,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new HQ(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(s){this.fullscreenMaterial.mipLevel1x1=s}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(s){this.fullscreenMaterial.adaptationRate=s}render(s,e,t,i,n){this.fullscreenMaterial.deltaTime=i,s.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),s.render(this.scene,this.camera),this.copyPass.render(s,this.renderTargetAdapted)}},Sle=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,K1=class extends vo{constructor({blendFunction:e=Xt.SRC,adaptive:t=!1,mode:i=t?Us.REINHARD2_ADAPTIVE:Us.AGX,resolution:n=256,maxLuminance:r=4,whitePoint:o=r,middleGrey:a=.6,minLuminance:l=.01,averageLuminance:c=1,adaptationRate:h=1}={}){super("ToneMappingEffect",Sle,{blendFunction:e,uniforms:new Map([["luminanceBuffer",new Se(null)],["maxLuminance",new Se(r)],["whitePoint",new Se(o)],["middleGrey",new Se(a)],["averageLuminance",new Se(c)]])}),this.renderTargetLuminance=new $t(1,1,{minFilter:Do,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new QQ({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new wle(this.luminancePass.texture,{minLuminance:l,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=n,this.mode=i}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(e){if(this.mode!==e){switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",e.toFixed(0)),e){case Us.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case Us.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case Us.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)","OptimizedCineonToneMapping(texel)");break;case Us.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case Us.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case Us.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=e===Us.REINHARD2_ADAPTIVE,this.setChanged()}}getMode(){return this.mode}setMode(e){this.mode=e}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(e){this.uniforms.get("whitePoint").value=e}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(e){this.uniforms.get("middleGrey").value=e}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(e){this.uniforms.get("averageLuminance").value=e}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(e){const t=Math.max(0,Math.ceil(Math.log2(e))),i=Math.pow(2,t);this.luminancePass.resolution.setPreferredSize(i,i),this.adaptiveLuminanceMaterial.mipLevel1x1=t}getResolution(){return this.resolution}setResolution(e){this.resolution=e}get adaptive(){return this.mode===Us.REINHARD2_ADAPTIVE}set adaptive(e){this.mode=e?Us.REINHARD2_ADAPTIVE:Us.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(e){this.adaptiveLuminanceMaterial.adaptationRate=e}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(e){console.warn(this.name,"distinction was removed.")}update(e,t,i){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(e,t),this.adaptiveLuminancePass.render(e,null,null,i))}initialize(e,t,i){this.adaptiveLuminancePass.initialize(e,t,i)}},Cle=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,iW=class extends vo{constructor({blendFunction:s,eskil:e=!1,technique:t=e?x0.ESKIL:x0.DEFAULT,offset:i=.5,darkness:n=.5}={}){super("VignetteEffect",Cle,{blendFunction:s,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new Se(i)],["darkness",new Se(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(s){this.technique!==s&&(this.defines.set("VIGNETTE_TECHNIQUE",s.toFixed(0)),this.setChanged())}get eskil(){return this.technique===x0.ESKIL}set eskil(s){this.technique=s?x0.ESKIL:x0.DEFAULT}getTechnique(){return this.technique}setTechnique(s){this.technique=s}get offset(){return this.uniforms.get("offset").value}set offset(s){this.uniforms.get("offset").value=s}getOffset(){return this.offset}setOffset(s){this.offset=s}get darkness(){return this.uniforms.get("darkness").value}set darkness(s){this.uniforms.get("darkness").value=s}getDarkness(){return this.darkness}setDarkness(s){this.darkness=s}},Ele=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Mle="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Tle=class extends kt{constructor(s,e,t,i,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:su.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Se(null),depthBuffer:new Se(null),resolution:new Se(new ee),texelSize:new Se(new ee),cameraNear:new Se(.3),cameraFar:new Se(1e3),aspect:new Se(1),time:new Se(0)},blending:xn,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:n}),s&&this.setShaderParts(s),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(i)}set inputBuffer(s){this.uniforms.inputBuffer.value=s}setInputBuffer(s){this.uniforms.inputBuffer.value=s}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(s){this.uniforms.depthBuffer.value=s}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(s){this.defines.DEPTH_PACKING=s.toFixed(0),this.needsUpdate=!0}setDepthBuffer(s,e=gr){this.depthBuffer=s,this.depthPacking=e}setShaderData(s){this.setShaderParts(s.shaderParts),this.setDefines(s.defines),this.setUniforms(s.uniforms),this.setExtensions(s.extensions)}setShaderParts(s){return this.fragmentShader=Ele.replace(wi.FRAGMENT_HEAD,s.get(wi.FRAGMENT_HEAD)||"").replace(wi.FRAGMENT_MAIN_UV,s.get(wi.FRAGMENT_MAIN_UV)||"").replace(wi.FRAGMENT_MAIN_IMAGE,s.get(wi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Mle.replace(wi.VERTEX_HEAD,s.get(wi.VERTEX_HEAD)||"").replace(wi.VERTEX_MAIN_SUPPORT,s.get(wi.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=Sv(this.fragmentShader),this.needsUpdate=!0,this}setDefines(s){for(const e of s.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(s){for(const e of s.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(s){this.extensions={};for(const e of s)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(s){this.encodeOutput!==s&&(s?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(s){return this.encodeOutput}setOutputEncodingEnabled(s){this.encodeOutput=s}get time(){return this.uniforms.time.value}set time(s){this.uniforms.time.value=s}setDeltaTime(s){this.uniforms.time.value+=s}adoptCameraSettings(s){this.copyCameraSettings(s)}copyCameraSettings(s){s&&(this.uniforms.cameraNear.value=s.near,this.uniforms.cameraFar.value=s.far,s instanceof Vt?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(s,e){const t=this.uniforms;t.resolution.value.set(s,e),t.texelSize.value.set(1/s,1/e),t.aspect.value=s/e}static get Section(){return wi}};function YN(s,e,t){for(const i of e){const n="$1"+s+i.charAt(0).toUpperCase()+i.slice(1),r=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(r,n))}}function Ile(s,e,t){let i=e.getFragmentShader(),n=e.getVertexShader();const r=i!==void 0&&/mainImage/.test(i),o=i!==void 0&&/mainUv/.test(i);if(t.attributes|=e.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&t.attributes&ga.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!r&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,l=t.shaderParts;let c=l.get(wi.FRAGMENT_HEAD)||"",h=l.get(wi.FRAGMENT_MAIN_UV)||"",u=l.get(wi.FRAGMENT_MAIN_IMAGE)||"",f=l.get(wi.VERTEX_HEAD)||"",p=l.get(wi.VERTEX_MAIN_SUPPORT)||"";const m=new Set,v=new Set;if(o&&(h+=`	${s}MainUv(UV);
`,t.uvTransformation=!0),n!==null&&/mainSupport/.test(n)){const A=/mainSupport *\([\w\s]*?uv\s*?\)/.test(n);p+=`	${s}MainSupport(`,p+=A?`vUv);
`:`);
`;for(const _ of n.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const b of _[1].split(/\s*,\s*/))t.varyings.add(b),m.add(b),v.add(b);for(const _ of n.matchAll(a))v.add(_[1])}for(const A of i.matchAll(a))v.add(A[1]);for(const A of e.defines.keys())v.add(A.replace(/\([\w\s,]*\)/g,""));for(const A of e.uniforms.keys())v.add(A);v.delete("while"),v.delete("for"),v.delete("if"),e.uniforms.forEach((A,_)=>t.uniforms.set(s+_.charAt(0).toUpperCase()+_.slice(1),A)),e.defines.forEach((A,_)=>t.defines.set(s+_.charAt(0).toUpperCase()+_.slice(1),A));const g=new Map([["fragment",i],["vertex",n]]);YN(s,v,t.defines),YN(s,v,g),i=g.get("fragment"),n=g.get("vertex");const y=e.blendMode;if(t.blendModes.set(y.blendFunction,y),r){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(u+=e.inputColorSpace===bt?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Bo?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const A=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;u+=`${s}MainImage(color0, UV, `,t.attributes&ga.DEPTH&&A.test(i)&&(u+="depth, ",t.readDepth=!0),u+=`color1);
	`;const _=s+"BlendOpacity";t.uniforms.set(_,y.opacity),u+=`color0 = blend${y.blendFunction}(color0, color1, ${_});

	`,c+=`uniform float ${_};

`}if(c+=i+`
`,n!==null&&(f+=n+`
`),l.set(wi.FRAGMENT_HEAD,c),l.set(wi.FRAGMENT_MAIN_UV,h),l.set(wi.FRAGMENT_MAIN_IMAGE,u),l.set(wi.VERTEX_HEAD,f),l.set(wi.VERTEX_MAIN_SUPPORT,p),e.extensions!==null)for(const A of e.extensions)t.extensions.add(A)}}var KN=class extends _r{constructor(s,...e){super("EffectPass"),this.fullscreenMaterial=new Tle(null,null,null,s),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(s){for(const e of this.effects)e.mainScene=s}set mainCamera(s){this.fullscreenMaterial.copyCameraSettings(s);for(const e of this.effects)e.mainCamera=s}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(s){this.fullscreenMaterial.encodeOutput=s}get dithering(){return this.fullscreenMaterial.dithering}set dithering(s){const e=this.fullscreenMaterial;e.dithering=s,e.needsUpdate=!0}setEffects(s){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=s.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const s=new Hoe;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===Xt.DST)s.attributes|=o.getAttributes()&ga.DEPTH;else{if(s.attributes&o.getAttributes()&ga.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);Ile("e"+e++,o,s)}let t=s.shaderParts.get(wi.FRAGMENT_HEAD),i=s.shaderParts.get(wi.FRAGMENT_MAIN_IMAGE),n=s.shaderParts.get(wi.FRAGMENT_MAIN_UV);const r=/\bblend\b/g;for(const o of s.blendModes.values())t+=o.getShaderCode().replace(r,`blend${o.blendFunction}`)+`
`;s.attributes&ga.DEPTH?(s.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,s.colorSpace===bt&&(i+=`color0 = sRGBToLinear(color0);
	`),s.uvTransformation?(n=`vec2 transformedUv = vUv;
`+n,s.defines.set("UV","transformedUv")):s.defines.set("UV","vUv"),s.shaderParts.set(wi.FRAGMENT_HEAD,t),s.shaderParts.set(wi.FRAGMENT_MAIN_IMAGE,i),s.shaderParts.set(wi.FRAGMENT_MAIN_UV,n);for(const[o,a]of s.shaderParts)a!==null&&s.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(s)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(s,e=gr){this.fullscreenMaterial.depthBuffer=s,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(s,e)}render(s,e,t,i,n){for(const r of this.effects)r.update(s,e,i);if(!this.skipRendering||this.renderToScreen){const r=this.fullscreenMaterial;r.inputBuffer=e.texture,r.time+=i*this.timeScale,s.setRenderTarget(this.renderToScreen?null:t),s.render(this.scene,this.camera)}}setSize(s,e){this.fullscreenMaterial.setSize(s,e);for(const t of this.effects)t.setSize(s,e)}initialize(s,e,t){this.renderer=s;for(const i of this.effects)i.initialize(s,e,t);this.updateMaterial(),t!==void 0&&t!==wn&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const s of this.effects)s.removeEventListener("change",this.listener),s.dispose()}handleEvent(s){switch(s.type){case"change":this.recompile();break}}},nW=class extends _r{constructor(s,e,{renderTarget:t,resolutionScale:i=1,width:n=Ii.AUTO_SIZE,height:r=Ii.AUTO_SIZE,resolutionX:o=n,resolutionY:a=r}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new kM(s,e,new gM);const l=this.renderPass;l.ignoreBackground=!0,l.skipShadowMapUpdate=!0;const c=l.getClearPass();c.overrideClearColor=new Ae(7829503),c.overrideClearAlpha=1,this.renderTarget=t,this.renderTarget===void 0&&(this.renderTarget=new $t(1,1,{minFilter:Ot,magFilter:Ot}),this.renderTarget.texture.name="NormalPass.Target");const h=this.resolution=new Ii(this,o,a,i);h.addEventListener("change",u=>this.setSize(h.baseWidth,h.baseHeight))}set mainScene(s){this.renderPass.mainScene=s}set mainCamera(s){this.renderPass.mainCamera=s}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(s){this.resolution.scale=s}render(s,e,t,i,n){const r=this.renderToScreen?null:this.renderTarget;this.renderPass.render(s,r,r)}setSize(s,e){const t=this.resolution;t.setBaseSize(s,e),this.renderTarget.setSize(t.width,t.height)}},YA=function(){var s=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(h){h.preventDefault(),i(++s%e.children.length)},!1);function t(h){return e.appendChild(h.dom),h}function i(h){for(var u=0;u<e.children.length;u++)e.children[u].style.display=u===h?"block":"none";s=h}var n=(performance||Date).now(),r=n,o=0,a=t(new YA.Panel("FPS","#0ff","#002")),l=t(new YA.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new YA.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:t,showPanel:i,begin:function(){n=(performance||Date).now()},end:function(){o++;var h=(performance||Date).now();if(l.update(h-n,200),h>=r+1e3&&(a.update(o*1e3/(h-r),100),r=h,o=0,c)){var u=performance.memory;c.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return h},update:function(){n=this.end()},domElement:e,setMode:i}};YA.Panel=function(s,e,t){var i=1/0,n=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,h=2*o,u=3*o,f=15*o,p=74*o,m=30*o,v=document.createElement("canvas");v.width=a,v.height=l,v.style.cssText="width:80px;height:48px";var g=v.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=t,g.fillRect(0,0,a,l),g.fillStyle=e,g.fillText(s,c,h),g.fillRect(u,f,p,m),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(u,f,p,m),{dom:v,update:function(y,A){i=Math.min(i,y),n=Math.max(n,y),g.fillStyle=t,g.globalAlpha=1,g.fillRect(0,0,a,f),g.fillStyle=e,g.fillText(r(y)+" "+s+" ("+r(i)+"-"+r(n)+")",c,h),g.drawImage(v,u+o,f,p-o,m,u,f,p-o,m),g.fillRect(u+p-o,f,o,m),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(u+p-o,f,o,r((1-y/A)*m))}}};const Rle=YA,Ple=ie("debugpatch");function FM(s,e,t,i){const n=Ple===e;if(!t&&!i)return;const r=e+"___needle";Dle(s,e,t,i);const o=Object.getOwnPropertyDescriptor(s,e),a=s[e];n&&console.log("Patch",s.constructor.name,e,o,a),o?(n&&console.log("Apply patch with existing descriptor",s.constructor.name,e,o),typeof o.value=="function"&&(s[e]=ZN(o.value,s,e))):(n&&console.log("Create patch with new property",s.constructor.name,e,o),Object.defineProperty(s,e,{set:function(l){if(typeof l=="function")this[r]=ZN(l,s,e);else{const c=this[r];sW(s,e,this,c,l),this[r]=l,rW(s,e,this,c,l)}},get:function(){const l=this[r];return typeof l=="function"&&l[r]?l[r]:l}}))}function Ble(s,e,t){const i=dk(s,e);if(i)for(let n=i.length-1;n>=0;n--){const r=i[n];r.prefix===t&&(r.prefix=null),r.postfix===t&&(r.postfix=null),!r.prefix&&!r.postfix&&i.splice(n,1)}}const JN=Symbol("Needle:Patches:WrappedFunction");function ZN(s,e,t){if(s[JN])return s;const i=function(...n){sW(e,t,this,...n);const r=s.apply(this,n);return rW(e,t,this,r,...n),r};return i[JN]=!0,i}const $C="Needle:Patches";function N2(){return globalThis[$C]||(globalThis[$C]=new WeakMap),globalThis[$C]}function dk(s,e){const t=N2().get(s);return t?t.get(e):null}function Dle(s,e,t,i){let n=N2().get(s);n||(n=new Map,N2().set(s,n));let r=n.get(e);r||(r=[],n.set(e,r)),r.push({prefix:t,postfix:i})}function sW(s,e,t,...i){var r;if(!t)return;const n=dk(s,e);if(n)for(const o of n)(r=o.prefix)==null||r.call(t,...i)}function rW(s,e,t,i,...n){var o;if(!t)return;const r=dk(s,e);if(r)for(const a of r)(o=a.postfix)==null||o.call(t,i,...n)}const oW="";globalThis.GLTF_PROGRESSIVE_VERSION=oW;console.debug(`[gltf-progressive] version ${oW}`);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const aW="166",J1=0,Ole=1,Lle=2,$N=1,ez=100,tz=204,iz=205,nz=3,kle=0,sz="attached",Fle="detached",lW=300,Ule=301,H_=1e3,Sp=1001,z2=1002,V_=1003,Nle=1004,zle=1005,Q_=1006,Gle=1007,UM=1008,qa=1009,kp=1015,e1=1016,yd=1023,yy=1028,yA=1030,Hle=33777,Vle=33779,Qle=35840,Wle=35842,jle=36196,qle=37492,Xle=37496,Yle=37808,rz=37812,Kle=36492,W_=2300,j_=2301,nR=2302,oz=2400,az=2401,lz=2402,Jle=2500,Zle=0,cW=1,G2=2,$le=0,Z1="",zr="srgb",zo="srgb-linear",hW="display-p3",fk="display-p3-linear",H2="linear",cz="srgb",hz="rec709",uz="p3",hg=7680,dz=519,V2=35044,Cp=2e3,Q2=2001;class NM{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e);e.target=null}}}const Rr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let fz=1234567;const KA=Math.PI/180,q_=180/Math.PI;function Ul(){const s=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Rr[s&255]+Rr[s>>8&255]+Rr[s>>16&255]+Rr[s>>24&255]+"-"+Rr[e&255]+Rr[e>>8&255]+"-"+Rr[e>>16&15|64]+Rr[e>>24&255]+"-"+Rr[t&63|128]+Rr[t>>8&255]+"-"+Rr[t>>16&255]+Rr[t>>24&255]+Rr[i&255]+Rr[i>>8&255]+Rr[i>>16&255]+Rr[i>>24&255]).toLowerCase()}function Gr(s,e,t){return Math.max(e,Math.min(t,s))}function pk(s,e){return(s%e+e)%e}function ece(s,e,t,i,n){return i+(s-e)*(n-i)/(t-e)}function tce(s,e,t){return s!==e?(t-s)/(e-s):0}function JA(s,e,t){return(1-t)*s+t*e}function ice(s,e,t,i){return JA(s,e,1-Math.exp(-t*i))}function nce(s,e=1){return e-Math.abs(pk(s,e*2)-e)}function sce(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*(3-2*s))}function rce(s,e,t){return s<=e?0:s>=t?1:(s=(s-e)/(t-e),s*s*s*(s*(s*6-15)+10))}function oce(s,e){return s+Math.floor(Math.random()*(e-s+1))}function ace(s,e){return s+Math.random()*(e-s)}function lce(s){return s*(.5-Math.random())}function cce(s){s!==void 0&&(fz=s);let e=fz+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function hce(s){return s*KA}function uce(s){return s*q_}function dce(s){return(s&s-1)===0&&s!==0}function fce(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function pce(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function mce(s,e,t,i,n){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),u=r((e-i)/2),f=o((e-i)/2),p=r((i-e)/2),m=o((i-e)/2);switch(n){case"XYX":s.set(a*h,l*u,l*f,a*c);break;case"YZY":s.set(l*f,a*h,l*u,a*c);break;case"ZXZ":s.set(l*u,l*f,a*h,a*c);break;case"XZX":s.set(a*h,l*m,l*p,a*c);break;case"YXY":s.set(l*p,a*h,l*m,a*c);break;case"ZYZ":s.set(l*m,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Dl(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function Di(s,e){switch(e.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const gce={DEG2RAD:KA,RAD2DEG:q_,generateUUID:Ul,clamp:Gr,euclideanModulo:pk,mapLinear:ece,inverseLerp:tce,lerp:JA,damp:ice,pingpong:nce,smoothstep:sce,smootherstep:rce,randInt:oce,randFloat:ace,randFloatSpread:lce,seededRandom:cce,degToRad:hce,radToDeg:uce,isPowerOfTwo:dce,ceilPowerOfTwo:fce,floorPowerOfTwo:pce,setQuaternionFromProperEuler:mce,normalize:Di,denormalize:Dl};class Bn{constructor(e=0,t=0){Bn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Gr(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*n+e.x,this.y=r*n+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class uu{constructor(e,t,i,n,r,o,a,l,c){uu.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c)}set(e,t,i,n,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=n,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],u=i[7],f=i[2],p=i[5],m=i[8],v=n[0],g=n[3],y=n[6],A=n[1],_=n[4],b=n[7],x=n[2],E=n[5],M=n[8];return r[0]=o*v+a*A+l*x,r[3]=o*g+a*_+l*E,r[6]=o*y+a*b+l*M,r[1]=c*v+h*A+u*x,r[4]=c*g+h*_+u*E,r[7]=c*y+h*b+u*M,r[2]=f*v+p*A+m*x,r[5]=f*g+p*_+m*E,r[8]=f*y+p*b+m*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+n*r*c-n*o*l}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=h*o-a*c,f=a*l-h*r,p=c*r-o*l,m=t*u+i*f+n*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/m;return e[0]=u*v,e[1]=(n*c-h*i)*v,e[2]=(a*i-n*o)*v,e[3]=f*v,e[4]=(h*t-n*l)*v,e[5]=(n*r-a*t)*v,e[6]=p*v,e[7]=(i*l-c*t)*v,e[8]=(o*t-i*r)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-n*c,n*l,-n*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(sR.makeScale(e,t)),this}rotate(e){return this.premultiply(sR.makeRotation(-e)),this}translate(e,t){return this.premultiply(sR.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const sR=new uu;function yce(s){for(let e=s.length-1;e>=0;--e)if(s[e]>=65535)return!0;return!1}function W2(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}const pz={};function uW(s){s in pz||(pz[s]=!0,console.warn(s))}const mz=new uu().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),gz=new uu().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Qw={[zo]:{transfer:H2,primaries:hz,toReference:s=>s,fromReference:s=>s},[zr]:{transfer:cz,primaries:hz,toReference:s=>s.convertSRGBToLinear(),fromReference:s=>s.convertLinearToSRGB()},[fk]:{transfer:H2,primaries:uz,toReference:s=>s.applyMatrix3(gz),fromReference:s=>s.applyMatrix3(mz)},[hW]:{transfer:cz,primaries:uz,toReference:s=>s.convertSRGBToLinear().applyMatrix3(gz),fromReference:s=>s.applyMatrix3(mz).convertLinearToSRGB()}},vce=new Set([zo,fk]),$o={enabled:!0,_workingColorSpace:zo,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(s){if(!vce.has(s))throw new Error(`Unsupported working color space, "${s}".`);this._workingColorSpace=s},convert:function(s,e,t){if(this.enabled===!1||e===t||!e||!t)return s;const i=Qw[e].toReference,n=Qw[t].fromReference;return n(i(s))},fromWorkingColorSpace:function(s,e){return this.convert(s,this._workingColorSpace,e)},toWorkingColorSpace:function(s,e){return this.convert(s,e,this._workingColorSpace)},getPrimaries:function(s){return Qw[s].primaries},getTransfer:function(s){return s===Z1?H2:Qw[s].transfer}};function Oy(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function rR(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}let ug;class Ace{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{ug===void 0&&(ug=W2("canvas")),ug.width=e.width,ug.height=e.height;const i=ug.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=ug}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=W2("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let o=0;o<r.length;o++)r[o]=Oy(r[o]/255)*255;return i.putImageData(n,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Oy(t[i]/255)*255):t[i]=Oy(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let _ce=0;class bce{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_ce++}),this.uuid=Ul(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let r;if(Array.isArray(n)){r=[];for(let o=0,a=n.length;o<a;o++)n[o].isDataTexture?r.push(oR(n[o].image)):r.push(oR(n[o]))}else r=oR(n);i.url=r}return t||(e.images[this.uuid]=i),i}}function oR(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?Ace.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let xce=0;class Gs extends NM{constructor(e=Gs.DEFAULT_IMAGE,t=Gs.DEFAULT_MAPPING,i=Sp,n=Sp,r=Q_,o=UM,a=yd,l=qa,c=Gs.DEFAULT_ANISOTROPY,h=Z1){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:xce++}),this.uuid=Ul(),this.name="",this.source=new bce(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Bn(0,0),this.repeat=new Bn(1,1),this.center=new Bn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new uu,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==lW)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case H_:e.x=e.x-Math.floor(e.x);break;case Sp:e.x=e.x<0?0:1;break;case z2:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case H_:e.y=e.y-Math.floor(e.y);break;case Sp:e.y=e.y<0?0:1;break;case z2:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Gs.DEFAULT_IMAGE=null;Gs.DEFAULT_MAPPING=lW;Gs.DEFAULT_ANISOTROPY=1;class Ya{constructor(e=0,t=0,i=0,n=1){Ya.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const l=e.elements,c=l[0],h=l[4],u=l[8],f=l[1],p=l[5],m=l[9],v=l[2],g=l[6],y=l[10];if(Math.abs(h-f)<.01&&Math.abs(u-v)<.01&&Math.abs(m-g)<.01){if(Math.abs(h+f)<.1&&Math.abs(u+v)<.1&&Math.abs(m+g)<.1&&Math.abs(c+p+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(c+1)/2,b=(p+1)/2,x=(y+1)/2,E=(h+f)/4,M=(u+v)/4,T=(m+g)/4;return _>b&&_>x?_<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(_),n=E/i,r=M/i):b>x?b<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(b),i=E/n,r=T/n):x<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(x),i=M/r,n=T/r),this.set(i,n,r,t),this}let A=Math.sqrt((g-m)*(g-m)+(u-v)*(u-v)+(f-h)*(f-h));return Math.abs(A)<.001&&(A=1),this.x=(g-m)/A,this.y=(u-v)/A,this.z=(f-h)/A,this.w=Math.acos((c+p+y-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class wce extends Gs{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=V_,this.minFilter=V_,this.wrapR=Sp,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class sf{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,o,a){let l=i[n+0],c=i[n+1],h=i[n+2],u=i[n+3];const f=r[o+0],p=r[o+1],m=r[o+2],v=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u;return}if(a===1){e[t+0]=f,e[t+1]=p,e[t+2]=m,e[t+3]=v;return}if(u!==v||l!==f||c!==p||h!==m){let g=1-a;const y=l*f+c*p+h*m+u*v,A=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const x=Math.sqrt(_),E=Math.atan2(x,y*A);g=Math.sin(g*E)/x,a=Math.sin(a*E)/x}const b=a*A;if(l=l*g+f*b,c=c*g+p*b,h=h*g+m*b,u=u*g+v*b,g===1-a){const x=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=x,c*=x,h*=x,u*=x}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,n,r,o){const a=i[n],l=i[n+1],c=i[n+2],h=i[n+3],u=r[o],f=r[o+1],p=r[o+2],m=r[o+3];return e[t]=a*m+h*u+l*p-c*f,e[t+1]=l*m+h*f+c*u-a*p,e[t+2]=c*m+h*p+a*f-l*u,e[t+3]=h*m-a*u-l*f-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,n=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(n/2),u=a(r/2),f=l(i/2),p=l(n/2),m=l(r/2);switch(o){case"XYZ":this._x=f*h*u+c*p*m,this._y=c*p*u-f*h*m,this._z=c*h*m+f*p*u,this._w=c*h*u-f*p*m;break;case"YXZ":this._x=f*h*u+c*p*m,this._y=c*p*u-f*h*m,this._z=c*h*m-f*p*u,this._w=c*h*u+f*p*m;break;case"ZXY":this._x=f*h*u-c*p*m,this._y=c*p*u+f*h*m,this._z=c*h*m+f*p*u,this._w=c*h*u-f*p*m;break;case"ZYX":this._x=f*h*u-c*p*m,this._y=c*p*u+f*h*m,this._z=c*h*m-f*p*u,this._w=c*h*u+f*p*m;break;case"YZX":this._x=f*h*u+c*p*m,this._y=c*p*u+f*h*m,this._z=c*h*m-f*p*u,this._w=c*h*u-f*p*m;break;case"XZY":this._x=f*h*u-c*p*m,this._y=c*p*u-f*h*m,this._z=c*h*m+f*p*u,this._w=c*h*u+f*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],u=t[10],f=i+a+u;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(h-l)*p,this._y=(r-c)*p,this._z=(o-n)*p}else if(i>a&&i>u){const p=2*Math.sqrt(1+i-a-u);this._w=(h-l)/p,this._x=.25*p,this._y=(n+o)/p,this._z=(r+c)/p}else if(a>u){const p=2*Math.sqrt(1+a-i-u);this._w=(r-c)/p,this._x=(n+o)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+u-i-a);this._w=(o-n)/p,this._x=(r+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Gr(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+n*c-r*l,this._y=n*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-n*a,this._w=o*h-i*a-n*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,n=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*i+t*this._x,this._y=p*n+t*this._y,this._z=p*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),u=Math.sin((1-t)*h)/c,f=Math.sin(t*h)/c;return this._w=o*u+this._w*f,this._x=i*u+this._x*f,this._y=n*u+this._y*f,this._z=r*u+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(n*Math.sin(e),n*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class pe{constructor(e=0,t=0,i=0){pe.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(yz.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(yz.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*n-a*i),h=2*(a*t-r*n),u=2*(r*i-o*t);return this.x=t+l*c+o*u-a*h,this.y=i+l*h+a*c-r*u,this.z=n+l*u+r*h-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=n*l-r*a,this.y=r*o-i*l,this.z=i*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return aR.copy(this).projectOnVector(e),this.sub(aR)}reflect(e){return this.sub(aR.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Gr(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const aR=new pe,yz=new sf;class Vl{constructor(e=new pe(1/0,1/0,1/0),t=new pe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Al.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Al.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Al.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Al):Al.fromBufferAttribute(r,o),Al.applyMatrix4(e.matrixWorld),this.expandByPoint(Al);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Ww.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Ww.copy(i.boundingBox)),Ww.applyMatrix4(e.matrixWorld),this.union(Ww)}const n=e.children;for(let r=0,o=n.length;r<o;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Al),Al.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(w0),jw.subVectors(this.max,w0),dg.subVectors(e.a,w0),fg.subVectors(e.b,w0),pg.subVectors(e.c,w0),Lu.subVectors(fg,dg),ku.subVectors(pg,fg),Ff.subVectors(dg,pg);let t=[0,-Lu.z,Lu.y,0,-ku.z,ku.y,0,-Ff.z,Ff.y,Lu.z,0,-Lu.x,ku.z,0,-ku.x,Ff.z,0,-Ff.x,-Lu.y,Lu.x,0,-ku.y,ku.x,0,-Ff.y,Ff.x,0];return!lR(t,dg,fg,pg,jw)||(t=[1,0,0,0,1,0,0,0,1],!lR(t,dg,fg,pg,jw))?!1:(qw.crossVectors(Lu,ku),t=[qw.x,qw.y,qw.z],lR(t,dg,fg,pg,jw))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Al).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Al).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(uh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),uh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),uh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),uh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),uh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),uh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),uh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),uh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(uh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const uh=[new pe,new pe,new pe,new pe,new pe,new pe,new pe,new pe],Al=new pe,Ww=new Vl,dg=new pe,fg=new pe,pg=new pe,Lu=new pe,ku=new pe,Ff=new pe,w0=new pe,jw=new pe,qw=new pe,Uf=new pe;function lR(s,e,t,i,n){for(let r=0,o=s.length-3;r<=o;r+=3){Uf.fromArray(s,r);const a=n.x*Math.abs(Uf.x)+n.y*Math.abs(Uf.y)+n.z*Math.abs(Uf.z),l=e.dot(Uf),c=t.dot(Uf),h=i.dot(Uf);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const Sce=new Vl,S0=new pe,cR=new pe;class ql{constructor(e=new pe,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):Sce.setFromPoints(e).getCenter(i);let n=0;for(let r=0,o=e.length;r<o;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;S0.subVectors(e,this.center);const t=S0.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),n=(i-this.radius)*.5;this.center.addScaledVector(S0,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(cR.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(S0.copy(e.center).add(cR)),this.expandByPoint(S0.copy(e.center).sub(cR))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const dh=new pe,hR=new pe,Xw=new pe,Fu=new pe,uR=new pe,Yw=new pe,dR=new pe;class zM{constructor(e=new pe,t=new pe(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,dh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=dh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(dh.copy(this.origin).addScaledVector(this.direction,t),dh.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){hR.copy(e).add(t).multiplyScalar(.5),Xw.copy(t).sub(e).normalize(),Fu.copy(this.origin).sub(hR);const r=e.distanceTo(t)*.5,o=-this.direction.dot(Xw),a=Fu.dot(this.direction),l=-Fu.dot(Xw),c=Fu.lengthSq(),h=Math.abs(1-o*o);let u,f,p,m;if(h>0)if(u=o*l-a,f=o*a-l,m=r*h,u>=0)if(f>=-m)if(f<=m){const v=1/h;u*=v,f*=v,p=u*(u+o*f+2*a)+f*(o*u+f+2*l)+c}else f=r,u=Math.max(0,-(o*f+a)),p=-u*u+f*(f+2*l)+c;else f=-r,u=Math.max(0,-(o*f+a)),p=-u*u+f*(f+2*l)+c;else f<=-m?(u=Math.max(0,-(-o*r+a)),f=u>0?-r:Math.min(Math.max(-r,-l),r),p=-u*u+f*(f+2*l)+c):f<=m?(u=0,f=Math.min(Math.max(-r,-l),r),p=f*(f+2*l)+c):(u=Math.max(0,-(o*r+a)),f=u>0?r:Math.min(Math.max(-r,-l),r),p=-u*u+f*(f+2*l)+c);else f=o>0?-r:r,u=Math.max(0,-(o*f+a)),p=-u*u+f*(f+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,u),n&&n.copy(hR).addScaledVector(Xw,f),p}intersectSphere(e,t){dh.subVectors(e.center,this.origin);const i=dh.dot(this.direction),n=dh.dot(dh)-i*i,r=e.radius*e.radius;if(n>r)return null;const o=Math.sqrt(r-n),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,f=this.origin;return c>=0?(i=(e.min.x-f.x)*c,n=(e.max.x-f.x)*c):(i=(e.max.x-f.x)*c,n=(e.min.x-f.x)*c),h>=0?(r=(e.min.y-f.y)*h,o=(e.max.y-f.y)*h):(r=(e.max.y-f.y)*h,o=(e.min.y-f.y)*h),i>o||r>n||((r>i||isNaN(i))&&(i=r),(o<n||isNaN(n))&&(n=o),u>=0?(a=(e.min.z-f.z)*u,l=(e.max.z-f.z)*u):(a=(e.max.z-f.z)*u,l=(e.min.z-f.z)*u),i>l||a>n)||((a>i||i!==i)&&(i=a),(l<n||n!==n)&&(n=l),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return this.intersectBox(e,dh)!==null}intersectTriangle(e,t,i,n,r){uR.subVectors(t,e),Yw.subVectors(i,e),dR.crossVectors(uR,Yw);let o=this.direction.dot(dR),a;if(o>0){if(n)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Fu.subVectors(this.origin,e);const l=a*this.direction.dot(Yw.crossVectors(Fu,Yw));if(l<0)return null;const c=a*this.direction.dot(uR.cross(Fu));if(c<0||l+c>o)return null;const h=-a*Fu.dot(dR);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ui{constructor(e,t,i,n,r,o,a,l,c,h,u,f,p,m,v,g){ui.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,n,r,o,a,l,c,h,u,f,p,m,v,g)}set(e,t,i,n,r,o,a,l,c,h,u,f,p,m,v,g){const y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=n,y[1]=r,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=h,y[10]=u,y[14]=f,y[3]=p,y[7]=m,y[11]=v,y[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ui().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/mg.setFromMatrixColumn(e,0).length(),r=1/mg.setFromMatrixColumn(e,1).length(),o=1/mg.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(n),c=Math.sin(n),h=Math.cos(r),u=Math.sin(r);if(e.order==="XYZ"){const f=o*h,p=o*u,m=a*h,v=a*u;t[0]=l*h,t[4]=-l*u,t[8]=c,t[1]=p+m*c,t[5]=f-v*c,t[9]=-a*l,t[2]=v-f*c,t[6]=m+p*c,t[10]=o*l}else if(e.order==="YXZ"){const f=l*h,p=l*u,m=c*h,v=c*u;t[0]=f+v*a,t[4]=m*a-p,t[8]=o*c,t[1]=o*u,t[5]=o*h,t[9]=-a,t[2]=p*a-m,t[6]=v+f*a,t[10]=o*l}else if(e.order==="ZXY"){const f=l*h,p=l*u,m=c*h,v=c*u;t[0]=f-v*a,t[4]=-o*u,t[8]=m+p*a,t[1]=p+m*a,t[5]=o*h,t[9]=v-f*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const f=o*h,p=o*u,m=a*h,v=a*u;t[0]=l*h,t[4]=m*c-p,t[8]=f*c+v,t[1]=l*u,t[5]=v*c+f,t[9]=p*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const f=o*l,p=o*c,m=a*l,v=a*c;t[0]=l*h,t[4]=v-f*u,t[8]=m*u+p,t[1]=u,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=p*u+m,t[10]=f-v*u}else if(e.order==="XZY"){const f=o*l,p=o*c,m=a*l,v=a*c;t[0]=l*h,t[4]=-u,t[8]=c*h,t[1]=f*u+v,t[5]=o*h,t[9]=p*u-m,t[2]=m*u-p,t[6]=a*h,t[10]=v*u+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Cce,e,Ece)}lookAt(e,t,i){const n=this.elements;return Ko.subVectors(e,t),Ko.lengthSq()===0&&(Ko.z=1),Ko.normalize(),Uu.crossVectors(i,Ko),Uu.lengthSq()===0&&(Math.abs(i.z)===1?Ko.x+=1e-4:Ko.z+=1e-4,Ko.normalize(),Uu.crossVectors(i,Ko)),Uu.normalize(),Kw.crossVectors(Ko,Uu),n[0]=Uu.x,n[4]=Kw.x,n[8]=Ko.x,n[1]=Uu.y,n[5]=Kw.y,n[9]=Ko.y,n[2]=Uu.z,n[6]=Kw.z,n[10]=Ko.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],u=i[5],f=i[9],p=i[13],m=i[2],v=i[6],g=i[10],y=i[14],A=i[3],_=i[7],b=i[11],x=i[15],E=n[0],M=n[4],T=n[8],R=n[12],w=n[1],I=n[5],O=n[9],k=n[13],B=n[2],G=n[6],L=n[10],U=n[14],z=n[3],j=n[7],X=n[11],re=n[15];return r[0]=o*E+a*w+l*B+c*z,r[4]=o*M+a*I+l*G+c*j,r[8]=o*T+a*O+l*L+c*X,r[12]=o*R+a*k+l*U+c*re,r[1]=h*E+u*w+f*B+p*z,r[5]=h*M+u*I+f*G+p*j,r[9]=h*T+u*O+f*L+p*X,r[13]=h*R+u*k+f*U+p*re,r[2]=m*E+v*w+g*B+y*z,r[6]=m*M+v*I+g*G+y*j,r[10]=m*T+v*O+g*L+y*X,r[14]=m*R+v*k+g*U+y*re,r[3]=A*E+_*w+b*B+x*z,r[7]=A*M+_*I+b*G+x*j,r[11]=A*T+_*O+b*L+x*X,r[15]=A*R+_*k+b*U+x*re,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],u=e[6],f=e[10],p=e[14],m=e[3],v=e[7],g=e[11],y=e[15];return m*(+r*l*u-n*c*u-r*a*f+i*c*f+n*a*p-i*l*p)+v*(+t*l*p-t*c*f+r*o*f-n*o*p+n*c*h-r*l*h)+g*(+t*c*u-t*a*p-r*o*u+i*o*p+r*a*h-i*c*h)+y*(-n*a*h-t*l*u+t*a*f+n*o*u-i*o*f+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=e[9],f=e[10],p=e[11],m=e[12],v=e[13],g=e[14],y=e[15],A=u*g*c-v*f*c+v*l*p-a*g*p-u*l*y+a*f*y,_=m*f*c-h*g*c-m*l*p+o*g*p+h*l*y-o*f*y,b=h*v*c-m*u*c+m*a*p-o*v*p-h*a*y+o*u*y,x=m*u*l-h*v*l-m*a*f+o*v*f+h*a*g-o*u*g,E=t*A+i*_+n*b+r*x;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/E;return e[0]=A*M,e[1]=(v*f*r-u*g*r-v*n*p+i*g*p+u*n*y-i*f*y)*M,e[2]=(a*g*r-v*l*r+v*n*c-i*g*c-a*n*y+i*l*y)*M,e[3]=(u*l*r-a*f*r-u*n*c+i*f*c+a*n*p-i*l*p)*M,e[4]=_*M,e[5]=(h*g*r-m*f*r+m*n*p-t*g*p-h*n*y+t*f*y)*M,e[6]=(m*l*r-o*g*r-m*n*c+t*g*c+o*n*y-t*l*y)*M,e[7]=(o*f*r-h*l*r+h*n*c-t*f*c-o*n*p+t*l*p)*M,e[8]=b*M,e[9]=(m*u*r-h*v*r-m*i*p+t*v*p+h*i*y-t*u*y)*M,e[10]=(o*v*r-m*a*r+m*i*c-t*v*c-o*i*y+t*a*y)*M,e[11]=(h*a*r-o*u*r-h*i*c+t*u*c+o*i*p-t*a*p)*M,e[12]=x*M,e[13]=(h*v*n-m*u*n+m*i*f-t*v*f-h*i*g+t*u*g)*M,e[14]=(m*a*n-o*v*n-m*i*l+t*v*l+o*i*g-t*a*g)*M,e[15]=(o*u*n-h*a*n+h*i*l-t*u*l-o*i*f+t*a*f)*M,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-n*l,c*l+n*a,0,c*a+n*l,h*a+i,h*l-n*o,0,c*l-n*a,h*l+n*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,o){return this.set(1,i,r,0,e,1,o,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,u=a+a,f=r*c,p=r*h,m=r*u,v=o*h,g=o*u,y=a*u,A=l*c,_=l*h,b=l*u,x=i.x,E=i.y,M=i.z;return n[0]=(1-(v+y))*x,n[1]=(p+b)*x,n[2]=(m-_)*x,n[3]=0,n[4]=(p-b)*E,n[5]=(1-(f+y))*E,n[6]=(g+A)*E,n[7]=0,n[8]=(m+_)*M,n[9]=(g-A)*M,n[10]=(1-(f+v))*M,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=mg.set(n[0],n[1],n[2]).length();const o=mg.set(n[4],n[5],n[6]).length(),a=mg.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],_l.copy(this);const c=1/r,h=1/o,u=1/a;return _l.elements[0]*=c,_l.elements[1]*=c,_l.elements[2]*=c,_l.elements[4]*=h,_l.elements[5]*=h,_l.elements[6]*=h,_l.elements[8]*=u,_l.elements[9]*=u,_l.elements[10]*=u,t.setFromRotationMatrix(_l),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,n,r,o,a=Cp){const l=this.elements,c=2*r/(t-e),h=2*r/(i-n),u=(t+e)/(t-e),f=(i+n)/(i-n);let p,m;if(a===Cp)p=-(o+r)/(o-r),m=-2*o*r/(o-r);else if(a===Q2)p=-o/(o-r),m=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=h,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,n,r,o,a=Cp){const l=this.elements,c=1/(t-e),h=1/(i-n),u=1/(o-r),f=(t+e)*c,p=(i+n)*h;let m,v;if(a===Cp)m=(o+r)*u,v=-2*u;else if(a===Q2)m=r*u,v=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=v,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const mg=new pe,_l=new ui,Cce=new pe(0,0,0),Ece=new pe(1,1,1),Uu=new pe,Kw=new pe,Ko=new pe,vz=new ui,Az=new sf;class Cv{constructor(e=0,t=0,i=0,n=Cv.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,r=n[0],o=n[4],a=n[8],l=n[1],c=n[5],h=n[9],u=n[2],f=n[6],p=n[10];switch(t){case"XYZ":this._y=Math.asin(Gr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Gr(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Gr(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Gr(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Gr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-Gr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return vz.makeRotationFromQuaternion(e),this.setFromRotationMatrix(vz,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Az.setFromEuler(this),this.setFromQuaternion(Az,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Cv.DEFAULT_ORDER="XYZ";class Mce{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Tce=0;const _z=new pe,gg=new sf,fh=new ui,Jw=new pe,C0=new pe,Ice=new pe,Rce=new sf,bz=new pe(1,0,0),xz=new pe(0,1,0),wz=new pe(0,0,1),Sz={type:"added"},Pce={type:"removed"},yg={type:"childadded",child:null},fR={type:"childremoved",child:null};class Zn extends NM{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Tce++}),this.uuid=Ul(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Zn.DEFAULT_UP.clone();const e=new pe,t=new Cv,i=new sf,n=new pe(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ui},normalMatrix:{value:new uu}}),this.matrix=new ui,this.matrixWorld=new ui,this.matrixAutoUpdate=Zn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Zn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Mce,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return gg.setFromAxisAngle(e,t),this.quaternion.multiply(gg),this}rotateOnWorldAxis(e,t){return gg.setFromAxisAngle(e,t),this.quaternion.premultiply(gg),this}rotateX(e){return this.rotateOnAxis(bz,e)}rotateY(e){return this.rotateOnAxis(xz,e)}rotateZ(e){return this.rotateOnAxis(wz,e)}translateOnAxis(e,t){return _z.copy(e).applyQuaternion(this.quaternion),this.position.add(_z.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(bz,e)}translateY(e){return this.translateOnAxis(xz,e)}translateZ(e){return this.translateOnAxis(wz,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(fh.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Jw.copy(e):Jw.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),C0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fh.lookAt(C0,Jw,this.up):fh.lookAt(Jw,C0,this.up),this.quaternion.setFromRotationMatrix(fh),n&&(fh.extractRotation(n.matrixWorld),gg.setFromRotationMatrix(fh),this.quaternion.premultiply(gg.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Sz),yg.child=e,this.dispatchEvent(yg),yg.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Pce),fR.child=e,this.dispatchEvent(fR),fR.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),fh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),fh.multiply(e.parent.matrixWorld)),e.applyMatrix4(fh),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Sz),yg.child=e,this.dispatchEvent(yg),yg.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(C0,e,Ice),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(C0,Rce,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const n=this.children;for(let r=0,o=n.length;r<o;r++)n[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(n.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];r(e.shapes,u)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));n.material=a}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];n.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),u=o(e.shapes),f=o(e.skeletons),p=o(e.animations),m=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),u.length>0&&(i.shapes=u),f.length>0&&(i.skeletons=f),p.length>0&&(i.animations=p),m.length>0&&(i.nodes=m)}return i.object=n,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const n=e.children[i];this.add(n.clone())}return this}}Zn.DEFAULT_UP=new pe(0,1,0);Zn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Zn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const bl=new pe,ph=new pe,pR=new pe,mh=new pe,vg=new pe,Ag=new pe,Cz=new pe,mR=new pe,gR=new pe,yR=new pe;class vc{constructor(e=new pe,t=new pe,i=new pe){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),bl.subVectors(e,t),n.cross(bl);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){bl.subVectors(n,t),ph.subVectors(i,t),pR.subVectors(e,t);const o=bl.dot(bl),a=bl.dot(ph),l=bl.dot(pR),c=ph.dot(ph),h=ph.dot(pR),u=o*c-a*a;if(u===0)return r.set(0,0,0),null;const f=1/u,p=(c*l-a*h)*f,m=(o*h-a*l)*f;return r.set(1-p-m,m,p)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,mh)===null?!1:mh.x>=0&&mh.y>=0&&mh.x+mh.y<=1}static getInterpolation(e,t,i,n,r,o,a,l){return this.getBarycoord(e,t,i,n,mh)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,mh.x),l.addScaledVector(o,mh.y),l.addScaledVector(a,mh.z),l)}static isFrontFacing(e,t,i,n){return bl.subVectors(i,t),ph.subVectors(e,t),bl.cross(ph).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return bl.subVectors(this.c,this.b),ph.subVectors(this.a,this.b),bl.cross(ph).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return vc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return vc.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,n,r){return vc.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return vc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return vc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,r=this.c;let o,a;vg.subVectors(n,i),Ag.subVectors(r,i),mR.subVectors(e,i);const l=vg.dot(mR),c=Ag.dot(mR);if(l<=0&&c<=0)return t.copy(i);gR.subVectors(e,n);const h=vg.dot(gR),u=Ag.dot(gR);if(h>=0&&u<=h)return t.copy(n);const f=l*u-h*c;if(f<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(vg,o);yR.subVectors(e,r);const p=vg.dot(yR),m=Ag.dot(yR);if(m>=0&&p<=m)return t.copy(r);const v=p*c-l*m;if(v<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(i).addScaledVector(Ag,a);const g=h*m-p*u;if(g<=0&&u-h>=0&&p-m>=0)return Cz.subVectors(r,n),a=(u-h)/(u-h+(p-m)),t.copy(n).addScaledVector(Cz,a);const y=1/(g+v+f);return o=v*y,a=f*y,t.copy(i).addScaledVector(vg,o).addScaledVector(Ag,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const dW={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nu={h:0,s:0,l:0},Zw={h:0,s:0,l:0};function vR(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*6*(2/3-t):s}class us{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=zr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,$o.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=$o.workingColorSpace){return this.r=e,this.g=t,this.b=i,$o.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=$o.workingColorSpace){if(e=pk(e,1),t=Gr(t,0,1),i=Gr(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=vR(o,r,e+1/3),this.g=vR(o,r,e),this.b=vR(o,r,e-1/3)}return $o.toWorkingColorSpace(this,n),this}setStyle(e,t=zr){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=n[1],a=n[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=n[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=zr){const i=dW[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Oy(e.r),this.g=Oy(e.g),this.b=Oy(e.b),this}copyLinearToSRGB(e){return this.r=rR(e.r),this.g=rR(e.g),this.b=rR(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=zr){return $o.fromWorkingColorSpace(Pr.copy(this),e),Math.round(Gr(Pr.r*255,0,255))*65536+Math.round(Gr(Pr.g*255,0,255))*256+Math.round(Gr(Pr.b*255,0,255))}getHexString(e=zr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=$o.workingColorSpace){$o.fromWorkingColorSpace(Pr.copy(this),t);const i=Pr.r,n=Pr.g,r=Pr.b,o=Math.max(i,n,r),a=Math.min(i,n,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=h<=.5?u/(o+a):u/(2-o-a),o){case i:l=(n-r)/u+(n<r?6:0);break;case n:l=(r-i)/u+2;break;case r:l=(i-n)/u+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=$o.workingColorSpace){return $o.fromWorkingColorSpace(Pr.copy(this),t),e.r=Pr.r,e.g=Pr.g,e.b=Pr.b,e}getStyle(e=zr){$o.fromWorkingColorSpace(Pr.copy(this),e);const t=Pr.r,i=Pr.g,n=Pr.b;return e!==zr?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(e,t,i){return this.getHSL(Nu),this.setHSL(Nu.h+e,Nu.s+t,Nu.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Nu),e.getHSL(Zw);const i=JA(Nu.h,Zw.h,t),n=JA(Nu.s,Zw.s,t),r=JA(Nu.l,Zw.l,t);return this.setHSL(i,n,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,n=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*n,this.g=r[1]*t+r[4]*i+r[7]*n,this.b=r[2]*t+r[5]*i+r[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Pr=new us;us.NAMES=dW;let Bce=0;class Id extends NM{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Bce++}),this.uuid=Ul(),this.name="",this.type="Material",this.blending=$N,this.side=J1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=tz,this.blendDst=iz,this.blendEquation=ez,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new us(0,0,0),this.blendAlpha=0,this.depthFunc=nz,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=dz,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=hg,this.stencilZFail=hg,this.stencilZPass=hg,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];if(n===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==$N&&(i.blending=this.blending),this.side!==J1&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==tz&&(i.blendSrc=this.blendSrc),this.blendDst!==iz&&(i.blendDst=this.blendDst),this.blendEquation!==ez&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==nz&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==dz&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==hg&&(i.stencilFail=this.stencilFail),this.stencilZFail!==hg&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==hg&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=n(e.textures),o=n(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const n=t.length;i=new Array(n);for(let r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class vy extends Id{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new us(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Cv,this.combine=kle,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const is=new pe,$w=new Bn;class ya{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=V2,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=kp,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return uW("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)$w.fromBufferAttribute(this,t),$w.applyMatrix3(e),this.setXY(t,$w.x,$w.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)is.fromBufferAttribute(this,t),is.applyMatrix3(e),this.setXYZ(t,is.x,is.y,is.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)is.fromBufferAttribute(this,t),is.applyMatrix4(e),this.setXYZ(t,is.x,is.y,is.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)is.fromBufferAttribute(this,t),is.applyNormalMatrix(e),this.setXYZ(t,is.x,is.y,is.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)is.fromBufferAttribute(this,t),is.transformDirection(e),this.setXYZ(t,is.x,is.y,is.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Dl(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Di(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Dl(t,this.array)),t}setX(e,t){return this.normalized&&(t=Di(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Dl(t,this.array)),t}setY(e,t){return this.normalized&&(t=Di(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Dl(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Di(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Dl(t,this.array)),t}setW(e,t){return this.normalized&&(t=Di(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Di(t,this.array),i=Di(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=Di(t,this.array),i=Di(i,this.array),n=Di(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=Di(t,this.array),i=Di(i,this.array),n=Di(n,this.array),r=Di(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==V2&&(e.usage=this.usage),e}}class Dce extends ya{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Oce extends ya{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class mk extends ya{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Lce=0;const Ba=new ui,AR=new Zn,_g=new pe,Jo=new Vl,E0=new Vl,Bs=new pe;class Ql extends NM{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Lce++}),this.uuid=Ul(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(yce(e)?Oce:Dce)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new uu().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ba.makeRotationFromQuaternion(e),this.applyMatrix4(Ba),this}rotateX(e){return Ba.makeRotationX(e),this.applyMatrix4(Ba),this}rotateY(e){return Ba.makeRotationY(e),this.applyMatrix4(Ba),this}rotateZ(e){return Ba.makeRotationZ(e),this.applyMatrix4(Ba),this}translate(e,t,i){return Ba.makeTranslation(e,t,i),this.applyMatrix4(Ba),this}scale(e,t,i){return Ba.makeScale(e,t,i),this.applyMatrix4(Ba),this}lookAt(e){return AR.lookAt(e),AR.updateMatrix(),this.applyMatrix4(AR.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_g).negate(),this.translate(_g.x,_g.y,_g.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new mk(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Vl);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new pe(-1/0,-1/0,-1/0),new pe(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){const r=t[i];Jo.setFromBufferAttribute(r),this.morphTargetsRelative?(Bs.addVectors(this.boundingBox.min,Jo.min),this.boundingBox.expandByPoint(Bs),Bs.addVectors(this.boundingBox.max,Jo.max),this.boundingBox.expandByPoint(Bs)):(this.boundingBox.expandByPoint(Jo.min),this.boundingBox.expandByPoint(Jo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ql);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new pe,1/0);return}if(e){const i=this.boundingSphere.center;if(Jo.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];E0.setFromBufferAttribute(a),this.morphTargetsRelative?(Bs.addVectors(Jo.min,E0.min),Jo.expandByPoint(Bs),Bs.addVectors(Jo.max,E0.max),Jo.expandByPoint(Bs)):(Jo.expandByPoint(E0.min),Jo.expandByPoint(E0.max))}Jo.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)Bs.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(Bs));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Bs.fromBufferAttribute(a,c),l&&(_g.fromBufferAttribute(e,c),Bs.add(_g)),n=Math.max(n,i.distanceToSquared(Bs))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,n=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ya(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let T=0;T<i.count;T++)a[T]=new pe,l[T]=new pe;const c=new pe,h=new pe,u=new pe,f=new Bn,p=new Bn,m=new Bn,v=new pe,g=new pe;function y(T,R,w){c.fromBufferAttribute(i,T),h.fromBufferAttribute(i,R),u.fromBufferAttribute(i,w),f.fromBufferAttribute(r,T),p.fromBufferAttribute(r,R),m.fromBufferAttribute(r,w),h.sub(c),u.sub(c),p.sub(f),m.sub(f);const I=1/(p.x*m.y-m.x*p.y);isFinite(I)&&(v.copy(h).multiplyScalar(m.y).addScaledVector(u,-p.y).multiplyScalar(I),g.copy(u).multiplyScalar(p.x).addScaledVector(h,-m.x).multiplyScalar(I),a[T].add(v),a[R].add(v),a[w].add(v),l[T].add(g),l[R].add(g),l[w].add(g))}let A=this.groups;A.length===0&&(A=[{start:0,count:e.count}]);for(let T=0,R=A.length;T<R;++T){const w=A[T],I=w.start,O=w.count;for(let k=I,B=I+O;k<B;k+=3)y(e.getX(k+0),e.getX(k+1),e.getX(k+2))}const _=new pe,b=new pe,x=new pe,E=new pe;function M(T){x.fromBufferAttribute(n,T),E.copy(x);const R=a[T];_.copy(R),_.sub(x.multiplyScalar(x.dot(R))).normalize(),b.crossVectors(E,R);const I=b.dot(l[T])<0?-1:1;o.setXYZW(T,_.x,_.y,_.z,I)}for(let T=0,R=A.length;T<R;++T){const w=A[T],I=w.start,O=w.count;for(let k=I,B=I+O;k<B;k+=3)M(e.getX(k+0)),M(e.getX(k+1)),M(e.getX(k+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new ya(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let f=0,p=i.count;f<p;f++)i.setXYZ(f,0,0,0);const n=new pe,r=new pe,o=new pe,a=new pe,l=new pe,c=new pe,h=new pe,u=new pe;if(e)for(let f=0,p=e.count;f<p;f+=3){const m=e.getX(f+0),v=e.getX(f+1),g=e.getX(f+2);n.fromBufferAttribute(t,m),r.fromBufferAttribute(t,v),o.fromBufferAttribute(t,g),h.subVectors(o,r),u.subVectors(n,r),h.cross(u),a.fromBufferAttribute(i,m),l.fromBufferAttribute(i,v),c.fromBufferAttribute(i,g),a.add(h),l.add(h),c.add(h),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(v,l.x,l.y,l.z),i.setXYZ(g,c.x,c.y,c.z)}else for(let f=0,p=t.count;f<p;f+=3)n.fromBufferAttribute(t,f+0),r.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),h.subVectors(o,r),u.subVectors(n,r),h.cross(u),i.setXYZ(f+0,h.x,h.y,h.z),i.setXYZ(f+1,h.x,h.y,h.z),i.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Bs.fromBufferAttribute(e,t),Bs.normalize(),e.setXYZ(t,Bs.x,Bs.y,Bs.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,u=a.normalized,f=new c.constructor(l.length*h);let p=0,m=0;for(let v=0,g=l.length;v<g;v++){a.isInterleavedBufferAttribute?p=l[v]*a.data.stride+a.offset:p=l[v]*h;for(let y=0;y<h;y++)f[m++]=c[p++]}return new ya(f,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ql,i=this.index.array,n=this.attributes;for(const a in n){const l=n[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,u=c.length;h<u;h++){const f=c[h],p=e(f,i);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,f=c.length;u<f;u++){const p=c[u];h.push(p.toJSON(e.data))}h.length>0&&(n[l]=h,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const n=e.attributes;for(const c in n){const h=n[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],u=r[c];for(let f=0,p=u.length;f<p;f++)h.push(u[f].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ez=new ui,Nf=new zM,eS=new ql,Mz=new pe,bg=new pe,xg=new pe,wg=new pe,_R=new pe,tS=new pe,iS=new Bn,nS=new Bn,sS=new Bn,Tz=new pe,Iz=new pe,Rz=new pe,rS=new pe,oS=new pe;class Rd extends Zn{constructor(e=new Ql,t=new vy){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(n,e);const a=this.morphTargetInfluences;if(r&&a){tS.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],u=r[l];h!==0&&(_R.fromBufferAttribute(u,e),o?tS.addScaledVector(_R,h):tS.addScaledVector(_R.sub(t),h))}t.add(tS)}return t}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),eS.copy(i.boundingSphere),eS.applyMatrix4(r),Nf.copy(e.ray).recast(e.near),!(eS.containsPoint(Nf.origin)===!1&&(Nf.intersectSphere(eS,Mz)===null||Nf.origin.distanceToSquared(Mz)>(e.far-e.near)**2))&&(Ez.copy(r).invert(),Nf.copy(e.ray).applyMatrix4(Ez),!(i.boundingBox!==null&&Nf.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Nf)))}_computeIntersections(e,t,i){let n;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,u=r.attributes.normal,f=r.groups,p=r.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,v=f.length;m<v;m++){const g=f[m],y=o[g.materialIndex],A=Math.max(g.start,p.start),_=Math.min(a.count,Math.min(g.start+g.count,p.start+p.count));for(let b=A,x=_;b<x;b+=3){const E=a.getX(b),M=a.getX(b+1),T=a.getX(b+2);n=aS(this,y,e,i,c,h,u,E,M,T),n&&(n.faceIndex=Math.floor(b/3),n.face.materialIndex=g.materialIndex,t.push(n))}}else{const m=Math.max(0,p.start),v=Math.min(a.count,p.start+p.count);for(let g=m,y=v;g<y;g+=3){const A=a.getX(g),_=a.getX(g+1),b=a.getX(g+2);n=aS(this,o,e,i,c,h,u,A,_,b),n&&(n.faceIndex=Math.floor(g/3),t.push(n))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,v=f.length;m<v;m++){const g=f[m],y=o[g.materialIndex],A=Math.max(g.start,p.start),_=Math.min(l.count,Math.min(g.start+g.count,p.start+p.count));for(let b=A,x=_;b<x;b+=3){const E=b,M=b+1,T=b+2;n=aS(this,y,e,i,c,h,u,E,M,T),n&&(n.faceIndex=Math.floor(b/3),n.face.materialIndex=g.materialIndex,t.push(n))}}else{const m=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let g=m,y=v;g<y;g+=3){const A=g,_=g+1,b=g+2;n=aS(this,o,e,i,c,h,u,A,_,b),n&&(n.faceIndex=Math.floor(g/3),t.push(n))}}}}function kce(s,e,t,i,n,r,o,a){let l;if(e.side===Ole?l=i.intersectTriangle(o,r,n,!0,a):l=i.intersectTriangle(n,r,o,e.side===J1,a),l===null)return null;oS.copy(a),oS.applyMatrix4(s.matrixWorld);const c=t.ray.origin.distanceTo(oS);return c<t.near||c>t.far?null:{distance:c,point:oS.clone(),object:s}}function aS(s,e,t,i,n,r,o,a,l,c){s.getVertexPosition(a,bg),s.getVertexPosition(l,xg),s.getVertexPosition(c,wg);const h=kce(s,e,t,i,bg,xg,wg,rS);if(h){n&&(iS.fromBufferAttribute(n,a),nS.fromBufferAttribute(n,l),sS.fromBufferAttribute(n,c),h.uv=vc.getInterpolation(rS,bg,xg,wg,iS,nS,sS,new Bn)),r&&(iS.fromBufferAttribute(r,a),nS.fromBufferAttribute(r,l),sS.fromBufferAttribute(r,c),h.uv1=vc.getInterpolation(rS,bg,xg,wg,iS,nS,sS,new Bn)),o&&(Tz.fromBufferAttribute(o,a),Iz.fromBufferAttribute(o,l),Rz.fromBufferAttribute(o,c),h.normal=vc.getInterpolation(rS,bg,xg,wg,Tz,Iz,Rz,new pe),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const u={a,b:l,c,normal:new pe,materialIndex:0};vc.getNormal(bg,xg,wg,u.normal),h.face=u}return h}let fW=class extends Zn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ui,this.projectionMatrix=new ui,this.projectionMatrixInverse=new ui,this.coordinateSystem=Cp}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const zu=new pe,Pz=new Bn,Bz=new Bn;class gk extends fW{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=q_*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(KA*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return q_*2*Math.atan(Math.tan(KA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){zu.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(zu.x,zu.y).multiplyScalar(-e/zu.z),zu.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(zu.x,zu.y).multiplyScalar(-e/zu.z)}getViewSize(e,t){return this.getViewBounds(e,Pz,Bz),t.subVectors(Bz,Pz)}setViewOffset(e,t,i,n,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(KA*.5*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*n/l,t-=o.offsetY*i/c,n*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const bR=new pe,Fce=new pe,Uce=new uu;class Sg{constructor(e=new pe(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=bR.subVectors(i,t).cross(Fce.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(bR),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Uce.getNormalMatrix(e),n=this.coplanarPoint(bR).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const zf=new ql,lS=new pe;class Nce{constructor(e=new Sg,t=new Sg,i=new Sg,n=new Sg,r=new Sg,o=new Sg){this.planes=[e,t,i,n,r,o]}set(e,t,i,n,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Cp){const i=this.planes,n=e.elements,r=n[0],o=n[1],a=n[2],l=n[3],c=n[4],h=n[5],u=n[6],f=n[7],p=n[8],m=n[9],v=n[10],g=n[11],y=n[12],A=n[13],_=n[14],b=n[15];if(i[0].setComponents(l-r,f-c,g-p,b-y).normalize(),i[1].setComponents(l+r,f+c,g+p,b+y).normalize(),i[2].setComponents(l+o,f+h,g+m,b+A).normalize(),i[3].setComponents(l-o,f-h,g-m,b-A).normalize(),i[4].setComponents(l-a,f-u,g-v,b-_).normalize(),t===Cp)i[5].setComponents(l+a,f+u,g+v,b+_).normalize();else if(t===Q2)i[5].setComponents(a,u,v,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),zf.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),zf.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(zf)}intersectsSprite(e){return zf.center.set(0,0,0),zf.radius=.7071067811865476,zf.applyMatrix4(e.matrixWorld),this.intersectsSphere(zf)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(lS.x=n.normal.x>0?e.max.x:e.min.x,lS.y=n.normal.y>0?e.max.y:e.min.y,lS.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(lS)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class pW extends fW{constructor(e=-1,t=1,i=1,n=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=n+t,l=n-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class xR extends Zn{constructor(){super(),this.isGroup=!0,this.type="Group"}}class zce{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=V2,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Ul()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return uW("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ul()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ul()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const eo=new pe;class yk{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)eo.fromBufferAttribute(this,t),eo.applyMatrix4(e),this.setXYZ(t,eo.x,eo.y,eo.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)eo.fromBufferAttribute(this,t),eo.applyNormalMatrix(e),this.setXYZ(t,eo.x,eo.y,eo.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)eo.fromBufferAttribute(this,t),eo.transformDirection(e),this.setXYZ(t,eo.x,eo.y,eo.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=Dl(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Di(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=Di(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Di(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Di(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Di(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Dl(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Dl(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Dl(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Dl(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Di(t,this.array),i=Di(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Di(t,this.array),i=Di(i,this.array),n=Di(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Di(t,this.array),i=Di(i,this.array),n=Di(n,this.array),r=Di(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return new ya(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new yk(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[n+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Dz=new pe,Oz=new Ya,Lz=new Ya,Gce=new pe,kz=new ui,cS=new pe,wR=new ql,Fz=new ui,SR=new zM;class Hce extends Rd{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=sz,this.bindMatrix=new ui,this.bindMatrixInverse=new ui,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Vl),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,cS),this.boundingBox.expandByPoint(cS)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new ql),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,cS),this.boundingSphere.expandByPoint(cS)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,n=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),wR.copy(this.boundingSphere),wR.applyMatrix4(n),e.ray.intersectsSphere(wR)!==!1&&(Fz.copy(n).invert(),SR.copy(e.ray).applyMatrix4(Fz),!(this.boundingBox!==null&&SR.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,SR)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ya,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===sz?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Fle?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,n=this.geometry;Oz.fromBufferAttribute(n.attributes.skinIndex,e),Lz.fromBufferAttribute(n.attributes.skinWeight,e),Dz.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=Lz.getComponent(r);if(o!==0){const a=Oz.getComponent(r);kz.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(Gce.copy(Dz).applyMatrix4(kz),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class mW extends Zn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class vk extends Gs{constructor(e=null,t=1,i=1,n,r,o,a,l,c=V_,h=V_,u,f){super(null,o,a,l,c,h,n,r,u,f),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Uz=new ui,Vce=new ui;class Ak{constructor(e=[],t=[]){this.uuid=Ul(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new ui)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new ui;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:Vce;Uz.multiplyMatrices(a,t[r]),Uz.toArray(i,r*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new Ak(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new vk(t,e,e,yd,kp);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new mW),this.bones.push(o),this.boneInverses.push(new ui().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){const o=t[n];e.bones.push(o.uuid);const a=i[n];e.boneInverses.push(a.toArray())}return e}}class j2 extends ya{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Cg=new ui,Nz=new ui,hS=[],zz=new Vl,Qce=new ui,M0=new Rd,T0=new ql;class Wce extends Rd{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new j2(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<i;n++)this.setMatrixAt(n,Qce)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Vl),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Cg),zz.copy(e.boundingBox).applyMatrix4(Cg),this.boundingBox.union(zz)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new ql),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Cg),T0.copy(e.boundingSphere).applyMatrix4(Cg),this.boundingSphere.union(T0)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,n=this.morphTexture.source.data.data,r=i.length+1,o=e*r+1;for(let a=0;a<i.length;a++)i[a]=n[o+a]}raycast(e,t){const i=this.matrixWorld,n=this.count;if(M0.geometry=this.geometry,M0.material=this.material,M0.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),T0.copy(this.boundingSphere),T0.applyMatrix4(i),e.ray.intersectsSphere(T0)!==!1))for(let r=0;r<n;r++){this.getMatrixAt(r,Cg),Nz.multiplyMatrices(i,Cg),M0.matrixWorld=Nz,M0.raycast(e,hS);for(let o=0,a=hS.length;o<a;o++){const l=hS[o];l.instanceId=r,l.object=this,t.push(l)}hS.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new j2(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,n=i.length+1;this.morphTexture===null&&(this.morphTexture=new vk(new Float32Array(n*this.count),n,this.count,yy,kp));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=n*e;r[l]=a,r.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class gW extends Id{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new us(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const $1=new pe,eE=new pe,Gz=new ui,I0=new zM,uS=new ql,CR=new pe,Hz=new pe;class _k extends Zn{constructor(e=new Ql,t=new gW){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let n=1,r=t.count;n<r;n++)$1.fromBufferAttribute(t,n-1),eE.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=$1.distanceTo(eE);e.setAttribute("lineDistance",new mk(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),uS.copy(i.boundingSphere),uS.applyMatrix4(n),uS.radius+=r,e.ray.intersectsSphere(uS)===!1)return;Gz.copy(n).invert(),I0.copy(e.ray).applyMatrix4(Gz);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,h=i.index,f=i.attributes.position;if(h!==null){const p=Math.max(0,o.start),m=Math.min(h.count,o.start+o.count);for(let v=p,g=m-1;v<g;v+=c){const y=h.getX(v),A=h.getX(v+1),_=dS(this,e,I0,l,y,A);_&&t.push(_)}if(this.isLineLoop){const v=h.getX(m-1),g=h.getX(p),y=dS(this,e,I0,l,v,g);y&&t.push(y)}}else{const p=Math.max(0,o.start),m=Math.min(f.count,o.start+o.count);for(let v=p,g=m-1;v<g;v+=c){const y=dS(this,e,I0,l,v,v+1);y&&t.push(y)}if(this.isLineLoop){const v=dS(this,e,I0,l,m-1,p);v&&t.push(v)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function dS(s,e,t,i,n,r){const o=s.geometry.attributes.position;if($1.fromBufferAttribute(o,n),eE.fromBufferAttribute(o,r),t.distanceSqToSegment($1,eE,CR,Hz)>i)return;CR.applyMatrix4(s.matrixWorld);const l=e.ray.origin.distanceTo(CR);if(!(l<e.near||l>e.far))return{distance:l,point:Hz.clone().applyMatrix4(s.matrixWorld),index:n,face:null,faceIndex:null,object:s}}const Vz=new pe,Qz=new pe;class jce extends _k{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let n=0,r=t.count;n<r;n+=2)Vz.fromBufferAttribute(t,n),Qz.fromBufferAttribute(t,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+Vz.distanceTo(Qz);e.setAttribute("lineDistance",new mk(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class qce extends _k{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class yW extends Id{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new us(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Wz=new ui,q2=new zM,fS=new ql,pS=new pe;class Xce extends Zn{constructor(e=new Ql,t=new yW){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),fS.copy(i.boundingSphere),fS.applyMatrix4(n),fS.radius+=r,e.ray.intersectsSphere(fS)===!1)return;Wz.copy(n).invert(),q2.copy(e.ray).applyMatrix4(Wz);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,u=i.attributes.position;if(c!==null){const f=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let m=f,v=p;m<v;m++){const g=c.getX(m);pS.fromBufferAttribute(u,g),jz(pS,g,l,n,e,t,this)}}else{const f=Math.max(0,o.start),p=Math.min(u.count,o.start+o.count);for(let m=f,v=p;m<v;m++)pS.fromBufferAttribute(u,m),jz(pS,m,l,n,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=n.length;r<o;r++){const a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function jz(s,e,t,i,n,r,o){const a=q2.distanceSqToPoint(s);if(a<t){const l=new pe;q2.closestPointToPoint(s,l),l.applyMatrix4(i);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class GM extends Gs{constructor(e,t,i,n,r,o,a,l,c,h,u,f){super(null,o,a,l,c,h,n,r,u,f),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Yce extends GM{constructor(e,t,i,n,r,o){super(e,t,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=Sp,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Kce extends GM{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,Ule),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class HM extends Id{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new us(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new us(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$le,this.normalScale=new Bn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Cv,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class jc extends HM{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Bn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Gr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new us(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new us(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new us(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function mS(s,e,t){return!s||!t&&s.constructor===e?s:typeof e.BYTES_PER_ELEMENT=="number"?new e(s):Array.prototype.slice.call(s)}function Jce(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function Zce(s){function e(n,r){return s[n]-s[r]}const t=s.length,i=new Array(t);for(let n=0;n!==t;++n)i[n]=n;return i.sort(e),i}function qz(s,e,t){const i=s.length,n=new s.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let l=0;l!==e;++l)n[o++]=s[a+l]}return n}function vW(s,e,t,i){let n=1,r=s[0];for(;r!==void 0&&r[i]===void 0;)r=s[n++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=s[n++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=s[n++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=s[n++];while(r!==void 0)}class Vb{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let o;i:{n:if(!(e<n)){for(let a=i+2;;){if(n===void 0){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=n,n=t[++i],e<n)break t}o=t.length;break i}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(n=r,r=t[--i-1],e>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(n=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let o=0;o!==n;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class $ce extends Vb{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:oz,endingEnd:oz}}intervalChanged_(e,t,i){const n=this.parameterPositions;let r=e-2,o=e+1,a=n[r],l=n[o];if(a===void 0)switch(this.getSettings_().endingStart){case az:r=e,a=2*t-i;break;case lz:r=n.length-2,a=t+n[r]-n[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case az:o=e,l=2*i-t;break;case lz:o=1,l=i+n[1]-n[0];break;default:o=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,u=this._offsetNext,f=this._weightPrev,p=this._weightNext,m=(i-t)/(n-t),v=m*m,g=v*m,y=-f*g+2*f*v-f*m,A=(1+f)*g+(-1.5-2*f)*v+(-.5+f)*m+1,_=(-1-p)*g+(1.5+p)*v+.5*m,b=p*g-p*v;for(let x=0;x!==a;++x)r[x]=y*o[h+x]+A*o[c+x]+_*o[l+x]+b*o[u+x];return r}}class ehe extends Vb{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(i-t)/(n-t),u=1-h;for(let f=0;f!==a;++f)r[f]=o[c+f]*u+o[l+f]*h;return r}}class the extends Vb{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class qc{constructor(e,t,i,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=mS(t,this.TimeBufferType),this.values=mS(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:mS(e.times,Array),values:mS(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new the(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new ehe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new $ce(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case W_:t=this.InterpolantFactoryMethodDiscrete;break;case j_:t=this.InterpolantFactoryMethodLinear;break;case nR:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return W_;case this.InterpolantFactoryMethodLinear:return j_;case this.InterpolantFactoryMethodSmooth:return nR}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,o=n-1;for(;r!==n&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==n){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(n!==void 0&&Jce(n))for(let a=0,l=n.length;a!==l;++a){const c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),n=this.getInterpolation()===nR,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(n)l=!0;else{const u=a*i,f=u-i,p=u+i;for(let m=0;m!==i;++m){const v=t[u+m];if(v!==t[f+m]||v!==t[p+m]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const u=a*i,f=o*i;for(let p=0;p!==i;++p)t[f+p]=t[u+p]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,n=new i(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}qc.prototype.TimeBufferType=Float32Array;qc.prototype.ValueBufferType=Float32Array;qc.prototype.DefaultInterpolation=j_;class Ev extends qc{constructor(e,t,i){super(e,t,i)}}Ev.prototype.ValueTypeName="bool";Ev.prototype.ValueBufferType=Array;Ev.prototype.DefaultInterpolation=W_;Ev.prototype.InterpolantFactoryMethodLinear=void 0;Ev.prototype.InterpolantFactoryMethodSmooth=void 0;class AW extends qc{}AW.prototype.ValueTypeName="color";class rv extends qc{}rv.prototype.ValueTypeName="number";class ihe extends Vb{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(n-t);let c=e*a;for(let h=c+a;c!==h;c+=4)sf.slerpFlat(r,0,o,c-a,o,c,l);return r}}class ov extends qc{InterpolantFactoryMethodLinear(e){return new ihe(this.times,this.values,this.getValueSize(),e)}}ov.prototype.ValueTypeName="quaternion";ov.prototype.InterpolantFactoryMethodSmooth=void 0;class Mv extends qc{constructor(e,t,i){super(e,t,i)}}Mv.prototype.ValueTypeName="string";Mv.prototype.ValueBufferType=Array;Mv.prototype.DefaultInterpolation=W_;Mv.prototype.InterpolantFactoryMethodLinear=void 0;Mv.prototype.InterpolantFactoryMethodSmooth=void 0;class av extends qc{}av.prototype.ValueTypeName="vector";class nhe{constructor(e="",t=-1,i=[],n=Jle){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=Ul(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(rhe(i[o]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(qc.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=Zce(l);l=qz(l,1,h),c=qz(c,1,h),!n&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new rv(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const n=e;i=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const u=h[1];let f=n[u];f||(n[u]=f=[]),f.push(c)}}const o=[];for(const a in n)o.push(this.CreateFromMorphTargetSequence(a,n[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(u,f,p,m,v){if(p.length!==0){const g=[],y=[];vW(p,g,y,m),g.length!==0&&v.push(new u(f,g,y))}},n=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let u=0;u<c.length;u++){const f=c[u].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let m;for(m=0;m<f.length;m++)if(f[m].morphTargets)for(let v=0;v<f[m].morphTargets.length;v++)p[f[m].morphTargets[v]]=-1;for(const v in p){const g=[],y=[];for(let A=0;A!==f[m].morphTargets.length;++A){const _=f[m];g.push(_.time),y.push(_.morphTarget===v?1:0)}n.push(new rv(".morphTargetInfluence["+v+"]",g,y))}l=p.length*o}else{const p=".bones["+t[u].name+"]";i(av,p+".position",f,"pos",n),i(ov,p+".quaternion",f,"rot",n),i(av,p+".scale",f,"scl",n)}}return n.length===0?null:new this(r,l,n,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,n=e.length;i!==n;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function she(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return rv;case"vector":case"vector2":case"vector3":case"vector4":return av;case"color":return AW;case"quaternion":return ov;case"bool":case"boolean":return Ev;case"string":return Mv}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function rhe(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=she(s.type);if(s.times===void 0){const t=[],i=[];vW(s.keys,t,i,"value"),s.times=t,s.values=i}return e.parse!==void 0?e.parse(s):new e(s.name,s.times,s.values,s.interpolation)}const vd={enabled:!1,files:{},add:function(s,e){this.enabled!==!1&&(this.files[s]=e)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};class ohe{constructor(e,t,i){const n=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,r===!1&&n.onStart!==void 0&&n.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,n.onProgress!==void 0&&n.onProgress(h,o,a),o===a&&(r=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,f=c.length;u<f;u+=2){const p=c[u],m=c[u+1];if(p.global&&(p.lastIndex=0),p.test(h))return m}return null}}}const ahe=new ohe;class rf{constructor(e){this.manager=e!==void 0?e:ahe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(n,r){i.load(e,n,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}rf.DEFAULT_MATERIAL_NAME="__DEFAULT";const gh={};class lhe extends Error{constructor(e,t){super(e),this.response=t}}class Fp extends rf{constructor(e){super(e)}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=vd.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(gh[e]!==void 0){gh[e].push({onLoad:t,onProgress:i,onError:n});return}gh[e]=[],gh[e].push({onLoad:t,onProgress:i,onError:n});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=gh[e],u=c.body.getReader(),f=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=f?parseInt(f):0,m=p!==0;let v=0;const g=new ReadableStream({start(y){A();function A(){u.read().then(({done:_,value:b})=>{if(_)y.close();else{v+=b.byteLength;const x=new ProgressEvent("progress",{lengthComputable:m,loaded:v,total:p});for(let E=0,M=h.length;E<M;E++){const T=h[E];T.onProgress&&T.onProgress(x)}y.enqueue(b),A()}},_=>{y.error(_)})}}});return new Response(g)}else throw new lhe(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),f=u&&u[1]?u[1].toLowerCase():void 0,p=new TextDecoder(f);return c.arrayBuffer().then(m=>p.decode(m))}}}).then(c=>{vd.add(e,c);const h=gh[e];delete gh[e];for(let u=0,f=h.length;u<f;u++){const p=h[u];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=gh[e];if(h===void 0)throw this.manager.itemError(e),c;delete gh[e];for(let u=0,f=h.length;u<f;u++){const p=h[u];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class che extends rf{constructor(e){super(e)}load(e,t,i,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=vd.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=W2("img");function l(){h(),vd.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(u){h(),n&&n(u),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class _W extends rf{constructor(e){super(e)}load(e,t,i,n){const r=new Gs,o=new che(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,n),r}}let bk=class extends Zn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new us(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}};const ER=new ui,Xz=new pe,Yz=new pe;class xk{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Bn(512,512),this.map=null,this.mapPass=null,this.matrix=new ui,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Nce,this._frameExtents=new Bn(1,1),this._viewportCount=1,this._viewports=[new Ya(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;Xz.setFromMatrixPosition(e.matrixWorld),t.position.copy(Xz),Yz.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Yz),t.updateMatrixWorld(),ER.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ER),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(ER)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class hhe extends xk{constructor(){super(new gk(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=q_*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class uhe extends bk{constructor(e,t,i=0,n=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Zn.DEFAULT_UP),this.updateMatrix(),this.target=new Zn,this.distance=i,this.angle=n,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new hhe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Kz=new ui,R0=new pe,MR=new pe;class dhe extends xk{constructor(){super(new gk(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Bn(4,2),this._viewportCount=6,this._viewports=[new Ya(2,1,1,1),new Ya(0,1,1,1),new Ya(3,1,1,1),new Ya(1,1,1,1),new Ya(3,0,1,1),new Ya(1,0,1,1)],this._cubeDirections=[new pe(1,0,0),new pe(-1,0,0),new pe(0,0,1),new pe(0,0,-1),new pe(0,1,0),new pe(0,-1,0)],this._cubeUps=[new pe(0,1,0),new pe(0,1,0),new pe(0,1,0),new pe(0,1,0),new pe(0,0,1),new pe(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),R0.setFromMatrixPosition(e.matrixWorld),i.position.copy(R0),MR.copy(i.position),MR.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(MR),i.updateMatrixWorld(),n.makeTranslation(-R0.x,-R0.y,-R0.z),Kz.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Kz)}}class fhe extends bk{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new dhe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class phe extends xk{constructor(){super(new pW(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class mhe extends bk{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Zn.DEFAULT_UP),this.updateMatrix(),this.target=new Zn,this.shadow=new phe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class ZA{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class ghe extends rf{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=vd.get(e);if(o!==void 0){if(r.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),r.manager.itemEnd(e)}).catch(c=>{n&&n(c)});return}return setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return vd.add(e,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){n&&n(c),vd.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});vd.add(e,l),r.manager.itemStart(e)}}class yhe{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Jz(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Jz();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Jz(){return(typeof performance>"u"?Date:performance).now()}const wk="\\[\\]\\.:\\/",vhe=new RegExp("["+wk+"]","g"),Sk="[^"+wk+"]",Ahe="[^"+wk.replace("\\.","")+"]",_he=/((?:WC+[\/:])*)/.source.replace("WC",Sk),bhe=/(WCOD+)?/.source.replace("WCOD",Ahe),xhe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Sk),whe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Sk),She=new RegExp("^"+_he+bhe+xhe+whe+"$"),Che=["material","materials","bones","map"];class Ehe{constructor(e,t,i){const n=i||Oi.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class Oi{constructor(e,t,i){this.path=t,this.parsedPath=i||Oi.parseTrackName(t),this.node=Oi.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Oi.Composite(e,t,i):new Oi(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(vhe,"")}static parseTrackName(e){const t=She.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const r=i.nodeName.substring(n+1);Che.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=Oi.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[n];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Oi.Composite=Ehe;Oi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Oi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Oi.prototype.GetterByBindingType=[Oi.prototype._getValue_direct,Oi.prototype._getValue_array,Oi.prototype._getValue_arrayElement,Oi.prototype._getValue_toArray];Oi.prototype.SetterByBindingTypeAndVersioning=[[Oi.prototype._setValue_direct,Oi.prototype._setValue_direct_setNeedsUpdate,Oi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Oi.prototype._setValue_array,Oi.prototype._setValue_array_setNeedsUpdate,Oi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Oi.prototype._setValue_arrayElement,Oi.prototype._setValue_arrayElement_setNeedsUpdate,Oi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Oi.prototype._setValue_fromArray,Oi.prototype._setValue_fromArray_setNeedsUpdate,Oi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:aW}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=aW);function Zz(s,e){if(e===Zle)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(e===G2||e===cW){let t=s.getIndex();if(t===null){const o=[],a=s.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);s.setIndex(o),t=s.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const i=t.count-2,n=[];if(e===G2)for(let o=1;o<=i;o++)n.push(t.getX(0)),n.push(t.getX(o)),n.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(n.push(t.getX(o)),n.push(t.getX(o+1)),n.push(t.getX(o+2))):(n.push(t.getX(o+2)),n.push(t.getX(o+1)),n.push(t.getX(o)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=s.clone();return r.setIndex(n),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),s}let Mhe=class extends rf{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Bhe(t)}),this.register(function(t){return new Dhe(t)}),this.register(function(t){return new Hhe(t)}),this.register(function(t){return new Vhe(t)}),this.register(function(t){return new Qhe(t)}),this.register(function(t){return new Lhe(t)}),this.register(function(t){return new khe(t)}),this.register(function(t){return new Fhe(t)}),this.register(function(t){return new Uhe(t)}),this.register(function(t){return new Phe(t)}),this.register(function(t){return new Nhe(t)}),this.register(function(t){return new Ohe(t)}),this.register(function(t){return new Ghe(t)}),this.register(function(t){return new zhe(t)}),this.register(function(t){return new Ihe(t)}),this.register(function(t){return new Whe(t)}),this.register(function(t){return new jhe(t)})}load(e,t,i,n){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=ZA.extractUrlBase(e);o=ZA.resolveURL(c,this.path)}else o=ZA.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){n?n(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new Fp(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let r;const o={},a={},l=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===bW){try{o[hi.KHR_BINARY_GLTF]=new qhe(e)}catch(u){n&&n(u);return}r=JSON.parse(o[hi.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new oue(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const u=r.extensionsUsed[h],f=r.extensionsRequired||[];switch(u){case hi.KHR_MATERIALS_UNLIT:o[u]=new Rhe;break;case hi.KHR_DRACO_MESH_COMPRESSION:o[u]=new Xhe(r,this.dracoLoader);break;case hi.KHR_TEXTURE_TRANSFORM:o[u]=new Yhe;break;case hi.KHR_MESH_QUANTIZATION:o[u]=new Khe;break;default:f.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,r){i.parse(e,t,n,r)})}};function The(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const hi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let Ihe=class{constructor(e){this.parser=e,this.name=hi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new us(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],zo);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new mhe(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new fhe(h),c.distance=u;break;case"spot":c=new uhe(h),c.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Rh(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),n=Promise.resolve(c),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}},Rhe=class{constructor(){this.name=hi.KHR_MATERIALS_UNLIT}getMaterialType(){return vy}extendParams(e,t,i){const n=[];e.color=new us(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],zo),e.opacity=o[3]}r.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",r.baseColorTexture,zr))}return Promise.all(n)}},Phe=class{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}},Bhe=class{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jc}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Bn(a,a)}return Promise.all(r)}};class Dhe{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jc}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}let Ohe=class{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jc}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},Lhe=class{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jc}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new us(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],zo)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,zr)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},khe=class{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jc}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},Fhe=class{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jc}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new us().setRGB(a[0],a[1],a[2],zo),Promise.all(r)}},Uhe=class{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jc}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},Nhe=class{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jc}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new us().setRGB(a[0],a[1],a[2],zo),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,zr)),Promise.all(r)}},zhe=class{constructor(e){this.parser=e,this.name=hi.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jc}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}},Ghe=class{constructor(e){this.parser=e,this.name=hi.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:jc}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}},Hhe=class{constructor(e){this.parser=e,this.name=hi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}},Vhe=class{constructor(e){this.parser=e,this.name=hi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=n.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},Qhe=class{constructor(e){this.parser=e,this.name=hi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=n.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},Whe=class{constructor(e){this.name=hi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],r=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=n.byteOffset||0,c=n.byteLength||0,h=n.count,u=n.byteStride,f=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,u,f,n.mode,n.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(h*u);return o.decodeGltfBuffer(new Uint8Array(p),h,u,f,n.mode,n.filter),p})})}else return null}},jhe=class{constructor(e){this.name=hi.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const c of n.primitives)if(c.mode!==Va.TRIANGLES&&c.mode!==Va.TRIANGLE_STRIP&&c.mode!==Va.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(l[c]=h,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const h=c.pop(),u=h.isGroup?h.children:[h],f=c[0].count,p=[];for(const m of u){const v=new ui,g=new pe,y=new sf,A=new pe(1,1,1),_=new Wce(m.geometry,m.material,f);for(let b=0;b<f;b++)l.TRANSLATION&&g.fromBufferAttribute(l.TRANSLATION,b),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,b),l.SCALE&&A.fromBufferAttribute(l.SCALE,b),_.setMatrixAt(b,v.compose(g,y,A));for(const b in l)if(b==="_COLOR_0"){const x=l[b];_.instanceColor=new j2(x.array,x.itemSize,x.normalized)}else b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&m.geometry.setAttribute(b,l[b]);Zn.prototype.copy.call(_,m),this.parser.assignFinalMaterial(_),p.push(_)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}};const bW="glTF",P0=12,$z={JSON:1313821514,BIN:5130562};let qhe=class{constructor(e){this.name=hi.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,P0),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==bW)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-P0,r=new DataView(e,P0);let o=0;for(;o<n;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===$z.JSON){const c=new Uint8Array(e,P0+o,a);this.content=i.decode(c)}else if(l===$z.BIN){const c=P0+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},Xhe=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=hi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const u=X2[h]||h.toLowerCase();a[u]=o[h]}for(const h in e.attributes){const u=X2[h]||h.toLowerCase();if(o[h]!==void 0){const f=i.accessors[e.attributes[h]],p=Ly[f.componentType];c[u]=p.name,l[u]=f.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(u,f){n.decodeDracoFile(h,function(p){for(const m in p.attributes){const v=p.attributes[m],g=l[m];g!==void 0&&(v.normalized=g)}u(p)},a,c,zo,f)})})}},Yhe=class{constructor(){this.name=hi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},Khe=class{constructor(){this.name=hi.KHR_MESH_QUANTIZATION}},xW=class extends Vb{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let o=0;o!==n;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=n-t,u=(i-t)/h,f=u*u,p=f*u,m=e*c,v=m-c,g=-2*p+3*f,y=p-f,A=1-g,_=y-f+u;for(let b=0;b!==a;b++){const x=o[v+b+a],E=o[v+b+l]*h,M=o[m+b+a],T=o[m+b]*h;r[b]=A*x+_*E+g*M+y*T}return r}};const Jhe=new sf;let Zhe=class extends xW{interpolate_(e,t,i,n){const r=super.interpolate_(e,t,i,n);return Jhe.fromArray(r).normalize().toArray(r),r}};const Va={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ly={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},e4={9728:V_,9729:Q_,9984:Nle,9985:Gle,9986:zle,9987:UM},t4={33071:Sp,33648:z2,10497:H_},TR={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},X2={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Gu={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},$he={CUBICSPLINE:void 0,LINEAR:j_,STEP:W_},IR={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function eue(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new HM({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:J1})),s.DefaultMaterial}function Gf(s,e,t){for(const i in t.extensions)s[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Rh(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function tue(s,e,t){let i=!1,n=!1,r=!1;for(let c=0,h=e.length;c<h;c++){const u=e[c];if(u.POSITION!==void 0&&(i=!0),u.NORMAL!==void 0&&(n=!0),u.COLOR_0!==void 0&&(r=!0),i&&n&&r)break}if(!i&&!n&&!r)return Promise.resolve(s);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const u=e[c];if(i){const f=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):s.attributes.position;o.push(f)}if(n){const f=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):s.attributes.normal;a.push(f)}if(r){const f=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):s.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],u=c[1],f=c[2];return i&&(s.morphAttributes.position=h),n&&(s.morphAttributes.normal=u),r&&(s.morphAttributes.color=f),s.morphTargetsRelative=!0,s})}function iue(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)s.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function nue(s){let e;const t=s.extensions&&s.extensions[hi.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+RR(t.attributes):e=s.indices+":"+RR(s.attributes)+":"+s.mode,s.targets!==void 0)for(let i=0,n=s.targets.length;i<n;i++)e+=":"+RR(s.targets[i]);return e}function RR(s){let e="";const t=Object.keys(s).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+s[t[i]]+";";return e}function Y2(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function sue(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const rue=new ui;let oue=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new The,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=-1,r=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);n=i&&l?parseInt(l[1],10):-1,r=a.indexOf("Firefox")>-1,o=r?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&n<17||r&&o<98?this.textureLoader=new _W(this.options.manager):this.textureLoader=new ghe(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Fp(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:i,userData:{}};return Gf(r,a,n),Rh(a,n),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const o=t[n].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let n=0,r=e.length;n<r;n++){const o=e[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])};return r(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const r=e(t[n]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":n=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[hi.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(r,o){i.load(ZA.resolveURL(t.uri,n.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const o=TR[n.type],a=Ly[n.componentType],l=n.normalized===!0,c=new a(n.count*o);return Promise.resolve(new ya(c,o,l))}const r=[];return n.bufferView!==void 0?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),n.sparse!==void 0&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=TR[n.type],c=Ly[n.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,f=n.byteOffset||0,p=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let v,g;if(p&&p!==u){const y=Math.floor(f/p),A="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+y+":"+n.count;let _=t.cache.get(A);_||(v=new c(a,y*p,n.count*p/h),_=new zce(v,p/h),t.cache.add(A,_)),g=new yk(_,l,f%p/h,m)}else a===null?v=new c(n.count*l):v=new c(a,f,n.count*l),g=new ya(v,l,m);if(n.sparse!==void 0){const y=TR.SCALAR,A=Ly[n.sparse.indices.componentType],_=n.sparse.indices.byteOffset||0,b=n.sparse.values.byteOffset||0,x=new A(o[1],_,n.sparse.count*y),E=new c(o[2],b,n.sparse.count*l);a!==null&&(g=new ya(g.array.slice(),g.itemSize,g.normalized));for(let M=0,T=x.length;M<T;M++){const R=x[M];if(g.setX(R,E[M*l]),l>=2&&g.setY(R,E[M*l+1]),l>=3&&g.setZ(R,E[M*l+2]),l>=4&&g.setW(R,E[M*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,i){const n=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const f=(r.samplers||{})[o.sampler]||{};return h.magFilter=e4[f.magFilter]||Q_,h.minFilter=e4[f.minFilter]||UM,h.wrapS=t4[f.wrapS]||H_,h.wrapT=t4[f.wrapT]||H_,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,n=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const o=n.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(u){c=!0;const f=new Blob([u],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(f,p){let m=f;t.isImageBitmapLoader===!0&&(m=function(v){const g=new Gs(v);g.needsUpdate=!0,f(g)}),t.load(ZA.resolveURL(u,r.path),m,void 0,p)})}).then(function(u){return c===!0&&a.revokeObjectURL(l),Rh(u,o),u.userData.mimeType=o.mimeType||sue(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[e]=h,h}assignTexture(e,t,i,n){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[hi.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[hi.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[hi.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return n!==void 0&&(o.colorSpace=n),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new yW,Id.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new gW,Id.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(n||r||o){let a="ClonedMaterial:"+i.uuid+":";n&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return HM}loadMaterial(e){const t=this,i=this.json,n=this.extensions,r=i.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[hi.KHR_MATERIALS_UNLIT]){const u=n[hi.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),c.push(u.extendParams(a,r,t))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new us(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;a.color.setRGB(f[0],f[1],f[2],zo),a.opacity=f[3]}u.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",u.baseColorTexture,zr)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Lle);const h=r.alphaMode||IR.OPAQUE;if(h===IR.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===IR.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==vy&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Bn(1,1),r.normalTexture.scale!==void 0)){const u=r.normalTexture.scale;a.normalScale.set(u,u)}if(r.occlusionTexture!==void 0&&o!==vy&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==vy){const u=r.emissiveFactor;a.emissive=new us().setRGB(u[0],u[1],u[2],zo)}return r.emissiveTexture!==void 0&&o!==vy&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,zr)),Promise.all(c).then(function(){const u=new o(a);return r.name&&(u.name=r.name),Rh(u,r),t.associations.set(u,{materials:e}),r.extensions&&Gf(n,u,r),u})}createUniqueName(e){const t=Oi.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function r(a){return i[hi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return i4(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],h=nue(c),u=n[h];if(u)o.push(u.promise);else{let f;c.extensions&&c.extensions[hi.KHR_DRACO_MESH_COMPRESSION]?f=r(c):f=i4(new Ql,c,t),n[h]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,n=this.extensions,r=i.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?eue(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let p=0,m=h.length;p<m;p++){const v=h[p],g=o[p];let y;const A=c[p];if(g.mode===Va.TRIANGLES||g.mode===Va.TRIANGLE_STRIP||g.mode===Va.TRIANGLE_FAN||g.mode===void 0)y=r.isSkinnedMesh===!0?new Hce(v,A):new Rd(v,A),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),g.mode===Va.TRIANGLE_STRIP?y.geometry=Zz(y.geometry,cW):g.mode===Va.TRIANGLE_FAN&&(y.geometry=Zz(y.geometry,G2));else if(g.mode===Va.LINES)y=new jce(v,A);else if(g.mode===Va.LINE_STRIP)y=new _k(v,A);else if(g.mode===Va.LINE_LOOP)y=new qce(v,A);else if(g.mode===Va.POINTS)y=new Xce(v,A);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(y.geometry.morphAttributes).length>0&&iue(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),Rh(y,r),g.extensions&&Gf(n,y,g),t.assignFinalMaterial(y),u.push(y)}for(let p=0,m=u.length;p<m;p++)t.associations.set(u[p],{meshes:e,primitives:p});if(u.length===1)return r.extensions&&Gf(n,u[0],r),u[0];const f=new xR;r.extensions&&Gf(n,f,r),t.associations.set(f,{meshes:e});for(let p=0,m=u.length;p<m;p++)f.add(u[p]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new gk(gce.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new pW(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Rh(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,r=t.joints.length;n<r;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const r=n.pop(),o=n,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const u=o[c];if(u){a.push(u);const f=new ui;r!==null&&f.fromArray(r.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Ak(a,l)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],r=n.name?n.name:"animation_"+e,o=[],a=[],l=[],c=[],h=[];for(let u=0,f=n.channels.length;u<f;u++){const p=n.channels[u],m=n.samplers[p.sampler],v=p.target,g=v.node,y=n.parameters!==void 0?n.parameters[m.input]:m.input,A=n.parameters!==void 0?n.parameters[m.output]:m.output;v.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",A)),c.push(m),h.push(v))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(u){const f=u[0],p=u[1],m=u[2],v=u[3],g=u[4],y=[];for(let A=0,_=f.length;A<_;A++){const b=f[A],x=p[A],E=m[A],M=v[A],T=g[A];if(b===void 0)continue;b.updateMatrix&&b.updateMatrix();const R=i._createAnimationTracks(b,x,E,M,T);if(R)for(let w=0;w<R.length;w++)y.push(R[w])}return new nhe(r,void 0,y)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,n.mesh,r);return n.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=n.weights.length;l<c;l++)a.morphTargetInfluences[l]=n.weights[l]}),o})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],r=i._loadNodeShallow(e),o=[],a=n.children||[];for(let c=0,h=a.length;c<h;c++)o.push(i.getDependency("node",a[c]));const l=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const h=c[0],u=c[1],f=c[2];f!==null&&h.traverse(function(p){p.isSkinnedMesh&&p.bind(f,rue)});for(let p=0,m=u.length;p<m;p++)h.add(u[p]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?n.createUniqueName(r.name):"",a=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(n.getDependency("camera",r.camera).then(function(c){return n._getNodeRef(n.cameraCache,r.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let h;if(r.isBone===!0?h=new mW:c.length>1?h=new xR:c.length===1?h=c[0]:h=new Zn,h!==c[0])for(let u=0,f=c.length;u<f;u++)h.add(c[u]);if(r.name&&(h.userData.name=r.name,h.name=o),Rh(h,r),r.extensions&&Gf(i,h,r),r.matrix!==void 0){const u=new ui;u.fromArray(r.matrix),h.applyMatrix4(u)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,r=new xR;i.name&&(r.name=n.createUniqueName(i.name)),Rh(r,i),i.extensions&&Gf(t,r,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(n.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,u=l.length;h<u;h++)r.add(l[h]);const c=h=>{const u=new Map;for(const[f,p]of n.associations)(f instanceof Id||f instanceof Gs)&&u.set(f,p);return h.traverse(f=>{const p=n.associations.get(f);p!=null&&u.set(f,p)}),u};return n.associations=c(r),r})}_createAnimationTracks(e,t,i,n,r){const o=[],a=e.name?e.name:e.uuid,l=[];Gu[r.path]===Gu.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(a);let c;switch(Gu[r.path]){case Gu.weights:c=rv;break;case Gu.rotation:c=ov;break;case Gu.position:case Gu.scale:c=av;break;default:switch(i.itemSize){case 1:c=rv;break;case 2:case 3:default:c=av;break}break}const h=n.interpolation!==void 0?$he[n.interpolation]:j_,u=this._getArrayFromAccessor(i);for(let f=0,p=l.length;f<p;f++){const m=new c(l[f]+"."+Gu[r.path],t.array,u,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=Y2(t.constructor),n=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)n[r]=t[r]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof ov?Zhe:xW;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function aue(s,e,t){const i=e.attributes,n=new Vl;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(n.set(new pe(l[0],l[1],l[2]),new pe(c[0],c[1],c[2])),a.normalized){const h=Y2(Ly[a.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new pe,l=new pe;for(let c=0,h=r.length;c<h;c++){const u=r[c];if(u.POSITION!==void 0){const f=t.json.accessors[u.POSITION],p=f.min,m=f.max;if(p!==void 0&&m!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),f.normalized){const v=Y2(Ly[f.componentType]);l.multiplyScalar(v)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}s.boundingBox=n;const o=new ql;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,s.boundingSphere=o}function i4(s,e,t){const i=e.attributes,n=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){s.setAttribute(a,l)})}for(const o in i){const a=X2[o]||o.toLowerCase();a in s.attributes||n.push(r(i[o],a))}if(e.indices!==void 0&&!s.index){const o=t.getDependency("accessor",e.indices).then(function(a){s.setIndex(a)});n.push(o)}return $o.workingColorSpace!==zo&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${$o.workingColorSpace}" not supported.`),Rh(s,e),aue(s,e,t),Promise.all(n).then(function(){return e.targets!==void 0?tue(s,e.targets,t):s})}var lue=function(){var s="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",e="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var n=WebAssembly.validate(t)?e:s,r,o=WebAssembly.instantiate(a(n),{}).then(function(y){r=y.instance,r.exports.__wasm_call_ctors()});function a(y){for(var A=new Uint8Array(y.length),_=0;_<y.length;++_){var b=y.charCodeAt(_);A[_]=b>96?b-97:b>64?b-39:b+4}for(var x=0,_=0;_<y.length;++_)A[x++]=A[_]<60?i[A[_]]:(A[_]-60)*64+A[++_];return A.buffer.slice(0,x)}function l(y,A,_,b,x,E){var M=r.exports.sbrk,T=_+3&-4,R=M(T*b),w=M(x.length),I=new Uint8Array(r.exports.memory.buffer);I.set(x,w);var O=y(R,_,b,w,x.length);if(O==0&&E&&E(R,T,b),A.set(I.subarray(R,R+_*b)),M(R-M(0)),O!=0)throw new Error("Malformed buffer data: "+O)}var c={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},u=[],f=0;function p(y){var A={object:new Worker(y),pending:0,requests:{}};return A.object.onmessage=function(_){var b=_.data;A.pending-=b.count,A.requests[b.id][b.action](b.value),delete A.requests[b.id]},A}function m(y){for(var A="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(n))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+l.toString()+g.toString(),_=new Blob([A],{type:"text/javascript"}),b=URL.createObjectURL(_),x=0;x<y;++x)u[x]=p(b);URL.revokeObjectURL(b)}function v(y,A,_,b,x){for(var E=u[0],M=1;M<u.length;++M)u[M].pending<E.pending&&(E=u[M]);return new Promise(function(T,R){var w=new Uint8Array(_),I=f++;E.pending+=y,E.requests[I]={resolve:T,reject:R},E.object.postMessage({id:I,count:y,size:A,source:w,mode:b,filter:x},[w.buffer])})}function g(y){o.then(function(){var A=y.data;try{var _=new Uint8Array(A.count*A.size);l(r.exports[A.mode],_,A.count,A.size,A.source,r.exports[A.filter]),self.postMessage({id:A.id,count:A.count,action:"resolve",value:_},[_.buffer])}catch(b){self.postMessage({id:A.id,count:A.count,action:"reject",value:b})}})}return{ready:o,supported:!0,useWorkers:function(y){m(y)},decodeVertexBuffer:function(y,A,_,b,x){l(r.exports.meshopt_decodeVertexBuffer,y,A,_,b,r.exports[c[x]])},decodeIndexBuffer:function(y,A,_,b){l(r.exports.meshopt_decodeIndexBuffer,y,A,_,b)},decodeIndexSequence:function(y,A,_,b){l(r.exports.meshopt_decodeIndexSequence,y,A,_,b)},decodeGltfBuffer:function(y,A,_,b,x,E){l(r.exports[h[x]],y,A,_,b,r.exports[c[E]])},decodeGltfBufferAsync:function(y,A,_,b,x){return u.length>0?v(y,A,_,h[b],c[x]):o.then(function(){var E=new Uint8Array(y*A);return l(r.exports[h[b]],E,y,A,_,r.exports[c[x]]),E})}}}();const PR=new WeakMap;class cue extends rf{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){const r=new Fp(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.parse(o,t,n)},i,n)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,zr,i).catch(i)}decodeDracoFile(e,t,i,n,r=zo,o=()=>{}){const a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(e,a).then(t).catch(o)}decodeGeometry(e,t){const i=JSON.stringify(t);if(PR.has(e)){const l=PR.get(e);if(l.key===i)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const r=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(r,o).then(l=>(n=l,new Promise((c,h)=>{n._callbacks[r]={resolve:c,reject:h},n.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{n&&r&&this._releaseTask(n,r)}),PR.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new Ql;e.index&&t.setIndex(new ya(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const n=e.attributes[i],r=n.name,o=n.array,a=n.itemSize,l=new ya(o,a);r==="color"&&(this._assignVertexColorSpace(l,n.vertexColorSpace),l.normalized=!(o instanceof Float32Array)),t.setAttribute(r,l)}return t}_assignVertexColorSpace(e,t){if(t!==zr)return;const i=new us;for(let n=0,r=e.count;n<r;n++)i.fromBufferAttribute(e,n).convertSRGBToLinear(),e.setXYZ(n,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new Fp(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((n,r)=>{i.load(e,n,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const n=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const r=hue.toString(),o=["/* draco decoder */",n,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(r){const o=r.data;switch(o.type){case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function hue(){let s,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":s=a.decoderConfig,e=new Promise(function(h){s.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(s)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(h=>{const u=h.draco,f=new u.Decoder;try{const p=t(u,f,new Int8Array(l),c),m=p.attributes.map(v=>v.array.buffer);p.index&&m.push(p.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:p},m)}catch(p){console.error(p),self.postMessage({type:"error",id:a.id,error:p.message})}finally{u.destroy(f)}});break}};function t(o,a,l,c){const h=c.attributeIDs,u=c.attributeTypes;let f,p;const m=a.GetEncodedGeometryType(l);if(m===o.TRIANGULAR_MESH)f=new o.Mesh,p=a.DecodeArrayToMesh(l,l.byteLength,f);else if(m===o.POINT_CLOUD)f=new o.PointCloud,p=a.DecodeArrayToPointCloud(l,l.byteLength,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const v={index:null,attributes:[]};for(const g in h){const y=self[u[g]];let A,_;if(c.useUniqueIDs)_=h[g],A=a.GetAttributeByUniqueId(f,_);else{if(_=a.GetAttributeId(f,o[h[g]]),_===-1)continue;A=a.GetAttribute(f,_)}const b=n(o,a,f,g,y,A);g==="color"&&(b.vertexColorSpace=c.vertexColorSpace),v.attributes.push(b)}return m===o.TRIANGULAR_MESH&&(v.index=i(o,a,f)),o.destroy(f),v}function i(o,a,l){const h=l.num_faces()*3,u=h*4,f=o._malloc(u);a.GetTrianglesUInt32Array(l,u,f);const p=new Uint32Array(o.HEAPF32.buffer,f,h).slice();return o._free(f),{array:p,itemSize:1}}function n(o,a,l,c,h,u){const f=u.num_components(),m=l.num_points()*f,v=m*h.BYTES_PER_ELEMENT,g=r(o,h),y=o._malloc(v);a.GetAttributeDataArrayForAllPoints(l,u,g,v,y);const A=new h(o.HEAPF32.buffer,y,m).slice();return o._free(y),{name:c,array:A,itemSize:f}}function r(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class uue{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:n,msg:r,transfer:o}=this.queue.shift();this.workersResolve[e]=n,this.workers[e].postMessage(r,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const n=this._getIdleWorker();n!==-1?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=i,this.workers[n].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const due=0,n4=2,fue=1,s4=2,pue=0,mue=1,gue=10,yue=0,wW=9,SW=15,CW=16,EW=22,MW=37,TW=43,IW=76,RW=83,PW=97,BW=100,DW=103,OW=109,LW=165,kW=166;class vue{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class B0{constructor(e,t,i,n){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const i=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,n)}}const to=[171,75,84,88,32,50,48,187,13,10,26,10];function r4(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}function Aue(s){const e=new Uint8Array(s.buffer,s.byteOffset,to.length);if(e[0]!==to[0]||e[1]!==to[1]||e[2]!==to[2]||e[3]!==to[3]||e[4]!==to[4]||e[5]!==to[5]||e[6]!==to[6]||e[7]!==to[7]||e[8]!==to[8]||e[9]!==to[9]||e[10]!==to[10]||e[11]!==to[11])throw new Error("Missing KTX 2.0 identifier.");const t=new vue,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new B0(s,to.length,i,!0);t.vkFormat=n._nextUint32(),t.typeSize=n._nextUint32(),t.pixelWidth=n._nextUint32(),t.pixelHeight=n._nextUint32(),t.pixelDepth=n._nextUint32(),t.layerCount=n._nextUint32(),t.faceCount=n._nextUint32();const r=n._nextUint32();t.supercompressionScheme=n._nextUint32();const o=n._nextUint32(),a=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),h=n._nextUint64(),u=n._nextUint64(),f=new B0(s,to.length+i,3*r*8,!0);for(let U=0;U<r;U++)t.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+f._nextUint64(),f._nextUint64()),uncompressedByteLength:f._nextUint64()});const p=new B0(s,o,a,!0),m={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},v=(m.descriptorBlockSize/4-6)/4;for(let U=0;U<v;U++){const z={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&z.channelType?(z.sampleLower=p._nextInt32(),z.sampleUpper=p._nextInt32()):(z.sampleLower=p._nextUint32(),z.sampleUpper=p._nextUint32()),m.samples[U]=z}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(m);const g=new B0(s,l,c,!0);for(;g._offset<c;){const U=g._nextUint32(),z=g._scan(U),j=r4(z),X=g._scan(U-z.byteLength);t.keyValue[j]=j.match(/^ktx/i)?r4(X):X,g._offset%4&&g._skip(4-g._offset%4)}if(u<=0)return t;const y=new B0(s,h,u,!0),A=y._nextUint16(),_=y._nextUint16(),b=y._nextUint32(),x=y._nextUint32(),E=y._nextUint32(),M=y._nextUint32(),T=[];for(let U=0;U<r;U++)T.push({imageFlags:y._nextUint32(),rgbSliceByteOffset:y._nextUint32(),rgbSliceByteLength:y._nextUint32(),alphaSliceByteOffset:y._nextUint32(),alphaSliceByteLength:y._nextUint32()});const R=h+y._offset,w=R+b,I=w+x,O=I+E,k=new Uint8Array(s.buffer,s.byteOffset+R,b),B=new Uint8Array(s.buffer,s.byteOffset+w,x),G=new Uint8Array(s.buffer,s.byteOffset+I,E),L=new Uint8Array(s.buffer,s.byteOffset+O,M);return t.globalData={endpointCount:A,selectorCount:_,imageDescs:T,endpointsData:k,selectorsData:B,tablesData:G,extendedData:L},t}let BR,wh,K2;const DR={env:{emscripten_notify_memory_growth:function(s){K2=new Uint8Array(wh.exports.memory.buffer)}}};class _ue{init(){return BR||(BR=typeof fetch<"u"?fetch("data:application/wasm;base64,"+o4).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,DR)).then(this._init):WebAssembly.instantiate(Buffer.from(o4,"base64"),DR).then(this._init),BR)}_init(e){wh=e.instance,DR.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!wh)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,n=wh.exports.malloc(i);K2.set(e,n),t=t||Number(wh.exports.ZSTD_findDecompressedSize(n,i));const r=wh.exports.malloc(t),o=wh.exports.ZSTD_decompress(r,t,n,i),a=K2.slice(r,r+o);return wh.exports.free(n),wh.exports.free(r),a}}const o4="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",OR=new WeakMap;let LR=0,kR;class Mc extends rf{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new uue,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new Fp(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new Fp(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const n=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then(([r,o])=>{const a=Mc.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(Mc.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Mc.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Mc.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),c})}),LR>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),LR++}return this.transcoderPending}load(e,t,i,n){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new Fp(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,o=>{if(OR.has(o))return OR.get(o).promise.then(t).catch(n);this._createTexture(o).then(a=>t?t(a):null).catch(n)},i,n)}_createTextureFrom(e,t){const{faces:i,width:n,height:r,format:o,type:a,error:l,dfdFlags:c}=e;if(a==="error")return Promise.reject(l);let h;if(t.faceCount===6)h=new Kce(i,o,qa);else{const u=i[0].mipmaps;h=t.layerCount>1?new Yce(u,n,r,t.layerCount,o,qa):new GM(u,n,r,o,qa)}return h.minFilter=i[0].mipmaps.length===1?Q_:UM,h.magFilter=Q_,h.generateMipmaps=!1,h.needsUpdate=!0,h.colorSpace=FW(t),h.premultiplyAlpha=!!(c&fue),h}async _createTexture(e,t={}){const i=Aue(new Uint8Array(e));if(i.vkFormat!==yue)return xue(i);const n=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:n},[e])).then(o=>this._createTextureFrom(o.data,i));return OR.set(e,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),LR--,this}}Mc.BasisFormat={ETC1S:0,UASTC_4x4:1};Mc.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Mc.EngineFormat={RGBAFormat:yd,RGBA_ASTC_4x4_Format:Yle,RGBA_BPTC_Format:Kle,RGBA_ETC2_EAC_Format:Xle,RGBA_PVRTC_4BPPV1_Format:Wle,RGBA_S3TC_DXT5_Format:Vle,RGB_ETC1_Format:jle,RGB_ETC2_Format:qle,RGB_PVRTC_4BPPV1_Format:Qle,RGBA_S3TC_DXT1_Format:Hle};Mc.BasisWorker=function(){let s,e,t;const i=_EngineFormat,n=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(m){const v=m.data;switch(v.type){case"init":s=v.config,o(v.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:g,buffers:y,width:A,height:_,hasAlpha:b,format:x,dfdFlags:E}=a(v.buffer);self.postMessage({type:"transcode",id:v.id,faces:g,width:A,height:_,hasAlpha:b,format:x,dfdFlags:E},y)}catch(g){console.error(g),self.postMessage({type:"error",id:v.id,error:g.message})}});break}});function o(m){e=new Promise(v=>{t={wasmBinary:m,onRuntimeInitialized:v},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(m){const v=new t.KTX2File(new Uint8Array(m));function g(){v.close(),v.delete()}if(!v.isValid())throw g(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const y=v.isUASTC()?r.UASTC_4x4:r.ETC1S,A=v.getWidth(),_=v.getHeight(),b=v.getLayers()||1,x=v.getLevels(),E=v.getFaces(),M=v.getHasAlpha(),T=v.getDFDFlags(),{transcoderFormat:R,engineFormat:w}=u(y,A,_,M);if(!A||!_||!x)throw g(),new Error("THREE.KTX2Loader:	Invalid texture");if(!v.startTranscoding())throw g(),new Error("THREE.KTX2Loader: .startTranscoding failed");const I=[],O=[];for(let k=0;k<E;k++){const B=[];for(let G=0;G<x;G++){const L=[];let U,z;for(let X=0;X<b;X++){const re=v.getImageLevelInfo(G,X,k);k===0&&G===0&&X===0&&(re.origWidth%4!==0||re.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),x>1?(U=re.origWidth,z=re.origHeight):(U=re.width,z=re.height);const ce=new Uint8Array(v.getImageTranscodedSizeInBytes(G,X,0,R));if(!v.transcodeImage(ce,G,X,k,R,0,-1,-1))throw g(),new Error("THREE.KTX2Loader: .transcodeImage failed.");L.push(ce)}const j=p(L);B.push({data:j,width:U,height:z}),O.push(j.buffer)}I.push({mipmaps:B,width:A,height:_,format:w})}return g(),{faces:I,buffers:O,width:A,height:_,hasAlpha:M,format:w,dfdFlags:T}}const l=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGBA_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],c=l.sort(function(m,v){return m.priorityETC1S-v.priorityETC1S}),h=l.sort(function(m,v){return m.priorityUASTC-v.priorityUASTC});function u(m,v,g,y){let A,_;const b=m===r.ETC1S?c:h;for(let x=0;x<b.length;x++){const E=b[x];if(s[E.if]&&E.basisFormat.includes(m)&&!(y&&E.transcoderFormat.length<2)&&!(E.needsPowerOfTwo&&!(f(v)&&f(g))))return A=E.transcoderFormat[y?1:0],_=E.engineFormat[y?1:0],{transcoderFormat:A,engineFormat:_}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),A=n.RGBA32,_=i.RGBAFormat,{transcoderFormat:A,engineFormat:_}}function f(m){return m<=2?!0:(m&m-1)===0&&m!==0}function p(m){if(m.length===1)return m[0];let v=0;for(let A=0;A<m.length;A++){const _=m[A];v+=_.byteLength}const g=new Uint8Array(v);let y=0;for(let A=0;A<m.length;A++){const _=m[A];g.set(_,y),y+=_.byteLength}return g}};const bue=new Set([yd,yA,yy]),FR={[OW]:yd,[PW]:yd,[MW]:yd,[TW]:yd,[DW]:yA,[RW]:yA,[CW]:yA,[EW]:yA,[BW]:yy,[IW]:yy,[SW]:yy,[wW]:yy,[kW]:rz,[LW]:rz},UR={[OW]:kp,[PW]:e1,[MW]:qa,[TW]:qa,[DW]:kp,[RW]:e1,[CW]:qa,[EW]:qa,[BW]:kp,[IW]:e1,[SW]:qa,[wW]:qa,[kW]:qa,[LW]:qa};async function xue(s){const{vkFormat:e}=s;if(FR[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;s.supercompressionScheme===n4&&(kR||(kR=new Promise(async r=>{const o=new _ue;await o.init(),r(o)})),t=await kR);const i=[];for(let r=0;r<s.levels.length;r++){const o=Math.max(1,s.pixelWidth>>r),a=Math.max(1,s.pixelHeight>>r),l=s.pixelDepth?Math.max(1,s.pixelDepth>>r):0,c=s.levels[r];let h;if(s.supercompressionScheme===due)h=c.levelData;else if(s.supercompressionScheme===n4)h=t.decode(c.levelData,c.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let u;UR[e]===kp?u=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):UR[e]===e1?u=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):u=h,i.push({data:u,width:o,height:a,depth:l})}let n;if(bue.has(FR[e]))n=s.pixelDepth===0?new vk(i[0].data,s.pixelWidth,s.pixelHeight):new wce(i[0].data,s.pixelWidth,s.pixelHeight,s.pixelDepth);else{if(s.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");n=new GM(i,s.pixelWidth,s.pixelHeight)}return n.mipmaps=i,n.type=UR[e],n.format=FR[e],n.colorSpace=FW(s),n.needsUpdate=!0,Promise.resolve(n)}function FW(s){const e=s.dataFormatDescriptor[0];return e.colorPrimaries===mue?e.transferFunction===s4?zr:zo:e.colorPrimaries===gue?e.transferFunction===s4?hW:fk:(e.colorPrimaries===pue||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),Z1)}let tE="https://www.gstatic.com/draco/versioned/decoders/1.4.1/",Ck="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";fetch(tE+"draco_decoder.js",{method:"head"}).catch(s=>{tE="./include/draco/",Ck="./include/ktx2/"});function wue(s){tE=s}function Sue(s){Ck=s}let ey,t1,ty;function UW(s){return ey||(ey=new cue,ey.setDecoderPath(tE),ey.setDecoderConfig({type:"js"})),ty||(ty=new Mc,ty.setTranscoderPath(Ck)),t1||(t1=lue),s?ty.detectSupport(s):s!==null&&console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures might fail"),{dracoLoader:ey,ktx2Loader:ty,meshoptDecoder:t1}}function Cue(s){s.dracoLoader||s.setDRACOLoader(ey),s.ktx2Loader||s.setKTX2Loader(ty),s.meshoptDecoder||s.setMeshoptDecoder(t1)}Qb("debugprogressive");function Qb(s){const t=new URL(window.location.href).searchParams.get(s);return t==null||t==="0"||t==="false"?!1:t===""?!0:t}function Eue(s,e){if(e===void 0||e.startsWith("./")||e.startsWith("http")||s===void 0)return e;const t=s.lastIndexOf("/");if(t>=0){const i=s.substring(0,t+1);for(;i.endsWith("/")&&e.startsWith("/");)e=e.substring(1);return i+e}return e}let D0;function Mue(){return D0!==void 0||(D0=/iPhone|iPad|iPod|Android|IEMobile/i.test(navigator.userAgent),Qb("debugprogressive")&&console.log("[glTF Progressive]: isMobileDevice",D0)),D0}const J2=Symbol("needle:raycast-mesh");function Wb(s){return(s==null?void 0:s[J2])instanceof Ql?s[J2]:null}function Tue(s,e){if((s.type==="Mesh"||s.type==="SkinnedMesh")&&!Wb(s)){const i=Iue(e);i.userData={isRaycastMesh:!0},s[J2]=i}}function Iue(s){const e=new Ql;for(const t in s.attributes)e.setAttribute(t,s.getAttribute(t));return e.setIndex(s.getIndex()),e}const rd=new Array,kh="NEEDLE_progressive",rn=Qb("debugprogressive"),Z2=Symbol("needle-progressive-texture"),$A=new Map,$2=new Set;if(rn){let s=function(){e+=1,console.log("Toggle LOD level",e,$A),$A.forEach((n,r)=>{for(const o of n.keys){const a=r[o];if(a!=null){if(a.isBufferGeometry===!0){const l=yi.getMeshLODInformation(a),c=l?Math.min(e,l.lods.length):0;r["DEBUG:LOD"]=e,yi.assignMeshLOD(r,c),l&&(t=Math.max(t,l.lods.length-1))}else if(r.isMaterial===!0){r["DEBUG:LOD"]=e,yi.assignTextureLOD(r,e);break}}}}),e>=t&&(e=-1)},e=-1,t=2,i=!1;window.addEventListener("keyup",n=>{n.key==="p"&&s(),n.key==="w"&&(i=!i,$2&&$2.forEach(r=>{r.name!="BackgroundCubeMaterial"&&r.glyphMap==null&&"wireframe"in r&&(r.wireframe=i)}))})}function a4(s,e,t){var n;if(!rn)return;$A.has(s)||$A.set(s,{keys:[],sourceId:t});const i=$A.get(s);((n=i==null?void 0:i.keys)==null?void 0:n.includes(e))==!1&&i.keys.push(e)}const zs=class{constructor(s,e){this.loadMesh=t=>{var n,r;if(this._isLoadingMesh)return null;const i=(r=(n=this.parser.json.meshes[t])==null?void 0:n.extensions)==null?void 0:r[kh];return i?(this._isLoadingMesh=!0,this.parser.getDependency("mesh",t).then(o=>{var a;return this._isLoadingMesh=!1,o&&zs.registerMesh(this.url,i.guid,o,(a=i.lods)==null?void 0:a.length,void 0,i),o})):null},rn&&console.log("Progressive extension registered for",e),this.parser=s,this.url=e}get name(){return kh}static getMeshLODInformation(s){const e=this.getAssignedLODInformation(s);return e!=null&&e.key?this.lodInfos.get(e.key):null}static getMaterialMinMaxLODsCount(s,e){const t=this,i="LODS:minmax",n=s[i];if(n!=null)return n;if(e||(e={min_count:1/0,max_count:0,lods:[]}),Array.isArray(s)){for(const o of s)this.getMaterialMinMaxLODsCount(o,e);return s[i]=e,e}if(rn==="verbose"&&console.log("getMaterialMinMaxLODsCount",s),s.type==="ShaderMaterial"||s.type==="RawShaderMaterial"){const o=s;for(const a of Object.keys(o.uniforms)){const l=o.uniforms[a].value;(l==null?void 0:l.isTexture)===!0&&r(l,e)}}else if(s.isMaterial)for(const o of Object.keys(s)){const a=s[o];(a==null?void 0:a.isTexture)===!0&&r(a,e)}return s[i]=e,e;function r(o,a){const l=t.getAssignedLODInformation(o);if(l){const c=t.lodInfos.get(l.key);if(c&&c.lods){a.min_count=Math.min(a.min_count,c.lods.length),a.max_count=Math.max(a.max_count,c.lods.length);for(let h=0;h<c.lods.length;h++){const u=c.lods[h];u.width&&(a.lods[h]=a.lods[h]||{min_height:1/0,max_height:0},a.lods[h].min_height=Math.min(a.lods[h].min_height,u.height),a.lods[h].max_height=Math.max(a.lods[h].max_height,u.height))}}}}}static hasLODLevelAvailable(s,e){var n;if(Array.isArray(s)){for(const r of s)if(this.hasLODLevelAvailable(r,e))return!0;return!1}if(s.isMaterial===!0){for(const r of Object.keys(s)){const o=s[r];if(o&&o.isTexture&&this.hasLODLevelAvailable(o,e))return!0}return!1}else if(s.isGroup===!0){for(const r of s.children)if(r.isMesh===!0&&this.hasLODLevelAvailable(r,e))return!0}let t,i;if(s.isMesh?t=s.geometry:(s.isBufferGeometry||s.isTexture)&&(t=s),t&&(n=t==null?void 0:t.userData)!=null&&n.LODS){const r=t.userData.LODS;if(i=this.lodInfos.get(r.key),e===void 0)return i!=null;if(i)return Array.isArray(i.lods)?e<i.lods.length:e===0}return!1}static assignMeshLOD(s,e){var t;if(!s)return Promise.resolve(null);if(s instanceof Rd||s.isMesh===!0){const i=s.geometry,n=this.getAssignedLODInformation(i);if(!n)return Promise.resolve(null);for(const r of rd)(t=r.onBeforeGetLODMesh)==null||t.call(r,s,e);return s["LOD:requested level"]=e,zs.getOrLoadLOD(i,e).then(r=>{if(s["LOD:requested level"]===e){if(delete s["LOD:requested level"],Array.isArray(r)){const o=n.index||0;r=r[o]}r&&i!=r&&((r==null?void 0:r.isBufferGeometry)?(s.geometry=r,rn&&a4(s,"geometry",n.url)):rn&&console.error("Invalid LOD geometry",r))}return r}).catch(r=>(console.error("Error loading mesh LOD",s,r),null))}else rn&&console.error("Invalid call to assignMeshLOD: Request mesh LOD but the object is not a mesh",s);return Promise.resolve(null)}static assignTextureLOD(s,e=0){if(!s)return Promise.resolve(null);if(s instanceof Id||s.isMaterial===!0){const t=s,i=[],n=new Array;if(rn&&$2.add(t),t.uniforms&&t.isRawShaderMaterial||t.isShaderMaterial===!0){const r=t;for(const o of Object.keys(r.uniforms)){const a=r.uniforms[o].value;if((a==null?void 0:a.isTexture)===!0){const l=this.assignTextureLODForSlot(a,e,t,o);i.push(l),n.push(o)}}}else for(const r of Object.keys(t)){const o=t[r];if((o==null?void 0:o.isTexture)===!0){const a=this.assignTextureLODForSlot(o,e,t,r);i.push(a),n.push(r)}}return Promise.all(i).then(r=>{const o=new Array;for(let a=0;a<r.length;a++){const l=r[a],c=n[a];l&&l.isTexture===!0?o.push({material:t,slot:c,texture:l,level:e}):o.push({material:t,slot:c,texture:null,level:e})}return o})}if(s instanceof Gs||s.isTexture===!0){const t=s;return this.assignTextureLODForSlot(t,e,null,null)}return Promise.resolve(null)}static assignTextureLODForSlot(s,e,t,i){return(s==null?void 0:s.isTexture)!==!0?Promise.resolve(null):i==="glyphMap"?Promise.resolve(s):zs.getOrLoadLOD(s,e).then(n=>{if(Array.isArray(n))return null;if((n==null?void 0:n.isTexture)===!0){if(n!=s){if(t&&i){const r=t[i];if(r){const o=this.getAssignedLODInformation(r);if(o&&(o==null?void 0:o.level)<e)return rn==="verbose"&&console.warn("Assigned texture level is already higher: ",o.level,e,t,r,n),null}t[i]=n}if(rn&&i&&t){const r=this.getAssignedLODInformation(s);r&&a4(t,i,r.url)}}return n}else rn=="verbose"&&console.warn("No LOD found for",s,e);return null}).catch(n=>(console.error("Error loading LOD",s,n),null))}afterRoot(s){var e,t;return rn&&console.log("AFTER",this.url,s),(e=this.parser.json.textures)==null||e.forEach((i,n)=>{var r;if(i!=null&&i.extensions){const o=i==null?void 0:i.extensions[kh];if(o){if(!o.lods){rn&&console.warn("Texture has no LODs",o);return}let a=!1;for(const l of this.parser.associations.keys())if(l.isTexture===!0){const c=this.parser.associations.get(l);(c==null?void 0:c.textures)===n&&(a=!0,zs.registerTexture(this.url,l,(r=o.lods)==null?void 0:r.length,n,o))}a||this.parser.getDependency("texture",n).then(l=>{var c;l&&zs.registerTexture(this.url,l,(c=o.lods)==null?void 0:c.length,n,o)})}}}),(t=this.parser.json.meshes)==null||t.forEach((i,n)=>{if(i!=null&&i.extensions){const r=i==null?void 0:i.extensions[kh];if(r&&r.lods){for(const o of this.parser.associations.keys())if(o.isMesh){const a=this.parser.associations.get(o);(a==null?void 0:a.meshes)===n&&zs.registerMesh(this.url,r.guid,o,r.lods.length,a.primitives,r)}}}}),null}static async getOrLoadLOD(s,e){var o,a,l,c;const t=rn=="verbose",i=s.userData.LODS;if(!i)return null;const n=i==null?void 0:i.key;let r;if(s.isTexture===!0){const h=s;h.source&&h.source[Z2]&&(r=h.source[Z2])}if(r||(r=zs.lodInfos.get(n)),r){if(e>0){let f=!1;const p=Array.isArray(r.lods);if(p&&e>=r.lods.length?f=!0:p||(f=!0),f)return this.lowresCache.get(n)}const h=Array.isArray(r.lods)?(o=r.lods[e])==null?void 0:o.path:r.lods;if(!h)return rn&&!r["missing:uri"]&&(r["missing:uri"]=!0,console.warn("Missing uri for progressive asset for LOD "+e,r)),null;const u=Eue(i.url,h);if(u.endsWith(".glb")||u.endsWith(".gltf")){if(!r.guid)return console.warn("missing pointer for glb/gltf texture",r),null;const f=u+"_"+r.guid,p=this.previouslyLoaded.get(f);if(p!==void 0){t&&console.log(`LOD ${e} was already loading/loaded: ${f}`);let y=await p.catch(_=>(console.error(`Error loading LOD ${e} from ${u}
`,_),null)),A=!1;if(y==null||(y instanceof Gs&&s instanceof Gs?(a=y.image)!=null&&a.data||(l=y.source)!=null&&l.data?y=this.copySettings(s,y):(A=!0,this.previouslyLoaded.delete(f)):y instanceof Ql&&s instanceof Ql&&((c=y.attributes.position)!=null&&c.array||(A=!0,this.previouslyLoaded.delete(f)))),!A)return y}const m=r,v=new Promise(async(y,A)=>{const _=new Mhe;Cue(_),rn&&(await new Promise(T=>setTimeout(T,1e3)),t&&console.warn("Start loading (delayed) "+u,m.guid));let b=u;if(m&&Array.isArray(m.lods)){const T=m.lods[e];T.hash&&(b+="?v="+T.hash)}const x=await _.loadAsync(b).catch(T=>(console.error(`Error loading LOD ${e} from ${u}
`,T),null));if(!x)return null;const E=x.parser;t&&console.log("Loading finished "+u,m.guid);let M=0;if(x.parser.json.textures){let T=!1;for(const R of x.parser.json.textures){if(R!=null&&R.extensions){const w=R==null?void 0:R.extensions[kh];if(w!=null&&w.guid&&w.guid===m.guid){T=!0;break}}M++}if(T){let R=await E.getDependency("texture",M);return R&&zs.assignLODInformation(i.url,R,n,e,void 0,void 0),t&&console.log('change "'+s.name+'"  "'+R.name+'"',u,M,R,f),s instanceof Gs&&(R=this.copySettings(s,R)),R&&(R.guid=m.guid),y(R)}else rn&&console.warn("Could not find texture with guid",m.guid,x.parser.json)}if(M=0,x.parser.json.meshes){let T=!1;for(const R of x.parser.json.meshes){if(R!=null&&R.extensions){const w=R==null?void 0:R.extensions[kh];if(w!=null&&w.guid&&w.guid===m.guid){T=!0;break}}M++}if(T){const R=await E.getDependency("mesh",M),w=m;if(t&&console.log(`Loaded Mesh "${R.name}"`,u,M,R,f),R.isMesh===!0){const I=R.geometry;return zs.assignLODInformation(i.url,I,n,e,void 0,w.density),y(I)}else{const I=new Array;for(let O=0;O<R.children.length;O++){const k=R.children[O];if(k.isMesh===!0){const B=k.geometry;zs.assignLODInformation(i.url,B,n,e,O,w.density),I.push(B)}}return y(I)}}else rn&&console.warn("Could not find mesh with guid",m.guid,x.parser.json)}return y(null)});return this.previouslyLoaded.set(f,v),await v}else if(s instanceof Gs){t&&console.log("Load texture from uri: "+u);const p=await new _W().loadAsync(u);return p?(p.guid=r.guid,p.flipY=!1,p.needsUpdate=!0,p.colorSpace=s.colorSpace,t&&console.log(r,p)):rn&&console.warn("failed loading",u),p}}else rn&&console.warn(`Can not load LOD ${e}: no LOD info found for "${n}" ${s.name}`,s.type);return null}static assignLODInformation(s,e,t,i,n,r){if(!e)return;e.userData||(e.userData={});const o=new Rue(s,t,i,n,r);e.userData.LODS=o}static getAssignedLODInformation(s){var e;return((e=s==null?void 0:s.userData)==null?void 0:e.LODS)||null}static copySettings(s,e){return e=e.clone(),rn&&console.warn(`Copying texture settings
`,s.uuid,`
`,e.uuid),e.offset=s.offset,e.repeat=s.repeat,e.colorSpace=s.colorSpace,e.magFilter=s.magFilter,e.minFilter=s.minFilter,e.wrapS=s.wrapS,e.wrapT=s.wrapT,e.flipY=s.flipY,e.anisotropy=s.anisotropy,e.mipmaps||(e.generateMipmaps=s.generateMipmaps),e}};let yi=zs;yi.registerTexture=(s,e,t,i,n)=>{if(rn&&console.log("> Progressive: register texture",i,e.name,e.uuid,e,n),!e){rn&&console.error("gltf-progressive: Register texture without texture");return}e.source&&(e.source[Z2]=n);const r=n.guid;zs.assignLODInformation(s,e,r,t,i,void 0),zs.lodInfos.set(r,n),zs.lowresCache.set(r,e)};yi.registerMesh=(s,e,t,i,n,r)=>{var l;rn&&console.log("> Progressive: register mesh",n,t.name,r,t.uuid,t);const o=t.geometry;if(!o){rn&&console.warn("gltf-progressive: Register mesh without geometry");return}o.userData||(o.userData={}),zs.assignLODInformation(s,o,e,i,n,r.density),zs.lodInfos.set(e,r);let a=zs.lowresCache.get(e);a?a.push(t.geometry):a=[t.geometry],zs.lowresCache.set(e,a),i>0&&!Wb(t)&&Tue(t,o);for(const c of rd)(l=c.onRegisteredNewMesh)==null||l.call(c,t,r)};yi.lodInfos=new Map;yi.previouslyLoaded=new Map;yi.lowresCache=new Map;class Rue{constructor(e,t,i,n,r){this.url=e,this.key=t,this.level=i,n!=null&&(this.index=n),r!=null&&(this.density=r)}}var NW=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)},sn=(s,e,t)=>(NW(s,e,"read from private field"),t?t.call(s):e.get(s)),Hf=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},yh=(s,e,t,i)=>(NW(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),Eo,ed,eD,iy,vA,i1,td;const xl=Qb("debugprogressive"),Pue=Qb("noprogressive"),NR=Symbol("Needle:LODSManager"),zR=Symbol("Needle:LODState"),Eg=Symbol("Needle:CurrentLOD"),wl={mesh_lod:-1,texture_lod:-1},Ua=class{constructor(s,e){this.projectionScreenMatrix=new ui,this.targetTriangleDensity=2e5,this.updateInterval="auto",Hf(this,Eo,1),this.pause=!1,this.manual=!1,this._lodchangedlisteners=[],Hf(this,ed,void 0),Hf(this,eD,new yhe),Hf(this,iy,0),Hf(this,vA,0),Hf(this,i1,0),Hf(this,td,0),this._fpsBuffer=[60,60,60,60,60],this._sphere=new ql,this._tempBox=new Vl,this._tempBox2=new Vl,this.tempMatrix=new ui,this._tempWorldPosition=new pe,this._tempBoxSize=new pe,this._tempBox2Size=new pe,this.renderer=s,this.context={...e}}static getObjectLODState(s){return s[zR]}static addPlugin(s){rd.push(s)}static removePlugin(s){const e=rd.indexOf(s);e>=0&&rd.splice(e,1)}static get(s,e){if(s[NR])return console.debug("[gltf-progressive] LODsManager already exists for this renderer"),s[NR];const t=new Ua(s,{engine:"unknown",...e});return s[NR]=t,t}get plugins(){return rd}addEventListener(s,e){s==="changed"&&this._lodchangedlisteners.push(e)}removeEventListener(s,e){if(s==="changed"){const t=this._lodchangedlisteners.indexOf(e);t>=0&&this._lodchangedlisteners.splice(t,1)}}enable(){if(sn(this,ed))return;console.debug("[gltf-progressive] Enabling LODsManager for renderer");let s=0;yh(this,ed,this.renderer.render);const e=this;UW(this.renderer),this.renderer.render=function(t,i){const n=e.renderer.getRenderTarget();(n==null||"isXRRenderTarget"in n&&n.isXRRenderTarget)&&(s=0,yh(e,iy,sn(e,iy)+1),yh(e,vA,sn(e,eD).getDelta()),yh(e,i1,sn(e,i1)+sn(e,vA)),e._fpsBuffer.shift(),e._fpsBuffer.push(1/sn(e,vA)),yh(e,td,e._fpsBuffer.reduce((o,a)=>o+a)/e._fpsBuffer.length),xl&&sn(e,iy)%200===0&&console.log("FPS",Math.round(sn(e,td)),"Interval:",sn(e,Eo)));const r=s++;sn(e,ed).call(this,t,i),e.onAfterRender(t,i,r)}}disable(){sn(this,ed)&&(this.renderer.render=sn(this,ed),yh(this,ed,void 0))}update(s,e){this.internalUpdate(s,e)}onAfterRender(s,e,t){if(this.pause)return;const n=this.renderer.renderLists.get(s,0).opaque;let r=!0;if(n.length===1){const o=n[0].material;(o.name==="EffectMaterial"||o.name==="CopyShader")&&(r=!1)}if((e.parent&&e.parent.type==="CubeCamera"||t>=1&&e.type==="OrthographicCamera")&&(r=!1),r){if(Pue||(this.updateInterval==="auto"?sn(this,td)<40&&sn(this,Eo)<10?(yh(this,Eo,sn(this,Eo)+1),xl&&console.warn(" Reducing LOD updates",sn(this,Eo),sn(this,td).toFixed(0))):sn(this,td)>=60&&sn(this,Eo)>1&&(yh(this,Eo,sn(this,Eo)-1),xl&&console.warn(" Increasing LOD updates",sn(this,Eo),sn(this,td).toFixed(0))):yh(this,Eo,this.updateInterval),sn(this,Eo)>0&&sn(this,iy)%sn(this,Eo)!=0))return;this.internalUpdate(s,e)}}internalUpdate(s,e){var a,l;const t=this.renderer.renderLists.get(s,0),i=t.opaque;this.projectionScreenMatrix.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);const n=this.targetTriangleDensity;for(const c of i){if(c.material&&(((a=c.geometry)==null?void 0:a.type)==="BoxGeometry"||((l=c.geometry)==null?void 0:l.type)==="BufferGeometry")&&(c.material.name==="SphericalGaussianBlur"||c.material.name=="BackgroundCubeMaterial"||c.material.name==="CubemapFromEquirect"||c.material.name==="EquirectangularToCubeUV")){xl&&(c.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]||(c.material["NEEDLE_PROGRESSIVE:IGNORE-WARNING"]=!0,console.warn("Ignoring skybox or BLIT object",c,c.material.name,c.material.type)));continue}switch(c.material.type){case"LineBasicMaterial":case"LineDashedMaterial":case"PointsMaterial":case"ShadowMaterial":case"MeshDistanceMaterial":case"MeshDepthMaterial":continue}if(xl==="color"&&c.material&&!c.object.progressive_debug_color){c.object.progressive_debug_color=!0;const u=Math.random()*16777215,f=new HM({color:u});c.object.material=f}const h=c.object;(h instanceof Rd||h.isMesh)&&this.updateLODs(s,e,h,n)}const r=t.transparent;for(const c of r){const h=c.object;(h instanceof Rd||h.isMesh)&&this.updateLODs(s,e,h,n)}const o=t.transmissive;for(const c of o){const h=c.object;(h instanceof Rd||h.isMesh)&&this.updateLODs(s,e,h,n)}}updateLODs(s,e,t,i){var o,a;t.userData||(t.userData={});let n=t[zR];if(n||(n=new Bue,t[zR]=n),n.frames++<2)return;for(const l of rd)(o=l.onBeforeUpdateLOD)==null||o.call(l,this.renderer,s,e,t);this.calculateLodLevel(e,t,n,i,wl),wl.mesh_lod=Math.round(wl.mesh_lod),wl.texture_lod=Math.round(wl.texture_lod),wl.mesh_lod>=0&&this.loadProgressiveMeshes(t,wl.mesh_lod);let r=wl.texture_lod;if(t.material&&r>=0){const l=t["DEBUG:LOD"];l!=null&&(r=l),this.loadProgressiveTextures(t.material,r)}for(const l of rd)(a=l.onAfterUpdatedLOD)==null||a.call(l,this.renderer,s,e,t,wl);n.lastLodLevel_Mesh=wl.mesh_lod,n.lastLodLevel_Texture=wl.texture_lod}loadProgressiveTextures(s,e){if(!s)return;if(Array.isArray(s)){for(const i of s)this.loadProgressiveTextures(i,e);return}let t=!1;(s[Eg]===void 0||e<s[Eg])&&(t=!0),t&&(s[Eg]=e,yi.assignTextureLOD(s,e).then(i=>{this._lodchangedlisteners.forEach(n=>n({type:"texture",level:e,object:s}))}))}loadProgressiveMeshes(s,e){if(!s)return Promise.resolve(null);if(s[Eg]!==e){s[Eg]=e;const t=s.geometry;return yi.assignMeshLOD(s,e).then(i=>(i&&s[Eg]==e&&t!=s.geometry&&this._lodchangedlisteners.forEach(n=>n({type:"mesh",level:e,object:s})),i))}return Promise.resolve(null)}static isInside(s,e){const t=s.min,i=s.max,n=(t.x+i.x)*.5,r=(t.y+i.y)*.5;return this._tempPtInside.set(n,r,t.z).applyMatrix4(e).z<0}calculateLodLevel(s,e,t,i,n){var v;if(!e){n.mesh_lod=-1,n.texture_lod=-1;return}if(!s){n.mesh_lod=-1,n.texture_lod=-1;return}let o=10+1,a=!1;if(xl&&e["DEBUG:LOD"]!=null)return e["DEBUG:LOD"];const l=yi.getMeshLODInformation(e.geometry),c=l==null?void 0:l.lods,h=c&&c.length>0,u=yi.getMaterialMinMaxLODsCount(e.material),f=(u==null?void 0:u.min_count)!=1/0&&u.min_count>0&&u.max_count>0;if(!h&&!f){n.mesh_lod=0,n.texture_lod=0;return}h||(a=!0,o=0);const p=this.renderer.domElement.clientHeight||this.renderer.domElement.height;let m=e.geometry.boundingBox;if(e.type==="SkinnedMesh"){const g=e;if(!g.boundingBox)g.computeBoundingBox();else if(t.frames%30===0){const y=Wb(g),A=g.geometry;y&&(g.geometry=y),g.computeBoundingBox(),g.geometry=A}m=g.boundingBox}if(m&&s.isPerspectiveCamera){const g=s;if(e.geometry.attributes.color&&e.geometry.attributes.color.count<100&&e.geometry.boundingSphere){this._sphere.copy(e.geometry.boundingSphere),this._sphere.applyMatrix4(e.matrixWorld);const R=s.getWorldPosition(this._tempWorldPosition);if(this._sphere.containsPoint(R)){n.mesh_lod=0,n.texture_lod=0;return}}if(this._tempBox.copy(m),this._tempBox.applyMatrix4(e.matrixWorld),Ua.isInside(this._tempBox,this.projectionScreenMatrix)){n.mesh_lod=0,n.texture_lod=0;return}if(this._tempBox.applyMatrix4(this.projectionScreenMatrix),this.renderer.xr.enabled&&g.fov>70){const R=this._tempBox.min,w=this._tempBox.max;let I=R.x,O=R.y,k=w.x,B=w.y;const G=2,L=1.5,U=(R.x+w.x)*.5,z=(R.y+w.y)*.5;I=(I-U)*G+U,O=(O-z)*G+z,k=(k-U)*G+U,B=(B-z)*G+z;const j=I<0&&k>0?0:Math.min(Math.abs(R.x),Math.abs(w.x)),X=O<0&&B>0?0:Math.min(Math.abs(R.y),Math.abs(w.y)),re=Math.max(j,X);t.lastCentrality=(L-re)*(L-re)*(L-re)}else t.lastCentrality=1;const y=this._tempBox.getSize(this._tempBoxSize);y.multiplyScalar(.5),screen.availHeight>0&&p>0&&y.multiplyScalar(p/screen.availHeight),y.x*=g.aspect;const A=s.matrixWorldInverse,_=this._tempBox2;_.copy(m),_.applyMatrix4(e.matrixWorld),_.applyMatrix4(A);const b=_.getSize(this._tempBox2Size),x=Math.max(b.x,b.y);if(Math.max(y.x,y.y)!=0&&x!=0&&(y.z=b.z/Math.max(b.x,b.y)*Math.max(y.x,y.y)),t.lastScreenCoverage=Math.max(y.x,y.y,y.z),t.lastScreenspaceVolume.copy(y),t.lastScreenCoverage*=t.lastCentrality,xl&&Ua.debugDrawLine){const R=this.tempMatrix.copy(this.projectionScreenMatrix);R.invert();const w=Ua.corner0,I=Ua.corner1,O=Ua.corner2,k=Ua.corner3;w.copy(this._tempBox.min),I.copy(this._tempBox.max),I.x=w.x,O.copy(this._tempBox.max),O.y=w.y,k.copy(this._tempBox.max);const B=(w.z+k.z)*.5;w.z=I.z=O.z=k.z=B,w.applyMatrix4(R),I.applyMatrix4(R),O.applyMatrix4(R),k.applyMatrix4(R),Ua.debugDrawLine(w,I,255),Ua.debugDrawLine(w,O,255),Ua.debugDrawLine(I,k,255),Ua.debugDrawLine(O,k,255)}let M=999;if(c&&t.lastScreenCoverage>0){for(let R=0;R<c.length;R++)if(c[R].density/t.lastScreenCoverage<i){M=R;break}}M<o&&(o=M,a=!0)}if(a?n.mesh_lod=o:n.mesh_lod=t.lastLodLevel_Mesh,xl&&n.mesh_lod!=t.lastLodLevel_Mesh){const y=c==null?void 0:c[n.mesh_lod];y&&console.log(`Mesh LOD changed: ${t.lastLodLevel_Mesh}  ${n.mesh_lod} (${y.density.toFixed(0)}) - ${e.name}`)}if(f){const g="saveData"in globalThis.navigator&&globalThis.navigator.saveData===!0;if(t.lastLodLevel_Texture<0){if(n.texture_lod=u.max_count-1,xl){const y=u.lods[u.max_count-1];xl&&console.log(`First Texture LOD ${n.texture_lod} (${y.max_height}px) - ${e.name}`)}}else{const y=t.lastScreenspaceVolume.x+t.lastScreenspaceVolume.y+t.lastScreenspaceVolume.z;let A=t.lastScreenCoverage*2;((v=this.context)==null?void 0:v.engine)==="model-viewer"&&(A*=2);const b=p/window.devicePixelRatio*A;for(let x=u.lods.length-1;x>=0;x--){let E=u.lods[x];if(!(g&&E.max_height>=2048)&&!(Mue()&&E.max_height>4096)&&E.max_height>b){if(n.texture_lod=x,n.texture_lod<t.lastLodLevel_Texture){const M=E.max_height;xl&&console.log(`Texture LOD changed: ${t.lastLodLevel_Texture}  ${n.texture_lod} = ${M}px 
Screensize: ${b.toFixed(0)}px, Coverage: ${(100*t.lastScreenCoverage).toFixed(2)}%, Volume ${y.toFixed(1)} 
${e.name}`)}break}}}}else n.texture_lod=0}};let Ja=Ua;Eo=new WeakMap;ed=new WeakMap;eD=new WeakMap;iy=new WeakMap;vA=new WeakMap;i1=new WeakMap;td=new WeakMap;Ja.corner0=new pe;Ja.corner1=new pe;Ja.corner2=new pe;Ja.corner3=new pe;Ja._tempPtInside=new pe;class Bue{constructor(){this.frames=0,this.lastLodLevel_Mesh=-1,this.lastLodLevel_Texture=-1,this.lastScreenCoverage=0,this.lastScreenspaceVolume=new pe,this.lastCentrality=0}}const l4=Symbol("NEEDLE_mesh_lod"),gS=Symbol("NEEDLE_texture_lod");let O0=null;function zW(){const s=Due();s&&(s.mapURLs(function(e){return c4(),e}),c4(),O0==null||O0.disconnect(),O0=new MutationObserver(e=>{e.forEach(t=>{t.addedNodes.forEach(i=>{i instanceof HTMLElement&&i.tagName.toLowerCase()==="model-viewer"&&GW(i)})})}),O0.observe(document,{childList:!0,subtree:!0}))}function Due(){if(typeof customElements>"u")return null;const s=customElements.get("model-viewer");return s||(customElements.whenDefined("model-viewer").then(()=>{console.debug("[gltf-progressive] model-viewer defined"),zW()}),null)}function c4(){if(typeof document>"u")return;document.querySelectorAll("model-viewer").forEach(e=>{GW(e)})}const h4=new WeakSet;let Oue=0;function GW(s){if(!s||h4.has(s))return null;h4.add(s),console.debug("[gltf-progressive] found new model-viewer..."+ ++Oue+`
`,s.getAttribute("src"));let e=null,t=null,i=null;for(let n=s;n!=null;n=Object.getPrototypeOf(n)){const r=Object.getOwnPropertySymbols(n),o=r.find(c=>c.toString()=="Symbol(renderer)"),a=r.find(c=>c.toString()=="Symbol(scene)"),l=r.find(c=>c.toString()=="Symbol(needsRender)");!e&&o!=null&&(e=s[o].threeRenderer),!t&&a!=null&&(t=s[a]),!i&&l!=null&&(i=s[l])}if(e&&t){let n=function(){if(i){let o=0,a=setInterval(()=>{if(o++>5){clearInterval(a);return}i==null||i.call(s)},300)}};console.debug("[gltf-progressive] setup model-viewer");const r=Ja.get(e,{engine:"model-viewer"});return Ja.addPlugin(new Lue),r.enable(),r.addEventListener("changed",()=>{i==null||i.call(s)}),s.addEventListener("model-visibility",o=>{o.detail.visible&&(i==null||i.call(s))}),s.addEventListener("load",()=>{n()}),()=>{r.disable()}}return null}class Lue{constructor(){this._didWarnAboutMissingUrl=!1}onBeforeUpdateLOD(e,t,i,n){this.tryParseMeshLOD(t,n),this.tryParseTextureLOD(t,n)}getUrl(e){if(!e)return null;let t=e.getAttribute("src");return t||(t=e.src),t||(this._didWarnAboutMissingUrl||console.warn("No url found in modelviewer",e),this._didWarnAboutMissingUrl=!0),t}tryGetCurrentGLTF(e){return e._currentGLTF}tryGetCurrentModelViewer(e){return e.element}tryParseTextureLOD(e,t){if(t[gS]==!0)return;t[gS]=!0;const i=this.tryGetCurrentGLTF(e),n=this.tryGetCurrentModelViewer(e),r=this.getUrl(n);if(r&&i&&t.material){let o=function(l){var h,u,f;if(l[gS]==!0)return;l[gS]=!0,l.userData&&(l.userData.LOD=-1);const c=Object.keys(l);for(let p=0;p<c.length;p++){const m=c[p],v=l[m];if((v==null?void 0:v.isTexture)===!0){const g=(u=(h=v.userData)==null?void 0:h.associations)==null?void 0:u.textures;if(g==null)continue;const y=i.parser.json.textures[g];if(!y){console.warn("Texture data not found for texture index "+g);continue}if((f=y==null?void 0:y.extensions)!=null&&f[kh]){const A=y.extensions[kh];A&&r&&yi.registerTexture(r,v,A.lods.length,g,A)}}}};const a=t.material;if(Array.isArray(a))for(const l of a)o(l);else o(a)}}tryParseMeshLOD(e,t){var o,a;if(t[l4]==!0)return;t[l4]=!0;const i=this.tryGetCurrentModelViewer(e),n=this.getUrl(i);if(!n)return;const r=(a=(o=t.userData)==null?void 0:o.gltfExtensions)==null?void 0:a[kh];if(r&&n){const l=t.uuid;yi.registerMesh(n,l,t,0,r.lods.length,r)}}}zW();const lv=[];function VM(s){lv.indexOf(s)===-1&&lv.push(s)}function kue(s){const e=lv.indexOf(s);e!==-1&&lv.splice(e,1)}const cv=[];function Ek(s){cv.indexOf(s)===-1&&cv.push(s)}function Fue(s){const e=cv.indexOf(s);e!==-1&&cv.splice(e,1)}function HW(s){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-start",{detail:s}));for(let e=0;e<lv.length;e++)lv[e](s)}function VW(s){globalThis.dispatchEvent(new CustomEvent("needle-xrsession-end",{detail:s}));for(let e=0;e<cv.length;e++)cv[e](s)}const Ns={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function QW(s){const e=await fetch(s);if(e.ok)return e.json();throw new Error(e.statusText)}async function Uue(s){if(!s)throw new Error("No basePath supplied");return await QW(`${s}/profilesList.json`)}async function Nue(s,e,t=null,i=!0){if(!s)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const n=await Uue(e);let r;if(s.profiles.some(l=>{const c=n[l];return c&&(r={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const l=n[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await QW(r.profilePath);let a;if(i){let l;if(s.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[s.handedness],!l)throw new Error(`No matching handedness, ${s.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const zue={xAxis:0,yAxis:0,button:0,state:Ns.ComponentState.DEFAULT};function Gue(s=0,e=0){let t=s,i=e;if(Math.sqrt(s*s+e*e)>1){const o=Math.atan2(e,s);t=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}let Hue=class{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Ns.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(zue)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:n}){const{normalizedXAxis:r,normalizedYAxis:o}=Gue(e,t);switch(this.componentProperty){case Ns.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?r:.5;break;case Ns.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?o:.5;break;case Ns.ComponentProperty.BUTTON:this.value=this.states.includes(n)?i:0;break;case Ns.ComponentProperty.STATE:this.valueNodeProperty===Ns.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}},Vue=class{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const n=new Hue(t.visualResponses[i]);this.visualResponses[i]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Ns.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Ns.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Ns.ComponentState.PRESSED:(t.touched||this.values.button>Ns.ButtonTouchThreshold)&&(this.values.state=Ns.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Ns.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Ns.AxisTouchThreshold&&(this.values.state=Ns.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Ns.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Ns.AxisTouchThreshold&&(this.values.state=Ns.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}},Que=class{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(n=>{const r=this.layoutDescription.components[n];this.components[n]=new Vue(n,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}};const vs=ie("debuginput");var QM=(s=>(s.Mouse="mouse",s.Touch="touch",s.Controller="controller",s.Hand="hand",s))(QM||{}),vn=(s=>(s.PointerDown="pointerdown",s.PointerUp="pointerup",s.PointerMove="pointermove",s.KeyDown="keydown",s.KeyUp="keyup",s.KeyPressed="keypress",s))(vn||{});class Ph extends PointerEvent{constructor(t,i,n){super(t,n);d(this,"clientZ");d(this,"deviceIndex");d(this,"origin");d(this,"source");d(this,"mode");d(this,"_ray");d(this,"space");d(this,"isClick",!1);d(this,"isDoubleClick",!1);d(this,"_used",!1);d(this,"_pointerid");d(this,"_pointerType");d(this,"_type");d(this,"metadata",{});d(this,"intersections",new Array);d(this,"_immediatePropagationStopped",!1);d(this,"_propagationStopped",!1);this.clientZ=n.clientZ,this._pointerid=n.pointerId,this._pointerType=n.pointerType,this._type=t,this.deviceIndex=n.deviceIndex,this.origin=n.origin,this.source=i,this.mode=n.mode,this._ray=n.ray,this.space=n.device}get isSpatial(){return this.mode!="screen"}get ray(){return this._ray||(this._ray=new _o(this.space.worldPosition.clone(),this.space.worldForward.clone())),this._ray}set ray(t){this._ray=t}get hasRay(){return this._ray!==void 0}get used(){return this._used}use(){this._used=!0}get pointerId(){return this._pointerid}get pointerType(){return this._pointerType}get type(){return this._type}get immediatePropagationStopped(){return this._immediatePropagationStopped}get propagationStopped(){return this._immediatePropagationStopped||this._propagationStopped}stopImmediatePropagation(){var t;this._immediatePropagationStopped=!0,super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}stopPropagation(){var t;this._propagationStopped=!0,super.stopPropagation(),(t=this.source)==null||t.stopPropagation(),vs&&console.warn("Stop propagation...",this.pointerId,this.pointerType)}}class AA extends KeyboardEvent{constructor(t,i,n){super(t,n);d(this,"source");this.source=i}stopImmediatePropagation(){var t;super.stopImmediatePropagation(),(t=this.source)==null||t.stopImmediatePropagation()}}class Wue{constructor(e){d(this,"key");d(this,"keyType");d(this,"source");this.key=e.key,this.keyType=e.type,this.source=e}}var Ka=(s=>(s[s.Early=-100]="Early",s[s.Default=0]="Default",s[s.Late=100]="Late",s))(Ka||{});class WW{constructor(e){d(this,"_eventListeners",{});d(this,"_doubleClickTimeThreshold",.2);d(this,"_longPressTimeThreshold",1);d(this,"_specialCursorTrigger",0);d(this,"context");d(this,"_pointerDown",[!1]);d(this,"_pointerUp",[!1]);d(this,"_pointerClick",[!1]);d(this,"_pointerDoubleClick",[!1]);d(this,"_pointerPressed",[!1]);d(this,"_pointerPositions",[new ee]);d(this,"_pointerPositionsLastFrame",[new ee]);d(this,"_pointerPositionsDelta",[new ee]);d(this,"_pointerPositionsRC",[new ee]);d(this,"_pointerPositionDown",[new S]);d(this,"_pointerDownTime",[]);d(this,"_pointerUpTime",[]);d(this,"_pointerUpTimestamp",[]);d(this,"_pointerIds",[]);d(this,"_pointerTypes",[""]);d(this,"_mouseWheelChanged",[!1]);d(this,"_mouseWheelDeltaY",[0]);d(this,"_pointerEvent",[]);d(this,"_pointerEventsPressed",[]);d(this,"_pointerSpace",[]);d(this,"_pressedStack",new Map);d(this,"_htmlEventSource");d(this,"onLostFocus",()=>{for(const e in this.keysPressed)this.keysPressed[e].pressed=!1});d(this,"onEndOfFrame",()=>{for(let e=0;e<this._pointerUp.length;e++)this._pointerUp[e]=!1;for(let e=0;e<this._pointerDown.length;e++)this._pointerDown[e]=!1;for(let e=0;e<this._pointerClick.length;e++)this._pointerClick[e]=!1;for(let e=0;e<this._pointerDoubleClick.length;e++)this._pointerDoubleClick[e]=!1;for(const e of this._pointerPositionsDelta)e.set(0,0);for(let e=0;e<this._mouseWheelChanged.length;e++)this._mouseWheelChanged[e]=!1;for(let e=0;e<this._mouseWheelDeltaY.length;e++)this._mouseWheelDeltaY[e]=0});d(this,"onContextMenu",e=>{this.canReceiveInput(e)!==!1&&e instanceof PointerEvent&&e.pointerType});d(this,"keysPressed",{});d(this,"onKeyDown",e=>{if(vs&&console.log(`key down ${e.code}, ${this.context.application.hasFocus}`,e),!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(t&&t.pressed)return;this.keysPressed[e.code]={pressed:!0,frame:this.context.time.frameCount+1,startFrame:this.context.time.frameCount+1,key:e.key,code:e.code};const i=new AA("keydown",e,e);this.onDispatchEvent(i)});d(this,"onKeyPressed",e=>{if(!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(!t)return;t.pressed=!0,t.frame=this.context.time.frameCount+1;const i=new AA("keypress",e,e);this.onDispatchEvent(i)});d(this,"onKeyUp",e=>{if(!this.context.application.hasFocus)return;const t=this.keysPressed[e.code];if(!t)return;t.pressed=!1,t.frame=this.context.time.frameCount+1;const i=new AA("keyup",e,e);this.onDispatchEvent(i)});d(this,"onWheelWindow",e=>{document.pointerLockElement&&this.onMouseWheel(e)});d(this,"onMouseWheel",e=>{if(this.canReceiveInput(e)===!1)return;this._mouseWheelDeltaY.length<=0&&this._mouseWheelDeltaY.push(0),this._mouseWheelChanged.length<=0&&this._mouseWheelChanged.push(!1),this._mouseWheelChanged[0]=!0;const t=this._mouseWheelDeltaY[0];this._mouseWheelDeltaY[0]=t+e.deltaY});d(this,"onPointerDown",e=>{if(this.context.isInAR||this.canReceiveInput(e)===!1)return;e.target instanceof HTMLElement&&e.target.setPointerCapture(e.pointerId);const t=this.getPointerId(e);vs&&_n(`pointer down #${t}, identifier:${e.pointerId}`);const i=this.getAndUpdateSpatialObjectForScreenPosition(t,e.clientX,e.clientY),n=new Ph("pointerdown",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:t,button:e.button,clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,buttonName:this.getButtonName(e),device:i,pressure:e.pressure});this.onDown(n)});d(this,"onPointerMove",e=>{if(this.context.isInAR)return;let t=e.button;e.pointerType==="mouse"&&(t=this.getFirstPressedButtonForPointer(0)??0);const i=this.getPointerId(e,t);t===-1&&(t=i);const n=this.getAndUpdateSpatialObjectForScreenPosition(i,e.clientX,e.clientY),r=new Ph("pointermove",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:i,button:t,clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,buttonName:this.getButtonName(e),device:n,pressure:e.pressure});this.onMove(r)});d(this,"onPointerCancel",e=>{this.context.isInAR||(vs&&console.log("Pointer cancel",e),this.onPointerUp(e))});d(this,"onPointerUp",e=>{if(this.context.isInAR)return;e.target instanceof HTMLElement&&e.target.releasePointerCapture(e.pointerId);const t=this.getPointerId(e),i=new Ph("pointerup",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:t,button:e.button,clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,buttonName:this.getButtonName(e),device:this.getAndUpdateSpatialObjectForScreenPosition(t,e.clientX,e.clientY),pressure:e.pressure});this.onUp(i),this._pointerIds[t]=-1,vs&&console.log("ID="+t,"PointerId="+e.pointerId,"ALL:",[...this._pointerIds])});d(this,"onTouchStart",e=>{if(this.context.isInAR)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(n,i.clientX,i.clientY),o=new Ph("pointerdown",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:n,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:r,pressure:i.force});this.onDown(o)}});d(this,"onTouchMove",e=>{if(this.context.isInAR)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=this.getPointerIndex(i.identifier),r=this.getAndUpdateSpatialObjectForScreenPosition(n,i.clientX,i.clientY),o=new Ph("pointermove",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:n,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:r,pressure:i.force});this.onMove(o)}});d(this,"onTouchEnd",e=>{if(this.context.isInAR)for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=this.getPointerIndex(i.identifier),r=new Ph("pointerup",e,{origin:this,mode:"screen",deviceIndex:0,pointerId:n,button:0,clientX:i.clientX,clientY:i.clientY,pointerType:"touch",buttonName:"unknown",device:this.getAndUpdateSpatialObjectForScreenPosition(n,i.clientX,i.clientY),pressure:i.force});this.onUp(r),this._pointerIds[n]=-1}});d(this,"tempNearPlaneVector",new S);d(this,"tempFarPlaneVector",new S);d(this,"tempLookMatrix",new le);this.context=e,this.context.post_render_callbacks.push(this.onEndOfFrame)}addEventListener(e,t,i){if(this._eventListeners[e]||(this._eventListeners[e]=[]),!t||typeof t!="function"){console.error("Invalid call to addEventListener: callback is required and must be a function!");return}i?i={...i}:i={};let n=0;(i==null?void 0:i.queue)!=null&&(n=i.queue);const r=this._eventListeners[e],o=r.find(a=>a.priority===n);o?o.listeners.push({callback:t,options:i}):(r.push({priority:n,listeners:[{callback:t,options:i}]}),r.sort((a,l)=>a.priority-l.priority))}removeEventListener(e,t,i){if(!this._eventListeners[e]||!t)return;const n=this._eventListeners[e];if((i==null?void 0:i.queue)!=null){const r=n.find(a=>a.priority===i.queue);if(!r)return;const o=r.listeners.findIndex(a=>a.callback===t);o>=0&&r.listeners.splice(o,1)}else for(const r of n){const o=r.listeners.findIndex(a=>a.callback===t);o>=0&&r.listeners.splice(o,1)}}dispatchEvent(e){var i,n,r,o;let t=!1;if(e instanceof AA){const a=this._eventListeners[e.type];if(a)for(const l of a)for(let c=0;c<l.listeners.length;c++){const h=l.listeners[c];if((n=(i=h.options)==null?void 0:i.signal)!=null&&n.aborted){l.listeners.splice(c,1),c--;continue}h.options.once&&(l.listeners.splice(c,1),c--),h.callback(e)}}if(e instanceof Ph){const a=this._eventListeners[e.type];if(a)for(const l of a){if(t)break;for(let c=0;c<l.listeners.length;c++){const h=l.listeners[c];if((o=(r=h.options)==null?void 0:r.signal)!=null&&o.aborted){l.listeners.splice(c,1),c--;continue}if(e.immediatePropagationStopped){t=!0,vs&&console.log("immediatePropagationStopped",e.type);break}else e.propagationStopped&&(t=!0,vs&&console.log("propagationStopped",e.type));h.options.once&&(l.listeners.splice(c,1),c--),h.callback(e)}}}}get mousePosition(){return this._pointerPositions[0]}get mousePositionRC(){return this._pointerPositionsRC[0]}get mouseDown(){return this._pointerDown[0]}get mouseUp(){return this._pointerUp[0]}get mouseClick(){return this._pointerClick[0]}get mouseDoubleClick(){return this._pointerDoubleClick[0]}get mousePressed(){return this._pointerPressed[0]}get mouseWheelChanged(){return this.getMouseWheelChanged(0)}setCursorPointer(){this._specialCursorTrigger+=1,this.context.domElement.style.cursor="pointer"}setCursorNormal(){this._specialCursorTrigger-=1,this._specialCursorTrigger=Math.max(0,this._specialCursorTrigger),this._specialCursorTrigger===0&&(this.context.domElement.style.cursor="default")}getIsPointerIdInUse(e){for(const t of this._pointerEventsPressed)if(t.pointerId===e&&t.used)return!0;return!1}getPointerPressedCount(){let e=0;for(let t=0;t<this._pointerPressed.length;t++)this._pointerPressed[t]&&e++;return e}getPointerPosition(e){return e>=this._pointerPositions.length?null:this._pointerPositions[e]}getPointerPositionLastFrame(e){return e>=this._pointerPositionsLastFrame.length?null:this._pointerPositionsLastFrame[e]}getPointerPositionDelta(e){return e>=this._pointerPositionsDelta.length?null:this._pointerPositionsDelta[e]}getPointerPositionRC(e){return e>=this._pointerPositionsRC.length?null:this._pointerPositionsRC[e]}getPointerDown(e){return e>=this._pointerDown.length?!1:this._pointerDown[e]}getPointerUp(e){return e>=this._pointerUp.length?!1:this._pointerUp[e]}getPointerPressed(e){return e>=this._pointerPressed.length?!1:this._pointerPressed[e]}getPointerClicked(e){return e>=this._pointerClick.length?!1:this._pointerClick[e]}getPointerDoubleClicked(e){return e>=this._pointerDoubleClick.length?!1:this._pointerDoubleClick[e]}getPointerDownTime(e){return e>=this._pointerDownTime.length?-1:this._pointerDownTime[e]}getPointerUpTime(e){return e>=this._pointerUpTime.length?-1:this._pointerUpTime[e]}getPointerLongPress(e){return e>=this._pointerDownTime.length?!1:this.getPointerPressed(e)&&this.context.time.time-this._pointerDownTime[e]>this._longPressTimeThreshold}getIsMouse(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]==="mouse"}getIsTouch(e){return e<0||e>=this._pointerTypes.length?!1:this._pointerTypes[e]==="touch"}getTouchesPressedCount(){let e=0;for(let t=0;t<this._pointerPressed.length;t++)this._pointerPressed[t]&&this.getIsTouch(t)&&e++;return e}getMouseWheelChanged(e=0){return e>=this._mouseWheelChanged.length?!1:this._mouseWheelChanged[e]}getMouseWheelDeltaY(e=0){return e>=this._mouseWheelDeltaY.length?0:this._mouseWheelDeltaY[e]}getPointerEvent(e){if(!(e>=this._pointerEvent.length))return this._pointerEvent[e]??void 0}*foreachPointerId(e){for(let t=0;t<this._pointerTypes.length;t++)if(this._pointerIsActive(t)){if(e!==void 0){const i=this._pointerTypes[t];if(Array.isArray(e)){let n=!1;for(const r of e)if(i===r){n=!0;break}if(!n)continue}else if(e!==i)continue}yield t}}*foreachTouchId(){for(let e=0;e<this._pointerTypes.length;e++)this._pointerTypes[e]==="touch"&&this._pointerIsActive[e]&&(yield e)}_pointerIsActive(e){return e<0?!1:this._pointerPressed[e]||this._pointerDown[e]||this._pointerUp[e]}onDownButton(e,t){let i=this._pressedStack.get(e);i||(i=[],this._pressedStack.set(e,i)),i.push(t)}onReleaseButton(e,t){const i=this._pressedStack.get(e);if(!i)return;const n=i.indexOf(t);n>=0&&i.splice(n,1)}getFirstPressedButtonForPointer(e){const t=this._pressedStack.get(e);if(t)return t[0]}getLatestPressedButtonForPointer(e){const t=this._pressedStack.get(e);if(t)return t[t.length-1]}getKeyDown(){for(const e in this.keysPressed){const t=this.keysPressed[e];if(t.startFrame===this.context.time.frameCount)return t.key}return null}getKeyPressed(){for(const e in this.keysPressed){const t=this.keysPressed[e];if(t.pressed)return t.key}return null}isKeyDown(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const n of t)if(this.isKeyDown(n))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.startFrame)===this.context.time.frameCount&&this.keysPressed[e].pressed}isKeyUp(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const n of t)if(this.isKeyUp(n))return!0;return!1}return((i=this.keysPressed[e])==null?void 0:i.frame)===this.context.time.frameCount&&!this.keysPressed[e].pressed}isKeyPressed(e){var i;if(!this.context.application.isVisible||!this.context.application.hasFocus)return!1;const t=this.getCodeForCommonKeyName(e);if(t!==null){for(const n of t)if(this.isKeyPressed(n))return!0;return!1}return(i=this.keysPressed[e])==null?void 0:i.pressed}getCodeForCommonKeyName(e){if(e.length===1){if(e>="0"&&e<="9")return["Digit"+e];if(e>="a"&&e<="z")return["Key"+e.toUpperCase()];if(e==" ")return["Space"]}switch(e){case"shift":case"Shift":return["ShiftLeft","ShiftRight"];case"control":case"Control":return["ControlLeft","ControlRight"];case"alt":case"Alt":return["AltLeft","AltRight"]}return null}createInputEvent(e){switch(e.type){case"pointerdown":vs&&_n("Create Pointer down"),this.onDownButton(e.deviceIndex,e.button),this.onDown(e);break;case"pointermove":vs&&_n("Create Pointer move"),this.onMove(e);break;case"pointerup":vs&&_n("Create Pointer up"),this.onUp(e),this.onReleaseButton(e.deviceIndex,e.button);break}}convertScreenspaceToRaycastSpace(e){return e.x=(e.x-this.context.domX)/this.context.domWidth*2-1,e.y=-((e.y-this.context.domY)/this.context.domHeight)*2+1,e}bindEvents(){this.unbindEvents(),this._htmlEventSource=this.context.renderer.domElement,window.addEventListener("contextmenu",this.onContextMenu),this._htmlEventSource.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),window.addEventListener("pointermove",this.onPointerMove,{passive:!0,capture:!0}),window.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:!0}),window.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this._htmlEventSource.addEventListener("wheel",this.onMouseWheel,{passive:!0}),window.addEventListener("wheel",this.onWheelWindow,{passive:!0}),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keypress",this.onKeyPressed,!1),window.addEventListener("keyup",this.onKeyUp,!1),window.addEventListener("blur",this.onLostFocus)}unbindEvents(){var e,t;window.removeEventListener("contextmenu",this.onContextMenu),(e=this._htmlEventSource)==null||e.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),(t=this._htmlEventSource)==null||t.removeEventListener("wheel",this.onMouseWheel,!1),window.removeEventListener("wheel",this.onWheelWindow,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keypress",this.onKeyPressed,!1),window.removeEventListener("keyup",this.onKeyUp,!1),window.removeEventListener("blur",this.onLostFocus)}dispose(){const e=this.context.post_render_callbacks.indexOf(this.onEndOfFrame);e>=0&&this.context.post_render_callbacks.splice(e,1),this.unbindEvents()}canReceiveInput(e){var t;return e.target===((t=this.context.renderer)==null?void 0:t.domElement)||e.target===this.context.domElement||this.context.isInAR||this.context.isInAR&&e.target===document.body&&Dp()?!0:(vs&&console.warn("CanReceiveInput:False for",e.target),!1)}getPointerId(e,t){return e.pointerType==="mouse"?0+(t??e.button):this.getPointerIndex(e.pointerId)}getButtonName(e){const t=e.button;if(e.pointerType==="mouse")switch(t){case 0:return"left";case 1:return"middle";case 2:return"right"}return"unknown"}getAndUpdateSpatialObjectForScreenPosition(e,t,i){let n=this._pointerSpace[e];n||(n=new ye,this._pointerSpace[e]=n),this._pointerSpace[e]=n;const r=this.context.mainCamera;if(r){const o=this.tempNearPlaneVector.set(t,i,-1);this.convertScreenspaceToRaycastSpace(o);const a=this.tempFarPlaneVector.set(o.x,o.y,1);o.unproject(r),a.unproject(r);const l=r.worldUp||wt(0,1,0).applyQuaternion(ki(r));this.tempLookMatrix.lookAt(a,o,l),n.position.set(o.x,o.y,o.z),n.quaternion.setFromRotationMatrix(this.tempLookMatrix)}return n}isInRect(e){if(this.context.isInXR)return!0;const t=this.context.domElement.getBoundingClientRect(),i=e.clientX,n=e.clientY,r=i>=t.x&&i<=t.right&&n>=t.y&&n<=t.bottom;return vs&&!r&&console.log("Not in rect",t,i,n),r}onDown(e){const t=e.pointerId;if(this.getPointerPressed(t)&&console.warn(`Received pointerDown for pointerId that is already pressed: ${t}`,vs?e:""),vs&&console.log(e.pointerType,"DOWN",t),!!this.isInRect(e)){for(this.setPointerState(t,this._pointerPressed,!0),this.setPointerState(t,this._pointerDown,!0),this.setPointerStateT(t,this._pointerEvent,e.source);t>=this._pointerTypes.length;)this._pointerTypes.push(e.pointerType);for(this._pointerTypes[t]=e.pointerType;t>=this._pointerPositionDown.length;)this._pointerPositionDown.push(new S);for(this._pointerPositionDown[t].set(e.clientX,e.clientY,e.clientZ??0);t>=this._pointerPositions.length;)this._pointerPositions.push(new ee);this._pointerPositions[t].set(e.clientX,e.clientY),t>=this._pointerDownTime.length&&this._pointerDownTime.push(0),this._pointerDownTime[t]=this.context.time.realtimeSinceStartup,this.updatePointerPosition(e),this._pointerEventsPressed.push(e),this.onDispatchEvent(e)}}onMove(e){const t=e.pointerId,i=this.getPointerPressed(t);i===!1&&!this.isInRect(e)||e.pointerType==="touch"&&!i||(this.updatePointerPosition(e),this.setPointerStateT(t,this._pointerEvent,e.source),this.onDispatchEvent(e))}onUp(e){const t=e.pointerId;if(!this.getPointerPressed(t)){vs&&console.log(e.pointerType,"UP",t,"was not down");return}vs&&console.log(e.pointerType,"UP",t),this.setPointerState(t,this._pointerPressed,!1),this.setPointerStateT(t,this._pointerEvent,e.source),this.setPointerState(t,this._pointerUp,!0),this.updatePointerPosition(e);for(let a=this._pointerEventsPressed.length-1;a>=0;a--)if(this._pointerEventsPressed[a].pointerId===t){this._pointerEventsPressed.splice(a,1);break}if(!this._pointerPositionDown[t]){vs&&Fi("Received pointer up event without matching down event for button: "+t),console.warn("Received pointer up event without matching down event for button: "+t);return}const n=this._pointerDownTime[t],r=this.context.time.realtimeSinceStartup,o=r-n;if(t>=this._pointerUpTime.length&&this._pointerUpTime.push(-99),this._pointerUpTime[t]=r,o<1){let a=e.clientX-this._pointerPositionDown[t].x,l=e.clientY-this._pointerPositionDown[t].y,c=0;if(e.isSpatial&&e.clientZ!=null&&(c=e.clientZ-this._pointerPositionDown[t].z,a*=200,l*=200,c*=200),Math.abs(a)<5&&Math.abs(l)<5&&Math.abs(c)<5){vs&&console.log("CLICK",t,a,l,c),this.setPointerState(t,this._pointerClick,!0),e.isClick=!0;const h=this._pointerUpTime[t],u=this.context.time.time-h;u<this._doubleClickTimeThreshold&&u>0&&(this.setPointerState(t,this._pointerDoubleClick,!0),e.isDoubleClick=!0)}}this.onDispatchEvent(e)}updatePointerPosition(e){const t=e.pointerId;for(;t>=this._pointerPositions.length;)this._pointerPositions.push(new ee);for(;t>=this._pointerPositionsLastFrame.length;)this._pointerPositionsLastFrame.push(new ee);for(;t>=this._pointerPositionsDelta.length;)this._pointerPositionsDelta.push(new ee);const i=this._pointerPositionsLastFrame[t];i.copy(this._pointerPositions[t]);const n=this._pointerPositionsDelta[t];let r=e.clientX-i.x,o=e.clientY-i.y;if(e.source instanceof MouseEvent||e.source instanceof TouchEvent){const h=e.source;r===0&&h.movementX!==0&&(r=h.movementX||0),o===0&&h.movementY!==0&&(o=h.movementY||0)}n.x+=r,n.y+=o,this._pointerPositions[t].x=e.clientX,this._pointerPositions[t].y=e.clientY;const a=e.clientX,l=e.clientY;for(;t>=this._pointerPositionsRC.length;)this._pointerPositionsRC.push(new ee);const c=this._pointerPositionsRC[t];c.set(a,l),this.convertScreenspaceToRaycastSpace(c)}getPointerIndex(e){let t=-1;for(let i=0;i<this._pointerIds.length;i++){if(this._pointerIds[i]===e)return i;t===-1&&this._pointerIds[i]===-1&&(t=i)}return t!==-1?(this._pointerIds[t]=e,t):(vs&&console.log("PUSH pointerId:",e),this._pointerIds.push(e),this._pointerIds.length-1)}setPointerState(e,t,i){t[e]=i}setPointerStateT(e,t,i){return t[e]=i,i}onDispatchEvent(e){const t=Dt.Current;try{Dt.Current=this.context,this.dispatchEvent(e)}finally{Dt.Current=t}}}const ky=new le().makeRotationY(Math.PI),dc=new Ce().setFromAxisAngle(new S(0,1,0),Math.PI),jue=ie("debugwebxr");class que{constructor(){d(this,"priority",-1e5);d(this,"gameObject");if(this.gameObject=new ye,this.gameObject.name="Implicit XR Rig",jue){const e=Uk(16733661);e.position.y+=.5,this.gameObject.add(e)}}isXRRig(){return!0}get isActive(){return this.gameObject.visible}}const Hu=ie("debugwebxr"),yS=ie("debugcustomgesture"),Xue="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Yue="generic-trigger";class Mk{constructor(e,t,i){d(this,"xr");d(this,"inputSource");d(this,"index",0);d(this,"emitEvents",!0);d(this,"_connected",!0);d(this,"_isTracking",!1);d(this,"__gamepad");d(this,"__hand");d(this,"__side");d(this,"_hitTestSource");d(this,"_hasSelectEvent",!1);d(this,"_handJointPoses",new Map);d(this,"_gripMatrix",new le);d(this,"_gripPosition",new S);d(this,"_gripQuaternion",new Ce);d(this,"_linearVelocity",new S);d(this,"_rayPositionRaw",new S);d(this,"_rayRotationRaw",new Ce);d(this,"_rayMatrix",new le);d(this,"_rayPosition",new S);d(this,"_rayQuaternion",new Ce);d(this,"_gripWorldPosition",new S);d(this,"_gripWorldQuaternion",new Ce);d(this,"_rayWorldPosition",new S);d(this,"_rayWorldQuaternion",new Ce);d(this,"_ray");d(this,"_hand_wristDotUp");d(this,"_object");d(this,"model",null);d(this,"_debugAxesHelper",new _a(.2));d(this,"_hitTestSourcePromise",null);d(this,"onPointerHits",e=>{});d(this,"_needleGamepadButtons",{});d(this,"_buttonMap",new Map);d(this,"_motioncontroller");d(this,"_layout");d(this,"getMotionController");d(this,"emitPointerDownEvent",!0);d(this,"emitPointerUpEvent",!0);d(this,"emitPointerMoveEvent",!0);d(this,"pointerMoveDistanceThreshold",.03);d(this,"pointerMoveAngleThreshold",.05);d(this,"_selectButtonIndex");d(this,"_squeezeButtonIndex");d(this,"onSelectStart",e=>{var n,r,o,a;if(!this.emitPointerDownEvent||this.inputSource!==e.inputSource)return;this.onUpdateFrame(e.frame),this._hasSelectEvent=!0;const t=(n=this._layout)==null?void 0:n.selectComponentId,i=(a=(o=(r=this._layout)==null?void 0:r.components[t])==null?void 0:o.gamepadIndices)==null?void 0:a.button;i!==void 0&&(this._selectButtonIndex=i),!yS&&(Hu&&_t.DrawDirection(this.rayWorldPosition,wt(0,.01,1).applyQuaternion(this.rayWorldQuaternion),16711680,10),this.emitPointerEvent(vn.PointerDown,this._selectButtonIndex||0,"xr-standard-trigger",!0,e))});d(this,"onSelectEnd",e=>{this.emitPointerUpEvent&&(yS||this.inputSource===e.inputSource&&this.emitPointerEvent(vn.PointerUp,this._selectButtonIndex||0,"xr-standard-trigger",!0,e))});d(this,"onSequeezeStart",e=>{var t,i,n;this.emitPointerDownEvent&&this.inputSource===e.inputSource&&(this._squeezeButtonIndex=(n=(i=(t=this._layout)==null?void 0:t.components["xr-standard-squeeze"])==null?void 0:i.gamepadIndices)==null?void 0:n.button,this._squeezeButtonIndex!==void 0&&(Hu&&_t.DrawDirection(this.rayWorldPosition,wt(0,.01,1).applyQuaternion(this.rayWorldQuaternion),255,10),this.emitPointerEvent(vn.PointerDown,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,e)))});d(this,"onSequeezeEnd",e=>{this.emitPointerUpEvent&&this.inputSource===e.inputSource&&this._squeezeButtonIndex!==void 0&&this.emitPointerEvent(vn.PointerUp,this._squeezeButtonIndex||0,"xr-standard-squeeze",!0,e)});d(this,"states",{});d(this,"_didMoveLastFrame",!1);d(this,"_lastPointerMovePosition",new S);d(this,"_lastPointerMoveQuaternion",new Ce);d(this,"pointerInit");this.xr=e,this.inputSource=t,this.index=i,this._object=new ye,Hu&&this._object.add(this._debugAxesHelper),this.xr.context.scene.add(this._object),this._ray=new _o,this.pointerInit={origin:this,pointerType:this.hand?"hand":"controller",deviceIndex:this.index,pointerId:-1,mode:this.inputSource.targetRayMode,ray:this._ray,device:this._object,buttonName:"none"},this.initialize(),this.subscribeEvents()}get context(){return this.xr.context}get connected(){return this._connected}get isTracking(){return this._isTracking}get gamepad(){return this.__gamepad??(this.__gamepad=this.inputSource.gamepad)}get isHand(){return this.hand!=null}get hand(){return this.__hand??(this.__hand=this.inputSource.hand)}get handObject(){return this.context.renderer.xr.getHand(this.index)}get profiles(){return this.inputSource.profiles}get layout(){return this._layout}get targetRayMode(){return this.inputSource.targetRayMode}get targetRaySpace(){return this.inputSource.targetRaySpace}get gripSpace(){return this.inputSource.gripSpace}get side(){return this.__side??(this.__side=this.inputSource.handedness)}get isRight(){return this.side==="right"}get isLeft(){return this.side==="left"}getHitTestSource(){return this._hitTestSource||this._requestHitTestSource(),this._hitTestSource}get hasHitTestSource(){return this._hitTestSource}cancelHitTestSource(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}get hasSelectEvent(){return this._hasSelectEvent}getHitTest(){return this.xr.getHitTest(this)}getHandJointPose(e,t){var n;if(t=t||this.xr.frame,!this.hand||!(t!=null&&t.getJointPose)||!this.xr.referenceSpace)return null;let i=(n=this._handJointPoses)==null?void 0:n.get(e);return i||(i=t.getJointPose(e,this.xr.referenceSpace),i&&this._handJointPoses.set(e,i),i)}get gripPosition(){return wt(this._gripPosition)}get gripQuaternion(){return fc(this._gripQuaternion)}get gripMatrix(){return this._gripMatrix}get gripLinearVelocity(){return wt(this._linearVelocity).applyQuaternion(dc)}get rayPosition(){return wt(this._rayPosition)}get rayQuaternion(){return fc(this._rayQuaternion)}get gripWorldPosition(){return wt(this._gripWorldPosition)}get gripWorldQuaternion(){return fc(this._gripWorldQuaternion)}get rayWorldPosition(){return wt(this._rayWorldPosition)}updateRayWorldPosition(){var t;const e=(t=this.xr.context.mainCamera)==null?void 0:t.parent;this._rayWorldPosition.copy(this._rayPositionRaw),e&&this._rayWorldPosition.applyMatrix4(e.matrixWorld)}get rayWorldQuaternion(){return fc(this._rayWorldQuaternion)}updateRayWorldQuaternion(){var i;const e=(i=this.xr.context.mainCamera)==null?void 0:i.parent,t=e?ki(e):void 0;this._rayWorldQuaternion.copy(this._rayRotationRaw).multiply(dc),t&&this._rayWorldQuaternion.premultiply(t)}get ray(){return this._ray.origin.copy(this.rayWorldPosition),this._ray.direction.copy(wt(0,0,1).applyQuaternion(this.rayWorldQuaternion)),this._ray}get handWristDotUp(){var t;if(this._hand_wristDotUp!==void 0)return this._hand_wristDotUp;const e=(t=this.handObject)==null?void 0:t.joints.wrist;if(e){const i=wt(0,1,0).applyQuaternion(e.quaternion),n=wt(0,1,0).dot(i);return this._hand_wristDotUp=n}}get isHandUpsideDown(){return this.handWristDotUp!==void 0?this.handWristDotUp<-.7:!1}get isTeleportGesture(){return this.isHandUpsideDown}get object(){return this._object}async getModelUrl(){var e;return(e=this.getMotionController)==null?void 0:e.then(t=>(t==null?void 0:t.assetUrl)||null)}_requestHitTestSource(){var e;return this._hitTestSourcePromise?this._hitTestSourcePromise:this.xr.mode==="immersive-ar"&&this.inputSource.targetRayMode==="tracked-pointer"&&this.xr.session.requestHitTestSourceForTransientInput?this._hitTestSourcePromise=((e=this.xr.session.requestHitTestSourceForTransientInput({profile:this.inputSource.profiles[0],offsetRay:new XRRay}))==null?void 0:e.then(t=>(this._hitTestSourcePromise=null,this.connected?this._hitTestSource=t:(t.cancel(),null))))??null:null}onUpdate(e){performance.mark("NeedleXRController onUpdate start"),this.onUpdateFrame(e),this.updateInputEvents(),this.onUpdateMove(),performance.mark("NeedleXRController onUpdate end"),performance.measure("NeedleXRController onUpdate","NeedleXRController onUpdate start","NeedleXRController onUpdate end")}onRenderDebug(){var n;_t.DrawWireSphere(this.rayWorldPosition,.02),_t.DrawDirection(this.rayWorldPosition,wt(0,0,10).applyQuaternion(this.rayWorldQuaternion));const e=this.gripWorldPosition.sub(this.object.worldForward.multiplyScalar(.1)),t=this.inputSource.profiles.join(`
`);let i=`Controller[${this.index}] ${this.side}
C:${this.connected?"yes":"no"} T:${this.isTracking?"yes":"no"} Hand:${this.inputSource.hand?"yes":"no"}`;this.inputSource.hand&&(i+=`
Pinch: ${(n=this.getGesture("pinch"))==null?void 0:n.value.toFixed(3)}`),i+=`
`+t,_t.DrawLabel(e,i,.01)}onUpdateFrame(e){var h,u,f;if(this._handJointPoses.clear(),this._hand_wristDotUp=void 0,!this.xr.referenceSpace){this._isTracking=!1;return}const t=e.getPose(this.inputSource.targetRaySpace,this.xr.referenceSpace);this._isTracking=t!=null;let i=null,n=null,r=null,o=null;if(t){const p=t.transform;this._rayMatrix.fromArray(p.matrix).premultiply(ky),this._rayMatrix.decompose(this._rayPosition,this._rayQuaternion,wt(1,1,1)),r=wt(p.position),o=fc(p.orientation),this._rayPositionRaw.copy(p.position),this._rayRotationRaw.copy(p.orientation)}if(this.inputSource.gripSpace){const p=e.getPose(this.inputSource.gripSpace,this.xr.referenceSpace);if(p){const m=p.transform;if(i=wt(m.position),n=fc(m.orientation),this._gripMatrix.fromArray(m.matrix).premultiply(ky),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,wt(1,1,1)),"linearVelocity"in p&&p.linearVelocity){const v=p.linearVelocity;this._linearVelocity.set(v.x,v.y,v.z)}}}(h=this.xr.context.mainCamera)!=null&&h.parent&&this._object.parent!==((u=this.xr.context.mainCamera)==null?void 0:u.parent)&&this.xr.context.mainCamera.parent.add(this._object);const a=this.hand;if(a){let p=!1;const m=a.get("wrist"),v=m&&this.getHandJointPose(m,e);if(v){p=!0;const A=v.transform.position,_=v.transform.orientation;this._object.position.set(A.x,A.y,A.z),this._object.quaternion.set(_.x,_.y,_.z,_.w).multiply(dc)}p||(this._object.position.copy(this._rayPosition),this._object.quaternion.copy(this._rayQuaternion).multiply(dc));const g=a.get("middle-finger-metacarpal"),y=g&&this.getHandJointPose(g,e);y&&(this._gripMatrix.fromArray(y.transform.matrix).premultiply(ky),this._gripMatrix.decompose(this._gripPosition,this._gripQuaternion,wt(1,1,1)))}else this.inputSource.gripSpace&&this.targetRayMode==="transient-pointer"&&i&&n?(this._object.position.copy(i),this._object.quaternion.copy(n).multiply(dc)):r&&o&&(this._object.position.copy(r),this._object.quaternion.copy(o).multiply(dc));const l=(f=this.xr.context.mainCamera)==null?void 0:f.parent,c=l?ki(l):void 0;i&&n&&(this._gripWorldPosition.copy(i),l&&this._gripWorldPosition.applyMatrix4(l.matrixWorld),this._gripWorldQuaternion.copy(n),this._gripWorldQuaternion.multiply(dc),c&&this._gripWorldQuaternion.premultiply(c)),this.updateRayWorldPosition(),this.updateRayWorldQuaternion()}onDisconnected(){this._connected=!1,Hu&&console.warn("Controller disconnected",this.index);for(const e of this._object.children)this.xr.context.scene.attach(e);this._object.removeFromParent(),this._debugAxesHelper.removeFromParent(),this.unsubscribeEvents(),this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0)}getButton(e){var i;if(!this._layout)return;switch(e){case"primary-button":if(this.isLeft)e="x-button";else if(this.isRight)e="a-button";else return;break;case"primary":return this.hand?this.getGesture("pinch"):this.toNeedleGamepadButton(0,e)}if(this._buttonMap.has(e))return this.toNeedleGamepadButton(this._buttonMap.get(e),e);const t=(i=this._layout)==null?void 0:i.components[e];if(t!=null&&t.gamepadIndices)switch(t.type){case"button":case"squeeze":if(this.inputSource.gamepad){const n=t.gamepadIndices.button;return this._buttonMap.set(e,n),this.toNeedleGamepadButton(n,e)}break;default:console.warn("Unsupported component type",t.type);break}this._buttonMap.set(e,void 0)}getGesture(e){const t=this.states[e];if(!t)return null;this.states[e]=t;const i=this._needleGamepadButtons[e]||new d4(void 0,e);return i.pressed=t.pressed,i.value=t.value,i.isDown=t.isDown,i.isUp=t.isUp,this._needleGamepadButtons[e]=i,i}getPointerId(e){if((e==="primary"||e==="pinch")&&(e=0),typeof e!="number"){const t=this._buttonMap.get(e);if(t===void 0)return;e=t}return this.index*10+e}toNeedleGamepadButton(e,t){var o,a;if(!((o=this.inputSource.gamepad)!=null&&o.buttons))return;const i=(a=this.inputSource.gamepad)==null?void 0:a.buttons[e],n=this.states[e],r=this._needleGamepadButtons[e]||new d4(e,t);return i&&(r.pressed=i.pressed,r.value=i.value,r.touched=i.touched),n&&(r.isDown=n.isDown,r.isUp=n.isUp),this._needleGamepadButtons[e]=r,r}getStick(e){var i,n,r,o,a,l,c,h,u;if(!this._layout)return{x:0,y:0,z:0};if(e==="primary"){const f=((i=this.inputSource.gamepad)==null?void 0:i.axes[0])||0,p=((n=this.inputSource.gamepad)==null?void 0:n.axes[1])||0,m=((o=(r=this.inputSource.gamepad)==null?void 0:r.buttons[3])==null?void 0:o.value)||0;return{x:f,y:p,z:m}}const t=(a=this._layout)==null?void 0:a.components[e];if(t!=null&&t.gamepadIndices)switch(t.type){case"thumbstick":if(this.inputSource.gamepad){const f=t.gamepadIndices.xAxis,p=t.gamepadIndices.yAxis;let m=(l=this.inputSource.gamepad)==null?void 0:l.axes[f],v=(c=this.inputSource.gamepad)==null?void 0:c.axes[p];m*=-1,v*=-1;const g=t.gamepadIndices.button,y=(u=(h=this.inputSource.gamepad)==null?void 0:h.buttons[g])==null?void 0:u.value;return{x:m,y:v,z:y}}}return{x:0,y:0,z:0}}initialize(){if(this._hasSelectEvent=this.profiles.includes("generic-hand-select")||this.profiles.some(e=>e.startsWith("generic-trigger")),!this._layout){if(this.inputSource.targetRayMode==="transient-pointer")return;const e=Nue(this.inputSource,Xue,Yue);this.getMotionController=e.then(t=>{var r;if(!this.connected)return null;this._motioncontroller=new Que(this.inputSource,t.profile,t.assetPath||"");const n=t.profile.layouts[this.inputSource.handedness];if(this._layout=n,this._layout&&!((r=this._layout.gamepad)!=null&&r.length)){this._layout.gamepad=[];for(const o in this._layout.components){const a=this._layout.components[o];this._layout.gamepad[a.gamepadIndices.button]=o}}return this._motioncontroller}).catch(t=>(this.inputSource&&console.warn("Couldn't initialize motion controller profile for ",this.inputSource,t),null))}}subscribeEvents(){this.xr.session.addEventListener("selectstart",this.onSelectStart),this.xr.session.addEventListener("selectend",this.onSelectEnd),this.xr.session.addEventListener("squeezestart",this.onSequeezeStart),this.xr.session.addEventListener("squeezeend",this.onSequeezeEnd)}unsubscribeEvents(){this.xr.session.removeEventListener("selectstart",this.onSelectStart),this.xr.session.removeEventListener("selectend",this.onSelectEnd),this.xr.session.removeEventListener("squeezestart",this.onSequeezeStart),this.xr.session.removeEventListener("squeezeend",this.onSequeezeEnd)}updateInputEvents(){var e,t;if((e=this.gamepad)!=null&&e.buttons)for(let i=0;i<this.gamepad.buttons.length;i++){const n=this.gamepad.buttons[i],r=this.states[i]||new u4;let o=null;n.pressed&&!r.pressed?(o="pointerdown",r.isDown=!0,r.isUp=!1):!n.pressed&&r.pressed?(o="pointerup",r.isDown=!1,r.isUp=!0):(r.isDown=!1,r.isUp=!1),r.value=n.value,r.pressed=n.pressed,this.states[i]=r;const a=i!==this._selectButtonIndex&&i!==this._squeezeButtonIndex;if(o!=null&&a){const l=(t=this._layout)==null?void 0:t.gamepad[i];(Hu||yS)&&console.log("Emitting pointer event",o,i,l,n.value,this.gamepad,this._layout),this.emitPointerEvent(o,i,l??"none",!1,null,n.value)}}if(this.hand){const i=this.handObject;if(i){const n=i.joints["index-finger-tip"],r=i.joints["thumb-tip"];if(n&&r){const o=n.position.distanceTo(r.position);if(o!==0){const c=this.states.pinch||new u4,h=(.02+.01)*1.5;c.value=1-(o-.02)/h;const u=o<.02-.01,f=o>.02+.01;u&&!c.pressed?(yS&&console.log("pinch start",o),c.isDown=!0,c.isUp=!1,c.pressed=!0):f&&c.pressed?(c.isDown=!1,c.isUp=!0,c.pressed=!1):(c.isDown=!1,c.isUp=!1),this.states.pinch=c}}}}}onUpdateMove(){var i,n;if(!this.emitPointerMoveEvent)return;let e=!1;if(this._lastPointerMovePosition.distanceTo(this.gripWorldPosition)>this.pointerMoveDistanceThreshold*this.xr.rigScale&&(e=!0),e||this._lastPointerMoveQuaternion.angleTo(this.gripWorldQuaternion)>this.pointerMoveAngleThreshold&&(e=!0),e){this._didMoveLastFrame=!0,this._lastPointerMovePosition.copy(this.gripWorldPosition),this._lastPointerMoveQuaternion.copy(this.gripWorldQuaternion),Hu&&_t.DrawLabel(this.rayWorldPosition.add(this.object.worldForward.multiplyScalar(.1)),"move",.01);let r=this.xr.context.input.getFirstPressedButtonForPointer(this.index);r===void 0&&(r=0);const o=(n=(i=this.gamepad)==null?void 0:i.buttons[r])==null?void 0:n.value;this.emitPointerEvent("pointermove",r,"none",!1,null,o)}else this._didMoveLastFrame=!1}emitPointerEvent(e,t,i,n,r=null,o){if(!this.emitEvents){Hu&&e!==vn.PointerMove&&console.warn("Pointer events are disabled for this controller",this.index,e,t);return}if(this.xr.mode==="immersive-vr"||this.xr.isPassThrough){this.pointerInit.origin=this,this.pointerInit.pointerId=this.getPointerId(t),this.pointerInit.pointerType=this.hand?"hand":"controller",this.pointerInit.button=t,this.pointerInit.buttonName=i,this.pointerInit.isPrimary=n,this.pointerInit.mode=this.inputSource.targetRayMode,this.pointerInit.ray=this.ray,this.pointerInit.device=this.object,this.pointerInit.pressure=o,this.pointerInit.clientX=this._rayPosition.x/this.xr.rigScale,this.pointerInit.clientY=this._rayPosition.y/this.xr.rigScale,this.pointerInit.clientZ=this._rayPosition.z/this.xr.rigScale;const a=Dt.Current;Dt.Current=this.xr.context,Hu&&e!=="pointermove"&&console.warn("Pointer event",e,t,i,{...this.pointerInit}),this.xr.context.input.createInputEvent(new Ph(e,r,this.pointerInit)),Dt.Current=a}}}class u4{constructor(){d(this,"isDown",!1);d(this,"isUp",!1);d(this,"pressed",!1);d(this,"value",0)}}class d4{constructor(e,t){d(this,"index");d(this,"name");d(this,"touched",!1);d(this,"pressed",!1);d(this,"value",0);d(this,"isDown",!1);d(this,"isUp",!1);this.index=e,this.name=t}}function Up(s,e){try{e?s(e):s()}catch(t){return console.error(t),!1}return!0}const e_=new Map,GR=new WeakSet;function of(s,e,t){e_.has(e)||e_.set(e,new Array),e_.get(e).push({method:s,options:{once:!1,...t}})}function af(s,e){const t=e_.get(e);if(t){for(let i=0;i<t.length;i++)if(t[i].method===s){t.splice(i,1);return}}}function $l(s,e){e===Ti.ContextCreated&&GR.delete(s);const t=e_.get(e);if(t&&t.length>0){const i=t;if(e===nn.Start){if(GR.has(s))return;GR.add(s)}Kue(s,i)}}const vS=new Array;function Kue(s,e){var t;vS.length=0;for(let i=0;i<e.length;i++)vS.push(e[i]);for(let i=0;i<vS.length;i++){const n=vS[i];if(Up(n.method,s),(t=n.options)!=null&&t.once){for(let r=0;r<e.length;r++)if(e[r]===n){e.splice(r,1);break}}}}const HR=2,Ac=4,Hh=4,Tk=4,od=new Int32Array(2),f4=new Float32Array(od.buffer),p4=new Float64Array(od.buffer),AS=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;class eu{constructor(e,t){this.low=e|0,this.high=t|0}static create(e,t){return e==0&&t==0?eu.ZERO:new eu(e,t)}toFloat64(){return(this.low>>>0)+this.high*4294967296}equals(e){return this.low==e.low&&this.high==e.high}}eu.ZERO=new eu(0,0);var tD;(function(s){s[s.UTF8_BYTES=1]="UTF8_BYTES",s[s.UTF16_STRING=2]="UTF16_STRING"})(tD||(tD={}));class X_{constructor(e){this.bytes_=e,this.position_=0}static allocate(e){return new X_(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return new eu(this.readInt32(e),this.readInt32(e+4))}readUint64(e){return new eu(this.readUint32(e),this.readUint32(e+4))}readFloat32(e){return od[0]=this.readInt32(e),f4[0]}readFloat64(e){return od[AS?0:1]=this.readInt32(e),od[AS?1:0]=this.readInt32(e+4),p4[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,t.low),this.writeInt32(e+4,t.high)}writeUint64(e,t){this.writeUint32(e,t.low),this.writeUint32(e+4,t.high)}writeFloat32(e,t){f4[0]=t,this.writeInt32(e,od[0])}writeFloat64(e,t){p4[0]=t,this.writeInt32(e,od[AS?0:1]),this.writeInt32(e+4,od[AS?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Ac+Hh)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Hh;t++)e+=String.fromCharCode(this.readInt8(this.position_+Ac+t));return e}__offset(e,t){const i=e-this.readInt32(e);return t<this.readInt16(i)?this.readInt16(i+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const i=this.readInt32(e);let n="",r=0;if(e+=Ac,t===tD.UTF8_BYTES)return this.bytes_.subarray(e,e+i);for(;r<i;){let o;const a=this.readUint8(e+r++);if(a<192)o=a;else{const l=this.readUint8(e+r++);if(a<224)o=(a&31)<<6|l&63;else{const c=this.readUint8(e+r++);if(a<240)o=(a&15)<<12|(l&63)<<6|c&63;else{const h=this.readUint8(e+r++);o=(a&7)<<18|(l&63)<<12|(c&63)<<6|h&63}}}o<65536?n+=String.fromCharCode(o):(o-=65536,n+=String.fromCharCode((o>>10)+55296,(o&1024-1)+56320))}return n}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Ac}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Hh)throw new Error("FlatBuffers: file identifier must be length "+Hh);for(let t=0;t<Hh;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Ac+t))return!1;return!0}createLong(e,t){return eu.create(e,t)}createScalarList(e,t){const i=[];for(let n=0;n<t;++n)e(n)!==null&&i.push(e(n));return i}createObjList(e,t){const i=[];for(let n=0;n<t;++n){const r=e(n);r!==null&&i.push(r.unpack())}return i}}class jb{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null;let t;e?t=e:t=1024,this.bb=X_.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const i=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<i+e+t;){const n=this.bb.capacity();this.bb=jb.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(i)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,i){(this.force_defaults||t!=i)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,i){(this.force_defaults||t!=i)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,i){(this.force_defaults||t!=i)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,i){(this.force_defaults||!t.equals(i))&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,i){(this.force_defaults||t!=i)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,i){t!=i&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=t<<1,n=X_.allocate(i);return n.setPosition(i-t),n.bytes().set(e.bytes(),i-t),n}addOffset(e){this.prep(Ac,0),this.writeInt32(this.offset()-e+Ac)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const i=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const n=2;this.addInt16(e-this.object_start);const r=(i+n)*HR;this.addInt16(r);let o=0;const a=this.space;e:for(t=0;t<this.vtables.length;t++){const l=this.bb.capacity()-this.vtables[t];if(r==this.bb.readInt16(l)){for(let c=HR;c<r;c+=HR)if(this.bb.readInt16(a+c)!=this.bb.readInt16(l+c))continue e;o=this.vtables[t];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,i){const n=i?Tk:0;if(t){const r=t;if(this.prep(this.minalign,Ac+Hh+n),r.length!=Hh)throw new Error("FlatBuffers: file identifier must be length "+Hh);for(let o=Hh-1;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,Ac+n),this.addOffset(e),n&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const i=this.bb.capacity()-e,n=i-this.bb.readInt32(i);if(!(this.bb.readInt16(n+t)!=0))throw new Error("FlatBuffers: field "+t+" must be set")}startVector(e,t,i){this.notNested(),this.vector_num_elems=t,this.prep(Ac,e*t),this.prep(i,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(!e)return 0;let t;if(e instanceof Uint8Array)t=e;else{t=[];let i=0;for(;i<e.length;){let n;const r=e.charCodeAt(i++);if(r<55296||r>=56320)n=r;else{const o=e.charCodeAt(i++);n=(r<<10)+o+(65536-56623104-56320)}n<128?t.push(n):(n<2048?t.push(n>>6&31|192):(n<65536?t.push(n>>12&15|224):t.push(n>>18&7|240,n>>12&63|128),t.push(n>>6&63|128)),t.push(n&63|128))}}this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length);for(let i=0,n=this.space,r=this.bb.bytes();i<t.length;i++)r[n++]=t[i];return this.endVector()}createLong(e,t){return eu.create(e,t)}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let i=0;i<e.length;++i){const n=e[i];if(n!==null)t.push(this.createObjectOffset(n));else throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e),this.endVector()}}const Ik={};function Rk(s,e){Ik[s]=e}function jW(s){const e=s.getBufferIdentifier(),t=Ik[e];return t(s)}function qW(s){return typeof s.guid=="function"?s.guid():null}function WM(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var XW={exports:{}};(function(s){var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),s.exports.binaryFeatures=e;var t=s.exports.BlobBuilder;typeof window<"u"&&(t=s.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function i(){this._pieces=[],this._parts=[]}i.prototype.append=function(n){typeof n=="number"?this._pieces.push(n):(this.flush(),this._parts.push(n))},i.prototype.flush=function(){if(this._pieces.length>0){var n=new Uint8Array(this._pieces);e.useArrayBufferView||(n=n.buffer),this._parts.push(n),this._pieces=[]}},i.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var n=new t,r=0,o=this._parts.length;r<o;r++)n.append(this._parts[r]);return n.getBlob()}else return new Blob(this._parts)},s.exports.BufferBuilder=i})(XW);var YW=XW.exports,Jue=YW.BufferBuilder,m4=YW.binaryFeatures,Zue={unpack:function(s){var e=new br(s);return e.unpack()},pack:function(s){var e=new xr;e.pack(s);var t=e.getBuffer();return t}},$ue=Zue;function br(s){this.index=0,this.dataBuffer=s,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}br.prototype.unpack=function(){var s=this.unpack_uint8();if(s<128)return s;if((s^224)<32)return(s^224)-32;var e;if((e=s^160)<=15)return this.unpack_raw(e);if((e=s^176)<=15)return this.unpack_string(e);if((e=s^144)<=15)return this.unpack_array(e);if((e=s^128)<=15)return this.unpack_map(e);switch(s){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}};br.prototype.unpack_uint8=function(){var s=this.dataView[this.index]&255;return this.index++,s};br.prototype.unpack_uint16=function(){var s=this.read(2),e=(s[0]&255)*256+(s[1]&255);return this.index+=2,e};br.prototype.unpack_uint32=function(){var s=this.read(4),e=((s[0]*256+s[1])*256+s[2])*256+s[3];return this.index+=4,e};br.prototype.unpack_uint64=function(){var s=this.read(8),e=((((((s[0]*256+s[1])*256+s[2])*256+s[3])*256+s[4])*256+s[5])*256+s[6])*256+s[7];return this.index+=8,e};br.prototype.unpack_int8=function(){var s=this.unpack_uint8();return s<128?s:s-256};br.prototype.unpack_int16=function(){var s=this.unpack_uint16();return s<32768?s:s-65536};br.prototype.unpack_int32=function(){var s=this.unpack_uint32();return s<Math.pow(2,31)?s:s-Math.pow(2,32)};br.prototype.unpack_int64=function(){var s=this.unpack_uint64();return s<Math.pow(2,63)?s:s-Math.pow(2,64)};br.prototype.unpack_raw=function(s){if(this.length<this.index+s)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+s+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+s);return this.index+=s,e};br.prototype.unpack_string=function(s){for(var e=this.read(s),t=0,i="",n,r;t<s;)n=e[t],n<128?(i+=String.fromCharCode(n),t++):(n^192)<32?(r=(n^192)<<6|e[t+1]&63,i+=String.fromCharCode(r),t+=2):(r=(n&15)<<12|(e[t+1]&63)<<6|e[t+2]&63,i+=String.fromCharCode(r),t+=3);return this.index+=s,i};br.prototype.unpack_array=function(s){for(var e=new Array(s),t=0;t<s;t++)e[t]=this.unpack();return e};br.prototype.unpack_map=function(s){for(var e={},t=0;t<s;t++){var i=this.unpack(),n=this.unpack();e[i]=n}return e};br.prototype.unpack_float=function(){var s=this.unpack_uint32(),e=s>>31,t=(s>>23&255)-127,i=s&8388607|8388608;return(e===0?1:-1)*i*Math.pow(2,t-23)};br.prototype.unpack_double=function(){var s=this.unpack_uint32(),e=this.unpack_uint32(),t=s>>31,i=(s>>20&2047)-1023,n=s&1048575|1048576,r=n*Math.pow(2,i-20)+e*Math.pow(2,i-52);return(t===0?1:-1)*r};br.prototype.read=function(s){var e=this.index;if(e+s<=this.length)return this.dataView.subarray(e,e+s);throw new Error("BinaryPackFailure: read index out of range")};function xr(){this.bufferBuilder=new Jue}xr.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};xr.prototype.pack=function(s){var e=typeof s;if(e==="string")this.pack_string(s);else if(e==="number")Math.floor(s)===s?this.pack_integer(s):this.pack_double(s);else if(e==="boolean")s===!0?this.bufferBuilder.append(195):s===!1&&this.bufferBuilder.append(194);else if(e==="undefined")this.bufferBuilder.append(192);else if(e==="object")if(s===null)this.bufferBuilder.append(192);else{var t=s.constructor;if(t==Array)this.pack_array(s);else if(t==Blob||t==File||s instanceof Blob||s instanceof File)this.pack_bin(s);else if(t==ArrayBuffer)m4.useArrayBufferView?this.pack_bin(new Uint8Array(s)):this.pack_bin(s);else if("BYTES_PER_ELEMENT"in s)m4.useArrayBufferView?this.pack_bin(new Uint8Array(s.buffer)):this.pack_bin(s.buffer);else if(t==Object||t.toString().startsWith("class"))this.pack_object(s);else if(t==Date)this.pack_string(s.toString());else if(typeof s.toBinaryPack=="function")this.bufferBuilder.append(s.toBinaryPack());else throw new Error('Type "'+t.toString()+'" not yet supported')}else throw new Error('Type "'+e+'" not yet supported');this.bufferBuilder.flush()};xr.prototype.pack_bin=function(s){var e=s.length||s.byteLength||s.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(s)};xr.prototype.pack_string=function(s){var e=tde(s);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(s)};xr.prototype.pack_array=function(s){var e=s.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");for(var t=0;t<e;t++)this.pack(s[t])};xr.prototype.pack_integer=function(s){if(s>=-32&&s<=127)this.bufferBuilder.append(s&255);else if(s>=0&&s<=255)this.bufferBuilder.append(204),this.pack_uint8(s);else if(s>=-128&&s<=127)this.bufferBuilder.append(208),this.pack_int8(s);else if(s>=0&&s<=65535)this.bufferBuilder.append(205),this.pack_uint16(s);else if(s>=-32768&&s<=32767)this.bufferBuilder.append(209),this.pack_int16(s);else if(s>=0&&s<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(s);else if(s>=-2147483648&&s<=2147483647)this.bufferBuilder.append(210),this.pack_int32(s);else if(s>=-9223372036854776e3&&s<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(s);else if(s>=0&&s<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(s);else throw new Error("Invalid integer")};xr.prototype.pack_double=function(s){var e=0;s<0&&(e=1,s=-s);var t=Math.floor(Math.log(s)/Math.LN2),i=s/Math.pow(2,t)-1,n=Math.floor(i*Math.pow(2,52)),r=Math.pow(2,32),o=e<<31|t+1023<<20|n/r&1048575,a=n%r;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(a)};xr.prototype.pack_object=function(s){var e=Object.keys(s),t=e.length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(t);else throw new Error("Invalid length");for(var i in s)s.hasOwnProperty(i)&&(this.pack(i),this.pack(s[i]))};xr.prototype.pack_uint8=function(s){this.bufferBuilder.append(s)};xr.prototype.pack_uint16=function(s){this.bufferBuilder.append(s>>8),this.bufferBuilder.append(s&255)};xr.prototype.pack_uint32=function(s){var e=s&4294967295;this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};xr.prototype.pack_uint64=function(s){var e=s/Math.pow(2,32),t=s%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};xr.prototype.pack_int8=function(s){this.bufferBuilder.append(s&255)};xr.prototype.pack_int16=function(s){this.bufferBuilder.append((s&65280)>>8),this.bufferBuilder.append(s&255)};xr.prototype.pack_int32=function(s){this.bufferBuilder.append(s>>>24&255),this.bufferBuilder.append((s&16711680)>>>16),this.bufferBuilder.append((s&65280)>>>8),this.bufferBuilder.append(s&255)};xr.prototype.pack_int64=function(s){var e=Math.floor(s/Math.pow(2,32)),t=s%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};function ede(s){var e=s.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function tde(s){return s.length>600?new Blob([s]).size:s.replace(/[^\u0000-\u007F]/g,ede).length}const g4=WM($ue);let KW=!0,JW=!0;function _A(s,e,t){const i=s.match(e);return i&&i.length>=t&&parseInt(i[t],10)}function Tv(s,e,t){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return n.apply(this,arguments);const l=c=>{const h=t(c);h&&(a.handleEvent?a.handleEvent(h):a(h))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),n.apply(this,[o,l])};const r=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(a))return r.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function ide(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(KW=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function nde(s){return typeof s!="boolean"?new Error("Argument type: "+typeof s+". Please use a boolean."):(JW=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function Pk(){if(typeof window=="object"){if(KW)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function jM(s,e){JW&&console.warn(s+" is deprecated, please use "+e+" instead.")}function sde(s){const e={browser:null,version:null};if(typeof s>"u"||!s.navigator)return e.browser="Not a browser.",e;const{navigator:t}=s;if(t.mozGetUserMedia)e.browser="firefox",e.version=_A(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection&&!s.RTCIceGatherer)e.browser="chrome",e.version=_A(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=_A(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(s.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=_A(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function y4(s){return Object.prototype.toString.call(s)==="[object Object]"}function ZW(s){return y4(s)?Object.keys(s).reduce(function(e,t){const i=y4(s[t]),n=i?ZW(s[t]):s[t],r=i&&!Object.keys(n).length;return n===void 0||r?e:Object.assign(e,{[t]:n})},{}):s}function iD(s,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?iD(s,s.get(e[i]),t):i.endsWith("Ids")&&e[i].forEach(n=>{iD(s,s.get(n),t)})}))}function v4(s,e,t){const i=t?"outbound-rtp":"inbound-rtp",n=new Map;if(e===null)return n;const r=[];return s.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&r.push(o)}),r.forEach(o=>{s.forEach(a=>{a.type===i&&a.trackId===o.id&&iD(s,a,n)})}),n}const A4=Pk;function $W(s,e){const t=s&&s.navigator;if(!t.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const h=typeof a[c]=="object"?a[c]:{ideal:a[c]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const u=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(h.ideal!==void 0){l.optional=l.optional||[];let f={};typeof h.ideal=="number"?(f[u("min",c)]=h.ideal,l.optional.push(f),f={},f[u("max",c)]=h.ideal,l.optional.push(f)):(f[u("",c)]=h.ideal,l.optional.push(f))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[u("",c)]=h.exact):["min","max"].forEach(f=>{h[f]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[u(f,c)]=h[f])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},n=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(h,u,f){u in h&&!(f in h)&&(h[f]=h[u],delete h[u])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const h=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete a.video.facingMode;let u;if(c.exact==="environment"||c.ideal==="environment"?u=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(u=["front"]),u)return t.mediaDevices.enumerateDevices().then(f=>{f=f.filter(m=>m.kind==="videoinput");let p=f.find(m=>u.some(v=>m.label.toLowerCase().includes(v)));return!p&&f.length&&u.includes("back")&&(p=f[f.length-1]),p&&(a.video.deviceId=c.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),A4("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return A4("chrome: "+JSON.stringify(a)),l(a)},r=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,c){n(a,h=>{t.webkitGetUserMedia(h,l,u=>{c&&c(r(u))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(l){return n(l,c=>a(c).then(h=>{if(c.audio&&!h.getAudioTracks().length||c.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return h},h=>Promise.reject(r(h))))}}}function rde(s,e){if(!(s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices)&&s.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}s.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(n=>{const r=i.video&&i.video.width,o=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:a||3}},r&&(i.video.mandatory.maxWidth=r),o&&(i.video.mandatory.maxHeight=o),s.navigator.mediaDevices.getUserMedia(i)})}}}function ej(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function tj(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",n=>{let r;s.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===n.track.id):r={track:n.track};const o=new Event("track");o.track=n.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(n=>{let r;s.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===n.id):r={track:n};const o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Tv(s,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function ij(s){if(typeof s=="object"&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const e=function(n,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=n.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:n}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(a,l){let c=n.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const r=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],t.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof s=="object"&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const e=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(n=>n._pc=this),i},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function nj(s){if(!s.RTCPeerConnection)return;const e=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[i,n,r]=arguments;if(arguments.length>0&&typeof i=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof i!="function"))return e.apply(this,[]);const o=function(l){const c={};return l.result().forEach(u=>{const f={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(p=>{f[p]=u.stat(p)}),c[f.id]=f}),c},a=function(l){return new Map(Object.keys(l).map(c=>[c,l[c]]))};if(arguments.length>=2){const l=function(c){n(a(o(c)))};return e.apply(this,[l,i])}return new Promise((l,c)=>{e.apply(this,[function(h){l(a(o(h)))},c])}).then(n,r)}}function sj(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const t=s.RTCPeerConnection.prototype.getSenders;t&&(s.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=s.RTCPeerConnection.prototype.addTrack;i&&(s.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),s.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>v4(o,r.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const t=s.RTCPeerConnection.prototype.getReceivers;t&&(s.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Tv(s,"track",i=>(i.receiver._pc=i.srcElement,i)),s.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(r=>v4(r,n.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype&&"getStats"in s.RTCRtpReceiver.prototype))return;const e=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const i=arguments[0];let n,r,o;return this.getSenders().forEach(a=>{a.track===i&&(n?o=!0:n=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||n&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function rj(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const t=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(u=>u.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const n=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),n.apply(this,arguments)}}function oj(s,e){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&e.version>=65)return rj(s);const t=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const h=t.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(u=>this._reverseStreams[u.id])};const i=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(u=>{if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const u=new s.MediaStream(h.getTracks());this._streams[h.id]=u,this._reverseStreams[u.id]=h,h=u}i.apply(this,[h])};const n=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},s.RTCPeerConnection.prototype.addTrack=function(h,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(v=>v===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[u.id];if(m)m.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new s.MediaStream([h]);this._streams[u.id]=v,this._reverseStreams[v.id]=u,this.addStream(v)}return this.getSenders().find(v=>v.track===h)};function r(c,h){let u=h.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const p=c._reverseStreams[f],m=c._streams[p.id];u=u.replace(new RegExp(m.id,"g"),p.id)}),new RTCSessionDescription({type:h.type,sdp:u})}function o(c,h){let u=h.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const p=c._reverseStreams[f],m=c._streams[p.id];u=u.replace(new RegExp(p.id,"g"),m.id)}),new RTCSessionDescription({type:h.type,sdp:u})}["createOffer","createAnswer"].forEach(function(c){const h=s.RTCPeerConnection.prototype[c],u={[c](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[m=>{const v=r(this,m);f[0].apply(null,[v])},m=>{f[1]&&f[1].apply(null,m)},arguments[2]]):h.apply(this,arguments).then(m=>r(this,m))}};s.RTCPeerConnection.prototype[c]=u[c]});const a=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:r(this,c)}}),s.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(h._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(v=>h.track===v)&&(f=this._streams[p])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function nD(s,e){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=s.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new(t==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};s.RTCPeerConnection.prototype[t]=n[t]})}function aj(s,e){Tv(s,"negotiationneeded",t=>{const i=t.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return t})}const _4=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:aj,shimAddTrackRemoveTrack:oj,shimAddTrackRemoveTrackWithNative:rj,shimGetDisplayMedia:rde,shimGetSendersWithDtmf:ij,shimGetStats:nj,shimGetUserMedia:$W,shimMediaStream:ej,shimOnTrack:tj,shimPeerConnection:nD,shimSenderReceiverGetStats:sj},Symbol.toStringTag,{value:"Module"}));function ode(s,e){let t=!1;return s=JSON.parse(JSON.stringify(s)),s.filter(i=>{if(i&&(i.urls||i.url)){let n=i.urls||i.url;i.url&&!i.urls&&jM("RTCIceServer.url","RTCIceServer.urls");const r=typeof n=="string";return r&&(n=[n]),n=n.filter(o=>{if(o.indexOf("stun:")===0)return!1;const a=o.startsWith("turn")&&!o.startsWith("turn:[")&&o.includes("transport=udp");return a&&!t?(t=!0,!0):a&&!t}),delete i.url,i.urls=r?n[0]:n,!!n.length}})}var lj={exports:{}};(function(s){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(function(i){return i.trim()})},e.splitSections=function(t){var i=t.split(`
m=`);return i.map(function(n,r){return(r>0?"m="+n:n).trim()+`\r
`})},e.getDescription=function(t){var i=e.splitSections(t);return i&&i[0]},e.getMediaSections=function(t){var i=e.splitSections(t);return i.shift(),i},e.matchPrefix=function(t,i){return e.splitLines(t).filter(function(n){return n.indexOf(i)===0})},e.parseCandidate=function(t){var i;t.indexOf("a=candidate:")===0?i=t.substring(12).split(" "):i=t.substring(10).split(" ");for(var n={foundation:i[0],component:parseInt(i[1],10),protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]},r=8;r<i.length;r+=2)switch(i[r]){case"raddr":n.relatedAddress=i[r+1];break;case"rport":n.relatedPort=parseInt(i[r+1],10);break;case"tcptype":n.tcpType=i[r+1];break;case"ufrag":n.ufrag=i[r+1],n.usernameFragment=i[r+1];break;default:n[i[r]]=i[r+1];break}return n},e.writeCandidate=function(t){var i=[];i.push(t.foundation),i.push(t.component),i.push(t.protocol.toUpperCase()),i.push(t.priority),i.push(t.address||t.ip),i.push(t.port);var n=t.type;return i.push("typ"),i.push(n),n!=="host"&&t.relatedAddress&&t.relatedPort&&(i.push("raddr"),i.push(t.relatedAddress),i.push("rport"),i.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(i.push("ufrag"),i.push(t.usernameFragment||t.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(t){return t.substr(14).split(" ")},e.parseRtpMap=function(t){var i=t.substr(9).split(" "),n={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),n.name=i[0],n.clockRate=parseInt(i[1],10),n.channels=i.length===3?parseInt(i[2],10):1,n.numChannels=n.channels,n},e.writeRtpMap=function(t){var i=t.payloadType;t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType);var n=t.channels||t.numChannels||1;return"a=rtpmap:"+i+" "+t.name+"/"+t.clockRate+(n!==1?"/"+n:"")+`\r
`},e.parseExtmap=function(t){var i=t.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`},e.parseFmtp=function(t){for(var i={},n,r=t.substr(t.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)n=r[o].trim().split("="),i[n[0].trim()]=n[1];return i},e.writeFmtp=function(t){var i="",n=t.payloadType;if(t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var r=[];Object.keys(t.parameters).forEach(function(o){t.parameters[o]?r.push(o+"="+t.parameters[o]):r.push(o)}),i+="a=fmtp:"+n+" "+r.join(";")+`\r
`}return i},e.parseRtcpFb=function(t){var i=t.substr(t.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(t){var i="",n=t.payloadType;return t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(r){i+="a=rtcp-fb:"+n+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(t){var i=t.indexOf(" "),n={ssrc:parseInt(t.substr(7,i-7),10)},r=t.indexOf(":",i);return r>-1?(n.attribute=t.substr(i+1,r-i-1),n.value=t.substr(r+1)):n.attribute=t.substr(i+1),n},e.parseSsrcGroup=function(t){var i=t.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(function(n){return parseInt(n,10)})}},e.getMid=function(t){var i=e.matchPrefix(t,"a=mid:")[0];if(i)return i.substr(6)},e.parseFingerprint=function(t){var i=t.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1]}},e.getDtlsParameters=function(t,i){var n=e.matchPrefix(t+i,"a=fingerprint:");return{role:"auto",fingerprints:n.map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,i){var n="a=setup:"+i+`\r
`;return t.fingerprints.forEach(function(r){n+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),n},e.parseCryptoLine=function(t){var i=t.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;var i=t.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,i){var n=e.matchPrefix(t+i,"a=crypto:");return n.map(e.parseCryptoLine)},e.getIceParameters=function(t,i){var n=e.matchPrefix(t+i,"a=ice-ufrag:")[0],r=e.matchPrefix(t+i,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substr(12),password:r.substr(10)}:null},e.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`},e.parseRtpParameters=function(t){for(var i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=e.splitLines(t),r=n[0].split(" "),o=3;o<r.length;o++){var a=r[o],l=e.matchPrefix(t,"a=rtpmap:"+a+" ")[0];if(l){var c=e.parseRtpMap(l),h=e.matchPrefix(t,"a=fmtp:"+a+" ");switch(c.parameters=h.length?e.parseFmtp(h[0]):{},c.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+a+" ").map(e.parseRtcpFb),i.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(c.name.toUpperCase());break}}}return e.matchPrefix(t,"a=extmap:").forEach(function(u){i.headerExtensions.push(e.parseExtmap(u))}),i},e.writeRtpDescription=function(t,i){var n="";n+="m="+t+" ",n+=i.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=i.codecs.map(function(o){return o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType}).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(function(o){n+=e.writeRtpMap(o),n+=e.writeFmtp(o),n+=e.writeRtcpFb(o)});var r=0;return i.codecs.forEach(function(o){o.maxptime>r&&(r=o.maxptime)}),r>0&&(n+="a=maxptime:"+r+`\r
`),n+=`a=rtcp-mux\r
`,i.headerExtensions&&i.headerExtensions.forEach(function(o){n+=e.writeExtmap(o)}),n},e.parseRtpEncodingParameters=function(t){var i=[],n=e.parseRtpParameters(t),r=n.fecMechanisms.indexOf("RED")!==-1,o=n.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(function(f){return e.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),l=a.length>0&&a[0].ssrc,c,h=e.matchPrefix(t,"a=ssrc-group:FID").map(function(f){var p=f.substr(17).split(" ");return p.map(function(m){return parseInt(m,10)})});h.length>0&&h[0].length>1&&h[0][0]===l&&(c=h[0][1]),n.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var p={ssrc:l,codecPayloadType:parseInt(f.parameters.apt,10)};l&&c&&(p.rtx={ssrc:c}),i.push(p),r&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&l&&i.push({ssrc:l});var u=e.matchPrefix(t,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substr(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substr(5),10)*1e3*.95-50*40*8:u=void 0,i.forEach(function(f){f.maxBitrate=u})),i},e.parseRtcpParameters=function(t){var i={},n=e.matchPrefix(t,"a=ssrc:").map(function(a){return e.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];n&&(i.cname=n.value,i.ssrc=n.ssrc);var r=e.matchPrefix(t,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;var o=e.matchPrefix(t,"a=rtcp-mux");return i.mux=o.length>0,i},e.parseMsid=function(t){var i,n=e.matchPrefix(t,"a=msid:");if(n.length===1)return i=n[0].substr(7).split(" "),{stream:i[0],track:i[1]};var r=e.matchPrefix(t,"a=ssrc:").map(function(o){return e.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="msid"});if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(t){var i=e.parseMLine(t),n=e.matchPrefix(t,"a=max-message-size:"),r;n.length>0&&(r=parseInt(n[0].substr(19),10)),isNaN(r)&&(r=65536);var o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:r};var a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){var l=e.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},e.writeSctpDescription=function(t,i){var n=[];return t.protocol!=="DTLS/SCTP"?n=["m="+t.kind+" 9 "+t.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:n=["m="+t.kind+" 9 "+t.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&n.push("a=max-message-size:"+i.maxMessageSize+`\r
`),n.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(t,i,n){var r,o=i!==void 0?i:2;t?r=t:r=e.generateSessionId();var a=n||"thisisadapterortc";return`v=0\r
o=`+a+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(t,i,n,r){var o=e.writeRtpDescription(t.kind,i);if(o+=e.writeIceParameters(t.iceGatherer.getLocalParameters()),o+=e.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":"active"),o+="a=mid:"+t.mid+`\r
`,t.direction?o+="a="+t.direction+`\r
`:t.rtpSender&&t.rtpReceiver?o+=`a=sendrecv\r
`:t.rtpSender?o+=`a=sendonly\r
`:t.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,t.rtpSender){var a="msid:"+r.id+" "+t.rtpSender.track.id+`\r
`;o+="a="+a,o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+a,t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),o},e.getDirection=function(t,i){for(var n=e.splitLines(t),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(t){var i=e.splitLines(t),n=i[0].split(" ");return n[0].substr(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){var i=e.splitLines(t),n=i[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},e.parseOLine=function(t){var i=e.matchPrefix(t,"o=")[0],n=i.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;for(var i=e.splitLines(t),n=0;n<i.length;n++)if(i[n].length<2||i[n].charAt(1)!=="=")return!1;return!0},s.exports=e})(lj);var cj=lj.exports;const n1=WM(cj);var Gt=cj;function ade(s){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[s.type]||s.type}function b4(s,e,t,i,n){var r=Gt.writeRtpDescription(s.kind,e);if(r+=Gt.writeIceParameters(s.iceGatherer.getLocalParameters()),r+=Gt.writeDtlsParameters(s.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":n||"active"),r+="a=mid:"+s.mid+`\r
`,s.rtpSender&&s.rtpReceiver?r+=`a=sendrecv\r
`:s.rtpSender?r+=`a=sendonly\r
`:s.rtpReceiver?r+=`a=recvonly\r
`:r+=`a=inactive\r
`,s.rtpSender){var o=s.rtpSender._initialTrackId||s.rtpSender.track.id;s.rtpSender._initialTrackId=o;var a="msid:"+(i?i.id:"-")+" "+o+`\r
`;r+="a="+a,r+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" "+a,s.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" "+a,r+="a=ssrc-group:FID "+s.sendEncodingParameters[0].ssrc+" "+s.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return r+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" cname:"+Gt.localCName+`\r
`,s.rtpSender&&s.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" cname:"+Gt.localCName+`\r
`),r}function lde(s,e){var t=!1;return s=JSON.parse(JSON.stringify(s)),s.filter(function(i){if(i&&(i.urls||i.url)){var n=i.urls||i.url;i.url&&!i.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r=typeof n=="string";return r&&(n=[n]),n=n.filter(function(o){var a=o.indexOf("turn:")===0&&o.indexOf("transport=udp")!==-1&&o.indexOf("turn:[")===-1&&!t;return a?(t=!0,!0):o.indexOf("stun:")===0&&e>=14393&&o.indexOf("?transport=udp")===-1}),delete i.url,i.urls=r?n[0]:n,!!n.length}})}function _S(s,e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(r,o){r=parseInt(r,10);for(var a=0;a<o.length;a++)if(o[a].payloadType===r||o[a].preferredPayloadType===r)return o[a]},n=function(r,o,a,l){var c=i(r.parameters.apt,a),h=i(o.parameters.apt,l);return c&&h&&c.name.toLowerCase()===h.name.toLowerCase()};return s.codecs.forEach(function(r){for(var o=0;o<e.codecs.length;o++){var a=e.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&a.parameters.apt&&!n(r,a,s.codecs,e.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),t.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(l){for(var c=0;c<r.rtcpFeedback.length;c++)if(r.rtcpFeedback[c].type===l.type&&r.rtcpFeedback[c].parameter===l.parameter)return!0;return!1});break}}}),s.headerExtensions.forEach(function(r){for(var o=0;o<e.headerExtensions.length;o++){var a=e.headerExtensions[o];if(r.uri===a.uri){t.headerExtensions.push(a);break}}}),t}function x4(s,e,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][s].indexOf(t)!==-1}function VR(s,e){var t=s.getRemoteCandidates().find(function(i){return e.foundation===i.foundation&&e.ip===i.ip&&e.port===i.port&&e.priority===i.priority&&e.protocol===i.protocol&&e.type===i.type});return t||s.addRemoteCandidate(e),!t}function Br(s,e){var t=new Error(e);return t.name=s,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[s],t}var cde=function(s,e){function t(l,c){c.addTrack(l),c.dispatchEvent(new s.MediaStreamTrackEvent("addtrack",{track:l}))}function i(l,c){c.removeTrack(l),c.dispatchEvent(new s.MediaStreamTrackEvent("removetrack",{track:l}))}function n(l,c,h,u){var f=new Event("track");f.track=c,f.receiver=h,f.transceiver={receiver:h},f.streams=u,s.setTimeout(function(){l._dispatchEvent("track",f)})}var r=function(l){var c=this,h=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(f){c[f]=h[f].bind(h)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",l=JSON.parse(JSON.stringify(l||{})),this.usingBundle=l.bundlePolicy==="max-bundle",l.rtcpMuxPolicy==="negotiate")throw Br("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(l.rtcpMuxPolicy||(l.rtcpMuxPolicy="require"),l.iceTransportPolicy){case"all":case"relay":break;default:l.iceTransportPolicy="all";break}switch(l.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:l.bundlePolicy="balanced";break}if(l.iceServers=lde(l.iceServers||[],e),this._iceGatherers=[],l.iceCandidatePoolSize)for(var u=l.iceCandidatePoolSize;u>0;u--)this._iceGatherers.push(new s.RTCIceGatherer({iceServers:l.iceServers,gatherPolicy:l.iceTransportPolicy}));else l.iceCandidatePoolSize=0;this._config=l,this.transceivers=[],this._sdpSessionId=Gt.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(l,c){this._isClosed||(this.dispatchEvent(c),typeof this["on"+l]=="function"&&this["on"+l](c))},r.prototype._emitGatheringStateChange=function(){var l=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",l)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(l,c){var h=this.transceivers.length>0,u={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:l,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&h)u.iceTransport=this.transceivers[0].iceTransport,u.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();u.iceTransport=f.iceTransport,u.dtlsTransport=f.dtlsTransport}return c||this.transceivers.push(u),u},r.prototype.addTrack=function(l,c){if(this._isClosed)throw Br("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var h=this.transceivers.find(function(p){return p.track===l});if(h)throw Br("InvalidAccessError","Track already exists.");for(var u,f=0;f<this.transceivers.length;f++)!this.transceivers[f].track&&this.transceivers[f].kind===l.kind&&(u=this.transceivers[f]);return u||(u=this._createTransceiver(l.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(c)===-1&&this.localStreams.push(c),u.track=l,u.stream=c,u.rtpSender=new s.RTCRtpSender(l,u.dtlsTransport),u.rtpSender},r.prototype.addStream=function(l){var c=this;if(e>=15025)l.getTracks().forEach(function(u){c.addTrack(u,l)});else{var h=l.clone();l.getTracks().forEach(function(u,f){var p=h.getTracks()[f];u.addEventListener("enabled",function(m){p.enabled=m.enabled})}),h.getTracks().forEach(function(u){c.addTrack(u,h)})}},r.prototype.removeTrack=function(l){if(this._isClosed)throw Br("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(l instanceof s.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(f){return f.rtpSender===l});if(!c)throw Br("InvalidAccessError","Sender was not created by this connection.");var h=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null;var u=this.transceivers.map(function(f){return f.stream});u.indexOf(h)===-1&&this.localStreams.indexOf(h)>-1&&this.localStreams.splice(this.localStreams.indexOf(h),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(l){var c=this;l.getTracks().forEach(function(h){var u=c.getSenders().find(function(f){return f.track===h});u&&c.removeTrack(u)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(l){return!!l.rtpSender}).map(function(l){return l.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(l){return!!l.rtpReceiver}).map(function(l){return l.rtpReceiver})},r.prototype._createIceGatherer=function(l,c){var h=this;if(c&&l>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var u=new s.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(u,"state",{value:"new",writable:!0}),this.transceivers[l].bufferedCandidateEvents=[],this.transceivers[l].bufferCandidates=function(f){var p=!f.candidate||Object.keys(f.candidate).length===0;u.state=p?"completed":"gathering",h.transceivers[l].bufferedCandidateEvents!==null&&h.transceivers[l].bufferedCandidateEvents.push(f)},u.addEventListener("localcandidate",this.transceivers[l].bufferCandidates),u},r.prototype._gather=function(l,c){var h=this,u=this.transceivers[c].iceGatherer;if(!u.onlocalcandidate){var f=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,u.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),u.onlocalcandidate=function(p){if(!(h.usingBundle&&c>0)){var m=new Event("icecandidate");m.candidate={sdpMid:l,sdpMLineIndex:c};var v=p.candidate,g=!v||Object.keys(v).length===0;if(g)(u.state==="new"||u.state==="gathering")&&(u.state="completed");else{u.state==="new"&&(u.state="gathering"),v.component=1,v.ufrag=u.getLocalParameters().usernameFragment;var y=Gt.writeCandidate(v);m.candidate=Object.assign(m.candidate,Gt.parseCandidate(y)),m.candidate.candidate=y,m.candidate.toJSON=function(){return{candidate:m.candidate.candidate,sdpMid:m.candidate.sdpMid,sdpMLineIndex:m.candidate.sdpMLineIndex,usernameFragment:m.candidate.usernameFragment}}}var A=Gt.getMediaSections(h._localDescription.sdp);g?A[m.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:A[m.candidate.sdpMLineIndex]+="a="+m.candidate.candidate+`\r
`,h._localDescription.sdp=Gt.getDescription(h._localDescription.sdp)+A.join("");var _=h.transceivers.every(function(b){return b.iceGatherer&&b.iceGatherer.state==="completed"});h.iceGatheringState!=="gathering"&&(h.iceGatheringState="gathering",h._emitGatheringStateChange()),g||h._dispatchEvent("icecandidate",m),_&&(h._dispatchEvent("icecandidate",new Event("icecandidate")),h.iceGatheringState="complete",h._emitGatheringStateChange())}},s.setTimeout(function(){f.forEach(function(p){u.onlocalcandidate(p)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var l=this,c=new s.RTCIceTransport(null);c.onicestatechange=function(){l._updateIceConnectionState(),l._updateConnectionState()};var h=new s.RTCDtlsTransport(c);return h.ondtlsstatechange=function(){l._updateConnectionState()},h.onerror=function(){Object.defineProperty(h,"state",{value:"failed",writable:!0}),l._updateConnectionState()},{iceTransport:c,dtlsTransport:h}},r.prototype._disposeIceAndDtlsTransports=function(l){var c=this.transceivers[l].iceGatherer;c&&(delete c.onlocalcandidate,delete this.transceivers[l].iceGatherer);var h=this.transceivers[l].iceTransport;h&&(delete h.onicestatechange,delete this.transceivers[l].iceTransport);var u=this.transceivers[l].dtlsTransport;u&&(delete u.ondtlsstatechange,delete u.onerror,delete this.transceivers[l].dtlsTransport)},r.prototype._transceive=function(l,c,h){var u=_S(l.localCapabilities,l.remoteCapabilities);c&&l.rtpSender&&(u.encodings=l.sendEncodingParameters,u.rtcp={cname:Gt.localCName,compound:l.rtcpParameters.compound},l.recvEncodingParameters.length&&(u.rtcp.ssrc=l.recvEncodingParameters[0].ssrc),l.rtpSender.send(u)),h&&l.rtpReceiver&&u.codecs.length>0&&(l.kind==="video"&&l.recvEncodingParameters&&e<15019&&l.recvEncodingParameters.forEach(function(f){delete f.rtx}),l.recvEncodingParameters.length?u.encodings=l.recvEncodingParameters:u.encodings=[{}],u.rtcp={compound:l.rtcpParameters.compound},l.rtcpParameters.cname&&(u.rtcp.cname=l.rtcpParameters.cname),l.sendEncodingParameters.length&&(u.rtcp.ssrc=l.sendEncodingParameters[0].ssrc),l.rtpReceiver.receive(u))},r.prototype.setLocalDescription=function(l){var c=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(Br("TypeError",'Unsupported type "'+l.type+'"'));if(!x4("setLocalDescription",l.type,c.signalingState)||c._isClosed)return Promise.reject(Br("InvalidStateError","Can not set local "+l.type+" in state "+c.signalingState));var h,u;if(l.type==="offer")h=Gt.splitSections(l.sdp),u=h.shift(),h.forEach(function(p,m){var v=Gt.parseRtpParameters(p);c.transceivers[m].localCapabilities=v}),c.transceivers.forEach(function(p,m){c._gather(p.mid,m)});else if(l.type==="answer"){h=Gt.splitSections(c._remoteDescription.sdp),u=h.shift();var f=Gt.matchPrefix(u,"a=ice-lite").length>0;h.forEach(function(p,m){var v=c.transceivers[m],g=v.iceGatherer,y=v.iceTransport,A=v.dtlsTransport,_=v.localCapabilities,b=v.remoteCapabilities,x=Gt.isRejected(p)&&Gt.matchPrefix(p,"a=bundle-only").length===0;if(!x&&!v.rejected){var E=Gt.getIceParameters(p,u),M=Gt.getDtlsParameters(p,u);f&&(M.role="server"),(!c.usingBundle||m===0)&&(c._gather(v.mid,m),y.state==="new"&&y.start(g,E,f?"controlling":"controlled"),A.state==="new"&&A.start(M));var T=_S(_,b);c._transceive(v,T.codecs.length>0,!1)}})}return c._localDescription={type:l.type,sdp:l.sdp},l.type==="offer"?c._updateSignalingState("have-local-offer"):c._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(l){var c=this;if(["offer","answer"].indexOf(l.type)===-1)return Promise.reject(Br("TypeError",'Unsupported type "'+l.type+'"'));if(!x4("setRemoteDescription",l.type,c.signalingState)||c._isClosed)return Promise.reject(Br("InvalidStateError","Can not set remote "+l.type+" in state "+c.signalingState));var h={};c.remoteStreams.forEach(function(y){h[y.id]=y});var u=[],f=Gt.splitSections(l.sdp),p=f.shift(),m=Gt.matchPrefix(p,"a=ice-lite").length>0,v=Gt.matchPrefix(p,"a=group:BUNDLE ").length>0;c.usingBundle=v;var g=Gt.matchPrefix(p,"a=ice-options:")[0];return g?c.canTrickleIceCandidates=g.substr(14).split(" ").indexOf("trickle")>=0:c.canTrickleIceCandidates=!1,f.forEach(function(y,A){var _=Gt.splitLines(y),b=Gt.getKind(y),x=Gt.isRejected(y)&&Gt.matchPrefix(y,"a=bundle-only").length===0,E=_[0].substr(2).split(" ")[2],M=Gt.getDirection(y,p),T=Gt.parseMsid(y),R=Gt.getMid(y)||Gt.generateIdentifier();if(x||b==="application"&&(E==="DTLS/SCTP"||E==="UDP/DTLS/SCTP")){c.transceivers[A]={mid:R,kind:b,protocol:E,rejected:!0};return}!x&&c.transceivers[A]&&c.transceivers[A].rejected&&(c.transceivers[A]=c._createTransceiver(b,!0));var w,I,O,k,B,G,L,U,z,j=Gt.parseRtpParameters(y),X,re;x||(X=Gt.getIceParameters(y,p),re=Gt.getDtlsParameters(y,p),re.role="client"),L=Gt.parseRtpEncodingParameters(y);var ce=Gt.parseRtcpParameters(y),Me=Gt.matchPrefix(y,"a=end-of-candidates",p).length>0,se=Gt.matchPrefix(y,"a=candidate:").map(function(je){return Gt.parseCandidate(je)}).filter(function(je){return je.component===1});if((l.type==="offer"||l.type==="answer")&&!x&&v&&A>0&&c.transceivers[A]&&(c._disposeIceAndDtlsTransports(A),c.transceivers[A].iceGatherer=c.transceivers[0].iceGatherer,c.transceivers[A].iceTransport=c.transceivers[0].iceTransport,c.transceivers[A].dtlsTransport=c.transceivers[0].dtlsTransport,c.transceivers[A].rtpSender&&c.transceivers[A].rtpSender.setTransport(c.transceivers[0].dtlsTransport),c.transceivers[A].rtpReceiver&&c.transceivers[A].rtpReceiver.setTransport(c.transceivers[0].dtlsTransport)),l.type==="offer"&&!x){w=c.transceivers[A]||c._createTransceiver(b),w.mid=R,w.iceGatherer||(w.iceGatherer=c._createIceGatherer(A,v)),se.length&&w.iceTransport.state==="new"&&(Me&&(!v||A===0)?w.iceTransport.setRemoteCandidates(se):se.forEach(function(je){VR(w.iceTransport,je)})),U=s.RTCRtpReceiver.getCapabilities(b),e<15019&&(U.codecs=U.codecs.filter(function(je){return je.name!=="rtx"})),G=w.sendEncodingParameters||[{ssrc:(2*A+2)*1001}];var ve=!1;if(M==="sendrecv"||M==="sendonly"){if(ve=!w.rtpReceiver,B=w.rtpReceiver||new s.RTCRtpReceiver(w.dtlsTransport,b),ve){var xe;z=B.track,T&&T.stream==="-"||(T?(h[T.stream]||(h[T.stream]=new s.MediaStream,Object.defineProperty(h[T.stream],"id",{get:function(){return T.stream}})),Object.defineProperty(z,"id",{get:function(){return T.track}}),xe=h[T.stream]):(h.default||(h.default=new s.MediaStream),xe=h.default)),xe&&(t(z,xe),w.associatedRemoteMediaStreams.push(xe)),u.push([z,B,xe])}}else w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach(function(je){var lt=je.getTracks().find(function(ot){return ot.id===w.rtpReceiver.track.id});lt&&i(lt,je)}),w.associatedRemoteMediaStreams=[]);w.localCapabilities=U,w.remoteCapabilities=j,w.rtpReceiver=B,w.rtcpParameters=ce,w.sendEncodingParameters=G,w.recvEncodingParameters=L,c._transceive(c.transceivers[A],!1,ve)}else if(l.type==="answer"&&!x){w=c.transceivers[A],I=w.iceGatherer,O=w.iceTransport,k=w.dtlsTransport,B=w.rtpReceiver,G=w.sendEncodingParameters,U=w.localCapabilities,c.transceivers[A].recvEncodingParameters=L,c.transceivers[A].remoteCapabilities=j,c.transceivers[A].rtcpParameters=ce,se.length&&O.state==="new"&&((m||Me)&&(!v||A===0)?O.setRemoteCandidates(se):se.forEach(function(je){VR(w.iceTransport,je)})),(!v||A===0)&&(O.state==="new"&&O.start(I,X,"controlling"),k.state==="new"&&k.start(re));var Fe=_S(w.localCapabilities,w.remoteCapabilities),Ge=Fe.codecs.filter(function(je){return je.name.toLowerCase()==="rtx"}).length;!Ge&&w.sendEncodingParameters[0].rtx&&delete w.sendEncodingParameters[0].rtx,c._transceive(w,M==="sendrecv"||M==="recvonly",M==="sendrecv"||M==="sendonly"),B&&(M==="sendrecv"||M==="sendonly")?(z=B.track,T?(h[T.stream]||(h[T.stream]=new s.MediaStream),t(z,h[T.stream]),u.push([z,B,h[T.stream]])):(h.default||(h.default=new s.MediaStream),t(z,h.default),u.push([z,B,h.default]))):delete w.rtpReceiver}}),c._dtlsRole===void 0&&(c._dtlsRole=l.type==="offer"?"active":"passive"),c._remoteDescription={type:l.type,sdp:l.sdp},l.type==="offer"?c._updateSignalingState("have-remote-offer"):c._updateSignalingState("stable"),Object.keys(h).forEach(function(y){var A=h[y];if(A.getTracks().length){if(c.remoteStreams.indexOf(A)===-1){c.remoteStreams.push(A);var _=new Event("addstream");_.stream=A,s.setTimeout(function(){c._dispatchEvent("addstream",_)})}u.forEach(function(b){var x=b[0],E=b[1];A.id===b[2].id&&n(c,x,E,[A])})}}),u.forEach(function(y){y[2]||n(c,y[0],y[1],[])}),s.setTimeout(function(){c&&c.transceivers&&c.transceivers.forEach(function(y){y.iceTransport&&y.iceTransport.state==="new"&&y.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),y.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(l){l.iceTransport&&l.iceTransport.stop(),l.dtlsTransport&&l.dtlsTransport.stop(),l.rtpSender&&l.rtpSender.stop(),l.rtpReceiver&&l.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(l){this.signalingState=l;var c=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",c)},r.prototype._maybeFireNegotiationNeeded=function(){var l=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,s.setTimeout(function(){if(l.needNegotiation){l.needNegotiation=!1;var c=new Event("negotiationneeded");l._dispatchEvent("negotiationneeded",c)}},0))},r.prototype._updateIceConnectionState=function(){var l,c={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(u){u.iceTransport&&!u.rejected&&c[u.iceTransport.state]++}),l="new",c.failed>0?l="failed":c.checking>0?l="checking":c.disconnected>0?l="disconnected":c.new>0?l="new":c.connected>0?l="connected":c.completed>0&&(l="completed"),l!==this.iceConnectionState){this.iceConnectionState=l;var h=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",h)}},r.prototype._updateConnectionState=function(){var l,c={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(u){u.iceTransport&&u.dtlsTransport&&!u.rejected&&(c[u.iceTransport.state]++,c[u.dtlsTransport.state]++)}),c.connected+=c.completed,l="new",c.failed>0?l="failed":c.connecting>0?l="connecting":c.disconnected>0?l="disconnected":c.new>0?l="new":c.connected>0&&(l="connected"),l!==this.connectionState){this.connectionState=l;var h=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",h)}},r.prototype.createOffer=function(){var l=this;if(l._isClosed)return Promise.reject(Br("InvalidStateError","Can not call createOffer after close"));var c=l.transceivers.filter(function(m){return m.kind==="audio"}).length,h=l.transceivers.filter(function(m){return m.kind==="video"}).length,u=arguments[0];if(u){if(u.mandatory||u.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");u.offerToReceiveAudio!==void 0&&(u.offerToReceiveAudio===!0?c=1:u.offerToReceiveAudio===!1?c=0:c=u.offerToReceiveAudio),u.offerToReceiveVideo!==void 0&&(u.offerToReceiveVideo===!0?h=1:u.offerToReceiveVideo===!1?h=0:h=u.offerToReceiveVideo)}for(l.transceivers.forEach(function(m){m.kind==="audio"?(c--,c<0&&(m.wantReceive=!1)):m.kind==="video"&&(h--,h<0&&(m.wantReceive=!1))});c>0||h>0;)c>0&&(l._createTransceiver("audio"),c--),h>0&&(l._createTransceiver("video"),h--);var f=Gt.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.transceivers.forEach(function(m,v){var g=m.track,y=m.kind,A=m.mid||Gt.generateIdentifier();m.mid=A,m.iceGatherer||(m.iceGatherer=l._createIceGatherer(v,l.usingBundle));var _=s.RTCRtpSender.getCapabilities(y);e<15019&&(_.codecs=_.codecs.filter(function(x){return x.name!=="rtx"})),_.codecs.forEach(function(x){x.name==="H264"&&x.parameters["level-asymmetry-allowed"]===void 0&&(x.parameters["level-asymmetry-allowed"]="1"),m.remoteCapabilities&&m.remoteCapabilities.codecs&&m.remoteCapabilities.codecs.forEach(function(E){x.name.toLowerCase()===E.name.toLowerCase()&&x.clockRate===E.clockRate&&(x.preferredPayloadType=E.payloadType)})}),_.headerExtensions.forEach(function(x){var E=m.remoteCapabilities&&m.remoteCapabilities.headerExtensions||[];E.forEach(function(M){x.uri===M.uri&&(x.id=M.id)})});var b=m.sendEncodingParameters||[{ssrc:(2*v+1)*1001}];g&&e>=15019&&y==="video"&&!b[0].rtx&&(b[0].rtx={ssrc:b[0].ssrc+1}),m.wantReceive&&(m.rtpReceiver=new s.RTCRtpReceiver(m.dtlsTransport,y)),m.localCapabilities=_,m.sendEncodingParameters=b}),l._config.bundlePolicy!=="max-compat"&&(f+="a=group:BUNDLE "+l.transceivers.map(function(m){return m.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`,l.transceivers.forEach(function(m,v){f+=b4(m,m.localCapabilities,"offer",m.stream,l._dtlsRole),f+=`a=rtcp-rsize\r
`,m.iceGatherer&&l.iceGatheringState!=="new"&&(v===0||!l.usingBundle)&&(m.iceGatherer.getLocalCandidates().forEach(function(g){g.component=1,f+="a="+Gt.writeCandidate(g)+`\r
`}),m.iceGatherer.state==="completed"&&(f+=`a=end-of-candidates\r
`))});var p=new s.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(p)},r.prototype.createAnswer=function(){var l=this;if(l._isClosed)return Promise.reject(Br("InvalidStateError","Can not call createAnswer after close"));if(!(l.signalingState==="have-remote-offer"||l.signalingState==="have-local-pranswer"))return Promise.reject(Br("InvalidStateError","Can not call createAnswer in signalingState "+l.signalingState));var c=Gt.writeSessionBoilerplate(l._sdpSessionId,l._sdpSessionVersion++);l.usingBundle&&(c+="a=group:BUNDLE "+l.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),c+=`a=ice-options:trickle\r
`;var h=Gt.getMediaSections(l._remoteDescription.sdp).length;l.transceivers.forEach(function(f,p){if(!(p+1>h)){if(f.rejected){f.kind==="application"?f.protocol==="DTLS/SCTP"?c+=`m=application 0 DTLS/SCTP 5000\r
`:c+="m=application 0 "+f.protocol+` webrtc-datachannel\r
`:f.kind==="audio"?c+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:f.kind==="video"&&(c+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),c+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+f.mid+`\r
`;return}if(f.stream){var m;f.kind==="audio"?m=f.stream.getAudioTracks()[0]:f.kind==="video"&&(m=f.stream.getVideoTracks()[0]),m&&e>=15019&&f.kind==="video"&&!f.sendEncodingParameters[0].rtx&&(f.sendEncodingParameters[0].rtx={ssrc:f.sendEncodingParameters[0].ssrc+1})}var v=_S(f.localCapabilities,f.remoteCapabilities),g=v.codecs.filter(function(y){return y.name.toLowerCase()==="rtx"}).length;!g&&f.sendEncodingParameters[0].rtx&&delete f.sendEncodingParameters[0].rtx,c+=b4(f,v,"answer",f.stream,l._dtlsRole),f.rtcpParameters&&f.rtcpParameters.reducedSize&&(c+=`a=rtcp-rsize\r
`)}});var u=new s.RTCSessionDescription({type:"answer",sdp:c});return Promise.resolve(u)},r.prototype.addIceCandidate=function(l){var c=this,h;return l&&!(l.sdpMLineIndex!==void 0||l.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(u,f){if(c._remoteDescription)if(!l||l.candidate==="")for(var p=0;p<c.transceivers.length&&!(!c.transceivers[p].rejected&&(c.transceivers[p].iceTransport.addRemoteCandidate({}),h=Gt.getMediaSections(c._remoteDescription.sdp),h[p]+=`a=end-of-candidates\r
`,c._remoteDescription.sdp=Gt.getDescription(c._remoteDescription.sdp)+h.join(""),c.usingBundle));p++);else{var m=l.sdpMLineIndex;if(l.sdpMid){for(var v=0;v<c.transceivers.length;v++)if(c.transceivers[v].mid===l.sdpMid){m=v;break}}var g=c.transceivers[m];if(g){if(g.rejected)return u();var y=Object.keys(l.candidate).length>0?Gt.parseCandidate(l.candidate):{};if(y.protocol==="tcp"&&(y.port===0||y.port===9)||y.component&&y.component!==1)return u();if((m===0||m>0&&g.iceTransport!==c.transceivers[0].iceTransport)&&!VR(g.iceTransport,y))return f(Br("OperationError","Can not add ICE candidate"));var A=l.candidate.trim();A.indexOf("a=")===0&&(A=A.substr(2)),h=Gt.getMediaSections(c._remoteDescription.sdp),h[m]+="a="+(y.type?A:"end-of-candidates")+`\r
`,c._remoteDescription.sdp=Gt.getDescription(c._remoteDescription.sdp)+h.join("")}else return f(Br("OperationError","Can not add ICE candidate"))}else return f(Br("InvalidStateError","Can not add ICE candidate without a remote description"));u()})},r.prototype.getStats=function(l){if(l&&l instanceof s.MediaStreamTrack){var c=null;if(this.transceivers.forEach(function(u){u.rtpSender&&u.rtpSender.track===l?c=u.rtpSender:u.rtpReceiver&&u.rtpReceiver.track===l&&(c=u.rtpReceiver)}),!c)throw Br("InvalidAccessError","Invalid selector.");return c.getStats()}var h=[];return this.transceivers.forEach(function(u){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){u[f]&&h.push(u[f].getStats())})}),Promise.all(h).then(function(u){var f=new Map;return u.forEach(function(p){p.forEach(function(m){f.set(m.id,m)})}),f})};var o=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];o.forEach(function(l){var c=s[l];if(c&&c.prototype&&c.prototype.getStats){var h=c.prototype.getStats;c.prototype.getStats=function(){return h.apply(this).then(function(u){var f=new Map;return Object.keys(u).forEach(function(p){u[p].type=ade(u[p]),f.set(p,u[p])}),f})}}});var a=["createOffer","createAnswer"];return a.forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var h=arguments;return typeof h[0]=="function"||typeof h[1]=="function"?c.apply(this,[arguments[2]]).then(function(u){typeof h[0]=="function"&&h[0].apply(null,[u])},function(u){typeof h[1]=="function"&&h[1].apply(null,[u])}):c.apply(this,arguments)}}),a=["setLocalDescription","setRemoteDescription","addIceCandidate"],a.forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var h=arguments;return typeof h[1]=="function"||typeof h[2]=="function"?c.apply(this,arguments).then(function(){typeof h[1]=="function"&&h[1].apply(null)},function(u){typeof h[2]=="function"&&h[2].apply(null,[u])}):c.apply(this,arguments)}}),["getStats"].forEach(function(l){var c=r.prototype[l];r.prototype[l]=function(){var h=arguments;return typeof h[1]=="function"?c.apply(this,arguments).then(function(){typeof h[1]=="function"&&h[1].apply(null)}):c.apply(this,arguments)}}),r};const hde=WM(cde);function hj(s){const e=s&&s.navigator,t=function(n){return{name:{PermissionDeniedError:"NotAllowedError"}[n.name]||n.name,message:n.message,constraint:n.constraint,toString(){return this.name}}},i=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(n){return i(n).catch(r=>Promise.reject(t(r)))}}function uj(s){"getDisplayMedia"in s.navigator&&s.navigator.mediaDevices&&(s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||(s.navigator.mediaDevices.getDisplayMedia=s.navigator.getDisplayMedia.bind(s.navigator)))}function sD(s,e){if(s.RTCIceGatherer&&(s.RTCIceCandidate||(s.RTCIceCandidate=function(n){return n}),s.RTCSessionDescription||(s.RTCSessionDescription=function(n){return n}),e.version<15025)){const i=Object.getOwnPropertyDescriptor(s.MediaStreamTrack.prototype,"enabled");Object.defineProperty(s.MediaStreamTrack.prototype,"enabled",{set(n){i.set.call(this,n);const r=new Event("enabled");r.enabled=n,this.dispatchEvent(r)}})}s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)&&Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new s.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),s.RTCDtmfSender&&!s.RTCDTMFSender&&(s.RTCDTMFSender=s.RTCDtmfSender);const t=hde(s,e.version);s.RTCPeerConnection=function(n){return n&&n.iceServers&&(n.iceServers=ode(n.iceServers,e.version),Pk("ICE servers after filtering:",n.iceServers)),new t(n)},s.RTCPeerConnection.prototype=t.prototype}function dj(s){s.RTCRtpSender&&!("replaceTrack"in s.RTCRtpSender.prototype)&&(s.RTCRtpSender.prototype.replaceTrack=s.RTCRtpSender.prototype.setTrack)}const w4=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:uj,shimGetUserMedia:hj,shimPeerConnection:sD,shimReplaceTrack:dj},Symbol.toStringTag,{value:"Module"}));function fj(s,e){const t=s&&s.navigator,i=s&&s.MediaStreamTrack;if(t.getUserMedia=function(n,r,o){jM("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(n).then(r,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const n=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),n(o.audio,"autoGainControl","mozAutoGainControl"),n(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return n(a,"mozAutoGainControl","autoGainControl"),n(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a,"autoGainControl","mozAutoGainControl"),n(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function ude(s,e){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,s.navigator.mediaDevices.getUserMedia(i)})}function pj(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rD(s,e){if(typeof s!="object"||!(s.RTCPeerConnection||s.mozRTCPeerConnection))return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=s.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};s.RTCPeerConnection.prototype[n]=o[n]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=t[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((h,u)=>{l.set(u,Object.assign({},h,{type:t[h.type]||h.type}))})}return l}).then(o,a)}}function mj(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const e=s.RTCPeerConnection.prototype.getSenders;e&&(s.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n});const t=s.RTCPeerConnection.prototype.addTrack;t&&(s.RTCPeerConnection.prototype.addTrack=function(){const n=t.apply(this,arguments);return n._pc=this,n}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function gj(s){if(!(typeof s=="object"&&s.RTCPeerConnection&&s.RTCRtpSender)||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const e=s.RTCPeerConnection.prototype.getReceivers;e&&(s.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(n=>n._pc=this),i}),Tv(s,"track",t=>(t.receiver._pc=t.srcElement,t)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function yj(s){!s.RTCPeerConnection||"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){jM("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&t.getTracks().includes(i.track)&&this.removeTrack(i)})})}function vj(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function Aj(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.addTransceiver;e&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],n=i&&"sendEncodings"in i;n&&i.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(n){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i.sendEncodings,o.sendEncodings=i.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function _j(s){if(!(typeof s=="object"&&s.RTCRtpSender))return;const e=s.RTCRtpSender.prototype.getParameters;e&&(s.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function bj(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function xj(s){if(!(typeof s=="object"&&s.RTCPeerConnection))return;const e=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const S4=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Aj,shimCreateAnswer:xj,shimCreateOffer:bj,shimGetDisplayMedia:ude,shimGetParameters:_j,shimGetUserMedia:fj,shimOnTrack:pj,shimPeerConnection:rD,shimRTCDataChannel:vj,shimReceiverGetStats:gj,shimRemoveStream:yj,shimSenderGetStats:mj},Symbol.toStringTag,{value:"Module"}));function wj(s){if(!(typeof s!="object"||!s.RTCPeerConnection)){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const e=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(n=>e.call(this,n,i)),i.getVideoTracks().forEach(n=>e.call(this,n,i))},s.RTCPeerConnection.prototype.addTrack=function(i,...n){return n&&n.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),e.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);const n=t.getTracks();this.getSenders().forEach(r=>{n.includes(r.track)&&this.removeTrack(r)})})}}function Sj(s){if(!(typeof s!="object"||!s.RTCPeerConnection)&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const r=new Event("addstream");r.stream=n,this.dispatchEvent(r)})})}});const e=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function Cj(s){if(typeof s!="object"||!s.RTCPeerConnection)return;const e=s.RTCPeerConnection.prototype,t=e.createOffer,i=e.createAnswer,n=e.setLocalDescription,r=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,h){const u=arguments.length>=2?arguments[2]:arguments[0],f=t.apply(this,[u]);return h?(f.then(c,h),Promise.resolve()):f},e.createAnswer=function(c,h){const u=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[u]);return h?(f.then(c,h),Promise.resolve()):f};let a=function(l,c,h){const u=n.apply(this,[l]);return h?(u.then(c,h),Promise.resolve()):u};e.setLocalDescription=a,a=function(l,c,h){const u=r.apply(this,[l]);return h?(u.then(c,h),Promise.resolve()):u},e.setRemoteDescription=a,a=function(l,c,h){const u=o.apply(this,[l]);return h?(u.then(c,h),Promise.resolve()):u},e.addIceCandidate=a}function Ej(s){const e=s&&s.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,i=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=n=>i(Mj(n))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(i,n,r){e.mediaDevices.getUserMedia(i).then(n,r)}.bind(e))}function Mj(s){return s&&s.video!==void 0?Object.assign({},s,{video:ZW(s.video)}):s}function Tj(s){if(!s.RTCPeerConnection)return;const e=s.RTCPeerConnection;s.RTCPeerConnection=function(i,n){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(jM("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new e(i,n)},s.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Ij(s){typeof s=="object"&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Rj(s){const e=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):i.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio"),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video")}return e.apply(this,arguments)}}function Pj(s){typeof s!="object"||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}const C4=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Pj,shimCallbacksAPI:Cj,shimConstraints:Mj,shimCreateOfferLegacy:Rj,shimGetUserMedia:Ej,shimLocalStreamsAPI:wj,shimRTCIceServerUrls:Tj,shimRemoteStreamsAPI:Sj,shimTrackEventTransceiver:Ij},Symbol.toStringTag,{value:"Module"}));function s1(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const e=s.RTCIceCandidate;s.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const n=new e(i),r=n1.parseCandidate(i.candidate),o=Object.assign(n,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(i)},s.RTCIceCandidate.prototype=e.prototype,Tv(s,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new s.RTCIceCandidate(t.candidate),writable:"false"}),t))}function bA(s,e){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const l=n1.splitSections(a.sdp);return l.shift(),l.some(c=>{const h=n1.parseMLine(c);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},n=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},r=function(a,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const h=n1.matchPrefix(a.sdp,"a=max-message-size:");return h.length>0?c=parseInt(h[0].substr(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},o=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const l=i(arguments[0]),c=n(l),h=r(arguments[0],l);let u;c===0&&h===0?u=Number.POSITIVE_INFINITY:c===0||h===0?u=Math.max(c,h):u=Math.min(c,h);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return u}}),this._sctp=f}return o.apply(this,arguments)}}function xA(s){if(!(s.RTCPeerConnection&&"createDataChannel"in s.RTCPeerConnection.prototype))return;function e(i,n){const r=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&n.sctp&&l>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const t=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const n=t.apply(this,arguments);return e(n,this),n},Tv(s,"datachannel",i=>(e(i.channel,i.target),i))}function oD(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const e=s.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const i=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const r=n.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",n);r.dispatchEvent(o)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function aD(s,e){if(!s.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=n.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);s.RTCSessionDescription&&n instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:n.type,sdp:r}):n.sdp=r}return t.apply(this,arguments)}}function r1(s,e){if(!(s.RTCPeerConnection&&s.RTCPeerConnection.prototype))return;const t=s.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const dde=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:aD,shimAddIceCandidateNullOrEmpty:r1,shimConnectionState:oD,shimMaxMessageSize:bA,shimRTCIceCandidate:s1,shimSendThrowTypeError:xA},Symbol.toStringTag,{value:"Module"}));function fde({window:s}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const t=Pk,i=sde(s),n={browserDetails:i,commonShim:dde,extractVersion:_A,disableLog:ide,disableWarnings:nde};switch(i.browser){case"chrome":if(!_4||!nD||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),n;if(i.version===null)return t("Chrome shim can not determine version, not shimming."),n;t("adapter.js shimming chrome."),n.browserShim=_4,r1(s,i),$W(s,i),ej(s),nD(s,i),tj(s),oj(s,i),ij(s),nj(s),sj(s),aj(s,i),s1(s),oD(s),bA(s,i),xA(s),aD(s,i);break;case"firefox":if(!S4||!rD||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),n;t("adapter.js shimming firefox."),n.browserShim=S4,r1(s,i),fj(s,i),rD(s,i),pj(s),yj(s),mj(s),gj(s),vj(s),Aj(s),_j(s),bj(s),xj(s),s1(s),oD(s),bA(s,i),xA(s);break;case"edge":if(!w4||!sD||!e.shimEdge)return t("MS edge shim is not included in this adapter release."),n;t("adapter.js shimming edge."),n.browserShim=w4,hj(s),uj(s),sD(s,i),dj(s),bA(s,i),xA(s);break;case"safari":if(!C4||!e.shimSafari)return t("Safari shim is not included in this adapter release."),n;t("adapter.js shimming safari."),n.browserShim=C4,r1(s,i),Tj(s),Rj(s),Cj(s),wj(s),Sj(s),Ij(s),Ej(s),Pj(s),s1(s),bA(s,i),xA(s),aD(s,i);break;default:t("Unsupported browser!");break}return n}const E4=fde({window:typeof window>"u"?void 0:window});function Xc(s,e,t,i){Object.defineProperty(s,e,{get:t,set:i,enumerable:!0,configurable:!0})}var QR=E4.default||E4,L0=new(function(){function s(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return s.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},s.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion(),i=this.supportedBrowsers.includes(e);return i?e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1},s.prototype.getBrowser=function(){return QR.browserDetails.browser},s.prototype.getVersion=function(){return QR.browserDetails.version||0},s.prototype.isUnifiedPlanSupported=function(){var e=this.getBrowser(),t=QR.browserDetails.version||0;if(e==="chrome"&&t<this.minChromeVersion)return!1;if(e==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i,n=!1;try{i=new RTCPeerConnection,i.addTransceiver("audio"),n=!0}catch{}finally{i&&i.close()}return n},s.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},s}()),M4={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},pde=function(){function s(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=M4,this.browser=L0.getBrowser(),this.browserVersion=L0.getVersion(),this.supports=function(){var e={browser:L0.isBrowserSupported(),webRTC:L0.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;var t;try{t=new RTCPeerConnection(M4),e.audioVideo=!0;var i=void 0;try{i=t.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!i.ordered;try{i.binaryType="blob",e.binaryBlob=!L0.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{t&&t.close()}return e}(),this.pack=g4.pack,this.unpack=g4.unpack,this._dataCount=1}return s.prototype.noop=function(){},s.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},s.prototype.chunk=function(e){for(var t=[],i=e.size,n=Math.ceil(i/Si.chunkedMTU),r=0,o=0;o<i;){var a=Math.min(i,o+Si.chunkedMTU),l=e.slice(o,a),c={__peerData:this._dataCount,n:r,data:l,total:n};t.push(c),o=a,r++}return this._dataCount++,t},s.prototype.blobToArrayBuffer=function(e,t){var i=new FileReader;return i.onload=function(n){n.target&&t(n.target.result)},i.readAsArrayBuffer(e),i},s.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i)&255;return t.buffer},s.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},s.prototype.isSecure=function(){return location.protocol==="https:"},s}(),Si=new pde,Bj={};Xc(Bj,"Peer",()=>hD,s=>hD=s);var qb={},mde=Object.prototype.hasOwnProperty,Ao="~";function Y_(){}Object.create&&(Y_.prototype=Object.create(null),new Y_().__proto__||(Ao=!1));function gde(s,e,t){this.fn=s,this.context=e,this.once=t||!1}function Dj(s,e,t,i,n){if(typeof t!="function")throw new TypeError("The listener must be a function");var r=new gde(t,i||s,n),o=Ao?Ao+e:e;return s._events[o]?s._events[o].fn?s._events[o]=[s._events[o],r]:s._events[o].push(r):(s._events[o]=r,s._eventsCount++),s}function o1(s,e){--s._eventsCount===0?s._events=new Y_:delete s._events[e]}function qr(){this._events=new Y_,this._eventsCount=0}qr.prototype.eventNames=function(){var e=[],t,i;if(this._eventsCount===0)return e;for(i in t=this._events)mde.call(t,i)&&e.push(Ao?i.slice(1):i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};qr.prototype.listeners=function(e){var t=Ao?Ao+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o};qr.prototype.listenerCount=function(e){var t=Ao?Ao+e:e,i=this._events[t];return i?i.fn?1:i.length:0};qr.prototype.emit=function(e,t,i,n,r,o){var a=Ao?Ao+e:e;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,h,u;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,i),!0;case 4:return l.fn.call(l.context,t,i,n),!0;case 5:return l.fn.call(l.context,t,i,n,r),!0;case 6:return l.fn.call(l.context,t,i,n,r,o),!0}for(u=1,h=new Array(c-1);u<c;u++)h[u-1]=arguments[u];l.fn.apply(l.context,h)}else{var f=l.length,p;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),c){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,i);break;case 4:l[u].fn.call(l[u].context,t,i,n);break;default:if(!h)for(p=1,h=new Array(c-1);p<c;p++)h[p-1]=arguments[p];l[u].fn.apply(l[u].context,h)}}return!0};qr.prototype.on=function(e,t,i){return Dj(this,e,t,i,!1)};qr.prototype.once=function(e,t,i){return Dj(this,e,t,i,!0)};qr.prototype.removeListener=function(e,t,i,n){var r=Ao?Ao+e:e;if(!this._events[r])return this;if(!t)return o1(this,r),this;var o=this._events[r];if(o.fn)o.fn===t&&(!n||o.once)&&(!i||o.context===i)&&o1(this,r);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==t||n&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=l.length===1?l[0]:l:o1(this,r)}return this};qr.prototype.removeAllListeners=function(e){var t;return e?(t=Ao?Ao+e:e,this._events[t]&&o1(this,t)):(this._events=new Y_,this._eventsCount=0),this};qr.prototype.off=qr.prototype.removeListener;qr.prototype.addListener=qr.prototype.on;qr.prefixed=Ao;qr.EventEmitter=qr;qb=qr;var gt={};Xc(gt,"LogLevel",()=>To,s=>To=s);Xc(gt,"default",()=>T4,s=>T4=s);var Vf=function(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var i=t.call(s),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},Qf=function(s,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,r;i<n;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return s.concat(r||Array.prototype.slice.call(e))},yde="PeerJS: ",To;(function(s){s[s.Disabled=0]="Disabled",s[s.Errors=1]="Errors",s[s.Warnings=2]="Warnings",s[s.All=3]="All"})(To||(To={}));var vde=function(){function s(){this._logLevel=To.Disabled}return Object.defineProperty(s.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),s.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=To.All&&this._print.apply(this,Qf([To.All],Vf(e),!1))},s.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=To.Warnings&&this._print.apply(this,Qf([To.Warnings],Vf(e),!1))},s.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=To.Errors&&this._print.apply(this,Qf([To.Errors],Vf(e),!1))},s.prototype.setLogFunction=function(e){this._print=e},s.prototype._print=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=Qf([yde],Vf(t),!1);for(var r in n)n[r]instanceof Error&&(n[r]="("+n[r].name+") "+n[r].message);e>=To.All?console.log.apply(console,Qf([],Vf(n),!1)):e>=To.Warnings?console.warn.apply(console,Qf(["WARNING"],Vf(n),!1)):e>=To.Errors&&console.error.apply(console,Qf(["ERROR"],Vf(n),!1))},s}(),T4=new vde,Oj={};Xc(Oj,"Socket",()=>I4,s=>I4=s);var Ol;(function(s){s.Data="data",s.Media="media"})(Ol||(Ol={}));var Yn;(function(s){s.BrowserIncompatible="browser-incompatible",s.Disconnected="disconnected",s.InvalidID="invalid-id",s.InvalidKey="invalid-key",s.Network="network",s.PeerUnavailable="peer-unavailable",s.SslUnavailable="ssl-unavailable",s.ServerError="server-error",s.SocketError="socket-error",s.SocketClosed="socket-closed",s.UnavailableID="unavailable-id",s.WebRTC="webrtc"})(Yn||(Yn={}));var Bh;(function(s){s.Binary="binary",s.BinaryUTF8="binary-utf8",s.JSON="json"})(Bh||(Bh={}));var Yh;(function(s){s.Message="message",s.Disconnected="disconnected",s.Error="error",s.Close="close"})(Yh||(Yh={}));var hr;(function(s){s.Heartbeat="HEARTBEAT",s.Candidate="CANDIDATE",s.Offer="OFFER",s.Answer="ANSWER",s.Open="OPEN",s.Error="ERROR",s.IdTaken="ID-TAKEN",s.InvalidKey="INVALID-KEY",s.Leave="LEAVE",s.Expire="EXPIRE"})(hr||(hr={}));var Bk={};Bk=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var Ade=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),_de=function(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var i=t.call(s),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},bde=function(s,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,r;i<n;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return s.concat(r||Array.prototype.slice.call(e))},xde=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},I4=function(s){Ade(e,s);function e(t,i,n,r,o,a){a===void 0&&(a=5e3);var l=s.call(this)||this;l.pingInterval=a,l._disconnected=!0,l._messagesQueue=[];var c=t?"wss://":"ws://";return l._baseUrl=c+i+":"+n+r+"peerjs?key="+o,l}return e.prototype.start=function(t,i){var n=this;this._id=t;var r="".concat(this._baseUrl,"&id=").concat(t,"&token=").concat(i);this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+Bk.version),this._disconnected=!1,this._socket.onmessage=function(o){var a;try{a=JSON.parse(o.data),gt.default.log("Server message received:",a)}catch{gt.default.log("Invalid server message",o.data);return}n.emit(Yh.Message,a)},this._socket.onclose=function(o){n._disconnected||(gt.default.log("Socket closed.",o),n._cleanup(),n._disconnected=!0,n.emit(Yh.Disconnected))},this._socket.onopen=function(){n._disconnected||(n._sendQueuedMessages(),gt.default.log("Socket open"),n._scheduleHeartbeat())})},e.prototype._scheduleHeartbeat=function(){var t=this;this._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},this.pingInterval)},e.prototype._sendHeartbeat=function(){if(!this._wsOpen()){gt.default.log("Cannot send heartbeat, because socket closed");return}var t=JSON.stringify({type:hr.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()},e.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},e.prototype._sendQueuedMessages=function(){var t,i,n=bde([],_de(this._messagesQueue),!1);this._messagesQueue=[];try{for(var r=xde(n),o=r.next();!o.done;o=r.next()){var a=o.value;this.send(a)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.send=function(t){if(!this._disconnected){if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(Yh.Error,"Invalid message");return}if(this._wsOpen()){var i=JSON.stringify(t);this._socket.send(i)}}},e.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},e.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},e}(qb.EventEmitter),lD={};Xc(lD,"MediaConnection",()=>B4,s=>B4=s);var Dk={};Xc(Dk,"Negotiator",()=>R4,s=>R4=s);var iE=function(){return iE=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},iE.apply(this,arguments)},bS=function(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(u){o(u)}}function l(h){try{c(i.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):n(h.value).then(a,l)}c((i=i.apply(s,e||[])).next())})},xS=function(s,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,n,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(h){return l([c,h])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(r=c[0]&2?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[c[0]&2,r.value]),c[0]){case 0:case 1:r=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,n=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){t.label=c[1];break}if(c[0]===6&&t.label<r[1]){t.label=r[1],r=c;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(c);break}r[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(s,t)}catch(h){c=[6,h],n=0}finally{i=r=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},R4=function(){function s(e){this.connection=e}return s.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===Ol.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===Ol.Data){var i=this.connection,n={ordered:!!e.reliable},r=t.createDataChannel(i.label,n);i.initialize(r)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},s.prototype._startPeerConnection=function(){gt.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},s.prototype._setupListeners=function(e){var t=this,i=this.connection.peer,n=this.connection.connectionId,r=this.connection.type,o=this.connection.provider;gt.default.log("Listening for ICE candidates."),e.onicecandidate=function(a){!a.candidate||!a.candidate.candidate||(gt.default.log("Received ICE candidates for ".concat(i,":"),a.candidate),o.socket.send({type:hr.Candidate,payload:{candidate:a.candidate,type:r,connectionId:n},dst:i}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":gt.default.log("iceConnectionState is failed, closing connections to "+i),t.connection.emit("error",new Error("Negotiation of connection to "+i+" failed.")),t.connection.close();break;case"closed":gt.default.log("iceConnectionState is closed, closing connections to "+i),t.connection.emit("error",new Error("Connection to "+i+" closed.")),t.connection.close();break;case"disconnected":gt.default.log("iceConnectionState changed to disconnected on the connection with "+i);break;case"completed":e.onicecandidate=Si.noop;break}t.connection.emit("iceStateChanged",e.iceConnectionState)},gt.default.log("Listening for data channel"),e.ondatachannel=function(a){gt.default.log("Received data channel");var l=a.channel,c=o.getConnection(i,n);c.initialize(l)},gt.default.log("Listening for remote stream"),e.ontrack=function(a){gt.default.log("Received remote stream");var l=a.streams[0],c=o.getConnection(i,n);if(c.type===Ol.Media){var h=c;t._addStreamToMediaConnection(l,h)}}},s.prototype.cleanup=function(){gt.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t=e.signalingState!=="closed",i=!1;if(this.connection.type===Ol.Data){var n=this.connection,r=n.dataChannel;r&&(i=!!r.readyState&&r.readyState!=="closed")}(t||i)&&e.close()}},s.prototype._makeOffer=function(){return bS(this,void 0,Promise,function(){var e,t,i,n,r,o,a;return xS(this,function(l){switch(l.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:i=l.sent(),gt.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return l.sent(),gt.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),n={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:Si.browser},this.connection.type===Ol.Data&&(r=this.connection,n=iE(iE({},n),{label:r.label,reliable:r.reliable,serialization:r.serialization})),t.socket.send({type:hr.Offer,payload:n,dst:this.connection.peer}),[3,6];case 5:return o=l.sent(),o!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(Yn.WebRTC,o),gt.default.log("Failed to setLocalDescription, ",o)),[3,6];case 6:return[3,8];case 7:return a=l.sent(),t.emitError(Yn.WebRTC,a),gt.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},s.prototype._makeAnswer=function(){return bS(this,void 0,Promise,function(){var e,t,i,n,r;return xS(this,function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:i=o.sent(),gt.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(i)];case 4:return o.sent(),gt.default.log("Set localDescription:",i,"for:".concat(this.connection.peer)),t.socket.send({type:hr.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,browser:Si.browser},dst:this.connection.peer}),[3,6];case 5:return n=o.sent(),t.emitError(Yn.WebRTC,n),gt.default.log("Failed to setLocalDescription, ",n),[3,6];case 6:return[3,8];case 7:return r=o.sent(),t.emitError(Yn.WebRTC,r),gt.default.log("Failed to create answer, ",r),[3,8];case 8:return[2]}})})},s.prototype.handleSDP=function(e,t){return bS(this,void 0,Promise,function(){var i,n,r,o;return xS(this,function(a){switch(a.label){case 0:t=new RTCSessionDescription(t),i=this.connection.peerConnection,n=this.connection.provider,gt.default.log("Setting remote description",t),r=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,i.setRemoteDescription(t)];case 2:return a.sent(),gt.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),e!=="OFFER"?[3,4]:[4,r._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return o=a.sent(),n.emitError(Yn.WebRTC,o),gt.default.log("Failed to setRemoteDescription, ",o),[3,6];case 6:return[2]}})})},s.prototype.handleCandidate=function(e){return bS(this,void 0,Promise,function(){var t,i,n,r,o,a;return xS(this,function(l){switch(l.label){case 0:gt.default.log("handleCandidate:",e),t=e.candidate,i=e.sdpMLineIndex,n=e.sdpMid,r=this.connection.peerConnection,o=this.connection.provider,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,r.addIceCandidate(new RTCIceCandidate({sdpMid:n,sdpMLineIndex:i,candidate:t}))];case 2:return l.sent(),gt.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=l.sent(),o.emitError(Yn.WebRTC,a),gt.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},s.prototype._addTracksToConnection=function(e,t){if(gt.default.log("add tracks from stream ".concat(e.id," to peer connection")),!t.addTrack)return gt.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(i){t.addTrack(i,e)})},s.prototype._addStreamToMediaConnection=function(e,t){gt.default.log("add stream ".concat(e.id," to media connection ").concat(t.connectionId)),t.addStream(e)},s}(),Ok={};Xc(Ok,"BaseConnection",()=>P4,s=>P4=s);var wde=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),P4=function(s){wde(e,s);function e(t,i,n){var r=s.call(this)||this;return r.peer=t,r.provider=i,r.options=n,r._open=!1,r.metadata=n.metadata,r}return Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),e}(qb.EventEmitter),Sde=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),nE=function(){return nE=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},nE.apply(this,arguments)},Cde=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},B4=function(s){Sde(e,s);function e(t,i,n){var r=s.call(this,t,i,n)||this;return r._localStream=r.options._stream,r.connectionId=r.options.connectionId||e.ID_PREFIX+Si.randomToken(),r._negotiator=new Dk.Negotiator(r),r._localStream&&r._negotiator.startConnection({_stream:r._localStream,originator:!0}),r}return Object.defineProperty(e.prototype,"type",{get:function(){return Ol.Media},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),e.prototype.addStream=function(t){gt.default.log("Receiving stream",t),this._remoteStream=t,s.prototype.emit.call(this,"stream",t)},e.prototype.handleMessage=function(t){var i=t.type,n=t.payload;switch(t.type){case hr.Answer:this._negotiator.handleSDP(i,n.sdp),this._open=!0;break;case hr.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:gt.default.warn("Unrecognized message type:".concat(i," from peer:").concat(this.peer));break}},e.prototype.answer=function(t,i){var n,r;if(i===void 0&&(i={}),this._localStream){gt.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,i&&i.sdpTransform&&(this.options.sdpTransform=i.sdpTransform),this._negotiator.startConnection(nE(nE({},this.options._payload),{_stream:t}));var o=this.provider._getMessages(this.connectionId);try{for(var a=Cde(o),l=a.next();!l.done;l=a.next()){var c=l.value;this.handleMessage(c)}}catch(h){n={error:h}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}this._open=!0},e.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,s.prototype.emit.call(this,"close"))},e.ID_PREFIX="mc_",e}(Ok.BaseConnection),cD={};Xc(cD,"DataConnection",()=>O4,s=>O4=s);var Lj={};Xc(Lj,"EncodingQueue",()=>D4,s=>D4=s);var Ede=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),D4=function(s){Ede(e,s);function e(){var t=s.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(i){t._processing=!1,i.target&&t.emit("done",i.target.result),t.doNextTask()},t.fileReader.onerror=function(i){gt.default.error("EncodingQueue error:",i),t._processing=!1,t.destroy(),t.emit("error",i)},t}return Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),e.prototype.enque=function(t){this.queue.push(t),!this.processing&&this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(qb.EventEmitter),Mde=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Tde=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},O4=function(s){Mde(e,s);function e(t,i,n){var r=s.call(this,t,i,n)||this;return r.stringify=JSON.stringify,r.parse=JSON.parse,r._buffer=[],r._bufferSize=0,r._buffering=!1,r._chunkedData={},r._encodingQueue=new Lj.EncodingQueue,r.connectionId=r.options.connectionId||e.ID_PREFIX+Si.randomToken(),r.label=r.options.label||r.connectionId,r.serialization=r.options.serialization||Bh.Binary,r.reliable=!!r.options.reliable,r._encodingQueue.on("done",function(o){r._bufferedSend(o)}),r._encodingQueue.on("error",function(){gt.default.error("DC#".concat(r.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),r.close()}),r._negotiator=new Dk.Negotiator(r),r._negotiator.startConnection(r.options._payload||{originator:!0}),r}return Object.defineProperty(e.prototype,"type",{get:function(){return Ol.Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),e.prototype.initialize=function(t){this._dc=t,this._configureDataChannel()},e.prototype._configureDataChannel=function(){var t=this;(!Si.supports.binaryBlob||Si.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){gt.default.log("DC#".concat(t.connectionId," dc connection success")),t._open=!0,t.emit("open")},this.dataChannel.onmessage=function(i){gt.default.log("DC#".concat(t.connectionId," dc onmessage:"),i.data),t._handleDataMessage(i)},this.dataChannel.onclose=function(){gt.default.log("DC#".concat(t.connectionId," dc closed for:"),t.peer),t.close()}},e.prototype._handleDataMessage=function(t){var i=this,n=t.data,r=n.constructor,o=this.serialization===Bh.Binary||this.serialization===Bh.BinaryUTF8,a=n;if(o){if(r===Blob){Si.blobToArrayBuffer(n,function(c){var h=Si.unpack(c);i.emit("data",h)});return}else if(r===ArrayBuffer)a=Si.unpack(n);else if(r===String){var l=Si.binaryStringToArrayBuffer(n);a=Si.unpack(l)}}else this.serialization===Bh.JSON&&(a=this.parse(n));if(a.__peerData){this._handleChunk(a);return}s.prototype.emit.call(this,"data",a)},e.prototype._handleChunk=function(t){var i=t.__peerData,n=this._chunkedData[i]||{data:[],count:0,total:t.total};if(n.data[t.n]=t.data,n.count++,this._chunkedData[i]=n,n.total===n.count){delete this._chunkedData[i];var r=new Blob(n.data);this._handleDataMessage({data:r})}},e.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,s.prototype.emit.call(this,"close"))},e.prototype.send=function(t,i){if(!this.open){s.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===Bh.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===Bh.Binary||this.serialization===Bh.BinaryUTF8){var n=Si.pack(t);if(!i&&n.size>Si.chunkedMTU){this._sendChunks(n);return}Si.supports.binaryBlob?this._bufferedSend(n):this._encodingQueue.enque(n)}else this._bufferedSend(t)},e.prototype._bufferedSend=function(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)},e.prototype._trySend=function(t){var i=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>e.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){i._buffering=!1,i._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(n){return gt.default.error("DC#:".concat(this.connectionId," Error when sending:"),n),this._buffering=!0,this.close(),!1}return!0},e.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},e.prototype._sendChunks=function(t){var i,n,r=Si.chunk(t);gt.default.log("DC#".concat(this.connectionId," Try to send ").concat(r.length," chunks..."));try{for(var o=Tde(r),a=o.next();!a.done;a=o.next()){var l=a.value;this.send(l,!0)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}},e.prototype.handleMessage=function(t){var i=t.payload;switch(t.type){case hr.Answer:this._negotiator.handleSDP(t.type,i.sdp);break;case hr.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:gt.default.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}},e.ID_PREFIX="dc_",e.MAX_BUFFERED_AMOUNT=8388608,e}(Ok.BaseConnection),kj={};Xc(kj,"API",()=>F4,s=>F4=s);var L4=function(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(u){o(u)}}function l(h){try{c(i.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):n(h.value).then(a,l)}c((i=i.apply(s,e||[])).next())})},k4=function(s,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,n,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(h){return l([c,h])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(r=c[0]&2?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[c[0]&2,r.value]),c[0]){case 0:case 1:r=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,n=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){t.label=c[1];break}if(c[0]===6&&t.label<r[1]){t.label=r[1],r=c;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(c);break}r[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(s,t)}catch(h){c=[6,h],n=0}finally{i=r=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},F4=function(){function s(e){this._options=e}return s.prototype._buildRequest=function(e){var t=this._options.secure?"https":"http",i=this._options,n=i.host,r=i.port,o=i.path,a=i.key,l=new URL("".concat(t,"://").concat(n,":").concat(r).concat(o).concat(a,"/").concat(e));return l.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),l.searchParams.set("version",Bk.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})},s.prototype.retrieveId=function(){return L4(this,void 0,Promise,function(){var e,t,i;return k4(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(e=n.sent(),e.status!==200)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw t=n.sent(),gt.default.error("Error retrieving ID",t),i="",this._options.path==="/"&&this._options.host!==Si.CLOUD_HOST&&(i=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+i);case 3:return[2]}})})},s.prototype.listAllPeers=function(){return L4(this,void 0,Promise,function(){var e,t,i;return k4(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(e=n.sent(),e.status!==200)throw e.status===401?(t="",this._options.host===Si.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)):new Error("Error. Status:".concat(e.status));return[2,e.json()];case 2:throw i=n.sent(),gt.default.error("Error retrieving list peers",i),new Error("Could not get list peers from the server."+i);case 3:return[2]}})})},s}(),Ide=function(){var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])},s(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");s(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),t_=function(){return t_=Object.assign||function(s){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},t_.apply(this,arguments)},k0=function(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Rde=function(s,e){var t=typeof Symbol=="function"&&s[Symbol.iterator];if(!t)return s;var i=t.call(s),n,r=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)r.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return r},hD=function(s){Ide(e,s);function e(t,i){var n=s.call(this)||this;n._id=null,n._lastServerId=null,n._destroyed=!1,n._disconnected=!1,n._open=!1,n._connections=new Map,n._lostMessages=new Map;var r;return t&&t.constructor==Object?i=t:t&&(r=t.toString()),i=t_({debug:0,host:Si.CLOUD_HOST,port:Si.CLOUD_PORT,path:"/",key:e.DEFAULT_KEY,token:Si.randomToken(),config:Si.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},i),n._options=i,n._options.host==="/"&&(n._options.host=window.location.hostname),n._options.path&&(n._options.path[0]!=="/"&&(n._options.path="/"+n._options.path),n._options.path[n._options.path.length-1]!=="/"&&(n._options.path+="/")),n._options.secure===void 0&&n._options.host!==Si.CLOUD_HOST?n._options.secure=Si.isSecure():n._options.host==Si.CLOUD_HOST&&(n._options.secure=!0),n._options.logFunction&&gt.default.setLogFunction(n._options.logFunction),gt.default.logLevel=n._options.debug||0,n._api=new kj.API(i),n._socket=n._createServerConnection(),!Si.supports.audioVideo&&!Si.supports.data?(n._delayedAbort(Yn.BrowserIncompatible,"The current browser does not support WebRTC"),n):r&&!Si.validateId(r)?(n._delayedAbort(Yn.InvalidID,'ID "'.concat(r,'" is invalid')),n):(r?n._initialize(r):n._api.retrieveId().then(function(o){return n._initialize(o)}).catch(function(o){return n._abort(Yn.ServerError,o)}),n)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){var t,i,n=Object.create(null);try{for(var r=k0(this._connections),o=r.next();!o.done;o=r.next()){var a=Rde(o.value,2),l=a[0],c=a[1];n[l]=c}}catch(h){t={error:h}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),e.prototype._createServerConnection=function(){var t=this,i=new Oj.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return i.on(Yh.Message,function(n){t._handleMessage(n)}),i.on(Yh.Error,function(n){t._abort(Yn.SocketError,n)}),i.on(Yh.Disconnected,function(){t.disconnected||(t.emitError(Yn.Network,"Lost connection to server."),t.disconnect())}),i.on(Yh.Close,function(){t.disconnected||t._abort(Yn.SocketClosed,"Underlying socket is already closed.")}),i},e.prototype._initialize=function(t){this._id=t,this.socket.start(t,this._options.token)},e.prototype._handleMessage=function(t){var i,n,r=t.type,o=t.payload,a=t.src;switch(r){case hr.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case hr.Error:this._abort(Yn.ServerError,o.msg);break;case hr.IdTaken:this._abort(Yn.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case hr.InvalidKey:this._abort(Yn.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case hr.Leave:gt.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case hr.Expire:this.emitError(Yn.PeerUnavailable,"Could not connect to peer ".concat(a));break;case hr.Offer:var m=o.connectionId,v=this.getConnection(a,m);if(v&&(v.close(),gt.default.warn("Offer received for existing Connection ID:".concat(m))),o.type===Ol.Media){var l=new lD.MediaConnection(a,this,{connectionId:m,_payload:o,metadata:o.metadata});v=l,this._addConnection(a,v),this.emit("call",l)}else if(o.type===Ol.Data){var c=new cD.DataConnection(a,this,{connectionId:m,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable});v=c,this._addConnection(a,v),this.emit("connection",c)}else{gt.default.warn("Received malformed connection type:".concat(o.type));return}var h=this._getMessages(m);try{for(var u=k0(h),f=u.next();!f.done;f=u.next()){var p=f.value;v.handleMessage(p)}}catch(g){i={error:g}}finally{try{f&&!f.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}break;default:if(!o){gt.default.warn("You received a malformed message from ".concat(a," of type ").concat(r));return}var m=o.connectionId,v=this.getConnection(a,m);v&&v.peerConnection?v.handleMessage(t):m?this._storeMessage(m,t):gt.default.warn("You received an unrecognized message:",t);break}},e.prototype._storeMessage=function(t,i){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(i)},e.prototype._getMessages=function(t){var i=this._lostMessages.get(t);return i?(this._lostMessages.delete(t),i):[]},e.prototype.connect=function(t,i){if(i===void 0&&(i={}),this.disconnected){gt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Yn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var n=new cD.DataConnection(t,this,i);return this._addConnection(t,n),n},e.prototype.call=function(t,i,n){if(n===void 0&&(n={}),this.disconnected){gt.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Yn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!i){gt.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var r=new lD.MediaConnection(t,this,t_(t_({},n),{_stream:i}));return this._addConnection(t,r),r},e.prototype._addConnection=function(t,i){gt.default.log("add connection ".concat(i.type,":").concat(i.connectionId," to peerId:").concat(t)),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(i)},e.prototype._removeConnection=function(t){var i=this._connections.get(t.peer);if(i){var n=i.indexOf(t);n!==-1&&i.splice(n,1)}this._lostMessages.delete(t.connectionId)},e.prototype.getConnection=function(t,i){var n,r,o=this._connections.get(t);if(!o)return null;try{for(var a=k0(o),l=a.next();!l.done;l=a.next()){var c=l.value;if(c.connectionId===i)return c}}catch(h){n={error:h}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return null},e.prototype._delayedAbort=function(t,i){var n=this;setTimeout(function(){n._abort(t,i)},0)},e.prototype._abort=function(t,i){gt.default.error("Aborting!"),this.emitError(t,i),this._lastServerId?this.disconnect():this.destroy()},e.prototype.emitError=function(t,i){gt.default.error("Error:",i);var n;typeof i=="string"?n=new Error(i):n=i,n.type=t,this.emit("error",n)},e.prototype.destroy=function(){this.destroyed||(gt.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},e.prototype._cleanup=function(){var t,i;try{for(var n=k0(this._connections.keys()),r=n.next();!r.done;r=n.next()){var o=r.value;this._cleanupPeer(o),this._connections.delete(o)}}catch(a){t={error:a}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}this.socket.removeAllListeners()},e.prototype._cleanupPeer=function(t){var i,n,r=this._connections.get(t);if(r)try{for(var o=k0(r),a=o.next();!a.done;a=o.next()){var l=a.value;l.close()}}catch(c){i={error:c}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}},e.prototype.disconnect=function(){if(!this.disconnected){var t=this.id;gt.default.log("Disconnect peer with ID:".concat(t)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}},e.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)gt.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)gt.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},e.prototype.listAllPeers=function(t){var i=this;t===void 0&&(t=function(n){}),this._api.listAllPeers().then(function(n){return t(n)}).catch(function(n){return i._abort(Yn.ServerError,n)})},e.DEFAULT_KEY="peerjs",e}(qb.EventEmitter),uD=Bj.Peer;const Pde=Object.freeze(Object.defineProperty({__proto__:null,get Peer(){return hD},default:uD,util:Si},Symbol.toStringTag,{value:"Module"}));let Lk;function Bde(){return Lk}function Dde(s){Lk=s}function Fj(s,e){return e||(e={}),e={...Lk,...e},s?new uD(s,e):new uD(e)}async function U4(){const s=await Promise.resolve().then(()=>Pde);return console.log(s),s.default===void 0?s:s.default}class Uj{constructor(){d(this,"_host");d(this,"_client");d(this,"_clientData");this.onEnable()}get isHost(){return this._host!==void 0}onEnable(){const e="HOST-5980e65c-8438-453e-8b35-f13c736dcd81";this.trySetupHost(e)}async trySetupHost(e){const t=await U4(),i=new t(e);i.on("error",n=>{console.error(n),this._host=void 0,this.trySetupClient(e)}),i.on("open",n=>{this._host=new Lde(i)})}async trySetupClient(e){const t=await U4();this._client=new t,this._client.on("error",i=>{console.error("Client error",i)}),this._client.on("open",i=>{console.log("client connected",i),this._clientData=this._client.connect(e,{metadata:{id:i}}),this._clientData.on("open",()=>{console.log("Connected to host")}),this._clientData.on("data",n=>{console.log("<<",n)})})}}class Ode{constructor(e){d(this,"_peer");this._peer=e}}class Lde extends Ode{constructor(t){var i;super(t);d(this,"_connections",[]);console.log("I AM THE HOST"),(i=this._peer)==null||i.on("connection",this.onConnection.bind(this)),this._peer.on("close",()=>{this.broadcast("BYE")}),setInterval(()=>{this.broadcast("HELLO")},2e3)}get isHost(){return!0}onConnection(t){console.log("host connection",t),t.on("open",()=>{this._connections.push(t),this.broadcastConnection(t)})}broadcastConnection(t){const i=this._connections.map(n=>{var r;return(r=n.metadata)==null?void 0:r.id}).filter(n=>n!==void 0);this.broadcast({type:"connection-list",connections:i})}broadcast(t){if(t!=null){console.log(">>",t);for(const i in this._peer.connections){const n=this._peer.connections[i];if(n)if(Array.isArray(n))for(const r of n)r&&r.send(t);else console.warn(n)}}}}var Bl=(s=>(s[s.OnConnection=0]="OnConnection",s[s.OnRoomJoin=1]="OnRoomJoin",s[s.Queued=2]="Queued",s[s.Immediate=3]="Immediate",s))(Bl||{});const N4="https://urls.needle.tools/default-networking-backend/index";let vh="wss://needle-tiny-starter.glitch.me/socket";const oo=!!ie("debugnet"),wA=!!(oo||ie("debugowner")),WR=ie("debugnetbin");var Nj=(s=>(s.ConnectionInfo="connection-start-info",s))(Nj||{}),Qt=(s=>(s.Join="join-room",s.Leave="leave-room",s.JoinedRoom="joined-room",s.LeftRoom="left-room",s.UserJoinedRoom="user-joined-room",s.UserLeftRoom="user-left-room",s.RoomStateSent="room-state-sent",s))(Qt||{});class kde{constructor(){d(this,"room");d(this,"viewId");d(this,"allowEditing");d(this,"inRoom")}}class Fde{constructor(){d(this,"room")}}class Ude{constructor(){d(this,"userId")}}var zj=(s=>(s.RequestHasOwner="request-has-owner",s.ResponseHasOwner="response-has-owner",s.RequestIsOwner="request-is-owner",s.ResponseIsOwner="response-is-owner",s.RequestOwnership="request-ownership",s.GainedOwnership="gained-ownership",s.RemoveOwnership="remove-ownership",s.LostOwnership="lost-ownership",s.GainedOwnershipBroadcast="gained-ownership-broadcast",s.LostOwnershipBroadcast="lost-ownership-broadcast",s))(zj||{});class kk{constructor(e,t){d(this,"guid");d(this,"connection");d(this,"_hasOwnership",!1);d(this,"_isOwned");d(this,"_gainSubscription");d(this,"_lostSubscription");d(this,"_hasOwnerResponse");d(this,"_isWaitingForOwnershipResponseCallback",null);this.connection=e,this.guid=t,this._gainSubscription=this.onGainedOwnership.bind(this),this._lostSubscription=this.onLostOwnership.bind(this),e.beginListen("lost-ownership",this._lostSubscription),e.beginListen("gained-ownership-broadcast",this._gainSubscription),this._hasOwnerResponse=this.onHasOwnerResponse.bind(this),e.beginListen("response-has-owner",this._hasOwnerResponse)}get hasOwnership(){return this._hasOwnership}get isOwned(){return this._isOwned}get isConnected(){return this.connection.isConnected}updateIsOwned(){this.connection.send("request-has-owner",{guid:this.guid})}onHasOwnerResponse(e){e.guid===this.guid&&(this._isOwned=e.value)}requestOwnershipIfNotOwned(){return this._isWaitingForOwnershipResponseCallback!==null?this:(this._isWaitingForOwnershipResponseCallback=this.waitForHasOwnershipRequestResponse.bind(this),this.connection.beginListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this.connection.send("request-has-owner",{guid:this.guid}),this)}waitForHasOwnershipRequestResponse(e){e.guid===this.guid&&(this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this._isOwned=e.value,e.value||(wA&&console.log("request ownership",this.guid),this.requestOwnership()))}requestOwnershipAsync(){return new Promise((e,t)=>{this.requestOwnership();let i=0;const n=()=>{if(i++>10)return t("Timeout");setTimeout(()=>{this.hasOwnership?e(this):n()},100)};n()})}requestOwnership(){return wA&&console.log("Request ownership",this.guid),this.connection.send("request-ownership",{guid:this.guid}),this}freeOwnership(){return this.connection.send("remove-ownership",{guid:this.guid}),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null),this}destroy(){this.connection.stopListen("gained-ownership",this._gainSubscription),this.connection.stopListen("lost-ownership",this._lostSubscription),this.connection.stopListen("response-has-owner",this._hasOwnerResponse),this._isWaitingForOwnershipResponseCallback&&(this.connection.stopListen("response-has-owner",this._isWaitingForOwnershipResponseCallback),this._isWaitingForOwnershipResponseCallback=null)}onGainedOwnership(e){e.guid===this.guid&&(this._isOwned=!0,this.connection.connectionId===e.owner?(wA&&console.log("GAINED OWNERSHIP",this.guid),this._hasOwnership=!0):this._hasOwnership=!1)}onLostOwnership(e){e===this.guid&&(wA&&console.log("LOST OWNERSHIP",this.guid),this._hasOwnership=!1,this._isOwned=!1)}}class Gj{constructor(e){d(this,"context");d(this,"_peer",null);d(this,"_usersInRoomCopy",[]);d(this,"_defaultMessagesBuffer",[]);d(this,"_defaultMessagesBufferArray",[]);d(this,"netWebSocketUrlProvider");d(this,"_listeners",{});d(this,"_listenersBinary",{});d(this,"connected",!1);d(this,"channelId");d(this,"_connectionId",null);d(this,"_ws");d(this,"_waitingForSocket",{});d(this,"_isInRoom",!1);d(this,"_currentRoomName",null);d(this,"_currentRoomViewId",null);d(this,"_currentRoomAllowEditing",!0);d(this,"_currentInRoom",[]);d(this,"_state",{});d(this,"_currentDelay",-1);d(this,"_connectingToWebsocketPromise",null);this.context=e}get peer(){return this._peer||(this._peer=new Uj),this._peer}tryGetState(e){return e==="invalid"?null:this._state[e]}get connectionId(){return this._connectionId}get isDebugEnabled(){return oo}get isConnected(){return this.connected}get currentRoomName(){return this._currentRoomName}get allowEditing(){return this._currentRoomAllowEditing}get currentRoomViewId(){return this._currentRoomViewId}getViewOnlyUrl(){if(this.currentRoomViewId===null)return null;const e=new URL(window.location.href);return e.searchParams.set("view",this.currentRoomViewId),e.href}get isInRoom(){return this._isInRoom}get currentLatency(){return this._currentDelay}get currentServerUrl(){var e;return((e=this._ws)==null?void 0:e.url)??null}sendPing(){this.send("ping",{time:this.context.time.time})}userIsInRoom(e){return this._currentInRoom.indexOf(e)!==-1}usersInRoom(e=null){e||(e=this._usersInRoomCopy),e.length=0;for(const t of this._currentInRoom)e.push(t);return e}joinRoom(e,t=!1){return e?e.length>1024?(console.error('Room name too long, can not join: "'+e+'". Max length is 1024 characters.'),!1):(this.connect(),oo&&console.log("join: "+e),this.send("join-room",{room:e,viewOnly:t},Bl.OnConnection),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}leaveRoom(e=null){return e||(e=this.currentRoomName),e?(this.send("leave-room",{room:e}),!0):(console.error('Missing room name, can not join: "'+e+'"'),!1)}send(e,t=null,i=Bl.Queued){if(t===null&&(t={}),i===Bl.Queued){this._defaultMessagesBuffer.push({key:e,value:t});return}return this.sendWithWebsocket(e,t,i)}sendDeleteRemoteState(e){this.send("delete-state",{guid:e,dontSave:!0}),delete this._state[e]}sendDeleteRemoteStateAll(){this.send("delete-all-state"),this._state={}}sendBinary(e){var t;WR&&console.log("<< send binary",this.context.time.frame,e.length/1024+" KB"),(t=this._ws)==null||t.send(e)}sendBufferedMessagesNow(){var i;if(!this._ws)return;this._defaultMessagesBufferArray.length=0;const e=Object.keys(this._defaultMessagesBuffer).length;for(const n in this._defaultMessagesBuffer){const r=this._defaultMessagesBuffer[n];if(e<=1){this.sendWithWebsocket(r.key,r.value,Bl.Immediate);break}const o=this.toMessage(r.key,r.value);this._defaultMessagesBufferArray.push(o)}if(this._defaultMessagesBuffer.length=0,this._defaultMessagesBufferArray.length>0&&oo&&console.log("SEND BUFFERED",this._defaultMessagesBufferArray.length),this._defaultMessagesBufferArray.length<=0)return;const t=JSON.stringify(this._defaultMessagesBufferArray);(i=this._ws)==null||i.send(t)}beginListen(e,t){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),t}stopListening(e,t){return this.stopListen(e,t)}stopListen(e,t){if(!t||!this._listeners[e])return;const i=this._listeners[e].indexOf(t);i>=0&&this._listeners[e].splice(i,1)}beginListenBinary(e,t){return this._listenersBinary[e]||(this._listenersBinary[e]=[]),this._listenersBinary[e].push(t),t}stopListenBinary(e,t){if(!this._listenersBinary[e])return;const i=this._listenersBinary[e].indexOf(t);i>=0&&this._listenersBinary[e].splice(i,1)}registerProvider(e){this.netWebSocketUrlProvider=e}async connect(){var t;if(this.connected)return Promise.resolve(!0);oo&&console.log("connecting");const e=(t=this.netWebSocketUrlProvider)==null?void 0:t.getWebsocketUrl();return e?vh=e:A6()&&(vh="wss://"+window.location.host+"/socket"),this.connectWebsocket()}disconnect(){var e;(e=this._ws)==null||e.close(),this._ws=void 0}connectWebsocket(){return this._connectingToWebsocketPromise?this._connectingToWebsocketPromise:this._connectingToWebsocketPromise=new Promise(async(e,t)=>{var c,h;let i=!1;const n=u=>{i||(i=!0,e(u))};if(vh===void 0&&(console.log("Fetch default backend url: "+N4),vh=await(await fetch(N4)).text()),vh===void 0){n(!1);return}console.debug(` Connecting to networking backend on
`+vh);const r=await Promise.resolve().then(()=>vCe),o=((c=r.default)==null?void 0:c.WebsocketBuilder)??r.WebsocketBuilder,a=((h=r.default)==null?void 0:h.ExponentialBackoff)??r.ExponentialBackoff,l=new o(vh).withMaxRetries(3).withBackoff(new a(2e3,2)).onOpen(()=>{this._connectingToWebsocketPromise=null,this._ws=l,this.connected=!0,nt()||oo?console.log(` Connected to networking backend
`+vh):console.debug(" Connected to networking backend",vh),n(!0),this.onSendQueued(Bl.OnConnection)}).onClose(u=>{this._connectingToWebsocketPromise=null,this.connected=!1,this._isInRoom=!1,n(!1)}).onError(u=>{console.error(" Websocket error"),n(!1)}).onRetry(()=>{console.log("Retry connecting to networking websocket")}).build();l.addEventListener(r.WebsocketEvent.message,(u,f)=>{this.onMessage(u,f)})})}onMessage(e,t){const i=t.data;try{if(typeof i!="string"){i.size&&this.handleIncomingBinaryMessage(i);return}const n=JSON.parse(i);if(Array.isArray(n))for(const r of n)this.handleIncomingStringMessage(r);else this.handleIncomingStringMessage(n);return}catch(n){oo&&i==="pong"?console.log("<<",i):nt()&&console.error("Failed to parse message",n)}}async handleIncomingBinaryMessage(e){WR&&console.log("<< bin",this.context.time.frame);const t=await e.arrayBuffer();var i=new Uint8Array(t);const n=new X_(i),r=n.getBufferIdentifier(),o=this._listenersBinary[r],a=jW(n),l=qW(a);if(l&&typeof l=="string"&&(this._state[l]=a),!o)return;const c=a??n;for(const h of o)h(c)}handleIncomingStringMessage(e){var n,r;if(oo&&console.log("<<",e.key??e),e.key)switch(e.key){case"connection-start-info":if(e.data){const l=e.data;l&&(console.assert(l.id!==void 0&&l.id!==null&&l.id.length>0,"server did not send connection id",l.id),console.debug("Your id is: "+l.id,this.context.alias??""),this._connectionId=l.id)}else console.warn("Expected connection id in "+e.key);break;case"joined-room":if(oo&&console.log(e),e){this._isInRoom=!0;const l=e;this._currentRoomName=l.room,this._currentRoomViewId=l.viewId,this._currentRoomAllowEditing=l.allowEditing??!0,this._currentInRoom.length=0,this._currentInRoom.push(...l.inRoom),(WR||nt())&&console.debug("Joined Needle Engine Room: "+l.room);const c=new URL(window.location.href);c.searchParams.has("room")&&c.searchParams.delete("room"),c.searchParams.set("view",this._currentRoomViewId),console.debug(`Room view id: ${this._currentRoomViewId}
${c.href}`)}this.onSendQueued(Bl.OnRoomJoin);break;case"left-room":e.room===this.currentRoomName&&(this._isInRoom=!1,this._currentRoomName=null,this._currentInRoom.length=0);break;case"user-joined-room":if(e.data){const l=e.data;this._currentInRoom.push(l.userId),oo&&console.log(l.userId+" joined","now in room:",this._currentInRoom)}break;case"user-left-room":if(e.data){const l=e.data,c=this._currentInRoom.indexOf(l.userId);c>=0&&(oo&&console.log(l.userId+" left","now in room:",this._currentInRoom),this._currentInRoom.splice(c,1)),l.userId===this.connectionId&&console.log("you left the room")}break;case"all-room-state-deleted":oo&&console.log("RECEIVED all-room-state-deleted"),this._state={};break;case"ping":case"pong":const a=(n=e.data)==null?void 0:n.time;a&&(this._currentDelay=this.context.time.time-a),oo&&console.log("Current latency: "+this._currentDelay.toFixed(4)+" sec","Clients in room: "+((r=this._currentInRoom)==null?void 0:r.length));break}const t=e.data;t&&(this._state[t.guid]=t);let i=this._listeners[e.key];if(i){i=[...i];for(const o of i)try{o(e.data)}catch(a){console.error('Error invoking callback for "'+e.key+'"',a)}}}toMessage(e,t){return{key:e,data:t}}sendWithWebsocket(e,t,i=Bl.OnRoomJoin){if(!this._ws){const r=this._waitingForSocket[i]||[];r.push(()=>this.sendWithWebsocket(e,t,i)),this._waitingForSocket[i]=r;return}const n=JSON.stringify(this.toMessage(e,t));oo&&console.log(">>",e),this._ws.send(n)}onSendQueued(e){const t=this._waitingForSocket[e];if(t){for(const i of t)i();t.length=0}}}const i_=ie("debugwebxr");class jR{constructor(e,t){d(this,"controllerStates",[]);d(this,"userId");d(this,"context");d(this,"userStateEvtName");d(this,"onReceivedControllerState",e=>{i_&&console.log(`XRSync: Received change for ${this.userId}: ${e.type} ${e.handedness}; tracked=${e.isTracking}`);let t=!1;for(let i=0;i<this.controllerStates.length;i++)if(this.controllerStates[i].index===e.index){this.controllerStates[i]=e,t=!0;break}t||this.controllerStates.push(e)});this.userId=e,this.context=t,this.userStateEvtName="xr-sync-user-state-"+e,this.context.connection.beginListen(this.userStateEvtName,this.onReceivedControllerState)}dispose(){this.context.connection.stopListen(this.userStateEvtName,this.onReceivedControllerState)}update(e){if(this.context.connection.isConnected!=!1){for(let t=this.controllerStates.length-1;t>=0;t--){const i=this.controllerStates[t];let n=!1;for(let r=0;r<e.controllers.length;r++)e.controllers[r].index===i.index&&(n=!0);n||(i_&&console.log(`XRSync: ${i.type} ${i.handedness} removed`,i.index),this.controllerStates.splice(t,1),this.sendControllerRemoved(i))}for(const t of e.controllers)this.updateControllerStates(t)}}onExitXR(e){for(const t of this.controllerStates)this.sendControllerRemoved(t);this.controllerStates.length=0}sendControllerRemoved(e){e.isTracking=!1,e.guid="",this.context.connection.send(this.userStateEvtName,e),this.context.connection.sendDeleteRemoteState(e.guid)}updateControllerStates(e){const t=this.controllerStates.find(i=>i.index===e.index);if(t){let i=!1;i||(i=t.isTracking!=e.isTracking),i&&(t.isTracking=e.isTracking,this.context.connection.send(this.userStateEvtName,t))}else{const i={guid:this.userId+"-"+e.index,isTracking:e.isTracking,handedness:e.side,index:e.index,type:e.hand?"hand":"controller"};this.controllerStates.push(i),this.context.connection.send(this.userStateEvtName,i),i_&&console.log(`XRSync: ${i.type} ${i.handedness} added`,i.index)}}}class Hj{constructor(e){d(this,"context");d(this,"onJoinedRoom",()=>{if(this.context.connection.connectionId){this._states.has(this.context.connection.connectionId)||(i_&&console.log("XRSync: Local user joined room",this.context.connection.connectionId),this._states.set(this.context.connection.connectionId,new jR(this.context.connection.connectionId,this.context)));for(const e of this.context.connection.usersInRoom())this._states.has(e)||this._states.set(e,new jR(e,this.context))}});d(this,"onLeftRoom",()=>{if(this.context.connection.connectionId&&!this._states.has(this.context.connection.connectionId)){const e=this._states.get(this.context.connection.connectionId);e==null||e.dispose(),this._states.delete(this.context.connection.connectionId)}});d(this,"onOtherUserJoinedRoom",e=>{const t=e.userId;this._states.has(t)||(i_&&console.log("XRSync: Remote user joined room",t),this._states.set(t,new jR(t,this.context)))});d(this,"onOtherUserLeftRoom",e=>{const t=e.userId;if(!this._states.has(t)){const i=this._states.get(t);i==null||i.dispose(),this._states.delete(t)}});d(this,"_states",new Map);this.context=e,this.context.connection.beginListen(Qt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Qt.LeftRoom,this.onLeftRoom),this.context.connection.beginListen(Qt.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.beginListen(Qt.UserLeftRoom,this.onOtherUserLeftRoom)}hasState(e){return e?this._states.has(e):!1}isTracking(e,t){if(!e)return;const i=this._states.get(e);if(!i)return;const n=i.controllerStates.find(r=>r.handedness===t);return(n==null?void 0:n.isTracking)||!1}getDeviceType(e,t){if(!e)return;const i=this._states.get(e);if(!i)return;const n=i.controllerStates.find(r=>r.handedness===t);return(n==null?void 0:n.type)||"unknown"}destroy(){this.context.connection.stopListen(Qt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Qt.LeftRoom,this.onLeftRoom),this.context.connection.stopListen(Qt.UserJoinedRoom,this.onOtherUserJoinedRoom),this.context.connection.stopListen(Qt.UserLeftRoom,this.onOtherUserLeftRoom)}onUpdate(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const t=this._states.get(this.context.connection.connectionId);t==null||t.update(e)}}onExitXR(e){if(this.context.connection.isConnected&&this.context.connection.connectionId){const t=this._states.get(this.context.connection.connectionId);t==null||t.onExitXR(e)}}}class z4{constructor(){d(this,"_fadeToColorQuad");d(this,"_fadeToColorMaterial");d(this,"_requestedFadeValue",0);d(this,"_transitionPromise",null);d(this,"_transitionResolve",null);this._fadeToColorMaterial=new ti({color:0,transparent:!0,depthTest:!1,fog:!1,side:_i}),this._fadeToColorQuad=new fe(new ps(10,10),this._fadeToColorMaterial)}dispose(){this._fadeToColorQuad.geometry.dispose(),this._fadeToColorMaterial.dispose()}update(e,t){const i=this._fadeToColorQuad,n=this._fadeToColorMaterial;i.parent!==e&&n.opacity>0?e.add(i):n.opacity===0&&i.removeFromParent(),i.layers.set(2),i.material=this._fadeToColorMaterial,i.position.z=-1,i.renderOrder=1/0;const r=this._requestedFadeValue;n.opacity=it.lerp(n.opacity,r,t/.03),Math.abs(n.opacity-r)<=.01&&this._transitionResolve&&(this._transitionResolve(),this._transitionResolve=null,this._transitionPromise=null,this._requestedFadeValue=0)}remove(){this._fadeToColorQuad.removeFromParent()}fadeTransition(){if(this._transitionPromise)return this._transitionPromise;this._requestedFadeValue=1;const e=new Promise(t=>{this._transitionResolve=t});return this._transitionPromise=e,e}}class Nde extends bv{constructor(e,t={}){const i=t.font;if(i===void 0)super();else{const n=i.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(n,t)}this.type="TextGeometry"}}class zde extends ds{constructor(e){super(e)}load(e,t,i,n){const r=this,o=new yr(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){const l=r.parse(JSON.parse(a));t&&t(l)},i,n)}parse(e){return new Vj(e)}}class Vj{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const i=[],n=Gde(e,t,this.data);for(let r=0,o=n.length;r<o;r++)i.push(...n[r].toShapes());return i}}function Gde(s,e,t){const i=Array.from(s),n=e/t.resolution,r=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*n,o=[];let a=0,l=0;for(let c=0;c<i.length;c++){const h=i[c];if(h===`
`)a=0,l-=r;else{const u=Hde(h,n,a,l,t);a+=u.offsetX,o.push(u.path)}}return o}function Hde(s,e,t,i,n){const r=n.glyphs[s]||n.glyphs["?"];if(!r){console.error('THREE.Font: character "'+s+'" does not exists in font family '+n.familyName+".");return}const o=new y6;let a,l,c,h,u,f,p,m;if(r.o){const v=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let g=0,y=v.length;g<y;)switch(v[g++]){case"m":a=v[g++]*e+t,l=v[g++]*e+i,o.moveTo(a,l);break;case"l":a=v[g++]*e+t,l=v[g++]*e+i,o.lineTo(a,l);break;case"q":c=v[g++]*e+t,h=v[g++]*e+i,u=v[g++]*e+t,f=v[g++]*e+i,o.quadraticCurveTo(u,f,c,h);break;case"b":c=v[g++]*e+t,h=v[g++]*e+i,u=v[g++]*e+t,f=v[g++]*e+i,p=v[g++]*e+t,m=v[g++]*e+i,o.bezierCurveTo(u,f,p,m,c,h);break}}return{offsetX:r.ha*e,path:o}}var om=(s=>(s[s.Quad=0]="Quad",s[s.Cube=1]="Cube",s[s.Sphere=2]="Sphere",s[s.RoundedCube=10]="RoundedCube",s))(om||{});const wS=new Map;function Vde(s){let e="";switch(s){default:case"OpenSans":e="https://cdn.needle.tools/static/fonts/facetype/Open Sans_Regular_ascii.json";break;case"Helvetiker":e="https://raw.githubusercontent.com/mrdoob/three.js/master/examples/fonts/helvetiker_regular.typeface.json";break}if(wS.has(e)){const n=wS.get(e);if(n)return n}const t=new zde,i=new Promise((n,r)=>{t.load(e,o=>{wS.set(e,o),n(o)},void 0,r)});return wS.set(e,i),i}var yb,dD;class Iv{static createText(e,t){let i=null;const n=(t==null?void 0:t.font)||Vde((t==null?void 0:t.familyFamily)||null);n instanceof Vj?i=Cf(this,yb,dD).call(this,e,n,t):i==null&&(i=new yt);const r=(t==null?void 0:t.color)||16777215,o=new fe(i,(t==null?void 0:t.material)??new ws({color:r}));return this.applyDefaultObjectOptions(o,t),n instanceof Promise?n.then(a=>{o.geometry=Cf(this,yb,dD).call(this,e,a,t),t!=null&&t.onGeometry&&t.onGeometry(o)}):t!=null&&t.onGeometry&&t.onGeometry(o),o}static createOccluder(e){const t=new ws({colorWrite:!1,depthWrite:!0,side:_i});return this.createPrimitive(e,{material:t})}static createPrimitive(e,t){let i;const n=(t==null?void 0:t.color)||16777215;switch(e){case"Quad":case 0:{const r=new ps(1,1,1,1),o=(t==null?void 0:t.material)??new ws({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new fe(r,o)}break;case"Cube":case 1:{const r=new Ki(1,1,1),o=(t==null?void 0:t.material)??new ws({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new fe(r,o)}break;case 10:case"RoundedCube":{const r=Qde(1,1,1,.1,2),o=(t==null?void 0:t.material)??new ws({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new fe(r,o)}break;case"Sphere":case 2:{const r=new cl(.5,16,16),o=(t==null?void 0:t.material)??new ws({color:n});t!=null&&t.texture&&"map"in o&&(o.map=t.texture),i=new fe(r,o)}break}return this.applyDefaultObjectOptions(i,t),i}static createSprite(e){const i=new iM({color:16777215});e!=null&&e.texture&&"map"in i&&(i.map=e.texture);const n=new JO(i);return this.applyDefaultObjectOptions(n,e),n}static applyDefaultObjectOptions(e,t){e.receiveShadow=!0,e.castShadow=!0,t!=null&&t.name&&(e.name=t.name),t!=null&&t.position&&(Array.isArray(t.position)?e.position.set(t.position[0],t.position[1],t.position[2]):e.position.set(t.position.x,t.position.y,t.position.z)),t!=null&&t.rotation&&(Array.isArray(t.rotation)?e.rotation.set(t.rotation[0],t.rotation[1],t.rotation[2]):e.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z)),t!=null&&t.scale&&(typeof t.scale=="number"?e.scale.set(t.scale,t.scale,t.scale):e.scale.set(t.scale.x,t.scale.y,t.scale.z)),(t==null?void 0:t.receiveShadow)!=null&&(e.receiveShadow=t.receiveShadow),(t==null?void 0:t.castShadow)!=null&&(e.castShadow=t.castShadow),t!=null&&t.parent&&t.parent.add(e)}}yb=new WeakSet,dD=function(e,t,i){const n=(i==null?void 0:i.depth)||.1;return new Nde(e,{font:t,size:1,depth:n,height:n,bevelEnabled:(i==null?void 0:i.bevel)||!1,bevelThickness:.01,bevelOffset:.01,bevelSize:.01})},qo(Iv,yb);function Qde(s,e,t,i,n){const r=new Td,o=1e-5,a=i-o;r.absarc(o,o,o,-Math.PI/2,-Math.PI,!0),r.absarc(o,e-a*2,o,Math.PI,Math.PI/2,!0),r.absarc(s-a*2,e-a*2,o,Math.PI/2,0,!0),r.absarc(s-a*2,o,o,0,-Math.PI/2,!0);const l=new bv(r,{bevelEnabled:!0,bevelSegments:n*2,steps:1,bevelSize:a,bevelThickness:i,curveSegments:n});return l.scale(1,1,1-i),l.center(),l.computeVertexNormals(),l}const PU=class{constructor(e,t,i){d(this,"_session");d(this,"_mode");d(this,"_init");d(this,"_renderer");d(this,"_camera");d(this,"_scene");d(this,"onEnd",()=>{var e;(e=this._session)==null||e.removeEventListener("end",this.onEnd),this._renderer.setAnimationLoop(null),this._renderer.dispose(),this._scene.clear()});d(this,"_lastTime",0);d(this,"onFrame",(e,t)=>{const i=e-this._lastTime;this.update(e,i),this._camera.parent!==this._scene&&this._scene.add(this._camera),this._renderer.render(this._scene,this._camera)});d(this,"_objects",[]);this._mode=e,this._init=t,this._session=i,this._session.addEventListener("end",this.onEnd),this._renderer=new hu({alpha:!0}),this._renderer.setAnimationLoop(this.onFrame),this._renderer.xr.setSession(i),this._renderer.xr.enabled=!0,this._camera=new Vt,this._scene=new Ws,this._scene.fog=new tM(4473924,10,250),this._scene.add(this._camera),this.setupScene()}static get active(){return this._active}static async start(e,t){if(this._active)return console.error("Cannot start a new XR session while one is already active"),null;if(this._requestInFlight)return console.error("Cannot start a new XR session while a request is already in flight"),null;if("xr"in navigator&&navigator.xr){if(!t)return console.error("XRSessionInit must be provided"),null;this._requestInFlight=!0;const i=await navigator.xr.requestSession(e,t);return i.addEventListener("end",()=>{this._active=null}),this._requestInFlight?(this._requestInFlight=!1,this._active=new PU(e,t,i),this._active):(i.end(),null)}return null}static async handoff(){return this._active?this._active.handoff():null}static async stop(){this._requestInFlight=!1,this._active&&(await this._active.end(),await Nc(100)),this._active=null}get isAR(){return this._mode==="immersive-ar"}end(){return this._session?this._session.end():Promise.resolve()}async handoff(){if(!this._session)throw new Error("Cannot handoff a session that has already ended");const e={session:this._session,mode:this._mode,init:this._init};return await this.onBeforeHandoff(),this.onEnd(),this._session=null,e}async onBeforeHandoff(){await Nc(1e3),this._scene.clear()}setupScene(){this._scene.background=new Ae(0),this._scene.add(new SM(5,10,1118481,1118481));const e=new nm(16777215,1);e.position.set(0,20,0),e.castShadow=!1,this._scene.add(e);const t=new nm(16777215,1);t.position.set(0,-1,0),t.castShadow=!1,this._scene.add(t);const i=new im(16777215,1,100,1);i.position.set(0,2,0),i.castShadow=!1,i.distance=200,this._scene.add(i);const n=50;for(let r=0;r<100;r++){const o=new ws({color:2236962,metalness:1,roughness:.8});this.isAR&&(o.emissive=new Ae(Math.random(),Math.random(),Math.random()),o.emissiveIntensity=Math.random());const a=it.random(0,1)>.5?om.Sphere:om.Cube,l=Iv.createPrimitive(a,{material:o});l.position.x=it.random(-n,n),l.position.y=it.random(-2,n),l.position.z=it.random(-n,n),l.rotation.x=it.random(0,Math.PI*2),l.rotation.y=it.random(0,Math.PI*2),l.rotation.z=it.random(0,Math.PI*2),l.scale.multiplyScalar(.5+Math.random()*10);const c=l.position.distanceTo(this._camera.position)-l.scale.x;c<1&&l.position.multiplyScalar(1+1/c),this._objects.push(l),this._scene.add(l)}}update(e,t){const i=e*4e-4;for(let n=0;n<this._objects.length;n++){const r=this._objects[n];r.position.y+=Math.sin(i+n*.5)*.005,r.rotateY(.002)}}};let Ad=PU;d(Ad,"_active",null),d(Ad,"_requestInFlight",!1);const G4="NeedleXRSession onStart",H4="NeedleXRSession onEnd",ns=ie("debugwebxr"),V4=ie("stats");let qR=0;function Wde(s){let e=null;const t=s;return t.getAROverlayContainer?e=t.getAROverlayContainer():e=s,e}jde();async function jde(){var s;if(ie("debugasap")){let e=globalThis["needle:XRSession"];if(e instanceof Promise){delete globalThis["needle:XRSession"],mi.addContextCreatedCallback(async t=>{if(!e)return;Lp(!0);const i=await e;if(i){const n=Mt.getDefaultSessionInit("immersive-vr");Mt.setSession("immersive-vr",i,n,t.context)}else console.error("NeedleXRSession: ASAP session was rejected");e=void 0});return}}if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent)){console.warn("WebXRViewer does not support addEventListener");return}(s=navigator.xr)==null||s.addEventListener("sessiongranted",async()=>{Lp(!0),console.log("Received Session Granted..."),await Nc(100);const e=sessionStorage.getItem("needle_xr_session_mode"),t=sessionStorage.getItem("needle_xr_session_init")??null,i=t?JSON.parse(t):null;let n=null;if(Qj()&&(await Ad.start(e||"immersive-vr",i||Mt.getDefaultSessionInit("immersive-vr")),await Yde(),n=await Ad.handoff()),n)Mt.setSession(n.mode,n.session,n.init,Dt.Current);else if(e&&t){console.log("Session Granted: Restore last session");const r=JSON.parse(t);Mt.start(e,r).catch(o=>console.warn(o))}else Mt.start("immersive-vr").catch(r=>console.warn("Session Granted failed:",r))},{once:!0})}}function qde(s,e){sessionStorage.setItem("needle_xr_session_mode",s),sessionStorage.setItem("needle_xr_session_init",JSON.stringify(e))}function Xde(){sessionStorage.removeItem("needle_xr_session_mode"),sessionStorage.removeItem("needle_xr_session_init")}const Fk=new Set;mi.registerCallback(Ti.ContextCreationStart,async s=>{Fk.add(s.context)});mi.registerCallback(Ti.ContextCreated,async s=>{Fk.delete(s.context)});function Qj(){return Fk.size>0}function Yde(){return new Promise(s=>{const e=Date.now(),t=setInterval(()=>{(!Qj()||Date.now()-e>6e4)&&(clearInterval(t),s())},100)})}ev()&&nt()&&window.addEventListener("keydown",s=>{(s.key==="x"||s.key==="Escape")&&Mt.active&&Mt.stop()});const Lh=class{constructor(e,t,i,n){d(this,"context");d(this,"session");d(this,"mode");d(this,"controllers",[]);d(this,"_rigScale",1);d(this,"_lastRigScaleUpdate",-1);d(this,"_rigs",[]);d(this,"_viewerHitTestSource",null);d(this,"_defaultRig");d(this,"_xr_scripts");d(this,"_xr_update_scripts",[]);d(this,"_inactive_scripts",[]);d(this,"_controllerAdded");d(this,"_controllerRemoved");d(this,"_originalCameraWorldPosition");d(this,"_originalCameraWorldRotation");d(this,"_originalCameraWorldScale");d(this,"_originalCameraParent");d(this,"_mainCamera",null);d(this,"onRendererSessionSet",()=>{var e;this.running&&(this.context.renderer.xr.enabled=!0,this.context.renderer.xr.updateCamera(this.context.mainCamera),(e=this.context.mainCameraComponent)==null||e.applyClearFlags())});d(this,"onInputSourceAdded",e=>{if(e.targetRayMode==="screen")return;let t=0;for(let n=0;n<this.session.inputSources.length;n++)if(this.session.inputSources[n]===e){t=n;break}if(this.controllers.find(n=>n.inputSource===e)){console.warn("Controller already exists for input source",t);return}ns&&console.log("Adding controller",t);const i=new Mk(this,e,t);this._newControllers.push(i)});d(this,"_ended",!1);d(this,"_newControllers",[]);d(this,"onEnd",e=>{var n,r,o;if(this._ended)return;this._ended=!0,ns&&console.log("XR Session ended"),Xde(),this.onAfterRender(),this.revertCustomForward(),this._didStart=!1,this._previousCameraParent=null,af(this.onBefore,nn.LateUpdate);const t=this.context.pre_render_callbacks.indexOf(this.onBeforeRender);t>=0&&this.context.pre_render_callbacks.splice(t,1);const i=this.context.post_render_callbacks.indexOf(this.onAfterRender);i>=0&&this.context.post_render_callbacks.splice(i,1),this.context.xr=null,this.context.renderer.xr.enabled=!1,this.context.pre_update_oneshot_callbacks.push(()=>{var a,l;(a=this.context.mainCameraComponent)==null||a.applyClearFlags(),(l=this.context.mainCameraComponent)==null||l.applyClippingPlane()}),VW({session:this});for(const a of Lh._xrEndListeners)a({xr:this});for(let a=0;a<this.controllers.length;a++)this.disconnectInputSource(this.controllers[a].inputSource);for(const a of this._xr_scripts)(n=a==null?void 0:a.onLeaveXR)==null||n.call(a,{xr:this});(r=this.sync)==null||r.onExitXR(this),this.context.mainCamera&&((o=this._originalCameraParent)==null||o.add(this.context.mainCamera),this._originalCameraWorldPosition&&Es(this.context.mainCamera,this._originalCameraWorldPosition),this._originalCameraWorldRotation&&rl(this.context.mainCamera,this._originalCameraWorldRotation),this._originalCameraWorldScale&&sv(this.context.mainCamera,this._originalCameraWorldScale)),this.context.requestSizeUpdate(),this._defaultRig.gameObject.removeFromParent(),Lp(!1),performance.mark(H4),performance.measure("NeedleXRSession",G4,H4)});d(this,"_didStart",!1);d(this,"onBefore",e=>{var n,r,o,a,l,c,h,u;const t=e.xrFrame;if(!t)return;performance.mark("NeedleXRSession onBefore start"),this.context.xr=this,this.context.mainCameraComponent&&this.context.mainCameraComponent!==this._mainCamera&&(this._mainCamera=this.context.mainCameraComponent),((n=this.rig)==null?void 0:n.isActive)==!1&&(ns&&console.warn("Latest rig is not active - trying to activate a different rig",this.rig),this.updateActiveXRRig()),this.rig&&((r=this._mainCamera)!=null&&r.gameObject)&&((a=(o=this._mainCamera)==null?void 0:o.gameObject)==null?void 0:a.parent)!==this.rig.gameObject&&this.rig.gameObject.add((l=this._mainCamera)==null?void 0:l.gameObject),this.internalUpdateState(),this.applyCustomForward();const i={xr:this};if(this._didStart){if(this.context.new_scripts_xr.length>0){const f=[...this.context.new_scripts_xr];for(let p=0;p<f.length;p++){const m=this.context.new_scripts_xr[p];if(!m||m.destroyed||((c=m.supportsXR)==null?void 0:c.call(m,this.mode))==!1){this.context.new_scripts_xr.splice(p,1);continue}if(!m.activeAndEnabled){this.context.new_scripts_xr.splice(p,1),this.markInactive(m);continue}if(this.addScript(m)){this.invokeCallback_EnterXR(m);for(const v of this.controllers)this.invokeCallback_ControllerAdded(m,v)}}}}else{if(this._didStart=!0,this.mode==="immersive-vr"){const p=Hl(this.context.scene.children);if(p){const m=p.getSize(wt());if(m.length()>0){const v=this._defaultRig.gameObject;v.position.set(p.min.x+m.x*.5,p.min.y,p.max.z+m.z*.5+1.5);const g=p.getCenter(wt());g.y=v.position.y,v.lookAt(g)}}}HW({session:this});for(const p of Lh._xrStartListeners)p(i);const f=[...this._xr_scripts];ns&&console.log("NeedleXRSession start, handle scripts:",f);for(const p of f){if(p.destroyed){this._script_to_remove.push(p);continue}if(!p.activeAndEnabled){this.markInactive(p);continue}this.invokeCallback_EnterXR(p);for(const m of this.controllers)this.invokeCallback_ControllerAdded(p,m)}}this.syncCameraCullingMask();for(const f of this.controllers)f.onUpdate(t);if(this._newControllers.length>0){const f=[...this._newControllers];this._newControllers.length=0;for(const p of f){if(!p.connected){console.warn("New controller is not connected",p);continue}this.controllers.push(p);for(const m of this._xr_scripts){if(m.destroyed){this._script_to_remove.push(m);continue}m.activeAndEnabled!==!1&&this.invokeCallback_ControllerAdded(m,p)}}this.controllers.sort((p,m)=>p.index-m.index)}ns&&this.context.time.frame%30===0&&this.controllers.length<=0&&this.session.inputSources.length>0&&(Lp(!0),console.error("XRControllers are not added but inputSources are present")),performance.mark("NeedleXRSession update scripts start");for(const f of this._xr_update_scripts){if(f.destroyed===!0){this._script_to_remove.push(f);continue}if(f.activeAndEnabled===!1){this.markInactive(f);continue}f.onUpdateXR&&f.onUpdateXR(i)}if(performance.mark("NeedleXRSession update scripts end"),performance.measure("NeedleXRSession update scripts","NeedleXRSession update scripts start","NeedleXRSession update scripts end"),this.handleInactiveScripts(),this._script_to_remove.length>0){const f=[...new Set(this._script_to_remove)];this._script_to_remove.length=0;for(const p of f)!p.destroyed&&this.running&&((h=p.onLeaveXR)==null||h.call(p,i)),this.removeScript(p)}(u=this.sync)==null||u.onUpdate(this),this.onRenderDebug(),performance.mark("NeedleXRSession onBefore end"),performance.measure("NE XR frame","NeedleXRSession onBefore start","NeedleXRSession onBefore end")});d(this,"onBeforeRender",()=>{this.context.mainCamera&&this.updateFade(this.context.mainCamera)});d(this,"onAfterRender",()=>{if(this.onUpdateFade_PostRender(),ev()||!this._renderOnceOnDevice){const e=this.context.renderer;if(e.xr.isPresenting&&this.context.mainCamera){this._renderOnceOnDevice=!0;const t=e.xr.enabled,i=e.getRenderTarget(),n=this.context.scene.background;e.xr.enabled=!1,e.setRenderTarget(null),this.isPassThrough&&(this.context.scene.background=null),this.context.composer?this.context.composer.render(this.context.time.deltaTime):e.render(this.context.scene,this.context.mainCamera),e.xr.enabled=t,e.setRenderTarget(i),this.context.scene.background=n}}});d(this,"_script_to_remove",[]);d(this,"_camera");d(this,"_cameraRenderParent",new ye().rotateY(Math.PI));d(this,"_previousCameraParent");d(this,"_customforward",!0);d(this,"originalCameraNearPlane");d(this,"_viewerPose");d(this,"_transformOrientation",new Ce);d(this,"_transformPosition",new S);d(this,"_transition");var r,o;performance.mark(G4),qde(e,n.init),this.session=t,this.mode=e,this.context=i,(ns||ie("console"))&&Lp(!0),this._xr_scripts=[...n.scripts],this._xr_update_scripts=this._xr_scripts.filter(a=>typeof a.onUpdateXR=="function"),this._controllerAdded=n.controller_added,this._controllerRemoved=n.controller_removed,of(this.onBefore,nn.LateUpdate),this.context.pre_render_callbacks.push(this.onBeforeRender),this.context.post_render_callbacks.push(this.onAfterRender),((r=n.init.optionalFeatures)!=null&&r.includes("hit-test")||(o=n.init.requiredFeatures)!=null&&o.includes("hit-test"))&&t.requestReferenceSpace("viewer").then(a=>{var l,c;return(c=(l=t.requestHitTestSource)==null?void 0:l.call(t,{space:a}))==null?void 0:c.then(h=>this._viewerHitTestSource=h)}).catch(a=>console.warn(a)),this.context.mainCamera&&(this._originalCameraWorldPosition=Ft(this.context.mainCamera,new S),this._originalCameraWorldRotation=ki(this.context.mainCamera,new Ce),this._originalCameraWorldScale=$i(this.context.mainCamera,new S),this._originalCameraParent=this.context.mainCamera.parent),this._defaultRig=new que,this.context.scene.add(this._defaultRig.gameObject),this.addRig(this._defaultRig);for(let a=0;a<t.inputSources.length;a++){const l=t.inputSources[a];if(!l.handedness){console.warn("Input source in xr session has no handedness - ignoring",a);continue}this.onInputSourceAdded(l)}this.session.addEventListener("end",this.onEnd),this.session.addEventListener("inputsourceschange",a=>{for(const l of a.removed)this.disconnectInputSource(l);for(const l of a.added)this.onInputSourceAdded(l)}),this.context.xr=this,this.context.renderer.xr.setSession(this.session).then(this.onRendererSessionSet),"controllerAutoUpdate"in this.context.renderer.xr?(console.debug("Disabling three.js controllerAutoUpdate"),this.context.renderer.xr.controllerAutoUpdate=!1):ns&&console.warn("controllerAutoUpdate is not available in three.js - cannot disable it")}static getXRSync(e){return this._sync||(this._sync=new Hj(e)),this._sync}static get currentSessionRequest(){return this._currentSessionRequestMode}static get active(){return this._activeSession}static get activeMode(){var e;return((e=this._activeSession)==null?void 0:e.mode)??null}static get xrSystem(){return"xr"in navigator?navigator.xr:void 0}static isXRSupported(){return Promise.all([this.isVRSupported(),this.isARSupported()]).then(e=>e.some(t=>t)).catch(()=>!1)}static isVRSupported(){return this.isSessionSupported("immersive-vr")}static isARSupported(){return this.isSessionSupported("immersive-ar")}static isSessionSupported(e){var t;return((t=this.xrSystem)==null?void 0:t.isSessionSupported(e).catch(i=>(ns&&console.error(i),!1)))??Promise.resolve(!1)}static onSessionRequestStart(e){this._sessionRequestStartListeners.push(e)}static offSessionRequestStart(e){const t=this._sessionRequestStartListeners.indexOf(e);t>=0&&this._sessionRequestStartListeners.splice(t,1)}static onSessionRequestEnd(e){this._sessionRequestEndListeners.push(e)}static offSessionRequestEnd(e){const t=this._sessionRequestEndListeners.indexOf(e);t>=0&&this._sessionRequestEndListeners.splice(t,1)}static onXRSessionStart(e){this._xrStartListeners.push(e)}static offXRSessionStart(e){const t=this._xrStartListeners.indexOf(e);t>=0&&this._xrStartListeners.splice(t,1)}static onXRSessionEnd(e){this._xrEndListeners.push(e)}static offXRSessionEnd(e){const t=this._xrEndListeners.indexOf(e);t>=0&&this._xrEndListeners.splice(t,1)}static onControllerAdded(e){this._controllerAddedListeners.push(e)}static offControllerAdded(e){const t=this._controllerAddedListeners.indexOf(e);t>=0&&this._controllerAddedListeners.splice(t,1)}static onControllerRemoved(e){this._controllerRemovedListeners.push(e)}static offControllerRemoved(e){const t=this._controllerRemovedListeners.indexOf(e);t>=0&&this._controllerRemovedListeners.splice(t,1)}static offerSession(e,t,i){return"xr"in navigator&&navigator.xr&&"offerSession"in navigator.xr?(typeof navigator.xr.offerSession=="function"&&(console.log("WebXR offerSession is available - requesting mode: "+e),t=="default"&&(t=this.getDefaultSessionInit(e)),navigator.xr.offerSession(e,{...t}).then(n=>Lh.setSession(e,n,t,i)).catch(n=>{console.log("XRSession offer rejected (perhaps because another call to offerSession was made or a call to requestSession was made)")})),!0):!1}static getDefaultSessionInit(e){switch(e){case"immersive-ar":return{optionalFeatures:["anchors","local-floor","hand-tracking","layers","dom-overlay","hit-test","unbounded"]};case"immersive-vr":return{optionalFeatures:["local-floor","bounded-floor","hand-tracking","high-fixed-foveation-level","layers"]};default:return console.warn("No default session init for mode",e),{}}}static async start(e,t,i){var a,l,c,h;if(nt()&&ie("debugxrpreroom"))return console.warn("Debug: Starting temporary XR session"),await Ad.start(e,t||Lh.getDefaultSessionInit(e)),null;if(this._currentSessionRequest)return console.warn("A XRSession is already being requested"),(ns||nt())&&Fi("A XRSession is already being requested"),this._currentSessionRequest.then(()=>this._activeSession);if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;if(i||(i=Dt.Current),i||(i=mi.All[0]),!i)throw new Error("No Needle Engine Context found");switch(performance.mark("NeedleXRSession start"),t||(t={}),e){case"immersive-ar":{if(await((a=this.xrSystem)==null?void 0:a.isSessionSupported("immersive-ar"))!==!0)return console.error(e+" is not supported by this browser."),null;const f=this.getDefaultSessionInit(e),p=Wde(i.domElement);p&&!MM()&&(f.domOverlay={root:p},f.optionalFeatures.push("dom-overlay")),t={...f,...t}}break;case"immersive-vr":{if(await((l=this.xrSystem)==null?void 0:l.isSessionSupported("immersive-vr"))!==!0)return console.error(e+" is not supported by this browser."),null;t={...this.getDefaultSessionInit(e),...t}}break;default:console.warn("No default session init for mode",e);break}t.optionalFeatures??(t.optionalFeatures=[]),t.requiredFeatures??(t.requiredFeatures=[]),await Ad.stop();const n=e=="immersive-ar"?i.scripts_immersive_ar:i.scripts_immersive_vr;ns?console.log(`%cRequesting ${e} session`,"font-weight:bold;",t,n):console.log(`%cRequesting ${e} session`,"font-weight:bold;");for(const u of n)u.onBeforeXR&&u.onBeforeXR(e,t);for(const u of this._sessionRequestStartListeners)u({mode:e,init:t});ns&&_n("Requesting "+e+" session ("+Date.now()+")"),this._currentSessionRequest=(c=navigator.xr)==null?void 0:c.requestSession(e,t),this._currentSessionRequestMode=e;const r=await((h=this._currentSessionRequest)==null?void 0:h.catch(u=>{console.error(u,"Code: "+u.code),u.code===9&&Fi("Make sure your device has the required permissions (e.g. camera access)"),console.log("If the specified XR configuration is not supported (e.g. entering AR doesnt work) - make sure you access the website on a secure connection (HTTPS) and your device has the required permissions (e.g. camera access)"),location.protocol==="http:"&&Fi("XR requires a secure connection (HTTPS)")}));this._currentSessionRequest=void 0,this._currentSessionRequestMode=null;for(const u of this._sessionRequestEndListeners)u({mode:e,init:t,newSession:r||null});if(!r)return console.warn("XR Session request was rejected"),null;const o=this.setSession(e,r,t,i);return performance.mark("NeedleXRSession end"),performance.measure("NeedleXRSession Startup","NeedleXRSession start","NeedleXRSession end"),o}static setSession(e,t,i,n){if(this._activeSession)return console.error("A XRSession is already running"),this._activeSession;const r=e=="immersive-ar"?n.scripts_immersive_ar:n.scripts_immersive_vr;return this._activeSession=new Lh(e,t,n,{scripts:r,controller_added:this._controllerAddedListeners,controller_removed:this._controllerRemovedListeners,init:i}),t.addEventListener("end",this.onEnd),ns?console.log(`%cStarted ${e} session`,"font-weight:bold;",r):console.log(`%cStarted ${e} session`,"font-weight:bold;"),this._activeSession}static stop(){var e;(e=this._activeSession)==null||e.end()}get sync(){return Lh._sync}get running(){return!this._ended&&this.session!=null}get interactionMode(){return this.session.interactionMode}get visibilityState(){return this.session.visibilityState}get isVisibleBlurred(){return this.session.visibilityState==="visible-blurred"}get isSystemKeyboardSupported(){return this.session.isSystemKeyboardSupported}get environmentBlendMode(){return this.session.environmentBlendMode}get frame(){return this.context.xrFrame}get leftController(){return this.controllers.find(e=>e.side==="left")}get rightController(){return this.controllers.find(e=>e.side==="right")}getController(e){return typeof e=="number"?this.controllers[e]||null:this.controllers.find(t=>t.side===e)||null}get isPassThrough(){return!!(this.environmentBlendMode!=="opaque"&&this.interactionMode==="world-space"||this.mode==="immersive-ar"&&this.environmentBlendMode!=="opaque"&&this.controllers.some(e=>e.inputSource.targetRayMode==="tracked-pointer")||nt()&&ev()&&this.mode==="immersive-ar")}get isAR(){return this.mode==="immersive-ar"}get isVR(){return this.mode==="immersive-vr"}get isScreenBasedAR(){return this.isAR&&!this.isPassThrough}get posePosition(){return this._transformPosition}get poseOrientation(){return this._transformOrientation}get referenceSpace(){return this.context.renderer.xr.getReferenceSpace()}get viewerPose(){return this._viewerPose}get isTrackingImages(){if(this.frame&&"getImageTrackingResults"in this.frame&&typeof this.frame.getImageTrackingResults=="function")try{const e=this.frame.getImageTrackingResults();for(const t of e)if(t.trackingState==="tracked")return!0}catch{return!1}return!1}get rig(){const e=this._rigs[0]??null;return e!=null&&e.gameObject&&am(e.gameObject)||(e==null?void 0:e.isActive)===!1?(this.updateActiveXRRig(),this._rigs[0]??null):e}get rigScale(){return this._rigs[0]?(this._lastRigScaleUpdate!==this.context.time.frame&&(this._lastRigScaleUpdate=this.context.time.frame,this._rigScale=this._rigs[0].gameObject.worldScale.x),this._rigScale):1}addRig(e){this._rigs.indexOf(e)>=0||(e.priority===void 0&&(e.priority=0),this._rigs.push(e),this.updateActiveXRRig())}removeRig(e){const t=this._rigs.indexOf(e);t!==-1&&(this._rigs.splice(t,1),this.updateActiveXRRig())}setRigActive(e){const t=this._rigs.indexOf(e);this._rigs.splice(t,1),this._rigs.unshift(e),this.updateActiveXRRig()}getUserOffsetInRig(){var i;const e=(i=this.context.mainCamera)==null?void 0:i.position;if(!e||!this.rig)return wt(0,0,0);const t=wt(e);return t.x*=-1,t.z*=-1,t.applyQuaternion(fc(this.rig.gameObject.quaternion)),t}updateActiveXRRig(){const e=this._rigs[0]??null;this._defaultRig.gameObject.parent!==this.context.scene&&this.context.scene.add(this._defaultRig.gameObject),this._defaultRig.gameObject.visible=!0,this._rigs.includes(this._defaultRig)||this._rigs.push(this._defaultRig);let t=this._rigs[0];t&&t.priority===void 0&&(t.priority=0);for(let i=1;i<this._rigs.length;i++){const n=this._rigs[i];if(n.isActive){if(am(n.gameObject)){this._rigs.splice(i,1),i--;continue}(!t||t.isActive===!1||n.priority!==void 0&&n.priority>t.priority)&&(t=n)}}if(e!==t){const i=this._rigs.indexOf(t);i>=0&&this._rigs.splice(i,1),this._rigs.unshift(t)}ns&&(e===t?console.log("Updated Active XR Rig:",t,"prev:",e):console.log("Updated Active XRRig:",t," (the same as before)"))}getHitTest(e){if(e)return this.getControllerHitTest(e);if(!this._viewerHitTestSource)return null;const t=this._viewerHitTestSource,i=this.frame.getHitTestResults(t);if(i.length>0){const n=i[0];return this.convertHitTestResult(n)}return null}getControllerHitTest(e){const t=e.getHitTestSource();if(!t)return null;const i=this.frame.getHitTestResultsForTransientInput(t);for(const n of i)if(n.inputSource===e.inputSource)for(const r of n.results)return this.convertHitTestResult(r);return null}convertHitTestResult(e){const t=this.context.renderer.xr.getReferenceSpace(),i=t&&e.getPose(t);if(i){const n=wt(i.transform.position),r=fc(i.transform.orientation),o=this.context.mainCamera;if((o==null?void 0:o.parent)!==this._cameraRenderParent&&n.applyMatrix4(ky),o!=null&&o.parent){n.applyMatrix4(o.parent.matrixWorld),r.multiply(dc);const a=ki(o.parent);a.premultiply(dc),r.premultiply(a)}return{hit:e,position:n,quaternion:r}}return null}convertSpace(e){const t=wt(e.position);t.applyMatrix4(ky);const i=fc(e.orientation);return i.premultiply(dc),{position:t,quaternion:i}}disconnectInputSource(e){const t=(i,n,r)=>{if(i.inputSource===e){ns&&console.log("Disconnecting controller",i.index),this.controllers.splice(r,1),this.invokeControllerEvent(i,this._controllerRemoved,"removed");const o={xr:this,controller:i,change:"removed"};for(const a of this._xr_scripts)a.onXRControllerRemoved&&a.onXRControllerRemoved(o);i.onDisconnected()}};for(let i=this.controllers.length-1;i>=0;i--){const n=this.controllers[i];t(n,this.controllers,i)}for(let i=this._newControllers.length-1;i>=0;i--){const n=this._newControllers[i];t(n,this._newControllers,i)}}end(){this._ended||this.session.end().catch(e=>console.warn(e))}onRenderDebug(){if(ns)for(const e of this.controllers)e.onRenderDebug();if((ns||V4)&&this.rig&&(qR++,qR>=20)){const e=this.rig.gameObject.worldPosition,t=this.rig.gameObject.worldForward;e.add(t.multiplyScalar(1.5));const i=this.rig.gameObject.worldUp;e.add(i.multiplyScalar(2.5));let n="";if(n+=`${this.context.time.smoothedFps.toFixed(0)} FPS`,n+=`, calls: ${this.context.renderer.info.render.calls}, tris: ${this.context.renderer.info.render.triangles.toLocaleString()}`,ns||V4)for(const r of this.controllers)n+=`
${r.hand?"hand":"ctrl"} ${r.inputSource.handedness}[${r.index}] con:${r.connected} tr:${r.isTracking} hts:${r.hasHitTestSource?"yes":"no"}`;qR=0,_t.DrawLabel(e,n,void 0,1/60*20)}}addScript(e){return this._xr_scripts.includes(e)?!1:(ns&&console.log("Register new XRScript",e),this._xr_scripts.push(e),typeof e.onUpdateXR=="function"&&this._xr_update_scripts.push(e),!0)}markInactive(e){if(!(this._inactive_scripts.indexOf(e)>=0)){this.removeScript(e,!1),this._inactive_scripts.push(e);for(const t of this.controllers)this.invokeCallback_ControllerRemoved(e,t);this.invokeCallback_LeaveXR(e)}}handleInactiveScripts(){if(this._inactive_scripts.length>0)for(let e=this._inactive_scripts.length-1;e>=0;e--){const t=this._inactive_scripts[e];if(t.activeAndEnabled){this._inactive_scripts.splice(e,1),this.addScript(t),this.invokeCallback_EnterXR(t);for(const i of this.controllers)this.invokeCallback_ControllerAdded(t,i)}}}removeScript(e,t=!0){ns&&console.log("Remove XRScript",e);const i=this._xr_scripts.indexOf(e);i>=0&&this._xr_scripts.splice(i,1);const n=this._xr_update_scripts.indexOf(e);if(n>=0&&this._xr_update_scripts.splice(n,1),t){const r=this._inactive_scripts.indexOf(e);r>=0&&this._inactive_scripts.splice(r,1)}}invokeCallback_EnterXR(e){e.onEnterXR&&e.onEnterXR({xr:this})}invokeCallback_ControllerAdded(e,t){e.onXRControllerAdded&&e.onXRControllerAdded({xr:this,controller:t,change:"added"})}invokeCallback_ControllerRemoved(e,t){e.onXRControllerRemoved&&e.onXRControllerRemoved({xr:this,controller:t,change:"removed"})}invokeCallback_LeaveXR(e){e.onLeaveXR&&!e.destroyed&&e.onLeaveXR({xr:this})}syncCameraCullingMask(){var i;const e=this.context.xrCamera,t=(i=this.context.mainCameraComponent)==null?void 0:i.cullingMask;if(e&&t!==void 0){for(const n of e.cameras)n.layers.mask=t;e.layers.mask=t}else if(e){for(const n of e.cameras)n.layers.enableAll();e.layers.enableAll()}}invokeControllerEvent(e,t,i){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r)try{r({xr:this,controller:e,change:i})}catch(o){console.error(o)}}}applyCustomForward(){var e;if(this.context.mainCamera&&this._customforward){this._camera=this.context.mainCamera,this._camera.parent!==this._cameraRenderParent&&(this._previousCameraParent=this._camera.parent,(e=this._previousCameraParent)==null||e.add(this._cameraRenderParent)),this._cameraRenderParent.name="XR Camera Render Parent",this._cameraRenderParent.add(this._camera);let t=.02;if(this.rig){const i=$i(this.rig.gameObject);t*=i.x}this._camera instanceof Vt&&this._camera.near>t&&(this.originalCameraNearPlane=this._camera.near,this._camera.near=t)}}revertCustomForward(){this._camera&&this._previousCameraParent&&this._previousCameraParent.add(this._camera),this._previousCameraParent=null,this._camera instanceof Vt&&this.originalCameraNearPlane!=null&&(this._camera.near=this.originalCameraNearPlane)}internalUpdateState(){const e=this.context.renderer.xr.getReferenceSpace();if(!e){this._viewerPose=void 0;return}if(this._viewerPose=this.frame.getViewerPose(e),this._viewerPose){const t=this._viewerPose.transform;this._transformPosition.set(t.position.x,t.position.y,t.position.z),this._transformOrientation.set(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w)}}get transition(){return this._transition||(this._transition=new z4),this._transition}fadeTransition(){return this._transition||(this._transition=new z4),this._transition.fadeTransition()}updateFade(e){this._transition&&e instanceof Vt&&this._transition.update(e,this.context.time.deltaTime)}onUpdateFade_PostRender(){var e;(e=this._transition)==null||e.remove()}};let Mt=Lh;d(Mt,"_sync",null),d(Mt,"_currentSessionRequestMode",null),d(Mt,"_currentSessionRequest"),d(Mt,"_activeSession"),d(Mt,"_sessionRequestStartListeners",[]),d(Mt,"_sessionRequestEndListeners",[]),d(Mt,"_xrStartListeners",[]),d(Mt,"_xrEndListeners",[]),d(Mt,"_controllerAddedListeners",[]),d(Mt,"_controllerRemovedListeners",[]),d(Mt,"onEnd",()=>{ns&&console.log("XR Session ended"),Lh._activeSession=null});const XR=ie("debugwebxr");class Wj{static tryFindAvatarObjects(e,t,i){if(i.head&&i.leftHand&&i.rightHand)return;const n=e.name.toLocaleLowerCase();!i.head&&n.includes("head")&&(XR&&console.log("FOUND AVATAR HEAD",e.name),i.head=new ei("",t,e)),n.includes("hand")&&(!i.leftHand&&n.includes("left")&&(XR&&console.log("FOUND AVATAR LEFT HAND",e.name),i.leftHand=new ei("",t,e)),!i.rightHand&&n.includes("right")&&(XR&&console.log("FOUND AVATAR RIGHT HAND",e.name),i.rightHand=new ei("",t,e)));for(let r=0;r<e.children.length;r++){if(i.head&&i.leftHand&&i.rightHand)return;const o=e.children[r];this.tryFindAvatarObjects(o,t,i)}}}const Dr=new S,Q4=new S,W4=new Ce,Kde=ie("debuggizmos"),Sl=8947848,YR=32,za=class{constructor(){}static isGizmo(e){return e[fD]!==void 0}static DrawLabel(e,t,i=.05,n=0,r,o,a){var h;if(!za.enabled)return null;r||(r=Sl);const l=((h=Mt.active)==null?void 0:h.rigScale)??1,c=on.getTextLabel(n,t,i*l,r,o);return a instanceof ye&&a.add(c),c.position.x=e.x,c.position.y=e.y,c.position.z=e.z,c}static DrawRay(e,t,i=Sl,n=0,r=!0){if(!za.enabled)return;const o=on.getLine(n),a=o.geometry.getAttribute("position");a.setXYZ(0,e.x,e.y,e.z),Dr.set(t.x,t.y,t.z).multiplyScalar(999999999),a.setXYZ(1,e.x+Dr.x,e.y+Dr.y,e.z+Dr.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawDirection(e,t,i=Sl,n=0,r=!0,o=1){if(!za.enabled)return;const a=on.getLine(n),l=a.geometry.getAttribute("position");l.setXYZ(0,e.x,e.y,e.z),t.w!==void 0?(Dr.set(0,0,-o),W4.set(t.x,t.y,t.z,t.w),Dr.applyQuaternion(W4)):(Dr.set(t.x,t.y,t.z),Dr.multiplyScalar(o)),l.setXYZ(1,e.x+Dr.x,e.y+Dr.y,e.z+Dr.z),l.needsUpdate=!0,a.material.color.set(i),a.material.depthTest=r,a.material.depthWrite=!1}static DrawLine(e,t,i=Sl,n=0,r=!0){if(!za.enabled)return;const o=on.getLine(n),a=o.geometry.getAttribute("position");a.setXYZ(0,e.x,e.y,e.z),a.setXYZ(1,t.x,t.y,t.z),a.needsUpdate=!0,o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawCircle(e,t,i,n=Sl,r=0,o=!0){if(!za.enabled)return;const a=on.getCircle(r);a.position.set(e.x,e.y,e.z),a.scale.set(i,i,i),a.quaternion.setFromUnitVectors(this._up,Dr.set(t.x,t.y,t.z).normalize()),a.material.color.set(n),a.material.depthTest=o,a.material.depthWrite=!1,a.material.fog=!1}static DrawWireSphere(e,t,i=Sl,n=0,r=!0){if(!za.enabled)return;const o=on.getSphere(t,n,!0);rm(o,e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1,o.material.fog=!1}static DrawSphere(e,t,i=Sl,n=0,r=!0){if(!za.enabled)return;const o=on.getSphere(t,n,!1);rm(o,e.x,e.y,e.z),o.material.color.set(i),o.material.depthTest=r,o.material.depthWrite=!1}static DrawWireBox(e,t,i=Sl,n=0,r=!0){if(!za.enabled)return;const o=on.getBox(n);o.position.set(e.x,e.y,e.z),o.scale.set(t.x,t.y,t.z),o.material.color.set(i),o.material.depthTest=r,o.material.wireframe=!0,o.material.depthWrite=!1,o.material.fog=!1}static DrawWireBox3(e,t=Sl,i=0,n=!0){if(!za.enabled)return;const r=on.getBox(i);r.position.copy(e.getCenter(Dr)),r.scale.copy(e.getSize(Dr)),r.material.color.set(t),r.material.depthTest=n,r.material.wireframe=!0,r.material.depthWrite=!1,r.material.fog=!1}static DrawArrow(e,t,i=Sl,n=0,r=!0,o=!1){if(!za.enabled)return;const a=on.getArrowHead(n);a.position.set(t.x,t.y,t.z),a.quaternion.setFromUnitVectors(this._up.set(0,1,0),Dr.set(t.x,t.y,t.z).sub(Q4.set(e.x,e.y,e.z)).normalize());const c=Dr.set(t.x,t.y,t.z).sub(Q4.set(e.x,e.y,e.z)).length()*.1;a.scale.set(c,c,c),a.material.color.set(i),a.material.depthTest=r,a.material.wireframe=o,this.DrawLine(e,t,i,n,r)}static DrawWireMesh(e){const t=on.getMesh(e.duration??0);"mesh"in e?(t.geometry=e.mesh.geometry,t.matrix.copy(e.mesh.matrixWorld)):(t.geometry=e.geometry,t.matrix.copy(e.matrix)),t.matrixAutoUpdate=!1,t.matrixWorldAutoUpdate=!1,t.material.color.set(e.color??Sl),t.material.depthTest=e.depthTest??!0,t.material.wireframe=!0}static setVisible(e){for(const t of on.timedObjectsBuffer)t.visible=e}};let _t=za;d(_t,"enabled",!0),d(_t,"_up",new S(0,1,0));const Jde=new Ki(1,1,1);function Uk(s=null){const e=new Ae(s??14540253),t=new lL(Jde);return new jr(t,new ji({color:e}))}const fD=Symbol("GizmoCache");class on{static ensureFont(){let e=Wi.FontLibrary.getFontFamily(this.familyName);if(!e){e=Wi.FontLibrary.addFontFamily(this.familyName);const t=e.addVariant("normal","normal","https://uploads.needle.tools/include/font-msdf.json","https://uploads.needle.tools/include/font.png");t==null||t.addEventListener("ready",()=>{Wi.update()})}}static getTextLabel(e,t,i,n,r){this.ensureFont();let o=this.textLabelCache.pop(),a=1;r&&typeof r=="string"&&(r==null?void 0:r.length)>=8&&r.startsWith("#")?(a=parseInt(r.substring(7),16)/255,r=r.substring(0,7),Kde&&console.log(r,a)):typeof r=="object"&&r.a!==void 0&&(a=r.a);const l={boxSizing:"border-box",fontFamily:this.familyName,width:"auto",fontSize:i,color:n,lineHeight:1,backgroundColor:r??void 0,backgroundOpacity:a,textContent:t,borderRadius:.5*i,padding:.8*i,whiteSpace:"pre"};if(o)o.set(l);else{o=new YL(l);const c=this,h=o;h.setText=function(u){this.set({textContent:u}),c.tmuiNeedsUpdate=!0}}return this.tmuiNeedsUpdate=!0,this.registerTimedObject(Dt.Current,o,e,this.textLabelCache),o}static getBox(e){let t=this.boxesCache.pop();if(!t){const i=new Ki(1,1,1);t=new fe(i)}return this.registerTimedObject(Dt.Current,t,e,this.boxesCache),t}static getLine(e){let t=this.linesCache.pop();if(!t){t=new An;let i=t.geometry.getAttribute("position");i||(i=new Ke(new Float32Array(2*3),3),t.geometry.setAttribute("position",i))}return t.frustumCulled=!1,this.registerTimedObject(Dt.Current,t,e,this.linesCache),t}static getCircle(e){let t=this.circlesCache.pop();if(!t){t=new An;let i=t.geometry.getAttribute("position");if(!i){i=new Ke(new Float32Array(YR*3),3),t.geometry.setAttribute("position",i);const n=wt(0,1,0),r=wt(0,0,1),o=wt(r);o.cross(n).normalize();const a=wt(o),l=Math.PI*2/(YR-1);for(let c=0;c<YR+1;c++){const h=l*c;n.copy(a).multiplyScalar(Math.cos(h)*1),o.copy(r).multiplyScalar(Math.sin(h)*1);const u=n.add(o);i.setXYZ(c,u.x,u.y,u.z)}}}return t.frustumCulled=!1,this.registerTimedObject(Dt.Current,t,e,this.circlesCache),t}static getSphere(e,t,i){let n=this.spheresCache.pop();return n||(n=new fe(new cl(1,8,8))),n.scale.set(e,e,e),n.material.wireframe=i,this.registerTimedObject(Dt.Current,n,t,this.spheresCache),n}static getArrowHead(e){let t=this.arrowHeadsCache.pop();return t||(t=new fe(new Xn(0,.5,1,8))),this.registerTimedObject(Dt.Current,t,e,this.arrowHeadsCache),t}static getMesh(e){let t=this.mesh.pop();return t||(t=new fe,t.material=new ti),this.registerTimedObject(Dt.Current,t,e,this.mesh),t}static registerTimedObject(e,t,i,n){if(!e){console.error("No Needle Engine context available. Did you call a Gizmos function in global scope?");return}const r=this.contextBeforeRenderCallbacks.get(e),o=this.contextPostRenderCallbacks.get(e);if(r){if(e.pre_render_callbacks[e.pre_render_callbacks.length-1]!==r){const a=e.pre_render_callbacks.indexOf(r);a>=0&&e.pre_render_callbacks.splice(a,1),e.pre_render_callbacks.push(r)}}else{const a=()=>{this.onBeforeRender(e,this.timedObjectsBuffer)};this.contextBeforeRenderCallbacks.set(e,a),e.pre_render_callbacks.push(a)}if(o){if(e.post_render_callbacks[e.post_render_callbacks.length-1]!==o){const a=e.post_render_callbacks.indexOf(o);a>=0&&e.post_render_callbacks.splice(a,1),e.post_render_callbacks.push(o)}}else{const a=()=>{this.onPostRender(e,this.timedObjectsBuffer,this.timesBuffer)};this.contextPostRenderCallbacks.set(e,a),e.post_render_callbacks.push(a)}t.traverse(a=>{a.layers.disableAll(),a.layers.enable(2)}),t.renderOrder=999999,t[fD]=n,t.castShadow=!1,t.receiveShadow=!1,t.isGizmo=!0,this.timedObjectsBuffer.push(t),i<=0&&e.currentFrameEvent>=nn.OnBeforeRender?this.timesBuffer.push(0):this.timesBuffer.push(Dt.Current.time.realtimeSinceStartup+i),e.scene.add(t)}static onBeforeRender(e,t){this.tmuiNeedsUpdate&&(this.tmuiNeedsUpdate=!1,Wi.update());for(let i=0;i<t.length;i++){const n=t[i];if(e.mainCamera&&n instanceof Wi.MeshUIBaseElement){if(am(n))continue;const r=e.isInVR,o=!1,a=!r;zb(n,e.mainCamera,o,a)}}}static onPostRender(e,t,i){const n=e.time.realtimeSinceStartup;for(let r=t.length-1;r>=0;r--){const o=t[r];n>i[r]&&(t.splice(r,1),i.splice(r,1),o.removeFromParent(),am(o)!=!0&&o[fD].push(o))}}}d(on,"familyName","needle-gizmos"),d(on,"linesCache",[]),d(on,"circlesCache",[]),d(on,"spheresCache",[]),d(on,"boxesCache",[]),d(on,"arrowHeadsCache",[]),d(on,"mesh",[]),d(on,"textLabelCache",[]),d(on,"timedObjectsBuffer",new Array),d(on,"timesBuffer",new Array),d(on,"contextPostRenderCallbacks",new Map),d(on,"contextBeforeRenderCallbacks",new Map),d(on,"tmuiNeedsUpdate",!1);const dd=ie("debugphysics"),j4=new Vr;class zc{constructor(){d(this,"ray");d(this,"cam");d(this,"screenPoint");d(this,"raycaster");d(this,"results");d(this,"targets");d(this,"recursive",!0);d(this,"minDistance");d(this,"maxDistance");d(this,"lineThreshold");d(this,"layerMask");d(this,"ignore");d(this,"testObject");d(this,"useAcceleratedRaycast")}screenPointFromOffset(e,t){this.screenPoint===void 0&&(this.screenPoint=new ee),this.screenPoint.x=e/window.innerWidth*2-1,this.screenPoint.y=-(t/window.innerHeight)*2+1}setLayer(e){j4.set(e),this.layerMask=j4}setMask(e){this.layerMask||(this.layerMask=new Vr);const t=this.layerMask;t?t.mask=e:this.layerMask=e}}d(zc,"AllLayers",4294967295);class Nk{constructor(e,t,i){d(this,"distance");d(this,"point");d(this,"object");this.object=e,this.distance=t,this.point=i}}const BE=class{constructor(e){d(this,"context");d(this,"engine");d(this,"raycaster",new tf);d(this,"defaultRaycastOptions",new zc);d(this,"targetBuffer",new Array(1));d(this,"defaultThresholds",{Mesh:{},Line:{threshold:-1},LOD:{},Points:{threshold:0},Sprite:{}});d(this,"sphereResults",new Array);d(this,"sphereMask",new Vr);d(this,"sphere",new ln);d(this,"tempBoundingBox",new jt);this.context=e}static get raycasting(){return this._raycasting>0}raycastPhysicsFast(e,t=void 0,i=1/0,n=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycast(e,t,{maxDistance:i,solid:n}))??null}raycastPhysicsFastAndGetNormal(e,t=void 0,i=1/0,n=!0){var r;return((r=this.context.physics.engine)==null?void 0:r.raycastAndGetNormal(e,t,{maxDistance:i,solid:n}))??null}sphereOverlapPhysics(e,t){var i;return((i=this.context.physics.engine)==null?void 0:i.sphereOverlap(e,t))??null}sphereOverlap(e,t,i=!0,n=!1,r=null){if(this.sphereResults.length=0,!this.context.scene)return this.sphereResults;const o=this.sphereMask;o.enableAll(),o.disable(2);for(const a of this.context.scene.children)this.intersectSphere(a,e,t,o,this.sphereResults,i,n,r);return this.sphereResults.sort((a,l)=>a.distance-l.distance)}raycastFromRay(e,t=null){const i=t??this.defaultRaycastOptions;i.ray=e;const n=this.raycast(i);return i===this.defaultRaycastOptions&&(i.ray=void 0),n}raycast(e=null){dd&&performance.mark("raycast.start"),e||(e=this.defaultRaycastOptions);const t=e.screenPoint??this.context.input.mousePositionRC,i=e.raycaster??this.raycaster;if(i.near=e.minDistance??0,i.far=e.maxDistance??1/0,i.params=this.defaultThresholds,e.lineThreshold===void 0&&(e.lineThreshold=-1),i.params.Line={threshold:e.lineThreshold},e.ray)i.ray.copy(e.ray);else{const a=e.cam??this.context.mainCamera;if(!a)return dd&&console.error("Can not perform raycast - no main camera found"),this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),this.defaultRaycastOptions.results??[];const l=this.context.xrCamera;this.context.isInXR&&l instanceof KO&&l.cameras.length>0?i.setFromCamera(t,l.cameras[0]):i.setFromCamera(t,a)}let n=e.targets;n||(n=this.targetBuffer,n.length=1,n[0]=this.context.scene);let r=e.results;this.defaultRaycastOptions.results&&(this.defaultRaycastOptions.results.length=0),r||(this.defaultRaycastOptions.results||(this.defaultRaycastOptions.results=new Array),r=this.defaultRaycastOptions.results),e.layerMask!==void 0?e.layerMask instanceof Vr?i.layers.mask=e.layerMask.mask:i.layers.mask=e.layerMask:(i.layers.enableAll(),i.layers.disable(2)),dd&&(_t.DrawRay(i.ray.origin,i.ray.direction,16711680,2),console.time("raycast")),r.length=0,BE._raycasting++,this.intersect(this.raycaster,n,r,e),r.sort((a,l)=>a.distance-l.distance);const o=e.ignore;return o!==void 0&&o.length>0&&(r=r.filter(a=>!o.includes(a.object))),BE._raycasting--,dd&&(console.timeEnd("raycast"),console.warn("#"+this.context.time.frame+", hits:",r!=null&&r.length?[...r]:"nothing"),performance.mark("raycast.end"),performance.measure("raycast","raycast.start","raycast.end")),r}intersect(e,t,i,n){var r,o,a;for(const l of t){if(!l||l.visible===!1||_t.isGizmo(l)||n.lineThreshold!==void 0&&n.lineThreshold<0&&l instanceof An)continue;const c=(r=n.testObject)==null?void 0:r.call(n,l);if(c===!1)continue;if(c!=="continue in children"){const u=l,f=u.geometry;if(f){const p=Wb(l);p&&(u.geometry=p);const m=i.length;let v=!0;n.precise===!1&&(v=!1),v||(v=((a=(o=f.getAttribute("position"))==null?void 0:o.array)==null?void 0:a.length)<64),u instanceof nv&&(v=!1),!v&&$de(u,e,i)||(n.useAcceleratedRaycast!==!1?sE.runMeshBVHRaycast(e,u,i,this.context):e.intersectObject(l,!1,i)),dd&&i.length!=m&&_t.DrawWireMesh({mesh:l,depthTest:!1,duration:.2,color:p?8969557:7798784}),u.geometry=f}}n.recursive!==!1&&this.intersect(e,l.children,i,n)}return i}intersectSphere(e,t,i,n,r,o,a,l){let c=e&&e.isMesh&&e.layers.test(n)&&!_t.isGizmo(e);if(c&&(c=e.visible),c&&(c=!(e instanceof An)),c&&(c=!(e instanceof nv)),l){const h=l(e);if(h===!1||h!=="continue in children")return}if(c){const h=e,u=h.geometry;if(u){if(a){const f=this.sphere;f.center.copy(t),f.radius=i;const p=r.length;if(sE.runMeshBVHRaycast(this.sphere,h,r,this.context),p!=r.length&&!o)return}else if(u.boundingBox||u.computeBoundingBox(),u.boundingBox){h.matrixWorldNeedsUpdate&&h.updateWorldMatrix(!1,!1);const f=this.tempBoundingBox.copy(u.boundingBox).applyMatrix4(h.matrixWorld),p=this.sphere;if(p.center.copy(t),p.radius=i,p.intersectsBox(f)){const m=Ft(e),v=m.distanceTo(p.center),g=new Nk(e,v,m);if(r.push(g),!o)return}}}}if(e.children)for(const h of e.children){const u=r.length;if(this.intersectSphere(h,t,i,n,r,o,a,l),u!=r.length&&!o)return}}};let Fy=BE;d(Fy,"_raycasting",0);const Wf=new ln,SS=new xs,Zde=new Ut;function $de(s,e,t){const i=s._computeIntersections;if(!i)return!1;let n=s["_computeIntersections:Needle"];return n||(n=s["_computeIntersections:Needle"]=function(r,o,a){const l=this,c=l.geometry.boundingSphere;if(c){if(l instanceof nv){SS.setFromNormalAndCoplanarPoint(wt(0,1,0),wt(0,-l.position.y,0)),SS.applyMatrix4(l.matrixWorld,Zde);const u=r.ray.intersectPlane(SS,wt());if(u){Wf.copy(c),Wf.applyMatrix4(l.matrixWorld);const p=wt(u).sub(r.ray.origin).length(),m=Wf.radius*.5;p<m&&o.push({distance:p,point:u,object:l,normal:SS.normal.clone()})}return}Wf.copy(c),Wf.applyMatrix4(l.matrixWorld);const h=r.ray.intersectSphere(Wf,wt());if(h){const u=wt(h).sub(r.ray.origin),f=u.length();if(f>Wf.radius){const p=u.clone().normalize();o.push({distance:f,point:h,object:l,normal:p})}}}}),s._computeIntersections=n,e.intersectObject(s,!1,t),s._computeIntersections=i,!0}var sE;(s=>{function e(y,A,_,b){var E,M,T;if(!A.geometry||!A.geometry.hasAttribute("position"))return!1;const x=A.geometry;if(A!=null&&A.isSkinnedMesh){const R=A,w=R.bvhNeedsUpdate;if(!R.staticGenerator)a(),r&&(R.staticGenerator=new r(A),R.staticGenerator.applyWorldTransforms=!1,R.staticGeometry=R.staticGenerator.generate(),x.boundsTree=o==null?void 0:o.call(R.staticGeometry),R.staticGeometryLastUpdate=performance.now()+Math.random()*200,R.autoUpdateMeshBVH===void 0&&(R.autoUpdateMeshBVH=!1));else if(x.boundsTree&&(R.autoUpdateMeshBVH===!0||w===!0)){const I=performance.now(),O=I-R.staticGeometryLastUpdate;(w||O>100)&&(R.bvhNeedsUpdate=!1,R.staticGeometryLastUpdate=I,(E=R.staticGenerator)==null||E.generate(R.staticGeometry),x.boundsTree.refit())}}else if(!x.boundsTree){c||g();let R=!0;if((b.xr||x[p]===!1||(M=x.getAttribute("position"))!=null&&M.isInterleavedBufferAttribute||x.index&&((T=x.index)!=null&&T.isInterleavedBufferAttribute))&&(R=!1),R&&u){if(x[f]===void 0){let w=null;if(v.length>0){const I=v.shift();I&&!I.running&&(w=I)}else m.length<1&&(w=new u,m.push(w));w!=null&&!w.running?(x[f]="queued",performance.mark("bvh.create.start"),w.generate(x).then(I=>{x[f]="done",x.boundsTree=I}).catch(I=>{x[f]="failed - "+(I==null?void 0:I.message),x[p]=!1}).finally(()=>{v.push(w),performance.mark("bvh.create.end"),performance.measure("bvh.create (worker)","bvh.create.start","bvh.create.end")})):dd&&console.warn("No worker available")}}else(!h||!R)&&(a(),n&&(performance.mark("bvh.create.start"),x.boundsTree=new n(x),performance.mark("bvh.create.end"),performance.measure("bvh.create","bvh.create.start","bvh.create.end")))}if(y instanceof tf){const R=y,w=A.raycast;i&&x.boundsTree&&(A.acceleratedRaycast||(A.acceleratedRaycast=i.bind(A)),A.raycast=A.acceleratedRaycast);const I=R.firstHitOnly;return R.firstHitOnly=!1,R.intersectObject(A,!1,_),R.firstHitOnly=I,A.raycast=w,!0}else if(y instanceof ln){const R=x.boundsTree;if(R){const w=y;if(l.copy(A.matrixWorld).invert(),w.applyMatrix4(l),R.intersectsSphere(w)){const O=Ft(A),k=O.distanceTo(w.center),B=new Nk(A,k,O);_.push(B)}}return!0}return!1}s.runMeshBVHRaycast=e;let t=!1,i=null,n=null,r=null,o=null;function a(){t||(t=!0,Promise.resolve().then(()=>q1e).then(y=>{i=y.acceleratedRaycast,n=y.MeshBVH,r=y.StaticGeometryGenerator,o=y.computeBoundsTree}).catch(y=>{(dd||nt())&&console.warn("Failed to load mesh bvh library")}))}const l=new le;let c=!1,h=!1,u=null;const f=Symbol("Needle:MeshBVH-Worker"),p=Symbol("Needle:MeshBVH-CanUseWorker"),m=[],v=[];function g(){c=!0,h=!0,Promise.resolve().then(()=>J1e).then(y=>{u=y.GenerateMeshBVHWorker}).catch(y=>{(dd||nt())&&console.warn("Failed to setup mesh bvh worker")}).finally(()=>{h=!1})}})(sE||(sE={}));const q4=Symbol("gltf-loader-internal-usage-tracker"),efe=ie("debugusers"),y_=class{constructor(e){d(this,"parser");d(this,"_getDependency");d(this,"_loadingId");d(this,"_loadedObjects",new Set);this.parser=e,this._getDependency=this.parser.getDependency,this._loadingId=Date.now().toString()}get name(){return"NEEDLE_internal_usage_tracker"}static isLoading(e){return y_._loadingProcesses>0}beforeRoot(){y_._loadingProcesses++;const e=this,t=this._getDependency;return this.parser.getDependency=function(i,n){const r=t.call(this,i,n);return r.then(o=>(o&&(e._loadedObjects.add(o),o[q4]=e._loadingId),o)),r},null}afterRoot(e){y_._loadingProcesses--,this.parser.getDependency=this._getDependency;for(const t of this._loadedObjects)delete t[q4],t instanceof ye&&(t.parent||t instanceof fe&&setTimeout(()=>{efe&&console.warn("> GLTF LOADER: Mesh not used in scene!",t),t.material=null,t.geometry=null},1e3));return null}};let n_=y_;d(n_,"_loadingProcesses",0);class jj{constructor(){window.addEventListener("unhandledrejection",e=>{var i;if(e.defaultPrevented)return;const t=(i=e==null?void 0:e.reason)==null?void 0:i.path;if(t){const n=t[0];n&&n.tagName==="IMG"&&(console.warn(`Could not load image:
`+n.src),e.preventDefault())}})}}const qM=ie("trackresources");function qj(){return qM==="dispose"}let gm=!0;qM===0&&(gm=!1);function tfe(s){gm=s}function Xj(){return gm}const Yj=Symbol("disposable");function zk(s,e){s&&(s[Yj]=e,Np&&console.warn("Set disposable",e,s))}const Kj=Symbol("disposed");function ife(s){return s[Kj]===!0}function Xi(s){var e;if(s){if(s[Yj]===!1){Np&&console.warn("Object is marked as not disposable",s);return}if(s[Kj]=!0,s instanceof Ws)Xi(s.environment),Xi(s.background),Xi(s.customDepthMaterial),Xi(s.customDistanceMaterial);else if(s instanceof Fo)Xi(s.geometry),Xi(s.material),Xi(s.skeleton),Xi(s.bindMatrix),Xi(s.bindMatrixInverse),Xi(s.customDepthMaterial),Xi(s.customDistanceMaterial),s.geometry=null,s.material=null;else if(s instanceof fe)Xi(s.geometry),Xi(s.material),Xi(s.customDepthMaterial),Xi(s.customDistanceMaterial),s.geometry=null,s.material=null;else if(s instanceof yt){Mg(s);for(const t of Object.keys(s.attributes)){const i=s.attributes[t];Xi(i)}}else if(s instanceof Ke||s instanceof aa)Np&&console.warn("BufferAttribute dispose not supported",s.count);else if(s instanceof Array)for(const t of s)t instanceof Ht&&Xi(t);else if(s instanceof Ht){Mg(s);for(const i of Object.keys(s)){const n=s[i];n instanceof Wt&&(Xi(n),s[i]=null)}const t=s.uniforms;if(t)for(const i of Object.keys(t)){const n=t[i];n instanceof Wt?(Xi(n),t[i]=null):n instanceof Se&&(Xi(n.value),n.value=null)}}else s instanceof Wt?(Mg(s),Mg(s.source),((e=s.source)==null?void 0:e.data)instanceof ImageBitmap&&Mg(s.source.data)):s instanceof Bb?(Mg(s.boneTexture),s.boneTexture=null):s instanceof em||!(s instanceof ye)&&Np&&console.warn("Unknown object type",s)}}function Mg(s){s&&((Np||qj()||qM)&&console.warn(" FREE",s),s instanceof ImageBitmap?s.close():s instanceof jh?s.data=null:s.dispose())}function Jj(s){(s instanceof fe||s instanceof Fo)&&(s.material=null,s.geometry=null)}const nfe=new Set;function Gk(s,e,t=null,i){if(i||(i=nfe,i.clear()),!s)return i;const n=s[K_];if(n)for(const r of n)i.has(r)||(t==null?void 0:t.call(null,r))!==!1&&(i.add(r),e&&Gk(r,!0,t,i));return i}function sfe(s){return s[SA]}const Np=ie("debugresourceusers")||ie("debugmemory"),K_=Symbol("needle-resource-users"),SA=Symbol("needle-resource-users-count");function io(s,e){FM(s,e,function(t,i){gm&&!Fy.raycasting&&(rE(K_,this,t,!1),rE(K_,this,i,!0))})}gm&&(io(fe.prototype,"material"),io(fe.prototype,"geometry"),io(Ht.prototype,"map"),io(Ht.prototype,"bumpMap"),io(Ht.prototype,"alphaMap"),io(Ht.prototype,"normalMap"),io(Ht.prototype,"displacementMap"),io(Ht.prototype,"roughnessMap"),io(Ht.prototype,"metalnessMap"),io(Ht.prototype,"emissiveMap"),io(Ht.prototype,"specularMap"),io(Ht.prototype,"envMap"),io(Ht.prototype,"lightMap"),io(Ht.prototype,"aoMap"),io(Ht.prototype,"gradientMap"));function rfe(s){if(gm===!1)return;const e=s[K_];if(e)for(const t of e)rE(K_,t,s,!1)}gm&&FM(Ht.prototype,"dispose",function(){rfe(this)});let pD=0;function rE(s,e,t,i){if(pD>0)return;if(Array.isArray(t)){for(const r of t)rE(s,e,r,i);return}if(!t)return;let n=t[s];if(n||(n=new Set),i){if(e&&!n.has(e)){n.add(e);let r=t[SA]||0;r+=1,t[SA]=r,Np&&console.warn(` Added user of "${t.type}"`,e,t,r,"users:",n)}}else if(e&&n.has(e)){n.delete(e);let r=t[SA]||0;r>0&&(r-=1,t[SA]=r),Np&&console.warn(` Removed user of "${t.type}"`,e,t,r,"users:",n),r<=0&&(n_.isLoading(t)||(qM&&console.warn(` Removed all user of "${t.type}"`,t),qj()&&Xi(t)))}t[s]=n}try{FM(hu.prototype,"render",function(){pD++},function(){pD--})}catch(s){console.warn("Could not wrap WebGLRenderer.render",s)}var Xb=(s=>(s.Added="component-added",s.Removing="removing-component",s))(Xb||{});const X4=ie("debugcomponentevents");class Yb{static addComponentLifecylceEventListener(e,t){this.eventListeners.has(e)&&this.eventListeners.set(e,[]);let i=this.eventListeners.get(e);i||(i=[]),i.push(t),this.eventListeners.set(e,i),X4&&console.log("Added event listener for "+e,this.eventListeners)}static removeComponentLifecylceEventListener(e,t){const i=this.eventListeners.get(e);if(!i)return;const n=i.indexOf(t);n<0||i.splice(n,1)}static dispatchComponentLifecycleEvent(e,t){const i=this.eventListeners.get(e);if(X4&&console.log("Dispatching event "+e,i),!!i)for(const n of i)n(t)}}d(Yb,"eventListeners",new Map);const J_=Symbol("NEEDLE_NEED_UPDATE_INSTANCE"),Zj=Symbol("isUsingInstancing"),$j=Symbol("instancingRenderer"),CA=Symbol("instancingAutoUpdateBounds");class sl{static isUsingInstancing(e){return e[Zj]===!0}static getRenderer(e){return e[$j]||null}setAutoUpdateBounds(e,t){const i=sl.getRenderer(e);i&&(i[CA]=t)}static markDirty(e,t=!0){if(e&&(this.isUsingInstancing(e)&&(e[J_]=!0,e.matrixWorldNeedsUpdate=!0),t))for(const i of e.children)sl.markDirty(i,!0)}}const mD=ie("debugnewscripts"),ofe=ie("debughierarchy"),fn=[];function afe(){return fn.length>0}function oE(s){if(!(s.new_scripts.length<=0)){if(mD&&console.log("Register new components",s.new_scripts.length,[...s.new_scripts],s.alias?"element: "+s.alias:s.hash,s),s.new_scripts_pre_setup_callbacks.length>0){for(const e of s.new_scripts_pre_setup_callbacks)e&&e();s.new_scripts_pre_setup_callbacks.length=0}fn.length=0,s.new_scripts.length>0&&fn.push(...s.new_scripts),s.new_scripts.length=0;for(let e=0;e<fn.length;e++)try{const t=fn[e];if(t.isComponent!==!0){(nt()||mD)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,t),fn.splice(e,1),e--;continue}if(t.destroyed)continue;if(!t.gameObject){console.warn(`Component can not be initialized: no GameObject assigned.
Did you add and remove a component in the same frame?`),fn.splice(e,1),e--;continue}t.context=s,s_(t.gameObject),Hk(t,s)}catch(t){console.error(t),Vh(fn[e],s),fn.splice(e,1),e--}for(let e=0;e<fn.length;e++)try{const t=fn[e];if(t.destroyed){Vh(fn[e],s),fn.splice(e,1),e--;continue}if(t.registering)try{t.registering()}catch(i){console.error(i)}t.__internalAwake!==void 0&&(t.gameObject||console.error("Calling awake for a component without a GameObject",t,t.gameObject),s_(t.gameObject),t.activeAndEnabled&&Up(t.__internalAwake.bind(t)))}catch(t){console.error(t),Vh(fn[e],s),fn.splice(e,1),e--}for(let e=0;e<fn.length;e++)try{const t=fn[e];if(t.destroyed||t.enabled===!1||(s_(t.gameObject),t.activeAndEnabled===!1))continue;t.__internalEnable!==void 0&&(t.enabled=!0,Up(t.__internalEnable.bind(t)))}catch(t){console.error(t),Vh(fn[e],s),fn.splice(e,1),e--}for(let e=0;e<fn.length;e++)try{const t=fn[e];if(t.destroyed||!t.gameObject)continue;s.new_script_start.push(t)}catch(t){console.error(t),Vh(fn[e],s),fn.splice(e,1),e--}fn.length=0;for(const e of s.new_scripts_post_setup_callbacks)e&&e();s.new_scripts_post_setup_callbacks.length=0}}function lfe(s){s&&(s.__internalDisable(!0),Vh(s,s.context))}function e9(s,e){for(let t=0;t<s.new_script_start.length;t++)try{const i=s.new_script_start[t];if(e!==void 0&&i.gameObject!==e||i.destroyed||i.activeAndEnabled===!1)continue;Up(i.__internalAwake.bind(i)),i.enabled&&(Up(i.__internalEnable.bind(i)),Up(i.__internalStart.bind(i)),s.new_script_start.splice(t,1),t--)}catch(i){console.error(i),Vh(s.new_script_start[t],s),s.new_script_start.splice(t,1),t--}}function Hk(s,e){e.scripts.indexOf(s)===-1&&(e.scripts.push(s),s.earlyUpdate&&e.scripts_earlyUpdate.push(s),s.update&&e.scripts_update.push(s),s.lateUpdate&&e.scripts_lateUpdate.push(s),s.onBeforeRender&&e.scripts_onBeforeRender.push(s),s.onAfterRender&&e.scripts_onAfterRender.push(s),s.onPausedChanged&&e.scripts_pausedChanged.push(s),KR(s,null)&&e.new_scripts_xr.push(s),KR(s,"immersive-vr")&&e.scripts_immersive_vr.push(s),KR(s,"immersive-ar")&&e.scripts_immersive_ar.push(s))}function Vh(s,e){Da(s,e.new_scripts),Da(s,e.new_script_start),Da(s,e.scripts),Da(s,e.scripts_earlyUpdate),Da(s,e.scripts_update),Da(s,e.scripts_lateUpdate),Da(s,e.scripts_onBeforeRender),Da(s,e.scripts_onAfterRender),Da(s,e.scripts_pausedChanged),Da(s,e.new_scripts_xr),Da(s,e.scripts_immersive_vr),Da(s,e.scripts_immersive_ar),e.stopAllCoroutinesFrom(s)}function Da(s,e){const t=e.indexOf(s);t>=0&&e.splice(t,1)}function KR(s,e){var t;if(s){const i=s;if(i.onBeforeXR||i.onEnterXR||i.onUpdateXR||i.onLeaveXR||i.onXRControllerAdded||i.onXRControllerRemoved)return!(e!=null&&((t=i.supportsXR)==null?void 0:t.call(i,e))===!1)}return!1}function a1(s){if(s||(s=mi.Current.scene),!s){console.trace("Invalid call - no current context.");return}const e=Pv(s);t9(s,e,!0)||(mD||nt()?console.error(`Error updating hierarchy
Do you have circular references in your project? <a target="_blank" href="https://docs.needle.tools/circular-reference"> Click here for more information.`,s):console.error('Failed to update active state in hierarchy of "'+s.name+'"',s),console.warn("  this error might be caused by circular references. Please make sure you don't have files with circular references (e.g. one GLB 1 is loading GLB 2 which is then loading GLB 1 again)."))}function t9(s,e,t,i=0){if(i>1e3)return console.warn("Hierarchy is too deep (> 1000 level) - will abort updating active state"),!1;const n=Pv(s);if(e&&(e=n,e&&s.parent)){const l=s.parent;e=l[$h],e===void 0&&(l instanceof Ws||(e=!0))}const o=s[$h]!==e;s[$h]=e,o&&(ofe&&console.warn("ACTIVE CHANGE",s.name,n,s.visible,e,"changed?"+o,s),t&&cfe(s,l=>{e?l.enabled&&(Up(l.__internalAwake.bind(l)),l.enabled&&(l.__didEnable=!0,l.onEnable())):l.__didAwake&&l.enabled&&(l.__didEnable=!1,l.onDisable())}));let a=!0;if(s.children){const l=i+1;for(const c of s.children)t9(c,e,t,l)===!1&&(a=!1)}return a}function s_(s){let e=!0,t=s,i=!1;for(;t&&t;){if(t.type==="Scene"&&(i=!0),!Pv(t)){e=!1;break}t=t.parent}if(!s){console.error("GO is null");return}s[$h]=e&&i}function cfe(s,e){var t;if((t=s.userData)!=null&&t.components)for(const i of s.userData.components)e(i)}const l1=new Map,i9=Symbol("prewarmFlag"),gD=Symbol("waitingForPrewarm"),yD=ie("debugprewarm");function hfe(s,e){if(!s||s[i9]===!0||s[gD]===!0)return;l1.has(e)||l1.set(e,[]),s[gD]=!0,l1.get(e).push(s),yD&&console.debug("register prewarm",s.name)}let Y4=null,K4=null;function ufe(s){if(!s)return;const e=l1.get(s);if(!(e!=null&&e.length))return;const t=s.mainCamera;if(t){yD&&console.log("prewarm",e.length,"objects",[...e]);const i=s.renderer;if(i.compile){const n=s.scene;i.compile(n,t),Y4??(Y4=new qO(64)),K4??(K4=new jO(.001,9999999,Y4)),K4.update(i,n);for(const r of e)r[i9]=!0,r[gD]=!1;e.length=0,yD&&console.log("prewarm done")}}}const dfe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ffe(s){return typeof s=="string"&&dfe.test(s)}const sr=[];for(let s=0;s<256;++s)sr.push((s+256).toString(16).slice(1));function pfe(s,e=0){return sr[s[e+0]]+sr[s[e+1]]+sr[s[e+2]]+sr[s[e+3]]+"-"+sr[s[e+4]]+sr[s[e+5]]+"-"+sr[s[e+6]]+sr[s[e+7]]+"-"+sr[s[e+8]]+sr[s[e+9]]+"-"+sr[s[e+10]]+sr[s[e+11]]+sr[s[e+12]]+sr[s[e+13]]+sr[s[e+14]]+sr[s[e+15]]}function mfe(s){if(!ffe(s))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(s.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(s.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(s.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(s.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(s.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function gfe(s){s=unescape(encodeURIComponent(s));const e=[];for(let t=0;t<s.length;++t)e.push(s.charCodeAt(t));return e}const yfe="6ba7b810-9dad-11d1-80b4-00c04fd430c8",vfe="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Afe(s,e,t){function i(n,r,o,a){var l;if(typeof n=="string"&&(n=gfe(n)),typeof r=="string"&&(r=mfe(r)),((l=r)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+n.length);if(c.set(r),c.set(n,r.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(let h=0;h<16;++h)o[a+h]=c[h];return o}return pfe(c)}try{i.name=s}catch{}return i.DNS=yfe,i.URL=vfe,i}function _fe(s,e,t,i){switch(s){case 0:return e&t^~e&i;case 1:return e^t^i;case 2:return e&t^e&i^t&i;case 3:return e^t^i}}function JR(s,e){return s<<e|s>>>32-e}function bfe(s){const e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof s=="string"){const o=unescape(encodeURIComponent(s));s=[];for(let a=0;a<o.length;++a)s.push(o.charCodeAt(a))}else Array.isArray(s)||(s=Array.prototype.slice.call(s));s.push(128);const i=s.length/4+2,n=Math.ceil(i/16),r=new Array(n);for(let o=0;o<n;++o){const a=new Uint32Array(16);for(let l=0;l<16;++l)a[l]=s[o*64+l*4]<<24|s[o*64+l*4+1]<<16|s[o*64+l*4+2]<<8|s[o*64+l*4+3];r[o]=a}r[n-1][14]=(s.length-1)*8/Math.pow(2,32),r[n-1][14]=Math.floor(r[n-1][14]),r[n-1][15]=(s.length-1)*8&4294967295;for(let o=0;o<n;++o){const a=new Uint32Array(80);for(let p=0;p<16;++p)a[p]=r[o][p];for(let p=16;p<80;++p)a[p]=JR(a[p-3]^a[p-8]^a[p-14]^a[p-16],1);let l=t[0],c=t[1],h=t[2],u=t[3],f=t[4];for(let p=0;p<80;++p){const m=Math.floor(p/20),v=JR(l,5)+_fe(m,c,h,u)+f+e[m]+a[p]>>>0;f=u,u=h,h=JR(c,30)>>>0,c=l,l=v}t[0]=t[0]+l>>>0,t[1]=t[1]+c>>>0,t[2]=t[2]+h>>>0,t[3]=t[3]+u>>>0,t[4]=t[4]+f>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}const xfe=Afe("v5",80,bfe),J4=xfe;mi.registerCallback(Ti.ContextCreated,s=>{const e=s.context;o9(e),s9(e)});const aE=ie("debugcomponents"),Z4="eff8ba80-635d-11ec-90d6-0242ac120003";class Ms{constructor(e){d(this,"_originalSeed");d(this,"_seed");typeof e=="string"&&(e=Ms.hash(e)),this._originalSeed=e,this._seed=e}get seed(){return this._seed}set seed(e){this._seed=e}reset(){this._seed=this._originalSeed}generateUUID(e){if(typeof e=="string")return J4(e,Z4);const t=this._seed;return this._seed-=1,J4(t.toString(),Z4)}initialize(e){typeof e=="string"?this._seed=Ms.hash(e):this._seed=e}static createFromString(e){return new Ms(this.hash(e))}static hash(e){let t=0;for(let i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t);return t}}var n9=(s=>(s.NewInstanceCreated="new-instance-created",s.InstanceDestroyed="instance-destroyed",s))(n9||{});class wfe{constructor(e){d(this,"guid");d(this,"dontSave");this.guid=e}}function Kb(s,e,t=!0,i){if(!s)return;const n=s;if(xa(s,t),!e){console.warn("Can not send destroy: No networking connection provided",s.guid);return}if(!e.isConnected){console.warn("Can not send destroy: not connected",s.guid);return}let r=s.guid;if(!r&&n.uuid&&(r=n.uuid),!r){console.warn("Can not send destroy: failed to find guid",s);return}Vk(r,e,i)}function Vk(s,e,t){const i=new wfe(s);(t==null?void 0:t.saveInRoom)===!1&&(i.dontSave=!0),e.send("instance-destroyed",i,Bl.Queued)}function s9(s){s.connection.beginListen("instance-destroyed",e=>{aE&&console.log("[Remote] Destroyed",s.scene,e);const t=tx(e.guid,s.scene);t&&xa(t)})}class Sfe{constructor(e,t,i){d(this,"filename");d(this,"hash");d(this,"size");this.filename=e,this.hash=t,this.size=i}}class r9{constructor(e,t){d(this,"guid");d(this,"originalGuid");d(this,"seed");d(this,"visible");d(this,"hostData");d(this,"dontSave");d(this,"parent");d(this,"position");d(this,"rotation");d(this,"scale");d(this,"preventCreation");d(this,"deleteStateOnDisconnect");this.originalGuid=e,this.guid=t}}function Qk(s,e,t,i){var l;const n=s;if(!n.guid)return console.warn("Can not instantiate: No guid",n),null;if(e.context||(e.context=Dt.Current),!e.context)return console.error("Missing network instantiate options / reference to network connection in sync instantiate"),null;const r=e?{...e}:null,{instance:o,seed:a}=Cfe(n,e);if(o){const c=o;if(c.guid){aE&&console.log("[Local] new instance","gameobject:",o==null?void 0:o.guid);const h=new r9(n.guid,c.guid);h.seed=a,e.deleteOnDisconnect===!0&&(h.deleteStateOnDisconnect=!0),r&&(r.position&&(h.position={x:r.position.x,y:r.position.y,z:r.position.z}),r.rotation&&(h.rotation={x:r.rotation.x,y:r.rotation.y,z:r.rotation.z,w:r.rotation.w}),r.scale&&(h.scale={x:r.scale.x,y:r.scale.y,z:r.scale.z})),h.position||(h.position={x:c.position.x,y:c.position.y,z:c.position.z}),h.rotation||(h.rotation={x:c.quaternion.x,y:c.quaternion.y,z:c.quaternion.z,w:c.quaternion.w}),h.scale||(h.scale={x:c.scale.x,y:c.scale.y,z:c.scale.z}),h.visible=n.visible,r!=null&&r.parent&&(typeof r.parent=="string"?h.parent=r.parent:h.parent=r.parent.guid),h.hostData=t,i===!1&&(h.dontSave=!0),(l=e==null?void 0:e.context)==null||l.connection.send("new-instance-created",h)}else console.warn("Missing guid, can not send new instance event",c)}return o}function XM(){return Math.random()*9999999}function o9(s){s.connection.beginListen("new-instance-created",async e=>{const t=await Efe(e.originalGuid,s.scene);if(e.preventCreation===!0)return;if(!t){console.warn("could not find object that was instantiated: "+e.guid);return}const i=new Xl;e.position&&(i.position=new S(e.position.x,e.position.y,e.position.z)),e.rotation&&(i.rotation=new Ce(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)),e.scale&&(i.scale=new S(e.scale.x,e.scale.y,e.scale.z)),i.parent=e.parent,e.seed&&(i.idProvider=new Ms(e.seed)),i.visible=e.visible,i.context=s,aE&&s.alias&&console.log("[Remote] instantiate in: "+s.alias);const n=Bv(t,i);n&&(e.parent==="scene"&&s.scene.add(n),aE&&console.log("[Remote] new instance","gameobject:",n==null?void 0:n.guid,t))})}function Cfe(s,e){const t=XM(),i=e??new Xl;i.idProvider=new Ms(t);const n=Bv(s,i);return{seed:t,instance:n}}const a9={};function l9(s,e){a9[s]=e}async function Efe(s,e){const t=a9[s];if(t!=null){const i=await t(s);if(i)return i}return c9(s,e)}function c9(s,e){if(e===null||!s)return null;if(e.guid===s)return e;if(e.children)for(const t of e.children){const i=c9(s,t);if(i)return i}return null}const Jb=ie("gizmos"),Hs=ie("debugextension"),ZR=ie("debugtypes");class Mfe{constructor(){d(this,"_types",{});ZR&&console.warn("TypeStore: Created",this)}add(e,t){ZR&&console.warn("ADD TYPE",e);const i=this._types[e];i===void 0?this._types[e]=t:ZR&&i!==t&&console.warn("Type name exists multiple times in your project and may lead to runtime errors:",e)}get(e){return this._types[e]}}const Tfe=Symbol("BuiltInType"),J=new Mfe,Ife=function(s){J.get(s.name)||J.add(s.name,s)},Wk=ie("debugresolvedependencies"),Rfe=["/extensions/","extensions/"],Pfe=[{prefix:"/nodes/",dependencyName:"node"},{prefix:"/meshes/",dependencyName:"mesh"},{prefix:"/materials/",dependencyName:"material"},{prefix:"/textures/",dependencyName:"texture"},{prefix:"/animations/",dependencyName:"animation"},{prefix:"nodes/",dependencyName:"node"},{prefix:"meshes/",dependencyName:"mesh"},{prefix:"materials/",dependencyName:"material"},{prefix:"textures/",dependencyName:"texture"},{prefix:"animations/",dependencyName:"animation"}];async function jk(s,e){Wk&&console.log(s,e);const t=[];vD(Pfe,s,e,t);const i=await Promise.all(t);return typeof e=="string"&&i.length===1?i[0]:i}function h9(s,e){return!s||!e?!1:s["needle:identifier"]!=null&&e["needle:identifier"]!=null?s["needle:identifier"]===e["needle:identifier"]:!1}function Bfe(s,e){s["needle:identifier"]=e}function vD(s,e,t,i){if(typeof t=="object"&&t!==void 0&&t!==null)for(const n of Object.keys(t)){const r=t[n];if(typeof r=="string"){const o=$4(e,r);if(o!=null)typeof o.then=="function"?i.push(o.then(a=>t[n]=a)):t[n]=o;else{const a=eG(s,e,r);if(a){i.push(a.then(l=>(t[n]=l,l)));continue}}}else if(Array.isArray(r))for(let o=0;o<r.length;o++){const a=r[o],l=$4(e,a);if(l!==null){typeof l.then=="function"?i.push(l.then(c=>r[o]=c)):r[o]=l;continue}for(const c of s){const h=u9(c.prefix,a);if(h>=0){Wk&&console.log(c,h,c.dependencyName),i.push(e.getDependency(c.dependencyName,h).then(u=>r[o]=u));break}}typeof a=="object"&&vD(s,e,a,i)}else typeof r=="object"&&vD(s,e,r,i)}else if(typeof t=="string"){const n=eG(s,e,t);n&&i.push(n)}}function $4(s,e){if(s&&s.plugins&&typeof e=="string"){for(const t of Rfe)if(e.startsWith(t)){let i=e.substring(t.length);const n=i.indexOf("/");n>=0&&(i=i.substring(0,n));const r=s.plugins[i];if(Hs&&console.log(i,r),typeof(r==null?void 0:r.resolve)=="function"){const o=e.substring(t.length+i.length+1);return r.resolve(s,o)}break}}return null}function eG(s,e,t){for(const i of s){const n=u9(i.prefix,t);if(n>=0)return Wk&&console.warn("GET DEPENDENCY",i,n,i.dependencyName),e.getDependency(i.dependencyName,n)}return null}function u9(s,e){if(typeof e=="string"&&e.startsWith(s)){const t=e.substring(s.length),i=Number.parseInt(t);if(i>=0)return i}return-1}const $R="NEEDLE_persistent_assets";function Dfe(s){return(s==null?void 0:s.___persistentAsset)===!0}class Ofe{constructor(e){d(this,"parser");this.parser=e}get name(){return $R}async afterRoot(e){var n,r;if(!((r=(n=this.parser)==null?void 0:n.json)!=null&&r.extensions))return;const t=this.parser.json.extensions[$R];if(!t)return;Hs&&console.log(t);const i=new Array;for(const o of t==null?void 0:t.assets){const a=jk(this.parser,o);a&&i.push(a)}await Promise.all(i)}resolve(e,t){const i=Number.parseInt(t);if(i>=0){Hs&&console.log(t);const n=e.json.extensions[$R];if(n){const r=n==null?void 0:n.assets[i];if(r&&typeof r=="object"){r.___persistentAsset=!0;const o=r.__type;o&&J.get(o)}return r}}return null}}const Qh=ie("debugserializer");class Lfe{constructor(){d(this,"typeMap",new Map)}register(e,t){if(this.typeMap.has(e)){const i=this.typeMap.get(e);if(i===t)return;console.warn("Type "+e+" is already registered",t,i)}Qh&&console.log("Register type serializer",t.name,t,e),this.typeMap.set(e,t)}getSerializer(e){if(e)return this.typeMap.get(e)}getSerializerForConstructor(e,t=0){if(t>20)return;if(!e||!e.constructor){Qh&&console.log("invalid type");return}const i=e.name,n=this.getSerializer(e);if(n!==void 0)return Qh&&console.log("FOUND SERIALIZER",n==null?void 0:n.name,e.name,e.constructor.name,"for type: "+i,n,e,this.typeMap),n;const r=Object.getPrototypeOf(e);if(r&&r!==e){const o=this.getSerializerForConstructor(r,++t);if(o){const a=r.constructor||r.prototype;Qh&&console.log("FOUND SERIALIZER(in constructor) "+a.constructor.name,a.name,a,o),this.register(a,o)}return o}Qh&&console.warn("No serializer found for "+i,e,e.name,e.constructor.name)}}const lE=new Lfe;class hl{constructor(e,t){d(this,"name");if(this.name=t,Array.isArray(e))for(const i of e)lE.register(i,this);else lE.register(e,this)}}class kfe{constructor(){d(this,"isDevMode",yo());d(this,"cache",{})}registerDefinedKeys(e,t){if(this.isDevMode&&this.cache[e]===void 0){this.cache[e]=Object.keys(t);const i=t;i.$serializedTypes&&Object.keys(i.$serializedTypes)&&this.cache[e].push(...Object.keys(i.$serializedTypes)),Qh&&console.log("registerDefinedKeys for "+e,this.cache[e],t)}}getDefinedKey(e,t){return this.cache[e]===void 0?!1:this.cache[e].includes(t)}}class qk{constructor(e){d(this,"root");d(this,"gltf");d(this,"gltfId");d(this,"object");d(this,"target");d(this,"nodeId");d(this,"nodeToObject");d(this,"objectToNode");d(this,"context");d(this,"path");d(this,"type");d(this,"serializable");d(this,"implementationInformation");this.root=e}}function d9(s,e){const t=s.$serializedTypes;if(t===void 0)return null;const i={};for(const n in t){const r=s[n];if(r!=null&&typeof r=="object"){const o=lE.getSerializerForConstructor(r);if(o){i[n]=o.onSerialize(r,e);continue}}i[n]=r}return i.name=s.constructor.name,typeof s.guid=="string"&&(i.guid=s.guid),i}const c1=[];function f9(s,e){if(!s)return e;typeof s.$serializedTypes=="object"&&(e||(e={}),Object.assign(e,s.$serializedTypes));const t=Object.getPrototypeOf(s);return f9(t,e)}function cE(s,e,t){if(!s)return!1;if(t.target=s,s.onBeforeDeserialize!==void 0){const n=s.onBeforeDeserialize(e,t);if(typeof n=="boolean")return n}const i=f9(s);if(e){if(typeof e.guid=="string"&&(s.guid=e.guid),i)for(const n in i){let r=function(l){const h=l.type;return h?AD(a,h,t,void 0,s[n]):AD(a,l,t,void 0,s[n])};const o=i[n],a=e[n];if(Qh&&console.log(n,a,s,o),!(s[n]!==void 0&&a===void 0)&&(t.type=void 0,t.path=n,t.serializable=o,!(s.onBeforeDeserializeMember!==void 0&&s.onBeforeDeserializeMember(n,a,t)===!0))){if(o===null)s[n]=a;else{if(Array.isArray(o))for(let l=0;l<o.length;l++){const c=o[l],h=r(c);if(h!==void 0||l===o.length-1){s[n]=h;break}}else s[n]=r(o);c1.length=0}s.onAfterDeserializeMember!==void 0&&s.onAfterDeserializeMember(n,a,t)}}Nfe(s,e)}return Ufe(s,e,t.implementationInformation),s.onAfterDeserialize!==void 0&&s.onAfterDeserialize(e,t),!0}const Ffe=ie("noerrors");function Ufe(s,e,t){var r,o;if(Ffe||!e||!yo()||!s||s.constructor&&s.constructor[Tfe]===!0)return;const i=(r=s.constructor)==null?void 0:r.name,n=Object.getOwnPropertyNames(e);for(const a of n){if(a==="sourceId")continue;const l=s[a];if(l==null)continue;const c=e[a];if((t==null?void 0:t.getDefinedKey(i,a))===!1){const h=a.charAt(0).toUpperCase()+a.slice(1);t.getDefinedKey(i,h)&&(Cc(la.Warn,'<strong>Please rename</strong> "'+h+'" to "'+a+'" in '+i),console.warn('Please use lowercase for field: "'+h+'" in '+i,c,s));continue}if(c!=null){if(typeof c=="object"&&(l===void 0||!l.isObject3D)){if(typeof c.node=="number"||typeof c.guid=="string"){if(c.could_not_resolve)continue;if(!(l!==void 0&&Object.keys(l).length>1)){Cc(la.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(Object3D)
${a}? : Object3D;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,a,s[a],s);continue}}else if(!Array.isArray(l)){const h=(o=l.constructor)==null?void 0:o.name;if(h==="Object"&&!l.constructor["did_warn:missing_serializable"]){l.constructor["did_warn:missing_serializable"]=!0;const u='You might be missing a @serializable(Type) decorator for field "'+a+'" in '+i+".ts";console.warn(u+`
${a}:`,c,h),Cc(la.Warn,"Dev Warning: Are you missing a type in @serializable? Please check the browser console for details")}}}if(typeof l=="string"&&(c.endsWith(".gltf")||c.endsWith(".glb"))){Cc(la.Warn,`<strong>Missing serialization for object reference!</strong>

Please change to: 
@serializable(AssetReference)
${a}? : AssetReference;

in script ${i}.ts
<a href="https://docs.needle.tools/serializable" target="_blank">documentation</a>`),console.warn(i,a,s[a],s);continue}}}}function Nfe(s,e){for(const t of Object.keys(e)){const i=e[t];if(typeof i=="object"&&i!==null&&i!==void 0){const n=s[t];if(!n){Qh&&console.log(t,"is undefined on",s);continue}for(const r of Object.keys(i))if(n[r]===void 0&&tG(i[r])&&!tG(n)){const a=zfe(n,r);if(a&&((a==null?void 0:a.writable)===void 0||(a==null?void 0:a.writable)===!1)&&a.set===void 0){Qh&&console.warn('Property is not writable "'+r+'"',n,a,i[r],n[r]);continue}n[r]=i[r]}}}}function zfe(s,e){for(;s;){const t=Object.getOwnPropertyDescriptor(s,e);if(t)return t;s=Object.getPrototypeOf(s)}}function tG(s){switch(typeof s){case"number":case"string":case"boolean":return!0}return!1}function AD(s,e,t,i,n){let r=typeof e=="function"&&e.prototype===void 0,o=e;if(r)try{if(o=e==null?void 0:e.call(e,n),r=!1,o==null)return}catch(h){console.error("Error in callback",h,s)}if(t.type=o,!r&&n instanceof o)return n;if(i||(i={serializer:lE.getSerializerForConstructor(o)}),n&&typeof n=="object"&&Dfe(n)){if(n.__concreteInstance)return n.__concreteInstance;const h=n;if(!h.$serializedTypes&&o.prototype.$serializedTypes&&(h.$serializedTypes=o.prototype.$serializedTypes),h.$serializedTypes&&cE(h,s,t),n&&o!==void 0)try{let u=null;i.serializer&&(u=i.serializer.onDeserialize(s,t)),u||(u=new o,Hs&&console.log("Create concrete instance for persistent asset",n,"instance:",u),hv(u,n)),n.__concreteInstance=u,n=u}catch(u){console.error("Error creating instance or creating values on instance",u,n,o)}return n}if(Array.isArray(s)){const h=[];for(let u=0;u<s.length;u++){const f=s[u],p=AD(f,e,t,i,f);h.push(p)}return h}const a=i==null?void 0:i.serializer;if(a)return a.onDeserialize(s,t);let l;if(s&&(s.isMaterial||s.isTexture||s.isObject3D||s instanceof go))l=s;else{if(s===void 0)return;if(s===null&&(o===Ht||o===Wt||o===fe||o===go))return null;try{l=new o(...Gfe(s))}catch(h){console.error("Error creating "+t.path,t.target,h);return}}const c=l;return c.$serializedTypes&&cE(c,s,t),l}function Gfe(s){if(c1.length=0,typeof s=="object"&&s!==null&&s!==void 0)for(const e of Object.keys(s))c1.push(s[e]);return c1}const _D=Symbol("assigned component properties");function hv(s,e,t){var n;if(e==null||s==null)return;s[_D]=!0;const i=((n=s.constructor)==null?void 0:n.name)??"unknown";t==null||t.registerDefinedKeys(i,s);for(const r of Object.keys(e)){const o=Hfe(s,r);typeof(o==null?void 0:o.value)!="function"&&(!o||o.writable===!0||(o==null?void 0:o.set)!==void 0)&&(s[r]=e[r])}delete s[_D]}function Hfe(s,e){let t;do t=Object.getOwnPropertyDescriptor(s,e);while(!t&&(s=Object.getPrototypeOf(s)));return t}const p9=Symbol("customVisibilityFlag");function fd(s,e){s.layers[p9]=e}const iG=Symbol("DidPatchLayers");function Vfe(){const s=Vr.prototype;if(s[iG])return;s[iG]=!0;const e=s.test;s.test=function(t){return this[p9]===!1?!1:e.call(this,t)}}Vfe();Object.defineProperty(Vt.prototype,"fov",{get:function(){return this._fov},set:function(s){const e=s!==this._fov;this._fov=s,e&&this.view!==void 0&&this.updateProjectionMatrix()}});Object.defineProperty(Vt.prototype,"near",{get:function(){return this._near},set:function(s){const e=s!==this._near;this._near=s,e&&this.view!==void 0&&this.updateProjectionMatrix()}});Object.defineProperty(Vt.prototype,"far",{get:function(){return this._far},set:function(s){const e=s!==this._far;this._far=s,e&&this.view!==void 0&&this.updateProjectionMatrix()}});const m9=new Map;function g9(s,e){if(!s)return;if(!e){console.warn("No prototype found",s,s.prototype,s.constructor);return}const t=m9.get(e);t&&t.apply(s)}function y9(s){const e=Qfe(s.prototype);m9.set(s,e)}function Qfe(s){return new Wfe(s)}class Wfe{constructor(e){d(this,"$symbol");d(this,"extensions");d(this,"descriptors");this.$symbol=Symbol("prototype-extension"),this.extensions=Object.keys(e),this.descriptors=new Array;for(let t=0;t<this.extensions.length;t++){const i=this.extensions[t],n=Object.getOwnPropertyDescriptor(e,i);n&&this.descriptors.push(n)}}apply(e){if(!e[this.$symbol]){e[this.$symbol]=!0;for(let t=0;t<this.extensions.length;t++){const i=this.extensions[t],n=this.descriptors[t];n&&Object.defineProperty(e,i,n)}}}}const jf=new tf,kr=new S,Vu=new S,gn=new Ce,nG={X:new S(1,0,0),Y:new S(0,1,0),Z:new S(0,0,1)},eP={type:"change"},sG={type:"mouseDown"},rG={type:"mouseUp",mode:null},oG={type:"objectChange"};class jfe extends ye{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new Xk;this._gizmo=i,this.add(i);const n=new Zfe;this._plane=n,this.add(n);const r=this;function o(A,_){let b=_;Object.defineProperty(r,A,{get:function(){return b!==void 0?b:_},set:function(x){b!==x&&(b=x,n[A]=x,i[A]=x,r.dispatchEvent({type:A+"-changed",value:x}),r.dispatchEvent(eP))}}),r[A]=_,n[A]=_,i[A]=_}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new S,l=new S,c=new Ce,h=new Ce,u=new S,f=new Ce,p=new S,m=new S,v=new S,g=0,y=new S;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",h),o("cameraPosition",u),o("cameraQuaternion",f),o("pointStart",p),o("pointEnd",m),o("rotationAxis",v),o("rotationAngle",g),o("eye",y),this._offset=new S,this._startNorm=new S,this._endNorm=new S,this._cameraScale=new S,this._parentPosition=new S,this._parentQuaternion=new Ce,this._parentQuaternionInv=new Ce,this._parentScale=new S,this._worldScaleStart=new S,this._worldQuaternionInv=new Ce,this._worldScale=new S,this._positionStart=new S,this._quaternionStart=new Ce,this._scaleStart=new S,this._getPointer=qfe.bind(this),this._onPointerDown=Yfe.bind(this),this._onPointerHover=Xfe.bind(this),this._onPointerMove=Kfe.bind(this),this._onPointerUp=Jfe.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&jf.setFromCamera(e,this.camera);const t=tP(this._gizmo.picker[this.mode],jf);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&jf.setFromCamera(e,this.camera);const t=tP(this._plane,jf,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,sG.mode=this.mode,this.dispatchEvent(sG)}}pointerMove(e){const t=this.axis,i=this.mode,n=this.object;let r=this.space;if(i==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),n===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&jf.setFromCamera(e,this.camera);const o=tP(this._plane,jf,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(n.position.applyQuaternion(gn.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),r==="world"&&(n.parent&&n.position.add(kr.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(kr.setFromMatrixPosition(n.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Vu.set(a,a,a)}else kr.copy(this.pointStart),Vu.copy(this.pointEnd),kr.applyQuaternion(this._worldQuaternionInv),Vu.applyQuaternion(this._worldQuaternionInv),Vu.divide(kr),t.search("X")===-1&&(Vu.x=1),t.search("Y")===-1&&(Vu.y=1),t.search("Z")===-1&&(Vu.z=1);n.scale.copy(this._scaleStart).multiply(Vu),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(kr.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(kr.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(nG[t]),kr.copy(nG[t]),r==="local"&&kr.applyQuaternion(this.worldQuaternion),kr.cross(this.eye),kr.length()===0?l=!0:this.rotationAngle=this._offset.dot(kr.normalize())*a),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(gn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(gn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(eP),this.dispatchEvent(oG)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(rG.mode=this.mode,this.dispatchEvent(rG)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(eP),this.dispatchEvent(oG),this.pointStart.copy(this.pointEnd))}getRaycaster(){return jf}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function qfe(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const e=this.domElement.getBoundingClientRect();return{x:(s.clientX-e.left)/e.width*2-1,y:-(s.clientY-e.top)/e.height*2+1,button:s.button}}}function Xfe(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function Yfe(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function Kfe(s){this.enabled&&this.pointerMove(this._getPointer(s))}function Jfe(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function tP(s,e,t){const i=e.intersectObject(s,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||t)return i[n];return!1}const CS=new li,Qi=new S(0,1,0),aG=new S(0,0,0),lG=new le,ES=new Ce,h1=new Ce,ec=new S,cG=new le,EA=new S(1,0,0),cp=new S(0,1,0),MA=new S(0,0,1),MS=new S,F0=new S,U0=new S;class Xk extends ye{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new ti({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new ji({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const n=t.clone();n.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const u=e.clone();u.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const v=new Xn(0,.04,.1,12);v.translate(0,.05,0);const g=new Ki(.08,.08,.08);g.translate(0,.04,0);const y=new yt;y.setAttribute("position",new rt([0,0,0,1,0,0],3));const A=new Xn(.0075,.0075,.5,3);A.translate(0,.25,0);function _(G,L){const U=new Gh(G,.0075,3,64,L*Math.PI*2);return U.rotateY(Math.PI/2),U.rotateX(Math.PI/2),U}function b(){const G=new yt;return G.setAttribute("position",new rt([0,0,0,1,1,1],3)),G}const x={X:[[new fe(v,r),[.5,0,0],[0,0,-Math.PI/2]],[new fe(v,r),[-.5,0,0],[0,0,Math.PI/2]],[new fe(A,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new fe(v,o),[0,.5,0]],[new fe(v,o),[0,-.5,0],[Math.PI,0,0]],[new fe(A,o)]],Z:[[new fe(v,a),[0,0,.5],[Math.PI/2,0,0]],[new fe(v,a),[0,0,-.5],[-Math.PI/2,0,0]],[new fe(A,a),null,[Math.PI/2,0,0]]],XYZ:[[new fe(new qh(.1,0),u.clone()),[0,0,0]]],XY:[[new fe(new Ki(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new fe(new Ki(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new fe(new Ki(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},E={X:[[new fe(new Xn(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new fe(new Xn(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new fe(new Xn(.2,0,.6,4),i),[0,.3,0]],[new fe(new Xn(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new fe(new Xn(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new fe(new Xn(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new fe(new qh(.2,0),i)]],XY:[[new fe(new Ki(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new fe(new Ki(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new fe(new Ki(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new fe(new qh(.01,2),n),null,null,null,"helper"]],END:[[new fe(new qh(.01,2),n),null,null,null,"helper"]],DELTA:[[new An(b(),n),null,null,null,"helper"]],X:[[new An(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new An(y,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new An(y,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},T={XYZE:[[new fe(_(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new fe(_(.5,.5),r)]],Y:[[new fe(_(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new fe(_(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new fe(_(.75,1),f),null,[0,Math.PI/2,0]]]},R={AXIS:[[new An(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},w={XYZE:[[new fe(new cl(.25,10,8),i)]],X:[[new fe(new Gh(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new fe(new Gh(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new fe(new Gh(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new fe(new Gh(.75,.1,2,24),i)]]},I={X:[[new fe(g,r),[.5,0,0],[0,0,-Math.PI/2]],[new fe(A,r),[0,0,0],[0,0,-Math.PI/2]],[new fe(g,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new fe(g,o),[0,.5,0]],[new fe(A,o)],[new fe(g,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new fe(g,a),[0,0,.5],[Math.PI/2,0,0]],[new fe(A,a),[0,0,0],[Math.PI/2,0,0]],[new fe(g,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new fe(new Ki(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new fe(new Ki(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new fe(new Ki(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new fe(new Ki(.1,.1,.1),u.clone())]]},O={X:[[new fe(new Xn(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new fe(new Xn(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new fe(new Xn(.2,0,.6,4),i),[0,.3,0]],[new fe(new Xn(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new fe(new Xn(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new fe(new Xn(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new fe(new Ki(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new fe(new Ki(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new fe(new Ki(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new fe(new Ki(.2,.2,.2),i),[0,0,0]]]},k={X:[[new An(y,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new An(y,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new An(y,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function B(G){const L=new ye;for(const U in G)for(let z=G[U].length;z--;){const j=G[U][z][0].clone(),X=G[U][z][1],re=G[U][z][2],ce=G[U][z][3],Me=G[U][z][4];j.name=U,j.tag=Me,X&&j.position.set(X[0],X[1],X[2]),re&&j.rotation.set(re[0],re[1],re[2]),ce&&j.scale.set(ce[0],ce[1],ce[2]),j.updateMatrix();const se=j.geometry.clone();se.applyMatrix4(j.matrix),j.geometry=se,j.renderOrder=1/0,j.position.set(0,0,0),j.rotation.set(0,0,0),j.scale.set(1,1,1),L.add(j)}return L}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=B(x)),this.add(this.gizmo.rotate=B(T)),this.add(this.gizmo.scale=B(I)),this.add(this.picker.translate=B(E)),this.add(this.picker.rotate=B(w)),this.add(this.picker.scale=B(O)),this.add(this.helper.translate=B(M)),this.add(this.helper.rotate=B(R)),this.add(this.helper.scale=B(k)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:h1;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let r=0;r<n.length;r++){const o=n[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(gn.setFromEuler(CS.set(0,0,0)),o.quaternion.copy(i).multiply(gn),Math.abs(Qi.copy(EA).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(gn.setFromEuler(CS.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply(gn),Math.abs(Qi.copy(cp).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(gn.setFromEuler(CS.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply(gn),Math.abs(Qi.copy(MA).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(gn.setFromEuler(CS.set(0,Math.PI/2,0)),Qi.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(lG.lookAt(aG,Qi,cp)),o.quaternion.multiply(gn),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),kr.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),kr.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(kr),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Qi.copy(EA).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Qi.copy(cp).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Qi.copy(MA).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Qi.copy(MA).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Qi.copy(EA).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Qi.copy(cp).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(ES.copy(i),Qi.copy(this.eye).applyQuaternion(gn.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(lG.lookAt(this.eye,aG,cp)),o.name==="X"&&(gn.setFromAxisAngle(EA,Math.atan2(-Qi.y,Qi.z)),gn.multiplyQuaternions(ES,gn),o.quaternion.copy(gn)),o.name==="Y"&&(gn.setFromAxisAngle(cp,Math.atan2(Qi.x,Qi.z)),gn.multiplyQuaternions(ES,gn),o.quaternion.copy(gn)),o.name==="Z"&&(gn.setFromAxisAngle(MA,Math.atan2(Qi.y,Qi.x)),gn.multiplyQuaternions(ES,gn),o.quaternion.copy(gn))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class Zfe extends fe{constructor(){super(new ps(1e5,1e5,2,2),new ti({visible:!1,wireframe:!0,side:_i,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),MS.copy(EA).applyQuaternion(t==="local"?this.worldQuaternion:h1),F0.copy(cp).applyQuaternion(t==="local"?this.worldQuaternion:h1),U0.copy(MA).applyQuaternion(t==="local"?this.worldQuaternion:h1),Qi.copy(F0),this.mode){case"translate":case"scale":switch(this.axis){case"X":Qi.copy(this.eye).cross(MS),ec.copy(MS).cross(Qi);break;case"Y":Qi.copy(this.eye).cross(F0),ec.copy(F0).cross(Qi);break;case"Z":Qi.copy(this.eye).cross(U0),ec.copy(U0).cross(Qi);break;case"XY":ec.copy(U0);break;case"YZ":ec.copy(MS);break;case"XZ":Qi.copy(U0),ec.copy(F0);break;case"XYZ":case"E":ec.set(0,0,0);break}break;case"rotate":default:ec.set(0,0,0)}ec.length()===0?this.quaternion.copy(this.cameraQuaternion):(cG.lookAt(kr.set(0,0,0),ec,Qi),this.quaternion.setFromRotationMatrix(cG)),super.updateMatrixWorld(e)}}const $fe=ie("debuggetcomponent"),hG=()=>$fe||globalThis.NEEDLE_DEBUG_GETCOMPONENT===!0;function epe(s){return s==null||s.isObject3D?s:s.object&&s.object.isObject3D?s.object:s}function Yk(s,e){if(!s||!s.userData.components)return e;const t=s.userData.components.indexOf(e);return t<0||(Yb.dispatchComponentLifecycleEvent(Xb.Removing,e),e.gameObject=null,s.userData.components.splice(t,1)),e}function Zb(s,e,t){const i=ym(s,e);return i||va(s,e,t)}const v9=new Ms("addComponentIdProvider");function zp(s,e,t=!0){s.userData||(s.userData={}),s.userData.components||(s.userData.components=[]),s.userData.components.push(e),e.gameObject=s,(e.guid===void 0||e.guid==="invalid")&&(e.guid=v9.generateUUID()),JM(s),iT(e,e.context);try{t&&e.__internalAwake&&(s_(s),e.activeAndEnabled&&e.__internalAwake()),Yb.dispatchComponentLifecycleEvent(Xb.Added,e)}catch(i){console.error(i)}return e}function va(s,e,t,i){if(typeof e=="function"){const n=new e;t&&n.__internalNewInstanceCreated(t);let r=!0;return(i==null?void 0:i.callAwake)!=null&&(r=i.callAwake),zp(s,n,r)}if(e.destroyed)return console.warn("Can not move/add a destroyed component",e),e;if(e.gameObject===s)return e;if(e.gameObject&&e.gameObject.userData.components){const n=e.gameObject.userData.components.indexOf(e);e.gameObject.userData.components.splice(n,1)}if(!s.userData.components)s.userData.components=[];else if(s.userData.components.includes(e))return e;return s.userData.components.push(e),e.gameObject=s,(e.guid===void 0||e.guid==="invalid")&&(e.guid=v9.generateUUID()),t&&e._internalInit(t),iT(e,e.context),e}function A9(s){if(s.gameObject&&s.gameObject.userData.components){const e=s.gameObject.userData.components.indexOf(s);s.gameObject.userData.components.splice(e,1)}s.__internalDisable&&s.__internalDisable(),Vh(s,s.context??Dt.Current),s.destroy(),s.gameObject=null}let uG=!1;function _9(s,e,t){var i;if(s==null)return null;if(!s.isObject3D)return console.error("Object is not object3D"),null;if(!((i=s==null?void 0:s.userData)!=null&&i.components)||(typeof e=="string"&&(uG||(uG=!0,console.warn(`Accessing components by name is not supported.
Please use the component type instead. This may keep working in local development but it will fail when bundling your application.

You can import other modules your main module to get access to types
or if you use npmdefs you can make types available globally using globalThis:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis`,e))),hG()&&console.log("[onGetComponent] FIND",e),e==null))return null;for(let n=0;n<s.userData.components.length;n++){const r=s.userData.components[n];let o=Object.getPrototypeOf(r);for(;o;){if(o===e.prototype)if(hG()&&console.log("[onGetComponent] MATCH BY PROTOYPE",o),t)t.push(r);else return r;o=Object.getPrototypeOf(o)}}return t||null}function ym(s,e){const t=_9(s,e);return t?Array.isArray(t)?t[0]:t:null}function $b(s,e,t,i=!0){return t||(t=[]),i&&(t.length=0),_9(s,e,t),t}function ex(s,e,t){var n;const i=ym(s,e);if(t===!1&&(i==null?void 0:i.enabled)===!1)return null;if(i)return i;for(let r=0;r<((n=s==null?void 0:s.children)==null?void 0:n.length);r++){const o=ex(s.children[r],e);if(o)return o}return null}function Rv(s,e,t,i=!0){var n;t||(t=[]),i&&(t.length=0),$b(s,e,t,!1);for(let r=0;r<((n=s==null?void 0:s.children)==null?void 0:n.length);r++)Rv(s.children[r],e,t,!1);return t}function Z_(s,e){if(!s)return null;if(Array.isArray(s)){for(let i=0;i<s.length;i++){const n=epe(s[i]),r=Z_(n,e);if(r)return r}return null}const t=ym(s,e);return t||(s.parent?Z_(s.parent,e):null)}function YM(s,e,t,i=!0){return t||(t=[]),i&&(t.length=0),s?($b(s,e,t,!1),s.parent?YM(s.parent,e,t,!1):t):t}function KM(s,e=void 0,t=!0){if(!s)return null;if(!e&&(e=Dt.Current,!e))return console.error("Can not search object without any needle context or scene!!!"),null;let i=e;if(i.isScene||(i=e==null?void 0:e.scene),!i)return null;for(const n in i.children){const r=i.children[n];if(t===!1&&r[$h]===!1)continue;const o=ex(r,s);if(o)return o}return null}function b9(s,e,t=void 0){if(!s)return e;if(e||(e=[]),e.length=0,!t&&(t=Dt.Current,!t))return console.error("Can not search object without any needle context or scene!!!"),e;"scene"in t&&(t=t.scene);const i=t;if(!i)return e;for(const n in i.children){const r=i.children[n];Rv(r,s,e,!1)}return e}function JM(s){s&&s.isObject3D===!0&&g9(s,ye)}ye.prototype.SetActive=function(s){this.visible=s};ye.prototype.setActive=function(s){this.visible=s};ye.prototype.destroy=function(){xa(this)};ye.prototype.addComponent=function(s,e){return va(this,s,e)};ye.prototype.addNewComponent=function(s,e){return va(this,s,e)};ye.prototype.removeComponent=function(s){return Yk(this,s)};ye.prototype.getOrAddComponent=function(s,e){return Zb(this,s,e)};ye.prototype.getComponent=function(s){return ym(this,s)};ye.prototype.getComponents=function(s,e){return $b(this,s,e)};ye.prototype.getComponentInChildren=function(s){return ex(this,s)};ye.prototype.getComponentsInChildren=function(s,e){return Rv(this,s,e)};ye.prototype.getComponentInParent=function(s){return Z_(this,s)};ye.prototype.getComponentsInParent=function(s,e){return YM(this,s,e)};Object.getOwnPropertyDescriptor(ye.prototype,"activeSelf")||Object.defineProperty(ye.prototype,"activeSelf",{get:function(){return Pv(this)},set:function(s){r_(this,s)}});Object.getOwnPropertyDescriptor(ye.prototype,"transform")||Object.defineProperty(ye.prototype,"transform",{get:function(){return this}});Object.getOwnPropertyDescriptor(ye.prototype,"worldPosition")||Object.defineProperty(ye.prototype,"worldPosition",{get:function(){return this instanceof Xk?Ft(this.object):Ft(this)},set:function(s){Es(this,s)}});Object.getOwnPropertyDescriptor(ye.prototype,"worldQuaternion")||Object.defineProperty(ye.prototype,"worldQuaternion",{get:function(){return this instanceof Xk?ki(this.object):ki(this)},set:function(s){rl(this,s)}});Object.getOwnPropertyDescriptor(ye.prototype,"worldRotation")||Object.defineProperty(ye.prototype,"worldRotation",{get:function(){return Gb(this)},set:function(s){ik(this,s)}});Object.getOwnPropertyDescriptor(ye.prototype,"worldScale")||Object.defineProperty(ye.prototype,"worldScale",{get:function(){return $i(this)},set:function(s){sv(this,s)}});Object.getOwnPropertyDescriptor(ye.prototype,"worldForward")||Object.defineProperty(ye.prototype,"worldForward",{get:function(){return wt().set(0,0,1).applyQuaternion(ki(this))}});Object.getOwnPropertyDescriptor(ye.prototype,"worldRight")||Object.defineProperty(ye.prototype,"worldRight",{get:function(){return wt().set(1,0,0).applyQuaternion(ki(this))}});Object.getOwnPropertyDescriptor(ye.prototype,"worldUp")||Object.defineProperty(ye.prototype,"worldUp",{get:function(){return wt().set(0,1,0).applyQuaternion(ki(this))}});y9(ye);class Ui extends Ae{constructor(t,i,n,r){super(t,i,n);d(this,"alpha",1);this.alpha=r}get isRGBAColor(){return!0}set a(t){this.alpha=t}get a(){return this.alpha}clone(){const t=super.clone();return t.alpha=this.alpha,t}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,"alpha"in t&&typeof t.alpha=="number"?this.alpha=t.alpha:typeof t.a=="number"&&(this.alpha=t.a),this}lerp(t,i){const n=t;return n.alpha!=null&&(this.alpha=it.lerp(this.alpha,n.alpha,i)),super.lerp(t,i)}lerpColors(t,i,n){const r=t,o=i;return r.alpha!=null&&o.alpha!=null&&(this.alpha=it.lerp(r.alpha,o.alpha,n)),super.lerpColors(t,i,n)}multiply(t){const i=t;return i.alpha!=null&&(this.alpha=this.alpha*i.alpha),super.multiply(t)}fromArray(t,i=0){return this.alpha=t[i+3],super.fromArray(t,i)}}const u1=ie("debuggetcomponent"),d1=ie("debuginstantiate");var x9=(s=>(s[s.None=0]="None",s[s.HideInHierarchy=1]="HideInHierarchy",s[s.HideInInspector=2]="HideInInspector",s[s.DontSaveInEditor=4]="DontSaveInEditor",s[s.NotEditable=8]="NotEditable",s[s.DontSaveInBuild=16]="DontSaveInBuild",s[s.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",s[s.DontSave=52]="DontSave",s[s.HideAndDontSave=61]="HideAndDontSave",s))(x9||{});class Xl{constructor(){d(this,"idProvider");d(this,"parent");d(this,"keepWorldPosition");d(this,"position");d(this,"rotation");d(this,"scale");d(this,"visible");d(this,"context");d(this,"components")}clone(){var t,i,n;const e=new Xl;return e.idProvider=this.idProvider,e.parent=this.parent,e.keepWorldPosition=this.keepWorldPosition,e.position=(t=this.position)==null?void 0:t.clone(),e.rotation=(i=this.rotation)==null?void 0:i.clone(),e.scale=(n=this.scale)==null?void 0:n.clone(),e.visible=this.visible,e.context=this.context,e.components=this.components,e}cloneAssign(e){var t,i,n;this.idProvider=e.idProvider,this.parent=e.parent,this.keepWorldPosition=e.keepWorldPosition,this.position=(t=e.position)==null?void 0:t.clone(),this.rotation=(i=e.rotation)==null?void 0:i.clone(),this.scale=(n=e.scale)==null?void 0:n.clone(),this.visible=e.visible,this.context=e.context,this.components=e.components}}function Pv(s){return s.visible}function r_(s,e){return typeof e=="number"&&(e=e>.5),s.visible=e,s.visible}function w9(s){return s[$h]||ZM(s)}function S9(s,e){s[Zj]=e}function ZM(s){return sl.isUsingInstancing(s)}function tx(s,e){return $y(s,e,!0,!0)}const C9=Symbol("isDestroyed");function am(s){return s[C9]}function E9(s,e){s[C9]=e}const bD=Symbol("isDontDestroy");function xD(s,e=!0){s[bD]=e}const f1=[],p1=[];function xa(s,e=!0,t=!1){f1.length=0,p1.length=0,wD(s,e,!0);for(const i of f1)i.gameObject=null,i.context=null;for(const i of p1)E9(i,!0),t&&Xi(i),Jj(i);p1.length=0,f1.length=0}function wD(s,e=!0,t=!0){var o;if(s==null)return;const i=s;if(i.isComponent){if(i[bD])return;f1.push(i);const a=i.gameObject;i.__internalDisable(),i.__internalDestroy(),i.gameObject=a;return}if(s[bD])return;const n=s;u1&&console.log(n),p1.push(n);const r=(o=n.userData)==null?void 0:o.components;if(r!=null&&Array.isArray(r)){let a=r.length;for(let l=0;l<r.length;l++){const c=r[l];wD(c,e,!1),r.length<a&&(a=r.length,l--)}}if(e&&n.children)for(const a of n.children)wD(a,e,!1);t&&n.removeFromParent()}function lm(s,e,t=!0){return M9(s,e,t)}function*$M(s,e,t=!1,i=999,n=0){if(s!=null&&s.userData.components&&!(n>i)){for(const r of s.userData.components)e&&(r==null?void 0:r.isComponent)===!0&&r instanceof e?yield r:yield r;if(t===!0)for(const r of s.children)yield*$M(r,e,!0,i,n+1)}}function M9(s,e,t,i=0){var n;if(s){if(s.isObject3D,i>1e3){console.warn("Failed to iterate components: too many levels");return}if((n=s.userData)!=null&&n.components)for(let r=0;r<s.userData.components.length;r++){const o=s.userData.components[r];if((o==null?void 0:o.isComponent)===!0){const a=e(o);if(a!==void 0)return a}}if(t&&s.children){const r=i+1;for(let o=0;o<s.children.length;o++){const a=s.children[o];if(!a)continue;const l=M9(a,e,t,r);if(l!==void 0)return l}}}}function Bv(s,e=null){let t=null;e!==null&&(e.x!==void 0?(t=new Xl,t.position=e):t=e);let i=Dt.Current;t!=null&&t.context&&(i=t.context),u1&&i.alias&&console.log("context",i.alias),t&&!t.idProvider&&(t.idProvider=new Ms(Date.now()));const n=[],r={},o={},a=T9(i,s,t,n,r,o);a&&(ipe(r),tpe(o,r)),u1&&(Y1(s,!0),Y1(a,!0));const l={};if((t==null?void 0:t.components)!==!1){for(const c in n){const h=n[c],u=h.guid;t&&t.idProvider&&(h.guid=t.idProvider.generateUUID(),l[u]=h.guid,u1&&console.log(h.name,h.guid)),iT(h,i),h.__internalNewInstanceCreated&&h.__internalNewInstanceCreated()}for(const c in n){const h=n[c];h.resolveGuids&&h.resolveGuids(l),h.enabled!==!1&&(h.enabled=!0)}oE(i)}return a}function T9(s,e,t,i,n,r){var h;if(!e)return null;const o=e.userData;e.userData={};const a=e.children;e.children=[];const l=e.clone(!1);if(JM(l),e.userData=o,e.children=a,n[e.uuid]={original:e,clone:l},d1&&console.log("ADD",e,l),e.type==="SkinnedMesh"&&(r[e.uuid]={original:e,clone:l}),(t==null?void 0:t.visible)!==void 0&&(l.visible=t.visible),t!=null&&t.idProvider){l.uuid=t.idProvider.generateUUID();const u=l;u&&(u.guid=l.uuid)}e.animations&&e.animations.length>0&&(l.animations=[...e.animations]);const c=e.parent;if(c&&c.add(l),t!=null&&t.position?Es(l,t.position):l.position.copy(e.position),t!=null&&t.rotation?rl(l,t.rotation):l.quaternion.copy(e.quaternion),t!=null&&t.scale?l.scale.copy(t.scale):l.scale.copy(e.scale),t!=null&&t.parent&&t.parent!=="scene"){let u=null;if(typeof t.parent=="string"?u=$y(t.parent,s.scene,!0):u=t.parent,u){const f=t.keepWorldPosition===!0?u.attach:u.add;f?f.call(u,l):console.error("Invalid parent object",u,"received when instantiating:",e)}else console.warn("could not find parent:",t.parent)}for(const[u,f]of Object.entries(e.userData))u!=="components"&&(l.userData[u]=f);if((h=e.userData)!=null&&h.components){const u=e.userData.components,f=[];l.userData.components=f;for(let p=0;p<u.length;p++){const m=u[p],v=new m.constructor;hv(v,m),m[qA]!==void 0&&(v[qA]=m[qA]),f.push(v),v.gameObject=l,i.push(v),n[m.guid]={original:m,clone:v},Yb.dispatchComponentLifecycleEvent(Xb.Added,v)}}t&&(t.position=void 0,t.rotation=void 0,t.scale=void 0,t.parent=void 0);for(const u in e.children){const f=e.children[u],p=T9(s,f,t,i,n,r);p&&l.add(p)}return l}function tpe(s,e){for(const t in s){const i=s[t],n=i.original,r=n.skeleton,o=i.clone;if(!r){console.warn("Skinned mesh has no skeleton?",i);continue}const a=r.bones,l=o.skeleton.clone();o.skeleton=l,o.bindMatrix.clone().copy(n.bindMatrix),o.bindMatrixInverse.copy(n.bindMatrixInverse);const c=[];l.bones=c;for(let h=0;h<a.length;h++){const u=a[h],p=e[u.uuid].clone;c.push(p)}}for(const t in s){const i=s[t].clone;i.skeleton.update(),i.bind(i.skeleton,i.bindMatrix),i.updateMatrixWorld(!0)}}function ipe(s){var e;for(const t in s){const n=s[t].clone;if(n!=null&&n.isObject3D&&((e=n==null?void 0:n.userData)!=null&&e.components))for(let r=0;r<n.userData.components.length;r++){const o=n.userData.components[r],a=Object.entries(o);for(const[l,c]of a)if(Array.isArray(c)){const h=[];o[l]=h;for(let u=0;u<c.length;u++){const f=c[u];if(typeof f!="object"){h.push(f);continue}const p=dG(o,l,f,s);p!==void 0?h.push(p):h.push(f)}}else if(typeof c=="object"){const h=dG(o,l,c,s);h!==void 0&&(o[l]=h)}}}}function dG(s,e,t,i){var n,r;if(t!=null)if(t.isComponent===!0){const o=t.gameObject;if(o){const a=o.uuid,l=(n=i[a])==null?void 0:n.clone;if(!l){d1&&console.log("reference did not change",e,s,t);return}const c=o.userData.components.indexOf(t);if(c>=0&&l.isObject3D)return d1&&console.log(e,a),l.userData.components[c];console.warn("could not find component",e,t)}}else if(t.isObject3D===!0){if(e==="gameObject")return;const o=t;if(o){const a=o.uuid,l=(r=i[a])==null?void 0:r.clone;if(l)return d1&&console.log(e,"old",t,"new",l),l}}else{if(t.isVector4||t.isVector3||t.isVector2||t.isQuaternion||t.isEuler)return t.clone();if(t.isColor===!0)return t.clone();if(t.isEventList===!0)return t.__internalOnInstantiate(i)}}var I9={exports:{}},R9={exports:{}};(function(){var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,i){return t<<i|t>>>32-i},rotr:function(t,i){return t<<32-i|t>>>i},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var i=0;i<t.length;i++)t[i]=e.endian(t[i]);return t},randomBytes:function(t){for(var i=[];t>0;t--)i.push(Math.floor(Math.random()*256));return i},bytesToWords:function(t){for(var i=[],n=0,r=0;n<t.length;n++,r+=8)i[r>>>5]|=t[n]<<24-r%32;return i},wordsToBytes:function(t){for(var i=[],n=0;n<t.length*32;n+=8)i.push(t[n>>>5]>>>24-n%32&255);return i},bytesToHex:function(t){for(var i=[],n=0;n<t.length;n++)i.push((t[n]>>>4).toString(16)),i.push((t[n]&15).toString(16));return i.join("")},hexToBytes:function(t){for(var i=[],n=0;n<t.length;n+=2)i.push(parseInt(t.substr(n,2),16));return i},bytesToBase64:function(t){for(var i=[],n=0;n<t.length;n+=3)for(var r=t[n]<<16|t[n+1]<<8|t[n+2],o=0;o<4;o++)n*8+o*6<=t.length*8?i.push(s.charAt(r>>>6*(3-o)&63)):i.push("=");return i.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var i=[],n=0,r=0;n<t.length;r=++n%4)r!=0&&i.push((s.indexOf(t.charAt(n-1))&Math.pow(2,-2*r+8)-1)<<r*2|s.indexOf(t.charAt(n))>>>6-r*2);return i}};R9.exports=e})();var npe=R9.exports,SD={utf8:{stringToBytes:function(s){return SD.bin.stringToBytes(unescape(encodeURIComponent(s)))},bytesToString:function(s){return decodeURIComponent(escape(SD.bin.bytesToString(s)))}},bin:{stringToBytes:function(s){for(var e=[],t=0;t<s.length;t++)e.push(s.charCodeAt(t)&255);return e},bytesToString:function(s){for(var e=[],t=0;t<s.length;t++)e.push(String.fromCharCode(s[t]));return e.join("")}}},fG=SD;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var spe=function(s){return s!=null&&(P9(s)||rpe(s)||!!s._isBuffer)};function P9(s){return!!s.constructor&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s)}function rpe(s){return typeof s.readFloatLE=="function"&&typeof s.slice=="function"&&P9(s.slice(0,0))}(function(){var s=npe,e=fG.utf8,t=spe,i=fG.bin,n=function(r,o){r.constructor==String?o&&o.encoding==="binary"?r=i.stringToBytes(r):r=e.stringToBytes(r):t(r)?r=Array.prototype.slice.call(r,0):!Array.isArray(r)&&r.constructor!==Uint8Array&&(r=r.toString());for(var a=s.bytesToWords(r),l=r.length*8,c=1732584193,h=-271733879,u=-1732584194,f=271733878,p=0;p<a.length;p++)a[p]=(a[p]<<8|a[p]>>>24)&16711935|(a[p]<<24|a[p]>>>8)&4278255360;a[l>>>5]|=128<<l%32,a[(l+64>>>9<<4)+14]=l;for(var m=n._ff,v=n._gg,g=n._hh,y=n._ii,p=0;p<a.length;p+=16){var A=c,_=h,b=u,x=f;c=m(c,h,u,f,a[p+0],7,-680876936),f=m(f,c,h,u,a[p+1],12,-389564586),u=m(u,f,c,h,a[p+2],17,606105819),h=m(h,u,f,c,a[p+3],22,-1044525330),c=m(c,h,u,f,a[p+4],7,-176418897),f=m(f,c,h,u,a[p+5],12,1200080426),u=m(u,f,c,h,a[p+6],17,-1473231341),h=m(h,u,f,c,a[p+7],22,-45705983),c=m(c,h,u,f,a[p+8],7,1770035416),f=m(f,c,h,u,a[p+9],12,-1958414417),u=m(u,f,c,h,a[p+10],17,-42063),h=m(h,u,f,c,a[p+11],22,-1990404162),c=m(c,h,u,f,a[p+12],7,1804603682),f=m(f,c,h,u,a[p+13],12,-40341101),u=m(u,f,c,h,a[p+14],17,-1502002290),h=m(h,u,f,c,a[p+15],22,1236535329),c=v(c,h,u,f,a[p+1],5,-165796510),f=v(f,c,h,u,a[p+6],9,-1069501632),u=v(u,f,c,h,a[p+11],14,643717713),h=v(h,u,f,c,a[p+0],20,-373897302),c=v(c,h,u,f,a[p+5],5,-701558691),f=v(f,c,h,u,a[p+10],9,38016083),u=v(u,f,c,h,a[p+15],14,-660478335),h=v(h,u,f,c,a[p+4],20,-405537848),c=v(c,h,u,f,a[p+9],5,568446438),f=v(f,c,h,u,a[p+14],9,-1019803690),u=v(u,f,c,h,a[p+3],14,-187363961),h=v(h,u,f,c,a[p+8],20,1163531501),c=v(c,h,u,f,a[p+13],5,-1444681467),f=v(f,c,h,u,a[p+2],9,-51403784),u=v(u,f,c,h,a[p+7],14,1735328473),h=v(h,u,f,c,a[p+12],20,-1926607734),c=g(c,h,u,f,a[p+5],4,-378558),f=g(f,c,h,u,a[p+8],11,-2022574463),u=g(u,f,c,h,a[p+11],16,1839030562),h=g(h,u,f,c,a[p+14],23,-35309556),c=g(c,h,u,f,a[p+1],4,-1530992060),f=g(f,c,h,u,a[p+4],11,1272893353),u=g(u,f,c,h,a[p+7],16,-155497632),h=g(h,u,f,c,a[p+10],23,-1094730640),c=g(c,h,u,f,a[p+13],4,681279174),f=g(f,c,h,u,a[p+0],11,-358537222),u=g(u,f,c,h,a[p+3],16,-722521979),h=g(h,u,f,c,a[p+6],23,76029189),c=g(c,h,u,f,a[p+9],4,-640364487),f=g(f,c,h,u,a[p+12],11,-421815835),u=g(u,f,c,h,a[p+15],16,530742520),h=g(h,u,f,c,a[p+2],23,-995338651),c=y(c,h,u,f,a[p+0],6,-198630844),f=y(f,c,h,u,a[p+7],10,1126891415),u=y(u,f,c,h,a[p+14],15,-1416354905),h=y(h,u,f,c,a[p+5],21,-57434055),c=y(c,h,u,f,a[p+12],6,1700485571),f=y(f,c,h,u,a[p+3],10,-1894986606),u=y(u,f,c,h,a[p+10],15,-1051523),h=y(h,u,f,c,a[p+1],21,-2054922799),c=y(c,h,u,f,a[p+8],6,1873313359),f=y(f,c,h,u,a[p+15],10,-30611744),u=y(u,f,c,h,a[p+6],15,-1560198380),h=y(h,u,f,c,a[p+13],21,1309151649),c=y(c,h,u,f,a[p+4],6,-145523070),f=y(f,c,h,u,a[p+11],10,-1120210379),u=y(u,f,c,h,a[p+2],15,718787259),h=y(h,u,f,c,a[p+9],21,-343485551),c=c+A>>>0,h=h+_>>>0,u=u+b>>>0,f=f+x>>>0}return s.endian([c,h,u,f])};n._ff=function(r,o,a,l,c,h,u){var f=r+(o&a|~o&l)+(c>>>0)+u;return(f<<h|f>>>32-h)+o},n._gg=function(r,o,a,l,c,h,u){var f=r+(o&l|a&~l)+(c>>>0)+u;return(f<<h|f>>>32-h)+o},n._hh=function(r,o,a,l,c,h,u){var f=r+(o^a^l)+(c>>>0)+u;return(f<<h|f>>>32-h)+o},n._ii=function(r,o,a,l,c,h,u){var f=r+(a^(o|~l))+(c>>>0)+u;return(f<<h|f>>>32-h)+o},n._blocksize=16,n._digestsize=16,I9.exports=function(r,o){if(r==null)throw new Error("Illegal argument "+r);var a=s.wordsToBytes(n(r,o));return o&&o.asBytes?a:o&&o.asString?i.bytesToString(a):s.bytesToHex(a)}})();var ope=I9.exports;const ape=WM(ope);class CD{constructor(e,t,i,n){d(this,"success");d(this,"filename");d(this,"hash");d(this,"size");d(this,"url");this.success=e,this.filename=t,this.hash=i,this.size=n}}async function B9(s,e){const t=await s.arrayBuffer(),i=Kk(t),n=s.name.split(".").pop(),r=i+"."+n,o=s.name.split(".").shift();console.assert(o!==void 0);const a={alias:o,filename:r},c=await(await fetch(e+"/exists",{method:"POST",body:JSON.stringify(a)})).json();if(c.success||console.warn("exists check did fail"),c.exists)return console.log("file already exists",i),new CD(!0,r,i,s.size);console.log("begin uploading file",o,s.size);const h=new FormData;h.append("file",s);const u={};u.filesize=s.size,o&&(u.alias=o);const p=await(await fetch(e+"/upload/file",{method:"POST",body:h,headers:u})).json();if((p==null?void 0:p.success)===!1)return p.message!==void 0?console.error("Upload failed:",p.message):console.error("Upload failed"),null;console.assert(p.hash_sum===i,"hash sum did not match","received:",p.hash_sum,"expected:",i),p.success&&console.log("successfully uploaded",i,p.id);const m=new CD(p.success,r,i,s.size);return m.url=e,m}function Kk(s){return ape(new Uint8Array(s))}async function Jk(s,e,t,i,n=!1){try{const r=await fetch(i+"/download/file",{method:"POST",body:s});if(r.status!==200)return console.error("download failed",r),null;const o=await r.blob(),a=await o.arrayBuffer();n||console.assert(o.size===t,"size mismatch","expected:",t,"got:",o.size);const l=Kk(a);return n||console.assert(l===e,"hash mismatch, downloaded file is invalid"),o.arrayBuffer()}catch(r){console.error(r)}return null}async function D9(s,e){var h;const t=await fetch(s),i=(h=t.body)==null?void 0:h.getReader(),n=t.headers.get("Content-Length"),r=n?parseInt(n):0;if(!i)return null;let o=0;const a=[];for(;;){const{done:u,value:f}=await i.read();if(f&&(a.push(f),o+=f.length,e.call(null,new ProgressEvent("progress",{loaded:o,total:r}))),u)break}const l=new Uint8Array(o);let c=0;for(const u of a)l.set(u,c),c+=u.length;return l}const Qu=ie("debugaddressables");class O9{constructor(e){d(this,"_context");d(this,"_assetReferences",{});d(this,"preUpdate",()=>{});this._context=e,this._context.pre_update_callbacks.push(this.preUpdate)}dispose(){const e=this._context.pre_update_callbacks.indexOf(this.preUpdate);e>=0&&this._context.pre_update_callbacks.splice(e,1);for(const t in this._assetReferences){const i=this._assetReferences[t];i==null||i.unload()}this._assetReferences={}}findAssetReference(e){return this._assetReferences[e]||null}registerAssetReference(e){return e.uri&&(this._assetReferences[e.uri]?console.warn("Asset reference already registered",e):this._assetReferences[e.uri]=e),e}unregisterAssetReference(e){e.uri&&delete this._assetReferences[e.uri]}}const iP=Symbol("assetReference"),gp=class{constructor(e,t,i=null){d(this,"_loading");d(this,"_asset");d(this,"_glbRoot");d(this,"_url");d(this,"_progressListeners",[]);d(this,"_hash");d(this,"_hashedUri");d(this,"_isLoadingRawBinary",!1);d(this,"_rawBinary");this._url=e,this._hash=t,e.includes("?v=")?this._hashedUri=e:this._hashedUri=t?e+"?v="+t:e,i!==null&&(this.asset=i),l9(this._url,this.onResolvePrefab.bind(this))}static getOrCreateFromUrl(e,t){if(!t&&(t=Dt.Current,!t))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.');const i=t.addressables,n=i.findAssetReference(e);if(n)return n;const r=new gp(e,t.hash);return i.registerAssetReference(r),r}static getOrCreate(e,t,i){if(typeof e=="string"){if(!i&&(i=Dt.Current,!i))throw new Error('Context is required when sourceId is a string. When you call this method from a component you can call it with "getOrCreate(this, url)" where "this" is the component.')}else i=e.context,e=e.sourceId;const n=nf(e,t);Qu&&console.log("GetOrCreate Addressable from",e,t,"FinalPath=",n);const r=i.addressables,o=r.findAssetReference(n);if(o)return o;const a=new gp(n,i.hash);return r.registerAssetReference(a),a}get asset(){return this._glbRoot??this._asset}set asset(e){this._asset=e}get uri(){return this._url}get url(){return this._url}get hasUrl(){return this._url!==void 0&&(this._url.startsWith("http")||this._url.startsWith("blob:")||this._url.startsWith("www.")||this._url.includes("/"))}get rawAsset(){return this._asset}async onResolvePrefab(e){return e===this.uri&&(this.mustLoad&&await this.loadAssetAsync(),this.asset)?this.asset:null}get mustLoad(){return!this.asset||this.asset.__destroyed===!0||am(this.asset)===!0}isLoaded(){return this._rawBinary||this.asset!==void 0}unload(){this.asset&&(Qu&&console.log("Unload",this.asset),this.asset.scene&&xa(this.asset.scene,!0,!0),xa(this.asset,!0,!0)),this.asset=null,this._rawBinary=void 0,this._glbRoot=null,this._loading=void 0,Dt.Current&&Dt.Current.addressables.unregisterAssetReference(this)}async preload(){if(!this.mustLoad||this._isLoadingRawBinary)return null;if(this._rawBinary!==void 0)return this._rawBinary;this._isLoadingRawBinary=!0,Qu&&console.log("Preload",this._hashedUri);const e=await D9(this._hashedUri,t=>{this.raiseProgressEvent(t)});return this._rawBinary=(e==null?void 0:e.buffer)??null,this._isLoadingRawBinary=!1,this._rawBinary}async loadAssetAsync(e){if(Qu&&console.log("loadAssetAsync",this.uri),!this.mustLoad)return this.asset;if(e&&this._progressListeners.push(e),this._loading!==void 0)return this._loading.then(n=>this.asset);const t=Dt.Current;this._rawBinary?(this._loading=Gl().parseSync(t,this._rawBinary,this.uri,null),this.raiseProgressEvent(new ProgressEvent("progress",{loaded:this._rawBinary.byteLength,total:this._rawBinary.byteLength}))):(Qu&&console.log("Load async",this.uri),this._loading=Gl().loadSync(t,this._hashedUri,this.uri,null,n=>{this.raiseProgressEvent(n)}));const i=await this._loading;if(this._progressListeners.length=0,this._glbRoot=this.tryGetActualGameObjectRoot(i),this._loading=void 0,i)return i[iP]=this,this._glbRoot&&(this._glbRoot[iP]=this),this.asset&&(this.asset[iP]=this),oE(t),i.scene!==void 0&&(this.asset=i),this.asset}async instantiate(e){return this.onInstantiate(e,!1)}async instantiateSynced(e,t=!0){return this.onInstantiate(e,!0,t)}beginListenDownload(e){this._progressListeners.indexOf(e)<0&&this._progressListeners.push(e)}endListenDownload(e){const t=this._progressListeners.indexOf(e);t>=0&&this._progressListeners.splice(t,1)}raiseProgressEvent(e){for(const t of this._progressListeners)t(this,e)}async onInstantiate(e,t=!1,i){const n=Dt.Current,r=new Xl;if(e instanceof ye?r.parent=e:e&&(Object.assign(r,e),r.cloneAssign(e)),r.parent||(r.parent=n.scene),this.mustLoad&&await this.loadAssetAsync(),Qu&&console.log("Instantiate",this.uri,"parent:",e),this.asset){Qu&&console.log("Add to scene",this.asset);let o=gp.currentlyInstantiating.get(this.uri);if(o!==void 0&&o>=1e4)return console.error("Recursive or too many instantiations of "+this.uri+" in the same frame ("+o+")"),null;try{if(o===void 0&&(o=0),o+=1,gp.currentlyInstantiating.set(this.uri,o),t){r.context=n;const a=this.asset;a.guid=this.uri;const l=Qk(a,r,void 0,i);if(l)return l}else{const a=Bv(this.asset,r);if(a)return a}}finally{n.post_render_callbacks.push(()=>{o===void 0||o<0?o=0:o-=1,gp.currentlyInstantiating.set(this.uri,o)})}}else Qu&&console.warn("Failed to load asset",this.uri);return null}tryGetActualGameObjectRoot(e){if(e&&e.scene){const t=e.scene;return t.isGroup&&t.children.length===1&&t.children[0].name+"glb"===t.name?t.children[0]:t}return null}};let ei=gp;d(ei,"currentlyInstantiating",new Map);class lpe extends hl{constructor(){super([ei],"AssetReferenceSerializer")}onSerialize(e,t){if(e&&e.uri!==void 0&&typeof e.uri=="string")return e.uri}onDeserialize(e,t){if(typeof e=="string")return t.context?t.gltfId?ei.getOrCreate(t.gltfId,e,t.context):(console.error("Missing source id"),null):(console.error("Missing context"),null);if(e instanceof ye){if(!t.context)return console.error("Missing context"),null;if(!t.gltfId)return console.error("Missing source id"),null;const i=e,n=t.context,r=i.guid??i.uuid,o=n.addressables.findAssetReference(r);if(o)return o;const a=new ei(r,void 0,i);return n.addressables.registerAssetReference(a),a}return null}}new lpe;const cpe=Promise.resolve(null),v_=class{constructor(e){d(this,"url");d(this,"_bitmap");d(this,"_bitmapObject");d(this,"loader",null);this.url=e}static getOrCreate(e){let t=v_.imageReferences.get(e);return t||(t=new v_(e),v_.imageReferences.set(e,t)),t}dispose(){this._bitmapObject&&this._bitmapObject.close(),this._bitmap=void 0}createHTMLImage(){const e=new Image;return e.src=this.url,e}createTexture(){return this.url?(this.loader||(this.loader=new Bc),this.loader.setCrossOrigin("anonymous"),this.loader.loadAsync(this.url)):cpe}getBitmap(){return this._bitmap?this._bitmap:(this._bitmap=new Promise((e,t)=>{const i=document.createElement("img");i.addEventListener("load",()=>{this._bitmap=createImageBitmap(i).then(n=>(this._bitmapObject=n,e(n),n))}),i.addEventListener("error",n=>{console.error("Failed to load image:"+this.url,n),e(null)}),i.src=this.url}),this._bitmap)}};let Uy=v_;d(Uy,"imageReferences",new Map);class L9 extends hl{constructor(){super([Uy],"ImageReferenceSerializer")}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"){const i=nf(t.gltfId,e);return Uy.getOrCreate(i)}}}new L9;const A_=class{constructor(e){d(this,"url");d(this,"res");this.url=e}static getOrCreate(e){let t=A_.cache.get(e);return t||(t=new A_(e),A_.cache.set(e,t)),t}async loadRaw(){return this.res||(this.res=fetch(this.url)),this.res.then(e=>e.blob())}async loadText(){return this.res||(this.res=fetch(this.url)),this.res.then(e=>e.text())}};let Ny=A_;d(Ny,"cache",new Map);class k9 extends hl{constructor(){super([Ny],"FileReferenceSerializer")}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"){const i=nf(t.gltfId,e);return Ny.getOrCreate(i)}}}new k9;class hpe{constructor(e){d(this,"context");d(this,"mixers",[]);this.context=e}onDestroy(){this.mixers.forEach(e=>e.stopAllAction()),this.mixers.length=0}registerAnimationMixer(e){if(!e){console.warn("AnimationsRegistry.registerAnimationMixer called with null or undefined mixer");return}this.mixers.includes(e)||this.mixers.push(e)}unregisterAnimationMixer(e){if(!e)return;const t=this.mixers.indexOf(e);t!==-1&&this.mixers.splice(t,1)}}class uv{static tryGetActionsFromMixer(e){const t=e._actions;return t||null}static tryGetAnimationClipsFromObjectHierarchy(e,t){if(t||(t=new Array),e)e.animations&&t.push(...e.animations);else return t;if(e.children)for(const i of e.children)this.tryGetAnimationClipsFromObjectHierarchy(i,t);return t}static assignAnimationsFromFile(e,t){if(!e||!e.animations)return;for(let n=0;n<e.animations.length;n++){const r=e.animations[n];if(!(!r.tracks||r.tracks.length<=0))for(const o in r.tracks){const a=r.tracks[o],l=Zt.parseTrackName(a.name);let c=Zt.findNode(e.scene,l.nodeName);if(!c){const u=a.__objectName??a.name.substring(0,a.name.indexOf("."));if(c=e.scene.getObjectByProperty("uuid",u),!c)continue}let h=i(c);if(!h){if(!(t!=null&&t.createAnimationComponent)){console.warn("No AnimationComponent found in parent hierarchy of object and no 'createAnimationComponent' callback was provided in options.");continue}h=t.createAnimationComponent(e.scene,r)}h.addClip&&h.addClip(r)}}function i(n){var o;if(!n)return null;const r=(o=n.userData)==null?void 0:o.components;if(r&&r.length>0){for(let a=0;a<r.length;a++)if(r[a].isAnimationComponent===!0)return n}return i(n.parent)}}}var hE=(s=>(s.Visible="application-visible",s.Hidden="application-hidden",s.MuteChanged="application-mutechanged",s))(hE||{});let uE=!1;const Ay=[];function vm(){if(uE)return;nt()&&console.debug("User interaction registered: audio can now be played"),uE=!0;const s=[...Ay];Ay.length=0,s.forEach(e=>e())}document.addEventListener("mousedown",vm);document.addEventListener("pointerup",vm);document.addEventListener("click",vm);document.addEventListener("dragstart",vm);document.addEventListener("touchend",vm);document.addEventListener("keydown",vm);Mt.onXRSessionStart(()=>{vm()});const BU=class extends EventTarget{constructor(t){super();d(this,"_mute",!1);d(this,"context");d(this,"_isVisible",!0);this.context=t,window.addEventListener("visibilitychange",this.onVisiblityChanged.bind(this),!1)}static get userInteractionRegistered(){return uE}static registerWaitForInteraction(t){if(t!==null){if(uE){t();return}Ay.indexOf(t)===-1&&Ay.push(t)}}static unregisterWaitForInteraction(t){const i=Ay.indexOf(t);i!==-1&&Ay.splice(i,1)}get muted(){return this._mute}set muted(t){t!==this._mute&&(this._mute=t,this.dispatchEvent(new Event("application-mutechanged")))}get hasFocus(){return document.hasFocus()}get isVisible(){return this._isVisible}onVisiblityChanged(t){switch(t.target.visibilityState){case"hidden":this._isVisible=!1,this.dispatchEvent(new Event("application-hidden"));break;case"visible":this._isVisible=!0,this.dispatchEvent(new Event("application-visible"));break}}};let Nl=BU;d(Nl,"registerWaitForAllowAudio",BU.registerWaitForInteraction);function*F9(s,e=null){const t=e?e.time:Dt.Current.time,i=t.time;for(;t.time-i<s;)yield}function*upe(s){for(let e=0;e<s;e++)yield}function*U9(s){let e=!0;for(s.then(()=>e=!1),s.catch(()=>e=!1);e;)yield}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var pG=function(s){return URL.createObjectURL(new Blob([s],{type:"text/javascript"}))};try{URL.revokeObjectURL(pG(""))}catch{pG=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var ls=Uint8Array,fo=Uint16Array,dv=Uint32Array,eT=new ls([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tT=new ls([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ED=new ls([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),N9=function(s,e){for(var t=new fo(31),i=0;i<31;++i)t[i]=e+=1<<s[i-1];for(var n=new dv(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)n[r]=r-t[i]<<5|i;return[t,n]},z9=N9(eT,2),G9=z9[0],MD=z9[1];G9[28]=258,MD[258]=28;var H9=N9(tT,0),dpe=H9[0],mG=H9[1],TD=new fo(32768);for(var an=0;an<32768;++an){var Wu=(an&43690)>>>1|(an&21845)<<1;Wu=(Wu&52428)>>>2|(Wu&13107)<<2,Wu=(Wu&61680)>>>4|(Wu&3855)<<4,TD[an]=((Wu&65280)>>>8|(Wu&255)<<8)>>>1}var Oc=function(s,e,t){for(var i=s.length,n=0,r=new fo(e);n<i;++n)++r[s[n]-1];var o=new fo(e);for(n=0;n<e;++n)o[n]=o[n-1]+r[n-1]<<1;var a;if(t){a=new fo(1<<e);var l=15-e;for(n=0;n<i;++n)if(s[n])for(var c=n<<4|s[n],h=e-s[n],u=o[s[n]-1]++<<h,f=u|(1<<h)-1;u<=f;++u)a[TD[u]>>>l]=c}else for(a=new fo(i),n=0;n<i;++n)s[n]&&(a[n]=TD[o[s[n]-1]++]>>>15-s[n]);return a},Qd=new ls(288);for(var an=0;an<144;++an)Qd[an]=8;for(var an=144;an<256;++an)Qd[an]=9;for(var an=256;an<280;++an)Qd[an]=7;for(var an=280;an<288;++an)Qd[an]=8;var $_=new ls(32);for(var an=0;an<32;++an)$_[an]=5;var fpe=Oc(Qd,9,0),ppe=Oc(Qd,9,1),mpe=Oc($_,5,0),gpe=Oc($_,5,1),nP=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},Cl=function(s,e,t){var i=e/8|0;return(s[i]|s[i+1]<<8)>>(e&7)&t},sP=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(e&7)},Zk=function(s){return(s/8|0)+(s&7&&1)},$k=function(s,e,t){(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length);var i=new(s instanceof fo?fo:s instanceof dv?dv:ls)(t-e);return i.set(s.subarray(e,t)),i},ype=function(s,e,t){var i=s.length;if(!i||t&&!t.l&&i<5)return e||new ls(0);var n=!e||t,r=!t||t.i;t||(t={}),e||(e=new ls(i*3));var o=function(xe){var Fe=e.length;if(xe>Fe){var Ge=new ls(Math.max(Fe*2,xe));Ge.set(e),e=Ge}},a=t.f||0,l=t.p||0,c=t.b||0,h=t.l,u=t.d,f=t.m,p=t.n,m=i*8;do{if(!h){t.f=a=Cl(s,l,1);var v=Cl(s,l+1,3);if(l+=3,v)if(v==1)h=ppe,u=gpe,f=9,p=5;else if(v==2){var _=Cl(s,l,31)+257,b=Cl(s,l+10,15)+4,x=_+Cl(s,l+5,31)+1;l+=14;for(var E=new ls(x),M=new ls(19),T=0;T<b;++T)M[ED[T]]=Cl(s,l+T*3,7);l+=b*3;for(var R=nP(M),w=(1<<R)-1,I=Oc(M,R,1),T=0;T<x;){var O=I[Cl(s,l,w)];l+=O&15;var g=O>>>4;if(g<16)E[T++]=g;else{var k=0,B=0;for(g==16?(B=3+Cl(s,l,3),l+=2,k=E[T-1]):g==17?(B=3+Cl(s,l,7),l+=3):g==18&&(B=11+Cl(s,l,127),l+=7);B--;)E[T++]=k}}var G=E.subarray(0,_),L=E.subarray(_);f=nP(G),p=nP(L),h=Oc(G,f,1),u=Oc(L,p,1)}else throw"invalid block type";else{var g=Zk(l)+4,y=s[g-4]|s[g-3]<<8,A=g+y;if(A>i){if(r)throw"unexpected EOF";break}n&&o(c+y),e.set(s.subarray(g,A),c),t.b=c+=y,t.p=l=A*8;continue}if(l>m){if(r)throw"unexpected EOF";break}}n&&o(c+131072);for(var U=(1<<f)-1,z=(1<<p)-1,j=l;;j=l){var k=h[sP(s,l)&U],X=k>>>4;if(l+=k&15,l>m){if(r)throw"unexpected EOF";break}if(!k)throw"invalid length/literal";if(X<256)e[c++]=X;else if(X==256){j=l,h=null;break}else{var re=X-254;if(X>264){var T=X-257,ce=eT[T];re=Cl(s,l,(1<<ce)-1)+G9[T],l+=ce}var Me=u[sP(s,l)&z],se=Me>>>4;if(!Me)throw"invalid distance";l+=Me&15;var L=dpe[se];if(se>3){var ce=tT[se];L+=sP(s,l)&(1<<ce)-1,l+=ce}if(l>m){if(r)throw"unexpected EOF";break}n&&o(c+131072);for(var ve=c+re;c<ve;c+=4)e[c]=e[c-L],e[c+1]=e[c+1-L],e[c+2]=e[c+2-L],e[c+3]=e[c+3-L];c=ve}}t.l=h,t.p=j,t.b=c,h&&(a=1,t.m=f,t.d=u,t.n=p)}while(!a);return c==e.length?e:$k(e,0,c)},Ah=function(s,e,t){t<<=e&7;var i=e/8|0;s[i]|=t,s[i+1]|=t>>>8},N0=function(s,e,t){t<<=e&7;var i=e/8|0;s[i]|=t,s[i+1]|=t>>>8,s[i+2]|=t>>>16},rP=function(s,e){for(var t=[],i=0;i<s.length;++i)s[i]&&t.push({s:i,f:s[i]});var n=t.length,r=t.slice();if(!n)return[eF,0];if(n==1){var o=new ls(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(x,E){return x.f-E.f}),t.push({s:-1,f:25001});var a=t[0],l=t[1],c=0,h=1,u=2;for(t[0]={s:-1,f:a.f+l.f,l:a,r:l};h!=n-1;)a=t[t[c].f<t[u].f?c++:u++],l=t[c!=h&&t[c].f<t[u].f?c++:u++],t[h++]={s:-1,f:a.f+l.f,l:a,r:l};for(var f=r[0].s,i=1;i<n;++i)r[i].s>f&&(f=r[i].s);var p=new fo(f+1),m=ID(t[h-1],p,0);if(m>e){var i=0,v=0,g=m-e,y=1<<g;for(r.sort(function(E,M){return p[M.s]-p[E.s]||E.f-M.f});i<n;++i){var A=r[i].s;if(p[A]>e)v+=y-(1<<m-p[A]),p[A]=e;else break}for(v>>>=g;v>0;){var _=r[i].s;p[_]<e?v-=1<<e-p[_]++-1:++i}for(;i>=0&&v;--i){var b=r[i].s;p[b]==e&&(--p[b],++v)}m=e}return[new ls(p),m]},ID=function(s,e,t){return s.s==-1?Math.max(ID(s.l,e,t+1),ID(s.r,e,t+1)):e[s.s]=t},gG=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new fo(++e),i=0,n=s[0],r=1,o=function(l){t[i++]=l},a=1;a<=e;++a)if(s[a]==n&&a!=e)++r;else{if(!n&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(n),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(n);r=1,n=s[a]}return[t.subarray(0,i),e]},z0=function(s,e){for(var t=0,i=0;i<e.length;++i)t+=s[i]*e[i];return t},m1=function(s,e,t){var i=t.length,n=Zk(e+2);s[n]=i&255,s[n+1]=i>>>8,s[n+2]=s[n]^255,s[n+3]=s[n+1]^255;for(var r=0;r<i;++r)s[n+r+4]=t[r];return(n+4+i)*8},yG=function(s,e,t,i,n,r,o,a,l,c,h){Ah(e,h++,t),++n[256];for(var u=rP(n,15),f=u[0],p=u[1],m=rP(r,15),v=m[0],g=m[1],y=gG(f),A=y[0],_=y[1],b=gG(v),x=b[0],E=b[1],M=new fo(19),T=0;T<A.length;++T)M[A[T]&31]++;for(var T=0;T<x.length;++T)M[x[T]&31]++;for(var R=rP(M,7),w=R[0],I=R[1],O=19;O>4&&!w[ED[O-1]];--O);var k=c+5<<3,B=z0(n,Qd)+z0(r,$_)+o,G=z0(n,f)+z0(r,v)+o+14+3*O+z0(M,w)+(2*M[16]+3*M[17]+7*M[18]);if(k<=B&&k<=G)return m1(e,h,s.subarray(l,l+c));var L,U,z,j;if(Ah(e,h,1+(G<B)),h+=2,G<B){L=Oc(f,p,0),U=f,z=Oc(v,g,0),j=v;var X=Oc(w,I,0);Ah(e,h,_-257),Ah(e,h+5,E-1),Ah(e,h+10,O-4),h+=14;for(var T=0;T<O;++T)Ah(e,h+3*T,w[ED[T]]);h+=3*O;for(var re=[A,x],ce=0;ce<2;++ce)for(var Me=re[ce],T=0;T<Me.length;++T){var se=Me[T]&31;Ah(e,h,X[se]),h+=w[se],se>15&&(Ah(e,h,Me[T]>>>5&127),h+=Me[T]>>>12)}}else L=fpe,U=Qd,z=mpe,j=$_;for(var T=0;T<a;++T)if(i[T]>255){var se=i[T]>>>18&31;N0(e,h,L[se+257]),h+=U[se+257],se>7&&(Ah(e,h,i[T]>>>23&31),h+=eT[se]);var ve=i[T]&31;N0(e,h,z[ve]),h+=j[ve],ve>3&&(N0(e,h,i[T]>>>5&8191),h+=tT[ve])}else N0(e,h,L[i[T]]),h+=U[i[T]];return N0(e,h,L[256]),h+U[256]},vpe=new dv([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),eF=new ls(0),Ape=function(s,e,t,i,n,r){var o=s.length,a=new ls(i+o+5*(1+Math.ceil(o/7e3))+n),l=a.subarray(i,a.length-n),c=0;if(!e||o<8)for(var h=0;h<=o;h+=65535){var u=h+65535;u<o?c=m1(l,c,s.subarray(h,u)):(l[h]=r,c=m1(l,c,s.subarray(h,o)))}else{for(var f=vpe[e-1],p=f>>>13,m=f&8191,v=(1<<t)-1,g=new fo(32768),y=new fo(v+1),A=Math.ceil(t/3),_=2*A,b=function(we){return(s[we]^s[we+1]<<A^s[we+2]<<_)&v},x=new dv(25e3),E=new fo(288),M=new fo(32),T=0,R=0,h=0,w=0,I=0,O=0;h<o;++h){var k=b(h),B=h&32767,G=y[k];if(g[B]=G,y[k]=B,I<=h){var L=o-h;if((T>7e3||w>24576)&&L>423){c=yG(s,l,0,x,E,M,R,w,O,h-O,c),w=T=R=0,O=h;for(var U=0;U<286;++U)E[U]=0;for(var U=0;U<30;++U)M[U]=0}var z=2,j=0,X=m,re=B-G&32767;if(L>2&&k==b(h-re))for(var ce=Math.min(p,L)-1,Me=Math.min(32767,h),se=Math.min(258,L);re<=Me&&--X&&B!=G;){if(s[h+z]==s[h+z-re]){for(var ve=0;ve<se&&s[h+ve]==s[h+ve-re];++ve);if(ve>z){if(z=ve,j=re,ve>ce)break;for(var xe=Math.min(re,ve-2),Fe=0,U=0;U<xe;++U){var Ge=h-re+U+32768&32767,je=g[Ge],lt=Ge-je+32768&32767;lt>Fe&&(Fe=lt,G=Ge)}}}B=G,G=g[B],re+=B-G+32768&32767}if(j){x[w++]=268435456|MD[z]<<18|mG[j];var ot=MD[z]&31,q=mG[j]&31;R+=eT[ot]+tT[q],++E[257+ot],++M[q],I=h+z,++T}else x[w++]=s[h],++E[s[h]]}}c=yG(s,l,r,x,E,M,R,w,O,h-O,c),!r&&c&7&&(c=m1(l,c+1,eF))}return $k(a,0,i+Zk(c)+n)},_pe=function(){for(var s=new dv(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&3988292384)^t>>>1;s[e]=t}return s}(),bpe=function(){var s=-1;return{p:function(e){for(var t=s,i=0;i<e.length;++i)t=_pe[t&255^e[i]]^t>>>8;s=t},d:function(){return~s}}},xpe=function(s,e,t,i,n){return Ape(s,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(s.length)))*1.5):12+e.mem,t,i,!n)},V9=function(s,e){var t={};for(var i in s)t[i]=s[i];for(var i in e)t[i]=e[i];return t},ar=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},wpe=function(s){if((s[0]&15)!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(s[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Spe(s,e){return xpe(s,e||{},0,0)}function TA(s,e){return ype((wpe(s),s.subarray(2,-4)),e)}var Q9=function(s,e,t,i){for(var n in s){var r=s[n],o=e+n;r instanceof ls?t[o]=[r,i]:Array.isArray(r)?t[o]=[r[0],V9(i,r[1])]:Q9(r,o+"/",t,i)}},vG=typeof TextEncoder<"u"&&new TextEncoder,Cpe=typeof TextDecoder<"u"&&new TextDecoder,Epe=0;try{Cpe.decode(eF,{stream:!0}),Epe=1}catch{}function dE(s,e){if(e){for(var t=new ls(s.length),i=0;i<s.length;++i)t[i]=s.charCodeAt(i);return t}if(vG)return vG.encode(s);for(var n=s.length,r=new ls(s.length+(s.length>>1)),o=0,a=function(h){r[o++]=h},i=0;i<n;++i){if(o+5>r.length){var l=new ls(o+8+(n-i<<1));l.set(r),r=l}var c=s.charCodeAt(i);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1047552)|s.charCodeAt(++i)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return $k(r,0,o)}var RD=function(s){var e=0;if(s)for(var t in s){var i=s[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},AG=function(s,e,t,i,n,r,o,a){var l=i.length,c=t.extra,h=a&&a.length,u=RD(c);ar(s,e,o!=null?33639248:67324752),e+=4,o!=null&&(s[e++]=20,s[e++]=t.os),s[e]=20,e+=2,s[e++]=t.flag<<1|(r==null&&8),s[e++]=n&&8,s[e++]=t.compression&255,s[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(ar(s,e,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,r!=null&&(ar(s,e,t.crc),ar(s,e+4,r),ar(s,e+8,t.size)),ar(s,e+12,l),ar(s,e+14,u),e+=16,o!=null&&(ar(s,e,h),ar(s,e+6,t.attrs),ar(s,e+10,o),e+=14),s.set(i,e),e+=l,u)for(var m in c){var v=c[m],g=v.length;ar(s,e,+m),ar(s,e+2,g),s.set(v,e+4),e+=4+g}return h&&(s.set(a,e),e+=h),e},Mpe=function(s,e,t,i,n){ar(s,e,101010256),ar(s,e+8,t),ar(s,e+10,t),ar(s,e+12,i),ar(s,e+16,n)};function Tpe(s,e){e||(e={});var t={},i=[];Q9(s,"",t,e);var n=0,r=0;for(var o in t){var a=t[o],l=a[0],c=a[1],h=c.level==0?0:8,u=dE(o),f=u.length,p=c.comment,m=p&&dE(p),v=m&&m.length,g=RD(c.extra);if(f>65535)throw"filename too long";var y=h?Spe(l,c):l,A=y.length,_=bpe();_.p(l),i.push(V9(c,{size:l.length,crc:_.d(),c:y,f:u,m,u:f!=o.length||m&&p.length!=v,o:n,compression:h})),n+=30+f+g+A,r+=76+2*(f+g)+(v||0)+A}for(var b=new ls(r+22),x=n,E=r-n,M=0;M<i.length;++M){var u=i[M];AG(b,u.o,u,u.f,u.u,u.c.length);var T=30+u.f.length+RD(u.extra);b.set(u.c,u.o+T),AG(b,n,u,u.f,u.u,u.c.length,u.o,u.m),n+=16+T+(u.m?u.m.length:0)}return Mpe(b,n,i.length,E,x),b}class eb extends fL{constructor(e){super(e),this.type=Cs}parse(e){const R=Math.pow(2.7182818,2.2);function w(D,N){let Z=0;for(let H=0;H<65536;++H)(H==0||D[H>>3]&1<<(H&7))&&(N[Z++]=H);const P=Z-1;for(;Z<65536;)N[Z++]=0;return P}function I(D){for(let N=0;N<16384;N++)D[N]={},D[N].len=0,D[N].lit=0,D[N].p=null}const O={l:0,c:0,lc:0};function k(D,N,Z,P,H){for(;Z<D;)N=N<<8|Xe(P,H),Z+=8;Z-=D,O.l=N>>Z&(1<<D)-1,O.c=N,O.lc=Z}const B=new Array(59);function G(D){for(let Z=0;Z<=58;++Z)B[Z]=0;for(let Z=0;Z<65537;++Z)B[D[Z]]+=1;let N=0;for(let Z=58;Z>0;--Z){const P=N+B[Z]>>1;B[Z]=N,N=P}for(let Z=0;Z<65537;++Z){const P=D[Z];P>0&&(D[Z]=P|B[P]++<<6)}}function L(D,N,Z,P,H,Q){const Y=N;let K=0,me=0;for(;P<=H;P++){if(Y.value-N.value>Z)return!1;k(6,K,me,D,Y);const ue=O.l;if(K=O.c,me=O.lc,Q[P]=ue,ue==63){if(Y.value-N.value>Z)throw new Error("Something wrong with hufUnpackEncTable");k(8,K,me,D,Y);let be=O.l+6;if(K=O.c,me=O.lc,P+be>H+1)throw new Error("Something wrong with hufUnpackEncTable");for(;be--;)Q[P++]=0;P--}else if(ue>=59){let be=ue-59+2;if(P+be>H+1)throw new Error("Something wrong with hufUnpackEncTable");for(;be--;)Q[P++]=0;P--}}G(Q)}function U(D){return D&63}function z(D){return D>>6}function j(D,N,Z,P){for(;N<=Z;N++){const H=z(D[N]),Q=U(D[N]);if(H>>Q)throw new Error("Invalid table entry");if(Q>14){const Y=P[H>>Q-14];if(Y.len)throw new Error("Invalid table entry");if(Y.lit++,Y.p){const K=Y.p;Y.p=new Array(Y.lit);for(let me=0;me<Y.lit-1;++me)Y.p[me]=K[me]}else Y.p=new Array(1);Y.p[Y.lit-1]=N}else if(Q){let Y=0;for(let K=1<<14-Q;K>0;K--){const me=P[(H<<14-Q)+Y];if(me.len||me.p)throw new Error("Invalid table entry");me.len=Q,me.lit=N,Y++}}}return!0}const X={c:0,lc:0};function re(D,N,Z,P){D=D<<8|Xe(Z,P),N+=8,X.c=D,X.lc=N}const ce={c:0,lc:0};function Me(D,N,Z,P,H,Q,Y,K,me){if(D==N){P<8&&(re(Z,P,H,Q),Z=X.c,P=X.lc),P-=8;let ue=Z>>P;if(ue=new Uint8Array([ue])[0],K.value+ue>me)return!1;const be=Y[K.value-1];for(;ue-- >0;)Y[K.value++]=be}else if(K.value<me)Y[K.value++]=D;else return!1;ce.c=Z,ce.lc=P}function se(D){return D&65535}function ve(D){const N=se(D);return N>32767?N-65536:N}const xe={a:0,b:0};function Fe(D,N){const Z=ve(D),H=ve(N),Q=Z+(H&1)+(H>>1),Y=Q,K=Q-H;xe.a=Y,xe.b=K}function Ge(D,N){const Z=se(D),P=se(N),H=Z-(P>>1)&65535,Q=P+H-32768&65535;xe.a=Q,xe.b=H}function je(D,N,Z,P,H,Q,Y){const K=Y<16384,me=Z>H?H:Z;let ue=1,be,Be;for(;ue<=me;)ue<<=1;for(ue>>=1,be=ue,ue>>=1;ue>=1;){Be=0;const Oe=Be+Q*(H-be),We=Q*ue,$e=Q*be,tt=P*ue,ut=P*be;let Tt,xi,qt,Bt;for(;Be<=Oe;Be+=$e){let Bi=Be;const Ct=Be+P*(Z-be);for(;Bi<=Ct;Bi+=ut){const Vi=Bi+tt,Zr=Bi+We,dn=Zr+tt;K?(Fe(D[Bi+N],D[Zr+N]),Tt=xe.a,qt=xe.b,Fe(D[Vi+N],D[dn+N]),xi=xe.a,Bt=xe.b,Fe(Tt,xi),D[Bi+N]=xe.a,D[Vi+N]=xe.b,Fe(qt,Bt),D[Zr+N]=xe.a,D[dn+N]=xe.b):(Ge(D[Bi+N],D[Zr+N]),Tt=xe.a,qt=xe.b,Ge(D[Vi+N],D[dn+N]),xi=xe.a,Bt=xe.b,Ge(Tt,xi),D[Bi+N]=xe.a,D[Vi+N]=xe.b,Ge(qt,Bt),D[Zr+N]=xe.a,D[dn+N]=xe.b)}if(Z&ue){const Vi=Bi+We;K?Fe(D[Bi+N],D[Vi+N]):Ge(D[Bi+N],D[Vi+N]),Tt=xe.a,D[Vi+N]=xe.b,D[Bi+N]=Tt}}if(H&ue){let Bi=Be;const Ct=Be+P*(Z-be);for(;Bi<=Ct;Bi+=ut){const Vi=Bi+tt;K?Fe(D[Bi+N],D[Vi+N]):Ge(D[Bi+N],D[Vi+N]),Tt=xe.a,D[Vi+N]=xe.b,D[Bi+N]=Tt}}be=ue,ue>>=1}return Be}function lt(D,N,Z,P,H,Q,Y,K,me){let ue=0,be=0;const Be=Y,Oe=Math.trunc(P.value+(H+7)/8);for(;P.value<Oe;)for(re(ue,be,Z,P),ue=X.c,be=X.lc;be>=14;){const $e=ue>>be-14&16383,tt=N[$e];if(tt.len)be-=tt.len,Me(tt.lit,Q,ue,be,Z,P,K,me,Be),ue=ce.c,be=ce.lc;else{if(!tt.p)throw new Error("hufDecode issues");let ut;for(ut=0;ut<tt.lit;ut++){const Tt=U(D[tt.p[ut]]);for(;be<Tt&&P.value<Oe;)re(ue,be,Z,P),ue=X.c,be=X.lc;if(be>=Tt&&z(D[tt.p[ut]])==(ue>>be-Tt&(1<<Tt)-1)){be-=Tt,Me(tt.p[ut],Q,ue,be,Z,P,K,me,Be),ue=ce.c,be=ce.lc;break}}if(ut==tt.lit)throw new Error("hufDecode issues")}}const We=8-H&7;for(ue>>=We,be-=We;be>0;){const $e=N[ue<<14-be&16383];if($e.len)be-=$e.len,Me($e.lit,Q,ue,be,Z,P,K,me,Be),ue=ce.c,be=ce.lc;else throw new Error("hufDecode issues")}return!0}function ot(D,N,Z,P,H,Q){const Y={value:0},K=Z.value,me=pt(N,Z),ue=pt(N,Z);Z.value+=4;const be=pt(N,Z);if(Z.value+=4,me<0||me>=65537||ue<0||ue>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Be=new Array(65537),Oe=new Array(16384);I(Oe);const We=P-(Z.value-K);if(L(D,Z,We,me,ue,Be),be>8*(P-(Z.value-K)))throw new Error("Something wrong with hufUncompress");j(Be,me,ue,Oe),lt(Be,Oe,D,Z,be,ue,Q,H,Y)}function q(D,N,Z){for(let P=0;P<Z;++P)N[P]=D[N[P]]}function He(D){for(let N=1;N<D.length;N++){const Z=D[N-1]+D[N]-128;D[N]=Z}}function we(D,N){let Z=0,P=Math.floor((D.length+1)/2),H=0;const Q=D.length-1;for(;!(H>Q||(N[H++]=D[Z++],H>Q));)N[H++]=D[P++]}function Ne(D){let N=D.byteLength;const Z=new Array;let P=0;const H=new DataView(D);for(;N>0;){const Q=H.getInt8(P++);if(Q<0){const Y=-Q;N-=Y+1;for(let K=0;K<Y;K++)Z.push(H.getUint8(P++))}else{const Y=Q;N-=2;const K=H.getUint8(P++);for(let me=0;me<Y+1;me++)Z.push(K)}}return Z}function Ee(D,N,Z,P,H,Q){let Y=new DataView(Q.buffer);const K=Z[D.idx[0]].width,me=Z[D.idx[0]].height,ue=3,be=Math.floor(K/8),Be=Math.ceil(K/8),Oe=Math.ceil(me/8),We=K-(Be-1)*8,$e=me-(Oe-1)*8,tt={value:0},ut=new Array(ue),Tt=new Array(ue),xi=new Array(ue),qt=new Array(ue),Bt=new Array(ue);for(let Ct=0;Ct<ue;++Ct)Bt[Ct]=N[D.idx[Ct]],ut[Ct]=Ct<1?0:ut[Ct-1]+Be*Oe,Tt[Ct]=new Float32Array(64),xi[Ct]=new Uint16Array(64),qt[Ct]=new Uint16Array(Be*64);for(let Ct=0;Ct<Oe;++Ct){let Vi=8;Ct==Oe-1&&(Vi=$e);let Zr=8;for(let bi=0;bi<Be;++bi){bi==Be-1&&(Zr=We);for(let Yt=0;Yt<ue;++Yt)xi[Yt].fill(0),xi[Yt][0]=H[ut[Yt]++],st(tt,P,xi[Yt]),et(xi[Yt],Tt[Yt]),ct(Tt[Yt]);zt(Tt);for(let Yt=0;Yt<ue;++Yt)V(Tt[Yt],qt[Yt],bi*64)}let dn=0;for(let bi=0;bi<ue;++bi){const Yt=Z[D.idx[bi]].type;for(let Js=8*Ct;Js<8*Ct+Vi;++Js){dn=Bt[bi][Js];for(let nh=0;nh<be;++nh){const In=nh*64+(Js&7)*8;Y.setUint16(dn+0*2*Yt,qt[bi][In+0],!0),Y.setUint16(dn+1*2*Yt,qt[bi][In+1],!0),Y.setUint16(dn+2*2*Yt,qt[bi][In+2],!0),Y.setUint16(dn+3*2*Yt,qt[bi][In+3],!0),Y.setUint16(dn+4*2*Yt,qt[bi][In+4],!0),Y.setUint16(dn+5*2*Yt,qt[bi][In+5],!0),Y.setUint16(dn+6*2*Yt,qt[bi][In+6],!0),Y.setUint16(dn+7*2*Yt,qt[bi][In+7],!0),dn+=8*2*Yt}}if(be!=Be)for(let Js=8*Ct;Js<8*Ct+Vi;++Js){const nh=Bt[bi][Js]+8*be*2*Yt,In=be*64+(Js&7)*8;for(let Su=0;Su<Zr;++Su)Y.setUint16(nh+Su*2*Yt,qt[bi][In+Su],!0)}}}const Bi=new Uint16Array(K);Y=new DataView(Q.buffer);for(let Ct=0;Ct<ue;++Ct){Z[D.idx[Ct]].decoded=!0;const Vi=Z[D.idx[Ct]].type;if(Z[Ct].type==2)for(let Zr=0;Zr<me;++Zr){const dn=Bt[Ct][Zr];for(let bi=0;bi<K;++bi)Bi[bi]=Y.getUint16(dn+bi*2*Vi,!0);for(let bi=0;bi<K;++bi)Y.setFloat32(dn+bi*2*Vi,ae(Bi[bi]),!0)}}}function st(D,N,Z){let P,H=1;for(;H<64;)P=N[D.value],P==65280?H=64:P>>8==255?H+=P&255:(Z[H]=P,H++),D.value++}function et(D,N){N[0]=ae(D[0]),N[1]=ae(D[1]),N[2]=ae(D[5]),N[3]=ae(D[6]),N[4]=ae(D[14]),N[5]=ae(D[15]),N[6]=ae(D[27]),N[7]=ae(D[28]),N[8]=ae(D[2]),N[9]=ae(D[4]),N[10]=ae(D[7]),N[11]=ae(D[13]),N[12]=ae(D[16]),N[13]=ae(D[26]),N[14]=ae(D[29]),N[15]=ae(D[42]),N[16]=ae(D[3]),N[17]=ae(D[8]),N[18]=ae(D[12]),N[19]=ae(D[17]),N[20]=ae(D[25]),N[21]=ae(D[30]),N[22]=ae(D[41]),N[23]=ae(D[43]),N[24]=ae(D[9]),N[25]=ae(D[11]),N[26]=ae(D[18]),N[27]=ae(D[24]),N[28]=ae(D[31]),N[29]=ae(D[40]),N[30]=ae(D[44]),N[31]=ae(D[53]),N[32]=ae(D[10]),N[33]=ae(D[19]),N[34]=ae(D[23]),N[35]=ae(D[32]),N[36]=ae(D[39]),N[37]=ae(D[45]),N[38]=ae(D[52]),N[39]=ae(D[54]),N[40]=ae(D[20]),N[41]=ae(D[22]),N[42]=ae(D[33]),N[43]=ae(D[38]),N[44]=ae(D[46]),N[45]=ae(D[51]),N[46]=ae(D[55]),N[47]=ae(D[60]),N[48]=ae(D[21]),N[49]=ae(D[34]),N[50]=ae(D[37]),N[51]=ae(D[47]),N[52]=ae(D[50]),N[53]=ae(D[56]),N[54]=ae(D[59]),N[55]=ae(D[61]),N[56]=ae(D[35]),N[57]=ae(D[36]),N[58]=ae(D[48]),N[59]=ae(D[49]),N[60]=ae(D[57]),N[61]=ae(D[58]),N[62]=ae(D[62]),N[63]=ae(D[63])}function ct(D){const N=.5*Math.cos(.7853975),Z=.5*Math.cos(3.14159/16),P=.5*Math.cos(3.14159/8),H=.5*Math.cos(3*3.14159/16),Q=.5*Math.cos(5*3.14159/16),Y=.5*Math.cos(3*3.14159/8),K=.5*Math.cos(7*3.14159/16),me=new Array(4),ue=new Array(4),be=new Array(4),Be=new Array(4);for(let Oe=0;Oe<8;++Oe){const We=Oe*8;me[0]=P*D[We+2],me[1]=Y*D[We+2],me[2]=P*D[We+6],me[3]=Y*D[We+6],ue[0]=Z*D[We+1]+H*D[We+3]+Q*D[We+5]+K*D[We+7],ue[1]=H*D[We+1]-K*D[We+3]-Z*D[We+5]-Q*D[We+7],ue[2]=Q*D[We+1]-Z*D[We+3]+K*D[We+5]+H*D[We+7],ue[3]=K*D[We+1]-Q*D[We+3]+H*D[We+5]-Z*D[We+7],be[0]=N*(D[We+0]+D[We+4]),be[3]=N*(D[We+0]-D[We+4]),be[1]=me[0]+me[3],be[2]=me[1]-me[2],Be[0]=be[0]+be[1],Be[1]=be[3]+be[2],Be[2]=be[3]-be[2],Be[3]=be[0]-be[1],D[We+0]=Be[0]+ue[0],D[We+1]=Be[1]+ue[1],D[We+2]=Be[2]+ue[2],D[We+3]=Be[3]+ue[3],D[We+4]=Be[3]-ue[3],D[We+5]=Be[2]-ue[2],D[We+6]=Be[1]-ue[1],D[We+7]=Be[0]-ue[0]}for(let Oe=0;Oe<8;++Oe)me[0]=P*D[16+Oe],me[1]=Y*D[16+Oe],me[2]=P*D[48+Oe],me[3]=Y*D[48+Oe],ue[0]=Z*D[8+Oe]+H*D[24+Oe]+Q*D[40+Oe]+K*D[56+Oe],ue[1]=H*D[8+Oe]-K*D[24+Oe]-Z*D[40+Oe]-Q*D[56+Oe],ue[2]=Q*D[8+Oe]-Z*D[24+Oe]+K*D[40+Oe]+H*D[56+Oe],ue[3]=K*D[8+Oe]-Q*D[24+Oe]+H*D[40+Oe]-Z*D[56+Oe],be[0]=N*(D[Oe]+D[32+Oe]),be[3]=N*(D[Oe]-D[32+Oe]),be[1]=me[0]+me[3],be[2]=me[1]-me[2],Be[0]=be[0]+be[1],Be[1]=be[3]+be[2],Be[2]=be[3]-be[2],Be[3]=be[0]-be[1],D[0+Oe]=Be[0]+ue[0],D[8+Oe]=Be[1]+ue[1],D[16+Oe]=Be[2]+ue[2],D[24+Oe]=Be[3]+ue[3],D[32+Oe]=Be[3]-ue[3],D[40+Oe]=Be[2]-ue[2],D[48+Oe]=Be[1]-ue[1],D[56+Oe]=Be[0]-ue[0]}function zt(D){for(let N=0;N<64;++N){const Z=D[0][N],P=D[1][N],H=D[2][N];D[0][N]=Z+1.5747*H,D[1][N]=Z-.1873*P-.4682*H,D[2][N]=Z+1.8556*P}}function V(D,N,Z){for(let P=0;P<64;++P)N[Z+P]=bp.toHalfFloat(F(D[P]))}function F(D){return D<=1?Math.sign(D)*Math.pow(Math.abs(D),2.2):Math.sign(D)*Math.pow(R,Math.abs(D)-1)}function ge(D){return new DataView(D.array.buffer,D.offset.value,D.size)}function _e(D){const N=D.viewer.buffer.slice(D.offset.value,D.offset.value+D.size),Z=new Uint8Array(Ne(N)),P=new Uint8Array(Z.length);return He(Z),we(Z,P),new DataView(P.buffer)}function Pe(D){const N=D.array.slice(D.offset.value,D.offset.value+D.size),Z=TA(N),P=new Uint8Array(Z.length);return He(Z),we(Z,P),new DataView(P.buffer)}function Te(D){const N=D.viewer,Z={value:D.offset.value},P=new Uint16Array(D.width*D.scanlineBlockSize*(D.channels*D.type)),H=new Uint8Array(8192);let Q=0;const Y=new Array(D.channels);for(let $e=0;$e<D.channels;$e++)Y[$e]={},Y[$e].start=Q,Y[$e].end=Y[$e].start,Y[$e].nx=D.width,Y[$e].ny=D.lines,Y[$e].size=D.type,Q+=Y[$e].nx*Y[$e].ny*Y[$e].size;const K=$(N,Z),me=$(N,Z);if(me>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(K<=me)for(let $e=0;$e<me-K+1;$e++)H[$e+K]=mt(N,Z);const ue=new Uint16Array(65536),be=w(H,ue),Be=pt(N,Z);ot(D.array,N,Z,Be,P,Q);for(let $e=0;$e<D.channels;++$e){const tt=Y[$e];for(let ut=0;ut<Y[$e].size;++ut)je(P,tt.start+ut,tt.nx,tt.size,tt.ny,tt.nx*tt.size,be)}q(ue,P,Q);let Oe=0;const We=new Uint8Array(P.buffer.byteLength);for(let $e=0;$e<D.lines;$e++)for(let tt=0;tt<D.channels;tt++){const ut=Y[tt],Tt=ut.nx*ut.size,xi=new Uint8Array(P.buffer,ut.end*2,Tt*2);We.set(xi,Oe),Oe+=Tt*2,ut.end+=Tt}return new DataView(We.buffer)}function xt(D){const N=D.array.slice(D.offset.value,D.offset.value+D.size),Z=TA(N),P=D.lines*D.channels*D.width,H=D.type==1?new Uint16Array(P):new Uint32Array(P);let Q=0,Y=0;const K=new Array(4);for(let me=0;me<D.lines;me++)for(let ue=0;ue<D.channels;ue++){let be=0;switch(D.type){case 1:K[0]=Q,K[1]=K[0]+D.width,Q=K[1]+D.width;for(let Be=0;Be<D.width;++Be){const Oe=Z[K[0]++]<<8|Z[K[1]++];be+=Oe,H[Y]=be,Y++}break;case 2:K[0]=Q,K[1]=K[0]+D.width,K[2]=K[1]+D.width,Q=K[2]+D.width;for(let Be=0;Be<D.width;++Be){const Oe=Z[K[0]++]<<24|Z[K[1]++]<<16|Z[K[2]++]<<8;be+=Oe,H[Y]=be,Y++}break}}return new DataView(H.buffer)}function ft(D){const N=D.viewer,Z={value:D.offset.value},P=new Uint8Array(D.width*D.lines*(D.channels*D.type*2)),H={version:at(N,Z),unknownUncompressedSize:at(N,Z),unknownCompressedSize:at(N,Z),acCompressedSize:at(N,Z),dcCompressedSize:at(N,Z),rleCompressedSize:at(N,Z),rleUncompressedSize:at(N,Z),rleRawSize:at(N,Z),totalAcUncompressedCount:at(N,Z),totalDcUncompressedCount:at(N,Z),acCompression:at(N,Z)};if(H.version<2)throw new Error("EXRLoader.parse: "+wu.compression+" version "+H.version+" is unsupported");const Q=new Array;let Y=$(N,Z)-2;for(;Y>0;){const tt=Le(N.buffer,Z),ut=mt(N,Z),Tt=ut>>2&3,xi=(ut>>4)-1,qt=new Int8Array([xi])[0],Bt=mt(N,Z);Q.push({name:tt,index:qt,type:Bt,compression:Tt}),Y-=tt.length+3}const K=wu.channels,me=new Array(D.channels);for(let tt=0;tt<D.channels;++tt){const ut=me[tt]={},Tt=K[tt];ut.name=Tt.name,ut.compression=0,ut.decoded=!1,ut.type=Tt.pixelType,ut.pLinear=Tt.pLinear,ut.width=D.width,ut.height=D.lines}const ue={idx:new Array(3)};for(let tt=0;tt<D.channels;++tt){const ut=me[tt];for(let Tt=0;Tt<Q.length;++Tt){const xi=Q[Tt];ut.name==xi.name&&(ut.compression=xi.compression,xi.index>=0&&(ue.idx[xi.index]=tt),ut.offset=tt)}}let be,Be,Oe;if(H.acCompressedSize>0)switch(H.acCompression){case 0:be=new Uint16Array(H.totalAcUncompressedCount),ot(D.array,N,Z,H.acCompressedSize,be,H.totalAcUncompressedCount);break;case 1:const tt=D.array.slice(Z.value,Z.value+H.totalAcUncompressedCount),ut=TA(tt);be=new Uint16Array(ut.buffer),Z.value+=H.totalAcUncompressedCount;break}if(H.dcCompressedSize>0){const tt={array:D.array,offset:Z,size:H.dcCompressedSize};Be=new Uint16Array(Pe(tt).buffer),Z.value+=H.dcCompressedSize}if(H.rleRawSize>0){const tt=D.array.slice(Z.value,Z.value+H.rleCompressedSize),ut=TA(tt);Oe=Ne(ut.buffer),Z.value+=H.rleCompressedSize}let We=0;const $e=new Array(me.length);for(let tt=0;tt<$e.length;++tt)$e[tt]=new Array;for(let tt=0;tt<D.lines;++tt)for(let ut=0;ut<me.length;++ut)$e[ut].push(We),We+=me[ut].width*D.type*2;Ee(ue,$e,me,be,Be,P);for(let tt=0;tt<me.length;++tt){const ut=me[tt];if(!ut.decoded)switch(ut.compression){case 2:let Tt=0,xi=0;for(let qt=0;qt<D.lines;++qt){let Bt=$e[tt][Tt];for(let Bi=0;Bi<ut.width;++Bi){for(let Ct=0;Ct<2*ut.type;++Ct)P[Bt++]=Oe[xi+Ct*ut.width*ut.height];xi++}Tt++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(P.buffer)}function Le(D,N){const Z=new Uint8Array(D);let P=0;for(;Z[N.value+P]!=0;)P+=1;const H=new TextDecoder().decode(Z.slice(N.value,N.value+P));return N.value=N.value+P+1,H}function Qe(D,N,Z){const P=new TextDecoder().decode(new Uint8Array(D).slice(N.value,N.value+Z));return N.value=N.value+Z,P}function St(D,N){const Z=ni(D,N),P=pt(D,N);return[Z,P]}function ke(D,N){const Z=pt(D,N),P=pt(D,N);return[Z,P]}function ni(D,N){const Z=D.getInt32(N.value,!0);return N.value=N.value+4,Z}function pt(D,N){const Z=D.getUint32(N.value,!0);return N.value=N.value+4,Z}function Xe(D,N){const Z=D[N.value];return N.value=N.value+1,Z}function mt(D,N){const Z=D.getUint8(N.value);return N.value=N.value+1,Z}const at=function(D,N){let Z;return"getBigInt64"in DataView.prototype?Z=Number(D.getBigInt64(N.value,!0)):Z=D.getUint32(N.value+4,!0)+Number(D.getUint32(N.value,!0)<<32),N.value+=8,Z};function Lt(D,N){const Z=D.getFloat32(N.value,!0);return N.value+=4,Z}function W(D,N){return bp.toHalfFloat(Lt(D,N))}function ae(D){const N=(D&31744)>>10,Z=D&1023;return(D>>15?-1:1)*(N?N===31?Z?NaN:1/0:Math.pow(2,N-15)*(1+Z/1024):6103515625e-14*(Z/1024))}function $(D,N){const Z=D.getUint16(N.value,!0);return N.value+=2,Z}function De(D,N){return ae($(D,N))}function he(D,N,Z,P){const H=Z.value,Q=[];for(;Z.value<H+P-1;){const Y=Le(N,Z),K=ni(D,Z),me=mt(D,Z);Z.value+=3;const ue=ni(D,Z),be=ni(D,Z);Q.push({name:Y,pixelType:K,pLinear:me,xSampling:ue,ySampling:be})}return Z.value+=1,Q}function Ve(D,N){const Z=Lt(D,N),P=Lt(D,N),H=Lt(D,N),Q=Lt(D,N),Y=Lt(D,N),K=Lt(D,N),me=Lt(D,N),ue=Lt(D,N);return{redX:Z,redY:P,greenX:H,greenY:Q,blueX:Y,blueY:K,whiteX:me,whiteY:ue}}function Ye(D,N){const Z=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],P=mt(D,N);return Z[P]}function si(D,N){const Z=pt(D,N),P=pt(D,N),H=pt(D,N),Q=pt(D,N);return{xMin:Z,yMin:P,xMax:H,yMax:Q}}function Mi(D,N){const Z=["INCREASING_Y"],P=mt(D,N);return Z[P]}function hn(D,N){const Z=Lt(D,N),P=Lt(D,N);return[Z,P]}function un(D,N){const Z=Lt(D,N),P=Lt(D,N),H=Lt(D,N);return[Z,P,H]}function oi(D,N,Z,P,H){if(P==="string"||P==="stringvector"||P==="iccProfile")return Qe(N,Z,H);if(P==="chlist")return he(D,N,Z,H);if(P==="chromaticities")return Ve(D,Z);if(P==="compression")return Ye(D,Z);if(P==="box2i")return si(D,Z);if(P==="lineOrder")return Mi(D,Z);if(P==="float")return Lt(D,Z);if(P==="v2f")return hn(D,Z);if(P==="v3f")return un(D,Z);if(P==="int")return ni(D,Z);if(P==="rational")return St(D,Z);if(P==="timecode")return ke(D,Z);if(P==="preview")return Z.value+=H,"skipped";Z.value+=H}function Tn(D,N,Z){const P={};if(D.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");P.version=D.getUint8(4);const H=D.getUint8(5);P.spec={singleTile:!!(H&2),longName:!!(H&4),deepFormat:!!(H&8),multiPart:!!(H&16)},Z.value=8;let Q=!0;for(;Q;){const Y=Le(N,Z);if(Y==0)Q=!1;else{const K=Le(N,Z),me=pt(D,Z),ue=oi(D,N,Z,K,me);ue===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${K}'.`):P[Y]=ue}}if(H&-5)throw console.error("THREE.EXRHeader:",P),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return P}function Fn(D,N,Z,P,H){const Q={size:0,viewer:N,array:Z,offset:P,width:D.dataWindow.xMax-D.dataWindow.xMin+1,height:D.dataWindow.yMax-D.dataWindow.yMin+1,channels:D.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:D.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:zi};switch(D.compression){case"NO_COMPRESSION":Q.lines=1,Q.uncompress=ge;break;case"RLE_COMPRESSION":Q.lines=1,Q.uncompress=_e;break;case"ZIPS_COMPRESSION":Q.lines=1,Q.uncompress=Pe;break;case"ZIP_COMPRESSION":Q.lines=16,Q.uncompress=Pe;break;case"PIZ_COMPRESSION":Q.lines=32,Q.uncompress=Te;break;case"PXR24_COMPRESSION":Q.lines=16,Q.uncompress=xt;break;case"DWAA_COMPRESSION":Q.lines=32,Q.uncompress=ft;break;case"DWAB_COMPRESSION":Q.lines=256,Q.uncompress=ft;break;default:throw new Error("EXRLoader.parse: "+D.compression+" is unsupported")}if(Q.scanlineBlockSize=Q.lines,Q.type==1)switch(H){case tn:Q.getter=De,Q.inputSize=2;break;case Cs:Q.getter=$,Q.inputSize=2;break}else if(Q.type==2)switch(H){case tn:Q.getter=Lt,Q.inputSize=4;break;case Cs:Q.getter=W,Q.inputSize=4}else throw new Error("EXRLoader.parse: unsupported pixelType "+Q.type+" for "+D.compression+".");Q.blockCount=(D.dataWindow.yMax+1)/Q.scanlineBlockSize;for(let K=0;K<Q.blockCount;K++)at(N,P);Q.outputChannels=Q.channels==3?4:Q.channels;const Y=Q.width*Q.height*Q.outputChannels;switch(H){case tn:Q.byteArray=new Float32Array(Y),Q.channels<Q.outputChannels&&Q.byteArray.fill(1,0,Y);break;case Cs:Q.byteArray=new Uint16Array(Y),Q.channels<Q.outputChannels&&Q.byteArray.fill(15360,0,Y);break;default:console.error("THREE.EXRLoader: unsupported type: ",H);break}return Q.bytesPerLine=Q.width*Q.inputSize*Q.channels,Q.outputChannels==4?(Q.format=Li,Q.colorSpace=zi):(Q.format=um,Q.colorSpace=Bo),Q}const Wo=new DataView(e),xu=new Uint8Array(e),jo={value:0},wu=Tn(Wo,e,jo),ii=Fn(wu,Wo,xu,jo,this.type),c0={value:0},Vx={R:0,G:1,B:2,A:3,Y:0};for(let D=0;D<ii.height/ii.scanlineBlockSize;D++){const N=pt(Wo,jo);ii.size=pt(Wo,jo),ii.lines=N+ii.scanlineBlockSize>ii.height?ii.height-N:ii.scanlineBlockSize;const P=ii.size<ii.lines*ii.bytesPerLine?ii.uncompress(ii):ge(ii);jo.value+=ii.size;for(let H=0;H<ii.scanlineBlockSize;H++){const Q=H+D*ii.scanlineBlockSize;if(Q>=ii.height)break;for(let Y=0;Y<ii.channels;Y++){const K=Vx[wu.channels[Y].name];for(let me=0;me<ii.width;me++){c0.value=(H*(ii.channels*ii.width)+Y*ii.width+me)*ii.inputSize;const ue=(ii.height-1-Q)*(ii.width*ii.outputChannels)+me*ii.outputChannels+K;ii.byteArray[ue]=ii.getter(P,c0)}}}}return{header:wu,width:ii.width,height:ii.height,data:ii.byteArray,format:ii.format,colorSpace:ii.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,n){function r(o,a){o.colorSpace=a.colorSpace,o.minFilter=Nt,o.magFilter=Nt,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)}return super.load(e,r,i,n)}}const Ipe=Object.freeze(Object.defineProperty({__proto__:null,EXRLoader:eb},Symbol.toStringTag,{value:"Module"}));class fE extends fL{constructor(e){super(e),this.type=Cs}parse(e){const o=function(T,R){switch(T){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(R||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(R||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(R||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(R||""))}},h=`
`,u=function(T,R,w){R=R||1024;let O=T.pos,k=-1,B=0,G="",L=String.fromCharCode.apply(null,new Uint16Array(T.subarray(O,O+128)));for(;0>(k=L.indexOf(h))&&B<R&&O<T.byteLength;)G+=L,B+=L.length,O+=128,L+=String.fromCharCode.apply(null,new Uint16Array(T.subarray(O,O+128)));return-1<k?(w!==!1&&(T.pos+=B+k+1),G+L.slice(0,k)):!1},f=function(T){const R=/^#\?(\S+)/,w=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,I=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,O=/^\s*FORMAT=(\S+)\s*$/,k=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,B={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let G,L;for((T.pos>=T.byteLength||!(G=u(T)))&&o(1,"no header found"),(L=G.match(R))||o(3,"bad initial token"),B.valid|=1,B.programtype=L[1],B.string+=G+`
`;G=u(T),G!==!1;){if(B.string+=G+`
`,G.charAt(0)==="#"){B.comments+=G+`
`;continue}if((L=G.match(w))&&(B.gamma=parseFloat(L[1])),(L=G.match(I))&&(B.exposure=parseFloat(L[1])),(L=G.match(O))&&(B.valid|=2,B.format=L[1]),(L=G.match(k))&&(B.valid|=4,B.height=parseInt(L[1],10),B.width=parseInt(L[2],10)),B.valid&2&&B.valid&4)break}return B.valid&2||o(3,"missing format specifier"),B.valid&4||o(3,"missing image size specifier"),B},p=function(T,R,w){const I=R;if(I<8||I>32767||T[0]!==2||T[1]!==2||T[2]&128)return new Uint8Array(T);I!==(T[2]<<8|T[3])&&o(3,"wrong scanline width");const O=new Uint8Array(4*R*w);O.length||o(4,"unable to allocate buffer space");let k=0,B=0;const G=4*I,L=new Uint8Array(4),U=new Uint8Array(G);let z=w;for(;z>0&&B<T.byteLength;){B+4>T.byteLength&&o(1),L[0]=T[B++],L[1]=T[B++],L[2]=T[B++],L[3]=T[B++],(L[0]!=2||L[1]!=2||(L[2]<<8|L[3])!=I)&&o(3,"bad rgbe scanline format");let j=0,X;for(;j<G&&B<T.byteLength;){X=T[B++];const ce=X>128;if(ce&&(X-=128),(X===0||j+X>G)&&o(3,"bad scanline data"),ce){const Me=T[B++];for(let se=0;se<X;se++)U[j++]=Me}else U.set(T.subarray(B,B+X),j),j+=X,B+=X}const re=I;for(let ce=0;ce<re;ce++){let Me=0;O[k]=U[ce+Me],Me+=I,O[k+1]=U[ce+Me],Me+=I,O[k+2]=U[ce+Me],Me+=I,O[k+3]=U[ce+Me],k+=4}z--}return O},m=function(T,R,w,I){const O=T[R+3],k=Math.pow(2,O-128)/255;w[I+0]=T[R+0]*k,w[I+1]=T[R+1]*k,w[I+2]=T[R+2]*k,w[I+3]=1},v=function(T,R,w,I){const O=T[R+3],k=Math.pow(2,O-128)/255;w[I+0]=bp.toHalfFloat(Math.min(T[R+0]*k,65504)),w[I+1]=bp.toHalfFloat(Math.min(T[R+1]*k,65504)),w[I+2]=bp.toHalfFloat(Math.min(T[R+2]*k,65504)),w[I+3]=bp.toHalfFloat(1)},g=new Uint8Array(e);g.pos=0;const y=f(g),A=y.width,_=y.height,b=p(g.subarray(g.pos),A,_);let x,E,M;switch(this.type){case tn:M=b.length/4;const T=new Float32Array(M*4);for(let w=0;w<M;w++)m(b,w*4,T,w*4);x=T,E=tn;break;case Cs:M=b.length/4;const R=new Uint16Array(M*4);for(let w=0;w<M;w++)v(b,w*4,R,w*4);x=R,E=Cs;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:A,height:_,data:x,header:y.string,gamma:y.gamma,exposure:y.exposure,type:E}}setDataType(e){return this.type=e,this}load(e,t,i,n){function r(o,a){switch(o.type){case tn:case Cs:o.colorSpace=zi,o.minFilter=Nt,o.magFilter=Nt,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,r,i,n)}}const Rpe=Object.freeze(Object.defineProperty({__proto__:null,RGBELoader:fE},Symbol.toStringTag,{value:"Module"})),_G="NEEDLE_lightmaps",G0=ie("debuglightmapsextension")||ie("debuglightmaps");var _d=(s=>(s[s.Lightmap=0]="Lightmap",s[s.Skybox=1]="Skybox",s[s.Reflection=2]="Reflection",s))(_d||{});class Ppe{constructor(e,t,i){d(this,"parser");d(this,"registry");d(this,"source");this.parser=e,this.registry=t,this.source=i}get name(){return _G}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[_G];if(i){const n=i.textures;return n!=null&&n.length?(G0&&console.log(i),new Promise(async(r,o)=>{const a=[];for(const c of n)if(c.pointer){G0&&console.log(c);let h=null;if(c.pointer.startsWith("/textures/"))G0&&console.log("Load texture from gltf",c.pointer),h=jk(this.parser,c.pointer).then(u=>this.resolveTexture(c,u));else if(typeof c.pointer=="string"){G0&&console.log("Load texture from path",c.pointer);const u=nf(this.source,c.pointer);let f;u.endsWith(".exr")?f=new eb(this.parser.options.manager):u.endsWith(".hdr")?f=new fE(this.parser.options.manager):f=new Bc(this.parser.options.manager),h=f.loadAsync(u,void 0).then(p=>this.resolveTexture(c,p))}else c.pointer;h&&a.push(h)}const l=await TM(a);l!=null&&l.anyFailed&&nt()&&console.error("Failed to load lightmap extension",l),r()})):null}}return null}resolveTexture(e,t){const i=t;G0&&console.log("Lightmap loaded:",i),i!=null&&i.isTexture&&(this.registry?(i.colorSpace=zi,this.registry.registerTexture(this.source,e.type,i,e.index)):console.log(_d[e.type],e.pointer,i))}}const bG=!!ie("debuglightmaps");class Bpe{constructor(e){d(this,"_context");d(this,"_lightmaps",new Map);this._context=e}clear(){this._lightmaps.clear()}registerTexture(e,t,i,n){bG&&console.log("Registering ",_d[t]+' "'+e+'"',i),this._lightmaps.has(e)||this._lightmaps.set(e,new Map);const r=this._lightmaps.get(e),o=(r==null?void 0:r.get(t))??[];o.length<n&&(o.length=n+1),o[n]=i,r==null||r.set(t,o)}tryGetLightmap(e,t=0){return this.tryGet(e,_d.Lightmap,t)}tryGetSkybox(e){return this.tryGet(e,_d.Skybox,0)}tryGetReflection(e){return this.tryGet(e,_d.Reflection,0)}tryGet(e,t,i){if(!e)return bG&&console.warn("Missing source id"),null;const n=this._lightmaps.get(e);if(!n)return null;const r=n.get(t);return r===void 0||!(r!=null&&r.length)||r.length<=i?null:r[i]}}It.lights_fragment_maps=It.lights_fragment_maps.replace("vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );",`
    vec2 lUv = vLightMapUv.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
    vec4 lightMapTexel = texture2D( lightMap, lUv);
    // The range of RGBM lightmaps goes from 0 to 34.49 (5^2.2) in linear space, and from 0 to 5 in gamma space.
    lightMapTexel.rgb *= lightMapTexel.a * 8.; // no idea where that "8" comes from... heuristically derived
    lightMapTexel.a = 1.;
    lightMapTexel = conv_sRGBToLinear(lightMapTexel);
    `);It.lightmap_pars_fragment=`
    #ifdef USE_LIGHTMAP
        uniform sampler2D lightMap;
        uniform float lightMapIntensity;
        uniform vec4 lightmapScaleOffset;
        
        // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
        vec4 conv_sRGBToLinear( in vec4 value ) {
            return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
        }
    #endif
    `;It.lights_fragment_begin=It.lights_fragment_begin.replace("irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );",`
#if defined(USE_LIGHTMAP)
irradiance += 0.;
#else
irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
#endif`);ze.lightmap.lightmapScaleOffset={value:new Je(1,1,0,0)};const oP=ie("debugprogressive"),TS=new jt,IS=new ln;class Dpe{constructor(e){d(this,"context");d(this,"_lodsManager");this.context=e}get manager(){return this._lodsManager}get targetTriangleDensity(){var e;return((e=this._lodsManager)==null?void 0:e.targetTriangleDensity)??-1}set targetTriangleDensity(e){this._lodsManager&&(this._lodsManager.targetTriangleDensity=e)}setRenderer(e){var t;(t=this._lodsManager)==null||t.disable(),Ja.removePlugin(this),Ja.addPlugin(this),Ja.debugDrawLine=_t.DrawLine,this._lodsManager=Ja.get(e),this._lodsManager.enable()}onAfterUpdatedLOD(e,t,i,n,r){oP&&this.onRenderDebug(i,n,r)}onRenderDebug(e,t,i){var a,l,c;if(!t.geometry||!yi.hasLODLevelAvailable(t.geometry)&&!yi.hasLODLevelAvailable(t.material))return;const n=Ja.getObjectLODState(t);if(!n)return;let r=i.mesh_lod;const o=i.mesh_lod!=n.lastLodLevel_Mesh||i.texture_lod!=n.lastLodLevel_Texture;if(oP&&t.geometry.boundingSphere){const h=t.geometry.boundingSphere;IS.copy(h),IS.applyMatrix4(t.matrixWorld);const u=IS.center,f=IS.radius,p=["#76c43e","#bcc43e","#c4ac3e","#c4673e","#ff3e3e"];if(o)_t.DrawWireSphere(u,f,p[r],.1);else{const m=((a=t.geometry.index)==null?void 0:a.count)??0,v=(l=yi.getMeshLODInformation(t.geometry))==null?void 0:l.lods;r=v?Math.min((v==null?void 0:v.length)-1,r):0;let g="";if(v&&n.lastScreenCoverage>0)for(let _=0;_<v.length;_++){const b=v[_].density,x=_==v.length-1;g+=b.toFixed(0)+">"+(b/n.lastScreenCoverage).toFixed(0)+(x?"":",")}const y=v?(c=v[r])==null?void 0:c.density:-1;let A="LOD "+i.mesh_lod+`
TEX `+i.texture_lod;if(oP=="density"&&(A+=`
`+m+` tris
`+(y/n.lastScreenCoverage).toFixed(0)+` dens
`+(n.lastScreenCoverage*100).toFixed(1)+`% cov
`+(n.lastCentrality*100).toFixed(1)+`% centr
`+(TS.min.x.toFixed(2)+"-"+TS.max.x.toFixed(2)+"x"+TS.min.y.toFixed(2)+"-"+TS.max.y.toFixed(2))+" scr"),n.lastScreenCoverage>.1){const _=e,b=_.worldForward,x=_.worldPosition,M=wt(b).multiplyScalar(f*.7).add(u),T=M.distanceTo(x),R=p[Math.min(p.length-1,Math.max(0,r))]+"88",w=this.context.domHeight>0?screen.height/this.context.domHeight:1,I=e.isPerspectiveCamera?Math.tan(e.fov*Math.PI/180/2):1;_t.DrawLabel(M,A,T*.012*w*I,void 0,16777215,R)}}}}}const Ope=ie("debugplayerview");var Pd=(s=>(s.Browser="browser",s.Headset="headset",s.Handheld="handheld",s))(Pd||{});class W9{constructor(e,t){d(this,"userId");d(this,"context");d(this,"viewDevice","browser");d(this,"removed",!1);d(this,"_object");this.userId=e,this.context=t}get currentObject(){return this._object}set currentObject(e){this._object=e}get isConnected(){return this.context.connection.userIsInRoom(this.userId)}}class j9{constructor(e){d(this,"context");d(this,"playerViews",new Map);this.context=e}setPlayerView(e,t,i){let n=this.playerViews.get(e);n||(n=new W9(e,this.context),this.playerViews.set(e,n)),n.viewDevice=i,n.currentObject=t,n.removed=!1}getPlayerView(e){if(!e)return;if(!this.context.connection.userIsInRoom(e)){this.playerViews.delete(e);return}return this.playerViews.get(e)}removePlayerView(e,t){const i=this.playerViews.get(e);(i==null?void 0:i.viewDevice)===t&&(Ope&&console.log("REMOVE",e),i.removed=!0,this.playerViews.delete(e))}}new yr;const ix=new Uint8Array(4);ix[0]=255;ix[1]=255;ix[2]=255;ix[3]=255;const Lpe=new Qr(ix,1,1,Li);function tF(s,e=1){const t="alpha"in s,i=e*e,n=new Uint8Array(4*i),r=Math.floor(s.r*255),o=Math.floor(s.g*255),a=Math.floor(s.b*255);for(let c=0;c<i;c++){const h=c*4;n[h+0]=r,n[h+1]=o,n[h+2]=a,t?n[h+3]=Math.floor(s.alpha*255):n[h+3]=255}const l=new Qr(n,e,e);return l.needsUpdate=!0,l}function kpe(s,e,t,i=1,n=3){const o=i*n,a=[s,e,t],l=a.length,c=new Uint8Array(4*l*o),h=new Ae;for(let f=0;f<n;f++){const p=Math.floor(f/n*l),m=it.clamp(p+1,0,l-1),v=a[p],g=a[m],y=f/n*l%1;h.lerpColors(v,g,y);const A=Math.floor(h.r*255),_=Math.floor(h.g*255),b=Math.floor(h.b*255);for(let x=0;x<i;x++){const E=(f*i+x)*4;c[E+0]=A,c[E+1]=_,c[E+2]=b,c[E+3]=255}}const u=new Qr(c,i,n);return u.needsUpdate=!0,u}function pE(s,e){const t=s.elements;e||(e=[]),e.length=0;for(let i=0;i<16;i+=4){const n=t[i],r=t[i+1],o=t[i+2],a=t[i+3],l=new Je(n,r,o,a);e.push(l)}return e}const aP=[],xG=[];function Fpe(s,e){if(aP.length===0)for(let t=0;t<27;t++)aP.push(0);e||(e=aP);for(let t=0;t<27;t++)xG[t]=e[t];e=xG,s.unity_SHAr={value:new Je(e[9],e[3],e[6],e[0])},s.unity_SHBr={value:new Je(e[12],e[15],e[18],e[21])},s.unity_SHAg={value:new Je(e[10],e[4],e[7],e[1])},s.unity_SHBg={value:new Je(e[13],e[16],e[19],e[22])},s.unity_SHAb={value:new Je(e[11],e[5],e[8],e[2])},s.unity_SHBb={value:new Je(e[14],e[17],e[20],e[23])},s.unity_SHC={value:new Je(e[24],e[25],e[26],1)}}class Upe{constructor(e,t,i){d(this,"vertexShader");d(this,"fragmentShader");d(this,"technique");this.vertexShader=e,this.fragmentShader=t,this.technique=i}}async function Npe(s,e){if(!s)return console.error("Can not find technique: no shader data"),null;const t=s.programs[e],i=t.vertexShader,n=t.fragmentShader;if(i!==void 0&&n!==void 0){const r=s.shaders[i],o=s.shaders[n];if(r.uri&&o.uri||r.code&&o.code){if(!r.code&&r.uri&&await wG(r),!o.code&&o.uri&&await wG(o),!r.code||!o.code)return null;const a=s.techniques[e];return new Upe(r.code,o.code,a)}}return console.error("Shader technique not found",e),null}async function wG(s){const e=s.uri;if(e)if(e.endsWith(".glsl")){const i=await new yr().loadAsync(e);s.code=i.toString()}else s.code=zpe(s.uri)}function zpe(s){return decodeURIComponent(Array.prototype.map.call(atob(s),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}const El=ie("debugenvlight");var zy=(s=>(s[s.Skybox=0]="Skybox",s[s.Trilight=1]="Trilight",s[s.Flat=3]="Flat",s[s.Custom=4]="Custom",s))(zy||{}),mE=(s=>(s[s.Skybox=0]="Skybox",s[s.Custom=1]="Custom",s))(mE||{});class q9{constructor(e){d(this,"context");d(this,"_currentLightSettingsId");d(this,"_sceneLightSettings");d(this,"_timevec4",new Je);d(this,"__currentReflectionId",null);d(this,"_lighting",{});this.context=e,this.context.pre_update_callbacks.push(this.preUpdate.bind(this))}preUpdate(){const e=this.context.time;this._timevec4.x=e.time,this._timevec4.y=Math.sin(e.time),this._timevec4.z=Math.cos(e.time),this._timevec4.w=e.deltaTime}get timeVec4(){return this._timevec4}get environmentIntensity(){if(!this._sceneLightSettings||!this._currentLightSettingsId)return 1;const e=this._sceneLightSettings.get(this._currentLightSettingsId);return e?e.ambientIntensity:1}get sceneLightSettings(){var e;return(e=this._sceneLightSettings)==null?void 0:e.values()}enable(e){var i;e instanceof ei&&(e=e.uri);const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);return t?(El&&console.log("Enable scene light settings",e,t),e!==this._currentLightSettingsId&&this._currentLightSettingsId&&this.disable(this._currentLightSettingsId),this._currentLightSettingsId=e,t.enabled=!0,!0):(El&&console.warn("No light settings found for",e),!1)}disable(e){var i;if(e instanceof ei&&(e=e.uri),e==null)return!1;const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);return t?(El&&console.log("Disable scene light settings",e,t),t.enabled=!1,!0):!1}disableCurrent(){if(this._currentLightSettingsId){const e=this._currentLightSettingsId;return this.disable(this._currentLightSettingsId),e}return null}internalRegisterSceneLightSettings(e){const t=e.sourceId;if(!t){console.error("Missing source id for scene light settings, can not register:",e);return}El&&console.log("Register "+(e==null?void 0:e.sourceId)+" lighting",e),this._sceneLightSettings||(this._sceneLightSettings=new Map),this._sceneLightSettings.set(t,e)}internalUnregisterSceneLightSettings(e){const t=e.sourceId;if(!t){console.error("Missing source id for scene light settings, can not unregister:",e);return}El&&console.log("Unregister "+(e==null?void 0:e.sourceId)+" lighting",e),this._sceneLightSettings&&this._sceneLightSettings.delete(t)}internalRegisterReflection(e,t){El&&console.log("Register reflection",e,t);const i=new X9(this.context,t,1);this._lighting[e]=i}internalGetReflection(e){return this._lighting[e]}internalEnableReflection(e){var i;this.__currentReflectionId=e;const t=(i=this._sceneLightSettings)==null?void 0:i.get(e);switch(El&&console.log("Enable reflection",e,t?zy[t.ambientMode]:"Unknown ambient mode",t),t==null?void 0:t.ambientMode){case 0:case 4:const n=this.internalGetReflection(e);if(n&&n.Source){El&&console.log("Setting environment reflection",n);const r=this.context.scene,o=n.Source;o.mapping=mo,r.environment=o;return}else El&&console.warn("Could not find reflection for source",e);break}if((t==null?void 0:t.environmentReflectionSource)===1)switch(t==null?void 0:t.ambientMode){case 1:if(t.ambientTrilight){const n=t.ambientTrilight,r=kpe(n[0],n[1],n[2],64,64);r.colorSpace=bt,r.mapping=mo,this.context.scene.environment=r}else console.error("Missing ambient trilight",t.sourceId);return;case 3:if(t.ambientLight){const n=tF(t.ambientLight,64);n.colorSpace=bt,n.mapping=mo,this.context.scene.environment=n}else console.error("Missing ambientlight",t.sourceId);return;default:return}}internalDisableReflection(e){if(e&&e!==this.__currentReflectionId){El&&console.log("Not disabling reflection for",e,"because it is not the current light settings id",this.__currentReflectionId);return}El&&console.log("Disable reflection",e);const t=this.context.scene;t.environment=null}}class X9{constructor(e,t,i=1){d(this,"_source");this._source=t,t.mapping=mo}get Source(){return this._source}}const SG=ie("timescale");let PD=1;typeof SG=="number"&&(PD=SG);class Y9{constructor(){d(this,"_time",0);d(this,"_deltaTime",0);d(this,"_deltaTimeUnscaled",0);d(this,"timeScale",1);d(this,"_frame",0);d(this,"clock",new gL);d(this,"_smoothedFps",0);d(this,"_smoothedDeltaTime",0);d(this,"_fpsSamples",[]);d(this,"_fpsSampleIndex",0);typeof PD=="number"&&(this.timeScale=PD)}get time(){return this._time}set time(e){this._time=e}get deltaTime(){return this._deltaTime}set deltaTime(e){this._deltaTime=e}get deltaTimeUnscaled(){return this._deltaTimeUnscaled}get frame(){return this._frame}set frame(e){this._frame=e}get frameCount(){return this.frame}get realtimeSinceStartup(){return this.clock.elapsedTime}get smoothedFps(){return this._smoothedFps}get smoothedDeltaTime(){return 1/this._smoothedFps}update(){this.deltaTime=this.clock.getDelta(),this.deltaTime=Math.min(.1,this.deltaTime),this._deltaTimeUnscaled=this.deltaTime,this.deltaTime<=0&&(this.deltaTime=1e-12),this.deltaTime*=this.timeScale,this.frame+=1,this.time+=this.deltaTime,this._fpsSamples.length<60?this._fpsSamples.push(this.deltaTime):this._fpsSamples[this._fpsSampleIndex++%60]=this.deltaTime;let e=0;for(let t=0;t<this._fpsSamples.length;t++)e+=this._fpsSamples[t];this._smoothedDeltaTime=e/this._fpsSamples.length,this._smoothedFps=1/this._smoothedDeltaTime}}let CG=!1;function K9(s){CG||(CG=!0,Gpe(),Hpe())}K9();function Gpe(){const s=`
float startCompression = 0.8;
float desaturation = 0.5;
// Patched tonemapping function
vec3 NeutralToneMapping( vec3 color ) {
    color *= toneMappingExposure;
    
    float d = 1. - startCompression;
    // float peak = dot(color, vec3(0.299, 0.587, 0.114));
    float peak = max(color.r, max(color.g, color.b));
    if (peak < startCompression) return color;
    float newPeak = 1. - d * d / (peak + d - startCompression);
    float invPeak = 1. / peak;
    
    float extraBrightness = dot(color * (1. - startCompression * invPeak), vec3(1, 1, 1));
    
    color *= newPeak * invPeak;
    float g = 1. - 3. / (desaturation * extraBrightness + 3.);
    return mix(color, vec3(1, 1, 1), g);
}
`,e="vec3 NeutralToneMapping( vec3 color ) {",t=`return mix(color, vec3(1, 1, 1), g);
}`,i=It.tonemapping_pars_fragment.indexOf(e),n=It.tonemapping_pars_fragment.indexOf(t,i);if(i>=0&&n>=0){const r=It.tonemapping_pars_fragment.substring(i,n+t.length);It.tonemapping_pars_fragment=It.tonemapping_pars_fragment.replace(r,s)}}function Hpe(){const s=`
// 0: Default, 1: Golden, 2: Punchy
#define AGX_LOOK 0        

vec3 userSlope = vec3(1.0);
vec3 userOffset = vec3(0.0);
vec3 userPower = vec3(1.0);
float userSaturation = 1.0;

// Mean error^2: 3.6705141e-06
vec3 _agxDefaultContrastApprox(vec3 x) {
    vec3 x2 = x * x;
    vec3 x4 = x2 * x2;
    
    return  + 15.5     * x4 * x2
            - 40.14    * x4 * x
            + 31.96    * x4
            - 6.868    * x2 * x
            + 0.4298   * x2
            + 0.1191   * x
            - 0.00232;
}

vec3 _agx(vec3 val) {
    const mat3 agx_mat = mat3(
        0.842479062253094, 0.0423282422610123, 0.0423756549057051,
        0.0784335999999992,  0.878468636469772,  0.0784336,
        0.0792237451477643, 0.0791661274605434, 0.879142973793104);
    
    const float min_ev = -12.47393f;
    const float max_ev = 4.026069f;

    // val = pow(val, vec3(2.2)); 

    // Input transform (inset)
    val = agx_mat * val;
    
    // Log2 space encoding
    val = clamp(log2(val), min_ev, max_ev);
    val = (val - min_ev) / (max_ev - min_ev);
    
    // Apply sigmoid function approximation
    val = _agxDefaultContrastApprox(val);

    return val;
}

vec3 _agxEotf(vec3 val) {
    const mat3 agx_mat_inv = mat3(
        1.19687900512017, -0.0528968517574562, -0.0529716355144438,
        -0.0980208811401368, 1.15190312990417, -0.0980434501171241,
        -0.0990297440797205, -0.0989611768448433, 1.15107367264116);
        
    // Inverse input transform (outset)
    val = agx_mat_inv * val;
    
    // sRGB IEC 61966-2-1 2.2 Exponent Reference EOTF Display
    // NOTE: We're linearizing the output here. Comment/adjust when
    // *not* using a sRGB render target
    val = pow(val, vec3(2.2)); 

    return val;
}

vec3 _agxLook(vec3 val) {
    const vec3 lw = vec3(0.2126, 0.7152, 0.0722);
    float luma = dot(val, lw);
    
    // Default
    vec3 offset = vec3(0.0);
    vec3 slope = vec3(1.0);
    vec3 power = vec3(1.0);
    float sat = 1.0;
    
    #if AGX_LOOK == 1
    // Golden
    slope = vec3(1.0, 0.9, 0.5);
    power = vec3(0.8);
    sat = 0.8;
    #elif AGX_LOOK == 2
    // Punchy
    slope = vec3(1.0);
    power = vec3(1.35, 1.35, 1.35);
    sat = 1.4;
    #endif        
    
    // Needle
    slope = vec3(1.05);
    power = vec3(1.10, 1.10, 1.10);
    sat = 1.15;

    // User
    // slope = userSlope;
    // offset = userOffset;
    // power = userPower;
    // sat = userSaturation;
    
    // ASC CDL
    val = pow(val * slope + offset, power);
    return luma + sat * (val - luma);
}


vec3 AgXToneMapping( vec3 color ) {
    // apply AGX
    color *= toneMappingExposure;
    color = _agx(color);
    color = _agxLook(color); // Optional
    color = _agxEotf(color);
    return color;
}`,e="vec3 AgXToneMapping( vec3 color ) {",t=`	return color;
}`,i=It.tonemapping_pars_fragment.indexOf(e),n=It.tonemapping_pars_fragment.indexOf(t,i);if(i>=0&&n>=0){const r=It.tonemapping_pars_fragment.substring(i,n+t.length);It.tonemapping_pars_fragment=It.tonemapping_pars_fragment.replace(r,s)}}function dr(s){const e=document.createElement("span");return e.style.maxWidth="48px",e.style.maxHeight="48px",e.style.overflow="hidden",e.classList.add("material-symbols-outlined","notranslate"),e.setAttribute("translate","no"),e.innerText=s,e}function J9(s){var t;return((t=s.classList)==null?void 0:t.contains("material-symbols-outlined"))||!1}const RS=new Map;async function BD(s){const e="Material Symbols Outlined";if(document.fonts.check(`1em '${e}'`)||(console.log("Font not loaded yet"),await document.fonts.ready),RS.has(s))return RS.get(s);const t=document.createElement("canvas"),i=48;t.width=i,t.height=i;const n=t.getContext("2d");if(n){n.font=`${i}px '${e}'`,n.fillStyle="black",n.fillText(s,0,i);const r=t.toDataURL(),o=new Wt;return o.name=s+" icon",o.image=new Image,o.image.src=r,o.needsUpdate=!0,RS.set(s,o),o}return RS.set(s,null),null}const DE=class{constructor(){d(this,"_fullscreenButton");d(this,"_muteButton");d(this,"_qrButton")}static getOrCreate(){return this._instance||(this._instance=new DE),this._instance}static create(){return new DE}get fullscreenButton(){return this._fullscreenButton}createFullscreenButton(e){if(this._fullscreenButton)return this._fullscreenButton;if(!document.fullscreenEnabled)return nt()&&console.warn("NeedleMenu: Fullscreen button could not be created, device doesn't support the Fullscreen API"),null;const t=document.createElement("button");this._fullscreenButton=t,t.classList.add("fullscreen-button"),t.title="Click to enter fullscreen mode";const i=dr("fullscreen"),n=dr("fullscreen_exit");return t.appendChild(i),t.onclick=()=>{document.fullscreenElement?document.exitFullscreen():"webkitRequestFullscreen"in e.domElement&&typeof e.domElement.webkitRequestFullscreen=="function"?e.domElement.webkitRequestFullscreen():"requestFullscreen"in e.domElement&&e.domElement.requestFullscreen()},document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(i.remove(),t.appendChild(n),t.title="Click to enter fullscreen mode"):(n.remove(),t.appendChild(i),t.title="Click to exit fullscreen mode")}),globalThis.addEventListener("needle-xrsession-start",()=>{t.style.display="none"}),globalThis.addEventListener("needle-xrsession-end",()=>{t.style.display=""}),t}get muteButton(){return this._muteButton}createMuteButton(e){if(this._muteButton)return this._muteButton;const t=document.createElement("button");this._muteButton=t,t.classList.add("mute-button"),t.title="Click to mute/unmute";const i=dr("volume_off"),n=dr("volume_up");return e.application.muted?t.appendChild(i):t.appendChild(n),t.onclick=()=>{e.application.muted?(i.remove(),t.appendChild(n),e.application.muted=!1):(n.remove(),t.appendChild(i),e.application.muted=!0)},t}get qrButton(){return this._qrButton}createQRCode(){if(this._qrButton)return this._qrButton;const e=document.createElement("button");this._qrButton=e,e.innerText="QR Code",e.prepend(dr("qr_code")),e.title="Scan this QR code with your phone to open this page",this.hideElementDuringXRSession(e);const t=document.createElement("div");t.style.cssText=`
            position: fixed;
            display: inline-block;
            padding: 1rem;
            background-color: white;
            border-radius: 0.4rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        `;const i=document.createElement("div");i.classList.add("qr-code-container"),t.appendChild(i),e.addEventListener("click",()=>{if(t.parentNode)return r();window.location.href.includes("://localhost")&&Fi("To access your website from another device in the same local network you have to use the IP address instead of localhost."),n()});async function n(){await o(),document.body.appendChild(t);const a=i.getBoundingClientRect(),l=e.getBoundingClientRect();t.style.left=l.left+l.width*.5-a.width*.5+"px",l.top<a.height?t.style.top=`calc(${l.bottom}px + ${t.style.padding} * .6)`:t.style.top=`calc(${l.top-a.height}px - ${t.style.padding} * 2.5)`,t.style.opacity="0",t.style.pointerEvents="all",t.style.transition="opacity 0.2s ease-in-out",setTimeout(()=>{t.style.opacity="1",window.addEventListener("click",r,{once:!0})}),window.addEventListener("resize",r),window.addEventListener("scroll",r),document.fullscreenElement?document.fullscreenElement.appendChild(t):document.body.appendChild(t)}function r(){t.style.pointerEvents="none",t.style.transition="opacity 0.2s",t.style.opacity="0",setTimeout(()=>{var a;return(a=t.parentNode)==null?void 0:a.removeChild(t)},500),window.removeEventListener("click",r),window.removeEventListener("resize",r),window.removeEventListener("scroll",r)}async function o(){const l=await I6({text:window.location.href,width:200,height:200});i.innerHTML="",i.appendChild(l)}return e.addEventListener("pointerenter",()=>{o()},{once:!0}),e}hideElementDuringXRSession(e){VM(t=>{e["previous-display"]=e.style.display,e.style.display="none"}),Ek(t=>{e["previous-display"]!=null&&(e.style.display=e["previous-display"])})}};let Ll=DE;d(Ll,"_instance");function gE(s,e){const t=(e==null?void 0:e.element)||document.head,i=Array.from(t.querySelectorAll(`link[rel=stylesheet][href*='${s}']`));if(i.length<=0){const n=document.createElement("link");n.href=s,n.rel="stylesheet",t.appendChild(n),i.push(n)}if(e!=null&&e.loadedCallback)for(let n=0;n<i.length;n++)e!=null&&e.loadedCallback&&i[n].addEventListener("load",e.loadedCallback)}function Z9(){gE("https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap")}const DD="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0",yE="needle-logo-element";class $9 extends HTMLElement{constructor(){super();d(this,"_root");d(this,"wrapper");d(this,"logoElement",document.createElement("img"));d(this,"textElement",document.createElement("span"));this._root=this.attachShadow({mode:"closed"});const t=document.createElement("template");t.innerHTML=`<style>
        :host {
            position: relative;
            min-width: fit-content;
            /* height: 100%; can not have height 100% because of align-items: stretch; in the parent */
            display: flex;
            margin: 0 0.3rem;
        }

        .wrapper {
            position: relative;
            display: grid;
            grid-template-columns: auto auto;
            padding: .1rem;
        }
        .wrapper:hover {
            cursor: pointer;
        }
        img {
            width: 95px;
            height: 100%;
            align-self: end;
        }
        span {
            font-size: 1rem;
            white-space: nowrap;
        }
        </style>
        <div class="wrapper">
            <img class="logo" src=${Doe} />
        </div>
        `,this._root.appendChild(t.content.cloneNode(!0)),this.wrapper=this._root.querySelector(".wrapper"),this._root.appendChild(this.wrapper),this.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),this.wrapper.setAttribute("title","Made with Needle Engine")}static get elementName(){return yE}static create(){return document.createElement(yE)}setLogoVisible(t){this.logoElement.style.display=t?"block":"none"}}customElements.get(yE)||customElements.define(yE,$9);const lP=ie("debugspatialmenu");class Vpe{constructor(e,t){d(this,"_context");d(this,"needleMenu");d(this,"htmlButtonsMap",new Map);d(this,"enabled",!0);d(this,"uiisDirty",!1);d(this,"_showNeedleLogo");d(this,"_wasInXR",!1);d(this,"preRender",()=>{var t;if(!this.enabled){(t=this.menu)==null||t.removeFromParent();return}lP&&ev()&&this.updateMenu();const e=this._context.xr;if(!(e!=null&&e.running)){this._wasInXR&&(this._wasInXR=!1,this.onExitXR());return}this._wasInXR||(this._wasInXR=!0,this.onEnterXR()),this.updateMenu()});d(this,"_menuTarget",new ye);d(this,"positionFilter",new KL(90,.5));d(this,"familyName","Needle Spatial Menu");d(this,"menu");d(this,"_poweredByNeedleElement");var n;this._context=e,this._context.pre_render_callbacks.push(this.preRender),this.needleMenu=t;const i=(n=this.needleMenu.shadowRoot)==null?void 0:n.querySelector(".options");i?new MutationObserver(o=>{if(this.enabled&&!(this._context.isInXR==!1&&!lP))for(const a of o)a.type==="childList"&&(a.addedNodes.forEach(l=>{this.createButtonFromHTMLNode(l)}),a.removedNodes.forEach(l=>{const c=l,h=this.htmlButtonsMap.get(c);h&&(this.htmlButtonsMap.delete(c),h.remove(),Wi.update())}))}).observe(i,{childList:!0}):console.error("Could not find options container in needle menu")}setEnabled(e){var t;this.enabled=e,e||(t=this.menu)==null||t.removeFromParent()}onDestroy(){const e=this._context.pre_render_callbacks.indexOf(this.preRender);e>-1&&this._context.pre_render_callbacks.splice(e,1)}markDirty(){this.uiisDirty=!0}showNeedleLogo(e){this._showNeedleLogo=e}onEnterXR(){var t;const e=(t=this.needleMenu.shadowRoot)==null?void 0:t.querySelector(".options");e&&e.childNodes.forEach(i=>{this.createButtonFromHTMLNode(i)})}onExitXR(){var e;(e=this.menu)==null||e.removeFromParent()}createButtonFromHTMLNode(e){const t=this.getMenu(),i=this.htmlButtonsMap.get(e);if(i){i.add();return}if(e instanceof HTMLButtonElement){const n=this.createButton(t,e);this.htmlButtonsMap.set(e,n),n.add()}else e instanceof HTMLSlotElement&&e.assignedNodes().forEach(n=>{this.createButtonFromHTMLNode(n)})}updateMenu(){var r,o;performance.mark("NeedleSpatialMenu updateMenu start");const e=this.getMenu();this.handleNeedleWatermark(),this._context.scene.add(e);const t=this._context.mainCamera,i=this._context.xr,n=(i==null?void 0:i.rigScale)||1;if(t){const a=t.worldPosition,l=t.worldForward.multiplyScalar(-1),c=l.y>.6,h=l.y>.4,u=e.visible?h:c,f=!e.visible&&u;e.visible=u||ev()&&lP,l.multiplyScalar(3*n),a.add(l),(f||!1)&&(e.position.copy(this._menuTarget.position),e.position.y+=1,this._menuTarget.position.copy(e.position),this.positionFilter.reset(e.position),e.quaternion.copy(this._menuTarget.quaternion),this.markDirty());const m=this._menuTarget.position.distanceTo(a);(f||m>1.5*n)&&(this.ensureRenderOnTop(this.menu),this._menuTarget.position.copy(a),this._context.scene.add(this._menuTarget),zb(this._menuTarget,this._context.mainCamera,!1,!0),this._menuTarget.removeFromParent()),this.positionFilter.filter(this._menuTarget.position,e.position,this._context.time.time);const v=5;(r=this.menu)==null||r.quaternion.slerp(this._menuTarget.quaternion,this._context.time.deltaTime*v),(o=this.menu)==null||o.scale.setScalar(n)}this.uiisDirty&&(performance.mark("SpatialMenu.update.uiisDirty.start"),this.uiisDirty=!1,Wi.update(),performance.mark("SpatialMenu.update.uiisDirty.end"),performance.measure("SpatialMenu.update.uiisDirty","SpatialMenu.update.uiisDirty.start","SpatialMenu.update.uiisDirty.end")),performance.mark("NeedleSpatialMenu updateMenu end"),performance.measure("SpatialMenu.update","NeedleSpatialMenu updateMenu start","NeedleSpatialMenu updateMenu end")}ensureRenderOnTop(e,t=0){e instanceof fe&&(e.material.depthTest=!1,e.material.depthWrite=!1),e.renderOrder=1e3+t*2;for(const i of e.children)this.ensureRenderOnTop(i,t+1)}getMenu(){if(this.menu)return this.menu;this.ensureFont(),this.menu=new Wi.Block({boxSizing:"border-box",fontFamily:this.familyName,height:"auto",fontSize:.1,color:0,lineHeight:1,backgroundColor:16777215,backgroundOpacity:.55,borderRadius:.04,whiteSpace:"pre-wrap",flexDirection:"row",alignItems:"center",padding:new Je(0,.05,0,.05),borderColor:0,borderOpacity:.05,borderWidth:.005});const e=J.get("ObjectRaycaster");return e&&zp(this.menu,new e),this.menu}handleNeedleWatermark(){var e;if(!this._poweredByNeedleElement){this._poweredByNeedleElement=new Wi.Block({width:"auto",height:"auto",fontSize:.05,whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",margin:.02,borderRadius:.02,padding:.02,backgroundColor:16777215,backgroundOpacity:1}),this._poweredByNeedleElement["needle:use_eventsystem"]=!0;const t=new EG(this._context,()=>globalThis.open("https://needle.tools","_self"));zp(this._poweredByNeedleElement,t);const i=new Wi.Text({textContent:"Powered by",width:"auto",height:"auto"}),n=new Wi.Text({textContent:"needle",width:"auto",height:"auto",fontSize:.07,margin:new Je(0,0,0,.02)});this._poweredByNeedleElement.add(i),this._poweredByNeedleElement.add(n),(e=this.menu)==null||e.add(this._poweredByNeedleElement),this.markDirty(),new Bc().load("./include/needle/poweredbyneedle.webp",o=>{var l;t.allowModifyUI=!1,i.removeFromParent(),n.removeFromParent();const a=o.image.width/o.image.height;(l=this._poweredByNeedleElement)==null||l.set({backgroundImage:o,backgroundOpacity:1,width:.1*a,height:.1}),this.markDirty()})}if(this.menu){const t=this.menu.children.indexOf(this._poweredByNeedleElement);if(!this._showNeedleLogo&&Bd())t>=0&&(this._poweredByNeedleElement.removeFromParent(),this.markDirty());else{this._poweredByNeedleElement.visible=!0,this.menu.add(this._poweredByNeedleElement);const i=this.menu.children.indexOf(this._poweredByNeedleElement);t!==i&&this.markDirty()}}}ensureFont(){let e=Wi.FontLibrary.getFontFamily(this.familyName);if(!e){e=Wi.FontLibrary.addFontFamily(this.familyName);const t=e.addVariant("normal","normal","./include/needle/arial-msdf.json","./include/needle/arial.png");t==null||t.addEventListener("ready",()=>{this.markDirty()})}}createButton(e,t){const i=new Wi.Block({width:"auto",height:"auto",whiteSpace:"pre-wrap",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",backgroundColor:16777215,backgroundOpacity:0,padding:.02,margin:.01,borderRadius:.02,cursor:"pointer",fontSize:.05}),n=new Wi.Text({textContent:"",width:"auto",justifyContent:"center",alignItems:"center",backgroundOpacity:0,backgroundColor:16777215,fontFamily:this.familyName,color:0,borderRadius:.02,padding:.01});i.add(n),i["needle:use_eventsystem"]=!0;const r=new EG(this._context,()=>t.click());return zp(i,r),new Qpe(this,e,t,i,n)}}class Qpe{constructor(e,t,i,n,r){d(this,"menu");d(this,"root");d(this,"htmlbutton");d(this,"spatialContainer");d(this,"spatialText");d(this,"spatialIcon");d(this,"_lastText","");d(this,"_lastTexture");this.menu=e,this.root=t,this.htmlbutton=i,this.spatialContainer=n,this.spatialText=r,new MutationObserver(a=>{for(const l of a)l.type==="attributes"?l.attributeName==="style"&&this.updateVisible():l.type==="childList"&&this.updateText()}).observe(i,{attributes:!0,childList:!0}),this.updateText()}add(){this.spatialContainer.parent!=this.root&&(this.root.add(this.spatialContainer),this.menu.markDirty(),this.updateVisible(),this.updateText())}remove(){this.spatialContainer.parent&&(this.spatialContainer.removeFromParent(),this.menu.markDirty())}updateVisible(){const e=this.spatialContainer.visible;this.spatialContainer.visible=this.htmlbutton.style.display!=="none",e!==this.spatialContainer.visible&&this.menu.markDirty()}updateText(){let e="",t="";this.htmlbutton.childNodes.forEach(i=>{i.nodeType===Node.TEXT_NODE?e+=i.textContent:i instanceof HTMLElement&&J9(i)&&i.textContent&&(t=i.textContent)}),this._lastText!==e&&(this._lastText=e,this.spatialText.name=e,this.spatialText.set({textContent:e}),this.menu.markDirty()),e.length<=0?this.spatialText.parent&&(this.spatialText.removeFromParent(),this.menu.markDirty()):this.spatialText.parent||(this.spatialContainer.add(this.spatialText),this.menu.markDirty()),t&&this.createIcon(t)}async createIcon(e){var i;if(!this.spatialIcon){const n=await BD(e);if(n&&!this.spatialIcon){const o=new Wi.Block({width:.08,height:.08,backgroundColor:16777215,backgroundImage:n,backgroundOpacity:1,margin:new Je(0,.005,0,0)});this.spatialIcon=o,this.spatialContainer.add(o),this.menu.markDirty()}}if(e!=this._lastTexture){this._lastTexture=e;const n=await BD(e);n&&((i=this.spatialIcon)==null||i.set({backgroundImage:n}),this.menu.markDirty())}const t=this.spatialContainer.children.indexOf(this.spatialIcon);t>0&&(this.spatialContainer.children.splice(t,1),this.spatialContainer.children.unshift(this.spatialIcon),this.menu.markDirty())}}class EG{constructor(e,t){d(this,"isComponent",!0);d(this,"enabled",!0);d(this,"gameObject");d(this,"allowModifyUI",!0);d(this,"context");d(this,"onclick");this.context=e,this.onclick=t}get activeAndEnabled(){return!0}__internalAwake(){}__internalEnable(){}__internalDisable(){}__internalStart(){}onEnable(){}onDisable(){}get element(){return this.gameObject}onPointerEnter(){this.context.input.setCursorPointer(),this.allowModifyUI&&(this.element.set({backgroundOpacity:1}),Wi.update())}onPointerExit(){this.context.input.setCursorNormal(),this.allowModifyUI&&(this.element.set({backgroundOpacity:0}),Wi.update())}onPointerDown(e){e.use()}onPointerUp(e){e.use()}onPointerClick(e){e.use(),this.onclick()}}const _y="needle-menu",o_=ie("debugmenu"),MG=ie("debugnoncommercial");let Wpe=class{constructor(e){d(this,"_context");d(this,"_menu");d(this,"_spatialMenu");d(this,"onPostMessage",e=>{if(e.origin===globalThis.location.origin&&typeof e.data=="object"){const t=e.data,i=t.type;if(i==="needle:menu"){const n=t.button;if(n){if(!n.label)return console.error("NeedleMenu: buttoninfo.label is required");if(!n.onclick)return console.error("NeedleMenu: buttoninfo.onclick is required");const r=document.createElement("button");if(r.textContent=n.label,n.icon){const o=dr(n.icon);r.prepend(o)}n.priority&&r.setAttribute("priority",n.priority.toString()),r.onclick=()=>{if(n.onclick){const o=n.onclick.startsWith("http")||n.onclick.startsWith("www."),a=n.target||"_blank";o?globalThis.open(n.onclick,a):console.error("NeedleMenu: onclick is not a valid link",n.onclick)}},this._menu.appendChild(r)}else o_&&console.error("NeedleMenu: unknown postMessage event",t)}else o_&&console.warn("NeedleMenu: unknown postMessage type",i,t)}});d(this,"onStartXR",e=>{e.session.isScreenBasedAR&&(this._menu.previousParent=this._menu.parentNode,this._context.arOverlayElement.appendChild(this._menu),e.session.session.addEventListener("end",this.onExitXR))});d(this,"onExitXR",()=>{this._menu.previousParent&&(this._menu.previousParent.appendChild(this._menu),delete this._menu.previousParent)});d(this,"_muteButton");d(this,"_fullscreenButton");this._menu=vE.getOrCreate(e.domElement,e),this._context=e,this._spatialMenu=new Vpe(e,this._menu),window.addEventListener("message",this.onPostMessage),VM(this.onStartXR)}onDestroy(){window.removeEventListener("message",this.onPostMessage),this._menu.remove(),this._spatialMenu.onDestroy()}setPosition(e){this._menu.setPosition(e)}setVisible(e){this._menu.setVisible(e)}showNeedleLogo(e){var t;this._menu.showNeedleLogo(e),(t=this._spatialMenu)==null||t.showNeedleLogo(e)}showSpatialMenu(e){this._spatialMenu.setEnabled(e)}showQRCodeButton(e){if(e==="desktop-only"&&(e=!Wc()),e){const t=Ll.getOrCreate().createQRCode();return t.style.display="",this._menu.appendChild(t),t}else{const t=Ll.getOrCreate().qrButton;return t&&(t.style.display="none"),t??null}}showAudioPlaybackOption(e){var t;if(!e){(t=this._muteButton)==null||t.remove();return}this._muteButton=Ll.getOrCreate().createMuteButton(this._context),this._muteButton.setAttribute("priority","100"),this._menu.appendChild(this._muteButton)}showFullscreenOption(e){var t;if(!e){(t=this._fullscreenButton)==null||t.remove();return}this._fullscreenButton=Ll.getOrCreate().createFullscreenButton(this._context),this._fullscreenButton&&(this._fullscreenButton.setAttribute("priority","150"),this._menu.appendChild(this._fullscreenButton))}appendChild(e){return this._menu.appendChild(e)}};var vb,Ab,OD;const DU=class extends HTMLElement{constructor(){var h,u,f,p,m,v;super();qo(this,Ab);d(this,"_domElement",null);d(this,"_context",null);d(this,"_sizeChangeInterval");qo(this,vb,t=>{if(!t.defaultPrevented&&t.target==this._domElement&&t instanceof PointerEvent&&t.button===0&&this.root.classList.contains("open")){const i=this.foldout.getBoundingClientRect(),n=t;n.clientX>i.left&&n.clientX<i.right&&n.clientY>i.top&&n.clientY<i.bottom||this.root.classList.toggle("open",!1)}});d(this,"_userRequestedLogoVisible");d(this,"_userRequestedMenuVisible");d(this,"root");d(this,"wrapper");d(this,"options");d(this,"logoContainer");d(this,"compactMenuButton");d(this,"foldout");d(this,"_isHandlingChange",!1);d(this,"_didSort",new Map);d(this,"_lastAvailableWidthChange",0);d(this,"_timeoutHandle",0);d(this,"handleSizeChange",(t,i)=>{if(!this._domElement)return;const n=this._domElement.clientWidth;if(n<500){this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style");return}const r=20*2,o=n-r;if(!i&&Math.abs(o-this._lastAvailableWidthChange)<1)return;this._lastAvailableWidthChange=o,clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout(()=>{const c=l();c<0?(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")):c>0&&(this.root.classList.remove("compact"),this.foldout.classList.remove("floating-panel-style"),l()<0&&(this.root.classList.add("compact"),this.foldout.classList.add("floating-panel-style")))},5);const a=()=>this.options.clientWidth+this.logoContainer.clientWidth,l=()=>o-a()});const t=document.createElement("template");t.innerHTML=`<style>

        #root {
            position: absolute;
            width: auto;
            max-width: 95%;
            left: 50%;
            transform: translateX(-50%);
            top: min(20px, 10vh);
            padding: 0.3rem;
            display: flex;
            visibility: visible;
            flex-direction: row-reverse; /* if we overflow this should be right aligned so the logo is always visible */
            pointer-events: all;
            z-index: 1000;
        }

        /** hide the menu if it's empty **/
        #root.has-no-options.logo-hidden {
            display: none; 
        }

        /** using a div here because then we can change the class for placement **/
        #root.bottom {
            top: auto;
            bottom: min(30px, 10vh);
        }
        
        .wrapper {
            position: relative;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 0px;
            padding: 0 .3rem;
        }

        .wrapper > *, .options > button, ::slotted(*) {
            position: relative;
            border: none;
            border-radius: 0;
            outline: 1px solid rgba(0,0,0,0);
            display: flex;
            justify-content: center;
            align-items: center;
            max-height: 2.3rem;

            /** basic font settings for all entries **/
            font-size: 1rem;
            font-family: 'Roboto Flex', sans-serif;
            font-optical-sizing: auto;
            font-weight: 500;
            font-weight: 200;
            font-variation-settings: "wdth" 100;
            color: rgb(20,20,20);
        }

        .floating-panel-style {
            background: rgba(255, 255, 255, .4);
            outline: rgb(0 0 0 / 5%) 1px solid;
            border: 1px solid rgba(255, 255, 255, .1);
            box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0,0,0,.05);
            border-radius: 1.1999999999999993rem;
            /** 
             * to make nested background filter work 
             * https://stackoverflow.com/questions/60997948/backdrop-filter-not-working-for-nested-elements-in-chrome 
             **/
            &::before {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: -1;
                border-radius: 1.1999999999999993rem;
                -webkit-backdrop-filter: blur(8px);
                backdrop-filter: blur(8px);
            }
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .options {
            display: flex;
            flex-direction: row;
        }

        .options > button, ::slotted(button) {
            height: 2.25rem;
            padding: .4rem .5rem;
        }
        
        :host .options > button, ::slotted(*) {
            background: transparent;
            border: none;
            white-space: nowrap;
            transition: all 0.1s linear .02s;
            border-radius: 0.8rem;
        }
            
        :host .options > *:hover, ::slotted(*:hover) {
            cursor: pointer;
            color: black;
            background: rgba(245, 245, 245, .8);
            box-shadow: inset 0 0 1rem rgba(0,0,30,.2);
            outline: rgba(0,0,0,.1) 1px solid;
        }
        :host .options > *:active, ::slotted(*:active) {
            background: rgba(255, 255, 255, .8);
            box-shadow: inset 0px 1px 1px rgba(255,255,255,.5), inset 0 0 2rem rgba(0,0,30,.2), inset 0px 2px 4px rgba(0,0,20,.5);
            transition: all 0.05s linear;
        }
        :host .options > *:focus, ::slotted(*:focus) {
            outline: rgba(255,255,255,.5) 1px solid;
        }

        :host .options > *:disabled, ::slotted(*:disabled) {
            background: rgba(0,0,0,.05);
            color: rgba(60,60,60,.7);
            pointer-events: none;
        }

        button, ::slotted(button) {
            gap: 0.3rem;
        }

        /** XR button animation **/
        :host button.this-mode-is-requested {
            background: repeating-linear-gradient(to right, #fff 0%, #fff 40%, #aaffff 55%, #fff 80%);
            background-size: 200% auto;
            background-position: 0 100%;
            animation: AnimationName .7s ease infinite forwards;
        }
        :host button.other-mode-is-requested {
            opacity: .5;
        }
        
        @keyframes AnimationName {
            0% { background-position: 0% 0 }
            100% { background-position: -200% 0 }
        }




        .logo {
            cursor: pointer;
            padding-left: 0.6rem;
        }
        .logo-hidden {
            .logo {
                display: none;
            }
        }
        :host .has-options .logo {
            border-left: 1px solid rgba(40,40,40,.4);
            margin-left: 0.3rem;
        }

        .logo > span {
            white-space: nowrap;
        }



        /** COMPACT */

        /** Hide the menu button normally **/
        .compact-menu-button { display: none; }
        /** And show it when we're in compact mode **/
        .compact .compact-menu-button {
            display: block;
            background: none;
            border: none;
            border-radius: 2rem;

            margin: 0;
            padding: 0 .3rem;
            padding-top: .2rem;

            color: #000;

            &:hover {
                background: rgba(255,255,255,.2);
                cursor: pointer;
            }
            &:focus {
                outline: 1px solid rgba(255,255,255,.5);
            }
        }  
        .has-no-options .compact-menu-button {
            display: none;
        }
        .open .compact-menu-button {
            background: rgba(255,255,255,.2);
        }
        .logo-visible .compact-menu-button { 
            margin-left: .2rem;
        }
        
        /** Open and hide menu **/
        .compact .foldout { 
            display: none;
        }
        .open .options, .open .foldout {
            display: flex;
        }
        .compact .wrapper {
            padding: 0;
        }
        .compact .wrapper, .compact .options {
            height: auto;
            max-height: initial;
            flex-direction: row;
            gap: .12rem;
        }
        .compact .options { 
            flex-wrap: wrap;
        }
        .compact .top .options {
            height: auto;
            flex-direction: row;
        }
        .compact .bottom .wrapper {
            height: auto;
            flex-direction: column;
        }

        .compact .foldout {
            max-height: min(100ch, calc(100vh - 100px));
            overflow: auto;
            overflow-x: hidden;
            align-items: center;

            position: fixed;
            bottom: calc(100% + 5px);
            z-index: 100;
            width: auto;
            left: .2rem;
            right: .2rem;
            padding: .2rem;

        }
        .compact.logo-hidden .foldout {
            /** for when there's no logo we want to center the foldout **/
            min-width: 24ch;
            margin-left: 50%;
            transform: translateX(calc(-50% - .2rem));
        }
        
        .compact.top .foldout {
            top: calc(100% + 5px);
            bottom: auto;
        }

        ::-webkit-scrollbar {
            max-width: 7px;
            background: rgba(100,100,100,.2);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, .3);
            border-radius: .2rem;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgb(150,150,150);
        }

        .compact .options > * {
            font-size: 1.2rem;
            padding: .6rem .5rem;
        }
        .compact.has-options .logo {
            border: none;
            padding-left: 0;
            margin-left: 1rem;
            margin-bottom: .02rem;
        }
        .compact .options > button {
            display: flex;
            flex-basis: 100%;
        }
        .compact .options > button.row2 {
            //border: 1px solid red !important;
            display: flex;
            flex: 1;
            flex-basis: 30%;
        }

        /** If there's really not enough space then just hide all options **/
        @media (max-width: 100px) or (max-height: 100px){
            .foldout {
                display: none !important;
            }
            .compact-menu-button {
                display: none !important;
            }
        }
        
        /* dark mode */
        /*
        @media (prefers-color-scheme: dark) {
            :host {
                background: rgba(0,0,0, .6);
            }
            :host button {
                color: rgba(200,200,200);
            }
            :host button:hover {
                background: rgba(100,100,100, .8);
            }
        }
        */

        </style>
        
        <div id="root" class="logo-visible floating-panel-style bottom">
            <div class="wrapper">
                <div class="foldout">
                    <div class="options" part="options">
                        <slot></slot>
                    </div>
                    <div class="options" part="options">
                        <slot name="end"></slot>
                    </div>
                </div>
                <div class="logo">
                    <span class="madewith notranslate">powered by</span>
                </div>
            </div>
            <button class="compact-menu-button"></button>
        </div>
        `;const i=this.attachShadow({mode:"open"});Z9(),gE(DD,{loadedCallback:()=>{this.handleSizeChange()}}),gE(DD,{element:i});const n=t.content.cloneNode(!0);i==null||i.appendChild(n),this.root=i.querySelector("#root"),this.wrapper=(h=this.root)==null?void 0:h.querySelector(".wrapper"),this.options=(u=this.root)==null?void 0:u.querySelector(".options"),this.logoContainer=(f=this.root)==null?void 0:f.querySelector(".logo"),this.compactMenuButton=(p=this.root)==null?void 0:p.querySelector(".compact-menu-button"),this.compactMenuButton.append(dr("more_vert")),this.foldout=(m=this.root)==null?void 0:m.querySelector(".foldout"),(v=this.root)==null||v.appendChild(this.wrapper),this.wrapper.classList.add("wrapper");const r=$9.create();r.style.minHeight="1rem",this.logoContainer.append(r),this.logoContainer.addEventListener("click",()=>{globalThis.open("https://needle.tools","_blank")}),Zpe(g=>{if(g==!0&&tu()&&!MG){let y=this._userRequestedLogoVisible;y===void 0&&(y=!1),Cf(this,Ab,OD).call(this,y)}}),this.compactMenuButton.addEventListener("click",g=>{g.preventDefault(),this.root.classList.toggle("open")});let o=this._context;setTimeout(()=>o=this._context);let a=0;const l=(g,y)=>{var A,_,b;o_&&console.log("Set menu visible",y),o!=null&&o.isInAR&&o.arOverlayElement?g!=o.arOverlayElement&&o.arOverlayElement.appendChild(this):this.parentNode!=((A=this._domElement)==null?void 0:A.shadowRoot)&&((b=(_=this._domElement)==null?void 0:_.shadowRoot)==null||b.appendChild(this)),this.style.display=y?"flex":"none",this.style.visibility="visible",this.style.opacity="1"};new MutationObserver(g=>{var A;this.onChangeDetected(g);const y=this==null?void 0:this.parentNode;if((this.style.display!="flex"||this.style.visibility!="visible"||this.style.opacity!="1"||y!=((A=this._domElement)==null?void 0:A.shadowRoot))&&!tu()){const _=a++;yo()&&this._userRequestedMenuVisible===!1?(_===0&&l(y,this._userRequestedMenuVisible),_===1&&console.warn("Needle Menu Warning: You need a PRO license to hide the Needle Engine menu  The menu will be visible in your deployed website if you don't have a PRO license. See https://needle.tools/pricing for details.")):_===0?l(y,!0):setTimeout(()=>l(y,!0),5)}}).observe(this.root,{childList:!0,subtree:!0,attributes:!0}),o_&&this.___insertDebugOptions()}static create(){return document.createElement(_y,{is:_y})}static getOrCreate(t,i){let n=t.querySelector(_y);return!n&&t.shadowRoot&&(n=t.shadowRoot.querySelector(_y)),n||(n=DU.create(),t.shadowRoot?t.shadowRoot.appendChild(n):t.appendChild(n)),n._domElement=t,n._context=i,n}connectedCallback(){window.addEventListener("resize",this.handleSizeChange),this.handleMenuVisible(),this._sizeChangeInterval=setInterval(()=>this.handleSizeChange(void 0,!0),5e3),setTimeout(()=>{var t,i;(t=this._domElement)==null||t.addEventListener("resize",this.handleSizeChange),(i=this._domElement)==null||i.addEventListener("click",pi(this,vb))},1)}disconnectedCallback(){var t,i;window.removeEventListener("resize",this.handleSizeChange),clearInterval(this._sizeChangeInterval),(t=this._domElement)==null||t.removeEventListener("resize",this.handleSizeChange),(i=this._context)==null||i.domElement.removeEventListener("click",pi(this,vb))}showNeedleLogo(t){this._userRequestedLogoVisible=t,!(!t&&(!tu()||MG)&&(console.warn("Needle Menu: You need a PRO license to hide the Needle Engine logo."),!yo()))&&Cf(this,Ab,OD).call(this,t)}setPosition(t){if(t!=="top"&&t!=="bottom")return console.error("NeedleMenu.setPosition: invalid position",t);this.root.classList.remove("top","bottom"),this.root.classList.add(t)}setVisible(t){this._userRequestedMenuVisible=t,this.style.display=t?"flex":"none"}append(...t){for(const i of t)if(typeof i=="string"){const n=document.createTextNode(i);this.options.appendChild(n)}else this.options.appendChild(i)}appendChild(t){var n;if(!(t instanceof Node)){const r=document.createElement("button");if(r.textContent=t.label,r.onclick=t.onClick,r.setAttribute("priority",((n=t.priority)==null?void 0:n.toString())??"0"),t.icon){const o=dr(t.icon);t.iconSide==="right"?r.appendChild(o):r.prepend(o)}t.class&&r.classList.add(t.class),t=r}return this.options.appendChild(t)}prepend(...t){for(const i of t)if(typeof i=="string"){const n=document.createTextNode(i);this.options.prepend(n)}else this.options.prepend(i)}onChangeDetected(t){if(!this._isHandlingChange){this._isHandlingChange=!0;try{this.handleMenuVisible();for(const i of t)i.target==this.options&&this.onOptionsChildrenChanged(i)}finally{this._isHandlingChange=!1}}}onOptionsChildrenChanged(t){if(this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions),this.handleSizeChange(void 0,!0),t.type==="childList"){let i=!1;const n=Date.now();for(let r=0;r<t.addedNodes.length;r++){const o=t.addedNodes[r],a=this._didSort.get(o);typeof a=="number"&&n-a<100||(this._didSort.set(o,n),i=!0)}if(i){const r=Array.from(this.options.children);r.sort((o,a)=>{const l=parseInt(o.getAttribute("priority")||"0"),c=parseInt(a.getAttribute("priority")||"0");return l-c});for(const o of r)this.options.appendChild(o)}}}handleMenuVisible(){o_&&console.log("Update VisibleState: Any Content?",this.hasAnyContent),this.hasAnyContent?this.root.style.display="":this.root.style.display="none",this.root.classList.toggle("has-options",this.hasAnyVisibleOptions),this.root.classList.toggle("has-no-options",!this.hasAnyVisibleOptions)}get hasAnyContent(){return!!(this.logoContainer.style.display!="none"||this.hasAnyVisibleOptions)}get hasAnyVisibleOptions(){for(let t=0;t<this.options.children.length;t++){const i=this.options.children[t];if(i.tagName==="SLOT"){const r=i.assignedNodes();for(const o of r)if(o instanceof HTMLElement&&o.style.display!="none")return!0}else if(i.style.display!="none")return!0}return!1}___insertDebugOptions(){window.addEventListener("keydown",n=>{n.key==="p"&&this.setPosition(this.root.classList.contains("top")?"bottom":"top")});const t=document.createElement("button");t.textContent="Hide Buttons",t.onclick=()=>{const n=new Array(this.options.children.length);for(let r=0;r<this.options.children.length;r++)n[r]=this.options.children[r];for(const r of n)this.options.removeChild(r);setTimeout(()=>{for(const r of n)this.options.appendChild(r)},1e3)},this.appendChild(t);const i=document.createElement("button");i.textContent="Toggle Logo",i.addEventListener("click",()=>{this.logoContainer.style.display=this.logoContainer.style.display==="none"?"":"none"}),this.appendChild(i)}};let vE=DU;vb=new WeakMap,Ab=new WeakSet,OD=function(t){this.logoContainer.style.display="",this.logoContainer.style.opacity="1",this.logoContainer.style.visibility="visible",t?(this.root.classList.remove("logo-hidden"),this.root.classList.add("logo-visible")):(this.root.classList.remove("logo-visible"),this.root.classList.add("logo-hidden"))};customElements.get(_y)||customElements.define(_y,vE);const _s=ie("debugcontext"),jpe=ie("stats"),qpe=ie("debugactive"),Xpe=ie("debugframerate"),Ype=ie("debugcoroutine"),Kpe={};class Jpe{constructor(){d(this,"name");d(this,"alias");d(this,"hash");d(this,"runInBackground");d(this,"domElement");d(this,"renderer");d(this,"camera");d(this,"scene")}}var nn=(s=>(s[s.Start=-1]="Start",s[s.EarlyUpdate=0]="EarlyUpdate",s[s.Update=1]="Update",s[s.LateUpdate=2]="LateUpdate",s[s.OnBeforeRender=3]="OnBeforeRender",s[s.OnAfterRender=4]="OnAfterRender",s[s.PrePhysicsStep=9]="PrePhysicsStep",s[s.PostPhysicsStep=10]="PostPhysicsStep",s[s.Undefined=-1]="Undefined",s))(nn||{});function iT(s,e){if(!s)return;if(!s.isComponent){(nt()||_s)&&console.error(`Registered script is not a Needle Engine component. 
The script will be ignored. Please make sure your component extends "Behaviour" imported from "@needle-tools/engine"
`,s);return}e||(e=Dt.Current,_s&&console.warn("> Registering component without context"));const t=e==null?void 0:e.new_scripts;t.includes(s)||t.push(s)}const qi=class{constructor(e){d(this,"name");d(this,"alias");d(this,"isManagedExternally",!1);d(this,"isPaused",!1);d(this,"runInBackground",!1);d(this,"targetFrameRate");d(this,"physicsSteps",1);d(this,"hash");d(this,"domElement");d(this,"_resolutionScaleFactor",1);d(this,"_boundingClientRectFrame",-1);d(this,"_boundingClientRect",null);d(this,"_domX");d(this,"_domY");d(this,"xr",null);d(this,"_xrFrame",null);d(this,"_currentFrameEvent",-1);d(this,"scene");d(this,"renderer");d(this,"composer",null);d(this,"scripts",[]);d(this,"scripts_pausedChanged",[]);d(this,"scripts_earlyUpdate",[]);d(this,"scripts_update",[]);d(this,"scripts_lateUpdate",[]);d(this,"scripts_onBeforeRender",[]);d(this,"scripts_onAfterRender",[]);d(this,"scripts_WithCorroutines",[]);d(this,"scripts_immersive_vr",[]);d(this,"scripts_immersive_ar",[]);d(this,"coroutines",{});d(this,"post_setup_callbacks",[]);d(this,"pre_update_callbacks",[]);d(this,"pre_render_callbacks",[]);d(this,"post_render_callbacks",[]);d(this,"pre_update_oneshot_callbacks",[]);d(this,"new_scripts",[]);d(this,"new_script_start",[]);d(this,"new_scripts_pre_setup_callbacks",[]);d(this,"new_scripts_post_setup_callbacks",[]);d(this,"new_scripts_xr",[]);d(this,"mainCameraComponent");d(this,"_camera",null);d(this,"application");d(this,"animations");d(this,"time");d(this,"input");d(this,"physics");d(this,"connection");d(this,"assets");d(this,"mainLight",null);d(this,"sceneLighting");d(this,"addressables");d(this,"lightmaps");d(this,"players");d(this,"lodsManager");d(this,"menu");d(this,"_sizeChanged",!1);d(this,"_isCreated",!1);d(this,"_isCreating",!1);d(this,"_isVisible",!1);d(this,"_stats",jpe?new Rle:null);d(this,"_intersectionObserver",null);d(this,"_disposeCallbacks",[]);d(this,"maxRenderResolution");d(this,"_originalCreationArgs");d(this,"onUnhandledRejection",e=>{this.onError(e.reason)});d(this,"_cameraStack",[]);d(this,"_onBeforeRenderListeners",new Map);d(this,"_onAfterRenderListeners",new Map);d(this,"_requireDepthTexture",!1);d(this,"_requireColorTexture",!1);d(this,"_renderTarget");d(this,"_isRendering",!1);d(this,"_createId",0);d(this,"_renderlooperrors",0);d(this,"_lastTimestamp",0);d(this,"_accumulatedTime",0);d(this,"_dispatchReadyAfterFrame",!1);d(this,"_wasPaused",!1);this.name=(e==null?void 0:e.name)||"",this.alias=e==null?void 0:e.alias,this.domElement=(e==null?void 0:e.domElement)||document.body,this.hash=e==null?void 0:e.hash,e!=null&&e.renderer&&(this.renderer=e.renderer,this.isManagedExternally=!0),(e==null?void 0:e.runInBackground)!==void 0&&(this.runInBackground=e.runInBackground),e!=null&&e.scene?this.scene=e.scene:this.scene=new Ws,e!=null&&e.camera&&(this._camera=e.camera),this.application=new Nl(this),this.time=new Y9,this.input=new WW(this),this.physics=new Fy(this),this.connection=new Gj(this),this.assets=new jj,this.sceneLighting=new q9(this),this.addressables=new O9(this),this.lightmaps=new Bpe(this),this.players=new j9(this),this.menu=new Wpe(this),this.lodsManager=new Dpe(this),this.animations=new hpe(this);const t=()=>this._sizeChanged=!0;window.addEventListener("resize",t),this._disposeCallbacks.push(()=>window.removeEventListener("resize",t));const i=new ResizeObserver(n=>this._sizeChanged=!0);i.observe(this.domElement),this._disposeCallbacks.push(()=>i.disconnect()),this._intersectionObserver=new IntersectionObserver(n=>{this._isVisible=n[0].isIntersecting}),this._disposeCallbacks.push(()=>{var n;return(n=this._intersectionObserver)==null?void 0:n.disconnect()}),mi.register(this)}static get DefaultTargetFrameRate(){return qi._defaultTargetFramerate.value}static set DefaultTargetFrameRate(e){qi._defaultTargetFramerate.value=e}static get DefaultWebGLRendererParameters(){return qi._defaultWebglRendererParameters}get version(){return tl}static get Current(){return mi.Current}static set Current(e){mi.Current=e}appendHTMLElement(e){return this.domElement.shadowRoot?this.domElement.shadowRoot.appendChild(e):this.domElement.appendChild(e)}get resolutionScaleFactor(){return this._resolutionScaleFactor}set resolutionScaleFactor(e){if(e!==this._resolutionScaleFactor&&typeof e=="number"){if(e<=0){console.error("Invalid resolution scale factor",e);return}this._resolutionScaleFactor=e,this.updateSize()}}calculateBoundingClientRect(){if(this.xr){this._domX=0,this._domY=0;return}this._boundingClientRectFrame!==this.time.frame&&(this._boundingClientRectFrame=this.time.frame,this._boundingClientRect=this.domElement.getBoundingClientRect(),this._domX=this._boundingClientRect.x,this._domY=this._boundingClientRect.y)}get domWidth(){return this.isInAR?window.innerWidth:this.domElement.clientWidth}get domHeight(){return this.isInAR?window.innerHeight:this.domElement.clientHeight}get domX(){return this.calculateBoundingClientRect(),this._domX}get domY(){return this.calculateBoundingClientRect(),this._domY}get isInXR(){var e,t;return((t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.isPresenting)||!1}get xrSessionMode(){var e;return(e=this.xr)==null?void 0:e.mode}get isInVR(){return this.xrSessionMode==="immersive-vr"}get isInAR(){return this.xrSessionMode==="immersive-ar"}get isInPassThrough(){return this.xr?this.xr.isPassThrough:!1}get xrSession(){var e,t;return(t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.getSession()}get xrFrame(){return this._xrFrame}get xrCamera(){var e,t;return this.renderer.xr.isPresenting?(t=(e=this.renderer)==null?void 0:e.xr)==null?void 0:t.getCamera():void 0}get arOverlayElement(){const e=this.domElement;return typeof e.getAROverlayContainer=="function"?e.getAROverlayContainer():this.domElement}get currentFrameEvent(){return this._currentFrameEvent}get mainCamera(){if(this._camera)return this._camera;if(this.mainCameraComponent){const e=this.mainCameraComponent;return e.cam||e.buildCamera(),e.cam}return null}set mainCamera(e){this._camera=e}get rendererData(){return this.sceneLighting}get isCreated(){return this._isCreated}createNewRenderer(e){var t,i,n;if((t=this.renderer)==null||t.dispose(),e={...qi.DefaultWebGLRendererParameters,...e},!e.canvas){const r=(n=(i=this.domElement)==null?void 0:i.shadowRoot)==null?void 0:n.querySelector("canvas");r&&(e.canvas=r,_s&&console.log("Using canvas from shadow root",r))}_s&&console.log("Using Renderer Parameters:",e,this.domElement),this.renderer=new hu(e),this.renderer.debug.checkShaderErrors=nt()||ie("checkshadererrors")===!0,this.renderer.toneMappingExposure=1,this.renderer.toneMapping=po,this.renderer.setClearColor(new Ae("lightgrey"),0),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=PO,this.renderer.setSize(this.domWidth,this.domHeight),this.renderer.outputColorSpace=bt,this.lodsManager.setRenderer(this.renderer),this.input.bindEvents()}internalOnUpdateVisible(){var e,t;(e=this._intersectionObserver)==null||e.disconnect(),(t=this._intersectionObserver)==null||t.observe(this.domElement)}requestSizeUpdate(){this._sizeChanged=!0}updateSize(e=!1){var t,i,n;if(e||!this.isManagedExternally&&((t=this.renderer.xr)==null?void 0:t.isPresenting)===!1){this._sizeChanged=!1;const r=this.resolutionScaleFactor;let o=this.domWidth*r,a=this.domHeight*r;this.maxRenderResolution&&(this.maxRenderResolution.x=Math.max(1,this.maxRenderResolution.x),o=Math.min(this.maxRenderResolution.x,o),this.maxRenderResolution.y=Math.max(1,this.maxRenderResolution.y),a=Math.min(this.maxRenderResolution.y,a));const l=this.mainCamera;this.updateAspect(l),this.renderer.setSize(o,a,!0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.composer&&((i=this.composer.setSize)==null||i.call(this.composer,o,a),"setPixelRatio"in this.composer&&typeof this.composer.setPixelRatio=="function"&&((n=this.composer.setPixelRatio)==null||n.call(this.composer,window.devicePixelRatio)))}}updateAspect(e,t,i){if(!e)return;t===void 0&&(t=this.domWidth),i===void 0&&(i=this.domHeight);const n=e.aspect;e.aspect=t/i,n!==e.aspect&&e.updateProjectionMatrix()}recreate(){this.clear(),this.create(this._originalCreationArgs)}async onCreate(e){return this.create(e)}async create(e){try{this._isCreating=!0,e!==this._originalCreationArgs&&(this._originalCreationArgs=Fb(e)),window.addEventListener("unhandledrejection",this.onUnhandledRejection);const t=await this.internalOnCreate(e);return this._isCreated=t,t}finally{window.removeEventListener("unhandledrejection",this.onUnhandledRejection),this._isCreating=!1}}onError(e){this.domElement.dispatchEvent(new CustomEvent("error",{detail:e}))}clear(){var e,t,i,n;mi.dispatchCallback(Ti.ContextClearing,this),$l(this,Ti.ContextClearing),xa(this.scene,!0,!0),this.scene=new Ws,(e=this.addressables)==null||e.dispose(),(t=this.lightmaps)==null||t.clear(),(n=(i=this.physics)==null?void 0:i.engine)==null||n.clearCaches(),this.isManagedExternally||this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.state.reset(),this.renderer.resetState()),mi.dispatchCallback(Ti.ContextCleared,this)}dispose(){this.internalOnDestroy()}onDestroy(){this.internalOnDestroy()}internalOnDestroy(){var e,t;qi.Current=this,mi.dispatchCallback(Ti.ContextDestroying,this),$l(this,Ti.ContextDestroying),this.clear(),(e=this.renderer)==null||e.setAnimationLoop(null),this.renderer&&(this.renderer.setClearAlpha(0),this.renderer.clear(),this.isManagedExternally||(_s&&console.log("Disposing renderer"),this.renderer.dispose())),this.scene=null,this.renderer=null,this.input.dispose(),this.menu.onDestroy(),this.animations.onDestroy();for(const i of this._disposeCallbacks)try{i()}catch(n){console.error("Error in on dispose callback:",n,i)}(t=this.domElement)!=null&&t.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this._isCreated=!1,mi.dispatchCallback(Ti.ContextDestroyed,this),$l(this,Ti.ContextDestroyed),mi.unregister(this),qi.Current===this&&(qi.Current=null)}registerCoroutineUpdate(e,t,i){return typeof(t==null?void 0:t.next)!="function"?(console.error("Registered invalid coroutine function from "+e.name+`
Coroutine functions must be generators: "*myCoroutine() {...}"
Start a coroutine from a component by calling "this.startCoroutine(myCoroutine())"`),t):(this.coroutines[i]||(this.coroutines[i]=[]),this.coroutines[i].push({comp:e,main:t}),t)}unregisterCoroutineUpdate(e,t){if(!this.coroutines[t])return;const i=this.coroutines[t].findIndex(n=>n.main===e);i>=0&&this.coroutines[t].splice(i,1)}stopAllCoroutinesFrom(e){for(const t in this.coroutines){const i=this.coroutines[t];for(let n=i.length-1;n>=0;n--)i[n].comp===e&&i.splice(n,1)}}setCurrentCamera(e){var n;if(!e)return;if(e.cam||e.buildCamera(),!e.cam){console.warn("Camera component is missing camera",e);return}const t=this._cameraStack.indexOf(e);t>=0&&this._cameraStack.splice(t,1),this._cameraStack.push(e),this.mainCameraComponent=e;const i=e.cam;i.isPerspectiveCamera&&this.updateAspect(i),(n=this.mainCameraComponent)==null||n.applyClearFlagsIfIsActiveCamera()}removeCamera(e){if(!e)return;const t=this._cameraStack.indexOf(e);if(t>=0&&this._cameraStack.splice(t,1),this.mainCameraComponent===e&&(this.mainCameraComponent=void 0,this._cameraStack.length>0)){const i=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(i)}}addBeforeRenderListener(e,t){this._onBeforeRenderListeners.has(e.uuid)||(this._onBeforeRenderListeners.set(e.uuid,[]),e.onBeforeRender=this._createRenderCallbackWrapper(e,this._onBeforeRenderListeners)),this._onBeforeRenderListeners.get(e.uuid).push(t)}removeBeforeRenderListener(e,t){if(this._onBeforeRenderListeners.has(e.uuid)){const i=this._onBeforeRenderListeners.get(e.uuid),n=i.indexOf(t);n>=0&&i.splice(n,1)}}addAfterRenderListener(e,t){var i;this._onAfterRenderListeners.has(e.uuid)||(this._onAfterRenderListeners.set(e.uuid,[]),e.onAfterRender=this._createRenderCallbackWrapper(e,this._onAfterRenderListeners)),(i=this._onAfterRenderListeners.get(e.uuid))==null||i.push(t)}removeAfterRenderListener(e,t){if(this._onAfterRenderListeners.has(e.uuid)){const i=this._onAfterRenderListeners.get(e.uuid),n=i.indexOf(t);n>=0&&i.splice(n,1)}}_createRenderCallbackWrapper(e,t){return(i,n,r,o,a,l)=>{const c=t.get(e.uuid);if(c)for(let h=0;h<c.length;h++){const u=c[h];u(i,n,r,o,a,l)}}}get isRendering(){return this._isRendering}setRequireDepth(e){this._requireDepthTexture=e}setRequireColor(e){this._requireColorTexture=e}get depthTexture(){var e;return((e=this._renderTarget)==null?void 0:e.depthTexture)||null}get opaqueColorTexture(){var e;return((e=this._renderTarget)==null?void 0:e.texture)||null}get isVisibleToUser(){if(this.isInXR)return!0;if(!this._isVisible)return!1;const e=getComputedStyle(this.domElement);return e.visibility!=="hidden"&&e.display!=="none"&&e.opacity!=="0"}async internalOnCreate(e){var a,l,c,h,u,f,p,m;const t=++this._createId;_s&&console.log("Creating context",this.name,e);const i=globalThis["needle:dependencies:ready"];i instanceof Promise&&(_s&&console.log("Waiting for dependencies to be ready"),await i.catch(v=>{if(_s||nt()){if(DM("Needle Engine dependencies failed to load. Please check the console for more details"),v instanceof ReferenceError){let g="YourComponentName";const y=v.message.indexOf("'");if(y>0){const A=v.message.indexOf("'",y+1);if(A>0){const _=v.message.substring(y+1,A);_.length>3&&(g=_)}}console.error(`Needle Engine dependencies failed to load:

# Make sure you don't have circular imports in your scripts!
 Possible solution: Replace @serializable(${g}) in your script with @serializable(Behaviour)

---`,v);return}console.error("Needle Engine dependencies failed to load",v)}}).then(()=>{_s&&console.log("Needle Engine dependencies are ready")})),this.clear(),this.isManagedExternally===!1&&(this.createNewRenderer(),(a=this.renderer)==null||a.setAnimationLoop(null)),await Nc(1),qi.Current=this,await mi.dispatchCallback(Ti.ContextCreationStart,this);let n=!0,r;try{qi.Current=this,e?r=await this.internalLoadInitialContent(t,e):r=[]}catch(v){console.error(v),n=!1}if(!n)return this.onError("Failed to load initial content"),!1;if(t!==this._createId||(l=e==null?void 0:e.abortSignal)!=null&&l.aborted)return!1;if(this.internalOnUpdateVisible(),!this.renderer)return _s&&console.warn("Context has no renderer (perhaps it was disconnected?",this.domElement.isConnected),!1;!this.isManagedExternally&&!this.domElement.shadowRoot&&this.domElement.prepend(this.renderer.domElement),qi.Current=this,qi.Current=this;for(let v=0;v<this.new_scripts.length;v++){const g=this.new_scripts[v];if(g.gameObject!==void 0&&g.gameObject!==null){g.gameObject.userData===void 0&&(g.gameObject.userData={}),g.gameObject.userData.components===void 0&&(g.gameObject.userData.components=[]);const y=g.gameObject.userData.components;y.includes(g)||y.push(g)}}if(this.post_setup_callbacks)for(let v=0;v<this.post_setup_callbacks.length;v++)qi.Current=this,await this.post_setup_callbacks[v](this);if(!this.mainCamera){qi.Current=this;let v=null;lm(this.scene,g=>{const y=g;if(y!=null&&y.isCamera){if(s_(y.gameObject),!y.activeAndEnabled)return;if(y.tag==="MainCamera")return v=y,!0;v=y}}),v?this.setCurrentCamera(v):!mi.dispatchCallback(Ti.MissingCamera,this,{files:r})&&!this.mainCamera&&!this.isManagedExternally&&console.warn("Missing camera in main scene",this)}if(this.input.bindEvents(),qi.Current=this,oE(this),this.physics.engine&&((c=this.physics.engine)==null||c.step(0),(h=this.physics.engine)==null||h.postStep()),!this.isManagedExternally&&this.composer&&this.mainCamera){const v=new kM(this.scene,this.mainCamera);this.renderer.setSize(this.domWidth,this.domHeight),this.composer.addPass(v),this.composer.setSize(this.domWidth,this.domHeight)}this._sizeChanged=!0,this._stats&&(this._stats.showPanel(0),this._stats.dom.style.position="absolute",(u=this.domElement.shadowRoot)==null||u.appendChild(this._stats.dom)),_s&&Y1(this.scene,!0),this.targetFrameRate===void 0?(_s&&console.warn("No target framerate set, using default",qi.DefaultTargetFrameRate),this.targetFrameRate=qi._defaultTargetFramerate):_s&&console.log("Target framerate set to",this.targetFrameRate),this._dispatchReadyAfterFrame=!0;const o=mi.dispatchCallback(Ti.ContextCreated,this,{files:r});return o&&("internalSetLoadingMessage"in this.domElement&&typeof this.domElement.internalSetLoadingMessage=="function"&&((f=this.domElement)==null||f.internalSetLoadingMessage("finish loading")),await o),(p=e==null?void 0:e.abortSignal)!=null&&p.aborted?!1:($l(this,Ti.ContextCreated),_s&&console.log("Context Created...",this.renderer,this.renderer.domElement),this._isCreating=!1,!this.isManagedExternally&&!((m=e==null?void 0:e.abortSignal)!=null&&m.aborted)&&this.restartRenderLoop(),!0)}async internalLoadInitialContent(e,t){var l,c,h,u;const i=new Array;if(t.files.length===0)return i;const n=[...t.files],r={name:"",progress:null,index:0,count:n.length},o=Gl(),a=0;for(let f=0;f<n.length;f++){if((l=t.abortSignal)!=null&&l.aborted){_s&&console.log("Aborting loading because of abort signal");break}if(e!==this._createId){_s&&console.log("Aborting loading because create id changed",e,this._createId);break}const p=n[f];(c=t==null?void 0:t.onLoadingStart)==null||c.call(this,f,p),_s&&console.log("Context Load "+p);const m=await o.loadSync(this,p,p,a,v=>{var g,y;(g=t.abortSignal)!=null&&g.aborted||(r.name=p,r.progress=v,r.index=f,r.count=n.length,(y=t.onLoadingProgress)==null||y.call(this,r))});(h=t==null?void 0:t.onLoadingFinished)==null||h.call(this,f,p,m??null),m?i.push({src:p,file:m}):console.warn("Could not load file: "+p)}if(e!==this._createId||(u=t.abortSignal)!=null&&u.aborted){for(const f of i)if(f&&f.file)for(const p of f.file.scenes)xa(p,!0,!0)}else for(const f of i)f&&f.file&&this.scene.add(f.file.scene);return i}restartRenderLoop(){return this.renderer?this._isCreating?(console.warn("Can not start render loop while creating context"),!1):(this.renderer.setAnimationLoop((e,t)=>{this.isManagedExternally||this.update(e,t)}),!0):(console.error("Can not start render loop without renderer"),!1)}update(e,t){if(t===void 0&&(t=null),nt()||_s||afe())try{performance.mark("update.start"),this.internalStep(e,t),this._renderlooperrors=0,performance.mark("update.end"),performance.measure("NE Frame","update.start","update.end")}catch(i){this._renderlooperrors+=1,(nt()||_s)&&(i instanceof Error||i instanceof TypeError)&&_n("Caught unhandled exception during render-loop - see console for details.",la.Error),console.error("Frame #"+this.time.frame+`
`,i),this._renderlooperrors>=3&&(console.warn("Stopping render loop due to error"),this.renderer.setAnimationLoop(null)),this.domElement.dispatchEvent(new CustomEvent("error",{detail:i}))}else this.internalStep(e,t)}updatePhysics(e){this.internalUpdatePhysics(e)}internalStep(e,t){this.internalOnBeforeRender(e,t)!==!1&&(this.internalOnRender(),this.internalOnAfterRender())}internalOnBeforeRender(e,t){var n;this.renderer.info.autoReset=!0;const i=t!==null&&this._xrFrame===null;if(this._xrFrame=t,i&&this.domElement.dispatchEvent(new CustomEvent("xr-session-started",{detail:{context:this,session:this.xrSession,frame:t}})),this._currentFrameEvent=-1,this.isManagedExternally===!1&&this.isInXR===!1&&this.targetFrameRate!==void 0){this._lastTimestamp===0&&(this._lastTimestamp=e),this._accumulatedTime+=(e-this._lastTimestamp)/1e3,this._lastTimestamp=e;let r=this.targetFrameRate;if(typeof r=="object"&&(r=r.value),this._accumulatedTime<1/(r+1))return!1;this._accumulatedTime=0}if((n=this._stats)==null||n.begin(),qi.Current=this,this.onHandlePaused())return!1;for(qi.Current=this,this.time.update(),Xpe&&console.log("FPS",this.time.smoothedFps.toFixed(0)),oE(this),a1(this.scene),e9(this),$l(this,-1);this._cameraStack.length>0&&(!this.mainCameraComponent||this.mainCameraComponent.destroyed);){this._cameraStack.splice(this._cameraStack.length-1,1);const r=this._cameraStack[this._cameraStack.length-1];this.setCurrentCamera(r)}if(this.pre_update_oneshot_callbacks){for(const r in this.pre_update_oneshot_callbacks)this.pre_update_oneshot_callbacks[r]();this.pre_update_oneshot_callbacks.length=0}if(this.pre_update_callbacks)for(const r in this.pre_update_callbacks)this.pre_update_callbacks[r]();this._currentFrameEvent=0;for(let r=0;r<this.scripts_earlyUpdate.length;r++){const o=this.scripts_earlyUpdate[r];o.activeAndEnabled&&o.earlyUpdate!==void 0&&(qi.Current=this,o.earlyUpdate())}if(this.executeCoroutines(0),$l(this,0),this.onHandlePaused())return!1;this._currentFrameEvent=1;for(let r=0;r<this.scripts_update.length;r++){const o=this.scripts_update[r];o.activeAndEnabled&&o.update!==void 0&&(qi.Current=this,o.update())}if(this.executeCoroutines(1),$l(this,1),this.onHandlePaused())return!1;this._currentFrameEvent=2;for(let r=0;r<this.scripts_lateUpdate.length;r++){const o=this.scripts_lateUpdate[r];o.activeAndEnabled&&o.lateUpdate!==void 0&&(qi.Current=this,o.lateUpdate())}if(this.executeCoroutines(2),$l(this,2),this.onHandlePaused()||(this.physicsSteps===void 0&&(this.physicsSteps=1),this.physics.engine&&this.physicsSteps>0&&this.internalUpdatePhysics(this.physicsSteps),this.onHandlePaused()))return!1;if(this.isVisibleToUser||this.runInBackground){this._currentFrameEvent=3;for(let r=0;r<this.scripts_onBeforeRender.length;r++){const o=this.scripts_onBeforeRender[r];o.activeAndEnabled&&o.onBeforeRender!==void 0&&(qi.Current=this,o.onBeforeRender(t))}if(this.executeCoroutines(3),$l(this,3),this._sizeChanged&&this.updateSize(),this.pre_render_callbacks)for(const r in this.pre_render_callbacks)this.pre_render_callbacks[r](t)}return!0}internalUpdatePhysics(e){if(!this.physics.engine)return!1;const t=e,i=this.time.deltaTime/t;for(let n=0;n<t;n++)this._currentFrameEvent=9,this.executeCoroutines(9),this.physics.engine.step(i),this._currentFrameEvent=10,this.executeCoroutines(10);return this.physics.engine.postStep(),!0}internalOnRender(){this.isManagedExternally||(ufe(this),this._currentFrameEvent=-1,this.renderNow(),this._currentFrameEvent=4)}internalOnAfterRender(){if(this.isVisibleToUser||this.runInBackground){for(let e=0;e<this.scripts_onAfterRender.length;e++){const t=this.scripts_onAfterRender[e];t.activeAndEnabled&&t.onAfterRender!==void 0&&(qi.Current=this,t.onAfterRender())}if(this.executeCoroutines(4),$l(this,4),this.post_render_callbacks)for(const e in this.post_render_callbacks)this.post_render_callbacks[e]()}this._currentFrameEvent=-1,this.connection.sendBufferedMessagesNow(),this._stats&&(this._stats.end(),this.time.frameCount%150===0&&console.log(this.renderer.info.render.calls+" DrawCalls",`
Render:`,{...this.renderer.info.render},`
Memory:`,{...this.renderer.info.memory},`
Target Framerate: `+this.targetFrameRate)),this._dispatchReadyAfterFrame&&(this._dispatchReadyAfterFrame=!1,this.domElement.dispatchEvent(new CustomEvent("ready")),mi.dispatchCallback(Ti.ContextFirstFrameRendered,this))}renderNow(e){return!e&&(e=this.mainCamera,!e)?!1:(this._isRendering=!0,this.renderRequiredTextures(),this.renderer.toneMapping!==po&&K9(),this.composer&&!this.isInXR?this.composer.render(this.time.deltaTime):e&&this.renderer.render(this.scene,e),this._isRendering=!1,!0)}onHandlePaused(){const e=this.evaluatePaused();if(this._wasPaused!==e){qpe&&console.log("Paused?",e,"context:"+this.alias);for(let t=0;t<this.scripts_pausedChanged.length;t++){const i=this.scripts_pausedChanged[t];i.activeAndEnabled&&i.onPausedChanged!==void 0&&(qi.Current=this,i.onPausedChanged(e,this._wasPaused))}}return this._wasPaused=e,e}evaluatePaused(){return this.isInXR?!1:this.isPaused?!0:this.runInBackground?!1:!this.isVisibleToUser}renderRequiredTextures(){if(!this.mainCamera||!this._requireDepthTexture&&!this._requireColorTexture)return;if(!this._renderTarget){if(this._renderTarget=new $t(this.domWidth,this.domHeight),this._requireDepthTexture){const i=new Av(this.domWidth,this.domHeight);this._renderTarget.depthTexture=i}this._requireColorTexture&&(this._renderTarget.texture=new Wt,this._renderTarget.texture.generateMipmaps=!1,this._renderTarget.texture.minFilter=Ot,this._renderTarget.texture.magFilter=Ot,this._renderTarget.texture.format=Li)}const e=this._renderTarget;e.texture&&(e.texture.colorSpace=this.renderer.outputColorSpace);const t=this.renderer.getRenderTarget();this.renderer.setRenderTarget(e),this.renderer.render(this.scene,this.mainCamera),this.renderer.setRenderTarget(t)}executeCoroutines(e){var i;if(this.coroutines[e]){const n=this.coroutines[e];for(let r=0;r<n.length;r++)try{const o=n[r];if(!o.comp||o.comp.destroyed||!o.main||o.comp.enabled===!1){Ype&&console.log("Removing coroutine",o.comp,o.comp.enabled),n.splice(r,1),--r;continue}const l=o.chained;if(l&&l.length>0){const f=l[l.length-1].next();if(f.done&&l.pop(),t(f)&&(o.chained||(o.chained=[]),o.chained.push(f.value)),!f.done)continue}const c=o.main.next();if(c.done===!0){n.splice(r,1),--r;continue}const h=c.value;if(t(h)){if(h.next().done)continue;o.chained||(o.chained=[]),o.chained.push(h)}else if(h instanceof Promise){const u=h;o.chained||(o.chained=[]);const f=U9(u);(i=o.chained)==null||i.push(f);continue}}catch(o){console.error(o)}}function t(n){return!!(n&&n.next&&n.return)}}};let Dt=qi;d(Dt,"_defaultTargetFramerate",{value:90,toString(){return this.value}}),d(Dt,"_defaultWebglRendererParameters",{antialias:!0,alpha:!1,powerPreference:Vd()||E6()?"default":"high-performance"});const Za=ie("debuglicense");let Gp="basic";Za&&console.log("License Type: "+Gp);function Bd(){switch(Gp){case"pro":case"enterprise":return!0}return!1}function iF(){switch(Gp){case"indie":return!0}return!1}function tu(){return Bd()||iF()}const e7=[];function Zpe(s){if(Bd()||iF())return s(!0);e7.push(s)}function $pe(s){for(const e of e7)try{e(s)}catch{}}mi.registerCallback(Ti.ContextRegistered,s=>{ime(s.context),sme(),tme(s.context)});let Dd,LD=!1,IA="";async function eme(){if(Dd)return Dd;if(Gp==="basic")try{const s="https://engine.needle.tools/licensing/check?location="+encodeURIComponent(window.location.href)+"&version="+tl+"&generator="+encodeURIComponent(OM),e=await fetch(s,{method:"GET"}).catch(t=>{Za&&console.error("License check failed",t)});(e==null?void 0:e.status)===200?(LD=!1,Za&&console.log("License check succeeded"),Gp="pro",$pe(!0)):(e==null?void 0:e.status)===403?(LD=!0,IA=await e.text()):Za&&console.log("License check failed with status "+(e==null?void 0:e.status))}catch(s){Za&&console.error("License check failed",s)}else Za&&console.log('Runtime license check is skipped because license is already applied as "'+Gp+'"')}Dd=eme();async function tme(s){function e(){const n=document.createElement("div");n.className="needle-forbidden",n.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: all;
        zIndex: 2147483647;
        line-height: 1.5;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        `;const r=n.style.cssText,o=document.createElement("div");n.appendChild(o),o.style.cssText=`
        position: absolute;
        left: 0;
        right: 0;
        top:0;
        bottom: 0;
        padding: 10%;
        color: white;
        font-size: 20px;
        font-family: sans-serif;
        text-align: center;
        pointer-events: all;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgba(0,0,0,.3);
        text-shadow: 0 0 2px black;
        `;const a=o.style.cssText,l=(IA==null?void 0:IA.length)>1?IA:"This web application has been paused.<br/>You might be in violation of the Needle Engine terms of use.<br/>Please contact the Needle support if you think this is a mistake.";return o.innerHTML=l,setInterval(()=>{o.innerHTML!==l&&(o.innerHTML=l),o.parentNode!==n&&n.appendChild(o),n.style.cssText!==r&&(n.style.cssText=r),o.style.cssText!==a&&(o.style.cssText=a)},500),n}let t=e();const i=t.style.cssText;setInterval(()=>{var n;LD===!0&&(t.style.cssText!==i&&(t=e()),s.domElement.shadowRoot?t.parentNode!==s.domElement.shadowRoot&&((n=s.domElement.shadowRoot)==null||n.appendChild(t)):t.parentNode!=document.body&&document.body.appendChild(t))},500)}async function ime(s){try{if(tu()!==!0)return cP(s)}catch(e){return Za&&console.log("License check failed",e),cP(s)}Za&&cP(s)}async function cP(s){s.domElement.addEventListener("ready",()=>!0),await(Dd==null?void 0:Dd.catch(()=>{})),!tu()&&nme()}let TG=0;async function nme(s){var o;const e=Date.now();if(e-TG<2e3)return;TG=e;const i=`
        position: relative;
        display: block;
        font-size: 18px;
        background-size: 20px;
        background-position: 10px 5px;
        background-repeat:no-repeat;
        background-image:url('data:image/webp;base64,UklGRrABAABXRUJQVlA4WAoAAAAQAAAAHwAAHwAAQUxQSKEAAAARN6CmbSM4WR7vdARON11EBDq3fLiNbVtVzpMCPlKAEzsx0Y/x+Ovuv4dn0EFE/ydAvz6YggXzgh5sVgXM/zOC/4sii7qgGvB5N7hmuQYwkvazWAu1JPW41FXSHq6pnaQWvqYH18Fc0j1hO/BFTtIeSBlJi5w6qIIO7IOrwhFsB2Yxukif0FTRLpXswHR8MxbslKe9VZsn/Ub5C7YFOpqSTABWUDgg6AAAAFAGAJ0BKiAAIAA+7VyoTqmkpCI3+qgBMB2JbACdMt69DwMIQBLhkTO6XwY00UEDK6cNIDnuNibPf0EgAP7Y1myuiQHLDsF/0h5unrGh6WAbv7aegg2ZMd3uRKfT/3SJztcaujYfTvMXspfCTmYcoO6a+vhC3ss4M8uM58t4siiu59I4aOl59e9Sr6xoxYlHf2v+NnBNpJYeJf8jABQAId/PXuBkLEFkiCucgSGEcfhvajql/j3reCGl0M5/9gQWy7ayNPs+wlvIxFnNfSlfuND4CZOCyxOHhRqOmHN4ULHo3tCSrUNvgAA=');
        background-max-size: 40px;
        margin-bottom: 5px;
        margin-top: .3em;
        margin-bottom: .5em;
        padding: .2em;
        padding-left: 25px;
        border-radius: .5em;
        border: 2px solid rgba(160,160,160,.3);
    `,r=`Needle Engine  No license active, commercial use is not allowed. Visit https://needle.tools/pricing for more information and licensing options! v${tl}`;(o=Dt.Current)!=null&&o.xr?console.log(r):console.log("%c "+r,i)}async function sme(){var s;try{const e="https://needle-engine-analytics-v2-r26roub2hq-lz.a.run.app";if(e){Za&&console.log("Analytics backend url",e);const t=window.location.href.split("?")[0];let i="api/v2/new/request";e.endsWith("/")||(i="/"+i);const n=Gp,r=`${e}${i}`;Za&&console.log("Sending non-commercial usage message to analytics backend",r);const o={license:n,url:t,hostname:window.location.hostname,pathname:window.location.pathname,version:tl,generator:OM,build_time:ok},a=(s=navigator.sendBeacon)==null?void 0:s.call(navigator,r,JSON.stringify(o));Za&&console.log("Send beacon result",a)}}catch(e){Za&&console.log("Failed to send non-commercial usage message to analytics backend",e)}}const mp=ie("debugloading"),H0=ie("debugloadingrendering"),IG=ie("debuglicense");class rme{constructor(){d(this,"className");d(this,"additionalClasses")}}let V0=0,RG;function nF(s){mp&&console.log(s.progress.loaded.toFixed(0)+"/"+s.progress.total.toFixed(0),s);const e=s.count,t=s.progress.total;t===0||t===void 0?(RG!==s.name&&(V0=0),RG=s.name,V0+=(1-V0)*.001,mp&&Fi("Loading "+s.name+" did not report total size")):V0=s.progress.loaded/t;const i=s.index/e+V0/e;return it.clamp01(i)}const OE=class{constructor(e,t){d(this,"loadingProgress",0);d(this,"_element");d(this,"_progress",0);d(this,"_allowCustomLoadingElement",!0);d(this,"_loadingElement");d(this,"_loadingTextContainer",null);d(this,"_loadingBar",null);d(this,"_messageContainer",null);d(this,"_loadingElementOptions");d(this,"_progressLoop");this._element=e,this._loadingElementOptions=t}async onLoadingBegin(e){const t=this._element.shadowRoot||this._element;if(mp&&console.warn("Begin Loading"),!this._loadingElement){for(let i=0;i<t.children.length;i++){const n=t.children[i];if(n.classList.contains(OE.LoadingContainerClassName)){if(!this._allowCustomLoadingElement){mp&&console.warn("Remove custom loading container"),t.removeChild(n);continue}this._loadingElement=this.createLoadingElement(n)}}this._loadingElement||(this._loadingElement=this.createLoadingElement())}this._progress=0,this.loadingProgress=0,this._loadingElement.style.display="flex",t.appendChild(this._loadingElement),this.smoothProgressLoop(),this.setMessage(e??"")}onLoadingUpdate(e,t){var n;if(!((n=this._loadingElement)!=null&&n.parentNode))return;let i=0;typeof e=="number"?i=e:("index"in e&&(i=nF(e)),!t&&"name"in e&&this.setMessage("loading "+e.name)),this.loadingProgress=i,t&&this.setMessage(t),this.updateDisplay()}onLoadingFinished(){mp&&console.warn("Finished Loading"),H0||(this.loadingProgress=1,this.onDoneLoading())}setMessage(e){this._messageContainer&&(this._messageContainer.innerText=e)}smoothProgressLoop(){if(this._progressLoop)return;let e=1/12;H0&&(e=1/500,typeof H0=="number"&&(e*=H0)),this._progressLoop=setInterval(()=>{this.loadingProgress>=.95&&!H0&&(e=.9),this._progress=it.lerp(this._progress,this.loadingProgress,e*this.loadingProgress),this.updateDisplay()},e)}onDoneLoading(){this._loadingElement&&(mp&&console.log("Hiding loading element"),this._loadingElement.style.display="none",this._loadingElement.remove()),this._progressLoop&&clearInterval(this._progressLoop),this._progressLoop=null}updateDisplay(){const e=this._progress,t=(e*100).toFixed(0)+"%";this._loadingBar&&(this._loadingBar.style.width=e*100+"%"),this._loadingTextContainer&&(this._loadingTextContainer.textContent=t)}createLoadingElement(e){var m,v;mp&&!e&&console.log("Creating loading element"),this._loadingElement=e||document.createElement("div");let t=this._element.getAttribute("loading-style");(!t||t==="auto")&&(window.matchMedia("(prefers-color-scheme: dark)").matches?t="dark":t="light");const i=Bd();if(!e&&(this._loadingElement.style.position="absolute",this._loadingElement.style.width="100%",this._loadingElement.style.height="100%",this._loadingElement.style.left="0",this._loadingElement.style.top="0",t==="light"?this._loadingElement.style.backgroundColor="#ddd":this._loadingElement.style.backgroundColor="#222",this._loadingElement.style.display="flex",this._loadingElement.style.alignItems="center",this._loadingElement.style.justifyContent="center",this._loadingElement.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),this._loadingElement.style.flexDirection="column",this._loadingElement.style.pointerEvents="none",this._loadingElement.style.color="white",this._loadingElement.style.fontFamily='system-ui, Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',this._loadingElement.style.fontSize="1rem",t==="light"?this._loadingElement.style.color="rgba(0,0,0,.6)":this._loadingElement.style.color="rgba(255,255,255,.3)",i&&this._element)){const g=this._element.getAttribute("loading-background-color");g&&(this._loadingElement.style.backgroundColor=g);const y=this._element.getAttribute("loading-text-color");y&&(this._loadingElement.style.color=y)}const n=((m=this._loadingElementOptions)==null?void 0:m.className)??OE.LoadingContainerClassName;if(this._loadingElement.classList.add(n),(v=this._loadingElementOptions)!=null&&v.additionalClasses)for(const g of this._loadingElementOptions.additionalClasses)this._loadingElement.classList.add(g);const r=document.createElement("div");this._loadingElement.appendChild(r);const o=document.createElement("img"),a=120;o.style.width=`${a}px`,o.style.height=`${a}px`,o.style.paddingTop="20px",o.style.paddingBottom="10px",o.style.margin="0px",o.style.userSelect="none",o.style.objectFit="contain",o.style.transition="transform 1.5s ease-out, opacity .3s ease-in-out",o.style.transform="translateY(30px)",o.style.opacity="0.05",setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0px)"},1),o.src=Toe;let l=!1;if(i&&this._element){const g=this._element.getAttribute("loading-logo-src");g&&(l=!0,o.src=g)}l||(o.style.cursor="pointer",o.style.pointerEvents="all",o.addEventListener("click",()=>window.open("https://needle.tools","_blank"))),r.appendChild(o);const c=document.createElement("div");c.style.cssText=`
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out 4s;
        `,setTimeout(()=>{c.style.opacity="1"},1),this._loadingElement.appendChild(c);const h=document.createElement("div"),u=100;h.style.display="flex",h.style.width=u+"%",h.style.height="3px",h.style.position="absolute",h.style.left="0",h.style.bottom="0px",h.style.opacity="0",h.style.transition="opacity 1s ease-in-out 2s",setTimeout(()=>{h.style.opacity="1"},1),t==="light"?h.style.backgroundColor="rgba(0,0,0,.2)":h.style.backgroundColor="rgba(255,255,255,.2)",this._loadingElement.appendChild(h),this._loadingBar=document.createElement("div"),h.appendChild(this._loadingBar);const f=function(g){return it.lerp(0,u,g)+"%"};if(this._loadingBar.style.background=`linear-gradient(90deg, #204f49 ${f(0)}, #0BA398 ${f(.3)}, #66A22F ${f(.6)}, #D7DB0A ${f(1)})`,this._loadingBar.style.backgroundAttachment="fixed",this._loadingBar.style.width="0%",this._loadingBar.style.height="100%",i&&this._element){const g=this._element.getAttribute("primary-color"),y=this._element.getAttribute("secondary-color");g&&y?this._loadingBar.style.background=`linear-gradient(90deg, ${g} ${f(0)}, ${y} ${f(1)})`:g?this._loadingBar.style.background=g:y&&(this._loadingBar.style.background=y)}this._loadingTextContainer=document.createElement("div"),this._loadingTextContainer.style.display="flex",this._loadingTextContainer.style.justifyContent="center",this._loadingTextContainer.style.marginTop=".2rem",c.appendChild(this._loadingTextContainer);const p=document.createElement("div");if(this._messageContainer=p,p.style.display="flex",p.style.fontSize=".8rem",p.style.paddingTop=".1rem",p.style.justifyContent="center",c.appendChild(p),i&&this._element){const g=this._element.getAttribute("loading-text-color");g&&(p.style.color=g)}return this.handleRuntimeLicense(this._loadingElement),this._loadingElement}async handleRuntimeLicense(e){let t=tu();if(t)return;IG&&console.log("Loading UI has commercial license?",t);const i=document.createElement("div");i.style.paddingTop=".6em",i.style.fontSize=".8em",i.style.textTransform="uppercase",i.innerText=`NEEDLE ENGINE NON COMMERCIAL VERSION
CLICK HERE TO GET A LICENSE`,i.style.cursor="pointer",i.style.userSelect="none",i.style.textAlign="center",i.style.pointerEvents="all",i.addEventListener("click",()=>window.open("https://needle.tools/pricing","_self")),i.style.opacity="0",e.appendChild(i),!nt()&&Dd&&(IG&&console.log("Waiting for runtime license check"),await Dd,t=tu()),!t&&(i.style.transition="opacity .5s ease-in-out",i.style.opacity="1")}};let a_=OE;d(a_,"LoadingContainerClassName","loading");const Q0=ie("debugoverlay"),t7="ar",ome="quit-ar";class ame{constructor(){d(this,"arContainer",null);d(this,"currentSession",null);d(this,"_createdAROnlyElements",[]);d(this,"_reparentedObjects",[]);d(this,"contentElement",null);d(this,"originalDomOverlayParent",null);d(this,"requestEndAR",()=>{this.onRequestedEndAR()})}get ARContainer(){return this.arContainer}onBegin(e,t,i){var n;if(this.currentSession=i,this.arContainer=t,Dp()){const r=e.domElement.children;for(let o=0;o<(r==null?void 0:r.length);o++){const a=r[o];if(!a||a===this.arContainer)return;this._reparentedObjects.push({el:a,previousParent:a.parentElement}),(n=this.arContainer)==null||n.appendChild(a)}t?(this.originalDomOverlayParent=t.parentNode,this.originalDomOverlayParent&&(console.log("Reparent DOM Overlay to body",t,t.style.display),t.style.display="",t.style.visibility="",document.body.appendChild(t))):console.warn("WebXRViewer: No DOM Overlay found")}this.ensureQuitARButton(this.arContainer)}onEnd(e){var t;for(const i of this._createdAROnlyElements)i.remove&&i.remove();for(const i of this._reparentedObjects){const n=i.el;(t=i.previousParent)==null||t.appendChild(n)}this._reparentedObjects.length=0,Dp()&&setTimeout(()=>{var o;const i=e.renderer.domElement;i&&((o=e.domElement.shadowRoot)==null||o.prepend(i));const n=document.querySelectorAll("*");for(var r=0;r<n.length;r++){const a=n[r];a&&a._displayChanged!==void 0&&a._displayWas!==void 0&&(a.style.display=a._displayWas)}},10)}createOverlayContainer(e){if(this.contentElement)return this.contentElement;Q0&&console.log("Setup overlay container");const t=e.shadowRoot.querySelector(".content");this.contentElement=t;const i=e.shadowRoot.querySelector(".overlay-content");return i&&t.appendChild(i),Q0&&!Wc()&&this.ensureQuitARButton(t),t}onRequestedEndAR(){this.currentSession&&(this.currentSession.end(),this.currentSession=null)}ensureQuitARButton(e){const t=document.createElement("slot");t.setAttribute("name","quit-ar"),this.appendElement(t,e),this._createdAROnlyElements.push(t),t.style.pointerEvents="auto";const i=document.querySelector(`.${ome}`);if(i){i.addEventListener("click",this.requestEndAR),Q0&&i.addEventListener("click",()=>console.log("Clicked quit-ar button"));return}t.addEventListener("click",this.requestEndAR),Q0&&t.addEventListener("click",()=>console.log("Clicked fallback close button"));const n=document.createElement("div");n.style.cssText=`
            position: fixed;
            top: 0;
            right: 0;
            z-index: 600;
            pointer-events: all;
        `,this.appendElement(n,t);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.classList.add("quit-ar-button"),r.setAttribute("width","38px"),r.setAttribute("height","38px"),r.style.cssText=`
            background: radial-gradient(circle, rgba(0,0,0,.05) 70%, rgba(0,0,0,0) 100%);
            border-radius: 50%;
        `,n.appendChild(r);var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),o.setAttribute("stroke","#fff"),o.setAttribute("stroke-width","3px"),o.style.cssText=`
            filter: drop-shadow(0 0px 1.2px rgba(0,0,0,.7));
        `,r.appendChild(o),Q0&&console.log("Created fallback close button",r,e)}appendElement(e,t){return t.shadowRoot?t.shadowRoot.appendChild(e):t.appendChild(e)}}const nT=ie("debugdecoders");let hP="https://www.gstatic.com/draco/versioned/decoders/1.5.7/";fetch(hP+"draco_decoder.js",{method:"head"}).catch(s=>{nt()&&console.warn('Failed to load draco decoder from "'+hP+`".
Falling back to local version at "./include/draco"`),hP="./include/draco/"});let uP,dP=null;function sT(){if(!dP){const s=UW(null);dP={dracoLoader:s.dracoLoader,ktx2Loader:s.ktx2Loader,meshoptDecoder:s.meshoptDecoder}}return dP}function PG(s){if(s!==void 0&&typeof s=="string"){const e=sT();nT&&console.log("Setting draco decoder path to",s),e.dracoLoader.setDecoderPath(s),wue(s)}}function BG(s){if(s!==void 0&&typeof s=="string"){const e=sT();nT&&console.log("Setting draco decoder type to",s),e.dracoLoader.setDecoderConfig({type:s})}}function DG(s){if(s!==void 0&&typeof s=="string"){const e=sT();nT&&console.log("Setting ktx2 transcoder path to",s),e.ktx2Loader.setTranscoderPath(s),Sue(s)}}function rT(s,e){const t=sT();return uP||(uP=t.meshoptDecoder,nT&&console.log("Using the default meshopt decoder")),e.renderer?t.ktx2Loader.detectSupport(e.renderer):console.warn("No renderer provided to detect ktx2 support - loading KTX2 textures will probably fail"),s.dracoLoader||s.setDRACOLoader(t.dracoLoader),s.ktx2Loader||s.setKTX2Loader(t.ktx2Loader),s.meshoptDecoder||s.setMeshoptDecoder(uP),s}function i7(s,e,t){const i=t.length-s-1;if(e>=t[i])return i-1;if(e<=t[s])return s;let n=s,r=i,o=Math.floor((n+r)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?r=o:n=o,o=Math.floor((n+r)/2);return o}function lme(s,e,t,i){const n=[],r=[],o=[];n[0]=1;for(let a=1;a<=t;++a){r[a]=e-i[s+1-a],o[a]=i[s+a]-e;let l=0;for(let c=0;c<a;++c){const h=o[c+1],u=r[a-c],f=n[c]/(h+u);n[c]=l+h*f,l=u*f}n[a]=l}return n}function cme(s,e,t,i){const n=i7(s,i,e),r=lme(n,i,s,e),o=new Je(0,0,0,0);for(let a=0;a<=s;++a){const l=t[n-s+a],c=r[a],h=l.w*c;o.x+=l.x*h,o.y+=l.y*h,o.z+=l.z*h,o.w+=l.w*c}return o}function hme(s,e,t,i,n){const r=[];for(let u=0;u<=t;++u)r[u]=0;const o=[];for(let u=0;u<=i;++u)o[u]=r.slice(0);const a=[];for(let u=0;u<=t;++u)a[u]=r.slice(0);a[0][0]=1;const l=r.slice(0),c=r.slice(0);for(let u=1;u<=t;++u){l[u]=e-n[s+1-u],c[u]=n[s+u]-e;let f=0;for(let p=0;p<u;++p){const m=c[p+1],v=l[u-p];a[u][p]=m+v;const g=a[p][u-1]/a[u][p];a[p][u]=f+m*g,f=v*g}a[u][u]=f}for(let u=0;u<=t;++u)o[0][u]=a[u][t];for(let u=0;u<=t;++u){let f=0,p=1;const m=[];for(let v=0;v<=t;++v)m[v]=r.slice(0);m[0][0]=1;for(let v=1;v<=i;++v){let g=0;const y=u-v,A=t-v;u>=v&&(m[p][0]=m[f][0]/a[A+1][y],g=m[p][0]*a[y][A]);const _=y>=-1?1:-y,b=u-1<=A?v-1:t-u;for(let E=_;E<=b;++E)m[p][E]=(m[f][E]-m[f][E-1])/a[A+1][y+E],g+=m[p][E]*a[y+E][A];u<=A&&(m[p][v]=-m[f][v-1]/a[A+1][u],g+=m[p][v]*a[u][A]),o[v][u]=g;const x=f;f=p,p=x}}let h=t;for(let u=1;u<=i;++u){for(let f=0;f<=t;++f)o[u][f]*=h;h*=t-u}return o}function ume(s,e,t,i,n){const r=n<s?n:s,o=[],a=i7(s,i,e),l=hme(a,i,s,r,e),c=[];for(let h=0;h<t.length;++h){const u=t[h].clone(),f=u.w;u.x*=f,u.y*=f,u.z*=f,c[h]=u}for(let h=0;h<=r;++h){const u=c[a-s].clone().multiplyScalar(l[h][0]);for(let f=1;f<=s;++f)u.add(c[a-s+f].clone().multiplyScalar(l[h][f]));o[h]=u}for(let h=r+1;h<=n+1;++h)o[h]=new Je(0,0,0);return o}function dme(s,e){let t=1;for(let n=2;n<=s;++n)t*=n;let i=1;for(let n=2;n<=e;++n)i*=n;for(let n=2;n<=s-e;++n)i*=n;return t/i}function fme(s){const e=s.length,t=[],i=[];for(let r=0;r<e;++r){const o=s[r];t[r]=new S(o.x,o.y,o.z),i[r]=o.w}const n=[];for(let r=0;r<e;++r){const o=t[r].clone();for(let a=1;a<=r;++a)o.sub(n[r-a].clone().multiplyScalar(dme(r,a)*i[a]));n[r]=o.divideScalar(i[0])}return n}function pme(s,e,t,i,n){const r=ume(s,e,t,i,n);return fme(r)}class mme extends ll{constructor(e,t,i,n,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<i.length;++o){const a=i[o];this.controlPoints[o]=new Je(a.x,a.y,a.z,a.w)}}getPoint(e,t=new S){const i=t,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=cme(this.degree,this.knots,this.controlPoints,n);return r.w!==1&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(e,t=new S){const i=t,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=pme(this.degree,this.knots,this.controlPoints,n,1);return i.copy(r[1]).normalize(),i}}let ri,Kn,ao;class n7 extends ds{constructor(e){super(e)}load(e,t,i,n){const r=this,o=r.path===""?Jh.extractUrlBase(e):r.path,a=new yr(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(l){try{t(r.parse(l,o))}catch(c){n?n(c):console.error(c),r.manager.itemError(e)}},i,n)}parse(e,t){if(bme(e))ri=new _me().parse(e);else{const n=a7(e);if(!xme(n))throw new Error("THREE.FBXLoader: Unknown format.");if(LG(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+LG(n));ri=new Ame().parse(n)}const i=new Bc(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new gme(i,this.manager).parse(ri)}}class gme{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Kn=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),n=this.parseDeformers(),r=new yme().parse(n);return this.parseScene(n,r,i),ao}parseConnections(){const e=new Map;return"Connections"in ri&&ri.Connections.connections.forEach(function(i){const n=i[0],r=i[1],o=i[2];e.has(n)||e.set(n,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(n).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:n,relationship:o};e.get(r).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in ri.Objects){const i=ri.Objects.Video;for(const n in i){const r=i[n],o=parseInt(n);if(e[o]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){const c=this.parseImage(i[n]);t[r.RelativeFilename||r.Filename]=c}}}}for(const i in e){const n=e[i];t[n]!==void 0?e[i]=t[n]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();let r;switch(n){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+n+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in ri.Objects){const i=ri.Objects.Texture;for(const n in i){const r=this.parseTexture(i[n],e);t.set(parseInt(n),r)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const n=e.WrapModeU,r=e.WrapModeV,o=n!==void 0?n.value:0,a=r!==void 0?r.value:0;if(i.wrapS=o===0?Uo:as,i.wrapT=a===0?Uo:as,"Scaling"in e){const l=e.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;i.offset.x=l[0],i.offset.y=l[1]}return i}loadTexture(e,t){let i;const n=this.textureLoader.path,r=Kn.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(i=t[r[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new Wt):(l.setPath(this.textureLoader.path),o=l.load(i))}else if(a==="dds"){const l=this.manager.getHandler(".dds");l===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),o=new Wt):(l.setPath(this.textureLoader.path),o=l.load(i))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new Wt):o=this.textureLoader.load(i);return this.textureLoader.setPath(n),o}parseMaterials(e){const t=new Map;if("Material"in ri.Objects){const i=ri.Objects.Material;for(const n in i){const r=this.parseMaterial(i[n],e);r!==null&&t.set(parseInt(n),r)}}return t}parseMaterial(e,t){const i=e.id,n=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!Kn.has(i))return null;const o=this.parseParameters(e,t,i);let a;switch(r.toLowerCase()){case"phong":a=new By;break;case"lambert":a=new hL;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new By;break}return a.setValues(o),a.name=n,a}parseParameters(e,t,i){const n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=new Ae().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(n.color=new Ae().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=new Ae().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(n.emissive=new Ae().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=new Ae().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(n.specular=new Ae().fromArray(e.SpecularColor.value).convertSRGBToLinear());const r=this;return Kn.get(i).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":n.bumpMap=r.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":n.aoMap=r.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=r.getTexture(t,o.ID),n.map!==void 0&&(n.map.colorSpace=bt);break;case"DisplacementColor":n.displacementMap=r.getTexture(t,o.ID);break;case"EmissiveColor":n.emissiveMap=r.getTexture(t,o.ID),n.emissiveMap!==void 0&&(n.emissiveMap.colorSpace=bt);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=r.getTexture(t,o.ID);break;case"ReflectionColor":n.envMap=r.getTexture(t,o.ID),n.envMap!==void 0&&(n.envMap.mapping=mo,n.envMap.colorSpace=bt);break;case"SpecularColor":n.specularMap=r.getTexture(t,o.ID),n.specularMap!==void 0&&(n.specularMap.colorSpace=bt);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=r.getTexture(t,o.ID),n.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),n}getTexture(e,t){return"LayeredTexture"in ri.Objects&&t in ri.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Kn.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in ri.Objects){const i=ri.Objects.Deformer;for(const n in i){const r=i[n],o=Kn.get(parseInt(n));if(r.attrType==="Skin"){const a=this.parseSkeleton(o,i);a.ID=n,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[n]=a}else if(r.attrType==="BlendShape"){const a={id:n};a.rawTargets=this.parseMorphTargets(o,i),a.id=n,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(n){const r=t[n.ID];if(r.attrType!=="Cluster")return;const o={ID:n.ID,indices:[],weights:[],transformLink:new le().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let n=0;n<e.children.length;n++){const r=e.children[n],o=t[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=Kn.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,i.push(a)}return i}parseScene(e,t,i){ao=new Vs;const n=this.parseModels(e.skeletons,t,i),r=ri.Objects.Model,o=this;n.forEach(function(l){var u;const c=r[l.ID];o.setLookAtProperties(l,c);const h=(u=Kn.get(l.ID))==null?void 0:u.parents;h==null||h.forEach(function(f){const p=n.get(f.ID);p!==void 0&&p.add(l)}),l.parent===null&&ao.add(l)}),this.bindSkeleton(e.skeletons,t,n),this.addGlobalSceneSettings(),ao.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=r7(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new vme().parse();ao.children.length===1&&ao.children[0].isGroup&&(ao.children[0].animations=a,ao=ao.children[0]),ao.animations=a}parseModels(e,t,i){const n=new Map,r=ri.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],c=Kn.get(a);let h=this.buildSkeleton(c,e,a,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,i);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new em;break;case"Null":default:h=new Vs;break}h.name=l.attrName?Zt.sanitizeNodeName(l.attrName):"",h.userData.originalName=l.attrName,h.ID=a}this.getTransformData(h,l),n.set(a,h)}return n}buildSkeleton(e,t,i,n){let r=null;return e==null||e.parents.forEach(function(o){for(const a in t){const l=t[a];l.rawBones.forEach(function(c,h){if(c.ID===o.ID){const u=r;r=new em,r.matrixWorld.copy(c.transformLink),r.name=n?Zt.sanitizeNodeName(n):"",r.userData.originalName=n,r.ID=i,l.bones[h]=r,u!==null&&r.add(u)}})}}),r}createCamera(e){let t,i;if(e.children.forEach(function(n){const r=ri.Objects.NodeAttribute[n.ID];r!==void 0&&(i=r)}),i===void 0)t=new ye;else{let n=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(n=1);let r=1;i.NearPlane!==void 0&&(r=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(a=i.AspectWidth.value,l=i.AspectHeight.value);const c=a/l;let h=45;i.FieldOfView!==void 0&&(h=i.FieldOfView.value);const u=i.FocalLength?i.FocalLength.value:null;switch(n){case 0:t=new Vt(h,c,r,o),u!==null&&t.setFocalLength(u);break;case 1:t=new Qc(-a/2,a/2,l/2,-l/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+n+"."),t=new ye;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(n){const r=ri.Objects.NodeAttribute[n.ID];r!==void 0&&(i=r)}),i===void 0)t=new ye;else{let n;i.LightType===void 0?n=0:n=i.LightType.value;let r=16777215;i.Color!==void 0&&(r=new Ae().fromArray(i.Color.value).convertSRGBToLinear());let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let a=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?a=0:a=i.FarAttenuationEnd.value);const l=1;switch(n){case 0:t=new im(r,o,a,l);break;case 1:t=new nm(r,o);break;case 2:let c=Math.PI/3;i.InnerAngle!==void 0&&(c=gi.degToRad(i.InnerAngle.value));let h=0;i.OuterAngle!==void 0&&(h=gi.degToRad(i.OuterAngle.value),h=Math.max(h,1)),t=new Lb(r,o,a,c,h,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new im(r,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let n,r=null,o=null;const a=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),i.has(l.ID)&&a.push(i.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new By({name:ds.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(n=new Fo(r,o),n.normalizeSkinWeights()):n=new fe(r,o),n}createCurve(e,t){const i=e.children.reduce(function(r,o){return t.has(o.ID)&&(r=t.get(o.ID)),r},null),n=new ji({name:ds.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new An(i,n)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=o7(t.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&Kn.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const r=ri.Objects.Model[n.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),ao.add(e.target)):e.lookAt(new S().fromArray(o))}}})}bindSkeleton(e,t,i){const n=this.parsePoseNodes();for(const r in e){const o=e[r];Kn.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;Kn.get(c).parents.forEach(function(u){i.has(u.ID)&&i.get(u.ID).bind(new Bb(o.bones),n[u.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in ri.Objects){const t=ri.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const n=t[i].PoseNode;Array.isArray(n)?n.forEach(function(r){e[r.Node]=new le().fromArray(r.Matrix.a)}):e[n.Node]=new le().fromArray(n.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in ri){if("AmbientColor"in ri.GlobalSettings){const e=ri.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],n=e[2];if(t!==0||i!==0||n!==0){const r=new Ae(t,i,n).convertSRGBToLinear();ao.add(new AM(r,1))}}"UnitScaleFactor"in ri.GlobalSettings&&(ao.userData.unitScaleFactor=ri.GlobalSettings.UnitScaleFactor.value)}}}class yme{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in ri.Objects){const i=ri.Objects.Geometry;for(const n in i){const r=Kn.get(parseInt(n)),o=this.parseGeometry(r,i[n],e);t.set(parseInt(n),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const n=i.skeletons,r=[],o=e.parents.map(function(u){return ri.Objects.Model[u.ID]});if(o.length===0)return;const a=e.children.reduce(function(u,f){return n[f.ID]!==void 0&&(u=n[f.ID]),u},null);e.children.forEach(function(u){i.morphTargets[u.ID]!==void 0&&r.push(i.morphTargets[u.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=o7(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=r7(c);return this.genGeometry(t,a,r,h)}genGeometry(e,t,i,n){const r=new yt;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new rt(a.vertex,3);if(l.applyMatrix4(n),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new rt(a.colors,3)),t&&(r.setAttribute("skinIndex",new ZE(a.weightsIndices,4)),r.setAttribute("skinWeight",new rt(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const c=new Ut().getNormalMatrix(n),h=new rt(a.normal,3);h.applyNormalMatrix(c),r.setAttribute("normal",h)}if(a.uvs.forEach(function(c,h){const u=h===0?"uv":`uv${h}`;r.setAttribute(u,new rt(a.uvs[h],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(u,f){u!==c&&(r.addGroup(h,f-h,c),c=u,h=f)}),r.groups.length>0){const u=r.groups[r.groups.length-1],f=u.start+u.count;f!==a.materialIndex.length&&r.addGroup(f,a.materialIndex.length-f,c)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,i,n),r}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let n=0;for(;e.LayerElementUV[n];)e.LayerElementUV[n].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(n,r){n.indices.forEach(function(o,a){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:r,weight:n.weights[a]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,n=0,r=!1,o=[],a=[],l=[],c=[],h=[],u=[];const f=this;return e.vertexIndices.forEach(function(p,m){let v,g=!1;p<0&&(p=p^-1,g=!0);let y=[],A=[];if(o.push(p*3,p*3+1,p*3+2),e.color){const _=PS(m,i,p,e.color);l.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(_){A.push(_.weight),y.push(_.id)}),A.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const _=[0,0,0,0],b=[0,0,0,0];A.forEach(function(x,E){let M=x,T=y[E];b.forEach(function(R,w,I){if(M>R){I[w]=M,M=R;const O=_[w];_[w]=T,T=O}})}),y=_,A=b}for(;A.length<4;)A.push(0),y.push(0);for(let _=0;_<4;++_)h.push(A[_]),u.push(y[_])}if(e.normal){const _=PS(m,i,p,e.normal);a.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(v=PS(m,i,p,e.material)[0],v<0&&(f.negativeMaterialIndices=!0,v=0)),e.uv&&e.uv.forEach(function(_,b){const x=PS(m,i,p,_);c[b]===void 0&&(c[b]=[]),c[b].push(x[0]),c[b].push(x[1])}),n++,g&&(f.genFace(t,e,o,v,a,l,c,h,u,n),i++,n=0,o=[],a=[],l=[],c=[],h=[],u=[])}),t}getNormalNewell(e){const t=new S(0,0,0);for(let i=0;i<e.length;i++){const n=e[i],r=e[(i+1)%e.length];t.x+=(n.y-r.y)*(n.z+r.z),t.y+=(n.z-r.z)*(n.x+r.x),t.z+=(n.x-r.x)*(n.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),n=(Math.abs(t.z)>.5?new S(0,1,0):new S(0,0,1)).cross(t).normalize(),r=t.clone().cross(n).normalize();return{normal:t,tangent:n,bitangent:r}}flattenVertex(e,t,i){return new ee(e.dot(t),e.dot(i))}genFace(e,t,i,n,r,o,a,l,c,h){let u;if(h>3){const f=[];for(let g=0;g<i.length;g+=3)f.push(new S(t.vertexPositions[i[g]],t.vertexPositions[i[g+1]],t.vertexPositions[i[g+2]]));const{tangent:p,bitangent:m}=this.getNormalTangentAndBitangent(f),v=[];for(const g of f)v.push(this.flattenVertex(g,p,m));u=kl.triangulateShape(v,[])}else u=[[0,1,2]];for(const[f,p,m]of u)e.vertex.push(t.vertexPositions[i[f*3]]),e.vertex.push(t.vertexPositions[i[f*3+1]]),e.vertex.push(t.vertexPositions[i[f*3+2]]),e.vertex.push(t.vertexPositions[i[p*3]]),e.vertex.push(t.vertexPositions[i[p*3+1]]),e.vertex.push(t.vertexPositions[i[p*3+2]]),e.vertex.push(t.vertexPositions[i[m*3]]),e.vertex.push(t.vertexPositions[i[m*3+1]]),e.vertex.push(t.vertexPositions[i[m*3+2]]),t.skeleton&&(e.vertexWeights.push(l[f*4]),e.vertexWeights.push(l[f*4+1]),e.vertexWeights.push(l[f*4+2]),e.vertexWeights.push(l[f*4+3]),e.vertexWeights.push(l[p*4]),e.vertexWeights.push(l[p*4+1]),e.vertexWeights.push(l[p*4+2]),e.vertexWeights.push(l[p*4+3]),e.vertexWeights.push(l[m*4]),e.vertexWeights.push(l[m*4+1]),e.vertexWeights.push(l[m*4+2]),e.vertexWeights.push(l[m*4+3]),e.weightsIndices.push(c[f*4]),e.weightsIndices.push(c[f*4+1]),e.weightsIndices.push(c[f*4+2]),e.weightsIndices.push(c[f*4+3]),e.weightsIndices.push(c[p*4]),e.weightsIndices.push(c[p*4+1]),e.weightsIndices.push(c[p*4+2]),e.weightsIndices.push(c[p*4+3]),e.weightsIndices.push(c[m*4]),e.weightsIndices.push(c[m*4+1]),e.weightsIndices.push(c[m*4+2]),e.weightsIndices.push(c[m*4+3])),t.color&&(e.colors.push(o[f*3]),e.colors.push(o[f*3+1]),e.colors.push(o[f*3+2]),e.colors.push(o[p*3]),e.colors.push(o[p*3+1]),e.colors.push(o[p*3+2]),e.colors.push(o[m*3]),e.colors.push(o[m*3+1]),e.colors.push(o[m*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(r[f*3]),e.normal.push(r[f*3+1]),e.normal.push(r[f*3+2]),e.normal.push(r[p*3]),e.normal.push(r[p*3+1]),e.normal.push(r[p*3+2]),e.normal.push(r[m*3]),e.normal.push(r[m*3+1]),e.normal.push(r[m*3+2])),t.uv&&t.uv.forEach(function(v,g){e.uvs[g]===void 0&&(e.uvs[g]=[]),e.uvs[g].push(a[g][f*2]),e.uvs[g].push(a[g][f*2+1]),e.uvs[g].push(a[g][p*2]),e.uvs[g].push(a[g][p*2+1]),e.uvs[g].push(a[g][m*2]),e.uvs[g].push(a[g][m*2+1])})}addMorphTargets(e,t,i,n){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;i.forEach(function(o){o.rawTargets.forEach(function(a){const l=ri.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,n,a.name)})})}genMorphGeometry(e,t,i,n,r){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=i.Vertices!==void 0?i.Vertices.a:[],l=i.Indexes!==void 0?i.Indexes.a:[],c=e.attributes.position.count*3,h=new Float32Array(c);for(let m=0;m<l.length;m++){const v=l[m]*3;h[v]=a[m*3],h[v+1]=a[m*3+1],h[v+2]=a[m*3+2]}const u={vertexIndices:o,vertexPositions:h},f=this.genBuffers(u),p=new rt(f.vertex,3);p.name=r||i.attrName,p.applyMatrix4(n),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Normals.a;let r=[];return i==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:r,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.UV.a;let r=[];return i==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:n,indices:r,mappingType:t,referenceType:i}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Colors.a;let r=[];i==="IndexToDirect"&&(r=e.ColorIndex.a);for(let o=0,a=new Ae;o<n.length;o+=4)a.fromArray(n,o).convertSRGBToLinear().toArray(n,o);return{dataSize:4,buffer:n,indices:r,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const n=e.Materials.a,r=[];for(let o=0;o<n.length;++o)r.push(o);return{dataSize:1,buffer:n,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new yt;const i=t-1,n=e.KnotVector.a,r=[],o=e.Points.a;for(let u=0,f=o.length;u<f;u+=4)r.push(new Je().fromArray(o,u));let a,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=i,l=n.length-1-a;for(let u=0;u<i;++u)r.push(r[u])}const h=new mme(i,n,r,a,l).getPoints(r.length*12);return new yt().setFromPoints(h)}}class vme{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const n=t[i],r=this.addClip(n);e.push(r)}return e}parseClips(){if(ri.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=ri.Objects.AnimationCurveNode,t=new Map;for(const i in e){const n=e[i];if(n.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:n.id,attr:n.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=ri.Objects.AnimationCurve;for(const i in t){const n={id:t[i].id,times:t[i].KeyTime.a.map(wme),values:t[i].KeyValueFloat.a},r=Kn.get(n.id);if(r!==void 0){const o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=n:a.match(/Y/)?e.get(o).curves.y=n:a.match(/Z/)?e.get(o).curves.z=n:a.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=n)}}}parseAnimationLayers(e){const t=ri.Objects.AnimationLayer,i=new Map;for(const n in t){const r=[],o=Kn.get(parseInt(n));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[c]===void 0){const u=Kn.get(l.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(u!==void 0){const f=ri.Objects.Model[u.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:f.attrName?Zt.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ao.traverse(function(m){m.ID===f.id&&(p.transform=m.matrix,m.userData.transformData&&(p.eulerOrder=m.userData.transformData.eulerOrder))}),p.transform||(p.transform=new le),"PreRotation"in f&&(p.preRotation=f.PreRotation.value),"PostRotation"in f&&(p.postRotation=f.PostRotation.value),r[c]=p}}r[c]&&(r[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[c]===void 0){const u=Kn.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,f=Kn.get(u).parents[0].ID,p=Kn.get(f).parents[0].ID,m=Kn.get(p).parents[0].ID,v=ri.Objects.Model[m],g={modelName:v.attrName?Zt.sanitizeNodeName(v.attrName):"",morphName:ri.Objects.Deformer[u].attrName};r[c]=g}r[c][h.attr]=h}}}),i.set(parseInt(n),r))}return i}parseAnimStacks(e){const t=ri.Objects.AnimationStack,i={};for(const n in t){const r=Kn.get(parseInt(n)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);i[n]={name:t[n].attrName,layer:o}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(n){t=t.concat(i.generateTracks(n))}),new go(e.name,-1,t)}generateTracks(e){const t=[];let i=new S,n=new S;if(e.transform&&e.transform.decompose(i,new Ce,n),i=i.toArray(),n=n.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");r!==void 0&&t.push(r)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);r!==void 0&&t.push(r)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");r!==void 0&&t.push(r)}if(e.DeformPercent!==void 0){const r=this.generateMorphTrack(e);r!==void 0&&t.push(r)}return t}generateVectorTrack(e,t,i,n){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,i);return new Uc(e+"."+n,r,o)}generateRotationTrack(e,t,i,n,r){let o,a;if(t.x===void 0||t.y===void 0||t.z===void 0){console.warn("THREE.FBXLoader: Missing rotation curves "+(t.x===void 0?"x ":"")+(t.y===void 0?"y ":"")+(t.z===void 0?"z ":"")+" for animation of "+e+". This is currently not supported.");return}if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const u=this.interpolateRotations(t.x,t.y,t.z,r);o=u[0],a=u[1]}i!==void 0&&(i=i.map(gi.degToRad),i.push(r),i=new li().fromArray(i),i=new Ce().setFromEuler(i)),n!==void 0&&(n=n.map(gi.degToRad),n.push(r),n=new li().fromArray(n),n=new Ce().setFromEuler(n).invert());const l=new Ce,c=new li,h=[];if(!(!a||!o)){for(let u=0;u<a.length;u+=3)c.set(a[u],a[u+1],a[u+2],r),l.setFromEuler(c),i!==void 0&&l.premultiply(i),n!==void 0&&l.multiply(n),u>2&&new Ce().fromArray(h,(u-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(h,u/3*4);return new zl(e+".quaternion",o,h)}}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(r){return r/100}),n=ao.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ou(e.modelName+".morphTargetInfluences["+n+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,n){return i-n}),t.length>1){let i=1,n=t[0];for(let r=1;r<t.length;r++){const o=t[r];o!==n&&(t[i]=o,n=o,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const n=i,r=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),o!==-1){const h=t.x.values[o];r.push(h),n[0]=h}else r.push(n[0]);if(a!==-1){const h=t.y.values[a];r.push(h),n[1]=h}else r.push(n[1]);if(l!==-1){const h=t.z.values[l];r.push(h),n[2]=h}else r.push(n[2])}),r}interpolateRotations(e,t,i,n){const r=[],o=[];r.push(e.times[0]),o.push(gi.degToRad(e.values[0])),o.push(gi.degToRad(t.values[0])),o.push(gi.degToRad(i.values[0]));for(let a=1;a<e.values.length;a++){const l=[e.values[a-1],t.values[a-1],i.values[a-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(gi.degToRad),h=[e.values[a],t.values[a],i.values[a]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;const u=h.map(gi.degToRad),f=[h[0]-l[0],h[1]-l[1],h[2]-l[2]],p=[Math.abs(f[0]),Math.abs(f[1]),Math.abs(f[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const v=Math.max(...p)/180,g=new li(...c,n),y=new li(...u,n),A=new Ce().setFromEuler(g),_=new Ce().setFromEuler(y);A.dot(_)&&_.set(-_.x,-_.y,-_.z,-_.w);const b=e.times[a-1],x=e.times[a]-b,E=new Ce,M=new li;for(let T=0;T<1;T+=1/v)E.copy(A.clone().slerp(_.clone(),T)),r.push(b+T*x),M.setFromQuaternion(E,n),o.push(M.x),o.push(M.y),o.push(M.z)}else r.push(e.times[a]),o.push(gi.degToRad(e.values[a])),o.push(gi.degToRad(t.values[a])),o.push(gi.degToRad(i.values[a]))}return[r,o]}}class Ame{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new s7,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(n,r){const o=n.match(/^[\s\t]*;/),a=n.match(/^[\s\t]*$/);if(o||a)return;const l=n.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=n.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=n.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(n,l):c?t.parseNodeProperty(n,c,i[++r]):h?t.popStack():n.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(n)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},o=this.parseNodeAttr(n),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,r):i in a?(i==="PoseNode"?a.PoseNode.push(r):a[i].id!==void 0&&(a[i]={},a[i][a[i].id]=a[i]),o.id!==""&&(a[i][o.id]=r)):typeof o.id=="number"?(a[i]={},a[i][o.id]=r):i!=="Properties70"&&(i==="PoseNode"?a[i]=[r]:a[i]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",n="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:i,type:n}}parseNodeProperty(e,t,i){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();n==="Content"&&r===","&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,n,r);return}if(n==="C"){const l=r.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let u=r.split(",").slice(3);u=u.map(function(f){return f.trim().replace(/^"/,"")}),n="connections",r=[c,h],Cme(r,u),o[n]===void 0&&(o[n]=[])}n==="Node"&&(o.id=r),n in o&&Array.isArray(o[n])?o[n].push(r):n!=="a"?o[n]=r:o.a=r,this.setCurrentProp(o,n),n==="a"&&r.slice(-1)!==","&&(o.a=pP(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=pP(t.a))}parseNodeSpecialProperty(e,t,i){const n=i.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=n[0],o=n[1],a=n[2],l=n[3];let c=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=pP(c);break}this.getPrevNode()[r]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}}class _me{parse(e){const t=new OG(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const n=new s7;for(;!this.endOfContent(t);){const r=this.parseNode(t,i);r!==null&&n.add(r.name,r)}return n}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},n=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(n===0)return null;const l=[];for(let f=0;f<r;f++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",u=l.length>2?l[2]:"";for(i.singleProperty=r===1&&e.getOffset()===n;n>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,i,f)}return i.propertyList=l,typeof c=="number"&&(i.id=c),h!==""&&(i.attrName=h),u!==""&&(i.attrType=u),a!==""&&(i.name=a),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const n=i.propertyList[0];Array.isArray(n)?(t[i.name]=i,i.a=n):t[i.name]=n}else if(e==="Connections"&&i.name==="C"){const n=[];i.propertyList.forEach(function(r,o){o!==0&&n.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(n)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){t[r]=i[r]});else if(e==="Properties70"&&i.name==="P"){let n=i.propertyList[0],r=i.propertyList[1];const o=i.propertyList[2],a=i.propertyList[3];let l;n.indexOf("Lcl ")===0&&(n=n.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:l=i.propertyList[4],t[n]={type:r,type2:o,flag:a,value:l}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}const a=TA(new Uint8Array(e.getArrayBuffer(o))),l=new OG(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(n);case"d":return l.getFloat64Array(n);case"f":return l.getFloat32Array(n);case"i":return l.getInt32Array(n);case"l":return l.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class OG{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const n=i.indexOf(0);return n>=0&&(i=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(i)}}class s7{add(e,t){this[e]=t}}function bme(s){const e="Kaydara FBX Binary  \0";return s.byteLength>=e.length&&e===a7(s,0,e.length)}function xme(s){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(n){const r=s[n-1];return s=s.slice(t+n),t++,r}for(let n=0;n<e.length;++n)if(i(1)===e[n])return!1;return!0}function LG(s){const e=/FBXVersion: (\d+)/,t=s.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function wme(s){return s/46186158e3}const Sme=[];function PS(s,e,t,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=s;break;case"ByPolygon":n=e;break;case"ByVertice":n=t;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(n=i.indices[n]);const r=n*i.dataSize,o=r+i.dataSize;return Eme(Sme,i.buffer,r,o)}const fP=new li,Tg=new S;function r7(s){const e=new le,t=new le,i=new le,n=new le,r=new le,o=new le,a=new le,l=new le,c=new le,h=new le,u=new le,f=new le,p=s.inheritType?s.inheritType:0;if(s.translation&&e.setPosition(Tg.fromArray(s.translation)),s.preRotation){const w=s.preRotation.map(gi.degToRad);w.push(s.eulerOrder||li.DEFAULT_ORDER),t.makeRotationFromEuler(fP.fromArray(w))}if(s.rotation){const w=s.rotation.map(gi.degToRad);w.push(s.eulerOrder||li.DEFAULT_ORDER),i.makeRotationFromEuler(fP.fromArray(w))}if(s.postRotation){const w=s.postRotation.map(gi.degToRad);w.push(s.eulerOrder||li.DEFAULT_ORDER),n.makeRotationFromEuler(fP.fromArray(w)),n.invert()}s.scale&&r.scale(Tg.fromArray(s.scale)),s.scalingOffset&&a.setPosition(Tg.fromArray(s.scalingOffset)),s.scalingPivot&&o.setPosition(Tg.fromArray(s.scalingPivot)),s.rotationOffset&&l.setPosition(Tg.fromArray(s.rotationOffset)),s.rotationPivot&&c.setPosition(Tg.fromArray(s.rotationPivot)),s.parentMatrixWorld&&(u.copy(s.parentMatrix),h.copy(s.parentMatrixWorld));const m=t.clone().multiply(i).multiply(n),v=new le;v.extractRotation(h);const g=new le;g.copyPosition(h);const y=g.clone().invert().multiply(h),A=v.clone().invert().multiply(y),_=r,b=new le;if(p===0)b.copy(v).multiply(m).multiply(A).multiply(_);else if(p===1)b.copy(v).multiply(A).multiply(m).multiply(_);else{const I=new le().scale(new S().setFromMatrixScale(u)).clone().invert(),O=A.clone().multiply(I);b.copy(v).multiply(m).multiply(O).multiply(_)}const x=c.clone().invert(),E=o.clone().invert();let M=e.clone().multiply(l).multiply(c).multiply(t).multiply(i).multiply(n).multiply(x).multiply(a).multiply(o).multiply(r).multiply(E);const T=new le().copyPosition(M),R=h.clone().multiply(T);return f.copyPosition(R),M=f.clone().multiply(b),M.premultiply(h.invert()),M}function o7(s){s=s||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return s===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[s]}function pP(s){return s.split(",").map(function(t){return parseFloat(t)})}function a7(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=s.byteLength),new TextDecoder().decode(new Uint8Array(s,e,t))}function Cme(s,e){for(let t=0,i=s.length,n=e.length;t<n;t++,i++)s[i]=e[t]}function Eme(s,e,t,i){for(let n=t,r=0;n<i;n++,r++)s[r]=e[n];return s}function Mme(s,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},i=s.getIndex(),n=s.getAttribute("position"),r=i?i.count:n.count;let o=0;const a=Object.keys(s.attributes),l={},c={},h=[],u=["getX","getY","getZ","getW"],f=["setX","setY","setZ","setW"];for(let A=0,_=a.length;A<_;A++){const b=a[A],x=s.attributes[b];l[b]=new Ke(new x.array.constructor(x.count*x.itemSize),x.itemSize,x.normalized);const E=s.morphAttributes[b];E&&(c[b]=new Ke(new E.array.constructor(E.count*E.itemSize),E.itemSize,E.normalized))}const p=e*.5,m=Math.log10(1/e),v=Math.pow(10,m),g=p*v;for(let A=0;A<r;A++){const _=i?i.getX(A):A;let b="";for(let x=0,E=a.length;x<E;x++){const M=a[x],T=s.getAttribute(M),R=T.itemSize;for(let w=0;w<R;w++)b+=`${~~(T[u[w]](_)*v+g)},`}if(b in t)h.push(t[b]);else{for(let x=0,E=a.length;x<E;x++){const M=a[x],T=s.getAttribute(M),R=s.morphAttributes[M],w=T.itemSize,I=l[M],O=c[M];for(let k=0;k<w;k++){const B=u[k],G=f[k];if(I[G](o,T[B](_)),R)for(let L=0,U=R.length;L<U;L++)O[L][G](o,R[L][B](_))}}t[b]=o,h.push(o),o++}}const y=s.clone();for(const A in s.attributes){const _=l[A];if(y.setAttribute(A,new Ke(_.array.slice(0,o*_.itemSize),_.itemSize,_.normalized)),A in c)for(let b=0;b<c[A].length;b++){const x=c[A][b];y.morphAttributes[A][b]=new Ke(x.array.slice(0,o*x.itemSize),x.itemSize,x.normalized)}}return y.setIndex(h),y}function kG(s,e){if(e===X5)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),s;if(e===D1||e===zO){let t=s.getIndex();if(t===null){const o=[],a=s.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);s.setIndex(o),t=s.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s}const i=t.count-2,n=[];if(e===D1)for(let o=1;o<=i;o++)n.push(t.getX(0)),n.push(t.getX(o)),n.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(n.push(t.getX(o)),n.push(t.getX(o+1)),n.push(t.getX(o+2))):(n.push(t.getX(o+2)),n.push(t.getX(o+1)),n.push(t.getX(o)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=s.clone();return r.setIndex(n),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),s}class Wd extends ds{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Bme(t)}),this.register(function(t){return new Gme(t)}),this.register(function(t){return new Hme(t)}),this.register(function(t){return new Vme(t)}),this.register(function(t){return new Ome(t)}),this.register(function(t){return new Lme(t)}),this.register(function(t){return new kme(t)}),this.register(function(t){return new Fme(t)}),this.register(function(t){return new Pme(t)}),this.register(function(t){return new Ume(t)}),this.register(function(t){return new Dme(t)}),this.register(function(t){return new zme(t)}),this.register(function(t){return new Nme(t)}),this.register(function(t){return new Ime(t)}),this.register(function(t){return new Qme(t)}),this.register(function(t){return new Wme(t)})}load(e,t,i,n){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=Jh.extractUrlBase(e);o=Jh.resolveURL(c,this.path)}else o=Jh.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){n?n(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new yr(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let r;const o={},a={},l=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===l7){try{o[fi.KHR_BINARY_GLTF]=new jme(e)}catch(u){n&&n(u);return}r=JSON.parse(o[fi.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new rge(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const u=r.extensionsUsed[h],f=r.extensionsRequired||[];switch(u){case fi.KHR_MATERIALS_UNLIT:o[u]=new Rme;break;case fi.KHR_DRACO_MESH_COMPRESSION:o[u]=new qme(r,this.dracoLoader);break;case fi.KHR_TEXTURE_TRANSFORM:o[u]=new Xme;break;case fi.KHR_MESH_QUANTIZATION:o[u]=new Yme;break;default:f.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,r){i.parse(e,t,n,r)})}}function Tme(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const fi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Ime{constructor(e){this.parser=e,this.name=fi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new Ae(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],zi);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new nm(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new im(h),c.distance=u;break;case"spot":c=new Lb(h),c.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,ad(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),n=Promise.resolve(c),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}let Rme=class{constructor(){this.name=fi.KHR_MATERIALS_UNLIT}getMaterialType(){return ti}extendParams(e,t,i){const n=[];e.color=new Ae(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],zi),e.opacity=o[3]}r.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",r.baseColorTexture,bt))}return Promise.all(n)}},Pme=class{constructor(e){this.parser=e,this.name=fi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}},Bme=class{constructor(e){this.parser=e,this.name=fi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:No}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ee(a,a)}return Promise.all(r)}},Dme=class{constructor(e){this.parser=e,this.name=fi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:No}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},Ome=class{constructor(e){this.parser=e,this.name=fi.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:No}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Ae(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],zi)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,bt)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},Lme=class{constructor(e){this.parser=e,this.name=fi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:No}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},kme=class{constructor(e){this.parser=e,this.name=fi.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:No}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new Ae().setRGB(a[0],a[1],a[2],zi),Promise.all(r)}},Fme=class{constructor(e){this.parser=e,this.name=fi.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:No}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},Ume=class{constructor(e){this.parser=e,this.name=fi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:No}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new Ae().setRGB(a[0],a[1],a[2],zi),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,bt)),Promise.all(r)}},Nme=class{constructor(e){this.parser=e,this.name=fi.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:No}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}},zme=class{constructor(e){this.parser=e,this.name=fi.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:No}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}};class Gme{constructor(e){this.parser=e,this.name=fi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class Hme{constructor(e){this.parser=e,this.name=fi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=n.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Vme{constructor(e){this.parser=e,this.name=fi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=n.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Qme{constructor(e){this.name=fi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],r=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=n.byteOffset||0,c=n.byteLength||0,h=n.count,u=n.byteStride,f=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,u,f,n.mode,n.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(h*u);return o.decodeGltfBuffer(new Uint8Array(p),h,u,f,n.mode,n.filter),p})})}else return null}}let Wme=class{constructor(e){this.name=fi.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const c of n.primitives)if(c.mode!==Qa.TRIANGLES&&c.mode!==Qa.TRIANGLE_STRIP&&c.mode!==Qa.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(l[c]=h,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const h=c.pop(),u=h.isGroup?h.children:[h],f=c[0].count,p=[];for(const m of u){const v=new le,g=new S,y=new Ce,A=new S(1,1,1),_=new $O(m.geometry,m.material,f);for(let b=0;b<f;b++)l.TRANSLATION&&g.fromBufferAttribute(l.TRANSLATION,b),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,b),l.SCALE&&A.fromBufferAttribute(l.SCALE,b),_.setMatrixAt(b,v.compose(g,y,A));for(const b in l)if(b==="_COLOR_0"){const x=l[b];_.instanceColor=new Po(x.array,x.itemSize,x.normalized)}else b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&m.geometry.setAttribute(b,l[b]);ye.prototype.copy.call(_,m),this.parser.assignFinalMaterial(_),p.push(_)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}};const l7="glTF",W0=12,FG={JSON:1313821514,BIN:5130562};class jme{constructor(e){this.name=fi.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,W0),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==l7)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-W0,r=new DataView(e,W0);let o=0;for(;o<n;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===FG.JSON){const c=new Uint8Array(e,W0+o,a);this.content=i.decode(c)}else if(l===FG.BIN){const c=W0+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class qme{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=fi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const u=kD[h]||h.toLowerCase();a[u]=o[h]}for(const h in e.attributes){const u=kD[h]||h.toLowerCase();if(o[h]!==void 0){const f=i.accessors[e.attributes[h]],p=Gy[f.componentType];c[u]=p.name,l[u]=f.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(u,f){n.decodeDracoFile(h,function(p){for(const m in p.attributes){const v=p.attributes[m],g=l[m];g!==void 0&&(v.normalized=g)}u(p)},a,c,zi,f)})})}}class Xme{constructor(){this.name=fi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Yme{constructor(){this.name=fi.KHR_MESH_QUANTIZATION}}class c7 extends xv{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let o=0;o!==n;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,n){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=n-t,u=(i-t)/h,f=u*u,p=f*u,m=e*c,v=m-c,g=-2*p+3*f,y=p-f,A=1-g,_=y-f+u;for(let b=0;b!==a;b++){const x=o[v+b+a],E=o[v+b+l]*h,M=o[m+b+a],T=o[m+b]*h;r[b]=A*x+_*E+g*M+y*T}return r}}const Kme=new Ce;class Jme extends c7{interpolate_(e,t,i,n){const r=super.interpolate_(e,t,i,n);return Kme.fromArray(r).normalize().toArray(r),r}}const Qa={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Gy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},UG={9728:Ot,9729:Nt,9984:Yy,9985:Rp,9986:Nh,9987:Do},NG={33071:as,33648:Zp,10497:Uo},mP={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},kD={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ju={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Zme={CUBICSPLINE:void 0,LINEAR:Fc,STEP:Hd},gP={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function $me(s){return s.DefaultMaterial===void 0&&(s.DefaultMaterial=new ws({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:$n})),s.DefaultMaterial}function qf(s,e,t){for(const i in t.extensions)s[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function ad(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ege(s,e,t){let i=!1,n=!1,r=!1;for(let c=0,h=e.length;c<h;c++){const u=e[c];if(u.POSITION!==void 0&&(i=!0),u.NORMAL!==void 0&&(n=!0),u.COLOR_0!==void 0&&(r=!0),i&&n&&r)break}if(!i&&!n&&!r)return Promise.resolve(s);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const u=e[c];if(i){const f=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):s.attributes.position;o.push(f)}if(n){const f=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):s.attributes.normal;a.push(f)}if(r){const f=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):s.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],u=c[1],f=c[2];return i&&(s.morphAttributes.position=h),n&&(s.morphAttributes.normal=u),r&&(s.morphAttributes.color=f),s.morphTargetsRelative=!0,s})}function tge(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)s.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ige(s){let e;const t=s.extensions&&s.extensions[fi.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+yP(t.attributes):e=s.indices+":"+yP(s.attributes)+":"+s.mode,s.targets!==void 0)for(let i=0,n=s.targets.length;i<n;i++)e+=":"+yP(s.targets[i]);return e}function yP(s){let e="";const t=Object.keys(s).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+s[t[i]]+";";return e}function FD(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function nge(s){return s.search(/\.jpe?g($|\?)/i)>0||s.search(/^data\:image\/jpeg/)===0?"image/jpeg":s.search(/\.webp($|\?)/i)>0||s.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const sge=new le;class rge{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Tme,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,r=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,r=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||n&&r<98?this.textureLoader=new Bc(this.options.manager):this.textureLoader=new c6(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new yr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:i,userData:{}};return qf(r,a,n),ad(a,n),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const o=t[n].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let n=0,r=e.length;n<r;n++){const o=e[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])};return r(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const r=e(t[n]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":n=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[fi.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(r,o){i.load(Jh.resolveURL(t.uri,n.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const o=mP[n.type],a=Gy[n.componentType],l=n.normalized===!0,c=new a(n.count*o);return Promise.resolve(new Ke(c,o,l))}const r=[];return n.bufferView!==void 0?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),n.sparse!==void 0&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=mP[n.type],c=Gy[n.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,f=n.byteOffset||0,p=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let v,g;if(p&&p!==u){const y=Math.floor(f/p),A="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+y+":"+n.count;let _=t.cache.get(A);_||(v=new c(a,y*p,n.count*p/h),_=new Pb(v,p/h),t.cache.add(A,_)),g=new aa(_,l,f%p/h,m)}else a===null?v=new c(n.count*l):v=new c(a,f,n.count*l),g=new Ke(v,l,m);if(n.sparse!==void 0){const y=mP.SCALAR,A=Gy[n.sparse.indices.componentType],_=n.sparse.indices.byteOffset||0,b=n.sparse.values.byteOffset||0,x=new A(o[1],_,n.sparse.count*y),E=new c(o[2],b,n.sparse.count*l);a!==null&&(g=new Ke(g.array.slice(),g.itemSize,g.normalized));for(let M=0,T=x.length;M<T;M++){const R=x[M];if(g.setX(R,E[M*l]),l>=2&&g.setY(R,E[M*l+1]),l>=3&&g.setZ(R,E[M*l+2]),l>=4&&g.setW(R,E[M*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,i){const n=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const f=(r.samplers||{})[o.sampler]||{};return h.magFilter=UG[f.magFilter]||Nt,h.minFilter=UG[f.minFilter]||Do,h.wrapS=NG[f.wrapS]||Uo,h.wrapT=NG[f.wrapT]||Uo,h.anisotropy=4,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,n=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const o=n.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(u){c=!0;const f=new Blob([u],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(f,p){let m=f;t.isImageBitmapLoader===!0&&(m=function(v){const g=new Wt(v);g.needsUpdate=!0,f(g)}),t.load(Jh.resolveURL(u,r.path),m,void 0,p)})}).then(function(u){return c===!0&&a.revokeObjectURL(l),u.userData.mimeType=o.mimeType||nge(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[e]=h,h}assignTexture(e,t,i,n){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[fi.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[fi.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[fi.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return n!==void 0&&(o.colorSpace=n),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new md,Ht.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new ji,Ht.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(n||r||o){let a="ClonedMaterial:"+i.uuid+":";n&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return ws}loadMaterial(e){const t=this,i=this.json,n=this.extensions,r=i.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[fi.KHR_MATERIALS_UNLIT]){const u=n[fi.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),c.push(u.extendParams(a,r,t))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new Ae(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;a.color.setRGB(f[0],f[1],f[2],zi),a.opacity=f[3]}u.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",u.baseColorTexture,bt)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=_i);const h=r.alphaMode||gP.OPAQUE;if(h===gP.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===gP.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==ti&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new ee(1,1),r.normalTexture.scale!==void 0)){const u=r.normalTexture.scale;a.normalScale.set(u,u)}if(r.occlusionTexture!==void 0&&o!==ti&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==ti){const u=r.emissiveFactor;a.emissive=new Ae().setRGB(u[0],u[1],u[2],zi)}return r.emissiveTexture!==void 0&&o!==ti&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,bt)),Promise.all(c).then(function(){const u=new o(a);return r.name&&(u.name=r.name),ad(u,r),t.associations.set(u,{materials:e}),r.extensions&&qf(n,u,r),u})}createUniqueName(e){const t=Zt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function r(a){return i[fi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return zG(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],h=ige(c),u=n[h];if(u)o.push(u.promise);else{let f;c.extensions&&c.extensions[fi.KHR_DRACO_MESH_COMPRESSION]?f=r(c):f=zG(new yt,c,t),n[h]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,n=this.extensions,r=i.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?$me(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let p=0,m=h.length;p<m;p++){const v=h[p],g=o[p];let y;const A=c[p];if(g.mode===Qa.TRIANGLES||g.mode===Qa.TRIANGLE_STRIP||g.mode===Qa.TRIANGLE_FAN||g.mode===void 0)y=r.isSkinnedMesh===!0?new Fo(v,A):new fe(v,A),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),g.mode===Qa.TRIANGLE_STRIP?y.geometry=kG(y.geometry,zO):g.mode===Qa.TRIANGLE_FAN&&(y.geometry=kG(y.geometry,D1));else if(g.mode===Qa.LINES)y=new jr(v,A);else if(g.mode===Qa.LINE_STRIP)y=new An(v,A);else if(g.mode===Qa.LINE_LOOP)y=new eL(v,A);else if(g.mode===Qa.POINTS)y=new Py(v,A);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(y.geometry.morphAttributes).length>0&&tge(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),ad(y,r),g.extensions&&qf(n,y,g),t.assignFinalMaterial(y),u.push(y)}for(let p=0,m=u.length;p<m;p++)t.associations.set(u[p],{meshes:e,primitives:p});if(u.length===1)return r.extensions&&qf(n,u[0],r),u[0];const f=new Vs;r.extensions&&qf(n,f,r),t.associations.set(f,{meshes:e});for(let p=0,m=u.length;p<m;p++)f.add(u[p]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Vt(gi.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new Qc(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),ad(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,r=t.joints.length;n<r;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const r=n.pop(),o=n,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const u=o[c];if(u){a.push(u);const f=new le;r!==null&&f.fromArray(r.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Bb(a,l)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],r=n.name?n.name:"animation_"+e,o=[],a=[],l=[],c=[],h=[];let u=0,f=n.channels.length;for(u=0,f=n.channels.length;u<f;u++){const p=n.channels[u],m=n.samplers[p.sampler],v=p.target,g=v.node,y=n.parameters!==void 0?n.parameters[m.input]:m.input,A=n.parameters!==void 0?n.parameters[m.output]:m.output;v.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",y)),l.push(this.getDependency("accessor",A)),c.push(m),h.push(v))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(p){const m=p[0],v=p[1],g=p[2],y=p[3],A=p[4],_=[];for(u=0,f=m.length;u<f;u++){const b=m[u],x=v[u],E=g[u],M=y[u],T=A[u];if(b===void 0)continue;b.updateMatrix&&b.updateMatrix();const R=i._createAnimationTracks(b,x,E,M,T);if(R)for(let w=0;w<R.length;w++)_.push(R[w])}return new go(r,void 0,_)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,n.mesh,r);return n.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=n.weights.length;l<c;l++)a.morphTargetInfluences[l]=n.weights[l]}),o})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],r=i._loadNodeShallow(e),o=[],a=n.children||[];for(let c=0,h=a.length;c<h;c++)o.push(i.getDependency("node",a[c]));const l=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const h=c[0],u=c[1],f=c[2];f!==null&&h.traverse(function(p){p.isSkinnedMesh&&p.bind(f,sge)});for(let p=0,m=u.length;p<m;p++)h.add(u[p]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?n.createUniqueName(r.name):"",a=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(n.getDependency("camera",r.camera).then(function(c){return n._getNodeRef(n.cameraCache,r.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let h;if(r.isBone===!0?h=new em:c.length>1?h=new Vs:c.length===1?h=c[0]:h=new ye,h!==c[0])for(let u=0,f=c.length;u<f;u++)h.add(c[u]);if(r.name&&(h.userData.name=r.name,h.name=o),ad(h,r),r.extensions&&qf(i,h,r),r.matrix!==void 0){const u=new le;u.fromArray(r.matrix),h.applyMatrix4(u)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,r=new Vs;i.name&&(r.name=n.createUniqueName(i.name)),ad(r,i),i.extensions&&qf(t,r,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(n.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,u=l.length;h<u;h++)r.add(l[h]);const c=h=>{const u=new Map;for(const[f,p]of n.associations)(f instanceof Ht||f instanceof Wt)&&u.set(f,p);return h.traverse(f=>{const p=n.associations.get(f);p!=null&&u.set(f,p)}),u};return n.associations=c(r),r})}_createAnimationTracks(e,t,i,n,r){const o=[],a=e.name?e.name:e.uuid,l=[];ju[r.path]===ju.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(a);let c;switch(ju[r.path]){case ju.weights:c=ou;break;case ju.rotation:c=zl;break;case ju.position:case ju.scale:c=Uc;break;default:switch(i.itemSize){case 1:c=ou;break;case 2:case 3:default:c=Uc;break}break}const h=n.interpolation!==void 0?Zme[n.interpolation]:Fc,u=this._getArrayFromAccessor(i);for(let f=0,p=l.length;f<p;f++){const m=new c(l[f]+"."+ju[r.path],t.array,u,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=FD(t.constructor),n=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)n[r]=t[r]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof zl?Jme:c7;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function oge(s,e,t){const i=e.attributes,n=new jt;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(n.set(new S(l[0],l[1],l[2]),new S(c[0],c[1],c[2])),a.normalized){const h=FD(Gy[a.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new S,l=new S;for(let c=0,h=r.length;c<h;c++){const u=r[c];if(u.POSITION!==void 0){const f=t.json.accessors[u.POSITION],p=f.min,m=f.max;if(p!==void 0&&m!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),f.normalized){const v=FD(Gy[f.componentType]);l.multiplyScalar(v)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}s.boundingBox=n;const o=new ln;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,s.boundingSphere=o}function zG(s,e,t){const i=e.attributes,n=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){s.setAttribute(a,l)})}for(const o in i){const a=kD[o]||o.toLowerCase();a in s.attributes||n.push(r(i[o],a))}if(e.indices!==void 0&&!s.index){const o=t.getDependency("accessor",e.indices).then(function(a){s.setIndex(a)});n.push(o)}return Ci.workingColorSpace!==zi&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ci.workingColorSpace}" not supported.`),ad(s,e),oge(s,e,t),Promise.all(n).then(function(){return e.targets!==void 0?ege(s,e.targets,t):s})}const age=/^[og]\s*(.+)?/,lge=/^mtllib /,cge=/^usemtl /,hge=/^usemap /,GG=/\s+/,HG=new S,vP=new S,VG=new S,QG=new S,Oa=new S,BS=new Ae;function uge(){const s={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(n,r){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:n||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(n){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),n&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return n&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},i&&i.name&&typeof i.clone=="function"){const n=i.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){const n=this.vertices,r=this.object.geometry.vertices;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const n=this.normals,r=this.object.geometry.normals;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addFaceNormal:function(e,t,i){const n=this.vertices,r=this.object.geometry.normals;HG.fromArray(n,e),vP.fromArray(n,t),VG.fromArray(n,i),Oa.subVectors(VG,vP),QG.subVectors(HG,vP),Oa.cross(QG),Oa.normalize(),r.push(Oa.x,Oa.y,Oa.z),r.push(Oa.x,Oa.y,Oa.z),r.push(Oa.x,Oa.y,Oa.z)},addColor:function(e,t,i){const n=this.colors,r=this.object.geometry.colors;n[e]!==void 0&&r.push(n[e+0],n[e+1],n[e+2]),n[t]!==void 0&&r.push(n[t+0],n[t+1],n[t+2]),n[i]!==void 0&&r.push(n[i+0],n[i+1],n[i+2])},addUV:function(e,t,i){const n=this.uvs,r=this.object.geometry.uvs;r.push(n[e+0],n[e+1]),r.push(n[t+0],n[t+1]),r.push(n[i+0],n[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,n,r,o,a,l,c){const h=this.vertices.length;let u=this.parseVertexIndex(e,h),f=this.parseVertexIndex(t,h),p=this.parseVertexIndex(i,h);if(this.addVertex(u,f,p),this.addColor(u,f,p),a!==void 0&&a!==""){const m=this.normals.length;u=this.parseNormalIndex(a,m),f=this.parseNormalIndex(l,m),p=this.parseNormalIndex(c,m),this.addNormal(u,f,p)}else this.addFaceNormal(u,f,p);if(n!==void 0&&n!==""){const m=this.uvs.length;u=this.parseUVIndex(n,m),f=this.parseUVIndex(r,m),p=this.parseUVIndex(o,m),this.addUV(u,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,n=e.length;i<n;i++){const r=this.parseVertexIndex(e[i],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,n=this.uvs.length;for(let r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],i));for(let r=0,o=t.length;r<o;r++)this.addUVLine(this.parseUVIndex(t[r],n))}};return s.startObject("",!1),s}class sF extends ds{constructor(e){super(e),this.materials=null}load(e,t,i,n){const r=this,o=new yr(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(a))}catch(l){n?n(l):console.error(l),r.manager.itemError(e)}},i,n)}setMaterials(e){return this.materials=e,this}parse(e){const t=new uge;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const i=e.split(`
`);let n=[];for(let a=0,l=i.length;a<l;a++){const c=i[a].trimStart();if(c.length===0)continue;const h=c.charAt(0);if(h!=="#")if(h==="v"){const u=c.split(GG);switch(u[0]){case"v":t.vertices.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])),u.length>=7?(BS.setRGB(parseFloat(u[4]),parseFloat(u[5]),parseFloat(u[6])).convertSRGBToLinear(),t.colors.push(BS.r,BS.g,BS.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));break;case"vt":t.uvs.push(parseFloat(u[1]),parseFloat(u[2]));break}}else if(h==="f"){const f=c.slice(1).trim().split(GG),p=[];for(let v=0,g=f.length;v<g;v++){const y=f[v];if(y.length>0){const A=y.split("/");p.push(A)}}const m=p[0];for(let v=1,g=p.length-1;v<g;v++){const y=p[v],A=p[v+1];t.addFace(m[0],y[0],A[0],m[1],y[1],A[1],m[2],y[2],A[2])}}else if(h==="l"){const u=c.substring(1).trim().split(" ");let f=[];const p=[];if(c.indexOf("/")===-1)f=u;else for(let m=0,v=u.length;m<v;m++){const g=u[m].split("/");g[0]!==""&&f.push(g[0]),g[1]!==""&&p.push(g[1])}t.addLineGeometry(f,p)}else if(h==="p"){const f=c.slice(1).trim().split(" ");t.addPointGeometry(f)}else if((n=age.exec(c))!==null){const u=(" "+n[0].slice(1).trim()).slice(1);t.startObject(u)}else if(cge.test(c))t.object.startMaterial(c.substring(7).trim(),t.materialLibraries);else if(lge.test(c))t.materialLibraries.push(c.substring(7).trim());else if(hge.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(n=c.split(" "),n.length>1){const f=n[1].trim().toLowerCase();t.object.smooth=f!=="0"&&f!=="off"}else t.object.smooth=!0;const u=t.object.currentMaterial();u&&(u.smooth=t.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}t.finalize();const r=new Vs;if(r.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let a=0,l=t.objects.length;a<l;a++){const c=t.objects[a],h=c.geometry,u=c.materials,f=h.type==="Line",p=h.type==="Points";let m=!1;if(h.vertices.length===0)continue;const v=new yt;v.setAttribute("position",new rt(h.vertices,3)),h.normals.length>0&&v.setAttribute("normal",new rt(h.normals,3)),h.colors.length>0&&(m=!0,v.setAttribute("color",new rt(h.colors,3))),h.hasUVIndices===!0&&v.setAttribute("uv",new rt(h.uvs,2));const g=[];for(let A=0,_=u.length;A<_;A++){const b=u[A],x=b.name+"_"+b.smooth+"_"+m;let E=t.materials[x];if(this.materials!==null){if(E=this.materials.create(b.name),f&&E&&!(E instanceof ji)){const M=new ji;Ht.prototype.copy.call(M,E),M.color.copy(E.color),E=M}else if(p&&E&&!(E instanceof md)){const M=new md({size:10,sizeAttenuation:!1});Ht.prototype.copy.call(M,E),M.color.copy(E.color),M.map=E.map,E=M}}E===void 0&&(f?E=new ji:p?E=new md({size:1,sizeAttenuation:!1}):E=new By,E.name=b.name,E.flatShading=!b.smooth,E.vertexColors=m,t.materials[x]=E),g.push(E)}let y;if(g.length>1){for(let A=0,_=u.length;A<_;A++){const b=u[A];v.addGroup(b.groupStart,b.groupCount,A)}f?y=new jr(v,g):p?y=new Py(v,g):y=new fe(v,g)}else f?y=new jr(v,g[0]):p?y=new Py(v,g[0]):y=new fe(v,g[0]);y.name=c.name,r.add(y)}else if(t.vertices.length>0){const a=new md({size:1,sizeAttenuation:!1}),l=new yt;l.setAttribute("position",new rt(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(l.setAttribute("color",new rt(t.colors,3)),a.vertexColors=!0);const c=new Py(l,a);r.add(c)}return r}}typeof globalThis!==void 0&&!("OffscreenCanvas"in globalThis)&&(globalThis.OffscreenCanvas=class{constructor(e,t){d(this,"canvas");return this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.canvas.convertToBlob=(i,n)=>new Promise(r=>{this.canvas.toBlob(r,i,n)}),this.canvas}});const dge=ie("debugprogress");function h7(s){s=s||new Date;const e=s.getMonth()+1,t=s.getDate(),i=s.getHours(),n=s.getMinutes(),r=s.getSeconds(),o=(e<10?"0":"")+e,a=(t<10?"0":"")+t,l=(i<10?"0":"")+i,c=(n<10?"0":"")+n,h=(r<10?"0":"")+r;return s.getFullYear()+o+a+"-"+l+c+h}class ai{static start(e,t){typeof t=="string"&&(t={parentScope:t});const i=new fge(e,t);RA.set(e,i)}static report(e,t){const i=RA.get(e);if(!i){console.warn("Reporting progress for non-existing scope",e);return}typeof t=="string"&&(t={message:t,autoStep:!0}),i.report(t)}static end(e){const t=RA.get(e);t&&(t.end(),RA.delete(e))}}const RA=new Map;class fge{constructor(e,t){d(this,"scopeLabel");d(this,"parentScope");d(this,"childScopes",[]);d(this,"parentDepth",0);d(this,"lastStep",0);d(this,"lastAutoStepWeight",1);d(this,"lastTotalSteps",0);d(this,"onProgress");d(this,"showLogs",!1);d(this,"selfProgress",0);d(this,"totalProgress",0);d(this,"selfReports",0);d(this,"totalReports",0);this.parentScope=t!=null&&t.parentScope?RA.get(t.parentScope):void 0,this.parentScope&&(this.parentScope.childScopes.push(this),this.parentDepth=this.parentScope.parentDepth+1),this.scopeLabel=" ".repeat(this.parentDepth*2)+e,this.showLogs=(t==null?void 0:t.logTimings)??!!dge,this.showLogs&&console.time(this.scopeLabel),this.onProgress=t==null?void 0:t.onProgress}report(e,t=!1){if(e){if(e.totalSteps!==void 0&&(this.lastTotalSteps=e.totalSteps),e.currentStep!==void 0&&(this.lastStep=e.currentStep),e.autoStep!==void 0){if(e.currentStep===void 0){this.lastStep===void 0&&(this.lastStep=0);const n=typeof e.autoStep=="number"?e.autoStep:1;this.lastStep+=this.lastAutoStepWeight,this.lastAutoStepWeight=n,e.currentStep=this.lastStep}e.totalSteps=this.lastTotalSteps}e.progress!==void 0?this.selfProgress=e.progress:e.currentStep!==void 0&&e.totalSteps!==void 0&&(this.selfProgress=e.currentStep/e.totalSteps)}if(this.childScopes.length>0){let n=0,r=0;for(const a of this.childScopes)n+=a.selfProgress,r+=1;r>0&&(n/=r);const o=this.lastAutoStepWeight/(this.lastTotalSteps??1);this.totalProgress=this.selfProgress+n*o}else this.totalProgress=this.selfProgress;this.selfProgress=Math.min(1,this.selfProgress),this.totalProgress=Math.min(1,this.totalProgress);let i=(this.totalProgress*100).toFixed(3)+"%";this.childScopes.length>0&&(i+=" ("+(this.selfProgress*100).toFixed(3)+"% self)"),e!=null&&e.message&&(i=e.message+"  "+i),this.lastStep!==void 0&&this.lastTotalSteps!==void 0&&(i="Step "+(this.lastStep+(this.lastAutoStepWeight!=1?""+(this.lastStep+this.lastAutoStepWeight):"")+"/"+this.lastTotalSteps)+" "+i),t?this.totalReports++:(this.selfReports++,this.totalReports++),this.showLogs&&console.timeLog(this.scopeLabel,i),this.onProgress&&this.onProgress(this.totalProgress),this.parentScope&&this.parentScope.report(void 0,!0)}end(){this.report({progress:1,autoStep:!0},!0),this.showLogs&&(console.timeLog(this.scopeLabel,"Total reports: "+this.totalReports,"Self reports: "+this.selfReports),console.timeEnd(this.scopeLabel));let e=!1;for(const t of this.childScopes)if(!(t.selfProgress>=1)){e=!0;break}e&&console.warn("Progress end with child scopes that are still running",this),this.onProgress=void 0}}function Wl(s){return s=s.replace(/[^a-zA-Z0-9_]/g,""),s.match(/^[a-zA-Z_]/)||(s="_"+s),s}function u7(s){if(s.length===0)return null;const e=s.map(i=>{const n=new Array;for(;i.parent;)n.unshift(i.parent),i=i.parent;return n});return e[0].findLast(i=>e.every(n=>n.includes(i)))||null}function d7(s){const e=u7(s),t=new Set;for(const i of s){let n=i.parent;for(;n&&n!==e;)s.includes(n)||t.add(n),n=n.parent}return t}const yp=class{constructor(e,t,i,n=null,r=null,o=null,a=null,l=null){d(this,"uuid");d(this,"name");d(this,"type");d(this,"extraSchemas",[]);d(this,"displayName");d(this,"visibility");d(this,"matrix");d(this,"_isDynamic");d(this,"geometry");d(this,"material");d(this,"camera");d(this,"parent");d(this,"skinnedMesh");d(this,"children",[]);d(this,"animations");d(this,"_eventListeners");this.uuid=e,this.name=Wl(t),this.displayName=t,this.matrix=i.clone(),this.geometry=n,this.material=r,this.camera=o,this.parent=null,this.children=[],this._eventListeners={},this._isDynamic=!1,this.skinnedMesh=a,this.animations=l}get isDynamic(){return this._isDynamic}set isDynamic(e){this._isDynamic=e}static createEmptyParent(e){const t=new yp(gi.generateUUID(),e.name+"_empty_"+yp.USDObject_export_id++,e.matrix),i=e.parent;return i&&i.add(t),t.add(e),t.isDynamic=!0,e.matrix=new le().identity(),t}static createEmpty(){const e=new yp(gi.generateUUID(),"Empty_"+yp.USDObject_export_id++,new le);return e.isDynamic=!0,e}is(e){return e?this.uuid===e.uuid:!1}isEmpty(){return!this.geometry}clone(){const e=new yp(gi.generateUUID(),this.name,this.matrix,this.geometry,this.material);return e.isDynamic=this.isDynamic,e}deepClone(){const e=this.clone();for(const t of this.children)t&&e.add(t.deepClone());return e}getPath(){let e=this.parent,t=this.name;for(;e;)t=(e.parent?e.name:e.name+"/Scenes/Scene")+"/"+t,e=e.parent;return"</"+t+">"}add(e){e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e)}remove(e){const t=this.children.indexOf(e);t>=0&&(e.parent===this&&(e.parent=null),this.children.splice(t,1))}addEventListener(e,t){this._eventListeners[e]||(this._eventListeners[e]=[]),this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}onSerialize(e,t){const i=this._eventListeners.serialize;i&&i.forEach(n=>n(e,t))}};let mr=yp;d(mr,"USDObject_export_id",0);class f7 extends mr{constructor(){super(void 0,"StageRoot",new le,null,null,null);d(this,"stageLength");this.children=[],this.stageLength=200}get isDocumentRoot(){return!0}get isDynamic(){return!1}add(t){t.parent=this,this.children.push(t)}remove(t){const i=this.children.indexOf(t);i>=0&&(t.parent===this&&(t.parent=null),this.children.splice(i,1))}traverse(t,i=null){if(i!==null?t(i):i=this,i.children)for(const n of i.children)this.traverse(t,n)}findById(t){let i=!1;function n(r){if(!i){if(r.uuid===t)return i=!0,r;if(r.children)for(const o of r.children){if(!o)continue;const a=n(o);if(a)return a}}}return n(this)}buildHeader(t){var a,l;const i=(a=t.extensions)==null?void 0:a.find(c=>(c==null?void 0:c.extensionName)==="animation"),n=(l=t.extensions)==null?void 0:l.find(c=>(c==null?void 0:c.extensionName)==="Behaviour"),r=(i==null?void 0:i.getStartTimeCode())??0,o=(i==null?void 0:i.getEndTimeCode())??0;return`#usda 1.0
(
	customLayerData = {
		string creator = "Needle Engine ${tl}"
		dictionary Needle = {
			bool animations = ${i?1:0}
			bool interactive = ${n?1:0}
			bool quickLookCompatible = ${t.quickLookCompatible?1:0}
		}
	}
	defaultPrim = "${Wl(this.name)}"
	metersPerUnit = 1
	upAxis = "Y"
	startTimeCode = ${r}
	endTimeCode = ${o}
	timeCodesPerSecond = 60
	framesPerSecond = 60
	doc = """Generated by Needle Engine USDZ Exporter ${tl}"""
)
`}}const Ig=`
`,So="</StageRoot/Materials";class p7{constructor(){d(this,"str");d(this,"indent");this.str="",this.indent=0}clear(){this.str="",this.indent=0}beginBlock(e=void 0,t="{",i=!0){e!==void 0?(e=this.applyIndent(e),this.str+=e,i?(this.str+=Ig,this.str+=this.applyIndent(t)):this.str+=" "+t):this.str+=this.applyIndent(t),this.str+=Ig,this.indent+=1}closeBlock(e="}"){this.indent-=1,this.str+=this.applyIndent(e)+Ig}beginArray(e){e=this.applyIndent(e+" = ["),this.str+=e,this.str+=Ig,this.indent+=1}closeArray(){this.indent-=1,this.str+=this.applyIndent("]")+Ig}appendLine(e=""){e=this.applyIndent(e),this.str+=e,this.str+=Ig}toString(){return this.str}applyIndent(e){let t="";for(let i=0;i<this.indent;i++)t+="	";return t+e}}class pge{constructor(e,t,i){d(this,"root");d(this,"exporter");d(this,"extensions",[]);d(this,"quickLookCompatible");d(this,"exportInvisible");d(this,"materials");d(this,"textures");d(this,"files");d(this,"document");d(this,"output");d(this,"animations");this.root=e,this.exporter=t,this.quickLookCompatible=i.quickLookCompatible,this.exportInvisible=i.exportInvisible,i.extensions&&(this.extensions=i.extensions),this.materials=new Map,this.textures={},this.files={},this.document=new f7,this.output="",this.animations=[]}}class AP{constructor(){d(this,"ar",{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}});d(this,"quickLookCompatible",!1);d(this,"extensions",[]);d(this,"maxTextureSize",4096);d(this,"exportInvisible",!1)}}let m7=class{constructor(){d(this,"debug");d(this,"sceneAnchoringOptions",new AP);d(this,"extensions",[]);d(this,"keepObject");this.debug=!1}async parse(e,t=new AP){t=Object.assign(new AP,t),this.sceneAnchoringOptions=t;const i=new pge(e,this,t);this.extensions=i.extensions;const n=i.files,r="model.usda";n[r]=null;const o=i.materials,a=i.textures;ai.report("export-usdz","Invoking onBeforeBuildDocument"),await g1(i,"onBeforeBuildDocument"),ai.report("export-usdz","Done onBeforeBuildDocument"),ai.report("export-usdz","Reparent bones to common ancestor");const l=[];e==null||e.traverse(v=>{if(!(!t.exportInvisible&&!v.visible)&&v instanceof Fo){const g=v.skeleton.bones,y=u7(g);y&&l.push({object:v,originalParent:v.parent,newParent:y})}});for(const v of l){const{object:g,originalParent:y,newParent:A}=v;A.add(g)}ai.report("export-usdz","Traversing hierarchy"),e&&g7(e,i.document,i,this.keepObject),ai.report("export-usdz","Invoking onAfterBuildDocument"),await g1(i,"onAfterBuildDocument"),ai.report("export-usdz",{message:"Parsing document",autoStep:10}),await mge(i,()=>(ai.report("export-usdz","Building materials"),wge(o,a,t.quickLookCompatible))),ai.report("export-usdz","Invoking onAfterSerialize"),await g1(i,"onAfterSerialize");for(const v of l){const{object:g,originalParent:y,newParent:A}=v;y&&y.add(g)}const h=i.document.buildHeader(i)+`
`+i.output;this.debug&&console.log(h),n[r]=dE(h),i.output="",ai.report("export-usdz",{message:"Exporting textures",autoStep:10}),ai.start("export-usdz-textures","export-usdz");const u=new hu({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),f=Object.keys(a).length;ai.report("export-usdz-textures",{totalSteps:f*3,currentStep:0});const p=async v=>{const g=a[v],y=g.texture,A=_7.includes(y.format);let _={imageData:y.image};ai.report("export-usdz-textures",{message:"read back texture",autoStep:!0});const b=g.scale!==void 0&&g.scale.x!==1&&g.scale.y!==1&&g.scale.z!==1&&g.scale.w!==1;(y.isCompressedTexture||y.isRenderTargetTexture||b)&&(_=await gge(y,t.maxTextureSize,u,g.scale)),ai.report("export-usdz-textures",{message:"convert texture to canvas",autoStep:!0});const x=await vge(_.imageBitmap||_.imageData,t.maxTextureSize).catch(E=>{console.error("Error converting texture to canvas",y,E)});if(x){ai.report("export-usdz-textures",{message:"convert canvas to blob",autoStep:!0});const E=await x.convertToBlob({type:A?"image/png":"image/jpeg",quality:.95});n[`textures/${v}.${A?"png":"jpg"}`]=new Uint8Array(await E.arrayBuffer())}else console.warn("Can`t export texture: ",y)};for(const v in a)await p(v);u.dispose(),ai.end("export-usdz-textures");let m=0;for(const v in n){const g=n[v],y=34+v.length;m+=y;const A=m&63;if(A!==4){const _=64-A,b=new Uint8Array(_);n[v]=[g,{extra:{12345:b}}]}m=g.length}return ai.report("export-usdz","zip archive"),Tpe(n,{level:0})}};function g7(s,e,t,i){if(!t.exportInvisible&&!s.visible)return;let n,r,o;if((s instanceof fe||s instanceof Fo)&&(r=s.geometry,o=s.material),i&&!i(s)&&(r=void 0,o=void 0),(s instanceof fe||s instanceof Fo)&&o&&(o instanceof ws||o instanceof ti)){const a=LS(s),l=s instanceof Fo?s:null;n=new mr(s.uuid,a,s.matrix,r,o,void 0,l,s.animations)}else if(s instanceof Vt||s instanceof Qc){const a=LS(s);n=new mr(s.uuid,a,s.matrix,void 0,void 0,s)}else{const a=LS(s);n=new mr(s.uuid,a,s.matrix,void 0,void 0,void 0,void 0,s.animations)}if(n){if(n.displayName=s.name,n.visibility=s.visible?void 0:"invisible",e&&e.add(n),e=n,t.extensions)for(const a of t.extensions)a.onExportObject&&a.onExportObject.call(a,s,n,t)}else{const a=LS(s),l=new mr(s.uuid,a,s.matrix);e&&e.add(l),e=l}for(const a of s.children)g7(a,e,t,i)}async function mge(s,e){ai.start("export-usdz-resources","export-usdz");const t=[];for(const l of s.document.children)y7(l,s,t);const i=t.length;for(let l=0;l<i;l++)ai.report("export-usdz-resources",{totalSteps:i,currentStep:l}),await new Promise((c,h)=>{t[l](),c()});ai.end("export-usdz-resources");const n=new p7,r=s.exporter.sceneAnchoringOptions.ar;n.beginBlock(`def Xform "${s.document.name}"`),n.beginBlock(`def Scope "Scenes" (
		kind = "sceneLibrary"
	)`),n.beginBlock('def Xform "Scene"',"(",!1),n.appendLine('apiSchemas = ["Preliminary_AnchoringAPI"]'),n.appendLine("customData = {"),n.appendLine("	bool preliminary_collidesWithEnvironment = 0"),n.appendLine('	string sceneName = "Scene"'),n.appendLine("}"),n.appendLine('sceneName = "Scene"'),n.closeBlock(")"),n.beginBlock(),n.appendLine(`token preliminary:anchoring:type = "${r.anchoring.type}"`),r.anchoring.type==="plane"&&n.appendLine(`token preliminary:planeAnchoring:alignment = "${r.planeAnchoring.alignment}"`),r.anchoring.type==="image"&&n.appendLine(`rel preliminary:imageAnchoring:referenceImage = </${s.document.name}/Scenes/Scene/AnchoringReferenceImage>`),n.appendLine();const o=l=>{if(!l)return 0;let c=1;for(const h of l.children)c+=o(h);return c},a=o(s.document);ai.start("export-usdz-xforms","export-usdz"),ai.report("export-usdz-xforms",{totalSteps:a,currentStep:1});for(const l of s.document.children)A7(l,n,s);ai.end("export-usdz-xforms"),ai.report("export-usdz","invoke onAfterHierarchy"),g1(s,"onAfterHierarchy",n),n.closeBlock(),n.closeBlock(),n.appendLine(e()),n.closeBlock(),ai.report("export-usdz","write to string"),s.output+=n.toString()}function y7(s,e,t){if(!s)return;const i=s.geometry,n=s.material;if(i)if(n&&("isMeshStandardMaterial"in n&&n.isMeshStandardMaterial||"isMeshBasicMaterial"in n&&n.isMeshBasicMaterial)){const r="geometries/"+UD(i,s.name)+".usda";if(!(r in e.files)){const o=()=>{var l,c;const a=bge(i,(c=(l=s.skinnedMesh)==null?void 0:l.skeleton)==null?void 0:c.bones,e.quickLookCompatible);e.files[r]=_ge(a)};t.push(o)}}else console.warn("NeedleUSDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",name);n&&(n.uuid in e.materials||(e.materials[n.uuid]=n));for(const r of s.children)y7(r,e,t)}async function g1(s,e,t=null){if(s.extensions){for(const i of s.extensions)if(i&&typeof i[e]=="function"){const r=i[e].call(i,s,t);r instanceof Promise&&await r}}}let DS=null,no=null,_P,Rg,OS;async function gge(s,e=1/0,t=null,i=void 0){_P||(_P=new ps(2,2,1,1)),Rg||(Rg=new kt({uniforms:{blitTexture:new Se(s),flipY:new Se(!1),scale:new Se(new Je(1,1,1,1))},vertexShader:`
            varying vec2 vUv;
			uniform bool flipY;
            void main(){
                vUv = uv;
				if (flipY)
					vUv.y = 1. - vUv.y;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
			uniform vec4 scale; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
				
				gl_FragColor.rgba *= scale.rgba;
            }`}));const n=Rg.uniforms;n.blitTexture.value=s,n.flipY.value=!1,n.scale.value=new Je(1,1,1,1),i!==void 0&&n.scale.value.copy(i),Rg.defines.IS_SRGB=s.colorSpace==bt,Rg.needsUpdate=!0,OS||(OS=new fe(_P,Rg),OS.frustumCulled=!1);const r=new Vt,o=new Ws;o.add(OS),t||(t=DS=new hu({antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}));const a=Math.min(s.image.width,e),l=Math.min(s.image.height,e);no&&(no.width!==a||no.height!==l)&&(no.dispose(),no=null),no||(no=new $t(a,l,{format:Li,type:wn,minFilter:Nt,magFilter:Nt})),t.setRenderTarget(no),t.setSize(a,l),t.clear(),t.render(o,r),DS&&(DS.dispose(),DS=null);const c=new Uint8ClampedArray(no.width*no.height*4);t.readRenderTargetPixels(no,0,0,no.width,no.height,c);const h=new ImageData(c,no.width,no.height,void 0),u=await createImageBitmap(h,{premultiplyAlpha:"none"});return{imageData:h,imageBitmap:u}}function yge(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&s instanceof ImageBitmap}async function vge(s,e=4096){const t=e/Math.max(s.width,s.height),i=s.width*Math.min(1,t),n=s.height*Math.min(1,t),r=new OffscreenCanvas(i,n),o={premultiplyAlpha:"none"};s.width!==i&&(o.resizeWidth=i),s.height!==n&&(o.resizeHeight=n);const a=await createImageBitmap(s,o),l=r.getContext("bitmaprenderer");return l&&l.transferFromImageBitmap(a),r}async function v7(s,e=void 0,t=!1,i=4096){if(yge(s)){const n=i/Math.max(s.width,s.height),r=new OffscreenCanvas(s.width*Math.min(1,n),s.height*Math.min(1,n)),o=r.getContext("2d",{alpha:!0,premultipliedAlpha:!1});if(!o)throw new Error("Could not get canvas 2D context");if(t===!0&&(o.translate(0,r.height),o.scale(1,-1)),o.drawImage(s,0,0,r.width,r.height),e!==void 0){const a=e.x,l=e.y,c=e.z,h=e.w,u=o.getImageData(0,0,r.width,r.height),f=u.data;for(let p=0;p<f.length;p+=4)f[p+0]=f[p+0]*a,f[p+1]=f[p+1]*l,f[p+2]=f[p+2]*c,f[p+3]=f[p+3]*h;o.putImageData(u,0,0)}return r}else throw new Error("NeedleUSDZExporter: No valid image data found. Unable to process texture.")}const Jn=7;function Age(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Needle Engine USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)
`}function _ge(s,e){let t=Age();return t+=s,dE(t)}function LS(s){return s.name.replace(/[-<>\(\)\[\]$%&\/\\\=\?\,\;]/g,"")+"_"+s.id}function WG(s){return Wl(s.name||"bone_"+s.uuid)}function UD(s,e){return Wl(s.name||"Geometry")+"_"+s.id}function rF(s){return Wl(s.name||"Material")+"_"+s.id}function Hy(s,e){let t=WG(s),i=s.parent;for(;i&&i!==e;)t=WG(i)+"/"+t,i=i.parent;return t}function A7(s,e,t){var f;if(s==null)return;ai.report("export-usdz-xforms",{message:"buildXform "+s.displayName||s.name,autoStep:!0});const i=s.matrix,n=s.geometry,r=s.material,o=s.camera,a=s.name;if(s.animations)for(const p of s.animations)t.animations.push(p);const l=by(i);i.determinant()<0&&console.warn("NeedleUSDZExporter: USDZ does not support negative scales",a);const c=n&&n.isBufferGeometry&&n.attributes.skinIndex!==void 0&&n.attributes.skinIndex.count>0,h=c?"SkelRoot":"Xform",u=new Array;if(e.appendLine(),n?(e.beginBlock(`def ${h} "${a}"`,"(",!1),t.quickLookCompatible&&r&&r.side===_i&&!c?e.appendLine(`prepend references = @./geometries/${UD(n)}.usda@</Geometry_doubleSided>`):e.appendLine(`prepend references = @./geometries/${UD(n)}.usda@</Geometry>`),u.push("MaterialBindingAPI"),c&&u.push("SkelBindingAPI")):o?e.beginBlock(`def Camera "${a}"`,"(",!1):s.type!==void 0?e.beginBlock(`def ${s.type} "${a}"`):e.beginBlock(`def Xform "${a}"`,"(",!1),s.displayName&&e.appendLine(`displayName = "${s.displayName}"`),s.type===void 0&&((f=s.extraSchemas)!=null&&f.length&&u.push(...s.extraSchemas),u.length&&e.appendLine(`prepend apiSchemas = [${u.map(p=>`"${p}"`).join(", ")}]`),e.closeBlock(")"),e.beginBlock()),n&&r){const p=rF(r);e.appendLine(`rel material:binding = </StageRoot/Materials/${p}>`),!t.quickLookCompatible&&r.side===_i&&(e.beginBlock('over "Geometry" '),e.appendLine("uniform bool doubleSided = 1"),e.closeBlock())}if(c?(e.appendLine("rel skel:skeleton = <Rig>"),e.appendLine("rel skel:animationSource = <Rig/_anim>"),e.appendLine(`matrix4d xformOp:transform = ${by(new le)}`)):s.type===void 0&&e.appendLine(`matrix4d xformOp:transform = ${l}`),s.type===void 0&&e.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]'),s.visibility!==void 0&&e.appendLine(`token visibility = "${s.visibility}"`),o&&("isOrthographicCamera"in o&&o.isOrthographicCamera?(e.appendLine(`float2 clippingRange = (${o.near}, ${o.far})`),e.appendLine(`float horizontalAperture = ${((Math.abs(o.left)+Math.abs(o.right))*10).toPrecision(Jn)}`),e.appendLine(`float verticalAperture = ${((Math.abs(o.top)+Math.abs(o.bottom))*10).toPrecision(Jn)}`),e.appendLine('token projection = "orthographic"')):"isPerspectiveCamera"in o&&o.isPerspectiveCamera&&(e.appendLine(`float2 clippingRange = (${o.near.toPrecision(Jn)}, ${o.far.toPrecision(Jn)})`),e.appendLine(`float focalLength = ${o.getFocalLength().toPrecision(Jn)}`),e.appendLine(`float focusDistance = ${o.focus.toPrecision(Jn)}`),e.appendLine(`float horizontalAperture = ${o.getFilmWidth().toPrecision(Jn)}`),e.appendLine('token projection = "perspective"'),e.appendLine(`float verticalAperture = ${o.getFilmHeight().toPrecision(Jn)}`))),s.onSerialize&&s.onSerialize(e,t),s.children){e.appendLine();for(const p of s.children)A7(p,e,t)}e.closeBlock()}function Fs(s){return Number.isInteger(s)?s.toString():s.toFixed(10)}function by(s){const e=s.elements;return`( ${kS(e,0)}, ${kS(e,4)}, ${kS(e,8)}, ${kS(e,12)} )`}function kS(s,e){return`(${Fs(s[e+0])}, ${Fs(s[e+1])}, ${Fs(s[e+2])}, ${Fs(s[e+3])})`}function bge(s,e=[],t=!0){return`
def "Geometry"
${xge(s,e,t)}
`}function xge(s,e=[],t=!0){const i="Geometry",n=s.attributes,r=n.position.count,o=e&&e.length>0,a=[],l=[];let c=new Array,h=n.skinIndex;if(o){const f=[];for(const v of e)v.parent.type!=="Bone"&&(a.push({bone:v,index:e.indexOf(v)}),f.push(v.uuid));for(;f.length<e.length;)for(const v of a){const g=v.bone.children;for(const y of g)f.indexOf(y.uuid)===-1&&e.indexOf(y)!==-1&&(a.push({bone:y,index:e.indexOf(y)}),f.push(y.uuid))}for(const v of d7(e))a.push({bone:v,index:a.length});const p=a[0].bone.parent;a.sort((v,g)=>Hy(v.bone,p)>Hy(g.bone,p)?1:-1),a.map(v=>'"'+Hy(v.bone,p)+'"').join(", ");for(const v in a)l[a[v].index]=parseInt(v);const m=n.skinIndex;c=new Array;for(let v=0;v<m.count;v++){const g=m.getX(v),y=m.getY(v),A=m.getZ(v),_=m.getW(v);c.push(l[g],l[y],l[A],l[_])}h=new Ke(new Uint16Array(c),4)}const u=n.skinWeight&&n.skinIndex;return`
{	
    def Mesh "${i}" ${u?`(
        prepend apiSchemas = ["SkelBindingAPI"]
    )`:""}
    {
        int[] faceVertexCounts = [${bP(s)}]
        int[] faceVertexIndices = [${xP(s)}]
		${n.normal||t?`normal3f[] normals = [${jG(n.normal,r)}] (
            interpolation = "vertex"
        )`:""}
        point3f[] points = [${jG(n.position,r)}]
        ${n.uv?`texCoord2f[] primvars:st = [${XG(n.uv,r)}] (
            interpolation = "vertex"
        )`:""}
		${n.uv2?`texCoord2f[] primvars:st2 = [${XG(n.uv2,r)}] (
            interpolation = "vertex"
        )`:""}
		${u?`matrix4d primvars:skel:geomBindTransform = ( (1, 0, 0, 0), (0, 1, 0, 0), (0, 0, 1, 0), (0, 0, 0, 1) ) (
				elementSize = 1
				interpolation = "constant"
			)`:""}
		${n.skinIndex?`int[] primvars:skel:jointIndices = [${qG(h,!0)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
		${n.skinWeight?`float[] primvars:skel:jointWeights = [${qG(n.skinWeight)}] (
			elementSize = 4
			interpolation = "vertex"
		)`:""}
        uniform token subdivisionScheme = "none"
    }
}
${t?`
# This is a workaround for QuickLook/RealityKit not supporting the doubleSided attribute. We're adding a second
# geometry definition here, that uses the same mesh data but appends extra faces with reversed winding order.
def "${i}_doubleSided" (
	prepend references = </Geometry>
)
{
	over "Geometry"
	{
		int[] faceVertexCounts = [${bP(s)+", "+bP(s)}]
		int[] faceVertexIndices = [${xP(s)+", "+xP(s,!0)}]
	}
}
`:""}
`}function bP(s){const e=s.index!==null?s.index.count:s.attributes.position.count;return Array(e/3).fill(3).join(", ")}function xP(s,e=!1){const t=s.index,i=[];if(t!==null)for(let n=0;n<t.count;n++){let r=n;e&&(r=n%3===0?n+2:n%3===2?n-2:n),i.push(t.getX(r))}else{const n=s.attributes.position.count;for(let r=0;r<n;r++){let o=r;e&&(o=r%3===0?r+2:r%3===2?r-2:r),i.push(o)}}return i.join(", ")}function jG(s,e){if(s===void 0)return console.warn("USDZExporter: Attribute is missing. Results may be undefined."),Array(e).fill("(0, 0, 1)").join(", ");const t=[];for(let i=0;i<s.count;i++){const n=s.getX(i),r=s.getY(i),o=s.getZ(i);t.push(`(${n.toPrecision(Jn)}, ${r.toPrecision(Jn)}, ${o.toPrecision(Jn)})`)}return t.join(", ")}function qG(s,e=!1){const t=[];for(let i=0;i<s.count;i++){const n=s.getX(i),r=s.getY(i),o=s.getZ(i),a=s.getW(i);t.push(`${e?n:n.toPrecision(Jn)}`),t.push(`${e?r:r.toPrecision(Jn)}`),t.push(`${e?o:o.toPrecision(Jn)}`),t.push(`${e?a:a.toPrecision(Jn)}`)}return t.join(", ")}function XG(s,e){if(s===void 0)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const t=[];for(let i=0;i<s.count;i++){const n=s.getX(i),r=s.getY(i);t.push(`(${n.toPrecision(Jn)}, ${1-r.toPrecision(Jn)})`)}return t.join(", ")}function wge(s,e,t=!1){const i=[];for(const n in s){const r=s[n];i.push(Sge(r,e,t))}return`
	def "Materials"
    {
${i.join("")}
    }`}function Sge(s,e,t=!1){var p;const i="                ",n=[],r=[],o=rF(s),a=new Set;function l(m){var v;return Wl(m.name)+"_"+(((v=m.source)==null?void 0:v.id)??m.id)}function c(m,v,g=void 0,y=void 0){const A=l(m),_=A+(y!==void 0&&y!==1?"_"+y:""),b=t&&y!==void 0&&y!==1,x=b?new Je(1,1,1,y):void 0;y===void 0&&(y=1),b&&(y=1),x&&x.w<=.05&&(x.w=.05),e[_]={texture:m,scale:x};const E=m.channel>0?"st"+m.channel:"st";a.add(m.channel);const M=_7.includes(m.format),T={1e3:"repeat",1001:"clamp",1002:"mirror"},R=m.repeat.clone(),w=m.offset.clone(),I=m.rotation,O=Math.sin(I),k=Math.cos(I);w.y=1-w.y-R.y,t?(R.x===0&&(R.x=1e-4),R.y===0&&(R.y=1e-4),w.x=w.x/R.x,w.y=w.y/R.y,w.x+=O/R.x,w.y+=k-1):(w.x+=O*R.x,w.y+=(1-k)*R.y);const B=R.x!=1||R.y!=1||w.x!=0||w.y!=0||I!=0,G=`${So}/${o}/${"uvReader_"+E}.outputs:result>`,L=`${So}/${o}/Transform2d_${v}.outputs:result>`,U=v!=="normal"&&g&&(g.r!==1||g.g!==1||g.b!==1||y!==1)||!1,z=v==="normal",j=s instanceof ws&&s.normalScale?s.normalScale.x*2:2,X=j.toFixed(Jn),re=(-1*(j/2)).toFixed(Jn),ce=(1-j).toFixed(Jn);return`
			${B?`def Shader "Transform2d_${v}" (
				sdrMetadata = {
					string role = "math"
				}
			)
			{
				uniform token info:id = "UsdTransform2d"
				float2 inputs:in.connect = ${G}
				float2 inputs:scale = ${KG(R)}
				float2 inputs:translation = ${KG(w)}
				float inputs:rotation = ${(I/Math.PI*180).toFixed(Jn)}
				float2 outputs:result
			}
			`:""}
			def Shader "${A}_${v}"
			{
				uniform token info:id = "UsdUVTexture"
				asset inputs:file = @textures/${_}.${M?"png":"jpg"}@
				token inputs:sourceColorSpace = "${m.colorSpace==="srgb"?"sRGB":"raw"}"
				float2 inputs:st.connect = ${B?L:G}
				${U?`
				float4 inputs:scale = (${g?g.r+", "+g.g+", "+g.b:"1, 1, 1"}, ${y})
				`:""}
				${z?`
				float4 inputs:scale = (${X}, ${X}, ${X}, 1)
				float4 inputs:bias = (${re}, ${re}, ${ce}, 0)
				`:""}
				token inputs:wrapS = "${T[m.wrapS]}"
				token inputs:wrapT = "${T[m.wrapT]}"
				float outputs:r
				float outputs:g
				float outputs:b
				float3 outputs:rgb
				${s.transparent||s.alphaTest>0?"float outputs:a":""}
			}`}let h=s.transparent||s.alphaTest?s.opacity:1,u=!1,f=!1;if(s instanceof No&&s.transmission!==void 0&&(h*=1-s.transmission*(1-s.roughness*.5)),s.map?(n.push(`${i}color3f inputs:diffuseColor.connect = ${So}/${o}/${l(s.map)}_diffuse.outputs:rgb>`),s instanceof ti&&s.transparent&&s.alphaTest==0&&t?(n.push(`${i}float inputs:opacity.connect = ${So}/${o}/${l(s.map)}_diffuse.outputs:a>`),u=!0,n.push(`${i}float inputs:opacityThreshold = ${1e-10}`),f=!0):s.transparent?(n.push(`${i}float inputs:opacity.connect = ${So}/${o}/${l(s.map)}_diffuse.outputs:a>`),u=!0):s.alphaTest>0&&(n.push(`${i}float inputs:opacity.connect = ${So}/${o}/${l(s.map)}_diffuse.outputs:a>`),u=!0,n.push(`${i}float inputs:opacityThreshold = ${s.alphaTest}`),f=!0),r.push(c(s.map,"diffuse",s.color,h))):n.push(`${i}color3f inputs:diffuseColor = ${YG(s.color)}`),s.alphaHash&&t&&(f?console.warn("Opacity threshold for "+s.name+" was already connected. Skipping alphaHash opacity threshold."):(n.push(`${i}float inputs:opacityThreshold = 0.0000000001`),f=!0)),s.aoMap&&(n.push(`${i}float inputs:occlusion.connect = ${So}/${o}/${l(s.aoMap)}_occlusion.outputs:r>`),r.push(c(s.aoMap,"occlusion"))),s.alphaMap?(n.push(`${i}float inputs:opacity.connect = ${So}/${o}/${l(s.alphaMap)}_opacity.outputs:r>`),n.push(`${i}float inputs:opacityThreshold = 0.0000000001`),u=!0,f=!0,r.push(c(s.alphaMap,"opacity",new Ae(1,1,1),h))):(u?console.warn("Opacity for "+s.name+" was already connected. Skipping default opacity."):(n.push(`${i}float inputs:opacity = ${h}`),u=!0),s.alphaTest>0&&(f?console.warn("Opacity threshold for "+s.name+" was already connected. Skipping default opacity threshold."):(n.push(`${i}float inputs:opacityThreshold = ${s.alphaTest}`),f=!0))),s instanceof ws){if(s.emissiveMap){n.push(`${i}color3f inputs:emissiveColor.connect = ${So}/${o}/${l(s.emissiveMap)}_emissive.outputs:rgb>`);const m=s.emissive.clone();m.multiplyScalar(s.emissiveIntensity),r.push(c(s.emissiveMap,"emissive",m))}else if(((p=s.emissive)==null?void 0:p.getHex())>0){const m=s.emissive.clone();m.multiplyScalar(s.emissiveIntensity),n.push(`${i}color3f inputs:emissiveColor = ${YG(m)}`)}s.normalMap&&(n.push(`${i}normal3f inputs:normal.connect = ${So}/${o}/${l(s.normalMap)}_normal.outputs:rgb>`),r.push(c(s.normalMap,"normal"))),s.roughnessMap&&s.roughness===1?(n.push(`${i}float inputs:roughness.connect = ${So}/${o}/${l(s.roughnessMap)}_roughness.outputs:g>`),r.push(c(s.roughnessMap,"roughness"))):n.push(`${i}float inputs:roughness = ${s.roughness!==void 0?s.roughness:1}`),s.metalnessMap&&s.metalness===1?(n.push(`${i}float inputs:metallic.connect = ${So}/${o}/${l(s.metalnessMap)}_metallic.outputs:b>`),r.push(c(s.metalnessMap,"metallic"))):n.push(`${i}float inputs:metallic = ${s.metalness!==void 0?s.metalness:0}`)}return s instanceof No&&(n.push(`${i}float inputs:clearcoat = ${s.clearcoat}`),n.push(`${i}float inputs:clearcoatRoughness = ${s.clearcoatRoughness}`),n.push(`${i}float inputs:ior = ${s.ior}`),!s.transparent&&!(s.alphaTest>0)&&s.transmissionMap&&(n.push(`${i}float inputs:opacity.connect = ${So}/${o}/${l(s.transmissionMap)}_transmission.outputs:r>`),r.push(c(s.transmissionMap,"transmission")))),a.size>2?console.warn("USDZExporter: Material "+s.name+" uses more than 2 UV channels. Currently, only UV0 and UV1 are supported."):a.size===2&&(!a.has(0)||!a.has(1))&&console.warn("USDZExporter: Material "+s.name+" uses UV channels other than 0 and 1. Currently, only UV0 and UV1 are supported."),`

		def Material "${o}" ${s.name?`(
			displayName = "${s.name}"
		)`:""}
		{
			token outputs:surface.connect = ${So}/${o}/PreviewSurface.outputs:surface>

			def Shader "PreviewSurface"
			{
				uniform token info:id = "UsdPreviewSurface"
${n.join(`
`)}
				int inputs:useSpecularWorkflow = ${s instanceof ti?"1":"0"}
				token outputs:surface
			}
${r.length>0?`
${a.has(0)?`
			def Shader "uvReader_st"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${a.has(1)?`
			def Shader "uvReader_st2"
			{
				uniform token info:id = "UsdPrimvarReader_float2"
				token inputs:varname = "st2"
				float2 inputs:fallback = (0.0, 0.0)
				float2 outputs:result
			}
`:""}
${r.join(`
`)}`:""}
		}`}function YG(s){return`(${s.r}, ${s.g}, ${s.b})`}function KG(s){return`(${s.x}, ${s.y})`}const _7=[1023,33777,33778,33779,35842,35843,37496,37808,37809,37810,37811,37812,37813,37814,37815,37816,37817,37818,37819,37820,37821,36492];ie("debugusdz");const OU=class{constructor(e,t,i){d(this,"id");d(this,"trigger");d(this,"action");d(this,"exclusive",!1);this.id="Behavior_"+Wl(e)+"_"+OU.global_id++,this.trigger=t,this.action=i}makeExclusive(e){return this.exclusive=e,this}writeTo(e,t,i){if(!this.trigger||!this.action)return;i.beginBlock(`def Preliminary_Behavior "${this.id}"`);let n="";if(Array.isArray(this.trigger)){n="[";for(let r=0;r<this.trigger.length;r++){const o=this.trigger[r];n+="<"+o.id+">",r+1<this.trigger.length&&(n+=", ")}n+="]"}else n=`<${this.trigger.id}>`;if(i.appendLine(`rel triggers = ${n}`),i.appendLine(`rel actions = <${this.action.id}>`),i.appendLine(`uniform bool exclusive = ${this.exclusive?1:0}`),i.appendLine(),Array.isArray(this.trigger))for(const r of this.trigger)r.writeTo(t,i),i.appendLine();else this.trigger.writeTo(t,i);i.appendLine(),this.action.writeTo(t,i),i.closeBlock()}};let cs=OU;d(cs,"global_id",0);const Pg=new Set;function ND(s,e){var i,n;let t="";if(Array.isArray(s)){Pg.clear();let r="[ ";for(let o=0;o<s.length;o++){let a=s[o];if(!a){console.warn("Invalid target object in behavior",s+". Is the object exported?");continue}if(typeof a=="string"){if(Pg.has(a))continue;r+=a,Pg.add(a)}else if(typeof a=="object"){if(a.isObject3D&&(a=e.findById(a.uuid),!a)){console.warn("Invalid target object in behavior",s+". Is the object exported?");continue}const l=(i=a.getPath)==null?void 0:i.call(a);if(Pg.has(l))continue;r+=l,Pg.add(l)}o+1<s.length&&(r+=", ")}r+=" ]",t=r,Pg.clear()}else typeof s=="object"&&(s.isObject3D&&(s=e.findById(s.uuid)),t=(n=s.getPath)==null?void 0:n.call(s));return t}const LU=class{constructor(e,t){d(this,"id");d(this,"targetId");d(this,"tokenId");d(this,"type");d(this,"distance");e&&(this.targetId=e),t?this.id=t:this.id="Trigger_"+LU.global_id++}writeTo(e,t){t.beginBlock(`def Preliminary_Trigger "${this.id}"`),this.targetId&&(typeof this.targetId!="string"&&(this.targetId=ND(this.targetId,e)),t.appendLine("rel affectedObjects = "+this.targetId)),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.type&&t.appendLine(`token type = "${this.type}"`),typeof this.distance=="number"&&t.appendLine(`double distance = ${this.distance}`),t.closeBlock()}};let iu=LU;d(iu,"global_id",0);function JG(s,e={direct:!0,indirect:!0}){const t=mr.createEmpty();t.name="InputTarget_"+t.name,t.displayName=void 0,t.type="RealityKitComponent",t.onSerialize=i=>{i.appendLine("bool allowsDirectInput = "+(e.direct?1:0)),i.appendLine("bool allowsIndirectInput = "+(e.indirect?1:0)),i.appendLine('uniform token info:id = "RealityKit.InputTarget"')},s.add(t)}class Qs{static sceneStartTrigger(){const e=new iu;return e.targetId=void 0,e.tokenId="SceneTransition",e.type="enter",e}static tapTrigger(e,t={direct:!0,indirect:!0}){const i=new iu(e);if(Array.isArray(e)&&e.length>1)for(const n of e)n instanceof mr&&JG(n,t);else e instanceof mr&&JG(e,t);return i.tokenId="TapGesture",i}static isTapTrigger(e){return(e==null?void 0:e.tokenId)==="TapGesture"}static proximityToCameraTrigger(e,t){const i=new iu(e);return i.tokenId="ProximityToCamera",i.distance=t,i}}class bd{constructor(e,t){d(this,"id");d(this,"actions");d(this,"loops",0);d(this,"performCount",1);d(this,"type","serial");d(this,"multiplePerformOperation");this.id=e,this.actions=t}static getId(){return this.global_id++}addAction(e){return this.actions.push(e),this}makeParallel(){return this.type="parallel",this}makeSequence(){return this.type="serial",this}makeLooping(){return this.loops=1,this.performCount=0,this}makeRepeat(e){return this.performCount=e,this}writeTo(e,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),t.beginArray("rel actions");for(const i of this.actions){if(!i)continue;const n=i===this.actions[this.actions.length-1];t.appendLine("<"+i.id+">"+(n?"":", "))}t.closeArray(),t.appendLine(),t.appendLine('token info:id = "Group"'),t.appendLine(`bool loops = ${this.loops}`),t.appendLine(`int performCount = ${this.loops>0?0:Math.max(0,this.performCount)}`),t.appendLine(`token type = "${this.type}"`),typeof this.multiplePerformOperation=="string"&&t.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),t.appendLine();for(const i of this.actions)i&&(i.writeTo(e,t),t.appendLine());t.closeBlock()}}d(bd,"global_id",0);const LE=class{constructor(e,t){d(this,"id");d(this,"tokenId");d(this,"affectedObjects");d(this,"easeType");d(this,"motionType");d(this,"duration");d(this,"moveDistance");d(this,"style");d(this,"type");d(this,"front");d(this,"up");d(this,"start");d(this,"animationSpeed");d(this,"reversed");d(this,"pingPong");d(this,"xFormTarget");d(this,"audio");d(this,"gain");d(this,"auralMode");d(this,"multiplePerformOperation");d(this,"velocity");e&&(this.affectedObjects=e),t?this.id=t:this.id="Action",this.id+="_"+LE.global_id++}clone(){const e=new LE,t=e.id;return Object.assign(e,this),e.id=t,e}writeTo(e,t){t.beginBlock(`def Preliminary_Action "${this.id}"`),this.affectedObjects&&(typeof this.affectedObjects!="string"&&(this.affectedObjects=ND(this.affectedObjects,e)),t.appendLine("rel affectedObjects = "+this.affectedObjects)),typeof this.duration=="number"&&(typeof this.animationSpeed=="number"&&this.animationSpeed!==1?t.appendLine(`double duration = ${this.duration/this.animationSpeed} `):t.appendLine(`double duration = ${this.duration} `)),this.easeType&&t.appendLine(`token easeType = "${this.easeType}"`),this.tokenId&&t.appendLine(`token info:id = "${this.tokenId}"`),this.tokenId==="ChangeScene"&&t.appendLine("rel scene = </StageRoot/Scenes/Scene>"),this.motionType!==void 0&&t.appendLine(`token motionType = "${this.motionType}"`),typeof this.moveDistance=="number"&&t.appendLine(`double moveDistance = ${this.moveDistance} `),this.style&&t.appendLine(`token style = "${this.style}"`),this.type&&t.appendLine(`token type = "${this.type}"`),this.front&&t.appendLine(`vector3d front = (${this.front.x}, ${this.front.y}, ${this.front.z})`),this.up&&t.appendLine(`vector3d upVector = (${this.up.x}, ${this.up.y}, ${this.up.z})`),typeof this.start=="number"&&t.appendLine(`double start = ${this.start} `),typeof this.animationSpeed=="number"&&t.appendLine(`double animationSpeed = ${this.animationSpeed.toFixed(2)} `),typeof this.reversed=="boolean"&&t.appendLine(`bool reversed = ${this.reversed}`),typeof this.pingPong=="boolean"&&t.appendLine(`bool reverses = ${this.pingPong}`),this.xFormTarget&&(typeof this.xFormTarget!="string"&&(this.xFormTarget=ND(this.xFormTarget,e)),t.appendLine(`rel xformTarget = ${this.xFormTarget}`)),typeof this.audio=="string"&&t.appendLine(`asset audio = @${this.audio}@`),typeof this.gain=="number"&&t.appendLine(`double gain = ${this.gain}`),typeof this.auralMode=="string"&&t.appendLine(`token auralMode = "${this.auralMode}"`),typeof this.multiplePerformOperation=="string"&&t.appendLine(`token multiplePerformOperation = "${this.multiplePerformOperation}"`),typeof this.velocity=="object"&&t.appendLine(`vector3d velocity = (${this.velocity.x}, ${this.velocity.y}, ${this.velocity.z})`),t.closeBlock()}};let Ro=LE;d(Ro,"global_id",0);let xy=class ny{constructor(e,t,i){d(this,"x",0);d(this,"y",0);d(this,"z",0);this.x=e,this.y=t,this.z=i}static get up(){return new ny(0,1,0)}static get right(){return new ny(1,0,0)}static get forward(){return new ny(0,0,1)}static get back(){return new ny(0,0,-1)}static get zero(){return new ny(0,0,0)}};class Ai{static sequence(...e){return new bd("Group_"+bd.getId(),e).makeSequence()}static parallel(...e){return new bd("Group_"+bd.getId(),e).makeParallel()}static fadeAction(e,t,i){const n=new Ro(e);return n.tokenId="Visibility",n.type=i?"show":"hide",n.duration=t,n.style="basic",n.motionType="none",n.moveDistance=0,n.easeType="none",n}static startAnimationAction(e,t,i=0,n=1,r=!1,o=!1){const a=new Ro(e);if(a.tokenId="StartAnimation",a.start=t,a.duration=i,a.animationSpeed=n,a.reversed=r,a.pingPong=o,a.multiplePerformOperation="allow",r&&(a.start-=i),o){a.pingPong=!1;const l=a.clone();return l.reversed=!r,l.start=a.start,l.reversed&&(l.start-=i),Ai.sequence(a,l)}return a}static waitAction(e){const t=new Ro;return t.tokenId="Wait",t.duration=e,t.motionType=void 0,t}static lookAtCameraAction(e,t,i,n){const r=new Ro(e);return r.tokenId="LookAtCamera",r.duration=t===void 0?9999999999999:t,r.front=i??xy.forward,r.up=n??xy.up,r}static emphasize(e,t,i="bounce",n=1,r="basic"){const o=new Ro(e);return o.tokenId="Emphasize",o.duration=t,o.style=r??"basic",o.motionType=i,o.moveDistance=n,o}static transformAction(e,t,i,n,r="inout"){const o=new Ro(e);return o.tokenId="Transform",o.duration=i,o.duration=Math.max(1e-6,i),o.type=n,o.easeType=i>0?r:"none",Array.isArray(t)&&console.error("Transform target must not be an array",t),o.xFormTarget=t,o}static playAudioAction(e,t,i="play",n=1,r="spatial"){const o=new Ro(e);return o.tokenId="Audio",o.type=i,o.audio=t,o.gain=n,o.auralMode=r,o.multiplePerformOperation="allow",o}static impulseAction(e,t){const i=new Ro(e);return i.tokenId="Impulse",i.velocity=t,i}}class Cge{constructor(e){d(this,"object");d(this,"model");this.object=e}get id(){return this.object.uuid}apply(e){if(!this.model&&(this.model=e.findById(this.object.uuid),!this.model)){console.error("could not find model with id "+this.object.uuid);return}this.onApply(e)}}class oF extends Cge{constructor(t,i,n,r){super(t);d(this,"matrix");d(this,"material");d(this,"geometry");d(this,"_enableAction");d(this,"_disableAction");this.matrix=i,this.material=n,this.geometry=r}onApply(t){var r,o;const i=this.model;if(!i)return;(r=i.parent)!=null&&r.isDynamic||mr.createEmptyParent(i);const n=i.clone();this.matrix&&(n.matrix=this.matrix),this.material&&(n.material=this.material),this.geometry&&(n.geometry=this.geometry),(o=i.parent)==null||o.add(n)}enable(){return this._enableAction?this._enableAction:(this._enableAction=Ai.fadeAction(this.object,0,!0),this._enableAction)}disable(){return this._disableAction?this._disableAction:(this._disableAction=Ai.fadeAction(this.object,0,!1),this._disableAction)}}class aF{constructor(e){d(this,"actions");d(this,"sortedActions");this.actions=[...e]}organize(){this.sortedActions={};for(const e of this.actions){const t=e.id;this.sortedActions[t]||(this.sortedActions[t]=[]),this.sortedActions[t].push(e)}}getActions(e){return this.sortedActions||this.organize(),this.sortedActions[e.uuid]}}const Dv=function(s){return C(s)},C=function(s){if(s===void 0&&(s=null),!Array.isArray(s))s=ZG(s);else for(let e=0;e<s.length;e++){const t=s[e];s[e]=ZG(t)}return function(e,t){typeof t!="string"&&(t=t.name),Object.getOwnPropertyDescriptor(e,"$serializedTypes")||(e.$serializedTypes={});const i=e.$serializedTypes=e.$serializedTypes||{};i[t]=s}};function ZG(s){var e,t;switch((t=(e=s==null?void 0:s.prototype)==null?void 0:e.constructor)==null?void 0:t.name){case"Number":case"String":case"Boolean":return null}return s}class ne extends ye{constructor(){super(...arguments);d(this,"guid")}static isDestroyed(t){return am(t)}static setActive(t,i,n=!0){t&&(r_(t,i),a1(t),i&&n&&e9(Dt.Current,t))}static isActiveSelf(t){return Pv(t)}static isActiveInHierarchy(t){return w9(t)}static markAsInstancedRendered(t,i){S9(t,i)}static isUsingInstancing(t){return ZM(t)}static foreachComponent(t,i,n=!0){return lm(t,i,n)}static instantiateSynced(t,i){return t?Qk(t,i):null}static instantiate(t,i=null){return Bv(t,i)}static destroySynced(t,i,n=!0){if(!t)return;const r=t;i=i??Dt.Current,Kb(r,i.connection,n)}static destroy(t,i=!0){return xa(t,i)}static add(t,i,n){if(!(!t||!i)){if(t===i){console.warn("Can not add object to self",t);return}n||(n=Dt.Current),i.add(t),r_(t,!0),a1(t),n?ne.foreachComponent(t,r=>{Hk(r,n),!r.__internalDidAwakeAndStart&&n.new_script_start.includes(r)===!1&&n.new_script_start.push(r)},!0):console.warn("Missing context")}}static remove(t){var i;t&&((i=t.parent)==null||i.remove(t),r_(t,!1),a1(t),ne.foreachComponent(t,n=>{lfe(n)},!0))}static invokeOnChildren(t,i,...n){this.invoke(t,i,!0,n)}static invoke(t,i,n=!1,...r){t&&this.foreachComponent(t,o=>{const a=o[i];a&&typeof a=="function"&&(a==null||a.call(o,...r))},n)}static addNewComponent(t,i,n,r=!0){return va(t,i,n,{callAwake:r})}static addComponent(t,i,n,r){return va(t,i,n,r)}static moveComponent(t,i){return va(t,i)}static removeComponent(t){return Yk(t.gameObject,t),t}static getOrAddComponent(t,i){return Zb(t,i)}static getComponent(t,i){return t===null?null:ym(t,i)}static getComponents(t,i,n=null){return t===null?n??[]:$b(t,i,n)}static findByGuid(t,i){return tx(t,i)}static findObjectOfType(t,i,n=!0){return KM(t,i??Dt.Current,n)}static findObjectsOfType(t,i){const n=[];return b9(t,n,i),n}static getComponentInChildren(t,i){return ex(t,i)}static getComponentsInChildren(t,i,n=null){return Rv(t,i,n??void 0)}static getComponentInParent(t,i){return Z_(t,i)}static getComponentsInParent(t,i,n=null){return YM(t,i,n)}static getAllComponents(t){var r;return[...(r=t.userData)==null?void 0:r.components]}static*iterateComponents(t){var n;const i=(n=t==null?void 0:t.userData)==null?void 0:n.components;if(i&&Array.isArray(i))for(let r=0;r<i.length;r++)yield i[r]}}var wc;let Ie=(wc=class{constructor(e){d(this,"__context");d(this,"__name");d(this,"gameObject");d(this,"guid","invalid");d(this,"sourceId");d(this,"__didAwake",!1);d(this,"__didStart",!1);d(this,"__didEnable",!1);d(this,"__isEnabled");d(this,"__destroyed",!1);d(this,"_eventListeners",new Map);this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(e)}get isComponent(){return!0}get context(){return this.__context??Dt.Current}set context(e){this.__context=e}get scene(){return this.context.scene}get layer(){var e,t;return(t=(e=this.gameObject)==null?void 0:e.userData)==null?void 0:t.layer}get name(){var e,t;return(e=this.gameObject)!=null&&e.name?this.gameObject.name:(t=this.gameObject)==null?void 0:t.userData.name}set name(e){this.gameObject?(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.name=e,this.__name=e):this.__name=e}get tag(){var e;return(e=this.gameObject)==null?void 0:e.userData.tag}set tag(e){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.tag=e)}get static(){var e;return(e=this.gameObject)==null?void 0:e.userData.static}set static(e){this.gameObject&&(this.gameObject.userData||(this.gameObject.userData={}),this.gameObject.userData.static=e)}get hideFlags(){var e;return(e=this.gameObject)==null?void 0:e.userData.hideFlags}get activeAndEnabled(){return!(this.destroyed||this.__isEnabled===!1||!this.__isActiveInHierarchy)}get __isActive(){return this.gameObject.visible}get __isActiveInHierarchy(){if(!this.gameObject)return!1;const e=this.gameObject[$h];return e===void 0?!0:e}set __isActiveInHierarchy(e){this.gameObject&&(this.gameObject[$h]=e)}awake(){}onEnable(){}onDisable(){}onDestroy(){this.__destroyed=!0}startCoroutine(e,t=nn.Update){return this.context.registerCoroutineUpdate(this,e,t)}stopCoroutine(e,t=nn.Update){this.context.unregisterCoroutineUpdate(e,t)}get destroyed(){return this.__destroyed}destroy(){this.__destroyed||this.__internalDestroy()}get __internalDidAwakeAndStart(){return this.__didAwake&&this.__didStart}__internalNewInstanceCreated(e){return this.__didAwake=!1,this.__didStart=!1,this.__didEnable=!1,this.__isEnabled=void 0,this.__destroyed=!1,this._internalInit(e),this}_internalInit(e){if(typeof e=="object")for(const t of Object.keys(e)){const i=e[t];typeof i!="function"&&(this[t]=i)}}__internalAwake(){this.__didAwake||(this.__didAwake=!0,this.awake())}__internalStart(){this.__didStart||(this.__didStart=!0,this.start&&this.start())}__internalEnable(e){return this.__destroyed?(nt()&&console.warn("[Needle Engine Dev] Trying to enable destroyed component"),!1):this.__didAwake?this.__didEnable?(e!==!0&&(this.__isEnabled=!0),!1):(this.__didEnable=!0,this.__isEnabled=!0,this.onEnable(),!0):!1}__internalDisable(e){if(this.__didAwake){if(!this.__didEnable){e!==!0&&(this.__isEnabled=!1);return}this.__didEnable=!1,this.__isEnabled=!1,this.onDisable()}}__internalDestroy(){var e;this.__destroyed||(this.__destroyed=!0,this.__didAwake&&((e=this.onDestroy)==null||e.call(this),this.dispatchEvent(new CustomEvent("destroyed",{detail:this}))),A9(this))}get enabled(){return typeof this.__isEnabled=="boolean"?this.__isEnabled:!0}set enabled(e){if(this.__destroyed){nt()&&console.warn(`[Needle Engine Dev] Trying to ${e?"enable":"disable"} destroyed component`);return}if(typeof e=="number"&&(e>=.5?e=!0:e=!1),!this.__didAwake){this.__isEnabled=e;return}e?this.__internalEnable():this.__internalDisable()}get worldPosition(){return Ft(this.gameObject)}set worldPosition(e){Es(this.gameObject,e)}setWorldPosition(e,t,i){rm(this.gameObject,e,t,i)}get worldQuaternion(){return ki(this.gameObject)}set worldQuaternion(e){rl(this.gameObject,e)}setWorldQuaternion(e,t,i,n){ZL(this.gameObject,e,t,i,n)}get worldEuler(){return ek(this.gameObject)}set worldEuler(e){tk(this.gameObject,e)}get worldRotation(){return this.gameObject.worldRotation}set worldRotation(e){this.setWorldRotation(e.x,e.y,e.z,!0)}setWorldRotation(e,t,i,n=!0){Hb(this.gameObject,e,t,i,n)}get forward(){return wc._forward.set(0,0,-1).applyQuaternion(this.worldQuaternion)}get right(){return wc._right.set(1,0,0).applyQuaternion(this.worldQuaternion)}get up(){return wc._up.set(0,1,0).applyQuaternion(this.worldQuaternion)}addEventListener(e,t){this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].push(t)}removeEventListener(e,t){if(!this._eventListeners[e])return;const i=this._eventListeners[e].indexOf(t);i>=0&&this._eventListeners[e].splice(i,1)}dispatchEvent(e){if(!e||!this._eventListeners[e.type])return!1;const t=this._eventListeners[e.type];for(let i=0;i<t.length;i++)t[i](e);return!1}},d(wc,"_forward",new S),d(wc,"_right",new S),d(wc,"_up",new S),wc);const Ege=Object.freeze(Object.defineProperty({__proto__:null,Behaviour:Ie,Component:Ie,GameObject:ne},Symbol.toStringTag,{value:"Module"}));var Mge=Object.defineProperty,Tge=Object.getOwnPropertyDescriptor,b7=(s,e,t,i)=>{for(var n=i>1?void 0:i?Tge(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Mge(e,t,n),n};class nx extends Ie{constructor(){super(...arguments);d(this,"from");d(this,"to");d(this,"width",0);d(this,"centered",!0);d(this,"_centerPos")}awake(){this._centerPos=new S}update(){if(!this.from||!this.to)return;const t=Ft(this.from).clone(),i=Ft(this.to).clone(),n=t.distanceTo(i);this._centerPos.copy(t),this._centerPos.add(i),this._centerPos.multiplyScalar(.5),Es(this.gameObject,this.centered?this._centerPos:t),this.gameObject.lookAt(Ft(this.to).clone()),this.gameObject.scale.set(this.width,this.width,n)}}b7([C(ne)],nx.prototype,"from",2);b7([C(ne)],nx.prototype,"to",2);var Ige=Object.defineProperty,Rge=Object.getOwnPropertyDescriptor,Am=(s,e,t,i)=>{for(var n=i>1?void 0:i?Rge(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Ige(e,t,n),n};const qu=ie("debuganimation");let x7=class{constructor(){d(this,"x");d(this,"y")}};class Wr extends Ie{constructor(){super(...arguments);d(this,"playAutomatically",!0);d(this,"randomStartTime",!0);d(this,"minMaxSpeed");d(this,"minMaxOffsetNormalized");d(this,"loop",!0);d(this,"clampWhenFinished",!1);d(this,"_tempAnimationClipBeforeGameObjectExisted",null);d(this,"_tempAnimationsArray");d(this,"mixer");d(this,"_actions");d(this,"_handles")}get isAnimationComponent(){return!0}addClip(t){this.animations||(this.animations=[]),this.animations.push(t)}get time(){if(this.actions){for(const t of this.actions)if(t.isRunning())return t.time}return 0}set time(t){if(this.actions)for(const i of this.actions)i.time=t}get clip(){var t;return(t=this.animations)!=null&&t.length?this.animations[0]:null}set clip(t){if(!this.__didAwake){qu&&console.warn("Assign clip during serialization",t),this._tempAnimationClipBeforeGameObjectExisted=t;return}t&&(this.gameObject.animations||(this.gameObject.animations=[]),!this.animations.includes(t)&&(this.animations.length>0?this.animations.splice(0,0,t):this.animations.push(t)))}set clips(t){this.animations=t}set animations(t){t==null||!Array.isArray(t)||(this.gameObject?this.gameObject.animations=t:this._tempAnimationsArray=t)}get animations(){return this.gameObject.animations||this._tempAnimationsArray||[]}get actions(){return this._actions}set actions(t){this._actions=t}awake(){qu&&console.log("Animation Awake",this.name,this),this._tempAnimationsArray&&(this.animations=this._tempAnimationsArray,this._tempAnimationsArray=void 0),this._tempAnimationClipBeforeGameObjectExisted&&(this.clip=this._tempAnimationClipBeforeGameObjectExisted,this._tempAnimationClipBeforeGameObjectExisted=null),this.actions=[],this._handles=[]}onEnable(){var t;if(this.playAutomatically&&((t=this.animations)==null?void 0:t.length)>0){const i=Math.floor(Math.random()*this.animations.length),n=this.animations[i];this.play(i,{exclusive:!0,fadeDuration:0,startTime:this.randomStartTime?Math.random()*n.duration:0,loop:this.loop,clampWhenFinished:this.clampWhenFinished})}}update(){this.mixer&&(this.mixer.update(this.context.time.deltaTime),this._handles.forEach(t=>t.update()))}onDisable(){this.mixer&&(this.mixer.stopAllAction(),this.mixer=void 0)}onDestroy(){this.context.animations.unregisterAnimationMixer(this.mixer)}getAction(t){var i;return((i=this.actions)==null?void 0:i.find(n=>n.getClip().name===t))||null}get isPlaying(){if(this.actions){for(let t=0;t<this.actions.length;t++)if(this.actions[t].isRunning())return!0}return!1}stopAll(t){if(this.actions)for(const i of this.actions)t!=null&&t.fadeDuration?i.fadeOut(t.fadeDuration):i.stop()}stop(t,i){if(t===void 0){this.stopAll();return}else if(typeof t=="number"){if(t>=this.animations.length){qu&&console.log("No animation at index",t);return}t=this.animations[t]}else typeof t=="string"&&(t=this.animations.find(r=>r.name===t));if(!t){console.error("Could not find clip",t);return}const n=this.actions.find(r=>r.getClip()===t);if(!n){console.error("Could not find action",t);return}i!=null&&i.fadeDuration?n.fadeOut(i.fadeDuration):n.stop()}pause(t,i=!1){if(t===void 0){for(const r of this.actions)r.paused=!i;return}else if(typeof t=="number"){if(t>=this.animations.length){qu&&console.log("No animation at index",t);return}t=this.animations[t]}else typeof t=="string"&&(t=this.animations.find(r=>r.name===t));if(!t){console.error("Could not find clip",t);return}const n=this.actions.find(r=>r.getClip()===t);if(!n){console.error("Could not find action",t);return}n.paused=!i}resume(){for(const t of this.actions)t.paused=!1}play(t=0,i){if(qu&&console.log("PLAY",t),this.ensureMixer(),!this.mixer){qu&&console.warn("Missing mixer",this);return}t===void 0&&(t=0);let n=t;if(typeof t=="number"){if(t>=this.animations.length){qu&&console.log("No animation at index",t);return}n=this.animations[t]}else typeof t=="string"&&(n=this.animations.find(o=>o.name===t));if(!n){console.error("Could not find clip",t);return}i||(i={});for(const o of this.actions)if(o.getClip()===n)return this.internalOnPlay(o,i);if(!n.tracks){console.warn("Clip is no AnimationClip",n);return}const r=this.mixer.clipAction(n);return this.actions.push(r),this.internalOnPlay(r,i)}internalOnPlay(t,i){var n=this.actions.find(a=>a===t);if(n===t&&n.isRunning()&&n.time<n.getClip().duration){const a=this.tryFindHandle(t);if(n.paused&&(n.paused=!1),a)return a.waitForFinish()}if(i.loop===void 0&&(i.loop=this.loop),i.clampWhenFinished===void 0&&(i.clampWhenFinished=this.clampWhenFinished),i.minMaxOffsetNormalized===void 0&&this.randomStartTime&&(i.minMaxOffsetNormalized=this.minMaxOffsetNormalized),i.minMaxSpeed===void 0&&(i.minMaxSpeed=this.minMaxSpeed),(i==null?void 0:i.exclusive)??!0)for(const a of this.actions)a!=n&&(i.fadeDuration?a.fadeOut(i.fadeDuration):a.stop());if(i!=null&&i.fadeDuration&&t.fadeIn(i.fadeDuration),t.enabled=!0,(i==null?void 0:i.startTime)!=null)t.time=i.startTime;else if(i!=null&&i.minMaxOffsetNormalized&&i.minMaxOffsetNormalized.x!=0&&i.minMaxOffsetNormalized.y!=0){const a=t.getClip();t.time=it.lerp(i.minMaxOffsetNormalized.x,i.minMaxOffsetNormalized.y,Math.random())*a.duration}else t.time>=t.getClip().duration&&(t.time=0);i!=null&&i.minMaxSpeed?t.timeScale=it.lerp(i.minMaxSpeed.x,i.minMaxSpeed.y,Math.random()):t.timeScale=(i==null?void 0:i.speed)??1,(i==null?void 0:i.loop)!=null?t.loop=i.loop?UO:w_:t.loop=w_,i!=null&&i.clampWhenFinished&&(t.clampWhenFinished=!0),t.paused=!1,t.play(),qu&&console.log("PLAY",t.getClip().name,t);const o=new Pge(t,this.mixer,i,a=>{this._handles.splice(this._handles.indexOf(o),1)});return this._handles.push(o),o.waitForFinish()}tryFindHandle(t){for(const i of this._handles)if(i.action===t)return i}ensureMixer(){if(!this.mixer){const t="animationMixer";this.gameObject[t]&&(this.mixer=this.gameObject[t]),(!this.mixer||!this.mixer.clipAction)&&(this.mixer=new wM(this.gameObject),this.gameObject[t]=this.mixer)}this.context.animations.registerAnimationMixer(this.mixer)}}Am([C()],Wr.prototype,"playAutomatically",2);Am([C()],Wr.prototype,"randomStartTime",2);Am([C(x7)],Wr.prototype,"minMaxSpeed",2);Am([C(x7)],Wr.prototype,"minMaxOffsetNormalized",2);Am([C()],Wr.prototype,"loop",2);Am([C()],Wr.prototype,"clampWhenFinished",2);Am([C(go)],Wr.prototype,"clips",1);class Pge{constructor(e,t,i,n){d(this,"mixer");d(this,"action");d(this,"promise",null);d(this,"_options");d(this,"_resolveCallback",null);d(this,"_resolvedOrRejectedCallback");d(this,"onLoop",e=>{});d(this,"onFinished",e=>{e.action===this.action&&this.onResolve()});this.action=e,this.mixer=t,this._resolvedOrRejectedCallback=n,this._options=i}waitForFinish(){return this.promise?this.promise:(this.promise=new Promise(e=>{this._resolveCallback=e}),this.mixer.addEventListener("loop",this.onLoop),this.mixer.addEventListener("finished",this.onFinished),this.promise)}update(){this._options&&this._options.endTime!==void 0&&this.action.time>this._options.endTime&&(this._options.loop===!0?this.action.time=this._options.startTime??0:(this.action.time=this._options.endTime,this.action.timeScale=0,this.onResolve()))}onResolve(){var e,t;this.dispose(),(e=this._resolvedOrRejectedCallback)==null||e.call(this,this),(t=this._resolveCallback)==null||t.call(this,this.action)}dispose(){this.mixer.removeEventListener("loop",this.onLoop),this.mixer.removeEventListener("finished",this.onFinished)}}var Bge=Object.defineProperty,Dge=Object.getOwnPropertyDescriptor,lf=(s,e,t,i)=>{for(var n=i>1?void 0:i?Dge(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Bge(e,t,n),n};class ul{constructor(){d(this,"time");d(this,"value");d(this,"inTangent");d(this,"inWeight");d(this,"outTangent");d(this,"outWeight");d(this,"weightedMode")}}lf([C()],ul.prototype,"time",2);lf([C()],ul.prototype,"value",2);lf([C()],ul.prototype,"inTangent",2);lf([C()],ul.prototype,"inWeight",2);lf([C()],ul.prototype,"outTangent",2);lf([C()],ul.prototype,"outWeight",2);lf([C()],ul.prototype,"weightedMode",2);const zD=class{constructor(){d(this,"keys")}clone(){var e;const s=new zD;return s.keys=((e=this.keys)==null?void 0:e.map(t=>{const i=new ul;return i.time=t.time,i.value=t.value,i.inTangent=t.inTangent,i.inWeight=t.inWeight,i.outTangent=t.outTangent,i.outWeight=t.outWeight,i.weightedMode=t.weightedMode,i}))||[],s}get duration(){return!this.keys||this.keys.length==0?0:this.keys[this.keys.length-1].time}evaluate(s){if(!this.keys||this.keys.length==0)return 0;if(this.keys[0].time>=s)return this.keys[0].value;for(let e=0;e<this.keys.length;e++){const t=this.keys[e];if(t.time<=s)if(e+1<this.keys.length){const n=this.keys[e+1];if(n.time<s)continue;return!isFinite(t.outTangent)||!isFinite(n.inTangent)?t.value:zD.interpolateValue(s,t,n)}else return t.value}return this.keys[this.keys.length-1].value}static interpolateValue(s,e,t){const i=e.time,n=e.value,r=e.outTangent,o=t.time,a=t.value,l=t.inTangent,c=o-i,h=c*c,u=h*c,f=((r+l)*c-2*(a-n))/u,p=(3*(a-n)-(l+2*r)*c)/h,m=r,v=n,g=s-i,y=g*g,A=y*g;return f*A+p*y+m*g+v}};let _m=zD;lf([C(ul)],_m.prototype,"keys",2);class _c{constructor(e,t,i,n){d(this,"enabled",!0);d(this,"target");d(this,"methodName");d(this,"arguments");this.target=e,this.methodName=t||null,this.arguments=i,n!=null&&(this.enabled=n)}get canClone(){return this.target instanceof Object}invoke(...e){if(this.enabled!==!1){if(typeof this.target=="function")this.arguments?this.target(...this.arguments,...e):this.target(...e);else if(this.methodName!=null){const t=this.target[this.methodName];typeof t=="function"?this.arguments?t.call(this.target,...this.arguments,...e):t.call(this.target,...e):this.arguments?this.target[this.methodName]=this.arguments[0]||e[0]:this.target[this.methodName]=e[0]}}}}const Oge=s=>/^[A-Z]*$/.test(s);class oT extends Event{constructor(){super(...arguments);d(this,"args")}}class Sn{constructor(e){d(this,"isEventList",!0);d(this,"target");d(this,"key");d(this,"_isInvoking",!1);d(this,"methods",[]);d(this,"_methodsCopy",[]);if(this.methods=[],Array.isArray(e))for(const t of e)t instanceof _c?this.methods.push(t):typeof t=="function"&&this.methods.push(new _c(t));else typeof e=="function"&&this.methods.push(new _c(e))}__internalOnInstantiate(e){var n;const t=new Array;for(let r=0;r<this.methods.length;r++){const o=this.methods[r];if(!(o.target instanceof Function)){const a=o.target;let l=a==null?void 0:a.uuid;if(a&&(l=a.guid),l){const c=e[l];if(c){const h=(n=o.arguments)==null?void 0:n.map(u=>u instanceof Object&&u.uuid?e[u.uuid]:u!=null&&u.isComponent?e[u.guid]:u);t.push(new _c(c.clone,o.methodName,h,o.enabled))}else nt()&&console.warn("Could not find target for event listener")}}}return new Sn(t)}setEventTarget(e,t){if(this.key=e,this.target=t,this.key!==void 0){let i="",n=!1;for(const r of this.key)n&&Oge(r)&&(i+="-"),n=!0,i+=r.toLowerCase();this.key=i}}get listenerCount(){var e;return((e=this.methods)==null?void 0:e.length)??0}get isInvoking(){return this._isInvoking}static from(...e){return new Sn(e)}invoke(...e){var t;if(this._isInvoking)return console.warn("Circular event invocation detected. Please check your event listeners for circular references.",this),!1;if(((t=this.methods)==null?void 0:t.length)<=0)return!1;this._isInvoking=!0;try{this._methodsCopy.length=0,this._methodsCopy.push(...this.methods);for(const i of this._methodsCopy)i.invoke(...e);if(typeof this.target=="object"&&typeof this.key=="string"){const i=this.target.dispatchEvent;if(typeof i=="function"){const n=new oT(this.key);n.args=e,i.call(this.target,n)}}}finally{this._isInvoking=!1,this._methodsCopy.length=0}return!0}addEventListener(e){return this.methods.push(new _c(e)),e}removeEventListener(e){if(e)for(let t=this.methods.length-1;t>=0;t--)this.methods[t].target===e&&(this.methods[t].enabled=!1,this.methods.splice(t,1))}removeAllEventListeners(){this.methods.length=0}}const $G=Symbol("previous-visibility"),My=class extends $t{render(e,t,i){if(i instanceof ak)this._unsupported_effectcomposer_warning||(console.warn("RenderTexture.render() does not yet support EffectComposer"),this._unsupported_effectcomposer_warning=!0);else{this.onBeforeRender();const n=i.getRenderTarget(),r=i.xr.enabled;i.xr.enabled=!1,i.setRenderTarget(this),i.clear(!0,!0,!0),i.render(e,t),i.setRenderTarget(n),i.xr.enabled=r,this.onAfterRender()}}onBeforeRender(){My._userSet.clear();const e=Gk(this.texture,!0,null,My._userSet);for(const t of e)t instanceof fe&&(t[$G]=t.visible,t.visible=!1)}onAfterRender(){for(const e of My._userSet)e instanceof fe&&(e.visible=e[$G]);My._userSet.clear()}};let Od=My;d(Od,"_userSet",new Set);class Lge extends hl{constructor(){super([Ae,Ui],"ColorSerializer")}onDeserialize(e){if(e!=null)return e.a!==void 0?new Ui(e.r,e.g,e.b,e.a):e.alpha!==void 0?new Ui(e.r,e.g,e.b,e.alpha):new Ae(e.r,e.g,e.b)}onSerialize(e){if(e!=null)return e.a!==void 0?{r:e.r,g:e.g,b:e.b,a:e.a}:{r:e.r,g:e.g,b:e.b}}}const kge=new Lge;class Fge extends hl{constructor(){super([li],"EulerSerializer")}onDeserialize(e,t){if(e!=null){if(e.order)return new li(e.x,e.y,e.z,e.order);if(e.x!=null)return new li(e.x,e.y,e.z)}}onSerialize(e,t){return{x:e.x,y:e.y,z:e.z,order:e.order}}}const Uge=new Fge;class Nge extends hl{constructor(){super(ye,"ObjectSerializer")}onSerialize(e,t){if(t.objectToNode!==void 0&&e.uuid){const i=t.objectToNode[e.uuid];return Hs&&console.log(i,e.name,e.uuid),{node:i}}}onDeserialize(e,t){var i,n,r;if(typeof e=="string"){if(e.endsWith(".glb")||e.endsWith(".gltf")){if(t.serializable instanceof Array&&t.serializable.includes(ei))return;nt()&&Fi("Detected wrong usage of @serializable with Object3D or GameObject. Instead you should use AssetReference here! Please see the console for details.");const o=(n=(i=t.target)==null?void 0:i.constructor)==null?void 0:n.name;console.warn(`Wrong usage of @serializable detected in your script "${o}"

It looks like you used @serializable(Object3D) or @serializable(GameObject) for a prefab or scene reference which is exported to a separate glTF file.

To fix this please change your code to:

@serializable(AssetReference)
${t.path}! : AssetReference;
\0`)}return}if(e){if(e.node!==void 0&&t.nodeToObject){const o=t.nodeToObject[e.node];return Hs&&console.log("Deserialized object reference?",e,o,t==null?void 0:t.nodeToObject),o||console.warn("Did not find node: "+e.node,t.nodeToObject,t.object),o}else if(e.guid){if(!t.context){console.error("Missing context");return}let o;const a=(r=t.gltf)==null?void 0:r.scene;return a&&(o=ne.findByGuid(e.guid,a)),o||(o=ne.findByGuid(e.guid,t.context.scene)),o?(o&&o.isComponent===!0&&(Hs&&console.warn("Deserialized object reference is a component"),o=o.gameObject),Hs&&console.log("Deserialized object reference?",e,o,t==null?void 0:t.nodeToObject)):((nt()||Hs)&&console.warn("Could not resolve object reference",t.path,e,t.target,t.context.scene),e.could_not_resolve=!0),o}}}}const w7=new Nge;class zge extends hl{constructor(){super([Ie,Ie],"ComponentSerializer")}onSerialize(e,t){if(e!=null&&e.guid)return{guid:e.guid}}onDeserialize(e,t){var i;if(e!=null&&e.guid){if(e.___persistentAsset){Hs&&console.log("Skipping component deserialization because it's a persistent asset",e);return}const n=t.path;Hs&&console.log(e.guid,t.root,t.object,t.target);let r=this.findObjectForGuid(e.guid,t.root);if(r||t.context&&(r=this.findObjectForGuid(e.guid,(i=t.context)==null?void 0:i.scene),r))return r;(nt()||Hs)&&console.warn('Could not resolve component reference: "'+n+'" using guid '+e.guid,t.target),e.could_not_resolve=!0;return}}findObjectForGuid(e,t){if(t.guid===e)return t;const i=ne.foreachComponent(t,n=>{if(n.guid===e)return n},!1);if(i!==void 0)return i;for(let n=0;n<t.children.length;n++){const r=t.children[n],o=this.findObjectForGuid(e,r);if(o)return o}}}const y1=new zge;class Gge extends hl{constructor(){super([Sn])}onSerialize(e,t){console.log("TODO: SERIALIZE EVENT")}onDeserialize(e,t){var i,n,r;if(typeof e=="function")return new Sn([new _c(e,null,[],!0)]);if(e&&e.type==="EventList"){Hs&&console.log("DESERIALIZE EVENT",e);const o=new Array;if(e.calls&&Array.isArray(e.calls))for(const c of e.calls){let h=function(p){if(typeof p=="object"){let m=w7.onDeserialize(p,t);if(m||(m=y1.onDeserialize(p,t)),m)return m}return p};Hs&&console.log(c);let u=y1.findObjectForGuid(c.target,t.root);!u&&((i=t.context)!=null&&i.scene)&&(u=y1.findObjectForGuid(c.target,(n=t.context)==null?void 0:n.scene));const f=((r=c.method)==null?void 0:r.length)>0;if(u&&f){const p=()=>{const v=c.method[0].toUpperCase()+c.method.slice(1);if(typeof u[v]=="function"){console.warn(`EventList method:
Could not find method ${c.method} on object ${u.name}. Please rename ${c.method} to ${v}?
`,u[v],`
 in script: `,u),Fi("EventList methods must start with lowercase letter, see console for details");return}else console.warn(`EventList method:
Could not find method ${c.method} on object ${u.name}`,u,typeof u[c.method])};if(typeof u[c.method]!="function"){let v=!1,g=u;for(;g;){const y=Object.getOwnPropertyDescriptor(g,c.method);if(y&&(y.writable===!0||y.set)){v=!0;break}g=Object.getPrototypeOf(g)}!v&&(nt()||Hs)&&p()}}if(u){let p=c.argument;if(p!==void 0?p=h(p):c.arguments!==void 0&&(p=c.arguments.map(h)),!u[c.method])console.warn(`EventList method not found: "${c.method}" on ${u==null?void 0:u.name}`);else{Array.isArray(p)||(p=[p]);const v=new _c(u,c.method,p,c.enabled);o.push(v)}}else nt()&&console.warn("[Debug] EventList: Could not find event listener in scene",c)}const a=new Sn(o);Hs&&console.log(a);const l=t.target;return l!==void 0&&t.path!==void 0&&a.setEventTarget(t.path,l),a}}}const Hge=new Gge;class S7 extends hl{constructor(){super([Od,$t])}onSerialize(e,t){}onDeserialize(e,t){if(e instanceof Wt&&t.type===Od){const i=e,n=new Od(i.image.width,i.image.height,{colorSpace:zi});return n.texture=i,i.isRenderTargetTexture=!0,i.flipY=!0,i.offset.y=1,i.repeat.y=-1,i.needsUpdate=!0,i.mipmaps=[],i instanceof Md&&(i.isCompressedTexture=!1,i.format=RGBAFormat),n}}}new S7;class C7 extends hl{constructor(){super([URL])}onSerialize(e,t){return null}onDeserialize(e,t){if(typeof e=="string"&&e.length>0)return nf(t.gltfId,e)}}new C7;const eH={type:"change"},wP={type:"start"},tH={type:"end"},FS=new _o,iH=new xs,Vge=Math.cos(70*gi.DEG2RAD);let E7=class extends js{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new S,this.cursor=new S,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:op.ROTATE,MIDDLE:op.DOLLY,RIGHT:op.PAN},this.touches={ONE:ap.ROTATE,TWO:ap.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(W){W.addEventListener("keydown",Le),this._domElementKeyEvents=W},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Le),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(eH),i.update(),r=n.NONE},this.update=function(){const W=new S,ae=new Ce().setFromUnitVectors(e.up,new S(0,1,0)),$=ae.clone().invert(),De=new S,he=new Ce,Ve=new S,Ye=2*Math.PI;return function(Mi=null){const hn=i.object.getWorldPosition(e.position);W.copy(hn).sub(i.target),W.applyQuaternion(ae),a.setFromVector3(W),i.autoRotate&&r===n.NONE&&k(I(Mi)),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let un=i.minAzimuthAngle,oi=i.maxAzimuthAngle;isFinite(un)&&isFinite(oi)&&(un<-Math.PI?un+=Ye:un>Math.PI&&(un-=Ye),oi<-Math.PI?oi+=Ye:oi>Math.PI&&(oi-=Ye),un<=oi?a.theta=Math.max(un,Math.min(oi,a.theta)):a.theta=a.theta>(un+oi)/2?Math.max(un,a.theta):Math.min(oi,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(u,i.dampingFactor):i.target.add(u),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let Tn=!1;if(i.zoomToCursor&&M||i.object.isOrthographicCamera)a.radius=re(a.radius);else{i.enableDamping?h=gi.lerp(h,c,i.dampingFactor):h=c,a.radius=re(a.radius*h);const Fn=a.radius;a.radius=re(a.radius*c),Tn=Fn!=a.radius}if(W.setFromSpherical(a),W.applyQuaternion($),hn.copy(i.target).add(W),i.object.parent?i.object.parent.worldToLocal(hn):i.object.position.copy(hn),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,u.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),u.set(0,0,0)),i.zoomToCursor&&M){let Fn=null;if(i.object.isPerspectiveCamera){const Wo=W.length();Fn=re(Wo*c);const xu=Wo-Fn;i.object.position.addScaledVector(x,xu),i.object.updateMatrixWorld(),Tn=!!xu}else if(i.object.isOrthographicCamera){const Wo=new S(E.x,E.y,0);Wo.unproject(i.object);const xu=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),i.object.updateProjectionMatrix(),Tn=xu!==i.object.zoom;const jo=new S(E.x,E.y,0);jo.unproject(i.object),i.object.position.sub(jo).add(Wo),i.object.updateMatrixWorld(),Fn=W.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;Fn!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(Fn).add(i.object.position):(FS.origin.copy(i.object.position),FS.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(FS.direction))<Vge?e.lookAt(i.target):(iH.setFromNormalAndCoplanarPoint(i.object.up,i.target),FS.intersectPlane(iH,i.target))))}else if(i.object.isOrthographicCamera){const Fn=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),Fn!==i.object.zoom&&(i.object.updateProjectionMatrix(),Tn=!0)}return c=1,M=!1,Tn||De.distanceToSquared(i.object.position)>o||8*(1-he.dot(i.object.quaternion))>o||Ve.distanceToSquared(i.target)>o?(i.dispatchEvent(eH),De.copy(i.object.position),he.copy(i.object.quaternion),Ve.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",ke),i.domElement.removeEventListener("pointerdown",zt),i.domElement.removeEventListener("pointercancel",F),i.domElement.removeEventListener("wheel",Pe),i.domElement.removeEventListener("pointermove",V),window.removeEventListener("pointerup",F),i.domElement.getRootNode().removeEventListener("keydown",xt,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",Le),i._domElementKeyEvents=null)};const i=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=n.NONE;const o=1e-6,a=new C2,l=new C2;let c=1,h=1;const u=new S,f=new ee,p=new ee,m=new ee,v=new ee,g=new ee,y=new ee,A=new ee,_=new ee,b=new ee,x=new S,E=new ee;let M=!1;const T=[],R={};let w=!1;function I(W){return W!==null?2*Math.PI/60*i.autoRotateSpeed*W:2*Math.PI/60/60*i.autoRotateSpeed}function O(W){const ae=Math.abs(W*.01);return Math.pow(.95,i.zoomSpeed*ae)}function k(W){l.theta-=W}function B(W){l.phi-=W}const G=function(){const W=new S;return function($,De){W.setFromMatrixColumn(De,0),W.multiplyScalar(-$),u.add(W)}}(),L=function(){const W=new S;return function($,De){i.screenSpacePanning===!0?W.setFromMatrixColumn(De,1):(W.setFromMatrixColumn(De,0),W.crossVectors(i.object.up,W)),W.multiplyScalar($),u.add(W)}}(),U=function(){const W=new S,ae=new S;return function(De,he){const Ve=i.domElement;if(i.object.isPerspectiveCamera){i.object.getWorldPosition(ae),W.copy(ae).sub(i.target);let Ye=W.length();Ye*=Math.tan(i.object.fov/2*Math.PI/180),G(2*De*Ye/Ve.clientHeight,i.object.matrixWorld),L(2*he*Ye/Ve.clientHeight,i.object.matrixWorld)}else i.object.isOrthographicCamera?(G(De*(i.object.right-i.object.left)/i.object.zoom/Ve.clientWidth,i.object.matrixWorld),L(he*(i.object.top-i.object.bottom)/i.object.zoom/Ve.clientHeight,i.object.matrixWorld)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function z(W){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c/=W:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function j(W){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c*=W:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function X(W,ae){if(!i.zoomToCursor)return;M=!0;const $=i.domElement.getBoundingClientRect(),De=W-$.left,he=ae-$.top,Ve=$.width,Ye=$.height;E.x=De/Ve*2-1,E.y=-(he/Ye)*2+1,x.set(E.x,E.y,1).unproject(i.object).sub(i.object.position).normalize()}function re(W){return Math.max(i.minDistance,Math.min(i.maxDistance,W))}function ce(W){f.set(W.clientX,W.clientY)}function Me(W){X(W.clientX,W.clientX),A.set(W.clientX,W.clientY)}function se(W){v.set(W.clientX,W.clientY)}function ve(W){p.set(W.clientX,W.clientY),m.subVectors(p,f).multiplyScalar(i.rotateSpeed);const ae=i.domElement;k(2*Math.PI*m.x/ae.clientHeight),B(2*Math.PI*m.y/ae.clientHeight),f.copy(p),i.update()}function xe(W){_.set(W.clientX,W.clientY),b.subVectors(_,A),b.y>0?z(O(b.y)):b.y<0&&j(O(b.y)),A.copy(_),i.update()}function Fe(W){g.set(W.clientX,W.clientY),y.subVectors(g,v).multiplyScalar(i.panSpeed),U(y.x,y.y),v.copy(g),i.update()}function Ge(W){X(W.clientX,W.clientY),W.deltaY<0?j(O(W.deltaY)):W.deltaY>0&&z(O(W.deltaY)),i.update()}function je(W){let ae=!1;switch(W.code){case i.keys.UP:W.ctrlKey||W.metaKey||W.shiftKey?B(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):U(0,i.keyPanSpeed),ae=!0;break;case i.keys.BOTTOM:W.ctrlKey||W.metaKey||W.shiftKey?B(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):U(0,-i.keyPanSpeed),ae=!0;break;case i.keys.LEFT:W.ctrlKey||W.metaKey||W.shiftKey?k(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):U(i.keyPanSpeed,0),ae=!0;break;case i.keys.RIGHT:W.ctrlKey||W.metaKey||W.shiftKey?k(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):U(-i.keyPanSpeed,0),ae=!0;break}ae&&(W.preventDefault(),i.update())}function lt(W){if(T.length===1)f.set(W.pageX,W.pageY);else{const ae=at(W),$=.5*(W.pageX+ae.x),De=.5*(W.pageY+ae.y);f.set($,De)}}function ot(W){if(T.length===1)v.set(W.pageX,W.pageY);else{const ae=at(W),$=.5*(W.pageX+ae.x),De=.5*(W.pageY+ae.y);v.set($,De)}}function q(W){const ae=at(W),$=W.pageX-ae.x,De=W.pageY-ae.y,he=Math.sqrt($*$+De*De);A.set(0,he)}function He(W){i.enableZoom&&q(W),i.enablePan&&ot(W)}function we(W){i.enableZoom&&q(W),i.enableRotate&&lt(W)}function Ne(W){if(T.length==1)p.set(W.pageX,W.pageY);else{const $=at(W),De=.5*(W.pageX+$.x),he=.5*(W.pageY+$.y);p.set(De,he)}m.subVectors(p,f).multiplyScalar(i.rotateSpeed);const ae=i.domElement;k(2*Math.PI*m.x/ae.clientHeight),B(2*Math.PI*m.y/ae.clientHeight),f.copy(p)}function Ee(W){if(T.length===1)g.set(W.pageX,W.pageY);else{const ae=at(W),$=.5*(W.pageX+ae.x),De=.5*(W.pageY+ae.y);g.set($,De)}y.subVectors(g,v).multiplyScalar(i.panSpeed),U(y.x,y.y),v.copy(g)}function st(W){const ae=at(W),$=W.pageX-ae.x,De=W.pageY-ae.y,he=Math.sqrt($*$+De*De);_.set(0,he),b.set(0,Math.pow(_.y/A.y,i.zoomSpeed)),z(b.y),A.copy(_);const Ve=(W.pageX+ae.x)*.5,Ye=(W.pageY+ae.y)*.5;X(Ve,Ye)}function et(W){i.enableZoom&&st(W),i.enablePan&&Ee(W)}function ct(W){i.enableZoom&&st(W),i.enableRotate&&Ne(W)}function zt(W){i.enabled!==!1&&(T.length===0&&(i.domElement.setPointerCapture(W.pointerId),i.domElement.addEventListener("pointermove",V),window.addEventListener("pointerup",F)),!Xe(W)&&(ni(W),W.pointerType==="touch"?Qe(W):ge(W)))}function V(W){i.enabled!==!1&&(W.pointerType==="touch"?St(W):_e(W))}function F(W){switch(pt(W),T.length){case 0:i.domElement.releasePointerCapture(W.pointerId),i.domElement.removeEventListener("pointermove",V),i.domElement.removeEventListener("pointerup",F),i.dispatchEvent(tH),r=n.NONE;break;case 1:const ae=T[0],$=R[ae];Qe({pointerId:ae,pageX:$.x,pageY:$.y});break}}function ge(W){let ae;switch(W.button){case 0:ae=i.mouseButtons.LEFT;break;case 1:ae=i.mouseButtons.MIDDLE;break;case 2:ae=i.mouseButtons.RIGHT;break;default:ae=-1}switch(ae){case op.DOLLY:if(i.enableZoom===!1)return;Me(W),r=n.DOLLY;break;case op.ROTATE:if(W.ctrlKey||W.metaKey||W.shiftKey){if(i.enablePan===!1)return;se(W),r=n.PAN}else{if(i.enableRotate===!1)return;ce(W),r=n.ROTATE}break;case op.PAN:if(W.ctrlKey||W.metaKey||W.shiftKey){if(i.enableRotate===!1)return;ce(W),r=n.ROTATE}else{if(i.enablePan===!1)return;se(W),r=n.PAN}break;default:r=n.NONE}r!==n.NONE&&i.dispatchEvent(wP)}function _e(W){switch(r){case n.ROTATE:if(i.enableRotate===!1)return;ve(W);break;case n.DOLLY:if(i.enableZoom===!1)return;xe(W);break;case n.PAN:if(i.enablePan===!1)return;Fe(W);break}}function Pe(W){i.enabled===!1||i.enableZoom===!1||r!==n.NONE||(W.preventDefault(),i.dispatchEvent(wP),Ge(Te(W)),i.dispatchEvent(tH))}function Te(W){const ae=W.deltaMode,$={clientX:W.clientX,clientY:W.clientY,deltaY:W.deltaY};switch(ae){case 1:$.deltaY*=16;break;case 2:$.deltaY*=100;break}return W.ctrlKey&&!w&&($.deltaY*=10),$}function xt(W){W.key==="Control"&&(w=!0,i.domElement.getRootNode().addEventListener("keyup",ft,{passive:!0,capture:!0}))}function ft(W){W.key==="Control"&&(w=!1,i.domElement.getRootNode().removeEventListener("keyup",ft,{passive:!0,capture:!0}))}function Le(W){i.enabled===!1||i.enablePan===!1||je(W)}function Qe(W){switch(mt(W),T.length){case 1:switch(i.touches.ONE){case ap.ROTATE:if(i.enableRotate===!1)return;lt(W),r=n.TOUCH_ROTATE;break;case ap.PAN:if(i.enablePan===!1)return;ot(W),r=n.TOUCH_PAN;break;default:r=n.NONE}break;case 2:switch(i.touches.TWO){case ap.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;He(W),r=n.TOUCH_DOLLY_PAN;break;case ap.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;we(W),r=n.TOUCH_DOLLY_ROTATE;break;default:r=n.NONE}break;default:r=n.NONE}r!==n.NONE&&i.dispatchEvent(wP)}function St(W){switch(mt(W),r){case n.TOUCH_ROTATE:if(i.enableRotate===!1)return;Ne(W),i.update();break;case n.TOUCH_PAN:if(i.enablePan===!1)return;Ee(W),i.update();break;case n.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;et(W),i.update();break;case n.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;ct(W),i.update();break;default:r=n.NONE}}function ke(W){i.enabled!==!1&&W.preventDefault()}function ni(W){T.push(W.pointerId)}function pt(W){delete R[W.pointerId];for(let ae=0;ae<T.length;ae++)if(T[ae]==W.pointerId){T.splice(ae,1);return}}function Xe(W){for(let ae=0;ae<T.length;ae++)if(T[ae]==W.pointerId)return!0;return!1}function mt(W){let ae=R[W.pointerId];ae===void 0&&(ae=new ee,R[W.pointerId]=ae),ae.set(W.pageX,W.pageY)}function at(W){const ae=W.pointerId===T[0]?T[1]:T[0];return R[ae]}i.domElement.addEventListener("contextmenu",ke),i.domElement.addEventListener("pointerdown",zt),i.domElement.addEventListener("pointercancel",F),i.domElement.addEventListener("wheel",Pe,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",xt,{passive:!0,capture:!0}),this.update()}};var Qge=Object.defineProperty,Wge=Object.getOwnPropertyDescriptor,sx=(s,e,t,i)=>{for(var n=i>1?void 0:i?Wge(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Qge(e,t,n),n};const nH=ie("debuggroundprojection");class du extends Ie{constructor(){super(...arguments);d(this,"applyOnAwake",!1);d(this,"autoFit",!0);d(this,"_radius",50);d(this,"_height",3);d(this,"_arblending",0);d(this,"_lastEnvironment");d(this,"_lastRadius");d(this,"_lastHeight");d(this,"_projection");d(this,"_watcher");d(this,"_needsTextureUpdate",!1);d(this,"_blurrynessShader",null);d(this,"_lastBlurriness",-1)}set radius(t){this._radius=t,this.updateProjection()}get radius(){return this._radius}set height(t){this._height=t,this.updateProjection()}get height(){return this._height}set arBlending(t){this._arblending=t,this._needsTextureUpdate=!0}get arBlending(){return this._arblending}awake(){this.applyOnAwake&&this.updateAndCreate()}onEnable(){this.context.time.frameCount>0&&this.applyOnAwake&&this.updateAndCreate(),this._watcher||(this._watcher=new Zh(this.context.scene,"environment"),this._watcher.subscribeWrite(t=>{this.updateProjection()}))}onDisable(){var t,i;(t=this._watcher)==null||t.revoke(),(i=this._projection)==null||i.removeFromParent()}onEnterXR(){this.activeAndEnabled&&(this._needsTextureUpdate=!0,this.updateProjection())}async onLeaveXR(){this.activeAndEnabled&&(await CM(1),this.updateProjection())}onBeforeRender(){this._projection&&this.scene.backgroundRotation&&this._projection.rotation.copy(this.scene.backgroundRotation),this.context.scene.backgroundBlurriness!==void 0&&this._lastBlurriness!=this.context.scene.backgroundBlurriness&&this.context.scene.backgroundBlurriness>.001?this.updateProjection():this._needsTextureUpdate&&this.updateBlurriness()}updateAndCreate(){var t;this.updateProjection(),(t=this._watcher)==null||t.apply()}updateProjection(){var i,n,r,o,a;if(!this.context.scene.environment){(i=this._projection)==null||i.removeFromParent();return}if(((n=this.context.xr)!=null&&n.isPassThrough||(r=this.context.xr)!=null&&r.isAR)&&this.arBlending===0){(o=this._projection)==null||o.removeFromParent();return}const t=0;if((!this._projection||this.context.scene.environment!==this._lastEnvironment||this._height!==this._lastHeight||this._radius!==this._lastRadius)&&(nH&&console.log("Create/Update Ground Projection",this.context.scene.environment.name),(a=this._projection)==null||a.removeFromParent(),this._projection=new nv(this.context.scene.environment,this._height,this.radius,64),this._projection.position.y=this._height-t,this._projection.name="GroundProjection",nk(this._projection,!1)),this._lastEnvironment=this.context.scene.environment,this._lastHeight=this._height,this._lastRadius=this._radius,this._projection.parent||this.gameObject.add(this._projection),this.autoFit){this._projection.updateWorldMatrix(!0,!0);const l=Hl(this.context.scene.children,[this._projection]),c=l.min.y;if(c<1/0){const h=Ft(this._projection);h.x=l.min.x+(l.max.x-l.min.x)*.5,h.y=c+this._height-t,h.z=l.min.z+(l.max.z-l.min.z)*.5,Es(this._projection,h)}}(this.context.scene.backgroundBlurriness>.001||this._needsTextureUpdate)&&this.updateBlurriness(),this._needsTextureUpdate=!1}updateBlurriness(){var i;if(this._projection){if(!this.context.scene.environment)return}else return;this._needsTextureUpdate=!1,nH&&console.log("Update Blurriness",this.context.scene.backgroundBlurriness),this._blurrynessShader??(this._blurrynessShader=new kt({name:"GroundProjectionBlurriness",uniforms:{map:{value:this.context.scene.environment},blurriness:{value:this.context.scene.backgroundBlurriness},blending:{value:0},alphaFactor:{value:1}},vertexShader:jge,fragmentShader:qge})),this._blurrynessShader.depthWrite=!1,this._blurrynessShader.uniforms.blurriness.value=this.context.scene.backgroundBlurriness,this._lastBlurriness=this.context.scene.backgroundBlurriness,this.context.scene.environment.needsPMREMUpdate=!0;const t=this._projection.material.transparent;this._projection.material.transparent=(((i=this.context.xr)==null?void 0:i.isAR)===!0&&this.arBlending>1e-6)??!1,this._projection.material.transparent?this._blurrynessShader.uniforms.blending.value=this.arBlending:this._blurrynessShader.uniforms.blending.value=0,this.context.isInPassThrough?this._blurrynessShader.uniforms.alphaFactor.value=.95:this._blurrynessShader.uniforms.alphaFactor.value=1,t!==this._projection.material.transparent&&(this._projection.material.needsUpdate=!0),this._projection.material.map=ja.copyTexture(this.context.scene.environment,this._blurrynessShader),this._projection.material.depthTest=!0,this._projection.material.depthWrite=!1}}sx([C()],du.prototype,"applyOnAwake",2);sx([C()],du.prototype,"autoFit",2);sx([C()],du.prototype,"radius",1);sx([C()],du.prototype,"height",1);sx([C()],du.prototype,"arBlending",1);const jge=`
  varying vec2 vUv;

  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,qge=`
  uniform sampler2D map;
  uniform float blurriness;
  uniform float alphaFactor;
  uniform float blending;
  varying vec2 vUv;

  const float PI = 3.14159265359;

  // Gaussian function
  float gaussian(float x, float sigma) {
    return exp(-(x * x) / (2.0 * sigma * sigma)) / (sqrt(2.0 * PI) * sigma);
  }

  // Custom smoothstep function for desired falloff
  float customSmoothstep(float edge0, float edge1, float x) {
    float t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return t * t * (3.0 - 2.0 * t);
  }

  void main() {
    vec2 center = vec2(0.0, 0.0);
    vec2 pos = vUv;
    pos.x = 0.0; // Only consider vertical distance
    float distance = length(pos - center);
    
    // Calculate blur amount based on custom falloff
    float blurAmount = customSmoothstep(0.5, 1.0, distance * 2.0);
    blurAmount = clamp(blurAmount, 0.0, 1.0); // Ensure blur amount is within valid range

    // Gaussian blur
    vec2 pixelSize = 1.0 / vec2(textureSize(map, 0));
    vec4 color = vec4(0.0);
    float totalWeight = 0.0;
    int blurSize = int(60.0 * min(1.0, blurriness) * blurAmount); // Adjust blur size based on distance and blurriness
    float lodLevel = log2(float(blurSize)) * 0.5; // Compute LOD level

    for (int x = -blurSize; x <= blurSize; x++) {
        for (int y = -blurSize; y <= blurSize; y++) {
            vec2 offset = vec2(float(x), float(y)) * pixelSize * blurAmount;
            float weight = gaussian(length(vec2(float(x), float(y))), 1000.0 * blurAmount); // Use a fixed sigma value
            color += textureLod(map, vUv + offset, lodLevel) * weight;
            totalWeight += weight;
        }
    }

    color = totalWeight > 0.0 ? color / totalWeight : texture2D(map, vUv);

    gl_FragColor = color;

    float brightness = dot(gl_FragColor.rgb, vec3(0.299, 0.587, 0.114));
    float stepFactor = blending - brightness * .1;
    gl_FragColor.a = pow(1.0 - blending * customSmoothstep(0.35 * stepFactor, 0.45 * stepFactor, distance), 5.);
    gl_FragColor.a *= alphaFactor;
    // gl_FragColor.rgb = vec3(1.0);

    // #include <tonemapping_fragment>
    // #include <colorspace_fragment>
    
    // Uncomment to visualize blur amount
    // gl_FragColor = vec4(blurAmount, 0.0, 0.0, 1.0);
  }
`;var Xge=Object.defineProperty,Yge=Object.getOwnPropertyDescriptor,lF=(s,e,t,i)=>{for(var n=i>1?void 0:i?Yge(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Xge(e,t,n),n};class bm extends Ie{constructor(){super(...arguments);d(this,"constraintActive",!0);d(this,"locked",!1);d(this,"sources",[])}}lF([C()],bm.prototype,"constraintActive",2);lF([C()],bm.prototype,"locked",2);lF([C(ye)],bm.prototype,"sources",2);function Kge(s,e){return of(s,Ti.ContextCreated,e),()=>af(s,Ti.ContextCreated)}function Jge(s,e){return of(s,Ti.ContextClearing,e),()=>af(s,Ti.ContextClearing)}function Zge(s,e){return of(s,Ti.ContextDestroying,e),()=>af(s,Ti.ContextDestroying)}function cF(s,e){return of(s,nn.Start,e),()=>af(s,nn.Start)}function hF(s,e){return of(s,nn.Update,e),()=>af(s,nn.Update)}function M7(s,e){return of(s,nn.OnBeforeRender,e),()=>af(s,nn.OnBeforeRender)}function $ge(s,e){return of(s,nn.OnAfterRender,e),()=>af(s,nn.OnAfterRender)}class Hp{constructor(){d(this,"bb",null);d(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}y(){return this.bb.readFloat32(this.bb_pos+4)}z(){return this.bb.readFloat32(this.bb_pos+8)}static sizeOf(){return 12}static createVec3(e,t,i,n){return e.prep(4,12),e.writeFloat32(n),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class T7{constructor(){d(this,"bb",null);d(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}position(e){return(e||new Hp).__init(this.bb_pos,this.bb)}rotation(e){return(e||new Hp).__init(this.bb_pos+12,this.bb)}scale(e){return(e||new Hp).__init(this.bb_pos+24,this.bb)}static sizeOf(){return 36}static createTransform(e,t,i,n,r,o,a,l,c,h){return e.prep(4,36),e.prep(4,12),e.writeFloat32(h),e.writeFloat32(c),e.writeFloat32(l),e.prep(4,12),e.writeFloat32(a),e.writeFloat32(o),e.writeFloat32(r),e.prep(4,12),e.writeFloat32(n),e.writeFloat32(i),e.writeFloat32(t),e.offset()}}class Wh{constructor(){d(this,"bb",null);d(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedTransformModel(e,t){return(t||new Wh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedTransformModel(e,t){return e.setPosition(e.position()+Tk),(t||new Wh).__init(e.readInt32(e.position())+e.position(),e)}guid(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}fast(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}transform(e){const t=this.bb.__offset(this.bb_pos,8);return t?(e||new T7).__init(this.bb_pos+t,this.bb):null}dontSave(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startSyncedTransformModel(e){e.startObject(4)}static addGuid(e,t){e.addFieldOffset(0,t,0)}static addFast(e,t){e.addFieldInt8(1,+t,0)}static addTransform(e,t){e.addFieldStruct(2,t,0)}static addDontSave(e,t){e.addFieldInt8(3,+t,0)}static endSyncedTransformModel(e){return e.endObject()}static finishSyncedTransformModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedTransformModelBuffer(e,t){e.finish(t,void 0,!0)}}var ks=(s=>(s[s.Average=0]="Average",s[s.Multiply=1]="Multiply",s[s.Minimum=2]="Minimum",s[s.Maximum=3]="Maximum",s))(ks||{}),aT=(s=>(s[s.Discrete=0]="Discrete",s[s.Continuous=1]="Continuous",s))(aT||{}),jn=(s=>(s[s.None=0]="None",s[s.FreezePositionX=2]="FreezePositionX",s[s.FreezePositionY=4]="FreezePositionY",s[s.FreezePositionZ=8]="FreezePositionZ",s[s.FreezePosition=14]="FreezePosition",s[s.FreezeRotationX=16]="FreezeRotationX",s[s.FreezeRotationY=32]="FreezeRotationY",s[s.FreezeRotationZ=64]="FreezeRotationZ",s[s.FreezeRotation=112]="FreezeRotation",s[s.FreezeAll=126]="FreezeAll",s))(jn||{}),wy=(s=>(s[s.None=0]="None",s[s.X=2]="X",s[s.Y=4]="Y",s[s.Z=8]="Z",s[s.All=-1]="All",s))(wy||{});const wr=function(s,e){return function(t,i,n){eye(t,i,n,s,e)}};function eye(s,e,t,i,n){if(!n&&!i&&!s.onValidate)return;if(t!==void 0){console.error("Invalid usage of validate decorator. Only fields can be validated.",s,e,t),_n("Invalid usage of validate decorator. Only fields can be validated. Property: "+e,la.Error);return}let r="";if(typeof e=="string"?r=e:r=e.name,s.__internalAwake){const o=Symbol(r),a=s.__internalAwake;s.__internalAwake=function(){var l;if(!this.onValidate){nt()&&console.warn('Usage of @validate decorate detected but there is no onValidate method in your class: "'+((l=s.constructor)==null?void 0:l.name)+'"');return}if(this[o]===void 0){this[o]=this[r];const c=this[r];if(c instanceof ee||c instanceof S||c instanceof Je||c instanceof Ce){const h=this[r];EM(h,()=>{this.onValidate(r)})}Object.defineProperty(this,r,{set:function(h){var u;if(this[_D]===!0)this[o]=h;else{i==null||i.call(this,h);const f=this[o];this[o]=h,(u=this.onValidate)==null||u.call(this,r,f)}},get:function(){return n==null||n.call(this),this[o]}})}a.call(this)}}}const tye=function(s){return function(e,t,i){let n="";typeof t=="string"?n=t:n=t.name;const r=s.prototype,o=Object.getOwnPropertyDescriptor(r,n);if(!(o!=null&&o.value)){console.warn("Can not apply prefix: type does not have method named",t,s);return}const a=o.value,l=e[n];Object.defineProperty(r,n,{value:function(...c){const h=l==null?void 0:l.call(this,...c);if(h instanceof Promise){h.then(u=>{if(u!==!1)return a.call(this,...c)});return}if(h!==!1)return a.call(this,...c)}})}};var iye=Object.defineProperty,nye=Object.getOwnPropertyDescriptor,Ca=(s,e,t,i)=>{for(var n=i>1?void 0:i?nye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&iye(e,t,n),n};class sye{constructor(e,t){d(this,"positionChanged",!1);d(this,"rotationChanged",!1);d(this,"position");d(this,"quaternion");d(this,"_positionKeys",["x","y","z"]);d(this,"_quaternionKeys",["_x","_y","_z","_w"]);d(this,"mute",!1);d(this,"context");d(this,"obj");d(this,"_positionWatch");d(this,"_rotationWatch");this.context=t,this.obj=e}get isDirty(){return this.positionChanged||this.rotationChanged}reset(e=!1){if(this.positionChanged=!1,this.rotationChanged=!1,this.mute=!1,e){if(this.position)for(const t of this._positionKeys)delete this.position[t];if(this.quaternion)for(const t of this._quaternionKeys)delete this.quaternion[t]}}syncValues(){for(const e of this._positionKeys)this.position[e]=this.obj.position[e];for(const e of this._quaternionKeys)this.quaternion[e]=this.obj.quaternion[e]}applyValues(){if(this.positionChanged&&this.position)for(const e of this._positionKeys){const t=this.position[e];t!==void 0&&(this.obj.position[e]=t)}if(this.rotationChanged&&this.quaternion)for(const e of this._quaternionKeys){const t=this.quaternion[e];t!==void 0&&(this.obj.quaternion[e]=t)}}start(e,t){this.reset(),e&&(this._positionWatch||(this._positionWatch=new Zh(this.obj.position,["x","y","z"])),this._positionWatch.apply(),this.position={},this._positionWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.position[o];Math.abs(a-r)<1e-5||(this.position[o]=r,this.positionChanged=!0)})),t&&(this._rotationWatch||(this._rotationWatch=new Zh(this.obj.quaternion,["_x","_y","_z","_w"])),this._rotationWatch.apply(),this.quaternion={},this._rotationWatch.subscribeWrite((r,o)=>{var l;if((l=this.context.physics.engine)!=null&&l.isUpdating||this.mute)return;const a=this.quaternion[o];Math.abs(a-r)<1e-5||(this.quaternion[o]=r,this.rotationChanged=!0)}));const i=this.obj.matrixWorld.multiplyMatrices.bind(this.obj.matrixWorld),n=new le;this.obj.matrixWorld.multiplyMatrices=(r,o)=>{var a;return(a=this.context.physics.engine)!=null&&a.isUpdating||this.mute||n.equals(r)||(this.positionChanged=!0,this.rotationChanged=!0,n.copy(r)),i(r,o)}}stop(){var e,t;(e=this._positionWatch)==null||e.revoke(),(t=this._rotationWatch)==null||t.revoke()}}var CB;const GD=(CB=class extends Ie{constructor(){super(...arguments);d(this,"autoMass",!0);d(this,"_mass",0);d(this,"useGravity",!0);d(this,"centerOfMass",new S(0,0,0));d(this,"constraints",jn.None);d(this,"isKinematic",!1);d(this,"drag",0);d(this,"angularDrag",1);d(this,"detectCollisions",!0);d(this,"sleepThreshold",.01);d(this,"collisionDetectionMode",aT.Discrete);d(this,"_gravityScale",1);d(this,"dominanceGroup",0);d(this,"_propertiesChanged",!1);d(this,"_currentVelocity",new S);d(this,"_smoothedVelocity",new S);d(this,"_smoothedVelocityGetter",new S);d(this,"_lastPosition",new S);d(this,"_watch")}set mass(e){e!==this._mass&&(this._mass=e,this._propertiesChanged=!0,this.__didAwake&&(this.autoMass=!1))}get mass(){var e,t;return this.autoMass?((t=(e=this.context.physics.engine)==null?void 0:e.getBody(this))==null?void 0:t.mass())??-1:this._mass}get lockPositionX(){return(this.constraints&jn.FreezePositionX)!==0}get lockPositionY(){return(this.constraints&jn.FreezePositionY)!==0}get lockPositionZ(){return(this.constraints&jn.FreezePositionZ)!==0}get lockRotationX(){return(this.constraints&jn.FreezeRotationX)!==0}get lockRotationY(){return(this.constraints&jn.FreezeRotationY)!==0}get lockRotationZ(){return(this.constraints&jn.FreezeRotationZ)!==0}set lockPositionX(e){e?this.constraints|=jn.FreezePositionX:this.constraints&=~jn.FreezePositionX}set lockPositionY(e){e?this.constraints|=jn.FreezePositionY:this.constraints&=~jn.FreezePositionY}set lockPositionZ(e){e?this.constraints|=jn.FreezePositionZ:this.constraints&=~jn.FreezePositionZ}set lockRotationX(e){e?this.constraints|=jn.FreezeRotationX:this.constraints&=~jn.FreezeRotationX}set lockRotationY(e){e?this.constraints|=jn.FreezeRotationY:this.constraints&=~jn.FreezeRotationY}set lockRotationZ(e){e?this.constraints|=jn.FreezeRotationZ:this.constraints&=~jn.FreezeRotationZ}set gravityScale(e){this._gravityScale=e}get gravityScale(){return this._gravityScale}awake(){this._watch=void 0,this._propertiesChanged=!1}onEnable(){this._watch||(this._watch=new sye(this.gameObject,this.context)),this._watch.start(!0,!0),this.startCoroutine(this.beforePhysics(),nn.LateUpdate)}onDisable(){var e,t;(e=this._watch)==null||e.stop(),(t=this.context.physics.engine)==null||t.removeBody(this)}onDestroy(){var e;(e=this.context.physics.engine)==null||e.removeBody(this)}onValidate(){this._propertiesChanged=!0}*beforePhysics(){var e,t,i,n;for(;;)this._propertiesChanged&&(this._propertiesChanged=!1,(e=this.context.physics.engine)==null||e.updateProperties(this)),(t=this._watch)!=null&&t.isDirty?(this._watch.mute=!0,this._watch.applyValues(),(i=this.context.physics.engine)==null||i.updateBody(this,this._watch.positionChanged,this._watch.rotationChanged),this._watch.reset()):(n=this._watch)==null||n.syncValues(),this.captureVelocity(),yield}teleport(e,t=!0){var i;(i=this._watch)==null||i.reset(!0),t?this.gameObject.position.set(e.x,e.y,e.z):this.setWorldPosition(e.x,e.y,e.z),this.resetForcesAndTorques(),this.resetVelocities()}resetForces(e=!0){var t;(t=this.context.physics.engine)==null||t.resetForces(this,e)}resetTorques(e=!0){var t;(t=this.context.physics.engine)==null||t.resetTorques(this,e)}resetVelocities(){this.setVelocity(0,0,0),this.setAngularVelocity(0,0,0)}resetForcesAndTorques(){this.resetForces(),this.resetTorques()}wakeUp(){var e;(e=this.context.physics.engine)==null||e.wakeup(this)}get isSleeping(){var e;return(e=this.context.physics.engine)==null?void 0:e.isSleeping(this)}updateProperties(){var e;return this._propertiesChanged=!1,(e=this.context.physics.engine)==null?void 0:e.updateProperties(this)}applyForce(e,t,i=!0){var n;this._propertiesChanged&&this.updateProperties(),(n=this.context.physics.engine)==null||n.addForce(this,e,i)}applyImpulse(e,t=!0){var i;this._propertiesChanged&&this.updateProperties(),(i=this.context.physics.engine)==null||i.applyImpulse(this,e,t)}setForce(e,t,i,n=!0){var r,o,a;(r=this.context.physics.engine)==null||r.resetForces(this,n),typeof e=="number"?(t??(t=0),i??(i=0),(o=this.context.physics.engine)==null||o.addForce(this,{x:e,y:t,z:i},n)):(a=this.context.physics.engine)==null||a.addForce(this,e,n)}getVelocity(){var t;const e=(t=this.context.physics.engine)==null?void 0:t.getLinearVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setVelocity(e,t,i,n=!0){var r,o;if(e instanceof S){const a=e;(r=this.context.physics.engine)==null||r.setLinearVelocity(this,a,n);return}t===void 0||i===void 0||(o=this.context.physics.engine)==null||o.setLinearVelocity(this,{x:e,y:t,z:i},n)}getAngularVelocity(){var t;const e=(t=this.context.physics.engine)==null?void 0:t.getAngularVelocity(this);return e?(this._currentVelocity.x=e.x,this._currentVelocity.y=e.y,this._currentVelocity.z=e.z,this._currentVelocity):this._currentVelocity.set(0,0,0)}setAngularVelocity(e,t,i,n=!0){var r,o;if(e instanceof S){const a=e;(r=this.context.physics.engine)==null||r.setAngularVelocity(this,a,n);return}t===void 0||i===void 0||(o=this.context.physics.engine)==null||o.setAngularVelocity(this,{x:e,y:t,z:i},n)}setTorque(e,t,i){this.setAngularVelocity(e,t,i)}get smoothedVelocity(){return this._smoothedVelocityGetter.copy(this._smoothedVelocity),this._smoothedVelocityGetter.multiplyScalar(1/this.context.time.deltaTime)}setBodyFromGameObject(e=null){}captureVelocity(){const e=Ft(this.gameObject);this.gameObject.matrixWorld.decompose(GD.tempPosition,rye,oye);const t=e.sub(this._lastPosition);this._lastPosition.copy(GD.tempPosition),this._smoothedVelocity.lerp(t,this.context.time.deltaTime/.1)}},d(CB,"tempPosition",new S),CB);let Ni=GD;Ca([wr()],Ni.prototype,"autoMass",2);Ca([C()],Ni.prototype,"mass",1);Ca([wr(),C()],Ni.prototype,"useGravity",2);Ca([C(S)],Ni.prototype,"centerOfMass",2);Ca([wr(),C()],Ni.prototype,"constraints",2);Ca([wr(),C()],Ni.prototype,"isKinematic",2);Ca([wr(),C()],Ni.prototype,"drag",2);Ca([wr(),C()],Ni.prototype,"angularDrag",2);Ca([wr(),C()],Ni.prototype,"detectCollisions",2);Ca([wr(),C()],Ni.prototype,"sleepThreshold",2);Ca([wr(),C()],Ni.prototype,"collisionDetectionMode",2);Ca([wr()],Ni.prototype,"_gravityScale",2);Ca([wr()],Ni.prototype,"dominanceGroup",2);new S;const rye=new Ce,oye=new S,id=ie("debugsync"),tb="STRS";Rk(tb,Wh.getRootAsSyncedTransformModel);const tc=new jb;function I7(s,e,t=!0){tc.clear();const i=tc.createString(s);Wh.startSyncedTransformModel(tc),Wh.addGuid(tc,i),Wh.addFast(tc,t);const n=e.worldPosition,r=e.worldEuler,o=e.gameObject.scale;Wh.addTransform(tc,T7.createTransform(tc,n.x,n.y,n.z,r.x,r.y,r.z,o.x,o.y,o.z));const a=Wh.endSyncedTransformModel(tc);return tc.finish(a,tb),tc.asUint8Array()}let HD=0,l_=0;hF(s=>{var i;const t=((i=s.connection.currentServerUrl)==null?void 0:i.includes("glitch"))?10:40;l_=Math.floor(HD/t),HD=0,id&&l_>0&&console.log("Sync Transform Fast Interval",l_)});class Gc extends Ie{constructor(){super(...arguments);d(this,"overridePhysics",!0);d(this,"interpolatePosition",!0);d(this,"interpolateRotation",!0);d(this,"fastMode",!1);d(this,"syncDestroy",!1);d(this,"_model",null);d(this,"_needsUpdate",!0);d(this,"rb",null);d(this,"_wasKinematic",!1);d(this,"_receivedDataBefore",!1);d(this,"_targetPosition");d(this,"_targetRotation");d(this,"_receivedFastUpdate",!1);d(this,"_shouldRequestOwnership",!1);d(this,"joinedRoomCallback",null);d(this,"receivedDataCallback",null);d(this,"tempEuler",new li);d(this,"receivedUpdate",!1);d(this,"lastWorldPos");d(this,"lastWorldRotation")}requestOwnership(){id&&console.log("Request ownership"),this._model?this._model.requestOwnership():(this._shouldRequestOwnership=!0,this._needsUpdate=!0)}hasOwnership(){var t;return((t=this._model)==null?void 0:t.hasOwnership)??void 0}isOwned(){var t;return(t=this._model)==null?void 0:t.isOwned}awake(){id&&console.log("new instance",this.guid,this),this._receivedDataBefore=!1,this._targetPosition=new S,this._targetRotation=new Ce,this.lastWorldPos=new S,this.lastWorldRotation=new Ce,this.rb=ne.getComponentInChildren(this.gameObject,Ni),this.rb&&(this._wasKinematic=this.rb.isKinematic),this.receivedUpdate=!0,this._model=new kk(this.context.connection,this.guid),this.context.connection.isConnected&&this.tryGetLastState(),this.joinedRoomCallback=this.tryGetLastState.bind(this),this.context.connection.beginListen(Qt.JoinedRoom,this.joinedRoomCallback),this.receivedDataCallback=this.onReceivedData.bind(this),this.context.connection.beginListenBinary(tb,this.receivedDataCallback)}onDestroy(){this.syncDestroy&&Vk(this.guid,this.context.connection),this._model=null,this.context.connection.stopListen(Qt.JoinedRoom,this.joinedRoomCallback),this.context.connection.stopListenBinary(tb,this.receivedDataCallback)}tryGetLastState(){const t=this.context.connection.tryGetState(this.guid);t&&this.onReceivedData(t)}onReceivedData(t){var i;if(!this.destroyed&&typeof t.guid=="function"&&t.guid()===this.guid){id&&console.log("new data",this.context.connection.connectionId,this.context.time.frameCount,this.guid,t),this.receivedUpdate=!0,this._receivedFastUpdate=t.fast();const n=t.transform();if(n){sl.markDirty(this.gameObject,!0);const r=n.position();r&&(this.interpolatePosition&&((i=this._targetPosition)==null||i.set(r.x(),r.y(),r.z())),(!this.interpolatePosition||!this._receivedDataBefore)&&this.setWorldPosition(r.x(),r.y(),r.z()));const o=n.rotation();o&&(this.tempEuler.set(o.x(),o.y(),o.z()),this.interpolateRotation&&this._targetRotation.setFromEuler(this.tempEuler),(!this.interpolateRotation||!this._receivedDataBefore)&&tk(this.gameObject,this.tempEuler))}this._receivedDataBefore=!0}}onEnable(){this.lastWorldPos.copy(this.worldPosition),this.lastWorldRotation.copy(this.worldQuaternion),this._needsUpdate=!0,this._model&&this._model.updateIsOwned()}onDisable(){this._model&&this._model.freeOwnership()}onBeforeRender(){if(!this.activeAndEnabled||!this.context.connection.isConnected)return;if(!this.context.connection.isInRoom||!this._model){id&&console.log("no model or room",this.name,this.guid,this.context.connection.isInRoom);return}this._shouldRequestOwnership&&(this._shouldRequestOwnership=!1,this._model.requestOwnership());const t=this.worldPosition,i=this.worldQuaternion;if(this._model.isOwned&&!this.receivedUpdate){const o=t.distanceTo(this.lastWorldPos),a=i.angleTo(this.lastWorldRotation),l=this._model.hasOwnership||this.fastMode?1e-4:.001;(o>l||a>l)&&(this._model.hasOwnership?this._needsUpdate=!0:(id&&console.log(this.guid,"reset because not owned but",this.gameObject.name,this.lastWorldPos),this.worldPosition=this.lastWorldPos,t.copy(this.lastWorldPos),this.worldQuaternion=this.lastWorldRotation,i.copy(this.lastWorldRotation),sl.markDirty(this.gameObject,!0),this._needsUpdate=!1))}if(this._model&&!this._model.hasOwnership&&this._model.isOwned&&this._receivedDataBefore){const a=this._receivedFastUpdate||this.fastMode?.5:.3;let l=!1;if(this.interpolatePosition&&this._targetPosition){const c=this.worldPosition;c.lerp(this._targetPosition,a),this.worldPosition=c,l=!0}if(this.interpolateRotation&&this._targetRotation){const c=this.worldQuaternion;c.slerp(this._targetRotation,a),this.worldQuaternion=c,l=!0}l&&sl.markDirty(this.gameObject,!0)}if(this.receivedUpdate=!1,this.lastWorldPos.copy(t),this.lastWorldRotation.copy(i),!this._model||!this._model||this._model.hasOwnership===void 0||!this._model.hasOwnership)return;this.rb&&this.overridePhysics&&this._wasKinematic!==void 0&&(id&&console.log("reset kinematic",this.rb.name,this._wasKinematic),this.rb.isKinematic=this._wasKinematic);const n=10,r=this.rb||this.fastMode;if(this._needsUpdate&&(this.context.time.frameCount%n===0||r)){if(HD++,r&&l_>0&&this.context.time.frameCount%l_!==0)return;id&&console.log("send update",this.context.connection.connectionId,this.guid,this.gameObject.name,this.gameObject.guid),this._needsUpdate=!1;const o=I7(this.guid,this,!!r);this.context.connection.sendBinary(o)}}}const aye=ie("debugshadowcomponents");XL.prototype.interactable={get(){return this.interactive},set(s){this.interactable=s}};const $a=Symbol("shadowDomOwner");class ol extends Ie{constructor(){super(...arguments);d(this,"_shadowComponent",null);d(this,"_controlsChildLayout",!0);d(this,"_root");d(this,"_parentComponent")}isRoot(){var t;return((t=this.Root)==null?void 0:t.gameObject)===this.gameObject}get canvas(){const t=this.Root;return t!=null&&t.isCanvas?t:null}get Canvas(){return this.canvas}markDirty(){Oo.markUIDirty(this.context)}get shadowComponent(){return this._shadowComponent}set shadowComponent(t){this._shadowComponent=t}get controlsChildLayout(){return this._controlsChildLayout}set controlsChildLayout(t){this._controlsChildLayout=t,this.shadowComponent&&(this.shadowComponent.autoLayout=t)}get Root(){return this._root===void 0&&(this._root=ne.getComponentInParent(this.gameObject,rx)),this._root}__internalNewInstanceCreated(t){return super.__internalNewInstanceCreated(t),this.shadowComponent=null,this._root=void 0,this._parentComponent=void 0,this}onEnable(){super.onEnable()}addShadowComponent(t,i){var o;if(!t)return;this.removeShadowComponent();const n=this.isRoot()?this.gameObject:this.gameObject.parent;if(this._parentComponent=ne.getComponentInParent(n,ol),!this._parentComponent){console.warn(`Component "${this.name}" doesn't have a UI parent anywhere. Do you have an UI element outside a Canvas? UI components must be a child of a Canvas component`,this);return}t.name=this.name+" ("+(this.constructor.name??"UI")+")",t.autoLayout=this._parentComponent.controlsChildLayout,t[$a]=this,this.setShadowComponentOwner(t);let r=!1;if(((o=this.Root)==null?void 0:o.gameObject)===this.gameObject)this.gameObject.add(t);else{const a=this._parentComponent.shadowComponent;a&&(a==null||a.add(t),r=!0)}this.shadowComponent=t,i&&i.shadowComponent&&this.shadowComponent&&i.shadowComponent.add(this.shadowComponent),Jb&&t.add(new _a(.5)),this.onAfterAddedToScene(),r&&CQ(),aye&&console.warn("Added shadow component",this.shadowComponent)}setShadowComponentOwner(t){if(t&&(t[$a]===void 0||t[$a]===this)&&(t[$a]=this,t.children))for(const i of t.children)this.setShadowComponentOwner(i)}traverseOwnedShadowComponents(t,i,n){if(t&&t[$a]===i){n(t);for(const r of t.children)this.traverseOwnedShadowComponents(r,i,n)}}removeShadowComponent(){this.shadowComponent&&this.shadowComponent.removeFromParent()}onAfterAddedToScene(){}setInteractable(t){this.shadowComponent&&(this.shadowComponent.interactable=t)}}class rx extends ol{awake(){super.awake()}}class Ov{constructor(e,t){d(this,"event");d(this,"button");d(this,"buttonName");d(this,"_used",!1);d(this,"_propagationStopped",!1);d(this,"z__pointer_ctured",!1);d(this,"z__pointer_cture_rleased",!1);d(this,"inputSource");d(this,"object");d(this,"point");d(this,"normal");d(this,"face");d(this,"distance");d(this,"instanceId");d(this,"intersection");d(this,"isDown");d(this,"isUp");d(this,"isPressed");d(this,"isClick");d(this,"isDoubleClick");d(this,"input");this.event=t,this.input=e,this.button=t.button}get deviceIndex(){return this.event.deviceIndex}get pointerId(){return this.event.pointerId}get pressure(){return this.event.pressure}get used(){return this._used}use(){this._used||(this._used=!0,this.event.use())}get propagationStopped(){return this._propagationStopped}stopPropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}stopImmediatePropagation(){this._propagationStopped=!0,this.event.stopImmediatePropagation()}setPointerCapture(){this.z__pointer_ctured=!0}releasePointerCapture(){this.z__pointer_cture_rleased=!0}get mode(){return this.event.mode}clone(){const e=new Ov(this.input,this.event);return Object.assign(e,this),e}Use(){this.use()}StopPropagation(){this.event.stopImmediatePropagation()}}function AE(s,e){return ne.foreachComponent(s,i=>{if(!i.enabled)return;const n=i;if(e)switch(e){case"pointerdown":if(n.onPointerDown)return!0;break;case"pointerup":if(n.onPointerUp||n.onPointerClick)return!0;break;case"pointermove":if(n.onPointerEnter||n.onPointerExit||n.onPointerMove)return!0;break}else if(n.onPointerDown||n.onPointerUp||n.onPointerEnter||n.onPointerExit||n.onPointerClick)return!0},!1)===!0}var lye=Object.defineProperty,cye=Object.getOwnPropertyDescriptor,hye=(s,e,t,i)=>{for(var n=i>1?void 0:i?cye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&lye(e,t,n),n};class ox extends Ie{awake(){Oo.createIfNoneExists(this.context)}onEnable(){var e;(e=Oo.get(this.context))==null||e.register(this)}onDisable(){var e;(e=Oo.get(this.context))==null||e.unregister(this)}}class wa extends ox{constructor(){super(...arguments);d(this,"targets",null);d(this,"raycastHits",[]);d(this,"ignoreSkinnedMeshes",!1)}start(){this.targets=[this.gameObject]}performRaycast(t=null){if(!this.targets)return null;t??(t=new zc),t.targets=this.targets,t.results=this.raycastHits,t.useAcceleratedRaycast=!0;const i=t.testObject;this.ignoreSkinnedMeshes&&(t.testObject=r=>r instanceof Fo?"continue in children":i?i(r):!0);const n=this.context.physics.raycast(t);return t.testObject=i,n}}hye([C()],wa.prototype,"ignoreSkinnedMeshes",2);class lT extends wa{constructor(){super(),this.ignoreSkinnedMeshes=!0}}const kU=class extends ox{performRaycast(e){if(!Mt.active||!kU.allow||!(e!=null&&e.ray))return null;const t=e.ray.origin,i=.015;return this.context.physics.sphereOverlap(t,i,!1,!0)}};let Ld=kU;d(Ld,"allow",!0);class cT{static getObject(e){const t=e[$a];return t&&(t.isComponent===!0?e=t.gameObject:e=t),e}static isInteractable(e,t){if(t&&(t.canvasGroup=void 0,t.graphic=void 0),e==null||!e.visible||(e=this.getObject(e),!e.visible))return!1;const i=this.tryFindCanvasGroup(e);if((i==null?void 0:i.isCanvasGroup)===!0&&(t&&(t.canvasGroup=i),i.blocksRaycasts===!1||i.interactable===!1))return!1;const n=lm(e,r=>{if(r.isGraphic===!0)return r},!1);return t&&(n==null?void 0:n.isGraphic)===!0&&(t.graphic=n),!((n==null?void 0:n.raycastTarget)===!1||(n==null?void 0:n.layer)===2)}static tryFindCanvasGroup(e){if(!e)return null;const t=lm(e,i=>{const n=i;if(n.blocksRaycasts!==void 0&&n.interactable!==void 0)return n},!1);return t!==void 0?t:this.tryFindCanvasGroup(e.parent)}}function uF(s){const e=s[$a];return e||(s.parent?uF(s.parent):null)}function uye(s){return s.isUI===!0||typeof s[$a]=="object"}function _E(s,e){if(!s)return;const t=s.material;if((t==null?void 0:t.isMaterial)===!0){const i=s.parent;i&&i.isText,t.side=e.doubleSided??!0?_i:$n,t.shadowSide=e.doubleSided?_i:$n,s.castShadow=e.castShadows?e.castShadows:!1,s.receiveShadow=e.receiveShadows?e.receiveShadows:!1}for(const i of s.children)_E(i,e)}function sy(s,e,t){s[e]===void 0&&console.warn("Field",e,"is undefined on",s);const i=Proxy.revocable(s[e],{set(o,a,l,c){const h=o[a],u=Reflect.set(o,a,l,c);return t(l,h),u}}),n=i.revoke,r=s[e];return i.revoke=()=>{s[e]=r,n()},s[e]=i.proxy,i}const sH=Symbol("Scheduled action");function dye(s,e,t=nn.OnBeforeRender){let i=s[sH];i||(i=s[sH]={});const n=e.name;i[t]||(i[t]={});const r=i[t];if(r[n])return;function*a(){e==null||e.call(s),r[n]=null}const l=s.startCoroutine(a(),t);r[n]=l}const Sh=ie("debugeventsystem");var VD=(s=>(s.BeforeHandleInput="BeforeHandleInput",s.AfterHandleInput="AfterHandleInput",s))(VD||{});const uc=class extends Ie{constructor(){super();d(this,"raycaster",[]);d(this,"pressedByID",new Map);d(this,"hoveredByID",new Map);d(this,"onPointerEvent",t=>{if(t===void 0||t.propagationStopped||t.defaultPrevented||t.used)return;const i=new Ov(this.context.input,t);this._currentPointerEventName=t.type,i.inputSource=this.context.input,i.isClick=t.isClick,i.isDoubleClick=t.isDoubleClick,i.isDown=t.type==vn.PointerDown,i.isUp=t.type==vn.PointerUp,i.isPressed=this.context.input.getPointerPressed(t.pointerId),Sh&&(i.isDown?console.log("DOWN",i.pointerId):i.isUp&&console.log("UP",i.pointerId),i.isClick&&console.log("CLICK",i.pointerId));const n=new zc;t.hasRay?n.ray=t.ray:n.screenPoint=this.context.input.getPointerPositionRC(t.pointerId);const r=this.performRaycast(n);if(r){for(const a of r)a.event=t,t.intersections.push(a);t.origin.onPointerHits&&t.origin.onPointerHits({sender:this,event:t,hits:r})}Sh&&i.isClick&&_n("EventSystem: "+i.pointerId+" - "+this.context.time.frame+" - Up:"+i.isUp+", Down:"+i.isDown);const o={sender:this,args:i,hasActiveUI:this.currentActiveMeshUIComponents.length>0};this.dispatchEvent(new CustomEvent("BeforeHandleInput",{detail:o})),this.handleIntersections(r,i),this.dispatchEvent(new CustomEvent("AfterHandleInput",{detail:o}))});d(this,"_sortedHits",[]);d(this,"_testObjectsCache",new Map);d(this,"_currentlyActiveRaycaster",null);d(this,"_currentPointerEventName",null);d(this,"shouldRaycastObject",t=>{var r;let i=null;if(uye(t)&&(i=(r=t[$a])==null?void 0:r.gameObject),this._testObjectsCache.has(t)||i&&this._testObjectsCache.has(i))return this._testObjectsCache.get(t)===!1?"continue in children":!0;{let o=AE(t,this._currentPointerEventName);if(!o&&i&&(o=AE(i,this._currentPointerEventName)),o){this._testObjectsCache.set(t,!0);for(const a of t.children)this.shouldRaycastObject_AddToYesCache(a);return!0}return this._testObjectsCache.set(t,!1),"continue in children"}});d(this,"_sortingBuffer",[]);d(this,"_noDepthTestingResults",[]);d(this,"out",{});d(this,"_capturedPointer",{});d(this,"pointerEnterSymbol",Symbol("pointerEnter"));d(this,"pointerExitSymbol",Symbol("pointerExit"));d(this,"currentActiveMeshUIComponents",[]);uc.systems.push(this)}static createIfNoneExists(t){this.didSearchEventSystem||(this.didSearchEventSystem=!0,uc.systems.length<=0&&uc.systems.push(...ne.findObjectsOfType(uc,t)));for(const n of uc.systems)if(n.context===t)return;const i=new ye;ne.addNewComponent(i,uc),t.scene.add(i)}static get systems(){const t=Dt.Current;return this._eventSystemMap.has(t)||this._eventSystemMap.set(t,[]),this._eventSystemMap.get(t)}static get(t){const i=this._eventSystemMap.get(t);return i&&i.length>0?i[0]:null}static get instance(){return this.systems[0]}static ensureUpdateMeshUI(t,i,n=!1){pd.update(t,i,n)}static markUIDirty(t){pd.markDirty()}get hasActiveUI(){return this.currentActiveMeshUIComponents.length>0}get isHoveringObjects(){return this.hoveredByID.size>0}onDestroy(){uc.systems.splice(uc.systems.indexOf(this),1)}start(){if(this.raycaster.length<=0&&!ne.findObjectOfType(ox,this.context)){const i=ne.addNewComponent(this.context.scene,wa);this.raycaster.push(i),(nt()||Sh)&&console.warn("Added an ObjectRaycaster to the scene because no raycaster was found.")}}register(t){var i;t&&this.raycaster&&!this.raycaster.includes(t)&&((i=this.raycaster)==null||i.push(t))}unregister(t){var n,r;const i=(n=this.raycaster)==null?void 0:n.indexOf(t);i!==void 0&&i!==-1&&((r=this.raycaster)==null||r.splice(i,1))}onEnable(){this.context.input.addEventListener(vn.PointerDown,this.onPointerEvent),this.context.input.addEventListener(vn.PointerUp,this.onPointerEvent),this.context.input.addEventListener(vn.PointerMove,this.onPointerEvent)}onDisable(){this.context.input.removeEventListener(vn.PointerDown,this.onPointerEvent),this.context.input.removeEventListener(vn.PointerUp,this.onPointerEvent),this.context.input.removeEventListener(vn.PointerMove,this.onPointerEvent)}onBeforeRender(){this.resetMeshUIStates()}shouldRaycastObject_AddToYesCache(t){this._testObjectsCache.set(t,!0);for(const i of t.children)this.shouldRaycastObject_AddToYesCache(i)}performRaycast(t){if(!this.raycaster)return null;this._testObjectsCache.clear(),this._sortedHits.length=0,t||(t=new zc),t.testObject=this.shouldRaycastObject;for(const i of this.raycaster){if(!i.activeAndEnabled)continue;this._currentlyActiveRaycaster=i;const n=i.performRaycast(t);this._currentlyActiveRaycaster=null,n&&n.length>0&&this._sortedHits.push(...n)}return this._sortedHits.sort((i,n)=>i.distance-n.distance),this._sortedHits}assignHitInformation(t,i){i?(t.intersection=i,t.point=i.point,t.normal=i.normal,t.face=i.face,t.distance=i.distance,t.instanceId=i.instanceId):(t.intersection=void 0,t.point=void 0,t.normal=void 0,t.face=void 0,t.distance=void 0,t.instanceId=void 0)}handleIntersections(t,i){var r;if(t!=null&&t.length){t=this.sortCandidates(t);for(const o of t){if(i.event.immediatePropagationStopped)return!1;if(this.assignHitInformation(i,o),this.handleEventOnObject(o.object,i))return!0}}this.assignHitInformation(i,t==null?void 0:t[0]),this.invokePointerCapture(i);const n=this.hoveredByID.get(i.pointerId);return n&&this.propagatePointerExit(n.obj,n.data,null),this.hoveredByID.delete(i.pointerId),i.isUp&&((r=this.pressedByID.get(i.pointerId))==null||r.handlers.forEach(o=>this.invokeOnPointerUp(i,o)),this.pressedByID.delete(i.pointerId)),!1}sortCandidates(t){this._sortingBuffer.length=0,this._noDepthTestingResults.length=0;for(let i=0;i<t.length;i++){const n=t[i],r=n.object;if(r.material&&r.material.depthTest===!1){this._noDepthTestingResults.push(n);continue}this._sortingBuffer.push(n)}for(const i of this._sortingBuffer)this._noDepthTestingResults.push(i);return this._noDepthTestingResults}handleEventOnObject(t,i){if(!this.testIsVisible(t))return i.isClick&&Sh&&console.log("not allowed",t),!1;if(i.pointerId===void 0)return Sh&&console.error("Event without pointer can't be handled",i),!1;i.object=t;const n=t.parent,r=i.isClick??!1;let o=null;if(n&&n.isUI){const u=(i.isPressed||i.isClick)??!1;if(n[$a]){const f=n[$a].gameObject;if(f){if(!cT.isInteractable(f,this.out))return!1;o=this.out.canvasGroup??null,this.handleMeshUIIntersection(t,u),t=f}}}r&&Sh&&console.log(this.context.time.frame,t);const a=this.hoveredByID.get(i.pointerId),l=a==null?void 0:a.obj;l!==t&&l&&this.propagatePointerExit(l,a.data,t);const h=this.hoveredByID.get(i.pointerId);if(h?(h.obj=t,h.data=i):this.hoveredByID.set(i.pointerId,{obj:t,data:i}),i.isDown){const u=this.pressedByID.get(i.pointerId);u?(u.obj=t,u.data=i):this.pressedByID.set(i.pointerId,{obj:t,data:i,handlers:new Set})}return(o===null||o.interactable)&&this.handleMainInteraction(t,i,l??null),!0}propagate(t,i){for(;t;)ne.foreachComponent(t,n=>{i(n)},!1),t=t.parent}handleMainInteraction(t,i,n){const r=this.pressedByID.get(i.pointerId),o=n!==t;let a=!0;switch(i.event.pointerType){case"mouse":case"touch":const l=this.context.input.getPointerPositionLastFrame(i.pointerId),c=this.context.input.getPointerPosition(i.pointerId);a=l&&!it.approximately(l,c);break}this.propagate(t,l=>{var h;const c=l;c.interactable!==!1&&(!c.activeAndEnabled||!c.enabled||(c.onPointerEnter&&o&&this.handlePointerEnter(c,i),i.isDown&&c.onPointerDown&&(c.onPointerDown(i),r==null||r.handlers.add(c),this.handlePointerCapture(i,c)),c.onPointerMove&&(a&&c.onPointerMove(i),this.handlePointerCapture(i,c)),i.isUp&&(c.onPointerUp&&(this.invokeOnPointerUp(i,c),r==null||r.handlers.delete(c)),c.onPointerExit&&((h=i.event)==null?void 0:h.pointerType)===QM.Touch&&(this.handlePointerExit(c,i),this.hoveredByID.delete(i.pointerId))),i.isClick&&c.onPointerClick&&c.onPointerClick(i)))}),i.isUp&&(r==null||r.handlers.forEach(l=>{this.invokeOnPointerUp(i,l)}),this.pressedByID.delete(i.pointerId))}propagatePointerExit(t,i,n){this.propagate(t,r=>{if(!r.gameObject||r.destroyed)return;const o=r;if(o.onPointerExit||o.onPointerEnter){if(n&&this.isChild(n,r.gameObject))return;this.handlePointerExit(o,i)}})}invokeOnPointerUp(t,i){var n;(n=i.onPointerUp)==null||n.call(i,t),this.releasePointerCapture(t,i)}handlePointerEnter(t,i){t.onPointerEnter&&this.updatePointerState(t,i.pointerId,this.pointerEnterSymbol,!0)&&t.onPointerEnter(i),this.updatePointerState(t,i.pointerId,this.pointerExitSymbol,!1)}handlePointerExit(t,i){t.onPointerExit&&this.updatePointerState(t,i.pointerId,this.pointerExitSymbol,!0)&&t.onPointerExit(i),this.updatePointerState(t,i.pointerId,this.pointerEnterSymbol,!1)}updatePointerState(t,i,n,r){let o=t[n];if(r)return o&&o.includes(i)?!1:(o=o||[],o.push(i),t[n]=o,!0);{if(!o||!o.includes(i))return!1;const a=o.indexOf(i);return a!==-1&&o.splice(a,1),!0}}handlePointerCapture(t,i){if(t.z__pointer_ctured){t.z__pointer_ctured=!1;const n=t.pointerId;if(i.onPointerMove){const r=this._capturedPointer[n]||[];r.push(i),this._capturedPointer[n]=r}else nt()&&!i.z__warned_no_pointermove&&(i.z__warned_no_pointermove=!0,console.warn("PointerCapture was requested but the component doesn't implement onPointerMove. It will not receive any pointer events"))}else t.z__pointer_cture_rleased&&(t.z__pointer_cture_rleased=!1,this.releasePointerCapture(t,i))}releasePointerCapture(t,i){const n=t.pointerId;if(this._capturedPointer[n]){const r=this._capturedPointer[n].indexOf(i);r!==-1&&(this._capturedPointer[n].splice(r,1),Sh&&console.log("released pointer capture",n,i,this._capturedPointer))}}invokePointerCapture(t){var i;if(t.event.type===vn.PointerMove){const n=t.pointerId,r=this._capturedPointer[n];if(r){Sh&&console.log("Captured",n,r);for(let o=0;o<r.length;o++){const a=r[o];if(a.destroyed){r.splice(o,1),o--;continue}(i=a.onPointerMove)==null||i.call(a,t)}}}}isChild(t,i){return!t||!i?!1:t===i?!0:t.parent?this.isChild(t.parent,i):!1}handleMeshUiObjectWithoutShadowDom(t,i){return!t||!t.isUI?!0:this.handleMeshUIIntersection(t,i)}handleMeshUIIntersection(t,i){const n=pd.updateState(t,i);return n&&this.currentActiveMeshUIComponents.push(n),n!==null}resetMeshUIStates(){if(this.context.input.getPointerPressedCount()>0&&pd.resetLastSelected(),!(!this.currentActiveMeshUIComponents||this.currentActiveMeshUIComponents.length<=0)){for(let t=0;t<this.currentActiveMeshUIComponents.length;t++){const i=this.currentActiveMeshUIComponents[t];pd.resetState(i)}this.currentActiveMeshUIComponents.length=0}}testIsVisible(t){return t?ne.isActiveSelf(t)?this.testIsVisible(t.parent):!1:!0}};let Oo=uc;d(Oo,"_eventSystemMap",new Map),d(Oo,"didSearchEventSystem",!1);class pd{static markDirty(){this.needsUpdate=!0}static update(e,t,i=!1){if(i){e.update();return}const n=t.time.frameCount;for(const r of this.lastUpdateFrame)if(r.context===t){if(n===r.frame)return;r.frame=n;let o=this.needsUpdate||n<1;r.nextUpdate<=n&&(o=!0),o&&(Sh&&console.log("Update threemeshui"),this.needsUpdate=!1,r.nextUpdate=n+60,e.update());return}this.lastUpdateFrame=[{context:t,frame:n,nextUpdate:n+60}],e.update(),this.needsUpdate=!1}static updateState(e,t){let i=null;if(e&&(i=this.findBlockInParent(e),i&&i!==this.lastSelected)){if(i.interactable===!1)return null;this.needsUpdate=!0}return i}static resetLastSelected(){const e=this.lastSelected;e&&(this.lastSelected=null,this.resetState(e))}static resetState(e){e&&(this.needsUpdate=!0)}static findBlockInParent(e){return e?e.isBlock?e:this.findBlockInParent(e.parent):null}}d(pd,"lastSelected",null),d(pd,"lastUpdateFrame",[]),d(pd,"needsUpdate",!1);var fye=Object.defineProperty,pye=Object.getOwnPropertyDescriptor,En=(s,e,t,i)=>{for(var n=i>1?void 0:i?pye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&fye(e,t,n),n};const SP=ie("debugorbit"),US=ie("freecam"),NS=ie("debugcamerafit"),zS=ie("smoothcam"),mye={LEFT:"",UP:"",RIGHT:"",BOTTOM:""};let CP;class ib extends CustomEvent{constructor(e,t){super("target-reached",{detail:{controls:e,type:t}})}}class Ei extends Ie{constructor(){super(...arguments);d(this,"autoTarget",!0);d(this,"autoFit",!1);d(this,"enableRotate",!0);d(this,"autoRotate",!1);d(this,"autoRotateSpeed",1);d(this,"minAzimuthAngle",1/0);d(this,"maxAzimuthAngle",1/0);d(this,"minPolarAngle",0);d(this,"maxPolarAngle",Math.PI);d(this,"enableKeys",!0);d(this,"enableDamping",!0);d(this,"dampingFactor",.1);d(this,"enableZoom",!0);d(this,"minZoom",0);d(this,"maxZoom",1/0);d(this,"zoomSpeed",1);d(this,"zoomToCursor",!1);d(this,"enablePan",!0);d(this,"lookAtConstraint",null);d(this,"lookAtConstraint01",1);d(this,"allowInterrupt",!0);d(this,"middleClickToFocus",!0);d(this,"doubleClickToFocus",!0);d(this,"clickBackgroundToFitScene",2);d(this,"debugLog",!1);d(this,"targetLerpDuration",1);d(this,"_controls",null);d(this,"_cameraObject",null);d(this,"_lookTargetLerpActive",!1);d(this,"_lookTargetStartPosition",new S);d(this,"_lookTargetEndPosition",new S);d(this,"_lookTargetLerp01",0);d(this,"_lookTargetLerpDuration",0);d(this,"_cameraLerpActive",!1);d(this,"_cameraStartPosition",new S);d(this,"_cameraEndPosition",new S);d(this,"_cameraLerp01",0);d(this,"_cameraLerpDuration",0);d(this,"_inputs",0);d(this,"_enableTime",0);d(this,"_startedListeningToKeyEvents",!1);d(this,"_eventSystem");d(this,"_afterHandleInputFn");d(this,"_camera",null);d(this,"_syncedTransform");d(this,"_didSetTarget",0);d(this,"targetElement",null);d(this,"_activePointerEvents");d(this,"_lastTimeClickOnBackground",-1);d(this,"_clickOnBackgroundCount",0);d(this,"_onPointerDown",t=>{this._activePointerEvents.push(t)});d(this,"_onPointerUp",t=>{for(let i=this._activePointerEvents.length-1;i>=0;i--){const n=this._activePointerEvents[i];if(n.pointerId===t.pointerId&&n.button===t.button){this._activePointerEvents.splice(i,1);break}}if(this.clickBackgroundToFitScene>0&&t.isClick&&t.button===0){if(t.hasRay||t.intersections.push(...this.context.physics.raycast()),t.intersections.length<=0){const i=this.context.time.time-this._lastTimeClickOnBackground;this._lastTimeClickOnBackground=this.context.time.time,this.clickBackgroundToFitScene<=1||i<this.clickBackgroundToFitScene*.15?(this._clickOnBackgroundCount+=1,this._clickOnBackgroundCount>=this.clickBackgroundToFitScene-1&&this.fitCamera(this.context.scene.children,{immediate:!1})):this._clickOnBackgroundCount=0}SP&&console.log(this.clickBackgroundToFitScene,t.intersections.length,this._clickOnBackgroundCount)}});d(this,"onControlsChangeStarted",()=>{this._syncedTransform&&this._syncedTransform.requestOwnership()});d(this,"_shouldDisable",!1);d(this,"__onPreRender",()=>{const t=this.context.pre_render_callbacks.indexOf(this.__onPreRender);t>=0&&this.context.pre_render_callbacks.splice(t,1),this.autoFit&&(this.autoFit=!1,this.fitCamera(this.scene.children,{centerCamera:"y",immediate:!0}))});d(this,"_haveAttachedKeyboardEvents",!1)}get isCameraController(){return!0}get controls(){return this._controls}get controllerObject(){return this._cameraObject}onStartInteraction(t){var i;(i=this.controls)==null||i.addEventListener("start",t)}get targetLerpSpeed(){return 5}set targetLerpSpeed(t){this.targetLerpDuration=1/t}awake(){this._didSetTarget=0,this._startedListeningToKeyEvents=!1}start(){this._eventSystem=Oo.get(this.context)??void 0,this._eventSystem&&(this._afterHandleInputFn=this.afterHandleInput.bind(this),this._eventSystem.addEventListener(VD.AfterHandleInput,this._afterHandleInputFn))}onDestroy(){var t,i;(t=this._controls)==null||t.dispose(),(i=this._eventSystem)==null||i.removeEventListener(VD.AfterHandleInput,this._afterHandleInputFn)}onEnable(){this._didSetTarget=0,this._enableTime=this.context.time.time;const t=ne.getComponent(this.gameObject,Hi);this._camera=t;let i=t==null?void 0:t.cam;if(!i&&this.gameObject instanceof Vt&&(i=this.gameObject),i&&O2(i,this,!0),!this._controls&&i instanceof Vt){this._cameraObject=i;const n=this.targetElement??this.context.renderer.domElement,r=i==null?void 0:i.quaternion.clone();this._controls=new E7(i,n),i==null||i.quaternion.copy(r),CP===void 0&&(CP={...this._controls.keys})}this._controls&&(US&&(this.enablePan=!0,this.enableZoom=!0,this.middleClickToFocus=!0,Wc()&&(this.doubleClickToFocus=!0)),this._controls.addEventListener("start",this.onControlsChangeStarted),(i==null?void 0:i.type)==="PerspectiveCamera"?US||(this._controls.minDistance=this.minZoom,this._controls.maxDistance=this.maxZoom):US||(this._controls.minZoom=this.minZoom,this._controls.maxZoom=this.maxZoom),this._startedListeningToKeyEvents||(this._startedListeningToKeyEvents=!0,this._controls.listenToKeyEvents(window.document.body))),this._syncedTransform=ne.getComponent(this.gameObject,Gc)??void 0,this.context.pre_render_callbacks.push(this.__onPreRender),this._activePointerEvents=[],this.context.input.addEventListener("pointerdown",this._onPointerDown,{queue:Ka.Early}),this.context.input.addEventListener("pointerup",this._onPointerUp,{queue:Ka.Early})}onDisable(){var t;(t=this._camera)!=null&&t.cam&&O2(this._camera.cam,this,!1),this._controls&&(this._controls.enabled=!1,this._controls.autoRotate=!1,this._controls.removeEventListener("start",this.onControlsChangeStarted)),this._activePointerEvents.length=0,this.context.input.removeEventListener("pointerdown",this._onPointerDown),this.context.input.removeEventListener("pointerup",this._onPointerUp)}afterHandleInput(t){t.detail.args.pointerId===0&&(t.detail.args.isDown?this._controls&&this._eventSystem&&(this._shouldDisable=this._eventSystem.hasActiveUI):(!t.detail.args.isPressed||t.detail.args.isUp)&&(this._shouldDisable=!1))}onBeforeRender(){var i,n;if(!this._controls)return;if(this._cameraObject!==this.context.mainCamera){this._controls.enabled=!1;return}if(this._controls.enabled=!0,(this.context.input.getPointerDown(1)||this.context.input.getPointerDown(2)||this.context.input.mouseWheelChanged||this.context.input.getPointerPressed(0)&&((i=this.context.input.getPointerPositionDelta(0))!=null&&i.length())||0>.1)&&(this._inputs+=1),this._inputs>0&&this.allowInterrupt&&(this.enableRotate&&(this.autoRotate=!1),this._cameraLerpActive=!1,this._lookTargetLerpActive=!1),this._inputs=0,this.autoTarget&&this._didSetTarget++===0){const r=ne.getComponent(this.gameObject,Hi);if(r&&!this.setLookTargetFromConstraint()){this.debugLog&&console.log("NO TARGET");const o=Ft(r.cam),a=Math.max(.01,o.length()),l=new S(0,0,-a).applyMatrix4(r.cam.matrixWorld);this.setLookTargetPosition(l,!0)}if(!this.setLookTargetFromConstraint()){const o=new zc;o.screenPoint=new ee(0,0),o.lineThreshold=.1;const a=this.context.physics.raycast(o);a.length>0&&this.setLookTargetPosition(a[0].point,!0),NS&&console.log("OrbitControls hits",...a)}}let t=this.middleClickToFocus&&this.context.input.getPointerClicked(1);if(t||(t=this.doubleClickToFocus&&this.context.input.getPointerDoubleClicked(0)&&this.context.time.time-this._enableTime>.3),t&&this.setTargetFromRaycast(),this._lookTargetLerpActive||this._cameraLerpActive){if(this._cameraLerpActive&&this._cameraObject)if(this._cameraLerp01+=this.context.time.deltaTime/this._cameraLerpDuration,this._cameraLerp01>=1)this._cameraObject.position.copy(this._cameraEndPosition),this._cameraLerpActive=!1,this.dispatchEvent(new ib(this,"camera"));else{const r=it.easeInOutCubic(this._cameraLerp01);this._cameraObject.position.lerpVectors(this._cameraStartPosition,this._cameraEndPosition,r)}if(this._lookTargetLerpActive)if(this._lookTargetLerp01+=this.context.time.deltaTime/this._lookTargetLerpDuration,this._lookTargetLerp01>=1)this._controls.target.copy(this._lookTargetEndPosition),this._lookTargetLerpActive=!1,this.dispatchEvent(new ib(this,"lookat"));else{const r=it.easeInOutCubic(this._lookTargetLerp01);this._controls.target.lerpVectors(this._lookTargetStartPosition,this._lookTargetEndPosition,r)}}if(this._controls){if(this.debugLog&&(this._controls.domElement=this.context.renderer.domElement),this._controls.enabled=!this._shouldDisable&&this._camera===this.context.mainCameraComponent&&!this.context.isInXR&&!this._activePointerEvents.some(r=>r.used),this._controls.keys=this.enableKeys?CP:mye,this._controls.autoRotate=this.autoRotate,this._controls.autoRotateSpeed=this.autoRotateSpeed,this._controls.enableZoom=this.enableZoom,this._controls.zoomSpeed=this.zoomSpeed,this._controls.zoomToCursor=this.zoomToCursor,this._controls.enableDamping=this.enableDamping,this._controls.dampingFactor=this.dampingFactor,this._controls.enablePan=this.enablePan,this._controls.enableRotate=this.enableRotate,this._controls.minAzimuthAngle=this.minAzimuthAngle,this._controls.maxAzimuthAngle=this.maxAzimuthAngle,this._controls.minPolarAngle=this.minPolarAngle,this._controls.maxPolarAngle=this.maxPolarAngle,typeof zS=="number"||zS===!0){this._controls.enableDamping=!0;const r=typeof zS=="number"?zS:.99;this._controls.dampingFactor=Math.max(.001,1-Math.min(1,r))}this.allowInterrupt||(this._lookTargetLerpActive&&(this._controls.enablePan=!1),this._cameraLerpActive&&(this._controls.enableRotate=!1,this._controls.autoRotate=!1),(this._lookTargetLerpActive||this._cameraLerpActive)&&(this._controls.enableZoom=!1)),this.context.isInXR||(!US&&((n=this.lookAtConstraint)!=null&&n.locked)&&this.setLookTargetFromConstraint(0,this.lookAtConstraint01),this._controls.update(),SP&&_t.DrawWireSphere(this._controls.target,.1,65280))}}setCameraAndLookTarget(t){if(!t||!(t instanceof ye))return;const i=Ft(t),n=$L(t);this.setTargetFromRaycast(new _o(i,n)),this.setCameraTargetPosition(i)}setCameraTargetPosition(t,i=!1){var n,r;t&&(t instanceof ye&&(t=Ft(t)),this._cameraEndPosition||(this._cameraEndPosition=new S),this._cameraEndPosition.copy(t),i===!0?(this._cameraLerpActive=!1,(n=this.controllerObject)==null||n.position.copy(this._cameraEndPosition)):this._cameraObject&&(this._cameraLerpActive=!0,this._cameraLerp01=0,this._cameraStartPosition.copy((r=this._cameraObject)==null?void 0:r.position),typeof i=="number"?this._cameraLerpDuration=i:this._cameraLerpDuration=this.targetLerpDuration))}get cameraLerpActive(){return this._cameraLerpActive}stopCameraLerp(){this._cameraLerpActive=!1}setLookTargetPosition(t=null,i=!1){this._controls&&t&&(t instanceof ye&&(t=Ft(t)),this._lookTargetEndPosition.copy(t),SP&&(console.warn("OrbitControls: setLookTargetPosition",t,i),_t.DrawWireSphere(this._lookTargetEndPosition,.2,16711680,2)),i===!0?this._controls.target.copy(this._lookTargetEndPosition):(this._lookTargetLerpActive=!0,this._lookTargetLerp01=0,this._lookTargetStartPosition.copy(this._controls.target),typeof i=="number"?this._lookTargetLerpDuration=i:this._lookTargetLerpDuration=this.targetLerpDuration))}get lookTargetLerpActive(){return this._lookTargetLerpActive}stopLookTargetLerp(){this._lookTargetLerpActive=!1}setLookTargetFromConstraint(t=0,i=1){var r;if(!this._controls)return!1;const n=(r=this.lookAtConstraint)==null?void 0:r.sources;if(n&&n.length>0){const o=n[t];if(o)return o.getWorldPosition(this._lookTargetEndPosition),this.lerpLookTarget(this._lookTargetEndPosition,i),!0}return!1}lerpTarget(t,i){return this.lerpLookTarget(t,i)}lerpLookTarget(t,i){this._controls&&(i>=1?this._controls.target.copy(t):this._controls.target.lerp(t,i))}setTargetFromRaycast(t){if(!this.controls)return;const i=t?this.context.physics.raycastFromRay(t):this.context.physics.raycast();for(const n of i)if(n.distance>0&&ne.isActiveInHierarchy(n.object)){const r=uF(n.object);if(r){const o=r.canvas;if(o!=null&&o.screenspace)break}this.setLookTargetPosition(n.point);break}}fitCamera(t,i={fitOffset:void 0,immediate:!1}){if(this.context.isInXR)return;const{immediate:n=!1,centerCamera:r}=i;let{fitOffset:o}=i;o==null&&(o=1.1);const a=this._cameraObject,l=this._controls;if(t!=null&&t.length||(t=this.context.scene.children),t.length<=0){console.warn("No objects to fit camera to...");return}if(!a||!l){console.warn("No camera or controls found to fit camera to objects...");return}const c=new S,h=new S,u=Hl(t,void 0);a.updateMatrixWorld(),a.updateProjectionMatrix(),u.getCenter(h);const f=new S;if(u.getSize(f),u.applyMatrix4(a.matrixWorldInverse),u.getSize(c),u.setFromCenterAndSize(h,c),Number.isNaN(c.x)||Number.isNaN(c.y)||Number.isNaN(c.z)){console.warn("Camera fit size resultet in NaN",a,u,[...t]);return}if(c.length()<=1e-10){NS&&console.warn("Camera fit size is zero",u,[...t]);return}const p=a.fov,m=2*Math.atan(Math.tan(p*Math.PI/360/2)*a.aspect)/Math.PI*360,v=c.y/(2*Math.atan(Math.PI*p/360)),g=c.x/(2*Math.atan(Math.PI*m/360)),y=o*Math.max(v,g)+c.z/2;NS&&console.log("Fit camera to objects",v,g,"distance",y),l.maxDistance=y*10,l.minDistance=y*.01;const A=.05,_=h.clone();_.y-=c.y*A,this.setLookTargetPosition(_,n),this.autoTarget=!1;const b=ne.findObjectOfType(du),x=b?b.radius:0,E=Math.max(f.x,f.y,f.z,x);a.near=y/100,a.far=E+y*10,a.updateMatrixWorld(),a.updateProjectionMatrix();const M=Ft(a),T=h.clone();if(T.sub(M),r==="y"&&(T.y=0),T.normalize(),T.multiplyScalar(y),r==="y"&&(T.y+=-A*4*c.y),a.parent){const R=a.parent.worldToLocal(h.clone().sub(T));this.setCameraTargetPosition(R,n)}else console.error(`Can not fit camera ${a.name} because it has no parent`);if(NS){const R=new bL(u);this.context.scene.add(R),ik(R,Gb(a)),setTimeout(()=>{this.context.scene.remove(R)},1e4),this._haveAttachedKeyboardEvents||(this._haveAttachedKeyboardEvents=!0,document.body.addEventListener("keydown",w=>{w.code==="KeyF"&&this.fitCamera(t,{fitOffset:o,immediate:n})}))}l.update()}}En([C()],Ei.prototype,"autoTarget",2);En([C()],Ei.prototype,"autoFit",2);En([C()],Ei.prototype,"enableRotate",2);En([C()],Ei.prototype,"autoRotate",2);En([C()],Ei.prototype,"autoRotateSpeed",2);En([C()],Ei.prototype,"minAzimuthAngle",2);En([C()],Ei.prototype,"maxAzimuthAngle",2);En([C()],Ei.prototype,"minPolarAngle",2);En([C()],Ei.prototype,"maxPolarAngle",2);En([C()],Ei.prototype,"enableKeys",2);En([C()],Ei.prototype,"enableDamping",2);En([C()],Ei.prototype,"dampingFactor",2);En([C()],Ei.prototype,"enableZoom",2);En([C()],Ei.prototype,"minZoom",2);En([C()],Ei.prototype,"maxZoom",2);En([C()],Ei.prototype,"zoomSpeed",2);En([C()],Ei.prototype,"enablePan",2);En([C(bm)],Ei.prototype,"lookAtConstraint",2);En([C()],Ei.prototype,"lookAtConstraint01",2);En([C()],Ei.prototype,"allowInterrupt",2);En([C()],Ei.prototype,"middleClickToFocus",2);En([C()],Ei.prototype,"doubleClickToFocus",2);En([C()],Ei.prototype,"clickBackgroundToFitScene",2);En([C()],Ei.prototype,"targetLerpDuration",2);var gye=Object.defineProperty,yye=Object.getOwnPropertyDescriptor,bo=(s,e,t,i)=>{for(var n=i>1?void 0:i?yye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&gye(e,t,n),n},kd=(s=>(s[s.Skybox=1]="Skybox",s[s.SolidColor=2]="SolidColor",s[s.Uninitialized=4]="Uninitialized",s))(kd||{});const Dh=ie("debugcam"),rH=ie("debugscreenpointtoray");var BC;const PA=(BC=class extends Ie{constructor(){super(...arguments);d(this,"_nearClipPlane",.1);d(this,"_farClipPlane",1e3);d(this,"orthographic",!1);d(this,"orthographicSize",5);d(this,"ARBackgroundAlpha",0);d(this,"_cullingMask",4294967295);d(this,"_backgroundBlurriness",0);d(this,"_backgroundIntensity",1);d(this,"_backgroundRotation");d(this,"_environmentIntensity");d(this,"_targetTexture",null);d(this,"_backgroundColor");d(this,"_fov");d(this,"_cam",null);d(this,"_clearFlags",2);d(this,"_skybox");d(this,"_frustum");d(this,"_projScreenMatrix",new le)}get isCamera(){return!0}get aspect(){return this._cam instanceof Vt?this._cam.aspect:this.context.domWidth/this.context.domHeight}set aspect(e){this._cam instanceof Vt&&this._cam.aspect!==e&&(this._cam.aspect=e,this._cam.updateProjectionMatrix())}get fieldOfView(){return this._cam instanceof Vt?this._cam.fov:this._fov}set fieldOfView(e){const t=this.fieldOfView!=e;if(this._fov=e,t&&this._cam&&this._cam instanceof Vt){if(this._fov===void 0){console.warn("Can not set undefined fov on PerspectiveCamera");return}this._cam.fov=this._fov,this._cam.updateProjectionMatrix()}}get nearClipPlane(){return this._nearClipPlane}set nearClipPlane(e){const t=this._nearClipPlane!=e;this._nearClipPlane=e,this._cam&&(t||this._cam.near!=e)&&(this._cam.near=e,this._cam.updateProjectionMatrix())}applyClippingPlane(){this._cam&&(this._cam.near=this._nearClipPlane,this._cam.far=this._farClipPlane,this._cam.updateProjectionMatrix())}get farClipPlane(){return this._farClipPlane}set farClipPlane(e){const t=this._farClipPlane!=e;this._farClipPlane=e,this._cam&&(t||this._cam.far!=e)&&(this._cam.far=e,this._cam.updateProjectionMatrix())}get clearFlags(){return this._clearFlags}set clearFlags(e){e!==this._clearFlags&&(this._clearFlags=e,this.applyClearFlagsIfIsActiveCamera())}set cullingMask(e){this._cullingMask=e,this._cam&&(this._cam.layers.mask=e)}get cullingMask(){return this._cam?this._cam.layers.mask:this._cullingMask}set cullingLayer(e){this.cullingMask=(1<<e|0)>>>0}set backgroundBlurriness(e){e!==this._backgroundBlurriness&&(e===void 0?this._backgroundBlurriness=void 0:this._backgroundBlurriness=Math.min(Math.max(e,0),1),this.applyClearFlagsIfIsActiveCamera())}get backgroundBlurriness(){return this._backgroundBlurriness}set backgroundIntensity(e){e!==this._backgroundIntensity&&(e===void 0?this._backgroundIntensity=void 0:this._backgroundIntensity=Math.min(Math.max(e,0),10),this.applyClearFlagsIfIsActiveCamera())}get backgroundIntensity(){return this._backgroundIntensity}set backgroundRotation(e){e!==this._backgroundRotation&&(e===void 0?this._backgroundRotation=void 0:this._backgroundRotation=e,this.applyClearFlagsIfIsActiveCamera())}get backgroundRotation(){return this._backgroundRotation}set environmentIntensity(e){this._environmentIntensity=e}get environmentIntensity(){return this._environmentIntensity}get backgroundColor(){return this._backgroundColor??null}set backgroundColor(e){if(e){if(this._backgroundColor)this._backgroundColor.copy(e);else{if(!e.clone)return;this._backgroundColor=e.clone()}e.alpha===void 0&&(this._backgroundColor.alpha=1),this.applyClearFlagsIfIsActiveCamera()}}set targetTexture(e){this._targetTexture=e}get targetTexture(){return this._targetTexture}get cam(){return this.activeAndEnabled&&this.buildCamera(),this._cam}screenPointToRay(e,t,i){const n=this.cam,r=PA._origin;r.set(e,t,-1),this.context.input.convertScreenspaceToRaycastSpace(r),rH&&console.log("screenPointToRay",e.toFixed(2),t.toFixed(2),"now:",r.x.toFixed(2),r.y.toFixed(2),"isInXR:"+this.context.isInXR),r.z=-1,r.unproject(n);const o=PA._direction.set(r.x,r.y,r.z),a=Ft(n);return o.sub(a),o.normalize(),i?(i.set(a,o),i):new _o(a.clone(),o.clone())}getFrustum(){return this._frustum||(this._frustum=new $p,this.updateFrustum()),this._frustum}updateFrustum(){this._frustum||(this._frustum=new $p),this._frustum.setFromProjectionMatrix(this.getProjectionScreenMatrix(this._projScreenMatrix,!0),this.context.renderer.coordinateSystem)}getProjectionScreenMatrix(e,t){return t&&this._projScreenMatrix.multiplyMatrices(this.cam.projectionMatrix,this.cam.matrixWorldInverse),e===this._projScreenMatrix?e:e.copy(this._projScreenMatrix)}awake(){rH&&window.addEventListener("pointerdown",e=>{const t=e.clientX,i=e.clientY;console.log("touch",t.toFixed(2),i.toFixed(2));const n=this.screenPointToRay(t,i),r="#"+Math.floor(Math.random()*16777215).toString(16);_t.DrawRay(n.origin,n.direction,r,10)})}onEnable(){Dh&&console.log(`Camera enabled: "${this.name}". ClearFlags=${kd[this._clearFlags]}`,this),this.buildCamera(),(this.tag=="MainCamera"||!this.context.mainCameraComponent)&&(this.context.setCurrentCamera(this),Aye(this)),this.applyClearFlagsIfIsActiveCamera({applySkybox:!0})}onDisable(){this.context.removeCamera(this)}onBeforeRender(){if(this._cam&&(this._frustum&&this.updateFrustum(),this._clearFlags===2&&this.applyClearFlagsIfIsActiveCamera(),this._targetTexture)){this.context.isManagedExternally&&(this._warnedAboutExternalRenderer||(this._warnedAboutExternalRenderer=!0,console.warn("Rendering with external renderer is not supported yet. This may not work or throw errors. Please remove the the target texture from your camera: "+this.name,this.targetTexture))),this.context.composer;const e=this.context.renderer;if(e){const t=this.context.mainCameraComponent;this.applyClearFlags(),this._targetTexture.render(this.context.scene,this._cam,e),t==null||t.applyClearFlags()}}}buildCamera(){if(this._cam)return;const e=this.gameObject.isCamera;let t=null;if(e?(t=this.gameObject,t==null||t.layers.enableAll(),t instanceof Vt&&(this._fov=t.fov)):t=this.gameObject.children[0],t&&t.isCamera)t instanceof Vt&&(this._fov&&(t.fov=this._fov),t.near=this._nearClipPlane,t.far=this._farClipPlane,t.updateProjectionMatrix());else if(!this.orthographic)t=new Vt(this.fieldOfView,window.innerWidth/window.innerHeight,this._nearClipPlane,this._farClipPlane),this.fieldOfView&&(t.fov=this.fieldOfView),this.gameObject.add(t);else{const i=this.orthographicSize*100;t=new Qc(window.innerWidth/-i,window.innerWidth/i,window.innerHeight/i,window.innerHeight/-i,this._nearClipPlane,this._farClipPlane),this.gameObject.add(t)}this._cam=t,this._cam.layers.mask=this._cullingMask,this.tag=="MainCamera"&&this.context.setCurrentCamera(this)}applyClearFlagsIfIsActiveCamera(e){this.context.mainCameraComponent===this&&this.applyClearFlags(e)}applyClearFlags(e){var t;if(!this._cam){Dh&&console.log("Camera does not exist (apply clear flags)");return}if(this.fieldOfView=this._fov,Dh){const i=`Camera "${this.name}" clear flags: ${kd[this._clearFlags]}`;console.debug(i)}switch(this._clearFlags){case 1:if(PA.backgroundShouldBeTransparent(this.context)&&(!this.ARBackgroundAlpha||this.ARBackgroundAlpha<.001)){this.context.scene.background=null,this.context.renderer.setClearColor(0,0);return}(!this.scene.background||!this._skybox||(e==null?void 0:e.applySkybox)===!0)&&this.applySceneSkybox(),this._backgroundBlurriness!==void 0?this.context.scene.backgroundBlurriness=this._backgroundBlurriness:Dh&&console.warn(`Camera "${this.name}" has no background blurriness`),this._backgroundIntensity!==void 0&&(this.context.scene.backgroundIntensity=this._backgroundIntensity),this._backgroundRotation!==void 0?this.context.scene.backgroundRotation=this._backgroundRotation:Dh&&console.warn(`Camera "${this.name}" has no background intensity`);break;case 2:if(this._backgroundColor){let i=this._backgroundColor.alpha;PA.backgroundShouldBeTransparent(this.context)&&(i=this.ARBackgroundAlpha??0),this.context.scene.background=null,(t=this.context.xr)!=null&&t.isVR?this.context.renderer.setClearColor(TQ(this._backgroundColor).convertLinearToSRGB()):this.context.renderer.setClearColor(this._backgroundColor,i)}else Dh&&console.warn(`Camera "${this.name}" has no background color`,this);break;case 4:this.context.scene.background=null,this.context.renderer.setClearColor(0,0);break}}applySceneSkybox(){this._skybox||(this._skybox=new vye(this)),this._skybox.apply()}static backgroundShouldBeTransparent(e){var r,o,a,l;const t=(r=e.renderer.xr)==null?void 0:r.getSession();if(!t)return!1;if(typeof t._transparent=="boolean")return t._transparent;const i=t.environmentBlendMode;Dh&&_n("Environment blend mode: "+i+" on "+navigator.userAgent);let n=i==="additive"||i==="alpha-blend";return e.isInAR&&i==="opaque"&&((o=navigator.userAgent)!=null&&o.includes("OculusBrowser")||(a=navigator.userAgent)!=null&&a.includes("Mozilla")&&((l=navigator.userAgent)!=null&&l.includes("Mobile WebXRViewer/v2")))&&(n=!0),t._transparent=n,n}},d(BC,"_origin",new S),d(BC,"_direction",new S),BC);let Hi=PA;bo([C()],Hi.prototype,"aspect",1);bo([C()],Hi.prototype,"fieldOfView",1);bo([C()],Hi.prototype,"nearClipPlane",1);bo([C()],Hi.prototype,"farClipPlane",1);bo([C()],Hi.prototype,"clearFlags",1);bo([C()],Hi.prototype,"orthographic",2);bo([C()],Hi.prototype,"orthographicSize",2);bo([C()],Hi.prototype,"ARBackgroundAlpha",2);bo([C()],Hi.prototype,"cullingMask",1);bo([C()],Hi.prototype,"backgroundBlurriness",1);bo([C()],Hi.prototype,"backgroundIntensity",1);bo([C(li)],Hi.prototype,"backgroundRotation",1);bo([C()],Hi.prototype,"environmentIntensity",1);bo([C(Ui)],Hi.prototype,"backgroundColor",1);bo([C(Od)],Hi.prototype,"targetTexture",1);class vye{constructor(e){d(this,"_camera");d(this,"_skybox");this._camera=e}get context(){var e;return(e=this._camera)==null?void 0:e.context}apply(){this._skybox=this.context.lightmaps.tryGetSkybox(this._camera.sourceId),this._skybox?this.context.scene.background!==this._skybox&&(Dh&&console.log(`Camera "${this._camera.name}" set skybox`,this._camera,this._skybox),this._skybox.mapping=mo,this.context.scene.background=this._skybox):(this._did_log_failed_to_find_skybox||(this._did_log_failed_to_find_skybox=!0,console.warn(`Camera "${this._camera.name}" failed to load/find skybox texture`,this._camera.sourceId,this.context.lightmaps,"Current background: ",this.context.scene.background)),(Dh||nt())&&Fi(`Camera "${this._camera.name}" has no skybox texture`))}}function Aye(s){ie("freecam")&&s.context.mainCameraComponent===s&&ne.getOrAddComponent(s.gameObject,Ei)}class Fd extends Ie{constructor(){super(...arguments);d(this,"_listener",null);d(this,"onInteraction",()=>{this.destroyed||this.listener==null||this.addListenerIfItExists()})}get listener(){return this._listener==null&&(this._listener=new h6),this._listener}onEnable(){Nl.registerWaitForInteraction(this.onInteraction),this.addListenerIfItExists()}onDisable(){Nl.unregisterWaitForInteraction(this.onInteraction),this.removeListenerIfItExists()}addListenerIfItExists(){const t=this._listener;if(!t||t!=null&&t.parent)return;const i=this.context.mainCameraComponent||ne.getComponentInParent(this.gameObject,Hi);i!=null&&i.cam?i.cam.add(t):this.gameObject.add(t),t.filter?(t.gain.connect(t.filter),t.filter.connect(t.context.destination)):t.gain.connect(t.context.destination)}removeListenerIfItExists(){const t=this._listener;t&&(t.removeFromParent(),t.filter&&t.filter.disconnect(),t.gain&&t.gain.disconnect())}}class _ye extends An{constructor(e,t=1,i=16,n=2){const r=new yt,o=i+n*2,a=new Float32Array((o*3+3)*3);r.setAttribute("position",new Ke(a,3));const l=new ji({color:65280}),c=new ji({color:16776960});super(r,[c,l]),this.audio=e,this.range=t,this.divisionsInnerAngle=i,this.divisionsOuterAngle=n,this.type="PositionalAudioHelper",this.update()}update(){const e=this.audio,t=this.range,i=this.divisionsInnerAngle,n=this.divisionsOuterAngle,r=gi.degToRad(e.panner.coneInnerAngle),o=gi.degToRad(e.panner.coneOuterAngle),a=r/2,l=o/2;let c=0,h=0,u,f;const p=this.geometry,m=p.attributes.position;p.clearGroups();function v(g,y,A,_){const b=(y-g)/A;for(m.setXYZ(c,0,0,0),h++,u=g;u<y;u+=b)f=c+h,m.setXYZ(f,Math.sin(u)*t,0,Math.cos(u)*t),m.setXYZ(f+1,Math.sin(Math.min(u+b,y))*t,0,Math.cos(Math.min(u+b,y))*t),m.setXYZ(f+2,0,0,0),h+=3;p.addGroup(c,h,_),c+=h,h=0}v(-l,-a,n,0),v(-a,a,i,1),v(a,l,n,0),m.needsUpdate=!0,r===o&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}var bye=Object.defineProperty,xye=Object.getOwnPropertyDescriptor,Yc=(s,e,t,i)=>{for(var n=i>1?void 0:i?xye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&bye(e,t,n),n};const Or=ie("debugaudio"),nd=class extends Ie{constructor(){super(...arguments);d(this,"clip","");d(this,"playOnAwake",!1);d(this,"preload",!1);d(this,"playInBackground",!0);d(this,"_spatialBlend",0);d(this,"_minDistance",1);d(this,"_maxDistance",100);d(this,"_volume",1);d(this,"rollOffMode",0);d(this,"_loop",!1);d(this,"sound",null);d(this,"helper",null);d(this,"wasPlaying",!1);d(this,"audioLoader",null);d(this,"shouldPlay",!1);d(this,"_lastClipStartedLoading",null);d(this,"_audioElement",null);d(this,"onVisibilityChanged",()=>{switch(document.visibilityState){case"hidden":(this.playInBackground===!1||Wc())&&(this.wasPlaying=this.isPlaying,this.isPlaying&&this.pause());break;case"visible":Or&&console.log("visible",this.enabled,this.playOnAwake,!this.isPlaying,nd.userInteractionRegistered,this.wasPlaying),this.enabled&&this.playOnAwake&&!this.isPlaying&&nd.userInteractionRegistered&&this.wasPlaying&&this.play();break}});d(this,"onApplicationMuteChanged",()=>{var e,t;this.context.application.muted?(e=this.sound)==null||e.setVolume(0):(t=this.sound)==null||t.setVolume(this.volume)});d(this,"createAudio",e=>{Or&&console.log("AudioBuffer finished loading",e);const t=this.Sound;if(!t){Or&&console.warn("Failed getting sound?",this.name);return}t.isPlaying&&t.stop(),e&&t.setBuffer(e),t.loop=this._loop,this.context.application.muted?t.setVolume(0):t.setVolume(this.volume),t.autoplay=this.shouldPlay&&nd.userInteractionRegistered,this.applySpatialDistanceSettings(),t.isPlaying&&t.stop(),nd.registerWaitForAllowAudio(this.__onAllowAudioCallback)});d(this,"__onAllowAudioCallback",()=>{this.shouldPlay&&this.play()});d(this,"_lastContextTime",0);d(this,"_hasEnded",!0);d(this,"_needUpdateSpatialDistanceSettings",!1)}static get userInteractionRegistered(){return Nl.userInteractionRegistered}static registerWaitForAllowAudio(e){Nl.registerWaitForInteraction(e)}get isPlaying(){var e;return((e=this.sound)==null?void 0:e.isPlaying)??!1}get duration(){var e,t;return(t=(e=this.sound)==null?void 0:e.buffer)==null?void 0:t.duration}get time01(){var t;const e=this.duration;return e&&this.sound?((t=this.sound)==null?void 0:t.context.currentTime)/e:0}set time01(e){const t=this.duration;t&&this.sound&&(this.time=e*t)}get time(){var e,t;return(e=this.sound)!=null&&e.source?((t=this.sound.source)==null?void 0:t.context.currentTime)-this._lastContextTime+this.sound.offset:0}set time(e){if(this.sound){if(e===this.sound.offset)return;const t=this.isPlaying;this.stop(),this.sound.offset=e,t&&this.play()}}get loop(){return this.sound&&(this._loop=this.sound.getLoop()),this._loop}set loop(e){this._loop=e,this.sound&&this.sound.setLoop(e)}get spatialBlend(){return this._spatialBlend}set spatialBlend(e){e!==this._spatialBlend&&(this._spatialBlend=e,this._needUpdateSpatialDistanceSettings=!0)}get minDistance(){return this._minDistance}set minDistance(e){this._minDistance!==e&&(this._minDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get maxDistance(){return this._maxDistance}set maxDistance(e){this._maxDistance!==e&&(this._maxDistance=e,this._needUpdateSpatialDistanceSettings=!0)}get volume(){return this._volume}set volume(e){this._volume=e,this.sound&&!this.context.application.muted&&(Or&&console.log(this.name,"audio set volume",e),this.sound.setVolume(e))}get Sound(){var e;if(!this.sound&&nd.userInteractionRegistered){let t=ne.getComponent(this.context.mainCamera,Fd)??ne.findObjectOfType(Fd,this.context);!t&&this.context.mainCamera&&(t=ne.addNewComponent(this.context.mainCamera,Fd)),t!=null&&t.listener?(this.sound=new u6(t.listener),(e=this.gameObject)==null||e.add(this.sound)):Or&&console.warn("No audio listener found in scene - can not play audio")}return this.sound}get ShouldPlay(){return this.shouldPlay}get audioContext(){var e;return(e=this.sound)==null?void 0:e.context}awake(){Or&&console.log(this),this.audioLoader=new z1,this.playOnAwake&&(this.shouldPlay=!0),this.preload&&typeof this.clip=="string"&&this.audioLoader.load(this.clip,this.createAudio,()=>{},console.error)}onEnable(){this.sound&&this.gameObject.add(this.sound),nd.userInteractionRegistered?this.playOnAwake&&this.context.application.isVisible&&this.play():nd.registerWaitForAllowAudio(()=>{this.enabled&&!this.destroyed&&this.shouldPlay&&this.onNewClip(this.clip)}),globalThis.addEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.addEventListener(hE.MuteChanged,this.onApplicationMuteChanged)}onDisable(){globalThis.removeEventListener("visibilitychange",this.onVisibilityChanged),this.context.application.removeEventListener(hE.MuteChanged,this.onApplicationMuteChanged),this.pause()}applySpatialDistanceSettings(){const e=this.sound;if(!e)return;this._needUpdateSpatialDistanceSettings=!1;const t=it.lerp(10*this._maxDistance/Math.max(1e-4,this.spatialBlend),this._minDistance,this.spatialBlend);switch(Or&&console.log(this.name,this._minDistance,this._maxDistance,this.spatialBlend,"Ref distance="+t),e.setRefDistance(t),e.setMaxDistance(Math.max(.01,this._maxDistance)),this.rollOffMode){case 0:e.setDistanceModel("exponential");break;case 1:e.setDistanceModel("linear");break;case 2:console.warn("Custom rolloff for AudioSource is not supported: "+this.name);break}this.spatialBlend>0?Or&&!this.helper&&(this.helper=new _ye(e,e.getRefDistance()),e.add(this.helper)):this.helper&&this.helper.parent&&this.helper.removeFromParent()}async onNewClip(e){if(e&&(this.clip=e),typeof e=="string")if(Or&&console.log(e),e.endsWith(".mp3")||e.endsWith(".wav")){if(this.audioLoader||(this.audioLoader=new z1),this.shouldPlay=!0,this._lastClipStartedLoading===e){Or&&console.log("Is currently loading:",this._lastClipStartedLoading,this);return}this._lastClipStartedLoading=e,Or&&console.log("load audio",e);const t=await this.audioLoader.loadAsync(e).catch(console.error);this._lastClipStartedLoading=null,t&&this.createAudio(t)}else console.warn("Unsupported audio clip type",e);else this.shouldPlay=!0,this.createAudio()}play(e=void 0){var i,n,r;!e&&this.clip&&(e=this.clip),e!==void 0&&typeof e!="string"&&!(e instanceof MediaStream)&&(nt()&&console.warn("Called play on AudioSource with unknown argument type:",e+`
Using the assigned clip instead:`,this.clip),e=this.clip);let t=!this.sound||e&&e!==this.clip;if(typeof e=="string"&&!this.audioLoader&&(t=!0),(e instanceof MediaStream||typeof e=="string")&&(this.clip=e),t){this.shouldPlay=!0,this.onNewClip(e);return}if(this.shouldPlay=!0,this._hasEnded=!1,Or&&console.log("play",(i=this.sound)==null?void 0:i.getVolume(),this.sound),this.sound&&!this.sound.isPlaying){const o=this.context.application.muted;o&&this.sound.setVolume(0),(n=this.gameObject)==null||n.add(this.sound),this.clip instanceof MediaStream?(this.sound.setMediaStreamSource(this.clip),this._audioElement||(this._audioElement=document.createElement("audio"),this._audioElement.style.display="none"),this._audioElement.parentNode||(r=this.context.domElement.shadowRoot)==null||r.append(this._audioElement),this._audioElement.srcObject=this.clip,this._audioElement.autoplay=!1):(this._audioElement&&this._audioElement.remove(),this.sound.play(o?.1:0))}}pause(){var e,t;Or&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.isPlaying&&this.sound.source&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,this.sound.pause()),(t=this._audioElement)==null||t.remove()}stop(){var e,t;Or&&console.log("Pause",this),this._hasEnded=!0,this.shouldPlay=!1,this.sound&&this.sound.source&&(this._lastContextTime=(e=this.sound)==null?void 0:e.context.currentTime,Or&&console.log(this._lastContextTime),this.sound.stop()),(t=this._audioElement)==null||t.remove()}update(){this.helper&&(this.isPlaying&&this.helper.update(),this.helper.visible=this.isPlaying),this._needUpdateSpatialDistanceSettings&&this.applySpatialDistanceSettings(),this.sound&&!this.sound.isPlaying&&this.shouldPlay&&!this._hasEnded&&(this._hasEnded=!0,Or&&console.log("Audio clip ended",this.clip),this.dispatchEvent(new CustomEvent("ended",{detail:this})))}};let Hn=nd;Yc([C(URL)],Hn.prototype,"clip",2);Yc([C()],Hn.prototype,"playOnAwake",2);Yc([C()],Hn.prototype,"preload",2);Yc([C()],Hn.prototype,"playInBackground",2);Yc([C()],Hn.prototype,"loop",1);Yc([C()],Hn.prototype,"spatialBlend",1);Yc([C()],Hn.prototype,"minDistance",1);Yc([C()],Hn.prototype,"maxDistance",1);Yc([C()],Hn.prototype,"volume",1);Yc([C()],Hn.prototype,"rollOffMode",2);var wye=Object.defineProperty,Sye=Object.getOwnPropertyDescriptor,hT=(s,e,t,i)=>{for(var n=i>1?void 0:i?Sye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&wye(e,t,n),n};const Cye=ie("debugsignals");class ax{constructor(){d(this,"guid")}}hT([C()],ax.prototype,"guid",2);class Lv{constructor(){d(this,"signal");d(this,"reaction")}}hT([C(ax)],Lv.prototype,"signal",2);hT([C(Sn)],Lv.prototype,"reaction",2);var EB;const Ch=(EB=class extends Ie{constructor(){super(...arguments);d(this,"events")}static invoke(e){if(Ch.receivers[e]){const t=Ch.receivers[e];if(!t)return;for(const i of t)i.invoke(e)}}awake(){Cye&&console.log("SignalReceiver awake",this)}onEnable(){if(this.events)for(const e of this.events)Ch.receivers[e.signal.guid]||(Ch.receivers[e.signal.guid]=[]),Ch.receivers[e.signal.guid].push(this)}onDisable(){if(this.events){for(const e of this.events)if(Ch.receivers[e.signal.guid]){const t=Ch.receivers[e.signal.guid].indexOf(this);t>=0&&Ch.receivers[e.signal.guid].splice(t,1)}}}invoke(e){if(!this.events||!Array.isArray(this.events))return;const t=typeof e=="object"?e.guid:e;for(const i of this.events)if(i.signal.guid===t)try{if(i.reaction){if(!i.reaction.invoke){console.warn("Missing invoke - possibly a serialization error",i,this);continue}}else{console.warn("Missing reaction for signal",i,this);continue}i.reaction.invoke()}catch(n){console.error(n)}}},d(EB,"receivers",{}),EB);let kv=Ch;hT([C(Lv)],kv.prototype,"events",2);var ea=(s=>(s.Activation="ActivationTrack",s.Animation="AnimationTrack",s.Audio="AudioTrack",s.Control="ControlTrack",s.Marker="MarkerTrack",s.Signal="SignalTrack",s))(ea||{}),hc=(s=>(s[s.None=0]="None",s[s.Hold=1]="Hold",s[s.Loop=2]="Loop",s[s.PingPong=3]="PingPong",s[s.Continue=4]="Continue",s))(hc||{}),dF=(s=>(s.Signal="SignalEmitter",s))(dF||{});const Tc=ie("debugtimeline");class lx{constructor(){d(this,"director");d(this,"track")}get muted(){return this.track.muted}set muted(e){var t;e!==this.track.muted&&(this.track.muted=e,(t=this.onMuteChanged)==null||t.call(this))}*forEachClip(e=!1){var t;if((t=this.track)!=null&&t.clips)if(e)for(let i=this.track.clips.length-1;i>=0;i--)yield this.track.clips[i];else for(const i of this.track.clips)yield i}getClipTime(e,t){return t.clipIn+(e-t.start)*t.timeScale}getClipTimeNormalized(e,t){return(e-t.start)/t.duration}evaluateWeight(e,t,i,n=!0){if(t<0||t>=i.length)return 0;const r=i[t];if(n||e>=r.start&&e<=r.end){let o=1;const a=!1;if(r.easeInDuration>0){const l=Math.min((e-r.start)/r.easeInDuration,1);o*=l}if(r.easeOutDuration>0&&!a){const l=Math.min((r.end-e)/r.easeOutDuration,1);o*=l}return o}return 0}}class Eye{constructor(e){d(this,"clip");d(this,"rootPositionOffset");d(this,"rootQuaternionOffset");d(this,"rootStartPosition");d(this,"rootEndPosition");d(this,"rootStartQuaternion");d(this,"rootEndQuaternion");const t=e.getClip();this.clip=t;const i=e.getRoot(),n=i.name+".position",r=i.name+".quaternion";Tc&&console.log(t.name,t.tracks,n);for(const o of t.tracks)if(!(o.times.length<=0)){if(o.name.endsWith(n))this.rootStartPosition=new S().fromArray(o.values,0),this.rootEndPosition=new S().fromArray(o.values,o.values.length-3),this.rootPositionOffset=this.rootEndPosition.clone().sub(this.rootStartPosition),Tc&&console.log(this.rootPositionOffset);else if(o.name.endsWith(r)&&(this.rootStartQuaternion=new Ce().fromArray(o.values,0),this.rootEndQuaternion=new Ce().fromArray(o.values,o.values.length-4),this.rootQuaternionOffset=this.rootEndQuaternion.clone().multiply(this.rootStartQuaternion),Tc)){const a=new li().setFromQuaternion(this.rootQuaternionOffset);console.log("ROT",a)}}}get hasOffsets(){return this.rootPositionOffset!==void 0||this.rootQuaternionOffset!==void 0}}class uT extends lx{constructor(){super(...arguments);d(this,"models",[]);d(this,"trackOffset");d(this,"target");d(this,"mixer");d(this,"clips",[]);d(this,"actions",[]);d(this,"_actionOffsets",[]);d(this,"_didBind",!1);d(this,"_animator",null);d(this,"_useclipOffsets",!0);d(this,"_totalOffsetPosition",new S);d(this,"_totalOffsetRotation",new Ce);d(this,"_totalOffsetPosition2",new S);d(this,"_totalOffsetRotation2",new Ce);d(this,"_summedPos",new S);d(this,"_tempPos",new S);d(this,"_summedRot",new Ce);d(this,"_tempRot",new Ce);d(this,"_clipRotQuat",new Ce)}onDisable(){var t;(t=this.mixer)==null||t.stopAllAction()}onDestroy(){this.director.context.animations.unregisterAnimationMixer(this.mixer)}onStateChanged(){this._animator&&oH(this._animator.gameObject,this,this.director.isPlaying)}createHooks(t,i){var h,u;if(((h=i.tracks)==null?void 0:h.length)<=0){console.warn("No tracks in AnimationClip",i);return}const n=i.tracks[0].name.split("."),r=n[n.length-2],o=r+".position",a=r+".quaternion";let l=!1,c=!1;for(const f of i.tracks)f.name.endsWith(o)?(l=!0,this.createPositionInterpolant(i,t,f)):f.name.endsWith(a)&&(c=!0,this.createRotationInterpolant(i,t,f));if(!l||!c){const f=(u=this.mixer)==null?void 0:u.getRoot(),p=i.tracks[0],m=p.name.lastIndexOf("."),v=p.name.substring(0,m),g=v.substring(v.lastIndexOf(".")+1),y=f.getObjectByName(g);if(y)if(l){if(!c){const A=i.tracks[0].name.substring(0,m)+".quaternion";Tc&&console.warn("Create quaternion track",g,y);const _=y.quaternion,b=new zl(A,[0,i.duration],[_.x,_.y,_.z,_.w,_.x,_.y,_.z,_.w]);i.tracks.push(b),this.createRotationInterpolant(i,t,b)}}else{const A=v+".position";Tc&&console.warn("Create position track",g,y);const _=y.position,b=new Uc(A,[0,i.duration],[_.x,_.y,_.z,_.x,_.y,_.z]);i.tracks.push(b),this.createPositionInterpolant(i,t,b)}}}bind(){if(!this._didBind){this._didBind=!0,Tc&&console.log(this.models),this.mixer?this.target=this.mixer.getRoot():console.warn("No mixer was assigned to animation track");for(const t of this.actions){const i=new Eye(t);this._actionOffsets.push(i)}this.target&&(this._animator=ne.getComponent(this.target,vr)??null,this._animator&&oH(this._animator.gameObject,this,!0));for(const t of this.models){const i=t.asset,n=i.position,r=i.rotation;n&&n.x!==void 0&&(n.isVector3||(i.position=new S(n.x,n.y,n.z)),r.isQuaternion||(i.rotation=new Ce(r.x,r.y,r.z,r.w)))}this.ensureTrackOffsets()}}ensureTrackOffsets(){if(this.trackOffset){const t=this.trackOffset.position;t&&(t.isVector3||(this.trackOffset.position=new S(t.x,t.y,t.z)));const i=this.trackOffset.rotation;i&&(i.isQuaternion||(this.trackOffset.rotation=new Ce(i.x,i.y,i.z,i.w)))}}evaluate(t){var l,c,h,u,f,p,m;if(this.track.muted||!this.mixer)return;this.bind(),this._totalOffsetPosition.set(0,0,0),this._totalOffsetRotation.set(0,0,0,1),this._totalOffsetPosition2.set(0,0,0),this._totalOffsetRotation2.set(0,0,0,1);let i=0,n=0,r=!1,o=!1,a=0;for(let v=0;v<this.clips.length;v++){const g=this.models[v],y=this.actions[v],A=g.asset;y.weight=0;const _=t>=g.start&&t<=g.end,b=g.preExtrapolationMode,x=g.postExtrapolationMode,E=v<this.clips.length-1?this.models[v+1]:null;let M=_,T=!1;if(!M&&!r&&g.end<t&&x!==hc.None?(!E||E.start>t)&&(M=!0,r=!0):v==0&&!M&&!o&&g.start>t&&b!==hc.None&&(!E||E.start<t)&&(M=!0,T=!0,o=!0),M){let R=1;R*=this.evaluateWeight(t,v,this.models,M),R*=this.director.weight;let w=_;if(T)switch(b){case hc.Hold:break;case hc.Loop:t+=g.start,w=!0;break;default:t+=g.start,w=!0;break}let I=this.getClipTime(t,g),O=0;const k=A.duration;if(T&&b===hc.Hold&&(I=0),w){if(A.loop)for(O+=Math.floor(I/(k+1e-6));I>k;)I-=k}else if(!_&&r)switch(x){case hc.Hold:I=this.getClipTime(g.end,g);break;case hc.Loop:I%=k;break;case hc.PingPong:const L=Math.floor(I/k)%2!==0;I%=k,L&&(I=k-I);break}g.reversed===!0?y.time=y.getClip().duration-I:y.time=I,y.timeScale=0;const B=Math.max(0,R);if(y.weight=B,a+=B,y.clampWhenFinished=!1,y.isRunning()||y.play(),this._useclipOffsets){const G=i==0?this._totalOffsetPosition:this._totalOffsetPosition2,L=i==0?this._totalOffsetRotation:this._totalOffsetRotation2;i<1&&(n=1-R),i+=1;const U=this._summedPos.set(0,0,0),z=this._tempPos.set(0,0,0),j=this._summedRot.identity(),X=this._tempRot.identity(),re=A.rotation;re&&(this._clipRotQuat.identity(),this._clipRotQuat.slerp(re,R));const ce=this._actionOffsets[v];if(ce.hasOffsets)for(let Me=0;Me<O;Me++)ce.rootPositionOffset?z.copy(ce.rootPositionOffset):z.set(0,0,0),z.applyQuaternion(j),this._clipRotQuat&&z.applyQuaternion(this._clipRotQuat),ce.rootQuaternionOffset&&(X.copy(ce.rootQuaternionOffset),j.multiply(X)),U.add(z);this._clipRotQuat&&L.multiply(this._clipRotQuat),L.multiply(j),A.position&&U.add(A.position),G.add(U)}}}if(this._useclipOffsets&&(this._totalOffsetPosition.lerp(this._totalOffsetPosition2,n),this._totalOffsetRotation.slerp(this._totalOffsetRotation2,n)),this.__mixerError===void 0&&(Tc||nt())&&((c=(l=this._animator)==null?void 0:l.runtimeAnimatorController)!=null&&c.mixer)&&this.mixer!==((u=(h=this._animator)==null?void 0:h.runtimeAnimatorController)==null?void 0:u.mixer)&&(this.__mixerError=!0,console.error("AnimationTrack mixer is not shared with the animator controller - this might result in the timeline to not animate properly. Please report a bug to the Needle Engine team!",this)),(f=this._animator)!=null&&f.runtimeAnimatorController){const v=Math.max(0,1-a);(m=(p=this._animator)==null?void 0:p.runtimeAnimatorController)==null||m.update(v)}else this.mixer.update(t)}createRotationInterpolant(t,i,n){var l;const r=n.createInterpolant.bind(n),o=new Ce;this.ensureTrackOffsets();const a=(l=this.trackOffset)==null?void 0:l.rotation;n.createInterpolant=()=>{const c=r(),h=c.evaluate.bind(c);return c.evaluate=u=>{var p;const f=h(u);if(o.set(f[0],f[1],f[2],f[3]),o.premultiply(this._totalOffsetRotation),a&&o.premultiply(a),this.director.animationCallbackReceivers)for(const m of this.director.animationCallbackReceivers)(p=m==null?void 0:m.onTimelineRotation)==null||p.call(m,this.director,this.target,u,o);return f[0]=o.x,f[1]=o.y,f[2]=o.z,f[3]=o.w,f},c}}createPositionInterpolant(t,i,n){var h,u;const r=n.createInterpolant.bind(n),o=new S;this.ensureTrackOffsets();const a=(h=this.trackOffset)==null?void 0:h.rotation,l=(u=this.trackOffset)==null?void 0:u.position;let c;n.createInterpolant=()=>{const f=r(),p=f.evaluate.bind(f);return f.evaluate=m=>{var g,y,A;const v=p(m);if(o.set(v[0],v[1],v[2]),i.removeStartOffset&&(c===void 0?(c=null,c=(y=(g=this._actionOffsets.find(_=>_.clip===t))==null?void 0:g.rootStartPosition)==null?void 0:y.clone()):c!=null&&c.isVector3&&o.sub(c)),o.applyQuaternion(this._totalOffsetRotation),o.add(this._totalOffsetPosition),a&&o.applyQuaternion(a),l&&(o.x-=l.x,o.y+=l.y,o.z+=l.z),this.director.animationCallbackReceivers)for(const _ of this.director.animationCallbackReceivers)(A=_==null?void 0:_.onTimelinePosition)==null||A.call(_,this.director,this.target,m,o);return v[0]=o.x,v[1]=o.y,v[2]=o.z,v},f}}}const Mye=ie("mutetimeline"),Ty=class extends lx{constructor(){super(...arguments);d(this,"models",[]);d(this,"listener");d(this,"audio",[]);d(this,"audioContextTimeOffset",[]);d(this,"lastTime",0);d(this,"audioSource");d(this,"_audioLoader",null);d(this,"_playableDirectorResumed",!1)}getAudioFilePath(t){const i=this.director.sourceId;return nf(i,t)}onAllowAudioChanged(t){for(let i=0;i<this.models.length;i++){const n=this.models[i];this.audio[i].setVolume(t?n.asset.volume:0)}}addModel(t){const i=new yL(this.listener);this.audio.push(i);const n=t;n._didTriggerPlay=!1,this.models.push(n)}onDisable(){for(const t of this.audio)t.isPlaying&&t.stop();for(const t of this.models)t._didTriggerPlay=!1}onDestroy(){for(const t of this.audio)t.source&&(t==null||t.disconnect());this.audio.length=0}onMuteChanged(){if(this.muted)for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}}stop(){for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}for(const t of this.models)t._didTriggerPlay=!1}onPauseChanged(){for(let t=0;t<this.audio.length;t++){const i=this.audio[t];i!=null&&i.isPlaying&&i.stop()}this._playableDirectorResumed=this.director.isPlaying}evaluate(t){if(Mye||this.track.muted||this.director.speed<0)return;const i=this.director.context.application.muted,n=this._playableDirectorResumed;this._playableDirectorResumed=!1;const r=i?.1:0;for(let o=0;o<this.models.length;o++){const a=this.models[o],l=this.audio[o],c=a.asset;if((!l||!l.buffer)&&this.isInTimeRange(a,t-1,t+1)&&this.handleAudioLoading(a,l),Hn.userInteractionRegistered!==!1&&!(l===null||!l.buffer))if(l.playbackRate=this.director.context.time.timeScale*this.director.speed,l.loop=c.loop,t>=a.start&&t<=a.end&&t<this.director.duration){if(!l.isPlaying||!this.director.isPlaying)(n||!a._didTriggerPlay&&this.lastTime<t)&&(a.duration*a.timeScale>.3?l.offset=a.clipIn+(t-a.start)*a.timeScale:l.offset=0,Tc&&console.log("Timeline Audio ("+this.track.name+") play with offset "+l.offset+" - "+a.asset.clip),l.play(r),a._didTriggerPlay=!0);else{const u=a.clipIn+(t-a.start)*a.timeScale,f=l.context.currentTime-l._startedAt+l.offset;Math.abs(u-f)>.3&&(l.offset=u,l.stop(),l.play(r))}let h=c.volume;if(this.track.volume!==void 0&&(h*=this.track.volume),i&&(h=0),a.easeInDuration>0){const u=Math.min((t-a.start)/a.easeInDuration,1);h*=u}if(a.easeOutDuration>0){const u=Math.min((a.end-t)/a.easeOutDuration,1);h*=u}l.setVolume(h*this.director.weight)}else a._didTriggerPlay=!1,this.director.isPlaying&&l.isPlaying&&l.stop()}this.lastTime=t}loadAudio(t,i=0,n=0){let r=null;const o=t-n,a=t+i;for(const l of this.models)if(this.isInTimeRange(l,o,a)){const c=this.audio[this.models.indexOf(l)],h=this.handleAudioLoading(l,c);h!==null&&(r===null&&(r=[]),r.push(h))}return r!==null?Promise.all(r):null}isInTimeRange(t,i,n){return i<=t.start&&n>=t.end||i>=t.start&&i<=t.end||n>=t.start&&n<=t.end}static dispose(){Ty._audioBuffers.clear()}handleAudioLoading(t,i){this._audioLoader||(this._audioLoader=new z1);const n=this.getAudioFilePath(t.asset.clip);if(Ty._audioBuffers.get(n)){const o=Ty._audioBuffers.get(n);return o.then(a=>{a&&i.setBuffer(a)}),o}Tc&&console.warn("LOAD audio track",n,this.director.sourceId);const r=new Promise((o,a)=>{this._audioLoader.load(n,l=>{i.setBuffer(l),o(l)},void 0,l=>{console.error("Error loading audio",l),o(null)})});return Ty._audioBuffers.set(n,r),r}};let Vp=Ty;d(Vp,"_audioBuffers",new Map);class nb extends lx{constructor(){super(...arguments);d(this,"models",[]);d(this,"didTrigger",[]);d(this,"receivers",[])}evaluate(t){var n;if(this.track.muted)return;const i=this.director.context.time.deltaTime*1.5;for(let r=0;r<this.models.length;r++){const o=this.models[r],a=this.didTrigger[r],l=o.time-t;let c=!1;if(o.retroActive)c=l<=1e-6;else{const h=Math.abs(l);(h===0||h>=1e-5&&h<i)&&(c=!0)}if(c){if(!a)if(Tc&&console.log("Trigger signal",t,o.time,o),this.didTrigger[r]=!0,((n=this.receivers)==null?void 0:n.length)<=0)kv.invoke(o.asset);else for(const h of this.receivers)h&&h.invoke(o.asset)}else o.emitOnce||(this.didTrigger[r]=!1)}}}class dT extends lx{constructor(){super(...arguments);d(this,"models",[]);d(this,"timelines",[]);d(this,"_previousActiveModel",null)}resolveSourceObjects(t){for(let i=this.models.length-1;i>=0;i--){const r=this.models[i].asset;if(!r.sourceObject||typeof r.sourceObject!="object"){console.log("no source object, removing model",i,r),this.models.splice(i,1);continue}else{const o=ne.getComponent(r.sourceObject,jd);this.timelines.push(o),o&&r.updateDirector&&(o.playOnAwake=!1)}}}evaluate(t){var i;this._previousActiveModel=null;for(let n=0;n<this.models.length;n++){const r=this.models[n],o=r.asset;if(t>=r.start&&t<=r.end){this._previousActiveModel=r;const a=this.getClipTime(t,r);if(o.controlActivation){const l=o.sourceObject;l.visible=!0}if(o.updateDirector){const l=this.timelines[n];l&&(l.isPlaying&&l.pause(),l.time=a,l.evaluate())}}else{const a=(i=this._previousActiveModel)==null?void 0:i.asset;if(o.controlActivation){const l=o.sourceObject;(a==null?void 0:a.sourceObject)!==l&&(l.visible=!1)}}}}}var Tye=Object.defineProperty,Iye=Object.getOwnPropertyDescriptor,R7=(s,e,t,i)=>{for(var n=i>1?void 0:i?Iye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Tye(e,t,n),n};const _h=ie("debugtimeline");var MB;const QD=(MB=class extends Ie{constructor(){super(...arguments);d(this,"playableAsset");d(this,"playOnAwake");d(this,"extrapolationMode",1);d(this,"waitForAudio",!0);d(this,"_visibilityChangeEvt");d(this,"_clonedPlayableAsset",!1);d(this,"_speed",1);d(this,"_guidsMap");d(this,"_isPlaying",!1);d(this,"_internalUpdateRoutine");d(this,"_isPaused",!1);d(this,"_isStopping",!1);d(this,"_time",0);d(this,"_duration",0);d(this,"_weight",1);d(this,"_animationTracks",[]);d(this,"_audioTracks",[]);d(this,"_signalTracks",[]);d(this,"_controlTracks",[]);d(this,"_customTracks",[]);d(this,"_allTracks",[this._animationTracks,this._audioTracks,this._signalTracks,this._controlTracks,this._customTracks]);d(this,"animationCallbackReceivers",[])}static registerCreateTrack(e,t){this.createTrackFunctions[e]=t}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get time(){return this._time}set time(e){typeof e=="number"&&!Number.isNaN(e)?this._time=e:(_h||yo())&&console.error("INVALID TIMELINE.TIME VALUE",e,this.name)}get duration(){return this._duration}set duration(e){this._duration=e}get weight(){return this._weight}set weight(e){this._weight=e}get speed(){return this._speed}set speed(e){this._speed=e}awake(){var e,t,i,n,r;_h&&console.log(this,(e=this.playableAsset)==null?void 0:e.tracks),this.rebuildGraph(),!this.isValid()&&(_h||nt())&&(_h?console.warn("PlayableDirector is not valid","Asset?",this.playableAsset,"Tracks:",(t=this.playableAsset)==null?void 0:t.tracks,"IsArray?",Array.isArray((i=this.playableAsset)==null?void 0:i.tracks),this):(r=(n=this.playableAsset)==null?void 0:n.tracks)!=null&&r.length?console.warn("PlayableDirector is not valid"):console.warn("PlayableDirector has no tracks"))}onEnable(){var e,t,i;for(const n of this._audioTracks)(e=n.onEnable)==null||e.call(n);for(const n of this._customTracks)(t=n.onEnable)==null||t.call(n);for(const n of this._animationTracks)(i=n.onEnable)==null||i.call(n);this.playOnAwake&&this.play(),this._visibilityChangeEvt||(this._visibilityChangeEvt=()=>{switch(document.visibilityState){case"hidden":this.setAudioTracksAllowPlaying(!1);break;case"visible":this.setAudioTracksAllowPlaying(!0);break}}),window.addEventListener("visibilitychange",this._visibilityChangeEvt)}onDisable(){var e,t,i;this.stop();for(const n of this._audioTracks)(e=n.onDisable)==null||e.call(n);for(const n of this._customTracks)(t=n.onDisable)==null||t.call(n);for(const n of this._animationTracks)(i=n.onDisable)==null||i.call(n);this._visibilityChangeEvt&&window.removeEventListener("visibilitychange",this._visibilityChangeEvt)}onDestroy(){var e;for(const t of this._allTracks)for(const i of t)(e=i.onDestroy)==null||e.call(i)}rebuildGraph(){this.isValid()&&(this.resolveBindings(),this.updateTimelineDuration(),this.setupAndCreateTrackHandlers())}async play(){if(!this.isValid())return;const e=this._isPaused==!0;if(this._isPaused=!1,!this._isPlaying){if(this._isPlaying=!0,e&&this.invokePauseChangedMethodsOnTracks(),this.waitForAudio){const t=[];for(const i of this._audioTracks){const n=i.loadAudio(this._time,1,0);n&&t.push(n)}if(t.length>0&&(await Promise.all(t),!this._isPlaying))return;for(;this._audioTracks.length>0&&this._isPlaying&&!Hn.userInteractionRegistered&&this.waitForAudio;)await Nc(200)}this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine=this.startCoroutine(this.internalUpdate(),nn.LateUpdate)}}pause(){this.isValid()&&(this._isPlaying=!1,!this._isPaused&&(this._isPaused=!0,this.internalEvaluate(),this.invokePauseChangedMethodsOnTracks(),this.invokeStateChangedMethodsOnTracks()))}stop(){this._isStopping=!0;for(const i of this._audioTracks)i.stop();const e=this._isPaused==!0,t=this._isPlaying;this._isPlaying&&(this._time=0,this._isPlaying=!1,this._isPaused=!1,this.internalEvaluate(),e&&this.invokePauseChangedMethodsOnTracks()),this._isPlaying=!1,this._isPaused=!1,e&&!t&&this.invokePauseChangedMethodsOnTracks(),t&&this.invokeStateChangedMethodsOnTracks(),this._internalUpdateRoutine&&this.stopCoroutine(this._internalUpdateRoutine),this._internalUpdateRoutine=null,this._isStopping=!1}evaluate(){this.internalEvaluate(!0)}isValid(){return this.playableAsset&&this.playableAsset.tracks&&Array.isArray(this.playableAsset.tracks)}*forEachTrack(){for(const e of this._allTracks)for(const t of e)yield t}get audioTracks(){return this._audioTracks}resolveGuids(e){this._guidsMap=e}invokePauseChangedMethodsOnTracks(){var e;for(const t of this.forEachTrack())(e=t.onPauseChanged)==null||e.call(t)}invokeStateChangedMethodsOnTracks(){var e;for(const t of this.forEachTrack())(e=t.onStateChanged)==null||e.call(t,this._isPlaying)}*internalUpdate(){for(;this._isPlaying&&this.activeAndEnabled;)!this._isPaused&&this._isPlaying&&(this._time+=this.context.time.deltaTime*this.speed,this.internalEvaluate()),yield}internalEvaluate(e=!1){if(!this.isValid())return;let t=this._time;switch(this.extrapolationMode){case 0:this._speed>0?t=Math.min(t,this._duration):this._speed<0&&(t=Math.max(t,0)),this._time=t;break;case 1:t%=this._duration,this._time=t;break;case 2:if(t>this._duration){this.stop();return}break}const i=this._time;for(const n of this.playableAsset.tracks)if(!n.muted)switch(n.type){case ea.Activation:if(!e&&!this._isPlaying)continue;for(let r=0;r<n.outputs.length;r++){const o=n.outputs[r];if(typeof o=="object"){let a=!1;if(n.clips)for(const c of n.clips)c.start<=i&&i<=c.end&&(a=!0);const l=o;l.visible!==void 0&&l.visible!==a&&(l.visible=a,_h&&console.warn(this.name,"set ActivationTrack-"+r,l.name,a,i))}}break}if(!this._isStopping)for(const n of this._animationTracks)n.evaluate(i);for(const n of this._audioTracks)n.evaluate(i);for(const n of this._signalTracks)n.evaluate(i);for(const n of this._controlTracks)n.evaluate(i);for(const n of this._customTracks)n.evaluate(i)}resolveBindings(){if(this._clonedPlayableAsset||(this._clonedPlayableAsset=!0,this.playableAsset=Fb(this.playableAsset)),!this.playableAsset||!this.playableAsset.tracks)return;const e=this.findRoot(this.gameObject);for(const t of this.playableAsset.tracks){for(let i=t.outputs.length-1;i>=0;i--){let n=t.outputs[i];if(typeof n=="string"){this._guidsMap&&this._guidsMap[n]&&(n=this._guidsMap[n]);const r=ne.findByGuid(n,e);r===null||typeof r!="object"?(t.outputs.splice(i,1),console.warn("Failed to resolve binding",n,t.name,t.type)):(_h&&console.log("Resolved binding",n,"to",r),t.outputs[i]=r)}else if(n===null){if(t.outputs.splice(i,1),QD.createTrackFunctions[t.type])continue;t.type!==ea.Audio&&t.type!==ea.Control&&t.type!==ea.Marker&&t.type!==ea.Signal&&console.warn("Missing binding",n,t.name,t.type,this.name,this.playableAsset.name)}}if(t.type===ea.Control&&t.clips)for(let i=0;i<t.clips.length;i++){const n=t.clips[i];let r=n.asset.sourceObject;if(typeof r=="string"){this._guidsMap&&this._guidsMap[r]&&(r=this._guidsMap[r]);const o=ne.findByGuid(r,e);o===null||typeof o!="object"?console.warn("Failed to resolve sourceObject binding",r,t.name,n):(_h&&console.log("Resolved binding",r,"to",o),n.asset.sourceObject=o)}}}}findRoot(e){return e.parent?this.findRoot(e.parent):e}updateTimelineDuration(){if(this._duration=0,!(!this.playableAsset||!this.playableAsset.tracks)){for(const e of this.playableAsset.tracks)if(e.muted!==!0){if(e.clips)for(const t of e.clips)t.end>this._duration&&(this._duration=t.end);if(e.markers)for(const t of e.markers)t.time>this._duration&&(this._duration=t.time+.001)}}}setupAndCreateTrackHandlers(){var t,i,n;if(this._animationTracks.length=0,this._audioTracks.length=0,this._signalTracks.length=0,!this.playableAsset)return;let e=ne.findObjectOfType(Fd,this.context);for(const r of this.playableAsset.tracks){const o=r.type,a=QD.createTrackFunctions[o];if(a!=null){const l=a(this,r);if(typeof l.evaluate=="function"){l.director=this,l.track=r,this._customTracks.push(l);continue}}if(r.type===ea.Animation){if(!r.clips||r.clips.length<=0){_h&&console.warn("Animation track has no clips",r);continue}for(let l=r.outputs.length-1;l>=0;l--){let c=r.outputs[l];if(c instanceof ye){const u=ne.getOrAddComponent(c,vr);u&&(c=u)}const h=(t=c==null?void 0:c.gameObject)==null?void 0:t.animations;if(h){const u=new uT;u.trackOffset=r.trackOffset,u.director=this,u.track=r;for(let f=0;f<r.clips.length;f++){const p=r.clips[f],m=p.asset;if(!m){console.error(`Timeline ${this.name}: clip #${f} on track "${r.name}" has no animation data`);continue}const v=m.clip;let g=v;if((typeof g=="string"||typeof g=="number")&&(g=h.find(A=>A.name===v)),_h&&console.log(m,v,"",g),!g){console.warn("Could not find animationClip for model",p,r.name,this.name,(i=this.playableAsset)==null?void 0:i.name,h,c);continue}c instanceof vr&&c.runtimeAnimatorController&&(c.__internalDidAwakeAndStart||c.initializeRuntimeAnimatorController(),c.runtimeAnimatorController.mixer||c.runtimeAnimatorController.bind(c),u.mixer=c.runtimeAnimatorController.mixer),u.mixer||(u.mixer=new wM(c.gameObject),this.context.animations.registerAnimationMixer(u.mixer)),u.clips.push(g),u.mixer.uncacheAction(g),u.createHooks(p.asset,g);const y=u.mixer.clipAction(g);u.actions.push(y),u.models.push(p)}this._animationTracks.push(u)}}}else if(r.type===ea.Audio){if(!r.clips||r.clips.length<=0)continue;const l=new Vp;l.director=this,l.track=r,l.audioSource=r.outputs.find(c=>c instanceof Hn),this._audioTracks.push(l),e||(e=(n=this.context.mainCameraComponent)==null?void 0:n.gameObject.addNewComponent(Fd)),l.listener=e.listener;for(let c=0;c<r.clips.length;c++){const h=r.clips[c];l.addModel(h)}}else if(r.type===ea.Marker){const l=new nb;if(l.director=this,l.track=r,r.markers)for(const c of r.markers)switch(c.type){case dF.Signal:l.models.push(c),l.didTrigger.push(!1);break}if(l!==null&&l.models.length>0){const c=ne.getComponent(this.gameObject,kv);c&&(l.receivers.push(c),this._signalTracks.push(l))}}else if(r.type===ea.Signal){const l=new nb;if(l.director=this,l.track=r,r.markers)for(const c of r.markers)l.models.push(c),l.didTrigger.push(!1);for(const c of r.outputs)l.receivers.push(c);this._signalTracks.push(l)}else if(r.type===ea.Control){const l=new dT;if(l.director=this,l.track=r,r.clips)for(const c of r.clips)l.models.push(c);l.resolveSourceObjects(this.context),this._controlTracks.push(l)}}}setAudioTracksAllowPlaying(e){for(const t of this._audioTracks)t.onAllowAudioChanged(e)}registerAnimationCallback(e){this.animationCallbackReceivers.push(e)}unregisterAnimationCallback(e){const t=this.animationCallbackReceivers.indexOf(e);t!==-1&&this.animationCallbackReceivers.splice(t,1)}},d(MB,"createTrackFunctions",{}),MB);let jd=QD;R7([C()],jd.prototype,"playOnAwake",2);R7([C()],jd.prototype,"extrapolationMode",2);const v1=Symbol("objectIsAnimatedData");function oH(s,e,t){if(!s)return;if(s[v1]===void 0){if(!t)return;s[v1]=new Set}const i=s[v1];t?i.add(e):i.has(e)&&i.delete(e)}function Rye(s){if(!s)return!1;const e=s[v1];return e!==void 0&&e.size>0}mi.registerCallback(Ti.ContextCreated,s=>{const e=s.context.domElement.getAttribute("autoplay");if(e!==void 0&&(e===""||e==="true"||e==="1")&&s.files)for(const t of s.files)ne.foreachComponent(t.file.scene,n=>{if(n.enabled!==!1){if(n instanceof Wr&&n.playAutomatically||n instanceof vr||n instanceof jd&&n.playOnAwake===!0)return!0;if(n instanceof Wr)return n.playAutomatically=!0,!0;if(n instanceof jd)return n.playOnAwake=!0,!0}},!0)!==!0&&uv.assignAnimationsFromFile(t.file,{createAnimationComponent:(n,r)=>va(n,Wr)})});class Pye{constructor(){d(this,"_context")}get context(){return this._context??Dt.Current}get isStateMachineBehaviour(){return!0}}class BA{constructor(e,t,i,n){d(this,"name");d(this,"nameHash");d(this,"normalizedTime");d(this,"length");d(this,"speed");d(this,"action");d(this,"hasTransitions");var r;this.name=e.name,this.nameHash=e.hash,this.normalizedTime=t,this.length=i,this.speed=n,this.action=e.motion.action||null,this.hasTransitions=((r=e.transitions)==null?void 0:r.length)>0||!1}}function P7(s,e){return{name:"Empty",isLooping:!1,guid:(e==null?void 0:e.generateUUID())??gi.generateUUID(),index:-1,clip:new go(s,0,[])}}var ld=(s=>(s[s.If=1]="If",s[s.IfNot=2]="IfNot",s[s.Greater=3]="Greater",s[s.Less=4]="Less",s[s.Equals=6]="Equals",s[s.NotEqual=7]="NotEqual",s))(ld||{}),fF=(s=>(s[s.Float=1]="Float",s[s.Int=3]="Int",s[s.Bool=4]="Bool",s[s.Trigger=9]="Trigger",s))(fF||{});const Ds=ie("debuganimatorcontroller"),GS=ie("debugrootmotion");class Aa{constructor(e){d(this,"_speed",1);d(this,"normalizedStartOffset",0);d(this,"animator");d(this,"model");d(this,"_mixer");d(this,"_activeState");d(this,"_activeStates",[]);d(this,"_heldActions",[]);d(this,"rootMotionHandler");this.model=e,Ds&&console.log(this)}static createFromClips(e,t={looping:!1,autoTransition:!0,transitionDuration:0}){const i=[];for(let o=0;o<e.length;o++){const a=e[o],l=[];if(t.autoTransition!==!1){const h=t.transitionDuration??0,u=h/a.duration;let f=o;(t.autoTransition===void 0||t.autoTransition===!0)&&(f=(o+1)%e.length),l.push({exitTime:1-u,offset:0,duration:h,hasExitTime:!0,destinationState:f,conditions:[]})}const c={name:a.name,hash:o,motion:{name:a.name,clip:a,isLooping:(t==null?void 0:t.looping)??!1},transitions:l,behaviours:[]};i.push(c)}const n={name:"AnimatorController",guid:new Ms(Date.now()).generateUUID(),parameters:[],layers:[{name:"Base Layer",stateMachine:{defaultState:0,states:i}}]};return new Aa(n)}play(e,t=-1,i=Number.NEGATIVE_INFINITY,n=0){if(t<0)t=0;else if(t>=this.model.layers.length){console.warn("invalid layer");return}const o=this.model.layers[t].stateMachine;for(const a of o.states)if(a.name===e||a.hash===e){Ds&&console.log("transition to ",a),this.transitionTo(a,n,i);return}console.warn("Could not find "+e+" to play")}reset(){this.setStartTransition()}setBool(e,t){var n,r;const i=typeof e=="string"?"name":"hash";return(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getBool(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??!1}setFloat(e,t){var r,o;const i=typeof e=="string"?"name":"hash",n=(o=(r=this.model)==null?void 0:r.parameters)==null?void 0:o.filter(a=>a[i]===e);return n.forEach(a=>a.value=t),(n==null?void 0:n.length)>0}getFloat(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??0}setInteger(e,t){var n,r;const i=typeof e=="string"?"name":"hash";return(r=(n=this.model)==null?void 0:n.parameters)==null?void 0:r.filter(o=>o[i]===e).forEach(o=>o.value=t)}getInteger(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??0}setTrigger(e){var i,n;Ds&&console.log("SET TRIGGER",e);const t=typeof e=="string"?"name":"hash";return(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.filter(r=>r[t]===e).forEach(r=>r.value=!0)}resetTrigger(e){var i,n;const t=typeof e=="string"?"name":"hash";return(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.filter(r=>r[t]===e).forEach(r=>r.value=!1)}getTrigger(e){var i,n,r;const t=typeof e=="string"?"name":"hash";return((r=(n=(i=this.model)==null?void 0:i.parameters)==null?void 0:n.find(o=>o[t]===e))==null?void 0:r.value)??!1}isInTransition(){return this._activeStates.length>1}setSpeed(e){this._speed=e}FindState(e){return this.findState(e)}findState(e){if(!e)return null;if(Array.isArray(this.model.layers)){for(const t of this.model.layers)for(const i of t.stateMachine.states)if(i.name===e||i.hash==e)return i}return null}getCurrentStateInfo(){if(!this._activeState)return null;const e=this._activeState.motion.action;if(!e)return null;const t=this._activeState.motion.clip.duration,i=t<=0?0:Math.abs(e.time/t);return new BA(this._activeState,i,t,this._speed)}get currentAction(){if(!this._activeState)return null;const e=this._activeState.motion.action;return e||null}get context(){var e;return(e=this.animator)==null?void 0:e.context}get mixer(){return this._mixer}dispose(){var e;if(this._mixer.stopAllAction(),this.animator){this._mixer.uncacheRoot(this.animator.gameObject);for(const t of this._activeStates)t.motion.clip&&this.mixer.uncacheAction(t.motion.clip,this.animator.gameObject)}(e=this.context)==null||e.animations.unregisterAnimationMixer(this._mixer)}bind(e){var t,i;e?this.animator!==e&&(this._mixer&&(this._mixer.stopAllAction(),(t=this.context)==null||t.animations.unregisterAnimationMixer(this._mixer)),this.animator=e,this._mixer=new wM(this.animator.gameObject),(i=this.context)==null||i.animations.registerAnimationMixer(this._mixer),this.createActions(this.animator)):console.error("AnimatorController.bind: animator is null")}clone(){if(typeof this.model=="string")return console.warn("AnimatorController has not been resolved, can not create model from string",this.model),null;Ds&&console.warn("AnimatorController clone()",this.model);const e=Fb(this.model,(i,n,r)=>r==null?!0:!(r.type==="Object3D"||r.isObject3D===!0||IQ(r)||r.tracks!==void 0||r instanceof Aa));return console.assert(e!==this.model),new Aa(e)}update(e){var i,n;if(!this.animator)return;this.evaluateTransitions(),this.updateActiveStates(e);const t=this.animator.context.time.deltaTime;this.animator.applyRootMotion&&((i=this.rootMotionHandler)==null||i.onBeforeUpdate(e)),this._mixer.update(t),this.animator.applyRootMotion&&((n=this.rootMotionHandler)==null||n.onAfterUpdate(e))}get activeState(){return this._activeState}updateActiveStates(e){for(let t=0;t<this._activeStates.length;t++){const i=this._activeStates[t],n=i.motion;if(!n.action)this._activeStates.splice(t,1),t--;else{const r=n.action;r.weight=e,r.getEffectiveWeight()<=0&&!r.isRunning()&&(Ds&&console.debug("REMOVE",i.name,r.getEffectiveWeight(),r.isRunning(),r.isScheduled()),this._activeStates.splice(t,1),t--)}}}setStartTransition(){var e;this.model.layers.length>1&&(Ds||nt())&&console.warn("Multiple layers are not supported yet "+((e=this.animator)==null?void 0:e.name));for(const t of this.model.layers){const i=t.stateMachine;i.defaultState===void 0&&(Ds&&console.warn("AnimatorController default state is undefined, will assign state 0 as default",t),i.defaultState=0);const n=i.states[i.defaultState];this.transitionTo(n,0,this.normalizedStartOffset);break}}evaluateTransitions(){var r;let e=!1;if(!this._activeState){if(this.setStartTransition(),!this._activeState)return;e=!0}const t=this._activeState,i=t.motion.action;for(const o of t.transitions){if(!o.hasExitTime&&o.conditions.length<=0)continue;let a=!0;for(const l of o.conditions)if(!this.evaluateCondition(l)){a=!1;break}if(a)if(i){const l=t.motion.clip.duration,c=l<=0?1:Math.abs(i.time/l);let h=o.exitTime;i.timeScale<0&&(h=1-h);let u=!1;if(o.hasExitTime?i.timeScale>0?u=c>=o.exitTime:i.timeScale<0&&(u=1-c>=o.exitTime):u=!0,u){for(const f of o.conditions){const p=this.model.parameters.find(m=>m.name===f.parameter);(p==null?void 0:p.type)===fF.Trigger&&p.value&&(p.value=!1)}if(i.clampWhenFinished=!0,Ds){const f=this.getState(o.destinationState,0);console.log(`Transition to ${o.destinationState} / ${f==null?void 0:f.name}`,o,`
Timescale: `+i.timeScale,`
Normalized time: `+c.toFixed(3),`
Exit Time: `+h,o.hasExitTime)}this.transitionTo(o.destinationState,o.duration,o.offset);return}}else{this.transitionTo(o.destinationState,o.duration,o.offset);return}}i&&this.setTimescale(i,t);let n=!1;if(t.motion.isLooping&&i&&(i.time>=i.getClip().duration?(n=!0,i.reset(),i.time=0,i.play()):i.time<=0&&i.timeScale<0&&(n=!0,i.reset(),i.time=i.getClip().duration,i.play())),!n&&t&&!e&&i&&this.animator&&t.behaviours){const o=i==null?void 0:i.getClip().duration,a=i.time/o,l=new BA(this._activeState,a,o,this._speed);for(const c of t.behaviours)c.instance&&((r=c.instance.onStateUpdate)==null||r.call(c.instance,this.animator,l,0))}}setTimescale(e,t){let i=t.speed??1;t.speedParameter&&(i*=this.getFloat(t.speedParameter)),i!==void 0&&(e.timeScale=i*this._speed)}getState(e,t){return typeof e=="number"&&(e==-1&&(e=this.model.layers[t].stateMachine.defaultState,e===void 0&&(Ds&&console.warn("AnimatorController default state is undefined: ",this.model,"Layer: "+t),e=0)),e=this.model.layers[t].stateMachine.states[e]),e}releaseHeldActions(e){for(const t of this._heldActions)t.fadeOut(e);this._heldActions.length=0}transitionTo(e,t,i){var h,u,f,p,m,v,g,y;if(!this.animator)return;const n=0;if(e=this.getState(e,n),!(e!=null&&e.motion)||!e.motion.clip||!(e.motion.clip instanceof go))return;const r=this._activeState===e;if(r){const A=e.motion;if(!A.action_loopback&&A.clip){const _=this.rootMotionHandler?this.animator.gameObject.matrix.clone():null;this._mixer.uncacheAction(A.clip,this.animator.gameObject),_&&_.decompose(this.animator.gameObject.position,this.animator.gameObject.quaternion,this.animator.gameObject.scale),A.action_loopback=this.createAction(A.clip)}}if((h=this._activeState)!=null&&h.behaviours&&this._activeState.motion.action){const A=(u=this._activeState)==null?void 0:u.motion.clip.duration,_=this._activeState.motion.action.time/A,b=new BA(this._activeState,_,A,this._speed);for(const x of this._activeState.behaviours)(p=(f=x.instance)==null?void 0:f.onStateExit)==null||p.call(x.instance,this.animator,b,n)}const o=(m=this._activeState)==null?void 0:m.motion.action;r&&(e.motion.action=e.motion.action_loopback,e.motion.action_loopback=o);const a=this._activeState;this._activeState=e;const l=(v=e.motion)==null?void 0:v.action,c=e.motion.clip;if((c==null?void 0:c.duration)<=0&&c.tracks.length<=0?o&&this._heldActions.push(o):o&&(o.fadeOut(t),this.releaseHeldActions(t)),l){if(i=Math.max(0,Math.min(1,i)),e.cycleOffsetParameter){let _=this.getFloat(e.cycleOffsetParameter);typeof _=="number"?(_<0&&(_+=1),i+=_,i%=1):Ds&&console.warn("AnimatorController cycle offset parameter is not a number",e.cycleOffsetParameter)}else typeof e.cycleOffset=="number"&&(i+=e.cycleOffset,i%=1);l.isRunning()&&l.stop(),l.reset(),l.enabled=!0,this.setTimescale(l,e);const A=e.motion.clip.duration;if(l.time=r?0:i*A,l.timeScale<0&&(l.time=A-l.time),l.clampWhenFinished=!0,l.setLoop(w_,0),t>0?l.fadeIn(t):l.weight=1,l.play(),this.rootMotionHandler&&this.rootMotionHandler.onStart(l),this._activeStates.includes(e)||this._activeStates.push(e),this._activeState.behaviours){const _=new BA(e,i,A,this._speed);for(const b of this._activeState.behaviours)(y=(g=b.instance)==null?void 0:g.onStateEnter)==null||y.call(b.instance,this.animator,_,n)}}else Ds&&(e.__warned_no_motion||(e.__warned_no_motion=!0,console.warn("No action",e.motion,this)));Ds&&console.log("TRANSITION FROM "+(a==null?void 0:a.name)+" TO "+e.name,t,o,l,l==null?void 0:l.getEffectiveTimeScale(),l==null?void 0:l.getEffectiveWeight(),l==null?void 0:l.isRunning(),l==null?void 0:l.isScheduled(),l==null?void 0:l.paused)}createAction(e){var i,n;if(this._mixer.existingAction(e)&&this._mixer.uncacheAction(e,(i=this.animator)==null?void 0:i.gameObject),(n=this.animator)!=null&&n.applyRootMotion){this.rootMotionHandler||(this.rootMotionHandler=new Bye(this));const r=this.animator.gameObject;return this.rootMotionHandler.createClip(this._mixer,r,e)}else return this._mixer.clipAction(e)}evaluateCondition(e){const t=this.model.parameters.find(i=>i.name===e.parameter);if(!t)return!1;switch(e.mode){case ld.If:return t.value===!0;case ld.IfNot:return t.value===!1;case ld.Greater:return t.value>e.threshold;case ld.Less:return t.value<e.threshold;case ld.Equals:return t.value===e.threshold;case ld.NotEqual:return t.value!==e.threshold}return!1}createActions(e){var t,i,n,r;Ds&&console.log("AnimatorController createActions",this.model);for(const o of this.model.layers){const a=o.stateMachine;for(let l=0;l<a.states.length;l++){const c=a.states[l];c.transitions||(c.transitions=[]);for(const h of c.transitions)h.conditions||(h.conditions=[]);if(c.motion||(Ds&&console.warn("No motion",c),c.motion=P7(c.name)),this.animator&&c.motion.clips){const h=(t=c.motion.clips)==null?void 0:t.find(u=>{var f,p;return u.node.name===((p=(f=this.animator)==null?void 0:f.gameObject)==null?void 0:p.name)});h?c.motion.clip=h.clip:(Ds||nt())&&console.warn('Could not find clip for animator "'+((n=(i=this.animator)==null?void 0:i.gameObject)==null?void 0:n.name)+'"',c.motion.clips.map(u=>u.node.name))}if(!c.motion.clip){Ds&&console.warn("No clip assigned to state",c);const h=new go(void 0,void 0,[]);c.motion.clip=h}if((r=c.motion)!=null&&r.clip){const h=c.motion.clip;if(h instanceof go){const u=this.createAction(h);c.motion.action=u}else(Ds||nt())&&console.warn("No valid animationclip assigned",c)}if(c.behaviours&&Array.isArray(c.behaviours))for(const h of c.behaviours){if(!(h!=null&&h.typeName))continue;const u=J.get(h.typeName),f=new u;f.isStateMachineBehaviour&&(f._context=this.context??void 0,hv(f,h.properties),h.instance=f),Ds&&console.log("Created animator controller behaviour",c.name,h.typeName,h.properties,f)}}}}*enumerateActions(){if(this.model.layers)for(const e of this.model.layers){const t=e.stateMachine;for(let i=0;i<t.states.length;i++){const n=t.states[i];n!=null&&n.motion&&(n.motion.action&&(yield n.motion.action),n.motion.action_loopback&&(yield n.motion.action_loopback))}}}}class aH{constructor(e,t){d(this,"track");d(this,"createdInterpolant");d(this,"originalEvaluate");d(this,"customEvaluate");this.track=e;const i=e,n=i.createInterpolant.bind(e);i.createInterpolant=()=>(i.createInterpolant=n,this.createdInterpolant=n(),this.originalEvaluate=this.createdInterpolant.evaluate.bind(this.createdInterpolant),this.customEvaluate=r=>{if(!this.originalEvaluate)return;const o=this.originalEvaluate(r);return t(r,o)},this.createdInterpolant.evaluate=this.customEvaluate,this.createdInterpolant)}dispose(){this.createdInterpolant&&this.originalEvaluate&&(this.createdInterpolant.evaluate=this.originalEvaluate),this.track=void 0,this.createdInterpolant=null,this.originalEvaluate=void 0,this.customEvaluate=void 0}}const bs=class{constructor(e,t,i,n,r){d(this,"_action");d(this,"root");d(this,"clip");d(this,"positionWrapper",null);d(this,"rotationWrapper",null);d(this,"context");d(this,"positionChange",new S);d(this,"rotationChange",new Ce);d(this,"_prevTime",0);if(this.context=e,this.root=t,this.clip=i,bs.firstKeyframeRotation[this.cacheId]||(bs.firstKeyframeRotation[this.cacheId]=new Ce),r){const o=r.values;bs.firstKeyframeRotation[this.cacheId].set(o[0],o[1],o[2],o[3])}bs.spaceRotation[this.cacheId]||(bs.spaceRotation[this.cacheId]=new Ce),bs.effectiveSpaceRotation[this.cacheId]||(bs.effectiveSpaceRotation[this.cacheId]=new Ce),bs.clipOffsetRotation[this.cacheId]=new Ce,r&&bs.clipOffsetRotation[this.cacheId].set(r.values[0],r.values[1],r.values[2],r.values[3]).invert(),this.handlePosition(i,n),this.handleRotation(i,r)}set action(e){this._action=e}get action(){return this._action}get cacheId(){return this.root.uuid}onStart(e){if(e.getClip()!==this.clip)return;bs.lastObjRotation[this.cacheId]||(bs.lastObjRotation[this.cacheId]=this.root.quaternion.clone());const t=bs.lastObjRotation[this.cacheId];if(bs.spaceRotation[this.cacheId].copy(t),GS){const i=new li().setFromQuaternion(t);console.log("START",this.clip.name,it.toDegrees(i.y),this.root.position.z)}}getClipRotationOffset(){return bs.clipOffsetRotation[this.cacheId]}handlePosition(e,t){if(t){const i=this.root;GS&&i.add(new _a),bs.lastObjPosition[this.cacheId]||(bs.lastObjPosition[this.cacheId]=this.root.position.clone());const n=new S,r=new S;this.positionWrapper=new aH(t,(o,a)=>{const l=this.action.getEffectiveWeight();return GS&&i.position.length()>8&&i.position.set(0,i.position.y,0),o>this._prevTime&&(n.set(a[0],a[1],a[2]),n.sub(r),n.multiplyScalar(l),n.applyQuaternion(this.getClipRotationOffset()),n.applyQuaternion(i.quaternion),this.positionChange.copy(n)),r.fromArray(a),this._prevTime=o,a[0]=0,a[1]=0,a[2]=0,a})}}handleRotation(e,t){if(t){if(GS){const o=t.values,a=new li().setFromQuaternion(new Ce(o[0],o[1],o[2],o[3]));console.log(e.name,t.name,"FIRST ROTATION IN TRACK",it.toDegrees(a.y));const l=t.values.length-4,c=new Ce().set(o[l],o[l+1],o[l+2],o[l+3]),h=new li().setFromQuaternion(c);console.log(e.name,t.name,"LAST ROTATION IN TRACK",it.toDegrees(h.y))}let i=0;const n=new Ce,r=new Ce;this.rotationWrapper=new aH(t,(o,a)=>(o>i&&(r.set(a[0],a[1],a[2],a[3]),n.invert(),r.multiply(n),this.rotationChange.copy(r)),n.fromArray(a),i=o,a[0]=0,a[1]=0,a[2]=0,a[3]=1,a))}}onBeforeUpdate(e){this.positionChange.set(0,0,0),this.rotationChange.set(0,0,0,1)}onAfterUpdate(e){return!this.action||(e*=this.action.getEffectiveWeight(),e<=0)?!1:(this.positionChange.multiplyScalar(e),this.rotationChange.slerp(bs.identityQuaternion,1-e),!0)}};let oc=bs;d(oc,"lastObjPosition",{}),d(oc,"lastObjRotation",{}),d(oc,"firstKeyframeRotation",{}),d(oc,"spaceRotation",{}),d(oc,"effectiveSpaceRotation",{}),d(oc,"clipOffsetRotation",{}),d(oc,"identityQuaternion",new Ce);class Bye{constructor(e){d(this,"controller");d(this,"handler",[]);d(this,"root");d(this,"basePosition",new S);d(this,"baseQuaternion",new Ce);d(this,"baseRotation",new li);d(this,"summedPosition",new S);d(this,"summedRotation",new Ce);this.controller=e}createClip(e,t,i){this.root=t,t&&"name"in t&&t.name;const n=this.findRootTrack(i,".position"),r=this.findRootTrack(i,".quaternion"),o=new oc(this.controller.context,t,i,n,r);this.handler.push(o);const a=e.clipAction(i);return o.action=a,a}onStart(e){for(const t of this.handler)t.onStart(e)}onBeforeUpdate(e){this.basePosition.copy(this.root.position),this.baseQuaternion.copy(this.root.quaternion);for(const t of this.handler)t.onBeforeUpdate(e)}onAfterUpdate(e){if(!(e<=0)){this.root.position.copy(this.basePosition),this.root.quaternion.copy(this.baseQuaternion),this.summedPosition.set(0,0,0),this.summedRotation.set(0,0,0,1);for(const t of this.handler)t.onAfterUpdate(e)&&(this.summedPosition.add(t.positionChange),this.summedRotation.multiply(t.rotationChange));this.root.position.add(this.summedPosition),this.root.quaternion.multiply(this.summedRotation)}}findRootTrack(e,t){const i=e.tracks;if(!i)return null;for(const n of i)if(n.name.endsWith(t))return n;return null}}class Dye extends hl{onSerialize(e,t){}onDeserialize(e,t){if(t.type===Aa&&(e==null?void 0:e.__type)==="AnimatorController")return new Aa(e)}}new Dye(Aa);var Oye=Object.defineProperty,Lye=Object.getOwnPropertyDescriptor,fT=(s,e,t,i)=>{for(var n=i>1?void 0:i?Lye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Oye(e,t,n),n};const La=ie("debuganimator");class vr extends Ie{constructor(){super(...arguments);d(this,"applyRootMotion",!1);d(this,"hasRootMotion",!1);d(this,"keepAnimatorControllerStateOnDisable",!1);d(this,"_parametersAreDirty",!1);d(this,"_isDirty",!1);d(this,"_speed",1);d(this,"_normalizedStartOffset",0);d(this,"_animatorController",null);d(this,"_initializeWithRuntimeAnimatorController")}get isAnimationComponent(){return!0}set runtimeAnimatorController(t){var i;this._animatorController&&this._animatorController.model===t||(t?t instanceof Aa?(t.animator&&t.animator!==this&&(console.warn("AnimatorController can not be bound to multiple animators",(i=t.model)==null?void 0:i.name),t.model||console.error("AnimatorController has no model"),t=new Aa(t.model)),this._animatorController=t,this._animatorController.bind(this)):(La&&console.log("Assign animator controller",t,this),this._animatorController=new Aa(t),this.__didAwake&&this._animatorController.bind(this)):this._animatorController=null)}get runtimeAnimatorController(){return this._animatorController}getCurrentStateInfo(){var t;return(t=this.runtimeAnimatorController)==null?void 0:t.getCurrentStateInfo()}get currentAction(){var t;return((t=this.runtimeAnimatorController)==null?void 0:t.currentAction)||null}get parametersAreDirty(){return this._parametersAreDirty}get isDirty(){return this._isDirty}Play(t,i=-1,n=Number.NEGATIVE_INFINITY,r=0){this.play(t,i,n,r)}play(t,i=-1,n=Number.NEGATIVE_INFINITY,r=0){var o;(o=this.runtimeAnimatorController)==null||o.play(t,i,n,r),this._isDirty=!0}Reset(){this.reset()}reset(){var t;(t=this._animatorController)==null||t.reset(),this._isDirty=!0}SetBool(t,i){this.setBool(t,i)}setBool(t,i){var n,r;La&&console.log("setBool",t,i),((n=this.runtimeAnimatorController)==null?void 0:n.getBool(t))!==i&&(this._parametersAreDirty=!0),(r=this.runtimeAnimatorController)==null||r.setBool(t,i)}GetBool(t){return this.getBool(t)}getBool(t){var n;const i=((n=this.runtimeAnimatorController)==null?void 0:n.getBool(t))??!1;return La&&console.log("getBool",t,i),i}toggleBool(t){this.setBool(t,!this.getBool(t))}SetFloat(t,i){this.setFloat(t,i)}setFloat(t,i){var n,r;((n=this.runtimeAnimatorController)==null?void 0:n.getFloat(t))!==i&&(this._parametersAreDirty=!0),La&&console.log("setFloat",t,i),(r=this.runtimeAnimatorController)==null||r.setFloat(t,i)}GetFloat(t){return this.getFloat(t)}getFloat(t){var n;const i=((n=this.runtimeAnimatorController)==null?void 0:n.getFloat(t))??-1;return La&&console.log("getFloat",t,i),i}SetInteger(t,i){this.setInteger(t,i)}setInteger(t,i){var n,r;((n=this.runtimeAnimatorController)==null?void 0:n.getInteger(t))!==i&&(this._parametersAreDirty=!0),La&&console.log("setInteger",t,i),(r=this.runtimeAnimatorController)==null||r.setInteger(t,i)}GetInteger(t){return this.getInteger(t)}getInteger(t){var n;const i=((n=this.runtimeAnimatorController)==null?void 0:n.getInteger(t))??-1;return La&&console.log("getInteger",t,i),i}SetTrigger(t){this.setTrigger(t)}setTrigger(t){var i;this._parametersAreDirty=!0,La&&console.log("setTrigger",t),(i=this.runtimeAnimatorController)==null||i.setTrigger(t)}ResetTrigger(t){this.resetTrigger(t)}resetTrigger(t){var i;this._parametersAreDirty=!0,La&&console.log("resetTrigger",t),(i=this.runtimeAnimatorController)==null||i.resetTrigger(t)}GetTrigger(t){this.getTrigger(t)}getTrigger(t){var n;const i=(n=this.runtimeAnimatorController)==null?void 0:n.getTrigger(t);return La&&console.log("getTrigger",t,i),i}IsInTransition(){return this.isInTransition()}isInTransition(){var t;return((t=this.runtimeAnimatorController)==null?void 0:t.isInTransition())??!1}SetSpeed(t){return this.setSpeed(t)}setSpeed(t){var i;t!==this._speed&&(La&&console.log("setSpeed",t),this._speed=t,((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(t))}set minMaxSpeed(t){var i;this._speed=it.lerp(t.x,t.y,Math.random()),((i=this._animatorController)==null?void 0:i.animator)==this&&this._animatorController.setSpeed(this._speed)}set minMaxOffsetNormalized(t){var i;this._normalizedStartOffset=it.lerp(t.x,t.y,Math.random()),((i=this.runtimeAnimatorController)==null?void 0:i.animator)==this&&(this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset)}awake(){La&&console.log("ANIMATOR",this.name,this),this.gameObject&&this.initializeRuntimeAnimatorController()}initializeRuntimeAnimatorController(t=!1){const i=t||this.runtimeAnimatorController!==this._initializeWithRuntimeAnimatorController;if(this.runtimeAnimatorController&&i){const n=this.runtimeAnimatorController.clone();this._initializeWithRuntimeAnimatorController=n,n?(console.assert(this.runtimeAnimatorController!==n),this.runtimeAnimatorController=n,console.assert(this.runtimeAnimatorController===n),this.runtimeAnimatorController.bind(this),this.runtimeAnimatorController.setSpeed(this._speed),this.runtimeAnimatorController.normalizedStartOffset=this._normalizedStartOffset):console.warn("Could not clone animator controller",this.runtimeAnimatorController)}}onDisable(){var t;this.keepAnimatorControllerStateOnDisable||(t=this._animatorController)==null||t.reset()}onBeforeRender(){this._isDirty=!1,this._parametersAreDirty=!1,!Rye(this.gameObject)&&this._animatorController&&this._animatorController.update(1)}}fT([C()],vr.prototype,"applyRootMotion",2);fT([C()],vr.prototype,"hasRootMotion",2);fT([C()],vr.prototype,"keepAnimatorControllerStateOnDisable",2);fT([C()],vr.prototype,"runtimeAnimatorController",1);const mc=ie("debugusdzanimation"),WD=ie("debugusdzanimationserialization");class pT{constructor(e,t,i){d(this,"_start");d(this,"ext");d(this,"root");d(this,"clip");d(this,"speed");this.ext=e,this.root=t,this.clip=i}get start(){return this._start===void 0&&(this._start=this.ext.getStartTime01(this.root,this.clip)),this._start}get duration(){var e;return((e=this.clip)==null?void 0:e.duration)??os.restPoseClipDuration}}const FU=class{constructor(e,t,i){d(this,"clip");d(this,"pos");d(this,"rot");d(this,"scale");d(this,"root");d(this,"target");d(this,"duration",0);d(this,"useRootMotion",!1);this.root=e,this.target=t,this.clip=i,i?this.duration=i.duration:this.duration=FU.restPoseClipDuration;const n=ne.getComponent(e,vr);n&&(this.useRootMotion=n.applyRootMotion)}get frameRate(){return 60}addTrack(e){var t,i;if(!this.clip){console.error("This is a rest clip but you're trying to add tracks to it  this is likely a bug");return}e.name.endsWith("position")?this.pos=e:e.name.endsWith("quaternion")?this.rot=e:e.name.endsWith("scale")?this.scale=e:(e.name.endsWith("activeSelf")?console.warn("[USDZ] Animation of enabled/disabled state is not supported for USDZ export and will NOT be exported: "+e.name+" on "+(((t=this.root)==null?void 0:t.name)??this.target.name)+". Animate scale 0/1 instead."):console.warn("[USDZ] Animation track type not supported for USDZ export and will NOT be exported: "+e.name+" on "+(((i=this.root)==null?void 0:i.name)??this.target.name)+". Only .position, .rotation, .scale are supported."),nt()&&Fi("[USDZ] Some animations can't be exported. See console for details."))}getFrames(){var e,t,i,n,r,o;return this.clip?Math.max(((t=(e=this.pos)==null?void 0:e.times)==null?void 0:t.length)??0,((n=(i=this.rot)==null?void 0:i.times)==null?void 0:n.length)??0,((o=(r=this.scale)==null?void 0:r.times)==null?void 0:o.length)??0):2}getDuration(){return this.duration}getSortedTimesArray(e=!0,t=!0,i=!0){var l,c,h;if(!this.clip)return[0,this.duration];const n=(l=this.pos)==null?void 0:l.times,r=(c=this.rot)==null?void 0:c.times,o=(h=this.scale)==null?void 0:h.times,a=[];if(e&&n)for(const u of n)a.push(u);if(t&&r)for(const u of r)a.push(u);if(i&&o)for(const u of o)a.push(u);return a.includes(0)||a.push(0),a.sort((u,f)=>u-f),[...new Set(a)]}*getValues(e,t=!0,i=!0,n=!0){var f,p,m;const r=new S,o=new Ce,a=new S(1,1,1),l=this.target,c=t?(f=this.pos)==null?void 0:f.createInterpolant():void 0,h=i?(p=this.rot)==null?void 0:p.createInterpolant():void 0,u=n?(m=this.scale)==null?void 0:m.createInterpolant():void 0;c||r.set(l.position.x,l.position.y,l.position.z),h||o.set(l.quaternion.x,l.quaternion.y,l.quaternion.z,l.quaternion.w),u||a.set(l.scale.x,l.scale.y,l.scale.z);for(let v=0;v<e.length;v++){const g=e[v];if(c){const y=c.evaluate(g);r.set(y[0],y[1],y[2])}if(h){const y=h.evaluate(g);o.set(y[0],y[1],y[2],y[3])}if(u){const y=u.evaluate(g);a.set(y[0],y[1],y[2])}if(this.useRootMotion&&l===this.root){const y=new le;y.compose(r,o,a),y.multiply(l.matrix),y.decompose(r,o,a)}yield{time:g,translation:r,rotation:o,scale:a,index:v}}}};let os=FU;d(os,"animationDurationPadding",1/60),d(os,"restPoseClipDuration",1/60);class cx{constructor(e){d(this,"dict",new Map);d(this,"rootTargetMap",new Map);d(this,"rootAndClipToRegisteredAnimationMap",new Map);d(this,"rootToRegisteredClip",new Map);d(this,"serializers",[]);d(this,"injectRestPoses",!1);d(this,"injectImplicitBehaviours",!1);this.injectRestPoses=e,this.injectImplicitBehaviours=e}get extensionName(){return"animation"}getStartTimeCode(){return!this.injectRestPoses||this.rootAndClipToRegisteredAnimationMap.size===0?0:(os.restPoseClipDuration+os.animationDurationPadding)*60}getEndTimeCode(){let e=0;for(const[t,i]of this.rootAndClipToRegisteredAnimationMap){const n=i.start+i.duration;n>e&&(e=n)}return e*60}getClipCount(e){var i;return((i=this.rootToRegisteredClip.get(e))==null?void 0:i.length)??0??0}getStartTime01(e,t){if(!t)return 0;const i=this.rootTargetMap.get(e);if(!i)return 0;const n=this.dict.get(i[0]);if(!n)return console.error("Trying to get start time for root that has no animation data",e,t,...this.dict),0;let r=0;for(let o=0;o<n.length&&n[o].clip!==t;o++)r+=n[o].getDuration()+os.animationDurationPadding;return r}registerAnimation(e,t){var c;if(!e)return null;this.rootTargetMap.has(e)||this.rootTargetMap.set(e,[]);const i=e.uuid+((t==null?void 0:t.uuid)??"-rest");if(this.rootAndClipToRegisteredAnimationMap.has(i))return this.rootAndClipToRegisteredAnimationMap.get(i);mc&&console.log("registerAnimation",e,t);const n=this.injectRestPoses?1:0,r=(((c=this.rootToRegisteredClip.get(e))==null?void 0:c.length)??0)+n,o=this.rootTargetMap.get(e),a=new Set(o);if(t&&t.tracks)for(const h of t.tracks){const u=Zt.parseTrackName(h.name),f=Zt.findNode(e,u.nodeName);if(!f){console.warn("no object found for track",h.name,"using "+e.name+" instead");continue}this.dict.has(f)||this.dict.set(f,[]);const p=this.dict.get(f);if(!p){console.warn("no transform data found for target ",f,"at slot "+r+", this is likely a bug");continue}a.delete(f),this.injectRestPoses&&!p[0]&&(p[0]=new os(null,f,null));let m=p[r];m||(m=new os(e,f,t),p[r]=m),m.addTrack(h),o!=null&&o.includes(f)||o==null||o.push(f)}mc&&console.log("Unregistered nodes for this clip",a,"clip",t,"at slot",r,"for root",e,"targets",o);for(const h of a){const u=this.dict.get(h);if(!u)continue;if(this.injectRestPoses&&!u[0]){console.warn("Adding rest pose for ",h,t,"at slot",r,"This is likely a bug, should have been added earlier.");const p=new os(null,h,null);u[0]=p}let f=u[r];f||(mc&&console.log("Adding padding clip for ",h,t,"at slot",r),f=new os(e,h,t),u[r]=f)}const l=new pT(this,e,t);if(this.rootAndClipToRegisteredAnimationMap.set(i,l),mc&&console.log({root:e,clip:t,info:l}),t){const h=this.rootToRegisteredClip.get(e);h?h.push(t):this.rootToRegisteredClip.set(e,[t])}return l}onAfterHierarchy(e){mc&&console.log("Animation clips per animation target node",this.dict)}onAfterBuildDocument(e){var t,i;mc&&console.log("Animation data",{dict:this.dict,rootTargetMap:this.rootTargetMap,rootToRegisteredClip:this.rootToRegisteredClip});for(const n of this.rootTargetMap.keys()){const r=this.rootTargetMap.get(n);if(!r)continue;let o;const a=[];for(const l of r){const c=this.dict.get(l);if(!c){console.error("No data found for target on USDZ export  please report a bug!",l);continue}o===void 0&&(o=c==null?void 0:c.length),o!==(c==null?void 0:c.length)&&console.error("Different array lengths for targets  please report a bug!",c);for(let h=0;h<c.length;h++){let u=c[h];if(!u){const p=h-(this.injectRestPoses?1:0);c[h]=new os(null,l,this.rootToRegisteredClip.get(n)[p]),u=c[h]}const f=u.getDuration();if(a[h]===void 0)a[h]=f;else if(a[h]!==f){console.error("Error during UDSZ export: Encountered different animation durations for animated targets. Please report a bug!",{datas:c,target:l}),a[h]=f;continue}}}}for(const n of this.serializers){const r=(t=n.model)==null?void 0:t.parent,o=(r==null?void 0:r.isDynamic)===!0;WD&&console.log(o,(i=n.model)==null?void 0:i.parent),o&&n.registerCallback(r)}}onExportObject(e,t,i){ne.foreachComponent(e,r=>{const o=r;typeof o.createAnimation=="function"&&o.createAnimation(this,t,i)},!1);const n=new kye(e,this.dict);this.serializers.push(n),n.registerCallback(t)}}class kye{constructor(e,t){d(this,"object");d(this,"dict");d(this,"model");d(this,"callback");this.object=e,this.dict=t}registerCallback(e){this.model&&this.callback&&this.model.removeEventListener("serialize",this.callback),this.callback||(this.callback=this.onSerialize.bind(this)),WD&&console.log("REPARENT",e),this.model=e,this.callback&&this.model.addEventListener("serialize",this.callback)}skinnedMeshExport(e,t){var r;const i=this.model,n=this.dict;if(i&&i.skinnedMesh){let o=function(I){const O=[];for(const[k,B]of I){let G=`${k} : [`;const L=[];for(const U of B)L.push(`(${Fs(U.x)}, ${Fs(U.y)}, ${Fs(U.z)})`);G=G.concat(L.join(", ")),G=G.concat("],"),O.push(G)}return O},a=function(I){const O=[];for(const[k,B]of I){let G=`${k} : [`;const L=[];for(const U of B)L.push(`(${Fs(U.w)}, ${Fs(U.x)}, ${Fs(U.y)}, ${Fs(U.z)})`);G=G.concat(L.join(", ")),G=G.concat("],"),O.push(G)}return O},l=function(I){let O,k=!0;const B=new Map;for(const[L,U]of I){O===void 0&&(O=U.length),O!==U.length&&(k=!1);let z=0;for(const j of U)z++,j||(B.has(L)||B.set(L,[]),B.get(L).push(z))}mc&&console.log("Bone count: ",I.size,"TransformData entries per bone: ",O,"Undefined bone entries: ",B),console.assert(k,"All bones should have the same number of TransformData entries",I),console.assert(B.size===0,"All TransformData entries should be set",B);const G=[];for(const[L,U]of I){const z=new Array;let j=0;for(let X=0;X<U.length;X++)z.push(j),j+=U[X].getDuration()+os.animationDurationPadding;for(let X=0;X<U.length;X++){const re=U[X],ce=z[X];G.length<=X&&G.push({pos:[],rot:[],scale:[],timeOffset:ce});const Me=G[X];Me.pos.push(...re.getSortedTimesArray(!0,!1,!1)),Me.rot.push(...re.getSortedTimesArray(!1,!0,!1)),Me.scale.push(...re.getSortedTimesArray(!1,!1,!0))}}for(const L of G)L.pos.sort((U,z)=>U-z),L.rot.sort((U,z)=>U-z),L.scale.sort((U,z)=>U-z),L.pos=[...new Set(L.pos)],L.rot=[...new Set(L.rot)],L.scale=[...new Set(L.scale)];return G},c=function(I,O,k){const B=new Map,G=new Map,L=new Map,U=O.length;for(const z of k){const j=I.get(z);let X;j?console.assert(j.length===U,"We should have the same number of TransformData entries for each bone",j,O):X=new os(null,z,null);for(let re=0;re<U;re++){const ce=j?j[re]:X,Me=O[re];for(const{time:se,translation:ve}of ce.getValues(Me.pos,!0,!1,!1)){const Fe=(se+Me.timeOffset)*60;B.has(Fe)||B.set(Fe,new Array),B.get(Fe).push(ve.clone())}for(const{time:se,rotation:ve}of ce.getValues(Me.rot,!1,!0,!1)){const Fe=(se+Me.timeOffset)*60;G.has(Fe)||G.set(Fe,new Array),G.get(Fe).push(ve.clone())}for(const{time:se,scale:ve}of ce.getValues(Me.scale,!1,!1,!0)){const Fe=(se+Me.timeOffset)*60;L.has(Fe)||L.set(Fe,new Array),L.get(Fe).push(ve.clone())}}}return{position:B.size==0?void 0:B,quaternion:G.size==0?void 0:G,scale:L.size==0?void 0:L}},h=function(I){const O=[];for(const k of I)O.push(`(${Fs(k.x)}, ${Fs(k.y)}, ${Fs(k.z)})`);return O.join(", ")},u=function(I){const O=[];for(const k of I)O.push(`(${Fs(k.w)}, ${Fs(k.x)}, ${Fs(k.y)}, ${Fs(k.z)})`);return O.join(", ")},f=function(I){const O=new Map;if(mc){const k=new Array;for(const[B,G]of n)k.push(B.uuid+": "+G.length+" "+G.map(L=>{var U;return(U=L.clip)==null?void 0:U.uuid.substring(0,6)}).join(" "));console.log(`getPerBoneTransformData
`+k.join(`
`))}for(const k of I){const B=n.get(k);B&&O.set(k,B)}return O},p=function(I){const O=f(I),k=l(O);return c(O,k,I)};const m=i.skinnedMesh.skeleton,v=new Array,g=[],y=[];for(const I of m.bones)if(I.parent.type!=="Bone"){g.push(I);const O=m.boneInverses[m.bones.indexOf(I)];v.push({bone:I,inverse:O}),y.push(I.uuid)}for(;y.length<m.bones.length;)for(const I of g){const O=I.children;for(const k of O)if(y.indexOf(k.uuid)===-1&&m.bones.indexOf(k)!==-1){g.push(k);const B=m.boneInverses[m.bones.indexOf(k)];v.push({bone:k,inverse:B}),y.push(k.uuid)}}for(const I of d7(m.bones))v.push({bone:I,inverse:I.matrixWorld.clone().invert()});const A=v[0].bone.parent;A||console.error("No bone parent found for skinned mesh during USDZ export",i.skinnedMesh),v.sort((I,O)=>Hy(I.bone,A)>Hy(O.bone,A)?1:-1);const _=t.quickLookCompatible,b=[],x=[],E=[],M=[];for(const{bone:I}of v){if(_){const O=I.scale;O.x==0&&(O.x=1e-5),O.y==0&&(O.y=1e-5),O.z==0&&(O.z=1e-5),b.push(new le().compose(I.position,I.quaternion,I.scale))}else b.push(I.matrix.clone());x.push(I.position),E.push(I.quaternion),M.push(I.scale)}const T=v.map(I=>'"'+Hy(I.bone,A)+'"').join(", "),R=v.map(I=>by(I.inverse.clone().invert())).join(", ");e.beginBlock('def Skeleton "Rig"'),e.appendLine(`uniform matrix4d[] bindTransforms = [${R}]`),e.appendLine(`uniform token[] joints = [${T}]`),e.appendLine('uniform token purpose = "guide"'),e.appendLine(`uniform matrix4d[] restTransforms = [${b.map(I=>by(I)).join(", ")}]`),e.appendLine(`matrix4d xformOp:transform = ${by(new le)}`),e.appendLine('uniform token[] xformOpOrder = ["xformOp:transform"]');const w=p(v.map(I=>I.bone));if(mc){let I=1e7,O=0;for(const k of((r=w.position)==null?void 0:r.keys())??[])I=Math.min(I,k),O=Math.max(O,k);console.log("Time samples",I,O,w)}if(e.beginBlock('def SkelAnimation "_anim"'),e.appendLine(`uniform token[] joints = [${T}]`),e.appendLine(`quatf[] rotations = [${u(E)}]`),w&&w.quaternion){e.beginBlock("quatf[] rotations.timeSamples = {","");const I=a(w.quaternion);for(const O of I)e.appendLine(O);e.closeBlock()}if(e.appendLine(`half3[] scales = [${h(M)}]`),w&&w.scale){e.beginBlock("half3[] scales.timeSamples = {","");const I=o(w.scale);for(const O of I)e.appendLine(O);e.closeBlock()}if(e.appendLine(`float3[] translations = [${h(x)}]`),w&&w.position){e.beginBlock("float3[] translations.timeSamples = {","");const I=o(w.position);for(const O of I)e.appendLine(O);e.closeBlock()}e.closeBlock(),e.closeBlock()}}onSerialize(e,t){var h;if(!this.model)return;const i=this.dict.get(this.object);if(i)for(let u=0;u<i.length;u++)i[u]===void 0&&(i[u]=new os(null,this.object,null));this.skinnedMeshExport(e,t);const n=this.object,r=this.dict.get(n);if(!r||n.isSkinnedMesh)return;WD&&console.log("SERIALIZE",this.model.name,this.object.type,r);const o=new le;e.appendLine("matrix4d xformOp:transform.timeSamples = {"),e.indent++;const a=new Array;let l=0;for(let u=0;u<r.length;u++){if(a.push(l),r[u]===void 0){console.error("Got an undefined transform data, this is likely a bug.",n,r);continue}l+=r[u].getDuration()+os.animationDurationPadding}const c=Intl.NumberFormat("en-US",{maximumFractionDigits:3,minimumFractionDigits:0,useGrouping:!1});for(let u=0;u<r.length;u++){const f=r[u];if(!f)continue;const p=a[u];{const m=f.getSortedTimesArray();if(!m||m.length===0){console.error("got an animated object but no time values?",n,f);continue}{const v=((h=f.clip)==null?void 0:h.name)??"rest",g=f.getDuration();mc&&console.log("Write .timeSamples:",v,p,g,r),e.appendLine("# "+v+": start="+c.format(p*f.frameRate)+", length="+c.format(g*f.frameRate)+", frames="+f.getFrames())}for(const{time:v,translation:g,rotation:y,scale:A}of f.getValues(m)){o.compose(g,y,A);const b=`${c.format((p+v)*f.frameRate)}: ${by(o)},`;e.appendLine(b)}}}e.indent--,e.appendLine("}")}}const Fye=ie("debugpost");let jD=null;function Uye(s){jD=s}function B7(s){let e=s.gameObject;for(;e;){for(const t of $M(e))if(t.isPostProcessingManager===!0)return t;e=e.parent}return null}function Nye(s){let e=B7(s);if(!e)if(jD){Fye&&console.warn("Adding postprocessing manager to the scene.");const t=s.scene;e=va(t,jD)}else nt()&&console.warn("No post processing manager found");return e}var zye=Object.defineProperty,Gye=Object.getOwnPropertyDescriptor,D7=(s,e,t,i)=>{for(var n=i>1?void 0:i?Gye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&zye(e,t,n),n};const Hye=ie("debugpost");class Ze{constructor(e){d(this,"isVolumeParameter",!0);d(this,"_isInitialized",!1);d(this,"_active",!0);d(this,"_value");d(this,"_valueRaw");d(this,"_defaultValue");d(this,"valueProcessor");d(this,"onValueChanged");e!==void 0&&this.initialize(e)}get isInitialized(){return this._isInitialized}initialize(e){e!==void 0&&(this._value=e,this._defaultValue=e,this._valueRaw=e,this._isInitialized=!0)}get overrideState(){return this._active}set overrideState(e){if(this._active===e)return;this._active=e;const t=e?this._valueRaw:this._defaultValue;this.processValue(t,!0)}get value(){return this._valueRaw}set value(e){this.isInitialized||this.initialize(e),this.processValue(e,!1)}set defaultValue(e){this._defaultValue=e}__init(){this.processValue(this._valueRaw,!0)}processValue(e,t){if(e==null||!t&&this.testIfValueChanged(e)===!1)return;const i=this._value;Hye&&typeof i=="number"&&typeof e=="number"&&(i==null||i.toFixed(4),e==null||e.toFixed(4)),!this._active&&this._defaultValue!==void 0?(this._value=this._defaultValue,e=this._defaultValue,this._valueRaw=e):(this._valueRaw=e,this._active&&this.valueProcessor&&(e=this.valueProcessor(e)),this._value=e),this.onValueChanged&&this.onValueChanged(e,i,this)}testIfValueChanged(e){return this._valueRaw!==e}}D7([C()],Ze.prototype,"overrideState",1);D7([C()],Ze.prototype,"value",1);class Vye extends hl{constructor(){super([Ze])}onSerialize(e,t){}onDeserialize(e,t){const i=t.target,n=t.path;let r;if(i&&n&&(r=i[n]),(typeof r!="object"||typeof r=="object"&&r.isVolumeParameter!==!0)&&(r=new Ze),typeof e=="object"&&"value"in e){const o=e.value;r.initialize(o),r.overrideState=e.overrideState}else r.value=e;return r}}new Vye;var Qye=Object.defineProperty,Wye=Object.getOwnPropertyDescriptor,jye=(s,e,t,i)=>{for(var n=i>1?void 0:i?Wye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Qye(e,t,n),n};const qye=ie("debugpost");class Sr extends Ie{constructor(t=void 0){super();d(this,"active",!0);d(this,"_manager",null);d(this,"_result");d(this,"_postprocessingContext",null);if(t)for(const i of Object.keys(t)){const n=t[i],r=this[i];r instanceof Ze?r.initialize(n):r!==void 0&&(this[i]=n)}}get isPostProcessingEffect(){return!0}onEnable(){this.onEffectEnabled(),this.__internalDidAwakeAndStart&&(this.active=!0)}onDisable(){var t;(t=this._manager)==null||t.removeEffect(this),this.active=!1}onEffectEnabled(t){var i;t&&t.isPostProcessingManager===!0?this._manager=t:this._manager||(this._manager=Nye(this)),(i=this._manager)==null||i.addEffect(this)}init(){}get postprocessingContext(){return this._postprocessingContext}apply(t){var i;return this._postprocessingContext=t,this._result||(this.initParameters(),this._result=(i=this.onCreateEffect)==null?void 0:i.call(this)),this._result&&this.initParameters(),this._result}unapply(){}dispose(){qye&&console.warn("DISPOSE",this),this._result&&(Array.isArray(this._result)?this._result.forEach(t=>t.dispose()):this._result.dispose()),this._result=void 0}initParameters(){const t=Object.keys(this);for(const i of t){const n=this[i];n instanceof Ze&&n.__init()}}onEditorModification(t){const i=t.propertyName;if(this[i]instanceof Ze){const n=t.value;return this[i].value=n,!0}}}jye([C()],Sr.prototype,"active",2);var Xye=Object.defineProperty,Yye=Object.getOwnPropertyDescriptor,Kye=(s,e,t,i)=>{for(var n=i>1?void 0:i?Yye(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Xye(e,t,n),n};const Jye=ie("debugpost"),qD={};function dl(s,e){qD[s]=e}function Zye(s){return s.__type in qD?qD[s.__type]:(Jye&&s.__type&&console.warn("Unknown postprocessing type",s.__type,s),Sr)}class hx{constructor(){d(this,"components",[])}init(){var e;(e=this.components)==null||e.forEach(t=>t.init())}addEffect(e){this.components.push(e)}removeEffect(e){const t=this.components.indexOf(e);t>=0&&this.components.splice(t,1)}}Kye([Dv([s=>Zye(s),Sr])],hx.prototype,"components",2);var $ye=Object.defineProperty,eve=Object.getOwnPropertyDescriptor,tve=(s,e,t,i)=>{for(var n=i>1?void 0:i?eve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&$ye(e,t,n),n};class ux extends Sr{constructor(){super(...arguments);d(this,"preset",new Ze(pp.HIGH))}get typeName(){return"Antialiasing"}onCreateEffect(){const t=new $Q({preset:pp.HIGH,edgeDetectionMode:hk.DEPTH});return this.preset.onValueChanged=i=>{t.applyPreset(i)},t}}tve([C(Ze)],ux.prototype,"preset",2);dl("Antialiasing",ux);const ive=ie("debugusdz");class cf{constructor(){d(this,"files",new Array)}static getName(e){var r;const t=e.split(".").pop();let n=(r=e.split(".").slice(0,-1).join(".").split("/").pop())==null?void 0:r.replace(".","_");return n||(n="Audio_"+Math.random().toString(36).substring(2,15)),Wl(n)+"."+t}get extensionName(){return"Audio"}onExportObject(e,t,i){const n=ne.getComponents(e,Hn);if(n.length)for(const r of n){if(!r.clip||typeof r.clip!="string"||!r.playOnAwake)continue;const o=r.clip.split("/").pop()||"Audio",a=cf.getName(r.clip),l=Wl(a);if(!this.files.some(c=>c.path===r.clip)){this.files.push({path:r.clip,name:a});const c=a.toLowerCase();i.quickLookCompatible&&!c.endsWith(".mp3")&&!c.endsWith(".wav")&&!c.endsWith(".m4a")&&console.error("Audio file "+r.clip+" from "+r.name+" is not an MP3 or WAV file. QuickLook may not support playing it.")}i.quickLookCompatible||t.addEventListener("serialize",(c,h)=>{c.appendLine(),c.beginBlock(`def SpatialAudio "${l}"`,"(",!1),c.appendLine(`displayName = "${o}"`),c.closeBlock(")"),c.beginBlock(),c.appendLine(`uniform asset filePath = @audio/${a}@`),c.appendLine(`uniform token auralMode = "${r.spatialBlend>0?"spatial":"nonSpatial"}"`),c.appendLine(`uniform token playbackMode = "${r.loop?"loopFromStage":"onceFromStart"}"`),c.appendLine(`uniform float gain = ${r.volume}`),c.closeBlock()})}}async onAfterSerialize(e){for(const t of this.files){const i="audio/"+t.name;if(e.files[i]){ive&&console.warn("Audio file with name "+i+" already exists in the context. Skipping.");continue}const o=await(await(await fetch(t.path)).blob()).arrayBuffer(),a=new Uint8Array(o);e.files[i]=a}}}const Ep=ie("debugautosync"),EP=Symbol("syncerId");class nve{constructor(){d(this,"_syncers",{})}getOrCreateSyncer(e){if(!e.guid)return null;if(this._syncers[e.guid])return this._syncers[e.guid];const t=new sve(e);return t[EP]=e.guid,this._syncers[t[EP]]=t,t}removeSyncer(e){delete this._syncers[e[EP]]}}const pF=new nve;class sve{constructor(e){d(this,"comp");d(this,"hasChanges",!1);d(this,"changedProperties",{});d(this,"data",{});d(this,"_isReceiving",!1);d(this,"_isInit",!1);d(this,"onHandleSending",()=>{if(!this.hasChanges)return;this.hasChanges=!1;const e=this.comp.context.connection;if(!e||!e.isConnected||!e.isInRoom){for(const t in this.changedProperties)delete this.changedProperties[t];return}for(const t in this.data)delete this.data[t];this.data.guid=this.comp.guid;for(const t in this.changedProperties){const i=this.changedProperties[t];delete this.changedProperties[t],this.data[t]=i}e.send(this.networkingKey,this.data,Bl.Queued)});d(this,"onHandleReceiving",e=>{if(Ep&&console.log("RECEIVE",this.comp.name,this.comp.guid,e),!this._isInit||!this.comp)return;const t=e.guid;if(!(t&&t!==this.comp.guid)){Ep&&console.log("RECEIVED",this.comp.name,this.comp.guid,e);try{this._isReceiving=!0;for(const i in e){if(i==="guid")continue;const n=e[i];this.comp[i]=n,Ep&&console.log("SET",i,n)}}catch(i){console.error(i)}finally{this._isReceiving=!1}}});this.comp=e}get networkingKey(){return this.comp.guid}init(e){if(this._isInit)return;this._isInit=!0,this.comp=e,this.comp.context.post_render_callbacks.push(this.onHandleSending),this.comp.context.connection.beginListen(this.networkingKey,this.onHandleReceiving);const t=this.comp.context.connection.tryGetState(this.comp.guid);t&&this.onHandleReceiving(t)}destroy(){this._isInit&&(this.comp.context.post_render_callbacks.splice(this.comp.context.post_render_callbacks.indexOf(this.onHandleSending),1),this.comp.context.connection.stopListen(this.networkingKey,this.onHandleReceiving),this.comp=null,this._isInit=!1)}notifyChanged(e,t){this._isReceiving||(Ep&&console.log("Property changed: "+e,t),this.hasChanges=!0,this.changedProperties[e]=t)}}function rve(s,e){let t=e!==s;return!t&&s&&e&&(Array.isArray(s)&&Array.isArray(e)||typeof s=="object"&&typeof e=="object")&&(t=!0),t}const c_=Symbol("AutoSyncHandler");function ove(s){if(s[c_])return s[c_];const e=pF.getOrCreateSyncer(s);return e==null||e.init(s),s[c_]=e,e}function ave(s){const e=s[c_];e&&(pF.removeSyncer(e),e.destroy(),delete s[c_])}const mF=function(s){return function(e,t){var h;let i="";typeof t=="string"?i=t:i=t.name;let n=null,r;typeof s=="string"?r=e[s]:typeof s=="function"&&(r=s);const o=e,a=o.__internalAwake;if(typeof a!="function"){(Ep||nt())&&console.error('@syncField can currently only used on Needle Engine Components, custom object of type "'+((h=e==null?void 0:e.constructor)==null?void 0:h.name)+'" is not supported',e);return}Ep&&console.log(i);const l=Symbol(i);o.__internalAwake=function(){if(this[l]!==void 0)return;this[l]=this[i],n=pF.getOrCreateSyncer(this);const u=Object.getOwnPropertyDescriptor(this,i);if((u==null?void 0:u.set)===void 0){let f=!1;Object.defineProperty(this,i,{set:function(p){var v;const m=this[l];if(this[l]=p,f){nt()&&console.warn("Recursive call detected",i);return}f=!0;try{const g=rve(p,m);Ep&&console.log("SyncField assignment",i,"changed?",g,p),g&&(r==null?void 0:r.call(this,p,m))!==!1&&((v=ove(this))==null||v.notifyChanged(i,p))}finally{f=!1}},get:function(){return this[l]},configurable:!0,enumerable:!0})}n==null||n.init(this),a.call(this)};const c=o.__internalDestroy;o.__internalDestroy=function(){ave(this),c.call(this)}}};var lve=Object.defineProperty,cve=Object.getOwnPropertyDescriptor,mT=(s,e,t,i)=>{for(var n=i>1?void 0:i?cve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&lve(e,t,n),n};const na=ie("debugplayersync"),O7=class extends Ie{constructor(){super(...arguments);d(this,"autoSync",!0);d(this,"asset");d(this,"onPlayerSpawned");d(this,"_localInstance");d(this,"onJoinedRoom",()=>{na&&console.log("PlayerSync.joinedRoom. autoSync is set to "+this.autoSync),this.autoSync&&this.getInstance()});d(this,"destroyInstance",()=>{var e;(e=this._localInstance)==null||e.then(t=>{na&&console.log("PlayerSync.destroyInstance",t),Kb(t,this.context.connection,!0,{saveInRoom:!1})}),this._localInstance=void 0})}static async setupFrom(e,t){const i=ei.getOrCreateFromUrl(e);if(!i.asset){const o=await i.loadAssetAsync();ne.getOrAddComponent(o,ha)}const n=new O7;n._internalInit(t),n.asset=i;const r=new ye;return r.guid=e,ne.addComponent(r,n),n}awake(){this.watchTabVisible(),this.onPlayerSpawned||(this.onPlayerSpawned=new Sn)}onEnable(){this.context.connection.beginListen(Qt.RoomStateSent,this.onJoinedRoom),this.context.connection.beginListen(Qt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Qt.LeftRoom,this.destroyInstance),this.context.connection.isInRoom&&this.onJoinedRoom()}onDisable(){this.context.connection.stopListen(Qt.RoomStateSent,this.onJoinedRoom),this.context.connection.stopListen(Qt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Qt.LeftRoom,this.destroyInstance)}async getInstance(){var t,i,n,r,o,a;if(this._localInstance)return this._localInstance;if(na&&console.log("PlayerSync.createInstance",(t=this.asset)==null?void 0:t.uri),!((i=this.asset)!=null&&i.asset)&&!((n=this.asset)!=null&&n.uri))return console.error('PlayerSync: can not create an instance because "asset" is not set and or has no URL!'),null;this.gameObject.guid||console.warn("PlayerSync: gameObject has no guid! This might cause issues with syncing the player state."),this._localInstance=(r=this.asset)==null?void 0:r.instantiateSynced({parent:this.gameObject,deleteOnDisconnect:!0},!0);const e=await this._localInstance;if(e){const l=ne.getComponentsInChildren(e,ha);if(l!=null&&l.length){for(const c of l)c.owner=this.context.connection.connectionId;(o=this.onPlayerSpawned)==null||o.invoke(e)}else this._localInstance=void 0,console.error("<strong>Failed finding PlayerState on "+((a=this.asset)==null?void 0:a.uri)+"</strong>: please make sure the asset has a PlayerState component!"),ne.destroySynced(e)}else this._localInstance=void 0,console.warn("PlayerSync: failed instantiating asset!");return this._localInstance}watchTabVisible(){window.addEventListener("visibilitychange",e=>{if(document.visibilityState==="visible")for(let t=ha.all.length-1;t>=0;t--){const i=ha.all[t];(!i.owner||!this.context.connection.userIsInRoom(i.owner))&&i.doDestroy()}})}};let Fv=O7;mT([C()],Fv.prototype,"autoSync",2);mT([C(ei)],Fv.prototype,"asset",2);mT([C(Sn)],Fv.prototype,"onPlayerSpawned",2);var L7=(s=>(s.OwnerChanged="ownerChanged",s))(L7||{}),dA;const rr=(dA=class extends Ie{constructor(){super(...arguments);d(this,"onOwnerChangeEvent",new Sn);d(this,"onFirstOwnerChangeEvent",new Sn);d(this,"hasOwner",!1);d(this,"owner");d(this,"dontDestroy",!1);d(this,"onUserLeftRoom",e=>{if(e.userId===this.owner){na&&console.log("PLAYERSYNC LEFT",this.owner),this.doDestroy();return}})}static get all(){return rr._all}static get local(){return rr._local}static getFor(e){if(e instanceof ye)return ne.getComponentInParent(e,rr);if(e instanceof Ie)return ne.getComponentInParent(e.gameObject,rr)}static isLocalPlayer(e){const t=rr.getFor(e);return(t==null?void 0:t.isLocalPlayer)??!1}static addEventListener(e,t){return this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),t}static removeEventListener(e,t){if(!this._callbacks[e])return;const i=this._callbacks[e].indexOf(t);i>=0&&this._callbacks[e].splice(i,1)}static dispatchEvent(e,t){if(this._callbacks[e])for(const i of this._callbacks[e])i(t)}get isLocalPlayer(){return this.owner===this.context.connection.connectionId}onOwnerChange(e,t){var o,a;na&&console.log("PlayerSync.onOwnerChange",this,"newOwner",e,"oldOwner",t);const i=rr._local.indexOf(this);i>=0&&rr._local.splice(i,1);const n={playerState:this,oldValue:t,newValue:e};if(this.hasOwner||(this.hasOwner=!0,(o=this.onFirstOwnerChangeEvent)==null||o.invoke(n)),(a=this.onOwnerChangeEvent)==null||a.invoke(n),this.owner===this.context.connection.connectionId){rr._local.push(this);const l=new CustomEvent("local-owner-changed",{detail:n});this.dispatchEvent(l)}const r=new CustomEvent("owner-changed",{detail:n});this.dispatchEvent(r),rr.dispatchEvent("ownerChanged",r)}awake(){rr.all.push(this),na&&console.log("Registered new PlayerState",this.guid,rr.all.length-1,rr.all),this.context.connection.beginListen(Qt.UserLeftRoom,this.onUserLeftRoom)}async start(){na&&console.log("PLAYERSTATE.START, owner: "+this.owner,this.context.connection.usersInRoom([])),this.owner?(this.context.connection.isInRoom||await Nc(300),this.context.connection.userIsInRoom(this.owner)==!1&&(na&&console.log(`PlayerSync.start  doDestroy "${this.name}" because user "${this.owner}" is not in room anymore...`,"Currently in room:",...this.context.connection.usersInRoom()),this.doDestroy())):this.owner||(na&&console.warn("PlayerState.start  owner is undefined!",this.name),setTimeout(()=>{!this.destroyed&&!this.owner?this.dontDestroy?na&&console.warn("PlayerState.start  owner is still undefined but dontDestroy is set to true",this.name):(na&&console.warn(`PlayerState.start  owner is still undefined: destroying "${this.name}" instance now`),this.doDestroy()):na&&console.log("PlayerState.start  owner is assigned",this.owner)},2e3))}doDestroy(){na&&console.log("PlayerSync.doDestroy  syncDestroy",this.name),Kb(this.gameObject,this.context.connection,!0,{saveInRoom:!1})}onDestroy(){if(this.context.connection.stopListen(Qt.UserLeftRoom,this.onUserLeftRoom),rr.all.splice(rr.all.indexOf(this),1),this.isLocalPlayer){const e=rr._local.indexOf(this);e>=0&&rr._local.splice(e,1)}}},d(dA,"_all",[]),d(dA,"_local",[]),d(dA,"_callbacks",{}),dA);let ha=rr;mT([mF(ha.prototype.onOwnerChange)],ha.prototype,"owner",2);const hve=ie("debugavatar"),Pl=class extends Ie{constructor(){super(...arguments);d(this,"connectionId");d(this,"avatar")}static getAvatar(t){return t>=0&&t<Pl.instances.length?Pl.instances[t]:null}static onAvatarMarkerCreated(t){return Pl._onNewAvatarMarkerAdded.push(t),t}static onAvatarMarkerDestroyed(t){return Pl._onAvatarMarkerDestroyed.push(t),t}awake(){Pl.instances.push(this),hve&&console.log(this);for(const t of Pl._onNewAvatarMarkerAdded)t({avatarMarker:this,gameObject:this.gameObject})}onDestroy(){Pl.instances.splice(Pl.instances.indexOf(this),1);for(const t of Pl._onAvatarMarkerDestroyed)t({avatarMarker:this,gameObject:this.gameObject})}isLocalAvatar(){return this.connectionId===this.context.connection.connectionId}};let Ss=Pl;d(Ss,"instances",[]),d(Ss,"_onNewAvatarMarkerAdded",[]),d(Ss,"_onAvatarMarkerDestroyed",[]);var uve=Object.defineProperty,dve=Object.getOwnPropertyDescriptor,fve=(s,e,t,i)=>{for(var n=i>1?void 0:i?dve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&uve(e,t,n),n};const ry=ie("debugxrflags"),k7=ie("disablexrflags");k7&&console.warn("XRFlags are disabled");var bc=(s=>(s[s.Never=0]="Never",s[s.Browser=1]="Browser",s[s.AR=2]="AR",s[s.VR=4]="VR",s[s.FirstPerson=8]="FirstPerson",s[s.ThirdPerson=16]="ThirdPerson",s[s.All=4294967295]="All",s))(bc||{});const UU=class{constructor(){d(this,"Mask",17)}Has(e){return(this.Mask&e)!==0}Set(e){ry&&console.warn("Set XR flag state to",e),this.Mask=e,ra.Apply()}Enable(e){this.Mask|=e,ra.Apply()}Disable(e){this.Mask&=~e,ra.Apply()}Toggle(e){this.Mask^=e,ra.Apply()}EnableAll(){this.Mask=-1,ra.Apply()}DisableAll(){this.Mask=0,ra.Apply()}};let fr=UU;d(fr,"Global",new UU);var fA;const Eh=(fA=class extends Ie{constructor(){super(...arguments);d(this,"visibleIn")}static Apply(){for(const e of this.registry)e.UpdateVisible(fr.Global)}awake(){Eh.registry.push(this)}onEnable(){Eh.firstApply?this.UpdateVisible(fr.Global):(Eh.firstApply=!0,Eh.Apply())}onDestroy(){const e=Eh.registry.indexOf(this);e>=0&&Eh.registry.splice(e,1)}get isOn(){return this.gameObject.visible}UpdateVisible(e=null){if(k7)return;let t;const i=e;if(i&&typeof i=="number"&&(console.assert(typeof i=="number","XRFlag.UpdateVisible: state must be a number",i),ry&&console.log(i),Eh.buffer.Mask=i,e=Eh.buffer),e instanceof fr?(ry&&console.warn(this.name,"use passed in mask",e.Mask,this.visibleIn),t=e.Has(this.visibleIn)):(ry&&console.log(this.name,"use global mask"),fr.Global.Has(this.visibleIn)),t!==void 0)if(t)ry&&console.log(this.name,"is visible",this.gameObject.uuid),ne.setActive(this.gameObject,!0);else{if(ry&&console.log(this.name,"is not visible",this.gameObject.uuid),!this.gameObject.visible)return;this.gameObject.visible=!1}}},d(fA,"registry",[]),d(fA,"firstApply"),d(fA,"buffer",new fr),fA);let ra=Eh;fve([C()],ra.prototype,"visibleIn",2);var pve=Object.defineProperty,mve=Object.getOwnPropertyDescriptor,gF=(s,e,t,i)=>{for(var n=i>1?void 0:i?mve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&pve(e,t,n),n};const j0=ie("debugwebxr"),lH=new Ce().setFromAxisAngle(new S(0,1,0),Math.PI);class qd extends Ie{constructor(){super(...arguments);d(this,"head");d(this,"leftHand");d(this,"rightHand");d(this,"_leftHandMeshes");d(this,"_rightHandMeshes");d(this,"_syncTransforms")}async onEnterXR(t){if(!this.activeAndEnabled)return;j0&&console.warn("AVATAR ENTER XR",this.guid,this.sourceId,this,this.activeAndEnabled),this._syncTransforms&&(this._syncTransforms.length=0),await this.prepareAvatar();const i=ha.getFor(this);if(i!=null&&i.owner){const n=this.gameObject.addComponent(Ss);n.avatar=this.gameObject,n.connectionId=i.owner}else this.context.connection.isConnected?console.error("No player state found for avatar",this):i&&!this.context.connection.isConnected&&(i.dontDestroy=!0)}onLeaveXR(t){const i=this.gameObject.getComponent(Ss);i&&i.destroy()}onUpdateXR(t){var c,h;if(!this.activeAndEnabled)return;const i=ha.isLocalPlayer(this);if(!i)return;const n=t.xr;if(n.rig&&n.rig.gameObject!==this.gameObject.parent&&(this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),this.gameObject.scale.set(1,1,1),n.rig.gameObject.add(this.gameObject)),this._syncTransforms&&i)for(const u of this._syncTransforms)u.fastMode=!0,u.isOwned()||u.requestOwnership();if(this.head&&this.context.mainCamera){const u=this.head.asset;if(u.position.copy(this.context.mainCamera.position),u.position.x*=-1,u.position.z*=-1,u.quaternion.copy(this.context.mainCamera.quaternion),u.quaternion.x*=-1,this.context.time.frameCount%10===0){const f=ne.getComponentsInChildren(this.head.asset,ra);for(const p of f)p.enabled=!1,p.gameObject.visible=!1}}const r=t.xr.leftController,o=(c=this.leftHand)==null?void 0:c.asset;r&&o?(o.position.copy(r.gripPosition),o.quaternion.copy(r.gripQuaternion),o.quaternion.multiply(lH),o.visible=r.isTracking,this.updateHandVisibility(r,o,this._leftHandMeshes)):o&&o.visible&&(o.visible=!1);const a=t.xr.rightController,l=(h=this.rightHand)==null?void 0:h.asset;a&&l?(l.position.copy(a.gripPosition),l.quaternion.copy(a.gripQuaternion),l.quaternion.multiply(lH),l.visible=a.isTracking,this.updateHandVisibility(a,l,this._rightHandMeshes)):l&&l.visible&&(l.visible=!1)}onBeforeRender(){this.context.xr&&this.context.time.frame%10===0&&this.updateRemoteAvatarVisibility()}updateHandVisibility(t,i,n){if(n){const r=t.model&&t.model.visible&&t.model!==i;n.forEach(o=>{fd(o,!r)})}}updateRemoteAvatarVisibility(){var t,i,n;if(this.context.connection.isConnected){const r=ha.getFor(this);if(r&&r.isLocalPlayer==!1){const o=Mt.getXRSync(this.context);if(o&&o.hasState(r.owner)){this.tryFindAvatarObjectsIfMissing();const a=(t=this.leftHand)==null?void 0:t.asset;a&&(a.visible=(o==null?void 0:o.isTracking(r.owner,"left"))??!1);const l=(i=this.rightHand)==null?void 0:i.asset;l&&(l.visible=(o==null?void 0:o.isTracking(r.owner,"right"))??!1)}if((n=this.head)!=null&&n.asset){const a=ne.getComponentsInChildren(this.head.asset,ra);for(const l of a)l.enabled=!1,l.gameObject.visible=!0}}}}tryFindAvatarObjectsIfMissing(){if(!this.head||!this.leftHand||!this.rightHand){const t={head:this.head,leftHand:this.leftHand,rightHand:this.rightHand};Wj.tryFindAvatarObjects(this.gameObject,this.sourceId||"",t),t.head&&(this.head=t.head),t.leftHand&&(this.leftHand=t.leftHand),t.rightHand&&(this.rightHand=t.rightHand)}}async prepareAvatar(){if(this.tryFindAvatarObjectsIfMissing(),this.head)this.head instanceof ye&&(this.head=new ei("",this.sourceId,this.head));else{const t=new ye;t.name="Head";const i=Iv.createPrimitive(om.Cube);t.add(i),this.gameObject.add(t),this.head=new ei("",this.sourceId,t),j0&&console.log("Create head",t)}if(this.rightHand)this.rightHand instanceof ye&&(this.rightHand=new ei("",this.sourceId,this.rightHand));else{const t=new ye;t.name="Right Hand",this.gameObject.add(t),this.rightHand=new ei("",this.sourceId,t),j0&&console.log("Create right hand",t)}if(this.leftHand)this.leftHand instanceof ye&&(this.leftHand=new ei("",this.sourceId,this.leftHand));else{const t=new ye;t.name="Left Hand",this.gameObject.add(t),this.leftHand=new ei("",this.sourceId,t),j0&&console.log("Create left hand",t)}await this.loadAvatarObjects(this.head,this.leftHand,this.rightHand),this._leftHandMeshes=[],this.leftHand.asset.traverse(t=>{t!=null&&t.isMesh&&this._leftHandMeshes.push(t)}),this._rightHandMeshes=[],this.rightHand.asset.traverse(t=>{t!=null&&t.isMesh&&this._rightHandMeshes.push(t)}),ha.isLocalPlayer(this.gameObject)&&(this._syncTransforms=ne.getComponentsInChildren(this.gameObject,Gc))}async loadAvatarObjects(t,i,n){const r=t.loadAssetAsync(),o=i.loadAssetAsync(),a=n.loadAssetAsync(),l=new Array;r&&l.push(r),o&&l.push(o),a&&l.push(a);const c=await TM(l);j0&&console.log("Avatar loaded results:",c)}}gF([C(ei)],qd.prototype,"head",2);gF([C(ei)],qd.prototype,"leftHand",2);gF([C(ei)],qd.prototype,"rightHand",2);class Lc{static Add(e,t,i=null){if(t){for(const n of this.Pois)if(n.obj===t)return;this.Pois.push({obj:t,avatar:i}),this.LastChangeTime=e.time.time}}static Remove(e,t){var i;if(t){for(const n of this.Pois)if(n.obj===t){this.Pois.splice(this.Pois.indexOf(n),1),this.LastChangeTime=(e==null?void 0:e.time.time)??((i=Dt.Current)==null?void 0:i.time.time);return}}}}d(Lc,"Pois",[]),d(Lc,"LastChangeTime",0);class gve{constructor(){d(this,"guid");d(this,"position",new S)}}class sb extends Ie{constructor(){super(...arguments);d(this,"target",null);d(this,"avatar",null);d(this,"_model",null);d(this,"_targetModel",new gve);d(this,"_currentTargetObject",null);d(this,"_lastUpdateTime",0);d(this,"_lookDuration",0);d(this,"_lastPoiChangedTime",0)}set controlledTarget(t){this.target=t;const i=J.get("MoveRandom");if(i&&this.target){const n=ne.getComponent(this.target,i);n&&n.destroy()}}awake(){if(this.avatar=ne.getComponentInParent(this.gameObject,Ss),this.avatar){const t=ne.getComponentInParent(this.gameObject,Ss);this._model=new kk(this.context.connection,this.guid),t!=null&&t.isLocalAvatar&&this._model.requestOwnership()}this.context.connection.beginListen("avatar-look-target-changed",t=>{var i;this.target&&t&&t.guid===((i=this.avatar)==null?void 0:i.guid)&&Es(this.target,t.position)})}update(){var i;if((!this.context.connection.isConnected||(i=this._model)!=null&&i.hasOwnership)&&(Lc.LastChangeTime!==this._lastPoiChangedTime&&(this._lastPoiChangedTime=Lc.LastChangeTime,this._lookDuration=0),this.selectTarget(),this._currentTargetObject&&this.context.time.frameCount%10===0&&this.target)){const n=Ft(this._currentTargetObject);Es(this.target,n),this.context.connection.isConnected&&this.avatar&&(this.context.connection.send("avatar-look-target-changed",this._targetModel),this._targetModel.guid=this.avatar.guid,this._targetModel.position.copy(n))}}selectTarget(){if(this.context.time.time-this._lastUpdateTime>this._lookDuration){this._lastUpdateTime=this.context.time.time,this._lookDuration=Math.random()*.5+.2;const i=Lc.Pois;if(i.length>0){const n=i[Math.floor(Math.random()*i.length)];if(n&&n.obj){if(n.avatar&&n.avatar===this.avatar)return;this._currentTargetObject=n.obj}}}}}const qn=ie("debugnetworkingstreams");var Ic=(s=>(s.Connected="peer-user-connected",s.StreamReceived="receive-stream",s.StreamEnded="call-ended",s.Disconnected="peer-user-disconnected",s.UserJoined="user-joined",s))(Ic||{});class yF{constructor(e,t){d(this,"type","call-ended");d(this,"userId");d(this,"direction");this.userId=e,this.direction=t}}class F7{constructor(e,t,i){d(this,"type","receive-stream");d(this,"userId");d(this,"stream");d(this,"target");this.userId=e,this.stream=t,this.target=i}}class yve{constructor(e,t){d(this,"guid");d(this,"peerId");d(this,"dontSave",!0);this.guid=e.id,this.peerId=t}}var U7=(s=>(s.Incoming="incoming",s.Outgoing="outgoing",s))(U7||{});class vve extends js{constructor(t,i,n,r=null){super();d(this,"peerId");d(this,"userId");d(this,"direction");d(this,"call");d(this,"_stream",null);d(this,"_isDisposed",!1);this.peerId=i.peer,this.userId=t,this.call=i,this.direction=n,this._stream=r,i.on("stream",o=>{if(qn&&console.log("Receive stream",`
Audio:`,o.getAudioTracks(),`
Video:`,o.getVideoTracks()),this._stream=o,n==="incoming"){const a=new F7(t,o,this);this.dispatchEvent(a)}}),i.on("close",()=>{this.dispatchEvent(new yF(t,n))})}get stream(){return this._stream}close(){this._isDisposed||(this._isDisposed=!0,this.call.close(),Rc(this._stream))}get isOpen(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connected"}get isOpening(){var t;return((t=this.call.peerConnection)==null?void 0:t.connectionState)==="connecting"}get isClosed(){return!this.isOpen||this._isDisposed}}function cH(s){return s=s.replace("a=fmtp:111 minptime=10;useinbandfec=1","a=fmtp:111 ptime=5;useinbandfec=1;stereo=1;maxplaybackrate=48000;maxaveragebitrat=128000;sprop-stereo=1"),s}const Iy=class extends js{constructor(t,i){super();d(this,"updateCalls",()=>{var t;for(let i=this._incomingCalls.length-1;i>=0;i--){const n=this._incomingCalls[i];n.isClosed&&!n.isOpening&&this._incomingCalls.splice(i,1)}for(let i=this._outgoingCalls.length-1;i>=0;i--){const n=this._outgoingCalls[i];let r=!1;n.isClosed&&!n.isOpening&&((t=n.stream)!=null&&t.active?qn&&console.warn("!!! Stream is still active, don't remove call",n.userId,"Your id: "+this.context.connection.connectionId):(qn&&console.warn("!!! Remove closed call",n.userId),r=!0)),this.context.connection.userIsInRoom(n.userId)===!1&&(qn&&console.warn("!!! User is not in room anymore, remove call",n.userId),r=!0),r&&(n.close(),this._outgoingCalls.splice(i,1))}});d(this,"id");d(this,"context");d(this,"_incomingCalls",[]);d(this,"_outgoingCalls",[]);d(this,"_peer");d(this,"_enabled",!1);d(this,"_enabledPeer",!1);d(this,"onConnectRoomFn",this.onConnectRoom.bind(this));d(this,"onPeerConnect",t=>{if(qn&&console.log("PEER opened as",t),t===null){console.error("Peer connection failed",t);return}this.context.connection.send("peer-user-connected",new yve(this,t))});d(this,"onPeerClose",()=>{qn&&console.log("PEER closed"),this.updateCalls()});d(this,"onPeerDisconnected",()=>{qn&&console.log("PEER disconnected"),this.updateCalls()});d(this,"onPeerError",t=>{qn&&console.error("PEER error",t)});d(this,"onPeerReceivingCall",t=>{t.answer(void 0,{sdpTransform:i=>cH(i)}),this.registerCall(t,"incoming",null)});this.context=t,this.id=i,this.setupPeer(),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}static getOrCreate(t,i){if(Iy.instances.has(i))return Iy.instances.get(i);const n=new Iy(t,i);return Iy.instances.set(i,n),n}getMyPeerId(){if(this.context.connection.connectionId)return this.getPeerIdFromUserId(this.context.connection.connectionId)}getPeerIdFromUserId(t){return this.id+"-"+t}getUserIdFromPeerId(t){return t.substring(this.id.length+1)}makeCall(t,i){var o;if(!(i!=null&&i.id)){qn?console.warn("Can not make a call: mediastream has no id or is undefined"):console.debug("Can not make a call: mediastream has no id or is undefined");return}const n={metadata:{userId:this.context.connection.connectionId,streamId:i.id},sdpTransform:a=>cH(a)},r=(o=this._peer)==null?void 0:o.call(t,i,n);if(r){const a=this.registerCall(r,"outgoing",i);return qn&&console.warn(` CALL ${t}`,`
Outgoing:`,this._outgoingCalls,`
Incoming:`,this._incomingCalls),a}else qn&&console.error("Failed to make call",t,i,this._peer)}closeAll(){for(const t of this._incomingCalls)t.close();for(const t of this._outgoingCalls)t.close();this.updateCalls()}get peer(){return this._peer}get incomingCalls(){return this._incomingCalls}enable(){this._enabled||(this._enabled=!0,this.context.connection.beginListen(Qt.JoinedRoom,this.onConnectRoomFn),this.subscribePeerEvents())}disable(){this._enabled&&(this._enabled=!1,this.context.connection.stopListen(Qt.JoinedRoom,this.onConnectRoomFn),this.unsubscribePeerEvents())}onConnectRoom(){this.setupPeer()}setupPeer(){if(this.context.connection.connectionId&&!this._enabledPeer){if(this._enabledPeer=!0,!this._peer){const t=this.getMyPeerId();t?this._peer=Fj(t):console.error("Failed to setup peerjs because we dont have a connection id",this.context.connection.connectionId)}this._enabled&&this.subscribePeerEvents()}}subscribePeerEvents(){this._peer&&(this._peer.on("open",this.onPeerConnect),this._peer.on("close",this.onPeerClose),this._peer.on("call",this.onPeerReceivingCall),this._peer.on("disconnected",this.onPeerDisconnected),this._peer.on("error",this.onPeerError))}unsubscribePeerEvents(){this._peer&&(this._peer.off("open",this.onPeerConnect),this._peer.off("close",this.onPeerClose),this._peer.off("call",this.onPeerReceivingCall),this._peer.off("disconnected",this.onPeerDisconnected),this._peer.off("error",this.onPeerError))}registerCall(t,i,n){const r=t.metadata;(!r||!r.userId)&&console.error("Missing call metadata",t);const o=r.userId;i==="incoming"&&qn?console.warn(" Receive call from",t.metadata,t.connectionId):qn&&console.warn(" Make call to",t.metadata);const a=i==="incoming"?this._incomingCalls:this._outgoingCalls,l=new vve(o,t,i,n);return a.push(l),t.on("error",c=>{console.error("Call error",c)}),t.on("close",()=>{qn&&console.log("Call ended",t.metadata);const c=a.indexOf(l);c!==-1&&a.splice(c,1),l.close(),this.dispatchEvent(new yF(o,i))}),l.addEventListener("call-ended",c=>{this.dispatchEvent(c)}),i==="incoming"&&(l.addEventListener("receive-stream",c=>{this.dispatchEvent(c)}),t.on("stream",()=>{qn&&console.log("Received stream for call",t.metadata);let c=0;const h=setInterval(()=>{const u=c===0;!l.isOpen&&u&&(qn&&console.warn("Close call because stream is not active",t.metadata),c+=1,clearInterval(h),l.close())},2e3)})),l}};let Vy=Iy;d(Vy,"instances",new Map);class dx extends js{constructor(t,i){super();d(this,"context");d(this,"peer");d(this,"_sendingStreams",new Map);d(this,"debug",!1);d(this,"_enabled",!1);d(this,"_tickIntervalId");d(this,"tick",()=>{this.updateSendingCalls()});d(this,"onJoinedRoom",t=>{this._sendingStreams.size>0&&(this.debug&&console.warn(`${t!=null&&t.userId?`User ${t.userId}`:"You"} joined room`,t,this._sendingStreams.size),this.updateSendingCalls())});d(this,"onLeftRoom",t=>{this.debug&&console.warn(`${(t==null?void 0:t.userId)||"You"} left room`,t),this.stopCallsToUsersThatAreNotInTheRoomAnymore(),this.peer.closeAll()});d(this,"onCallStreamReceived",t=>{this.debug&&console.log("Call with "+t.userId+" started"),this.dispatchEvent({type:"receive-stream",target:this,stream:t.stream,userId:t.userId}),this.debug&&this.debugLogCurrentState()});d(this,"onCallEnded",t=>{this.debug&&console.log("Call with "+t.userId+" ended"),this.dispatchEvent(t),this.debug&&this.debugLogCurrentState()});d(this,"onUserConnected",t=>{if(this.peer.id===t.guid){this.debug&&console.log("PEER USER CONNECTED",t.guid,t,this._sendingStreams.size);const i=this._sendingStreams.keys().next().value;this.peer.makeCall(t.peerId,i)}else qn&&console.log("Unknown user connected",t.guid,t.peerId)});d(this,"onUserLeft",t=>{this.debug&&console.log("User left room: "+t.userId),this.stopCallsToUsersThatAreNotInTheRoomAnymore()});this.context=t,this.peer=i,qn&&(this.debug=!0)}static create(t,i){const n=Vy.getOrCreate(t.context,i||t.context.connection.connectionId||t.guid);return new dx(t.context,n)}startSendingStream(t){this._sendingStreams.has(t)?console.warn("Received start sending stream with stream that is already being sent"):(this._sendingStreams.set(t,[]),this.updateSendingCalls())}stopSendingStream(t){if(t){const i=this._sendingStreams.get(t);if(i){for(const n of i)n.close();i.length=0}this._sendingStreams.delete(t),i&&this.debug&&this.debugLogCurrentState()}this.updateSendingCalls()}get enabled(){return this._enabled}enable(){this._enabled||(this._enabled=!0,this.peer.enable(),this.peer.addEventListener("receive-stream",this.onCallStreamReceived),this.peer.addEventListener("call-ended",this.onCallEnded),this.context.connection.beginListen("peer-user-connected",this.onUserConnected),this.context.connection.beginListen(Qt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Qt.UserJoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Qt.UserLeftRoom,this.onUserLeft),this.context.connection.beginListen(Qt.LeftRoom,this.onLeftRoom),this._tickIntervalId=setInterval(this.tick,5e3))}disable(){this._enabled&&(this._enabled=!1,this.peer.disable(),this.peer.removeEventListener("receive-stream",this.onCallStreamReceived),this.peer.removeEventListener("call-ended",this.onCallEnded),this.context.connection.stopListen("peer-user-connected",this.onUserConnected),this.context.connection.stopListen(Qt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Qt.UserJoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Qt.UserLeftRoom,this.onUserLeft),this.context.connection.stopListen(Qt.LeftRoom,this.onLeftRoom),this._tickIntervalId!=null&&(clearInterval(this._tickIntervalId),this._tickIntervalId=void 0))}updateSendingCalls(){const t=this.context.connection.connectionId;for(const i of this._sendingStreams.keys()){const n=this._sendingStreams.get(i)||[];for(const r of this.context.connection.usersInRoom()){if(r===t)continue;const o=this.peer.getPeerIdFromUserId(r);if(n.find(l=>{var c;return l.peerId===o&&l.direction==="outgoing"&&!l.isClosed&&((c=l.stream)==null?void 0:c.active)}))qn&&console.debug("Already have a call with user "+r+" / peer "+o);else{const l=this.peer.makeCall(o,i);l&&n.push(l)}}this._sendingStreams.set(i,n)}this.stopCallsToUsersThatAreNotInTheRoomAnymore()}stopCallsToUsersThatAreNotInTheRoomAnymore(){for(const t of this._sendingStreams.keys()){const i=this._sendingStreams.get(t);if(i)for(let n=i.length-1;n>=0;n--){const r=i[n];this.context.connection.userIsInRoom(r.userId)?qn&&(this.context.connection.connectionId===r.userId?console.warn(`You are still in the room [${n}] ${r.userId}`):console.log(`User is still in room [${n}] ${r.userId}`)):(qn&&console.log(`Remove call ${[n]} to user that is not in room anymore ${r.userId}`),r.close(),i.splice(n,1))}}this.peer.updateCalls(),this.debug&&this.debugLogCurrentState()}debugLogCurrentState(){console.warn(`You (${this.context.connection.connectionId}) are currently sending ${this._sendingStreams.size} and receiving ${this.peer.incomingCalls.length} calls (${this.peer.incomingCalls.map(t=>t.userId).join(", ")})`,this.peer.incomingCalls)}}function Rc(s){if(s&&s instanceof MediaStream)for(const e of s.getTracks())e.stop()}var Ave=Object.defineProperty,_ve=Object.getOwnPropertyDescriptor,vF=(s,e,t,i)=>{for(var n=i>1?void 0:i?_ve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Ave(e,t,n),n};const bve="noVoip",xve=ie("debugvoip");class hf extends Ie{constructor(){super(...arguments);d(this,"autoConnect",!0);d(this,"runInBackground",!0);d(this,"createMenuButton",!0);d(this,"debug",!1);d(this,"_net");d(this,"_menubutton");d(this,"_allowSending",!0);d(this,"_outputStream",null);d(this,"onJoinedRoom",async()=>{this.debug&&console.log("VOIP: Joined room"),await Nc(300),this.autoConnect&&!this.isSending&&this._allowSending&&this.connect()});d(this,"onLeftRoom",()=>{this.debug&&console.log("VOIP: Left room"),this.disconnect();for(const t of this._incomingStreams.values())Rc(t.srcObject);this._incomingStreams.clear()});d(this,"_incomingStreams",new Map);d(this,"onReceiveStream",t=>{const i=t.target.userId,n=t.stream;let r=this._incomingStreams.get(i);r||(r=new Audio,this._incomingStreams.set(i,r)),r.srcObject=n,r.setAttribute("autoplay","true"),Nl.registerWaitForInteraction(()=>{r==null||r.play().catch(o=>{console.error("VOIP: Failed to play audio",o)})})});d(this,"onStreamEnded",t=>{const i=this._incomingStreams.get(t.userId);Rc(i==null?void 0:i.srcObject),this._incomingStreams.delete(t.userId)});d(this,"onEnabledChanged",()=>{for(const t of this._incomingStreams){const i=t[1];i.muted=!this.enabled}});d(this,"onVisibilityChanged",()=>{if(this.runInBackground)return;const i=!(document.visibilityState==="visible");this.setMuted(i);for(const n of this._incomingStreams){const r=n[1];r.muted=i}})}awake(){xve&&(this.debug=!0),this.debug&&(console.log("VOIP debugging: press 'v' to toggle mute or 'c' to toggle connect/disconnect"),window.addEventListener("keydown",async t=>{switch(t.key.toLowerCase()){case"v":console.log("MUTE?",!this.isMuted),this.setMuted(!this.isMuted);break;case"c":this.isSending?this.disconnect():this.connect();break}}),window.addEventListener("blur",()=>{console.log("VOIP: MUTE ON BLUR"),this.setMuted(!0)}),window.addEventListener("focus",()=>{console.log("VOIP: UNMUTE ON FOCUS"),this.setMuted(!1)}))}onEnable(){this._net||(this._net=dx.create(this)),this.debug&&(this._net.debug=!0),this._net.addEventListener(Ic.StreamReceived,this.onReceiveStream),this._net.addEventListener(Ic.StreamEnded,this.onStreamEnded),this._net.enable(),this.autoConnect&&this.context.connection.isConnected&&this.connect(),this.context.connection.beginListen(Qt.JoinedRoom,this.onJoinedRoom),this.context.connection.beginListen(Qt.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.addEventListener("visibilitychange",this.onVisibilityChanged)}onDisable(){var t;this._net&&(this._net.stopSendingStream(this._outputStream),this._net.removeEventListener(Ic.StreamReceived,this.onReceiveStream),this._net.removeEventListener(Ic.StreamEnded,this.onStreamEnded),(t=this._net)==null||t.disable()),this.context.connection.stopListen(Qt.JoinedRoom,this.onJoinedRoom),this.context.connection.stopListen(Qt.LeftRoom,this.onLeftRoom),this.onEnabledChanged(),this.updateButton(),window.removeEventListener("visibilitychange",this.onVisibilityChanged)}onDestroy(){var t;(t=this._menubutton)==null||t.remove(),this._menubutton=void 0}get isSending(){return this._outputStream!=null&&this._outputStream.active}async connect(t){var i,n;if(!this._net)return console.error("Cannot connect to voice chat - NetworkedStreams not initialized. Make sure the component is enabled before calling this method."),!1;if(this.context.connection.isConnected){if(!await mA())return console.error("Cannot connect to voice chat - microphone permissions not granted"),this.updateButton(),!1}else return console.error("Cannot connect to voice chat - not connected to server"),this.updateButton(),!1;return this._allowSending=!0,(i=this._net)==null||i.stopSendingStream(this._outputStream),Rc(this._outputStream),this._outputStream=await this.getAudioStream(t),this._outputStream?(this.debug&&console.log("VOIP: Got audio stream"),(n=this._net)==null||n.startSendingStream(this._outputStream),this.updateButton(),!0):(this.updateButton(),await mA()?console.error("VOIP: Could not get audio stream - please make sure to connect an audio device and grant microphone permissions"):DM("Microphone permissions not granted: Please grant microphone permissions to use voice chat"),(this.debug||nt())&&console.log("VOIP: Failed to get audio stream"),!1)}disconnect(t){var i;t!=null&&t.remember&&(this._allowSending=!1),(i=this._net)==null||i.stopSendingStream(this._outputStream),Rc(this._outputStream),this._outputStream=null,this.updateButton()}setMuted(t){var n;const i=(n=this._outputStream)==null?void 0:n.getAudioTracks();if(i)for(const r of i)r.enabled=!t}get isMuted(){var i;if(this._outputStream===null)return!1;const t=(i=this._outputStream)==null?void 0:i.getAudioTracks();if(t){for(const n of t)if(!n.enabled)return!0}return!1}async updateButton(){var t;if(this.createMenuButton){if(this._menubutton||(this._menubutton=document.createElement("button"),this._menubutton.addEventListener("click",()=>{this.isSending?this.disconnect({remember:!0}):this.connect(),mA().then(i=>{i||Fi("<strong>Microphone permissions not granted</strong>. Please allow your browser to use the microphone to be able to talk. Click on the button on the left side of your browser's address bar to allow microphone permissions.")})})),this._menubutton){this.context.menu.appendChild(this._menubutton),this.activeAndEnabled?this._menubutton.style.display="":this._menubutton.style.display="none",this._menubutton.title=this.isSending?"Click to disable your microphone":"Click to enable your microphone";let i=(this.isSending,""),n=this.isSending?"mic":"mic_off";await mA()||(i="No Permission",n="mic_off",this._menubutton.title="Microphone permissions not granted. Please allow your browser to use the microphone to be able to talk. This can usually be done in the addressbar of the webpage."),this._menubutton.innerText=i,this._menubutton.prepend(dr(n)),this.context.connection.isConnected==!1?this._menubutton.setAttribute("disabled",""):this._menubutton.removeAttribute("disabled")}}else this.activeAndEnabled||(t=this._menubutton)==null||t.remove()}getFrequency(t){return this.unsupported_getfrequency||(this.unsupported_getfrequency=!0,nt()&&Fi("VOIP: getFrequency is currently not supported"),console.warn("VOIP: getFrequency is currently not supported")),null}async getAudioStream(t){return navigator.mediaDevices.getUserMedia?await navigator.mediaDevices.getUserMedia({audio:t??!0,video:!1}).catch(n=>(console.warn("VOIP failed getting audio stream",n),null)):(console.error("No getDisplayMedia support"),null)}}vF([C()],hf.prototype,"autoConnect",2);vF([C()],hf.prototype,"runInBackground",2);vF([C()],hf.prototype,"createMenuButton",2);var wve=Object.defineProperty,Sve=Object.getOwnPropertyDescriptor,N7=(s,e,t,i)=>{for(var n=i>1?void 0:i?Sve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&wve(e,t,n),n};const Cve=ie("debugmouth");class fx extends Ie{constructor(){super(...arguments);d(this,"idle",[]);d(this,"talking",[]);d(this,"marker",null);d(this,"voip",null);d(this,"lastMouthChangeTime",0);d(this,"mouthChangeLength",0)}awake(){setTimeout(()=>{this.voip=ne.findObjectOfType(hf,this.context),this.marker||(this.marker=ne.getComponentInParent(this.gameObject,Ss))},3e3)}update(){var n;if(!this.voip||this.context.time.frameCount%10!==0)return;let t=((n=this.marker)==null?void 0:n.connectionId)??null;if(!t){Cve&&(t=null);return}const i=this.voip.getFrequency(t)??0;this.updateLips(i)}updateLips(t){if(this.context.time.time-this.lastMouthChangeTime>this.mouthChangeLength){if(this.mouthChangeLength=.05+Math.random()*.1,this.talking&&this.talking.length>0&&t>30){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.talking.length);this.setMouthShapeActive(this.talking,i)}else if(this.idle.length>0&&this.context.time.time-this.lastMouthChangeTime>.5){this.lastMouthChangeTime=this.context.time.time;const i=Math.floor(Math.random()*this.idle.length);this.setMouthShapeActive(this.idle,i)}}}setMouthShapeActive(t,i){if(t){t!=this.idle?this.idle.map(n=>n.visible=!1):this.talking.map(n=>n.visible=!1);for(let n=0;n<t.length;n++){const r=t[n];r&&(r.visible=n===i)}}}}N7([C(ye)],fx.prototype,"idle",2);N7([C(ye)],fx.prototype,"talking",2);class AF extends Ie{constructor(){super(...arguments);d(this,"voip",null);d(this,"marker",null);d(this,"_startPosition",null)}awake(){this.voip=ne.findObjectOfType(hf,this.context),this.marker=ne.getComponentInParent(this.gameObject,Ss)}update(){if(!this.voip||!this.marker||this.context.time.frameCount%10!==0)return;const t=this.marker.connectionId,i=this.voip.getFrequency(t);if(i==null)return;this._startPosition||(this._startPosition=this.gameObject.position.clone());const n=i/100;this.gameObject.position.y=this._startPosition.y+n*.07}}var Eve=Object.defineProperty,Mve=Object.getOwnPropertyDescriptor,gT=(s,e,t,i)=>{for(var n=i>1?void 0:i?Mve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Eve(e,t,n),n};class xm extends Ie{constructor(){super(...arguments);d(this,"eyes",[]);d(this,"lastBlinkTime",0);d(this,"blinkLength",0);d(this,"eyesOpen",!0);d(this,"state",null)}awake(){this.state=ne.getComponentInParent(this.gameObject,ra)}update(){if(!this.gameObject||!this.gameObject.visible||!this.eyes||!Array.isArray(this.eyes)||this.eyes.length===0)return;if(this.context.time.time-this.lastBlinkTime>this.blinkLength){if(this.lastBlinkTime=this.context.time.time,this.state&&!this.state.isOn||!this.activeAndEnabled)return;if(this.eyesOpen=!this.eyesOpen,this.blinkLength=Math.random(),this.eyesOpen?(this.blinkLength*=3,this.blinkLength+=.5,Math.random()<.1&&(this.blinkLength=.1+Math.random()*.2)):(this.blinkLength*=Math.random()*.2,this.blinkLength+=.1),Math.random()<.1&&(this.blinkLength*=3),this.blinkLength=Math.max(.2,this.blinkLength),this.blinkLength=Math.min(3,this.blinkLength),this.eyes)for(const i of this.eyes)i&&(i.visible=this.eyesOpen)}}}gT([C(ye)],xm.prototype,"eyes",2);gT([C()],xm.prototype,"lastBlinkTime",2);gT([C()],xm.prototype,"blinkLength",2);gT([C()],xm.prototype,"eyesOpen",2);var Tve=Object.defineProperty,Ive=Object.getOwnPropertyDescriptor,_F=(s,e,t,i)=>{for(var n=i>1?void 0:i?Ive(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Tve(e,t,n),n},TB;const z7=(TB=class extends Ie{constructor(){super(...arguments);d(this,"head",null);d(this,"eyes",null);d(this,"target",null);d(this,"brain",null);d(this,"vec",new S);d(this,"currentTargetPoint",new S)}awake(){this.brain||(this.brain=ne.getComponentInParent(this.gameObject,sb)),this.brain||(console.log("No look at brain found, adding it now"),this.brain=ne.addNewComponent(this.gameObject,sb)),this.brain&&this.target&&(this.brain.controlledTarget=this.target)}update(){const e=this.target;if(e&&this.head){const t=this.eyes;if(t){const i=Ft(e);this.currentTargetPoint.lerp(i,this.context.time.deltaTime/.1);const n=Ft(this.head),r=this.vec.copy(this.currentTargetPoint).sub(n).normalize();if(r.length()<.1)return;const o=z7.forward;if(o.set(0,0,1),o.applyQuaternion(ki(this.head)),o.dot(r)>.45)for(let l=0;l<t.length;l++)t[l].lookAt(this.currentTargetPoint)}}}},d(TB,"forward",new S(0,0,1)),TB);let Uv=z7;_F([C(ye)],Uv.prototype,"head",2);_F([C(ye)],Uv.prototype,"eyes",2);_F([C(ye)],Uv.prototype,"target",2);const q0=ie("debugavatar");class yT{constructor(e,t,i,n){d(this,"root");d(this,"head");d(this,"leftHand");d(this,"rigthHand");var r;this.root=e,this.head=t,this.leftHand=i,this.rigthHand=n,(r=this.root)==null||r.traverse(o=>o.layers.set(2))}get isValid(){return this.head!==null&&this.head!==void 0}}class bF{constructor(){d(this,"avatarRegistryUrl",null)}async getOrCreateNewAvatarInstance(e,t){if(!t)return console.error("Can not create avatar: failed to provide id or root object"),null;let i=null;if(typeof t=="string"){if(i=await this.loadAvatar(e,t),!i){const r=new Xl;i=ne.instantiate($y(t,e.scene),r)}}else i=t;if(!i)return null;const n=this.findAvatar(i);return n.isValid?(q0&&console.log("[Custom Avatar] valid config",t,q0?n:""),n):(console.warn("[Custom Avatar] config isn't valid",t,q0?n:""),null)}async loadAvatar(e,t){if(console.assert(t!=null&&typeof t=="string","Avatar id must not be null"),t.length<=0||!t)return null;if(q0&&console.log("[Custom Avatar] "+t+", loading..."),t.endsWith(".glb")||(t+=".glb"),this.avatarRegistryUrl===null){const n=await fetch("./"+t);let r=null;if(n.ok){const a=await n.blob();a&&(r=await a.arrayBuffer())}if(!r&&(r=await Jk(t,t,0,"no url here go away",!0),!r))return null;const o=await Gl().parseSync(e,r,null,0);return(o==null?void 0:o.scene)??null}const i=new Wd;return rT(i,e),new Promise((n,r)=>{const o=this.avatarRegistryUrl+"/"+t;i.load(o,async a=>{await Gl().createBuiltinComponents(e,o,a,null,void 0),n(a.scene)},a=>{q0&&console.log("[Custom Avatar] "+a.loaded/a.total*100+"% loaded of "+a.total/1024+"kB")},a=>{console.error("[Custom Avatar] Error when loading: "+a),n(null)})})}cacheModel(e,t){}findAvatar(e){const t=e;let i=t;i.children.length==1&&(i=e.children[0]);let n=this.findAvatarPart(i,["head"]);const r=this.findAvatarPart(i,["left","hand"]),o=this.findAvatarPart(i,["right","hand"]);if(!n){n=t;const l=new S;new jt().setFromObject(n).getSize(l);const c=Math.max(l.x,l.y,l.z);console.warn("[Custom Avatar] Normalizing head scale, it's too big: "+c+" meters! Should be < 0.3m"),c>.3&&n.scale.multiplyScalar(1/c*.3)}return new yT(t,n,r,o)}findAvatarPart(e,t){const i=e.name.toLowerCase();let n=!0;for(const r of t){if(!n)break;i.indexOf(r)===-1&&(n=!1)}if(n)return e;if(e.children)for(const r of e.children){const o=this.findAvatarPart(r,t);if(o)return o}return null}handleCustomAvatarErrors(e){if(!e.ok)throw Error(e.statusText);return e}}var Rve=Object.defineProperty,Pve=Object.getOwnPropertyDescriptor,xF=(s,e,t,i)=>{for(var n=i>1?void 0:i?Pve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Rve(e,t,n),n};class Nv extends Ie{constructor(){super(...arguments);d(this,"length",1);d(this,"depthTest",!0);d(this,"isGizmo",!1);d(this,"_axes",null)}onEnable(){if(this.isGizmo&&!Jb)return;this._axes||(this._axes=new _a(this.length)),this._axes.layers.disableAll(),this._axes.layers.set(this.layer),this.gameObject.add(this._axes);const t=this._axes.material;t&&t.depthTest!==void 0&&(t.depthTest=this.depthTest)}onDisable(){this._axes&&this.gameObject.remove(this._axes)}}xF([C()],Nv.prototype,"length",2);xF([C()],Nv.prototype,"depthTest",2);xF([C()],Nv.prototype,"isGizmo",2);class wF extends Ie{constructor(){super(...arguments);d(this,"from");d(this,"to");d(this,"hint");d(this,"desiredDistance",1)}onEnable(){}update(){if(!this.from||!this.to||!this.hint)return;const t=Ft(this.to).clone(),i=Ft(this.from).clone(),n=t.distanceTo(i),r=t.clone();r.sub(i);const o=i.clone();o.add(t),o.multiplyScalar(.5);const a=Ft(this.hint).clone();a.sub(o);const l=new S;l.crossVectors(a,r),l.crossVectors(r,l),l.normalize();const c=n*.5,h=Math.max(this.desiredDistance,c),u=Math.sqrt(h*h-c*c),f=l.clone();f.multiplyScalar(u),f.add(o),Es(this.gameObject,f);const p=o.clone();p.sub(l),this.gameObject.lookAt(p)}}const MP=ie("debugusdzbehaviours");class vT{constructor(){d(this,"behaviours",[]);d(this,"behaviourComponents",[]);d(this,"behaviourComponentsCopy",[]);d(this,"audioClips",[]);d(this,"audioClipsCopy",[])}get extensionName(){return"Behaviour"}addBehavior(e){this.behaviours.push(e)}addAudioClip(e){if(!e||typeof e!="string")return"";const i="audio/"+cf.getName(e);return this.audioClips.push({clipUrl:e,filesKey:i}),i}onBeforeBuildDocument(e){if(!e.root)return Promise.resolve();const t=[];return e.root.traverse(i=>{ne.foreachComponent(i,n=>{var o;const r=n;if(typeof r.createBehaviours=="function"||typeof r.beforeCreateDocument=="function"||typeof r.afterCreateDocument=="function"||typeof r.afterSerialize=="function"){this.behaviourComponents.push(r);const a=(o=r.beforeCreateDocument)==null?void 0:o.call(r,this,e);a instanceof Promise&&t.push(a)}},!1)}),MP&&console.log("onBeforeBuildDocument: all components",this.behaviourComponents),Promise.all(t)}onExportObject(e,t,i){var n;for(const r of this.behaviourComponents)MP&&console.log("onExportObject: createBehaviours",r),(n=r.createBehaviours)==null||n.call(r,this,t,i)}onAfterBuildDocument(e){for(const t of this.behaviourComponents)typeof t.afterCreateDocument=="function"&&t.afterCreateDocument(this,e);this.behaviourComponentsCopy=this.behaviourComponents.slice(),this.behaviourComponents.length=0,this.audioClipsCopy=this.audioClips.slice(),this.audioClips.length=0}onAfterHierarchy(e,t){var i;if((i=this.behaviours)!=null&&i.length){t.beginBlock('def Scope "Behaviors"');for(const n of this.behaviours)n.writeTo(this,e.document,t);t.closeBlock()}}async onAfterSerialize(e){MP&&console.log("onAfterSerialize behaviours",this.behaviourComponentsCopy);for(const t of this.behaviourComponentsCopy)typeof t.afterSerialize=="function"&&(t.afterSerialize.constructor.name==="AsyncFunction"?await t.afterSerialize(this,e):t.afterSerialize(this,e));for(const{clipUrl:t,filesKey:i}of this.audioClipsCopy){if(e.files[i])return;const o=await(await(await fetch(t)).blob()).arrayBuffer(),a=new Uint8Array(o);e.files[i]=a}this.behaviourComponentsCopy.length=0,this.audioClipsCopy.length=0}}var Bve=Object.defineProperty,Dve=Object.getOwnPropertyDescriptor,SF=(s,e,t,i)=>{for(var n=i>1?void 0:i?Dve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Bve(e,t,n),n},IB;const G7=(IB=class extends Sr{constructor(){super(...arguments);d(this,"threshold",new Ze(.9));d(this,"intensity",new Ze(1));d(this,"scatter",new Ze(.3));d(this,"selectiveBloom")}get typeName(){return"Bloom"}init(){this.threshold.valueProcessor=e=>e,this.intensity.valueProcessor=e=>e,this.scatter.valueProcessor=e=>e}onCreateEffect(){let e;if(this.selectiveBloom==null&&(this.selectiveBloom=G7.useSelectiveBloom),this.selectiveBloom){const t=e=new ZQ(this.context.scene,this.context.mainCamera,{blendFunction:Xt.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});t.inverted=!0}else e=new ck({blendFunction:Xt.ADD,mipmapBlur:!0,luminanceThreshold:this.threshold.value,luminanceSmoothing:this.scatter.value,radius:.85,intensity:this.intensity.value});return this.intensity.onValueChanged=t=>{e.intensity=t},this.threshold.onValueChanged=t=>{e.luminanceMaterial.threshold=Math.pow(t,2.2)},this.scatter.onValueChanged=t=>{e.luminancePass.enabled=!0,e.luminanceMaterial.smoothing=t,e.mipmapBlurPass&&(e.mipmapBlurPass.radius=gi.lerp(.1,.9,t))},e}},d(IB,"useSelectiveBloom",!1),IB);let wm=G7;SF([C(Ze)],wm.prototype,"threshold",2);SF([C(Ze)],wm.prototype,"intensity",2);SF([C(Ze)],wm.prototype,"scatter",2);dl("Bloom",wm);var Ove=Object.defineProperty,Lve=Object.getOwnPropertyDescriptor,Go=(s,e,t,i)=>{for(var n=i>1?void 0:i?Lve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Ove(e,t,n),n};class Ea extends Ie{constructor(){super(...arguments);d(this,"attachedRigidbody",null);d(this,"isTrigger",!1);d(this,"sharedMaterial");d(this,"membership",[0]);d(this,"filter");d(this,"updateProperties",()=>{var t;(t=this.context.physics.engine)==null||t.updateProperties(this)})}get isCollider(){return!0}awake(){super.awake(),this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Ni))}start(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Ni))}onEnable(){this.attachedRigidbody||(this.attachedRigidbody=this.gameObject.getComponentInParent(Ni))}onDisable(){var t;(t=this.context.physics.engine)==null||t.removeBody(this)}get body(){var t;return(t=this.context.physics.engine)==null?void 0:t.getBody(this)}updatePhysicsMaterial(){var t;(t=this.context.physics.engine)==null||t.updatePhysicsMaterial(this)}}Go([C(Ni)],Ea.prototype,"attachedRigidbody",2);Go([C()],Ea.prototype,"isTrigger",2);Go([C()],Ea.prototype,"sharedMaterial",2);Go([C()],Ea.prototype,"membership",2);Go([C()],Ea.prototype,"filter",2);class zv extends Ea{constructor(){super(...arguments);d(this,"radius",.5);d(this,"center",new S(0,0,0))}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addSphereCollider(this),EM(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),SL(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}}Go([wr(),C()],zv.prototype,"radius",2);Go([C(S)],zv.prototype,"center",2);const H7=class extends Ea{constructor(){super(...arguments);d(this,"size",new S(1,1,1));d(this,"center",new S(0,0,0))}static add(e,t){const i=new H7;e.geometry.boundingBox||e.geometry.computeBoundingBox();const n=e.geometry.boundingBox;return i.size=n.getSize(new S)||new S(1,1,1),i.center=n.getCenter(new S)||new S(0,0,0),va(e,i),(t==null?void 0:t.rigidbody)===!0&&va(e,Ni,{isKinematic:!1}),i}onEnable(){var e;super.onEnable(),(e=this.context.physics.engine)==null||e.addBoxCollider(this,this.size),EM(this.gameObject.scale,this.updateProperties)}onDisable(){super.onDisable(),SL(this.gameObject.scale,this.updateProperties)}onValidate(){this.updateProperties()}};let Gv=H7;Go([wr(),C(S)],Gv.prototype,"size",2);Go([C(S)],Gv.prototype,"center",2);class Sm extends Ea{constructor(){super(...arguments);d(this,"sharedMesh");d(this,"convex",!1)}onEnable(){var i,n,r;if(super.onEnable(),!this.context.physics.engine)return;(i=this.sharedMesh)!=null&&i.isMesh||this.gameObject instanceof fe&&(this.sharedMesh=this.gameObject);const t=0;if((n=this.sharedMesh)!=null&&n.isMesh)this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,$i(this.gameObject)),yi.assignMeshLOD(this.sharedMesh,t).then(o=>{o&&this.activeAndEnabled&&this.context.physics.engine&&this.sharedMesh&&(this.context.physics.engine.removeBody(this),this.sharedMesh.geometry=o,this.context.physics.engine.addMeshCollider(this,this.sharedMesh,this.convex,$i(this.gameObject)))});else{const o=this.sharedMesh;if(o!=null&&o.isGroup){console.warn(`MeshCollider mesh is a group "${((r=this.sharedMesh)==null?void 0:r.name)||this.gameObject.name}", adding all children as colliders. This is currently not fully supported (colliders can not be removed from world again)`,this);const a=new Array;for(const l in o.children){const c=o.children[l];c.isMesh&&(this.context.physics.engine.addMeshCollider(this,c,this.convex,$i(this.gameObject)),a.push(yi.assignMeshLOD(c,t)))}Promise.all(a).then(l=>{var h,u;if(l.some(f=>f)==!1)return;(h=this.context.physics.engine)==null||h.removeBody(this);const c=new fe;for(const f of l)f&&this.activeAndEnabled&&(c.geometry=f,(u=this.context.physics.engine)==null||u.addMeshCollider(this,c,this.convex,$i(this.gameObject)))})}}}}Go([C(fe)],Sm.prototype,"sharedMesh",2);Go([C()],Sm.prototype,"convex",2);class au extends Ea{constructor(){super(...arguments);d(this,"center",new S(0,0,0));d(this,"radius",.5);d(this,"height",2)}onEnable(){var t;super.onEnable(),(t=this.context.physics.engine)==null||t.addCapsuleCollider(this,this.height,this.radius)}}Go([C(S)],au.prototype,"center",2);Go([C()],au.prototype,"radius",2);Go([C()],au.prototype,"height",2);var kve=Object.defineProperty,Fve=Object.getOwnPropertyDescriptor,CF=(s,e,t,i)=>{for(var n=i>1?void 0:i?Fve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&kve(e,t,n),n};class Cm extends Ie{constructor(){super(...arguments);d(this,"objectBounds",!1);d(this,"color");d(this,"isGizmo",!0);d(this,"_gizmoObject",null);d(this,"_boxHelper",null)}onEnable(){this.isGizmo&&!Jb||(this._gizmoObject||(this.objectBounds?this._gizmoObject=new _L(this.gameObject,this.color??16776960):(this.objectBounds=!1,this._gizmoObject=Uk(this.color??16776960))),this.objectBounds?(this.scene.add(this._gizmoObject),this._boxHelper=this._gizmoObject,this.startCoroutine(this.syncObjectBounds(),nn.OnBeforeRender)):this.gameObject.add(this._gizmoObject))}onDisable(){this._gizmoObject&&this.gameObject.remove(this._gizmoObject)}*syncObjectBounds(){var t;for(;this._boxHelper;)(t=this._boxHelper)==null||t.update(),yield}}CF([C()],Cm.prototype,"objectBounds",2);CF([C(Ae)],Cm.prototype,"color",2);CF([C()],Cm.prototype,"isGizmo",2);const Uve=ie("gizmos"),Nve=ie("debugboxhelper"),Ga=class extends Ie{constructor(){super(...arguments);d(this,"box",null);d(this,"_lastMatrixUpdateFrame",-1);d(this,"_helper",null);d(this,"_color",null)}isInBox(t,i){var r;if(!t)return;if(this.box||(this.box=new jt),t.type==="Mesh")Ga.testBox.setFromObject(t);else if(t.type==="Group"){if(Ga.testBox.makeEmpty(),t.children.length>0)for(let o=0;o<t.children.length;o++)t.children[o].type==="Mesh"&&Ga.testBox.expandByObject(t)}else{const o=Ft(t,Ga._position),a=$i(t,Ga._size);i!==void 0&&a.multiplyScalar(i),Ga.testBox.setFromCenterAndSize(o,a)}this.updateBox();const n=(r=this.box)==null?void 0:r.intersectsBox(Ga.testBox);return n&&Nve&&_t.DrawWireBox3(Ga.testBox,16711680,5),n}intersects(t){return t?this.updateBox(!1).intersectsBox(t):!1}updateBox(t=!1){if(this.box||(this.box=new jt),t||this.context.time.frameCount!=this._lastMatrixUpdateFrame){const i=this._lastMatrixUpdateFrame<0;this._lastMatrixUpdateFrame=this.context.time.frameCount;const n=i,r=Ft(this.gameObject,Ga._position,n),o=$i(this.gameObject,Ga._size);this.box.setFromCenterAndSize(r,o)}return this.box}awake(){this._helper=null,this._color=null,this.box=null}showHelper(t=null,i=!1){var n;if(!(!Uve&&!i)){if(this._helper){t&&((n=this._color)==null||n.set(t)),this.gameObject.add(this._helper);return}this._helper=Uk(t),this.gameObject.add(this._helper)}}};let el=Ga;d(el,"testBox",new jt),d(el,"_position",new S),d(el,"_size",new S(.01,.01,.01));class zve extends SQ{constructor(e,t={}){super(e),e._simpleState__activeStates=[],e._simpleState__normalStyles={},e._simpleState__states=t,e._simpleState__statesProperties={};for(const i in t)for(const n in t[i])e._simpleState__statesProperties[n]||(e._simpleState__statesProperties[n]=[]),e._simpleState__statesProperties[n].push(i);for(const i of e._components)e._simpleState__statesProperties[i.id]&&(e._simpleState__normalStyles[i.id]=i.inline?i.inline:i._value);e.__overridedSet=e.set,e.set=this.storeSet.bind(e),e.renderStates=this.renderStates.bind(e),e.setupState=this.setupState.bind(e),e.setState=this.setState.bind(e),e.activatePseudoState=this.activatePseudoState.bind(e),e.deactivatePseudoState=this.deactivatePseudoState.bind(e),e.togglePseudoState=this.togglePseudoState.bind(e)}act(){}attach(){}detach(){}setupState(e,t){this._simpleState__states[e]=t;const i=[];for(const n in t)this._simpleState__statesProperties[n]||(this._simpleState__statesProperties[n]=[],i.push(n)),this._simpleState__statesProperties[n].push(e);for(const n of this._components)i.indexOf(n.id)>-1&&(this._simpleState__normalStyles[n.id]=n.inline?n.inline:n._value)}renderStates(){let e={...this._simpleState__normalStyles};for(const t in this._simpleState__states)this._simpleState__activeStates.indexOf(t)>-1&&(e={...e,...this._simpleState__states[t]});this.set(e,!1)}storeSet(e,t=!0){if(t)for(const i in e)this._simpleState__statesProperties[i]&&(this._simpleState__normalStyles[i]=e[i]);this.__overridedSet(e)}activatePseudoState(e){this._simpleState__activeStates.indexOf(e)===-1&&(this._simpleState__activeStates.push(e),this.renderStates())}deactivatePseudoState(e){const t=this._simpleState__activeStates.indexOf(e);t>-1&&(this._simpleState__activeStates.splice(t,1),this.renderStates())}togglePseudoState(e){const t=this._simpleState__activeStates.indexOf(e);t>-1?this._simpleState__activeStates.splice(t,1):this._simpleState__activeStates.push(e),this.renderStates()}setState(e){Array.isArray(e)?this._simpleState__activeStates=e:this._simpleState__activeStates=[e],this.renderStates()}}var Gve=Object.defineProperty,Hve=Object.getOwnPropertyDescriptor,V7=(s,e,t,i)=>{for(var n=i>1?void 0:i?Hve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Gve(e,t,n),n};class Hv extends Ie{constructor(){super(...arguments);d(this,"effectColor");d(this,"effectDistance")}}V7([C(Ui)],Hv.prototype,"effectColor",2);V7([C(ee)],Hv.prototype,"effectDistance",2);var Vve=Object.defineProperty,Qve=Object.getOwnPropertyDescriptor,px=(s,e,t,i)=>{for(var n=i>1?void 0:i?Qve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Vve(e,t,n),n};const TP=ie("debugui"),IP=ie("debuguilayout");class EF{constructor(){d(this,"width");d(this,"height")}}class MF{constructor(){d(this,"x");d(this,"y");d(this,"width");d(this,"height")}}const Ml=new S,X0=new le,HS=new Ce,Q7=class extends ol{constructor(){super(...arguments);d(this,"_anchoredPosition");d(this,"sizeDelta",new ee(100,100));d(this,"pivot",new ee(.5,.5));d(this,"anchorMin",new ee(0,0));d(this,"anchorMax",new ee(1,1));d(this,"minWidth");d(this,"minHeight");d(this,"lastMatrix");d(this,"rectBlock");d(this,"_transformNeedsUpdate",!1);d(this,"_initialPosition");d(this,"_parentRectTransform");d(this,"_lastUpdateFrame",-1);d(this,"_lastAnchoring");d(this,"_createdBlocks",[]);d(this,"_createdTextBlocks",[])}get parent(){return this._parentRectTransform}get translation(){return this.gameObject.position}get rotation(){return this.gameObject.quaternion}get scale(){return this.gameObject.scale}get anchoredPosition(){return this._anchoredPosition||(this._anchoredPosition=new ee),this._anchoredPosition}set anchoredPosition(e){this._anchoredPosition=e}get width(){let e=this.sizeDelta.x;if(this.anchorMin.x!==this.anchorMax.x&&this._parentRectTransform){const t=this._parentRectTransform.width,i=this.anchorMax.x-this.anchorMin.x;e=t*i,e+=this.sizeDelta.x}return this.minWidth!==void 0&&e<this.minWidth?this.minWidth:e}get height(){let e=this.sizeDelta.y;if(this.anchorMin.y!==this.anchorMax.y&&this._parentRectTransform){const t=this._parentRectTransform.height,i=this.anchorMax.y-this.anchorMin.y;e=t*i,e+=this.sizeDelta.y}return this.minHeight!==void 0&&e<this.minHeight?this.minHeight:e}awake(){super.awake(),this._anchoredPosition||(this._anchoredPosition=new ee),this.lastMatrix=new le,this.rectBlock=new ye,this.rectBlock.name=this.name,this._initialPosition=this.gameObject.position.clone(),this._initialPosition.z=0,sy(this,"_anchoredPosition",()=>{this.markDirty()}),sy(this,"sizeDelta",()=>{this.markDirty()}),sy(this,"pivot",()=>{this.markDirty()}),sy(this,"anchorMin",()=>{this.markDirty()}),sy(this,"anchorMax",()=>{this.markDirty()})}onEnable(){var e;super.onEnable(),this.rectBlock||(this.rectBlock=new ye),this.lastMatrix||(this.lastMatrix=new le),this._lastAnchoring||(this._lastAnchoring=new ee),this._initialPosition||(this._initialPosition=new S),this._anchoredPosition||(this._anchoredPosition=new ee),this.addShadowComponent(this.rectBlock),this._transformNeedsUpdate=!0,(e=this.canvas)==null||e.registerTransform(this)}onDisable(){var e;super.onDisable(),this.removeShadowComponent(),(e=this.canvas)==null||e.unregisterTransform(this)}onParentRectTransformChanged(e){this._transformNeedsUpdate||this.onApplyTransform(IP?`${e.name} changed`:void 0)}get isDirty(){return this._transformNeedsUpdate||(this._transformNeedsUpdate=!this.lastMatrix.equals(this.gameObject.matrix)),this._transformNeedsUpdate}markDirty(){this._transformNeedsUpdate||(IP&&console.warn("RectTransform markDirty()",this.name),this._transformNeedsUpdate=!0,this._lastUpdateFrame=-1)}updateTransform(){(this._transformNeedsUpdate||!this.lastMatrix.equals(this.gameObject.matrix))&&this.canUpdate()&&this.onApplyTransform(this._transformNeedsUpdate?"Marked dirty":"Matrix changed")}canUpdate(){return this._transformNeedsUpdate&&this.activeAndEnabled&&this._lastUpdateFrame!==this.context.time.frame}onApplyTransform(e){var n;if(this.context.time.frameCount===this._lastUpdateFrame)return;this._lastUpdateFrame=this.context.time.frameCount;const t=this.shadowComponent;if(!t)return;this.gameObject.parent?this._parentRectTransform=ne.getComponentInParent(this.gameObject.parent,Q7):this._parentRectTransform=void 0,this._transformNeedsUpdate=!1,IP&&console.warn("RectTransform  ApplyTransform",this.name+" because "+e),this.isRoot()?this.Root.screenspace||(t.rotation.y=Math.PI):(t.matrix.identity(),t.matrixAutoUpdate=!1,Ml.set(0,0,0),this.applyPivot(Ml),t.matrix.setPosition(Ml.x,Ml.y,0),(this.gameObject.quaternion.x||this.gameObject.quaternion.y||this.gameObject.quaternion.z)&&(HS.copy(this.gameObject.quaternion),HS.x*=-1,HS.z*=-1,X0.makeRotationFromQuaternion(HS),t.matrix.premultiply(X0)),Ml.set(0,0,0),this.applyAnchoring(Ml),(n=this.canvas)!=null&&n.screenspace?Ml.z+=.1:Ml.z+=.01,X0.identity(),X0.setPosition(Ml.x,Ml.y,Ml.z),t.matrix.premultiply(X0),t.matrix.scale(this.gameObject.scale)),this.lastMatrix.copy(this.gameObject.matrix);const i=!0;for(const r of $M(this.gameObject,ol,i,1)){if(r===this||!r.activeAndEnabled)continue;const o=r;o.onParentRectTransformChanged&&o.onParentRectTransformChanged(this)}}applyAnchoring(e){this._lastAnchoring||(this._lastAnchoring=new ee);const t=this._lastAnchoring.sub(this._anchoredPosition);this.gameObject.position.x+=t.x,this.gameObject.position.y+=t.y,this._lastAnchoring.copy(this._anchoredPosition),e.x+=this._initialPosition.x-this.gameObject.position.x,e.y+=this._initialPosition.y-this.gameObject.position.y,e.z+=this._initialPosition.z-this.gameObject.position.z;const i=this._parentRectTransform;if(i){let n=0;const r=1-this.anchorMax.y-this.anchorMin.y;n-=i.height*.5*r,e.y+=n;let o=0;const a=1-this.anchorMax.x-this.anchorMin.x;o-=i.width*.5*a,e.x+=o}}applyPivot(e){if(this.pivot&&!this.isRoot()){const t=this.pivot.x-.5;e.x-=t*this.sizeDelta.x*this.gameObject.scale.x;const i=this.pivot.y-.5;e.y-=i*this.sizeDelta.y*this.gameObject.scale.y}}getBasicOptions(){const e={width:this.sizeDelta.x,height:this.sizeDelta.y,offset:0,backgroundOpacity:0,borderWidth:0,borderRadius:0,borderOpacity:0,letterSpacing:-.03};return this.ensureValidSize(e),e}ensureValidSize(e,t=1e-4){return e.width<=0&&(e.width=t),e.height<=0&&(e.height=1e-4),e}createNewBlock(e){e={...this.getBasicOptions(),...e},TP&&console.log(this.name,e);const t=new XL(e);return this._createdBlocks.push(t),t}createNewText(e){TP&&console.log(e),e={...this.getBasicOptions(),...e},TP&&console.log(this.name,e);const t=new YL(e);return this._createdTextBlocks.push(t),t}};let Xr=Q7;px([C(ee)],Xr.prototype,"anchoredPosition",1);px([C(ee)],Xr.prototype,"sizeDelta",2);px([C(ee)],Xr.prototype,"pivot",2);px([C(ee)],Xr.prototype,"anchorMin",2);px([C(ee)],Xr.prototype,"anchorMax",2);var Wve=Object.defineProperty,jve=Object.getOwnPropertyDescriptor,W7=(s,e,t,i)=>{for(var n=i>1?void 0:i?jve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Wve(e,t,n),n};const VS={backgroundColor:new Ae(1,1,1),backgroundOpacity:1,borderColor:new Ae(1,1,1),borderOpacity:1};var RB;const DA=(RB=class extends ol{constructor(){super(...arguments);d(this,"_alphaFactor",1);d(this,"sRGBColor",new Ae(1,0,1));d(this,"raycastTarget",!0);d(this,"uiObject",null);d(this,"_color",null);d(this,"_rect",null);d(this,"_stateManager",null);d(this,"_currentlyCreatingPanel",!1)}get isGraphic(){return!0}get color(){return this._color||(this._color=new Ui(1,1,1,1)),this._color}set color(e){(!this._color||this._color.r!==e.r||this._color.g!==e.g||this._color.b!==e.b||this._color.alpha!==e.alpha)&&(this._color||(this._color=new Ui(1,1,1,1)),this._color.copy(e),this.onColorChanged())}setAlphaFactor(e){this._alphaFactor=e,this.onColorChanged()}get alphaFactor(){return this._alphaFactor}onColorChanged(){this.uiObject&&(this.sRGBColor.copy(this._color),this.sRGBColor.convertLinearToSRGB(),VS.backgroundColor=this.sRGBColor,VS.backgroundOpacity=this._color.alpha*this._alphaFactor,this.applyEffects(VS,this._alphaFactor),this.uiObject.set(VS),this.markDirty())}get m_Color(){return this._color}get rectTransform(){if(this._rect||(this._rect=ne.getComponent(this.gameObject,Xr)),!this._rect)throw new Error("Not Supported: Make sure to add a RectTransform component before adding a UI Graphic component.");return this._rect}onParentRectTransformChanged(){var e;(e=this.uiObject)==null||e.set({width:this.rectTransform.width,height:this.rectTransform.height}),this.markDirty()}__internalNewInstanceCreated(e){return super.__internalNewInstanceCreated(e),this._rect=null,this.uiObject=null,this._color&&(this._color=this._color.clone()),this}setState(e){this.makePanel(),this.uiObject&&(this.uiObject.setState(e),this==null||this.markDirty())}setupState(e){this.makePanel(),this.uiObject&&(this._stateManager||(this._stateManager=new zve(this.uiObject)),this.uiObject.setupState(e.state,e.attributes))}setOptions(e){this.makePanel(),this.uiObject&&this.uiObject.set(e)}awake(){super.awake(),this.makePanel(),sy(this,"_color",()=>dye(this,this.onColorChanged))}onEnable(){var e;super.onEnable(),this.uiObject&&((e=this.rectTransform.shadowComponent)==null||e.add(this.uiObject),this.addShadowComponent(this.uiObject,this.rectTransform))}onDisable(){super.onDisable(),this.uiObject&&this.removeShadowComponent()}makePanel(){if(this.uiObject||this._currentlyCreatingPanel)return;this._currentlyCreatingPanel=!0;const e=.015,t={backgroundColor:this.color,backgroundOpacity:this.color.alpha,offset:e};this.onBeforeCreate(t),this.applyEffects(t),this.onCreate(t),this.controlsChildLayout=!1,this._currentlyCreatingPanel=!1,this.onAfterCreated(),this.onColorChanged()}onBeforeCreate(e){}onCreate(e){this.uiObject=this.rectTransform.createNewBlock(e),this.uiObject.name=this.name}onAfterCreated(){}applyEffects(e,t=1){var n;const i=(n=this.gameObject)==null?void 0:n.getComponent(Hv);i&&(i.effectDistance&&(e.borderWidth=Math.max(Math.abs(i.effectDistance.x),Math.abs(i.effectDistance.y))),i.effectColor&&(e.borderColor=i.effectColor,e.borderOpacity=i.effectColor.alpha*t))}async setTexture(e){if(this.setOptions({backgroundOpacity:0}),e){if(DA.textureCache.has(e))e=DA.textureCache.get(e);else if(!e.isRenderTargetTexture){const t=e.clone();t.colorSpace=zi,DA.textureCache.set(e,t),e=t}this.setOptions({backgroundImage:e,borderRadius:0,backgroundOpacity:this.color.alpha,backgroundSize:"stretch"}),yi.assignTextureLOD(e,0).then(t=>{t instanceof Wt&&(e&&DA.textureCache.set(e,t),this.setOptions({backgroundImage:t}),this.markDirty())})}else this.setOptions({backgroundImage:void 0,borderRadius:0,backgroundOpacity:this.color.alpha});this.markDirty()}onAfterAddedToScene(){super.onAfterAddedToScene(),this.shadowComponent&&(this.shadowComponent.offset=this.shadowComponent.position.z)}},d(RB,"textureCache",new Map),RB);let Em=DA;W7([C(Ui)],Em.prototype,"color",1);W7([C()],Em.prototype,"raycastTarget",2);class mx extends Em{constructor(){super(...arguments);d(this,"_flippedObject",!1)}onAfterCreated(){this.uiObject&&!this._flippedObject&&(this._flippedObject=!0,this.uiObject.scale.y*=-1)}}var qve=Object.defineProperty,Xve=Object.getOwnPropertyDescriptor,AT=(s,e,t,i)=>{for(var n=i>1?void 0:i?Xve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&qve(e,t,n),n};let TF=class{constructor(){d(this,"texture",null);d(this,"rect")}};AT([C(Wt)],TF.prototype,"texture",2);let Vv=class extends mx{constructor(){super(...arguments);d(this,"_sprite");d(this,"pixelsPerUnitMultiplier",1)}set image(t){this.sprite||(this.sprite=new TF),this.sprite.texture=t,this.onAfterCreated()}get image(){return this.sprite?this.sprite.texture:null}get sprite(){return this._sprite}set sprite(t){this._sprite!==t&&(this._sprite=t,this.onAfterCreated())}isBuiltinSprite(){var i,n,r,o,a,l,c;const t=this.sprite;switch((i=t==null?void 0:t.texture)==null?void 0:i.name){case"InputFieldBackground":case"UISprite":case"Background":case"Knob":return!0}return!((r=(n=t==null?void 0:t.texture)==null?void 0:n.name)!=null&&r.length)&&((a=(o=t==null?void 0:t.texture)==null?void 0:o.image)==null?void 0:a.width)===32&&((c=(l=t==null?void 0:t.texture)==null?void 0:l.image)==null?void 0:c.height)===32}onBeforeCreate(t){var i,n;super.onBeforeCreate(t),this.isBuiltinSprite()&&(t.borderRadius=5/this.pixelsPerUnitMultiplier,((n=(i=this.sprite)==null?void 0:i.texture)==null?void 0:n.name)==="Knob"&&(t.borderRadius=999))}onAfterCreated(){var t;this.__didAwake&&(super.onAfterCreated(),!this.isBuiltinSprite()&&this.setTexture((t=this.sprite)==null?void 0:t.texture))}};AT([C(TF)],Vv.prototype,"sprite",1);AT([C()],Vv.prototype,"pixelsPerUnitMultiplier",2);class _T extends mx{constructor(){super(...arguments);d(this,"_mainTexture")}get mainTexture(){return this._mainTexture}set mainTexture(t){this._mainTexture!==t&&(this._mainTexture=t,this.onAfterCreated())}onAfterCreated(){this.__didAwake&&(super.onAfterCreated(),this.setTexture(this.mainTexture))}}AT([C(Wt)],_T.prototype,"mainTexture",1);var Yve=Object.defineProperty,Kve=Object.getOwnPropertyDescriptor,Ma=(s,e,t,i)=>{for(var n=i>1?void 0:i?Kve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Yve(e,t,n),n};const Xf=ie("debugbutton");class uf{constructor(){d(this,"colorMultiplier");d(this,"disabledColor");d(this,"fadeDuration");d(this,"highlightedColor");d(this,"normalColor");d(this,"pressedColor");d(this,"selectedColor")}}Ma([C()],uf.prototype,"colorMultiplier",2);Ma([C(Ui)],uf.prototype,"disabledColor",2);Ma([C()],uf.prototype,"fadeDuration",2);Ma([C(Ui)],uf.prototype,"highlightedColor",2);Ma([C(Ui)],uf.prototype,"normalColor",2);Ma([C(Ui)],uf.prototype,"pressedColor",2);Ma([C(Ui)],uf.prototype,"selectedColor",2);class Jve{constructor(){d(this,"disabledTrigger");d(this,"highlightedTrigger");d(this,"normalTrigger");d(this,"pressedTrigger");d(this,"selectedTrigger")}}class fu extends Ie{constructor(){super(...arguments);d(this,"onClick");d(this,"_isHovered",0);d(this,"colors");d(this,"transition");d(this,"animationTriggers");d(this,"animator");d(this,"_interactable",!0);d(this,"_requestedAnimatorTrigger");d(this,"_isInit",!1);d(this,"_image")}click(){var t;(t=this.onClick)==null||t.invoke()}onPointerEnter(t){var n,r;const i=t.event.pointerType==="mouse"&&t.button===0;i&&(this._isHovered+=1),Xf&&console.warn("Button Enter",i,this._isHovered,(n=this.animationTriggers)==null?void 0:n.highlightedTrigger,this.animator),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.highlightedTrigger):this.transition===1&&this.colors&&((r=this._image)==null||r.setState("hovered")),i&&this.context.input.setCursorPointer())}onPointerExit(){var t,i;this._isHovered-=1,this._isHovered<0&&(this._isHovered=0),Xf&&console.log("Button Exit",this._isHovered,(t=this.animationTriggers)==null?void 0:t.highlightedTrigger,this.animator),this.interactable&&(this._isHovered>0||(this._isHovered=0,this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((i=this._image)==null||i.setState("normal")),this.context.input.setCursorNormal()))}onPointerDown(t){var i,n;Xf&&console.log("Button Down",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this.animationTriggers.pressedTrigger):this.transition===1&&this.colors&&((n=this._image)==null||n.setState("pressed")))}onPointerUp(t){var i,n;Xf&&console.warn("Button Up",(i=this.animationTriggers)==null?void 0:i.highlightedTrigger,this.animator,this._isHovered),this.interactable&&(this.transition==3&&this.animationTriggers&&this.animator?this.animator.setTrigger(this._isHovered?this.animationTriggers.highlightedTrigger:this.animationTriggers.normalTrigger):this.transition===1&&this.colors&&((n=this._image)==null||n.setState(this._isHovered?"hovered":"normal")))}onPointerClick(t){if(this.interactable&&!(t.button!==0&&t.event.pointerType===QM.Mouse)&&(Xf&&(console.warn("Button Click",this.onClick),_n("CLICKED button "+this.name+" at "+this.context.time.frameCount)),this.onClick&&this.onClick.listenerCount>0&&(this.onClick.invoke(),t.use(),Xf))){const i=this.gameObject.worldPosition;i.add(this.gameObject.worldUp.multiplyScalar(1+Math.random()*.5)),_t.DrawLabel(i,"CLICK:"+Date.now(),.1,1+Math.random()*.5)}}set interactable(t){this._interactable=t,this._image&&(this._image.setInteractable(t),t?this._image.setState("normal"):this._image.setState("disabled"))}get interactable(){return this._interactable}set_interactable(t){this.interactable=t}awake(){super.awake(),Xf&&console.log(this),this._isInit=!1,this.init()}start(){var t;(t=this._image)==null||t.setInteractable(this.interactable),this.gameObject.getComponentInParent(ox)||this.gameObject.addComponent(lT)}onEnable(){super.onEnable()}onDestroy(){this._isHovered&&this.context.input.setCursorNormal()}*setAnimatorTriggerAtEndOfFrame(t){var i;this._requestedAnimatorTrigger=t,yield,yield,this._requestedAnimatorTrigger==t&&((i=this.animator)==null||i.SetTrigger(t))}init(){this._isInit||(this._isInit=!0,this._image=ne.getComponent(this.gameObject,Vv),this._image&&(this.stateSetup(this._image),this.interactable?this._image.setState("normal"):this._image.setState("disabled")))}stateSetup(t){var p,m,v,g,y;t.setInteractable(this.interactable);const i=this.getFinalColor(t.color,(p=this.colors)==null?void 0:p.normalColor),n={state:"normal",attributes:{backgroundColor:i,backgroundOpacity:i.alpha}};t.setupState(n);const r=this.getFinalColor(t.color,(m=this.colors)==null?void 0:m.highlightedColor),o={state:"hovered",attributes:{backgroundColor:r,backgroundOpacity:r.alpha}};t.setupState(o);const a=this.getFinalColor(t.color,(v=this.colors)==null?void 0:v.pressedColor),l={state:"pressed",attributes:{backgroundColor:a,backgroundOpacity:a.alpha}};t.setupState(l);const c=this.getFinalColor(t.color,(g=this.colors)==null?void 0:g.selectedColor),h={state:"selected",attributes:{backgroundColor:c,backgroundOpacity:c.alpha}};t.setupState(h);const u=this.getFinalColor(t.color,(y=this.colors)==null?void 0:y.disabledColor),f={state:"disabled",attributes:{backgroundColor:u,backgroundOpacity:u.alpha}};t.setupState(f)}getFinalColor(t,i){return i?t.clone().multiply(i).convertLinearToSRGB():t.clone().convertLinearToSRGB()}}Ma([C(Sn)],fu.prototype,"onClick",2);Ma([C(uf)],fu.prototype,"colors",2);Ma([C()],fu.prototype,"transition",2);Ma([C(Jve)],fu.prototype,"animationTriggers",2);Ma([C(vr)],fu.prototype,"animator",2);Ma([C()],fu.prototype,"interactable",1);var Zve=Object.defineProperty,$ve=Object.getOwnPropertyDescriptor,gs=(s,e,t,i)=>{for(var n=i>1?void 0:i?$ve(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Zve(e,t,n),n};const hH=ie("debuguilayout");class df{constructor(){d(this,"left",0);d(this,"right",0);d(this,"top",0);d(this,"bottom",0)}get vertical(){return this.top+this.bottom}get horizontal(){return this.left+this.right}}gs([C()],df.prototype,"left",2);gs([C()],df.prototype,"right",2);gs([C()],df.prototype,"top",2);gs([C()],df.prototype,"bottom",2);class Ta extends Ie{constructor(){super(...arguments);d(this,"_rectTransform",null);d(this,"_needsUpdate",!1);d(this,"childAlignment",0);d(this,"reverseArrangement",!1);d(this,"spacing",0);d(this,"padding");d(this,"minWidth",0);d(this,"minHeight",0);d(this,"flexibleHeight",0);d(this,"flexibleWidth",0);d(this,"preferredHeight",0);d(this,"preferredWidth",0)}get rectTransform(){return this._rectTransform}onParentRectTransformChanged(t){this._needsUpdate=!0}get isDirty(){return this._needsUpdate}get isLayoutGroup(){return!0}updateLayout(){this._rectTransform&&(hH&&console.warn("Layout Update",this.context.time.frame,this.name),this._needsUpdate=!1,this.onCalculateLayout(this._rectTransform))}start(){this._needsUpdate=!0}onEnable(){hH&&console.log(this.name,this),this._rectTransform=this.gameObject.getComponent(Xr);const t=this.gameObject.getComponentInParent(Ar);t&&t.registerLayoutGroup(this),this._needsUpdate=!0}onDisable(){const t=this.gameObject.getComponentInParent(Ar);t&&t.unregisterLayoutGroup(this)}set m_Spacing(t){t!==this.spacing&&(this._needsUpdate=!0,this.spacing=t)}get m_Spacing(){return this.spacing}}gs([C()],Ta.prototype,"childAlignment",2);gs([C()],Ta.prototype,"reverseArrangement",2);gs([C()],Ta.prototype,"spacing",2);gs([C(df)],Ta.prototype,"padding",2);gs([C()],Ta.prototype,"minWidth",2);gs([C()],Ta.prototype,"minHeight",2);gs([C()],Ta.prototype,"flexibleHeight",2);gs([C()],Ta.prototype,"flexibleWidth",2);gs([C()],Ta.prototype,"preferredHeight",2);gs([C()],Ta.prototype,"preferredWidth",2);class ff extends Ta{constructor(){super(...arguments);d(this,"childControlHeight",!0);d(this,"childControlWidth",!0);d(this,"childForceExpandHeight",!1);d(this,"childForceExpandWidth",!1);d(this,"childScaleHeight",!1);d(this,"childScaleWidth",!1)}onCalculateLayout(t){var T;const i=this.primaryAxis,n=t.width;let r=n;const o=t.height;let a=o;r-=this.padding.horizontal,a-=this.padding.vertical,i==="x"?this.padding.horizontal:this.padding.vertical;const l=i==="x",c=l?"y":"x",h=l?this.childControlWidth:this.childControlHeight,u=l?this.childControlHeight:this.childControlWidth,f=l?this.childForceExpandWidth:this.childForceExpandHeight,p=l?this.childForceExpandHeight:this.childForceExpandWidth,m=l?a:r,v=l?n:o,g=.5*(l?this.childAlignment%3:Math.floor(this.childAlignment/3));let y=0;l?y+=this.padding.left:y+=this.padding.top;let A=0,_=0;for(let R=0;R<this.gameObject.children.length;R++){const w=this.gameObject.children[R],I=ne.getComponent(w,Xr);I!=null&&I.activeAndEnabled&&(_+=1,l?A+=I.width:A+=I.height)}let b=0;const x=this.spacing*(_-1);if(f||h){let R=0;l?R=r-=x:R=a-=x,_>0&&(b=R/_)}let E=0;E+=this.padding.left,E-=this.padding.right,g!==0&&(y=v-A,y*=g,y-=x*g,l?(y-=this.padding.right*g,y+=this.padding.left*(1-g),y<this.padding.left&&(y=this.padding.left)):(y-=this.padding.bottom*g,y+=this.padding.top*(1-g),y<this.padding.top&&(y=this.padding.top)));let M=1;for(let R=0;R<this.gameObject.children.length;R++){const w=this.gameObject.children[R],I=ne.getComponent(w,Xr);if(I!=null&&I.activeAndEnabled){(T=I.pivot)==null||T.set(.5,.5),I.anchorMin.set(0,1),I.anchorMax.set(0,1);const O=n*.5+E*.5;I.anchoredPosition.x!==O&&(I.anchoredPosition.x=O);const k=o*-.5;I.anchoredPosition.y!==k&&(I.anchoredPosition.y=k),p&&u&&I.sizeDelta[c]!==m&&(I.sizeDelta[c]=m),f&&h&&I.sizeDelta[i]!==b&&(I.sizeDelta[i]=b);const B=l?I.width:I.height,G=B*.5;if(y+=G,f){const U=b*M-b*.5;U>y&&(y=U-b*.5+B+this.padding.left,y-=G)}let L=y;i==="y"&&(L=-L),I.anchoredPosition[i]!==L&&(I.anchoredPosition[i]=L),y+=G,y+=this.spacing,M+=1}}}}gs([C()],ff.prototype,"childControlHeight",2);gs([C()],ff.prototype,"childControlWidth",2);gs([C()],ff.prototype,"childForceExpandHeight",2);gs([C()],ff.prototype,"childForceExpandWidth",2);gs([C()],ff.prototype,"childScaleHeight",2);gs([C()],ff.prototype,"childScaleWidth",2);class IF extends ff{get primaryAxis(){return"y"}}class RF extends ff{get primaryAxis(){return"x"}}class PF extends Ta{onCalculateLayout(){}}var e0e=Object.defineProperty,t0e=Object.getOwnPropertyDescriptor,Kc=(s,e,t,i)=>{for(var n=i>1?void 0:i?t0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&e0e(e,t,n),n},j7=(s=>(s[s.ScreenSpaceOverlay=0]="ScreenSpaceOverlay",s[s.ScreenSpaceCamera=1]="ScreenSpaceCamera",s[s.WorldSpace=2]="WorldSpace",s[s.Undefined=-1]="Undefined",s))(j7||{});const RP=ie("debuguilayout"),q7=class extends rx{constructor(){super(...arguments);d(this,"_renderOnTop");d(this,"_depthWrite",!1);d(this,"_doubleSided",!0);d(this,"_castShadows",!1);d(this,"_receiveShadows",!1);d(this,"_renderMode",-1);d(this,"_rootCanvas");d(this,"_scaleFactor",1);d(this,"worldCamera");d(this,"planeDistance",-1);d(this,"_boundRenderSettingsChanged",this.onRenderSettingsChanged.bind(this));d(this,"previousParent",null);d(this,"_lastMatrixWorld",null);d(this,"_rectTransforms",[]);d(this,"_layoutGroups",new Map);d(this,"_receivers",[]);d(this,"onBeforeRenderRoutine",()=>{var e,t,i,n;if(this.previousParent=this.gameObject.parent,((e=this.context.xr)!=null&&e.isVR||(t=this.context.xr)!=null&&t.isPassThrough)&&this.screenspace){this.gameObject.visible=!1,this.gameObject.removeFromParent();return}this.renderOnTop||this.screenspace?this.gameObject.removeFromParent():(this.onUpdateRenderMode(),this.handleLayoutUpdates(),(i=this.shadowComponent)==null||i.updateMatrixWorld(!0),(n=this.shadowComponent)==null||n.updateWorldMatrix(!0,!0),this.invokeBeforeRenderEvents(),Oo.ensureUpdateMeshUI(LN,this.context))});d(this,"onAfterRenderRoutine",()=>{var e,t,i,n,r;if(((e=this.context.xr)!=null&&e.isVR||(t=this.context.xr)!=null&&t.isPassThrough)&&this.screenspace){(i=this.previousParent)==null||i.add(this.gameObject);return}if((this.screenspace||this.renderOnTop)&&this.previousParent&&this.context.mainCamera){if(this.screenspace){const l=this.context.mainCamera;l==null||l.add(this.gameObject)}else this.previousParent.add(this.gameObject);const o=this.context.renderer.autoClear,a=this.context.renderer.autoClearColor;this.context.renderer.autoClear=!1,this.context.renderer.autoClearColor=!1,this.context.renderer.clearDepth(),this.onUpdateRenderMode(!0),this.handleLayoutUpdates(),(n=this.shadowComponent)==null||n.updateMatrixWorld(!0),this.invokeBeforeRenderEvents(),Oo.ensureUpdateMeshUI(LN,this.context,!0),this.context.renderer.render(this.gameObject,this.context.mainCamera),this.context.renderer.autoClear=o,this.context.renderer.autoClearColor=a,this.previousParent.add(this.gameObject)}(r=this._lastMatrixWorld)==null||r.copy(this.gameObject.matrixWorld)});d(this,"_updateRenderSettingsRoutine");d(this,"_activeRenderMode",-1);d(this,"_lastWidth",-1);d(this,"_lastHeight",-1)}get isCanvas(){return!0}get screenspace(){return this.renderMode!==2}set renderOnTop(e){e!==this._renderOnTop&&(this._renderOnTop=e,this.onRenderSettingsChanged())}get renderOnTop(){return this._renderOnTop!==void 0?this._renderOnTop:!!(this.screenspace&&this._renderMode===0)}set depthWrite(e){this._depthWrite!==e&&(this._depthWrite=e,this.onRenderSettingsChanged())}get depthWrite(){return this._depthWrite}set doubleSided(e){this._doubleSided!==e&&(this._doubleSided=e,this.onRenderSettingsChanged())}get doubleSided(){return this._doubleSided}set castShadows(e){this._castShadows!==e&&(this._castShadows=e,this.onRenderSettingsChanged())}get castShadows(){return this._castShadows}set receiveShadows(e){this._receiveShadows!==e&&(this._receiveShadows=e,this.onRenderSettingsChanged())}get receiveShadows(){return this._receiveShadows}get renderMode(){return this._renderMode}set renderMode(e){this._renderMode!==e&&(this._renderMode=e,this.onRenderSettingsChanged())}set rootCanvas(e){this._rootCanvas instanceof q7||(this._rootCanvas=e)}get rootCanvas(){return this._rootCanvas}get scaleFactor(){return this._scaleFactor}set scaleFactor(e){this._scaleFactor=e}awake(){var e;this.shadowComponent=this.gameObject,this.previousParent=this.gameObject.parent,RP&&console.log("Canvas.Awake()",((e=this.previousParent)==null?void 0:e.name)+"/"+this.gameObject.name),super.awake()}start(){this.onUpdateRenderMode()}onEnable(){super.onEnable(),this._updateRenderSettingsRoutine=void 0,this._lastMatrixWorld=new le,this.onUpdateRenderMode(),document.addEventListener("resize",this._boundRenderSettingsChanged),this.context.pre_render_callbacks.push(this.onBeforeRenderRoutine),this.context.post_render_callbacks.push(this.onAfterRenderRoutine)}onDisable(){super.onDisable(),document.removeEventListener("resize",this._boundRenderSettingsChanged);const e=this.context.pre_render_callbacks.indexOf(this.onBeforeRenderRoutine);e!==-1&&this.context.pre_render_callbacks.splice(e,1);const t=this.context.post_render_callbacks.indexOf(this.onAfterRenderRoutine);t!==-1&&this.context.post_render_callbacks.splice(t,1)}registerTransform(e){this._rectTransforms.push(e)}unregisterTransform(e){const t=this._rectTransforms.indexOf(e);t!==-1&&this._rectTransforms.splice(t,1)}registerLayoutGroup(e){const t=e.gameObject;this._layoutGroups.set(t,e)}unregisterLayoutGroup(e){const t=e.gameObject;this._layoutGroups.delete(t)}registerEventReceiver(e){this._receivers.push(e)}unregisterEventReceiver(e){const t=this._receivers.indexOf(e);t!==-1&&this._receivers.splice(t,1)}async onEnterXR(e){this.screenspace?(e.xr.isVR||e.xr.isPassThrough)&&(this.gameObject.visible=!1):(this.gameObject.visible=!1,await CM(1).then(()=>{this.gameObject.visible=!0}))}onLeaveXR(e){this.screenspace&&(e.xr.isVR||e.xr.isPassThrough)&&(this.gameObject.visible=!0)}invokeBeforeRenderEvents(){var e;for(const t of this._receivers)(e=t.onBeforeCanvasRender)==null||e.call(t,this)}handleLayoutUpdates(){this._lastMatrixWorld===null&&(this._lastMatrixWorld=new le);const e=!this._lastMatrixWorld.equals(this.gameObject.matrixWorld);RP&&e&&console.log("Canvas Layout changed",this.context.time.frameCount,this.name);const t=!1;for(const i of this._rectTransforms){e&&i.markDirty();let n=this._layoutGroups.get(i.gameObject);i.isDirty&&!n&&(n=i.gameObject.getComponentInParent(Ta)),(i.isDirty||n!=null&&n.isDirty)&&(RP&&!t&&console.log("CANVAS UPDATE ### "+i.name+" ##################################### "+this.context.time.frame),n==null||n.updateLayout(),i.updateTransform())}}applyRenderSettings(){this.onRenderSettingsChanged()}onRenderSettingsChanged(){this._updateRenderSettingsRoutine||(this._updateRenderSettingsRoutine=this.startCoroutine(this._updateRenderSettingsDelayed(),nn.OnBeforeRender))}*_updateRenderSettingsDelayed(){if(yield,this._updateRenderSettingsRoutine=void 0,this.shadowComponent){this.onUpdateRenderMode(),_E(this.shadowComponent,this);for(const e of ne.getComponentsInChildren(this.gameObject,ol))_E(e.shadowComponent,this)}}onUpdateRenderMode(e=!1){if(!e&&this._renderMode===this._activeRenderMode&&this._lastWidth===this.context.domWidth&&this._lastHeight===this.context.domHeight)return;this._activeRenderMode=this._renderMode;let t=this.context.mainCameraComponent,i=10;switch(t&&t.nearClipPlane>0&&t.farClipPlane>0&&(i=it.lerp(t.nearClipPlane,t.farClipPlane,.01)),this._renderMode===1&&(this.worldCamera&&(t=this.worldCamera),this.planeDistance>0&&(i=this.planeDistance)),this._renderMode){case 0:case 1:if(this._lastWidth=this.context.domWidth,this._lastHeight=this.context.domHeight,!t)return;const n=i+.01;this.gameObject.position.x=0,this.gameObject.position.y=0,this.gameObject.position.z=-n,this.gameObject.quaternion.identity();const r=this.gameObject.getComponent(Xr);let o=!1;r.sizeDelta.x!==this.context.domWidth&&(o=!0),r.sizeDelta.y!==this.context.domHeight&&(o=!0);const a=t.fieldOfView*Math.PI/180,l=2*Math.tan(a/2)*Math.abs(n);this.gameObject.scale.x=l/this.context.domHeight,this.gameObject.scale.y=l/this.context.domHeight,this.gameObject.scale.z=.01,o&&(r.sizeDelta.x=this.context.domWidth,r.sizeDelta.y=this.context.domHeight,r==null||r.markDirty());break;case 2:this._lastWidth=-1,this._lastHeight=-1;break}}};let Ar=q7;Kc([C()],Ar.prototype,"renderOnTop",1);Kc([C()],Ar.prototype,"depthWrite",1);Kc([C()],Ar.prototype,"doubleSided",1);Kc([C()],Ar.prototype,"castShadows",1);Kc([C()],Ar.prototype,"receiveShadows",1);Kc([C()],Ar.prototype,"renderMode",1);Kc([C(Ar)],Ar.prototype,"rootCanvas",1);Kc([C()],Ar.prototype,"scaleFactor",1);Kc([C(Hi)],Ar.prototype,"worldCamera",2);Kc([C()],Ar.prototype,"planeDistance",2);var i0e=Object.defineProperty,n0e=Object.getOwnPropertyDescriptor,BF=(s,e,t,i)=>{for(var n=i>1?void 0:i?n0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&i0e(e,t,n),n};class Xd extends Ie{constructor(){super(...arguments);d(this,"_alpha",1);d(this,"interactable",!0);d(this,"blocksRaycasts",!0);d(this,"_isDirty",!1);d(this,"_buffer",[])}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.markDirty())}get isCanvasGroup(){return!0}markDirty(){this._isDirty||(this._isDirty=!0,this.startCoroutine(this.applyChangesDelayed(),nn.OnBeforeRender))}*applyChangesDelayed(){this._isDirty=!1,this.applyChangesNow()}applyChangesNow(){this._buffer.length=0;for(const t of ne.getComponentsInChildren(this.gameObject,ol,this._buffer)){const i=t;i.setAlphaFactor&&i.setAlphaFactor(this._alpha)}}}BF([C()],Xd.prototype,"alpha",1);BF([C()],Xd.prototype,"interactable",2);BF([C()],Xd.prototype,"blocksRaycasts",2);var s0e=Object.defineProperty,r0e=Object.getOwnPropertyDescriptor,Dn=(s,e,t,i)=>{for(var n=i>1?void 0:i?r0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&s0e(e,t,n),n};const uH=ie("debugusdzbehaviours");function gx(s){s&&(s.getComponentInParent(ox)||(nt()&&console.warn("Create Raycaster on "+s.name+" because no raycaster was found in the hierarchy"),s.addNewComponent(wa)))}class Mm extends Ie{constructor(){super(...arguments);d(this,"object");d(this,"target");d(this,"duration",1);d(this,"relativeMotion",!1);d(this,"coroutine",null);d(this,"targetPos",new S);d(this,"targetRot",new Ce);d(this,"targetScale",new S)}start(){gx(this.gameObject)}onPointerClick(t){t.use(),this.coroutine&&this.stopCoroutine(this.coroutine),this.relativeMotion?this.coroutine=this.startCoroutine(this.moveRelative()):this.coroutine=this.startCoroutine(this.moveToTarget())}*moveToTarget(){if(!this.target||!this.object)return;const t=Ft(this.object).clone(),i=Ft(this.target).clone(),n=ki(this.object).clone(),r=ki(this.target).clone(),o=$i(this.object).clone(),a=$i(this.target).clone(),l=t.distanceTo(i),c=n.angleTo(r),h=o.distanceTo(a);if(l<.01&&c<.01&&h<.01){Es(this.object,i),rl(this.object,r),sv(this.object,a),this.coroutine=null;return}let u=0,f=0;for(;u<1;)u+=this.context.time.deltaTime/this.duration,u>1&&(u=1),f=u<.5?4*u*u*u:1-Math.pow(-2*u+2,3)/2,this.targetPos.lerpVectors(t,i,f),this.targetRot.slerpQuaternions(n,r,f),this.targetScale.lerpVectors(o,a,f),Es(this.object,this.targetPos),rl(this.object,this.targetRot),sv(this.object,this.targetScale),yield;this.coroutine=null}*moveRelative(){if(!this.target||!this.object)return;const t=this.object.position.clone(),i=this.object.quaternion.clone(),n=this.object.scale.clone(),r=this.target.position.clone(),o=this.target.quaternion.clone(),a=this.target.scale.clone();r.applyQuaternion(this.object.quaternion),this.targetPos.copy(this.object.position).add(r),this.targetRot.copy(this.object.quaternion).multiply(o),this.targetScale.copy(this.object.scale).multiply(a);let l=0,c=0;for(;l<1;)l+=this.context.time.deltaTime/this.duration,l>1&&(l=1),c=l<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,this.object.position.lerpVectors(t,this.targetPos,c),this.object.quaternion.slerpQuaternions(i,this.targetRot,c),this.object.scale.lerpVectors(n,this.targetScale,c),yield;this.coroutine=null}beforeCreateDocument(t){var i;if(this.target&&this.object&&this.gameObject){const n=new cs("Move to "+((i=this.target)==null?void 0:i.name),Qs.tapTrigger(this.gameObject),Ai.transformAction(this.object,this.target,this.duration,this.relativeMotion?"relative":"absolute"));t.addBehavior(n)}}}Dn([C(ye)],Mm.prototype,"object",2);Dn([C(ye)],Mm.prototype,"target",2);Dn([C()],Mm.prototype,"duration",2);Dn([C()],Mm.prototype,"relativeMotion",2);var DC;const ac=(DC=class extends Ie{constructor(){super(...arguments);d(this,"materialToSwitch");d(this,"variantMaterial");d(this,"fadeDuration",0);d(this,"_objectsWithThisMaterial",null);d(this,"selfModel");d(this,"targetModels")}start(){var e;this._objectsWithThisMaterial=this.objectsWithThisMaterial,gx(this.gameObject),nt()&&this._objectsWithThisMaterial.length<=0&&console.warn('ChangeMaterialOnClick: No objects found with material "'+((e=this.materialToSwitch)==null?void 0:e.name)+'"')}onPointerEnter(e){this.context.input.setCursorPointer()}onPointerExit(e){this.context.input.setCursorNormal()}onPointerClick(e){if(e.use(),!!this.variantMaterial)for(let t=0;t<this.objectsWithThisMaterial.length;t++){const i=this.objectsWithThisMaterial[t];i.material=this.variantMaterial}}get objectsWithThisMaterial(){return this._objectsWithThisMaterial!=null?this._objectsWithThisMaterial:(this._objectsWithThisMaterial=[],this.variantMaterial&&this.materialToSwitch&&this.context.scene.traverse(e=>{if(e instanceof fe)if(Array.isArray(e.material)){for(const t of e.material)if(t===this.materialToSwitch){this.objectsWithThisMaterial.push(e);break}}else e.material===this.materialToSwitch?this.objectsWithThisMaterial.push(e):h9(e.material,this.materialToSwitch)&&this.objectsWithThisMaterial.push(e)}),this._objectsWithThisMaterial)}async beforeCreateDocument(e,t){this.targetModels=[],ac._materialTriggersPerId={},ac.variantSwitchIndex=0,this.materialToSwitch&&await yi.assignTextureLOD(this.materialToSwitch,0),this.variantMaterial&&await yi.assignTextureLOD(this.variantMaterial,0)}createBehaviours(e,t,i){this.objectsWithThisMaterial.find(r=>r.uuid===t.uuid)&&this.targetModels.push(t),this.gameObject.uuid===t.uuid&&(this.selfModel=t,this.materialToSwitch&&(ac._materialTriggersPerId[this.materialToSwitch.uuid]||(ac._materialTriggersPerId[this.materialToSwitch.uuid]=[]),ac._materialTriggersPerId[this.materialToSwitch.uuid].push(this)))}afterCreateDocument(e,t){if(!this.materialToSwitch)return;const i=ac._materialTriggersPerId[this.materialToSwitch.uuid];if(i){const n={};for(const r of i){const o=r.createVariants();o&&o.length>0&&(n[r.selfModel.uuid]=o)}for(const r of i){const o=[];for(const a in n)a!==r.selfModel.uuid&&o.push(...n[a]);r.createAndAttachBehaviors(e,n[r.selfModel.uuid],o)}}delete ac._materialTriggersPerId[this.materialToSwitch.uuid]}createAndAttachBehaviors(e,t,i){const n=[],r=[],o=Math.max(0,this.fadeDuration);r.push(Ai.fadeAction([...this.targetModels,...i],o,!1)),n.push(Ai.fadeAction(t,o,!1)),r.push(Ai.fadeAction(t,o,!0)),e.addBehavior(new cs("Select_"+this.selfModel.name,Qs.tapTrigger(this.selfModel),Ai.parallel(...r))),e.addBehavior(new cs("StartHidden_"+this.selfModel.name,Qs.sceneStartTrigger(),Ai.parallel(...n)))}static getMaterialName(e){return Wl(e.name||"Material")+"_"+e.id}createVariants(){if(!this.variantMaterial)return null;const e=[];for(const t of this.targetModels){const i=t.clone();i.name+="_Variant_"+ac.variantSwitchIndex+++"_"+ac.getMaterialName(this.variantMaterial),i.displayName=i.displayName+": Variant with material "+this.variantMaterial.name,i.material=this.variantMaterial,i.geometry=t.geometry,i.matrix=t.matrix,(!t.parent||!t.parent.isEmpty())&&mr.createEmptyParent(t),t.parent&&t.parent.add(i),e.push(i)}return e}},d(DC,"_materialTriggersPerId",{}),d(DC,"variantSwitchIndex",0),DC);let Qv=ac;Dn([C(Ht)],Qv.prototype,"materialToSwitch",2);Dn([C(Ht)],Qv.prototype,"variantMaterial",2);Dn([C()],Qv.prototype,"fadeDuration",2);var Yg;const Rn=(Yg=class extends Ie{constructor(){super(...arguments);d(this,"target");d(this,"toggleOnClick",!1);d(this,"targetState",!0);d(this,"hideSelf",!0);d(this,"selfModel");d(this,"selfModelClone");d(this,"targetModel");d(this,"toggleModel");d(this,"stateBeforeCreatingDocument",!1);d(this,"targetStateBeforeCreatingDocument",!1)}start(){gx(this.gameObject)}onPointerClick(e){e.use(),!this.toggleOnClick&&this.hideSelf&&(this.gameObject.visible=!1),this.target&&(this.target.visible=this.toggleOnClick?!this.target.visible:this.targetState)}createBehaviours(e,t,i){t.uuid===this.gameObject.uuid&&(this.selfModel=t,this.selfModelClone=t.clone())}beforeCreateDocument(){this.target&&(this.gameObject[Rn.wasVisible]===void 0&&(this.gameObject[Rn.wasVisible]=this.gameObject.activeSelf),this.target[Rn.wasVisible]===void 0&&(this.target[Rn.wasVisible]=this.target.activeSelf),this.stateBeforeCreatingDocument=this.gameObject[Rn.wasVisible],this.targetStateBeforeCreatingDocument=this.target[Rn.wasVisible],this.gameObject.visible=!0,this.target.visible=!0)}afterCreateDocument(e,t){if(!this.target)return;this.targetModel=t.document.findById(this.target.uuid);const i=this.selfModel;if(this.selfModel&&this.targetModel){let n=this.selfModel,r=this.targetState;if(this.toggleOnClick)if(r=!this.targetStateBeforeCreatingDocument,!this.selfModelClone.geometry)(!this.selfModel.parent||this.selfModel.parent.isEmpty())&&f7.createEmptyParent(this.selfModel),this.toggleModel=this.selfModel.deepClone(),this.toggleModel.name+="_toggle",this.selfModel.parent.add(this.toggleModel);else{if(!this.gameObject[Rn.toggleClone]){const l=this.selfModelClone.clone();l.matrix.identity(),l.name+="_toggle"+Rn.clonedToggleIndex++,i.add(l),this.gameObject[Rn.toggleClone]=l,console.warn("USDZExport: Toggle "+this.gameObject.name+" doesn't have geometry. It will be deep cloned and nested behaviours will likely not work.")}const a=this.gameObject[Rn.toggleClone];if(!this.gameObject[Rn.reverseToggleClone]){const l=this.selfModelClone.clone();l.matrix.identity(),l.name+="_toggleReverse"+Rn.clonedToggleIndex++,i.add(l),this.gameObject[Rn.reverseToggleClone]=l}this.toggleModel=this.gameObject[Rn.reverseToggleClone],(!this.toggleModel.geometry||!a.geometry)&&console.error("triggers without childs and without geometry won't work!",this,i.geometry),n=a,i.geometry=null,i.material=null}if(this.toggleModel){if(this.toggleOnClick){const a=[];a.push(Ai.fadeAction(n,0,!1)),a.push(Ai.fadeAction(this.toggleModel,0,!0)),a.push(Ai.fadeAction(this.targetModel,0,r)),e.addBehavior(new cs("Toggle_"+n.name+"_toggleTo"+(r?"On":"Off"),Qs.tapTrigger(n),Ai.parallel(...a)));const l=[];l.push(Ai.fadeAction(this.toggleModel,0,!1)),l.push(Ai.fadeAction(n,0,!0)),l.push(Ai.fadeAction(this.targetModel,0,!r)),e.addBehavior(new cs("Toggle_"+n.name+"_toggleTo"+(r?"Off":"On"),Qs.tapTrigger(this.toggleModel),Ai.parallel(...l)))}}else{const a=[];this.hideSelf&&a.push(Ai.fadeAction(n,0,!1)),a.push(Ai.fadeAction(this.targetModel,0,r)),e.addBehavior(new cs("Toggle_"+n.name+"_toggleTo"+(r?"On":"Off"),Qs.tapTrigger(n),Ai.parallel(...a)))}const o=new Array;this.targetStateBeforeCreatingDocument||o.push(this.targetModel),this.stateBeforeCreatingDocument||o.push(i),this.toggleModel&&o.push(this.toggleModel),e.addBehavior(new cs("HideOnStart_"+this.gameObject.name,Qs.sceneStartTrigger(),Ai.fadeAction(o,0,!1)))}}afterSerialize(e,t){this.gameObject[Rn.wasVisible]!==void 0&&(this.gameObject.visible=this.gameObject[Rn.wasVisible],delete this.gameObject[Rn.wasVisible]),this.target&&this.target[Rn.wasVisible]!==void 0&&(this.target.visible=this.target[Rn.wasVisible],delete this.target[Rn.wasVisible]),delete this.gameObject[Rn.toggleClone],delete this.gameObject[Rn.reverseToggleClone]}},d(Yg,"clonedToggleIndex",0),d(Yg,"wasVisible",Symbol("usdz_SetActiveOnClick_wasVisible")),d(Yg,"toggleClone",Symbol("clone for toggling")),d(Yg,"reverseToggleClone",Symbol("clone for reverse toggling")),Yg);let Tm=Rn;Dn([C(ye)],Tm.prototype,"target",2);Dn([C()],Tm.prototype,"toggleOnClick",2);Dn([C()],Tm.prototype,"targetState",2);Dn([C()],Tm.prototype,"hideSelf",2);class DF extends Ie{constructor(){super(...arguments);d(this,"wasVisible",!1)}start(){ne.setActive(this.gameObject,!1)}createBehaviours(t,i,n){i.uuid===this.gameObject.uuid&&(this.wasVisible||t.addBehavior(new cs("HideOnStart_"+this.gameObject.name,Qs.sceneStartTrigger(),Ai.fadeAction(i,0,!1))))}beforeCreateDocument(){this.wasVisible=ne.isActiveSelf(this.gameObject)}}class Wv extends Ie{constructor(){super(...arguments);d(this,"target");d(this,"duration",.5);d(this,"motionType","bounce")}beforeCreateDocument(){}createBehaviours(t,i,n){if(this.target&&i.uuid===this.gameObject.uuid){const r=new cs("emphasize "+this.name,Qs.tapTrigger(this.gameObject),Ai.emphasize(this.target,this.duration,this.motionType,void 0,"basic"));t.addBehavior(r)}}afterCreateDocument(t,i){}}Dn([C()],Wv.prototype,"target",2);Dn([C()],Wv.prototype,"duration",2);Dn([C()],Wv.prototype,"motionType",2);class Yd extends Ie{constructor(){super(...arguments);d(this,"target");d(this,"clip","");d(this,"toggleOnClick",!1);d(this,"trigger","tap")}start(){gx(this.gameObject)}ensureAudioSource(){if(!this.target){const t=this.gameObject.addNewComponent(Hn);t&&(this.target=t,t.spatialBlend=1,t.volume=1,t.loop=!1,t.preload=!0)}}onPointerClick(t){var i;t.use(),!(!((i=this.target)!=null&&i.clip)&&!this.clip)&&(this.ensureAudioSource(),this.target&&(this.target.isPlaying&&this.toggleOnClick?this.target.stop():(!this.toggleOnClick&&this.target.isPlaying&&this.target.stop(),this.clip?this.target.play(this.clip):this.target.play())))}createBehaviours(t,i,n){if(!(!this.target&&!this.clip)&&i.uuid===this.gameObject.uuid){const r=this.clip?this.clip:this.target?this.target.clip:void 0;if(!r||typeof r!="string")return;const o=this.target?this.target.gameObject:this.gameObject;cf.getName(r);const a=this.target?this.target.volume:1,l=this.target&&this.target.spatialBlend==0?"nonSpatial":"spatial";let c=!1;this.gameObject.traverse(p=>{p instanceof fe&&p.visible&&(c=!0)}),c=!0;const h=t.addAudioClip(r);let u=Ai.playAudioAction(o,h,"play",a,l);this.target&&this.target.loop&&(u=Ai.sequence(u).makeLooping());const f=this.name?"_"+this.name:"";if(c&&this.trigger==="tap"){this.toggleOnClick&&(u.multiplePerformOperation="stop");const p=new cs("playAudio"+f,Qs.tapTrigger(i),u);t.addBehavior(p)}if(this.target&&this.target.playOnAwake&&this.target.enabled)if(c&&this.trigger==="tap")console.warn("USDZExport: Audio sources that are played on tap can't also auto-play at scene start due to a QuickLook bug.");else{const p=new cs("playAudioOnStart"+f,Qs.sceneStartTrigger(),u);t.addBehavior(p)}}}}Dn([C(Hn)],Yd.prototype,"target",2);Dn([C(URL)],Yd.prototype,"clip",2);Dn([C()],Yd.prototype,"toggleOnClick",2);var OC;const lc=(OC=class extends Ie{constructor(){super(...arguments);d(this,"animator");d(this,"stateName");d(this,"trigger","tap");d(this,"animation");d(this,"selfModel");d(this,"stateAnimationModel");d(this,"animationSequence",new Array);d(this,"animationLoopAfterSequence",new Array)}get target(){var e,t;return((e=this.animator)==null?void 0:e.gameObject)||((t=this.animation)==null?void 0:t.gameObject)}start(){gx(this.gameObject)}onPointerClick(e){var t;e.use(),this.target&&this.stateName&&((t=this.animator)==null||t.play(this.stateName,0,0,.1))}createBehaviours(e,t,i){t.uuid===this.gameObject.uuid&&(this.selfModel=t)}afterSerialize(){if(lc.rootsWithExclusivePlayback.size>1){const e='Multiple root objects targeted by more than one animation. To work around QuickLook bug FB13410767, animations will be set as "exclusive" and activating them will stop other animations being marked as exclusive.';nt()&&Fi(e),console.warn(e,...lc.rootsWithExclusivePlayback)}lc.animationActions=[],lc.rootsWithExclusivePlayback=new Set}afterCreateDocument(e,t){if(this.animationSequence===void 0&&this.animationLoopAfterSequence===void 0||!this.stateAnimationModel||!this.target)return;const i=t.document,n=t.extensions.find(a=>a instanceof cx);if(!n)return;const r=n.getClipCount(this.target)>1;r&&(nt()&&console.warn("Setting exclusive playback for "+this.target.name+"@"+this.stateName+" because it has "+n.getClipCount(this.target)+" animations. This works around QuickLook bug FB13410767."),lc.rootsWithExclusivePlayback.add(this.target));const o=this.name?this.name:"";i.traverse(a=>{var l,c;if(a.uuid===((l=this.target)==null?void 0:l.uuid)){const h=lc.getActionForSequences(a,this.animationSequence,this.animationLoopAfterSequence),u=new cs(this.trigger+"_"+o+"_toPlayAnimation_"+this.stateName+"_on_"+((c=this.target)==null?void 0:c.name),this.trigger=="tap"?Qs.tapTrigger(this.selfModel):Qs.sceneStartTrigger(),h);r&&u.makeExclusive(!0),e.addBehavior(u)}})}static getActionForSequences(e,t,i){const n=(o,a)=>{let l=lc.animationActions.find(c=>c.affectedObjects==o&&c.start==a.start&&c.duration==a.duration&&c.animationSpeed==a.speed);return l||(l=Ai.startAnimationAction(o,a.start,a.duration,a.speed),lc.animationActions.push(l)),l},r=Ai.sequence();if(t&&t.length>0)for(const o of t)r.addAction(n(e,o));if(i&&i.length>0){const o=r.actions.length==0?r:Ai.sequence();for(const a of i)o.addAction(n(e,a));o.makeLooping(),r!==o&&r.addAction(o)}return r}static getAndRegisterAnimationSequences(e,t,i){var p,m,v,g,y;if(!t)return;const n=t.getComponent(vr),r=t.getComponent(Wr);if(!n&&!r)return;if(n&&!i)throw new Error("PlayAnimationOnClick: No stateName specified for animator "+n.name+" on "+t.name);let o=[],a=[];if(r){const A=e.registerAnimation(t,r.clip);return A&&(r.loop?a.push(A):o.push(A)),{animationSequence:o,animationLoopAfterSequence:a}}const l=n==null?void 0:n.runtimeAnimatorController;let c=l==null?void 0:l.findState(i),h=[],u=[];if(l&&c){const A=new Array;A.push(c);let _=!1;for(;A.length<100;){if(!c||c===null||!c.transitions||c.transitions.length===0){(p=c.motion)!=null&&p.isLooping&&(_=!0);break}const b=c.transitions.find(E=>E.conditions.length===0),x=b?l.getState(b.destinationState,0):null;if(x&&A.includes(x)){c=x,_=!0;break}else if(b){if(c=x,!c)break;A.push(c)}else{_=((m=c.motion)==null?void 0:m.isLooping)??!1;break}}if(_&&c){const b=A.indexOf(c);h=A.slice(0,b),u=A.slice(b),uH&&console.log("found loop from "+i,"states until loop",h,"states looping",u)}else h=A,u=[],uH&&console.log("found no loop from "+i,"states",h)}if(h.length===1&&(!((v=h[0].motion)!=null&&v.clip)||((y=(g=h[0].motion)==null?void 0:g.clip.tracks)==null?void 0:y.length)===0)){o=new Array;const A=e.registerAnimation(t,null);A&&o.push(A);return}if(h=h.filter(A=>{var _,b,x;return((_=A.motion)==null?void 0:_.clip)&&((x=(b=A.motion)==null?void 0:b.clip.tracks)==null?void 0:x.length)>0}),u=u.filter(A=>{var _,b,x;return((_=A.motion)==null?void 0:_.clip)&&((x=(b=A.motion)==null?void 0:b.clip.tracks)==null?void 0:x.length)>0}),h.length===0&&u.length===0){console.warn("No clips found for state "+i+" on "+(n==null?void 0:n.name)+", can't export animation data");return}const f=(A,_)=>{if(!t)return;const b=e.registerAnimation(t,A.motion.clip??null);b?(b.speed=A.speed,_.push(b)):console.warn("Couldn't register animation for state "+A.name+" on "+(n==null?void 0:n.name))};if(h.length>0){o=new Array;for(const A of h)f(A,o)}if(u.length>0){a=new Array;for(const A of u)f(A,a)}return{animationSequence:o,animationLoopAfterSequence:a}}createAnimation(e,t,i){if(!this.target||!this.animator&&!this.animation)return;const n=lc.getAndRegisterAnimationSequences(e,this.target,this.stateName);n&&(this.animationSequence=n.animationSequence,this.animationLoopAfterSequence=n.animationLoopAfterSequence,this.stateAnimationModel=t)}},d(OC,"animationActions",[]),d(OC,"rootsWithExclusivePlayback",new Set),OC);let cm=lc;Dn([C(vr)],cm.prototype,"animator",2);Dn([C()],cm.prototype,"stateName",2);class jv extends Ie{constructor(){super(...arguments);d(this,"target")}getType(){}getDuration(){}}Dn([C(ye)],jv.prototype,"target",2);class yx extends Ie{constructor(){super(...arguments);d(this,"target")}}Dn([C(jv)],yx.prototype,"target",2);class vx extends jv{constructor(){super(...arguments);d(this,"type",1);d(this,"duration",1)}getType(){switch(this.type){case 1:return"hide";case 0:return"show"}}getDuration(){return this.duration}}Dn([C()],vx.prototype,"type",2);Dn([C()],vx.prototype,"duration",2);class OF extends yx{}var o0e=Object.defineProperty,a0e=Object.getOwnPropertyDescriptor,pu=(s,e,t,i)=>{for(var n=i>1?void 0:i?a0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&o0e(e,t,n),n};const dH=ie("debugcharactercontroller");class Im extends Ie{constructor(){super(...arguments);d(this,"center",new S(0,0,0));d(this,"radius",.5);d(this,"height",2);d(this,"_rigidbody",null);d(this,"_activeGroundCollisions");d(this,"_contactVelocity",new S)}get rigidbody(){return this._rigidbody?this._rigidbody:(this._rigidbody=this.gameObject.getComponent(Ni),this._rigidbody||(this._rigidbody=this.gameObject.addNewComponent(Ni)),this.rigidbody)}awake(){this._activeGroundCollisions=new Set}onEnable(){const t=this.rigidbody;let i=this.gameObject.getComponent(au);i||(i=this.gameObject.addNewComponent(au)),i.center.copy(this.center),i.radius=this.radius,i.height=this.height;const n=new S(0,0,1),r=new S(1,0,0),o=new S(0,1,0),a=this.gameObject.getWorldDirection(new S);a.y=0;const l=r.dot(a)<0?-1:1,c=n.angleTo(a)*l;this.gameObject.setRotationFromAxisAngle(o,c),t.lockRotationX=!0,t.lockRotationY=!0,t.lockRotationZ=!0}move(t){this.gameObject.position.add(t)}onCollisionEnter(t){(t.contacts.length==0||t.contacts.some(i=>i.normal.y>.2))&&(this._activeGroundCollisions.add(t),dH&&console.log(`Collision(${this._activeGroundCollisions.size}): ${t.contacts.map(i=>i.normal.y.toFixed(2)).join(", ")} - ${this.isGrounded}`))}onCollisionExit(t){this._activeGroundCollisions.delete(t),dH&&console.log(`Collision(${this._activeGroundCollisions.size}) - ${this.isGrounded}`)}get isGrounded(){return this._activeGroundCollisions.size>0}get contactVelocity(){var t;this._contactVelocity.set(0,0,0);for(const i of this._activeGroundCollisions){const n=(t=this.context.physics.engine)==null?void 0:t.getLinearVelocity(i.collider);n&&(this._contactVelocity.x+=n.x,this._contactVelocity.y+=n.y,this._contactVelocity.z+=n.z)}return this._contactVelocity}}pu([C(S)],Im.prototype,"center",2);pu([C()],Im.prototype,"radius",2);pu([C()],Im.prototype,"height",2);class mu extends Ie{constructor(){super(...arguments);d(this,"controller");d(this,"movementSpeed",2);d(this,"rotationSpeed",2);d(this,"jumpForce",1);d(this,"doubleJumpForce",2);d(this,"animator");d(this,"lookForward",!0);d(this,"lookInput",new ee(0,0));d(this,"moveInput",new ee(0,0));d(this,"jumpInput",!1);d(this,"_currentSpeed",new S(0,0,0));d(this,"_currentAngularSpeed",new S(0,0,0));d(this,"_temp",new S(0,0,0));d(this,"_jumpCount",0);d(this,"_currentRotation");d(this,"_raycastOptions",new zc)}awake(){this._currentRotation=new Ce}update(){const t=this.context.input;t.isKeyPressed("KeyW")?this.moveInput.y+=1:t.isKeyPressed("KeyS")&&(this.moveInput.y-=1),t.isKeyPressed("KeyD")?this.lookInput.x+=1:t.isKeyPressed("KeyA")&&(this.lookInput.x-=1),this.jumpInput||(this.jumpInput=t.isKeyDown("Space"))}move(t){this.moveInput.add(t)}look(t){this.lookInput.add(t)}jump(){this.jumpInput=!0}onBeforeRender(){this.handleInput(this.moveInput,this.lookInput,this.jumpInput),this.lookInput.set(0,0),this.moveInput.set(0,0),this.jumpInput=!1}handleInput(t,i,n){var r,o,a,l,c,h,u,f,p,m,v;if((r=this.controller)!=null&&r.isGrounded&&(this._jumpCount=0,this.doubleJumpForce>0&&((o=this.animator)==null||o.setBool("doubleJump",!1))),this._currentSpeed.z+=t.y*this.movementSpeed*this.context.time.deltaTime,(a=this.animator)==null||a.setBool("running",t.length()>.01),(c=this.animator)==null||c.setBool("jumping",((l=this.controller)==null?void 0:l.isGrounded)===!0&&n),this._temp.copy(this._currentSpeed),this._temp.applyQuaternion(this.gameObject.quaternion),this.controller?this.controller.move(this._temp):this.gameObject.position.add(this._temp),this._currentAngularSpeed.y+=it.toRadians(-i.x*this.rotationSpeed)*this.context.time.deltaTime,this.lookForward&&Math.abs(this._currentAngularSpeed.y)<.01){const g=this.context.mainCameraComponent.forward;g.y=0,g.normalize(),this._currentRotation.setFromUnitVectors(new S(0,0,1),g),this.gameObject.quaternion.slerp(this._currentRotation,this.context.time.deltaTime*10)}if(this.gameObject.rotateY(this._currentAngularSpeed.y),this._currentSpeed.multiplyScalar(1-this.context.time.deltaTime*10),this._currentAngularSpeed.y*=1-this.context.time.deltaTime*10,this.controller&&n&&this.jumpForce>0){let g=(h=this.controller)==null?void 0:h.isGrounded;if(this.doubleJumpForce>0&&!((u=this.controller)!=null&&u.isGrounded)&&this._jumpCount===1&&(g=!0,(f=this.animator)==null||f.setBool("doubleJump",!0)),g){this._jumpCount+=1;const y=this.controller.rigidbody,A=this._jumpCount===2?this.doubleJumpForce:this.jumpForce;y.applyImpulse(new S(0,1,0).multiplyScalar(A))}}if(this.controller){const g=(p=this.controller)==null?void 0:p.rigidbody.getVelocity().y;if(g<-1){this._raycastOptions.ray||(this._raycastOptions.ray=new _o),this._raycastOptions.ray.origin.copy(Ft(this.gameObject)),this._raycastOptions.ray.direction.set(0,-1,0);const y=this.layer;this.gameObject.layers.disableAll(),this.gameObject.layers.set(2);const A=this.context.physics.raycast(this._raycastOptions);this.gameObject.layers.set(y),(A.length&&A[0].distance>2||g<-10)&&((m=this.animator)==null||m.setBool("falling",!0))}else(v=this.animator)==null||v.setBool("falling",!1)}}}pu([C(Im)],mu.prototype,"controller",2);pu([C()],mu.prototype,"movementSpeed",2);pu([C()],mu.prototype,"rotationSpeed",2);pu([C()],mu.prototype,"jumpForce",2);pu([C()],mu.prototype,"doubleJumpForce",2);pu([C(vr)],mu.prototype,"animator",2);var l0e=Object.defineProperty,c0e=Object.getOwnPropertyDescriptor,h0e=(s,e,t,i)=>{for(var n=i>1?void 0:i?c0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&l0e(e,t,n),n};class Ax extends Sr{constructor(){super(...arguments);d(this,"intensity",new Ze(0))}get typeName(){return"ChromaticAberration"}onCreateEffect(){const t=new jQ;return t.offset=new ee(0,0),t.radialModulation=!0,t.modulationOffset=.15,this.intensity.valueProcessor=i=>i*.02,this.intensity.onValueChanged=i=>{t.offset.x=-i,t.offset.y=i},t}}h0e([C(Ze)],Ax.prototype,"intensity",2);dl("ChromaticAberration",Ax);var u0e=Object.defineProperty,d0e=Object.getOwnPropertyDescriptor,X7=(s,e,t,i)=>{for(var n=i>1?void 0:i?d0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&u0e(e,t,n),n};const fH=ie("debugpost");var A1=(s=>(s[s.None=0]="None",s[s.Neutral=1]="Neutral",s[s.ACES=2]="ACES",s[s.AgX=3]="AgX",s[s.KhronosNeutral=4]="KhronosNeutral",s))(A1||{});function PP(s){switch(s){case 0:return mv;case 1:return wb;case 2:return Sb;case 3:return gv;case 4:return Jp;default:return Jp}}function f0e(s){switch(s){case mv:return 0;case Sb:return 2;case gv:return 3;case Jp:return 1;case wb:return 1;default:return 0}}function pH(s){switch(s){case mv:return Us.LINEAR;case Sb:return Us.ACES_FILMIC;case gv:return Us.AGX;case Jp:return Us.NEUTRAL;case wb:return Us.REINHARD;default:return Us.LINEAR}}const Y7=class extends Sr{constructor(){super(...arguments);d(this,"mode",new Ze(void 0));d(this,"exposure",new Ze(1))}get typeName(){return"ToneMapping"}setMode(e){const t=A1[e];return t===void 0?(console.error("Invalid ToneMapping mode",e),this):(this.mode.value=t,this)}get isToneMapping(){return!0}onEffectEnabled(){const e=B7(this);e&&super.onEffectEnabled(e)}onCreateEffect(){if(this.postprocessingContext)for(const i of this.postprocessingContext.components){if(i===this)break;if(i!=this&&i instanceof Y7){console.warn("Multiple tonemapping effects found in the same postprocessing stack: Please check your scene setup.",{activeEffect:i,ignoredEffect:this});return}}if(this.mode.isInitialized==!1){const i=f0e(this.context.renderer.toneMapping);this.mode.initialize(i)}const e=PP(this.mode.value),t=new K1({mode:pH(e)});return this.mode.onValueChanged=i=>{const n=PP(i);t.mode=pH(n),fH&&console.log("ToneMapping mode changed to",A1[i],n,t.mode)},fH&&console.log("Use ToneMapping",A1[this.mode.value],e,t.mode,"renderer.tonemapping: "+this.context.renderer.toneMapping),this.exposure.onValueChanged=i=>{this.context.renderer.toneMappingExposure=i},t}onBeforeRender(){this.mode.overrideState&&(this.context.renderer.toneMapping=PP(this.mode.value)),this.exposure.overrideState&&(this.context.renderer.toneMappingExposure=this.exposure.value)}};let Kd=Y7;X7([C(Ze)],Kd.prototype,"mode",2);X7([C(Ze)],Kd.prototype,"exposure",2);dl("Tonemapping",Kd);var p0e=Object.defineProperty,m0e=Object.getOwnPropertyDescriptor,bT=(s,e,t,i)=>{for(var n=i>1?void 0:i?m0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&p0e(e,t,n),n};class pf extends Sr{constructor(){super(...arguments);d(this,"postExposure",new Ze(0));d(this,"contrast",new Ze(0));d(this,"hueShift",new Ze(0));d(this,"saturation",new Ze(0))}get typeName(){return"ColorAdjustments"}init(){this.postExposure.valueProcessor=t=>(t=Math.pow(2,t),t),this.contrast.valueProcessor=t=>{let i=1;return t>0?i=200:t<0&&(i=100),t/i},this.contrast.defaultValue=0,this.hueShift.valueProcessor=t=>Math.PI*t/180,this.hueShift.defaultValue=0,this.saturation.valueProcessor=t=>t<0?t/100:t/(100*Math.PI),this.saturation.defaultValue=0}onCreateEffect(){var o,a;const t=[];this.context.renderer.toneMapping!==po&&this.postExposure.overrideState&&(this.context.renderer.toneMapping=po);let i=(o=this.postprocessingContext)==null?void 0:o.components.find(l=>l instanceof Kd);i||(i=new Kd,(a=this.postprocessingContext)==null||a.components.push(i)),this.postExposure.onValueChanged=l=>{this.postExposure.overrideState&&(i.exposure.value=l)};const n=new WQ;this.contrast.onValueChanged=l=>n.contrast=l;const r=new KQ;return t.push(n),t.push(r),this.hueShift.onValueChanged=l=>r.hue=l,this.saturation.onValueChanged=l=>r.saturation=l,t}}bT([C(Ze)],pf.prototype,"postExposure",2);bT([C(Ze)],pf.prototype,"contrast",2);bT([C(Ze)],pf.prototype,"hueShift",2);bT([C(Ze)],pf.prototype,"saturation",2);dl("ColorAdjustments",pf);const g0e=(Math.sqrt(5)-1)/4,Zs=(5-Math.sqrt(5))/20,QS=s=>Math.floor(s)|0,WS=new Float64Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function y0e(s=Math.random){const e=v0e(s),t=new Float64Array(e).map(o=>WS[o%32*4]),i=new Float64Array(e).map(o=>WS[o%32*4+1]),n=new Float64Array(e).map(o=>WS[o%32*4+2]),r=new Float64Array(e).map(o=>WS[o%32*4+3]);return function(a,l,c,h){let u,f,p,m,v;const g=(a+l+c+h)*g0e,y=QS(a+g),A=QS(l+g),_=QS(c+g),b=QS(h+g),x=(y+A+_+b)*Zs,E=y-x,M=A-x,T=_-x,R=b-x,w=a-E,I=l-M,O=c-T,k=h-R;let B=0,G=0,L=0,U=0;w>I?B++:G++,w>O?B++:L++,w>k?B++:U++,I>O?G++:L++,I>k?G++:U++,O>k?L++:U++;const z=B>=3?1:0,j=G>=3?1:0,X=L>=3?1:0,re=U>=3?1:0,ce=B>=2?1:0,Me=G>=2?1:0,se=L>=2?1:0,ve=U>=2?1:0,xe=B>=1?1:0,Fe=G>=1?1:0,Ge=L>=1?1:0,je=U>=1?1:0,lt=w-z+Zs,ot=I-j+Zs,q=O-X+Zs,He=k-re+Zs,we=w-ce+2*Zs,Ne=I-Me+2*Zs,Ee=O-se+2*Zs,st=k-ve+2*Zs,et=w-xe+3*Zs,ct=I-Fe+3*Zs,zt=O-Ge+3*Zs,V=k-je+3*Zs,F=w-1+4*Zs,ge=I-1+4*Zs,_e=O-1+4*Zs,Pe=k-1+4*Zs,Te=y&255,xt=A&255,ft=_&255,Le=b&255;let Qe=.6-w*w-I*I-O*O-k*k;if(Qe<0)u=0;else{const Xe=Te+e[xt+e[ft+e[Le]]];Qe*=Qe,u=Qe*Qe*(t[Xe]*w+i[Xe]*I+n[Xe]*O+r[Xe]*k)}let St=.6-lt*lt-ot*ot-q*q-He*He;if(St<0)f=0;else{const Xe=Te+z+e[xt+j+e[ft+X+e[Le+re]]];St*=St,f=St*St*(t[Xe]*lt+i[Xe]*ot+n[Xe]*q+r[Xe]*He)}let ke=.6-we*we-Ne*Ne-Ee*Ee-st*st;if(ke<0)p=0;else{const Xe=Te+ce+e[xt+Me+e[ft+se+e[Le+ve]]];ke*=ke,p=ke*ke*(t[Xe]*we+i[Xe]*Ne+n[Xe]*Ee+r[Xe]*st)}let ni=.6-et*et-ct*ct-zt*zt-V*V;if(ni<0)m=0;else{const Xe=Te+xe+e[xt+Fe+e[ft+Ge+e[Le+je]]];ni*=ni,m=ni*ni*(t[Xe]*et+i[Xe]*ct+n[Xe]*zt+r[Xe]*V)}let pt=.6-F*F-ge*ge-_e*_e-Pe*Pe;if(pt<0)v=0;else{const Xe=Te+1+e[xt+1+e[ft+1+e[Le+1]]];pt*=pt,v=pt*pt*(t[Xe]*F+i[Xe]*ge+n[Xe]*_e+r[Xe]*Pe)}return 27*(u+f+p+m+v)}}function v0e(s){const t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){const n=i+~~(s()*(256-i)),r=t[i];t[i]=t[n],t[n]=r}for(let i=256;i<512;i++)t[i]=t[i-256];return t}const BP=ie("debugstencil");function A0e(s,e){return(s&1<<e.layer)!=0}const _0e=Symbol("stencils"),vp=class{constructor(e,t){d(this,"parser");d(this,"source");this.parser=e,this.source=t}get name(){return"NEEDLE_render_objects"}static applyStencil(e){if(!e)return;const t=e.sourceId;if(BP&&console.log(t,vp.stencils),!t)return;const i=vp.stencils[t];if(i)for(let n=i.length-1;n>=0;n--){const r=i[n];if(A0e(r.layer,e)){BP&&console.log(r),setTimeout(()=>{yo()&&ZM(e.gameObject)&&(Fi("Stencil not supported on instanced objects"),console.warn("Stencil not supported on instanced objects",e))},500);for(let o=0;o<e.sharedMaterials.length;o++){let a=e.sharedMaterials[o];a&&(a=a.clone(),a[_0e]=!0,a.stencilWrite=!0,a.stencilWriteMask=255,a.stencilFuncMask=255,a.stencilRef=r.value,a.stencilFunc=r.compareFunc,a.stencilZPass=r.passOp,a.stencilFail=r.failOp,a.stencilZFail=r.zFailOp,e.sharedMaterials[o]=a)}e.gameObject.renderOrder=r.event*1e3+r.index*50;break}}}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[x0e];if(i){BP&&console.log(i);const n=i.stencil;if(n&&Array.isArray(n))for(const r of n){const o={...r};o.compareFunc=b0e(o.compareFunc),o.passOp=DP(o.passOp),o.failOp=DP(o.failOp),o.zFailOp=DP(o.zFailOp),vp.stencils[this.source]||(vp.stencils[this.source]=[]),vp.stencils[this.source].push(o)}}}return null}};let h_=vp;d(h_,"stencils",{});function DP(s){switch(s){case 0:return sd;case 1:return J5;case 2:return Z5;case 3:return $5;case 4:return e8;case 6:return t8;case 7:return i8;case 5:return n8}return 0}function b0e(s){switch(s){case 1:return m2;case 2:return s8;case 3:return r8;case 4:return o8;case 5:return a8;case 6:return l8;case 7:return c8;case 8:return O1}return m2}const x0e="NEEDLE_render_objects";var w0e=Object.defineProperty,S0e=Object.getOwnPropertyDescriptor,K7=(s,e,t,i)=>{for(var n=i>1?void 0:i?S0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&w0e(e,t,n),n};const Y0=ie("debugreflectionprobe"),mH=ie("noreflectionprobe"),C0e=Symbol("reflectionProbeKey"),E0e=Symbol("original material");var LC;const Mh=(LC=class extends Ie{constructor(){var e;super();d(this,"_texture");d(this,"center");d(this,"size");d(this,"_boxHelper");Mh._probes.has(this.context)||Mh._probes.set(this.context,[]),(e=Mh._probes.get(this.context))==null||e.push(this)}static get(e,t,i,n){if(!e||e.isObject3D!==!0||mH)return null;const r=Mh._probes.get(t);if(r){for(const o of r)if(o.__didAwake||o.__internalAwake(),o.enabled){if(n){if(o.gameObject===n)return o}else if(o.isInBox(e,void 0))return Y0&&console.log("Found reflection probe",e.name,o.name),o}}return Y0&&console.debug("Did not find reflection probe",e.name,i,e),null}set texture(e){if(e&&!(e instanceof Wt)){console.error("ReflectionProbe.texture must be a Texture",e);return}this._texture=e,e&&(e.mapping=mo,e.colorSpace=bt,e.needsUpdate=!0)}get texture(){return this._texture}isInBox(e,t){var i;return(i=this._boxHelper)==null?void 0:i.isInBox(e,t)}awake(){this._boxHelper=this.gameObject.addNewComponent(el),this._boxHelper.updateBox(!0),Y0&&this._boxHelper.showHelper(5592320,!0),this.texture&&(this.texture.mapping=mo,this.texture.colorSpace=bt,this.texture.needsUpdate=!0)}onDestroy(){const e=Mh._probes.get(this.context);if(e){const t=e.indexOf(this);t>=0&&e.splice(t,1)}}onSet(e){var i;if(mH||!this.enabled||((i=e.sharedMaterials)==null?void 0:i.length)<=0||!this.texture)return;let t=Mh._rendererMaterialsCache.get(e);t||(t=[],Mh._rendererMaterialsCache.set(e,t));for(let n=0;n<e.sharedMaterials.length;n++){const r=e.sharedMaterials[n];if(!r||r.envMap===void 0||r instanceof ti)continue;let o=t[n];const a=r===(o==null?void 0:o.copy),l=!o||o.material.uuid!==r.uuid||o.copy.version!==r.version;if(!a&&l){if(Y0){let u="";o?o.material!==r?u="reference changed; cached instance?: "+a:o.copy.version!==r.version&&(u="version changed"):u="not cached",console.warn("Cloning material",r.name,r.version,"Reason:",u,`
`,r.uuid,`
`,o==null?void 0:o.copy.uuid,`
`,e.name)}const h=r.clone();h.version=r.version,o?(o.copy=h,o.material=r):(o={material:r,copy:h},t.push(o)),h[C0e]=this,h[E0e]=r,Y0&&console.log("Set reflection",e.name,e.guid)}o&&o.copy&&(o.copy.onBeforeCompile=r.onBeforeCompile);const c=o==null?void 0:o.copy;c.envMap=this.texture,e.sharedMaterials[n]=c}}onUnset(e){const t=Mh._rendererMaterialsCache.get(e);if(t)for(let i=0;i<t.length;i++){const n=t[i];e.sharedMaterials[i]=n.material}}},d(LC,"_probes",new Map),d(LC,"_rendererMaterialsCache",new Map),LC);let qv=Mh;K7([C(S)],qv.prototype,"center",2);K7([C(S)],qv.prototype,"size",2);const OP=ie("debugexr");class M0e{constructor(e){d(this,"parser");this.parser=e,OP&&console.log(e)}get name(){return"EXT_texture_exr"}loadTexture(e){const t=this.name,i=this.parser,r=i.json.textures[e];if(OP&&console.log("EXT_texture_exr.loadTexture",e,r),!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=new eb(i.options.manager);return OP&&console.log("EXT_texture_exr.loadTexture",o),i.loadTextureImage(e,o.source,a)}}typeof window<"u"&&window.addEventListener("unhandledrejection",s=>{});const bh=Hs,jS="$___Export_Components",T0e="NEEDLE_components";var tEe;class I0e{constructor(){d(this,tEe)}}tEe=fp;class R0e{constructor(e,t,i){d(this,"node");d(this,"nodeIndex");d(this,"nodeDef");this.node=e,this.nodeIndex=t,this.nodeDef=i}}class P0e{constructor(){d(this,"parser");d(this,"nodeToObjectMap",{});d(this,"exportContext");d(this,"objectToNodeMap",{});d(this,"context");d(this,"writer")}get name(){return T0e}registerExport(e){e.register(t=>{if("serializeUserData"in t){const i=t.serializeUserData.bind(t);this.writer=t,t.serializeUserData=(n,r)=>{try{this.serializeUserData(n,r),i(n,r)}finally{this.afterSerializeUserData(n,r)}}}return this})}beforeParse(){this.exportContext={},this.objectToNodeMap={}}serializeUserData(e,t){var n;const i=(n=e.userData)==null?void 0:n.components;!i||i.length<=0||(delete e.userData.components,e[jS]=i)}afterSerializeUserData(e,t){if(e.type==="Scene"&&bh&&console.log("DONE",JSON.stringify(t)),e[jS]===void 0)return;const i=e[jS];delete e[jS],i!==null&&(e.userData.components=i)}writeNode(e,t){const i=this.writer.json.nodes.length;bh&&console.log(e.name,i,e.uuid);const n=new R0e(e,i,t);this.exportContext[i]=n,this.objectToNodeMap[e.uuid]=i}afterParse(e){var t;bh&&console.log("AFTER",e);for(const i in this.exportContext){const n=this.exportContext[i],r=n.node,o=n.nodeDef,a=n.nodeIndex,l=(t=r.userData)==null?void 0:t.components;if(!l||l.length<=0)continue;const c=new I0e;o.extensions=o.extensions||{},o.extensions[this.name]=c,this.context.object=r,this.context.nodeId=a,this.context.objectToNode=this.objectToNodeMap;const h=[];for(const u of l){this.context.target=u;const f=Gl().writeBuiltinComponentData(u,this.context);f!==null&&h.push(f)}h.length>0&&(c[fp]=h,bh&&console.log("DID WRITE",r,"nodeIndex",a,h))}}beforeRoot(){return bh&&console.log("BEGIN LOAD"),this.nodeToObjectMap={},null}async afterRoot(e){const t=e.parser,i=t==null?void 0:t.extensions;if(!i)return;const n=i[this.name];bh&&console.log("After root",e,this.parser,i);const r=[];if(n===!0){const o=t.json.nodes;if(o){for(let a=0;a<o.length;a++){const l=await t.getDependency("node",a);this.nodeToObjectMap[a]=l}for(let a=0;a<o.length;a++){const l=o[a],c=a,h=l.extensions;if(!h)continue;const u=h[this.name];if(!u)continue;bh&&console.log("NODE",l);const f=this.nodeToObjectMap[c];if(!f){console.error("Could not find object for node index: "+c,l,t);continue}JM(f),r.push(this.createComponents(f,u))}}}await Promise.all(r);for(const o of t.associations.keys()){const a=t.associations.get(o);if((a==null?void 0:a.materials)!=null){const l="/materials/"+a.materials;Bfe(o,l)}}}async createComponents(e,t){if(!t)return;const i=t[fp];if(i){const n=new Array;bh&&console.log(e.name,i);for(const r in i){const o=i[r];bh&&console.log("Serialized data",JSON.parse(JSON.stringify(o))),o&&this.parser&&n.push(jk(this.parser,o).catch(a=>console.error(`Error while resolving references (see console for details)
`,a,e,o))),e.userData=e.userData||{},e.userData[fp]=e.userData[fp]||[],e.userData[fp].push(o)}await Promise.all(n).catch(r=>{console.error("Error while loading components",r)})}}}const gH="NEEDLE_gameobject_data";class B0e{constructor(e){d(this,"parser");this.parser=e}get name(){return gH}afterRoot(e){var i;const t=[];for(let n=0;n<((i=this.parser.json.nodes)==null?void 0:i.length);n++){const r=this.parser.json.nodes[n];if(r&&r.extensions){const o=r.extensions[gH];if(o){const a=this.findAndApplyExtensionData(n,o);t.push(a)}}}return Promise.all(t).then(()=>null)}async findAndApplyExtensionData(e,t){const i=await this.parser.getDependency("node",e);i&&this.applyExtensionData(i,t)}applyExtensionData(e,t){t.layers===void 0&&(t.layers=0),e.userData.layer=t.layers,e.layers.disableAll(),e.layers.set(t.layers),e.userData.tag=t.tag??"none",e.userData.hideFlags=t.hideFlags??0,e.userData.static=t.static??!1,e.visible=t.activeSelf??!0,e.guid=t.guid}}const yH="NEEDLE_lighting_settings",oy=ie("debugenvlight");class D0e{constructor(e,t,i){d(this,"parser");d(this,"sourceId");d(this,"context");this.parser=e,this.sourceId=t,this.context=i}get name(){return yH}afterRoot(e){const t=this.parser.json.extensions;if(t){const i=t[yH];if(i){oy&&console.log('Loaded "'+this.name+'", src: "'+this.sourceId+'"',i);let n;if(e.scene.children.length===1){const r=e.scene.children[0];n=ne.addNewComponent(r,bE,{},!1)}else{const r=new ye;r.name="LightSettings "+this.sourceId,e.scene.add(r),n=ne.addNewComponent(r,bE,{},!1)}n.sourceId=this.sourceId,n.ambientIntensity=i.ambientIntensity,n.ambientLight=new Ae().fromArray(i.ambientLight),Array.isArray(i.ambientTrilight)&&(n.ambientTrilight=i.ambientTrilight.map(r=>new Ae().fromArray(r))),n.ambientMode=i.ambientMode,n.environmentReflectionSource=i.environmentReflectionSource}}return null}}mi.registerCallback(Ti.ContextCreated,s=>{const e=s.context,t=ne.findObjectOfType(bE,e);t!=null&&t.sourceId&&(t.enabled=!0)});class bE extends Ie{constructor(){super(...arguments);d(this,"ambientMode",zy.Skybox);d(this,"ambientLight");d(this,"ambientTrilight");d(this,"ambientIntensity",1);d(this,"environmentReflectionSource",mE.Skybox);d(this,"_hasReflection",!1);d(this,"_ambientLightObj");d(this,"_hemisphereLightObj")}awake(){var i;if(this.sourceId){const n=this.environmentReflectionSource===mE.Skybox?_d.Skybox:_d.Reflection,r=this.context.lightmaps.tryGet(this.sourceId,n,0);this._hasReflection=r!=null,r&&this.context.sceneLighting.internalRegisterReflection(this.sourceId,r)}this.enabled=!1,this.context.sceneLighting.internalRegisterSceneLightSettings(this),oy&&window.addEventListener("keydown",n=>{if(!this.destroyed)switch(n.key){case"l":this.enabled=!this.enabled;break}});const t=(i=this.gameObject.userData)==null?void 0:i.components;if(t){const n=t.indexOf(this);t.splice(n,1),t.push(this)}}onDestroy(){this.context.sceneLighting.internalUnregisterSceneLightSettings(this)}calculateIntensityFactor(t){const i=Math.max(t.r,t.g,t.b);return 2.2*it.lerp(0,1.33,i)}onEnable(){if(oy&&console.warn(" >>> Enable lighting",this.sourceId,this.enabled,this),this.ambientMode==zy.Flat){if(this.ambientLight&&!this._ambientLightObj){const t=this.calculateIntensityFactor(this.ambientLight);this._ambientLightObj=new AM(this.ambientLight,this.ambientIntensity*t),oy&&console.log("Created ambient light",this.sourceId,this._ambientLightObj,this.ambientIntensity,t)}this._ambientLightObj&&this.gameObject.add(this._ambientLightObj)}else if(this.ambientMode===zy.Trilight){if(this.ambientTrilight){const t=this.ambientTrilight[0],i=this.ambientTrilight[this.ambientTrilight.length-1],n=this.calculateIntensityFactor(i);this._hemisphereLightObj=new pL(i,t,this.ambientIntensity*n),this.gameObject.add(this._hemisphereLightObj),oy&&console.log("Created hemisphere ambient light",this.sourceId,this._hemisphereLightObj,this.ambientIntensity,n)}}else this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent();this.sourceId&&this.context.sceneLighting.internalEnableReflection(this.sourceId)}onDisable(){oy&&console.warn(" <<< Disable lighting:",this.sourceId,this),this._ambientLightObj&&this._ambientLightObj.removeFromParent(),this._hemisphereLightObj&&this._hemisphereLightObj.removeFromParent(),this.sourceId&&this.context.sceneLighting.internalDisableReflection(this.sourceId)}}var J7=(s=>(s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_VEC2=35664]="FLOAT_VEC2",s[s.FLOAT_VEC3=35665]="FLOAT_VEC3",s[s.FLOAT_VEC4=35666]="FLOAT_VEC4",s[s.INT_VEC2=35667]="INT_VEC2",s[s.INT_VEC3=35668]="INT_VEC3",s[s.INT_VEC4=35669]="INT_VEC4",s[s.BOOL=35670]="BOOL",s[s.BOOL_VEC2=35671]="BOOL_VEC2",s[s.BOOL_VEC3=35672]="BOOL_VEC3",s[s.BOOL_VEC4=35673]="BOOL_VEC4",s[s.FLOAT_MAT2=35674]="FLOAT_MAT2",s[s.FLOAT_MAT3=35675]="FLOAT_MAT3",s[s.FLOAT_MAT4=35676]="FLOAT_MAT4",s[s.SAMPLER_2D=35678]="SAMPLER_2D",s[s.SAMPLER_3D=35680]="SAMPLER_3D",s[s.SAMPLER_CUBE=35681]="SAMPLER_CUBE",s[s.UNKNOWN=0]="UNKNOWN",s))(J7||{});const cd=ie("debugcustomshader"),Bg="NEEDLE_techniques_webgl";class O0e{constructor(){d(this,"objectToWorldMatrix",new le);d(this,"worldToObjectMatrix",new le);d(this,"objectToWorld",new Array);d(this,"worldToObject",new Array)}updateFrom(e){this.objectToWorldMatrix.copy(e.matrixWorld),pE(this.objectToWorldMatrix,this.objectToWorld),this.worldToObjectMatrix.copy(e.matrixWorld).invert(),pE(this.worldToObjectMatrix,this.worldToObject)}}const mn=class extends mM{constructor(t,...i){super(...i);d(this,"identifier");d(this,"onBeforeRenderSceneCallback",this.onBeforeRenderScene.bind(this));d(this,"_sphericalHarmonicsName","unity_SpecCube0");d(this,"_objToWorldName","hlslcc_mtx4x4unity_ObjectToWorld");d(this,"_worldToObjectName","hlslcc_mtx4x4unity_WorldToObject");d(this,"_viewProjectionName","hlslcc_mtx4x4unity_MatrixVP");d(this,"_viewMatrixName","hlslcc_mtx4x4unity_MatrixV");d(this,"_rendererData",new O0e);this.identifier=t,cd&&console.log(this),this.type="NEEDLE_CUSTOM_SHADER",this.uniforms[this._objToWorldName]||(this.uniforms[this._objToWorldName]={value:[]}),this.uniforms[this._worldToObjectName]||(this.uniforms[this._worldToObjectName]={value:[]}),this.uniforms[this._viewProjectionName]||(this.uniforms[this._viewProjectionName]={value:[]}),this.uniforms[this._sphericalHarmonicsName],(this.depthTextureUniform||this.opaqueTextureUniform)&&Dt.Current.pre_render_callbacks.push(this.onBeforeRenderSceneCallback)}clone(){const t=super.clone();return Z7(t),t}dispose(){super.dispose();const t=Dt.Current.pre_render_callbacks.indexOf(this.onBeforeRenderSceneCallback);t>=0&&Dt.Current.pre_render_callbacks.splice(t,1)}get depthTextureUniform(){if(this.uniforms)return this.uniforms._CameraDepthTexture}get opaqueTextureUniform(){if(this.uniforms)return this.uniforms._CameraOpaqueTexture}onBeforeRenderScene(){this.opaqueTextureUniform&&Dt.Current.setRequireColor(!0),this.depthTextureUniform&&Dt.Current.setRequireDepth(!0)}onBeforeRender(t,i,n,r,o,a){r.attributes.tangent||r.computeTangents(),this.onUpdateUniforms(n,o)}onUpdateUniforms(t,i){const n=Dt.Current;if(t&&(mn.viewProjection&&this.uniforms[this._viewProjectionName]&&(mn.viewProjection.copy(t.projectionMatrix).multiply(t.matrixWorldInverse),pE(mn.viewProjection,mn._viewProjectionValues)),mn.viewMatrix&&this.uniforms[this._viewMatrixName]&&(mn.viewMatrix.copy(t.matrixWorldInverse),pE(mn.viewMatrix,mn._viewMatrixValues)),this.uniforms[mn._worldSpaceCameraPosName]&&mn._worldSpaceCameraPos.setFromMatrixPosition(t.matrixWorld)),this.uniforms._TimeParameters&&(this.uniforms._TimeParameters.value=n.sceneLighting.timeVec4),this.uniforms._Time){const l=this.uniforms._Time.value;l.x=n.sceneLighting.timeVec4.x/20,l.y=n.sceneLighting.timeVec4.x,l.z=n.sceneLighting.timeVec4.x*2,l.w=n.sceneLighting.timeVec4.x*3}if(this.uniforms._SinTime){const l=this.uniforms._SinTime.value;l.x=Math.sin(n.sceneLighting.timeVec4.x/8),l.y=Math.sin(n.sceneLighting.timeVec4.x/4),l.z=Math.sin(n.sceneLighting.timeVec4.x/2),l.w=Math.sin(n.sceneLighting.timeVec4.x)}if(this.uniforms._CosTime){const l=this.uniforms._CosTime.value;l.x=Math.cos(n.sceneLighting.timeVec4.x/8),l.y=Math.cos(n.sceneLighting.timeVec4.x/4),l.z=Math.cos(n.sceneLighting.timeVec4.x/2),l.w=Math.cos(n.sceneLighting.timeVec4.x)}if(this.uniforms.unity_DeltaTime){const l=this.uniforms.unity_DeltaTime.value;l.x=n.time.deltaTime,l.y=1/n.time.deltaTime,l.z=n.time.smoothedDeltaTime,l.w=1/n.time.smoothedDeltaTime}const r=n.mainLight;if(r){const l=Ft(r.gameObject,mn._mainLightPosition);this.uniforms._MainLightPosition={value:l.normalize()},mn._mainLightColor.set(r.color.r,r.color.g,r.color.b,0),this.uniforms._MainLightColor={value:mn._mainLightColor};const c=r.intensity;mn._lightData.z=c,this.uniforms.unity_LightData={value:mn._lightData}}if(t&&(mn.viewProjection&&this.uniforms[this._viewProjectionName]&&(this.uniforms[this._viewProjectionName].value=mn._viewProjectionValues),mn.viewMatrix&&this.uniforms[this._viewMatrixName]&&(this.uniforms[this._viewMatrixName].value=mn._viewMatrixValues),this.uniforms[mn._worldSpaceCameraPosName]&&(this.uniforms[mn._worldSpaceCameraPosName]={value:mn._worldSpaceCameraPos}),n.mainCameraComponent)){if(this.uniforms._ProjectionParams){const l=this.uniforms._ProjectionParams.value;l.x=1,l.y=n.mainCameraComponent.nearClipPlane,l.z=n.mainCameraComponent.farClipPlane,l.w=1/l.z,this.uniforms._ProjectionParams.value=l}if(this.uniforms._ZBufferParams){const l=this.uniforms._ZBufferParams.value,c=n.mainCameraComponent;l.x=1-c.farClipPlane/c.nearClipPlane,l.y=c.farClipPlane/c.nearClipPlane,l.z=l.x/c.farClipPlane,l.w=l.y/c.farClipPlane,this.uniforms._ZBufferParams.value=l}if(this.uniforms._ScreenParams){const l=this.uniforms._ScreenParams.value;l.x=n.domWidth,l.y=n.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScreenParams.value=l}if(this.uniforms._ScaledScreenParams){const l=this.uniforms._ScaledScreenParams.value;l.x=n.domWidth,l.y=n.domHeight,l.z=1+1/l.x,l.w=1+1/l.y,this.uniforms._ScaledScreenParams.value=l}}const o=this.depthTextureUniform;o&&(o.value=n.depthTexture);const a=this.opaqueTextureUniform;if(a&&(a.value=n.opaqueColorTexture),i){const l=this._rendererData;l.updateFrom(i),this.uniforms[this._worldToObjectName].value=l.worldToObject,this.uniforms[this._objToWorldName].value=l.objectToWorld}this.uniformsNeedUpdate=!0}};let ta=mn;d(ta,"viewProjection",new le),d(ta,"_viewProjectionValues",[]),d(ta,"viewMatrix",new le),d(ta,"_viewMatrixValues",[]),d(ta,"_worldSpaceCameraPosName","_WorldSpaceCameraPos"),d(ta,"_worldSpaceCameraPos",new S),d(ta,"_mainLightColor",new Je),d(ta,"_mainLightPosition",new S),d(ta,"_lightData",new Je);class L0e{constructor(e,t){d(this,"parser");d(this,"identifier");this.parser=e,this.identifier=t}get name(){return Bg}loadMaterial(e){const t=this.parser.json.materials[e];if(!t)return cd&&console.log(e,this.parser.json.materials),null;if(!t.extensions||!t.extensions[Bg])return cd&&console.log("material "+e+" does not use NEEDLE_techniques_webgl"),null;const i=t.extensions[Bg].technique;if(i<0)return null;const n=this.parser.json.extensions[Bg];if(!n)return null;cd&&console.log(n);const r=n.techniques[i];return r?new Promise(async(o,a)=>{var y,A,_;const l=await Npe(n,r.program),c=l==null?void 0:l.fragmentShader,h=l==null?void 0:l.vertexShader;if(!c||!h)return a();cd&&console.log("loadMaterial",t,l);const u={},f=r.uniforms;(h.includes("_Time")||c.includes("_Time"))&&(u._Time={value:new Je(0,0,0,0)}),(h.includes("_SinTime")||c.includes("_SinTime"))&&(u._SinTime={value:new Je(0,0,0,0)}),(h.includes("_CosTime")||c.includes("_CosTime"))&&(u._CosTime={value:new Je(0,0,0,0)}),(h.includes("unity_DeltaTime")||c.includes("unity_DeltaTime"))&&(u.unity_DeltaTime={value:new Je(0,0,0,0)});for(const b in f){const x=b;switch(x){case"_TimeParameters":const E=new Je;u[x]={value:E};break;case"hlslcc_mtx4x4unity_MatrixV":case"hlslcc_mtx4x4unity_MatrixVP":u[x]={value:[]};break;case"_MainLightPosition":case"_MainLightColor":case"_WorldSpaceCameraPos":u[x]={value:[0,0,0,1]};break;case"unity_OrthoParams":break;case"unity_SpecCube0":u[x]={value:null};break;default:case"_ScreenParams":case"_ZBufferParams":case"_ProjectionParams":u[x]={value:[0,0,0,0]};break;case"_CameraOpaqueTexture":case"_CameraDepthTexture":u[x]={value:null};break}}let p=!1;if(t.extensions&&t.extensions[Bg]){const b=t.extensions[Bg];if(b.technique===i){cd&&console.log(t.name,"Material Properties",b);for(const x in b.values){const E=b.values[x];if(typeof E=="string"){if(E.startsWith("/textures/")){const M=E.substring(10),T=Number.parseInt(M);if(T>=0){const R=await this.parser.getDependency("texture",T);R instanceof Wt&&(R.colorSpace=zi,R.needsUpdate=!0),u[x]={value:R};continue}}switch(x){case"alphaMode":E==="BLEND"&&(p=!0);continue}}if(Array.isArray(E)&&E.length===4){u[x]={value:new Je(E[0],E[1],E[2],E[3])};continue}u[x]={value:E}}}}const m=new ta(this.identifier,{name:t.name??"",uniforms:u,vertexShader:h,fragmentShader:c,lights:!1});switch(m.glslVersion=L1,m.vertexShader=m.vertexShader.replace("#version 300 es",""),m.fragmentShader=m.fragmentShader.replace("#version 300 es",""),(y=u._Cull)==null?void 0:y.value){case 0:m.side=_i;break;case 1:m.side=bn;break;case 2:m.side=$n;break;default:m.side=$n;break}switch((A=u._ZTest)==null?void 0:A.value){case 3:m.depthTest=!0,m.depthFunc=qy;break;case 6:m.depthTest=!0,m.depthFunc=bb;break;case 2:m.depthTest=!0,m.depthFunc=x_;break;case 4:m.depthTest=!0,m.depthFunc=Kp;break;case 5:m.depthTest=!0,m.depthFunc=VE;break;case 7:m.depthTest=!0,m.depthFunc=HE;break;case 8:m.depthTest=!1,m.depthFunc=GE;break}m.transparent=p,p&&(m.depthWrite=!1),Fpe(u),m.onUpdateUniforms();for(const b in f){const x=b,E=f[b].type;if(((_=u[x])==null?void 0:_.value)===void 0)switch(E){case J7.SAMPLER_2D:u[x]={value:Lpe},console.warn("Missing/unassigned texture, fallback to white: "+x);break;default:x==="unity_OrthoParams"||console.warn("TODO: EXPECTED UNIFORM / fallback NOT SET: "+x,f[b]);break}}cd&&console.log(m.uuid,u),Z7(m),o(m)}):null}}function Z7(s){if(s.uniforms){cd&&console.log("Uniforms:",s.uniforms);for(const t in s.uniforms)switch(e(t,t),t){case"_Color":e("color",t);break}}function e(t,i){Object.getOwnPropertyDescriptor(s,t)||Object.defineProperty(s,t,{get:()=>s.uniforms[i].value,set:n=>{s.uniforms[i].value=n,s.needsUpdate=!0}})}}const k0e=ie("debugextensions");let xE;const F0e=Promise.resolve().then(()=>eEe).then(async s=>(xE=s.GLTFAnimationPointerExtension,xE)).catch(s=>{console.warn("Failed to import GLTFLoaderAnimationPointer. Please use @needle-tools/three for full KHR_animation support",s)}),hm=new Array;function U0e(s){hm.includes(s)||hm.push(s)}function N0e(s){const e=hm.indexOf(s);e>=0&&hm.splice(e,1)}function LF(s){const e=new P0e;return s.register(t=>(e.parser=t,e)),e}class z0e{resolvePath(e){return e.includes("/extensions/builtin_components/")?e.replace("/extensions/builtin_components/","/userData/components/"):e.includes("extensions/builtin_components/")?e.replace("extensions/builtin_components/","/userData/components/"):e}}async function kF(s,e,t){const i=t.indexOf("?");i>=0&&(t=t.substring(0,i)),s.register(n=>new B0e(n)),s.register(n=>new Ofe(n)),s.register(n=>new Ppe(n,e.lightmaps,t)),s.register(n=>new D0e(n,t,e)),s.register(n=>new L0e(n,t)),s.register(n=>new h_(n,t)),s.register(n=>new yi(n,t)),s.register(n=>new M0e(n)),Xj()&&s.register(n=>new n_(n)),await F0e.catch(n=>{}),s.register(n=>{if(xE){const r=new xE(n);return r.setAnimationPointerResolver.bind(r)(new z0e),r}else return(k0e||nt())&&console.error("Missing KHR_animation_pointer extension..."),{name:"KHR_animation_pointer_NOT_AVAILABLE"}});for(const n of hm)n.onImport&&n.onImport(s,t,e)}function FF(s,e){for(const t of hm)t.onExport&&t.onExport(s,e)}function UF(s,e,t){for(const i of hm)i.onLoaded&&i.onLoaded(s,e,t)}const Tl=ie("debuginstancing"),NU=class{constructor(){d(this,"objs",[])}setup(e,t,i,n,r,o=0){e.applySettings(t);const a=this.tryCreateOrAddInstance(t,i,r);if(a)yi.assignTextureLOD(a.renderer.material,0),n===null&&(n=[]),n.push(a);else if(o<=0&&t.type!=="Mesh"){const l=o+1;for(const c of t.children)n=this.setup(e,c,i,n,r,l)}return o===0&&r.useMatrixWorldAutoUpdate&&n&&n.length>=0&&this.autoUpdateInstanceMatrix(t),n}tryCreateOrAddInstance(e,t,i){if(e.type==="Mesh"){const n=i.foundMeshes;if(i.foundMeshes+=1,!i.rend.enableInstancing)return null;if(i.rend.enableInstancing!==!0){if(n>=i.rend.enableInstancing.length)return Tl&&console.error("Something is wrong with instance setup",e,i.rend.enableInstancing,n),null;if(!i.rend.enableInstancing[n])return null}const r=e,o=r.material;for(const u of this.objs){if(!u.canAdd(r.geometry,o))continue;return u.addInstance(r)}const a=16;let l=e.name;l!=null&&l.length||(l=x6());const c=new $7(l,r.geometry,o,a,t);return this.objs.push(c),c.addInstance(r)}return null}autoUpdateInstanceMatrix(e){const t=e.matrixWorld.multiplyMatrices.bind(e.matrixWorld),i=e.matrixWorld.clone(),n=(r,o)=>{const a=t(r,o);return(e[J_]||i.equals(a)===!1)&&(i.copy(a),e[J_]=!0),a};e.matrixWorld.multiplyMatrices=n}};let Qp=NU;d(Qp,"instance",new NU);const __=class{constructor(e,t){d(this,"object");d(this,"renderer");d(this,"__instanceIndex",-1);d(this,"__reservedVertexRange",0);d(this,"__reservedIndexRange",0);d(this,"meshInformation");this.__instanceIndex=-1,this.object=e,this.renderer=t,e[$j]=t,this.meshInformation=ay(e.geometry),__.all.push(this)}get name(){return this.object.name}get isActive(){return this.__instanceIndex>=0}get vertexCount(){return this.object.geometry.attributes.position.count}get maxVertexCount(){return this.meshInformation.vertexCount}get reservedVertexCount(){return this.__reservedVertexRange}get indexCount(){return this.object.geometry.index?this.object.geometry.index.count:0}get maxIndexCount(){return this.meshInformation.indexCount}get reservedIndexCount(){return this.__reservedIndexRange}updateInstanceMatrix(e=!1,t=!0){this.__instanceIndex<0||(t&&this.object.updateWorldMatrix(!0,e),this.renderer.updateInstance(this.object.matrixWorld,this.__instanceIndex))}setMatrix(e){this.__instanceIndex<0||this.renderer.updateInstance(e,this.__instanceIndex)}setGeometry(e){return this.__instanceIndex<0?!1:this.vertexCount>this.__reservedVertexRange?(console.error(`Cannot update geometry, reserved range is too small: ${this.__reservedVertexRange} < ${this.vertexCount} vertices for ${this.name}`),!1):this.indexCount>this.__reservedIndexRange?(console.error(`Cannot update geometry, reserved range is too small: ${this.__reservedIndexRange} < ${this.indexCount} indices for ${this.name}`),!1):this.renderer.updateGeometry(e,this.__instanceIndex)}add(){this.__instanceIndex>=0||(this.renderer.add(this),ne.markAsInstancedRendered(this.object,!0))}remove(e){if(!(this.__instanceIndex<0)&&(this.renderer.remove(this,e),ne.markAsInstancedRendered(this.object,!1),e)){const t=__.all.indexOf(this);t>=0&&__.all.splice(t,1)}}};let Wp=__;d(Wp,"all",[]);class $7{constructor(e,t,i,n,r){d(this,"allowResize",!0);d(this,"name","");d(this,"geometry");d(this,"material");d(this,"context");d(this,"inst");d(this,"handles",[]);d(this,"maxInstanceCount");d(this,"_currentInstanceCount",0);d(this,"_currentVertexCount",0);d(this,"_currentIndexCount",0);d(this,"_maxVertexCount");d(this,"_maxIndexCount");d(this,"_needUpdateBounds",!1);d(this,"_debugMaterial",null);d(this,"onBeforeRender",()=>{this.inst.layers.enableAll(),this._needUpdateBounds&&this.inst[CA]===!0&&(Tl&&console.log("Update instancing bounds",this.name,this.inst.matrixWorldNeedsUpdate),this.updateBounds())});d(this,"onAfterRender",()=>{this.inst.layers.disableAll()});d(this,"_availableBuckets",new Array);d(this,"_usedBuckets",new Array);this.name=e,this.geometry=t,this.material=i,this.context=r,this.maxInstanceCount=Math.max(2,n),Tl&&(this._debugMaterial=vH());const o=this.tryEstimateVertexCountSize(this.maxInstanceCount,[t],n);this._maxVertexCount=o.vertexCount,this._maxIndexCount=o.indexCount,this.inst=new U1(this.maxInstanceCount,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material),this.inst[CA]=!0,this.inst.visible=!0,this.context.scene.add(this.inst),i instanceof mM&&(i.defines.USE_INSTANCING=!0,i.needsUpdate=!0),r.pre_render_callbacks.push(this.onBeforeRender),r.post_render_callbacks.push(this.onAfterRender),Tl&&console.log(`Instanced renderer created with ${this.maxInstanceCount} instances, ${this._maxVertexCount} max vertices and ${this._maxIndexCount} max indices for "${e}"`)}get mesh(){return this.inst}get visible(){return this.inst.visible}set visible(e){this.inst.visible=e}get castShadow(){return this.inst.castShadow}set castShadow(e){this.inst.castShadow=e}set receiveShadow(e){this.inst.receiveShadow=e}updateBounds(e=!0,t=!0){this._needUpdateBounds=!1,e&&this.inst.computeBoundingBox(),t&&this.inst.computeBoundingSphere()}get count(){return this._currentInstanceCount}canAdd(e,t){return this._maxVertexCount>1e7||t!==this.material?!1:!!(!this.mustGrow(e)||this.allowResize)}dispose(){Tl&&console.warn("Dispose instanced renderer",this.name),this.context.scene.remove(this.inst),this.inst.dispose(),this.inst=null,this.handles=[]}addInstance(e){const t=new Wp(e,this);e.castShadow===!0&&this.inst.castShadow===!1&&(this.inst.castShadow=!0),e.receiveShadow===!0&&this.inst.receiveShadow===!1&&(this.inst.receiveShadow=!0);try{this.add(t)}catch(i){return console.error(`Failed adding mesh to instancing
`,i),nt()&&DM("Failed instancing mesh. See the browser console for details."),null}return t}add(e){const t=e.object.geometry;if(!this.validateGeometry(t)){Tl&&console.error("Cannot add instance, invalid geometry",this.name,t);return}if(this.mustGrow(t))if(this.allowResize)this.grow(t);else{console.error("Cannot add instance, max count reached",this.name,this.count,this.maxInstanceCount);return}e.object.updateWorldMatrix(!0,!0),this.addGeometry(e),this.handles[e.__instanceIndex]=e,this._currentInstanceCount+=1,this.markNeedsUpdate(),this._currentInstanceCount>0&&(this.inst.visible=!0)}remove(e,t){e&&(e.__instanceIndex<0||this.handles[e.__instanceIndex]!=e||this._currentInstanceCount<=0||(this.removeGeometry(e,t),this.handles[e.__instanceIndex]=null,e.__instanceIndex=-1,this._currentInstanceCount>0&&(this._currentInstanceCount-=1),this._currentInstanceCount<=0&&(this.inst.visible=!1),this.markNeedsUpdate()))}updateInstance(e,t){this.inst.setMatrixAt(t,e),this.markNeedsUpdate()}updateGeometry(e,t){return this.validateGeometry(e)?(this.mustGrow()&&this.grow(e),Tl&&console.debug("UPDATE MESH",t,e.name,ay(e),e.attributes.position.count,e.index?e.index.count:0),this.inst.setGeometryAt(t,e),this.markNeedsUpdate(),!0):!1}validateGeometry(e){return this.geometry,!0}markNeedsUpdate(){this._needUpdateBounds=!0}mustGrow(e){if(this.count>=this.maxInstanceCount)return!0;if(!e)return!1;const t=ay(e),i=t.vertexCount,n=t.indexCount;return this._currentVertexCount+i>this._maxVertexCount||this._currentIndexCount+n>this._maxIndexCount}grow(e){const t=this.maxInstanceCount*2,i=this.tryEstimateVertexCountSize(t,[e]),n=Math.max(this._maxVertexCount,i.vertexCount),r=Math.max(this._maxIndexCount,i.indexCount,this._maxVertexCount*2);if(Tl){const a=ay(e);console.warn(`Growing batched mesh for "${this.name}/${e.name}" ${a.vertexCount} vertices, ${a.indexCount} indices
Max count ${this.maxInstanceCount}  ${t}
Max vertex count ${this._maxVertexCount} -> ${n}
Max index count ${this._maxIndexCount} -> ${r}`),this._debugMaterial=vH()}this._maxVertexCount=n,this._maxIndexCount=r;const o=new U1(t,this._maxVertexCount,this._maxIndexCount,this._debugMaterial??this.material);o.layers=this.inst.layers,o.castShadow=this.inst.castShadow,o.receiveShadow=this.inst.receiveShadow,o.visible=this.inst.visible,o[CA]=this.inst[CA],o.matrixAutoUpdate=this.inst.matrixAutoUpdate,o.matrixWorldNeedsUpdate=this.inst.matrixWorldNeedsUpdate,o.matrixAutoUpdate=this.inst.matrixAutoUpdate,o.matrixWorld.copy(this.inst.matrixWorld),o.matrix.copy(this.inst.matrix),this.inst.dispose(),this.inst.removeFromParent(),this.inst=o,this.maxInstanceCount=t;for(const a of this.handles)a&&a.__instanceIndex>=0&&this.addGeometry(a);this.context.scene.add(o)}tryEstimateVertexCountSize(e,t,i=1){const n=new Map;for(const u of this.handles)if(u&&u.__instanceIndex>=0)if(n.has(u.object.geometry)){const f=n.get(u.object.geometry);f.count+=1}else{const f={count:1,...ay(u.object.geometry)};n.set(u.object.geometry,f)}let r=0,o=0;for(const[u,f]of n)r+=f.vertexCount*f.count,o+=f.indexCount*f.count;let l=Math.ceil(r/Math.max(1,this._currentInstanceCount))*e,h=Math.ceil(o/Math.max(1,this._currentInstanceCount))*e*2;if(t)for(const u of t){const f=ay(u);l+=f.vertexCount*i,h+=f.indexCount*i}return{vertexCount:l,indexCount:h}}addGeometry(e){let t=null,i=-1;for(let o=this._availableBuckets.length-1;o>=0;o--){const a=this._availableBuckets[o];a.vertexCount>=e.maxVertexCount&&a.indexCount>=e.maxIndexCount&&(t==null||a.vertexCount<t.vertexCount)&&(t=a,i=o)}if(t!=null){const o=t;Tl&&console.debug(`RE-USE SPACE #${o.index}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name}`),this.inst.setGeometryAt(o.index,e.object.geometry),this.inst.setMatrixAt(o.index,e.object.matrixWorld),this.inst.setVisibleAt(o.index,!0),e.__instanceIndex=o.index,this._usedBuckets[o.index]=o,this._availableBuckets.splice(i,1);return}const n=e.object.geometry;Tl&&console.debug("ADD GEOMETRY",n.name,`
vertex:`,`${this._currentVertexCount} + ${e.maxVertexCount} < ${this._maxVertexCount}?`,`
index:`,e.maxIndexCount,this._currentIndexCount,this._maxIndexCount);const r=this.inst.addGeometry(n,e.maxVertexCount,e.maxIndexCount);e.__instanceIndex=r,e.__reservedVertexRange=e.maxVertexCount,e.__reservedIndexRange=e.maxIndexCount,this._currentVertexCount+=e.maxVertexCount,this._currentIndexCount+=e.maxIndexCount,this._usedBuckets[r]={index:r,vertexCount:e.maxVertexCount,indexCount:e.maxIndexCount},this.inst.setMatrixAt(r,e.object.matrixWorld),Tl&&console.debug(`ADD MESH & RESERVE SPACE #${r}, ${e.maxVertexCount} vertices, ${e.maxIndexCount} indices, ${e.name} ${e.object.uuid}`)}removeGeometry(e,t){e.__instanceIndex<0||(this._usedBuckets.splice(e.__instanceIndex,1),this.inst.setVisibleAt(e.__instanceIndex,!1),this._availableBuckets.push({index:e.__instanceIndex,vertexCount:e.reservedVertexCount,indexCount:e.reservedIndexCount}))}}d($7,"nullMatrix",new le);function ay(s){let e=s.attributes.position.count,t=s.index?s.index.count:0;const i=yi.getMeshLODInformation(s);if(i){const n=i.lods[0];let r=n.vertexCount,o=n.indexCount;r+=10,r+=r*.05,o+=20,e=Math.max(e,r),t=Math.max(t,o)}return e=Math.ceil(e),t=Math.ceil(t),{vertexCount:e,indexCount:t}}function vH(){const s=new ws({color:new Ae(Math.random(),Math.random(),Math.random())});return s.emissive=s.color,s.emissiveIntensity=.3,ie("wireframe")&&(s.wireframe=!0),s}const Dg=ie("debuglightmaps");class rb{constructor(e,t){d(this,"lightmapIndex",-1);d(this,"lightmapScaleOffset",new Je(1,1,0,0));d(this,"context");d(this,"gameObject");d(this,"lightmapTexture",null);d(this,"lightmapScaleOffsetUniform",{value:new Je(1,1,0,0)});d(this,"lightmapUniform",{value:null});d(this,"onBeforeCompile",(e,t)=>{Dg&&console.log(`Lightmaps, before compile
`,e),this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,this.lightmapUniform.value=this.lightmapTexture,e.uniforms.lightmapScaleOffset=this.lightmapScaleOffsetUniform});this.gameObject=e,this.context=t}get lightmap(){return this.lightmapTexture}set lightmap(e){e!==this.lightmapTexture&&(this.lightmapTexture=e,this.applyLightmap(),this.lightmapTexture&&yi.assignTextureLOD(this.lightmapTexture,0).then(t=>{t!=null&&t.isTexture&&(this.lightmapTexture=t)}))}init(e,t,i){console.assert(this.gameObject!==void 0&&this.gameObject!==null,"Missing gameobject",this),this.lightmapIndex=e,!(this.lightmapIndex<0)&&(this.lightmapScaleOffset=t,this.lightmapTexture=i,yi.assignTextureLOD(i,0).then(n=>{n!=null&&n.isTexture&&(this.lightmapTexture=n)}),Dg=="show"?(console.log("Lightmap:",this.gameObject.name,e,`
ScaleOffset:`,t,`
Texture:`,i),this.setLightmapDebugMaterial()):Dg&&console.log("Use debuglightmaps=show to render lightmaps only in the scene."),this.applyLightmap())}updateLightmapUniforms(e){const t=e.uniforms;t&&t.lightmap&&(this.lightmapScaleOffsetUniform.value=this.lightmapScaleOffset,t.lightmapScaleOffset=this.lightmapScaleOffsetUniform)}applyLightmap(){if(this.gameObject.type==="Object3D"){Dg&&console.warn("Can not add lightmap. Is this object missing a renderer?",this.gameObject.name);return}if(this.gameObject.type==="Group"){this.gameObject["Needle:Multimaterial-LightmapWarning"]===void 0&&(this.gameObject["Needle:Multimaterial-LightmapWarning"]=!0,console.warn("Lightmap on multimaterial object is not supported yet... please open a feature request on https://github.com/needle-tools/needle-engine-support if your project requires it"));return}console.assert(this.gameObject.type==="Mesh","Lightmap only works on meshes",this);const e=this.gameObject;if(e.geometry.getAttribute("uv1")||e.geometry.setAttribute("uv1",e.geometry.getAttribute("uv")),Array.isArray(this.gameObject.material)){const t=this.gameObject.material;for(let i=0;i<t.length;i++)t[i]=this.ensureLightmapMaterial(t[i])}else this.gameObject.material=this.ensureLightmapMaterial(this.gameObject.material);if(this.lightmapIndex>=0&&this.lightmapTexture){this.lightmapTexture.channel=1;const t=this.gameObject.material;if(Array.isArray(t))for(const i of t)this.assignLightmapTexture(i);else t&&this.assignLightmapTexture(t)}}ensureLightmapMaterial(e){return e.userData||(e.userData={}),e["NEEDLE:lightmap-material-version"]!=e.version&&e["NEEDLE:lightmap-material-version"]==null&&(Dg&&console.warn("Cloning material for lightmap "+e.name),e=e.clone(),e.onBeforeCompile=this.onBeforeCompile),e}assignLightmapTexture(e){!e||e instanceof No&&e.transmission>0||!(e.lightMap!==this.lightmapTexture||e["NEEDLE:lightmap-material-version"]!==e.version)||(Dg&&console.log("Assigning lightmap",e.name,e.version),e.lightMap=this.lightmapTexture,e["NEEDLE:lightmap-material-version"]=e.version)}setLightmapDebugMaterial(){this.gameObject.material=new kt({vertexShader:`
                varying vec2 vUv1;
                void main()
                {
                    vUv1 = uv1;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                }
                `,fragmentShader:`
                uniform sampler2D lightMap;
                uniform float lightMapIntensity;
                uniform vec4 lightmapScaleOffset;
                varying vec2 vUv1;

                // took from threejs 05fc79cd52b79e8c3e8dec1e7dca72c5c39983a4
                vec4 conv_sRGBToLinear( in vec4 value ) {
                    return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
                }

                void main() {
                    vec2 lUv = vUv1.xy * lightmapScaleOffset.xy + vec2(lightmapScaleOffset.z, (1. - (lightmapScaleOffset.y + lightmapScaleOffset.w)));
                    
                    vec4 lightMapTexel = texture2D( lightMap, lUv);
                    gl_FragColor = lightMapTexel;
                    gl_FragColor.a = 1.;
                }
                `,defines:{USE_LIGHTMAP:""}})}}var G0e=Object.defineProperty,H0e=Object.getOwnPropertyDescriptor,gu=(s,e,t,i)=>{for(var n=i>1?void 0:i?H0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&G0e(e,t,n),n};const OA=ie("debugrenderer"),AH=ie("debugskinnedmesh"),_H=ie("noinstancing"),V0e=ie("wireframe");class NF{constructor(){d(this,"path",null);d(this,"asset",null);d(this,"default")}}class Q0e{constructor(e,t){d(this,"_renderer");d(this,"_targets",[]);d(this,"_indexMapMaxIndex");d(this,"_indexMap");d(this,"_changed",!1);this._renderer=e;const i=this.setMaterial.bind(this),n=this.getMaterial.bind(this),r=e.gameObject;if(this._targets=[],r)switch(r.type){case"Group":this._targets=[...r.children];break;case"SkinnedMesh":case"Mesh":this._targets.push(r);break}let o=!1,a,l=0;for(let c=0;c<this._targets.length;c++){const h=this._targets[c];if(!h)continue;const u=h.material;if(u){u.shadowSide=u.side;for(let f=0;f<t.length;f++){const p=t[f];if(!p){o=!0;continue}if(u.name===p.name){a===void 0&&(a=new Map),a.set(f,c),l=Math.max(l,f);break}}}}if(o){this._indexMapMaxIndex=l,this._indexMap=a;const c=`Renderer ${e.name} was initialized with missing materials - this may lead to unexpected behaviour when trying to access sharedMaterials by index.`;console.warn(c),yo()&&Fi("Found renderer with missing materials: please check the console for details.")}return new Proxy(this,{get(c,h){if(typeof h=="string"){const u=parseInt(h);if(!isNaN(u))return n(u)}return c[h]},set(c,h,u){return typeof h=="string"&&i(u,Number.parseInt(h)),Reflect.set(c,h,u)?(u instanceof Ht&&(c.changed=!0),!0):!1}})}get changed(){return this._changed}set changed(e){e===!0&&OA&&console.warn("SharedMaterials have changed: "+this._renderer.name,this),this._changed=e}is(e){return this._renderer===e}get length(){return this._indexMapMaxIndex!==void 0?this._indexMapMaxIndex+1:this._targets.length}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.getMaterial(e)}resolveIndex(e){const t=this._indexMap;return t&&t.has(e)?t.get(e):e}setMaterial(e,t){if(t=this.resolveIndex(t),t<0||t>=this._targets.length)return;const i=this._targets[t];!i||i.material===void 0||(i.material=e,this.changed=!0)}getMaterial(e){if(e=this.resolveIndex(e),e<0)return null;const t=this._targets;if(e>=t.length)return null;const i=t[e];return i?i.material:null}}const _1=class extends Ie{constructor(){super(...arguments);d(this,"receiveShadows",!1);d(this,"shadowCastingMode",0);d(this,"lightmapIndex",-1);d(this,"lightmapScaleOffset",new Je(1,1,0,0));d(this,"enableInstancing");d(this,"renderOrder");d(this,"allowOcclusionWhenDynamic",!0);d(this,"probeAnchor");d(this,"reflectionProbeUsage",0);d(this,"_lightmaps");d(this,"_sharedMeshes",[]);d(this,"_sharedMaterials");d(this,"_originalMaterials");d(this,"_probeAnchorLastFrame");d(this,"_lightmapTextureOverride");d(this,"allowProgressiveLoading",!0);d(this,"_firstFrame",-1);d(this,"_isInstancingEnabled",!1);d(this,"handles");d(this,"onBeforeRenderThree",(e,t,i,n,r,o)=>{var a;if(r.envMapIntensity!==void 0){const l=this.hasLightmap?Math.PI:1,c=((a=this.context.mainCameraComponent)==null?void 0:a.environmentIntensity)??1;r.envMapIntensity=Math.max(0,c*this.context.sceneLighting.environmentIntensity/l)}if(this._lightmaps)for(const l of this._lightmaps)l.updateLightmapUniforms(r),l.applyLightmap()});d(this,"_reflectionProbe",null)}static setInstanced(e,t){const i=Zb(e,_1);return i.setInstancingEnabled(t),i}static isInstanced(e){const t=ym(e,_1);return t?t.isInstancingActive:sl.isUsingInstancing(e)}static setVisible(e,t){fd(e,t)}get sharedMesh(){if(this.gameObject.type==="Mesh")return this.gameObject;if(this.gameObject.type==="SkinnesMesh")return this.gameObject;if(this.gameObject.type==="Group")return this.gameObject.children[0]}get sharedMeshes(){if(this.destroyed||!this.gameObject)return this._sharedMeshes;if(this._sharedMeshes.length=0,this.gameObject.type==="Group")for(const e of this.gameObject.children)(e.type==="Mesh"||e.type==="SkinnedMesh")&&this._sharedMeshes.push(e);else(this.gameObject.type==="Mesh"||this.gameObject.type==="SkinnedMesh")&&this._sharedMeshes.push(this.gameObject);return this._sharedMeshes}get sharedMaterial(){return this.sharedMaterials[0]}set sharedMaterial(e){this.sharedMaterials[0]!==e&&(this.sharedMaterials[0]=e,this.applyLightmapping())}get material(){return this.sharedMaterials[0]}set material(e){this.sharedMaterial=e}set sharedMaterials(e){if(!this._originalMaterials)this._originalMaterials=e;else if(e){let t=!1;for(let i=0;i<this._sharedMaterials.length;i++){const n=i<e.length?e[i]:null;n&&n instanceof Ht?this.sharedMaterials[i]=n:t||(t=!0,console.warn("Can not assign null as material: "+this.name,n))}}}get sharedMaterials(){return(!this._sharedMaterials||!this._sharedMaterials.is(this))&&(this._originalMaterials||(this._originalMaterials=[]),this._sharedMaterials=new Q0e(this,this._originalMaterials)),this._sharedMaterials}static get shouldSuppressInstancing(){return _H}get lightmap(){var e;return(e=this._lightmaps)!=null&&e.length?this._lightmaps[0].lightmap:null}set lightmap(e){var t;if(this._lightmapTextureOverride=e,e===void 0&&(e=this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex)),(t=this._lightmaps)!=null&&t.length)for(const i of this._lightmaps)i.lightmap=e}get hasLightmap(){const e=this.lightmap;return e!=null}registering(){this.enabled||this.setVisibility(!1)}awake(){if(this._firstFrame=this.context.time.frame,OA&&console.log("Renderer ",this.name,this),this.clearInstancingState(),this.probeAnchor&&OA&&this.probeAnchor.add(new _a(.2)),this._reflectionProbe=null,this.isMultiMaterialObject(this.gameObject)){for(const e of this.gameObject.children)this.context.addBeforeRenderListener(e,this.onBeforeRenderThree),e.layers.mask=this.gameObject.layers.mask;if(this.renderOrder!==void 0){let e=0;for(let t=0;t<this.gameObject.children.length;t++){const i=this.gameObject.children[t];if(!(!this.isMeshOrSkinnedMesh(i)||ne.getComponent(i,_1))){if(this.renderOrder.length<=e){console.warn("Incorrect renderOrder element count",this,this.renderOrder.length+" but expected "+this.gameObject.children.length,"Index: "+e,"ChildElement:",i);continue}i.renderOrder=this.renderOrder[e],e+=1}}}}else this.isMeshOrSkinnedMesh(this.gameObject)?(this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree),this.renderOrder!==void 0&&this.renderOrder.length>0&&(this.gameObject.renderOrder=this.renderOrder[0])):this.context.addBeforeRenderListener(this.gameObject,this.onBeforeRenderThree);if(this.applyLightmapping(),V0e)for(let e=0;e<this.sharedMaterials.length;e++){const t=this.sharedMaterials[e];t&&(t.wireframe=!0)}}applyLightmapping(){var e;if(this.lightmapIndex>=0){const t=this.gameObject.type,i=this._lightmapTextureOverride!==void 0?this._lightmapTextureOverride:this.context.lightmaps.tryGetLightmap(this.sourceId,this.lightmapIndex);if(i){if(this._lightmaps||(this._lightmaps=[]),t==="Mesh"){const n=this.gameObject.material;if(n!=null&&n.isMeshBasicMaterial)n&&console.warn("Lightmapping is not supported on MeshBasicMaterial",n.name);else{if(this._lightmaps.length<=0){const o=new rb(this.gameObject,this.context);this._lightmaps.push(o)}this._lightmaps[0].init(this.lightmapIndex,this.lightmapScaleOffset,i)}}else if(this.isMultiMaterialObject(this.gameObject)&&this.sharedMaterials.length>0)for(let n=0;n<this.gameObject.children.length;n++){const r=this.gameObject.children[n];if(!((e=r.material)!=null&&e.isMeshBasicMaterial)){let o;n>=this._lightmaps.length?(o=new rb(r,this.context),this._lightmaps.push(o)):o=this._lightmaps[n],o.init(this.lightmapIndex,this.lightmapScaleOffset,i)}}}else OA&&console.warn("Lightmap not found",this.sourceId,this.lightmapIndex)}}get isInstancingActive(){return this.handles!=null&&this.handles.length>0&&this._isInstancingEnabled}setInstancingEnabled(e){if(this._isInstancingEnabled===e)return e&&(this.handles===void 0||this.handles!=null&&this.handles.length>0);if(this._isInstancingEnabled=e,e){if(this.enableInstancing===void 0&&(this.enableInstancing=!0),this.handles===void 0){if(this.handles=Qp.instance.setup(this,this.gameObject,this.context,null,{rend:this,foundMeshes:0,useMatrixWorldAutoUpdate:this.useInstanceMatrixWorldAutoUpdate()}),this.handles)return ne.markAsInstancedRendered(this.gameObject,!0),!0}else if(this.handles!==null){for(const t of this.handles)t.updateInstanceMatrix(!0),t.add();return ne.markAsInstancedRendered(this.gameObject,!0),!0}}else{if(this.handles)for(const t of this.handles)t.remove(this.destroyed);return!0}return!1}clearInstancingState(){this._isInstancingEnabled=!1,this.handles=void 0}useInstanceMatrixWorldAutoUpdate(){return!0}start(){if(this.enableInstancing&&!_H&&(this.setInstancingEnabled(!0),sl.markDirty(this.gameObject)),this.gameObject.frustumCulled=this.allowOcclusionWhenDynamic,this.isMultiMaterialObject(this.gameObject))for(let e=0;e<this.gameObject.children.length;e++){const t=this.gameObject.children[e];t.frustumCulled=this.allowOcclusionWhenDynamic}}onEnable(){this.sharedMeshes,this.setVisibility(!0),this._isInstancingEnabled||this.enableInstancing==!0||Array.isArray(this.enableInstancing)&&this.enableInstancing.some(t=>t)?this.__internalDidAwakeAndStart&&this.setInstancingEnabled(!0):this.enabled&&this.applyStencil(),this.updateReflectionProbe()}onDisable(){this.setVisibility(!1),this.handles&&this.handles.length>0&&this.setInstancingEnabled(!1)}onDestroy(){if(this.handles=null,this.isMultiMaterialObject(this.gameObject))for(const e of this.gameObject.children)this.context.removeBeforeRenderListener(e,this.onBeforeRenderThree);else this.context.removeBeforeRenderListener(this.gameObject,this.onBeforeRenderThree)}onBeforeRender(){var e,t,i;if(this.gameObject){if(this._probeAnchorLastFrame!==this.probeAnchor&&((e=this._reflectionProbe)==null||e.onUnset(this),this.updateReflectionProbe()),OA==this.name&&this.gameObject instanceof fe){this.gameObject.geometry.computeBoundingSphere();const n=wt(this.gameObject.geometry.boundingSphere.center).applyMatrix4(this.gameObject.matrixWorld);_t.DrawWireSphere(n,this.gameObject.geometry.boundingSphere.radius,56831)}if(this.isMultiMaterialObject(this.gameObject)&&((t=this.gameObject.children)==null?void 0:t.length)>0)for(const n of this.gameObject.children)this.applySettings(n);else this.applySettings(this.gameObject);if(this.sharedMaterials.changed&&(this.sharedMaterials.changed=!1,this.applyLightmapping()),(i=this.handles)!=null&&i.length&&this.gameObject[J_]===!0){this.gameObject[J_]=!1;for(let r=this.handles.length-1;r>=0;r--)this.handles[r].updateInstanceMatrix();this.gameObject.matrixWorldNeedsUpdate=!1}if(this.handles&&this.handles.length<=0&&ne.markAsInstancedRendered(this.gameObject,!1),this._isInstancingEnabled&&this.handles)for(let n=0;n<this.handles.length;n++){const r=this.handles[n];fd(r.object,!1)}this.reflectionProbeUsage!==0&&this._reflectionProbe&&this._reflectionProbe.onSet(this)}}onAfterRender(){if(this._isInstancingEnabled&&this.handles)for(let e=0;e<this.handles.length;e++){const t=this.handles[e];fd(t.object,!0)}this.reflectionProbeUsage!==0&&this._reflectionProbe&&this._reflectionProbe.onUnset(this),this.static&&this.gameObject.matrixAutoUpdate&&(this.gameObject.matrixAutoUpdate=!1)}applyStencil(){h_.applyStencil(this)}applySettings(e){e.receiveShadow=this.receiveShadows,this.shadowCastingMode==1?e.castShadow=!0:e.castShadow=!1}updateReflectionProbe(){this._reflectionProbe=null,this.reflectionProbeUsage!==0&&(this.startCoroutine(this._updateReflectionProbe(),nn.LateUpdate),this._probeAnchorLastFrame=this.probeAnchor)}*_updateReflectionProbe(){const e=this.probeAnchor||this.gameObject,t=!!this.probeAnchor;this._reflectionProbe=qv.get(e,this.context,t,this.probeAnchor)}setVisibility(e){if(!this.isMultiMaterialObject(this.gameObject))fd(this.gameObject,e);else for(const t of this.gameObject.children)this.isMeshOrSkinnedMesh(t)&&fd(t,e)}isMultiMaterialObject(e){return e.type==="Group"}isMeshOrSkinnedMesh(e){return e.type==="Mesh"||e.type==="SkinnedMesh"}};let Vn=_1;gu([C()],Vn.prototype,"receiveShadows",2);gu([C()],Vn.prototype,"shadowCastingMode",2);gu([C()],Vn.prototype,"lightmapIndex",2);gu([C(Je)],Vn.prototype,"lightmapScaleOffset",2);gu([C()],Vn.prototype,"enableInstancing",2);gu([C()],Vn.prototype,"renderOrder",2);gu([C()],Vn.prototype,"allowOcclusionWhenDynamic",2);gu([C(ye)],Vn.prototype,"probeAnchor",2);gu([C()],Vn.prototype,"reflectionProbeUsage",2);class _x extends Vn{}class zF extends _x{constructor(){super(...arguments);d(this,"_needUpdateBoundingSphere",!1)}awake(){var t;super.awake(),AH&&console.log('SkinnedMeshRenderer for "'+this.name+'"',this),this.allowOcclusionWhenDynamic=!1;for(const i of this.sharedMeshes)(t=i.parent)==null||t.updateWorldMatrix(!1,!0),this.markBoundsDirty()}onAfterRender(){if(super.onAfterRender(),this._needUpdateBoundingSphere){for(const t of this.sharedMeshes)if(t instanceof Fo){this._needUpdateBoundingSphere=!1;const i=t.geometry,n=Wb(t);n&&(t.geometry=n),t.computeBoundingSphere(),t.geometry=i}}if(AH){for(const t of this.sharedMeshes)if(t instanceof Fo&&t.boundingSphere){const i=wt(t.boundingSphere.center).applyMatrix4(t.matrixWorld);_t.DrawWireSphere(i,t.boundingSphere.radius,"red")}}}markBoundsDirty(){this._needUpdateBoundingSphere=!0}}var W0e=Object.defineProperty,j0e=Object.getOwnPropertyDescriptor,oe=(s,e,t,i)=>{for(var n=i>1?void 0:i?j0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&W0e(e,t,n),n};const qS=ie("debugparticles");var Fh=(s=>(s[s.Billboard=0]="Billboard",s[s.Stretch=1]="Stretch",s[s.HorizontalBillboard=2]="HorizontalBillboard",s[s.VerticalBillboard=3]="VerticalBillboard",s[s.Mesh=4]="Mesh",s))(Fh||{});let mf=class{constructor(){d(this,"alphaKeys");d(this,"colorKeys")}get duration(){return 1}evaluate(e,t){let i,n=0,r=null,o=0;for(let a=0;a<this.alphaKeys.length;a++){const l=this.alphaKeys[a];(l.time<e||!i)&&(i=l,n=a)}for(let a=0;a<this.colorKeys.length;a++){const l=this.colorKeys[a];(l.time<e||!r)&&(r=l,o=a)}if(r)if(o+1<this.colorKeys.length){const l=this.colorKeys[o+1],c=it.remap(e,r.time,l.time,0,1);t.r=it.lerp(r.color.r,l.color.r,c),t.g=it.lerp(r.color.g,l.color.g,c),t.b=it.lerp(r.color.b,l.color.b,c)}else t.r=r.color.r,t.g=r.color.g,t.b=r.color.b;if(i)if(n+1<this.alphaKeys.length){const l=this.alphaKeys[n+1],c=it.remap(e,i.time,l.time,0,1);t.alpha=it.lerp(i.alpha,l.alpha,c)}else t.alpha=i.alpha;return t}};oe([C()],mf.prototype,"alphaKeys",2);oe([C()],mf.prototype,"colorKeys",2);var ob=(s=>(s[s.Local=0]="Local",s[s.World=1]="World",s[s.Custom=2]="Custom",s))(ob||{}),wE=(s=>(s[s.Sphere=0]="Sphere",s[s.SphereShell=1]="SphereShell",s[s.Hemisphere=2]="Hemisphere",s[s.HemisphereShell=3]="HemisphereShell",s[s.Cone=4]="Cone",s[s.Box=5]="Box",s[s.Mesh=6]="Mesh",s[s.ConeShell=7]="ConeShell",s[s.ConeVolume=8]="ConeVolume",s[s.ConeVolumeShell=9]="ConeVolumeShell",s[s.Circle=10]="Circle",s[s.CircleEdge=11]="CircleEdge",s[s.SingleSidedEdge=12]="SingleSidedEdge",s[s.MeshRenderer=13]="MeshRenderer",s[s.SkinnedMeshRenderer=14]="SkinnedMeshRenderer",s[s.BoxShell=15]="BoxShell",s[s.BoxEdge=16]="BoxEdge",s[s.Donut=17]="Donut",s[s.Rectangle=18]="Rectangle",s[s.Sprite=19]="Sprite",s[s.SpriteRenderer=20]="SpriteRenderer",s))(wE||{});const eq=class{constructor(){d(this,"mode");d(this,"constant");d(this,"constantMin");d(this,"constantMax");d(this,"curve");d(this,"curveMin");d(this,"curveMax");d(this,"curveMultiplier")}clone(){var e,t,i;const s=new eq;return s.mode=this.mode,s.constant=this.constant,s.constantMin=this.constantMin,s.constantMax=this.constantMax,s.curve=(e=this.curve)==null?void 0:e.clone(),s.curveMin=(t=this.curveMin)==null?void 0:t.clone(),s.curveMax=(i=this.curveMax)==null?void 0:i.clone(),s.curveMultiplier=this.curveMultiplier,s}evaluate(s,e){const t=e===void 0?Math.random():e;switch(this.mode){case 0:return this.constant;case 1:return s=it.clamp01(s),this.curve.evaluate(s)*this.curveMultiplier;case 2:const i=s*this.curveMin.duration,n=s*this.curveMax.duration;return it.lerp(this.curveMin.evaluate(i),this.curveMax.evaluate(n),t%1)*this.curveMultiplier;case 3:return it.lerp(this.constantMin,this.constantMax,t%1);default:this.curveMax.evaluate(s)*this.curveMultiplier;break}return 0}getMax(){switch(this.mode){case 0:return this.constant;case 1:return this.getMaxFromCurve(this.curve)*this.curveMultiplier;case 2:return Math.max(this.getMaxFromCurve(this.curveMin),this.getMaxFromCurve(this.curveMax))*this.curveMultiplier;case 3:return Math.max(this.constantMin,this.constantMax);default:return 0}}getMaxFromCurve(s){if(!s)return 0;let e=Number.MIN_VALUE;for(let t=0;t<s.keys.length;t++){const i=s.keys[t];i.value>e&&(e=i.value)}return e}};let At=eq;oe([C()],At.prototype,"mode",2);oe([C()],At.prototype,"constant",2);oe([C()],At.prototype,"constantMin",2);oe([C()],At.prototype,"constantMax",2);oe([C(_m)],At.prototype,"curve",2);oe([C(_m)],At.prototype,"curveMin",2);oe([C(_m)],At.prototype,"curveMax",2);oe([C()],At.prototype,"curveMultiplier",2);var kC;const Il=(kC=class{constructor(){d(this,"mode");d(this,"color");d(this,"colorMin");d(this,"colorMax");d(this,"gradient");d(this,"gradientMin");d(this,"gradientMax")}evaluate(s,e){const t=e===void 0?Math.random():e;switch(this.mode){case 0:return this.color;case 1:return this.gradient.evaluate(s,Il._temp),Il._temp;case 2:return Il._temp.lerpColors(this.colorMin,this.colorMax,t);case 3:return this.gradientMin.evaluate(s,Il._temp),this.gradientMax.evaluate(s,Il._temp2),Il._temp.lerp(Il._temp2,t)}return Il._temp.set(16711935),Il._temp.alpha=1,Il._temp}},d(kC,"_temp",new Ui(0,0,0,1)),d(kC,"_temp2",new Ui(0,0,0,1)),kC);let Ho=Il;oe([C(Ui)],Ho.prototype,"color",2);oe([C(Ui)],Ho.prototype,"colorMin",2);oe([C(Ui)],Ho.prototype,"colorMax",2);oe([C(mf)],Ho.prototype,"gradient",2);oe([C(mf)],Ho.prototype,"gradientMin",2);oe([C(mf)],Ho.prototype,"gradientMax",2);var XD=(s=>(s[s.Hierarchy=0]="Hierarchy",s[s.Local=1]="Local",s[s.Shape=2]="Shape",s))(XD||{});class Cr{constructor(){d(this,"cullingMode");d(this,"duration");d(this,"emitterVelocityMode");d(this,"flipRotation");d(this,"gravityModifier");d(this,"gravityModifierMultiplier");d(this,"loop");d(this,"maxParticles");d(this,"playOnAwake");d(this,"prewarm");d(this,"ringBufferLoopRange");d(this,"ringBufferMode");d(this,"scalingMode");d(this,"simulationSpace");d(this,"simulationSpeed");d(this,"startColor");d(this,"startDelay");d(this,"startDelayMultiplier");d(this,"startLifetime");d(this,"startLifetimeMultiplier");d(this,"startRotation");d(this,"startRotationMultiplier");d(this,"startRotation3D");d(this,"startRotationX");d(this,"startRotationXMultiplier");d(this,"startRotationY");d(this,"startRotationYMultiplier");d(this,"startRotationZ");d(this,"startRotationZMultiplier");d(this,"startSize");d(this,"startSize3D");d(this,"startSizeMultiplier");d(this,"startSizeX");d(this,"startSizeXMultiplier");d(this,"startSizeY");d(this,"startSizeYMultiplier");d(this,"startSizeZ");d(this,"startSizeZMultiplier");d(this,"startSpeed");d(this,"startSpeedMultiplier");d(this,"stopAction");d(this,"useUnscaledTime")}}oe([C(At)],Cr.prototype,"gravityModifier",2);oe([C(Ho)],Cr.prototype,"startColor",2);oe([C(At)],Cr.prototype,"startDelay",2);oe([C(At)],Cr.prototype,"startLifetime",2);oe([C(At)],Cr.prototype,"startRotation",2);oe([C(At)],Cr.prototype,"startRotationX",2);oe([C(At)],Cr.prototype,"startRotationY",2);oe([C(At)],Cr.prototype,"startRotationZ",2);oe([C(At)],Cr.prototype,"startSize",2);oe([C(At)],Cr.prototype,"startSizeX",2);oe([C(At)],Cr.prototype,"startSizeY",2);oe([C(At)],Cr.prototype,"startSizeZ",2);oe([C(At)],Cr.prototype,"startSpeed",2);class ab{constructor(){d(this,"cycleCount");d(this,"maxCount");d(this,"minCount");d(this,"probability");d(this,"repeatInterval");d(this,"time");d(this,"count");d(this,"_performed",0)}reset(){this._performed=0}run(e){if(e<=this.time)return 0;let t=0;if(this.cycleCount===0||this._performed<this.cycleCount){const i=this.time+this.repeatInterval*this._performed;if(e>=i&&(this._performed+=1,Math.random()<this.probability))switch(this.count.mode){case 0:t=this.count.constant;break;case 3:t=it.lerp(this.count.constantMin,this.count.constantMax,Math.random());break;case 1:t=this.count.curve.evaluate(Math.random());break;case 2:const n=Math.random();t=it.lerp(this.count.curveMin.evaluate(n),this.count.curveMax.evaluate(n),Math.random());break}}return t}}class Jc{constructor(){d(this,"enabled");d(this,"bursts");d(this,"rateOverTime");d(this,"rateOverTimeMultiplier");d(this,"rateOverDistance");d(this,"rateOverDistanceMultiplier");d(this,"system")}get burstCount(){var e;return((e=this.bursts)==null?void 0:e.length)??0}reset(){var e;(e=this.bursts)==null||e.forEach(t=>t.reset())}getBurst(){let e=0;if(this.burstCount>0)for(let t=0;t<this.burstCount;t++){const i=this.bursts[t];this.system.main.loop&&i.time>=this.system.time&&i.reset(),e+=Math.round(i.run(this.system.time))}return e}}oe([C()],Jc.prototype,"enabled",2);oe([C()],Jc.prototype,"bursts",2);oe([C(At)],Jc.prototype,"rateOverTime",2);oe([C()],Jc.prototype,"rateOverTimeMultiplier",2);oe([C(At)],Jc.prototype,"rateOverDistance",2);oe([C()],Jc.prototype,"rateOverDistanceMultiplier",2);class bx{constructor(){d(this,"enabled");d(this,"color")}}oe([C(Ho)],bx.prototype,"color",2);class gf{constructor(){d(this,"enabled");d(this,"separateAxes");d(this,"size");d(this,"sizeMultiplier");d(this,"x");d(this,"xMultiplier");d(this,"y");d(this,"yMultiplier");d(this,"z");d(this,"zMultiplier");d(this,"_time",0);d(this,"_temp",new S)}evaluate(e,t,i){if(t||(t=this._temp),!this.enabled)return t.x=t.y=t.z=1,t;if(this.separateAxes)t.x=this.x.evaluate(e,i)*this.xMultiplier,t.y=this.y.evaluate(e,i)*this.yMultiplier,t.z=this.z.evaluate(e,i)*this.zMultiplier;else{const n=this.size.evaluate(e,i)*this.sizeMultiplier;t.x=n}return t}}oe([C(At)],gf.prototype,"size",2);oe([C(At)],gf.prototype,"x",2);oe([C(At)],gf.prototype,"y",2);oe([C(At)],gf.prototype,"z",2);var FC;const LA=(FC=class{constructor(){d(this,"shapeType",5);d(this,"enabled",!0);d(this,"alignToDirection",!1);d(this,"angle",0);d(this,"arc",360);d(this,"arcSpread");d(this,"arcSpeedMultiplier");d(this,"arcMode");d(this,"boxThickness");d(this,"position");d(this,"rotation");d(this,"_rotation",new li);d(this,"scale");d(this,"radius");d(this,"radiusThickness");d(this,"sphericalDirectionAmount");d(this,"randomDirectionAmount");d(this,"randomPositionAmount");d(this,"meshShapeType");d(this,"meshRenderer");d(this,"_meshObj");d(this,"_meshGeometry");d(this,"system");d(this,"_space");d(this,"_worldSpaceMatrix",new le);d(this,"_worldSpaceMatrixInverse",new le);d(this,"_vector",new S(0,0,0));d(this,"_temp",new S(0,0,0));d(this,"_triangle",new pr);d(this,"_dir",new S);d(this,"_loopTime",0);d(this,"_loopDirection",1);qS&&console.log(this)}get type(){return wE[this.shapeType]}initialize(s){this.onInitialize(s),s.position.copy(this._vector)}toJSON(){return this}clone(){return new LA}setMesh(s){this.meshRenderer=s,s?(this._meshObj=s.sharedMeshes[Math.floor(Math.random()*s.sharedMeshes.length)],this._meshGeometry=this._meshObj.geometry):(this._meshObj=void 0,this._meshGeometry=void 0)}update(s,e,t,i){this.system=s,this._space=t,t===1&&(this._worldSpaceMatrix.copy(i.matrixWorld),this._worldSpaceMatrix.elements[0]=1,this._worldSpaceMatrix.elements[5]=1,this._worldSpaceMatrix.elements[10]=1,this._worldSpaceMatrixInverse.copy(this._worldSpaceMatrix).invert())}applyRotation(s){const e=this.rotation.x!==0||this.rotation.y!==0||this.rotation.z!==0;return e&&(this._rotation.x=it.toRadians(this.rotation.x),this._rotation.y=it.toRadians(this.rotation.y),this._rotation.z=it.toRadians(this.rotation.z),this._rotation.order="ZYX",s.applyEuler(this._rotation)),e}onInitialize(s){this._vector.set(0,0,0),s.mesh=void 0,s.mesh_geometry=void 0;const e=this._temp.copy(this.position),t=this._space===1;t&&e.applyQuaternion(this.system.worldQuaternion);let i=this.radius;if(t&&(i*=this.system.worldScale.x),this.enabled){switch(this.shapeType){case 5:qS&&_t.DrawWireBox(this.position,this.scale,14540253,1),this._vector.x=Math.random()*this.scale.x-this.scale.x/2,this._vector.y=Math.random()*this.scale.y-this.scale.y/2,this._vector.z=Math.random()*this.scale.z-this.scale.z/2,this._vector.add(e);break;case 4:this.randomConePoint(this.position,this.angle,i,this.radiusThickness,this.arc,this.arcMode,this._vector);break;case 0:this.randomSpherePoint(this.position,i,this.radiusThickness,this.arc,this._vector);break;case 10:this.randomCirclePoint(this.position,i,this.radiusThickness,this.arc,this._vector);break;case 13:const n=this.meshRenderer;(n==null?void 0:n.destroyed)==!1&&this.setMesh(n);const r=s.mesh=this._meshObj,o=s.mesh_geometry=this._meshGeometry;if(r&&o)switch(this.meshShapeType){case 0:{const a=o.getAttribute("position"),l=Math.floor(Math.random()*a.count);this._vector.fromBufferAttribute(a,l),this._vector.applyMatrix4(r.matrixWorld),s.mesh_normal=l}break;case 1:break;case 2:{const a=o.index;if(a){let l=Math.random(),c=Math.random();l+c>1&&(l=1-l,c=1-c);const h=Math.floor(Math.random()*(a.count/3));let u=h*3,f=h*3+1,p=h*3+2;u=a.getX(u),f=a.getX(f),p=a.getX(p);const m=o.getAttribute("position");this._triangle.a.fromBufferAttribute(m,u),this._triangle.b.fromBufferAttribute(m,f),this._triangle.c.fromBufferAttribute(m,p),this._vector.set(0,0,0).addScaledVector(this._triangle.a,l).addScaledVector(this._triangle.b,c).addScaledVector(this._triangle.c,1-(l+c)),this._vector.applyMatrix4(r.matrixWorld),s.mesh_normal=h}}break}break;default:this._vector.set(0,0,0),nt()&&!globalThis.__particlesystem_shapetype_unsupported&&(console.warn("ParticleSystem ShapeType is not supported:",wE[this.shapeType]),globalThis.__particlesystem_shapetype_unsupported=!0);break}this.randomizePosition(this._vector,this.randomPositionAmount)}this.applyRotation(this._vector),t&&(this._vector.applyQuaternion(this.system.worldQuaternion),this._vector.add(this.system.worldPos)),qS&&_t.DrawSphere(this._vector,.03,16711680,.5,!0)}getDirection(s,e){var t;if(!this.enabled)return this._dir.set(0,0,1),this._dir;switch(this.shapeType){case 5:this._dir.set(0,0,1);break;case 4:this._dir.set(0,0,1);break;case 10:case 0:const i=e.x,n=e.y,r=e.z;this._dir.set(i,n,r),(t=this.system)!=null&&t.worldspace?this._dir.sub(this.system.worldPos):this._dir.sub(this.position);break;case 13:const o=s.mesh,a=s.mesh_geometry;if(o&&a)switch(this.meshShapeType){case 0:{const l=a.getAttribute("normal"),c=s.mesh_normal;this._dir.fromBufferAttribute(l,c)}break;case 1:break;case 2:{const l=a.index;if(l){const c=s.mesh_normal,h=l.getX(c*3),u=l.getX(c*3+1),f=l.getX(c*3+2),p=a.getAttribute("position"),m=wt(),v=wt(),g=wt();m.fromBufferAttribute(p,h),v.fromBufferAttribute(p,u),g.fromBufferAttribute(p,f),m.sub(v),g.sub(v),m.cross(g),this._dir.copy(m).multiplyScalar(-1);const y=ki(o);this._dir.applyQuaternion(y)}}break}break;default:this._dir.set(0,0,1);break}return this._space===1&&this._dir.applyQuaternion(this.system.worldQuaternion),this.applyRotation(this._dir),this._dir.normalize(),this.spherizeDirection(this._dir,this.sphericalDirectionAmount),this.randomizeDirection(this._dir,this.randomDirectionAmount),qS&&(_t.DrawSphere(e,.01,8925952,.5,!0),_t.DrawDirection(e,this._dir,8925952,.5,!0)),this._dir}randomizePosition(s,e){if(e<=0)return;const t=LA._tempVec;t.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1),t.x*=e*this.scale.x,t.y*=e*this.scale.y,t.z*=e*this.scale.z,s.add(t)}randomizeDirection(s,e){if(e===0)return;const t=LA._randomQuat,i=LA._tempVec;i.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize(),t.setFromAxisAngle(i,e*Math.random()*Math.PI),s.applyQuaternion(t)}spherizeDirection(s,e){if(e===0)return;const t=Math.random()*Math.PI*2,i=Math.acos(1-Math.random()*2),n=Math.sin(i)*Math.cos(t),r=Math.sin(i)*Math.sin(t),o=Math.cos(i),a=new S(n,r,o);s.lerp(a,e)}randomSpherePoint(s,e,t,i,n){const r=Math.random(),o=Math.random(),a=2*Math.PI*r*(i/360),l=Math.acos(2*o-1),c=it.lerp(1,1-Math.pow(1-Math.random(),Math.PI),t)*e,h=s.x+this.scale.x*(-c*Math.sin(l)*Math.cos(a)),u=s.y+this.scale.y*(c*Math.sin(l)*Math.sin(a)),f=s.z+this.scale.z*(c*Math.cos(l));n.x=h,n.y=u,n.z=f}randomCirclePoint(s,e,t,i,n){const r=Math.random(),o=2*Math.PI*r*(i/360),a=it.lerp(1,1-Math.pow(1-Math.random(),Math.PI),t)*e,l=s.x+this.scale.x*a*Math.cos(o),c=s.y+this.scale.y*a*Math.sin(o),h=s.z;n.x=l,n.y=c,n.z=h}randomConePoint(s,e,t,i,n,r,o){let a=0,l=0;switch(r){case 0:a=Math.random(),l=Math.random();break;case 2:this._loopTime>1&&(this._loopDirection=-1),this._loopTime<0&&(this._loopDirection=1);case 1:a=.5,l=Math.random(),this._loopTime+=this.system.deltaTime*this._loopDirection;break}let c=2*Math.PI*a*(n/360);switch(r){case 2:case 1:c+=Math.PI+.5,c+=this._loopTime*Math.PI*2,c%=it.toRadians(n);break}const h=Math.acos(2*l-1),u=it.lerp(1,1-Math.pow(1-Math.random(),Math.PI),i)*t,f=s.x+-u*Math.sin(h)*Math.cos(c),p=s.y+u*Math.sin(h)*Math.sin(c),m=s.z;o.x=f*this.scale.x,o.y=p*this.scale.y,o.z=m*this.scale.z}},d(FC,"_randomQuat",new Ce),d(FC,"_tempVec",new S),FC);let On=LA;oe([C()],On.prototype,"shapeType",2);oe([C()],On.prototype,"enabled",2);oe([C()],On.prototype,"alignToDirection",2);oe([C()],On.prototype,"angle",2);oe([C()],On.prototype,"arc",2);oe([C()],On.prototype,"arcSpread",2);oe([C()],On.prototype,"arcSpeedMultiplier",2);oe([C()],On.prototype,"arcMode",2);oe([C(S)],On.prototype,"boxThickness",2);oe([C(S)],On.prototype,"position",2);oe([C(S)],On.prototype,"rotation",2);oe([C(S)],On.prototype,"scale",2);oe([C()],On.prototype,"radius",2);oe([C()],On.prototype,"radiusThickness",2);oe([C()],On.prototype,"sphericalDirectionAmount",2);oe([C()],On.prototype,"randomDirectionAmount",2);oe([C()],On.prototype,"randomPositionAmount",2);oe([C()],On.prototype,"meshShapeType",2);oe([C(_x)],On.prototype,"meshRenderer",2);class Pi{constructor(){d(this,"damping");d(this,"enabled");d(this,"frequency");d(this,"octaveCount");d(this,"octaveMultiplier");d(this,"octaveScale");d(this,"positionAmount");d(this,"quality");d(this,"remap");d(this,"remapEnabled");d(this,"remapMultiplier");d(this,"remapX");d(this,"remapXMultiplier");d(this,"remapY");d(this,"remapYMultiplier");d(this,"remapZ");d(this,"remapZMultiplier");d(this,"scrollSpeedMultiplier");d(this,"separateAxes");d(this,"strengthMultiplier");d(this,"strengthX");d(this,"strengthXMultiplier");d(this,"strengthY");d(this,"strengthYMultiplier");d(this,"strengthZ");d(this,"strengthZMultiplier");d(this,"_noise");d(this,"_time",0);d(this,"_temp",new S)}update(e){this._time+=e.time.deltaTime*this.scrollSpeedMultiplier}apply(e,t,i,n,r,o){if(!this.enabled)return;this._noise||(this._noise=y0e(()=>0));const a=this._temp.set(t.x,t.y,t.z).multiplyScalar(this.frequency),l=this._noise(a.x,a.y,a.z,this._time),c=this._noise(a.x,a.y,a.z,this._time+1e3*this.frequency),h=this._noise(a.x,a.y,a.z,this._time+2e3*this.frequency);this._temp.set(l,c,h).normalize();const u=r/o;let f=this.positionAmount.evaluate(u);this.separateAxes?(this._temp.x*=f*this.strengthXMultiplier,this._temp.y*=f*this.strengthYMultiplier,this._temp.z*=f*this.strengthZMultiplier):(this.strengthX&&(f*=this.strengthX.evaluate(u)*1.5),this._temp.multiplyScalar(f)),i.x+=this._temp.x,i.y+=this._temp.y,i.z+=this._temp.z}}oe([C()],Pi.prototype,"damping",2);oe([C()],Pi.prototype,"enabled",2);oe([C()],Pi.prototype,"frequency",2);oe([C()],Pi.prototype,"octaveCount",2);oe([C()],Pi.prototype,"octaveMultiplier",2);oe([C()],Pi.prototype,"octaveScale",2);oe([C(At)],Pi.prototype,"positionAmount",2);oe([C()],Pi.prototype,"quality",2);oe([C(At)],Pi.prototype,"remap",2);oe([C()],Pi.prototype,"remapEnabled",2);oe([C()],Pi.prototype,"remapMultiplier",2);oe([C(At)],Pi.prototype,"remapX",2);oe([C()],Pi.prototype,"remapXMultiplier",2);oe([C(At)],Pi.prototype,"remapY",2);oe([C()],Pi.prototype,"remapYMultiplier",2);oe([C(At)],Pi.prototype,"remapZ",2);oe([C()],Pi.prototype,"remapZMultiplier",2);oe([C()],Pi.prototype,"scrollSpeedMultiplier",2);oe([C()],Pi.prototype,"separateAxes",2);oe([C()],Pi.prototype,"strengthMultiplier",2);oe([C(At)],Pi.prototype,"strengthX",2);oe([C()],Pi.prototype,"strengthXMultiplier",2);oe([C(At)],Pi.prototype,"strengthY",2);oe([C()],Pi.prototype,"strengthYMultiplier",2);oe([C(At)],Pi.prototype,"strengthZ",2);oe([C()],Pi.prototype,"strengthZMultiplier",2);class Mn{constructor(){d(this,"enabled");d(this,"attachRibbonToTransform",!1);d(this,"colorOverLifetime");d(this,"colorOverTrail");d(this,"dieWithParticles",!0);d(this,"inheritParticleColor",!0);d(this,"lifetime");d(this,"lifetimeMultiplier");d(this,"minVertexDistance",.2);d(this,"mode",0);d(this,"ratio",1);d(this,"ribbonCount",1);d(this,"shadowBias",0);d(this,"sizeAffectsLifetime",!1);d(this,"sizeAffectsWidth",!1);d(this,"splitSubEmitterRibbons",!1);d(this,"textureMode",0);d(this,"widthOverTrail");d(this,"widthOverTrailMultiplier");d(this,"worldSpace",!1)}getWidth(e,t,i,n){const r=this.widthOverTrail.evaluate(i,n);return e*=r,e}getColor(e,t,i){const n=this.colorOverTrail.evaluate(i),r=this.colorOverLifetime.evaluate(t);e.x*=n.r*r.r,e.y*=n.g*r.g,e.z*=n.b*r.b,e.w*=n.alpha*r.alpha}}oe([C()],Mn.prototype,"enabled",2);oe([C()],Mn.prototype,"attachRibbonToTransform",2);oe([C(Ho)],Mn.prototype,"colorOverLifetime",2);oe([C(Ho)],Mn.prototype,"colorOverTrail",2);oe([C()],Mn.prototype,"dieWithParticles",2);oe([C()],Mn.prototype,"inheritParticleColor",2);oe([C(At)],Mn.prototype,"lifetime",2);oe([C()],Mn.prototype,"lifetimeMultiplier",2);oe([C()],Mn.prototype,"minVertexDistance",2);oe([C()],Mn.prototype,"mode",2);oe([C()],Mn.prototype,"ratio",2);oe([C()],Mn.prototype,"ribbonCount",2);oe([C()],Mn.prototype,"shadowBias",2);oe([C()],Mn.prototype,"sizeAffectsLifetime",2);oe([C()],Mn.prototype,"sizeAffectsWidth",2);oe([C()],Mn.prototype,"splitSubEmitterRibbons",2);oe([C()],Mn.prototype,"textureMode",2);oe([C(At)],Mn.prototype,"widthOverTrail",2);oe([C()],Mn.prototype,"widthOverTrailMultiplier",2);oe([C()],Mn.prototype,"worldSpace",2);class Ln{constructor(){d(this,"enabled");d(this,"space",0);d(this,"orbitalX");d(this,"orbitalY");d(this,"orbitalZ");d(this,"orbitalXMultiplier");d(this,"orbitalYMultiplier");d(this,"orbitalZMultiplier");d(this,"orbitalOffsetX");d(this,"orbitalOffsetY");d(this,"orbitalOffsetZ");d(this,"speedModifier");d(this,"speedModifierMultiplier");d(this,"x");d(this,"xMultiplier");d(this,"y");d(this,"yMultiplier");d(this,"z");d(this,"zMultiplier");d(this,"_system");d(this,"_temp",new S);d(this,"_temp2",new S);d(this,"_temp3",new S);d(this,"_hasOrbital",!1);d(this,"_index",0);d(this,"_orbitalMatrix",new le)}update(e){this._system=e}init(e){this._index==0&&(e.debug=!0),this._index+=1,e.orbitx=this.orbitalX.evaluate(Math.random()),e.orbity=this.orbitalY.evaluate(Math.random()),e.orbitz=this.orbitalZ.evaluate(Math.random()),this._hasOrbital=e.orbitx!=0||e.orbity!=0||e.orbitz!=0}apply(e,t,i,n,r,o,a){var p;if(!this.enabled)return;const l=o/a,c=this.speedModifier.evaluate(l)*this.speedModifierMultiplier,h=this.x.evaluate(l),u=this.y.evaluate(l),f=this.z.evaluate(l);if(this._temp.set(-h,u,f),this._system&&this._system.main.simulationSpace===1&&this._temp.applyQuaternion(this._system.worldQuaternion),this._hasOrbital&&((p=this._system)==null?void 0:p.worldPos)){const v=this._temp2.set(i.x,i.y,i.z),g=this.orbitalXMultiplier,y=this.orbitalYMultiplier,A=this.orbitalZMultiplier,_=c*Math.PI*2*10,b=Math.cos(_*g),x=Math.sin(_*g),E=Math.cos(_*y),M=Math.sin(_*y),T=Math.cos(_*A),R=Math.sin(_*A),w=v.x*(E*T)+v.y*(E*R)+v.z*-M,I=v.x*(x*M*T-b*R)+v.y*(x*M*R+b*T)+v.z*(x*E),O=v.x*(b*M*T+x*R)+v.y*(b*M*R-x*T)+v.z*(b*E),k=this._temp3.set(v.x-w,v.y-I,v.z-O);k.normalize(),k.multiplyScalar(.2/r*Math.max(this.orbitalXMultiplier,this.orbitalYMultiplier,this.orbitalZMultiplier)),n.x+=k.x,n.y+=k.y,n.z+=k.z}n.x+=this._temp.x,n.y+=this._temp.y,n.z+=this._temp.z,n.x*=c,n.y*=c,n.z*=c}}oe([C()],Ln.prototype,"enabled",2);oe([C()],Ln.prototype,"space",2);oe([C(At)],Ln.prototype,"orbitalX",2);oe([C(At)],Ln.prototype,"orbitalY",2);oe([C(At)],Ln.prototype,"orbitalZ",2);oe([C()],Ln.prototype,"orbitalXMultiplier",2);oe([C()],Ln.prototype,"orbitalYMultiplier",2);oe([C()],Ln.prototype,"orbitalZMultiplier",2);oe([C()],Ln.prototype,"orbitalOffsetX",2);oe([C()],Ln.prototype,"orbitalOffsetY",2);oe([C()],Ln.prototype,"orbitalOffsetZ",2);oe([C(At)],Ln.prototype,"speedModifier",2);oe([C()],Ln.prototype,"speedModifierMultiplier",2);oe([C(At)],Ln.prototype,"x",2);oe([C()],Ln.prototype,"xMultiplier",2);oe([C(At)],Ln.prototype,"y",2);oe([C()],Ln.prototype,"yMultiplier",2);oe([C(At)],Ln.prototype,"z",2);oe([C()],Ln.prototype,"zMultiplier",2);class Er{constructor(){d(this,"animation");d(this,"enabled");d(this,"cycleCount");d(this,"frameOverTime");d(this,"frameOverTimeMultiplier");d(this,"numTilesX");d(this,"numTilesY");d(this,"startFrame");d(this,"startFrameMultiplier");d(this,"rowMode");d(this,"rowIndex");d(this,"spriteCount");d(this,"timeMode")}sampleOnceAtStart(){if(this.timeMode===0)switch(this.frameOverTime.mode){case 0:case 3:case 2:case 1:return!0}return!1}getStartIndex(){return this.sampleOnceAtStart()?Math.random()*(this.numTilesX*this.numTilesY):0}evaluate(e){if(!this.sampleOnceAtStart())return this.getIndex(e)}getIndex(e){const t=this.numTilesX*this.numTilesY;e=e*this.cycleCount;let i=this.frameOverTime.evaluate(e%1);return i*=this.frameOverTimeMultiplier,i*=t,i=i%t,i=Math.floor(i),i}}oe([C()],Er.prototype,"animation",2);oe([C()],Er.prototype,"enabled",2);oe([C()],Er.prototype,"cycleCount",2);oe([C(At)],Er.prototype,"frameOverTime",2);oe([C()],Er.prototype,"frameOverTimeMultiplier",2);oe([C()],Er.prototype,"numTilesX",2);oe([C()],Er.prototype,"numTilesY",2);oe([C(At)],Er.prototype,"startFrame",2);oe([C()],Er.prototype,"startFrameMultiplier",2);oe([C()],Er.prototype,"rowMode",2);oe([C()],Er.prototype,"rowIndex",2);oe([C()],Er.prototype,"spriteCount",2);oe([C()],Er.prototype,"timeMode",2);class fl{constructor(){d(this,"enabled");d(this,"separateAxes");d(this,"x");d(this,"xMultiplier");d(this,"y");d(this,"yMultiplier");d(this,"z");d(this,"zMultiplier")}evaluate(e,t){return this.enabled?this.separateAxes?0:this.z.evaluate(e,t)*-1:0}}oe([C()],fl.prototype,"enabled",2);oe([C()],fl.prototype,"separateAxes",2);oe([C(At)],fl.prototype,"x",2);oe([C()],fl.prototype,"xMultiplier",2);oe([C(At)],fl.prototype,"y",2);oe([C()],fl.prototype,"yMultiplier",2);oe([C(At)],fl.prototype,"z",2);oe([C()],fl.prototype,"zMultiplier",2);class Ia{constructor(){d(this,"enabled");d(this,"range");d(this,"separateAxes");d(this,"x");d(this,"xMultiplier");d(this,"y");d(this,"yMultiplier");d(this,"z");d(this,"zMultiplier")}evaluate(e,t){if(!this.enabled)return 0;if(!this.separateAxes){const i=it.lerp(this.range.x,this.range.y,t);return this.z.evaluate(i)*-1}return 0}}oe([C()],Ia.prototype,"enabled",2);oe([C()],Ia.prototype,"range",2);oe([C()],Ia.prototype,"separateAxes",2);oe([C(At)],Ia.prototype,"x",2);oe([C()],Ia.prototype,"xMultiplier",2);oe([C(At)],Ia.prototype,"y",2);oe([C()],Ia.prototype,"yMultiplier",2);oe([C(At)],Ia.prototype,"z",2);oe([C()],Ia.prototype,"zMultiplier",2);class ys{constructor(){d(this,"enabled");d(this,"dampen");d(this,"drag");d(this,"dragMultiplier");d(this,"limit");d(this,"limitMultiplier");d(this,"separateAxes");d(this,"limitX");d(this,"limitXMultiplier");d(this,"limitY");d(this,"limitYMultiplier");d(this,"limitZ");d(this,"limitZMultiplier");d(this,"multiplyDragByParticleSize",!1);d(this,"multiplyDragByParticleVelocity",!1);d(this,"space");d(this,"_temp",new S);d(this,"_temp2",new S)}apply(e,t,i,n,r,o,a){if(this.enabled){const l=this.limit.evaluate(r)*this.limitMultiplier;if(t.length()>l){this._temp.copy(t).normalize().multiplyScalar(l);const h=this.dampen*.5;t.x=it.lerp(t.x,this._temp.x,h),t.y=it.lerp(t.y,this._temp.y,h),t.z=it.lerp(t.z,this._temp.z,h),i.x=it.lerp(i.x,this._temp.x,h),i.y=it.lerp(i.y,this._temp.y,h),i.z=it.lerp(i.z,this._temp.z,h)}}}}oe([C()],ys.prototype,"enabled",2);oe([C()],ys.prototype,"dampen",2);oe([C(At)],ys.prototype,"drag",2);oe([C()],ys.prototype,"dragMultiplier",2);oe([C(At)],ys.prototype,"limit",2);oe([C()],ys.prototype,"limitMultiplier",2);oe([C()],ys.prototype,"separateAxes",2);oe([C(At)],ys.prototype,"limitX",2);oe([C()],ys.prototype,"limitXMultiplier",2);oe([C(At)],ys.prototype,"limitY",2);oe([C()],ys.prototype,"limitYMultiplier",2);oe([C(At)],ys.prototype,"limitZ",2);oe([C()],ys.prototype,"limitZMultiplier",2);oe([C()],ys.prototype,"multiplyDragByParticleSize",2);oe([C()],ys.prototype,"multiplyDragByParticleVelocity",2);oe([C()],ys.prototype,"space",2);const tq=class{constructor(){d(this,"enabled");d(this,"curve");d(this,"curveMultiplier");d(this,"mode");d(this,"system");d(this,"_temp",new S);d(this,"_firstUpdate",!0);d(this,"_frames",0)}clone(){var e;const s=new tq;return s.enabled=this.enabled,s.curve=(e=this.curve)==null?void 0:e.clone(),s.curveMultiplier=this.curveMultiplier,s.mode=this.mode,s}get _lastWorldPosition(){return this.system._iv_lastWorldPosition||(this.system._iv_lastWorldPosition=new S),this.system._iv_lastWorldPosition}get _velocity(){return this.system._iv_velocity||(this.system._iv_velocity=new S),this.system._iv_velocity}awake(s){this.system=s,this.reset()}reset(){this._firstUpdate=!0}update(s){this.enabled&&this.system.worldspace!==!1&&(this._firstUpdate?(this._firstUpdate=!1,this._velocity.set(0,0,0),this._lastWorldPosition.copy(this.system.worldPos)):this._lastWorldPosition&&(this._velocity.copy(this.system.worldPos).sub(this._lastWorldPosition).multiplyScalar(1/this.system.deltaTime),this._lastWorldPosition.copy(this.system.worldPos)))}applyInitial(s){if(this.enabled&&this.system.worldspace!==!1&&this.mode===0){const e=this.curve.evaluate(Math.random(),Math.random());this._temp.copy(this._velocity).multiplyScalar(e),s.add(this._temp)}}applyCurrent(s,e,t){if(this.enabled&&this.system&&this.system.worldspace!==!1&&this.mode===1){const i=this.curve.evaluate(e,t);this._temp.copy(this._velocity).multiplyScalar(i),s.add(this._temp)}}};let yf=tq;oe([C()],yf.prototype,"enabled",2);oe([C(At)],yf.prototype,"curve",2);oe([C()],yf.prototype,"curveMultiplier",2);oe([C()],yf.prototype,"mode",2);class xo{constructor(){d(this,"enabled");d(this,"range");d(this,"separateAxes");d(this,"size");d(this,"sizeMultiplier");d(this,"x");d(this,"xMultiplier");d(this,"y");d(this,"yMultiplier");d(this,"z");d(this,"zMultiplier")}evaluate(e,t,i,n){const r=e.length(),o=it.remap(r,this.range.x,this.range.y,0,1),a=this.size.evaluate(o,i);return n*a}}oe([C()],xo.prototype,"enabled",2);oe([C(ee)],xo.prototype,"range",2);oe([C()],xo.prototype,"separateAxes",2);oe([C(At)],xo.prototype,"size",2);oe([C()],xo.prototype,"sizeMultiplier",2);oe([C(At)],xo.prototype,"x",2);oe([C()],xo.prototype,"xMultiplier",2);oe([C(At)],xo.prototype,"y",2);oe([C()],xo.prototype,"yMultiplier",2);oe([C(At)],xo.prototype,"z",2);oe([C()],xo.prototype,"zMultiplier",2);class Rm{constructor(){d(this,"enabled");d(this,"range");d(this,"color")}evaluate(e,t,i){const n=e.length(),r=it.remap(n,this.range.x,this.range.y,0,1),o=this.color.evaluate(r,t);i.x*=o.r,i.y*=o.g,i.z*=o.b,i.w*=o.alpha}}oe([C()],Rm.prototype,"enabled",2);oe([C(ee)],Rm.prototype,"range",2);oe([C(Ho)],Rm.prototype,"color",2);const q0e={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},X0e={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var Y0e=Object.defineProperty,K0e=Object.getOwnPropertyDescriptor,Xv=(s,e,t,i)=>{for(var n=i>1?void 0:i?K0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Y0e(e,t,n),n};const XS=ie("debugcontactshadows");cF(s=>{const e=s.domElement.getAttribute("contactshadows");e!=null&&e!="0"&&e!="false"&&Zc.auto(s)});var PB;const iq=(PB=class extends Ie{constructor(){super(...arguments);d(this,"autoFit",!1);d(this,"darkness",.5);d(this,"opacity",.5);d(this,"blur",4);d(this,"occludeBelowGround",!1);d(this,"backfaceShadows",!0);d(this,"minSize");d(this,"shadowsRoot",new ye);d(this,"shadowCamera");d(this,"shadowGroup",new Vs);d(this,"renderTarget");d(this,"renderTargetBlur");d(this,"plane");d(this,"occluderMesh");d(this,"blurPlane");d(this,"depthMaterial");d(this,"horizontalBlurMaterial");d(this,"verticalBlurMaterial");d(this,"textureSize",512)}static auto(e){if(e||(e=Dt.Current),!e)throw new Error("No context provided and no current context set.");let t=this._instances.get(e);if(!t||t.destroyed){const i=new ye;t=va(i,iq,{autoFit:!1,occludeBelowGround:!1}),this._instances.set(e,t)}return e.scene.add(t.gameObject),t.fitShadows(),t}fitShadows(){XS&&console.log("Fitting shadows to scene"),k2(this.gameObject,!1);const e=Hl(this.context.scene.children,[this.gameObject]),t=Math.max(1,this.blur/32),i=e.max.x-e.min.x,n=e.max.z-e.min.z;e.expandByVector(new S(t*i,0,t*n)),XS&&_t.DrawWireBox3(e,16776960,60),this.gameObject.parent&&e.applyMatrix4(this.gameObject.parent.matrixWorld.clone().invert());const r=e.min,o=Math.max(1e-5,(e.max.y-r.y)*.002);e.max.y+=o,this.shadowsRoot.position.set((r.x+e.max.x)/2,r.y-o,(r.z+e.max.z)/2),this.shadowsRoot.scale.set(e.max.x-r.x,e.max.y-r.y,e.max.z-r.z),this.applyMinSize(),this.shadowsRoot.matrixWorldNeedsUpdate=!0}awake(){k2(this.gameObject,!1)}start(){XS&&console.log("Create ContactShadows on "+this.gameObject.name,this),this.gameObject.add(this.shadowsRoot),this.shadowsRoot.add(this.shadowGroup),this.renderTarget=new $t(this.textureSize,this.textureSize),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new $t(this.textureSize,this.textureSize),this.renderTargetBlur.texture.generateMipmaps=!1;const e=new ps(1,1).rotateX(Math.PI/2);this.gameObject instanceof fe&&(console.warn("ContactShadows can not be added to a Mesh. Please add it to a Group or an empty Object"),fd(this.gameObject,!1));const t=new ti({map:this.renderTarget.texture,opacity:this.opacity,color:0,transparent:!0,depthWrite:!1,side:$n});this.plane=new fe(e,t),this.plane.scale.y=-1,this.plane.layers.set(2),this.shadowsRoot.add(this.plane),this.plane&&(this.plane.renderOrder=1),this.occluderMesh=new fe(this.plane.geometry,new ti({depthWrite:!0,stencilWrite:!0,colorWrite:!1,side:bn})).translateY(-1e-4),this.occluderMesh.renderOrder=-100,this.occluderMesh.layers.set(2),this.shadowsRoot.add(this.occluderMesh),this.blurPlane=new fe(e),this.blurPlane.visible=!1,this.shadowGroup.add(this.blurPlane);const i=0,n=1;this.shadowCamera=new Qc(-1/2,1/2,1/2,-1/2,i,n),this.shadowCamera.layers.enableAll(),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.depthMaterial=new Rb,this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.blending=BO,this.depthMaterial.blendEquation=I1,this.depthMaterial.onBeforeCompile=r=>{this.depthMaterial&&(r.uniforms.darkness=this.depthMaterial.userData.darkness,r.fragmentShader=`
                uniform float darkness;
                ${r.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 ), ( 1.0 - fragCoordZ ) * darkness * opacity * (gl_FrontFacing ? 1.0 : 0.66) );")}
            `)},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new kt(q0e),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new kt(X0e),this.verticalBlurMaterial.depthTest=!1,this.shadowGroup.visible=!1,this.autoFit?this.fitShadows():this.applyMinSize()}onDestroy(){var e,t,i,n,r,o,a,l;(e=this.renderTarget)==null||e.dispose(),(t=this.renderTargetBlur)==null||t.dispose(),(i=this.depthMaterial)==null||i.dispose(),(n=this.horizontalBlurMaterial)==null||n.dispose(),(r=this.verticalBlurMaterial)==null||r.dispose(),(o=this.blurPlane)==null||o.geometry.dispose(),(a=this.plane)==null||a.geometry.dispose(),(l=this.occluderMesh)==null||l.geometry.dispose()}onBeforeRender(e){if(!this.renderTarget||!this.renderTargetBlur||!this.depthMaterial||!this.shadowCamera||!this.blurPlane||!this.shadowGroup||!this.plane||!this.horizontalBlurMaterial||!this.verticalBlurMaterial){XS&&console.error("ContactShadows: not initialized yet");return}const t=this.context.scene,i=this.context.renderer,n=i.getRenderTarget();this.shadowGroup.visible=!0,this.occluderMesh&&(this.occluderMesh.visible=!1);const r=this.plane.visible;this.plane.visible=!1,this.gameObject instanceof fe&&fd(this.gameObject,!1);const o=t.background;t.background=null,t.overrideMaterial=this.depthMaterial,this.backfaceShadows?this.depthMaterial.side=_i:this.depthMaterial.side=$n;const a=i.getClearAlpha();i.setClearAlpha(0);const l=i.xr.enabled;i.xr.enabled=!1;const c=this.context.scene.matrixWorldAutoUpdate;this.context.scene.matrixWorldAutoUpdate=!1;const h=i.renderLists.get(t,0),u=h.transparent;bH.length=0,h.transparent=bH,LP.length=0;for(const p of h.opaque){if(!p.object.visible)continue;const m=p.material;let v=p.material.colorWrite==!1||m.wireframe===!0||PQ(p.object)===!1;!v&&p.material.linewidth!=null&&(v=!0),v&&(LP.push(p.object),p.object["needle:visible"]=p.object.visible,p.object.visible=!1)}i.setRenderTarget(this.renderTarget),i.clear(),i.render(t,this.shadowCamera),h.transparent=u;for(const p of LP)p["needle:visible"]!=null&&(p.visible=p["needle:visible"]);t.overrideMaterial=null;const f=Math.max(this.blur,.05);this.blurShadow(f*2),this.blurShadow(f*.5),this.shadowGroup.visible=!1,this.occluderMesh&&(this.occluderMesh.visible=this.occludeBelowGround),this.plane.visible=r,i.setRenderTarget(n),i.setClearAlpha(a),t.background=o,i.xr.enabled=l,this.context.scene.matrixWorldAutoUpdate=c}blurShadow(e){if(!this.blurPlane||!this.shadowCamera||!this.renderTarget||!this.renderTargetBlur||!this.horizontalBlurMaterial||!this.verticalBlurMaterial)return;this.blurPlane.visible=!0;const t=this.shadowsRoot.worldScale,i=(t.x+t.z)/2,n=t.z/i,r=t.x/i;this.blurPlane.material=this.horizontalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=e*1/this.textureSize*n;const o=this.context.renderer,a=o.getRenderTarget();o.setRenderTarget(this.renderTargetBlur),o.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.blurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=e*1/this.textureSize*r,o.setRenderTarget(this.renderTarget),o.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1,o.setRenderTarget(a)}applyMinSize(){this.minSize&&this.shadowsRoot.scale.set(Math.max(this.minSize.x||0,this.shadowsRoot.scale.x),Math.max(this.minSize.y||0,this.shadowsRoot.scale.y),Math.max(this.minSize.z||0,this.shadowsRoot.scale.z))}},d(PB,"_instances",new Map),PB);let Zc=iq;Xv([C()],Zc.prototype,"autoFit",2);Xv([C()],Zc.prototype,"darkness",2);Xv([C()],Zc.prototype,"opacity",2);Xv([C()],Zc.prototype,"blur",2);Xv([C()],Zc.prototype,"occludeBelowGround",2);Xv([C()],Zc.prototype,"backfaceShadows",2);const bH=[],LP=new Array,zU=class{constructor(){d(this,"_quicklookButton");d(this,"_arButton");d(this,"_vrButton");d(this,"_sendToQuestButton")}static create(){return new zU}static getOrCreate(){return this._instance||(this._instance=this.create()),this._instance}get isSecureConnection(){return window.location.protocol==="https:"}get quicklookButton(){return this._quicklookButton}get arButton(){return this._arButton}get vrButton(){return this._vrButton}get sendToQuestButton(){return this._sendToQuestButton}get qrButton(){return Ll.getOrCreate().createQRCode()}createQuicklookButton(){if(this._quicklookButton)return this._quicklookButton;const e=document.createElement("button");this._quicklookButton=e,e.dataset.needle="quicklook-button",e.innerText="Open in Quicklook",e.prepend(dr("view_in_ar"));let t=!1,i=null;return e.addEventListener("click",()=>{i=KM(Gn),i||(t=!0,i=new Gn),t&&(i.objectToExport=Dt.Current.scene),i?(e.classList.add("this-mode-is-requested"),i.exportAndOpen().then(()=>{e.classList.remove("this-mode-is-requested")}).catch(n=>{e.classList.remove("this-mode-is-requested"),console.error(n)})):console.warn("No USDZExporter component found in the scene")}),this.hideElementDuringXRSession(e),e}createARButton(e){var n;if(this._arButton)return this._arButton;const t="immersive-ar",i=document.createElement("button");return this._arButton=i,i.classList.add("webxr-button"),i.dataset.needle="webxr-ar-button",i.innerText="Enter AR",i.prepend(dr("view_in_ar")),i.title="Click to start an AR session",i.addEventListener("click",()=>Mt.start(t,e)),this.updateSessionSupported(i,t),this.listenToXRSessionState(i,t),this.hideElementDuringXRSession(i),this.isSecureConnection||(i.disabled=!0,i.title="WebXR requires a secure connection (HTTPS)"),Dp()||(n=navigator.xr)==null||n.addEventListener("devicechange",()=>this.updateSessionSupported(i,t)),i}createVRButton(e){var n;if(this._vrButton)return this._vrButton;const t="immersive-vr",i=document.createElement("button");return this._vrButton=i,i.classList.add("webxr-button"),i.dataset.needle="webxr-vr-button",i.innerText="Enter VR",i.prepend(dr("panorama_photosphere")),i.title="Click to start a VR session",i.addEventListener("click",()=>Mt.start(t,e)),this.updateSessionSupported(i,t),this.listenToXRSessionState(i,t),this.hideElementDuringXRSession(i),this.isSecureConnection||(i.disabled=!0,i.title="WebXR requires a secure connection (HTTPS)"),Dp()||(n=navigator.xr)==null||n.addEventListener("devicechange",()=>this.updateSessionSupported(i,t)),i}createSendToQuestButton(){var i;if(this._sendToQuestButton)return this._sendToQuestButton;const e="https://oculus.com/open_url/?url=",t=document.createElement("button");return this._sendToQuestButton=t,t.dataset.needle="webxr-sendtoquest-button",t.innerText="Open on Quest",t.prepend(dr("share_windows")),t.title="Click to send this page to the Oculus Browser on your Quest",t.addEventListener("click",()=>{const n=encodeURIComponent(window.location.href),r=e+n;window.open(r)==null&&_n("This page doesn't allow popups. Please paste "+r+" into your browser.")}),this.listenToXRSessionState(t),this.hideElementDuringXRSession(t),Dp()||(i=navigator.xr)==null||i.addEventListener("devicechange",()=>{var n;(n=navigator.xr)!=null&&n.isSessionSupported("immersive-vr")?t.style.display="none":t.style.display=""}),t}createQRCode(){return Ll.getOrCreate().createQRCode()}updateSessionSupported(e,t){if(!("xr"in navigator)){e.style.display="none";return}Mt.isSessionSupported(t).then(i=>{e.style.display=i?"":"none",nt()&&!i&&console.log('[WebXR] "'+t+'" is not supported on this device  make sure your server runs using HTTPS and you have a device connected that supports '+t)})}hideElementDuringXRSession(e){VM(t=>{e["previous-display"]=e.style.display,e.style.display="none"}),Ek(t=>{e["previous-display"]!=null&&(e.style.display=e["previous-display"])})}listenToXRSessionState(e,t){t&&(Mt.onSessionRequestStart(i=>{i.mode===t?e.classList.add("this-mode-is-requested"):(e["was-disabled"]=e.disabled,e.disabled=!0,e.classList.add("other-mode-is-requested"))}),Mt.onSessionRequestEnd(i=>{e.classList.remove("this-mode-is-requested"),e.classList.remove("other-mode-is-requested"),e.disabled=e["was-disabled"]}))}};let nu=zU;d(nu,"_instance");var J0e=Object.defineProperty,Z0e=Object.getOwnPropertyDescriptor,qs=(s,e,t,i)=>{for(var n=i>1?void 0:i?Z0e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&J0e(e,t,n),n};const SE=ie("debugspriterenderer"),$0e=ie("wireframe"),kE=class{static getOrCreateGeometry(e){if(e.__cached_geometry)return e.__cached_geometry;if(e.guid&&kE.cache[e.guid])return SE&&console.log("Take cached geometry for sprite",e.guid),kE.cache[e.guid];const t=new yt;e.__cached_geometry=t;const i=new Float32Array(e.triangles.length*3),n=new Float32Array(e.triangles.length*2);for(let r=0;r<e.triangles.length;r+=1){const o=e.triangles[r];i[r*3]=-e.vertices[o].x,i[r*3+1]=e.vertices[o].y,i[r*3+2]=0;const a=e.uv[o];n[r*2]=a.x,n[r*2+1]=1-a.y}return t.setAttribute("position",new Ke(i,3)),t.setAttribute("uv",new Ke(n,2)),e.guid&&(this.cache[e.guid]=t),SE&&console.log("Built sprite geometry",e,t),t}};let jp=kE;d(jp,"cache",{});class eAe{constructor(){d(this,"x");d(this,"y")}}class yu{constructor(){d(this,"guid");d(this,"texture");d(this,"triangles");d(this,"uv");d(this,"vertices");d(this,"__cached_geometry");d(this,"_mesh");d(this,"_material")}get mesh(){return this._mesh||(this._mesh=new fe(jp.getOrCreateGeometry(this),this.material)),this._mesh}get material(){return this._material||(this.texture&&(this.texture.colorSpace=bt,this.texture.minFilter==Ot&&this.texture.magFilter==Ot&&(this.texture.anisotropy=1),this.texture.needsUpdate=!0),this._material=new ti({map:this.texture,color:16777215,side:_i,transparent:!0})),this._material}getGeometry(){return jp.getOrCreateGeometry(this)}}qs([C()],yu.prototype,"guid",2);qs([C(Wt)],yu.prototype,"texture",2);qs([Dv()],yu.prototype,"triangles",2);qs([Dv()],yu.prototype,"uv",2);qs([Dv()],yu.prototype,"vertices",2);const kP=Symbol("spriteOwner");class xx{constructor(){d(this,"sprites")}}qs([C(yu)],xx.prototype,"sprites",2);class Yv{constructor(){d(this,"spriteSheet");d(this,"index",0)}update(e){if(!this.spriteSheet)return;const t=this.index;if(t<0||t>=this.spriteSheet.sprites.length)return;const i=this.spriteSheet.sprites[t],n=i==null?void 0:i.texture;if(n&&(n.colorSpace=bt,n.minFilter==Ot&&n.magFilter==Ot&&(n.anisotropy=1),n.needsUpdate=!0,!i.__hasLoadedProgressive)){i.__hasLoadedProgressive=!0;const r=n;yi.assignTextureLOD(n,0).then(o=>{o instanceof Wt&&(i.texture=o,(e==null?void 0:e.map)===r&&(e.map=o,e.needsUpdate=!0))})}}}qs([C(xx)],Yv.prototype,"spriteSheet",2);qs([C()],Yv.prototype,"index",2);class Vo extends Ie{constructor(){super(...arguments);d(this,"drawMode",0);d(this,"size",{x:1,y:1});d(this,"color");d(this,"sharedMaterial");d(this,"transparent",!0);d(this,"cutoutThreshold",0);d(this,"castShadows",!1);d(this,"renderOrder",0);d(this,"toneMapped",!0);d(this,"_spriteSheet");d(this,"_currentSprite")}get sprite(){return this._spriteSheet}set sprite(t){if(t!==this._spriteSheet)if(typeof t=="number"){const i=Math.floor(t);this.spriteIndex=i;return}else this._spriteSheet=t,this.updateSprite()}set spriteIndex(t){this._spriteSheet&&(this._spriteSheet.index=t,this.updateSprite())}get spriteIndex(){var t;return((t=this._spriteSheet)==null?void 0:t.index)??0}get spriteFrames(){var t,i;return((i=(t=this._spriteSheet)==null?void 0:t.spriteSheet)==null?void 0:i.sprites.length)??0}awake(){this._currentSprite=void 0,SE&&console.log("Awake",this.name,this,this.sprite)}start(){this._currentSprite?this.gameObject&&this.gameObject.add(this._currentSprite):this.updateSprite()}updateSprite(t=!1){var n,r,o;if(!this.__didAwake&&!t||!((r=(n=this.sprite)==null?void 0:n.spriteSheet)!=null&&r.sprites))return;const i=this.sprite.spriteSheet.sprites[this.spriteIndex];if(!i){SE&&console.warn("Sprite not found",this.spriteIndex,this.sprite.spriteSheet.sprites);return}if(this._currentSprite)this._currentSprite.geometry=jp.getOrCreateGeometry(i),this._currentSprite.material.map=i.texture;else{const a=new ti({color:16777215,side:_i});if(!a)return;if($0e&&(a.wireframe=!0),this.color&&(a.color||(a.color=new Ae),a.color.copy(this.color),a.opacity=this.color.alpha),a.transparent=!0,a.toneMapped=this.toneMapped,i.texture&&!a.wireframe){let l=i.texture;l[kP]!==void 0&&l[kP]!==this&&this.spriteFrames>1&&(l=i.texture=l.clone()),l[kP]=this,a.map=l}this.sharedMaterial=a,this._currentSprite=new fe(jp.getOrCreateGeometry(i),a),this._currentSprite.renderOrder=Math.round(this.renderOrder),yi.assignTextureLOD(a,0)}this._currentSprite.parent!==this.gameObject&&(this.drawMode===2&&this._currentSprite.scale.set(this.size.x,this.size.y,1),this.gameObject&&this.gameObject.add(this._currentSprite)),this._currentSprite&&this._currentSprite.layers.set(this.layer),this.sharedMaterial&&(this.sharedMaterial.alphaTest=this.cutoutThreshold,this.sharedMaterial.transparent=this.transparent),this._currentSprite.castShadow=this.castShadows,(o=this._spriteSheet)==null||o.update(this.sharedMaterial)}}qs([C()],Vo.prototype,"drawMode",2);qs([C(eAe)],Vo.prototype,"size",2);qs([C(Ui)],Vo.prototype,"color",2);qs([C(Ht)],Vo.prototype,"sharedMaterial",2);qs([C()],Vo.prototype,"transparent",2);qs([C()],Vo.prototype,"cutoutThreshold",2);qs([C()],Vo.prototype,"castShadows",2);qs([C()],Vo.prototype,"renderOrder",2);qs([C()],Vo.prototype,"toneMapped",2);qs([C(Yv)],Vo.prototype,"sprite",1);const xH=ie("debugwebxr"),tAe=new le().makeRotationY(Math.PI);class lu extends Ie{constructor(){super(...arguments);d(this,"_arScale",1);d(this,"invertForward",!1);d(this,"customReticle");d(this,"arTouchTransform",!0);d(this,"autoPlace",!1);d(this,"autoCenter",!1);d(this,"useXRAnchor",!1);d(this,"_isPlacing",!0);d(this,"_startOffset",new le);d(this,"_createdPlacementObject",null);d(this,"_reparentedComponents",[]);d(this,"_placementScene",new Ws);d(this,"_reticle",[]);d(this,"_hits",[]);d(this,"_placementStartTime",-1);d(this,"_rigPlacementMatrix");d(this,"_anchor",null);d(this,"userInput");d(this,"onPlaceScene",t=>{var r;if(this._isPlacing==!1||t!=null&&t.used)return;let i=this._reticle[0];if(!i){console.warn("No reticle to place...");return}if(!i.visible&&!this.autoPlace){console.warn("Reticle is not visible (can not place)");return}if((r=Mt.active)!=null&&r.isTrackingImages){console.warn("Scene Placement is disabled while images are being tracked");return}let n=this._hits[0];if(t&&t.origin instanceof Mk){const o=this._reticle[t.origin.index];o&&(i=o,n=this._hits[t.origin.index])}if(t&&(t.stopImmediatePropagation(),t.stopPropagation(),t.use()),this._isPlacing=!1,this.context.input.removeEventListener("pointerup",this.onPlaceScene),this.onRevertSceneChanges(),i.position.copy(i.lastPos),i.quaternion.copy(i.lastQuat),this.onApplyPose(i),this.useXRAnchor&&this.onCreateAnchor(Mt.active,n),this.context.xr)for(const o of this.context.xr.controllers)o.cancelHitTestSource()});d(this,"upVec",new S(0,1,0));d(this,"lookPoint",new S);d(this,"worldUpVec",new S(0,1,0))}static onPlaced(t){const i="placed";return this._eventListeners[i]||(this._eventListeners[i]=[]),this._eventListeners[i].push(t),()=>{const n=this._eventListeners[i].indexOf(t);n>=0&&this._eventListeners[i].splice(n,1)}}get arScale(){return this._arScale}set arScale(t){t!==this._arScale&&(this._arScale=t,this.onScaleChanged())}onEnable(){var t;(t=this.customReticle)==null||t.preload()}supportsXR(t){return t==="immersive-ar"}onEnterXR(t){xH&&console.log("ENTER WEBXR: SessionRoot start..."),this._anchor=null,this.gameObject.updateMatrixWorld(),this._startOffset.copy(this.gameObject.matrixWorld);const i=new ye;this._createdPlacementObject=i,i.name="AR Session Root",this._placementScene.name="AR Placement Scene",this._placementScene.children.length=0;for(let n=this.context.scene.children.length-1;n>=0;n--){const r=this.context.scene.children[n];this._placementScene.add(r)}if(this.context.scene.add(i),this.autoCenter){const n=Hl(this._placementScene.children),r=n.getCenter(new S),o=n.getSize(new S),a=new le;a.makeTranslation(r.x,r.y-o.y*.5,r.z),this._startOffset.multiply(a)}this._reparentedComponents.length=0,this._reparentedComponents.push({comp:this,originalObject:this.gameObject}),ne.addComponent(i,this);for(const n of this._reticle)xa(n);this._reticle.length=0,this._isPlacing=!0,this.context.input.addEventListener("pointerup",this.onPlaceScene,{queue:Ka.Early})}onLeaveXR(){this.context.input.removeEventListener("pointerup",this.onPlaceScene,{queue:Ka.Early}),this.onRevertSceneChanges(),this._anchor=null,this._rigPlacementMatrix=void 0}onUpdateXR(t){var i,n,r,o;if(t.xr.isTrackingImages){for(const a of this._reticle)a.visible=!1;return}if(this._isPlacing){const a=(i=t.xr.rig)==null?void 0:i.gameObject;a&&a.parent!==this.context.scene&&this.context.scene.add(a);let l=!1;if(t.xr.isPassThrough&&t.xr.controllers.length>0&&!this.autoPlace)for(const c of t.xr.controllers){const h=c.getHitTest();h&&(l=!0,this.updateReticleAndHits(t.xr,c.index,h,t.xr.rigScale))}if(!l){const c=t.xr.getHitTest();c&&this.updateReticleAndHits(t.xr,0,c,t.xr.rigScale)}}else{if(this._anchor&&t.xr.referenceSpace){const a=t.xr.frame.getPose(this._anchor.anchorSpace,t.xr.referenceSpace);if(a&&this.context.time.frame%20===0){const l=t.xr.convertSpace(a.transform),c=this._reticle[0];c&&(c.position.copy(l.position),c.quaternion.copy(l.quaternion),this.onApplyPose(c))}}if(this.arTouchTransform?(this.userInput||(this.userInput=new ly(this.context)),(n=this.userInput)==null||n.enable()):(r=this.userInput)==null||r.disable(),this.arTouchTransform&&((o=this.userInput)!=null&&o.hasChanged)){if(t.xr.rig){const a=t.xr.rig.gameObject;this.userInput.applyMatrixTo(a.matrix,!0),a.matrix.decompose(a.position,a.quaternion,a.scale),this.userInput.factor=a.scale.x}this.userInput.reset()}}}updateReticleAndHits(t,i,n,r){this._hits[i]=n.hit;let o=this._reticle[i];if(!o){if(this.customReticle)if(this.customReticle.asset)o=Bv(this.customReticle.asset);else{this.customReticle.loadAssetAsync();return}else o=new fe(new Ob(.07,.09,32).rotateX(-Math.PI/2),new ti({side:_i,depthTest:!1,depthWrite:!1,transparent:!0,opacity:1,color:15658734})),o.name="AR Placement Reticle";if(xH){const a=new _a(1);a.position.y+=.01,o.add(a)}this._reticle[i]=o,o.matrixAutoUpdate=!1,o.visible=!1}if(o.lastPos=o.lastPos||n.position.clone(),o.lastQuat=o.lastQuat||n.quaternion.clone(),o.position.copy(o.lastPos.lerp(n.position,this.context.time.deltaTime/.1)),o.lastPos.copy(o.position),o.quaternion.copy(o.lastQuat.slerp(n.quaternion,this.context.time.deltaTime/.05)),o.lastQuat.copy(o.quaternion),o.scale.set(r,r,r),this.customReticle&&this.applyViewBasedTransform(o),o.updateMatrix(),o.visible=!0,o.parent!==this.context.scene&&this.context.scene.add(o),this._placementStartTime<0&&(this._placementStartTime=this.context.time.realtimeSinceStartup),this.autoPlace)if(this.upVec.set(0,1,0).applyQuaternion(o.quaternion),this.upVec.dot(wt(0,1,0))>.9){let l=o["autoplace:timer"]||0;l>=1?(o.visible=!1,this.onPlaceScene(null)):(l+=this.context.time.deltaTime,o["autoplace:timer"]=l)}else o["autoplace:timer"]=0}onScaleChanged(){}onRevertSceneChanges(){var t;for(const i of this._reticle)i&&(i.visible=!1,i==null||i.removeFromParent());this._reticle.length=0;for(let i=this._placementScene.children.length-1;i>=0;i--){const n=this._placementScene.children[i];this.context.scene.add(n)}(t=this._createdPlacementObject)==null||t.removeFromParent();for(const i of this._reparentedComponents)ne.addComponent(i.originalObject,i.comp)}async onCreateAnchor(t,i){if(i.createAnchor===void 0){console.warn("Hit does not support creating an anchor",i),nt()&&Fi("Hit does not support creating an anchor");return}else{const n=await i.createAnchor(t.viewerPose.transform);t.running&&n&&(this._anchor=n)}}applyViewBasedTransform(t){const i=this.context.mainCamera,n=t,r=i.worldPosition,o=n.worldPosition;this.upVec.set(0,1,0).applyQuaternion(t.quaternion);const a=i.worldPosition;a&&t.position.clone().sub(a).angleTo(this.upVec)<Math.PI/2&&this.upVec.negate();const l=this.upVec.angleTo(this.worldUpVec)*180/Math.PI,c=30;l>c&&l<180-c||l<-c&&l>-180+c?(this.lookPoint.copy(t.position).add(this.upVec),this.lookPoint.y=t.position.y,t.lookAt(this.lookPoint)):(r.y=o.y,t.lookAt(r))}onApplyPose(t){var r,o,a,l;const i=(o=(r=Mt.active)==null?void 0:r.rig)==null?void 0:o.gameObject;if(!i){console.warn("No rig object to place");return}(a=Mt.active)!=null&&a.rigScale;const n=i.parent||this.context.scene;this._rigPlacementMatrix?(l=this._rigPlacementMatrix)==null||l.decompose(i.position,i.quaternion,i.scale):this._rigPlacementMatrix=i.matrix.clone(),this.applyViewBasedTransform(t),t.updateMatrix(),this.context.scene.add(t),t.attach(i),t.removeFromParent(),i.scale.set(this.arScale,this.arScale,this.arScale),i.position.multiplyScalar(this.arScale),i.updateMatrix(),this.invertForward&&i.matrix.premultiply(tAe),i.matrix.premultiply(this._startOffset),i.matrix.decompose(i.position,i.quaternion,i.scale),n.add(i)}}d(lu,"_eventListeners",{});const FE=class{constructor(e){d(this,"oneFingerDrag",!0);d(this,"twoFingerRotate",!0);d(this,"twoFingerScale",!0);d(this,"factor",1);d(this,"context");d(this,"offset");d(this,"plane");d(this,"_scale",1);d(this,"_hasChanged",!1);d(this,"_enabled",!1);d(this,"currentlyUsedPointerIds",new Set);d(this,"currentlyUnusedPointerIds",new Set);d(this,"onPointerDownEarly",e=>{this.isActive&&e.stopPropagation()});d(this,"onPointerDownLate",e=>{e.used?this.currentlyUsedPointerIds.add(e.pointerId):this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.add(e.pointerId)});d(this,"onPointerUpEarly",e=>{this.currentlyUsedPointerIds.delete(e.pointerId),this.currentlyUnusedPointerIds.delete(e.pointerId)});d(this,"prev",new Map);d(this,"_didMultitouch",!1);d(this,"touchStart",e=>{for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],n=C6()&&i.clientY<window.innerHeight*.1;this.prev.has(i.identifier)||this.prev.set(i.identifier,{ignore:n,x:0,z:0,screenx:0,screeny:0});const r=this.prev.get(i.identifier);if(r){const o=this.getPositionOnPlane(i.clientX,i.clientY);r.x=o.x,r.z=o.z,r.screenx=i.clientX,r.screeny=i.clientY}}});d(this,"touchEnd",e=>{e.touches.length<=0&&(this._didMultitouch=!1);for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t];this.prev.delete(i.identifier)}});d(this,"touchMove",e=>{if(!e.defaultPrevented&&this.isActive){if(e.touches.length===1){if(this._didMultitouch)return;const t=e.touches[0],i=this.prev.get(t.identifier);if(!i||i.ignore)return;const n=this.getPositionOnPlane(t.clientX,t.clientY),r=n.x-i.x,o=n.z-i.z;if(r===0&&o===0)return;this.oneFingerDrag&&this.addMovement(r,o),i.x=n.x,i.z=n.z,i.screenx=t.clientX,i.screeny=t.clientY;return}else if(e.touches.length===2){this._didMultitouch=!0;const t=e.touches[0],i=e.touches[1],n=this.prev.get(t.identifier),r=this.prev.get(i.identifier);if(!n||!r)return;if(this.twoFingerRotate){const o=Math.atan2(t.clientY-i.clientY,t.clientX-i.clientX),a=Math.atan2(n.screeny-r.screeny,n.screenx-r.screenx),l=o-a;Math.abs(l)>.001&&this.addRotation(l)}if(this.twoFingerScale){const o=t.clientX-i.clientX,a=t.clientY-i.clientY,l=Math.sqrt(o*o+a*a),c=n.screenx-r.screenx,h=n.screeny-r.screeny,u=Math.sqrt(c*c+h*h),f=l-u;Math.abs(f)>2&&this.addScale(f)}n.screenx=t.clientX,n.screeny=t.clientY,r.screenx=i.clientX,r.screeny=i.clientY}}});d(this,"_raycaster",new tf);d(this,"_intersection",new S);d(this,"_screenPos",new S);d(this,"_tempMatrix",new le);this.context=e,this.offset=new le,this.plane=new xs,this.plane.setFromNormalAndCoplanarPoint(FE.up,FE.zero)}reset(){this._scale=1,this.offset.identity()}get hasChanged(){return this._hasChanged}applyMatrixTo(e,t){this._hasChanged=!1,t?(this.offset.invert(),e.premultiply(this.offset)):e.multiply(this.offset)}get isActive(){return this.currentlyUsedPointerIds.size<=0&&this.currentlyUnusedPointerIds.size>0}enable(){this._enabled||(this._enabled=!0,this.context.input.addEventListener("pointerdown",this.onPointerDownEarly,{queue:Ka.Early}),this.context.input.addEventListener("pointerdown",this.onPointerDownLate,{queue:Ka.Late}),this.context.input.addEventListener("pointerup",this.onPointerUpEarly,{queue:Ka.Early}),window.addEventListener("touchstart",this.touchStart,{passive:!1}),window.addEventListener("touchmove",this.touchMove,{passive:!1}),window.addEventListener("touchend",this.touchEnd,{passive:!1}))}disable(){this._enabled&&(this._enabled=!1,this.context.input.removeEventListener("pointerdown",this.onPointerDownEarly,{queue:Ka.Early}),this.context.input.removeEventListener("pointerdown",this.onPointerDownLate,{queue:Ka.Late}),this.context.input.removeEventListener("pointerup",this.onPointerUpEarly,{queue:Ka.Early}),window.removeEventListener("touchstart",this.touchStart),window.removeEventListener("touchmove",this.touchMove),window.removeEventListener("touchend",this.touchEnd))}getPositionOnPlane(e,t){const i=this.context.mainCamera;return this._screenPos.x=e/window.innerWidth*2-1,this._screenPos.y=-(t/window.innerHeight)*2+1,this._screenPos.z=1,this._screenPos.unproject(i),this._raycaster.set(i.position,this._screenPos.sub(i.position)),this._raycaster.ray.intersectPlane(this.plane,this._intersection),this._intersection}addMovement(e,t){e/=this._scale,t/=this._scale,e*=this.factor,t*=this.factor,this.offset.elements[12]+=e,this.offset.elements[14]+=t,(e!==0||t!==0)&&(this._hasChanged=!0)}addScale(e){e/=window.innerWidth,e*=-1,this._scale*=1+e,this._tempMatrix.makeScale(1-e,1-e,1-e),this.offset.premultiply(this._tempMatrix),e!==0&&(this._hasChanged=!0)}addRotation(e){e*=-1,this._tempMatrix.makeRotationY(e),this.offset.premultiply(this._tempMatrix),e!==0&&(this._hasChanged=!0)}};let ly=FE;d(ly,"up",new S(0,1,0)),d(ly,"zero",new S(0,0,0)),d(ly,"one",new S(1,1,1));var iAe=Object.defineProperty,nAe=Object.getOwnPropertyDescriptor,Kv=(s,e,t,i)=>{for(var n=i>1?void 0:i?nAe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&iAe(e,t,n),n};class $c extends Ie{constructor(){super(...arguments);d(this,"position","bottom");d(this,"showNeedleLogo",!0);d(this,"showSpatialMenu");d(this,"createFullscreenButton");d(this,"createMuteButton");d(this,"createQRCodeButton")}onEnable(){this.applyOptions()}applyOptions(){this.context.menu.setPosition(this.position),this.context.menu.showNeedleLogo(this.showNeedleLogo),this.createFullscreenButton===!0&&this.context.menu.showFullscreenOption(!0),this.createMuteButton===!0&&this.context.menu.showAudioPlaybackOption(!0),this.showSpatialMenu===!0&&this.context.menu.showSpatialMenu(this.showSpatialMenu),this.createQRCodeButton===!0&&(Wc()||this.context.menu.showQRCodeButton(!0))}}Kv([C()],$c.prototype,"position",2);Kv([C()],$c.prototype,"showNeedleLogo",2);Kv([C()],$c.prototype,"showSpatialMenu",2);Kv([C()],$c.prototype,"createFullscreenButton",2);Kv([C()],$c.prototype,"createMuteButton",2);Kv([C()],$c.prototype,"createQRCodeButton",2);const Nn={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function nq(s){const e=await fetch(s);if(e.ok)return e.json();throw new Error(e.statusText)}async function sAe(s){if(!s)throw new Error("No basePath supplied");return await nq(`${s}/profilesList.json`)}async function rAe(s,e,t=null,i=!0){if(!s)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const n=await sAe(e);let r;if(s.profiles.some(l=>{const c=n[l];return c&&(r={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!r}),!r){if(!t)throw new Error("No matching profile name found");const l=n[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);r={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await nq(r.profilePath);let a;if(i){let l;if(s.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[s.handedness],!l)throw new Error(`No matching handedness, ${s.handedness}, in profile ${r.profileId}`);l.assetPath&&(a=r.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const oAe={xAxis:0,yAxis:0,button:0,state:Nn.ComponentState.DEFAULT};function aAe(s=0,e=0){let t=s,i=e;if(Math.sqrt(s*s+e*e)>1){const o=Math.atan2(e,s);t=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}class lAe{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Nn.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(oAe)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:n}){const{normalizedXAxis:r,normalizedYAxis:o}=aAe(e,t);switch(this.componentProperty){case Nn.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?r:.5;break;case Nn.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?o:.5;break;case Nn.ComponentProperty.BUTTON:this.value=this.states.includes(n)?i:0;break;case Nn.ComponentProperty.STATE:this.valueNodeProperty===Nn.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class cAe{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const n=new lAe(t.visualResponses[i]);this.visualResponses[i]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Nn.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Nn.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Nn.ComponentState.PRESSED:(t.touched||this.values.button>Nn.ButtonTouchThreshold)&&(this.values.state=Nn.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Nn.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Nn.AxisTouchThreshold&&(this.values.state=Nn.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Nn.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Nn.AxisTouchThreshold&&(this.values.state=Nn.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class hAe{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(n=>{const r=this.layoutDescription.components[n];this.components[n]=new cAe(n,r)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const uAe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",dAe="generic-trigger";let fAe=class extends ye{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(i=>{const{valueNode:n,minNode:r,maxNode:o,value:a,valueNodeProperty:l}=i;n&&(l===Nn.VisualResponseProperty.VISIBILITY?n.visible=a:l===Nn.VisualResponseProperty.TRANSFORM&&(n.quaternion.slerpQuaternions(r.quaternion,o.quaternion,a),n.position.lerpVectors(r.position,o.position,a)))})}))}};function pAe(s,e){Object.values(s.components).forEach(t=>{const{type:i,touchPointNodeName:n,visualResponses:r}=t;if(i===Nn.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(n),t.touchPointNode){const o=new cl(.001),a=new ti({color:255}),l=new fe(o,a);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach(o=>{const{valueNodeName:a,minNodeName:l,maxNodeName:c,valueNodeProperty:h}=o;if(h===Nn.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(l),o.maxNode=e.getObjectByName(c),!o.minNode){console.warn(`Could not find ${l} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${c} in the model`);return}}o.valueNode=e.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function wH(s,e){pAe(s.motionController,e),s.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=s.envMap,t.material.needsUpdate=!0)}),s.layers.mask!=0&&e.traverse(t=>{t.layers.mask=s.layers.mask}),s.add(e)}class mAe{constructor(e=null,t=null){this.gltfLoader=e,this.path=uAe,this._assetCache={},this.onLoad=t,this.gltfLoader||(this.gltfLoader=new Wd)}setPath(e){return this.path=e,this}createControllerModel(e){const t=new fAe;let i=null;return e.addEventListener("connected",n=>{const r=n.data;r.targetRayMode!=="tracked-pointer"||!r.gamepad||rAe(r,this.path,dAe).then(({profile:o,assetPath:a})=>{t.motionController=new hAe(r,o,a);const l=this._assetCache[t.motionController.assetUrl];if(l)i=l.scene.clone(),wH(t,i),this.onLoad&&this.onLoad(i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,c=>{this._assetCache[t.motionController.assetUrl]=c,i=c.scene.clone(),wH(t,i),this.onLoad&&this.onLoad(i)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(i),i=null}),t}}const gAe="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class yAe{constructor(e,t,i,n,r=null,o=null){this.controller=t,this.handModel=e,this.bones=[],r===null&&(r=new Wd,r.setPath(i||gAe)),r.load(`${n}.glb`,a=>{const l=a.scene.children[0];this.handModel.add(l),l.layers.mask=this.handModel.layers.mask;const c=l.getObjectByProperty("type","SkinnedMesh");c.frustumCulled=!1,c.castShadow=!0,c.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(u=>{const f=l.getObjectByName(u);f!==void 0?f.jointName=u:console.warn(`Couldn't find ${u} in ${n} hand mesh`),this.bones.push(f)}),o&&o(l)})}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const i=this.bones[t];if(i){const n=e[i.jointName];if(n.visible){const r=n.position;i.position.copy(r),i.quaternion.copy(n.quaternion)}}}}}var vAe=Object.defineProperty,AAe=Object.getOwnPropertyDescriptor,xT=(s,e,t,i)=>{for(var n=i>1?void 0:i?AAe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&vAe(e,t,n),n};const ic=ie("debugwebxr"),Xu=new Array;class Hc extends Ie{constructor(){super(...arguments);d(this,"createControllerModel",!0);d(this,"createHandModel",!0);d(this,"customLeftHand");d(this,"customRightHand");d(this,"_models",new Array)}supportsXR(t){return t==="immersive-vr"||t==="immersive-ar"}async onXRControllerAdded(t){var r,o,a;if(!(t.xr.isVR||t.xr.isPassThrough))return;const{controller:n}=t;if(ic&&console.warn("Add Controller Model for",n.side,n.index),this.createControllerModel||this.createHandModel){if(n.hand){if(this.createHandModel){const l=await this.loadHandModel(n);if(!l||!n.connected||!n.isHand){(r=l==null?void 0:l.handObject)==null||r.removeFromParent(),(a=(o=l==null?void 0:l.handmesh)==null?void 0:o.controller)==null||a.removeFromParent();return}this._models.push({controller:n,model:l.handObject,handmesh:l.handmesh}),this._models.sort((c,h)=>c.controller.index-h.controller.index),this.scene.add(l.handObject),n.model=l.handObject}}else if(this.createControllerModel){const l=await n.getModelUrl();if(l){const c=await this.loadModel(n,l);if(!c||!n.connected||n.isHand)return;this._models.push({controller:n,model:c}),this._models.sort((h,u)=>h.controller.index-u.controller.index),this.scene.add(c),c.traverse(h=>{h.layers.set(2),h.matrixWorldAutoUpdate=!1,h.matrixAutoUpdate=!1,h.updateMatrix()}),n.model=c}else n.targetRayMode!=="transient-pointer"&&console.warn("XRControllerModel: no model found for "+n.side)}}}onXRControllerRemoved(t){var r;const i=this._models.findIndex(o=>o.controller===t.controller),n=this._models[i];n&&(this._models.splice(i,1),n.handmesh&&((r=n.handmesh.handModel)==null||r.removeFromParent(),n.handmesh=void 0),n.model&&(n.model.removeFromParent(),n.model=void 0))}onBeforeRender(){if(Mt.active&&(ic&&(Xu[0]=Date.now()),this.updateRendering(Mt.active),ic)){const t=Date.now()-Xu[0];if(Xu.push(t),Xu.length>=30){Xu[0]=0;const i=Xu.reduce((n,r)=>n+r,0)/Xu.length;Xu.length=0,console.log("[XRControllerModel] "+i.toFixed(2)+" ms")}}}onLeaveXR(t){var i;for(const n of this._models)n&&((i=n.model)==null||i.removeFromParent(),n.controller.model===n.model&&(n.controller.model=null));this._models.length=0}updateRendering(t){var i,n,r,o,a;for(let l=0;l<this._models.length;l++){const c=this._models[l];if(!c)continue;const h=c.controller;if(!h.connected){ic&&console.warn("XRControllerModel.onUpdateXR: controller is not connected anymore",h.side,h.hand);continue}if(c.model&&!c.handmesh)c.model.matrixAutoUpdate=!1,c.model.matrixWorldAutoUpdate=!1,c.model.matrix.copy(h.gripMatrix),c.model.visible=h.isTracking,(i=t.rig)==null||i.gameObject.add(c.model);else if(h.inputSource.hand&&c.handmesh){const u=t.referenceSpace,f=this.context.renderer.xr.getHand(h.index);if(u&&t.frame.getJointPose){for(const p of h.inputSource.hand.values()){const m=f.joints[p.jointName];if(m){const v=h.getHandJointPose(p);if(v){const g=v.transform.position,y=v.transform.orientation;m.position.copy(g),m.quaternion.copy(y),m.matrixAutoUpdate=!1,m.matrixWorldAutoUpdate=!1}m.visible=v!=null}}c.model&&(c.model.visible=h.isTracking,c.model.visible&&c.model.parent!==((n=t.rig)==null?void 0:n.gameObject)&&((r=t.rig)==null||r.gameObject.add(c.model))),(o=c.model)!=null&&o.visible&&((a=c.handmesh)==null||a.updateMesh(),c.model.matrixWorldAutoUpdate=!1,c.model.matrixAutoUpdate=!1,c.model.matrix.identity(),c.model.applyMatrix4(ky))}}}}async loadModel(t,i){var o;if(!t.connected)return console.warn("XRControllerModel.onXRControllerAdded: controller is not connected anymore",t.side),null;const r=await ei.getOrCreate("",i).instantiate();return xD(r),(o=Mt.active)!=null&&o.isPassThrough&&r.traverseVisible(a=>{this.makeOccluder(a)}),r}async loadHandModel(t){const i=this.context,n=i.renderer.xr.getHand(t.index);n||(ic?_t.DrawLabel(t.rayWorldPosition,"No hand found for index "+t.index,.05,5):console.warn("No hand found for index "+t.index));const r=new Wd;rT(r,i),await kF(r,i,this.sourceId??""),r.setPath("https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/");const o=t.side==="left"?"left.":"right.",a=t.side==="left"?this.customLeftHand:this.customRightHand;if(a)if(!a.uri.includes(o))console.warn("XRControllerModel: custom hand model must be named "+o),Fi("Custom Hand: unexpected name, please see the console for details");else{const h=a.uri.substring(0,a.uri.indexOf(o));r.setPath(h),ic&&console.log("XRControllerModel: loading custom hand model from "+h)}const l=new ye;xD(l);const c=new yAe(l,n,r.path,t.inputSource.handedness,r,h=>{h.traverse(u=>{var f;u.layers.set(2),(f=Mt.active)!=null&&f.isPassThrough&&this.makeOccluder(u),u instanceof fe&&yi.assignMeshLOD(u,0)}),t.connected||(ic&&_t.DrawLabel(t.rayWorldPosition,"Hand is loaded but not connected anymore",.05,5),h.removeFromParent())});if(ic&&l.add(new _a(.5)),t.inputSource.hand){ic&&console.log(t.inputSource.hand);for(const h of t.inputSource.hand.values())if(n.joints[h.jointName]===void 0){const u=new Vs;u.matrixAutoUpdate=!1,u.visible=!0,n.joints[h.jointName]=u,n.add(u)}}else ic&&_t.DrawLabel(t.rayWorldPosition,"No inputSource.hand found for index "+t.index,.05,5);return{handObject:l,handmesh:c}}makeOccluder(t){if(t instanceof fe){let i=t.material;i instanceof Ht&&(i=t.material=i.clone(),i.depthWrite=!0,i.depthTest=!0,i.colorWrite=!1,t.receiveShadow=!1,t.renderOrder=-100)}}}d(Hc,"factory",new mAe);xT([C()],Hc.prototype,"createControllerModel",2);xT([C()],Hc.prototype,"createHandModel",2);xT([C(ei)],Hc.prototype,"customLeftHand",2);xT([C(ei)],Hc.prototype,"customRightHand",2);const SH=new jt,YS=new S;class sq extends bM{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new rt(e,3)),this.setAttribute("uv",new rt(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new G1(t,6,1);return this.setAttribute("instanceStart",new aa(i,3,0)),this.setAttribute("instanceEnd",new aa(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new G1(t,6,1);return this.setAttribute("instanceColorStart",new aa(i,3,0)),this.setAttribute("instanceColorEnd",new aa(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new cL(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new jt);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),SH.setFromBufferAttribute(t),this.boundingBox.union(SH))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ln),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)YS.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(YS)),YS.fromBufferAttribute(t,r),n=Math.max(n,i.distanceToSquared(YS));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}ze.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ee(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};ur.line={uniforms:vv.merge([ze.common,ze.fog,ze.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class GF extends kt{constructor(e){super({type:"LineMaterial",uniforms:vv.clone(ur.line.uniforms),vertexShader:ur.line.vertexShader,fragmentShader:ur.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const CH=new S,EH=new S,$s=new Je,er=new Je,nc=new Je,FP=new S,UP=new le,lr=new ma,MH=new S,KS=new jt,JS=new ln,sc=new Je;let xc,qp;function TH(s,e,t){return sc.set(0,0,-e,1).applyMatrix4(s.projectionMatrix),sc.multiplyScalar(1/sc.w),sc.x=qp/t.width,sc.y=qp/t.height,sc.applyMatrix4(s.projectionMatrixInverse),sc.multiplyScalar(1/sc.w),Math.abs(Math.max(sc.x,sc.y))}function _Ae(s,e){const t=s.matrixWorld,i=s.geometry,n=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=Math.min(i.instanceCount,n.count);for(let a=0,l=o;a<l;a++){lr.start.fromBufferAttribute(n,a),lr.end.fromBufferAttribute(r,a),lr.applyMatrix4(t);const c=new S,h=new S;xc.distanceSqToSegment(lr.start,lr.end,h,c),h.distanceTo(c)<qp*.5&&e.push({point:h,pointOnLine:c,distance:xc.origin.distanceTo(h),object:s,face:null,faceIndex:a,uv:null,uv1:null})}}function bAe(s,e,t){const i=e.projectionMatrix,r=s.material.resolution,o=s.matrixWorld,a=s.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,h=Math.min(a.instanceCount,l.count),u=-e.near;xc.at(1,nc),nc.w=1,nc.applyMatrix4(e.matrixWorldInverse),nc.applyMatrix4(i),nc.multiplyScalar(1/nc.w),nc.x*=r.x/2,nc.y*=r.y/2,nc.z=0,FP.copy(nc),UP.multiplyMatrices(e.matrixWorldInverse,o);for(let f=0,p=h;f<p;f++){if($s.fromBufferAttribute(l,f),er.fromBufferAttribute(c,f),$s.w=1,er.w=1,$s.applyMatrix4(UP),er.applyMatrix4(UP),$s.z>u&&er.z>u)continue;if($s.z>u){const _=$s.z-er.z,b=($s.z-u)/_;$s.lerp(er,b)}else if(er.z>u){const _=er.z-$s.z,b=(er.z-u)/_;er.lerp($s,b)}$s.applyMatrix4(i),er.applyMatrix4(i),$s.multiplyScalar(1/$s.w),er.multiplyScalar(1/er.w),$s.x*=r.x/2,$s.y*=r.y/2,er.x*=r.x/2,er.y*=r.y/2,lr.start.copy($s),lr.start.z=0,lr.end.copy(er),lr.end.z=0;const v=lr.closestPointToPointParameter(FP,!0);lr.at(v,MH);const g=gi.lerp($s.z,er.z,v),y=g>=-1&&g<=1,A=FP.distanceTo(MH)<qp*.5;if(y&&A){lr.start.fromBufferAttribute(l,f),lr.end.fromBufferAttribute(c,f),lr.start.applyMatrix4(o),lr.end.applyMatrix4(o);const _=new S,b=new S;xc.distanceSqToSegment(lr.start,lr.end,b,_),t.push({point:b,pointOnLine:_,distance:xc.origin.distanceTo(b),object:s,face:null,faceIndex:f,uv:null,uv1:null})}}}class xAe extends fe{constructor(e=new sq,t=new GF({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let o=0,a=0,l=t.count;o<l;o++,a+=2)CH.fromBufferAttribute(t,o),EH.fromBufferAttribute(i,o),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+CH.distanceTo(EH);const r=new G1(n,2,1);return e.setAttribute("instanceDistanceStart",new aa(r,1,0)),e.setAttribute("instanceDistanceEnd",new aa(r,1,1)),this}raycast(e,t){const i=this.material.worldUnits,n=e.camera;n===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=e.params.Line2!==void 0&&e.params.Line2.threshold||0;xc=e.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;qp=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),JS.copy(a.boundingSphere).applyMatrix4(o);let c;if(i)c=qp*.5;else{const u=Math.max(n.near,JS.distanceToPoint(xc.origin));c=TH(n,u,l.resolution)}if(JS.radius+=c,xc.intersectsSphere(JS)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),KS.copy(a.boundingBox).applyMatrix4(o);let h;if(i)h=qp*.5;else{const u=Math.max(n.near,KS.distanceToPoint(xc.origin));h=TH(n,u,l.resolution)}KS.expandByScalar(h),xc.intersectsBox(KS)!==!1&&(i?_Ae(this,t):bAe(this,n,t))}}class rq extends sq{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class wAe extends xAe{constructor(e=new rq,t=new GF({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}class wT extends Ie{}var SAe=Object.defineProperty,CAe=Object.getOwnPropertyDescriptor,vf=(s,e,t,i)=>{for(var n=i>1?void 0:i?CAe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&SAe(e,t,n),n};const NP=ie("debugwebxr");class Sa extends Ie{constructor(){super(...arguments);d(this,"movementSpeed",1.5);d(this,"rotationStep",30);d(this,"useTeleport",!0);d(this,"usePinchToTeleport",!0);d(this,"useTeleportTarget",!1);d(this,"useTeleportFade",!1);d(this,"showRays",!0);d(this,"showHits",!0);d(this,"isXRMovementHandler",!0);d(this,"xrSessionMode","immersive-vr");d(this,"_didApplyRotation",!1);d(this,"_didTeleport",!1);d(this,"_teleportBuffer",new Array);d(this,"_plane",null);d(this,"_lines",[]);d(this,"_hitDiscs",[]);d(this,"_hitDistances",[]);d(this,"_lastHitDistances",[]);d(this,"hitPointRaycastFilter",t=>t.type==="SkinnedMesh"?"continue in children":!0)}onUpdateXR(t){const i=t.xr.rig;if(!(i!=null&&i.gameObject)||t.xr.isPassThrough)return;const n=t.xr.leftController,r=t.xr.rightController;n&&this.onHandleMovement(n,i.gameObject),r&&(this.onHandleRotation(r,i.gameObject),this.useTeleport&&this.onHandleTeleport(r,i.gameObject))}onLeaveXR(t){for(const i of this._lines)i.removeFromParent();for(const i of this._hitDiscs)i==null||i.removeFromParent()}onBeforeRender(){var t;(t=this.context.xr)!=null&&t.running&&(this.showRays&&this.renderRays(this.context.xr),this.showHits&&this.renderHits(this.context.xr))}onHandleMovement(t,i){const n=t.getStick("xr-standard-thumbstick");if(n.x!=0||n.y!=0){const r=wt(n.x,0,n.y);r.multiplyScalar(this.context.time.deltaTimeUnscaled*this.movementSpeed);const o=$i(i);r.multiplyScalar(o.x),r.applyQuaternion(t.xr.poseOrientation),r.y=0,r.applyQuaternion(i.worldQuaternion),i.position.add(r),i.updateWorldMatrix(!1,!1);for(const a of i.children)a.updateWorldMatrix(!1,!1)}}onHandleRotation(t,i){const r=t.getStick("xr-standard-thumbstick").x;if(this._didApplyRotation)Math.abs(r)<.3&&(this._didApplyRotation=!1);else if(Math.abs(r)>.5){this._didApplyRotation=!0;const o=r>0?1:-1,a=Ft(this.context.mainCamera).clone();i.rotateY(o*it.toRadians(this.rotationStep));const c=Ft(this.context.mainCamera).clone().sub(a);c.y=0,i.position.sub(c)}}onHandleTeleport(t,i){var r,o,a,l,c;let n=0;if(t.hand&&this.usePinchToTeleport&&t.isTeleportGesture){const h=t.getPointerId("primary");if(h!=null&&this.context.input.getIsPointerIdInUse(h))return;const u=t.getGesture("pinch");u&&(n=u.value)}else n=(r=t.getStick("xr-standard-thumbstick"))==null?void 0:r.y;if(this._didTeleport)n>=0&&n<.4?this._didTeleport=!1:n<0&&n>-.4&&(this._didTeleport=!1);else if(n>.8){this._didTeleport=!0;const h=this.context.physics.raycastFromRay(t.ray)[0];if(h&&h.object instanceof nv){const f=(o=h.normal)==null?void 0:o.dot(wt(0,1,0));if(f!==void 0&&f<.4)return}let u=h==null?void 0:h.point;if(!u&&!this.useTeleportTarget){this._plane||(this._plane=new xs(new S(0,1,0),0));const f=i.worldPosition;this._plane.setFromNormalAndCoplanarPoint(new S(0,1,0),f);const p=t.ray;u=f.clone(),this._plane.intersectLine(new ma(p.origin,wt(p.direction).multiplyScalar(1e4).add(p.origin)),u),u.distanceTo(f)>i.scale.x*10&&(u=null)}if(u){if(this.useTeleportTarget&&!ne.getComponentInParent(h.object,wT))return;const f=u.clone();if(NP&&_t.DrawSphere(u,.025,16711680,5),(a=this.context.mainCamera)==null?void 0:a.position){const m=(l=this.context.xr)==null?void 0:l.getUserOffsetInRig();m&&(m.y=0,f.sub(m),NP&&_t.DrawWireSphere(m.add(f),.025,65280,5))}this._teleportBuffer.push(i.matrix.clone()),this._teleportBuffer.length>10&&this._teleportBuffer.shift(),this.useTeleportFade?(c=t.xr.fadeTransition())==null||c.then(()=>{i.worldPosition=f}):i.worldPosition=f}}else if(n<-.8&&(this._didTeleport=!0,this._teleportBuffer.length>0)){const h=this._teleportBuffer.pop();h&&h.decompose(i.position,i.quaternion,i.scale)}}renderRays(t){var i;for(let n=0;n<this._lines.length;n++){const r=this._lines[n];r&&(r.visible=!1)}for(let n=0;n<t.controllers.length;n++){const r=t.controllers[n];let o=this._lines[n];if(!r.connected||!r.isTracking||!r.ray||r.targetRayMode==="transient-pointer"||!r.hasSelectEvent){o&&(o.visible=!1);continue}o||(o=this.createRayLineObject(),o.scale.z=.5,this._lines[n]=o),r.updateRayWorldPosition(),r.updateRayWorldQuaternion();const a=r.rayWorldPosition,l=r.rayWorldQuaternion;o.position.copy(a),o.quaternion.copy(l);const c=t.rigScale,h=this.usePinchToTeleport&&r.isTeleportGesture,u=this._lastHitDistances[n],f=this._hitDistances[n]!=null,p=u??c;o.scale.set(c,c,p),o.visible=!0,o.layers.disableAll(),o.layers.enable(2);let m=o.material.opacity;h?m=1:this.showHits&&p<t.rigScale*.5?m=0:(i=r.getButton("primary"))!=null&&i.pressed?m=.5:m=f?.2:.1,o.material.opacity=it.lerp(o.material.opacity,m,this.context.time.deltaTimeUnscaled/.1),o.parent!==this.context.scene&&this.context.scene.add(o)}}renderHits(t){var i;for(const n of this._hitDiscs){if(!n)continue;const r=n.controller;if(!r||!r.connected||!r.isTracking){n.visible=!1;continue}}for(let n=0;n<t.controllers.length;n++){const r=t.controllers[n];if(!r.connected||!r.isTracking||!r.ray||!r.hasSelectEvent)continue;let o=this._hitDiscs[n],a=!0;const l=r.getPointerId("primary");l!=null&&this.context.input.getIsPointerIdInUse(l)&&(o&&(o.visible=!1),this._hitDistances[n]=null,this._lastHitDistances[n]=0,a=!1);const c=this.context.time.smoothedFps>=59?1:10;if((this.context.time.frame+r.index)%c!==0&&(a=!1),!a){const f=this._hitDiscs[n];f&&f.visible&&f.hit&&this.updateHitPointerPosition(r,f,f.hit.distance);continue}const h=this.context.physics.raycastFromRay(r.ray,{testObject:this.hitPointRaycastFilter,precise:!1});let u=h.find(f=>this.usePinchToTeleport&&r.isTeleportGesture?!0:this.isObjectWithInteractiveComponent(f.object));if(u||(u=h[0]),o&&(o.controller=r,o.hit=u),this._hitDistances[n]=(u==null?void 0:u.distance)||null,u){this._lastHitDistances[n]=u.distance;const f=t.rigScale??1;NP&&(_t.DrawWireSphere(u.point,.025*f,16711680),_t.DrawLabel(wt(0,.2,0).add(u.point),u.object.name,.02,0)),o||(o=this.createHitPointObject(),this._hitDiscs[n]=o),o.hit=u,o.visible=u.distance>f*.05;let p=.01*(f+u.distance);const m=(i=r.getButton("primary"))==null?void 0:i.pressed;m&&(p*=1.1),o.scale.set(p,p,p),o.layers.set(2);let v=o.material.opacity;if(m?v=1:v=u.distance<.15*f?.2:.6,o.material.opacity=it.lerp(o.material.opacity,v,this.context.time.deltaTimeUnscaled/.1),o.visible){if(u.normal){this.updateHitPointerPosition(r,o,u.distance);const g=u.normal.applyQuaternion(ki(u.object));o.quaternion.setFromUnitVectors(EAe,g)}else this.updateHitPointerPosition(r,o,u.distance);o.parent!==this.context.scene&&this.context.scene.add(o)}}else this._hitDiscs[n]&&(this._hitDiscs[n].visible=!1)}}isObjectWithInteractiveComponent(t,i=0){return AE(t)||t.isUI===!0?!0:t.isScene?!1:t.parent?this.isObjectWithInteractiveComponent(t.parent,i+1):!1}updateHitPointerPosition(t,i,n){const r=wt(t.rayWorldPosition);r.add(wt(0,0,n-.01).applyQuaternion(t.rayWorldQuaternion)),i.position.lerp(r,this.context.time.deltaTimeUnscaled/.05)}createHitPointObject(){const t=new fe(new cl(.3,6,6),new ti({color:15658734,opacity:.7,transparent:!0,depthTest:!1,depthWrite:!1,side:_i}));return t.layers.disableAll(),t.layers.enable(2),t}createRayLineObject(){const t=new wAe;t.layers.disableAll(),t.layers.enable(2);const i=new rq;t.geometry=i;const n=new Float32Array(9);n.set([0,0,.02,0,0,.4,0,0,1]),i.setPositions(n);const r=new Float32Array(9);r.set([1,1,1,.1,.1,.1,0,0,0]),i.setColors(r);const o=new GF({color:16777215,vertexColors:!0,worldUnits:!0,linewidth:.004,transparent:!0,depthWrite:!1,blending:Yp,dashed:!1});return t.material=o,t}}vf([C()],Sa.prototype,"movementSpeed",2);vf([C()],Sa.prototype,"rotationStep",2);vf([C()],Sa.prototype,"useTeleport",2);vf([C()],Sa.prototype,"usePinchToTeleport",2);vf([C()],Sa.prototype,"useTeleportTarget",2);vf([C()],Sa.prototype,"useTeleportFade",2);vf([C()],Sa.prototype,"showRays",2);vf([C()],Sa.prototype,"showHits",2);const EAe=new S(0,1,0);var MAe=Object.defineProperty,TAe=Object.getOwnPropertyDescriptor,Xs=(s,e,t,i)=>{for(var n=i>1?void 0:i?TAe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&MAe(e,t,n),n};const ZS=ie("debugwebxr"),IAe=ie("debugusdz");var BB;const cy=(BB=class extends Ie{constructor(){super(...arguments);d(this,"createVRButton",!0);d(this,"createARButton",!0);d(this,"createSendToQuestButton",!0);d(this,"createQRCode",!0);d(this,"useDefaultControls",!0);d(this,"showControllerModels",!0);d(this,"showHandModels",!0);d(this,"usePlacementReticle",!0);d(this,"customARPlacementReticle");d(this,"usePlacementAdjustment",!0);d(this,"arScale",1);d(this,"useXRAnchor",!1);d(this,"autoPlace",!0);d(this,"autoCenter",!0);d(this,"useQuicklookExport",!1);d(this,"useDepthSensing",!1);d(this,"useSpatialGrab",!0);d(this,"defaultAvatar");d(this,"_playerSync");d(this,"_createdComponentsInSession",[]);d(this,"_usdzExporter");d(this,"_exitXRMenuButton");d(this,"_previousXRState",0);d(this,"_spatialGrabRaycaster");d(this,"onAvatarSpawned",e=>{ZS&&console.log("WebXR.onAvatarSpawned",e),ne.getComponentInChildren(e,qd)??(t=ne.addComponent(e,qd))});d(this,"_buttonFactory");d(this,"_buttons",[])}awake(){Mt.getXRSync(this.context)}onEnable(){var e,t;window.location.protocol!=="https:"&&Fi('<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebXR_Device_API" target="_blank">WebXR</a> only works on secure connections (https).'),this.useQuicklookExport&&(ne.findObjectOfType(Gn)||(ZS&&console.log("WebXR: Adding USDZExporter"),this._usdzExporter=ne.addComponent(this.gameObject,Gn),this._usdzExporter.objectToExport=this.context.scene,this._usdzExporter.autoExportAnimations=!0,this._usdzExporter.autoExportAudioSources=!0)),this.handleCreatingHTML(),this.handleOfferSession(),this.defaultAvatar===!0&&(ZS&&console.warn("WebXR: No default avatar set, using static default avatar"),this.defaultAvatar=new ei("https://cdn.needle.tools/static/avatars/DefaultAvatar.glb")),this.defaultAvatar&&(this._playerSync=this.gameObject.getOrAddComponent(Fv),this._playerSync.autoSync=!1),this._playerSync&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,(e=this._playerSync.onPlayerSpawned)==null||e.removeEventListener(this.onAvatarSpawned),(t=this._playerSync.onPlayerSpawned)==null||t.addEventListener(this.onAvatarSpawned))}onDisable(){var e;(e=this._usdzExporter)==null||e.destroy(),this.removeButtons()}async handleOfferSession(){return this.createVRButton&&await Mt.isVRSupported()&&this.createVRButton?Mt.offerSession("immersive-vr","default",this.context):this.createARButton&&await Mt.isARSupported()&&this.createARButton?Mt.offerSession("immersive-ar","default",this.context):!1}get session(){return Mt.active??null}get sessionMode(){return Mt.activeMode??null}async enterVR(e){return Mt.start("immersive-vr",e,this.context)}async enterAR(e){return Mt.start("immersive-ar",e,this.context)}exitXR(){Mt.stop()}get isActiveWebXR(){return!cy.activeWebXRComponent||cy.activeWebXRComponent===this}onBeforeXR(e,t){var i;if(!this.isActiveWebXR){console.warn(`WebXR: another WebXR component is already active (${(i=cy.activeWebXRComponent)==null?void 0:i.name}). This is ignored: ${this.name}`);return}cy.activeWebXRComponent=this,e=="immersive-ar"&&this.useDepthSensing&&(t.optionalFeatures=t.optionalFeatures||[],t.optionalFeatures.push("depth-sensing"))}async onEnterXR(e){if(!this.isActiveWebXR)return;ZS&&console.log("WebXR onEnterXR"),this._previousXRState=fr.Global.Mask;const t=e.xr.isVR;if(fr.Global.Set(t?bc.VR:bc.AR),this.usePlacementReticle&&e.xr.isAR){let i=ne.findObjectOfType(lu);if(!i){const n=new ye;for(const r of this.context.scene.children)n.add(r);this.context.scene.add(n),i=ne.addComponent(n,lu),this._createdComponentsInSession.push(i)}i.customReticle=this.customARPlacementReticle,i.arScale=this.arScale,i.arTouchTransform=this.usePlacementAdjustment,i.autoPlace=this.autoPlace,i.autoCenter=this.autoCenter,i.useXRAnchor=this.useXRAnchor}this.useDefaultControls&&this.setDefaultMovementEnabled(!0),(this.showControllerModels||this.showHandModels)&&this.setDefaultControllerRenderingEnabled(!0),this.useSpatialGrab&&(this._spatialGrabRaycaster=ne.findObjectOfType(Ld)??void 0,this._spatialGrabRaycaster||(this._spatialGrabRaycaster=this.gameObject.addComponent(Ld))),this.createLocalAvatar(e.xr),this._exitXRMenuButton=this.context.menu.appendChild({label:"Quit XR",onClick:()=>this.exitXR(),icon:"exit_to_app",priority:2e4})}onUpdateXR(e){this.isActiveWebXR&&this._spatialGrabRaycaster&&(this._spatialGrabRaycaster.enabled=this.useSpatialGrab)}onLeaveXR(e){var t,i;if((t=this._exitXRMenuButton)==null||t.remove(),!!this.isActiveWebXR){fr.Global.Set(this._previousXRState),(i=this._playerSync)==null||i.destroyInstance();for(const n of this._createdComponentsInSession)n.destroy();this._createdComponentsInSession.length=0,this.handleOfferSession(),CM(1).then(()=>cy.activeWebXRComponent=null)}}setDefaultMovementEnabled(e){let t=this.gameObject.getComponent(Sa);return!t&&e&&(t=this.gameObject.addComponent(Sa),this._createdComponentsInSession.push(t)),t&&(t.enabled=e),t}setDefaultControllerRenderingEnabled(e){let t=this.gameObject.getComponent(Hc);return!t&&e&&(t=this.gameObject.addComponent(Hc),this._createdComponentsInSession.push(t),t.createControllerModel=this.showControllerModels,t.createHandModel==this.showHandModels),t&&(t.enabled=e),t}async createLocalAvatar(e){this._playerSync&&e.running&&typeof this.defaultAvatar!="boolean"&&(this._playerSync.asset=this.defaultAvatar,await this._playerSync.getInstance())}getButtonsContainer(){return this.getButtonsFactory()}getButtonsFactory(){return this._buttonFactory||(this._buttonFactory=nu.getOrCreate()),this._buttonFactory}handleCreatingHTML(){if(this.createARButton||this.createVRButton||this.useQuicklookExport){if((Vd()&&Dy()||IAe)&&this.useQuicklookExport){const t=ne.findObjectOfType(Gn);if(!t||t&&t.allowCreateQuicklookButton){const i=this.getButtonsFactory().createQuicklookButton();this.addButton(i,50)}}if(this.createARButton){const t=this.getButtonsFactory().createARButton();this.addButton(t,50)}if(this.createVRButton){const t=this.getButtonsFactory().createVRButton();this.addButton(t,50)}}if(this.createSendToQuestButton&&!MM()&&Mt.isVRSupported().then(t=>{if(!t){const i=this.getButtonsFactory().createSendToQuestButton();this.addButton(i,50)}}),this.createQRCode){const t=KM($c);if(t&&t.createQRCodeButton===!1)nt()&&console.warn("WebXR: QRCode button is disabled in the Needle Menu component");else{const i=Ll.getOrCreate().createQRCode();this.addButton(i,50)}}}addButton(e,t){this._buttons.push(e),e.setAttribute("priority",t.toString()),this.context.menu.appendChild(e)}removeButtons(){for(const e of this._buttons)e.remove();this._buttons.length=0}},d(BB,"activeWebXRComponent",null),BB);let Qn=cy;Xs([C()],Qn.prototype,"createVRButton",2);Xs([C()],Qn.prototype,"createARButton",2);Xs([C()],Qn.prototype,"createSendToQuestButton",2);Xs([C()],Qn.prototype,"createQRCode",2);Xs([C()],Qn.prototype,"useDefaultControls",2);Xs([C()],Qn.prototype,"showControllerModels",2);Xs([C()],Qn.prototype,"showHandModels",2);Xs([C()],Qn.prototype,"usePlacementReticle",2);Xs([C(ei)],Qn.prototype,"customARPlacementReticle",2);Xs([C()],Qn.prototype,"usePlacementAdjustment",2);Xs([C()],Qn.prototype,"arScale",2);Xs([C()],Qn.prototype,"useXRAnchor",2);Xs([C()],Qn.prototype,"autoPlace",2);Xs([C()],Qn.prototype,"autoCenter",2);Xs([C()],Qn.prototype,"useQuicklookExport",2);Xs([C()],Qn.prototype,"useDepthSensing",2);Xs([C()],Qn.prototype,"useSpatialGrab",2);Xs([C(ei)],Qn.prototype,"defaultAvatar",2);class ST{get extensionName(){return"Physics"}onExportObject(e,t,i){const n=ne.getComponents(e,Ni).filter(l=>l.enabled),r=ne.getComponents(e,Ea).filter(l=>l.enabled&&!l.isTrigger);let o=n.length>0?n[0]:null;const a=r.length>0?r[0]:null;a&&!o&&(o=new Ni,o.isKinematic=!0),o&&t.addEventListener("serialize",(l,c)=>{var h,u,f;if(o){if(l.appendLine(),l.beginBlock('def RealityKitComponent "RigidBody"',"{",!0),o.useGravity||l.appendLine("bool gravityEnabled = 0"),l.appendLine('uniform token info:id = "RealityKit.RigidBody"'),o.isKinematic&&l.appendLine('token motionType = "Kinematic"'),l.beginBlock('def RealityKitStruct "massFrame"',"{",!0),l.appendLine(`float m_mass = ${o.mass}`),l.beginBlock('def RealityKitStruct "m_pose"',"{",!0),l.appendLine(`float3 position = (${o.centerOfMass.x}, ${o.centerOfMass.y}, ${o.centerOfMass.z})`),l.closeBlock("}"),l.closeBlock("}"),r.length>0){const p=r[0];l.beginBlock('def RealityKitStruct "material"',"{",!0);const m=p.sharedMaterial;m&&m.dynamicFriction!==void 0&&l.appendLine(`double dynamicFriction = ${(h=p.sharedMaterial)==null?void 0:h.dynamicFriction}`),m&&m.bounciness!==void 0&&l.appendLine(`double restitution = ${(u=p.sharedMaterial)==null?void 0:u.bounciness}`),m&&m.staticFriction!==void 0&&l.appendLine(`double staticFriction = ${(f=p.sharedMaterial)==null?void 0:f.staticFriction}`),l.closeBlock("}")}l.closeBlock("}")}}),a&&(t.addEventListener("serialize",(l,c)=>{var f;l.beginBlock('def RealityKitComponent "Collider"',"{",!0),l.appendLine("uint group = 1"),l.appendLine('uniform token info:id = "RealityKit.Collider"'),l.appendLine("uint mask = 4294967295");const u=a.isTrigger?"Trigger":"Default";if(l.appendLine(`token type = "${u}"`),l.beginBlock('def RealityKitStruct "Shape"',"{",!0),a instanceof zv){const p=a;l.appendLine('token shapeType = "Sphere"'),l.appendLine(`float radius = ${p.radius}`)}else if(a instanceof Gv){const p=a;l.appendLine('token shapeType = "Box"'),l.appendLine(`float3 extent = (${p.size.x}, ${p.size.y}, ${p.size.z})`)}else if(a instanceof au){const p=a;l.appendLine('token shapeType = "Capsule"'),l.appendLine(`float radius = ${p.radius}`),l.appendLine(`float height = ${p.height}`)}else if(a instanceof Sm&&((f=a.sharedMesh)!=null&&f.geometry)){const p=a.sharedMesh.geometry;p.boundingBox||p.computeBoundingBox();const m=a.sharedMesh.geometry.boundingBox;m&&(l.appendLine('token shapeType = "Box"'),l.appendLine(`float3 extent = (${m.max.x-m.min.x}, ${m.max.y-m.min.y}, ${m.max.z-m.min.z})`),console.log("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. MeshCollider will be exported as Box",a))}else console.warn("[USDZ] Only Box, Sphere, and Capsule colliders are supported in visionOS/iOS. Ignoring collider:",a);l.beginBlock('def RealityKitStruct "pose"',"{",!0),l.closeBlock("}"),l.closeBlock("}"),l.closeBlock("}")}),r.length>1&&console.log("WARNING: Multiple colliders detected. visionOS / iOS can only support objects with a single collider, only exporting the first collider: ",a))}}var RAe=Object.defineProperty,PAe=Object.getOwnPropertyDescriptor,vu=(s,e,t,i)=>{for(var n=i>1?void 0:i?PAe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&RAe(e,t,n),n};const Yf=ie("debugtext");var As=(s=>(s[s.UpperLeft=0]="UpperLeft",s[s.UpperCenter=1]="UpperCenter",s[s.UpperRight=2]="UpperRight",s[s.MiddleLeft=3]="MiddleLeft",s[s.MiddleCenter=4]="MiddleCenter",s[s.MiddleRight=5]="MiddleRight",s[s.LowerLeft=6]="LowerLeft",s[s.LowerCenter=7]="LowerCenter",s[s.LowerRight=8]="LowerRight",s))(As||{}),oq=(s=>(s[s.Normal=0]="Normal",s[s.Bold=1]="Bold",s[s.Italic=2]="Italic",s[s.BoldAndItalic=3]="BoldAndItalic",s))(oq||{});class Yr extends Em{constructor(){super(...arguments);d(this,"alignment",0);d(this,"verticalOverflow",0);d(this,"horizontalOverflow",0);d(this,"lineSpacing",1);d(this,"supportRichText",!1);d(this,"font");d(this,"fontStyle",0);d(this,"sRGBTextColor",new Ae(1,0,1));d(this,"_text","");d(this,"_fontSize",12);d(this,"_textMeshUi",null);d(this,"_didHandleTextRenderOnTop",!1)}setAlphaFactor(t){var i;super.setAlphaFactor(t),(i=this.uiObject)==null||i.set({fontOpacity:this.color.alpha*this.alphaFactor}),this.markDirty()}get text(){return this._text}set text(t){t!==this._text&&(this._text=t,this.feedText(this.text,this.supportRichText),this.markDirty())}set_text(t){this.text=t}get fontSize(){return this._fontSize}set fontSize(t){var i;this._fontSize=t,(i=this.uiObject)==null||i.set({fontSize:t})}onColorChanged(){var t;this.sRGBTextColor.copy(this.color),this.sRGBTextColor.convertLinearToSRGB(),(t=this.uiObject)==null||t.set({color:this.sRGBTextColor,fontOpacity:this.color.alpha})}onParentRectTransformChanged(){super.onParentRectTransformChanged(),this.uiObject&&this.updateOverflow()}onBeforeCanvasRender(t){this.updateOverflow()}updateOverflow(){var i;const t=(i=this.uiObject)==null?void 0:i._overflow;t&&(t._needsUpdate=!0)}onCreate(t){Yf&&console.log(this),this.horizontalOverflow==1&&(t.whiteSpace="pre"),this.verticalOverflow==0&&(this.context.renderer.localClippingEnabled=!0,t.overflow="hidden"),this.horizontalOverflow==1&&this.verticalOverflow==0,t.lineHeight=this.lineSpacing,delete t.backgroundOpacity,delete t.backgroundColor,Yf&&(t.backgroundColor=16750848,t.backgroundOpacity=.5);const i=this.rectTransform;t={...t,...this.getTextOpts()},this.getAlignment(t),Yf&&(t.backgroundColor=Math.random()*16777215,t.backgroundOpacity=.1),this.uiObject=i.createNewText(t),this.feedText(this.text,this.supportRichText)}onAfterAddedToScene(){super.onAfterAddedToScene(),this.handleTextRenderOnTop()}getTextOpts(){const t=this.fontSize,i={color:this.color,fontOpacity:this.color.alpha,fontSize:t,fontKerning:"normal"};return this.setFont(i,this.fontStyle),i}onEnable(){var t;super.onEnable(),this._didHandleTextRenderOnTop=!1,this.uiObject&&this.uiObject.addAfterUpdate(()=>{this.setShadowComponentOwner(this.uiObject),this.markDirty()}),setTimeout(()=>this.markDirty(),10),(t=this.canvas)==null||t.registerEventReceiver(this)}onDisable(){var t;super.onDisable(),(t=this.canvas)==null||t.unregisterEventReceiver(this)}getAlignment(t){switch(t.flexDirection="column",this.alignment){case 0:case 3:case 6:t.textAlign="left";break;case 1:case 4:case 7:t.textAlign="center";break;case 2:case 5:case 8:t.textAlign="right";break}switch(this.alignment){default:case 0:case 1:case 2:t.alignItems="start";break;case 3:case 4:case 5:t.alignItems="center";break;case 6:case 7:case 8:t.alignItems="end";break}return t}feedText(t,i){var n,r,o;if(Yf&&console.log("feedText",this.uiObject,t,i),!!this.uiObject)if(this._textMeshUi||(this._textMeshUi=[]),this.uiObject.children.length=0,!i||t.length===0)this.uiObject.textContent=t;else{let a=this.getNextTag(t);if(a){if(a.startIndex>0){for(let h=this.uiObject.children.length-1;h>=0;h--){const u=this.uiObject.children[h];u.isUI&&(this.uiObject.remove(u),u.clear())}const c=new KC({textContent:t.substring(0,a.startIndex),color:"inherit"});this.uiObject.add(c)}}else{this.uiObject.textContent="",this.setOptions({textContent:t});return}const l=[];for(;a;){const c=this.getNextTag(t,a.endIndex),h={fontFamily:(n=this.uiObject)==null?void 0:n.get("fontFamily"),color:"inherit",textContent:""};if(c){h.textContent=this.getText(t,a,c),this.handleTag(a,h,l);const u=new KC(h);(r=this.uiObject)==null||r.add(u)}else{h.textContent=t.substring(a.endIndex),this.handleTag(a,h,l);const u=new KC(h);(o=this.uiObject)==null||o.add(u)}a=c}}}handleTextRenderOnTop(){this._didHandleTextRenderOnTop||(this._didHandleTextRenderOnTop=!0,this.startCoroutine(this.renderOnTopCoroutine()))}*renderOnTopCoroutine(){if(!this.canvas)return;const t=[],i=this.canvas,n={renderOnTop:i.renderOnTop,depthWrite:i.depthWrite,doubleSided:i.doubleSided};for(;;){let r=!1;if(this._textMeshUi)for(let o=0;o<this._textMeshUi.length;o++){if(t[o]===!0)continue;r=!0;const a=this._textMeshUi[o];a.textContent&&(_E(a,n),t[o]=!0)}if(!r)break;yield}}handleTag(t,i,n){if(!t.isEndTag){if(t.type.includes("color")){const r=new zP(t,{color:i.color});if(n.push(r),t.type.length>6){const o=parseInt("0x"+t.type.substring(7));i.color=o}else i.color=new Ae(1,1,1)}else if(t.type=="b"){this.setFont(i,1);const r=new zP(t,{fontWeight:700});n.push(r)}else if(t.type=="i"){this.setFont(i,2);const r=new zP(t,{fontStyle:"italic"});n.push(r)}}}getText(t,i,n){return t.substring(i.endIndex,n.startIndex)}getNextTag(t,i=0){const n=t.indexOf("<",i),r=t.indexOf(">",n);if(n>=0&&r>=0){const o=t.substring(n+1,r);return{type:o,startIndex:n,endIndex:r+1,isEndTag:o.startsWith("/")}}return null}setFont(t,i){if(!this.font)return;const n=this.font,r=this.getFamilyNameWithCorrectSuffix(n,i);Yf&&console.log("Selected font family:"+r);let o=D2.getFontFamily(r);switch(o||(o=D2.addFontFamily(r)),t.fontFamily=o,i){default:case 0:t.fontWeight=400,t.fontStyle="normal";break;case 1:t.fontWeight=700,t.fontStyle="normal";break;case 2:t.fontWeight=400,t.fontStyle="italic";break;case 3:t.fontStyle="italic",t.fontWeight=400}let a=o.getVariant(t.fontWeight,t.fontStyle);if(!a){let l=r;l!=null&&l.endsWith("-msdf.json")||(l+="-msdf.json");let c=r;c!=null&&c.endsWith(".png")||(c+=".png"),a=o.addVariant(t.fontWeight,t.fontStyle,l,c),a==null||a.addEventListener("ready",()=>{this.markDirty()})}}getFamilyNameWithCorrectSuffix(t,i){var h;const n=t.lastIndexOf("-");if(n<0)return t;const r=(h=t.substring(n+1))==null?void 0:h.toLowerCase();if(BAe.includes(r))return Yf&&console.warn("Unsupported font style: "+r),t;const o=t.lastIndexOf("/");let a=t;o>=0&&(a=a.substring(o+1));const l=a[0]===a[0].toUpperCase(),c=t.substring(0,n);switch(Yf&&console.log("Select font: ",t,oq[i],a,l,c),i){case 0:return l?c+"-Regular":c+"-regular";case 1:return l?c+"-Bold":c+"-bold";case 2:return l?c+"-Italic":c+"-italic";case 3:return l?c+"-BoldItalic":c+"-bolditalic";default:return t}}}vu([C()],Yr.prototype,"alignment",2);vu([C()],Yr.prototype,"verticalOverflow",2);vu([C()],Yr.prototype,"horizontalOverflow",2);vu([C()],Yr.prototype,"lineSpacing",2);vu([C()],Yr.prototype,"supportRichText",2);vu([C(URL)],Yr.prototype,"font",2);vu([C()],Yr.prototype,"fontStyle",2);vu([C()],Yr.prototype,"text",1);vu([C()],Yr.prototype,"fontSize",1);class zP{constructor(e,t){d(this,"tag");d(this,"previousValues");this.tag=e,this.previousValues=t}}const BAe=["medium","mediumitalic","black","blackitalic","thin","thinitalic","extrabold","light","lightitalic","semibold"];class xd{constructor(e){d(this,"id");d(this,"content","");d(this,"font",[]);d(this,"pointSize",144);d(this,"width");d(this,"height");d(this,"depth");d(this,"wrapMode");d(this,"horizontalAlignment");d(this,"verticalAlignment");d(this,"material");this.id=e}static getId(){return this.global_id++}setDepth(e){return this.depth=e,this}setPointSize(e){return this.pointSize=e,this}setHorizontalAlignment(e){return this.horizontalAlignment=e,this}setVerticalAlignment(e){return this.verticalAlignment=e,this}writeTo(e,t){var n;t.beginBlock(`def Preliminary_Text "${this.id}"`,"(",!1),t.appendLine('prepend apiSchemas = ["MaterialBindingAPI"]'),t.closeBlock(")"),t.beginBlock(),this.content&&t.appendLine(`string content = "${this.content}"`),(!this.font||this.font.length<=0)&&(this.font||(this.font=[]),(n=this.font)==null||n.push("sans-serif"));const i=this.font.map(r=>`"${r}"`).join(", ");t.appendLine(`string[] font = [ ${i} ]`),t.appendLine(`double pointSize = ${this.pointSize}`),typeof this.width=="number"&&t.appendLine(`double width = ${this.width}`),typeof this.height=="number"&&t.appendLine(`double height = ${this.height}`),typeof this.depth=="number"&&t.appendLine(`double depth = ${this.depth}`),this.wrapMode&&t.appendLine(`token wrapMode = "${this.wrapMode}"`),this.horizontalAlignment&&t.appendLine(`token horizontalAlignment = "${this.horizontalAlignment}"`),this.verticalAlignment&&t.appendLine(`token verticalAlignment = "${this.verticalAlignment}"`),this.material!==void 0&&t.appendLine(`rel material:binding = </StageRoot/Materials/${rF(this.material)}>`),t.closeBlock()}}d(xd,"global_id",0);class CT{static singleLine(e,t,i){const n=new xd("text_"+xd.getId());return n.content=e,t&&(n.pointSize=t),i&&(n.depth=i),n}static multiLine(e,t,i,n,r,o){const a=new xd("text_"+xd.getId());return a.content=e,a.width=t,a.height=i,a.horizontalAlignment=n,a.verticalAlignment=r,o!==void 0&&(a.wrapMode=o),a}}const DAe=new le().makeRotationY(Math.PI),OAe=new le().makeScale(-1,1,-1);class wx{get extensionName(){return"text"}exportText(e,t,i){const n=ne.getComponent(e,Yr);if(!n)return;const r=ne.getComponent(e,Xr);let o=100,a=100;r&&(o=r.width,a=r.height),t.matrix=DAe.clone(),r&&t.matrix.premultiply(OAe);const l=n.color.clone();t.material=new ws({color:l,emissive:l}),t.addEventListener("serialize",(c,h)=>{let u=n.text;u=u.replace(/\r/g,""),u=u.replace(/\n/g,"\\n");const f=CT.multiLine(u,o,a,"center","bottom","flowing");this.setTextAlignment(f,n.alignment),this.setOverflow(f,n),t.material&&(f.material=t.material),f.pointSize=this.convertToTextSize(n.fontSize),f.depth=.001,f.writeTo(void 0,c)})}convertToTextSize(e){return 1/.0502*144*e}setOverflow(e,t){t.horizontalOverflow?e.wrapMode="singleLine":e.wrapMode="flowing"}setTextAlignment(e,t){switch(t){case As.LowerLeft:case As.MiddleLeft:case As.UpperLeft:e.horizontalAlignment="left";break;case As.LowerCenter:case As.MiddleCenter:case As.UpperCenter:e.horizontalAlignment="center";break;case As.LowerRight:case As.MiddleRight:case As.UpperRight:e.horizontalAlignment="right";break}switch(t){case As.LowerLeft:case As.LowerCenter:case As.LowerRight:e.verticalAlignment="bottom";break;case As.MiddleLeft:case As.MiddleCenter:case As.MiddleRight:e.verticalAlignment="middle";break;case As.UpperLeft:case As.UpperCenter:case As.UpperRight:e.verticalAlignment="top";break}}}class ET{get extensionName(){return"tmui"}onExportObject(e,t,i){const n=ne.getComponent(e,Ar);if(n&&n.enabled&&n.renderMode===j7.WorldSpace){const r=new wx,o=ne.getComponent(e,Xr),a=ne.getComponent(e,Xd),l=new Array;if(o){if(!ne.isActiveSelf(e)){const u=ne.isActiveSelf(e);ne.setActive(e,!0),o.onEnable(),o.updateTransform(),l.push(()=>{o.onDisable(),ne.setActive(e,u)})}e.traverse(u=>{if(!ne.isActiveInHierarchy(u)){const f=ne.isActiveSelf(u);ne.setActive(u,!0);const p=ne.getComponent(u,ol);p&&(p.onEnable(),l.push(()=>{p.onDisable()}));const m=ne.getComponent(u,Xr);m&&(m.onEnable(),m.updateTransform(),m.onApplyTransform(),l.push(()=>{m.onDisable()}));const v=ne.getComponent(u,Yr);v&&(v.onEnable(),l.push(()=>{v.onDisable()})),l.push(()=>{ne.setActive(u,f)})}}),o.width,o.height;const c=mr.createEmpty(),h=o.shadowComponent;if(t.add(c),h){const u=h.matrix;c.matrix.copy(u);const f=new Map,p=new Map;f.set(h,c),p.set(h,a?a.alpha:1),h.traverse(m=>{if(m===h)return;const v=mr.createEmpty();v.matrix.copy(m.matrix);const g=m.parent,y=!!g&&typeof g.textContent=="string"&&g.textContent.length>0;let A=p.get(g)||1;const _=ne.getComponent(m,Xd);if(_&&(A*=_.alpha),m instanceof fe&&y){const x=m[$a];x?r.exportText(x.gameObject,v,i):console.error("Error when exporting UI: shadow component owner not found. This is likely a bug.",m)}if(m instanceof fe&&!y){const x=m.geometry.clone();x.scale(1,1,-1),this.flipWindingOrder(x),v.geometry=x;const E=new Ae,M=m.material.opacity;E.copy(m.material.color),v.material=new ti({color:E,opacity:M*A,map:m.material.map,transparent:!0})}f.set(m,v),p.set(m,A);const b=f.get(g);if(!b){console.error("Error when exporting UI: shadow component parent not found!",m,m.parent);return}b.add(v)})}}for(const c of l)c()}}flipWindingOrder(e){const t=e.index.array;for(let i=0,n=t.length/3;i<n;i++){const r=t[i*3];t[i*3]=t[i*3+2],t[i*3+2]=r}e.index.needsUpdate=!0}}const kA=ie("debugusdz");function LAe(s,e){var a;const t=[],i=ne.getComponentsInChildren(s,vr),n=ne.getComponentsInChildren(s,Wr),r=new Array,o=new Array;if(e.injectImplicitBehaviours)for(const l of i){if(!l||!l.runtimeAnimatorController||!l.enabled)continue;const c=l.runtimeAnimatorController.activeState;if(!c||!c.motion||!c.motion.clip||((a=c.motion.clip.tracks)==null?void 0:a.length)<1||r.includes(l))continue;const h=new cm;h.animator=l,h.stateName=c.name,h.trigger="start",h.name="PlayAnimationOnClick_implicitAtStart_"+h.stateName;const u=new ye;ne.addComponent(u,h),o.push(u),r.push(l),s.add(u)}else for(const l of i){if(!l||!l.runtimeAnimatorController||!l.enabled)continue;kA&&console.log(l);const c=[];for(const h of l.runtimeAnimatorController.enumerateActions()){kA&&console.log(h);const u=h.getClip();c.includes(u)||c.push(u)}t.push({root:l.gameObject,clips:c})}if(e.injectImplicitBehaviours)for(const l of n){if(!l||!l.clip||!l.enabled||!l.playAutomatically||r.includes(l))continue;const c=new cm;c.animation=l,c.stateName=l.clip.name,c.trigger="start",c.name="PlayAnimationOnClick_implicitAtStart_"+c.stateName;const h=new ye;ne.addComponent(h,c),o.push(h),r.push(l),s.add(h)}else for(const l of n){kA&&console.log(l);const c=[];for(const h of l.animations)c.includes(h)||c.push(h);t.push({root:l.gameObject,clips:c})}kA&&(t==null?void 0:t.length)>0&&console.log("USDZ Animation Clips without behaviours",t);for(const l of t)for(const c of l.clips)e.registerAnimation(l.root,c);return o}function kAe(s,e){const t=ne.getComponentsInChildren(s,Hn),i=ne.getComponentsInChildren(s,Yd),n=new Array,r=new Array;kA&&console.log({audioSources:t,playAudioOnClicks:i});for(const o of i){if(!o.target)continue;const a=t.indexOf(o.target);a>-1&&t.splice(a,1)}for(const o of t){if(!o||!o.clip||o.volume<=0||n.includes(o))continue;const a=new Yd;a.target=o,a.name="PlayAudioOnClick_implicitAtStart_",a.trigger="start";const l=new ye;ne.addComponent(l,a),console.log("implicit PlayAudioOnStart",l,a),r.push(l),n.push(o),s.add(l)}return r}function FAe(s){return new cs("DisableAtStart",Qs.sceneStartTrigger(),Ai.fadeAction(s,0,!1))}function IH(s){const e=s.domElement.shadowRoot.querySelector("link[rel='ar']");if(e)return e;const t=document.createElement("div");t.classList.add("menu"),t.classList.add("quicklook-menu"),t.style.display="none",t.style.visibility="hidden";const i=document.createElement("button");i.id="open-in-ar",i.innerText="Open in QuickLook",t.appendChild(i);const n=document.createElement("a");n.id="needle-usdz-link",n.style.display="none",n.rel="ar",n.href="",t.appendChild(n);const r=document.createElement("img");return r.id="button",n.appendChild(r),s.domElement.shadowRoot.appendChild(t),n}var UAe=Object.defineProperty,NAe=Object.getOwnPropertyDescriptor,Kr=(s,e,t,i)=>{for(var n=i>1?void 0:i?NAe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&UAe(e,t,n),n};const ka=ie("debugusdz");class Af{constructor(){d(this,"callToAction");d(this,"checkoutTitle");d(this,"checkoutSubtitle");d(this,"callToActionURL")}}Kr([C()],Af.prototype,"callToAction",2);Kr([C()],Af.prototype,"checkoutTitle",2);Kr([C()],Af.prototype,"checkoutSubtitle",2);Kr([C()],Af.prototype,"callToActionURL",2);var UC;const YD=(UC=class extends Ie{constructor(){super(...arguments);d(this,"objectToExport");d(this,"autoExportAnimations",!0);d(this,"autoExportAudioSources",!0);d(this,"exportFileName");d(this,"customUsdzFile");d(this,"customBranding");d(this,"anchoringType","plane");d(this,"maxTextureSize",2048);d(this,"planeAnchoringAlignment","horizontal");d(this,"interactive",!0);d(this,"allowCreateQuicklookButton",!0);d(this,"quickLookCompatible",!0);d(this,"extensions",[]);d(this,"link");d(this,"button");d(this,"onClickedOpenInARElement",e=>{e.preventDefault(),this.exportAndOpen()});d(this,"_currentExportTasks",new Map);d(this,"_previousTimeScale",1);d(this,"lastCallback");d(this,"_rootSessionRootWasAppliedTo",null);d(this,"_rootPositionBeforeExport",new S);d(this,"_rootRotationBeforeExport",new Ce);d(this,"_rootScaleBeforeExport",new S)}start(){var e,t,i;ka&&(console.log("USDZExporter",this),console.log("Debug USDZ Mode. Press 'T' to export"),window.addEventListener("keydown",n=>{switch(n.key){case"t":this.exportAsync();break}}),Wc()&&setTimeout(()=>{this.exportAsync()},2e3)),this.objectToExport||(this.objectToExport=this.gameObject),!((t=(e=this.objectToExport)==null?void 0:e.children)!=null&&t.length)&&!((i=this.objectToExport)!=null&&i.isMesh)&&(this.objectToExport=this.context.scene),this.interactive&&(this.extensions.push(new vT),this.extensions.push(new cf),this.extensions.push(new ST),this.extensions.push(new wx),this.extensions.push(new ET))}onEnable(){var i;const e=Vd(),t=Dy();(ka||e&&t)&&(this.allowCreateQuicklookButton&&(this.button=this.createQuicklookButton()),this.lastCallback=this.quicklookCallback.bind(this),this.link=IH(this.context),this.link.addEventListener("message",this.lastCallback)),ka&&_n("USDZ Exporter enabled: "+this.name),(i=document.getElementById("open-in-ar"))==null||i.addEventListener("click",this.onClickedOpenInARElement)}onDisable(){var e,t,i;(e=this.button)==null||e.remove(),(t=this.link)==null||t.removeEventListener("message",this.lastCallback),ka&&_n("USDZ Exporter disabled: "+this.name),(i=document.getElementById("open-in-ar"))==null||i.removeEventListener("click",this.onClickedOpenInARElement)}async exportAsync(){return this.exportAndOpen()}async exportAndOpen(){var i;let e=this.exportFileName??((i=this.objectToExport)==null?void 0:i.name)??this.name;if(e+="-"+h7(),Bd()||(e!==""&&(e+="-"),e+="MadeWithNeedle"),this.link||(this.link=IH(this.context)),this.customUsdzFile)return ka&&console.log("Exporting custom usdz",this.customUsdzFile),this.openInQuickLook(this.customUsdzFile,e),null;if(!this.objectToExport)return console.warn("No object to export",this),null;const t=await this.export(this.objectToExport);return t?(ka&&console.log("USDZ generation done. Downloading as "+e),this.openInQuickLook(t,e),t):(console.error("USDZ generation failed. Please report a bug",this),null)}async export(e){if(!e)return console.warn("No object to export"),null;const t=this._currentExportTasks.get(e);if(t)return t;const i=this.internalExport(e);return i instanceof Promise?(this._currentExportTasks.set(e,i),i.then(n=>(this._currentExportTasks.delete(e),n)).catch(n=>(this._currentExportTasks.delete(e),console.error("Error during USDZ export  please report a bug!",n),null))):i}async internalExport(e){ai.start("export-usdz",{onProgress:A=>{this.dispatchEvent(new CustomEvent("export-progress",{detail:{progress:A}}))}}),ai.report("export-usdz",{message:"Starting export",totalSteps:40,currentStep:0}),ai.report("export-usdz",{message:"Load progressive textures",autoStep:5}),ai.start("export-usdz-textures","export-usdz");const t=ne.getComponentsInChildren(e,Vo);for(const A of t)A&&A.enabled&&A.updateSprite(!0);const i=ne.getComponentsInChildren(e,Vn),n=new Array;let r=0;for(const A of i){for(const _ of A.sharedMeshes)if(_){const b=yi.assignMeshLOD(_,0);b instanceof Promise&&n.push(new Promise((x,E)=>{b.then(()=>{r++,ai.report("export-usdz-textures",{message:"Loaded progressive mesh",currentStep:r,totalSteps:n.length}),x()}).catch(M=>E(M))}))}for(const _ of A.sharedMaterials)if(_){const b=yi.assignTextureLOD(_,0);b instanceof Promise&&n.push(new Promise((x,E)=>{b.then(()=>{r++,ai.report("export-usdz-textures",{message:"Loaded progressive texture",currentStep:r,totalSteps:n.length}),x()}).catch(M=>E(M))}))}}ka&&_n("Progressive Loading: "+n.length),await Promise.all(n),ka&&_n("Progressive Loading: done"),ai.end("export-usdz-textures");const o=fr.Global.Mask;fr.Global.Set(bc.AR);const a=new m7,l=new cx(this.quickLookCompatible),c=[l,...this.extensions],h={self:this,exporter:a,extensions:c,object:e};ai.report("export-usdz","Invoking before-export"),this.dispatchEvent(new CustomEvent("before-export",{detail:h})),this.applyWebARSessionRoot(),this._previousTimeScale=this.context.time.timeScale,this.context.time.timeScale=0,ai.report("export-usdz","auto export animations and audio sources");const u=new Array;this.autoExportAnimations&&u.push(...LAe(e,l)),this.extensions.find(A=>A.extensionName==="Audio")&&this.autoExportAudioSources&&u.push(...kAe(e)),a.debug=ka,a.keepObject=A=>{const _=ne.getComponent(A,Vn);return!(_&&!_.enabled)};const p=new Array;this.objectToExport&&this.quickLookCompatible&&this.interactive&&this.objectToExport.traverse(A=>{A.visible||p.push(A)});const m=this.extensions.find(A=>A.extensionName==="Behaviour");this.interactive&&m&&p.length>0&&m.addBehavior(FAe(p));let v=!0;this.quickLookCompatible&&!this.interactive&&(v=!1),this.anchoringType!=="plane"&&this.anchoringType!=="none"&&this.anchoringType!=="image"&&this.anchoringType!=="face"&&(this.anchoringType="plane"),this.planeAnchoringAlignment!=="horizontal"&&this.planeAnchoringAlignment!=="vertical"&&this.planeAnchoringAlignment!=="any"&&(this.planeAnchoringAlignment="horizontal"),ai.report("export-usdz","Invoking exporter.parse");const g=await a.parse(this.objectToExport,{ar:{anchoring:{type:this.anchoringType},planeAnchoring:{alignment:this.planeAnchoringAlignment}},extensions:c,quickLookCompatible:this.quickLookCompatible,maxTextureSize:this.maxTextureSize,exportInvisible:v}),y=new Blob([g],{type:"model/vnd.usdz+zip"});this.revertWebARSessionRoot(),this.context.time.timeScale=this._previousTimeScale,ai.report("export-usdz","Invoking after-export"),this.dispatchEvent(new CustomEvent("after-export",{detail:h}));for(const A of u)ne.destroy(A);return fr.Global.Set(o),ai.end("export-usdz"),y}openInQuickLook(e,t){const i=e instanceof Blob?URL.createObjectURL(e):e,n=this.buildQuicklookOverlay();ka&&console.log("QuickLook Overlay",n);const r=n.callToAction?encodeURIComponent(n.callToAction):"",o=n.checkoutTitle?encodeURIComponent(n.checkoutTitle):"",a=n.checkoutSubtitle?encodeURIComponent(n.checkoutSubtitle):"";this.link.href=i+`#callToAction=${r}&checkoutTitle=${o}&checkoutSubtitle=${a}&callToActionURL=${n.callToActionURL}`,this.lastCallback||(this.lastCallback=this.quicklookCallback.bind(this),this.link.addEventListener("message",this.lastCallback)),this.link.download=t+".usdz",this.link.click()}download(e,t){YD.save(e,t)}static save(e,t){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof e=="string"?i.href=e:i.href=URL.createObjectURL(e),i.download=t,i.click(),i.remove()}quicklookCallback(e){if((e==null?void 0:e.data)=="_apple_ar_quicklook_button_tapped"){ka&&Fi("Quicklook closed via call to action button");var t=new CustomEvent("quicklook-button-tapped",{detail:this});if(this.dispatchEvent(t),!t.defaultPrevented){const i=new URLSearchParams(this.link.href);if(i){const n=i.get("callToActionURL");ka&&_n("Quicklook url: "+n),n&&(Bd()?globalThis.open(n,"_blank"):console.warn("Quicklook closed: custom redirects require a Needle Engine Pro license: https://needle.tools/pricing",n))}}}}buildQuicklookOverlay(){var i,n,r,o,a,l;const e={};return this.customBranding&&Object.assign(e,this.customBranding),Bd()||(console.log("Custom Quicklook banner text requires pro license: https://needle.tools/pricing"),e.callToAction="Close",e.checkoutTitle=" Made with Needle",e.checkoutSubtitle="_"),(((i=e.callToAction)==null?void 0:i.length)||((n=e.checkoutTitle)==null?void 0:n.length)||((r=e.checkoutSubtitle)==null?void 0:r.length))&&((o=e.callToAction)!=null&&o.length||(e.callToAction="\0"),(a=e.checkoutTitle)!=null&&a.length||(e.checkoutTitle="\0"),(l=e.checkoutSubtitle)!=null&&l.length||(e.checkoutSubtitle="\0")),this.dispatchEvent(new CustomEvent("quicklook-overlay",{detail:e})),e}getARScaleAndTarget(){if(!this.objectToExport)return{scale:1,_invertForward:!1,target:this.gameObject,sessionRoot:null};let e=ne.getComponentInParent(this.objectToExport,lu);e||(e=ne.getComponentInChildren(this.objectToExport,lu));let t=1,i=!1;const n=this.objectToExport;if(e)t=e.arScale,i=e.invertForward;else{const a=ne.findObjectOfType(Qn);a&&(t=a.arScale)}return{scale:1/t,_invertForward:i,target:n,sessionRoot:(e==null?void 0:e.gameObject)??null}}applyWebARSessionRoot(){if(!this.objectToExport)return;const{scale:e,_invertForward:t,target:i,sessionRoot:n}=this.getARScaleAndTarget(),r=n==null?void 0:n.matrixWorld.clone().invert();this._rootSessionRootWasAppliedTo=i,this._rootPositionBeforeExport.copy(i.position),this._rootRotationBeforeExport.copy(i.quaternion),this._rootScaleBeforeExport.copy(i.scale),i.scale.multiplyScalar(e),t&&i.quaternion.multiply(YD.invertForwardQuaternion),i.updateMatrix(),i.updateMatrixWorld(!0),n&&r&&i.matrix.premultiply(r)}revertWebARSessionRoot(){if(!this.objectToExport||!this._rootSessionRootWasAppliedTo)return;const e=this._rootSessionRootWasAppliedTo;e.position.copy(this._rootPositionBeforeExport),e.quaternion.copy(this._rootRotationBeforeExport),e.scale.copy(this._rootScaleBeforeExport),e.updateMatrix(),e.updateMatrixWorld(!0),this._rootSessionRootWasAppliedTo=null}createQuicklookButton(){const t=nu.getOrCreate().createQuicklookButton();return t.parentNode||this.context.menu.appendChild(t),t}},d(UC,"invertForwardMatrix",new le().makeRotationY(Math.PI)),d(UC,"invertForwardQuaternion",new Ce().setFromEuler(new li(0,Math.PI,0))),UC);let Gn=YD;Kr([C(ye)],Gn.prototype,"objectToExport",2);Kr([C()],Gn.prototype,"autoExportAnimations",2);Kr([C()],Gn.prototype,"autoExportAudioSources",2);Kr([C()],Gn.prototype,"exportFileName",2);Kr([C(URL)],Gn.prototype,"customUsdzFile",2);Kr([C(Af)],Gn.prototype,"customBranding",2);Kr([C()],Gn.prototype,"anchoringType",2);Kr([C()],Gn.prototype,"maxTextureSize",2);Kr([C()],Gn.prototype,"planeAnchoringAlignment",2);Kr([C()],Gn.prototype,"interactive",2);Kr([C()],Gn.prototype,"allowCreateQuicklookButton",2);Kr([C()],Gn.prototype,"quickLookCompatible",2);class Sx extends Ie{constructor(){super(...arguments);d(this,"isUsed",!0);d(this,"usedBy",null)}}class HF extends Ie{}const RH=ie("debugdeletable");class MT extends el{}class VF extends Ie{constructor(){super(...arguments);d(this,"deleteBoxes",[])}awake(){this.deleteBoxes=ne.findObjectsOfType(MT,this.context)}update(){for(const t of this.deleteBoxes){const i=this.gameObject;if(t.isInBox(i)===!0){const r=ne.getComponentInParent(this.gameObject,Sx);r?RH&&console.warn("Can not delete object with usage marker",this.guid,r):(RH&&console.log("DESTROY",this.gameObject),Kb(this.gameObject,this.context.connection))}}}}var zAe=Object.defineProperty,GAe=Object.getOwnPropertyDescriptor,Pm=(s,e,t,i)=>{for(var n=i>1?void 0:i?GAe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&zAe(e,t,n),n};const HAe=ie("debugpost");class Yl extends Sr{constructor(){super(...arguments);d(this,"mode");d(this,"focusDistance",new Ze(1));d(this,"focalLength",new Ze(.2));d(this,"aperture",new Ze(20));d(this,"gaussianMaxRadius",new Ze);d(this,"resolutionScale",new Ze(1*1/window.devicePixelRatio));d(this,"bokehScale",new Ze)}get typeName(){return"DepthOfField"}init(){this.focalLength.valueProcessor=i=>{const n=i/300,r=2;return it.lerp(r,.01,n)};const t=20;this.aperture.valueProcessor=i=>{const n=1-i/32;return it.lerp(1,t,n)}}onCreateEffect(){if(this.mode===0){HAe&&console.warn("DepthOfField: Mode is set to Off");return}const t=new YQ(this.context.mainCamera,{worldFocusRange:.2,focalLength:1,bokehScale:20,resolutionScale:this.resolutionScale.value});return this.focusDistance.onValueChanged=i=>{t.cocMaterial.worldFocusDistance=i},this.focalLength.onValueChanged=i=>t.cocMaterial.worldFocusRange=i,this.aperture.onValueChanged=i=>t.bokehScale=i,this.resolutionScale&&(this.resolutionScale.onValueChanged=i=>t.resolution.scale=i),[t]}unapply(){}}Pm([C()],Yl.prototype,"mode",2);Pm([C(Ze)],Yl.prototype,"focusDistance",2);Pm([C(Ze)],Yl.prototype,"focalLength",2);Pm([C(Ze)],Yl.prototype,"aperture",2);Pm([C(Ze)],Yl.prototype,"gaussianMaxRadius",2);Pm([C(Ze)],Yl.prototype,"resolutionScale",2);Pm([C(Ze)],Yl.prototype,"bokehScale",2);dl("DepthOfField",Yl);var VAe=Object.defineProperty,QAe=Object.getOwnPropertyDescriptor,WAe=(s,e,t,i)=>{for(var n=i>1?void 0:i?QAe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&VAe(e,t,n),n};class TT extends Ie{constructor(){super(...arguments);d(this,"visibleOn")}onEnable(){this.apply()}apply(){this.test()||ne.setActive(this.gameObject,!1)}test(){return this.visibleOn<0?!0:Wc()?(this.visibleOn&2)!==0:(this.visibleOn&1)!==0}}WAe([C()],TT.prototype,"visibleOn",2);class QF{get extensionName(){return"DocumentExtension"}onAfterBuildDocument(e){}}var jAe=Object.defineProperty,qAe=Object.getOwnPropertyDescriptor,Bm=(s,e,t,i)=>{for(var n=i>1?void 0:i?qAe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&jAe(e,t,n),n};const Pc=ie("debugdrag");var WF=(s=>(s[s.XZPlane=0]="XZPlane",s[s.Attached=1]="Attached",s[s.HitNormal=2]="HitNormal",s[s.DynamicViewAngle=3]="DynamicViewAngle",s[s.SnapToSurfaces=4]="SnapToSurfaces",s[s.None=5]="None",s))(WF||{}),NC;const Th=(NC=class extends Ie{constructor(){super(...arguments);d(this,"dragMode",3);d(this,"snapGridResolution",0);d(this,"keepRotation",!0);d(this,"xrDragMode",1);d(this,"xrKeepRotation",!1);d(this,"xrDistanceDragFactor",1);d(this,"showGizmo",!1);d(this,"targetObject",null);d(this,"_dragHelper",null);d(this,"_draggingRigidbodies",[]);d(this,"_potentialDragStartEvt",null);d(this,"_dragHandlers",new Map);d(this,"_totalMovement",new S);d(this,"_marker",null);d(this,"_isDragging",!1);d(this,"_didDrag",!1)}static get HasAnySelected(){return this._active>0}setTargetObject(e){this.targetObject=e;for(const t of this._dragHandlers.values())t.setTargetObject(e)}awake(){this._potentialDragStartEvt=null,this._dragHandlers=new Map,this._totalMovement=new S,this._marker=null,this._isDragging=!1,this._didDrag=!1,this._dragHelper=null,this._draggingRigidbodies=[]}start(){this.gameObject.getComponentInParent(wa)||this.gameObject.addComponent(wa)}allowEdit(e=null){return this.context.connection.allowEditing}onPointerEnter(e){if(!this.allowEdit(this.gameObject)||e.mode!=="screen"||(e.event.mode==="tracked-pointer"||e.event.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===5)return;const n=ne.getComponentInParent(e.object,Th);!n||n!==this||(Th.lastHovered=e.object,this.context.domElement.style.cursor="pointer")}onPointerExit(e){this.allowEdit(this.gameObject)&&e.mode==="screen"&&Th.lastHovered===e.object&&(this.context.domElement.style.cursor="auto")}onPointerDown(e){if(!(!this.allowEdit(this.gameObject)||e.used||(e.mode==="tracked-pointer"||e.mode==="transient-pointer"?this.xrDragMode:this.dragMode)===5)&&(Th.lastHovered=e.object,e.button===0)){this._dragHandlers.size===0&&(this._didDrag=!1,this._totalMovement.set(0,0,0),this._potentialDragStartEvt=e),Th._active+=1;const n=new YAe(this,this.targetObject||this.gameObject);if(this._dragHandlers.set(e.event.space,n),n.onDragStart(e),this._dragHandlers.size===2){const r=this._dragHandlers.values(),o=r.next().value,a=r.next().value,l=new XAe(this,this.targetObject||this.gameObject,o,a);this._dragHandlers.set(this.gameObject,l),l.onDragStart(e)}e.use()}}onPointerMove(e){(this._isDragging||this._potentialDragStartEvt!==null)&&e.use()}onPointerUp(e){if(Pc&&_t.DrawLabel(e.point??this.gameObject.worldPosition,"POINTERUP:"+e.pointerId+", "+e.button,.03,3),!this.allowEdit(this.gameObject)||e.button!==0)return;this._potentialDragStartEvt=null;const t=this._dragHandlers.get(e.event.space),i=this._dragHandlers.get(this.gameObject);i&&(i.handlerA===t||i.handlerB===t)&&(this._dragHandlers.delete(this.gameObject),i.onDragEnd(e)),t&&(Th._active>0&&(Th._active-=1),t.onDragEnd&&t.onDragEnd(e),this._dragHandlers.delete(e.event.space),this._dragHandlers.size===0&&this.onLastDragEnd(e),e.use())}update(){for(const e of this._dragHandlers.values())e.collectMovementInfo&&e.collectMovementInfo(),e.getTotalMovement&&this._totalMovement.add(e.getTotalMovement());if(this._potentialDragStartEvt){if(!this._didDrag)if(this._totalMovement.length()>3e-4)this._didDrag=!0;else return;const e=this._potentialDragStartEvt;this._potentialDragStartEvt=null,this.onFirstDragStart(e)}for(const e of this._dragHandlers.values())e.onDragUpdate&&e.onDragUpdate(this._dragHandlers.size);this._dragHelper&&this._dragHelper.hasSelected&&this.onAnyDragUpdate()}onFirstDragStart(e){if(!e||!e.object)return;const t=ne.getComponentInParent(e.object,Th);if(!t||t!==this&&t._isDragging)return;const i=this.targetObject||this.gameObject;if(!i)return;this._isDragging=!0;const n=ne.getComponentInChildren(i,Gc);Pc&&console.log("DRAG START",n,i),n&&(n.fastMode=!0,n==null||n.requestOwnership()),this._marker=ne.addComponent(i,Sx),this._draggingRigidbodies.length=0;const r=ne.getComponentsInChildren(i,Ni);r&&this._draggingRigidbodies.push(...r)}onAnyDragUpdate(){if(!this._dragHelper)return;this._dragHelper.showGizmo=this.showGizmo,this._dragHelper.onUpdate(this.context);for(const t of this._draggingRigidbodies)t.wakeUp(),t.resetVelocities(),t.resetForcesAndTorques();const e=this.targetObject||this.gameObject;sl.markDirty(e)}onLastDragEnd(e){if(!this||!this._isDragging||(this._isDragging=!1,!this._dragHelper))return;for(const i of this._draggingRigidbodies)i.setVelocity(i.smoothedVelocity);this._draggingRigidbodies.length=0;const t=this._dragHelper.selected;if(Pc&&console.log("DRAG END",t,t==null?void 0:t.visible),this._dragHelper.setSelected(null,this.context),e!=null&&e.object){const i=ne.getComponentInChildren(e.object,Gc);i&&(i.fastMode=!1)}this._marker&&this._marker.destroy()}},d(NC,"_active",0),d(NC,"lastHovered"),NC);let Lo=Th;Bm([C()],Lo.prototype,"dragMode",2);Bm([C()],Lo.prototype,"snapGridResolution",2);Bm([C()],Lo.prototype,"keepRotation",2);Bm([C()],Lo.prototype,"xrDragMode",2);Bm([C()],Lo.prototype,"xrKeepRotation",2);Bm([C()],Lo.prototype,"xrDistanceDragFactor",2);Bm([C()],Lo.prototype,"showGizmo",2);class XAe{constructor(e,t,i,n){d(this,"handlerA");d(this,"handlerB");d(this,"context");d(this,"settings");d(this,"gameObject");d(this,"_handlerAAttachmentPoint",new S);d(this,"_handlerBAttachmentPoint",new S);d(this,"_followObject");d(this,"_manipulatorObject");d(this,"_deviceMode");d(this,"_followObjectStartWorldQuaternion",new Ce);d(this,"_manipulatorPosOffset",new S);d(this,"_manipulatorRotOffset",new Ce);d(this,"_manipulatorScaleOffset",new S);d(this,"_tempVec1",new S);d(this,"_tempVec2",new S);d(this,"_tempVec3",new S);d(this,"tempLookMatrix",new le);d(this,"_initialScale",new S);d(this,"_initialDistance",0);var o,a;this.context=e.context,this.settings=e,this.gameObject=t,this.handlerA=i,this.handlerB=n,this._followObject=new ye,this._manipulatorObject=new ye,this.context.scene.add(this._manipulatorObject);const r=(a=(o=Mt.active)==null?void 0:o.rig)==null?void 0:a.gameObject;if(!this.handlerA||!this.handlerB||!this.handlerA.hitPointInLocalSpace||!this.handlerB.hitPointInLocalSpace){console.error("Invalid: MultiTouchDragHandler needs two valid DragPointerHandlers with hitPointInLocalSpace set.");return}if(this._tempVec1.copy(this.handlerA.hitPointInLocalSpace),this._tempVec2.copy(this.handlerB.hitPointInLocalSpace),this.gameObject.localToWorld(this._tempVec1),this.gameObject.localToWorld(this._tempVec2),r&&(r.worldToLocal(this._tempVec1),r.worldToLocal(this._tempVec2)),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.02?(Pc&&console.log("Finding alternative drag attachment points since initial distance is too low: "+this._initialDistance.toFixed(2)),this.handlerA.followObject.parent.getWorldPosition(this._tempVec1),this.handlerB.followObject.parent.getWorldPosition(this._tempVec2),this._handlerAAttachmentPoint.copy(this._tempVec1),this._handlerBAttachmentPoint.copy(this._tempVec2),this.gameObject.worldToLocal(this._handlerAAttachmentPoint),this.gameObject.worldToLocal(this._handlerBAttachmentPoint),this._initialDistance=this._tempVec1.distanceTo(this._tempVec2),this._initialDistance<.001&&(console.warn("Not supported right now  controller drag points for multitouch are too close!"),this._initialDistance=1)):(this._handlerAAttachmentPoint.copy(this.handlerA.hitPointInLocalSpace),this._handlerBAttachmentPoint.copy(this.handlerB.hitPointInLocalSpace)),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._initialScale.copy(t.scale),Pc){this._followObject.add(new _a(2)),this._manipulatorObject.add(new _a(5));const l=c=>`${c.x.toFixed(2)}, ${c.y.toFixed(2)}, ${c.z.toFixed(2)}`;_t.DrawLine(this._tempVec1,this._tempVec2,65535,0,!1),_t.DrawLabel(this._tempVec3,"A:B "+this._initialDistance.toFixed(2)+`
`+l(this._tempVec1)+`
`+l(this._tempVec2),.03,5)}}onDragStart(e){this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.matrix.identity(),this._deviceMode=e.mode,this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this.alignManipulator(),this._manipulatorObject.attach(this._followObject),this._manipulatorPosOffset.copy(this._followObject.position),this._manipulatorRotOffset.copy(this._followObject.quaternion),this._manipulatorScaleOffset.copy(this._followObject.scale)}onDragEnd(e){if(!this.handlerA||!this.handlerB){console.error("onDragEnd called on MultiTouchDragHandler without valid handlers. This is likely a bug.");return}this.handlerA.recenter(),this.handlerB.recenter(),this._manipulatorObject.removeFromParent(),this._followObject.removeFromParent(),this._manipulatorObject.destroy(),this._followObject.destroy()}alignManipulator(){if(!this.handlerA||!this.handlerB){console.error("alignManipulator called on MultiTouchDragHandler without valid handlers. This is likely a bug.",this);return}if(!this.handlerA.followObject||!this.handlerB.followObject){console.error("alignManipulator called on MultiTouchDragHandler without valid follow objects. This is likely a bug.",this.handlerA,this.handlerB);return}this._tempVec1.copy(this._handlerAAttachmentPoint),this._tempVec2.copy(this._handlerBAttachmentPoint),this.handlerA.followObject.localToWorld(this._tempVec1),this.handlerB.followObject.localToWorld(this._tempVec2),this._tempVec3.lerpVectors(this._tempVec1,this._tempVec2,.5),this._manipulatorObject.position.copy(this._tempVec3);const e=this.context.mainCamera;this.tempLookMatrix.lookAt(this._tempVec3,this._tempVec2,e.worldUp),this._manipulatorObject.quaternion.setFromRotationMatrix(this.tempLookMatrix);const t=this._tempVec1.distanceTo(this._tempVec2);this._manipulatorObject.scale.copy(this._initialScale).multiplyScalar(t/this._initialDistance),this._manipulatorObject.updateMatrix(),this._manipulatorObject.updateMatrixWorld(!0),Pc&&(_t.DrawLabel(this._tempVec3.clone().add(new S(0,.2,0)),"A:B "+t.toFixed(2),.03),_t.DrawLine(this._tempVec1,this._tempVec2,65280,0,!1))}onDragUpdate(){this.alignManipulator();const e=30,t=1;this._followObject.position.copy(this._manipulatorPosOffset),this._followObject.quaternion.copy(this._manipulatorRotOffset),this._followObject.scale.copy(this._manipulatorScaleOffset);const i=this.gameObject,n=this._followObject;n.updateMatrix(),n.updateMatrixWorld(!0);const o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrKeepRotation:this.settings.keepRotation;if(this.settings.snapGridResolution>0){const u=this._followObject.worldPosition,f=this.settings.snapGridResolution;u.x=Math.round(u.x/f)*f,u.y=Math.round(u.y/f)*f,u.z=Math.round(u.z/f)*f,this._followObject.worldPosition=u,this._followObject.updateMatrix()}o&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const a=it.clamp01(this.context.time.deltaTime*e*t),l=i.worldPosition;l.lerp(n.worldPosition,a),i.worldPosition=l;const c=i.worldQuaternion;c.slerp(n.worldQuaternion,a),i.worldQuaternion=c;const h=i.worldScale;h.lerp(n.worldScale,a),i.worldScale=h}setTargetObject(e){this.gameObject=e}}class YAe{constructor(e,t){d(this,"context");d(this,"gameObject");d(this,"settings");d(this,"_lastRig");d(this,"_followObject");d(this,"_totalMovement",new S);d(this,"_totalMovementAlongRayDirection",0);d(this,"_grabStartDistance",0);d(this,"_deviceMode");d(this,"_followObjectStartPosition",new S);d(this,"_followObjectStartQuaternion",new Ce);d(this,"_followObjectStartWorldQuaternion",new Ce);d(this,"_lastDragPosRigSpace");d(this,"_tempVec",new S);d(this,"_tempMat",new le);d(this,"_hitPointInLocalSpace",new S);d(this,"_hitNormalInLocalSpace",new S);d(this,"_bottomCenter",new S);d(this,"_backCenter",new S);d(this,"_backBottomCenter",new S);d(this,"_bounds",new jt);d(this,"_dragPlane",new xs(new S(0,1,0)));d(this,"_draggedOverObject",null);d(this,"_draggedOverObjectLastSetUp",null);d(this,"_draggedOverObjectLastNormal",new S);d(this,"_draggedOverObjectDuration",0);d(this,"_hasLastSurfaceHitPoint",!1);d(this,"_lastSurfaceHitPoint",new S);this.settings=e,this.context=e.context,this.gameObject=t,this._followObject=new ye}getTotalMovement(){return this._totalMovement}get followObject(){return this._followObject}get hitPointInLocalSpace(){return this._hitPointInLocalSpace}setTargetObject(e){this.gameObject=e}recenter(){var r,o;if(!this._followObject.parent){console.warn("Error: space follow object doesn't have parent but recenter() is called. This is likely a bug");return}const e=this._followObject.parent;this.gameObject.add(this._followObject),this._followObject.matrixAutoUpdate=!1,this._followObject.position.set(0,0,0),this._followObject.quaternion.set(0,0,0,1),this._followObject.scale.set(1,1,1),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0),e.attach(this._followObject),this._followObjectStartPosition.copy(this._followObject.position),this._followObjectStartQuaternion.copy(this._followObject.quaternion),this._followObjectStartWorldQuaternion.copy(this._followObject.worldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const t=this._hitPointInLocalSpace.clone();this.gameObject.localToWorld(t),this._grabStartDistance=t.distanceTo(e.worldPosition);const i=(o=(r=Mt.active)==null?void 0:r.rig)==null?void 0:o.gameObject,n=(i==null?void 0:i.worldScale.x)||1;this._grabStartDistance/=n,this._totalMovementAlongRayDirection=0,this._lastDragPosRigSpace=void 0,Pc&&(_t.DrawLine(t,e.worldPosition,65280,.5,!1),_t.DrawLabel(e.worldPosition.add(new S(0,.1,0)),this._grabStartDistance.toFixed(2),.03,.5))}onDragStart(e){if(e.event.space.add(this._followObject),this._lastDragPosRigSpace=void 0,e.point&&e.normal)this._hitPointInLocalSpace.copy(e.point),this.gameObject.worldToLocal(this._hitPointInLocalSpace),this._hitNormalInLocalSpace.copy(e.normal);else if(e){const v=e.event.space,g=v.worldPosition;this.gameObject.worldToLocal(g),this._hitPointInLocalSpace.copy(g);const y=v.worldUp;this._tempMat.copy(this.gameObject.matrixWorld).invert(),y.transformDirection(this._tempMat),this._hitNormalInLocalSpace.copy(y)}this.recenter(),this._totalMovement.set(0,0,0),this._deviceMode=e.mode;const i=this._followObject.parent.worldForward,r=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer"?this.settings.xrDragMode:this.settings.dragMode,o=this._hitPointInLocalSpace.clone();switch(this.gameObject.localToWorld(o),r){case 0:const v=new S(0,1,0);this.gameObject.parent&&v.transformDirection(this.gameObject.parent.matrixWorld.clone().invert()),this._dragPlane.setFromNormalAndCoplanarPoint(v,o);break;case 2:const g=this._hitNormalInLocalSpace.clone();g.transformDirection(this.gameObject.matrixWorld),this._dragPlane.setFromNormalAndCoplanarPoint(g,o);break;case 1:this._dragPlane.setFromNormalAndCoplanarPoint(i,o);break;case 3:this.setPlaneViewAligned(o,!0);break;case 4:this.setPlaneViewAligned(o,!1);break}const a=this.gameObject.parent,l=this.gameObject.position.clone(),c=this.gameObject.quaternion.clone(),h=this.gameObject.scale.clone(),u=this.gameObject.matrixWorld.clone();a&&a.remove(this.gameObject),this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1),this.gameObject.scale.set(1,1,1);const f=Hl([this.gameObject]);f.expandByPoint(this.gameObject.worldPosition);const p=new S;f.getCenter(p);const m=new S;f.getSize(m),this._bottomCenter.copy(p.clone().add(new S(0,-m.y/2,0))),this._backCenter.copy(p.clone().add(new S(0,0,m.z/2))),this._backBottomCenter.copy(p.clone().add(new S(0,-m.y/2,m.z/2))),this._bounds.copy(f),a&&a.add(this.gameObject),this.gameObject.position.copy(l),this.gameObject.quaternion.copy(c),this.gameObject.scale.copy(h),this.gameObject.matrixWorld.copy(u),this._draggedOverObject=null,this._draggedOverObjectLastSetUp=null,this._draggedOverObjectLastNormal.set(0,1,0),this._draggedOverObjectDuration=0}collectMovementInfo(){var r,o;if(!this._followObject.parent)return;const e=this._followObject.parent;this._followObject.updateMatrix();const t=e.worldPosition,i=(o=(r=Mt.active)==null?void 0:r.rig)==null?void 0:o.gameObject;i&&i.worldToLocal(t),(this._lastDragPosRigSpace===void 0||i!=this._lastRig)&&(this._lastDragPosRigSpace=t.clone(),this._lastRig=i),this._tempVec.copy(t).sub(this._lastDragPosRigSpace);const n=e.worldForward;if(i&&(this._tempMat.copy(i.matrixWorld).invert(),n.transformDirection(this._tempMat)),this._totalMovementAlongRayDirection+=n.dot(this._tempVec),this._tempVec.x=Math.abs(this._tempVec.x),this._tempVec.y=Math.abs(this._tempVec.y),this._tempVec.z=Math.abs(this._tempVec.z),this._totalMovement.add(this._tempVec),this._lastDragPosRigSpace.copy(t),Pc){let a=t;i&&(a=a.clone(),a.transformDirection(i.matrixWorld)),_t.DrawRay(a,n,255)}}onDragUpdate(e){if(e>1)return;const t=this.gameObject,i=this._followObject.parent;this._followObject.updateMatrix();const n=i.worldPosition,r=i.worldForward,o=this._deviceMode==="tracked-pointer"||this._deviceMode==="transient-pointer",a=o?this.settings.xrKeepRotation:this.settings.keepRotation,l=o?this.settings.xrDragMode:this.settings.dragMode;if(l===5)return;const c=10;a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion),this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);let h=1,u=2;if(o&&this._grabStartDistance>.5){const y=1+this._totalMovementAlongRayDirection*(2*this.settings.xrDistanceDragFactor);h=Math.max(0,y),h=h*h*h}else this._grabStartDistance<=.5&&(u=3);this._followObject.position.copy(this._followObjectStartPosition),a||this._followObject.quaternion.copy(this._followObjectStartQuaternion),this._followObject.position.multiplyScalar(h),this._followObject.updateMatrix();const f=this._hasLastSurfaceHitPoint;this._hasLastSurfaceHitPoint=!1;const p=new _o(n,r);if(l==4){const y=this.context.physics.raycastFromRay(p,{testObject:A=>A!==this.followObject&&A!==i&&A!==t});if(y.length>0){const A=y[0];if(this._draggedOverObject===A.object?this._draggedOverObjectDuration+=this.context.time.deltaTime:(this._draggedOverObject=A.object,this._draggedOverObjectDuration=0),A.face){this._hasLastSurfaceHitPoint=!0,this._lastSurfaceHitPoint.copy(A.point);const _=.15,b=this._draggedOverObjectDuration>=_,x=.001,E=this._totalMovement.length()>=x;if((b||E)&&(this._draggedOverObjectLastSetUp!==this._draggedOverObject||this._draggedOverObjectLastNormal.dot(A.face.normal)<.999999||this.context.time.frame%60===0)){this._draggedOverObjectLastSetUp=this._draggedOverObject,this._draggedOverObjectLastNormal.copy(A.face.normal);const M=wt(),T=wt();this._bounds.getCenter(M),this._bounds.getSize(T),M.sub(T.multiplyScalar(.5).multiply(A.face.normal)),this._hitPointInLocalSpace.copy(M),this._hitNormalInLocalSpace.copy(A.face.normal),this._bounds.getCenter(M),this._bounds.getSize(T),M.add(T.multiplyScalar(.5).multiply(A.face.normal));const R=wt(this._hitPointInLocalSpace).add(M);this._followObject.localToWorld(R);const w=A.point;this._dragPlane.setFromNormalAndCoplanarPoint(A.face.normal,w)}else if(!(b||E))return}}else f&&this.setPlaneViewAligned(this.gameObject.worldPosition,!1)}if(l!==1&&p.intersectPlane(this._dragPlane,this._tempVec)){this._followObject.worldPosition=this._tempVec,this._followObject.updateMatrix(),this._followObject.updateMatrixWorld(!0);const y=this._hitPointInLocalSpace.clone();this._followObject.localToWorld(y),Pc&&_t.DrawLine(y,this._tempVec,65535,0,!1),this._followObject.worldPosition=this._tempVec.multiplyScalar(2).sub(y),this._followObject.updateMatrix(),this._followObject.updateMatrix()}if(this.settings.snapGridResolution>0){const y=this._followObject.worldPosition,A=this.settings.snapGridResolution;y.x=Math.round(y.x/A)*A,y.y=Math.round(y.y/A)*A,y.z=Math.round(y.z/A)*A,this._followObject.worldPosition=y,this._followObject.updateMatrix()}a&&(this._followObject.worldQuaternion=this._followObjectStartWorldQuaternion,this._followObject.updateMatrix());const m=it.clamp01(this.context.time.deltaTime*c*u),v=t.worldPosition;v.lerp(this._followObject.worldPosition,m),t.worldPosition=v;const g=t.worldQuaternion;if(g.slerp(this._followObject.worldQuaternion,m),t.worldQuaternion=g,Pc){const y=this._hitPointInLocalSpace.clone();t.localToWorld(y),_t.DrawSphere(y,.02,16711680);const A=this._hitNormalInLocalSpace.clone();A.applyQuaternion(g),_t.DrawRay(y,A,16711680),_t.DrawLabel(v.add(new S(0,.25,0)),`Distance: ${this._totalMovement.length().toFixed(2)}

                Along Ray: ${this._totalMovementAlongRayDirection.toFixed(2)}

                Session: ${!!Mt.active}

                Device: ${this._deviceMode}

                `,.03);const _=this._bottomCenter.clone(),b=this._backCenter.clone(),x=this._backBottomCenter.clone();t.localToWorld(_),t.localToWorld(b),t.localToWorld(x),_t.DrawSphere(_,.01,65280,0,!1),_t.DrawSphere(b,.01,255,0,!1),_t.DrawSphere(x,.01,16711935,0,!1),_t.DrawLine(_,x,65535,0,!1),_t.DrawLine(x,b,65535,0,!1)}}onDragEnd(e){console.assert(this._followObject.parent===e.event.space,"Drag end: _followObject is not parented to the space object"),this._followObject.removeFromParent(),this._followObject.destroy(),this._lastDragPosRigSpace=void 0}setPlaneViewAligned(e,t){if(!this._followObject.parent)return!1;const i=this._followObject.parent.worldForward,n=wt(0,1,0),r=i,o=n.angleTo(r),a=.5;return t&&(o>Math.PI/2+a||o<Math.PI/2-a)?this._dragPlane.setFromNormalAndCoplanarPoint(n,e):this._dragPlane.setFromNormalAndCoplanarPoint(i,e),!0}}const GU=class{constructor(e){d(this,"showGizmo",!0);d(this,"useViewAngle",!0);d(this,"_selected",null);d(this,"_context",null);d(this,"_camera");d(this,"_cameraPlane",new xs);d(this,"_hasGroundPlane",!1);d(this,"_groundPlane",new xs);d(this,"_groundOffset",new S);d(this,"_groundOffsetFactor",0);d(this,"_groundDistance",0);d(this,"_groundPlanePoint",new S);d(this,"_raycaster",new tf);d(this,"_cameraPlaneOffset",new S);d(this,"_intersection",new S);d(this,"_worldPosition",new S);d(this,"_inverseMatrix",new le);d(this,"_rbs",[]);d(this,"_groundLine");d(this,"_groundMarker");d(this,"_groundOffsetVector",new S(0,1,0));d(this,"_requireUpdateGroundPlane",!0);d(this,"_didDragOnGroundPlaneLastFrame",!1);this._camera=e;const t=new An(GU.geometry),i=t.material;i.color=new Ae(.4,.4,.4),t.layers.set(2),t.name="line",t.scale.y=1,this._groundLine=t;const n=new cl(.5,22,22),r=new ti({color:i.color}),o=new fe(n,r);o.visible=!1,o.layers.set(2),this._groundMarker=o}get hasSelected(){return this._selected!==null&&this._selected!==void 0}get selected(){return this._selected}setSelected(e,t){if(this._selected&&t)for(const i of this._rbs)i.wakeUp(),i.setVelocity(0,0,0);if(this._selected&&Lc.Remove(t,this._selected),this._selected=e,this._context=t,this._rbs.length=0,e?(t.scene.add(this._groundLine),t.scene.add(this._groundMarker)):(this._groundLine.removeFromParent(),this._groundMarker.removeFromParent()),this._selected){if(!t){console.error("DragHelper: no context");return}Lc.Add(t,this._selected,null),this._groundOffsetFactor=0,this._hasGroundPlane=!0,this._groundOffset.set(0,0,0),this._requireUpdateGroundPlane=!0,this.onUpdateScreenSpacePlane()}}onUpdate(e){this._selected}onUpdateWorldPosition(e,t,i){if(this._selected){if(i){const n=Ft(this._selected);n.y=e.y,e=n}if(Es(this._selected,e),Es(this._groundLine,e),this._hasGroundPlane?this._groundLine.scale.y=this._groundDistance:this._groundLine.scale.y=1e3,this._groundLine.visible=this.showGizmo,this._groundMarker.visible=t!==null&&this.showGizmo,t){const n=Ft(this._camera).distanceTo(t)*.01;this._groundMarker.scale.set(n,n,n),Es(this._groundMarker,t)}}}onUpdateScreenSpacePlane(){if(!this._selected||!this._context)return;const e=this._context.input.getPointerPositionRC(0);e&&(this._raycaster.setFromCamera(e,this._camera),this._cameraPlane.setFromNormalAndCoplanarPoint(this._camera.getWorldDirection(this._cameraPlane.normal),this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld)),this._raycaster.ray.intersectPlane(this._cameraPlane,this._intersection)&&this._selected.parent&&(this._inverseMatrix.copy(this._selected.parent.matrixWorld).invert(),this._cameraPlaneOffset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._selected.matrixWorld))))}onUpdateGroundPlane(){if(!this._selected||!this._context)return;const e=Ft(this._selected),t=new _o(wt(0,.1,0).add(e),wt(0,-1,0)),i=new zc;i.testObject=r=>r!==this._selected;const n=this._context.physics.raycastFromRay(t,i);for(let r=0;r<n.length;r++){const o=n[r];if(!o.face||this.contains(this._selected,o.object))continue;const a=wt(0,1,0);this._groundPlane.setFromNormalAndCoplanarPoint(a,o.point);break}this._hasGroundPlane=!0,this._groundPlane.setFromNormalAndCoplanarPoint(t.direction.multiplyScalar(-1),t.origin),this._raycaster.ray.intersectPlane(this._groundPlane,this._intersection),this._groundDistance=this._intersection.distanceTo(e),this._groundOffset.copy(this._intersection).sub(e)}contains(e,t){if(e===t)return!0;if(e.children){for(const i of e.children)if(this.contains(i,t))return!0}return!1}};let GP=GU;d(GP,"geometry",new yt().setFromPoints([new S(0,0,0),new S(0,-1,0)]));var aq=(s=>(s.File_Spawned="file-spawned",s))(aq||{});class lq{constructor(e,t,i,n,r,o,a,l){d(this,"guid");d(this,"file_name");d(this,"file_hash");d(this,"file_size");d(this,"position");d(this,"seed");d(this,"sender");d(this,"serverUrl");d(this,"parentGuid");d(this,"boundsSize");this.seed=t,this.guid=i,this.file_name=n,this.file_hash=r,this.file_size=o,this.position=a,this.sender=e,this.serverUrl=l}}async function cq(s,e,t){const i=s.name;return i.endsWith(".gltf")||i.endsWith(".glb")||s.type==="model/gltf+json"||s.type==="model/gltf-binary"?new Promise((n,r)=>{const o=new FileReader;o.readAsArrayBuffer(s),o.onloadend=async a=>{const l=o.result,c=XM(),h=new Ms(c),u=await Gl().parseSync(e,l,s.name,h);if(u&&u.scene){const f=u.scene;if(!f.guid){const p=new Ms(c);f.guid=p.generateUUID()}t&&KAe(e.connection,s,c,f,t),n(u)}}}):(console.warn("Unsupported file type: "+i,s),null)}async function hq(s,e){return new Promise(async(t,i)=>{const n=XM(),r=new Ms(n),o=s.toString(),a=await Gl().loadSync(e,o,o,r);a&&a.scene?(a.scene,t(a)):console.warn("Unsupported file type: "+s.toString())})}mi.registerCallback(Ti.ContextCreated,s=>{uq(s.context)});function uq(s){s.connection.beginListen("file-spawned",async e=>{if(e.sender!==s.connection.connectionId){console.log("received file event",e),JAe(e,s);let t=null;try{t=await Jk(e.file_name,e.file_hash,e.file_size,e.serverUrl)}finally{ZAe(e)}if(t){const i=new Ms(e.seed),n=await Gl().parseSync(s,t,e.file_name,i);if(n&&n.scene){const r=n.scene;if(e.parentGuid){const o=tx(e.parentGuid,s.scene);o&&"add"in o&&o.add(r)}r.parent||s.scene.add(r),e.position!==null&&r.position.copy(e.position)}}else console.error("download didnt return file")}})}async function KAe(s,e,t,i,n){if(!s.connectionId){console.error("Can not upload file - no connection id");return}if(!i.guid){console.error("Can not upload file - no guid",i,i.guid);return}const r=await B9(e,n);if(!r)return;if(!r.filename){console.error("Can not send upload event - no filename",e.name);return}if(!r.hash){console.error("Can not send upload event - no hash",e.name);return}const o=new lq(s.connectionId,t,i.guid,r.filename,r.hash,e.size,i.position,r.url??n);i.parent&&(o.parentGuid=i.parent.guid),s.send("file-spawned",o)}const KD={};function JAe(s,e){const t=new Ki,i=new fe(t,new ti({color:65280})),n=new _L(i,5592405);if(KD[s.guid]=n,e.scene.add(n),s.parentGuid){const r=tx(s.parentGuid,e.scene);r&&r.add(n)}s.position&&n.position.copy(s.position)}function ZAe(s,e){const t=s.guid,i=KD[t];i&&(delete KD[t],i.removeFromParent())}var $Ae=Object.defineProperty,e_e=Object.getOwnPropertyDescriptor,Cx=(s,e,t,i)=>{for(var n=i>1?void 0:i?e_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&$Ae(e,t,n),n};const Yu=ie("debugdroplistener");class _f extends Ie{constructor(){super(...arguments);d(this,"dropArea");d(this,"fitIntoVolume",!1);d(this,"fitVolumeSize",new S(1,1,1));d(this,"placeAtHitPosition",!0);d(this,"onDropped",new Sn);d(this,"onNetworkEvent",t=>{var i;if((i=t.guid)!=null&&i.startsWith(this.guid)){const n=t.url;if(n)if(Array.isArray(n))for(const r of n)this.addFromUrl(r,{screenposition:new ee},!0).then(o=>{o==null||o.position.set(t.point.x,t.point.y,t.point.z)});else this.addFromUrl(n,{screenposition:new ee},!0).then(r=>{r==null||r.position.set(t.point.x,t.point.y,t.point.z)})}});d(this,"handlePaste",async t=>{if(this.context.connection.allowEditing===!1)return;if((t.ctrlKey||t.metaKey)&&t.key==="v"){const r=await navigator.clipboard.readText().catch(console.warn);if(r&&(r.startsWith("http")||r.startsWith("https")||r.startsWith("blob"))){const a={screenposition:new ee(this.context.input.mousePosition.x,this.context.input.mousePosition.y)};this.testIfIsInDropArea(a)&&this.addFromUrl(r,a,!1)}}});d(this,"onDrag",t=>{this.context.connection.allowEditing!==!1&&t.preventDefault()});d(this,"onDrop",async t=>{if(this.context.connection.allowEditing===!1||(Yu&&console.log(t),!(t!=null&&t.dataTransfer))||t["droplistener:handled"])return;t.preventDefault();const i={screenposition:new ee(t.offsetX,t.offsetY)};if(this.dropArea&&this.testIfIsInDropArea(i)===!1)return;t["droplistener:handled"]=!0;const n=t.dataTransfer.items;if(n)for(const r in n){const o=n[r];if(o.kind==="file"){const a=o.getAsFile();if(!a)continue;await this.addFiles([a],i)}else o.kind==="string"&&o.type=="text/plain"&&o.getAsString(a=>{this.addFromUrl(a,i,!1)})}});d(this,"_addedObjects",new Array)}onEnable(){this.context.renderer.domElement.addEventListener("dragover",this.onDrag),this.context.renderer.domElement.addEventListener("drop",this.onDrop),window.addEventListener("keyup",this.handlePaste),this.context.connection.beginListen("droplistener",this.onNetworkEvent)}onDisable(){this.context.renderer.domElement.removeEventListener("dragover",this.onDrag),this.context.renderer.domElement.removeEventListener("drop",this.onDrop),window.removeEventListener("keyup",this.handlePaste),this.context.connection.stopListen("droplistener",this.onNetworkEvent)}async addFromUrl(t,i,n){Yu&&console.log("dropped url",t);try{if(t.startsWith("https://github.com/")){const a=t.split("/"),l=a[3],c=a[4],h=a[6],u=a.slice(7).join("/");t=`https://raw.githubusercontent.com/${l}/${c}/${h}/${u}`}else t.startsWith("https://polyhaven.com/a")&&(t=t_e(t));if(!t)return null;const r=t.toLowerCase();if(r.endsWith(".hdr")||r.endsWith(".hdri")||r.endsWith(".exr")||r.endsWith(".png")||r.endsWith(".jpg")||r.endsWith(".jpeg"))return null;const o=await hq(new URL(t),this.context);if(o)return i.url=t,this.addObject(o,i,n)}catch{console.warn("String is not a valid URL",t)}return null}async addFiles(t,i){if(Yu&&console.log("Add files",t),!!Array.isArray(t)&&t.length)for(const n of t){if(!n)continue;Yu&&console.log("Register file "+n.name,n);const r=await cq(n,this.context);this.dispatchEvent(new CustomEvent("file-dropped",{detail:n})),r&&this.addObject(r,i,!1)}}addObject(t,i,n){var a,l;if(Yu&&console.log(`Dropped ${this.gameObject.name}`,t),!(t!=null&&t.scene))return console.warn("No object specified to add to scene",t),null;for(const c of this._addedObjects)c.parent===this.gameObject&&xa(c,!0,!0);this._addedObjects.length=0;const r=t.scene;this.gameObject.attach(r),r.position.set(0,0,0),r.quaternion.identity(),this._addedObjects.push(r),Yu&&r.add(new _a(1));const o=new jt().setFromCenterAndSize(new S(0,this.fitVolumeSize.y*.5,0).add(this.gameObject.worldPosition),this.fitVolumeSize);if(Yu&&_t.DrawWireBox3(o,255,5),this.fitIntoVolume&&BQ(r,o,{position:!this.placeAtHitPosition}),this.placeAtHitPosition&&i&&i.screenposition){r.visible=!1;const c=this.context.physics.raycast({screenPoint:this.context.input.convertScreenspaceToRaycastSpace(i.screenposition.clone())});if(r.visible=!0,c&&c.length>0)for(const h of c){const u=h.point.clone();Yu&&console.log("Place object at hit",h),DQ(r,u);break}}if(uv.assignAnimationsFromFile(t,{createAnimationComponent:c=>va(c,Wr)}),this.dispatchEvent(new CustomEvent("object-added",{detail:t})),(a=this.onDropped)==null||a.invoke({sender:this,gltf:t}),!n&&((l=i.url)!=null&&l.startsWith("http"))&&this.context.connection.isConnected&&r){const c={guid:this.guid,url:i.url,point:r.position.clone()};this.context.connection.send("droplistener",c)}return r}testIfIsInDropArea(t){if(this.dropArea){const i=this.context.input.convertScreenspaceToRaycastSpace(t.screenposition.clone());if(!this.context.physics.raycast({targets:[this.dropArea],screenPoint:i,recursive:!0,testObject:r=>!this._addedObjects.includes(r)}).length)return nt()&&console.log(`Dropped outside of drop area for DropListener "${this.name}".`),!1}return!0}}Cx([C(ye)],_f.prototype,"dropArea",2);Cx([C()],_f.prototype,"fitIntoVolume",2);Cx([C(S)],_f.prototype,"fitVolumeSize",2);Cx([C()],_f.prototype,"placeAtHitPosition",2);Cx([C(Sn)],_f.prototype,"onDropped",2);function t_e(s){if(!s.startsWith("https://polyhaven.com/"))return s;const e="https://dl.polyhaven.org/file/ph-assets/Models/gltf/4k/",n=new URL(s).pathname.split("/").pop(),r=`${e}${n}/${n}_4k.gltf`;return console.log("Resolved polyhaven asset url",s,"",r),r}var i_e=Object.defineProperty,n_e=Object.getOwnPropertyDescriptor,IT=(s,e,t,i)=>{for(var n=i>1?void 0:i?n_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&i_e(e,t,n),n};const dq=class extends Ie{constructor(){super(...arguments);d(this,"parent",null);d(this,"object",null);d(this,"limitCount",10);d(this,"limitInterval",60);d(this,"_currentCount",0);d(this,"_startPosition",null);d(this,"_startQuaternion",null);d(this,"_forwardPointerEvents",new Map)}start(){var e,t;if(this._currentCount=0,this._startPosition=null,this._startQuaternion=null,this.object||(this.object=this.gameObject),this.object){if(this.object===this.gameObject){const n=new Ms(this.guid);this.object=ne.instantiate(this.object,{idProvider:n,keepWorldPosition:!1});const r=ne.getComponent(this.object,dq);r==null||r.destroy();let o=this.object.getComponentInChildren(Lo);o||(o=this.object.addComponent(Lo,{dragMode:WF.SnapToSurfaces}),o.guid=n.generateUUID());let a=ne.getComponent(o.gameObject,Gc);a||(a=o.gameObject.addComponent(Gc),a.guid=n.generateUUID())}this.object.visible=!1;const i=this.gameObject.getComponent(Lo);i&&(i.enabled=!1),this._startPosition=((e=this.object.position)==null?void 0:e.clone())??new S(0,0,0),this._startQuaternion=((t=this.object.quaternion)==null?void 0:t.clone())??new Ce(0,0,0,1)}this.gameObject.getComponentInParent(wa)||this.gameObject.addComponent(wa),this.cloneLimitIntervalFn()}onPointerEnter(e){e.used||this.object&&this.context.connection.allowEditing&&e.button===0&&this.context.input.setCursorPointer()}onPointerExit(e){e.used||this.object&&this.context.connection.allowEditing&&e.button===0&&this.context.input.setCursorNormal()}onPointerDown(e){if(e.used||!this.object||!this.context.connection.allowEditing||e.button!==0)return;const t=this.handleDuplication();if(t){const i=ne.getComponent(t,Lo);i?(i.onPointerDown(e),this._forwardPointerEvents.set(e.event.space,i)):console.warn("Duplicated object does not have DragControls")}}onPointerUp(e){if(e.used)return;const t=this._forwardPointerEvents.get(e.event.space);t&&(t.onPointerUp(e),this._forwardPointerEvents.delete(e.event.space))}cloneLimitIntervalFn(){this.destroyed||(this._currentCount>0&&(this._currentCount-=1),setTimeout(()=>{this.cloneLimitIntervalFn()},this.limitInterval/this.limitCount*1e3))}handleDuplication(){var i;if(!this.object||this._currentCount>=this.limitCount||this.object===this.gameObject)return null;this.object.visible=!0,this._startPosition&&this.object.position.copy(this._startPosition),this._startQuaternion&&this.object.quaternion.copy(this._startQuaternion);const e=new Xl;this.parent||(this.parent=this.gameObject.parent),this.parent&&(e.parent=this.parent.guid??((i=this.parent.userData)==null?void 0:i.guid),e.keepWorldPosition=!0),e.position=this.worldPosition,e.rotation=this.worldQuaternion,e.context=this.context,this._currentCount+=1;const t=ne.instantiateSynced(this.object,e);return console.assert(t!==this.object,"Duplicated object is original"),this.object.visible=!1,this._startPosition&&this.object.position.clone().copy(this._startPosition),this._startQuaternion&&this.object.quaternion.clone().copy(this._startQuaternion),t}};let Dm=dq;IT([C(ye)],Dm.prototype,"parent",2);IT([C(ye)],Dm.prototype,"object",2);IT([C()],Dm.prototype,"limitCount",2);IT([C()],Dm.prototype,"limitInterval",2);class lb extends Sr{constructor(t){super();d(this,"effect");this.effect=t}get typeName(){return this.effect.constructor.name}onCreateEffect(){return this.effect}}var hy=(s=>(s[s.PointerEnter=0]="PointerEnter",s[s.PointerExit=1]="PointerExit",s[s.PointerDown=2]="PointerDown",s[s.PointerUp=3]="PointerUp",s[s.PointerClick=4]="PointerClick",s[s.Drag=5]="Drag",s[s.Drop=6]="Drop",s[s.Scroll=7]="Scroll",s[s.UpdateSelected=8]="UpdateSelected",s[s.Select=9]="Select",s[s.Deselect=10]="Deselect",s[s.Move=11]="Move",s[s.InitializePotentialDrag=12]="InitializePotentialDrag",s[s.BeginDrag=13]="BeginDrag",s[s.EndDrag=14]="EndDrag",s[s.Submit=15]="Submit",s[s.Cancel=16]="Cancel",s))(hy||{}),s_e=Object.defineProperty,r_e=Object.getOwnPropertyDescriptor,jF=(s,e,t,i)=>{for(var n=i>1?void 0:i?r_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&s_e(e,t,n),n};class qF{constructor(){d(this,"eventID");d(this,"callback",new Sn)}}jF([C()],qF.prototype,"eventID",2);jF([C(Sn)],qF.prototype,"callback",2);class RT extends Ie{constructor(){super(...arguments);d(this,"triggers",[])}invoke(t){if(this.triggers)for(const i of this.triggers)i.eventID===t&&i.callback.invoke()}onPointerClick(t){this.invoke(hy.PointerClick)}onPointerEnter(t){this.invoke(hy.PointerEnter)}onPointerExit(t){this.invoke(hy.PointerExit)}onPointerDown(t){this.invoke(hy.PointerDown)}onPointerUp(t){this.invoke(hy.PointerUp)}}jF([C(qF)],RT.prototype,"triggers",2);var o_e=Object.defineProperty,a_e=Object.getOwnPropertyDescriptor,XF=(s,e,t,i)=>{for(var n=i>1?void 0:i?a_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&o_e(e,t,n),n};class YF extends Ie{constructor(){super(...arguments);d(this,"connectedBody");d(this,"_rigidBody",null)}get rigidBody(){return this._rigidBody}onEnable(){this._rigidBody||(this._rigidBody=this.gameObject.getComponent(Ni)),this.rigidBody&&this.connectedBody&&this.startCoroutine(this.create())}*create(){yield,this.rigidBody&&this.connectedBody&&this.activeAndEnabled&&this.createJoint(this.rigidBody,this.connectedBody)}}XF([C(Ni)],YF.prototype,"connectedBody",2);class KF extends YF{createJoint(e,t){var i;(i=this.context.physics.engine)==null||i.addFixedJoint(e,t)}}class Ex extends YF{constructor(){super(...arguments);d(this,"anchor");d(this,"axis")}createJoint(t,i){var n;this.axis&&this.anchor&&((n=this.context.physics.engine)==null||n.addHingeJoint(t,i,this.anchor,this.axis))}}XF([C(S)],Ex.prototype,"anchor",2);XF([C(S)],Ex.prototype,"axis",2);const l_e={type:"change"};let c_e=class extends js{constructor(e,t){super(),this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const i=this,n=1e-6,r=new Ce,o=new S;this.tmpQuaternion=new Ce,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new S(0,0,0),this.rotationVector=new S(0,0,0),this.keydown=function(m){if(!(m.altKey||this.enabled===!1)){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(m){if(this.enabled!==!1){switch(m.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}},this.pointerdown=function(m){if(this.enabled!==!1)if(this.dragToLook)this.status++;else{switch(m.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(m){if(this.enabled!==!1&&(!this.dragToLook||this.status>0)){const v=this.getContainerDimensions(),g=v.size[0]/2,y=v.size[1]/2;this.moveState.yawLeft=-(m.pageX-v.offset[0]-g)/g,this.moveState.pitchDown=(m.pageY-v.offset[1]-y)/y,this.updateRotationVector()}},this.pointerup=function(m){if(this.enabled!==!1){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(m.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}},this.pointercancel=function(){this.enabled!==!1&&(this.dragToLook?(this.status=0,this.moveState.yawLeft=this.moveState.pitchDown=0):(this.moveState.forward=0,this.moveState.back=0,this.updateMovementVector()),this.updateRotationVector())},this.contextMenu=function(m){this.enabled!==!1&&m.preventDefault()},this.update=function(m){if(this.enabled===!1)return;const v=m*i.movementSpeed,g=m*i.rollSpeed;i.object.translateX(i.moveVector.x*v),i.object.translateY(i.moveVector.y*v),i.object.translateZ(i.moveVector.z*v),i.tmpQuaternion.set(i.rotationVector.x*g,i.rotationVector.y*g,i.rotationVector.z*g,1).normalize(),i.object.quaternion.multiply(i.tmpQuaternion),(o.distanceToSquared(i.object.position)>n||8*(1-r.dot(i.object.quaternion))>n)&&(i.dispatchEvent(l_e),r.copy(i.object.quaternion),o.copy(i.object.position))},this.updateMovementVector=function(){const m=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-m+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",a),this.domElement.removeEventListener("pointerdown",c),this.domElement.removeEventListener("pointermove",l),this.domElement.removeEventListener("pointerup",h),this.domElement.removeEventListener("pointercancel",u),window.removeEventListener("keydown",f),window.removeEventListener("keyup",p)};const a=this.contextMenu.bind(this),l=this.pointermove.bind(this),c=this.pointerdown.bind(this),h=this.pointerup.bind(this),u=this.pointercancel.bind(this),f=this.keydown.bind(this),p=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",a),this.domElement.addEventListener("pointerdown",c),this.domElement.addEventListener("pointermove",l),this.domElement.addEventListener("pointerup",h),this.domElement.addEventListener("pointercancel",u),window.addEventListener("keydown",f),window.addEventListener("keyup",p),this.updateMovementVector(),this.updateRotationVector()}};class JF extends Ie{constructor(){super(...arguments);d(this,"_controls",null)}onEnable(){var i;const t=(i=ne.getComponent(this.gameObject,Hi))==null?void 0:i.cam;if(!t){console.warn("FlyControls: Requires a Camera component on the same object as this component.");return}this._controls=new c_e(t,this.context.renderer.domElement),this._controls.rollSpeed=.5,this._controls.movementSpeed=3,this._controls.dragToLook=!0}onDisable(){var t;(t=this._controls)==null||t.dispose(),this._controls=null}update(){this._controls&&this._controls.update(this.context.time.deltaTime)}}var h_e=Object.defineProperty,u_e=Object.getOwnPropertyDescriptor,ZF=(s,e,t,i)=>{for(var n=i>1?void 0:i?u_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&h_e(e,t,n),n};class Jv extends Ie{constructor(){super(...arguments);d(this,"_fog")}get fog(){return this._fog||(this._fog=new tM(0,0,50)),this._fog}get mode(){return 1}set near(t){this.fog.near=t}get near(){return this.fog.near}set far(t){this.fog.far=t}get far(){return this.fog.far}set color(t){this.fog.color.copy(t)}get color(){return this.fog.color}onEnable(){this.scene.fog=this.fog}onDisable(){this.scene.fog===this._fog&&(this.scene.fog=null)}}ZF([C()],Jv.prototype,"near",1);ZF([C()],Jv.prototype,"far",1);ZF([C(Ae)],Jv.prototype,"color",1);let K0,HP,Og,$S;function VP(s,e=1/0,t=null){HP||(HP=new ps(2,2,1,1)),Og||(Og=new kt({uniforms:{blitTexture:new Se(s)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),Og.uniforms.blitTexture.value=s,Og.defines.IS_SRGB=s.colorSpace==bt,Og.needsUpdate=!0,$S||($S=new fe(HP,Og),$S.frustrumCulled=!1);const i=new Vt,n=new Ws;n.add($S),t===null&&(t=K0=new hu({antialias:!1}));const r=Math.min(s.image.width,e),o=Math.min(s.image.height,e);t.setSize(r,o),t.clear(),t.render(n,i);const a=document.createElement("canvas"),l=a.getContext("2d");a.width=r,a.height=o,l.drawImage(t.domElement,0,0,r,o);const c=new tL(a);return c.minFilter=s.minFilter,c.magFilter=s.magFilter,c.wrapS=s.wrapS,c.wrapT=s.wrapT,c.name=s.name,K0&&(K0.forceContextLoss(),K0.dispose(),K0=null),c}const PH={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class PT{constructor(){this.pluginCallbacks=[],this.register(function(e){return new b_e(e)}),this.register(function(e){return new x_e(e)}),this.register(function(e){return new C_e(e)}),this.register(function(e){return new E_e(e)}),this.register(function(e){return new M_e(e)}),this.register(function(e){return new T_e(e)}),this.register(function(e){return new w_e(e)}),this.register(function(e){return new S_e(e)}),this.register(function(e){return new I_e(e)}),this.register(function(e){return new R_e(e)}),this.register(function(e){return new P_e(e)}),this.register(function(e){return new B_e(e)}),this.register(function(e){return new D_e(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){const r=new __e,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(e,t,n).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(n,r){i.parse(e,n,r,t)})}}const di={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},QP="KHR_mesh_quantization",ua={};ua[Ot]=di.NEAREST;ua[Yy]=di.NEAREST_MIPMAP_NEAREST;ua[Nh]=di.NEAREST_MIPMAP_LINEAR;ua[Nt]=di.LINEAR;ua[Rp]=di.LINEAR_MIPMAP_NEAREST;ua[Do]=di.LINEAR_MIPMAP_LINEAR;ua[as]=di.CLAMP_TO_EDGE;ua[Uo]=di.REPEAT;ua[Zp]=di.MIRRORED_REPEAT;const BH={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},d_e=new Ae,DH=12,f_e=1179937895,p_e=2,OH=8,m_e=1313821514,g_e=5130562;function FA(s,e){return s.length===e.length&&s.every(function(t,i){return t===e[i]})}function y_e(s){return new TextEncoder().encode(s).buffer}function v_e(s){return FA(s.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function A_e(s,e,t){const i={min:new Array(s.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(s.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=e;n<e+t;n++)for(let r=0;r<s.itemSize;r++){let o;s.itemSize>4?o=s.array[n*s.itemSize+r]:(r===0?o=s.getX(n):r===1?o=s.getY(n):r===2?o=s.getZ(n):r===3&&(o=s.getW(n)),s.normalized===!0&&(o=gi.normalize(o,s.array))),i.min[r]=Math.min(i.min[r],o),i.max[r]=Math.max(i.max[r],o)}return i}function fq(s){return Math.ceil(s/4)*4}function WP(s,e=0){const t=fq(s.byteLength);if(t!==s.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(s)),e!==0)for(let n=s.byteLength;n<t;n++)i[n]=e;return i.buffer}return s}function LH(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function kH(s,e){if(s.toBlob!==void 0)return new Promise(i=>s.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),s.convertToBlob({type:e,quality:t})}class __e{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const n=this,r=n.buffers,o=n.json;i=n.options;const a=n.extensionsUsed,l=n.extensionsRequired,c=new Blob(r,{type:"application/octet-stream"}),h=Object.keys(a),u=Object.keys(l);if(h.length>0&&(o.extensionsUsed=h),u.length>0&&(o.extensionsRequired=u),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=c.size),i.binary===!0){const f=new FileReader;f.readAsArrayBuffer(c),f.onloadend=function(){const p=WP(f.result),m=new DataView(new ArrayBuffer(OH));m.setUint32(0,p.byteLength,!0),m.setUint32(4,g_e,!0);const v=WP(y_e(JSON.stringify(o)),32),g=new DataView(new ArrayBuffer(OH));g.setUint32(0,v.byteLength,!0),g.setUint32(4,m_e,!0);const y=new ArrayBuffer(DH),A=new DataView(y);A.setUint32(0,f_e,!0),A.setUint32(4,p_e,!0);const _=DH+g.byteLength+v.byteLength+m.byteLength+p.byteLength;A.setUint32(8,_,!0);const b=new Blob([y,g,v,m,p],{type:"application/octet-stream"}),x=new FileReader;x.readAsArrayBuffer(b),x.onloadend=function(){t(x.result)}}}else if(o.buffers&&o.buffers.length>0){const f=new FileReader;f.readAsDataURL(c),f.onloadend=function(){const p=f.result;o.buffers[0].uri=p,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,n=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],n[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new S;for(let n=0,r=e.count;n<r;n++)if(Math.abs(i.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),n=new S;for(let r=0,o=i.count;r<o;r++)n.fromBufferAttribute(i,r),n.x===0&&n.y===0&&n.z===0?n.setX(1):n.normalize(),i.setXYZ(r,n.x,n.y,n.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const n={};(t.offset.x!==0||t.offset.y!==0)&&(n.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(n.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(n.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(p){return p.colorSpace===bt?function(v){return v<.04045?v*.0773993808:Math.pow(v*.9478672986+.0521327014,2.4)}:function(v){return v}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Md&&(e=VP(e)),t instanceof Md&&(t=VP(t));const n=e?e.image:null,r=t?t.image:null,o=Math.max(n?n.width:0,r?r.width:0),a=Math.max(n?n.height:0,r?r.height:0),l=LH();l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const h=c.getImageData(0,0,o,a);if(n){c.drawImage(n,0,0,o,a);const p=i(e),m=c.getImageData(0,0,o,a).data;for(let v=2;v<m.length;v+=4)h.data[v]=p(m[v]/256)*256}if(r){c.drawImage(r,0,0,o,a);const p=i(t),m=c.getImageData(0,0,o,a).data;for(let v=1;v<m.length;v+=4)h.data[v]=p(m[v]/256)*256}c.putImageData(h,0,0);const f=(e||t).clone();return f.source=new jh(l),f.colorSpace=Bo,f.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),f}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,n,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;switch(t){case di.BYTE:case di.UNSIGNED_BYTE:a=1;break;case di.SHORT:case di.UNSIGNED_SHORT:a=2;break;default:a=4}const l=fq(n*e.itemSize*a),c=new DataView(new ArrayBuffer(l));let h=0;for(let p=i;p<i+n;p++)for(let m=0;m<e.itemSize;m++){let v;e.itemSize>4?v=e.array[p*e.itemSize+m]:(m===0?v=e.getX(p):m===1?v=e.getY(p):m===2?v=e.getZ(p):m===3&&(v=e.getW(p)),e.normalized===!0&&(v=gi.normalize(v,e.array))),t===di.FLOAT?c.setFloat32(h,v,!0):t===di.INT?c.setInt32(h,v,!0):t===di.UNSIGNED_INT?c.setUint32(h,v,!0):t===di.SHORT?c.setInt16(h,v,!0):t===di.UNSIGNED_SHORT?c.setUint16(h,v,!0):t===di.BYTE?c.setInt8(h,v):t===di.UNSIGNED_BYTE&&c.setUint8(h,v),h+=a}const u={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return r!==void 0&&(u.target=r),r===di.ARRAY_BUFFER&&(u.byteStride=e.itemSize*a),this.byteOffset+=l,o.bufferViews.push(u),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(n){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=WP(r.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,n(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,n){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=di.FLOAT;else if(e.array.constructor===Int32Array)a=di.INT;else if(e.array.constructor===Uint32Array)a=di.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=di.SHORT;else if(e.array.constructor===Uint16Array)a=di.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=di.BYTE;else if(e.array.constructor===Uint8Array)a=di.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(i===void 0&&(i=0),(n===void 0||n===1/0)&&(n=e.count),n===0)return null;const l=A_e(e,i,n);let c;t!==void 0&&(c=e===t.index?di.ELEMENT_ARRAY_BUFFER:di.ARRAY_BUFFER);const h=this.processBufferView(e,a,i,n,c),u={bufferView:h.id,byteOffset:h.byteOffset,componentType:a,count:n,max:l.max,min:l.min,type:o[e.itemSize]};return e.normalized===!0&&(u.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(u)-1}processImage(e,t,i,n="image/png"){if(e!==null){const r=this,o=r.cache,a=r.json,l=r.options,c=r.pending;o.images.has(e)||o.images.set(e,{});const h=o.images.get(e),u=n+":flipY/"+i.toString();if(h[u]!==void 0)return h[u];a.images||(a.images=[]);const f={mimeType:n},p=LH();p.width=Math.min(e.width,l.maxTextureSize),p.height=Math.min(e.height,l.maxTextureSize);const m=p.getContext("2d");if(i===!0&&(m.translate(0,p.height),m.scale(1,-1)),e.data!==void 0){t!==Li&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const g=new Uint8ClampedArray(e.height*e.width*4);for(let y=0;y<g.length;y+=4)g[y+0]=e.data[y+0],g[y+1]=e.data[y+1],g[y+2]=e.data[y+2],g[y+3]=e.data[y+3];m.putImageData(new ImageData(g,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)m.drawImage(e,0,0,p.width,p.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");l.binary===!0?c.push(kH(p,n).then(g=>r.processBufferViewImage(g)).then(g=>{f.bufferView=g})):p.toDataURL!==void 0?f.uri=p.toDataURL(n):c.push(kH(p,n).then(g=>new FileReader().readAsDataURL(g)).then(g=>{f.uri=g}));const v=a.images.push(f)-1;return h[u]=v,v}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:ua[e.magFilter],minFilter:ua[e.minFilter],wrapS:ua[e.wrapS],wrapT:ua[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const i=this.options,n=this.cache,r=this.json;if(n.textures.has(e))return n.textures.get(e);const o={keep:!0,newTexture:null};if(this._invokeAll(function(h){h.beforeWriteTexture&&h.beforeWriteTexture(e,o)}),o.keep===!1)return null;o.newTexture!=null&&(e=o.newTexture),r.textures||(r.textures=[]),e instanceof Md&&(e=VP(e,i.maxTextureSize));let a=e.userData.mimeType;a==="image/webp"&&(a="image/png");const l={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(l.name=e.name),this._invokeAll(function(h){h.writeTexture&&h.writeTexture(e,l)});const c=r.textures.push(l)-1;return n.textures.set(e,c),c}processMaterial(e){var c,h,u,f,p;const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const n={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);FA(r,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5);const o=(c=e.metalnessMap)!=null&&c.image?e.metalnessMap:void 0,a=(h=e.roughnessMap)!=null&&h.image?e.roughnessMap:void 0;if(o||a){const m=this.buildMetalRoughTexture(o,a),v={index:this.processTexture(m),channel:m.channel};this.applyTextureTransform(v,m),n.pbrMetallicRoughness.metallicRoughnessTexture=v}if(e.map){const m={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(m,e.map),n.pbrMetallicRoughness.baseColorTexture=m}if(e.emissive){const m=e.emissive;if(Math.max(m.r,m.g,m.b)>0&&(n.emissiveFactor=e.emissive.toArray()),(u=e.emissiveMap)!=null&&u.image){const g={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(g,e.emissiveMap),n.emissiveTexture=g}}if((f=e.normalMap)!=null&&f.image){const m={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(m.scale=e.normalScale.x),this.applyTextureTransform(m,e.normalMap),n.normalTexture=m}if((p=e.aoMap)!=null&&p.image){const m={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(m.strength=e.aoMapIntensity),this.applyTextureTransform(m,e.aoMap),n.occlusionTexture=m}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===_i&&(n.doubleSided=!0),e.name!==""&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll(function(m){m.writeMaterial&&m.writeMaterial(e,n)});const l=i.materials.push(n)-1;return t.materials.set(e,l),l}processMesh(e){const t={keep:!0};if(this._invokeAll(function(x){x.beforeWriteMesh&&x.beforeWriteMesh(e,t)}),t.keep!=!0)return null;const i=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let x=0,E=e.material.length;x<E;x++)r.push(e.material[x].uuid);else r.push(e.material.uuid);const o=r.join(":");if(i.meshes.has(o))return i.meshes.get(o);const a=e.geometry;let l;e.isLineSegments?l=di.LINES:e.isLineLoop?l=di.LINE_LOOP:e.isLine?l=di.LINE_STRIP:e.isPoints?l=di.POINTS:l=e.material.wireframe?di.LINES:di.TRIANGLES;const c={},h={},u=[],f=[],p={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=a.getAttribute("normal");m!==void 0&&!this.isNormalizedNormalAttribute(m)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(m)));let v=null;for(let x in a.attributes){if(x.slice(0,5)==="morph")continue;const E=a.attributes[x];if(x=p[x]||x.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(x)||(x="_"+x),i.attributes.has(this.getUID(E))){h[x]=i.attributes.get(this.getUID(E));continue}v=null;const T=E.array;x==="JOINTS_0"&&!(T instanceof Uint16Array)&&!(T instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),v=new Ke(new Uint16Array(T),E.itemSize,E.normalized));const R=this.processAccessor(v||E,a);R!==null&&(x.startsWith("_")||this.detectMeshQuantization(x,E),h[x]=R,i.attributes.set(this.getUID(E),R))}if(m!==void 0&&a.setAttribute("normal",m),Object.keys(h).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const x=[],E=[],M={};if(e.morphTargetDictionary!==void 0)for(const T in e.morphTargetDictionary)M[e.morphTargetDictionary[T]]=T;for(let T=0;T<e.morphTargetInfluences.length;++T){const R={};let w=!1;for(const I in a.morphAttributes){if(I!=="position"&&I!=="normal"){w||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),w=!0);continue}const O=a.morphAttributes[I][T],k=I.toUpperCase(),B=a.attributes[I];if(i.attributes.has(this.getUID(O,!0))){R[k]=i.attributes.get(this.getUID(O,!0));continue}const G=O.clone();if(!a.morphTargetsRelative)for(let L=0,U=O.count;L<U;L++)for(let z=0;z<O.itemSize;z++)z===0&&G.setX(L,O.getX(L)-B.getX(L)),z===1&&G.setY(L,O.getY(L)-B.getY(L)),z===2&&G.setZ(L,O.getZ(L)-B.getZ(L)),z===3&&G.setW(L,O.getW(L)-B.getW(L));R[k]=this.processAccessor(G,a),i.attributes.set(this.getUID(B,!0),R[k])}f.push(R),x.push(e.morphTargetInfluences[T]),e.morphTargetDictionary!==void 0&&E.push(M[T])}c.weights=x,E.length>0&&(c.extras={},c.extras.targetNames=E)}const g=Array.isArray(e.material);if(g&&a.groups.length===0)return null;let y=!1;if(g&&a.index===null){const x=[];for(let E=0,M=a.attributes.position.count;E<M;E++)x[E]=E;a.setIndex(x),y=!0}const A=g?e.material:[e.material],_=g?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let x=0,E=_.length;x<E;x++){const M={mode:l,attributes:h};if(this.serializeUserData(a,M),f.length>0&&(M.targets=f),a.index!==null){let R=this.getUID(a.index);(_[x].start!==void 0||_[x].count!==void 0)&&(R+=":"+_[x].start+":"+_[x].count),i.attributes.has(R)?M.indices=i.attributes.get(R):(M.indices=this.processAccessor(a.index,a,_[x].start,_[x].count),i.attributes.set(R,M.indices)),M.indices===null&&delete M.indices}const T=this.processMaterial(A[_[x].materialIndex]);T!==null&&(M.material=T),u.push(M)}y===!0&&a.setIndex(null),c.primitives=u,n.meshes||(n.meshes=[]),this._invokeAll(function(x){x.writeMesh&&x.writeMesh(e,c)});const b=n.meshes.push(c)-1;return i.meshes.set(o,b),b}detectMeshQuantization(e,t){if(this.extensionsUsed[QP])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const n=e.split("_",1)[0];PH[n]&&PH[n].includes(i)&&(this.extensionsUsed[QP]=!0,this.extensionsRequired[QP]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,n={type:i?"orthographic":"perspective"};return i?n.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:gi.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){const i=this.json,n=this.nodeMap;i.animations||(i.animations=[]),e=PT.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],a=[];for(let l=0;l<r.length;++l){const c=r[l],h=Zt.parseTrackName(c.name);let u=Zt.findNode(t,h.nodeName);const f=BH[h.propertyName];if(h.objectName==="bones"&&(u.isSkinnedMesh===!0?u=u.skeleton.getBoneByName(h.objectIndex):u=void 0),!u||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;const p=1;let m=c.values.length/c.times.length;f===BH.morphTargetInfluences&&(m/=u.morphTargetInfluences.length);let v;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(v="CUBICSPLINE",m/=3):c.getInterpolation()===Hd?v="STEP":v="LINEAR",a.push({input:this.processAccessor(new Ke(c.times,p)),output:this.processAccessor(new Ke(c.values,m)),interpolation:v}),o.push({sampler:a.length-1,target:{node:n.get(u),path:f}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,n=t.nodes[i.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(r.bones.length*16),c=new le;for(let u=0;u<r.bones.length;++u)a.push(i.get(r.bones[u])),c.copy(r.boneInverses[u]),c.multiply(e.bindMatrix).toArray(l,u*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new Ke(l,16)),joints:a,skeleton:i.get(o)}),n.skin=t.skins.length-1}processNode(e){const t={keep:!0};if(this._invokeAll(function(l){l.beforeWriteNode&&l.beforeWriteNode(e,t)}),t.keep!=!0)return null;const i=this.json,n=this.options,r=this.nodeMap;i.nodes||(i.nodes=[]);const o={};if(n.trs){const l=e.quaternion.toArray(),c=e.position.toArray(),h=e.scale.toArray();FA(l,[0,0,0,1])||(o.rotation=l),FA(c,[0,0,0])||(o.translation=c),FA(h,[1,1,1])||(o.scale=h)}else e.matrixAutoUpdate&&e.updateMatrix(),v_e(e.matrix)===!1&&(o.matrix=e.matrix.elements);if(e.name!==""&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){const l=this.processMesh(e);l!==null&&(o.mesh=l)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const l=[];for(let c=0,h=e.children.length;c<h;c++){const u=e.children[c];if(u.visible||n.onlyVisible===!1){const f=this.processNode(u);f!==null&&l.push(f)}}l.length>0&&(o.children=l)}this._invokeAll(function(l){l.writeNode&&l.writeNode(e,o)});const a=i.nodes.push(o)-1;return r.set(e,a),a}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const n={};e.name!==""&&(n.name=e.name),t.scenes.push(n);const r=[];for(let o=0,a=e.children.length;o<a;o++){const l=e.children[o];if(l.visible||i.onlyVisible===!1){const c=this.processNode(l);c!==null&&r.push(c)}}r.length>0&&(n.nodes=r),this.serializeUserData(e,n)}processObjects(e){const t=new Ws;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(n){n.beforeParse&&n.beforeParse(e)});const i=[];for(let n=0;n<e.length;n++)e[n]instanceof Ws?this.processScene(e[n]):i.push(e[n]);i.length>0&&this.processObjects(i);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll(function(n){n.afterParse&&n.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class b_e{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,n=i.json,r=i.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(1-e.penumbra)*e.angle,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},r[this.name]=!0);const a=n.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class x_e{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class w_e{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class S_e{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class C_e{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class E_e{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,n=i.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class M_e{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const n=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class T_e{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(d_e)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.specularIntensityMap){const o={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(o,e.specularIntensityMap),r.specularTexture=o}if(e.specularColorMap){const o={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(o,e.specularColorMap),r.specularColorTexture=o}r.specularFactor=e.specularIntensity,r.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class I_e{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.sheenRoughnessMap){const o={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(o,e.sheenRoughnessMap),r.sheenRoughnessTexture=o}if(e.sheenColorMap){const o={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(o,e.sheenColorMap),r.sheenColorTexture=o}r.sheenRoughnessFactor=e.sheenRoughness,r.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class R_e{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.anisotropyMap){const o={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(o,e.anisotropyMap),r.anisotropyTexture=o}r.anisotropyStrength=e.anisotropy,r.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class P_e{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class B_e{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const i=this.writer,n=i.extensionsUsed,r={};if(e.bumpMap){const o={index:i.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(o,e.bumpMap),r.bumpTexture=o}r.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}class D_e{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const i=this.writer,n=e,r=new Float32Array(n.count*3),o=new Float32Array(n.count*4),a=new Float32Array(n.count*3),l=new le,c=new S,h=new Ce,u=new S;for(let p=0;p<n.count;p++)n.getMatrixAt(p,l),l.decompose(c,h,u),c.toArray(r,p*3),h.toArray(o,p*4),u.toArray(a,p*3);const f={TRANSLATION:i.processAccessor(new Ke(r,3)),ROTATION:i.processAccessor(new Ke(o,4)),SCALE:i.processAccessor(new Ke(a,3))};n.instanceColor&&(f._COLOR_0=i.processAccessor(n.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:f},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}}PT.Utils={insertKeyframe:function(s,e){const i=s.getValueSize(),n=new s.TimeBufferType(s.times.length+1),r=new s.ValueBufferType(s.values.length+i),o=s.createInterpolant(new s.ValueBufferType(i));let a;if(s.times.length===0){n[0]=e;for(let l=0;l<i;l++)r[l]=0;a=0}else if(e<s.times[0]){if(Math.abs(s.times[0]-e)<.001)return 0;n[0]=e,n.set(s.times,1),r.set(o.evaluate(e),0),r.set(s.values,i),a=0}else if(e>s.times[s.times.length-1]){if(Math.abs(s.times[s.times.length-1]-e)<.001)return s.times.length-1;n[n.length-1]=e,n.set(s.times,0),r.set(s.values,0),r.set(o.evaluate(e),s.values.length),a=n.length-1}else for(let l=0;l<s.times.length;l++){if(Math.abs(s.times[l]-e)<.001)return l;if(s.times[l]<e&&s.times[l+1]>e){n.set(s.times.slice(0,l+1),0),n[l+1]=e,n.set(s.times.slice(l+1),l+2),r.set(s.values.slice(0,(l+1)*i),0),r.set(o.evaluate(e),(l+1)*i),r.set(s.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return s.times=n,s.values=r,a},mergeMorphTargetTracks:function(s,e){const t=[],i={},n=s.tracks;for(let r=0;r<n.length;++r){let o=n[r];const a=Zt.parseTrackName(o.name),l=Zt.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(Fc)}const c=l.morphTargetInfluences.length,h=l.morphTargetDictionary[a.propertyIndex];if(h===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let u;if(i[l.uuid]===void 0){u=o.clone();const p=new u.ValueBufferType(c*u.times.length);for(let m=0;m<u.times.length;m++)p[m*c+h]=u.values[m];u.name=(a.nodeName||"")+".morphTargetInfluences",u.values=p,i[l.uuid]=u,t.push(u);continue}const f=o.createInterpolant(new o.ValueBufferType(1));u=i[l.uuid];for(let p=0;p<u.times.length;p++)u.values[p*c+h]=f.evaluate(u.times[p]);for(let p=0;p<o.times.length;p++){const m=this.insertKeyframe(u,o.times[p]);u.values[m*c+h]=o.values[p]}}return s.tracks=t,s}};class pq{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(e.constructor.name!=="InstancedMesh")return;const i=this.writer,n=i.extensionsUsed,r={};t.extensions=t.extensions||{},t.extensions[this.name]=r;let o=new le;const a=new Array,l=new Array,c=new Array;for(let p=0;p<e.count;p++){e.getMatrixAt(p,o);let m=new S,v=new Ce,g=new S;o.decompose(m,v,g),a.push(m.x,m.y,m.z),l.push(v.x,v.y,v.z,v.w),c.push(g.x,g.y,g.z)}const h=new Float32Array(a),u=new Float32Array(l),f=new Float32Array(c);r.attributes={TRANSLATION:i.processAccessor(new Ke(h,3)),ROTATION:i.processAccessor(new Ke(u,4)),SCALE:i.processAccessor(new Ke(f,3))},n[this.name]=!0}}var O_e=Object.defineProperty,L_e=Object.getOwnPropertyDescriptor,mq=(s,e,t,i)=>{for(var n=i>1?void 0:i?L_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&O_e(e,t,n),n};const eC=ie("debuggltfexport");class $F extends el{constructor(){super(...arguments);d(this,"sceneRoot")}}const uy=class extends Ie{constructor(){super(...arguments);d(this,"binary",!0);d(this,"objects",[]);d(this,"ext")}async exportNow(e){eC&&console.log("Exporting objects as glTF",this.objects),e||(e="scene"),(!this.objects||this.objects.length<=0)&&(this.objects=[this.context.scene]);const t={binary:this.binary,pivot:uy.calculateCenter(this.objects)},i=await this.export(this.objects,t).catch(n=>(console.error(n),!1));return i===!1?!1:(this.binary?e.endsWith(".glb")||(e+=".glb"):e.endsWith(".gltf")||(e+=".gltf"),this.binary?uy.saveArrayBuffer(i,e):uy.saveJson(i,e),!0)}async export(e,t){if(!e||e.length<=0){console.warn("No objects set to export");return}const i=new PT;i.register(l=>new pq(l)),FF(i,this.context),uy.filterTopmostParent(e);const n={trs:!1,onlyVisible:!0,truncateDrawRange:!1,binary:!0,maxTextureSize:1/0,embedImages:!0,includeCustomExtensions:!0,animations:(t==null?void 0:t.animations)||uy.collectAnimations(e),...t},r=new ye;t!=null&&t.pivot&&r.position.sub(t.pivot),eC&&console.log("EXPORT",e),e.forEach(l=>{l&&(r.children.push(l),l.matrixAutoUpdate=!1,l.matrix.copy(l.matrixWorld),ne.getComponentsInChildren(l,Vn).forEach(c=>{ne.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))});const o=new qk(r);return this.ext&&(this.ext.context=o),new Promise((l,c)=>{eC&&console.log("Starting glTF export.");try{i==null||i.parse(r,h=>{a(),l(h)},h=>{a(),c(h)},n)}catch(h){console.error(h),c(h)}finally{eC&&console.log("Finished glTF export.")}});function a(){e.forEach(l=>{l&&(l.matrixAutoUpdate=!0,ne.getComponentsInChildren(l,Vn).forEach(c=>{ne.isActiveInHierarchy(c.gameObject)&&c.setInstancingEnabled(!1)}))})}}static saveArrayBuffer(e,t){this.save(new Blob([e],{type:"application/octet-stream"}),t)}static saveJson(e,t){this.save("data: text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),t)}static save(e,t){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),typeof e=="string"?i.href=e:i.href=URL.createObjectURL(e),i.download=t,i.click(),i.remove()}static collectAnimations(e,t){t=t||[];for(const i of e)i&&i.traverseVisible(n=>{n.animations&&n.animations.length>0&&t.push(...n.animations)});return t}static calculateCenter(e,t){const i=t||new S;return i.set(0,0,0),e.forEach(n=>{i.add(Ft(n))}),console.log(i),i.divideScalar(e.length),i}static filterTopmostParent(e){if(!(e.length<=0))for(let t=0;t<e.length;t++){let i=e[t];if(!i){e.splice(t,1),t--;continue}for(;i.parent;){if(e.includes(i.parent)){e.splice(t,1),t--;break}i=i.parent}}}};let Mx=uy;mq([C()],Mx.prototype,"binary",2);mq([C(ye)],Mx.prototype,"objects",2);var k_e=Object.defineProperty,F_e=Object.getOwnPropertyDescriptor,eU=(s,e,t,i)=>{for(var n=i>1?void 0:i?F_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&k_e(e,t,n),n};class Zv extends Ie{constructor(){super(...arguments);d(this,"isGizmo",!1);d(this,"color0");d(this,"color1");d(this,"gridHelper");d(this,"size");d(this,"divisions");d(this,"offset")}onEnable(){if(this.isGizmo&&!Jb)return;const t=this.size,i=this.divisions;this.gridHelper||(this.gridHelper=new SM(t,i,this.color0??new Ae(.4,.4,.4),this.color1??new Ae(.6,.6,.6)),this.offset!==void 0&&(this.gridHelper.position.y+=this.offset)),this.gridHelper&&this.gameObject.add(this.gridHelper)}onDisable(){this.gridHelper&&(this.gameObject.remove(this.gridHelper),this.gridHelper=null)}}eU([C()],Zv.prototype,"isGizmo",2);eU([C(Ae)],Zv.prototype,"color0",2);eU([C(Ae)],Zv.prototype,"color1",2);var U_e=Object.defineProperty,N_e=Object.getOwnPropertyDescriptor,BT=(s,e,t,i)=>{for(var n=i>1?void 0:i?N_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&U_e(e,t,n),n};const Ku=ie("debuginputfield");var Kg;const Et=(Kg=class extends Ie{constructor(){super(...arguments);d(this,"textComponent");d(this,"placeholder");d(this,"onValueChanged");d(this,"onEndEdit");d(this,"inputEventFn");d(this,"_iosEventFn")}get text(){var e;return((e=this.textComponent)==null?void 0:e.text)??""}get isFocused(){return Et.active===this}start(){Ku&&console.log(this.name,this)}onEnable(){var e;Et.htmlField||(Et.htmlField=document.createElement("input"),Et.htmlField.style.width="0px",Et.htmlField.style.height="0px",Et.htmlField.style.padding="0px",Et.htmlField.style.border="none",Et.htmlField.style.overflow="hidden",Et.htmlField.style.caretColor="transparent",Et.htmlField.style.outline="none",Et.htmlField.classList.add("ar"),Et.htmlField.onfocus=()=>Et.htmlFieldFocused=!0,Et.htmlField.onblur=()=>Et.htmlFieldFocused=!1,document.body.append(Et.htmlField)),this.inputEventFn||(this.inputEventFn=this.onInput.bind(this)),Et.htmlField.addEventListener("keyup",this.inputEventFn),this.placeholder&&((e=this.textComponent)!=null&&e.text.length)&&ne.setActive(this.placeholder.gameObject,!1),Vd()&&(this._iosEventFn=this.processInputOniOS.bind(this),window.addEventListener("click",this._iosEventFn))}onDisable(){var e;(e=Et.htmlField)==null||e.removeEventListener("keyup",this.inputEventFn),this.onDeselected(),this._iosEventFn&&window.removeEventListener("click",this._iosEventFn)}clear(){Et.active===this&&Et.htmlField?(Et.htmlField.value="",this.setTextFromInputField()):(this.textComponent&&(this.textComponent.text=""),this.placeholder&&ne.setActive(this.placeholder.gameObject,!0))}select(){this.onSelected()}deselect(){this.onDeselected()}onPointerClick(e){Ku&&console.log("CLICK",e,Et.active),Et.activeTime=this.context.time.time,Et.active!==this&&this.startCoroutine(this.activeLoop(),nn.LateUpdate),this.selectInputField()}*activeLoop(){for(this.onSelected();Et.active===this&&!(this.context.input.getPointerClicked(0)&&this.context.time.time-Et.activeTime>.2);)this.setTextFromInputField(),yield;this.onDeselected()}onSelected(){var e,t,i,n;if(Et.active!==this&&(Ku&&console.log("Select",this.name,this,Et.htmlField,this.context.isInXR,this.context.arOverlayElement,(e=this.textComponent)==null?void 0:e.text,(t=Et.htmlField)==null?void 0:t.value),(i=Et.active)==null||i.onDeselected(),Et.active=this,this.placeholder&&ne.setActive(this.placeholder.gameObject,!1),Et.htmlField)){if(Et.htmlField.value=((n=this.textComponent)==null?void 0:n.text)||"",Ku&&console.log("set input field value",Et.htmlField.value),this.context.isInXR){const r=this.context.arOverlayElement;r&&r.append(Et.htmlField)}this.selectInputField()}}onDeselected(){var e;Et.active===this&&(Et.active=null,Ku&&console.log("Deselect",this.name,this),Et.htmlField&&(Et.htmlField.blur(),document.body.append(Et.htmlField)),this.placeholder&&(!this.textComponent||this.textComponent.text.length<=0)&&ne.setActive(this.placeholder.gameObject,!0),Et.htmlField&&((e=this.onEndEdit)==null||e.invoke(Et.htmlField.value)))}update(){var e;Et.active===this&&((e=this.textComponent)==null||e.markDirty())}onInput(e){var t,i;if(Et.active===this){if(Ku&&console.log(e.code,e,(t=Et.htmlField)==null?void 0:t.value,(i=this.textComponent)==null?void 0:i.text),e.code==="Escape"||e.code==="Enter"){this.onDeselected();return}Et.htmlField&&(this.textComponent&&(this.setTextFromInputField(),this.placeholder&&ne.setActive(this.placeholder.gameObject,this.textComponent.text.length<=0)),this.selectInputField())}}setTextFromInputField(){var e;if(this.textComponent&&Et.htmlField){if(this.textComponent.text!==Et.htmlField.value){Ku&&console.log("VALUE CHANGED");const t=this.textComponent.text,i=Et.htmlField.value;(e=this.onValueChanged)==null||e.invoke(i,t)}this.textComponent.text=Et.htmlField.value}}selectInputField(){Et.htmlField&&(Ku&&console.log("Focus Inputfield",Et.htmlFieldFocused),Et.htmlField.setSelectionRange(Et.htmlField.value.length,Et.htmlField.value.length),Vd()?Et.htmlField.focus({preventScroll:!0}):setTimeout(()=>{var e;return(e=Et.htmlField)==null?void 0:e.focus()},1))}processInputOniOS(){const e=this.context.physics.raycast();if(!e.length)return;const i=e[0].object,n=uF(i);((n==null?void 0:n.gameObject)===this.gameObject||(n==null?void 0:n.gameObject.parent)===this.gameObject)&&this.selectInputField()}},d(Kg,"active",null),d(Kg,"activeTime",-1),d(Kg,"htmlField",null),d(Kg,"htmlFieldFocused",!1),Kg);let Om=Et;BT([C(Yr)],Om.prototype,"textComponent",2);BT([C(Yr)],Om.prototype,"placeholder",2);BT([C(Sn)],Om.prototype,"onValueChanged",2);BT([C(Sn)],Om.prototype,"onEndEdit",2);var z_e=Object.defineProperty,G_e=Object.getOwnPropertyDescriptor,eh=(s,e,t,i)=>{for(var n=i>1?void 0:i?G_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&z_e(e,t,n),n};function jP(s){return s*Math.PI/180}const FH=300,Ju=ie("debuglights");class Qo extends Ie{constructor(){super(...arguments);d(this,"type",0);d(this,"range",1);d(this,"spotAngle",1);d(this,"innerSpotAngle",1);d(this,"_color",new Ae(16777215));d(this,"_shadowNearPlane",.1);d(this,"_shadowBias",0);d(this,"_shadowNormalBias",0);d(this,"_overrideShadowBiasSettings",!1);d(this,"_shadows",1);d(this,"lightmapBakeType",4);d(this,"_intensity",-1);d(this,"_shadowDistance");d(this,"shadowWidth");d(this,"shadowHeight");d(this,"_shadowResolution");d(this,"light");d(this,"_webXRStartedListener");d(this,"_webXREndedListener");d(this,"_webARRoot")}set color(t){this._color=t,this.light!==void 0&&(this.light.color=t)}get color(){return this.light?this.light.color:this._color}set shadowNearPlane(t){var i,n;if(t!==this._shadowNearPlane&&(this._shadowNearPlane=t,((n=(i=this.light)==null?void 0:i.shadow)==null?void 0:n.camera)!==void 0)){const r=this.light.shadow.camera;r.near=t}}get shadowNearPlane(){return this._shadowNearPlane}set shadowBias(t){var i,n;t!==this._shadowBias&&(this._shadowBias=t,((n=(i=this.light)==null?void 0:i.shadow)==null?void 0:n.bias)!==void 0&&(this.light.shadow.bias=t,this.light.shadow.needsUpdate=!0))}get shadowBias(){return this._shadowBias}set shadowNormalBias(t){var i,n;t!==this._shadowNormalBias&&(this._shadowNormalBias=t,((n=(i=this.light)==null?void 0:i.shadow)==null?void 0:n.normalBias)!==void 0&&(this.light.shadow.normalBias=t,this.light.shadow.needsUpdate=!0))}get shadowNormalBias(){return this._shadowNormalBias}set shadows(t){this._shadows=t,this.light&&(this.light.castShadow=t!==0,this.updateShadowSoftHard())}get shadows(){return this._shadows}set intensity(t){var i;if(this._intensity=t,this.light){let n=1;if(this.context.isInXR&&this._webARRoot){const r=(i=this._webARRoot)==null?void 0:i.arScale;typeof r=="number"&&r>0&&(n/=r)}this.light.intensity=t*n}Ju&&console.log("Set light intensity to "+this._intensity,t,this)}get intensity(){return this._intensity}get shadowDistance(){const t=this.light;return t!=null&&t.shadow?t.shadow.camera.far:-1}set shadowDistance(t){this._shadowDistance=t;const i=this.light;if(i!=null&&i.shadow){const n=i.shadow.camera;n.far=t,n.updateProjectionMatrix()}}get shadowResolution(){const t=this.light;return t!=null&&t.shadow?t.shadow.mapSize.x:-1}set shadowResolution(t){if(t===this._shadowResolution)return;this._shadowResolution=t;const i=this.light;i!=null&&i.shadow&&(i.shadow.mapSize.set(t,t),i.shadow.needsUpdate=!0)}get isBaked(){return this.lightmapBakeType===2}get selfIsLight(){if(this.gameObject.isLight===!0)return!0;switch(this.gameObject.type){case"SpotLight":case"PointLight":case"DirectionalLight":return!0}return!1}getWorldPosition(t){return this.light?this.type===1?this.light.getWorldPosition(t).multiplyScalar(1):this.light.getWorldPosition(t):t}awake(){this.color=new Ae(this.color??16777215),Ju&&console.log(this.name,this)}onEnable(){Ju&&console.log("ENABLE LIGHT",this.name),this.createLight(),!this.isBaked&&(this.light&&(this.light.visible=!0,this.light.intensity=this._intensity,Ju&&console.log("Set light intensity to "+this.light.intensity,this.name),this.selfIsLight||this.light.parent!==this.gameObject&&this.gameObject.add(this.light)),this.type===1&&this.startCoroutine(this.updateMainLightRoutine(),nn.LateUpdate))}onDisable(){Ju&&console.log("DISABLE LIGHT",this.name),this.light&&(this.selfIsLight?this.light.intensity=0:this.light.visible=!1)}onEnterXR(t){this._webARRoot=ne.getComponentInParent(this.gameObject,lu)??void 0}onLeaveXR(t){}createLight(){const t=this.selfIsLight;if(t&&!this.light)switch(this.light=this.gameObject,this.light.name=this.name,this._intensity=this.light.intensity,this.type){case 1:this.setDirectionalLight(this.light);break}else if(!this.light)switch(this.type){case 1:const i=new nm(this.color,this.intensity*Math.PI);if(i.position.set(0,0,-FH*.5).applyQuaternion(this.gameObject.quaternion),this.gameObject.add(i.target),rm(i.target,0,0,0),this.light=i,this.gameObject.position.set(0,0,0),this.gameObject.rotation.set(0,0,0),Ju){const a=new m6(this.light,.2,this.color);this.context.scene.add(a)}break;case 0:const n=new Lb(this.color,this.intensity*Math.PI,this.range,jP(this.spotAngle/2),1-jP(this.innerSpotAngle/2)/jP(this.spotAngle/2),2);n.position.set(0,0,0),n.rotation.set(0,0,0),this.light=n;const r=n.target;n.add(r),r.position.set(0,0,this.range),r.rotation.set(0,0,0);break;case 2:const o=new im(this.color,this.intensity*Math.PI,this.range);this.light=o;break}if(this.light){if(this._intensity>=0?this.light.intensity=this._intensity:this._intensity=this.light.intensity,this.shadows!==0?this.light.castShadow=!0:this.light.castShadow=!1,this.light.shadow){this._shadowResolution!==void 0&&this._shadowResolution>4?(this.light.shadow.mapSize.width=this._shadowResolution,this.light.shadow.mapSize.height=this._shadowResolution):(this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048),Ju&&console.log("Override shadow bias?",this._overrideShadowBiasSettings,this.shadowBias,this.shadowNormalBias),this.light.shadow.bias=this.shadowBias,this.light.shadow.normalBias=this.shadowNormalBias,this.updateShadowSoftHard();const i=this.light.shadow.camera;if(i.near=this.shadowNearPlane,this._shadowDistance!==void 0&&typeof this._shadowDistance=="number"?i.far=this._shadowDistance:i.far=FH*Math.abs(this.gameObject.scale.z),this.gameObject.scale.set(1,1,1),this.shadowWidth!==void 0)i.left=-this.shadowWidth/2,i.right=this.shadowWidth/2;else{const n=this.gameObject.scale.x;i.left*=n,i.right*=n}if(this.shadowHeight!==void 0)i.top=this.shadowHeight/2,i.bottom=-this.shadowHeight/2;else{const n=this.gameObject.scale.y;i.top*=n,i.bottom*=n}this.light.shadow.needsUpdate=!0,Ju&&this.context.scene.add(new g6(i))}this.isBaked?this.light.removeFromParent():t||this.gameObject.add(this.light)}}*updateMainLightRoutine(){for(;;){this.type===1&&((!this.context.mainLight||this.intensity>this.context.mainLight.intensity)&&(this.context.mainLight=this),yield);break}}updateShadowSoftHard(){this.light&&this.light.shadow&&(this.shadows===2||(this.light.shadow.radius=1,this.light.shadow.blurSamples=1))}setDirectionalLight(t){t.add(t.target),t.target.position.set(0,0,-1)}}d(Qo,"allowChangingRendererShadowMapType",!0);eh([C()],Qo.prototype,"type",2);eh([C(Ae)],Qo.prototype,"color",1);eh([C()],Qo.prototype,"shadowNearPlane",1);eh([C()],Qo.prototype,"shadowBias",1);eh([C()],Qo.prototype,"shadowNormalBias",1);eh([C()],Qo.prototype,"shadows",1);eh([C()],Qo.prototype,"lightmapBakeType",2);eh([C()],Qo.prototype,"intensity",1);eh([C()],Qo.prototype,"shadowDistance",1);eh([C()],Qo.prototype,"shadowResolution",1);new S(0,0,0);var H_e=Object.defineProperty,V_e=Object.getOwnPropertyDescriptor,Tx=(s,e,t,i)=>{for(var n=i>1?void 0:i?V_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&H_e(e,t,n),n};const qP=ie("debuglods"),Q_e=ie("nolods");class Lm{constructor(){d(this,"screenRelativeTransitionHeight");d(this,"distance");d(this,"renderers")}}Tx([C()],Lm.prototype,"screenRelativeTransitionHeight",2);Tx([C()],Lm.prototype,"distance",2);Tx([C(Vn)],Lm.prototype,"renderers",2);class W_e{constructor(e){d(this,"model");this.model=e}get renderers(){return this.model.renderers}}class Ix extends Ie{constructor(){super(...arguments);d(this,"fadeMode",0);d(this,"localReferencePoint");d(this,"lodCount",0);d(this,"size",0);d(this,"animateCrossFading",!1);d(this,"lodModels");d(this,"_lods",[]);d(this,"_settings",[]);d(this,"_lodsHandler");d(this,"_distanceFactor",1)}start(){if(qP&&console.log("LODGROUP",this.name,this.lodModels,this),!Q_e&&!this._lodsHandler&&this.gameObject&&this.lodModels&&Array.isArray(this.lodModels)){const t=[];for(const n of this.lodModels){const r=new W_e(n);this._lods.push(r);for(const o of r.renderers)t.includes(o)||t.push(o)}this._lodsHandler=new Array;for(let n=0;n<t.length;n++){const r=new ZO;this._lodsHandler.push(r),this.gameObject.add(r)}const i=new ye;i.name="Cull "+this.name;for(let n=0;n<t.length;n++){const r=t[n],o=this._lodsHandler[n],a=r.gameObject;qP&&console.log(n,a.name);for(const l of this._lods){const c=l.model.distance;let h=null;if(l.renderers.includes(r)?h=a:h=i,h.type==="Group"){console.warn(`LODGroup ${this.name}: Group or MultiMaterial object's are not supported as LOD object: ${h.name}`);continue}qP&&console.log("LEVEL",h.name,c),o.autoUpdate=!1,this.onAddLodLevel(o,h,l.model.distance)}}}}onAfterRender(){if(!this.gameObject||!this._lodsHandler)return;const t=this.context.mainCamera;if(t)for(const i of this._lodsHandler){i.update(t);const n=i.getCurrentLevel(),r=i.levels[n];i.layers.mask=r.object.layers.mask}}onAddLodLevel(t,i,n){if(i===this.gameObject){console.warn("LODGroup component must be on parent object and not mesh directly at the moment",i.name,i);return}t.addLevel(i,n*this._distanceFactor,.01);const r={lod:t,levelIndex:t.levels.length-1,distance:n};this._settings.push(r)}distanceFactor(t){if(t!==this._distanceFactor){this._distanceFactor=t;for(const i of this._settings){const n=i.lod.levels[i.levelIndex];n.distance=i.distance*t}}}}Tx([C(S)],Ix.prototype,"localReferencePoint",2);Tx([C(Lm)],Ix.prototype,"lodModels",2);const j_e=ie("logstats");class tU extends Ie{onEnable(){console.log(this),j_e&&this.startCoroutine(this.run(),nn.OnAfterRender)}*run(){for(;this.enabled;){const e=this.context.renderer.info;console.log(e.memory,e.render,e.programs),yield}}}var q_e=Object.defineProperty,X_e=Object.getOwnPropertyDescriptor,DT=(s,e,t,i)=>{for(var n=i>1?void 0:i?X_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&q_e(e,t,n),n},DB;const gq=(DB=class extends Ie{constructor(){super(...arguments);d(this,"target");d(this,"invertForward",!1);d(this,"keepUpDirection",!0);d(this,"copyTargetRotation",!1)}onBeforeRender(){let e=this.target;e||(e=this.context.mainCamera),e&&(zb(this.gameObject,e,this.keepUpDirection,this.copyTargetRotation),this.invertForward&&this.gameObject.quaternion.multiply(gq.flipYQuat))}createBehaviours(e,t,i){if(t.uuid===this.gameObject.uuid){let n=t;if(this.keepUpDirection){const o=mr.createEmptyParent(t);n=o;const a=this.invertForward?-1:1;o.matrix.multiply(new le().makeRotationZ(Math.PI/2*a)),t.matrix.multiply(new le().makeRotationZ(-Math.PI/2*a))}const r=new cs("lookat "+this.name,Qs.sceneStartTrigger(),Ai.lookAtCameraAction(n,void 0,this.invertForward?xy.back:xy.forward,this.keepUpDirection?xy.up:xy.zero));e.addBehavior(r)}}},d(DB,"flipYQuat",new Ce().setFromAxisAngle(new S(0,1,0),Math.PI)),DB);let km=gq;DT([C(ye)],km.prototype,"target",2);DT([C()],km.prototype,"invertForward",2);DT([C()],km.prototype,"keepUpDirection",2);DT([C()],km.prototype,"copyTargetRotation",2);var Y_e=Object.defineProperty,K_e=Object.getOwnPropertyDescriptor,J_e=(s,e,t,i)=>{for(var n=i>1?void 0:i?K_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Y_e(e,t,n),n};const tC=ie("debugnestedgltf");class OT extends Ie{constructor(){super(...arguments);d(this,"filePath");d(this,"_isLoadingOrDoneLoading",!1)}listenToProgress(t){var i;(i=this.filePath)==null||i.beginListenDownload(t)}preload(){var t;(t=this.filePath)==null||t.preload()}async start(){var i,n,r,o,a;if(this._isLoadingOrDoneLoading)return;tC&&console.log(this,this.guid);const t=this.gameObject.parent;if(t){this._isLoadingOrDoneLoading=!0;const l=new Xl;l.idProvider=new Ms(this.hash(this.guid)),l.parent=t,this.gameObject.updateMatrix();const c=this.gameObject.matrix;tC&&console.log("Load nested:",((i=this.filePath)==null?void 0:i.uri)??this.filePath,this.gameObject.position);const h=await((r=(n=this.filePath)==null?void 0:n.instantiate)==null?void 0:r.call(this.filePath,l));tC&&console.log("Nested loaded:",((o=this.filePath)==null?void 0:o.uri)??this.filePath,h),h&&(h.matrixAutoUpdate=!1,h.matrix.identity(),h.applyMatrix4(c),h.matrixAutoUpdate=!0,h.layers.disableAll(),h.layers.set(this.layer),this.dispatchEvent(new CustomEvent("loaded",{detail:{instance:h,assetReference:this.filePath}}))),tC&&console.log("Nested loading done:",((a=this.filePath)==null?void 0:a.uri)??this.filePath,h)}}onDestroy(){var t;(t=this.filePath)==null||t.unload()}hash(t){let i=0;for(let n=0;n<t.length;n++)i=t.charCodeAt(n)+((i<<5)-i);return i}}J_e([C(ei)],OT.prototype,"filePath",2);var Z_e=Object.defineProperty,$_e=Object.getOwnPropertyDescriptor,iU=(s,e,t,i)=>{for(var n=i>1?void 0:i?$_e(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Z_e(e,t,n),n};const ebe=ie("debugnet"),JD=class extends Ie{constructor(){super(...arguments);d(this,"url",null);d(this,"urlParameterName",null);d(this,"localhost",null)}awake(){ebe&&console.log(this),this.context.connection.registerProvider(this)}getWebsocketUrl(){let e=this.url?JD.GetUrl(this.url,this.localhost):null;if(this.urlParameterName){const r=ie(this.urlParameterName);r&&typeof r=="string"&&(e=r)}if(!e)return null;const i=new RegExp("(((https?)|(?<socket_prefix>wss?))://)?(www.)?(?<url>.+)","gm").exec(e);return i!=null&&i.groups?(i==null?void 0:i.groups.socket_prefix)?e:"wss://"+(i==null?void 0:i.groups.url):null}static GetUrl(e,t){let i=e;const n=JD.IsLocalNetwork()&&t;if(n&&(i=t),e!=null&&e.startsWith("/")){const r=n?i:window.location.origin;r!=null&&r.endsWith("/")&&e.startsWith("/")&&(e=e.substring(1)),i=r+e}return i}static IsLocalNetwork(e=window.location.hostname){return yo(e)}};let $v=JD;iU([C()],$v.prototype,"url",2);iU([C()],$v.prototype,"urlParameterName",2);iU([C()],$v.prototype,"localhost",2);var tbe=Object.defineProperty,ibe=Object.getOwnPropertyDescriptor,LT=(s,e,t,i)=>{for(var n=i>1?void 0:i?ibe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&tbe(e,t,n),n};class Fm extends Ie{constructor(){super(...arguments);d(this,"referenceSpace");d(this,"from");d(this,"affectPosition",!1);d(this,"affectRotation",!1);d(this,"alignLookDirection",!1);d(this,"levelLookDirection",!1);d(this,"levelPosition",!1);d(this,"positionOffset",new S(0,0,0));d(this,"rotationOffset",new S(0,0,0));d(this,"offset",new S(0,0,0))}update(){if(!this.from)return;var t=Ft(this.from),i=ki(this.from);this.offset.copy(this.positionOffset);const n=this.offset.length();if(this.referenceSpace&&this.offset.transformDirection(this.referenceSpace.matrixWorld).multiplyScalar(n),t.add(this.offset),this.levelPosition&&this.referenceSpace){const l=new xs(this.gameObject.up,0),c=Ft(this.referenceSpace);l.setFromNormalAndCoplanarPoint(this.gameObject.up,c);const h=new S(0,0,0);l.projectPoint(t,h),t.copy(h)}this.affectPosition&&Es(this.gameObject,t);const r=new li(this.rotationOffset.x,this.rotationOffset.y,this.rotationOffset.z),o=new Ce().setFromEuler(r);this.affectRotation&&rl(this.gameObject,i.multiply(o));const a=new S;this.from.getWorldDirection(a).multiplyScalar(50),this.levelLookDirection&&(a.y=0),this.alignLookDirection&&this.gameObject.lookAt(a)}}LT([C(ne)],Fm.prototype,"referenceSpace",2);LT([C(ne)],Fm.prototype,"from",2);LT([C(S)],Fm.prototype,"positionOffset",2);LT([C(S)],Fm.prototype,"rotationOffset",2);var nbe=Object.defineProperty,sbe=Object.getOwnPropertyDescriptor,nU=(s,e,t,i)=>{for(var n=i>1?void 0:i?sbe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&nbe(e,t,n),n};class e0 extends Ie{constructor(){super(...arguments);d(this,"url");d(this,"mode",0);d(this,"clickable",!0)}async open(){if(!this.url){console.warn("OpenURL: URL is not set, can't open.",this);return}this._validateUrl();let t=this.url;switch(!t.startsWith("mailto:")&&t.includes("@")&&(t="mailto:"+t),nt()&&_n("Open URL: "+t),this.mode){case 0:Dy(),globalThis.open(t,"_blank");break;case 1:Dy()&&Vd()?globalThis.open(t,"_top"):globalThis.open(t,"_self");break;case 2:Dy()?globalThis.open(t,"_top"):globalThis.open(t,"_new");break}}start(){this.gameObject.getComponentInParent(wa)||this.gameObject.addComponent(wa)}onPointerEnter(t){!t.used&&this.clickable&&this.context.input.setCursorPointer()}onPointerExit(){this.clickable&&this.context.input.setCursorNormal()}onPointerClick(t){var i;this.clickable&&!t.used&&((i=this.url)!=null&&i.length)&&this.open()}_validateUrl(){this.url&&this.url.startsWith("www.")&&(nt()&&console.warn("URL is not valid, adding https:// to the start of the URL",this.url),this.url="https://"+this.url)}}nU([C()],e0.prototype,"url",2);nU([C()],e0.prototype,"mode",2);nU([C()],e0.prototype,"clickable",2);function rbe(s,e){var t=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(t!=null){var i,n,r,o,a=[],l=!0,c=!1;try{if(r=(t=t.call(s)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(i=r.call(t)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(h){c=!0,n=h}finally{try{if(!l&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw n}}return a}}function ZD(){ZD=function(){return e};var s,e={},t=Object.prototype,i=t.hasOwnProperty,n=Object.defineProperty||function(L,U,z){L[U]=z.value},r=typeof Symbol=="function"?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(L,U,z){return Object.defineProperty(L,U,{value:z,enumerable:!0,configurable:!0,writable:!0}),L[U]}try{c({},"")}catch{c=function(U,z,j){return U[z]=j}}function h(L,U,z,j){var X=U&&U.prototype instanceof y?U:y,re=Object.create(X.prototype),ce=new B(j||[]);return n(re,"_invoke",{value:w(L,z,ce)}),re}function u(L,U,z){try{return{type:"normal",arg:L.call(U,z)}}catch(j){return{type:"throw",arg:j}}}e.wrap=h;var f="suspendedStart",p="suspendedYield",m="executing",v="completed",g={};function y(){}function A(){}function _(){}var b={};c(b,o,function(){return this});var x=Object.getPrototypeOf,E=x&&x(x(G([])));E&&E!==t&&i.call(E,o)&&(b=E);var M=_.prototype=y.prototype=Object.create(b);function T(L){["next","throw","return"].forEach(function(U){c(L,U,function(z){return this._invoke(U,z)})})}function R(L,U){function z(X,re,ce,Me){var se=u(L[X],L,re);if(se.type!=="throw"){var ve=se.arg,xe=ve.value;return xe&&typeof xe=="object"&&i.call(xe,"__await")?U.resolve(xe.__await).then(function(Fe){z("next",Fe,ce,Me)},function(Fe){z("throw",Fe,ce,Me)}):U.resolve(xe).then(function(Fe){ve.value=Fe,ce(ve)},function(Fe){return z("throw",Fe,ce,Me)})}Me(se.arg)}var j;n(this,"_invoke",{value:function(X,re){function ce(){return new U(function(Me,se){z(X,re,Me,se)})}return j=j?j.then(ce,ce):ce()}})}function w(L,U,z){var j=f;return function(X,re){if(j===m)throw new Error("Generator is already running");if(j===v){if(X==="throw")throw re;return{value:s,done:!0}}for(z.method=X,z.arg=re;;){var ce=z.delegate;if(ce){var Me=I(ce,z);if(Me){if(Me===g)continue;return Me}}if(z.method==="next")z.sent=z._sent=z.arg;else if(z.method==="throw"){if(j===f)throw j=v,z.arg;z.dispatchException(z.arg)}else z.method==="return"&&z.abrupt("return",z.arg);j=m;var se=u(L,U,z);if(se.type==="normal"){if(j=z.done?v:p,se.arg===g)continue;return{value:se.arg,done:z.done}}se.type==="throw"&&(j=v,z.method="throw",z.arg=se.arg)}}}function I(L,U){var z=U.method,j=L.iterator[z];if(j===s)return U.delegate=null,z==="throw"&&L.iterator.return&&(U.method="return",U.arg=s,I(L,U),U.method==="throw")||z!=="return"&&(U.method="throw",U.arg=new TypeError("The iterator does not provide a '"+z+"' method")),g;var X=u(j,L.iterator,U.arg);if(X.type==="throw")return U.method="throw",U.arg=X.arg,U.delegate=null,g;var re=X.arg;return re?re.done?(U[L.resultName]=re.value,U.next=L.nextLoc,U.method!=="return"&&(U.method="next",U.arg=s),U.delegate=null,g):re:(U.method="throw",U.arg=new TypeError("iterator result is not an object"),U.delegate=null,g)}function O(L){var U={tryLoc:L[0]};1 in L&&(U.catchLoc=L[1]),2 in L&&(U.finallyLoc=L[2],U.afterLoc=L[3]),this.tryEntries.push(U)}function k(L){var U=L.completion||{};U.type="normal",delete U.arg,L.completion=U}function B(L){this.tryEntries=[{tryLoc:"root"}],L.forEach(O,this),this.reset(!0)}function G(L){if(L||L===""){var U=L[o];if(U)return U.call(L);if(typeof L.next=="function")return L;if(!isNaN(L.length)){var z=-1,j=function X(){for(;++z<L.length;)if(i.call(L,z))return X.value=L[z],X.done=!1,X;return X.value=s,X.done=!0,X};return j.next=j}}throw new TypeError(typeof L+" is not iterable")}return A.prototype=_,n(M,"constructor",{value:_,configurable:!0}),n(_,"constructor",{value:A,configurable:!0}),A.displayName=c(_,l,"GeneratorFunction"),e.isGeneratorFunction=function(L){var U=typeof L=="function"&&L.constructor;return!!U&&(U===A||(U.displayName||U.name)==="GeneratorFunction")},e.mark=function(L){return Object.setPrototypeOf?Object.setPrototypeOf(L,_):(L.__proto__=_,c(L,l,"GeneratorFunction")),L.prototype=Object.create(M),L},e.awrap=function(L){return{__await:L}},T(R.prototype),c(R.prototype,a,function(){return this}),e.AsyncIterator=R,e.async=function(L,U,z,j,X){X===void 0&&(X=Promise);var re=new R(h(L,U,z,j),X);return e.isGeneratorFunction(U)?re:re.next().then(function(ce){return ce.done?ce.value:re.next()})},T(M),c(M,l,"Generator"),c(M,o,function(){return this}),c(M,"toString",function(){return"[object Generator]"}),e.keys=function(L){var U=Object(L),z=[];for(var j in U)z.push(j);return z.reverse(),function X(){for(;z.length;){var re=z.pop();if(re in U)return X.value=re,X.done=!1,X}return X.done=!0,X}},e.values=G,B.prototype={constructor:B,reset:function(L){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(k),!L)for(var U in this)U.charAt(0)==="t"&&i.call(this,U)&&!isNaN(+U.slice(1))&&(this[U]=s)},stop:function(){this.done=!0;var L=this.tryEntries[0].completion;if(L.type==="throw")throw L.arg;return this.rval},dispatchException:function(L){if(this.done)throw L;var U=this;function z(se,ve){return re.type="throw",re.arg=L,U.next=se,ve&&(U.method="next",U.arg=s),!!ve}for(var j=this.tryEntries.length-1;j>=0;--j){var X=this.tryEntries[j],re=X.completion;if(X.tryLoc==="root")return z("end");if(X.tryLoc<=this.prev){var ce=i.call(X,"catchLoc"),Me=i.call(X,"finallyLoc");if(ce&&Me){if(this.prev<X.catchLoc)return z(X.catchLoc,!0);if(this.prev<X.finallyLoc)return z(X.finallyLoc)}else if(ce){if(this.prev<X.catchLoc)return z(X.catchLoc,!0)}else{if(!Me)throw new Error("try statement without catch or finally");if(this.prev<X.finallyLoc)return z(X.finallyLoc)}}}},abrupt:function(L,U){for(var z=this.tryEntries.length-1;z>=0;--z){var j=this.tryEntries[z];if(j.tryLoc<=this.prev&&i.call(j,"finallyLoc")&&this.prev<j.finallyLoc){var X=j;break}}X&&(L==="break"||L==="continue")&&X.tryLoc<=U&&U<=X.finallyLoc&&(X=null);var re=X?X.completion:{};return re.type=L,re.arg=U,X?(this.method="next",this.next=X.finallyLoc,g):this.complete(re)},complete:function(L,U){if(L.type==="throw")throw L.arg;return L.type==="break"||L.type==="continue"?this.next=L.arg:L.type==="return"?(this.rval=this.arg=L.arg,this.method="return",this.next="end"):L.type==="normal"&&U&&(this.next=U),g},finish:function(L){for(var U=this.tryEntries.length-1;U>=0;--U){var z=this.tryEntries[U];if(z.finallyLoc===L)return this.complete(z.completion,z.afterLoc),k(z),g}},catch:function(L){for(var U=this.tryEntries.length-1;U>=0;--U){var z=this.tryEntries[U];if(z.tryLoc===L){var j=z.completion;if(j.type==="throw"){var X=j.arg;k(z)}return X}}throw new Error("illegal catch attempt")},delegateYield:function(L,U,z){return this.delegate={iterator:G(L),resultName:U,nextLoc:z},this.method==="next"&&(this.arg=s),g}},e}function Rt(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}function UH(s,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,vq(i.key),i)}}function Pt(s,e,t){return e&&UH(s.prototype,e),t&&UH(s,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function te(s,e,t){return e=vq(e),e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function t0(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),e&&$D(s,e)}function CE(s){return CE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},CE(s)}function $D(s,e){return $D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},$D(s,e)}function obe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ci(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function abe(s,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ci(s)}function i0(s){var e=obe();return function(){var i=CE(s),n;if(e){var r=CE(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return abe(this,n)}}function Qy(s,e){return lbe(s)||rbe(s,e)||yq(s,e)||cbe()}function lbe(s){if(Array.isArray(s))return s}function yq(s,e){if(s){if(typeof s=="string")return NH(s,e);var t=Object.prototype.toString.call(s).slice(8,-1);if(t==="Object"&&s.constructor&&(t=s.constructor.name),t==="Map"||t==="Set")return Array.from(s);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return NH(s,e)}}function NH(s,e){(e==null||e>s.length)&&(e=s.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=s[t];return i}function cbe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zH(s,e){var t=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!t){if(Array.isArray(s)||(t=yq(s))||e&&s&&typeof s.length=="number"){t&&(s=t);var i=0,n=function(){};return{s:n,n:function(){return i>=s.length?{done:!0}:{done:!1,value:s[i++]}},e:function(l){throw l},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r=!0,o=!1,a;return{s:function(){t=t.call(s)},n:function(){var l=t.next();return r=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!r&&t.return!=null&&t.return()}finally{if(o)throw a}}}}function hbe(s,e){if(typeof s!="object"||s===null)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var i=t.call(s,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function vq(s){var e=hbe(s,"string");return typeof e=="symbol"?e:String(e)}var ube=function(s){t0(t,s);var e=i0(t);function t(i){var n;return Rt(this,t),n=e.call(this),te(ci(n),"type","ParticleEmitter"),te(ci(n),"system",void 0),n.system=i,n}return Pt(t,[{key:"clone",value:function(){var n=this.system.clone();return n.emitter.copy(this,!0),n.emitter}},{key:"dispose",value:function(){}},{key:"extractFromCache",value:function(n){var r=[];for(var o in n){var a=n[o];delete a.metadata,r.push(a)}return r}},{key:"toJSON",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n===void 0||typeof n=="string",a={};o&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var l={};if(l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.castShadow===!0&&(l.castShadow=!0),this.receiveShadow===!0&&(l.receiveShadow=!0),this.visible===!1&&(l.visible=!1),this.frustumCulled===!1&&(l.frustumCulled=!1),this.renderOrder!==0&&(l.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(l.matrixAutoUpdate=!1),this.system!==null&&(l.ps=this.system.toJSON(n,r)),this.children.length>0){l.children=[];for(var c=0;c<this.children.length;c++)this.children[c].type!=="ParticleSystemPreview"&&l.children.push(this.children[c].toJSON(n).object)}if(o){var h=this.extractFromCache(n.geometries),u=this.extractFromCache(n.materials),f=this.extractFromCache(n.textures),p=this.extractFromCache(n.images);h.length>0&&(a.geometries=h),u.length>0&&(a.materials=u),f.length>0&&(a.textures=f),p.length>0&&(a.images=p)}return a.object=l,a}}]),t}(ye),XP=function(){function s(e){Rt(this,s),te(this,"data",void 0),te(this,"next",void 0),te(this,"prev",void 0),this.data=e,this.next=null,this.prev=null}return Pt(s,[{key:"hasPrev",value:function(){return this.prev!==null}},{key:"hasNext",value:function(){return this.next!==null}}]),s}(),dbe=function(){function s(){Rt(this,s),te(this,"length",void 0),te(this,"head",void 0),te(this,"tail",void 0),this.length=0,this.head=this.tail=null}return Pt(s,[{key:"isEmpty",value:function(){return this.head===null}},{key:"clear",value:function(){this.length=0,this.head=this.tail=null}},{key:"front",value:function(){return this.head===null?null:this.head.data}},{key:"back",value:function(){return this.tail===null?null:this.tail.data}},{key:"dequeue",value:function(){if(this.head){var t=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}}},{key:"pop",value:function(){if(this.tail){var t=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}}},{key:"queue",value:function(t){var i=new XP(t);this.tail||(this.tail=i),this.head&&(this.head.prev=i,i.next=this.head),this.head=i,this.length++}},{key:"push",value:function(t){var i=new XP(t);this.head||(this.head=i),this.tail&&(this.tail.next=i,i.prev=this.tail),this.tail=i,this.length++}},{key:"insertBefore",value:function(t,i){var n=new XP(i);n.next=t,n.prev=t.prev,n.prev!==null&&(n.prev.next=n),n.next.prev=n,t==this.head&&(this.head=n),this.length++}},{key:"remove",value:function(t){if(!(this.head===null||this.tail===null)){var i=this.head;for(t===this.head.data&&(this.head=this.head.next),t===this.tail.data&&(this.tail=this.tail.prev);i.next!==null&&i.data!==t;)i=i.next;i.data===t&&(i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.length--)}}},{key:"values",value:ZD().mark(function e(){var t;return ZD().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t=this.head;case 1:if(t===null){n.next=7;break}return n.next=4,t.data;case 4:t=t.next,n.next=1;break;case 7:case"end":return n.stop()}},e,this)})}]),s}(),cb=function(){function s(){Rt(this,s),te(this,"parentMatrix",void 0),te(this,"startSpeed",0),te(this,"startColor",new Je),te(this,"startSize",1),te(this,"position",new S),te(this,"velocity",new S),te(this,"age",0),te(this,"life",1),te(this,"size",1),te(this,"angularVelocity",void 0),te(this,"rotation",0),te(this,"color",new Je),te(this,"uvTile",0)}return Pt(s,[{key:"died",get:function(){return this.age>=this.life}}]),s}(),fbe=Pt(function s(e,t,i){Rt(this,s),this.position=e,this.size=t,this.color=i}),hb=function(){function s(){Rt(this,s),te(this,"parentMatrix",void 0),te(this,"startSpeed",0),te(this,"startColor",new Je),te(this,"startSize",1),te(this,"position",new S),te(this,"localPosition",void 0),te(this,"velocity",new S),te(this,"age",0),te(this,"life",1),te(this,"size",1),te(this,"length",100),te(this,"color",new Je),te(this,"previous",new dbe),te(this,"uvTile",0)}return Pt(s,[{key:"update",value:function(){for(this.age<=this.life?this.previous.push(new fbe(this.position.clone(),this.size,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}},{key:"died",get:function(){return this.age>=this.life}},{key:"reset",value:function(){this.previous.clear()}}]),s}(),Fr=function(){function s(e){Rt(this,s),te(this,"type",void 0),this.value=e,this.type="value"}return Pt(s,[{key:"genValue",value:function(){return this.value}},{key:"toJSON",value:function(){return{type:"ConstantValue",value:this.value}}},{key:"clone",value:function(){return new s(this.value)}}],[{key:"fromJSON",value:function(t){return new s(t.value)}}]),s}(),kT=function(){function s(e,t){Rt(this,s),te(this,"type",void 0),this.a=e,this.b=t,this.type="value"}return Pt(s,[{key:"genValue",value:function(){return gi.lerp(this.a,this.b,Math.random())}},{key:"toJSON",value:function(){return{type:"IntervalValue",a:this.a,b:this.b}}},{key:"clone",value:function(){return new s(this.a,this.b)}}],[{key:"fromJSON",value:function(t){return new s(t.a,t.b)}}]),s}(),pbe=function(){function s(){Rt(this,s),te(this,"functions",void 0),this.functions=new Array}return Pt(s,[{key:"findFunction",value:function(t){for(var i=0,n=0,r=this.functions.length-1;n+1<r;)if(i=Math.floor((n+r)/2),t<this.getStartX(i))r=i-1;else if(t>this.getEndX(i))n=i+1;else return i;for(var o=n;o<=r;o++)if(t>=this.functions[o][1]&&t<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(t){return this.functions[t][1]}},{key:"setStartX",value:function(t,i){t>0&&(this.functions[t][1]=i)}},{key:"getEndX",value:function(t){return t+1<this.functions.length?this.functions[t+1][1]:1}},{key:"setEndX",value:function(t,i){t+1<this.functions.length&&(this.functions[t+1][1]=i)}},{key:"insertFunction",value:function(t,i){var n=this.findFunction(t);this.functions.splice(n+1,0,[i,t])}},{key:"removeFunction",value:function(t){return this.functions.splice(t,1)[0][0]}},{key:"getFunction",value:function(t){return this.functions[t][0]}},{key:"setFunction",value:function(t,i){this.functions[t][0]=i}},{key:"numOfFunctions",get:function(){return this.functions.length}}]),s}(),eO=function(){function s(e,t,i,n){Rt(this,s),te(this,"p",void 0),this.p=[e,t,i,n]}return Pt(s,[{key:"genValue",value:function(t){var i=t*t,n=t*t*t,r=1-t,o=r*r,a=o*r;return this.p[0]*a+this.p[1]*o*t*3+this.p[2]*r*i*3+this.p[3]*n}},{key:"derivativeCoefficients",value:function(t){for(var i=[],n=t,r=n.length-1;r>0;r--){for(var o=[],a=0;a<r;a++){var l=r*(n[a+1]-n[a]);o.push(l)}i.push(o),n=o}return i}},{key:"getSlope",value:function(t){var i=this.derivativeCoefficients(this.p)[0],n=1-t,r=n*n,o=n*t*2,a=t*t;return r*i[0]+o*i[1]+a*i[2]}},{key:"controlCurve",value:function(t,i){this.p[1]=t/3+this.p[0],this.p[2]=this.p[3]-i/3}},{key:"hull",value:function(t){var i=this.p,n=[],r,o=0,a=0,l=0,c=[];for(c[o++]=i[0],c[o++]=i[1],c[o++]=i[2],c[o++]=i[3];i.length>1;){for(n=[],a=0,l=i.length-1;a<l;a++)r=t*i[a]+(1-t)*i[a+1],c[o++]=r,n.push(r);i=n}return c}},{key:"split",value:function(t){var i=this.hull(t),n={left:new s(i[0],i[4],i[7],i[9]),right:new s(i[9],i[8],i[6],i[3]),span:i};return n}},{key:"clone",value:function(){return new s(this.p[0],this.p[1],this.p[2],this.p[3])}},{key:"toJSON",value:function(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}}],[{key:"fromJSON",value:function(t){return new s(t.p0,t.p1,t.p2,t.p3)}}]),s}(),mbe=function(s){t0(t,s);var e=i0(t);function t(){var i,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new eO(0,.3333333333333333,.6666666666666666,1),0]];return Rt(this,t),i=e.call(this),te(ci(i),"type",void 0),i.type="function",i.functions=n,i}return Pt(t,[{key:"genValue",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=this.findFunction(n);return r===-1?0:this.functions[r][0].genValue((n-this.getStartX(r))/(this.getEndX(r)-this.getStartX(r)))}},{key:"toSVG",value:function(n,r){if(r<1)return"";for(var o=["M",0,this.functions[0][0].p[0]].join(" "),a=1/r;a<=1;a+=1/r)o=[o,"L",a*n,this.genValue(a)].join(" ");return o}},{key:"toJSON",value:function(){return{type:"PiecewiseBezier",functions:this.functions.map(function(n){var r=Qy(n,2),o=r[0],a=r[1];return{function:o.toJSON(),start:a}})}}},{key:"clone",value:function(){return new t(this.functions.map(function(n){var r=Qy(n,2),o=r[0],a=r[1];return[o.clone(),a]}))}}],[{key:"fromJSON",value:function(n){return new t(n.functions.map(function(r){return[eO.fromJSON(r.function),r.start]}))}}]),t}(pbe);function en(s){switch(s.type){case"ConstantValue":return Fr.fromJSON(s);case"IntervalValue":return kT.fromJSON(s);case"PiecewiseBezier":return mbe.fromJSON(s);default:return new Fr(0)}}var ub=function(e){return{r:e.x,g:e.y,b:e.z,a:e.w}},db=function(e){return new Je(e.r,e.g,e.b,e.a)},gbe=function(e,t){switch(t){case"Vector3":return new S(e.x,e.y,e.z);case"Vector4":return new Je(e.x,e.y,e.z,e.w);case"Color":return new S(e.r,e.g,e.b);case"Number":return e;default:return e}},ybe=function(e,t){switch(t){case"Vector3":return{x:e.x,y:e.y,z:e.z};case"Vector4":return{x:e.x,y:e.y,z:e.z,w:e.w};case"Color":return{r:e.x,g:e.y,b:e.z};case"Number":return e;default:return e}},vbe=function(){function s(e,t){Rt(this,s),te(this,"type",void 0),this.a=e,this.b=t,this.type="value"}return Pt(s,[{key:"genColor",value:function(t){var i=Math.random();return t.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"RandomColor",a:ub(this.a),b:ub(this.b)}}},{key:"clone",value:function(){return new s(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(t){return new s(db(t.a),db(t.b))}}]),s}(),tO=function(){function s(e,t){Rt(this,s),te(this,"type",void 0),this.a=e,this.b=t,this.type="function"}return Pt(s,[{key:"genColor",value:function(t,i){return t.copy(this.a).lerp(this.b,i)}},{key:"toJSON",value:function(){return{type:"ColorRange",a:ub(this.a),b:ub(this.b)}}},{key:"clone",value:function(){return new s(this.a.clone(),this.b.clone())}}],[{key:"fromJSON",value:function(t){return new s(db(t.a),db(t.b))}}]),s}(),iC=function(){function s(e,t){Rt(this,s),te(this,"keys",void 0),te(this,"type",void 0),te(this,"subType",void 0),this.subType=t,this.type="function",this.keys=e}return Pt(s,[{key:"findKey",value:function(t){for(var i=0,n=0,r=this.keys.length-1;n+1<r;)if(i=Math.floor((n+r)/2),t<this.getStartX(i))r=i-1;else if(t>this.getEndX(i))n=i+1;else return i;for(var o=n;o<=r;o++)if(t>=this.getStartX(o)&&t<=this.getEndX(o))return o;return-1}},{key:"getStartX",value:function(t){return this.keys[t][1]}},{key:"getEndX",value:function(t){return t+1<this.keys.length?this.keys[t+1][1]:1}},{key:"genValue",value:function(t,i){var n=this.findKey(i);return this.subType==="Number"?n===-1?this.keys[0][0]:n+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[n+1][0]-this.keys[n][0])*((i-this.getStartX(n))/(this.getEndX(n)-this.getStartX(n)))+this.keys[n][0]:n===-1?t.copy(this.keys[0][0]):n+1>=this.keys.length?t.copy(this.keys[this.keys.length-1][0]):t.copy(this.keys[n][0]).lerp(this.keys[n+1][0],(i-this.getStartX(n))/(this.getEndX(n)-this.getStartX(n)))}},{key:"toJSON",value:function(){var t=this;return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(function(i){var n=Qy(i,2),r=n[0],o=n[1];return{value:ybe(r,t.subType),pos:o}})}}},{key:"clone",value:function(){return this.subType==="Number"?new s(this.keys.map(function(t){var i=Qy(t,2),n=i[0],r=i[1];return[n,r]}),this.subType):new s(this.keys.map(function(t){var i=Qy(t,2),n=i[0],r=i[1];return[n.clone(),r]}),this.subType)}}],[{key:"fromJSON",value:function(t){return new s(t.keys.map(function(i){return[gbe(i.value,t.subType),i.pos]}),t.subType)}}]),s}(),nC=new S,iO=function(){function s(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[[new S(0,0,0),0],[new S(1,1,1),0]],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[[1,0],[1,1]];Rt(this,s),te(this,"type",void 0),te(this,"color",void 0),te(this,"alpha",void 0),this.type="function",this.color=new iC(e,"Color"),this.alpha=new iC(t,"Number")}return Pt(s,[{key:"genColor",value:function(t,i){return this.color.genValue(nC,i),t.set(nC.x,nC.y,nC.z,this.alpha.genValue(1,i))}},{key:"toJSON",value:function(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}},{key:"clone",value:function(){var t=new s;return t.alpha=this.alpha.clone(),t.color=this.color.clone(),t}}],[{key:"fromJSON",value:function(t){if(t.functions){var i=t.functions.map(function(r){return[tO.fromJSON(r.function).a,r.start]});return t.functions.length>0&&i.push([tO.fromJSON(t.functions[t.functions.length-1].function).b,1]),new s(i.map(function(r){return[new S(r[0].x,r[0].y,r[0].z),r[1]]}),i.map(function(r){return[r[0].w,r[1]]}))}else{var n=new s;return n.alpha=iC.fromJSON(t.alpha),n.color=iC.fromJSON(t.color),n}}}]),s}(),YP=new Je,Abe=function(){function s(e,t){Rt(this,s),te(this,"gradient1",void 0),te(this,"gradient2",void 0),te(this,"type",void 0),this.type="memorizedFunction",this.gradient1=e,this.gradient2=t}return Pt(s,[{key:"startGen",value:function(t){t.rand=Math.random()}},{key:"genColor",value:function(t,i,n){return this.gradient1.genColor(t,i),this.gradient2.genColor(YP,i),n&&n.rand?t.lerp(YP,n.rand):t.lerp(YP,Math.random()),t}},{key:"toJSON",value:function(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}},{key:"clone",value:function(){return new s(this.gradient1.clone(),this.gradient2.clone())}}],[{key:"fromJSON",value:function(t){return new s(iO.fromJSON(t.gradient1),iO.fromJSON(t.gradient2))}}]),s}(),EE=function(){function s(e){Rt(this,s),te(this,"type",void 0),this.color=e,this.type="value"}return Pt(s,[{key:"genColor",value:function(t){return t.copy(this.color)}},{key:"toJSON",value:function(){return{type:"ConstantColor",color:ub(this.color)}}},{key:"clone",value:function(){return new s(this.color.clone())}}],[{key:"fromJSON",value:function(t){return new s(db(t.color))}}]),s}();function sU(s){switch(s.type){case"ConstantColor":return EE.fromJSON(s);case"ColorRange":return tO.fromJSON(s);case"RandomColor":return vbe.fromJSON(s);case"Gradient":return iO.fromJSON(s);case"RandomColorBetweenGradient":return Abe.fromJSON(s);default:return new EE(new Je(1,1,1,1))}}var GH=function(){function s(){Rt(this,s),te(this,"type",void 0),this.type="rotation"}return Pt(s,[{key:"genValue",value:function(t,i){var n,r,o,a,l,c;do n=Math.random()*2-1,r=Math.random()*2-1,o=n*n+r*r;while(o>1);do a=Math.random()*2-1,l=Math.random()*2-1,c=a*a+l*l;while(c>1);var h=Math.sqrt((1-o)/c);return t.set(n,r,h*a,h*l),t}},{key:"toJSON",value:function(){return{type:"RandomQuat"}}},{key:"clone",value:function(){return new s}}],[{key:"fromJSON",value:function(t){return new s}}]),s}(),Aq=function(){function s(e,t){Rt(this,s),te(this,"type",void 0),this.axis=e,this.angle=t,this.type="rotation"}return Pt(s,[{key:"genValue",value:function(t,i){return t.setFromAxisAngle(this.axis,this.angle.genValue(i))}},{key:"toJSON",value:function(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new s(this.axis.clone(),this.angle.clone())}}],[{key:"fromJSON",value:function(t){return new s(t.axis,en(t.angle))}}]),s}(),_be=function(){function s(e,t,i){Rt(this,s),te(this,"type",void 0),this.angleX=e,this.angleY=t,this.angleZ=i,this.type="rotation"}return Pt(s,[{key:"genValue",value:function(t,i){return t.setFromEuler(new li(this.angleX.genValue(i),this.angleY.genValue(i),this.angleZ.genValue(i)))}},{key:"toJSON",value:function(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON()}}},{key:"clone",value:function(){return new s(this.angleX,this.angleY,this.angleZ)}}],[{key:"fromJSON",value:function(t){return new s(en(t.angleX),en(t.angleY),en(t.angleZ))}}]),s}();function _q(s){switch(s.type){case"AxisAngle":return Aq.fromJSON(s);case"Euler":return _be.fromJSON(s);case"RandomQuat":return GH.fromJSON(s);default:return new GH}}function bbe(s){switch(s.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return en(s);case"AxisAngle":case"RandomQuat":case"Euler":return _q(s);default:return new Fr(0)}}var HH=function(){function s(e){Rt(this,s),te(this,"type","ColorOverLife"),this.color=e}return Pt(s,[{key:"initialize",value:function(t){this.color.type==="memorizedFunction"&&(t.colorOverLifeMemory={},this.color.startGen(t.colorOverLifeMemory))}},{key:"update",value:function(t,i){this.color.type==="memorizedFunction"?this.color.genColor(t.color,t.age/t.life,t.colorOverLifeMemory):this.color.genColor(t.color,t.age/t.life),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON()}}},{key:"clone",value:function(){return new s(this.color.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(sU(t.color))}}]),s}(),VH=function(){function s(e,t){Rt(this,s),te(this,"type","RotationOverLife"),te(this,"tempQuat",new Ce),this.angularVelocity=e,this.dynamic=t}return Pt(s,[{key:"initialize",value:function(t){!this.dynamic&&t instanceof cb&&(t.angularVelocity=this.angularVelocity.genValue())}},{key:"update",value:function(t,i){this.dynamic?t.rotation+=i*this.angularVelocity.genValue(t.age/t.life):t instanceof cb&&(t.rotation+=i*t.angularVelocity)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(en(t.angularVelocity),t.dynamic)}}]),s}(),QH=function(){function s(e){Rt(this,s),te(this,"type","SizeOverLife"),this.size=e}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){t.size=t.startSize*this.size.genValue(t.age/t.life)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.size.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(en(t.size))}}]),s}(),WH=function(){function s(e){Rt(this,s),te(this,"type","SpeedOverLife"),this.speed=e}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){t.velocity.normalize().multiplyScalar(t.startSpeed*this.speed.genValue(t.age/t.life))}},{key:"toJSON",value:function(){return{type:this.type,speed:this.speed.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.speed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(en(t.speed))}}]),s}(),jH=function(){function s(e,t){Rt(this,s),te(this,"type","RotationBySpeed"),te(this,"tempQuat",new Ce),this.angularVelocity=e,this.speedRange=t}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){var n=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.rotation+=i*this.angularVelocity.genValue(n)}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.angularVelocity.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(en(t.angularVelocity),kT.fromJSON(t.speedRange))}}]),s}(),qH=function(){function s(e,t){Rt(this,s),te(this,"type","SizeBySpeed"),this.size=e,this.speedRange=t}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){var i=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);t.size=t.startSize*this.size.genValue(i)}},{key:"toJSON",value:function(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.size.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(en(t.size),kT.fromJSON(t.speedRange))}}]),s}(),XH=function(){function s(e,t){Rt(this,s),te(this,"type","ColorBySpeed"),this.color=e,this.speedRange=t}return Pt(s,[{key:"initialize",value:function(t){this.color.type==="memorizedFunction"&&(t.colorOverLifeMemory={},this.color.startGen(t.colorOverLifeMemory))}},{key:"update",value:function(t,i){var n=(t.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.type==="memorizedFunction"?this.color.genColor(t.color,n,t.colorOverLifeMemory):this.color.genColor(t.color,n),t.color.x*=t.startColor.x,t.color.y*=t.startColor.y,t.color.z*=t.startColor.z,t.color.w*=t.startColor.w}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}},{key:"clone",value:function(){return new s(this.color.clone(),this.speedRange.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(sU(t.color),kT.fromJSON(t.speedRange))}}]),s}(),YH=function(){function s(e){Rt(this,s),te(this,"type","FrameOverLife"),this.frame=e}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){t.uvTile=Math.floor(this.frame.genValue(t.age/t.life))}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,frame:this.frame.toJSON()}}},{key:"clone",value:function(){return new s(this.frame.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(en(t.frame))}}]),s}();new S(0,0,1);var KH=function(){function s(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new S(0,1,0);Rt(this,s),te(this,"type","OrbitOverLife"),te(this,"rotation",void 0),te(this,"line",void 0),te(this,"temp",new S),this.orbitSpeed=e,this.axis=t,this.rotation=new Ce,this.line=new ma}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){this.line.set(new S(0,0,0),this.axis),this.line.closestPointToPoint(t.position,!1,this.temp),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(t.age/t.life)*i),t.position.sub(this.temp),t.position.applyQuaternion(this.rotation),t.position.add(this.temp)}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}},{key:"clone",value:function(){return new s(this.orbitSpeed.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(en(t.orbitSpeed),t.axis?new S(t.axis[0],t.axis[1],t.axis[2]):void 0)}}]),s}(),JH=function(){function s(e,t){Rt(this,s),te(this,"type","ApplyForce"),te(this,"magnitudeValue",void 0),this.direction=e,this.magnitude=t,this.magnitudeValue=this.magnitude.genValue()}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){t.velocity.addScaledVector(this.direction,this.magnitudeValue*i)}},{key:"frameUpdate",value:function(t){this.magnitudeValue=this.magnitude.genValue()}},{key:"toJSON",value:function(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}},{key:"clone",value:function(){return new s(this.direction.clone(),this.magnitude.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){var i;return new s(new S(t.direction[0],t.direction[1],t.direction[2]),en((i=t.magnitude)!==null&&i!==void 0?i:t.force))}}]),s}(),ZH=function(){function s(e,t){Rt(this,s),te(this,"type","GravityForce"),te(this,"temp",new S),this.center=e,this.magnitude=t}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){this.temp.copy(this.center).sub(t.position).normalize(),t.velocity.addScaledVector(this.temp,this.magnitude/t.position.distanceToSquared(this.center)*i)}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}},{key:"clone",value:function(){return new s(this.center.clone(),this.magnitude)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(new S(t.center[0],t.center[1],t.center[2]),t.magnitude)}}]),s}(),$H=function(){function s(e){Rt(this,s),te(this,"type","WidthOverLength"),this.width=e}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){if(t instanceof hb)for(var i=t.previous.values(),n=0;n<t.previous.length;n++){var r=i.next();r.value.size=this.width.genValue((t.previous.length-n)/t.length)}}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,width:this.width.toJSON()}}},{key:"clone",value:function(){return new s(this.width.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(en(t.width))}}]),s}();new S(0,0,1);var eV=function(){function s(e){Rt(this,s),te(this,"type","ChangeEmitDirection"),te(this,"_temp",new S),te(this,"_q",new Ce),this.angle=e}return Pt(s,[{key:"initialize",value:function(t){var i=t.velocity.length();i!=0&&(t.velocity.normalize(),t.velocity.x===0&&t.velocity.y===0?this._temp.set(0,t.velocity.z,0):this._temp.set(-t.velocity.y,t.velocity.x,0),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue()),this._temp.copy(t.velocity),t.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),t.velocity.applyQuaternion(this._q),t.velocity.setLength(i))}},{key:"update",value:function(t,i){}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,angle:this.angle.toJSON()}}},{key:"clone",value:function(){return new s(this.angle)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(en(t.angle))}}]),s}(),xbe=new S(1,1,1),tV=new S(0,0,1),iV=function(){function s(e,t,i){Rt(this,s),te(this,"type","EmitSubParticleSystem"),te(this,"q_",new Ce),te(this,"v_",new S),te(this,"v2_",new S),this.particleSystem=e,this.useVelocityAsBasis=t,this.subParticleSystem=i,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}return Pt(s,[{key:"initialize",value:function(t){t.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:new le}}},{key:"update",value:function(t,i){if(!(!this.subParticleSystem||!t.emissionState)){var n=t.emissionState.matrix,r;if(t.rotation===void 0||this.useVelocityAsBasis)if(t.velocity.x===0&&t.velocity.y===0&&(t.velocity.z===1||t.velocity.z===0))n.set(1,0,0,t.position.x,0,1,0,t.position.y,0,0,1,t.position.z,0,0,0,1);else{this.v_.copy(tV).cross(t.velocity),this.v2_.copy(t.velocity).cross(this.v_);var o=this.v_.length(),a=this.v2_.length();n.set(this.v_.x/o,this.v2_.x/a,t.velocity.x,t.position.x,this.v_.y/o,this.v2_.y/a,t.velocity.y,t.position.y,this.v_.z/o,this.v2_.z/a,t.velocity.z,t.position.z,0,0,0,1)}else t.rotation instanceof Ce?r=t.rotation:(this.q_.setFromAxisAngle(tV,t.rotation),r=this.q_),n.compose(t.position,r,xbe);this.particleSystem.worldSpace||n.multiplyMatrices(this.particleSystem.emitter.matrixWorld,n),this.subParticleSystem.system.emit(i,t.emissionState,n)}}},{key:"frameUpdate",value:function(t){}},{key:"toJSON",value:function(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis}}},{key:"clone",value:function(){return new s(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t,i){return new s(i,t.useVelocityAsBasis,t.subParticleSystem)}}]),s}(),wbe=.5*(Math.sqrt(3)-1),J0=(3-Math.sqrt(3))/6,Sbe=1/3,rc=1/6,Cbe=(Math.sqrt(5)-1)/4,tr=(5-Math.sqrt(5))/20,Os=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),ss=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),bq=function(){function s(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Math.random;Rt(this,s),te(this,"p",void 0),te(this,"perm",void 0),te(this,"permMod12",void 0);var t=typeof e=="function"?e:Mbe(e);this.p=Ebe(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var i=0;i<512;i++)this.perm[i]=this.p[i&255],this.permMod12[i]=this.perm[i]%12}return Pt(s,[{key:"noise2D",value:function(t,i){var n=this.permMod12,r=this.perm,o=0,a=0,l=0,c=(t+i)*wbe,h=Math.floor(t+c),u=Math.floor(i+c),f=(h+u)*J0,p=h-f,m=u-f,v=t-p,g=i-m,y,A;v>g?(y=1,A=0):(y=0,A=1);var _=v-y+J0,b=g-A+J0,x=v-1+2*J0,E=g-1+2*J0,M=h&255,T=u&255,R=.5-v*v-g*g;if(R>=0){var w=n[M+r[T]]*3;R*=R,o=R*R*(Os[w]*v+Os[w+1]*g)}var I=.5-_*_-b*b;if(I>=0){var O=n[M+y+r[T+A]]*3;I*=I,a=I*I*(Os[O]*_+Os[O+1]*b)}var k=.5-x*x-E*E;if(k>=0){var B=n[M+1+r[T+1]]*3;k*=k,l=k*k*(Os[B]*x+Os[B+1]*E)}return 70*(o+a+l)}},{key:"noise3D",value:function(t,i,n){var r=this.permMod12,o=this.perm,a,l,c,h,u=(t+i+n)*Sbe,f=Math.floor(t+u),p=Math.floor(i+u),m=Math.floor(n+u),v=(f+p+m)*rc,g=f-v,y=p-v,A=m-v,_=t-g,b=i-y,x=n-A,E,M,T,R,w,I;_>=b?b>=x?(E=1,M=0,T=0,R=1,w=1,I=0):_>=x?(E=1,M=0,T=0,R=1,w=0,I=1):(E=0,M=0,T=1,R=1,w=0,I=1):b<x?(E=0,M=0,T=1,R=0,w=1,I=1):_<x?(E=0,M=1,T=0,R=0,w=1,I=1):(E=0,M=1,T=0,R=1,w=1,I=0);var O=_-E+rc,k=b-M+rc,B=x-T+rc,G=_-R+2*rc,L=b-w+2*rc,U=x-I+2*rc,z=_-1+3*rc,j=b-1+3*rc,X=x-1+3*rc,re=f&255,ce=p&255,Me=m&255,se=.6-_*_-b*b-x*x;if(se<0)a=0;else{var ve=r[re+o[ce+o[Me]]]*3;se*=se,a=se*se*(Os[ve]*_+Os[ve+1]*b+Os[ve+2]*x)}var xe=.6-O*O-k*k-B*B;if(xe<0)l=0;else{var Fe=r[re+E+o[ce+M+o[Me+T]]]*3;xe*=xe,l=xe*xe*(Os[Fe]*O+Os[Fe+1]*k+Os[Fe+2]*B)}var Ge=.6-G*G-L*L-U*U;if(Ge<0)c=0;else{var je=r[re+R+o[ce+w+o[Me+I]]]*3;Ge*=Ge,c=Ge*Ge*(Os[je]*G+Os[je+1]*L+Os[je+2]*U)}var lt=.6-z*z-j*j-X*X;if(lt<0)h=0;else{var ot=r[re+1+o[ce+1+o[Me+1]]]*3;lt*=lt,h=lt*lt*(Os[ot]*z+Os[ot+1]*j+Os[ot+2]*X)}return 32*(a+l+c+h)}},{key:"noise4D",value:function(t,i,n,r){var o=this.perm,a,l,c,h,u,f=(t+i+n+r)*Cbe,p=Math.floor(t+f),m=Math.floor(i+f),v=Math.floor(n+f),g=Math.floor(r+f),y=(p+m+v+g)*tr,A=p-y,_=m-y,b=v-y,x=g-y,E=t-A,M=i-_,T=n-b,R=r-x,w=0,I=0,O=0,k=0;E>M?w++:I++,E>T?w++:O++,E>R?w++:k++,M>T?I++:O++,M>R?I++:k++,T>R?O++:k++;var B=w>=3?1:0,G=I>=3?1:0,L=O>=3?1:0,U=k>=3?1:0,z=w>=2?1:0,j=I>=2?1:0,X=O>=2?1:0,re=k>=2?1:0,ce=w>=1?1:0,Me=I>=1?1:0,se=O>=1?1:0,ve=k>=1?1:0,xe=E-B+tr,Fe=M-G+tr,Ge=T-L+tr,je=R-U+tr,lt=E-z+2*tr,ot=M-j+2*tr,q=T-X+2*tr,He=R-re+2*tr,we=E-ce+3*tr,Ne=M-Me+3*tr,Ee=T-se+3*tr,st=R-ve+3*tr,et=E-1+4*tr,ct=M-1+4*tr,zt=T-1+4*tr,V=R-1+4*tr,F=p&255,ge=m&255,_e=v&255,Pe=g&255,Te=.6-E*E-M*M-T*T-R*R;if(Te<0)a=0;else{var xt=o[F+o[ge+o[_e+o[Pe]]]]%32*4;Te*=Te,a=Te*Te*(ss[xt]*E+ss[xt+1]*M+ss[xt+2]*T+ss[xt+3]*R)}var ft=.6-xe*xe-Fe*Fe-Ge*Ge-je*je;if(ft<0)l=0;else{var Le=o[F+B+o[ge+G+o[_e+L+o[Pe+U]]]]%32*4;ft*=ft,l=ft*ft*(ss[Le]*xe+ss[Le+1]*Fe+ss[Le+2]*Ge+ss[Le+3]*je)}var Qe=.6-lt*lt-ot*ot-q*q-He*He;if(Qe<0)c=0;else{var St=o[F+z+o[ge+j+o[_e+X+o[Pe+re]]]]%32*4;Qe*=Qe,c=Qe*Qe*(ss[St]*lt+ss[St+1]*ot+ss[St+2]*q+ss[St+3]*He)}var ke=.6-we*we-Ne*Ne-Ee*Ee-st*st;if(ke<0)h=0;else{var ni=o[F+ce+o[ge+Me+o[_e+se+o[Pe+ve]]]]%32*4;ke*=ke,h=ke*ke*(ss[ni]*we+ss[ni+1]*Ne+ss[ni+2]*Ee+ss[ni+3]*st)}var pt=.6-et*et-ct*ct-zt*zt-V*V;if(pt<0)u=0;else{var Xe=o[F+1+o[ge+1+o[_e+1+o[Pe+1]]]]%32*4;pt*=pt,u=pt*pt*(ss[Xe]*et+ss[Xe+1]*ct+ss[Xe+2]*zt+ss[Xe+3]*V)}return 27*(a+l+c+h+u)}}]),s}();function Ebe(s){for(var e=new Uint8Array(256),t=0;t<256;t++)e[t]=t;for(var i=0;i<255;i++){var n=i+~~(s()*(256-i)),r=e[i];e[i]=e[n],e[n]=r}return e}function Mbe(s){var e=0,t=0,i=0,n=1,r=Tbe();return e=r(" "),t=r(" "),i=r(" "),e-=r(s),e<0&&(e+=1),t-=r(s),t<0&&(t+=1),i-=r(s),i<0&&(i+=1),function(){var o=2091639*e+n*23283064365386963e-26;return e=t,t=i,i=o-(n=o|0)}}function Tbe(){var s=4022871197;return function(e){e=e.toString();for(var t=0;t<e.length;t++){s+=e.charCodeAt(t);var i=.02519603282416938*s;s=i>>>0,i-=s,i*=s,s=i>>>0,i-=s,s+=i*4294967296}return(s>>>0)*23283064365386963e-26}}var nV=function(){function s(e,t,i,n){Rt(this,s),te(this,"type","TurbulenceField"),te(this,"generator",new bq),te(this,"timeOffset",new S),te(this,"temp",new S),te(this,"temp2",new S),this.scale=e,this.octaves=t,this.velocityMultiplier=i,this.timeScale=n,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t,i){var n=t.position.x/this.scale.x,r=t.position.y/this.scale.y,o=t.position.z/this.scale.z;this.temp.set(0,0,0);for(var a=1,l=0;l<this.octaves;l++)this.temp2.set(this.generator.noise4D(n*a,r*a,o*a,this.timeOffset.x*a)/a,this.generator.noise4D(n*a,r*a,o*a,this.timeOffset.y*a)/a,this.generator.noise4D(n*a,r*a,o*a,this.timeOffset.z*a)/a),this.temp.add(this.temp2),a*=2;this.temp.multiply(this.velocityMultiplier),t.velocity.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}},{key:"frameUpdate",value:function(t){this.timeOffset.x+=t*this.timeScale.x,this.timeOffset.y+=t*this.timeScale.y,this.timeOffset.z+=t*this.timeScale.z}},{key:"clone",value:function(){return new s(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(new S(t.scale[0],t.scale[1],t.scale[2]),t.octaves,new S(t.velocityMultiplier[0],t.velocityMultiplier[1],t.velocityMultiplier[2]),new S(t.timeScale[0],t.timeScale[1],t.timeScale[2]))}}]),s}(),sV=new Ce,rV=function(){function s(e,t){Rt(this,s),te(this,"type","Rotation3DOverLife"),te(this,"tempQuat",new Ce),this.angularVelocity=e,this.dynamic=t}return Pt(s,[{key:"initialize",value:function(t){!this.dynamic&&t instanceof cb&&(t.angularVelocity=new Ce,this.angularVelocity.genValue(t.angularVelocity))}},{key:"update",value:function(t,i){this.dynamic?(this.angularVelocity.genValue(this.tempQuat,t.age/t.life),this.tempQuat.slerpQuaternions(sV,this.tempQuat,i),t.rotation.multiply(this.tempQuat)):t instanceof cb&&(this.tempQuat.slerpQuaternions(sV,t.angularVelocity,i),t.rotation.multiply(this.tempQuat))}},{key:"toJSON",value:function(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),dynamic:this.dynamic}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.angularVelocity.clone(),this.dynamic)}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(_q(t.angularVelocity),t.dynamic)}}]),s}(),oV=function(){function s(e,t,i){Rt(this,s),te(this,"type","ForceOverLife"),te(this,"_temp",new S),this.x=e,this.y=t,this.z=i}return Pt(s,[{key:"initialize",value:function(t){}},{key:"update",value:function(t){this._temp.set(this.x.genValue(t.age/t.life),this.y.genValue(t.age/t.life),this.z.genValue(t.age/t.life)),t.velocity.add(this._temp)}},{key:"toJSON",value:function(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}},{key:"frameUpdate",value:function(t){}},{key:"clone",value:function(){return new s(this.x.clone(),this.y.clone(),this.z.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(en(t.x),en(t.y),en(t.z))}}]),s}(),aV=function(){function s(e,t){Rt(this,s),te(this,"type","Noise"),te(this,"generator",new bq),te(this,"duration",0),te(this,"temp",new S),this.frequency=e,this.power=t}return Pt(s,[{key:"initialize",value:function(t){t.startTime=this.duration}},{key:"update",value:function(t,i){this.temp.set(this.generator.noise2D(t.startTime*this.frequency.x,t.life/t.age*this.frequency.x),this.generator.noise2D(t.startTime*this.frequency.y+100.25,t.life/t.age*this.frequency.y+100.154),this.generator.noise2D(t.startTime*this.frequency.z+200.89,t.life/t.age*this.frequency.z+200.1)).multiply(this.power),t.position.addScaledVector(this.temp,i)}},{key:"toJSON",value:function(){return{type:this.type,frequency:[this.frequency.x,this.frequency.y,this.frequency.z],power:[this.power.x,this.power.y,this.power.z]}}},{key:"frameUpdate",value:function(t){this.duration+=t}},{key:"clone",value:function(){return new s(this.frequency.clone(),this.power.clone())}},{key:"reset",value:function(){}}],[{key:"fromJSON",value:function(t){return new s(new S(t.frequency[0],t.frequency[1],t.frequency[2]),new S(t.power[0],t.power[1],t.power[2]))}}]),s}(),Ibe={ApplyForce:{type:"ApplyForce",constructor:JH,params:[["direction","vec3"],["magnitude","value"]],loadJSON:JH.fromJSON},Noise:{type:"Noise",constructor:aV,params:[["frequency","vec3"],["power","vec3"]],loadJSON:aV.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:nV,params:[["scale","vec3"],["octaves","number"],["velocityMultiplier","vec3"],["timeScale","vec3"]],loadJSON:nV.fromJSON},GravityForce:{type:"GravityForce",constructor:ZH,params:[["center","vec3"],["magnitude","number"]],loadJSON:ZH.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:HH,params:[["color","colorFunc"]],loadJSON:HH.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:VH,params:[["angularVelocity","valueFunc"],["dynamic","boolean"]],loadJSON:VH.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:rV,params:[["angularVelocity","rotationFunc"],["dynamic","boolean"]],loadJSON:rV.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:QH,params:[["size","valueFunc"]],loadJSON:QH.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:XH,params:[["color","colorFunc"],["speedRange","range"]],loadJSON:XH.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:jH,params:[["angularVelocity","valueFunc"],["speedRange","range"]],loadJSON:jH.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:qH,params:[["size","valueFunc"],["speedRange","range"]],loadJSON:qH.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:WH,params:[["speed","valueFunc"]],loadJSON:WH.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:YH,params:[["frame","valueFunc"]],loadJSON:YH.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:oV,params:[["x","valueFunc"],["y","valueFunc"],["z","valueFunc"]],loadJSON:oV.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:KH,params:[["orbitSpeed","valueFunc"],["axis","vec3"]],loadJSON:KH.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:$H,params:[["width","valueFunc"]],loadJSON:$H.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:eV,params:[["angle","value"]],loadJSON:eV.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:iV,params:[["particleSystem","self"],["useVelocityAsBasis","boolean"],["subParticleSystem","particleSystem"]],loadJSON:iV.fromJSON}};function Rbe(s,e){return Ibe[s.type].loadJSON(s,e)}var lV=function(){function s(){var e,t,i,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Rt(this,s),te(this,"type","cone"),te(this,"radius",void 0),te(this,"arc",void 0),te(this,"thickness",void 0),te(this,"angle",void 0),this.radius=(e=r.radius)!==null&&e!==void 0?e:10,this.arc=(t=r.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(n=r.angle)!==null&&n!==void 0?n:Math.PI/6}return Pt(s,[{key:"initialize",value:function(t){var i=Math.random(),n=gi.lerp(1-this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(n),a=Math.sin(r),l=Math.cos(r);t.position.x=o*l,t.position.y=o*a,t.position.z=0;var c=this.angle*o;t.velocity.set(0,0,Math.cos(c)).addScaledVector(t.position,Math.sin(c)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new s({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),cV=function(){function s(){var e,t,i,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Rt(this,s),te(this,"type","donut"),te(this,"radius",void 0),te(this,"arc",void 0),te(this,"thickness",void 0),te(this,"angle",void 0),this.radius=(e=r.radius)!==null&&e!==void 0?e:10,this.arc=(t=r.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=r.thickness)!==null&&i!==void 0?i:1,this.angle=(n=r.angle)!==null&&n!==void 0?n:Math.PI/6}return Pt(s,[{key:"initialize",value:function(t){var i=Math.random(),n=gi.lerp(this.thickness,1,Math.random()),r=i*this.arc,o=Math.sqrt(n),a=Math.sin(r),l=Math.cos(r);t.position.x=o*l,t.position.y=o*a,t.position.z=0;var c=this.angle*o;t.velocity.set(0,0,Math.cos(c)).addScaledVector(t.position,Math.sin(c)).multiplyScalar(t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle}}},{key:"clone",value:function(){return new s({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),hV=function(){function s(){Rt(this,s),te(this,"type","point")}return Pt(s,[{key:"initialize",value:function(t){var i=Math.random(),n=Math.random(),r=i*Math.PI*2,o=Math.acos(2*n-1),a=Math.cbrt(Math.random()),l=Math.sin(r),c=Math.cos(r),h=Math.sin(o),u=Math.cos(o);t.velocity.x=a*h*c,t.velocity.y=a*h*l,t.velocity.z=a*u,t.velocity.multiplyScalar(t.startSpeed),t.position.setScalar(0)}},{key:"toJSON",value:function(){return{type:"point"}}},{key:"clone",value:function(){return new s}}],[{key:"fromJSON",value:function(t){return new s}}]),s}(),nO=function(){function s(){var e,t,i,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Rt(this,s),te(this,"type","sphere"),te(this,"radius",void 0),te(this,"arc",void 0),te(this,"thickness",void 0),this.radius=(e=n.radius)!==null&&e!==void 0?e:10,this.arc=(t=n.arc)!==null&&t!==void 0?t:2*Math.PI,this.thickness=(i=n.thickness)!==null&&i!==void 0?i:1}return Pt(s,[{key:"initialize",value:function(t){var i=Math.random(),n=Math.random(),r=gi.lerp(1-this.thickness,1,Math.random()),o=i*this.arc,a=Math.acos(2*n-1),l=Math.cbrt(r),c=Math.sin(o),h=Math.cos(o),u=Math.sin(a),f=Math.cos(a);t.position.x=l*u*h,t.position.y=l*u*c,t.position.z=l*f,t.velocity.setScalar(0).addScaledVector(t.position,t.startSpeed),t.position.multiplyScalar(this.radius)}},{key:"toJSON",value:function(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness}}},{key:"clone",value:function(){return new s({radius:this.radius,arc:this.arc,thickness:this.thickness})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),uV=function(){function s(e){Rt(this,s),te(this,"type","mesh_surface"),te(this,"_triangleIndexToArea",[]),te(this,"_geometry",void 0),te(this,"_tempA",new S),te(this,"_tempB",new S),te(this,"_tempC",new S),e&&(this.geometry=e)}return Pt(s,[{key:"geometry",get:function(){return this._geometry},set:function(t){if(this._geometry=t,t!==void 0&&typeof t!="string"){var i=new pr;this._triangleIndexToArea.length=0;var n=0;if(t.getIndex()){var r=t.getIndex().array,o=r.length/3;this._triangleIndexToArea.push(0);for(var a=0;a<o;a++)i.setFromAttributeAndIndices(t.getAttribute("position"),r[a*3],r[a*3+1],r[a*3+2]),n+=i.getArea(),this._triangleIndexToArea.push(n);t.userData.triangleIndexToArea=this._triangleIndexToArea}}}},{key:"initialize",value:function(t){var i=this._geometry;if(!i||i.getIndex()===null){t.position.set(0,0,0),t.velocity.set(0,0,1).multiplyScalar(t.startSpeed);return}for(var n=this._triangleIndexToArea.length-1,r=0,o=n,a=Math.random()*this._triangleIndexToArea[n];r+1<o;){var l=Math.floor((r+o)/2);a<this._triangleIndexToArea[l]?o=l:r=l}var c=Math.random(),h=Math.random();c+h>1&&(c=1-c,h=1-h);var u=i.getIndex().array[r*3],f=i.getIndex().array[r*3+1],p=i.getIndex().array[r*3+2],m=i.getAttribute("position");this._tempA.fromBufferAttribute(m,u),this._tempB.fromBufferAttribute(m,f),this._tempC.fromBufferAttribute(m,p),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,c).addScaledVector(this._tempC,h),t.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),t.velocity.copy(this._tempA).normalize().multiplyScalar(t.startSpeed)}},{key:"toJSON",value:function(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}},{key:"clone",value:function(){return new s(this._geometry)}}],[{key:"fromJSON",value:function(t,i){return new s(i.geometries[t.geometry])}}]),s}(),dV=function(){function s(){var e,t,i,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Rt(this,s),te(this,"type","grid"),te(this,"width",void 0),te(this,"height",void 0),te(this,"column",void 0),te(this,"row",void 0),this.width=(e=r.width)!==null&&e!==void 0?e:1,this.height=(t=r.height)!==null&&t!==void 0?t:1,this.column=(i=r.column)!==null&&i!==void 0?i:10,this.row=(n=r.row)!==null&&n!==void 0?n:10}return Pt(s,[{key:"initialize",value:function(t){var i=Math.floor(Math.random()*this.row),n=Math.floor(Math.random()*this.column);t.position.x=n*this.width/this.column-this.width/2,t.position.y=i*this.height/this.row-this.height/2,t.position.z=0,t.velocity.set(0,0,t.startSpeed)}},{key:"toJSON",value:function(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}},{key:"clone",value:function(){return new s({width:this.width,height:this.height,column:this.column,row:this.row})}}],[{key:"fromJSON",value:function(t){return new s(t)}}]),s}(),Pbe={cone:{type:"cone",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:lV,loadJSON:lV.fromJSON},donut:{type:"donut",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:cV,loadJSON:cV.fromJSON},point:{type:"point",params:[],constructor:hV,loadJSON:hV.fromJSON},sphere:{type:"sphere",params:[["radius","number"],["arc","radian"],["thickness","number"],["angle","radian"]],constructor:nO,loadJSON:nO.fromJSON},grid:{type:"grid",params:[["width","number"],["height","number"],["rows","number"],["column","number"]],constructor:dV,loadJSON:dV.fromJSON},mesh_surface:{type:"mesh_surface",params:[["geometry","geometry"]],constructor:uV,loadJSON:uV.fromJSON}};function Bbe(s,e){return Pbe[s.type].loadJSON(s,e)}var ht=function(s){return s[s.BillBoard=0]="BillBoard",s[s.StretchedBillBoard=1]="StretchedBillBoard",s[s.Mesh=2]="Mesh",s[s.Trail=3]="Trail",s[s.HorizontalBillBoard=4]="HorizontalBillBoard",s[s.VerticalBillBoard=5]="VerticalBillBoard",s}({}),xq=function(s){t0(t,s);var e=i0(t);function t(i){var n;Rt(this,t),n=e.call(this),te(ci(n),"type","VFXBatch"),te(ci(n),"systems",void 0),te(ci(n),"settings",void 0),te(ci(n),"maxParticles",void 0),n.maxParticles=1e3,n.systems=new Set;var r=new Vr;return r.mask=i.layers.mask,n.settings={instancingGeometry:i.instancingGeometry,renderMode:i.renderMode,renderOrder:i.renderOrder,material:i.material.clone(),uTileCount:i.uTileCount,vTileCount:i.vTileCount,layers:r},n.frustumCulled=!1,n.renderOrder=n.settings.renderOrder,n}return Pt(t,[{key:"addSystem",value:function(n){this.systems.add(n)}},{key:"removeSystem",value:function(n){this.systems.delete(n)}}]),t}(fe),Dbe=new S(0,0,1),KP=new Ce,Obe=new S,Lbe=new S;new S;var fV=60,kbe=new ps(1,1,1,1),Fbe=function(){function s(e){var t,i,n,r,o,a,l,c,h,u,f,p,m,v,g,y,A,_,b,x,E;Rt(this,s),te(this,"autoDestroy",void 0),te(this,"prewarm",void 0),te(this,"looping",void 0),te(this,"duration",void 0),te(this,"startLife",void 0),te(this,"startSpeed",void 0),te(this,"startRotation",void 0),te(this,"startSize",void 0),te(this,"startColor",void 0),te(this,"startTileIndex",void 0),te(this,"rendererEmitterSettings",void 0),te(this,"emissionOverTime",void 0),te(this,"emissionOverDistance",void 0),te(this,"emissionBursts",void 0),te(this,"onlyUsedByOther",void 0),te(this,"worldSpace",void 0),te(this,"speedFactor",void 0),te(this,"particleNum",void 0),te(this,"paused",void 0),te(this,"particles",void 0),te(this,"emitterShape",void 0),te(this,"emitter",void 0),te(this,"rendererSettings",void 0),te(this,"neededToUpdateRender",void 0),te(this,"behaviors",void 0),te(this,"prewarmed",void 0),te(this,"emissionState",void 0),te(this,"emitEnded",void 0),te(this,"markForDestroy",void 0),te(this,"previousWorldPos",void 0),te(this,"temp",new S),te(this,"travelDistance",0),te(this,"normalMatrix",new Ut),te(this,"_renderer",void 0),this.autoDestroy=e.autoDestroy===void 0?!1:e.autoDestroy,this.duration=(t=e.duration)!==null&&t!==void 0?t:1,this.looping=e.looping===void 0?!0:e.looping,this.prewarm=e.prewarm===void 0?!1:e.prewarm,this.startLife=(i=e.startLife)!==null&&i!==void 0?i:new Fr(5),this.startSpeed=(n=e.startSpeed)!==null&&n!==void 0?n:new Fr(0),this.startRotation=(r=e.startRotation)!==null&&r!==void 0?r:new Fr(0),this.startSize=(o=e.startSize)!==null&&o!==void 0?o:new Fr(1),this.startColor=(a=e.startColor)!==null&&a!==void 0?a:new EE(new Je(1,1,1,1)),this.emissionOverTime=(l=e.emissionOverTime)!==null&&l!==void 0?l:new Fr(10),this.emissionOverDistance=(c=e.emissionOverDistance)!==null&&c!==void 0?c:new Fr(0),this.emissionBursts=(h=e.emissionBursts)!==null&&h!==void 0?h:[],this.onlyUsedByOther=(u=e.onlyUsedByOther)!==null&&u!==void 0?u:!1,this.emitterShape=(f=e.shape)!==null&&f!==void 0?f:new nO,this.behaviors=(p=e.behaviors)!==null&&p!==void 0?p:new Array,this.worldSpace=(m=e.worldSpace)!==null&&m!==void 0?m:!1,this.speedFactor=(v=e.speedFactor)!==null&&v!==void 0?v:0,this.rendererEmitterSettings=(g=e.rendererEmitterSettings)!==null&&g!==void 0?g:{},this.rendererSettings={instancingGeometry:(y=e.instancingGeometry)!==null&&y!==void 0?y:kbe,renderMode:(A=e.renderMode)!==null&&A!==void 0?A:ht.BillBoard,renderOrder:(_=e.renderOrder)!==null&&_!==void 0?_:0,material:e.material,uTileCount:(b=e.uTileCount)!==null&&b!==void 0?b:1,vTileCount:(x=e.vTileCount)!==null&&x!==void 0?x:1,layers:(E=e.layers)!==null&&E!==void 0?E:new Vr},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=e.startTileIndex||new Fr(0),this.emitter=new ube(this),this.paused=!1,this.particleNum=0,this.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}return Pt(s,[{key:"time",get:function(){return this.emissionState.time},set:function(t){this.emissionState.time=t}},{key:"layers",get:function(){return this.rendererSettings.layers}},{key:"texture",get:function(){return this.rendererSettings.material.map},set:function(t){this.rendererSettings.material.map=t,this.neededToUpdateRender=!0}},{key:"material",get:function(){return this.rendererSettings.material},set:function(t){this.rendererSettings.material=t,this.neededToUpdateRender=!0}},{key:"uTileCount",get:function(){return this.rendererSettings.uTileCount},set:function(t){this.rendererSettings.uTileCount=t,this.neededToUpdateRender=!0}},{key:"vTileCount",get:function(){return this.rendererSettings.vTileCount},set:function(t){this.rendererSettings.vTileCount=t,this.neededToUpdateRender=!0}},{key:"instancingGeometry",get:function(){return this.rendererSettings.instancingGeometry},set:function(t){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=t,this.neededToUpdateRender=!0}},{key:"renderMode",get:function(){return this.rendererSettings.renderMode},set:function(t){if((this.rendererSettings.renderMode!=ht.Trail&&t===ht.Trail||this.rendererSettings.renderMode==ht.Trail&&t!==ht.Trail)&&(this.restart(),this.particles.length=0),this.rendererSettings.renderMode!==t)switch(t){case ht.Trail:this.rendererEmitterSettings={startLength:new Fr(30),followLocalOrigin:!1};break;case ht.Mesh:this.rendererEmitterSettings={geometry:new ps(1,1)},this.startRotation=new Aq(new S(0,1,0),new Fr(0));break;case ht.BillBoard:case ht.VerticalBillBoard:case ht.HorizontalBillBoard:case ht.StretchedBillBoard:this.rendererEmitterSettings={},this.rendererSettings.renderMode===ht.Mesh&&(this.startRotation=new Fr(0));break}this.rendererSettings.renderMode=t,this.neededToUpdateRender=!0}},{key:"renderOrder",get:function(){return this.rendererSettings.renderOrder},set:function(t){this.rendererSettings.renderOrder=t,this.neededToUpdateRender=!0}},{key:"blending",get:function(){return this.rendererSettings.material.blending},set:function(t){this.rendererSettings.material.blending=t,this.neededToUpdateRender=!0}},{key:"pause",value:function(){this.paused=!0}},{key:"play",value:function(){this.paused=!1}},{key:"spawn",value:function(t,i,n){KP.setFromRotationMatrix(n);var r=Obe,o=KP,a=Lbe;n.decompose(r,o,a);for(var l=0;l<t;l++){for(this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===ht.Trail?this.particles.push(new hb):this.particles.push(new cb);var c=this.particles[this.particleNum-1];if(this.startColor.genColor(c.startColor,this.emissionState.time,{}),c.color.copy(c.startColor),c.startSpeed=this.startSpeed.genValue(i.time/this.duration),c.life=this.startLife.genValue(i.time/this.duration),c.age=0,c.startSize=this.startSize.genValue(i.time/this.duration),c.uvTile=Math.floor(this.startTileIndex.genValue()),c.size=c.startSize,this.rendererSettings.renderMode===ht.Mesh||this.rendererSettings.renderMode===ht.BillBoard||this.rendererSettings.renderMode===ht.VerticalBillBoard||this.rendererSettings.renderMode===ht.HorizontalBillBoard||this.rendererSettings.renderMode===ht.StretchedBillBoard){var h=c;this.rendererSettings.renderMode===ht.Mesh?(h.rotation instanceof Ce||(h.rotation=new Ce),this.startRotation.type==="rotation"?this.startRotation.genValue(h.rotation,i.time/this.duration):h.rotation.setFromAxisAngle(Dbe,this.startRotation.genValue(i.time/this.duration))):this.startRotation.type==="rotation"?h.rotation=0:h.rotation=this.startRotation.genValue(i.time/this.duration)}else if(this.rendererSettings.renderMode===ht.Trail){var u=c;u.length=this.rendererEmitterSettings.startLength.genValue(i.time/this.duration),u.reset()}if(this.emitterShape.initialize(c),this.rendererSettings.renderMode===ht.Trail&&this.rendererEmitterSettings.followLocalOrigin){var f=c;f.localPosition=new S().copy(f.position)}this.worldSpace?(c.position.applyMatrix4(n),c.startSize=c.startSize*(Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z))/3,c.size=c.startSize,c.velocity.multiply(a).applyMatrix3(this.normalMatrix),c.rotation&&c.rotation instanceof Ce&&c.rotation.multiplyQuaternions(KP,c.rotation)):this.onlyUsedByOther&&(c.parentMatrix=n);for(var p=0;p<this.behaviors.length;p++)this.behaviors[p].initialize(c)}}},{key:"endEmit",value:function(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0)}},{key:"dispose",value:function(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter)}},{key:"restart",value:function(){this.paused=!1,this.particleNum=0,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(function(t){t.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}},{key:"update",value:function(t){if(!this.paused){for(var i=this.emitter;i.parent;)i=i.parent;if(i.type!=="Scene"){this.dispose();return}if(this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(var n=0;n<this.duration*fV;n++)this.update(1/fV)}t>.1&&(t=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(t,this.emissionState,this.emitter.matrixWorld);for(var r=0;r<this.behaviors.length;r++){for(var o=0;o<this.particleNum;o++)this.particles[o].died||this.behaviors[r].update(this.particles[o],t);this.behaviors[r].frameUpdate(t)}for(var a=0;a<this.particleNum;a++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[a].localPosition?(this.particles[a].position.copy(this.particles[a].localPosition),this.particles[a].parentMatrix?this.particles[a].position.applyMatrix4(this.particles[a].parentMatrix):this.particles[a].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[a].position.addScaledVector(this.particles[a].velocity,t),this.particles[a].age+=t;if(this.rendererSettings.renderMode===ht.Trail)for(var l=0;l<this.particleNum;l++){var c=this.particles[l];c.update()}for(var h=0;h<this.particleNum;h++){var u=this.particles[h];u.died&&(!(u instanceof hb)||u.previous.length===0)&&(this.particles[h]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=u,this.particleNum--,h--)}}}},{key:"emit",value:function(t,i,n){i.time>this.duration&&(this.looping?(i.time-=this.duration,i.burstIndex=0,this.behaviors.forEach(function(c){c.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(n);var r=Math.ceil(i.waitEmiting);for(this.spawn(r,i,n),i.waitEmiting-=r;i.burstIndex<this.emissionBursts.length&&this.emissionBursts[i.burstIndex].time<=i.time;){if(Math.random()<this.emissionBursts[i.burstIndex].probability){var o=this.emissionBursts[i.burstIndex].count;this.spawn(o,i,n)}i.burstIndex++}if(!this.emitEnded&&(i.waitEmiting+=t*this.emissionOverTime.genValue(i.time/this.duration),this.previousWorldPos!=null)){this.emitter.getWorldPosition(this.temp),this.travelDistance+=this.previousWorldPos.distanceTo(this.temp);var a=this.emissionOverDistance.genValue(i.time/this.duration);if(this.travelDistance*a>0){var l=Math.floor(this.travelDistance*a);this.travelDistance-=l/a,i.waitEmiting+=l}}this.previousWorldPos===void 0&&(this.previousWorldPos=new S),this.emitter.getWorldPosition(this.previousWorldPos),i.time+=t}},{key:"toJSON",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t===void 0||typeof t=="string";if(n&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),t.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(t),i.useUrlForImage&&this.texture.source!==void 0){var r=this.texture.source;t.images[r.uuid]={uuid:r.uuid,url:this.texture.image.url}}var o;this.renderMode===ht.Trail?o={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===ht.Mesh?o={}:o={};var a=this.rendererSettings.instancingGeometry;return t.geometries&&!t.geometries[a.uuid]&&(t.geometries[a.uuid]=a.toJSON()),{version:"2.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:o,speedFactor:this.renderMode===ht.StretchedBillBoard?this.speedFactor:0,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:this.behaviors.map(function(l){return l.toJSON()}),worldSpace:this.worldSpace}}},{key:"addBehavior",value:function(t){this.behaviors.push(t)}},{key:"getRendererSettings",value:function(){return this.rendererSettings}},{key:"clone",value:function(){var t=[],i=zH(this.emissionBursts),n;try{for(i.s();!(n=i.n()).done;){var r=n.value,o={};Object.assign(o,r),t.push(o)}}catch(p){i.e(p)}finally{i.f()}var a=[],l=zH(this.behaviors),c;try{for(l.s();!(c=l.n()).done;){var h=c.value;a.push(h.clone())}}catch(p){l.e(p)}finally{l.f()}var u;this.renderMode===ht.Trail?u={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:u={};var f=new Vr;return f.mask=this.layers.mask,new s({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:t,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:u,speedFactor:this.speedFactor,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,behaviors:a,worldSpace:this.worldSpace,layers:f})}}],[{key:"fromJSON",value:function(t,i,n){var r,o=Bbe(t.shape,i),a;t.renderMode===ht.Trail?a={startLength:t.rendererEmitterSettings.startLength!=null?en(t.rendererEmitterSettings.startLength):new Fr(30),followLocalOrigin:t.rendererEmitterSettings.followLocalOrigin}:t.renderMode===ht.Mesh?a={}:a={};var l=new Vr;t.layers&&(l.mask=t.layers);var c=new s({autoDestroy:t.autoDestroy,looping:t.looping,prewarm:t.prewarm,duration:t.duration,shape:o,startLife:en(t.startLife),startSpeed:en(t.startSpeed),startRotation:bbe(t.startRotation),startSize:en(t.startSize),startColor:sU(t.startColor),emissionOverTime:en(t.emissionOverTime),emissionOverDistance:en(t.emissionOverDistance),emissionBursts:t.emissionBursts,onlyUsedByOther:t.onlyUsedByOther,instancingGeometry:i.geometries[t.instancingGeometry],renderMode:t.renderMode,rendererEmitterSettings:a,renderOrder:t.renderOrder,speedFactor:t.speedFactor,layers:l,material:t.material?i.materials[t.material]:t.texture?new ti({map:i.textures[t.texture],transparent:(r=t.transparent)!==null&&r!==void 0?r:!0,blending:t.blending,side:_i}):new ti({color:16777215,transparent:!0,blending:Yp,side:_i}),startTileIndex:typeof t.startTileIndex=="number"?new Fr(t.startTileIndex):en(t.startTileIndex),uTileCount:t.uTileCount,vTileCount:t.vTileCount,behaviors:[],worldSpace:t.worldSpace});return c.behaviors=t.behaviors.map(function(h){var u=Rbe(h,c);return u.type==="EmitSubParticleSystem"&&(n[h.subParticleSystem]=u),u}),c}}]),s}(),JP=`

#include <common>
#include <uv_pars_fragment>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #ifdef USE_MAP
    diffuseColor *= texture2D( map, vMapUv);
    #endif
    
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    
    #include <tonemapping_fragment>

}
`,Ube=`
#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;
#ifdef USE_SHEENCOLORMAP
uniform sampler2D sheenColorMap;
#endif
#ifdef USE_SHEENROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {
    #include <clipping_planes_fragment>
    vec4 diffuseColor = vec4( diffuse, opacity );
    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
    vec3 totalEmissiveRadiance = emissive;
    #include <logdepthbuf_fragment>
    #include <map_fragment>
    #include <color_fragment>
    #include <alphamap_fragment>
    #include <alphatest_fragment>
    #include <roughnessmap_fragment>
    #include <metalnessmap_fragment>
    #include <normal_fragment_begin>
    #include <normal_fragment_maps>
    #include <clearcoat_normal_fragment_begin>
    #include <clearcoat_normal_fragment_maps>
    #include <emissivemap_fragment>
    // accumulation
    #include <lights_physical_fragment>
    #include <lights_fragment_begin>
    #include <lights_fragment_maps>
    #include <lights_fragment_end>
    // modulation
    #include <aomap_fragment>
    vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
    vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #include <transmission_fragment>
    vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
    #ifdef USE_SHEEN
    // Sheen energy compensation approximation calculation can be found at the end of
        // https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
        float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
        outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
    #endif
    #ifdef USE_CLEARCOAT
        float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
        vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
        outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
    #endif
    #include <output_fragment>
    #include <tonemapping_fragment>
    #include <encodings_fragment>
    #include <fog_fragment>
    #include <premultiplied_alpha_fragment>
    #include <dithering_fragment>
}`,Rx=`

    #ifdef UV_TILE
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        mat3 tileTransform = mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    #else
        mat3 tileTransform = mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    #endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif
`,Nbe=`
#include <common>
#include <color_pars_vertex>
#include <uv_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(Rx,`
	
    vec2 alignedPosition = ( position.xy ) * size;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),zbe=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
// attribute vec4 color;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

void main() {

    `.concat(Rx,`
    
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`),Gbe=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute float size;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {
    `.concat(Rx,`

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size, sy = size, sz = size;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}
`),Hbe=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute float size;
attribute vec3 velocity;
attribute float uvTile;

#ifdef UV_TILE
uniform vec2 tileCount;
#endif

uniform float speedFactor;

void main() {

    `.concat(Rx,`
	
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity;

    vec3 scaledPos = vec3(position.xy * size, position.z);
    mvPosition.xyz += scaledPos + dot(scaledPos, viewVelocity) * viewVelocity / length(viewVelocity) * speedFactor;

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>

}
`);function sO(s){return s===0?"uv":"uv".concat(s)}new S(0,0,1);var Vbe=function(s){t0(t,s);var e=i0(t);function t(i){var n;return Rt(this,t),n=e.call(this,i),te(ci(n),"offsetBuffer",void 0),te(ci(n),"rotationBuffer",void 0),te(ci(n),"sizeBuffer",void 0),te(ci(n),"colorBuffer",void 0),te(ci(n),"uvTileBuffer",void 0),te(ci(n),"velocityBuffer",void 0),te(ci(n),"vector_",new S),te(ci(n),"vector2_",new S),te(ci(n),"vector3_",new S),te(ci(n),"quaternion_",new Ce),te(ci(n),"quaternion2_",new Ce),te(ci(n),"quaternion3_",new Ce),te(ci(n),"rotationMat_",new Ut),te(ci(n),"rotationMat2_",new Ut),n.maxParticles=1e3,n.setupBuffers(),n.rebuildMaterial(),n}return Pt(t,[{key:"buildExpandableBuffers",value:function(){this.offsetBuffer=new Po(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(Ur),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new Po(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(Ur),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===ht.Mesh?(this.rotationBuffer=new Po(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(Ur),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===ht.BillBoard||this.settings.renderMode===ht.HorizontalBillBoard||this.settings.renderMode===ht.VerticalBillBoard||this.settings.renderMode===ht.StretchedBillBoard)&&(this.rotationBuffer=new Po(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(Ur),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new Po(new Float32Array(this.maxParticles),1),this.sizeBuffer.setUsage(Ur),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new Po(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(Ur),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===ht.StretchedBillBoard&&(this.velocityBuffer=new Po(new Float32Array(this.maxParticles*3),3),this.velocityBuffer.setUsage(Ur),this.geometry.setAttribute("velocity",this.velocityBuffer))}},{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new bM,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}},{key:"expandBuffers",value:function(n){for(;n>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var n,r={};if(this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"){var o=this.settings.material;n=vv.merge([ze.common,ze.envmap,ze.aomap,ze.lightmap,ze.emissivemap,ze.bumpmap,ze.normalmap,ze.displacementmap,ze.roughnessmap,ze.metalnessmap,ze.fog,ze.lights,{emissive:{value:new Ae(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),n.diffuse.value=o.color,n.opacity.value=o.opacity,n.emissive.value=o.emissive,n.roughness.value=o.roughness,n.metalness.value=o.metalness,o.envMap&&(n.envMap.value=o.envMap,n.envMapIntensity.value=o.envMapIntensity),o.normalMap&&(n.normalMap.value=o.normalMap,n.normalScale.value=o.normalScale),o.roughnessMap&&(n.roughnessMap.value=o.roughnessMap),o.metalnessMap&&(n.metalnessMap.value=o.metalnessMap),o.map&&(n.map=new Se(o.map))}else n={},n.map=new Se(this.settings.material.map);this.settings.material.alphaTest&&(r.USE_ALPHATEST="",n.alphaTest=new Se(this.settings.material.alphaTest)),r.USE_UV="";var a=this.settings.uTileCount,l=this.settings.vTileCount;(a>1||l>1)&&(r.UV_TILE="",n.tileCount=new Se(new ee(a,l))),this.settings.material.normalMap&&(r.USE_NORMALMAP="",r.NORMALMAP_UV=sO(this.settings.material.normalMap.channel),n.normalMapTransform=new Se(new Ut().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=sO(this.settings.material.map.channel),n.mapTransform=new Se(new Ut().copy(this.settings.material.map.matrix))),r.USE_COLOR_ALPHA="";var c=!1;if(this.settings.renderMode===ht.BillBoard||this.settings.renderMode===ht.VerticalBillBoard||this.settings.renderMode===ht.HorizontalBillBoard||this.settings.renderMode===ht.Mesh){var h,u;this.settings.renderMode===ht.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(r.USE_COLOR="",h=Gbe,u=Ube,c=!0):(h=zbe,u=JP):(h=Nbe,u=JP),this.settings.renderMode===ht.VerticalBillBoard?r.VERTICAL="":this.settings.renderMode===ht.HorizontalBillBoard&&(r.HORIZONTAL=""),this.material=new kt({uniforms:n,defines:r,vertexShader:h,fragmentShader:u,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,lights:c})}else if(this.settings.renderMode===ht.StretchedBillBoard)n.speedFactor=new Se(1),this.material=new kt({uniforms:n,defines:r,vertexShader:Hbe,fragmentShader:JP,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var n=this,r=0,o=0;this.systems.forEach(function(a){o+=a.particleNum}),o>this.maxParticles&&this.expandBuffers(o),this.systems.forEach(function(a){var l=a.particles,c=a.particleNum,h=n.quaternion2_,u=n.vector2_,f=n.vector3_;a.emitter.matrixWorld.decompose(u,h,f),n.rotationMat_.setFromMatrix4(a.emitter.matrixWorld);for(var p=0;p<c;p++,r++){var m=l[p];if(n.settings.renderMode===ht.Mesh){var v=void 0;if(a.worldSpace)v=m.rotation;else{var g=void 0;m.parentMatrix?g=n.quaternion3_.setFromRotationMatrix(m.parentMatrix):g=h,v=n.quaternion_,v.copy(m.rotation).multiply(g)}n.rotationBuffer.setXYZW(r,v.x,v.y,v.z,v.w)}else(n.settings.renderMode===ht.StretchedBillBoard||n.settings.renderMode===ht.VerticalBillBoard||n.settings.renderMode===ht.HorizontalBillBoard||n.settings.renderMode===ht.BillBoard)&&n.rotationBuffer.setX(r,m.rotation);var y=void 0;if(a.worldSpace?y=m.position:(y=n.vector_,m.parentMatrix?y.copy(m.position).applyMatrix4(m.parentMatrix):y.copy(m.position).applyMatrix4(a.emitter.matrixWorld)),n.offsetBuffer.setXYZ(r,y.x,y.y,y.z),n.colorBuffer.setXYZW(r,m.color.x,m.color.y,m.color.z,m.color.w),a.worldSpace||m.parentMatrix?n.sizeBuffer.setX(r,m.size):n.sizeBuffer.setX(r,m.size*(Math.abs(f.x)+Math.abs(f.y)+Math.abs(f.z))/3),n.uvTileBuffer.setX(r,m.uvTile),n.settings.renderMode===ht.StretchedBillBoard&&n.velocityBuffer){var A=a.speedFactor,_=void 0;a.worldSpace?_=m.velocity:(_=n.vector_,m.parentMatrix?(n.rotationMat2_.setFromMatrix4(m.parentMatrix),_.copy(m.velocity).applyMatrix3(n.rotationMat2_)):_.copy(m.velocity).applyMatrix3(n.rotationMat_)),n.velocityBuffer.setXYZ(r,_.x*A,_.y*A,_.z*A)}}}),this.geometry.instanceCount=r,r>0&&(this.offsetBuffer.updateRange.count=r*3,this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.updateRange.count=r,this.sizeBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.updateRange.count=r,this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===ht.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.updateRange.count=r*3,this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===ht.Mesh?(this.rotationBuffer.updateRange.count=r*4,this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===ht.StretchedBillBoard||this.settings.renderMode===ht.HorizontalBillBoard||this.settings.renderMode===ht.VerticalBillBoard||this.settings.renderMode===ht.BillBoard)&&(this.rotationBuffer.updateRange.count=r,this.rotationBuffer.needsUpdate=!0))}},{key:"dispose",value:function(){this.geometry.dispose()}}]),t}(xq),Qbe=`

#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 c = vColor;
    
    #ifdef USE_MAP
    c *= texture2D( map, vUv * repeat );
    #endif
    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUv * repeat ).a;
    if( c.a < alphaTest ) discard;
    gl_FragColor = c;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,Wbe=`
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    `.concat(Rx,`
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`);new S(0,0,1);var jbe=function(s){t0(t,s);var e=i0(t);function t(i){var n;return Rt(this,t),n=e.call(this,i),te(ci(n),"positionBuffer",void 0),te(ci(n),"previousBuffer",void 0),te(ci(n),"nextBuffer",void 0),te(ci(n),"uvBuffer",void 0),te(ci(n),"sideBuffer",void 0),te(ci(n),"widthBuffer",void 0),te(ci(n),"colorBuffer",void 0),te(ci(n),"indexBuffer",void 0),te(ci(n),"vector_",new S),te(ci(n),"vector2_",new S),te(ci(n),"vector3_",new S),te(ci(n),"quaternion_",new Ce),n.maxParticles=1e4,n.setupBuffers(),n.rebuildMaterial(),n}return Pt(t,[{key:"setupBuffers",value:function(){this.geometry&&this.geometry.dispose(),this.geometry=new yt,this.indexBuffer=new Ke(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(Ur),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new Ke(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(Ur),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new Ke(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(Ur),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new Ke(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(Ur),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new Ke(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(Ur),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new Ke(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(Ur),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new Ke(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(Ur),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new Ke(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(Ur),this.geometry.setAttribute("color",this.colorBuffer)}},{key:"expandBuffers",value:function(n){for(;n>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}},{key:"rebuildMaterial",value:function(){this.layers.mask=this.settings.layers.mask;var n={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new ee(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{value:new ee(1,1)}},r={};if(r.USE_UV="",r.USE_COLOR_ALPHA="",this.settings.material.map&&(r.USE_MAP="",r.MAP_UV=sO(this.settings.material.map.channel),n.map=new Se(this.settings.material.map),n.mapTransform=new Se(new Ut().copy(this.settings.material.map.matrix))),this.settings.renderMode===ht.Trail)this.material=new kt({uniforms:n,defines:r,vertexShader:Wbe,fragmentShader:Qbe,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||Yp});else throw new Error("render mode unavailable")}},{key:"update",value:function(){var n=this,r=0,o=0,a=0;this.systems.forEach(function(l){for(var c=0;c<l.particleNum;c++)a+=l.particles[c].previous.length*2}),a>this.maxParticles&&this.expandBuffers(a),this.systems.forEach(function(l){var c=n.quaternion_,h=n.vector2_,u=n.vector3_;l.emitter.matrixWorld.decompose(h,c,u);for(var f=l.particles,p=l.particleNum,m=n.settings.uTileCount,v=n.settings.vTileCount,g=1/m,y=1/v,A=0;A<p;A++){var _=f[A],b=_.uvTile%v,x=Math.floor(_.uvTile/v),E=_.previous.values(),M=E.next(),T=M.value,R=T;M.done||(M=E.next());var w=void 0;M.value!==void 0?w=M.value:w=R;for(var I=0;I<_.previous.length;I++,r+=2){if(n.positionBuffer.setXYZ(r,R.position.x,R.position.y,R.position.z),n.positionBuffer.setXYZ(r+1,R.position.x,R.position.y,R.position.z),l.worldSpace?(n.positionBuffer.setXYZ(r,R.position.x,R.position.y,R.position.z),n.positionBuffer.setXYZ(r+1,R.position.x,R.position.y,R.position.z)):(_.parentMatrix?n.vector_.copy(R.position).applyMatrix4(_.parentMatrix):n.vector_.copy(R.position).applyMatrix4(l.emitter.matrixWorld),n.positionBuffer.setXYZ(r,n.vector_.x,n.vector_.y,n.vector_.z),n.positionBuffer.setXYZ(r+1,n.vector_.x,n.vector_.y,n.vector_.z)),l.worldSpace?(n.previousBuffer.setXYZ(r,T.position.x,T.position.y,T.position.z),n.previousBuffer.setXYZ(r+1,T.position.x,T.position.y,T.position.z)):(_.parentMatrix?n.vector_.copy(T.position).applyMatrix4(_.parentMatrix):n.vector_.copy(T.position).applyMatrix4(l.emitter.matrixWorld),n.previousBuffer.setXYZ(r,n.vector_.x,n.vector_.y,n.vector_.z),n.previousBuffer.setXYZ(r+1,n.vector_.x,n.vector_.y,n.vector_.z)),l.worldSpace?(n.nextBuffer.setXYZ(r,w.position.x,w.position.y,w.position.z),n.nextBuffer.setXYZ(r+1,w.position.x,w.position.y,w.position.z)):(_.parentMatrix?n.vector_.copy(w.position).applyMatrix4(_.parentMatrix):n.vector_.copy(w.position).applyMatrix4(l.emitter.matrixWorld),n.nextBuffer.setXYZ(r,n.vector_.x,n.vector_.y,n.vector_.z),n.nextBuffer.setXYZ(r+1,n.vector_.x,n.vector_.y,n.vector_.z)),n.sideBuffer.setX(r,-1),n.sideBuffer.setX(r+1,1),l.worldSpace)n.widthBuffer.setX(r,R.size),n.widthBuffer.setX(r+1,R.size);else if(_.parentMatrix)n.widthBuffer.setX(r,R.size),n.widthBuffer.setX(r+1,R.size);else{var O=(Math.abs(u.x)+Math.abs(u.y)+Math.abs(u.z))/3;n.widthBuffer.setX(r,R.size*O),n.widthBuffer.setX(r+1,R.size*O)}n.uvBuffer.setXY(r,(I/_.previous.length+b)*g,(v-x-1)*y),n.uvBuffer.setXY(r+1,(I/_.previous.length+b)*g,(v-x)*y),n.colorBuffer.setXYZW(r,R.color.x,R.color.y,R.color.z,R.color.w),n.colorBuffer.setXYZW(r+1,R.color.x,R.color.y,R.color.z,R.color.w),I+1<_.previous.length&&(n.indexBuffer.setX(o*3,r),n.indexBuffer.setX(o*3+1,r+1),n.indexBuffer.setX(o*3+2,r+2),o++,n.indexBuffer.setX(o*3,r+2),n.indexBuffer.setX(o*3+1,r+1),n.indexBuffer.setX(o*3+2,r+3),o++),T=R,R=w,M.done||(M=E.next(),M.value!==void 0&&(w=M.value))}}}),this.positionBuffer.updateRange.count=r*3,this.positionBuffer.needsUpdate=!0,this.previousBuffer.updateRange.count=r*3,this.previousBuffer.needsUpdate=!0,this.nextBuffer.updateRange.count=r*3,this.nextBuffer.needsUpdate=!0,this.sideBuffer.updateRange.count=r,this.sideBuffer.needsUpdate=!0,this.widthBuffer.updateRange.count=r,this.widthBuffer.needsUpdate=!0,this.uvBuffer.updateRange.count=r*2,this.uvBuffer.needsUpdate=!0,this.colorBuffer.updateRange.count=r*4,this.colorBuffer.needsUpdate=!0,this.indexBuffer.updateRange.count=o*3,this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,o*3)}},{key:"dispose",value:function(){this.geometry.dispose()}}]),t}(xq),qbe=function(s){t0(t,s);var e=i0(t);function t(){var i;return Rt(this,t),i=e.call(this),te(ci(i),"batches",[]),te(ci(i),"systemToBatchIndex",new Map),te(ci(i),"type","BatchedRenderer"),i}return Pt(t,[{key:"addSystem",value:function(n){n._renderer=this;for(var r=n.getRendererSettings(),o=0;o<this.batches.length;o++)if(t.equals(this.batches[o].settings,r)){this.batches[o].addSystem(n),this.systemToBatchIndex.set(n,o);return}var a;switch(r.renderMode){case ht.Trail:a=new jbe(r);break;case ht.Mesh:case ht.BillBoard:case ht.VerticalBillBoard:case ht.HorizontalBillBoard:case ht.StretchedBillBoard:a=new Vbe(r);break}a.addSystem(n),this.batches.push(a),this.systemToBatchIndex.set(n,this.batches.length-1),this.add(a)}},{key:"deleteSystem",value:function(n){var r=this.systemToBatchIndex.get(n);r!=null&&(this.batches[r].removeSystem(n),this.systemToBatchIndex.delete(n))}},{key:"updateSystem",value:function(n){this.deleteSystem(n),this.addSystem(n)}},{key:"update",value:function(n){this.systemToBatchIndex.forEach(function(o,a){a.update(n)});for(var r=0;r<this.batches.length;r++)this.batches[r].update()}}],[{key:"equals",value:function(n,r){return n.material.side===r.material.side&&n.material.blending===r.material.blending&&n.material.transparent===r.material.transparent&&n.material.type===r.material.type&&n.material.alphaTest===r.material.alphaTest&&n.material.map===r.material.map&&n.renderMode===r.renderMode&&n.uTileCount===r.uTileCount&&n.vTileCount===r.vTileCount&&n.instancingGeometry===r.instancingGeometry&&n.renderOrder===r.renderOrder&&n.layers.mask===r.layers.mask}}]),t}(ye),Xbe=qbe,pV=function(){function s(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new S;Rt(this,s),te(this,"locations",[]),this.scaleX=e,this.scaleY=t,this.position=i}return Pt(s,[{key:"transform",value:function(t,i){t.x=this.locations[i%this.locations.length].x*this.scaleX+this.position.x,t.y=this.locations[i%this.locations.length].y*this.scaleY+this.position.y,t.z=this.position.z}},{key:"clone",value:function(){var t=new s(this.scaleX,this.scaleY,this.position.clone());return t.locations=this.locations.map(function(i){return i.clone()}),t}},{key:"toJSON",value:function(){return{scaleX:this.scaleX,scaleY:this.scaleY,position:this.position,locations:this.locations.map(function(t){return{x:t.x,y:t.y}})}}},{key:"fromImage",value:function(t,i){var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");if(r){r.drawImage(t,0,0);var o=r.getImageData(0,0,n.width,n.height,{colorSpace:"srgb"});n.remove(),this.locations.length=0;for(var a=0;a<o.height;a++)for(var l=0;l<o.width;l++)o.data[(a*o.width+l)*4+3]>i&&this.locations.push(new ee(l,o.height-a))}}}],[{key:"fromJSON",value:function(t){var i=new s(t.scaleX,t.scaleY,new S(t.position[0],t.position[1],t.position[2]));return i.locations=t.locations.map(function(n){return new ee(n.x,n.y)}),i}}]),s}();function Ybe(s){switch(s.type){case"TextureSequencer":return pV.fromJSON(s);default:return new pV}}var Kbe=function(){function s(e){Rt(this,s),te(this,"type","ApplySequences"),te(this,"sequencers",[]),te(this,"time",0),te(this,"index",0),te(this,"pCount",0),te(this,"delay",void 0),te(this,"tempV",new S),this.delay=e}return Pt(s,[{key:"initialize",value:function(t){t.id=this.pCount,t.dst=new S,t.begin=new S,t.inMotion=!1,this.pCount++}},{key:"reset",value:function(){this.time=0,this.index=0,this.pCount=0}},{key:"update",value:function(t,i){var n=this.sequencers[this.index],r=t.id*this.delay;this.time>=n[0].a+r&&this.time<=n[0].b+r?(t.inMotion||(t.inMotion=!0,t.begin.copy(t.position),n[1].transform(t.dst,t.id)),t.position.lerpVectors(t.begin,t.dst,s.BEZIER.genValue((this.time-n[0].a-r)/(n[0].b-n[0].a)))):this.time>n[0].b+r&&(t.inMotion=!1)}},{key:"frameUpdate",value:function(t){for(;this.index+1<this.sequencers.length&&this.time>=this.sequencers[this.index+1][0].a;)this.index++;this.time+=t}},{key:"appendSequencer",value:function(t,i){this.sequencers.push([t,i])}},{key:"toJSON",value:function(){return{type:this.type,delay:this.delay,sequencers:this.sequencers.map(function(t){var i=Qy(t,2),n=i[0],r=i[1];return{range:n.toJSON(),sequencer:r.toJSON()}})}}},{key:"clone",value:function(){var t=new s(this.delay);return t.sequencers=this.sequencers.map(function(i){return[i[0].clone(),i[1].clone()]}),t}}],[{key:"fromJSON",value:function(t){var i=new s(t.delay);return t.sequencers.forEach(function(n){i.sequencers.push([en(n.range),Ybe(n.sequencer)])}),i}}]),s}();te(Kbe,"BEZIER",new eO(0,0,1,1));var de=function(s){return s[s.Number=0]="Number",s[s.Vec2=1]="Vec2",s[s.Vec3=2]="Vec3",s[s.Vec4=3]="Vec4",s[s.Boolean=4]="Boolean",s[s.AnyType=5]="AnyType",s}({}),mV=Pt(function s(e,t,i,n){Rt(this,s),te(this,"input",void 0),te(this,"inputIndex",void 0),te(this,"output",void 0),te(this,"outputIndex",void 0),this.input=e,this.inputIndex=t,this.input.outputs[t].push(this),this.output=i,this.outputIndex=n,this.output.inputs[n]=this}),Jbe=function(){function s(){Rt(this,s),te(this,"visited",new Set),te(this,"graph_",void 0),te(this,"context_",void 0),s.Instance=this}return Pt(s,[{key:"traverse",value:function(t){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");this.visited.add(t.id);for(var i=[],n=0;n<t.inputs.length;n++)if(t.inputs[n]instanceof mV){var r=t.inputs[n].input;this.visited.has(r.id)||this.traverse(r),i.push(r.outputValues[t.inputs[n].inputIndex])}else i.push(t.inputs[n].getValue(this.context_));t.func(this.context_,i,t.outputValues),this.graph_.nodesInOrder.push(t)}},{key:"executeCompiledGraph",value:function(){if(this.context_===void 0)throw new Error("context is undefined");if(this.graph_===void 0)throw new Error("graph is undefined");for(var t=this.graph_.nodesInOrder,i=0;i<t.length;i++){for(var n=[],r=t[i],o=0;o<r.inputs.length;o++)if(r.inputs[o]instanceof mV)n.push(r.inputs[o].input.outputValues[r.inputs[o].inputIndex]);else if(r.inputs[o]!==void 0)n.push(r.inputs[o].getValue(this.context_));else throw new Error("miss input for node ".concat(r.id));r.func(this.context_,n,r.outputValues)}}},{key:"run",value:function(t,i){if(this.graph_=t,this.context_=i,t.compiled)this.executeCompiledGraph();else{t.nodesInOrder.length=0,this.visited.clear();for(var n=0;n<t.outputNodes.length;n++){var r=t.outputNodes[n];this.traverse(r)}t.compiled=!0}}}]),s}();te(Jbe,"Instance",void 0);var vi=function(){function s(e){Rt(this,s),te(this,"name",void 0),te(this,"nodeTypeSignatures",[]),this.name=e}return Pt(s,[{key:"addSignature",value:function(t,i,n){this.nodeTypeSignatures.push({inputTypes:t,outputTypes:i,func:n})}}]),s}(),FT=new vi("add");FT.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=t[0]+t[1]});FT.addSignature([de.Vec2,de.Vec2],[de.Vec2],function(s,e,t,i){i[0].addVectors(t[0],t[1])});FT.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(s,e,t,i){i[0].addVectors(t[0],t[1])});FT.addSignature([de.Vec4,de.Vec4],[de.Vec4],function(s,e,t,i){i[0].addVectors(t[0],t[1])});var UT=new vi("sub");UT.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=t[0]-t[1]});UT.addSignature([de.Vec2,de.Vec2],[de.Vec2],function(s,e,t,i){i[0].subVectors(t[0],t[1])});UT.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(s,e,t,i){i[0].subVectors(t[0],t[1])});UT.addSignature([de.Vec4,de.Vec4],[de.Vec4],function(s,e,t,i){i[0].subVectors(t[0],t[1])});var NT=new vi("mul");NT.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=t[0]*t[1]});NT.addSignature([de.Vec2,de.Number],[de.Vec2],function(s,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});NT.addSignature([de.Vec3,de.Number],[de.Vec3],function(s,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});NT.addSignature([de.Vec4,de.Number],[de.Vec4],function(s,e,t,i){i[0].copy(t[0]).multiplyScalar(t[1])});var zT=new vi("div");zT.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=t[0]/t[1]});zT.addSignature([de.Vec2,de.Number],[de.Vec2],function(s,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});zT.addSignature([de.Vec3,de.Number],[de.Vec3],function(s,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});zT.addSignature([de.Vec4,de.Number],[de.Vec4],function(s,e,t,i){i[0].copy(t[0]).divideScalar(t[1])});var Zbe=new vi("sin");Zbe.addSignature([de.Number],[de.Number],function(s,e,t,i){i[0]=Math.sin(t[0])});var $be=new vi("cos");$be.addSignature([de.Number],[de.Number],function(s,e,t,i){i[0]=Math.cos(t[0])});var exe=new vi("tan");exe.addSignature([de.Number],[de.Number],function(s,e,t,i){i[0]=Math.tan(t[0])});var txe=new vi("abs");txe.addSignature([de.Number],[de.Number],function(s,e,t,i){i[0]=Math.abs(t[0])});var ixe=new vi("min");ixe.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=Math.min(t[0],t[1])});var nxe=new vi("max");nxe.addSignature([de.Number,de.Number],[de.Number],function(s,e,t,i){i[0]=Math.max(t[0],t[1])});var rU=new vi("dot");rU.addSignature([de.Vec2,de.Vec2],[de.Number],function(s,e,t,i){i[0]=t[0].dot(t[1])});rU.addSignature([de.Vec3,de.Vec3],[de.Number],function(s,e,t,i){i[0]=t[0].dot(t[1])});rU.addSignature([de.Vec4,de.Vec4],[de.Number],function(s,e,t,i){i[0]=t[0].dot(t[1])});var sxe=new vi("cross");sxe.addSignature([de.Vec3,de.Vec3],[de.Vec3],function(s,e,t,i){i[0].crossVectors(t[0],t[1])});var oU=new vi("length");oU.addSignature([de.Vec2],[de.Number],function(s,e,t,i){i[0]=t[0].length()});oU.addSignature([de.Vec3],[de.Number],function(s,e,t,i){i[0]=t[0].length()});oU.addSignature([de.Vec4],[de.Number],function(s,e,t,i){i[0]=t[0].length()});var aU=new vi("lengthSq");aU.addSignature([de.Vec2],[de.Number],function(s,e,t,i){i[0]=t[0].lengthSq()});aU.addSignature([de.Vec3],[de.Number],function(s,e,t,i){i[0]=t[0].lengthSq()});aU.addSignature([de.Vec4],[de.Number],function(s,e,t,i){i[0]=t[0].lengthSq()});var lU=new vi("normalize");lU.addSignature([de.Vec2],[de.Vec2],function(s,e,t,i){i[0].copy(t[0]).normalize()});lU.addSignature([de.Vec3],[de.Vec3],function(s,e,t,i){i[0].copy(t[0]).normalize()});lU.addSignature([de.Vec4],[de.Vec4],function(s,e,t,i){i[0].copy(t[0]).normalize()});var wq=new vi("distance");wq.addSignature([de.Vec2,de.Vec2],[de.Number],function(s,e,t,i){i[0]=t[0].distanceTo(t[1])});wq.addSignature([de.Vec3,de.Vec3],[de.Number],function(s,e,t,i){i[0]=t[0].distanceTo(t[1])});var rxe=new vi("and");rxe.addSignature([de.Boolean,de.Boolean],[de.Boolean],function(s,e,t,i){i[0]=t[0]&&t[1]});var oxe=new vi("or");oxe.addSignature([de.Boolean,de.Boolean],[de.Boolean],function(s,e,t,i){i[0]=t[0]||t[1]});var axe=new vi("not");axe.addSignature([de.Boolean],[de.Boolean],function(s,e,t,i){i[0]=!t[0]});var GT=new vi("equal");GT.addSignature([de.Number,de.Number],[de.Boolean],function(s,e,t,i){i[0]=t[0]===t[1]});GT.addSignature([de.Vec2,de.Vec2],[de.Boolean],function(s,e,t,i){i[0]=t[0].equals(t[1])});GT.addSignature([de.Vec3,de.Vec3],[de.Boolean],function(s,e,t,i){i[0]=t[0].equals(t[1])});GT.addSignature([de.Vec4,de.Vec4],[de.Boolean],function(s,e,t,i){i[0]=t[0].equals(t[1])});var lxe=new vi("lessThan");lxe.addSignature([de.Number,de.Number],[de.Boolean],function(s,e,t,i){i[0]=t[0]<t[1]});var cxe=new vi("greaterThan");cxe.addSignature([de.Number,de.Number],[de.Boolean],function(s,e,t,i){i[0]=t[0]>t[1]});var hxe=new vi("lessThanOrEqual");hxe.addSignature([de.Number,de.Number],[de.Boolean],function(s,e,t,i){i[0]=t[0]<=t[1]});var uxe=new vi("greaterThanOrEqual");uxe.addSignature([de.Number,de.Number],[de.Boolean],function(s,e,t,i){i[0]=t[0]>=t[1]});var dxe=new vi("if");dxe.addSignature([de.Boolean,de.AnyType,de.AnyType],[de.AnyType],function(s,e,t,i){i[0]=t[0]?t[1]:t[2]});var fxe=new vi("number");fxe.addSignature([],[de.Number],function(s,e,t,i){i[0]=e.value});var pxe=new vi("vec2");pxe.addSignature([],[de.Vec2],function(s,e,t,i){i[0]=e.value});var mxe=new vi("vec3");mxe.addSignature([],[de.Vec3],function(s,e,t,i){i[0]=e.value});var gxe=new vi("vec4");gxe.addSignature([],[de.Vec4],function(s,e,t,i){i[0]=e.value});var yxe=new vi("bool");yxe.addSignature([],[de.Boolean],function(s,e,t,i){i[0]=e.value});var vxe=new vi("particlePosition");vxe.addSignature([],[de.Vec3],function(s,e,t,i){i[0]=s.particle[e.property]});var Axe=new vi("particleVelocity");Axe.addSignature([],[de.Vec3],function(s,e,t,i){i[0]=s.particle[e.property]});var _xe=new vi("particleRotation");_xe.addSignature([],[de.Number],function(s,e,t,i){i[0]=s.particle[e.property]});var bxe=new vi("particleAge");bxe.addSignature([],[de.Number],function(s,e,t,i){i[0]=s.particle[e.property]});var Px=new vi("output");Px.addSignature([de.Number],[de.Number],function(s,e,t,i){i[0]=t[0]});Px.addSignature([de.Vec2],[de.Vec2],function(s,e,t,i){i[0]=t[0]});Px.addSignature([de.Vec3],[de.Vec3],function(s,e,t,i){i[0]=t[0]});Px.addSignature([de.Vec4],[de.Vec4],function(s,e,t,i){i[0]=t[0]});Px.addSignature([de.Boolean],[de.Boolean],function(s,e,t,i){i[0]=t[0]});console.log("%c Particle system powered by three.quarks. https://quarks.art/","font-size: 16px; font-weight: bold;");var xxe=Object.defineProperty,wxe=Object.getOwnPropertyDescriptor,kn=(s,e,t,i)=>{for(var n=i>1?void 0:i?wxe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&xxe(e,t,n),n};const UA=ie("debugparticles"),Sxe=ie("noprogressive"),Cxe=ie("debugprogressive");var rO=(s=>(s[s.Birth=0]="Birth",s[s.Collision=1]="Collision",s[s.Death=2]="Death",s[s.Trigger=3]="Trigger",s[s.Manual=4]="Manual",s))(rO||{});class pl extends Ie{constructor(){super(...arguments);d(this,"renderMode");d(this,"particleMaterial");d(this,"trailMaterial");d(this,"particleMesh");d(this,"maxParticleSize");d(this,"minParticleSize");d(this,"velocityScale");d(this,"cameraVelocityScale");d(this,"lengthScale")}start(){if(this.maxParticleSize!==.5&&this.minParticleSize!==0&&nt()){const t=`ParticleSystem "${this.name}" has non-default min/max particle size. This may not render correctly. Please set min size to 0 and the max size to 0.5 and use the "StartSize" setting instead`;console.warn(t)}}get transparent(){var i;return((i=this.particleMaterial)==null?void 0:i.transparent)??!1}getMaterial(t=!1){let i=t===!0&&this.trailMaterial?this.trailMaterial:this.particleMaterial;return i&&t&&i.side===$n&&(i=i.clone(),i.side=bn,t?this.trailMaterial=i:this.particleMaterial=i),i&&!Sxe&&i._didRequestTextureLOD===void 0&&(i._didRequestTextureLOD=0,Cxe&&console.log("Load material LOD",i.name),yi.assignTextureLOD(i,0)),i}getMesh(t){let i=null;if(!i&&(this.particleMesh instanceof fe&&(i=this.particleMesh.geometry),i===null)){i=new ps(1,1);const r=i.attributes.uv;for(let o=0;o<r.count;o++)r.setX(o,1-r.getX(o))}return new fe(i,this.getMaterial())}}kn([C()],pl.prototype,"renderMode",2);kn([C(Ht)],pl.prototype,"particleMaterial",2);kn([C(Ht)],pl.prototype,"trailMaterial",2);kn([C()],pl.prototype,"maxParticleSize",2);kn([C()],pl.prototype,"minParticleSize",2);kn([C()],pl.prototype,"velocityScale",2);kn([C()],pl.prototype,"cameraVelocityScale",2);kn([C()],pl.prototype,"lengthScale",2);class sC{constructor(e,t=1){d(this,"_curve");d(this,"_factor");d(this,"type","function");this._curve=e,this._factor=t}genValue(e){return this._curve.evaluate(e,Math.random())*this._factor}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class cU{constructor(e){d(this,"type","value");d(this,"system");this.system=e}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}}class Exe extends cU{genValue(){return this.system.textureSheetAnimation.getStartIndex()}}class Mxe extends cU{constructor(){super(...arguments);d(this,"_lastPosition",new S);d(this,"_lastDistance",0)}update(){const t=Ft(this.system.gameObject);this._lastDistance=this._lastPosition.distanceTo(t),this._lastPosition.copy(t)}genValue(){if(!this.system.isPlaying||!this.system.emission.enabled||this.system.currentParticles>=this.system.maxParticles)return 0;let t=this.system.emission.rateOverTime.evaluate(this.system.time/this.system.duration,Math.random());if(this.system.deltaTime>0){const r=this.system.emission.rateOverDistance.evaluate(this.system.time/this.system.duration,Math.random());let a=this._lastDistance/this.system.deltaTime*r;Number.isFinite(a)||(a=0),t+=a}const i=this.system.emission.getBurst();i>0&&(t+=i/this.system.deltaTime);const n=this.system.maxParticles-this.system.currentParticles;return it.clamp(t,0,n/this.system.deltaTime)}}class Txe extends cU{genValue(){return this.system.isPlaying,0}}class bf{constructor(e){d(this,"system");d(this,"type");this.type=Object.getPrototypeOf(this).constructor.name||"ParticleSystemBaseBehaviour",e&&(this.system=e)}get context(){return this.system.context}initialize(e){}update(e,t){}frameUpdate(e){}toJSON(){throw new Error("Method not implemented.")}clone(){throw new Error("Method not implemented.")}reset(){}}class Ixe extends bf{constructor(){super(...arguments);d(this,"type","NeedleTextureSheet")}update(t,i){const n=this.system.textureSheetAnimation;if(n.enabled){const r=t.age/t.life,o=n.evaluate(r);o!==void 0&&(t.uvTile=o)}}}const gV=Symbol("particleRotation");class Rxe extends bf{constructor(){super(...arguments);d(this,"type","NeedleRotation")}initialize(t){t[gV]=Math.random()}update(t,i){if(t.rotation===void 0)return;const n=t.age/t.life;if(typeof t.rotation=="number"&&(this.system.rotationOverLifetime.enabled?t.rotation+=this.system.rotationOverLifetime.evaluate(n,t[gV])*i:this.system.renderer.renderMode===Fh.Billboard&&(t.rotation=Math.PI),this.system.rotationBySpeed.enabled)){const r=t.velocity.length();t.rotation+=this.system.rotationBySpeed.evaluate(n,r)*i}}}const yV=Symbol("sizeLerpFactor"),Pxe=new S;class Bxe extends bf{constructor(){super(...arguments);d(this,"type","NeedleSize");d(this,"_minSize",0);d(this,"_maxSize",1)}initialize(t){t[yV]=Math.random(),this._minSize=this.system.renderer.minParticleSize,this._maxSize=this.system.renderer.maxParticleSize}update(t,i){const n=t.age/t.life;let r=1;this.system.sizeOverLifetime.enabled&&(r*=this.system.sizeOverLifetime.evaluate(n,void 0,t[yV]).x);let o=1;if(this.system.renderer.renderMode!==Fh.Mesh&&(o=this.system.worldScale.x/this.system.cameraScale),t.size=t.startSize*r*o,this.system.localspace){const a=Sq(this.system,Pxe);t.size*=a.x}}}const Sy=Symbol("particleLife"),ZP=Symbol("trailLifetime"),vV=Symbol("trailStartLength"),$P=Symbol("trailWidthRandom");class Dxe extends bf{constructor(){super(...arguments);d(this,"type","NeedleTrail")}initialize(t){t instanceof hb&&(t[Sy]=t.life,this.system.trails.enabled&&this.system.trails.dieWithParticles===!1&&(t[ZP]=this.system.trails.lifetime.evaluate(Math.random(),Math.random()),t.life+=t[ZP]),t[vV]=t.length,t[$P]=Math.random())}update(t){var i;if((i=this.system.trails)!=null&&i.enabled&&t instanceof hb){const n=t,r=t.age/t[Sy],o=t.previous.values(),a=t.previous.length;for(let l=0;l<a;l++){const h=o.next().value,u=1-l/(a-1);let f=t.size;f<=0&&!this.system.trails.sizeAffectsWidth&&(f=20*this.system.trails.widthOverTrail.evaluate(.5,n[$P])),h.size=this.system.trails.getWidth(f,r,u,n[$P]),h.color.copy(t.color),this.system.trails.getColor(h.color,r,u)}if(t.age>t[Sy]){t.velocity.set(0,0,0);const l=(t.age-t[Sy])/t[ZP];n.length=it.lerp(t[vV],0,l)}}}}const rC=Symbol("startVelocity"),AV=Symbol("gravityModifier"),eB=Symbol("gravitySpeed"),oC=Symbol("velocity lerp factor"),oO=new S;class Oxe extends bf{constructor(){super(...arguments);d(this,"type","NeedleVelocity");d(this,"_gravityDirection",new S)}initialize(t){var r,o;const i=this.system.main.simulationSpeed;t.startSpeed=this.system.main.startSpeed.evaluate(Math.random(),Math.random()),t.velocity.copy(this.system.shape.getDirection(t,t.position)).multiplyScalar(t.startSpeed),(r=this.system.inheritVelocity)!=null&&r.enabled&&this.system.inheritVelocity.applyInitial(t.velocity),t[rC]?t[rC].copy(t.velocity):t[rC]=t.velocity.clone();const n=this.system.main.gravityModifier.evaluate(Math.random(),Math.random());t[AV]=n*i,t[eB]=n*i*.5,t[oC]=Math.random(),(o=this.system.velocityOverLifetime)==null||o.init(t),this._gravityDirection.set(0,-1,0),this.system.main.simulationSpace===ob.Local&&this._gravityDirection.applyQuaternion(this.system.worldQuaternionInverted).normalize()}update(t,i){var f;const n=t[rC],r=t[AV];if(r!==0){const p=r*t[eB];oO.copy(this._gravityDirection).multiplyScalar(p),t[eB]+=i*.05,n.add(oO)}t.velocity.copy(n);const o=t.age/t.life;(f=this.system.inheritVelocity)!=null&&f.enabled&&this.system.inheritVelocity.applyCurrent(t.velocity,o,t[oC]);const a=this.system.noise;a.enabled&&a.apply(0,t.position,t.velocity,i,t.age,t.life);const l=this.system.sizeBySpeed;l!=null&&l.enabled&&(t.size=l.evaluate(t.velocity,o,t[oC],t.size));const c=this.system.colorBySpeed;c!=null&&c.enabled&&c.evaluate(t.velocity,t[oC],t.color);const h=this.system.velocityOverLifetime;h.enabled&&h.apply(t,0,t.position,t.velocity,i,t.age,t.life);const u=this.system.limitVelocityOverLifetime;u.enabled&&u.apply(t.position,n,t.velocity,t.size,o,i,1),this.system.worldspace&&t.velocity.multiply(this.system.worldScale)}}const _V=Symbol("colorLerpFactor"),bV=new Ui(1,1,1,1),Kf=new Ui(1,1,1,1);class Lxe extends bf{constructor(){super(...arguments);d(this,"type","NeedleColor")}initialize(t){}_init(t){const i=this.system.renderer.particleMaterial;Kf.copy(this.system.main.startColor.evaluate(Math.random())),i!=null&&i.color&&(bV.copy(i.color),Kf.multiply(bV)),Kf.convertLinearToSRGB(),t.startColor.set(Kf.r,Kf.g,Kf.b,Kf.alpha),t.color.copy(t.startColor),t[_V]=Math.random()}update(t,i){if(t.age===0&&this._init(t),this.system.colorOverLifetime.enabled){const n=t.age/t.life,r=this.system.colorOverLifetime.color.evaluate(n,t[_V]);t.color.set(r.r,r.g,r.b,r.alpha).multiply(t.startColor)}else t.color.copy(t.startColor)}}class kxe{constructor(e){d(this,"system");d(this,"emission");d(this,"autoDestroy");d(this,"startLength");d(this,"emissionBursts");d(this,"onlyUsedByOther");d(this,"behaviors",[]);d(this,"rendererEmitterSettings",{startLength:new Fr(220),followLocalOrigin:!1});d(this,"flatWhiteTexture");d(this,"clonedTexture",{original:void 0,clone:void 0});this.system=e,this.emission=new Mxe(this.system)}get anim(){return this.system.textureSheetAnimation}get prewarm(){return!1}get material(){return this.system.renderer.getMaterial(this.system.trails.enabled)}get layers(){return this.system.gameObject.layers}update(){this.emission.update()}get looping(){return this.system.main.loop}get duration(){return this.system.duration}get shape(){return this.system.shape}get startLife(){return new sC(this.system.main.startLifetime)}get startSpeed(){return new sC(this.system.main.startSpeed)}get startRotation(){return new sC(this.system.main.startRotation)}get startSize(){return new sC(this.system.main.startSize)}get startColor(){return new EE(new Je(1,1,1,1))}get emissionOverTime(){return this.emission}get emissionOverDistance(){return new Txe(this.system)}get instancingGeometry(){return this.system.renderer.getMesh(this.system.renderer.renderMode).geometry}get renderMode(){if(this.system.trails.enabled===!0)return ht.Trail;switch(this.system.renderer.renderMode){case Fh.Billboard:return ht.BillBoard;case Fh.Stretch:return ht.StretchedBillBoard;case Fh.HorizontalBillboard:return ht.HorizontalBillBoard;case Fh.VerticalBillboard:return ht.VerticalBillBoard;case Fh.Mesh:return ht.Mesh}return ht.BillBoard}get speedFactor(){var t;let e=this.system.main.simulationSpeed;return((t=this.system.renderer)==null?void 0:t.renderMode)===Fh.Stretch&&(e*=this.system.renderer.velocityScale??1),e}get texture(){const e=this.material;if(e&&e.map){const t=e.map;if(this.clonedTexture.original!==t||!this.clonedTexture.clone){const i=t.clone();i.premultiplyAlpha=!1,i.colorSpace=zi,this.clonedTexture.original=t,this.clonedTexture.clone=i}return this.clonedTexture.clone}return this.flatWhiteTexture||(this.flatWhiteTexture=tF(new Ui(1,1,1,1),1)),this.flatWhiteTexture}get startTileIndex(){return new Exe(this.system)}get uTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesX:void 0}get vTileCount(){var e;return this.anim.enabled?(e=this.anim)==null?void 0:e.numTilesY:void 0}get renderOrder(){return 1}get blending(){var e;return((e=this.system.renderer.particleMaterial)==null?void 0:e.blending)??Cd}get transparent(){return this.system.renderer.transparent}get worldSpace(){return this.system.main.simulationSpace===ob.World}}class Fxe{constructor(){d(this,"burstIndex",0);d(this,"burstWaveIndex",0);d(this,"time",0);d(this,"waitEmiting",0)}}const b1=class extends Ie{constructor(){super(...arguments);d(this,"_state");d(this,"colorOverLifetime");d(this,"main");d(this,"emission");d(this,"sizeOverLifetime");d(this,"shape");d(this,"noise");d(this,"trails");d(this,"velocityOverLifetime");d(this,"limitVelocityOverLifetime");d(this,"inheritVelocity");d(this,"colorBySpeed");d(this,"textureSheetAnimation");d(this,"rotationOverLifetime");d(this,"rotationBySpeed");d(this,"sizeBySpeed");d(this,"_cameraScale",1);d(this,"__worldQuaternion",new Ce);d(this,"_worldQuaternionInverted",new Ce);d(this,"_worldScale",new S);d(this,"_worldPositionFrame",-1);d(this,"_worldPos",new S);d(this,"_renderer");d(this,"_batchSystem");d(this,"_particleSystem");d(this,"_interface");d(this,"_container");d(this,"_time",0);d(this,"_isPlaying",!0);d(this,"_isUsedAsSubsystem",!1);d(this,"_didPreWarm",!1);d(this,"_bursts");d(this,"_subEmitterSystems");d(this,"_lastBatchesCount",-1);d(this,"lastMaterialVersion",-1)}play(e=!1){var t;e&&ne.foreachComponent(this.gameObject,i=>{i instanceof b1&&i!==this&&i.play(!1)},!0),this._isPlaying=!0,this._particleSystem&&(this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1),(t=this.emission)==null||t.reset()}pause(e=!0){e&&ne.foreachComponent(this.gameObject,t=>{t instanceof b1&&t!==this&&t.pause(!1)},!0),this._isPlaying=!1}stop(e=!0,t=!1){e&&ne.foreachComponent(this.gameObject,i=>{i instanceof b1&&i!==this&&i.stop(!1,t)},!0),this._isPlaying=!1,this._time=0,t&&this.reset()}reset(){var e;this._time=0,this._particleSystem&&(this._particleSystem.particleNum=0,this._particleSystem.emissionState.time=0,this._particleSystem.emitEnded=!1,(e=this.emission)==null||e.reset())}emit(e){if(this._particleSystem){this.onUpdate(),e=Math.min(e,this.maxParticles-this.currentParticles),this._state||(this._state=new Fxe),this._state.waitEmiting=e,this._state.time=0;const t=this._particleSystem.emitEnded;this._particleSystem.emitEnded=!1,this._particleSystem.emit(this.deltaTime,this._state,this._particleSystem.emitter.matrixWorld),this._particleSystem.emitEnded=t}}get playOnAwake(){return this.main.playOnAwake}set playOnAwake(e){this.main.playOnAwake=e}get renderer(){return this._renderer}get isPlaying(){return this._isPlaying}get currentParticles(){var e;return((e=this._particleSystem)==null?void 0:e.particleNum)??0}get maxParticles(){return this.main.maxParticles}get time(){return this._time}get duration(){return this.main.duration}get deltaTime(){return this.context.time.deltaTime*this.main.simulationSpeed}get scale(){return this.gameObject.scale.x}get cameraScale(){return this._cameraScale}get container(){return this._container}get worldspace(){return this.main.simulationSpace===ob.World}get localspace(){return this.main.simulationSpace===ob.Local}get worldQuaternion(){return this.__worldQuaternion}get worldQuaternionInverted(){return this._worldQuaternionInverted}get worldScale(){return this._worldScale}get worldPos(){return this._worldPositionFrame!==this.context.time.frame&&(this._worldPositionFrame=this.context.time.frame,Ft(this.gameObject,this._worldPos)),this._worldPos}get matrixWorld(){return this._container.matrixWorld}get isSubsystem(){return this._isUsedAsSubsystem}addBehaviour(e){return this._particleSystem?(e instanceof bf&&(e.system=this),nt()&&console.log("add behaviour",e),this._particleSystem.addBehavior(e),!0):!1}removeBehaviour(e){if(!this._particleSystem)return!1;const t=this._particleSystem.behaviors,i=t.indexOf(e);return i!==-1&&t.splice(i,1),!0}removeAllBehaviours(){return this._particleSystem?(this._particleSystem.behaviors.length=0,!0):!1}get behaviours(){return this._particleSystem?this._particleSystem.behaviors:null}get particleSystem(){return this._particleSystem??null}set bursts(e){for(let t=0;t<e.length;t++){const i=e[t];if(!(i instanceof ab)){const n=new ab;hv(n,i),e[t]=n}}this._bursts=e}set subEmitterSystems(e){for(let t=0;t<e.length;t++){const i=e[t];if(!(i instanceof fb)){const n=new fb;hv(n,i),e[t]=n}}UA&&e.length>0&&console.log("SubEmitters: ",e,this),this._subEmitterSystems=e}onAfterDeserialize(e){if(this._subEmitterSystems&&Array.isArray(this._subEmitterSystems))for(const t of this._subEmitterSystems)t._deserialize(this.context,this.gameObject)}awake(){if(this._worldPositionFrame=-1,this._renderer=this.gameObject.getComponent(pl),!this.main)throw new Error("Not Supported: ParticleSystem needs a serialized MainModule. Creating new particle systems at runtime is currently not supported.");this._container=new ye,this._container.matrixAutoUpdate=!1,this.context.scene.add(this._container),this._batchSystem=new Xbe,this._batchSystem.name=this.gameObject.name,this._container.add(this._batchSystem),this._interface=new kxe(this),this._particleSystem=new Fbe(this._interface),this._particleSystem.addBehavior(new Bxe(this)),this._particleSystem.addBehavior(new Lxe(this)),this._particleSystem.addBehavior(new Ixe(this)),this._particleSystem.addBehavior(new Rxe(this)),this._particleSystem.addBehavior(new Oxe(this)),this._particleSystem.addBehavior(new Dxe(this)),this._batchSystem.addSystem(this._particleSystem);const e=this._particleSystem.emitter;this.context.scene.add(e),this.inheritVelocity.system&&this.inheritVelocity.system!==this&&(this.inheritVelocity=this.inheritVelocity.clone()),this.inheritVelocity.awake(this),UA&&(console.log(this),this.gameObject.add(new _a(1)))}start(){this.addSubParticleSystems(),this.updateLayers(),this.renderer.particleMesh instanceof fe&&this._interface.renderMode==ht.Mesh&&yi.assignMeshLOD(this.renderer.particleMesh,0).then(e=>{e&&this.particleSystem&&this._interface.renderMode==ht.Mesh&&(this.particleSystem.instancingGeometry=e)})}onDestroy(){var e,t,i,n;(e=this._container)==null||e.removeFromParent(),(t=this._batchSystem)==null||t.removeFromParent(),(i=this._particleSystem)==null||i.emitter.removeFromParent(),(n=this._particleSystem)==null||n.dispose()}onEnable(){this.main&&(this.inheritVelocity&&(this.inheritVelocity.system=this),this._batchSystem&&(this._batchSystem.visible=!0),this.playOnAwake&&this.play(),this._isPlaying=this.playOnAwake)}onDisable(){this._batchSystem&&(this._batchSystem.visible=!1)}onBeforeRender(){var e;this.main&&(this._didPreWarm===!1&&((e=this.main)==null?void 0:e.prewarm)===!0&&(this._didPreWarm=!0,this.preWarm()),this.onUpdate(),this.onSimulate(this.deltaTime))}preWarm(){var c;if(!((c=this.emission)!=null&&c.enabled)||this.emission.rateOverTime.getMax()<=0)return;const t=1/60,i=this.main.duration,n=this.main.startLifetime.getMax(),r=1e3,o=Math.min(Math.max(i,n)/Math.max(.01,this.main.simulationSpeed),r),a=Math.ceil(o/t),l=Date.now();UA&&console.log(`Particles ${this.name} - Prewarm for ${a} frames (${o} sec). Duration: ${i}, Lifetime: ${n}`);for(let h=0;h<a&&!(this.currentParticles>=this.maxParticles);h++){const u=Date.now()-l;if(u>2e3){console.warn(`Particles ${this.name} - Prewarm took too long. Aborting: ${u}`);break}this.onUpdate(),this.onSimulate(t)}}onSimulate(e){if(this._batchSystem){let t=this.context.time.frameCount%60===0;this._lastBatchesCount!==this._batchSystem.batches.length&&(this._lastBatchesCount=this._batchSystem.batches.length,t=!0),t&&this.updateLayers(),this._batchSystem.update(e)}this._time+=e,this._time>this.duration&&(this._time=0)}updateLayers(){if(this._batchSystem)for(let e=0;e<this._batchSystem.batches.length;e++){const t=this._batchSystem.batches[e];t.layers.disableAll();const i=this.layer;t.layers.mask=1<<i}}onUpdate(){var r,o;const e=this.renderer.getMaterial(this.trails.enabled);if(e&&e.version!=this.lastMaterialVersion&&this._particleSystem&&(this.lastMaterialVersion=e.version,this._particleSystem.texture=this._interface.texture),this._bursts&&(this.emission.bursts=this._bursts,delete this._bursts),!this._isPlaying)return;const t=this.context.mainCamera;if(t){const a=$i(t);this._cameraScale=a.x}const i=!this.worldspace,n=this.gameObject;if(ki(n,this.__worldQuaternion),this._worldQuaternionInverted.copy(this.__worldQuaternion).invert(),$i(this.gameObject,this._worldScale),i&&this._container&&((r=this.gameObject)!=null&&r.parent)){const a=Sq(this,oO);this._container.matrix.makeScale(a.x,a.y,a.z),this._container.matrix.makeRotationFromQuaternion(this.__worldQuaternion),this._container.matrix.setPosition(this.worldPos),this._container.matrix.scale(this.gameObject.scale)}this.emission.system=this,this._interface.update(),this.shape.update(this,this.context,this.main.simulationSpace,this.gameObject),this.noise.update(this.context),(o=this.inheritVelocity)==null||o.update(this.context),this.velocityOverLifetime.update(this)}addSubParticleSystems(){var e;if(this._subEmitterSystems&&this._particleSystem)for(const t of this._subEmitterSystems){t.particleSystem&&(t.particleSystem.__internalAwake?t.particleSystem.__internalAwake():nt()&&console.warn("SubParticleSystem serialization issue(?)",t.particleSystem,t));const i=(e=t.particleSystem)==null?void 0:e._particleSystem;if(i){t.particleSystem._isUsedAsSubsystem=!0;const n=new HT(this,this._particleSystem,t.particleSystem,i);n.emitterType=t.type,n.emitterProbability=t.emitProbability,this._particleSystem.addBehavior(n)}else UA&&console.warn("Could not add SubParticleSystem",t,this)}}};let fs=b1;kn([C(bx)],fs.prototype,"colorOverLifetime",2);kn([C(Cr)],fs.prototype,"main",2);kn([C(Jc)],fs.prototype,"emission",2);kn([C(gf)],fs.prototype,"sizeOverLifetime",2);kn([C(On)],fs.prototype,"shape",2);kn([C(Pi)],fs.prototype,"noise",2);kn([C(Mn)],fs.prototype,"trails",2);kn([C(Ln)],fs.prototype,"velocityOverLifetime",2);kn([C(ys)],fs.prototype,"limitVelocityOverLifetime",2);kn([C(yf)],fs.prototype,"inheritVelocity",2);kn([C(Rm)],fs.prototype,"colorBySpeed",2);kn([C(Er)],fs.prototype,"textureSheetAnimation",2);kn([C(fl)],fs.prototype,"rotationOverLifetime",2);kn([C(Ia)],fs.prototype,"rotationBySpeed",2);kn([C(xo)],fs.prototype,"sizeBySpeed",2);class fb{constructor(){d(this,"particleSystem");d(this,"emitProbability",1);d(this,"properties");d(this,"type")}_deserialize(e,t){const i=this.particleSystem;if(i instanceof fs)return;let n="";i&&typeof i.guid=="string"&&(n=i.guid,this.particleSystem=ne.findByGuid(n,t)),UA&&!(this.particleSystem instanceof fs)&&console.warn("Could not find particle system for sub emitter",n,t,this)}}function Sq(s,e){if(e.set(1,1,1),s.gameObject.parent&&s.localspace)switch(s.main.scalingMode){case XD.Local:e=$i(s.gameObject.parent,e),e.x=1/e.x,e.y=1/e.y,e.z=1/e.z;break;default:if(!s.unsupported_scaling_mode){s.unsupported_scaling_mode=!0;const t="ParticleSystem scale mode "+XD[s.main.scalingMode]+" is not supported";nt()&&Fi(t),console.warn(t,s.name,s)}e=$i(s.gameObject,e);break}return e}new S(1,1,1);new S(0,0,1);class HT{constructor(e,t,i,n){d(this,"type","NeedleParticleSubEmitter");d(this,"emitterType");d(this,"emitterProbability");d(this,"q_",new Ce);d(this,"v_",new S);d(this,"v2_",new S);d(this,"_emitterMatrix",new le);d(this,"_circularBuffer");this.system=e,this.particleSystem=t,this.subSystem=i,this.subParticleSystem=n,this.subParticleSystem&&this.subParticleSystem&&(this.subParticleSystem.onlyUsedByOther=!0);const r=1e3;this._circularBuffer=new ba(()=>new le,r)}clone(){throw new Error("Method not implemented.")}initialize(e){e.emissionState={burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0},this._emitterMatrix.copy(this.subSystem.matrixWorld).invert().premultiply(this.system.matrixWorld),this._emitterMatrix.setPosition(0,0,0),this.emitterType===rO.Birth&&this.run(e)}update(e,t){this.run(e)}frameUpdate(e){}toJSON(){}reset(){}run(e){if(this.subSystem.currentParticles>=this.subSystem.main.maxParticles||!this.subParticleSystem||!e.emissionState||this.emitterProbability&&Math.random()>this.emitterProbability)return;const t=this.system.deltaTime;if(this.emitterType===rO.Death){let n=e.life;if(e[Sy]!==void 0&&(n=e[Sy]),!(e.age+t*1.2>=n))return;const o=this.subSystem.main.maxParticles-this.subSystem.currentParticles;e.emissionState.waitEmiting=o}const i=new le;i.set(1,0,0,e.position.x,0,1,0,e.position.y,0,0,1,e.position.z,0,0,0,1),this.particleSystem.worldSpace||i.multiplyMatrices(this._emitterMatrix,i),this.subParticleSystem.emit(t,e.emissionState,i)}}var Uxe=Object.defineProperty,Nxe=Object.getOwnPropertyDescriptor,zxe=(s,e,t,i)=>{for(var n=i>1?void 0:i?Nxe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Uxe(e,t,n),n};class Bx extends Sr{constructor(){super(...arguments);d(this,"granularity",new Ze(10))}get typeName(){return"PixelationEffect"}onCreateEffect(){const t=new JQ;return this.granularity.onValueChanged=i=>{t.granularity=i},t}}zxe([C(Ze)],Bx.prototype,"granularity",2);dl("PixelationEffect",Bx);class fv extends Ie{constructor(){super(...arguments);d(this,"_didAssignPlayerColor",!1);d(this,"tryAssignColor",()=>{const t=ne.getComponentInParent(this.gameObject,ha);if(t&&t.owner)return this._didAssignPlayerColor=!0,this.assignUserColor(t.owner),!0;const i=ne.getComponentInParent(this.gameObject,Ss);return i!=null&&i.connectionId?(this._didAssignPlayerColor=!0,this.assignUserColor(i.connectionId),!0):!1})}onEnable(){this.context.connection.beginListen(Qt.JoinedRoom,this.tryAssignColor),this._didAssignPlayerColor||this.startCoroutine(this.waitForConnection())}onDisable(){this.context.connection.stopListen(Qt.JoinedRoom,this.tryAssignColor)}*waitForConnection(){for(;!this.destroyed&&this.activeAndEnabled&&(yield F9(.2),!this.tryAssignColor()););}assignUserColor(t){const i=fv.hashCode(t),n=fv.colorFromHashCode(i);if(this.gameObject.type==="Mesh"){const r=this.gameObject;this.assignColor(n,t,r)}else if(this.gameObject.children)for(const r of this.gameObject.children){const o=r;o.material&&o.material.color&&this.assignColor(n,t,o)}}assignColor(t,i,n){let r=n.material;r&&(r._playerMaterial!==i&&(r=r.clone(),r._playerMaterial=i,n.material=r),r.color=t)}static hashCode(t){var i=0,n,r;if(t.length===0)return i;for(n=0;n<t.length;n++)r=t.charCodeAt(n),i=(i<<5)-i+r,i|=0;return i}static colorFromHashCode(t){const i=(t&16711680)>>16,n=(t&65280)>>8,r=t&255;return new Ae(i/255,n/255,r/255)}}const Dx=new yt;Dx.setAttribute("position",new Ke(new Float32Array([-1,-1,3,-1,-1,3]),2));Dx.setAttribute("uv",new Ke(new Float32Array([0,0,2,0,0,2]),2));Dx.boundingSphere=new ln;Dx.computeBoundingSphere=function(){};const Gxe=new Qc;class Jf{constructor(e){this._mesh=new fe(Dx,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,Gxe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const Hxe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new le},viewMat:{value:new le},projViewMat:{value:new le},projectionMatrixInv:{value:new le},viewMatrixInv:{value:new le},cameraPos:{value:new S},resolution:{value:new ee},time:{value:0},samples:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1},frame:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform highp sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform float frame;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

mat3 makeRotationZ(float theta) {
	float c = cos(theta);
	float s = sin(theta);
	return mat3(c, - s, 0,
			s,  c, 0,
			0,  0, 1);
  }

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec2 harmoniousNumbers = vec2(
        1.618033988749895,
        1.324717957244746
      );
      noise.rg += harmoniousNumbers * frame;
      noise.rg = fract(noise.rg);
        vec3 helperVec = vec3(0.0, 1.0, 0.0);
        if (dot(helperVec, normal) > 0.99) {
          helperVec = vec3(1.0, 0.0, 0.0);
        }
        vec3 tangent = normalize(cross(helperVec, normal));
        vec3 bitangent = cross(normal, tangent);
        mat3 tbn = mat3(tangent, bitangent, normal) *  makeRotationZ(noise.r * 2.0 * 3.1415962) ;

      float occluded = 0.0;
      float totalWeight = 0.0;
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : radiusToUse * distanceFalloff * 0.2;
      float bias = (min(
        0.1,
        distanceFalloffToUse * 0.1
      ) / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      float phi = 1.61803398875;
      float offsetMove = 0.0;
      float offsetMoveInv = 1.0 / FSAMPLES;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = tbn * samples[int(i)];

        float moveAmt = fract(noise.g + offsetMove);
        offsetMove += offsetMoveInv;

        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        
        vec2 diff = gl_FragCoord.xy - floor(offset.xy * resolution);
        // From Rabbid76's hbao
        vec2 clipRangeCheck = step(vec2(0.0),offset.xy) * step(offset.xy, vec2(1.0));
          float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;

          #ifdef LOGDEPTH

          float distSample = linearize_depth_log(sampleDepth, near, far);

          #else

          float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);

          #endif

          float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
          
          float rangeCheck = distSample == distWorld ? 0.0 : smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
          
          float sampleValid = (clipRangeCheck.x * clipRangeCheck.y);
          occluded += rangeCheck * float(sampleDepth != depth) * float(distSample + bias < distWorld) * step(
            1.0,
            dot(diff, diff)
          ) * sampleValid;
          
          totalWeight += sampleValid;
      }
      float occ = clamp(1.0 - occluded / (totalWeight == 0.0 ? 1.0 : totalWeight), 0.0, 1.0);
      gl_FragColor = vec4(occ, 0.5 + 0.5 * normal);
}`},Vxe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},transparencyDWFalse:{value:null},transparencyDWTrue:{value:null},transparencyDWTrueDepth:{value:null},transparencyAware:{value:!1},projMat:{value:new le},viewMat:{value:new le},projectionMatrixInv:{value:new le},viewMatrixInv:{value:new le},cameraPos:{value:new S},resolution:{value:new ee},color:{value:new S(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1},fog:{value:!1},fogExp:{value:!1},fogDensity:{value:0},fogNear:{value:1/0},fogFar:{value:1/0},colorMultiply:{value:!0}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform highp sampler2D downsampledDepth;
    uniform highp sampler2D transparencyDWFalse;
    uniform highp sampler2D transparencyDWTrue;
    uniform highp sampler2D transparencyDWTrueDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform bool fog;
    uniform bool fogExp;
    uniform bool colorMultiply;
    uniform bool transparencyAware;
    uniform float fogDensity;
    uniform float fogNear;
    uniform float fogFar;
    uniform float radius;
    uniform float distanceFalloff;
    uniform vec3 cameraPos;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        #ifdef HALFRES 
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.gba * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

        #ifdef LOGDEPTH
        texel.r = clamp(texel.r, 0.0, 1.0);
        if (texel.r == 0.0) {
          texel.r = 1.0;
        }
        #endif
     
        float finalAo = pow(texel.r, intensity);
        float fogFactor;
        float fogDepth = distance(
            cameraPos,
            getWorldPos(depth, vUv)
        );
        if (fog) {
            if (fogExp) {
                fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
            } else {
                fogFactor = smoothstep( fogNear, fogFar, fogDepth );
            }
        }
        if (transparencyAware) {
            float transparencyDWOff = texture2D(transparencyDWFalse, vUv).a;
            float transparencyDWOn = texture2D(transparencyDWTrue, vUv).a;
            float adjustmentFactorOff = transparencyDWOff;
            float adjustmentFactorOn = (1.0 - transparencyDWOn) * (
                texture2D(transparencyDWTrueDepth, vUv).r == texture2D(sceneDepth, vUv).r ? 1.0 : 0.0
            );
            float adjustmentFactor = max(adjustmentFactorOff, adjustmentFactorOn);
            finalAo = mix(finalAo, 1.0, adjustmentFactor);
        }
        finalAo = mix(finalAo, 1.0, fogFactor);
        vec3 aoApplied = color * mix(vec3(1.0), sceneTexel.rgb, float(colorMultiply));
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), aoApplied, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},Qxe={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new le},viewMat:{value:new le},projectionMatrixInv:{value:new le},viewMatrixInv:{value:new le},cameraPos:{value:new S},resolution:{value:new ee},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.r;
        float baseOcc = data.r;
        vec3 normal = data.gba * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        if (d == 1.0) {
          gl_FragColor = data;
          return;
        }
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
        radiusToUse * distanceFalloff
    : radiusToUse * distanceFalloff * 0.2;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.r;
            vec3 normalSample = dataSample.gba * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPosSample - worldPos, normal));
            float rangeCheck = dSample == 1.0 ? 0.0 :exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        if (count > 0.0) {
          occlusion /= count;
        }
        #ifdef LOGDEPTH
          occlusion = clamp(occlusion, 0.0, 1.0);
          if (occlusion == 0.0) {
            occlusion = 1.0;
          }
        #endif
        gl_FragColor = vec4(occlusion, 0.5 + 0.5 * normal);
    }
    `},Wxe={uniforms:{sceneDepth:{value:null},resolution:{value:new ee},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new le},projectionMatrixInv:{value:new le},logDepth:{value:!1}},depthWrite:!1,depthTest:!1,vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform highp sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        highp vec2[4] uvSamples;
        uvSamples[0] = uv;
        uvSamples[1] = uv + vec2(pixelSize.x, 0.0);
        uvSamples[2] = uv + vec2(0.0, pixelSize.y);
        uvSamples[3] = uv + pixelSize;
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[4] samples;
        samples[0] = depth00;
        samples[1] = depth10;
        samples[2] = depth01;
        samples[3] = depth11;
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
    }`};var Cq="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";const jxe=Uint8Array.from(atob(Cq),s=>s.charCodeAt(0));function Eq(s,e,t){if(e.getQueryParameter(s,e.QUERY_RESULT_AVAILABLE)){const r=e.getQueryParameter(s,e.QUERY_RESULT)/1e6;t.lastTime=r}else setTimeout(()=>{Eq(s,e,t)},1)}class Mq extends _r{constructor(e,t,i=512,n=512){super(),this.width=i,this.height=n,this.clear=!0,this.camera=t,this.scene=e,this.autosetGamma=!0,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new Ae(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0,colorMultiply:!0,transparencyAware:!1,accumulate:!1},{set:(r,o,a)=>{const l=r[o];return r[o]=a,a.equals?a.equals(l)||this.firstFrame():l!==a&&this.firstFrame(),o==="aoSamples"&&l!==a&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),o==="denoiseSamples"&&l!==a&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),o==="halfRes"&&l!==a&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),o==="depthAwareUpsampling"&&l!==a&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),o==="gammaCorrection"&&(this.autosetGamma=!1),o==="transparencyAware"&&l!==a&&(this.autoDetectTransparency=!1,this.configureTransparencyTarget()),!0}}),this.samples=[],this.samplesDenoise=[],this.autoDetectTransparency=!0,this.frames=0,this.lastViewMatrix=new le,this.lastProjectionMatrix=new le,this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.detectTransparency(),this.configureTransparencyTarget(),this.copyQuad=new Jf(new kt({uniforms:{tDiffuse:{value:null}},depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }
            `,fragmentShader:`
            uniform sampler2D tDiffuse;
            varying vec2 vUv;
            void main() {
                gl_FragColor = texture2D(tDiffuse, vUv);
            }
            `})),this.writeTargetInternal=new $t(this.width,this.height,{minFilter:Nt,magFilter:Nt,depthBuffer:!1}),this.readTargetInternal=new $t(this.width,this.height,{minFilter:Nt,magFilter:Nt,depthBuffer:!1}),this.outputTargetInternal=new $t(this.width,this.height,{minFilter:Nt,magFilter:Nt,depthBuffer:!1}),this.accumulationRenderTarget=new $t(this.width,this.height,{minFilter:Nt,magFilter:Nt,depthBuffer:!1,format:Li,type:Cs,stencilBuffer:!1,depthBuffer:!1,alpha:!0}),this.accumulationQuad=new Jf(new kt({uniforms:{frame:{value:0},tDiffuse:{value:null}},transparent:!0,opacity:1,vertexShader:`
             varying vec2 vUv;
             void main() {
                 vUv = uv;
                 gl_Position = vec4(position, 1);
             }`,fragmentShader:`
             uniform sampler2D tDiffuse;
             uniform float frame;
                varying vec2 vUv;
                void main() {
                    vec4 color = texture2D(tDiffuse, vUv);
                    gl_FragColor = vec4(color.rgb, 1.0 / (frame + 1.0));
                }
                `})),this.bluenoise=new Qr(jxe,128,128),this.bluenoise.colorSpace=Bo,this.bluenoise.wrapS=Uo,this.bluenoise.wrapT=Uo,this.bluenoise.minFilter=Ot,this.bluenoise.magFilter=Ot,this.bluenoise.needsUpdate=!0,this.lastTime=0,this.needsDepthTexture=!0,this.needsSwap=!0,this._r=new ee,this._c=new Ae}configureHalfResTargets(){this.firstFrame(),this.configuration.halfRes?(this.depthDownsampleTarget=new $t(this.width/2,this.height/2,{count:2}),this.depthDownsampleTarget.textures[0].format=um,this.depthDownsampleTarget.textures[0].type=tn,this.depthDownsampleTarget.textures[0].minFilter=Ot,this.depthDownsampleTarget.textures[0].magFilter=Ot,this.depthDownsampleTarget.textures[0].depthBuffer=!1,this.depthDownsampleTarget.textures[1].format=Li,this.depthDownsampleTarget.textures[1].type=Cs,this.depthDownsampleTarget.textures[1].minFilter=Ot,this.depthDownsampleTarget.textures[1].magFilter=Ot,this.depthDownsampleTarget.textures[1].depthBuffer=!1,this.depthDownsampleQuad=new Jf(new kt(Wxe))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}detectTransparency(){if(this.autoDetectTransparency){let e=!1;this.scene.traverse(t=>{t.material&&t.material.transparent&&(e=!0)}),e&&(this.configuration.transparencyAware=!0)}}configureTransparencyTarget(){this.configuration.transparencyAware?(this.transparencyRenderTargetDWFalse=new $t(this.width,this.height,{minFilter:Nt,magFilter:Ot,type:Cs,format:Li}),this.transparencyRenderTargetDWTrue=new $t(this.width,this.height,{minFilter:Nt,magFilter:Ot,type:Cs,format:Li}),this.transparencyRenderTargetDWTrue.depthTexture=new Av(this.width,this.height,Hr),this.depthCopyPass=new Jf(new kt({uniforms:{depthTexture:{value:this.depthTexture}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1);
            }`,fragmentShader:`
            uniform sampler2D depthTexture;
            varying vec2 vUv;
            void main() {
               gl_FragDepth = texture2D(depthTexture, vUv).r + 0.00001;
               gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
            }
            `}))):(this.transparencyRenderTargetDWFalse&&(this.transparencyRenderTargetDWFalse.dispose(),this.transparencyRenderTargetDWFalse=null),this.transparencyRenderTargetDWTrue&&(this.transparencyRenderTargetDWTrue.dispose(),this.transparencyRenderTargetDWTrue=null),this.depthCopyPass&&(this.depthCopyPass.dispose(),this.depthCopyPass=null))}renderTransparency(e){const t=this.scene.background,i=e.getClearColor(new Ae),n=e.getClearAlpha(),r=new Map,o=e.autoClearDepth;this.scene.traverse(a=>{r.set(a,a.visible)}),this.scene.background=null,e.autoClearDepth=!1,e.setClearColor(new Ae(0,0,0),0),this.depthCopyPass.material.uniforms.depthTexture.value=this.depthTexture,e.setRenderTarget(this.transparencyRenderTargetDWFalse),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&a.material.transparent&&!a.material.depthWrite&&!a.userData.treatAsOpaque)}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),e.setRenderTarget(this.transparencyRenderTargetDWTrue),this.scene.traverse(a=>{a.material&&(a.visible=r.get(a)&&a.material.transparent&&a.material.depthWrite&&!a.userData.treatAsOpaque)}),e.clear(!0,!0,!0),this.depthCopyPass.render(e),e.render(this.scene,this.camera),this.scene.traverse(a=>{a.visible=r.get(a)}),e.setClearColor(i,n),this.scene.background=t,e.autoClearDepth=o}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(e=!1){this.firstFrame(),this.samples=this.generateHemisphereSamples(this.configuration.aoSamples);const t={...Hxe};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new kt(t)):this.effectShaderQuad=new Jf(new kt(t))}configureDenoisePass(e=!1){this.firstFrame(),this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const t={...Qxe};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new kt(t)):this.poissonBlurQuad=new Jf(new kt(t))}configureEffectCompositer(e=!1){this.firstFrame();const t={...Vxe};e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new kt(t)):this.effectCompositerQuad=new Jf(new kt(t))}generateHemisphereSamples(e){const t=[];for(let i=0;i<e;i++){const n=2.399963*i,r=Math.sqrt(i+.5)/Math.sqrt(e),o=r*Math.cos(n),a=r*Math.sin(n),l=Math.sqrt(1-(o*o+a*a));t.push(new S(o,a,l))}return t}generateDenoiseSamples(e,t){const i=2*Math.PI*t/e,n=1/e,r=n,o=[];let a=n,l=0;for(let c=0;c<e;c++)o.push(new ee(Math.cos(l),Math.sin(l)).multiplyScalar(Math.pow(a,.75))),a+=r,l+=i;return o}setSize(e,t){this.firstFrame(),this.width=e,this.height=t;const i=this.configuration.halfRes?.5:1;this.writeTargetInternal.setSize(e*i,t*i),this.readTargetInternal.setSize(e*i,t*i),this.accumulationRenderTarget.setSize(e*i,t*i),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*i,t*i),this.configuration.transparencyAware&&(this.transparencyRenderTargetDWFalse.setSize(e,t),this.transparencyRenderTargetDWTrue.setSize(e,t)),this.outputTargetInternal.setSize(e,t)}setDepthTexture(e){this.depthTexture=e}firstFrame(){this.needsFrame=!0}render(e,t,i){const n=e.xr.enabled;e.xr.enabled=!1,e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer)),this.detectTransparency(),(t.texture.type!==this.outputTargetInternal.texture.type||t.texture.format!==this.outputTargetInternal.texture.format)&&(this.outputTargetInternal.texture.type=t.texture.type,this.outputTargetInternal.texture.format=t.texture.format,this.outputTargetInternal.texture.needsUpdate=!0),this.camera.updateMatrixWorld(),this.lastViewMatrix.equals(this.camera.matrixWorldInverse)&&this.lastProjectionMatrix.equals(this.camera.projectionMatrix)&&this.configuration.accumulate&&!this.needsFrame?this.frame++:(e.setRenderTarget(this.accumulationRenderTarget),e.clear(!0,!0,!0),this.frame=0,this.needsFrame=!1),this.lastViewMatrix.copy(this.camera.matrixWorldInverse),this.lastProjectionMatrix.copy(this.camera.projectionMatrix);let r,o,a;this.debugMode&&(r=e.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),this.debugMode&&(a=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,a)),this.configuration.transparencyAware&&this.renderTransparency(e),this._r.set(this.width,this.height);let l=this.configuration.aoRadius;if(this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(l*=.5),this.frame<1024/this.configuration.aoSamples){this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new S),this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=l,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectShaderQuad.material.uniforms.frame.value=this.frame,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let h=0;h<this.configuration.denoiseIterations;h++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new S),this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=l,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=h,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);e.setRenderTarget(this.accumulationRenderTarget);const c=e.autoClear;e.autoClear=!1,this.accumulationQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.accumulationQuad.material.uniforms.frame.value=this.frame,this.accumulationQuad.render(e),e.autoClear=c}this.configuration.transparencyAware&&(this.effectCompositerQuad.material.uniforms.transparencyDWFalse.value=this.transparencyRenderTargetDWFalse.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrue.value=this.transparencyRenderTargetDWTrue.texture,this.effectCompositerQuad.material.uniforms.transparencyDWTrueDepth.value=this.transparencyRenderTargetDWTrue.depthTexture,this.effectCompositerQuad.material.uniforms.transparencyAware.value=!0),this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=t.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.textures[0]:this.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=l,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.autosetGamma?this.renderToScreen:this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.accumulationRenderTarget.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),this.effectCompositerQuad.material.uniforms.colorMultiply.value=this.configuration.colorMultiply,this.effectCompositerQuad.material.uniforms.cameraPos.value=this.camera.getWorldPosition(new S),this.effectCompositerQuad.material.uniforms.fog.value=!!this.scene.fog,this.scene.fog&&(this.scene.fog.isFog?(this.effectCompositerQuad.material.uniforms.fogExp.value=!1,this.effectCompositerQuad.material.uniforms.fogNear.value=this.scene.fog.near,this.effectCompositerQuad.material.uniforms.fogFar.value=this.scene.fog.far):this.scene.fog.isFogExp2?(this.effectCompositerQuad.material.uniforms.fogExp.value=!0,this.effectCompositerQuad.material.uniforms.fogDensity.value=this.scene.fog.density):console.error(`Unsupported fog type ${this.scene.fog.constructor.name} in SSAOPass.`)),e.setRenderTarget(this.outputTargetInternal),this.effectCompositerQuad.render(e),e.setRenderTarget(this.renderToScreen?null:i),this.copyQuad.material.uniforms.tDiffuse.value=this.outputTargetInternal.texture,this.copyQuad.render(e),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),Eq(a,r,this)),e.xr.enabled=n}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}Uint8Array.from(atob(Cq),s=>s.charCodeAt(0));var qxe=Object.defineProperty,Xxe=Object.getOwnPropertyDescriptor,Tq=(s,e,t,i)=>{for(var n=i>1?void 0:i?Xxe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&qxe(e,t,n),n};class Ox extends Sr{constructor(){super(...arguments);d(this,"_effect")}get typeName(){return"Sharpening"}onCreateEffect(){return this.effect}get effect(){return this._effect??(this._effect=new Iq),this._effect}set amount(t){this.effect.uniforms.get("amount").value=t}get amount(){return this.effect.uniforms.get("amount").value}set radius(t){this.effect.uniforms.get("radius").value=t}get radius(){return this.effect.uniforms.get("radius").value}}Tq([C()],Ox.prototype,"amount",1);Tq([C()],Ox.prototype,"radius",1);const Yxe=`
  void mainSupport() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,Kxe=`
uniform sampler2D tDiffuse;
uniform float amount;
uniform float radius;

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
    float tx = 1.0 / resolution.x;
    float ty = 1.0 / resolution.y;
    vec2 texelSize = vec2(tx, ty);

    vec4 blurred = vec4(0.0);
    float total = 0.0;

    for (float x = -radius; x <= radius; x++) {
        for (float y = -radius; y <= radius; y++) {
            vec2 offset = vec2(x, y) * texelSize;
            vec4 diffuse = texture2D(tDiffuse, uv + offset);
            float weight = exp(-length(offset) * amount);
            blurred += diffuse * weight;
            total += weight;
        }
    }

    if (total > 0.0) {
        blurred /= total;
    }

    // Calculate the sharpened color using inputColor
    vec4 sharp = inputColor + clamp(inputColor - blurred, 0.0, 1.0) * amount;
    // Keep original alpha
    sharp.a = inputColor.a;

    // Ensure the sharp color does not go below 0 or above 1
    // This means: sharpening must happen AFTER tonemapping.
    sharp = clamp(sharp, 0.0, 1.0);

    outputColor = sharp;
}

`;class Iq extends vo{constructor(){super("Sharpening",Kxe,{vertexShader:Yxe,blendFunction:Xt.NORMAL,uniforms:new Map([["amount",new Se(1)],["radius",new Se(1)]])})}}const Zf=ie("debugpost"),tB=Symbol("needle:postprocessing-handler"),iB=Symbol("needle:previous-autoclear-state");class VT{constructor(e){d(this,"_composer",null);d(this,"_lastVolumeComponents");d(this,"_effects",[]);d(this,"_isActive",!1);d(this,"context");this.context=e}get isActive(){return this._isActive}get composer(){return this._composer}apply(e){this._isActive=!0,this.onApply(this.context,e)}unapply(){var i;if(Zf&&console.log("Unapplying postprocessing effects"),this._isActive=!1,this._lastVolumeComponents){for(const n of this._lastVolumeComponents)n.unapply();this._lastVolumeComponents.length=0}const e=this.context;e[tB]===this&&delete e[tB],e.composer===this._composer&&((i=e.composer)==null||i.dispose(),e.composer=null),typeof e.renderer[iB]=="boolean"&&(e.renderer.autoClear=e.renderer[iB])}dispose(){this.unapply();for(const e of this._effects)e.dispose();this._effects.length=0,this._composer=null}onApply(e,t){if(!t)return;e[tB]=this,Zf&&console.log("refreshing volume profile",t),this._lastVolumeComponents=[...t],this._effects.length=0;const i={handler:this,components:this._lastVolumeComponents};for(let n=0;n<this._lastVolumeComponents.length;n++){const r=this._lastVolumeComponents[n];if(r.context=e,r.apply){if(r.active){if(!e.mainCameraComponent){console.error("No camera in scene found or available yet - can not create postprocessing effects");return}const o=r.apply(i);if(!o)continue;Array.isArray(o)?this._effects.push(...o):this._effects.push(o)}}else r.active&&Fi("Volume component is not a VolumeComponent: "+r.__type)}if(this.context.renderer.toneMapping!=po&&!this._effects.find(n=>n instanceof K1)){const n=new K1;this._effects.push(n)}this.applyEffects(e)}applyEffects(e){const t=this._effects;if(t.length<=0)return;const i=e.mainCameraComponent,n=e.renderer,r=e.scene,o=i.cam;n[iB]=n.autoClear;const a=n.capabilities.maxSamples;this._composer||(this._composer=new ak(n,{frameBufferType:Cs,stencilBuffer:!0,multisampling:Math.min(Wc()?4:8,a)})),e.composer&&e.composer!==this._composer&&console.warn("There's already an active EffectComposer in your scene: replacing it with a new one. This might cause unexpected behaviour. Make sure to only use one PostprocessingManager/Volume in your scene."),e.composer=this._composer;const l=e.composer;l.setMainCamera(o),l.setRenderer(n),l.setMainScene(r);for(const h of l.passes)h.dispose();l.removeAllPasses();const c=new kM(r,o);c.name="Render To Screen",c.mainScene=r,l.addPass(c);try{this.orderEffects();const h=[];for(const u of t)if(u instanceof vo)h.push(u);else if(u instanceof _r){const f=new KN(o,...h);f.mainScene=r,f.name=h.map(p=>p.constructor.name).join(", "),f.enabled=!0,h.length=0,l.addPass(u)}if(h.length>0){const u=new KN(o,...h);u.name=h.map(f=>f.name).join(" "),u.mainScene=r,u.enabled=!0,l.addPass(u)}}catch(h){console.error("Error while applying postprocessing effects",h),l.removeAllPasses()}Zf&&console.log("PostProcessing Passes",t,"->",l.passes)}orderEffects(){var t;Zf&&console.log("Before ordering effects",[...this._effects]);const e=this._effects;e.sort((i,n)=>{const r=aO.findIndex(a=>i.constructor.name.endsWith(a.name)),o=aO.findIndex(a=>n.constructor.name.endsWith(a.name));return r<0?(Zf&&console.warn("Unknown effect found: ",i.constructor.name),-1):o<0?(Zf&&console.warn("Unknown effect found: ",n.constructor.name),1):r<0?1:o<0?-1:r-o}),Zf&&console.log("After ordering effects",[...this._effects]);for(let i=0;i<e.length;i++){const n=e[i];if(((t=n==null?void 0:n.configuration)==null?void 0:t.gammaCorrection)!==void 0){const r=i===e.length-1;n.configuration.gammaCorrection=r}}}}const aO=[nW,uk,$Q,eW,Mq,tW,YQ,jQ,ck,ZQ,iW,JQ,K1,KQ,WQ,Iq];async function hU(s){const{NeedleEngineHTMLElement:e}=await Promise.resolve().then(()=>OSe);e.observedAttributes.includes(s)||e.observedAttributes.push(s)}var Jxe=Object.defineProperty,Zxe=Object.getOwnPropertyDescriptor,Lx=(s,e,t,i)=>{for(var n=i>1?void 0:i?Zxe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Jxe(e,t,n),n};const Xa=ie("debugskybox");hU("skybox-image");hU("environment-image");function xV(s,e,t,i,n){const r=new Vc;r.allowDrop=!1,r.allowNetworking=!1,r.background=t,r.environment=i,ne.addComponent(s.scene,r);const o=a=>{typeof a=="string"&&(Xa&&console.log(n,"CHANGED TO",a),r.setSkybox(a))};return M6(s.domElement,n,o),r.addEventListener("destroy",()=>{Xa&&console.log("Destroyed attribute remote skybox",n),T6(s.domElement,n,o)}),r.setSkybox(e)}mi.addContextCreatedCallback(s=>{var r;const e=s.context,t=e.domElement.getAttribute("skybox-image"),i=e.domElement.getAttribute("environment-image"),n=new Array;if(t){Xa&&console.log("Creating remote skybox to load "+t),((r=e.mainCameraComponent)==null?void 0:r.clearFlags)!==kd.Skybox&&console.warn('"skybox-image" attribute has no effect: camera clearflags are not set to "Skybox"');const o=xV(e,t,!0,!1,"skybox-image");n.push(o)}if(i){Xa&&console.log("Creating remote environment to load "+i);const o=xV(e,i,!1,!0,"environment-image");n.push(o)}return n.length>0?TM(n):Promise.resolve()});function Rq(){return globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES||(globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES=new Array),globalThis.NEEDLE_ENGINE_SKYBOX_TEXTURES}function wV(s){const t=Rq().find(i=>i.src===s);return t?(Xa&&console.log("Skybox: Found previously loaded texture for "+s),t.texture):null}async function $xe(s){const e=await s;zk(e,!0),Xi(e)}function ewe(s,e){const t=Rq();for(;t.length>5;){const i=t.shift();i&&$xe(i.texture)}e.then(i=>zk(i,!1)),t.push({src:s,texture:e})}class Vc extends Ie{constructor(){super(...arguments);d(this,"url");d(this,"allowDrop",!0);d(this,"background",!0);d(this,"environment",!0);d(this,"allowNetworking",!0);d(this,"_loader");d(this,"_prevUrl");d(this,"_prevLoadedEnvironment");d(this,"_prevEnvironment",null);d(this,"_prevBackground",null);d(this,"validTextureTypes",[".hdr",".exr",".jpg",".jpeg",".png"]);d(this,"onDragOverEvent",t=>{if(this.allowDrop&&t.dataTransfer)for(const i of t.dataTransfer.types)(i==="text/uri-list"||i==="Files")&&t.preventDefault()});d(this,"onDrop",t=>{var i,n,r,o;if(this.allowDrop&&t.dataTransfer){for(const a of t.dataTransfer.types)if(Xa&&console.log(a),a==="text/uri-list"){const l=t.dataTransfer.getData(a);Xa&&console.log(a,l);let c=(n=(i=new RegExp(/polyhaven.com\/asset_img\/.+?\/(?<name>.+)\.png/).exec(l))==null?void 0:i.groups)==null?void 0:n.name;if(c||(c=(o=(r=new RegExp(/polyhaven\.com\/a\/(?<name>.+)/).exec(l))==null?void 0:r.groups)==null?void 0:o.name),Xa&&console.log(c),c){const h="https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/"+c+"_1k.exr";console.log(`[Remote Skybox] Setting skybox from url: ${h}`),t.preventDefault(),this.setSkybox(h);break}else if(this.isValidTextureType(l)){console.log("[Remote Skybox] Setting skybox from url: "+l),t.preventDefault(),this.setSkybox(l);break}else{console.warn(`[RemoteSkybox] Unknown url ${l}. If you want to load a skybox from a url, make sure it is a valid image url. Url must end with${this.validTextureTypes.join(", ")}.`);const h=new CustomEvent("dropped-unknown-url",{detail:{sender:this,event:t,url:l,apply:u=>{t.preventDefault(),this.setSkybox(u)}}});this.dispatchEvent(h)}}else if(a=="Files"){const l=t.dataTransfer.files.item(0);if(Xa&&console.log(a,l),!l)continue;if(!this.isValidTextureType(l.name)){console.warn(`[RemoteSkybox]: File "${l.name}" is not supported. Supported files are ${this.validTextureTypes.join(", ")}`);return}if(wV(l.name)===null){const c=new Blob([l]),h=URL.createObjectURL(c);t.preventDefault(),this.setSkybox(h,l.name)}else t.preventDefault(),this.setSkybox(l.name);break}}})}onEnable(){this.setSkybox(this.url),this.registerDropEvents()}onDisable(){var t;this.context.scene.environment===this._prevLoadedEnvironment&&(this.context.scene.environment=this._prevEnvironment,Hi.backgroundShouldBeTransparent(this.context)||(this.context.scene.background=this._prevBackground),this._prevLoadedEnvironment=void 0),this.unregisterDropEvents(),(t=this.context.mainCameraComponent)==null||t.applyClearFlags()}urlChangedSyncField(){this.allowNetworking&&this.url&&this.isRemoteTexture(this.url)&&this.setSkybox(this.url)}async setSkybox(t,i){var o;if(!this.activeAndEnabled||(t=twe(t,this.environment,this.background),!t))return!1;if(i??(i=t),this.isValidTextureType(i)||console.warn("Potentially invalid skybox url",i,"on",this.name),Xa&&console.log("Set remote skybox url: "+t),this._prevUrl===t&&this._prevLoadedEnvironment)return this.applySkybox(),!0;(o=this._prevLoadedEnvironment)==null||o.dispose(),this._prevLoadedEnvironment=void 0,this._prevUrl=t;const n=await this.loadTexture(t,i);if(!n||!this.enabled)return!1;this.url=t;const r=t.lastIndexOf("/");return n.name=t.substring(r>=0?r+1:0),this._loader instanceof Bc&&(n.colorSpace=bt),this._prevLoadedEnvironment=n,this.applySkybox(),!0}async loadTexture(t,i){var c,h,u,f,p;if(!t)return Promise.resolve(null);i??(i=t);const n=wV(i);if(n){const m=await n;if(((h=(c=m.source)==null?void 0:c.data)==null?void 0:h.length)>0||(p=(f=(u=m.source)==null?void 0:u.data)==null?void 0:f.data)!=null&&p.length)return m}const r=i.endsWith(".exr"),o=i.endsWith(".hdr");r?this._loader instanceof eb||(this._loader=new eb):o?this._loader instanceof fE||(this._loader=new fE):this._loader instanceof Bc||(this._loader=new Bc),Xa&&console.log("Loading skybox: "+t);const a=this._loader.loadAsync(t);return ewe(i,a),await a}applySkybox(){var i;const t=this._prevLoadedEnvironment;t&&(t.mapping=Xy,t.needsUpdate=!0,this.context.scene.background!==t&&(this._prevBackground=this.context.scene.background),this.context.scene.environment!==t&&(this._prevEnvironment=this.context.scene.environment),Xa&&console.log("Set remote skybox",this.url,!Hi.backgroundShouldBeTransparent(this.context)),this.environment&&(this.context.scene.environment=t),this.background&&!Hi.backgroundShouldBeTransparent(this.context)&&(this.context.scene.background=t),((i=this.context.mainCameraComponent)==null?void 0:i.backgroundBlurriness)!==void 0&&(this.context.scene.backgroundBlurriness=this.context.mainCameraComponent.backgroundBlurriness))}isRemoteTexture(t){return t.startsWith("http://")||t.startsWith("https://")}isValidTextureType(t){for(const i of this.validTextureTypes)if(t.endsWith(i))return!0;return!1}registerDropEvents(){this.unregisterDropEvents(),this.context.domElement.addEventListener("dragover",this.onDragOverEvent),this.context.domElement.addEventListener("drop",this.onDrop)}unregisterDropEvents(){this.context.domElement.removeEventListener("dragover",this.onDragOverEvent),this.context.domElement.removeEventListener("drop",this.onDrop)}}Lx([mF(Vc.prototype.urlChangedSyncField),C(URL)],Vc.prototype,"url",2);Lx([C()],Vc.prototype,"allowDrop",2);Lx([C()],Vc.prototype,"background",2);Lx([C()],Vc.prototype,"environment",2);Lx([C()],Vc.prototype,"allowNetworking",2);function twe(s,e,t){const i=e&&!t;switch(s==null?void 0:s.toLowerCase()){case"studio":return i?"https://cdn.needle.tools/static/skybox/modelviewer-Neutral-small.hdr":"https://cdn.needle.tools/static/skybox/modelviewer-Neutral.hdr";case"blurred-skybox":return i?"https://cdn.needle.tools/static/skybox/blurred-skybox-small.exr":"https://cdn.needle.tools/static/skybox/blurred-skybox.exr";case"quicklook-ar":return i?"https://cdn.needle.tools/static/skybox/QuickLook-ARMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ARMode.exr";case"quicklook":return i?"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode-small.exr":"https://cdn.needle.tools/static/skybox/QuickLook-ObjectMode.exr"}return s===void 0?null:s}var iwe=Object.defineProperty,nwe=Object.getOwnPropertyDescriptor,wo=(s,e,t,i)=>{for(var n=i>1?void 0:i?nwe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&iwe(e,t,n),n};const Io=ie("debugsceneswitcher"),swe=ie("sceneswitcher:clearscene"),x1="scene";hU(x1);const Zu=Promise.resolve(!1);class Ys extends Ie{constructor(){super(...arguments);d(this,"autoLoadFirstScene",!0);d(this,"scenes",[]);d(this,"loadingScene");d(this,"queryParameterName","scene");d(this,"useSceneName",!0);d(this,"clamp",!0);d(this,"useHistory",!0);d(this,"useKeyboard",!0);d(this,"useSwipe",!0);d(this,"useSceneLighting",!0);d(this,"useSceneBackground",!0);d(this,"preloadNext",1);d(this,"preloadPrevious",1);d(this,"preloadConcurrent",2);d(this,"createMenuButtons",!1);d(this,"_currentIndex",-1);d(this,"_currentScene");d(this,"_engineElementOverserver");d(this,"_preloadScheduler");d(this,"_menuButtons");d(this,"onPopState",async t=>{if(!this.useHistory)return;const i=this.useHistory;try{this.useHistory=!1;let n=!1;if(this.queryParameterName&&(n=await this.tryLoadFromQueryParam()),!n){const r=t==null?void 0:t.state;if(r&&r.startsWith(this.guid)){const o=r.substr(this.guid.length+2);Io&&console.log("PopState",o),await this.trySelectSceneFromValue(o)}}}finally{this.useHistory=i}});d(this,"normalizedSwipeThresholdX",.1);d(this,"_didSwipe",!1);d(this,"onInputPointerMove",t=>{if(this.useSwipe&&!this._didSwipe&&t.button===0&&t.pointerType==="touch"&&this.context.input.getPointerPressedCount()===1){const i=this.context.input.getPointerPositionDelta(t.button);if(i){const n=i.x/this.context.domWidth;n>=this.normalizedSwipeThresholdX?(this._didSwipe=!0,this.selectPrev()):n<=-this.normalizedSwipeThresholdX&&(this._didSwipe=!0,this.selectNext())}}});d(this,"onInputPointerUp",t=>{t.button===0&&(this._didSwipe=!1)});d(this,"onInputKeyDown",t=>{if(!this.useKeyboard||!this.scenes)return;const i=t.key.toLowerCase();if(!i)return;const n=parseInt(i)-1;if(n>=0){this.trySelectSceneFromValue(n);return}switch(i){case"arrowright":case"d":this.selectNext();break;case"arrowleft":case"a":this.selectPrev();break}});d(this,"__lastSwitchScene");d(this,"__lastSwitchScenePromise");d(this,"_currentlyLoadingScene");d(this,"_lastLoadingScene");d(this,"_loadingScenePromise");d(this,"_isCurrentlyLoading",!1);d(this,"_currentLoadingProgress")}get currentIndex(){return this._currentIndex}get currentLoadingProgress(){return this._currentLoadingProgress}get currentlyLoadingScene(){return this._currentlyLoadingScene}get currentlyLoadedScene(){return this._currentScene}awake(){this.scenes===void 0&&(this.scenes=[]);for(const t of this.scenes)t&&!t.hasUrl&&t.asset instanceof ye&&t.asset.removeFromParent();Io&&console.log("SceneSwitcher",this)}async onEnable(){if(globalThis.addEventListener("popstate",this.onPopState),this.context.input.addEventListener(vn.KeyDown,this.onInputKeyDown),this.context.input.addEventListener(vn.PointerMove,this.onInputPointerMove),this.context.input.addEventListener(vn.PointerUp,this.onInputPointerUp),this._engineElementOverserver||(this._engineElementOverserver=new MutationObserver(t=>{for(const i of t)if(i.type==="attributes"&&i.attributeName===x1){const n=this.context.domElement.getAttribute(x1);n!==null&&this.trySelectSceneFromValue(n)}})),this._engineElementOverserver.observe(this.context.domElement,{attributes:!0}),this._preloadScheduler||(this._preloadScheduler=new rwe(this)),this._preloadScheduler.maxLoadAhead=this.preloadNext,this._preloadScheduler.maxLoadBehind=this.preloadPrevious,this._preloadScheduler.maxConcurrent=this.preloadConcurrent,this._preloadScheduler.begin(),this.autoLoadFirstScene&&this._currentIndex===-1&&!await this.tryLoadFromQueryParam()){const t=this.context.domElement.getAttribute(x1);try{(t===null||!await this.trySelectSceneFromValue(t))&&this._currentIndex===-1&&this.select(0)}finally{}}this.createMenuButtons&&(this._menuButtons??(this._menuButtons=[]),this._menuButtons.push(this.context.menu.appendChild({label:"Previous",icon:"arrow_back_ios",onClick:()=>this.selectPrev(),priority:-1005,class:"row2"})),this._menuButtons.push(this.context.menu.appendChild({label:"Next",icon:"arrow_forward_ios",iconSide:"right",onClick:()=>this.selectNext(),priority:-1e3,class:"row2"})))}onDisable(){var t;if(globalThis.removeEventListener("popstate",this.onPopState),this.context.input.removeEventListener(vn.KeyDown,this.onInputKeyDown),this.context.input.removeEventListener(vn.PointerMove,this.onInputPointerMove),this.context.input.removeEventListener(vn.PointerUp,this.onInputPointerUp),(t=this._preloadScheduler)==null||t.stop(),this._menuButtons){for(const i of this._menuButtons)i.remove();this._menuButtons=void 0}}addScene(t){if(typeof t=="string"){let i=this.context.addressables.findAssetReference(t);return i||(i=new ei(t),this.context.addressables.registerAssetReference(i)),this.scenes.push(i),i}return this.scenes.push(t),t}selectNext(){return this.select(this._currentIndex+1)}selectPrev(){return this.select(this._currentIndex-1)}select(t){var n,r,o;if(Io&&console.log("select",t),typeof t=="object"&&console.warn('Switching to "'+t+'" might not work. Please either use an index or a AssetReference (not a scene reference)'),typeof t=="string"){const a=(n=this.scenes)==null?void 0:n.find(l=>l.uri===t);if(!a){const l=ei.getOrCreate(this.sourceId??"",t,this.context);return this.switchScene(l)}if(a)t=(r=this.scenes)==null?void 0:r.indexOf(a);else return Zu}if(!((o=this.scenes)!=null&&o.length))return Zu;if(t<0){if(this.clamp)return Zu;t=this.scenes.length-1}else if(t>=this.scenes.length){if(this.clamp)return Zu;t=0}const i=this.scenes[t];return this.switchScene(i)}async switchScene(t){if(!(t instanceof ei)){const n=typeof t;return n==="string"?this.select(t):n==="number"?this.select(t):(console.warn("SceneSwitcher: Can't switch to scene",t,"of type",n),!1)}return t.uri===this.sourceId?(console.warn("SceneSwitcher: can't load own scene - prevent recursive loading",this.sourceId),!1):this.__lastSwitchScene===t&&this.__lastSwitchScenePromise?this.__lastSwitchScenePromise:(this.__lastSwitchScene=t,this.__lastSwitchScenePromise=this.__internalSwitchScene(t),await this.__lastSwitchScenePromise)}async __internalSwitchScene(t){var n,r,o;if(this._currentScene){Io&&console.log("UNLOAD",this._currentScene.url,"HasURL?: "+this._currentScene.hasUrl);const a=this.tryGetSceneEventListener(this._currentScene.asset);if(a!=null&&a.sceneClosing){const l=a.sceneClosing();l instanceof Promise&&await l}this._currentScene.hasUrl?this._currentScene.unload():this._currentScene.asset instanceof ye&&this._currentScene.asset.removeFromParent()}this._currentScene=void 0;const i=this._currentIndex=((n=this.scenes)==null?void 0:n.indexOf(t))??-1;try{this._currentlyLoadingScene=t,this._currentLoadingProgress=new ProgressEvent("progress",{loaded:0,total:1});const a=new CustomEvent("loadscene-start",{detail:{scene:t,switcher:this,index:i}});this.dispatchEvent(a),await this.onStartLoading(),await t.loadAssetAsync((c,h)=>{this._currentLoadingProgress=h,this.dispatchEvent(h)}).catch(console.error),await this.onEndLoading();const l=new CustomEvent("loadscene-finished",{detail:{scene:t,switcher:this,index:i}});if(this.dispatchEvent(l),this._currentLoadingProgress=void 0,this._currentlyLoadingScene=void 0,l.defaultPrevented)return Io&&console.warn("Adding loaded scene prevented:",t,l),!1;if(!t.asset)return Io&&console.warn("Failed loading scene:",t),!1;if(this._currentIndex===i){if(Io&&console.log("ADD",t.uri),this._currentScene=t,swe){const u=((r=this.context.mainCameraComponent)==null?void 0:r.gameObject)||this.context.mainCamera;u==null||u.removeFromParent();const f=this.gameObject.removeFromParent();xa(this.context.scene,!0,!0),this.context.scene=new Ws,this.context.scene.add(f),u&&this.context.scene.add(u)}if(ne.add(t.asset,this.gameObject),this.useSceneLighting&&this.context.sceneLighting.enable(t),this.useSceneBackground){const u=this.context.lightmaps.tryGetSkybox(t.url);u?(u.mapping=mo,this.context.scene.background=u):Io&&console.warn("SceneSwitcher: Can't find skybox for scene "+t.url)}if(this.useHistory&&i>=0){let u=i.toString();if(this.useSceneName&&(u=SV(t.uri)),(o=this.queryParameterName)!=null&&o.length)H1(this.queryParameterName,u,this.useHistory);else{const f=history.state,p=this.guid+"::"+i;f!==p&&history.pushState(p,"unused",location.href)}}const c=this.tryGetSceneEventListener(t.asset);if(c!=null&&c.sceneOpened){const u=c.sceneOpened(this);u instanceof Promise&&await u}const h=new CustomEvent("scene-opened",{detail:{scene:t,switcher:this,index:i}});return this.dispatchEvent(h),!0}}catch(a){console.error(a)}return!1}preload(t){if(t>=0&&t<this.scenes.length){const i=this.scenes[t];if(i instanceof ei)return i.preload()}return Zu}tryLoadFromQueryParam(){var i;if(!((i=this.queryParameterName)!=null&&i.length))return Zu;const t=ie(this.queryParameterName);return typeof t=="boolean"?Zu:this.trySelectSceneFromValue(t)}trySelectSceneFromValue(t){if(typeof t=="string"){const i=parseInt(t);if(i>=0&&i<this.scenes.length)return this.select(i);{const n=t.toLowerCase();for(let r=0;r<this.scenes.length;r++){const o=this.scenes[r];if(o&&SV(o.uri).toLowerCase().includes(n))return this.select(r)}}}else if(typeof t=="number"&&t>=0&&t<this.scenes.length)return this.select(t);return yo()&&console.warn('Can not find scene: "'+t+'"',this),Zu}async onStartLoading(){var t,i;if(this._isCurrentlyLoading=!0,this.loadingScene&&(this._lastLoadingScene!==this.loadingScene&&(this._loadingScenePromise=void 0),this._lastLoadingScene=this.loadingScene,this._loadingScenePromise||(this._loadingScenePromise=(t=this.loadingScene)==null?void 0:t.loadAssetAsync()),await this._loadingScenePromise,this._isCurrentlyLoading&&((i=this.loadingScene)!=null&&i.asset))){Io&&console.log("Add loading scene",this.loadingScene.uri,this.loadingScene.asset);const n=this.loadingScene.asset;ne.add(n,this.gameObject);const r=this.tryGetSceneEventListener(n);if(r!=null&&r.sceneOpened){const o=r.sceneOpened(this);o instanceof Promise&&await o}}if(this._isCurrentlyLoading){const n=this.tryGetSceneEventListener(this.gameObject);if(n&&n.sceneOpened){const r=n.sceneOpened(this);r instanceof Promise&&await r}}}async onEndLoading(){var t;if(this._isCurrentlyLoading=!1,(t=this.loadingScene)!=null&&t.asset){Io&&console.log("Remove loading scene",this.loadingScene.uri);const i=this.loadingScene.asset,n=this.tryGetSceneEventListener(i);if(typeof(n==null?void 0:n.sceneClosing)=="function"){const r=n.sceneClosing();r instanceof Promise&&await r}ne.remove(i)}if(!this._isCurrentlyLoading){const i=this.tryGetSceneEventListener(this.gameObject);if(i&&i.sceneClosing){const n=i.sceneClosing();n instanceof Promise&&await n}}}tryGetSceneEventListener(t,i=0){const n=ne.foreachComponent(t,r=>r.sceneClosing?r:void 0);if(i===0&&!n&&t.children.length)for(const r of t.children){const o=this.tryGetSceneEventListener(r,i+1);if(o)return o}return n||null}}wo([C()],Ys.prototype,"autoLoadFirstScene",2);wo([C(ei)],Ys.prototype,"scenes",2);wo([C(ei)],Ys.prototype,"loadingScene",2);wo([C()],Ys.prototype,"queryParameterName",2);wo([C()],Ys.prototype,"useSceneName",2);wo([C()],Ys.prototype,"clamp",2);wo([C()],Ys.prototype,"useHistory",2);wo([C()],Ys.prototype,"useKeyboard",2);wo([C()],Ys.prototype,"useSwipe",2);wo([C()],Ys.prototype,"useSceneLighting",2);wo([C()],Ys.prototype,"useSceneBackground",2);wo([C()],Ys.prototype,"preloadNext",2);wo([C()],Ys.prototype,"preloadPrevious",2);wo([C()],Ys.prototype,"preloadConcurrent",2);wo([C()],Ys.prototype,"createMenuButtons",2);function SV(s){const e=s.split("/").pop(),t=e==null?void 0:e.split(".").shift();return t!=null&&t.length?t:s}class rwe{constructor(e,t=1,i=1,n=2){d(this,"maxLoadAhead");d(this,"maxLoadBehind");d(this,"maxConcurrent");d(this,"_isRunning",!1);d(this,"_switcher");d(this,"_loadTasks",[]);d(this,"_maxConcurrentLoads",1);this._switcher=e,this.maxLoadAhead=t,this.maxLoadBehind=i,this.maxConcurrent=n}begin(){if(this._isRunning)return;Io&&console.log("Preload begin"),this._isRunning=!0;let e=-1,t,i;const n=this._switcher.scenes,r=setInterval(()=>{if(this.allLoaded()&&(Io&&console.log("All scenes loaded"),this.stop()),!this._isRunning){clearInterval(r);return}if(this.canLoadNewScene()===!1)return;e!==this._switcher.currentIndex&&(e=this._switcher.currentIndex,i=0,t=0);const o=i%2===0;o&&(t+=1),i+=1;const a=o?this.maxLoadAhead:this.maxLoadBehind;if(t>a)return;const l=o?e+t:e-t;if(l<0||l<0||l>=n.length)return;const c=n[l];new owe(l,c,this._loadTasks)},200)}stop(){this._isRunning=!1}canLoadNewScene(){return this._loadTasks.length<this._maxConcurrentLoads}allLoaded(){if(this._switcher.scenes){for(const e of this._switcher.scenes)if((e==null?void 0:e.isLoaded())===!1)return!1}return!0}}class owe{constructor(e,t,i){d(this,"index");d(this,"asset");d(this,"tasks");this.index=e,this.asset=t,this.tasks=i,i.push(this),this.awaitLoading()}async awaitLoading(){this.asset&&!this.asset.isLoaded()&&(Io&&console.log("Preload start: "+this.asset.uri,this.index),await this.asset.preload(),Io&&console.log("Preload finished: "+this.asset.uri,this.index));const e=this.tasks.indexOf(this);e>=0&&this.tasks.splice(e,1)}}function awe(){return new Promise((s,e)=>{const i=()=>{i!=null&&(document.removeEventListener("pointerdown",i),document.removeEventListener("click",i),document.removeEventListener("dragstart",i),document.removeEventListener("touchstart",i),s())};document.addEventListener("pointerdown",i),document.addEventListener("click",i),document.addEventListener("dragstart",i),document.addEventListener("touchstart",i)})}async function lwe(s){await awe(),s()}var cwe=Object.defineProperty,hwe=Object.getOwnPropertyDescriptor,Ra=(s,e,t,i)=>{for(var n=i>1?void 0:i?hwe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&cwe(e,t,n),n};const Ls=ie("debugvideo");var Pq=(s=>(s[s.None=0]="None",s[s.AdjustHeight=1]="AdjustHeight",s[s.AdjustWidth=2]="AdjustWidth",s))(Pq||{}),Bq=(s=>(s[s.VideoClip=0]="VideoClip",s[s.Url=1]="Url",s))(Bq||{}),Dq=(s=>(s[s.CameraFarPlane=0]="CameraFarPlane",s[s.CameraNearPlane=1]="CameraNearPlane",s[s.RenderTexture=2]="RenderTexture",s[s.MaterialOverride=3]="MaterialOverride",s))(Dq||{});class Rs extends Ie{constructor(){super();d(this,"playOnAwake",!0);d(this,"aspectMode",0);d(this,"clip",null);d(this,"source",1);d(this,"_url",null);d(this,"renderMode");d(this,"targetMaterialProperty");d(this,"targetMaterialRenderer");d(this,"targetTexture");d(this,"time",0);d(this,"_playbackSpeed",1);d(this,"_isLooping",!1);d(this,"_muted",!1);d(this,"_audioOutputMode",2);d(this,"playInBackground",!0);d(this,"_crossOrigin","anonymous");d(this,"_videoElement",null);d(this,"_videoTexture",null);d(this,"_videoMaterial",null);d(this,"_isPlaying",!1);d(this,"wasPlaying",!1);d(this,"visibilityChanged",t=>{switch(document.visibilityState){case"hidden":this.playInBackground||(this.wasPlaying=this._isPlaying,this.pause());break;case"visible":this.wasPlaying&&!this._isPlaying&&this.play();break}});d(this,"_receivedInput",!1);d(this,"_overlay",null);d(this,"_targetObjects");d(this,"_updateAspectRoutineId",-1);d(this,"_hls");d(this,"onHlsAvailable",()=>{var t;Ls&&console.log("HLS: available",this.clip),!(!this.shouldUseM3U||!this.url)&&(this._hls||(this._hls=new Hls),this.videoElement.autoplay=!0,this._hls.loadSource(this.url),this._hls.attachMedia(this.videoElement),(t=this._videoElement)==null||t.play(),Ls&&console.log("HLS: loaded",this.clip))});lwe(()=>{this._receivedInput=!0,this.updateVideoElementSettings()}),this._targetObjects=[],ie("videoscreenspace")&&window.addEventListener("keydown",t=>{t.key==="f"&&(this.screenspace=!this.screenspace)})}get url(){return this._url}set url(t){const n=this._url!==t;this.__didAwake?n&&this.setClipURL(t??""):this._url=t}get playbackSpeed(){var t;return((t=this._videoElement)==null?void 0:t.playbackRate)??this._playbackSpeed}set playbackSpeed(t){this._playbackSpeed=t,this._videoElement&&(this._videoElement.playbackRate=t)}get isLooping(){var t;return((t=this._videoElement)==null?void 0:t.loop)??this._isLooping}set isLooping(t){this._isLooping=t,this._videoElement&&(this._videoElement.loop=t)}get currentTime(){var t;return((t=this._videoElement)==null?void 0:t.currentTime)??this.time}set currentTime(t){this._videoElement?this._videoElement.currentTime=t:this.time=t}get isPlaying(){const t=this._videoElement;if(t){if(t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA)return!0;if(t.srcObject&&t.srcObject.active)return!0}return!1}get crossOrigin(){var t;return((t=this._videoElement)==null?void 0:t.crossOrigin)??this._crossOrigin}set crossOrigin(t){this._crossOrigin=t,this._videoElement&&(t!==null?this._videoElement.setAttribute("crossorigin",t):this._videoElement.removeAttribute("crossorigin"))}get videoMaterial(){return!this._videoMaterial&&!this.create(!1)?null:this._videoMaterial}get videoTexture(){return!this._videoTexture&&!this.create(!1)?null:this._videoTexture}get videoElement(){return!this._videoElement&&!this.create(!1)?null:this._videoElement}requestPictureInPicture(){return this._videoElement?this._videoElement.requestPictureInPicture():null}get muted(){var t;return((t=this._videoElement)==null?void 0:t.muted)??this._muted}set muted(t){this._muted=t,this._videoElement&&(this._videoElement.muted=t)}get currentVideo(){return this.clip}set audioOutputMode(t){t!==this._audioOutputMode&&(t===1&&nt()&&console.warn("VideoAudioOutputMode.AudioSource is not yet implemented"),this._audioOutputMode=t,this.updateVideoElementSettings())}get audioOutputMode(){return this._audioOutputMode}preloadVideo(){Ls&&console.log("Video Preload: "+this.name,this.clip),this.create(!1)}preload(){this.preloadVideo()}setVideo(t){this.clip=t,this.source=0,this._videoElement?(this._videoElement.srcObject=t,this._isPlaying&&this.play(),this.updateAspect()):this.create(this.playOnAwake)}setClipURL(t){this._url!==t&&(this._url=t,this.source=1,Ls&&console.log("set url",t),this._videoElement?t.endsWith(".m3u8")||t.includes(".m3u")?this.ensureM3UCanBePlayed():(this._videoElement.src=t,this._isPlaying&&(this.stop(),this.play())):this.create(this.playOnAwake))}onEnable(){var t,i;Ls&&console.log("VideoPlayer.onEnable",Bq[this.source],this.clip,this.url,this),window.addEventListener("visibilitychange",this.visibilityChanged),this.playOnAwake===!0?this.create(!0):this.preloadVideo(),this.screenspace?(t=this._overlay)==null||t.start():(i=this._overlay)==null||i.stop()}onDisable(){var t;window.removeEventListener("visibilitychange",this.visibilityChanged),(t=this._overlay)==null||t.stop(),this.pause()}onDestroy(){var t;this._videoElement&&((t=this.videoElement)==null||t.remove(),this._videoElement=null),this._videoTexture&&(this._videoTexture.dispose(),this._videoTexture=null)}play(){var t,i;if(this._videoElement||this.create(!1),!this._videoElement){Ls&&console.warn("Can not play: no video element found",this);return}if(!(this._isPlaying&&!((t=this._videoElement)!=null&&t.ended)&&!((i=this._videoElement)!=null&&i.paused))){if(this._isPlaying=!0,this._receivedInput||(this._videoElement.muted=!0),this.handleBeginPlaying(!1),this.shouldUseM3U){this.ensureM3UCanBePlayed();return}Ls&&console.log("Video Play()",this.clip,this._videoElement,this.time),this._videoElement.currentTime=this.time,this._videoElement.play().catch(n=>{var r;console.log(n),Ls&&console.error("Error playing video",n,"CODE="+n.code,(r=this.videoElement)==null?void 0:r.src,this),setTimeout(()=>{this._isPlaying&&!this.destroyed&&this.activeAndEnabled&&this.play()},1e3)}),Ls&&console.log("play",this._videoElement,this.time)}}stop(){this._isPlaying=!1,this.time=0,this._videoElement&&(this._videoElement.currentTime=0,this._videoElement.pause(),Ls&&console.log("STOP",this))}pause(){var t,i;this.time=((t=this._videoElement)==null?void 0:t.currentTime)??0,this._isPlaying=!1,(i=this._videoElement)==null||i.pause(),Ls&&console.log("PAUSE",this,this.currentTime)}create(t){let i;switch(this.source){case 0:i=this.clip;break;case 1:i=this.url,!(i!=null&&i.length)&&typeof this.clip=="string"&&(i=this.clip);break}return i?(this._videoElement||(Ls&&console.warn("Create VideoElement",this),this._videoElement=this.createVideoElement(),this.context.domElement.shadowRoot.prepend(this._videoElement),this.updateVideoElementStyles()),typeof i=="string"?(Ls&&console.log("Set Video src",i),this._videoElement.src=i):(Ls&&console.log("Set Video srcObject",i),this._videoElement.srcObject=i),this._videoTexture||(this._videoTexture=new G8(this._videoElement)),this._videoTexture.flipY=!1,this._videoTexture.colorSpace=bt,t&&this.handleBeginPlaying(t),Ls&&console.log("Video: handle playing done...",i,t),!0):(Ls&&console.warn("No video source set",this),!1)}updateAspect(){this.aspectMode!==0&&this.startCoroutine(this.updateAspectImpl())}get screenspace(){var t;return((t=this._overlay)==null?void 0:t.enabled)??!1}set screenspace(t){var i;if(t){if(!this._videoTexture)return;this._overlay||(this._overlay=new uwe(this.context)),this._overlay.add(this._videoTexture)}else(i=this._overlay)==null||i.remove(this._videoTexture);this._overlay&&(this._overlay.enabled=t)}createVideoElement(){const t=document.createElement("video");return this._crossOrigin&&t.setAttribute("crossorigin",this._crossOrigin),Ls&&console.log("created video element",t),t}handleBeginPlaying(t){var r,o;if(!this.activeAndEnabled||!this._videoElement)return;this._targetObjects.length=0;let i=this.gameObject;switch(this.renderMode){case 3:i=(r=this.targetMaterialRenderer)==null?void 0:r.gameObject,i||(i=(o=ne.getComponent(this.gameObject,Vn))==null?void 0:o.gameObject);break;case 2:console.error("VideoPlayer renderTexture not implemented yet. Please use material override instead");return}if(!i){console.error("Missing target for video material renderer",this.name,Dq[this.renderMode],this);return}const n=i.material;if(n){this._targetObjects.push(i),n!==this._videoMaterial&&(this._videoMaterial=n.clone(),i.material=this._videoMaterial);const a="map",l=this._videoMaterial;if(!this.targetMaterialProperty)l[a]=this._videoTexture;else switch(this.targetMaterialProperty){default:l[a]=this._videoTexture;break}}else{console.warn("Can not play video, no material found, this might be a multimaterial case which is not supported yet");return}this.updateVideoElementSettings(),this.updateVideoElementStyles(),t&&(this.shouldUseM3U&&this.ensureM3UCanBePlayed(),this.play())}updateVideoElementSettings(){if(!this._videoElement)return;this._videoElement.loop=this._isLooping,this._videoElement.currentTime=this.currentTime,this._videoElement.playbackRate=this._playbackSpeed,this._videoElement.playsInline=!0;let t=!this._receivedInput||this.audioOutputMode===0;!t&&this._muted&&(t=!0),this._videoElement.muted=t,this.playOnAwake&&(this._videoElement.autoplay=!0)}updateVideoElementStyles(){this._videoElement&&(this._videoElement.style.userSelect="none",this._videoElement.style.visibility="hidden",this._videoElement.style.display="none",this.updateAspect())}*updateAspectImpl(){const t=++this._updateAspectRoutineId,i=void 0,n=this.clip;for(;t===this._updateAspectRoutineId&&this.aspectMode!==0&&this.clip&&n===this.clip&&this._isPlaying;){if(!n||typeof n=="string")return;let r;for(const o of n.getVideoTracks()){const a=o.getSettings();if(a&&a.width&&a.height){r=a.width/a.height;break}else r=this.context.renderer.domElement.clientWidth/this.context.renderer.domElement.clientHeight}if(r===void 0){for(let o=0;o<10;o++)yield;if(!this.isPlaying)break;continue}if(i===r){yield;continue}for(const o of this._targetObjects){let a=1;if(o.parent){const l=$i(o.parent);a=l.x/l.y}switch(this.aspectMode){case 1:o.scale.y=1/r*o.scale.x*a;break;case 2:o.scale.x=r*o.scale.y*a;break}}for(let o=0;o<3;o++)yield}}get shouldUseM3U(){return this.url!=null&&(this.url.endsWith(".m3u8")||this.url.endsWith(".m3u"))&&this.source===1}ensureM3UCanBePlayed(){if(!this.shouldUseM3U)return;let t=document.head.querySelector("script[data-hls_library]");t?globalThis.Hls?this.onHlsAvailable():t.addEventListener("load",this.onHlsAvailable):(Ls&&console.log("HLS: load script"),t=document.createElement("script"),t.dataset.hls_library="hls.js",t.src="https://cdn.jsdelivr.net/npm/hls.js@1",t.addEventListener("load",this.onHlsAvailable),document.head.append(t))}}Ra([C()],Rs.prototype,"playOnAwake",2);Ra([C()],Rs.prototype,"aspectMode",2);Ra([C(URL)],Rs.prototype,"clip",2);Ra([C()],Rs.prototype,"source",2);Ra([C(URL)],Rs.prototype,"url",1);Ra([C()],Rs.prototype,"renderMode",2);Ra([C()],Rs.prototype,"targetMaterialProperty",2);Ra([C(Vn)],Rs.prototype,"targetMaterialRenderer",2);Ra([C(Wt)],Rs.prototype,"targetTexture",2);Ra([C()],Rs.prototype,"time",2);Ra([C()],Rs.prototype,"playbackSpeed",1);Ra([C()],Rs.prototype,"isLooping",1);Ra([C()],Rs.prototype,"audioOutputMode",1);class uwe{constructor(e){d(this,"context");d(this,"_videos",[]);d(this,"_screenspaceModeQuad");d(this,"_isInScreenspaceMode",!1);d(this,"_input");this.context=e,this._input=new dwe(this)}get enabled(){return this._isInScreenspaceMode}set enabled(e){e?this.start():this.stop()}add(e){this._videos.indexOf(e)===-1&&this._videos.push(e)}remove(e){if(!e)return;const t=this._videos.indexOf(e);t>=0&&this._videos.splice(t,1)}start(){var n;if(this._isInScreenspaceMode||this._videos.length<0)return;const e=this._videos[this._videos.length-1];if(!e)return;if(this._isInScreenspaceMode=!0,!this._screenspaceModeQuad){if(this._screenspaceModeQuad=Iv.createPrimitive(om.Quad,{material:new fwe(e)}),!this._screenspaceModeQuad)return;this._screenspaceModeQuad.geometry.scale(2,2,2)}const t=this._screenspaceModeQuad;this.context.scene.add(t),this.updateScreenspaceMaterialUniforms();const i=t.material;i==null||i.reset(),(n=this._input)==null||n.enable(i)}stop(){var e;this._isInScreenspaceMode=!1,this._screenspaceModeQuad&&((e=this._input)==null||e.disable(),this._screenspaceModeQuad.removeFromParent())}updateScreenspaceMaterialUniforms(){var t;const e=(t=this._screenspaceModeQuad)==null?void 0:t.material;e&&(e.screenAspect=this.context.domElement.clientWidth/this.context.domElement.clientHeight)}}class dwe{constructor(e){d(this,"_onResizeScreenFn");d(this,"_onKeyUpFn");d(this,"_onMouseWheelFn");d(this,"context");d(this,"overlay");d(this,"_material");d(this,"_isPinching",!1);d(this,"_lastPinch",0);this.overlay=e,this.context=e.context}enable(e){this._material=e,window.addEventListener("resize",this._onResizeScreenFn=()=>{this.overlay.updateScreenspaceMaterialUniforms()}),window.addEventListener("keyup",this._onKeyUpFn=n=>{n.key==="Escape"&&this.overlay.stop()}),window.addEventListener("wheel",this._onMouseWheelFn=n=>{this.overlay.enabled&&(e.zoom+=n.deltaY*5e-4,n.preventDefault())},{passive:!1});const t=new ee;window.addEventListener("mousemove",n=>{if(this.overlay.enabled&&this.context.input.getPointerPressed(0)){const r=new ee(n.movementX,n.movementY);r.x/=this.context.domElement.clientWidth,r.y/=this.context.domElement.clientHeight,t.set(r.x,r.y),t.multiplyScalar(e.zoom/-this.context.time.deltaTime*.01),e.offset=e.offset.add(t)}}),window.addEventListener("pointermove",n=>{this.overlay.enabled&&this.context.input.getPointerPressed(0)&&this.context.input.getTouchesPressedCount()===1&&(t.set(n.movementX,n.movementY),t.multiplyScalar(e.zoom*-this.context.time.deltaTime*.05),e.offset=e.offset.add(t))});let i=0;window.addEventListener("touchstart",n=>{if(n.touches.length<2){this.context.time.time-i<.3&&this.overlay.stop(),i=this.context.time.time;return}this._isPinching=!0,this._lastPinch=0}),window.addEventListener("touchmove",n=>{if(!this._isPinching||!this._material)return;const r=n.touches[0],o=n.touches[1],a=r.clientX-o.clientX,l=r.clientY-o.clientY,c=Math.sqrt(a*a+l*l);if(this._lastPinch!==0){const h=c-this._lastPinch;this._material.zoom-=h*.004}this._lastPinch=c}),window.addEventListener("touchend",()=>{this._isPinching=!1})}disable(){this._onResizeScreenFn&&(window.removeEventListener("resize",this._onResizeScreenFn),this._onResizeScreenFn=void 0),this._onKeyUpFn&&(window.removeEventListener("keyup",this._onKeyUpFn),this._onKeyUpFn=void 0),this._onMouseWheelFn&&(window.removeEventListener("wheel",this._onMouseWheelFn),this._onMouseWheelFn=void 0)}}class fwe extends kt{constructor(t){super();d(this,"_offset",new ee);this.uniforms={map:{value:t},screenAspect:{value:1},offsetScale:{value:new Je(0,0,1,1)}},this.vertexShader=`
        uniform sampler2D map;
        uniform float screenAspect;
        uniform vec4 offsetScale;
        varying vec2 vUv;

        void main() {

            gl_Position = vec4( position , 1.0 );
            vUv = uv;
            vUv.y = 1. - vUv.y;

            // fit into screen
            ivec2 res = textureSize(map, 0);
            float videoAspect = float(res.x) / float(res.y);
            float aspect = videoAspect / screenAspect;
            if(aspect >= 1.0) 
            {
                vUv.y = vUv.y * aspect;
                float offset = (1. - aspect) * .5;
                vUv.y = vUv.y + offset;
            }
            else
            {
                vUv.x = vUv.x / aspect;
                float offset = (1. - 1. / aspect) * .5;
                vUv.x = vUv.x + offset;
            }

            vUv.x -= .5;
            vUv.y -= .5;

            vUv.x *= offsetScale.z;
            vUv.y *= offsetScale.z;
            vUv.x += offsetScale.x;
            vUv.y += offsetScale.y;

            vUv.x += .5;
            vUv.y += .5;
        }

        `,this.fragmentShader=`
        uniform sampler2D map;
        varying vec2 vUv;
        void main() {
            if(vUv.x < 0. || vUv.x > 1. || vUv.y < 0. || vUv.y > 1.)
                gl_FragColor = vec4(0., 0., 0., 1.);
            else
            {
                vec4 texcolor = texture2D(map, vUv);
                texcolor = LinearTosRGB(texcolor);
                gl_FragColor = texcolor;
            }
        }
        `}set screenAspect(t){this.uniforms.screenAspect.value=t,this.needsUpdate=!0}set offset(t){const i=this.uniforms.offsetScale.value;i.x=t.x,i.y=t.y,this.uniforms.offsetScale.value=i,this.needsUpdate=!0}get offset(){const t=this.uniforms.offsetScale.value;return this._offset.set(t.x,t.y),this._offset}set zoom(t){const i=this.uniforms.offsetScale.value;t<.001&&(t=.001),i.z=t,this.needsUpdate=!0}get zoom(){return this.uniforms.offsetScale.value.z}reset(){this.offset=this.offset.set(0,0),this.zoom=1,this.needsUpdate=!0}}var pwe=Object.defineProperty,mwe=Object.getOwnPropertyDescriptor,kx=(s,e,t,i)=>{for(var n=i>1?void 0:i?mwe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&pwe(e,t,n),n};const ir=ie("debugscreensharing");var Oq=(s=>(s[s.Screen=0]="Screen",s[s.Camera=1]="Camera",s[s.Canvas=2]="Canvas",s[s.Microphone=3]="Microphone",s))(Oq||{});class xf extends Ie{constructor(){super(...arguments);d(this,"allowStartOnClick",!0);d(this,"autoConnect",!1);d(this,"_videoPlayer");d(this,"_audioSource");d(this,"device","Screen");d(this,"deviceName");d(this,"deviceFilter");d(this,"_net");d(this,"_requestOpen",!1);d(this,"_currentStream",null);d(this,"_currentMode",0);d(this,"onJoinedRoom",async()=>{await Nc(1e3),this.autoConnect&&!this.isSending&&!this.isReceiving&&this.context.connection.isInRoom&&this.share()});d(this,"_activeShareRequest",null);d(this,"onReceiveStream",t=>{var i;((i=t.stream)==null?void 0:i.active)===!0&&this.setStream(t.stream,2)});d(this,"onCallEnded",t=>{ir&&console.log("CALL ENDED",this.isReceiving,this==null?void 0:this.screenspace),this.isReceiving&&(this.screenspace=!1)})}onPointerEnter(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorPointer()}onPointerExit(){this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&this.context.input.setCursorNormal()}onPointerClick(t){var i;if(this.context.connection.allowEditing!=!1&&this.allowStartOnClick&&!(t&&t.pointerId!==0)){if(this.isReceiving&&((i=this.videoPlayer)!=null&&i.isPlaying)){this.videoPlayer&&(this.videoPlayer.screenspace=!this.videoPlayer.screenspace);return}if(this.isSending){this.close();return}this.share()}}set videoPlayer(t){this._videoPlayer&&(this.isSending||this.isReceiving)&&this._videoPlayer.stop(),this._videoPlayer=t,this._videoPlayer&&this._currentStream&&(this.isSending||this.isReceiving)&&this._videoPlayer.setVideo(this._currentStream)}get videoPlayer(){return this._videoPlayer}get screenspace(){var t;return((t=this.videoPlayer)==null?void 0:t.screenspace)??!1}set screenspace(t){this.videoPlayer&&(this.videoPlayer.screenspace=t)}get currentScream(){return this._currentStream}get currentMode(){return this._currentMode}get isSending(){var t;return((t=this._currentStream)==null?void 0:t.active)&&this._currentMode===1}get isReceiving(){if(this._currentMode===2){if(!this._currentStream||this._currentStream.active===!1)return!1;const t=this._currentStream.getTracks();for(const i of t)if(i.readyState==="live")return!0}return!1}get requiresVideoPlayer(){return this.device!=="Microphone"}awake(){typeof this.device=="number"&&(this.device=Oq[this.device]),ir&&console.log("Screensharing",this.name,this),Hn.registerWaitForAllowAudio(()=>{this._videoPlayer&&this._currentStream&&this._currentMode===2&&(this._videoPlayer.playInBackground=!0,this._videoPlayer.setVideo(this._currentStream))});const t=Vy.getOrCreate(this.context,this.guid);this._net=new dx(this.context,t)}onEnable(){var t,i,n;(t=this._net)==null||t.enable(),(i=this._net)==null||i.addEventListener(Ic.StreamReceived,this.onReceiveStream),(n=this._net)==null||n.addEventListener(Ic.StreamEnded,this.onCallEnded),this.context.connection.beginListen(Qt.JoinedRoom,this.onJoinedRoom),this.autoConnect&&Nc(1e3).then(()=>(this.enabled&&this.autoConnect&&!this.isReceiving&&!this.isSending&&this.context.connection.isInRoom&&this.share(),0))}onDisable(){var t,i,n;(t=this._net)==null||t.removeEventListener(Ic.StreamReceived,this.onReceiveStream),(i=this._net)==null||i.removeEventListener(Ic.StreamEnded,this.onCallEnded),this.context.connection.stopListen(Qt.JoinedRoom,this.onJoinedRoom),(n=this._net)==null||n.disable(),this.close()}_ensureVideoPlayer(){const t=new Rs;t.aspectMode=Pq.AdjustWidth,ne.addComponent(this.gameObject,t),this._videoPlayer=t}async share(t){return this._activeShareRequest?this._activeShareRequest:(this._activeShareRequest=this.internalShare(t),this._activeShareRequest.then(()=>this._activeShareRequest=null))}async internalShare(t){if(this.context.connection.isInRoom===!1){console.warn("Can not start screensharing: requires network connection"),nt()&&Fi("Can not start screensharing: requires network connection. Add a SyncedRoom component or join a room first.");return}if(t!=null&&t.device&&(this.device=t.device),!this.videoPlayer&&this.requiresVideoPlayer&&(this._videoPlayer||(this._videoPlayer=ne.getComponent(this.gameObject,Rs)??void 0),this.videoPlayer||this._ensureVideoPlayer(),!this.videoPlayer)){console.warn("Can not share video without a videoPlayer assigned");return}this._requestOpen=!0;try{const i=(t==null?void 0:t.constraints)??{echoCancellation:!0,autoGainControl:!1},n={video:i,audio:i},r=n.video;switch(r!==void 0&&typeof r!="boolean"&&(r.width||(r.width={max:1920}),r.height||(r.height={max:1920}),r.aspectRatio||(r.aspectRatio={ideal:1.7777777778}),r.frameRate||(r.frameRate={ideal:24}),r.facingMode||(r.facingMode={ideal:"user"})),this.device){case"Camera":this.tryShareUserCamera(n,t);break;case"Screen":{if(!navigator.mediaDevices.getDisplayMedia){console.error("No getDisplayMedia support");return}const l=await navigator.mediaDevices.getDisplayMedia(n);this._requestOpen?this.setStream(l,1):Rc(l)}break;case"Canvas":const o=0,a=this.context.renderer.domElement.captureStream(o);this.setStream(a,1);break;case"Microphone":{if(!navigator.mediaDevices.getUserMedia){console.error("No getDisplayMedia support");return}n.video=!1;const l=await navigator.mediaDevices.getUserMedia(n);this._requestOpen?this.setStream(l,1):Rc(l)}break;default:console.error("Can not start screen sharing: Unknown device type",this.device)}}catch(i){if(i.name==="NotAllowedError"){console.log("Selection cancelled"),this._requestOpen=!1;return}console.error("Error opening video",i)}}close(){var t;this._requestOpen=!1,this._currentStream&&(ir&&console.warn("Close current stream / disposing resources, stream was active?",this._currentStream.active),(t=this._net)==null||t.stopSendingStream(this._currentStream),Rc(this._currentStream),this._currentMode=0,this._currentStream=null)}setStream(t,i){var o,a,l;if(t===this._currentStream||(this.close(),!t))return;this._currentStream=t,this._requestOpen=!0,this._currentMode=i;const n=this.device!=="Microphone",r=i===1;n?(this._videoPlayer||this._ensureVideoPlayer(),this._videoPlayer?this._videoPlayer.setVideo(t):console.error("No video player assigned for video stream")):(this._audioSource||(this._audioSource=new Hn,this._audioSource.spatialBlend=0,this._audioSource.volume=1,this.gameObject.addComponent(this._audioSource)),r||(ir&&console.log("PLAY",t.getAudioTracks()),this._audioSource.volume=1,(o=this._audioSource)==null||o.play(t))),r&&((a=this._net)==null||a.startSendingStream(t)),r&&(this._videoPlayer&&(this._videoPlayer.muted=!0),(l=this._audioSource)==null||l.stop());for(const c of t.getTracks())c.addEventListener("ended",()=>{ir&&console.log("Track ended",c),this.close()}),ir&&c.kind==="video"&&console.log(r?"Video ":"Video ",c.getSettings())}async tryShareUserCamera(t,i){const n=(await navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");ir&&console.log(`Request camera. These are your kind:videoinput devices:
`,n);let r=!1;for(const o of n)try{if(!this._requestOpen){ir&&console.log("Camera selection cancelled");break}if(o.kind!=="videoinput"){ir&&console.log("Skipping non-video device",o);continue}const a=o.deviceId;if((i==null?void 0:i.deviceId)!=null||(i==null?void 0:i.deviceFilter)!=null){if((i==null?void 0:i.deviceId)!==void 0&&a!==i.deviceId){ir&&console.log("Skipping device due to options.deviceId: "+o.label+"; "+o.deviceId);continue}if(i!=null&&i.deviceFilter&&i.deviceFilter(o)===!1){ir&&console.log("Skipping device due to options.deviceFilter: "+o.label+"; "+o.deviceId);continue}}else if(this.deviceFilter)if(this.deviceFilter(o)===!1){ir&&console.log("Skipping device due to ScreenShare.deviceFilter: "+o.label+"; "+o.deviceId);continue}else ir&&console.log("Selected device by filter",o);else if(this.deviceName){const h=o.label.toLowerCase(),u=this.deviceName.toLowerCase(),f=h.includes(u),p=o.deviceId===this.deviceName;if(!f&&!p){ir&&console.log("Skipping device due to ScreenShare.deviceName: "+o.label+"; "+o.deviceId);continue}else ir&&console.log("Selected device by name",o)}t.video!==!1&&((typeof t.video>"u"||typeof t.video=="boolean")&&(t.video={}),t.video.deviceId=a),r=!0;const c=await navigator.mediaDevices.getUserMedia(t).catch(h=>(console.error("Failed to get user media",h),null));if(c===null)continue;this._requestOpen?(this.setStream(c,1),ir&&console.log("Selected camera",o)):(Rc(c),ir&&console.log("Camera selection cancelled"));break}catch(a){if(a.message==="Failed to allocate videosource"||a.message==="Could not start video source"){Fi("Failed to start video: Try another camera (Code "+a.code+")"),console.warn(a);continue}else console.error("Failed to get user media",a.message,a.code,a)}!r&&nt()&&(Fi("No camera found for sharing. Please connect a camera (see console for more information)"),console.warn("No camera found for sharing. Please connect a camera",n,this.deviceName,"Using deviceFilter? "+this.deviceFilter!=null,"Using options? "+i!=null,"Using deviceName? "+this.deviceName!=null,"Using options.deviceId? "+(i==null?void 0:i.deviceId)!=null,"Using options.deviceFilter? "+(i==null?void 0:i.deviceFilter)!=null))}}kx([C()],xf.prototype,"allowStartOnClick",2);kx([C()],xf.prototype,"autoConnect",2);kx([C(Rs)],xf.prototype,"videoPlayer",1);kx([C()],xf.prototype,"device",2);kx([C()],xf.prototype,"deviceName",2);var gwe=Object.defineProperty,ywe=Object.getOwnPropertyDescriptor,Fx=(s,e,t,i)=>{for(var n=i>1?void 0:i?ywe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&gwe(e,t,n),n};class Au extends Sr{constructor(){super(...arguments);d(this,"intensity",new Ze(2));d(this,"falloff",new Ze(1));d(this,"samples",new Ze(9));d(this,"color",new Ze(new Ae(0,0,0)));d(this,"luminanceInfluence",new Ze(.7));d(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusion"}onBeforeRender(){if(this._ssao&&this.context.mainCamera instanceof Vt){const t=this.context.mainCamera.far-this.context.mainCamera.near;this._ssao.ssaoMaterial.worldDistanceFalloff=t*.01,this._ssao.ssaoMaterial.worldDistanceThreshold=this.context.mainCamera.far}}onCreateEffect(){const t=this.context.mainCamera,i=new nW(this.context.scene,t),n=new uk({normalBuffer:i.texture,resolutionScale:.5}),r=this._ssao=new eW(t,i.texture,{normalDepthBuffer:n.texture,worldDistanceThreshold:1,worldDistanceFalloff:1,worldProximityThreshold:.1,worldProximityFalloff:2,intensity:1,blendFunction:Xt.MULTIPLY,luminanceInfluence:.5});this.intensity.onValueChanged=a=>{r.intensity=a},this.falloff.onValueChanged=a=>{r.ssaoMaterial.radius=a*.1},this.samples.onValueChanged=a=>{r.samples=a},this.color.onValueChanged=a=>{r.color||(r.color=new Ae),r.color.copy(a)},this.luminanceInfluence.onValueChanged=a=>{r.luminanceInfluence=a};const o=new Array;return o.push(i),o.push(n),o.push(r),o}}Fx([C(Ze)],Au.prototype,"intensity",2);Fx([C(Ze)],Au.prototype,"falloff",2);Fx([C(Ze)],Au.prototype,"samples",2);Fx([C(Ze)],Au.prototype,"color",2);Fx([C(Ze)],Au.prototype,"luminanceInfluence",2);dl("ScreenSpaceAmbientOcclusion",Au);var vwe=Object.defineProperty,Awe=Object.getOwnPropertyDescriptor,Um=(s,e,t,i)=>{for(var n=i>1?void 0:i?Awe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&vwe(e,t,n),n},lO=(s=>(s[s.Performance=0]="Performance",s[s.Low=1]="Low",s[s.Medium=2]="Medium",s[s.High=3]="High",s[s.Ultra=4]="Ultra",s))(lO||{});class Kl extends Sr{constructor(){super(...arguments);d(this,"gammaCorrection",!0);d(this,"aoRadius",new Ze(1));d(this,"falloff",new Ze(1));d(this,"intensity",new Ze(1));d(this,"color",new Ze(new Ae(0,0,0)));d(this,"screenspaceRadius",!1);d(this,"quality",2);d(this,"_ssao")}get typeName(){return"ScreenSpaceAmbientOcclusionN8"}onValidate(){this._ssao&&(this._ssao.setQualityMode(lO[this.quality]),this._ssao.configuration.gammaCorrection=this.gammaCorrection,this._ssao.configuration.screenSpaceRadius=this.screenspaceRadius)}onCreateEffect(){const t=this.context.mainCamera,i=this._ssao=new Mq(this.context.scene,t,this.context.domWidth,this.context.domHeight),n=lO[this.quality];i.setQualityMode(n),i.configuration.gammaCorrection=this.gammaCorrection,i.configuration.screenSpaceRadius=this.screenspaceRadius,this.intensity.onValueChanged=o=>{i.configuration.intensity=o},this.falloff.onValueChanged=o=>{i.configuration.distanceFalloff=o},this.aoRadius.onValueChanged=o=>{i.configuration.aoRadius=o},this.color.onValueChanged=o=>{i.color||(i.color=new Ae),i.configuration.color.copy(o)};const r=new Array;return r.push(i),r}}Um([wr(),C()],Kl.prototype,"gammaCorrection",2);Um([C(Ze)],Kl.prototype,"aoRadius",2);Um([C(Ze)],Kl.prototype,"falloff",2);Um([C(Ze)],Kl.prototype,"intensity",2);Um([C(Ze)],Kl.prototype,"color",2);Um([wr(),C()],Kl.prototype,"screenspaceRadius",2);Um([wr(),C()],Kl.prototype,"quality",2);dl("ScreenSpaceAmbientOcclusionN8",Kl);var _we=Object.defineProperty,bwe=Object.getOwnPropertyDescriptor,Lq=(s,e,t,i)=>{for(var n=i>1?void 0:i?bwe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&_we(e,t,n),n};class Ux extends Ie{constructor(){super(...arguments);d(this,"mode",0);d(this,"shadowColor",new Ui(0,0,0,1));d(this,"targetMesh")}start(){if(this.gameObject instanceof fe)this.gameObject instanceof fe&&this.gameObject.material&&(this.gameObject.material=this.gameObject.material.clone(),this.targetMesh=this.gameObject,this.targetMesh.receiveShadow=!0);else{const t=Iv.createPrimitive(om.Quad,{name:"ShadowCatcher",material:new ws({color:10066329,roughness:1,metalness:0,transparent:!0})});t.receiveShadow=!0,t.geometry.rotateX(-Math.PI/2),this.gameObject.add(t),this.targetMesh=t}if(!this.targetMesh){console.warn("ShadowCatcher: no mesh to apply shadow catching to. Groups are currently not supported.");return}switch(this.targetMesh.layers.set(2),this.mode){case 0:this.applyShadowMaterial();break;case 1:this.applyLightBlendMaterial();break;case 2:this.applyOccluderMaterial();break}}applyLightBlendMaterial(){if(!this.targetMesh)return;const t=this.targetMesh.material;t.blending=Yp,this.applyMaterialOptions(t),t.onBeforeCompile=i=>{i.fragmentShader=i.fragmentShader.replace("vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;",`vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
            // diffuse-only lighting with overdrive to somewhat compensate
            // for the loss of indirect lighting and to make it more visible.
            vec3 direct = (reflectedLight.directDiffuse + reflectedLight.directSpecular) * 6.6;
            float max = max(direct.r, max(direct.g, direct.b));
            
            // early out - we're simply returning direct lighting and some alpha based on it so it can 
            // be blended onto the scene.
            gl_FragColor = vec4(direct, max);
            return;
            `)}}applyShadowMaterial(){if(this.targetMesh)if(this.targetMesh.material.type!=="ShadowMaterial"){const t=new pM;t.color=this.shadowColor,t.opacity=this.shadowColor.alpha,this.applyMaterialOptions(t),this.targetMesh.material=t}else{const t=this.targetMesh.material;t.color=this.shadowColor,t.opacity=this.shadowColor.alpha,this.applyMaterialOptions(t)}}applyOccluderMaterial(){if(this.targetMesh){let t=this.targetMesh.material;if(!t){const i=new ti;this.targetMesh.material=i,t=i}t.depthWrite=!0,t.stencilWrite=!0,t.colorWrite=!1,this.gameObject.renderOrder=-100}}applyMaterialOptions(t){t&&(t.depthWrite=!1,t.stencilWrite=!1)}}Lq([C()],Ux.prototype,"mode",2);Lq([C(Ui)],Ux.prototype,"shadowColor",2);var xwe=Object.defineProperty,wwe=Object.getOwnPropertyDescriptor,QT=(s,e,t,i)=>{for(var n=i>1?void 0:i?wwe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&xwe(e,t,n),n},OB;const kq=(OB=class extends Ie{constructor(){super(...arguments);d(this,"target",null);d(this,"followFactor",.1);d(this,"rotateFactor",.1);d(this,"positionAxes",wy.All);d(this,"flipForward",!1);d(this,"_firstUpdate",!0)}onBeforeRender(){this.updateNow(!1)}updateNow(e){if(!(!this.target||this.target===this.gameObject)){if(this.followFactor>0){const t=Ft(this.target),i=this._firstUpdate||e?1:it.clamp01(this.context.time.deltaTime*this.followFactor),n=this.worldPosition;this.positionAxes&wy.X&&(n.x=it.lerp(n.x,t.x,i)),this.positionAxes&wy.Y&&(n.y=it.lerp(n.y,t.y,i)),this.positionAxes&wy.Z&&(n.z=it.lerp(n.z,t.z,i)),this.worldPosition=n}if(this.rotateFactor>0){const t=ki(this.target);this.flipForward&&t.premultiply(kq._invertForward);const i=this._firstUpdate||e?1:it.clamp01(this.context.time.deltaTime*this.rotateFactor);this.worldQuaternion=this.worldQuaternion.slerp(t,i)}this._firstUpdate=!1}}},d(OB,"_invertForward",new Ce().setFromAxisAngle(new S(0,1,0),Math.PI)),OB);let wf=kq;QT([C(ye)],wf.prototype,"target",2);QT([C()],wf.prototype,"followFactor",2);QT([C()],wf.prototype,"rotateFactor",2);QT([C()],wf.prototype,"positionAxes",2);class Swe extends fe{constructor(e){const t=new Cwe(e),i=new ps(t.image.width*.001,t.image.height*.001),n=new ti({map:t,toneMapped:!1,transparent:!0});super(i,n);function r(o){n.map.dispatchDOMEvent(o)}this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){i.dispose(),n.dispose(),n.map.dispose(),cO.delete(e),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class Cwe extends tL{constructor(e){super(CV(e)),this.dom=e,this.anisotropy=16,this.colorSpace=bt,this.minFilter=Nt,this.magFilter=Nt;const t=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),i={attributes:!0,childList:!0,subtree:!0,characterData:!0};t.observe(e,i),this.observer=t}dispatchDOMEvent(e){e.data&&Ewe(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=CV(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const cO=new WeakMap;function CV(s){const e=document.createRange(),t=new Ae;function i(f){const p=[];let m=!1;function v(){if(m&&(m=!1,f.restore()),p.length===0)return;let g=-1/0,y=-1/0,A=1/0,_=1/0;for(let b=0;b<p.length;b++){const x=p[b];g=Math.max(g,x.x),y=Math.max(y,x.y),A=Math.min(A,x.x+x.width),_=Math.min(_,x.y+x.height)}f.save(),f.beginPath(),f.rect(g,y,A-g,_-y),f.clip(),m=!0}return{add:function(g){p.push(g),v()},remove:function(){p.pop(),v()}}}function n(f,p,m,v){v!==""&&(f.textTransform==="uppercase"&&(v=v.toUpperCase()),h.font=f.fontWeight+" "+f.fontSize+" "+f.fontFamily,h.textBaseline="top",h.fillStyle=f.color,h.fillText(v,p,m+parseFloat(f.fontSize)*.1))}function r(f,p,m,v,g){m<2*g&&(g=m/2),v<2*g&&(g=v/2),h.beginPath(),h.moveTo(f+g,p),h.arcTo(f+m,p,f+m,p+v,g),h.arcTo(f+m,p+v,f,p+v,g),h.arcTo(f,p+v,f,p,g),h.arcTo(f,p,f+m,p,g),h.closePath()}function o(f,p,m,v,g,y){const A=f[p+"Width"],_=f[p+"Style"],b=f[p+"Color"];A!=="0px"&&_!=="none"&&b!=="transparent"&&b!=="rgba(0, 0, 0, 0)"&&(h.strokeStyle=b,h.lineWidth=parseFloat(A),h.beginPath(),h.moveTo(m,v),h.lineTo(m+g,v+y),h.stroke())}function a(f,p){let m=0,v=0,g=0,y=0;if(f.nodeType===Node.TEXT_NODE){e.selectNode(f);const _=e.getBoundingClientRect();m=_.left-l.left-.5,v=_.top-l.top-.5,g=_.width,y=_.height,n(p,m,v,f.nodeValue.trim())}else{if(f.nodeType===Node.COMMENT_NODE)return;if(f instanceof HTMLCanvasElement){if(f.style.display==="none")return;const _=f.getBoundingClientRect();m=_.left-l.left-.5,v=_.top-l.top-.5,h.save();const b=window.devicePixelRatio;h.scale(1/b,1/b),h.drawImage(f,m,v),h.restore()}else if(f instanceof HTMLImageElement){if(f.style.display==="none")return;const _=f.getBoundingClientRect();m=_.left-l.left-.5,v=_.top-l.top-.5,g=_.width,y=_.height,h.drawImage(f,m,v,g,y)}else{if(f.style.display==="none")return;const _=f.getBoundingClientRect();m=_.left-l.left-.5,v=_.top-l.top-.5,g=_.width,y=_.height,p=window.getComputedStyle(f),r(m,v,g,y,parseFloat(p.borderRadius));const b=p.backgroundColor;b!=="transparent"&&b!=="rgba(0, 0, 0, 0)"&&(h.fillStyle=b,h.fill());const x=["borderTop","borderLeft","borderBottom","borderRight"];let E=!0,M=null;for(const T of x){if(M!==null&&(E=p[T+"Width"]===p[M+"Width"]&&p[T+"Color"]===p[M+"Color"]&&p[T+"Style"]===p[M+"Style"]),E===!1)break;M=T}if(E===!0){const T=parseFloat(p.borderTopWidth);p.borderTopWidth!=="0px"&&p.borderTopStyle!=="none"&&p.borderTopColor!=="transparent"&&p.borderTopColor!=="rgba(0, 0, 0, 0)"&&(h.strokeStyle=p.borderTopColor,h.lineWidth=T,h.stroke())}else o(p,"borderTop",m,v,g,0),o(p,"borderLeft",m,v,0,y),o(p,"borderBottom",m,v+y,g,0),o(p,"borderRight",m+g,v,0,y);if(f instanceof HTMLInputElement){let T=p.accentColor;(T===void 0||T==="auto")&&(T=p.color),t.set(T);const w=Math.sqrt(.299*t.r**2+.587*t.g**2+.114*t.b**2)<.5?"white":"#111111";if(f.type==="radio"&&(r(m,v,g,y,y),h.fillStyle="white",h.strokeStyle=T,h.lineWidth=1,h.fill(),h.stroke(),f.checked&&(r(m+2,v+2,g-4,y-4,y),h.fillStyle=T,h.strokeStyle=w,h.lineWidth=2,h.fill(),h.stroke())),f.type==="checkbox"&&(r(m,v,g,y,2),h.fillStyle=f.checked?T:"white",h.strokeStyle=f.checked?w:T,h.lineWidth=1,h.stroke(),h.fill(),f.checked)){const I=h.textAlign;h.textAlign="center";const O={color:w,fontFamily:p.fontFamily,fontSize:y+"px",fontWeight:"bold"};n(O,m+g/2,v,""),h.textAlign=I}if(f.type==="range"){const[I,O,k]=["min","max","value"].map(G=>parseFloat(f[G])),B=(k-I)/(O-I)*(g-y);r(m,v+y/4,g,y/2,y/4),h.fillStyle=w,h.strokeStyle=T,h.lineWidth=1,h.fill(),h.stroke(),r(m,v+y/4,B+y/2,y/2,y/4),h.fillStyle=T,h.fill(),r(m+B,v,y,y,y/2),h.fillStyle=T,h.fill()}(f.type==="color"||f.type==="text"||f.type==="number")&&(u.add({x:m,y:v,width:g,height:y}),n(p,m+parseInt(p.paddingLeft),v+parseInt(p.paddingTop),f.value),u.remove())}}}const A=p.overflow==="auto"||p.overflow==="hidden";A&&u.add({x:m,y:v,width:g,height:y});for(let _=0;_<f.childNodes.length;_++)a(f.childNodes[_],p);A&&u.remove()}const l=s.getBoundingClientRect();let c=cO.get(s);c===void 0&&(c=document.createElement("canvas"),c.width=l.width,c.height=l.height,cO.set(s,c));const h=c.getContext("2d"),u=new i(h);return h.clearRect(0,0,c.width,c.height),a(s),c}function Ewe(s,e,t,i){const n={clientX:t*s.offsetWidth+s.offsetLeft,clientY:i*s.offsetHeight+s.offsetTop,view:s.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(e,n));const r=s.getBoundingClientRect();t=t*r.width+r.left,i=i*r.height+r.top;function o(a){if(a.nodeType!==Node.TEXT_NODE&&a.nodeType!==Node.COMMENT_NODE){const l=a.getBoundingClientRect();if(t>l.left&&t<l.right&&i>l.top&&i<l.bottom&&(a.dispatchEvent(new MouseEvent(e,n)),a instanceof HTMLInputElement&&a.type==="range"&&(e==="mousedown"||e==="click"))){const[c,h]=["min","max"].map(m=>parseFloat(a[m])),u=l.width,p=(t-l.x)/u;a.value=c+(h-c)*p,a.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let c=0;c<a.childNodes.length;c++)o(a.childNodes[c])}}o(s)}const w1=new ee,Lg={type:"",data:w1},EV=new tf;class Mwe extends Vs{listenToPointerEvents(e,t){const i=this,n=new tf,r=e.domElement;function o(a){a.stopPropagation();const l=e.domElement.getBoundingClientRect();w1.x=(a.clientX-l.left)/l.width*2-1,w1.y=-(a.clientY-l.top)/l.height*2+1,n.setFromCamera(w1,t);const c=n.intersectObjects(i.children,!1);if(c.length>0){const h=c[0],u=h.object,f=h.uv;Lg.type=a.type,Lg.data.set(f.x,1-f.y),u.dispatchEvent(Lg)}}r.addEventListener("pointerdown",o),r.addEventListener("pointerup",o),r.addEventListener("pointermove",o),r.addEventListener("mousedown",o),r.addEventListener("mouseup",o),r.addEventListener("mousemove",o),r.addEventListener("click",o)}listenToXRControllerEvents(e){const t=this,i={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function n(r){const o=r.target;EV.setFromXRController(o);const a=EV.intersectObjects(t.children,!1);if(a.length>0){const l=a[0],c=l.object,h=l.uv;Lg.type=i[r.type],Lg.data.set(h.x,1-h.y),c.dispatchEvent(Lg)}}e.addEventListener("move",n),e.addEventListener("select",n),e.addEventListener("selectstart",n),e.addEventListener("selectend",n)}}var Twe=Object.defineProperty,Iwe=Object.getOwnPropertyDescriptor,Fq=(s,e,t,i)=>{for(var n=i>1?void 0:i?Iwe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Twe(e,t,n),n};class Nx extends Ie{constructor(){super(...arguments);d(this,"id",null);d(this,"keepAspect",!1);d(this,"_object",null)}onEnable(){if(this._object){this.gameObject.add(this._object);return}if(!this.id||!this.context.mainCamera)return;const t=document.getElementById(this.id);if(!t){console.warn('Could not find element with id "'+this.id+'"');return}t.style.display="block",t.style.visibility="hidden";const i=new Mwe;i.listenToPointerEvents(this.context.renderer,this.context.mainCamera),this.gameObject.add(i);const n=new Swe(t);i.add(n),n.visible=!1;const r=n.material;r.transparent=!0,setTimeout(()=>{n.visible=!0;const o=Gb(this.gameObject).clone();Hb(this.gameObject,0,0,0),this.gameObject.updateMatrixWorld();const a=new jt;a.setFromObject(i),this.setWorldRotation(o.x,o.y,o.z);const l=a.max.x-a.min.x,c=a.max.y-a.min.y;if(this.keepAspect){const u=l/c;l>c?n.scale.set(1/l,1/c/u,1):n.scale.set(1/l*u,1/c,1)}else n.scale.set(1/l,1/c,1);const h=this.gameObject.scale;n.scale.multiply(h)},1)}onDisable(){var t;(t=this._object)==null||t.removeFromParent()}}Fq([C()],Nx.prototype,"id",2);Fq([C()],Nx.prototype,"keepAspect",2);var Rwe=Object.defineProperty,Pwe=Object.getOwnPropertyDescriptor,zx=(s,e,t,i)=>{for(var n=i>1?void 0:i?Pwe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Rwe(e,t,n),n};const u_=ie("debugspatialtrigger"),MV=new Vr,TV=new Vr;function Bwe(s,e){return MV.mask=s,TV.mask=e,MV.test(TV)}class kc extends Ie{constructor(){super(...arguments);d(this,"triggerMask",0);d(this,"onEnter");d(this,"onStay");d(this,"onExit");d(this,"currentIntersected",[]);d(this,"lastIntersected",[])}start(){u_&&console.log(this.name,this.triggerMask,this)}update(){this.currentIntersected.length=0;for(const t of Gx.triggers)Bwe(t.triggerMask,this.triggerMask)&&t.test(this.gameObject)&&this.currentIntersected.push(t);for(let t=this.lastIntersected.length-1;t>=0;t--){const i=this.lastIntersected[t];this.currentIntersected.indexOf(i)<0&&(this.onExitTrigger(i),this.lastIntersected.splice(t,1))}for(const t of this.currentIntersected)this.lastIntersected.indexOf(t)<0&&this.onEnterTrigger(t),this.onStayTrigger(t);this.lastIntersected.length=0,this.lastIntersected.push(...this.currentIntersected)}onEnterTrigger(t){var i;u_&&console.log("ENTER TRIGGER",this.name,t.name,this,t),t.raiseOnEnterEvent(this),(i=this.onEnter)==null||i.invoke(this,t)}onExitTrigger(t){var i;u_&&console.log("EXIT TRIGGER",this.name,t.name,this,t),t.raiseOnExitEvent(this),(i=this.onExit)==null||i.invoke(this,t)}onStayTrigger(t){var i;t.raiseOnStayEvent(this),(i=this.onStay)==null||i.invoke(this,t)}}zx([C()],kc.prototype,"triggerMask",2);zx([C(Sn)],kc.prototype,"onEnter",2);zx([C(Sn)],kc.prototype,"onStay",2);zx([C(Sn)],kc.prototype,"onExit",2);var LB;const S1=(LB=class extends Ie{constructor(){super(...arguments);d(this,"triggerMask");d(this,"boxHelper")}start(){u_&&console.log(this.name,this.triggerMask,this)}onEnable(){var e;S1.triggers.push(this),this.boxHelper||(this.boxHelper=ne.addNewComponent(this.gameObject,el),(e=this.boxHelper)==null||e.showHelper(null,u_))}onDisable(){S1.triggers.splice(S1.triggers.indexOf(this),1)}test(e){return this.boxHelper?this.boxHelper.isInBox(e)??!1:!1}raiseOnEnterEvent(e){ne.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof kc&&t.onEnterTrigger(this)},!1)}raiseOnStayEvent(e){ne.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof kc&&t.onStayTrigger(this)},!1)}raiseOnExitEvent(e){ne.foreachComponent(this.gameObject,t=>{t!==e&&t instanceof kc&&t.onExitTrigger(this)},!1)}},d(LB,"triggers",[]),LB);let Gx=S1;zx([C()],Gx.prototype,"triggerMask",2);var Dwe=Object.defineProperty,Owe=Object.getOwnPropertyDescriptor,Lwe=(s,e,t,i)=>{for(var n=i>1?void 0:i?Owe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Dwe(e,t,n),n};const oa=ie("debugspectator");class WT extends Ie{constructor(){super(...arguments);d(this,"cam",null);d(this,"useKeys",!0);d(this,"_mode",0);d(this,"orbit",null);d(this,"_handler");d(this,"eventSub_WebXRRequestStartEvent",null);d(this,"eventSub_WebXRStartEvent",null);d(this,"eventSub_WebXREndEvent",null);d(this,"_debug");d(this,"_networking")}get mode(){return this._mode}set mode(t){this._mode=t}get isSpectating(){var t;return((t=this._handler)==null?void 0:t.currentTarget)!==void 0}isSpectatingUser(t){var i;return((i=this.target)==null?void 0:i.userId)===t}isFollowedBy(t){var i;return(i=this.followers)==null?void 0:i.includes(t)}get followers(){return this._networking.followers}stopSpectating(){if(this.context.isInXR){this.followSelf();return}this.target=void 0}get localId(){return this.context.connection.connectionId??"local"}set target(t){var i;if(this._handler){const n=(i=this._handler.currentTarget)==null?void 0:i.userId,r=this.context.players.getPlayerView(this.localId);t===void 0||this.context.isInXR===!1&&(r==null?void 0:r.currentObject)===t.currentObject?this._handler.currentTarget!==void 0&&(this._handler.disable(),ne.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),this._networking.onSpectatedObjectChanged(t,n)):this._handler.currentTarget!==t&&(this._handler.set(t),ne.setActive(this.gameObject,!0),this.orbit&&(this.orbit.enabled=!1),this._networking.onSpectatedObjectChanged(t,n))}}get target(){var t;return(t=this._handler)==null?void 0:t.currentTarget}requestAllFollowMe(){this._networking.onRequestFollowMe()}get isSpectatingSelf(){var t,i;return this.isSpectating&&((t=this.target)==null?void 0:t.currentObject)===((i=this.context.players.getPlayerView(this.localId))==null?void 0:i.currentObject)}awake(){if(this._debug=new Uwe(this.context,this),this._networking=new Gwe(this.context,this),this._networking.awake(),ne.setActive(this.gameObject,!1),this.cam=ne.getComponent(this.gameObject,Hi),!this.cam){console.warn("SpectatorCamera: Spectator camera needs camera component on the same object.",this);return}!this._handler&&this.cam&&(this._handler=new kwe(this.context,this.cam,this)),this.orbit=ne.getComponent(this.context.mainCamera,Ei)}onDestroy(){var t,i;this.stopSpectating(),(t=this._handler)==null||t.destroy(),(i=this._networking)==null||i.destroy()}isSupportedPlatform(){const t=window.navigator.userAgent,i=/Windows|MacOS/.test(t),n=/Windows NT/.test(t)&&/Edg/.test(t)&&!/Win64/.test(t);return i&&!n}onBeforeXR(t){this.isSupportedPlatform()&&ne.setActive(this.gameObject,!0)}onEnterXR(t){this.isSupportedPlatform()&&(oa&&console.log(this.context.mainCamera),this.context.mainCamera&&this.followSelf())}onLeaveXR(t){var i,n;this.context.removeCamera(this.cam),ne.setActive(this.gameObject,!1),this.orbit&&(this.orbit.enabled=!0),(i=this._handler)==null||i.set(void 0),(n=this._handler)==null||n.disable(),this.isSpectatingSelf&&this.stopSpectating()}followSelf(){this.target=this.context.players.getPlayerView(this.context.connection.connectionId),this.target||(this.context.players.setPlayerView(this.localId,this.context.mainCamera,Pd.Headset),this.target=this.context.players.getPlayerView(this.localId)),oa&&console.log("Follow self",this.target)}onAfterRender(){var h,u,f;if(!this.cam)return;const t=this.context.renderer,i=t.xr.enabled;if(!t.xr.isPresenting&&!((h=this._handler)!=null&&h.currentTarget))return;(u=this._handler)==null||u.update(this._mode);const n=t.getRenderTarget();let r=null;const o=t.state;if(!n){if(!t.state.bindFramebuffer||!o.bindXRFramebuffer)return;r=t._framebuffer,o.bindXRFramebuffer(null)}this.setAvatarFlagsBeforeRender();const a=this.context.mainCameraComponent;if(a){const p=a.backgroundColor;p&&t.setClearColor(p,p.alpha),this.cam.backgroundColor=p,this.cam.clearFlags=a.clearFlags,this.cam.nearClipPlane=a.nearClipPlane,this.cam.farClipPlane=a.farClipPlane}else t.setClearColor(new Ae(1,1,1));t.setRenderTarget(null),t.xr.enabled=!1;const l=(f=this.cam)==null?void 0:f.cam;this.context.updateAspect(l);const c=t.xr.isPresenting;t.xr.isPresenting=!1,t.setSize(this.context.domWidth,this.context.domHeight),t.render(this.context.scene,l),t.xr.isPresenting=c,t.xr.enabled=i,n?t.setRenderTarget(n):o.bindXRFramebuffer&&o.bindXRFramebuffer(r),this.resetAvatarFlags()}setAvatarFlagsBeforeRender(){const t=this._mode===0;for(const i of Ss.instances)if(i.avatar&&"isLocalAvatar"in i.avatar&&"flags"in i.avatar){let n=bc.All;this.isSpectatingSelf&&(n=t&&i.avatar.isLocalAvatar?bc.FirstPerson:bc.ThirdPerson);const r=i.avatar.flags;if(!r)continue;for(const o of r)o.UpdateVisible(n)}}resetAvatarFlags(){var t;for(const i of Ss.instances)if(i.avatar&&"flags"in i.avatar){const n=i.avatar.flags;if(!n)continue;for(const r of n)"isLocalAvatar"in i.avatar&&((t=i.avatar)!=null&&t.isLocalAvatar)?r.UpdateVisible(bc.FirstPerson):r.UpdateVisible(bc.ThirdPerson)}}}Lwe([C()],WT.prototype,"useKeys",2);class kwe{constructor(e,t,i){d(this,"context");d(this,"cam");d(this,"spectator");d(this,"follow");d(this,"target");d(this,"view");d(this,"currentObject");this.context=e,this.cam=t,this.spectator=i}get currentTarget(){return this.view}set(e){const t=e==null?void 0:e.currentObject;if(!t){this.spectator.stopSpectating();return}t!==this.currentObject&&(this.currentObject=t,this.view=e,this.follow||(this.follow=ne.addNewComponent(this.cam.gameObject,wf)),this.target||(this.target=new ye),t.add(this.target),this.follow.enabled=!0,this.follow.target=this.target,oa&&console.log("FOLLOW",t),this.context.isInXR?this.context.removeCamera(this.cam):this.context.setCurrentCamera(this.cam))}disable(){oa&&console.log("STOP FOLLOW",this.currentObject),this.view=void 0,this.currentObject=void 0,this.context.removeCamera(this.cam),this.follow&&(this.follow.enabled=!1)}destroy(){var e;(e=this.target)==null||e.removeFromParent(),this.follow&&ne.destroy(this.follow)}update(e){var n,r,o,a,l,c;if(((n=this.currentTarget)==null?void 0:n.isConnected)===!1||((r=this.currentTarget)==null?void 0:r.removed)===!0){oa&&console.log("Target disconnected or timeout",this.currentTarget),this.spectator.stopSpectating();return}this.currentTarget&&((o=this.currentTarget)==null?void 0:o.currentObject)!==this.currentObject&&(oa&&console.log("Target changed",this.currentObject,"to",this.currentTarget.currentObject),this.set(this.currentTarget));const t=this.context.mainCamera;t&&(this.cam.cam.near!==t.near||this.cam.cam.far!==t.far)&&(this.cam.cam.near=t.near,this.cam.cam.far=t.far,this.cam.cam.updateProjectionMatrix());const i=(a=this.follow)==null?void 0:a.target;if(!(!i||!this.follow)){switch(e){case 0:((l=this.view)==null?void 0:l.viewDevice)!==Pd.Browser?(this.follow.followFactor=5,this.follow.rotateFactor=5):(this.follow.followFactor=50,this.follow.rotateFactor=50),i.position.set(0,0,0);break;case 1:this.follow.followFactor=3,this.follow.rotateFactor=2,i.position.set(0,.5,1.5);break}this.follow.flipForward=!1,((c=this.view)==null?void 0:c.viewDevice)!==Pd.Browser?i.quaternion.copy(Fwe):i.quaternion.identity()}}}const Fwe=new Ce().setFromAxisAngle(new S(0,1,0),Math.PI);class Uwe{constructor(e,t){d(this,"context");d(this,"spectator");this.context=e,this.spectator=t,console.log("Click other avatars or cameras to follow them. Press ESC to exit spectator mode."),this.context.domElement.addEventListener("keydown",n=>{if(!this.spectator.useKeys)return;n.key==="Escape"&&this.spectator.stopSpectating()});let i=0;this.context.input.addEventListener(vn.PointerDown,n=>{i=this.context.time.time}),this.context.input.addEventListener(vn.PointerUp,n=>{const r=this.context.time.time-i;r>1?this.spectator.stopSpectating():this.context.input.getPointerClicked(0)&&r<.3&&this.trySelectObject()})}trySelectObject(){const e=new zc;e.setMask(16777215);const t=this.context.physics.raycast(e);if(oa&&console.log(...t),t!=null&&t.length)for(const i of t){if(i.distance<.2)continue;const n=i.object,r=ne.getComponentInParent(n,Ss),o=r==null?void 0:r.connectionId;if(o){const a=this.context.players.getPlayerView(o);this.spectator.target=a,oa&&console.log("spectate",o,r);break}}}}class Nwe{constructor(e,t,i){d(this,"guid");d(this,"dontSave",!0);d(this,"targetUserId");d(this,"stoppedFollowing");this.guid=e,this.targetUserId=t,this.stoppedFollowing=i}}class zwe{constructor(e,t){d(this,"guid");d(this,"userId");this.guid=e.guid,this.userId=t}}class Gwe{constructor(e,t){d(this,"followers",[]);d(this,"context");d(this,"spectator");d(this,"_followerEventMethod");d(this,"_requestFollowMethod");d(this,"_joinedRoomMethod");d(this,"_lastRequestFollowUser");d(this,"_enforceFollowInterval");this.context=e,this.spectator=t,this._followerEventMethod=this.onFollowerEvent.bind(this),this._requestFollowMethod=this.onRequestFollowEvent.bind(this),this._joinedRoomMethod=this.onUserJoinedRoom.bind(this)}awake(){this.context.connection.beginListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.beginListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.beginListen(Qt.JoinedRoom,this._joinedRoomMethod),this.context.domElement.addEventListener("keydown",e=>{this.spectator.useKeys&&(e.key==="f"?this.onRequestFollowMe():e.key==="Escape"&&this.onRequestFollowMe(!0))})}destroy(){this.context.connection.stopListen("spectator-follower-changed",this._followerEventMethod),this.context.connection.stopListen("spectator-request-follow",this._requestFollowMethod),this.context.connection.stopListen(Qt.JoinedRoom,this._joinedRoomMethod)}onSpectatedObjectChanged(e,t){if(oa&&console.log(this.context.connection.connectionId,"onSpectatedObjectChanged",e,t),this.context.connection.connectionId){const i=(e==null?void 0:e.userId)===void 0,n=i?t:e==null?void 0:e.userId,r=new Nwe(this.context.connection.connectionId,n,i);this.context.connection.send("spectator-follower-changed",r)}}onRequestFollowMe(e=!1){if(oa&&console.log("Request follow",this.context.connection.connectionId),this.context.connection.connectionId){this.spectator.stopSpectating();const t=e?void 0:this.context.connection.connectionId,i=new zwe(this.spectator,t);this.context.connection.send("spectator-request-follow",i)}}onUserJoinedRoom(){ie("followme")&&this.onRequestFollowMe()}onFollowerEvent(e){const t=e.targetUserId,i=e.guid;if(oa&&console.log(e),t===this.context.connection.connectionId)if(e.stoppedFollowing){const n=this.followers.indexOf(i);n!==-1&&(this.followers.splice(n,1),this.removeDisconnectedFollowers(),console.log(i,"unfollows you",this.followers.length))}else this.followers.includes(i)||(this.followers.push(i),this.removeDisconnectedFollowers(),console.log(i,"follows you",this.followers.length))}removeDisconnectedFollowers(){for(let e=this.followers.length-1;e>=0;e--){const t=this.followers[e];this.context.connection.userIsInRoom(t)===!1&&this.followers.splice(e,1)}}onRequestFollowEvent(e){if(this._lastRequestFollowUser=e,e.userId===this.context.connection.connectionId)this.spectator.stopSpectating();else if(e.userId===void 0)this.spectator.stopSpectating();else{const t=this.context.players.getPlayerView(e.userId);if(t)this.spectator.target=t;else return oa&&console.warn("Could not find view",e.userId),this.enforceFollow(),!1}return!0}enforceFollow(){this._enforceFollowInterval||(this._enforceFollowInterval=setInterval(()=>{this._lastRequestFollowUser===void 0||this._lastRequestFollowUser.userId&&this.spectator.isFollowedBy(this._lastRequestFollowUser.userId)?(clearInterval(this._enforceFollowInterval),this._enforceFollowInterval=void 0):(oa&&console.log("REQUEST FOLLOW AGAIN",this._lastRequestFollowUser.userId),this.onRequestFollowEvent(this._lastRequestFollowUser))},1e3))}}class gc{constructor(){d(this,"bb",null);d(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSyncedCameraModel(e,t){return(t||new gc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSyncedCameraModel(e,t){return e.setPosition(e.position()+Tk),(t||new gc).__init(e.readInt32(e.position())+e.position(),e)}userId(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}guid(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}dontSave(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}pos(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new Hp).__init(this.bb_pos+t,this.bb):null}rot(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new Hp).__init(this.bb_pos+t,this.bb):null}static startSyncedCameraModel(e){e.startObject(5)}static addUserId(e,t){e.addFieldOffset(0,t,0)}static addGuid(e,t){e.addFieldOffset(1,t,0)}static addDontSave(e,t){e.addFieldInt8(2,+t,0)}static addPos(e,t){e.addFieldStruct(3,t,0)}static addRot(e,t){e.addFieldStruct(4,t,0)}static endSyncedCameraModel(e){return e.endObject()}static finishSyncedCameraModelBuffer(e,t){e.finish(t)}static finishSizePrefixedSyncedCameraModelBuffer(e,t){e.finish(t,void 0,!0)}}var Hwe=Object.defineProperty,Vwe=Object.getOwnPropertyDescriptor,Qwe=(s,e,t,i)=>{for(var n=i>1?void 0:i?Vwe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Hwe(e,t,n),n};const ME="SCAM";Rk(ME,gc.getRootAsSyncedCameraModel);const Zo=new jb;class Wwe{constructor(e,t){d(this,"userId");d(this,"guid");this.guid=t,this.userId=e}send(e,t){if(e){Zo.clear();const i=Zo.createString(this.guid),n=Zo.createString(this.userId);gc.startSyncedCameraModel(Zo),gc.addGuid(Zo,i),gc.addUserId(Zo,n);const r=Ft(e),o=Gb(e);gc.addPos(Zo,Hp.createVec3(Zo,r.x,r.y,r.z)),gc.addRot(Zo,Hp.createVec3(Zo,o.x,o.y,o.z));const a=gc.endSyncedCameraModel(Zo);Zo.finish(a,ME),t.sendBinary(Zo.asUint8Array())}}}var kB;const hO=(kB=class extends Ie{constructor(){super(...arguments);d(this,"cameraPrefab",null);d(this,"_lastWorldPosition");d(this,"_lastWorldQuaternion");d(this,"_model",null);d(this,"_needsUpdate",!0);d(this,"_lastUpdateTime",0);d(this,"remoteCams",{});d(this,"userToCamMap",{});d(this,"_camTimeoutInSeconds",10);d(this,"_receiveCallback",null)}getCameraObject(e){const t=this.userToCamMap[e];return t?this.remoteCams[t].obj:null}async awake(){this._lastWorldPosition=this.worldPosition.clone(),this._lastWorldQuaternion=this.worldQuaternion.clone(),this.cameraPrefab&&("uri"in this.cameraPrefab&&(this.cameraPrefab=await this.cameraPrefab.instantiate(this.gameObject)),this.cameraPrefab&&"isObject3D"in this.cameraPrefab&&(this.cameraPrefab.visible=!1))}onEnable(){this._receiveCallback=this.context.connection.beginListenBinary(ME,this.onReceivedRemoteCameraInfoBin.bind(this))}onDisable(){this.context.connection.stopListenBinary(ME,this._receiveCallback)}update(){for(const n in this.remoteCams){const r=this.remoteCams[n],o=this.context.time.realtimeSinceStartup-r.lastUpdate;if(!r||o>this._camTimeoutInSeconds){nt()&&console.log("Remote cam timeout",n),r!=null&&r.obj&&ne.destroy(r.obj),delete this.remoteCams[n],r&&delete this.userToCamMap[r.userId],hO.instances.push(r),this.context.players.removePlayerView(r.userId,Pd.Browser);continue}}if(this.context.isInXR)return;const e=this.context.mainCamera;if(e===null){this.enabled=!1;return}if(!this.context.connection.isConnected||this.context.connection.connectionId===null)return;this._model===null&&(this._model=new Wwe(this.context.connection.connectionId,this.context.connection.connectionId+"_camera"));const t=Ft(e),i=ki(e);(t.distanceTo(this._lastWorldPosition)>.001||i.angleTo(this._lastWorldQuaternion)>.01)&&(this._needsUpdate=!0),this._lastWorldPosition.copy(t),this._lastWorldQuaternion.copy(i),!((!this._needsUpdate||this.context.time.frameCount%2!==0)&&!(this.context.time.realtimeSinceStartup-this._lastUpdateTime>this._camTimeoutInSeconds*.5))&&(this._lastUpdateTime=this.context.time.realtimeSinceStartup,this._needsUpdate=!1,this._model.send(e,this.context.connection),this.context.isInXR||this.context.players.setPlayerView(this.context.connection.connectionId,e,Pd.Browser))}onReceivedRemoteCameraInfoBin(e){const t=e.guid();if(!t)return;const i=e.userId();if(!i||!this.context.connection.userIsInRoom(i)||!this.cameraPrefab)return;let n=this.remoteCams[t];if(!n)if("isObject3D"in this.cameraPrefab){const l=new Xl;l.context=this.context;const c=ne.instantiate(this.cameraPrefab,l);n=this.remoteCams[t]={obj:c,lastUpdate:this.context.time.realtimeSinceStartup,userId:i},n.obj.visible=!0,this.gameObject.add(c),this.userToCamMap[i]=t,hO.instances.push(n);const h=ne.getOrAddComponent(c,Ss);h.connectionId=i,h.avatar=c}else return;const r=n.obj;this.context.players.setPlayerView(i,r,Pd.Browser),n.lastUpdate=this.context.time.realtimeSinceStartup,sl.markDirty(r);const o=e.pos();o&&rm(r,o.x(),o.y(),o.z());const a=e.rot();a&&Hb(r,a.x(),a.y(),a.z())}},d(kB,"instances",[]),kB);let jT=hO;Qwe([C([ye,ei])],jT.prototype,"cameraPrefab",2);var jwe=Object.defineProperty,qwe=Object.getOwnPropertyDescriptor,Sf=(s,e,t,i)=>{for(var n=i>1?void 0:i?qwe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&jwe(e,t,n),n};const nB="view",sB=ie("debugsyncedroom");class Jl extends Ie{constructor(){super(...arguments);d(this,"roomName","");d(this,"urlParameterName","room");d(this,"joinRandomRoom");d(this,"requireRoomParameter",!1);d(this,"autoRejoin",!0);d(this,"createJoinButton",!0);d(this,"createViewOnlyButton",!1);d(this,"_lastJoinedRoom");d(this,"_roomPrefix","");d(this,"_lastPingTime",0);d(this,"_lastRoomTime",-1);d(this,"_userWantsToBeInARoom",!1);d(this,"_roomButton");d(this,"_roomButtonIconJoin");d(this,"_roomButtonIconLeave");d(this,"updateRoomButtonState",()=>{var t,i;this._roomButton&&(this.context.connection.isInRoom?(this._roomButton.title="Leave the networked room",this._roomButton.textContent="Leave Room",(t=this._roomButtonIconJoin)==null||t.remove(),this._roomButton.prepend(this._roomButtonIconLeave)):(this._roomButton.title="Create or join a networked room",this._roomButton.textContent="Join Room",(i=this._roomButtonIconLeave)==null||i.remove(),this._roomButton.prepend(this._roomButtonIconJoin)))});d(this,"_viewOnlyButton");d(this,"onCreateViewOnlyButton",()=>{if(!this._viewOnlyButton){const t=document.createElement("button");this._viewOnlyButton=t,t.classList.add("view-only-button"),t.setAttribute("priority","90"),t.onclick=()=>{var n;const i=this.getViewOnlyUrl();i!=null&&i.length?navigator.canShare({url:i})?(n=navigator.share({url:i}))==null||n.catch(r=>{console.warn(r)}):(navigator.clipboard.writeText(i),_n("View only URL copied to clipboard")):Fi("Could not create view only URL")},t.title="Copy the view only URL: A page accessed by the view only URL can not be modified by visiting users.",t.textContent="Share View URL",t.prepend(dr("visibility"))}this.context.menu.appendChild(this._viewOnlyButton)})}get currentRoomName(){const t=ie(nB);return t||ie(this.urlParameterName)}set roomPrefix(t){this._roomPrefix=t}get roomPrefix(){return this._roomPrefix}awake(){var t;this.joinRandomRoom===void 0&&((t=this.roomName)==null?void 0:t.length)<=0&&(this.joinRandomRoom=!0),sB&&console.log(`SyncedRoom roomName:${this.roomName}, urlParamName:${this.urlParameterName}, joinRandomRoom:${this.joinRandomRoom}`)}onEnable(){const t=ie(nB);if(t&&typeof t=="string"&&t.length>0){console.log("Join as viewer"),this.context.connection.joinRoom(t,!0);return}if(this.tryJoinRoom(),this.createJoinButton){const i=this.createRoomButton();this.context.menu.appendChild(i)}this.createViewOnlyButton&&this.onEnableViewOnlyButton()}onDisable(){var t;(t=this._roomButton)==null||t.remove(),this.onDisableViewOnlyButton(),this.roomName&&this.roomName.length>0&&this.context.connection.leaveRoom(this.roomName)}onDestroy(){this.destroyRoomButton()}tryJoinRandomRoom(){this.setRandomRoomUrlParameter(),this.tryJoinRoom()}tryJoinRoom(t=0){var n;t===void 0&&(t=0);let i=!1;if(((n=this.urlParameterName)==null?void 0:n.length)>0){const r=ie(this.urlParameterName);if(r&&(typeof r=="string"||typeof r=="number")){i=!0;const o=w6(r.toString());this.roomName=o}else if(this.joinRandomRoom&&(console.log("No room name found in url, generating random one"),this.setRandomRoomUrlParameter(),t<1))return this.tryJoinRoom(t+1)}else this.joinRandomRoom&&(this.roomName===null||this.roomName===void 0||this.roomName.length<=0)&&(this.roomName=this.generateRoomName());return this.requireRoomParameter&&!i?((sB||nt())&&console.warn('SyncedRoom: Missing required room parameter "'+this.urlParameterName+`" in url - will not connect.
To allow joining a room without a query parameter you can set "requireRoomParameter" to false.`),!1):(this.context.connection.isConnected||this.context.connection.connect(),this._lastJoinedRoom=this.roomName,this._roomPrefix&&(this.roomName=this._roomPrefix+this.roomName),this.roomName.length<=0?(console.warn(`SyncedRoom: Room name is not set so we can not join a networked room.
Please choose one of the following options to fix this:
A) Set a room name in the SyncedRoom component
B) Set a room name in the URL parameter "?`+this.urlParameterName+`=my_room"
C) Set "joinRandomRoom" to true`),!1):(sB&&console.log("Join "+this.roomName),this._userWantsToBeInARoom=!0,this.context.connection.joinRoom(this.roomName),!0))}update(){this.context.connection.isConnected&&(this.context.time.time-this._lastPingTime>3&&(this._lastPingTime=this.context.time.time,this.context.connection.sendPing()),this.context.connection.isInRoom&&(this._lastRoomTime=this.context.time.time)),this._lastRoomTime>0&&this.context.time.time-this._lastRoomTime>.3&&(this._lastRoomTime=-1,this.autoRejoin?this._userWantsToBeInARoom&&(console.log("Disconnected from networking backend - attempt reconnecting now"),this.tryJoinRoom()):nt()&&console.warn("You are not connected to a room anymore (possibly because the tab was inactive for too long and the server kicked you?)"))}getViewOnlyUrl(){if(this.context.connection.isConnected&&this.context.connection.currentRoomViewId){const t=window.location.search,i=new URLSearchParams(t);return i.has(this.urlParameterName)&&i.delete(this.urlParameterName),i.set(nB,this.context.connection.currentRoomViewId),window.location.origin+window.location.pathname+"?"+i.toString()}return null}setRandomRoomUrlParameter(){const t=kb(),i=this.generateRoomName();ie(this.urlParameterName)?t.set(this.urlParameterName,i):t.append(this.urlParameterName,i),wL(i,t)}generateRoomName(){let t="";for(let i=0;i<6;i++)t+=Math.floor(Math.random()*10).toFixed(0);return t}createRoomButton(){if(this._roomButton)return this._roomButton;const t=document.createElement("button");return this._roomButton=t,t.classList.add("create-room-button"),t.setAttribute("priority","90"),t.onclick=()=>{if(this.context.connection.isInRoom)this.urlParameterName&&H1(this.urlParameterName,null),this.context.connection.leaveRoom(),this._userWantsToBeInARoom=!1;else{if(this.urlParameterName){const i=ie(this.urlParameterName);(!i||i===!0)&&(this._lastJoinedRoom?H1(this.urlParameterName,this._lastJoinedRoom):this.setRandomRoomUrlParameter())}this.tryJoinRoom()}},this._roomButtonIconJoin=dr("group"),this._roomButtonIconLeave=dr("group_off"),this.updateRoomButtonState(),this.context.connection.beginListen(Qt.JoinedRoom,this.updateRoomButtonState),this.context.connection.beginListen(Qt.LeftRoom,this.updateRoomButtonState),t}destroyRoomButton(){this.context.connection.stopListen(Qt.JoinedRoom,this.updateRoomButtonState),this.context.connection.stopListen(Qt.LeftRoom,this.updateRoomButtonState)}onEnableViewOnlyButton(){this.context.connection.isConnected?this.onCreateViewOnlyButton():(this.context.connection.stopListen(Qt.JoinedRoom,this.onCreateViewOnlyButton),this.context.connection.beginListen(Qt.JoinedRoom,this.onCreateViewOnlyButton))}onDisableViewOnlyButton(){var t;this.context.connection.stopListen(Qt.JoinedRoom,this.onCreateViewOnlyButton),(t=this._viewOnlyButton)==null||t.remove()}}Sf([C()],Jl.prototype,"roomName",2);Sf([C()],Jl.prototype,"urlParameterName",2);Sf([C()],Jl.prototype,"joinRandomRoom",2);Sf([C()],Jl.prototype,"requireRoomParameter",2);Sf([C()],Jl.prototype,"autoRejoin",2);Sf([C()],Jl.prototype,"createJoinButton",2);Sf([C()],Jl.prototype,"createViewOnlyButton",2);Sf([C()],Jl.prototype,"roomPrefix",1);function Xwe(){const s=ie("testwindowcount")||0;s&&s>0&&Ywe(s)}function Ywe(s){if(ie("testwindow"))return null;const e=new URL(window.location.href);M2(e.searchParams,bve,1),M2(e.searchParams,"testwindow",1);const t=e.toString(),i=[];window.onbeforeunload=()=>{for(const l of i)l.close()};const n=.05,r=128;let o=0,a=0;for(let l=0;l<s;l++){o*r+r*.01>=window.innerWidth&&(a+=1,o=0);const c=o*(r*(1+n))+window.screenLeft,h=a*(r*(1+n))+window.screenTop+90+60*a;o+=1;const u=window.open(t,"test window "+l,`popup=yes width=${r} height=${r} top=${h} left=${c}`);if(!u){console.warn("Failed to open window");continue}i.push(u),u.onload=()=>{u.onbeforeunload=()=>{for(let f=0;f<i.length;f++){const p=i[f];p!==u&&p.close()}i.length=0}}}return i}class uU extends Ie{awake(){Xwe()}}class dU extends Ie{constructor(){super(...arguments);d(this,"transformsPerFrame",10);d(this,"interval",0);d(this,"useFlatbuffers",!0);d(this,"builder",null);d(this,"models",null)}awake(){if(this.useFlatbuffers)this.context.connection.beginListenBinary(tb,t=>{});else{this.models=[];for(let t=0;t<this.transformsPerFrame;t++)this.models.push(new Uq(this.context.connection.connectionId+"_simulatedTransform_"+t,this))}}update(){if(this.context.connection.isConnected){if(this.useFlatbuffers){if(!this.context.connection.connectionId||this.context.time.frameCount%this.interval!==0)return;this.builder===null&&(this.builder=new jb(1024));const t=this.builder;for(let i=0;i<this.transformsPerFrame;i++){t.clear();const n=I7(this.context.connection.connectionId,this);this.context.connection.sendBinary(n)}}else if(this.models)for(let t=0;t<this.models.length;t++){const i=this.models[t];i.dontSave=!0,i.update(this,null),this.context.connection.send("TestSimulateUserData-"+t,i)}}}}class Uq{constructor(e,t){d(this,"guid");d(this,"fast",!1);d(this,"position");d(this,"rotation");d(this,"velocity");d(this,"dontSave");this.guid=e,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0,w:0},this.update(t,null)}isValid(){return this.fast!==void 0||this.position!==void 0||this.rotation!==void 0||this.velocity!==void 0}update(e,t){const i=e.worldPosition;this.position.x=i.x,this.position.y=i.y,this.position.z=i.z;const n=e.worldQuaternion;if(this.rotation.x=n.x,this.rotation.y=n.y,this.rotation.z=n.z,this.rotation.w=n.w,this.fast=!1,t){const r=t.getVelocity();this.velocity===void 0&&(this.velocity={x:0,y:0,z:0}),this.velocity.x=r.x,this.velocity.y=r.y,this.velocity.z=r.z}}}d(Uq,"temp",new S);var Kwe=Object.defineProperty,Jwe=Object.getOwnPropertyDescriptor,n0=(s,e,t,i)=>{for(var n=i>1?void 0:i?Jwe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Kwe(e,t,n),n};class th extends Sr{constructor(){super(...arguments);d(this,"offset",new Ze(0));d(this,"rotation",new Ze(0));d(this,"focusArea",new Ze(.4));d(this,"feather",new Ze(.3));d(this,"kernelSize",new Ze(Dc.MEDIUM));d(this,"resolutionScale",new Ze(1/window.devicePixelRatio))}get typeName(){return"TiltShiftEffect"}init(){this.offset.defaultValue=0,this.rotation.defaultValue=0,this.focusArea.defaultValue=.4,this.feather.defaultValue=.3,this.kernelSize.defaultValue=Dc.MEDIUM,this.resolutionScale.defaultValue=1/window.devicePixelRatio}onCreateEffect(){const t=new tW({kernelSize:Dc.VERY_LARGE,offset:this.offset.value,rotation:this.rotation.value,focusArea:this.focusArea.value,feather:this.feather.value});return this.offset.onValueChanged=i=>t.offset=i,this.rotation.onValueChanged=i=>t.rotation=i,this.focusArea.onValueChanged=i=>t.focusArea=i,this.feather.onValueChanged=i=>t.feather=i,this.kernelSize.onValueChanged=i=>t.blurPass.kernelSize=i,this.resolutionScale.onValueChanged=i=>t.resolution.scale=i/window.devicePixelRatio,t}}n0([C(Ze)],th.prototype,"offset",2);n0([C(Ze)],th.prototype,"rotation",2);n0([C(Ze)],th.prototype,"focusArea",2);n0([C(Ze)],th.prototype,"feather",2);n0([C(Ze)],th.prototype,"kernelSize",2);n0([C(Ze)],th.prototype,"resolutionScale",2);dl("TiltShiftEffect",th);var Zwe=Object.defineProperty,$we=Object.getOwnPropertyDescriptor,qT=(s,e,t,i)=>{for(var n=i>1?void 0:i?$we(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Zwe(e,t,n),n};class Nm extends Ie{constructor(){super(...arguments);d(this,"isGizmo",!1);d(this,"translationSnap",1);d(this,"rotationSnapAngle",15);d(this,"scaleSnap",.25);d(this,"control");d(this,"orbit");d(this,"onControlChangedEvent",t=>{const i=this.orbit;if(i&&(i.enabled=!t.value),t.value){const n=ne.getComponentInParent(this.gameObject,Gc);n&&n.requestOwnership()}});d(this,"windowKeyDownListener",t=>{if(this.enabled&&this.control)switch(t.keyCode){case 81:this.control.setSpace(this.control.space==="local"?"world":"local");break;case 16:this.enableSnapping();break;case 87:this.control.setMode("translate");break;case 69:this.control.setMode("rotate");break;case 82:this.control.setMode("scale");break;case 187:case 107:this.control.setSize(this.control.size+.1);break;case 189:case 109:this.control.setSize(Math.max(this.control.size-.1,.1));break;case 88:this.control.showX=!this.control.showX;break;case 89:this.control.showY=!this.control.showY;break;case 90:this.control.showZ=!this.control.showZ;break;case 32:this.control.enabled=!this.control.enabled;break}});d(this,"windowKeyUpListener",t=>{if(this.enabled)switch(t.keyCode){case 16:this.disableSnapping();break}})}onEnable(){var t;this.isGizmo&&!Jb||this.context.mainCamera&&(this.control||(this.control=new jfe(this.context.mainCamera,this.context.renderer.domElement),this.control.visible=!0,this.control.enabled=!0,this.control.getRaycaster().layers.set(2),this.control.size=1,this.control.traverse(i=>{const n=i;if(n.layers.set(2),n){const r=n.material;r&&(r.opacity=.3)}}),this.orbit=ne.getComponentInParent(this.context.mainCamera,Ei)??void 0),this.control&&(this.context.scene.add(this.control),this.control.attach(this.gameObject),(t=this.control)==null||t.addEventListener("dragging-changed",this.onControlChangedEvent),window.addEventListener("keydown",this.windowKeyDownListener),window.addEventListener("keyup",this.windowKeyUpListener)))}onDisable(){var t,i;(t=this.control)==null||t.removeFromParent(),(i=this.control)==null||i.removeEventListener("dragging-changed",this.onControlChangedEvent),window.removeEventListener("keydown",this.windowKeyDownListener),window.removeEventListener("keyup",this.windowKeyUpListener)}enableSnapping(){this.control&&(this.control.setTranslationSnap(this.translationSnap),this.control.setRotationSnap(gi.degToRad(this.rotationSnapAngle)),this.control.setScaleSnap(this.scaleSnap))}disableSnapping(){this.control&&(this.control.setTranslationSnap(null),this.control.setRotationSnap(null),this.control.setScaleSnap(null))}}qT([C()],Nm.prototype,"isGizmo",2);qT([C()],Nm.prototype,"translationSnap",2);qT([C()],Nm.prototype,"rotationSnapAngle",2);qT([C()],Nm.prototype,"scaleSnap",2);var eSe=Object.defineProperty,tSe=Object.getOwnPropertyDescriptor,fU=(s,e,t,i)=>{for(var n=i>1?void 0:i?tSe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&eSe(e,t,n),n};class zm extends Sr{constructor(){super(...arguments);d(this,"color",new Ze({r:0,g:0,b:0,a:1}));d(this,"intensity",new Ze(0));d(this,"center",new Ze({x:.5,y:.5}))}get typeName(){return"Vignette"}init(){this.color.defaultValue={r:0,g:0,b:0,a:1},this.intensity.defaultValue=0,this.center.defaultValue={x:.5,y:.5}}onCreateEffect(){const t=new iW;return this.intensity.onValueChanged=i=>{t.offset=i,this.updateDarkness(t)},this.color.onValueChanged=i=>{this.updateDarkness(t)},t}updateDarkness(t){const i=this.intensity.value;t.darkness=i}}fU([C(Ze)],zm.prototype,"color",2);fU([C(Ze)],zm.prototype,"intensity",2);fU([C(Ze)],zm.prototype,"center",2);dl("Vignette",zm);var iSe=Object.defineProperty,nSe=Object.getOwnPropertyDescriptor,sSe=(s,e,t,i)=>{for(var n=i>1?void 0:i?nSe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&iSe(e,t,n),n};const rB=ie("debugpost");class s0 extends Ie{constructor(){super(...arguments);d(this,"sharedProfile");d(this,"_postprocessing");d(this,"_activeEffects",[]);d(this,"_effects",[]);d(this,"_lastApplyTime");d(this,"_rapidApplyCount",0);d(this,"_isDirty",!1);d(this,"_modificationQueue");d(this,"_recreateId",-1)}get isPostProcessingManager(){return!0}get effects(){return this._activeEffects}addEffect(t){let i=t;return i instanceof vo&&(i=new lb(i)),this._effects.includes(i)||(this._effects.push(i),this._isDirty=!0),t}removeEffect(t){let i=-1;return t instanceof vo?i=this._effects.findIndex(n=>n instanceof lb&&n.effect===t):i=this._effects.indexOf(t),i!==-1&&(this._effects.splice(i,1),this._isDirty=!0),t}markDirty(){this._isDirty=!0}awake(){var t;rB&&(console.log("PostprocessingManager Awake",this),console.log("Press P to toggle post processing"),window.addEventListener("keydown",i=>{i.key==="p"&&(this.enabled=!this.enabled,_n("Toggle PostProcessing "+this.name+": Enabled="+this.enabled),this.markDirty())})),(t=this.sharedProfile)==null||t.init()}onEnable(){this._isDirty=!0}onDisable(){var t;(t=this._postprocessing)==null||t.unapply(),this._isDirty=!1}onBeforeRender(){var t;if(!this.context.isInXR){if(this.context.composer&&!(this.context.composer instanceof ak)){rB&&console.warn("PostProcessing: The current composer is not an EffectComposer - this is not supported");return}this.context.mainCamera&&this._isDirty&&this.apply(),this.context.composer&&((t=this._postprocessing)==null?void 0:t.composer)===this.context.composer&&(this.context.composer.setRenderer(this.context.renderer),this.context.composer.setMainScene(this.context.scene),this.context.mainCamera&&this.context.composer.setMainCamera(this.context.mainCamera))}}onDestroy(){var t;(t=this._postprocessing)==null||t.dispose()}apply(){var t;if(rB&&console.log("Apply PostProcessing "+this.name),nt()&&(this._lastApplyTime!==void 0&&Date.now()-this._lastApplyTime<100&&(this._rapidApplyCount++,this._rapidApplyCount===5&&console.warn("Detected rapid post processing modifications - this might be a bug",this)),this._lastApplyTime=Date.now()),this._isDirty=!1,this.unapply(),this._activeEffects.length=0,(t=this.sharedProfile)!=null&&t.components){const i=this.sharedProfile.components;for(const n of i)n.active&&!this._activeEffects.includes(n)&&this._activeEffects.push(n)}for(const i of this._effects)i.active&&!this._activeEffects.includes(i)&&this._activeEffects.push(i);this._activeEffects.length>0&&(this._postprocessing||(this._postprocessing=new VT(this.context)),this._postprocessing.apply(this._activeEffects),this._applyPostQueue())}unapply(){var t;(t=this._postprocessing)==null||t.unapply()}_applyPostQueue(){if(this._modificationQueue){for(const t of this._modificationQueue.values())this.onEditorModification(t);this._modificationQueue.clear()}}onEditorModification(t){var i,n;if(t.propertyName.startsWith("postprocessing.")){if(!this._postprocessing)return this._modificationQueue||(this._modificationQueue=new Map),this._modificationQueue.set(t.propertyName,t),!0;if(!((i=this._activeEffects)!=null&&i.length))return;const r=t.propertyName.split(".");if(r.length===3||r.length===4){const o=r[1],a=r[2];for(const l of this._activeEffects)if(((n=l.typeName)==null?void 0:n.toLowerCase())===o.toLowerCase()){if(a==="active"){l.active=t.value,this.scheduleRecreate();return}if(!aC.has(o)){const c=new Array;aC.set(o,c);const h=Object.keys(l);for(const u of h)l[u]instanceof Ze&&c.push(u)}if(aC.has(o)){const c=a.toLowerCase(),h=aC.get(o);for(const u of h)if(u.toLowerCase()===c){const f=l[u];f instanceof Ze&&(r.length===4&&r[3]==="active"?(f.overrideState=t.value,this.scheduleRecreate()):f&&f.value!==void 0&&(f.value=t.value));return}}console.warn("Unknown modification",a);return}}return!0}return!1}scheduleRecreate(){const t=++this._recreateId;setTimeout(()=>{t===this._recreateId&&(this.onDisable(),this.onEnable())},200)}}sSe([Dv(hx)],s0.prototype,"sharedProfile",2);const aC=new Map;Uye(s0);var rSe=Object.defineProperty,oSe=Object.getOwnPropertyDescriptor,aSe=(s,e,t,i)=>{for(var n=i>1?void 0:i?oSe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&rSe(e,t,n),n};const C1=ie("debugarcamera");class XT extends Ie{constructor(){super(...arguments);d(this,"backgroundTint",new Ui(1,1,1,1));d(this,"backgroundPlane");d(this,"threeTexture");d(this,"forceTextureInitialization",function(){const t=new ti,i=new ps,n=new Ws;n.add(new fe(i,t));const r=new Vt;return function(a,l){t.map=l,a.render(n,r),C1&&console.warn("Force texture initialization")}}());d(this,"preRender",()=>{if(!this||!this.gameObject)return;const i=this.context.renderer.xr.getFrame();i&&(!this.threeTexture&&this.context.renderer&&(this.threeTexture=new Wt,this.forceTextureInitialization(this.context.renderer,this.threeTexture)),this.backgroundPlane===void 0&&(this.backgroundPlane=cSe(this.backgroundTint)),this.backgroundPlane.parent!==this.scene&&this.scene.add(this.backgroundPlane),this.updateFromFrame(i))})}onBeforeXR(t,i){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push("camera-access"),C1&&console.warn("Requesting camera-access")}onEnterXR(t){this.backgroundPlane&&(this.context.scene.add(this.backgroundPlane),this.backgroundPlane.visible=!1),this.backgroundPlane&&this.context.scene.add(this.backgroundPlane),this.context.pre_render_callbacks.push(this.preRender)}onLeaveXR(t){this.backgroundPlane&&this.backgroundPlane.removeFromParent();const i=this.context.pre_render_callbacks.indexOf(this.preRender);i>=0&&this.context.pre_render_callbacks.splice(i,1)}get background(){return this.backgroundPlane}onBeforeRender(t){this.updateFromFrame(t)}updateFromFrame(t){if(!t)return;const i=t.session.enabledFeatures;if(i&&!i.some(r=>r==="camera-access")){this.background&&(this.background.visible=!1);return}const n=t.getViewerPose(this.context.renderer.xr.getReferenceSpace());if(n){for(const r of n.views)if("camera"in r&&r.camera){let a=this.context.renderer.xr.getBinding();if(a||(a=new XRWebGLBinding(t.session,this.context.renderer.getContext())),a){let l=null;if("getCameraImage"in a){l=a.getCameraImage(r.camera);const c=this.context.renderer.properties.get(this.threeTexture);c.__webglTexture=l,this.backgroundPlane?(this.backgroundPlane.setTexture(this.threeTexture),this.backgroundPlane.visible=!0):C1&&console.warn("No background plane to set texture on")}}}}}}aSe([C(Ui)],XT.prototype,"backgroundTint",2);const lSe=`
uniform sampler2D t2D;

varying vec2 vUv;

void main() {

    vec4 texColor = texture2D( t2D, vUv );
    texColor.w = 1.0;

    // inline sRGB decode
    texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );

    gl_FragColor = texColor * <backgroundTint>;

    #include <tonemapping_fragment>
    #include <colorspace_fragment>
}
`;function cSe(s){const e="vec4("+s.r.toFixed(3)+","+s.g.toFixed(3)+","+s.b.toFixed(3)+","+s.a.toFixed(3)+")";C1&&console.log(e);const t=new fe(new ps(2,2),new kt({name:"BackgroundMaterial",uniforms:vv.clone(ur.background.uniforms),vertexShader:ur.background.vertexShader,fragmentShader:lSe.replaceAll("<backgroundTint>",e),side:_i,depthTest:!1,depthWrite:!1,fog:!1}));return t.geometry.deleteAttribute("normal"),Object.defineProperty(t.material,"map",{get:function(){return this.threeTexture}}),t.renderOrder=-1e4,t.layers.set(2),t.frustumCulled=!1,t.setTexture=function(i){t.material.uniforms.t2D.value=i},t}var hSe=Object.defineProperty,uSe=Object.getOwnPropertyDescriptor,Gm=(s,e,t,i)=>{for(var n=i>1?void 0:i?uSe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&hSe(e,t,n),n};const IV=ie("debugimagetracking"),UE=class{constructor(e,t,i,n,r,o){d(this,"measuredSize");d(this,"state");d(this,"_position");d(this,"_rotation");d(this,"_trackingComponent");d(this,"_trackedImage");d(this,"_bitmap");d(this,"_pose");this._trackingComponent=e,this._trackedImage=t,this._bitmap=i,this.measuredSize=n,this.state=r,this._pose=o}get url(){return this._trackedImage.image??""}get widthInMeters(){return this._trackedImage.widthInMeters??void 0}get bitmap(){return this._bitmap}get model(){return this._trackedImage}getPosition(e){return this.ensureTransformData(),e.copy(this._position),e}getQuaternion(e){return this.ensureTransformData(),e.copy(this._rotation),e}applyToObject(e,t=void 0){this.ensureTransformData();const i=e.position.distanceToSquared(this._position)/.05+e.quaternion.angleTo(this._rotation)/.05;t&&(t*=Math.max(1,i)),t===void 0||t>=1?(e.position.copy(this._position),e.quaternion.copy(this._rotation)):(t=Math.max(0,Math.min(1,t)),e.position.lerp(this._position,t),e.quaternion.slerp(this._rotation,t))}ensureTransformData(){if(!this._position){this._position=UE._positionBuffer.get(),this._rotation=UE._rotationBuffer.get();const e=this._pose.transform,t=Mt.active.convertSpace(e);this._position.copy(t==null?void 0:t.position),this._rotation.copy(t==null?void 0:t.quaternion)}}};let wd=UE;d(wd,"_positionBuffer",new ba(()=>new S,20)),d(wd,"_rotationBuffer",new ba(()=>new Ce,20));class ih{constructor(){d(this,"image");d(this,"widthInMeters",.25);d(this,"object");d(this,"createObjectInstance",!1);d(this,"imageDoesNotMove",!1);d(this,"hideWhenTrackingIsLost",!0)}}Gm([C(URL)],ih.prototype,"image",2);Gm([C()],ih.prototype,"widthInMeters",2);Gm([C(ei)],ih.prototype,"object",2);Gm([C()],ih.prototype,"createObjectInstance",2);Gm([C()],ih.prototype,"imageDoesNotMove",2);Gm([C()],ih.prototype,"hideWhenTrackingIsLost",2);class dSe{constructor(e,t,i){d(this,"filename");d(this,"widthInMeters");d(this,"imageData");this.filename=e,this.imageData=t,this.widthInMeters=i}get extensionName(){return"image-tracking"}onAfterHierarchy(e,t){t.beginBlock('def Preliminary_ReferenceImage "AnchoringReferenceImage"'),t.appendLine("uniform asset image = @image_tracking/"+this.filename+"@"),t.appendLine("uniform double physicalWidth = "+(this.widthInMeters*100).toFixed(8)),t.closeBlock()}onBeforeBuildDocument(e){const t=ne.findObjectOfType(pv);!t||!t.trackedImages||t.trackedImages.length>1&&(nt()&&Fi("USDZ: Only one tracked image is supported."),console.warn("USDZ: Only one tracked image is supported."))}onAfterSerialize(e){e.files["image_tracking/"+this.filename]=this.imageData}onExportObject(e,t,i){var r;const n=ne.findObjectOfType(pv);if(!(!n||!n.trackedImages)){for(const o of n.trackedImages)if(((r=o.object)==null?void 0:r.asset)===e){const a=ne.findObjectOfType(Gn);if(!a)continue;const{scale:l,target:c}=a.getARScaleAndTarget();let h=e;const u=new le;if(e!==c)for(;h.parent&&h.parent!==c;)h=h.parent,u.premultiply(h.matrix);const f=u.clone().invert();t.matrix=f.scale(new S(l,l,l));break}}}}var FB;const NA=(FB=class extends Ie{constructor(){super(...arguments);d(this,"trackedImages");d(this,"smooth",!0);d(this,"trackedImageIndexMap",new Map);d(this,"imageToObjectMap",new Map);d(this,"currentImages",[]);d(this,"onImageTrackingUpdate",e=>{const t=Mt.active;if(t)for(const i of e){const n=i.model,r=i.state==="tracked";if(!n.object)continue;let o=this.imageToObjectMap.get(n);if(o===void 0)o={object:null,frames:0,lastTrackingTime:Date.now()},this.imageToObjectMap.set(n,o),n.object.loadAssetAsync().then(a=>{if(n.createObjectInstance&&a&&(a=ne.instantiate(a)),a){o.object=a;for(const l of a.getComponentsInChildren(Vn))l.setInstancingEnabled(!1);t.rig?(t.rig.gameObject.add(a),i.applyToObject(a),a.activeSelf||ne.setActive(a,!0)):console.warn("XRImageTracking: missing XRRig")}});else{if(o.frames++,r&&(o.lastTrackingTime=Date.now()),n.imageDoesNotMove&&o.frames>10||!o.object)continue;t.rig&&(t.rig.gameObject.add(o.object),i.applyToObject(o.object,this.smooth?this.context.time.deltaTimeUnscaled*3:void 0),o.object.activeSelf||ne.setActive(o.object,!0))}}})}awake(){if(IV&&console.log(this),!!this.trackedImages){for(const e of this.trackedImages)if(e.image&&!NA._imageElements.has(e.image)){const t=e.image;NA._imageElements.set(t,null);const i=document.createElement("img");i.src=t,i.addEventListener("load",async()=>{const n=await createImageBitmap(i);NA._imageElements.set(t,n);const r=await v7(n);if(r){const a=await(await r.convertToBlob({type:"image/png"})).arrayBuffer(),l=ne.findObjectOfType(Gn);l&&this.trackedImages&&(l.extensions.push(new dSe("marker.png",new Uint8Array(a),this.trackedImages[0].widthInMeters)),l.anchoringType="image")}})}}}onBeforeXR(e,t){var i;if(this.trackedImages){t.optionalFeatures=t.optionalFeatures||[],t.optionalFeatures.includes("image-tracking")||t.optionalFeatures.push("image-tracking"),t.trackedImages=[];for(const n of this.trackedImages)if((i=n.image)!=null&&i.length&&n.widthInMeters>0){const r=NA._imageElements.get(n.image);r&&(this.trackedImageIndexMap.set(t.trackedImages.length,n),t.trackedImages.push({image:r,widthInMeters:n.widthInMeters}))}}}onEnterXR(e){var t;if(this.trackedImages){for(const i of this.trackedImages)if((t=i.object)!=null&&t.asset){const n=i.object.asset;n.userData||(n.userData={});const r={visible:n.visible,parent:n.parent,matrix:n.matrix.clone()};n.userData["image-tracking"]=r}}for(const i of this.imageToObjectMap.values())i.frames=0}onLeaveXR(e){var t,i;if(this.trackedImages){for(const n of this.trackedImages)if((t=n.object)!=null&&t.asset){const r=n.object.asset;if(r.userData){const o=r.userData["image-tracking"];o&&(r.visible=o.visible,(i=o.parent)==null||i.add(r),r.matrix.copy(o.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale)),delete r.userData["image-tracking"]}}}}onUpdateXR(e){var n;this.currentImages.length=0;const t=e.xr.frame;if(!t)return;if("getImageTrackingResults"in t){if(((n=e.xr.session.enabledFeatures)==null?void 0:n.includes("image-tracking"))===!1)return;if(t.session&&typeof t.getImageTrackingResults=="function"){const r=t.getImageTrackingResults();if(r.length>0){const o=this.context.renderer.xr.getReferenceSpace();if(o){for(const a of r){const l=a.trackingState,c=a.index,h=this.trackedImageIndexMap.get(c);if(h){const u=t.getPose(a.imageSpace,o),f=new wd(this,h,a.image,a.measuredSize,l,u);this.currentImages.push(f)}else IV&&console.warn("No tracked image for index",c)}if(this.currentImages.length>0)try{this.dispatchEvent(new CustomEvent("image-tracking",{detail:this.currentImages})),this.onImageTrackingUpdate(this.currentImages)}catch(a){console.error(a)}}}}}else{const r=`Image tracking is currently not supported on this device. On Chrome for Android, you can enable the <a target="_blank" href="#" onclick="() => console.log('I')">chrome://flags/#webxr-incubations</a> flag.`;this.didPrintWarning||(this.didPrintWarning=!0,console.log(r)),Fi(r);return}const i=1e3;for(const[r,o]of this.imageToObjectMap){if(!o.object||!r||r.hideWhenTrackingIsLost===!1)continue;let a=!1;for(const l of this.currentImages)if(l.model===r){const c=Date.now()-o.lastTrackingTime;if(r.imageDoesNotMove||l.state==="tracked"||c<=i){a=!0;break}}a||ne.setActive(o.object,!1)}}},d(FB,"_imageElements",new Map),FB);let pv=NA;Gm([C(ih)],pv.prototype,"trackedImages",2);const Z0=new S,$0=new S,RV=new Ut;class fSe extends jr{constructor(e,t=1,i=16711680){const n=new yt,r=e.geometry.attributes.normal.count,o=new rt(r*2*3,3);n.setAttribute("position",o),super(n,new ji({color:i,toneMapped:!1})),this.object=e,this.size=t,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),RV.getNormalMatrix(this.object.matrixWorld);const e=this.object.matrixWorld,t=this.geometry.attributes.position,i=this.object.geometry;if(i){const n=i.attributes.position,r=i.attributes.normal;let o=0;for(let a=0,l=n.count;a<l;a++)Z0.fromBufferAttribute(n,a).applyMatrix4(e),$0.fromBufferAttribute(r,a),$0.applyMatrix3(RV).normalize().multiplyScalar(this.size).add(Z0),t.setXYZ(o,Z0.x,Z0.y,Z0.z),o=o+1,t.setXYZ(o,$0.x,$0.y,$0.z),o=o+1}t.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}var pSe=Object.defineProperty,mSe=Object.getOwnPropertyDescriptor,r0=(s,e,t,i)=>{for(var n=i>1?void 0:i?mSe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&pSe(e,t,n),n};const $f=ie("debugplanetracking");class _u extends Ie{constructor(){super(...arguments);d(this,"dataTemplate");d(this,"occluder",!0);d(this,"initiateRoomCaptureIfNoData",!0);d(this,"usePlaneData",!0);d(this,"useMeshData",!0);d(this,"runInVR",!0);d(this,"bounds",new jt);d(this,"center",new S);d(this,"labelOffset",new S);d(this,"_dataId",1);d(this,"_allPlanes",new Map);d(this,"_allMeshes",new Map);d(this,"firstTimeNoPlanesDetected",-100);d(this,"makeOccluder",(t,i,n=!1)=>{if(i){if(i instanceof Array){for(const r of i)this.makeOccluder(t,r,n);return}!n&&!i.name.toLowerCase().includes("occlu")||(i.colorWrite=!1,i.depthTest=!0,i.depthWrite=!0,i.transparent=!1,i.polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=.1,t.renderOrder=-1e3)}});d(this,"_flipForwardMatrix",new le().makeRotationY(Math.PI));d(this,"_verticesCache",new Map)}get trackedPlanes(){return this._allPlanes.values()}get trackedMeshes(){return this._allMeshes.values()}onBeforeXR(t,i){t==="immersive-vr"&&!this.runInVR||(i.optionalFeatures=i.optionalFeatures||[],this.usePlaneData&&!i.optionalFeatures.includes("plane-detection")&&i.optionalFeatures.push("plane-detection"),this.useMeshData&&!i.optionalFeatures.includes("mesh-detection")&&i.optionalFeatures.push("mesh-detection"))}onEnterXR(t){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onLeaveXR(t){for(const i of this._allPlanes.keys())this.removeData(i,this._allPlanes);for(const i of this._allMeshes.keys())this.removeData(i,this._allMeshes)}onUpdateXR(t){if(!this.runInVR&&t.xr.isVR)return;const i=t.xr.rig;if(!i){console.warn("No XR rig found, cannot parent tracked planes to it");return}const n=t.xr.frame;if(!this.context.renderer.xr.getReferenceSpace())return;const a=n.detectedPlanes,l=n.detectedMeshes,c=a!==void 0&&a.size>0,h=l!==void 0&&l.size>0;if(this.initiateRoomCaptureIfNoData&&(!c&&!h&&this.firstTimeNoPlanesDetected<-10&&(this.firstTimeNoPlanesDetected=Date.now()),(c||h)&&(this.firstTimeNoPlanesDetected=-1),this.firstTimeNoPlanesDetected>0&&Date.now()-this.firstTimeNoPlanesDetected>2500&&"initiateRoomCapture"in n.session&&(n.session.initiateRoomCapture(),this.firstTimeNoPlanesDetected=-1)),a!==void 0&&this.processFrameData(t.xr,i.gameObject,n,a,this._allPlanes),l!==void 0&&this.processFrameData(t.xr,i.gameObject,n,l,this._allMeshes),$f){const u=this.context.mainCameraComponent.gameObject.worldPosition;for(const f of this._allPlanes.values())!f.mesh||!f.mesh.visible||(this.bounds.makeEmpty(),f.mesh.traverse(p=>{p instanceof fe&&this.bounds.expandByObject(p)}),this.bounds.getCenter(this.center),this.labelOffset.copy(u).sub(this.center).normalize().multiplyScalar(.1),_t.DrawLabel(this.center.add(this.labelOffset),(f.xrData.semanticLabel||"plane").toUpperCase()+`
`+f.xrData.lastChangedTime.toFixed(2),.02))}}removeData(t,i){const n=i.get(t);if(!n)return;i.delete(t),$f&&console.log("Plane no longer tracked, id="+n.id),n.mesh&&(n.mesh.removeFromParent(),n.mesh.traverse(o=>{const a=o.userData.normalsHelper;a?(a.dispose(),a.removeFromParent()):$f&&console.warn("No normals helper found for mesh",n.mesh)}),xa(n.mesh,!0,!0));const r=new CustomEvent("plane-tracking",{detail:{type:"plane-removed",context:n}});this.dispatchEvent(r)}processFrameData(t,i,n,r,o){const l=this.context.renderer.xr.getReferenceSpace();if(l){for(const c of o.keys())r.has(c)||this.removeData(c,o);for(const c of r){const h="planeSpace"in c?c.planeSpace:"meshSpace"in c?c.meshSpace:void 0;if(!h)continue;const u=n.getPose(h,l);let f;if(o.has(c)){const p=o.get(c);if(f=p.mesh,p.timestamp<c.lastChangedTime){if(p.timestamp=c.lastChangedTime,p.mesh){const v=this.createGeometry(c);if(p.mesh instanceof fe)p.mesh.geometry.dispose(),p.mesh.geometry=v,this.makeOccluder(p.mesh,p.mesh.material);else if(p.mesh instanceof Vs)for(const g of p.mesh.children)g instanceof fe&&(g.geometry.dispose(),g.geometry=v,this.makeOccluder(g,g.material));if(p.collider){const g=p.mesh;p.collider.sharedMesh=g,p.collider.convex=this.checkIfContextShouldBeConvex(g,p.xrData),p.collider.onDisable(),p.collider.onEnable()}$f&&(console.log("Plane updated, id="+p.id,p),p.mesh.traverse(g=>{if(!(g instanceof fe))return;const y=g.userData.normalsHelper;y&&y.update()}))}const m=new CustomEvent("plane-tracking",{detail:{type:"plane-updated",context:p}});this.dispatchEvent(m)}}else{if(!this.dataTemplate){const p=new fe;$f?p.material=new gM:this.occluder?(p.material=new ti,this.makeOccluder(p,p.material,!0)):p.material=new ti({wireframe:!0,opacity:.5,transparent:!0,color:3355443}),this.dataTemplate=new ei("","",p)}if(!this.dataTemplate.asset)this.dataTemplate.loadAssetAsync();else{const p=ne.instantiate(this.dataTemplate.asset);if(p.name="xr-tracked-plane",f=p,nk(p,!1),p instanceof fe)Xi(p.geometry),p.geometry=this.createGeometry(c),this.makeOccluder(p,p.material,this.occluder);else if(p instanceof Vs)for(const g of p.children)g instanceof fe&&(Xi(g.geometry),g.geometry=this.createGeometry(c),this.makeOccluder(g,g.material,this.occluder));const m=p.getComponent(Sm);if(m){const g=p;m.sharedMesh=g,m.convex=this.checkIfContextShouldBeConvex(g,c),m.onDisable(),m.onEnable()}p.matrixAutoUpdate=!1,p.matrixWorldNeedsUpdate=!0,i.add(p);const v={id:this._dataId++,xrData:c,timestamp:c.lastChangedTime,mesh:p,collider:m};o.set(c,v),$f&&console.log("New plane detected, id="+v.id,v);try{const g=new CustomEvent("plane-tracking",{detail:{type:"plane-added",context:v}});this.dispatchEvent(g)}catch(g){console.error(g)}}}f&&(u?(f.visible=!0,f.matrix.fromArray(u.transform.matrix),f.matrix.premultiply(this._flipForwardMatrix)):f.visible=!1,$f&&f.traverse(p=>{if(p instanceof fe)if(p.userData.normalsHelper)p.userData.normalsHelper.update();else{const m=new fSe(p,.05,255);m.layers.disableAll(),m.layers.set(2),this.context.scene.add(m),p.userData.normalsHelper=m}}))}}}checkIfContextShouldBeConvex(t,i){if(!t)return!0;if(t){const n=new jt;n.expandByObject(t);const r=new S;n.getSize(r);let o=!0;return r.x>2&&r.y>2&&r.z>1.5&&(o=!1),o&&"semanticLabel"in i&&i.semanticLabel==="wall"&&(o=!0),o}return!0}createGeometry(t){return"polygon"in t?this.createPlaneGeometry(t.polygon):"vertices"in t&&"indices"in t?this.createMeshGeometry(t.vertices,t.indices):new yt}createMeshGeometry(t,i){const n=t.toString()+"_"+i.toString();if(this._verticesCache.has(n))return this._verticesCache.get(n);const r=new yt;r.setIndex(new Ke(i,1)),r.setAttribute("position",new Ke(t,3));const o=Array();for(let a=0;a<t.length;a+=3)o.push(t[a],t[a+2]);return r.setAttribute("uv",new Ke(t,3)),r.computeVertexNormals(),this._verticesCache.set(n,r),r}createPlaneGeometry(t){const i=new yt,n=[],r=[];t.forEach(p=>{n.push(p.x,p.y,p.z),r.push(p.x,p.z)});const o=new S(n[0],n[1],n[2]),a=new S(n[3],n[4],n[5]),l=new S(n[6],n[7],n[8]),c=new S,h=new S;c.subVectors(a,o),h.subVectors(l,o),c.cross(h),c.normalize();const u=[];for(let p=0;p<n.length/3;p++)u.push(c.x,c.y,c.z);const f=[];for(let p=2;p<t.length;++p)f.push(0,p-1,p);return i.setAttribute("position",new Ke(new Float32Array(n),3)),i.setAttribute("uv",new Ke(new Float32Array(r),2)),i.setAttribute("normal",new Ke(new Float32Array(u),3)),i.setIndex(f),i}}r0([C(ei)],_u.prototype,"dataTemplate",2);r0([C()],_u.prototype,"occluder",2);r0([C()],_u.prototype,"initiateRoomCaptureIfNoData",2);r0([C()],_u.prototype,"usePlaneData",2);r0([C()],_u.prototype,"useMeshData",2);r0([C()],_u.prototype,"runInVR",2);var gSe=Object.defineProperty,ySe=Object.getOwnPropertyDescriptor,o0=(s,e,t,i)=>{for(var n=i>1?void 0:i?ySe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&gSe(e,t,n),n};class bu extends Ie{constructor(){super(...arguments);d(this,"side","none");d(this,"controller",!0);d(this,"hands",!1);d(this,"controlVisibility",!0);d(this,"useGripSpace",!1);d(this,"resetTransformAfterXRSession",!0);d(this,"_startPosition",new S);d(this,"_startRotation",new Ce);d(this,"_startScale",new S)}get activeAndEnabled(){return!0}onEnterXR(t){this._startPosition.copy(this.gameObject.position),this._startRotation.copy(this.gameObject.quaternion),this._startScale.copy(this.gameObject.scale)}onUpdateXR(t){const i=t.xr.getController(this.side);if(i){if(i.hand&&!this.hands){this.controlVisibility&&(this.gameObject.visible=!1);return}else if(!this.controller){this.controlVisibility&&(this.gameObject.visible=!1);return}this.controlVisibility&&(this.gameObject.visible=!0),this.useGripSpace||i.targetRayMode==="transient-pointer"?(this.gameObject.worldPosition=i.gripWorldPosition,this.gameObject.worldQuaternion=i.gripWorldQuaternion,this.gameObject.worldScale=wt(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale)):(this.gameObject.worldPosition=i.rayWorldPosition,this.gameObject.worldQuaternion=i.rayWorldQuaternion,this.gameObject.worldScale=wt(i.xr.rigScale,i.xr.rigScale,i.xr.rigScale).multiply(this._startScale))}}onLeaveXR(t){this.resetTransformAfterXRSession&&(this.gameObject.position.copy(this._startPosition),this.gameObject.quaternion.copy(this._startRotation),this.gameObject.scale.copy(this._startScale))}}o0([C()],bu.prototype,"side",2);o0([C()],bu.prototype,"controller",2);o0([C()],bu.prototype,"hands",2);o0([C()],bu.prototype,"controlVisibility",2);o0([C()],bu.prototype,"useGripSpace",2);o0([C()],bu.prototype,"resetTransformAfterXRSession",2);var vSe=Object.defineProperty,ASe=Object.getOwnPropertyDescriptor,_Se=(s,e,t,i)=>{for(var n=i>1?void 0:i?ASe(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&vSe(e,t,n),n};const PV=ie("debugwebxr");class YT extends Ie{constructor(){super(...arguments);d(this,"priority",0);d(this,"_startScale")}get isActive(){return this.activeAndEnabled&&this.gameObject.visible}setAsActiveXRRig(){var t;(t=Mt.active)==null||t.setRigActive(this)}awake(){if(PV){const t=new ye;t.position.y+=.5,this.gameObject.add(t);const i=t.addNewComponent(Cm);i&&(i.isGizmo=!1);const n=new _a(.5);this.gameObject.add(n)}}isXRRig(){return!0}supportsXR(t){return!0}onEnterXR(t){this._startScale=this.gameObject.scale.clone(),t.xr.addRig(this),PV&&console.log("WebXR: add Rig",this.name,this.priority)}onLeaveXR(t){t.xr.removeRig(this),this._startScale&&this.gameObject&&this.gameObject.scale.copy(this._startScale)}}_Se([C()],YT.prototype,"priority",2);class pU{}const bSe=Object.freeze(Object.defineProperty({__proto__:null,ActionBuilder:Ai,ActionCollection:aF,ActionModel:Ro,AlignmentConstraint:nx,Animation:Wr,AnimationCurve:_m,AnimationExtension:cx,AnimationTrackHandler:uT,Animator:vr,AnimatorController:Aa,Antialiasing:ux,AudioExtension:cf,AudioListener:Fd,AudioSource:Hn,AudioTrackHandler:Vp,Avatar:qd,AvatarBlink_Simple:xm,AvatarEyeLook_Rotation:Uv,AvatarLoader:bF,AvatarMarker:Ss,AvatarModel:yT,Avatar_Brain_LookAt:sb,Avatar_MouthShapes:fx,Avatar_MustacheShake:AF,Avatar_POI:Lc,AxesHelper:Nv,BaseUIComponent:ol,BasicIKConstraint:wF,BehaviorExtension:vT,BehaviorModel:cs,BloomEffect:wm,BoxCollider:Gv,BoxGizmo:Cm,BoxHelperComponent:el,Button:fu,CallInfo:_c,Camera:Hi,CameraTargetReachedEvent:ib,Canvas:Ar,CanvasGroup:Xd,CapsuleCollider:au,ChangeMaterialOnClick:Qv,ChangeTransformOnClick:Mm,CharacterController:Im,CharacterControllerInput:mu,ChromaticAberration:Ax,Collider:Ea,ColorAdjustments:pf,ColorBySpeedModule:Rm,ColorOverLifetimeModule:bx,ContactShadows:Zc,ControlTrackHandler:dT,CustomBranding:Af,Deletable:VF,DeleteBox:MT,DepthOfField:Yl,DeviceFlag:TT,DocumentExtension:QF,DragControls:Lo,DropListener:_f,Duplicatable:Dm,EffectWrapper:lb,EmissionModule:Jc,EmphasizeOnClick:Wv,EventList:Sn,EventListEvent:oT,EventSystem:Oo,EventTrigger:RT,FieldWithDefault:NF,FixedJoint:KF,FlyControls:JF,Fog:Jv,GltfExport:Mx,GltfExportBox:$F,Gradient:mf,Graphic:Em,GraphicRaycaster:lT,GridHelper:Zv,GridLayoutGroup:PF,GroundProjectedEnv:du,GroupActionModel:bd,HideOnStart:DF,HingeJoint:Ex,HorizontalLayoutGroup:RF,Image:Vv,InheritVelocityModule:yf,InputField:Om,InstanceHandle:Wp,InstancingHandler:Qp,Interactable:HF,Keyframe:ul,LODGroup:Ix,LODModel:Lm,Light:Qo,LimitVelocityOverLifetimeModule:ys,LogStats:tU,LookAt:km,LookAtConstraint:bm,MainModule:Cr,MaskableGraphic:mx,MeshCollider:Sm,MeshRenderer:_x,MinMaxCurve:At,MinMaxGradient:Ho,NeedleMenu:$c,NestedGltf:OT,Networking:$v,NoiseModule:Pi,ObjectRaycaster:wa,OffsetConstraint:Fm,OpenURL:e0,OrbitControls:Ei,Outline:Hv,Padding:df,ParticleBurst:ab,ParticleSubEmitter:HT,ParticleSystem:fs,ParticleSystemRenderer:pl,PhysicsExtension:ST,PixelationEffect:Bx,PlayAnimationOnClick:cm,PlayAudioOnClick:Yd,PlayableDirector:jd,PlayerColor:fv,PointerEventData:Ov,PostProcessingHandler:VT,PreliminaryAction:jv,PreliminaryTrigger:yx,RawImage:_T,Rect:MF,RectTransform:Xr,ReflectionProbe:qv,RegisteredAnimationInfo:pT,RemoteSkybox:Vc,Renderer:Vn,RendererLightmap:rb,Rigidbody:Ni,RotationBySpeedModule:Ia,RotationOverLifetimeModule:fl,SceneSwitcher:Ys,ScreenCapture:xf,ScreenSpaceAmbientOcclusion:Au,ScreenSpaceAmbientOcclusionN8:Kl,SetActiveOnClick:Tm,ShadowCatcher:Ux,ShapeModule:On,SharpeningEffect:Ox,SignalAsset:ax,SignalReceiver:kv,SignalReceiverEvent:Lv,SignalTrackHandler:nb,Size:EF,SizeBySpeedModule:xo,SizeOverLifetimeModule:gf,SkinnedMeshRenderer:zF,SmoothFollow:wf,SpatialGrabRaycaster:Ld,SpatialHtml:Nx,SpatialTrigger:Gx,SpatialTriggerReceiver:kc,SpectatorCamera:WT,SphereCollider:zv,Sprite:yu,SpriteData:Yv,SpriteRenderer:Vo,SpriteSheet:xx,SubEmitterSystem:fb,SyncedCamera:jT,SyncedRoom:Jl,SyncedTransform:Gc,TapGestureTrigger:OF,TeleportTarget:wT,TestRunner:uU,TestSimulateUserData:dU,Text:Yr,TextBuilder:CT,TextExtension:wx,TextureSheetAnimationModule:Er,TiltShiftEffect:th,ToneMappingEffect:Kd,TrailModule:Mn,TransformData:os,TransformGizmo:Nm,TriggerBuilder:Qs,TriggerModel:iu,UIRaycastUtils:cT,UIRootComponent:rx,USDZExporter:Gn,USDZText:xd,USDZUIExtension:ET,UsageMarker:Sx,VariantAction:oF,VelocityOverLifetimeModule:Ln,VerticalLayoutGroup:IF,VideoPlayer:Rs,Vignette:zm,VisibilityAction:vx,Voip:hf,Volume:s0,VolumeParameter:Ze,VolumeProfile:hx,WebARCameraBackground:XT,WebARSessionRoot:lu,WebXR:Qn,WebXRImageTracking:pv,WebXRImageTrackingModel:ih,WebXRPlaneTracking:_u,WebXRTrackedImage:wd,XRControllerFollow:bu,XRControllerModel:Hc,XRControllerMovement:Sa,XRFlag:ra,XRRig:YT,XRState:fr,__Ignore:pU},Symbol.toStringTag,{value:"Module"}));class xSe extends Ie{constructor(){super(...arguments);d(this,"toggleKey","KeyP")}update(){this.context.input.isKeyDown(this.toggleKey)&&this.context.domElement.classList.toggle("presentation-mode")}}J.add("__Ignore",pU);J.add("ActionBuilder",Ai);J.add("ActionCollection",aF);J.add("ActionModel",Ro);J.add("AlignmentConstraint",nx);J.add("Animation",Wr);J.add("AnimationCurve",_m);J.add("AnimationExtension",cx);J.add("AnimationTrackHandler",uT);J.add("Animator",vr);J.add("AnimatorController",Aa);J.add("Antialiasing",ux);J.add("AudioExtension",cf);J.add("AudioListener",Fd);J.add("AudioSource",Hn);J.add("AudioTrackHandler",Vp);J.add("Avatar",qd);J.add("Avatar_Brain_LookAt",sb);J.add("Avatar_MouthShapes",fx);J.add("Avatar_MustacheShake",AF);J.add("Avatar_POI",Lc);J.add("AvatarBlink_Simple",xm);J.add("AvatarEyeLook_Rotation",Uv);J.add("AvatarLoader",bF);J.add("AvatarMarker",Ss);J.add("AvatarModel",yT);J.add("AxesHelper",Nv);J.add("BaseUIComponent",ol);J.add("BasicIKConstraint",wF);J.add("BehaviorExtension",vT);J.add("BehaviorModel",cs);J.add("BloomEffect",wm);J.add("BoxCollider",Gv);J.add("BoxGizmo",Cm);J.add("BoxHelperComponent",el);J.add("Button",fu);J.add("CallInfo",_c);J.add("Camera",Hi);J.add("CameraTargetReachedEvent",ib);J.add("Canvas",Ar);J.add("CanvasGroup",Xd);J.add("CapsuleCollider",au);J.add("ChangeMaterialOnClick",Qv);J.add("ChangeTransformOnClick",Mm);J.add("CharacterController",Im);J.add("CharacterControllerInput",mu);J.add("ChromaticAberration",Ax);J.add("Collider",Ea);J.add("ColorAdjustments",pf);J.add("ColorBySpeedModule",Rm);J.add("ColorOverLifetimeModule",bx);J.add("ContactShadows",Zc);J.add("ControlTrackHandler",dT);J.add("CustomBranding",Af);J.add("Deletable",VF);J.add("DeleteBox",MT);J.add("DepthOfField",Yl);J.add("DeviceFlag",TT);J.add("DocumentExtension",QF);J.add("DragControls",Lo);J.add("DropListener",_f);J.add("Duplicatable",Dm);J.add("EffectWrapper",lb);J.add("EmissionModule",Jc);J.add("EmphasizeOnClick",Wv);J.add("EventList",Sn);J.add("EventListEvent",oT);J.add("EventSystem",Oo);J.add("EventTrigger",RT);J.add("FieldWithDefault",NF);J.add("FixedJoint",KF);J.add("FlyControls",JF);J.add("Fog",Jv);J.add("GltfExport",Mx);J.add("GltfExportBox",$F);J.add("Gradient",mf);J.add("Graphic",Em);J.add("GraphicRaycaster",lT);J.add("GridHelper",Zv);J.add("GridLayoutGroup",PF);J.add("GroundProjectedEnv",du);J.add("GroupActionModel",bd);J.add("HideOnStart",DF);J.add("HingeJoint",Ex);J.add("HorizontalLayoutGroup",RF);J.add("Image",Vv);J.add("InheritVelocityModule",yf);J.add("InputField",Om);J.add("InstanceHandle",Wp);J.add("InstancingHandler",Qp);J.add("Interactable",HF);J.add("Keyframe",ul);J.add("Light",Qo);J.add("LimitVelocityOverLifetimeModule",ys);J.add("LODGroup",Ix);J.add("LODModel",Lm);J.add("LogStats",tU);J.add("LookAt",km);J.add("LookAtConstraint",bm);J.add("MainModule",Cr);J.add("MaskableGraphic",mx);J.add("MeshCollider",Sm);J.add("MeshRenderer",_x);J.add("MinMaxCurve",At);J.add("MinMaxGradient",Ho);J.add("NeedleMenu",$c);J.add("NestedGltf",OT);J.add("Networking",$v);J.add("NoiseModule",Pi);J.add("ObjectRaycaster",wa);J.add("OffsetConstraint",Fm);J.add("OpenURL",e0);J.add("OrbitControls",Ei);J.add("Outline",Hv);J.add("Padding",df);J.add("ParticleBurst",ab);J.add("ParticleSubEmitter",HT);J.add("ParticleSystem",fs);J.add("ParticleSystemRenderer",pl);J.add("PhysicsExtension",ST);J.add("PixelationEffect",Bx);J.add("PlayableDirector",jd);J.add("PlayAnimationOnClick",cm);J.add("PlayAudioOnClick",Yd);J.add("PlayerColor",fv);J.add("PlayerState",ha);J.add("PlayerSync",Fv);J.add("PointerEventData",Ov);J.add("PostProcessingHandler",VT);J.add("PreliminaryAction",jv);J.add("PreliminaryTrigger",yx);J.add("PresentationMode",xSe);J.add("RawImage",_T);J.add("Rect",MF);J.add("RectTransform",Xr);J.add("ReflectionProbe",qv);J.add("RegisteredAnimationInfo",pT);J.add("RemoteSkybox",Vc);J.add("Renderer",Vn);J.add("RendererLightmap",rb);J.add("Rigidbody",Ni);J.add("RotationBySpeedModule",Ia);J.add("RotationOverLifetimeModule",fl);J.add("SceneSwitcher",Ys);J.add("ScreenCapture",xf);J.add("ScreenSpaceAmbientOcclusion",Au);J.add("ScreenSpaceAmbientOcclusionN8",Kl);J.add("SetActiveOnClick",Tm);J.add("ShadowCatcher",Ux);J.add("ShapeModule",On);J.add("SharpeningEffect",Ox);J.add("SignalAsset",ax);J.add("SignalReceiver",kv);J.add("SignalReceiverEvent",Lv);J.add("SignalTrackHandler",nb);J.add("Size",EF);J.add("SizeBySpeedModule",xo);J.add("SizeOverLifetimeModule",gf);J.add("SkinnedMeshRenderer",zF);J.add("SmoothFollow",wf);J.add("SpatialGrabRaycaster",Ld);J.add("SpatialHtml",Nx);J.add("SpatialTrigger",Gx);J.add("SpatialTriggerReceiver",kc);J.add("SpectatorCamera",WT);J.add("SphereCollider",zv);J.add("Sprite",yu);J.add("SpriteData",Yv);J.add("SpriteRenderer",Vo);J.add("SpriteSheet",xx);J.add("SubEmitterSystem",fb);J.add("SyncedCamera",jT);J.add("SyncedRoom",Jl);J.add("SyncedTransform",Gc);J.add("TapGestureTrigger",OF);J.add("TeleportTarget",wT);J.add("TestRunner",uU);J.add("TestSimulateUserData",dU);J.add("Text",Yr);J.add("TextBuilder",CT);J.add("TextExtension",wx);J.add("TextureSheetAnimationModule",Er);J.add("TiltShiftEffect",th);J.add("ToneMappingEffect",Kd);J.add("TrailModule",Mn);J.add("TransformData",os);J.add("TransformGizmo",Nm);J.add("TriggerBuilder",Qs);J.add("TriggerModel",iu);J.add("UIRaycastUtils",cT);J.add("UIRootComponent",rx);J.add("UsageMarker",Sx);J.add("USDZExporter",Gn);J.add("USDZText",xd);J.add("USDZUIExtension",ET);J.add("VariantAction",oF);J.add("VelocityOverLifetimeModule",Ln);J.add("VerticalLayoutGroup",IF);J.add("VideoPlayer",Rs);J.add("Vignette",zm);J.add("VisibilityAction",vx);J.add("Voip",hf);J.add("Volume",s0);J.add("VolumeParameter",Ze);J.add("VolumeProfile",hx);J.add("WebARCameraBackground",XT);J.add("WebARSessionRoot",lu);J.add("WebXR",Qn);J.add("WebXRImageTracking",pv);J.add("WebXRImageTrackingModel",ih);J.add("WebXRPlaneTracking",_u);J.add("WebXRTrackedImage",wd);J.add("XRControllerFollow",bu);J.add("XRControllerModel",Hc);J.add("XRControllerMovement",Sa);J.add("XRFlag",ra);J.add("XRRig",YT);J.add("XRState",fr);const d_=Hs,wSe=ie("debugtypestore");wSe&&console.log(J);function SSe(s,e){const i=d9(s,e);return i!==void 0?i:null}const CSe=new kfe,oB=Symbol("deserialize-queue");async function ESe(s,e,t,i=null,n){if(!t)return;let r=i;typeof r=="number"&&(r=new Ms(i));const o=e.indexOf("?");e=o===-1?e:e.substring(0,o);const a=new qk(t.scene);a.gltfId=e,a.context=s,a.gltf=t,a.nodeToObject=n==null?void 0:n.nodeToObjectMap,a.implementationInformation=CSe;let l=s[oB];if(l||(l=s[oB]=[]),t.scenes)for(const c of t.scenes)await fO(a,c,l);if(t.children)for(const c of t.children)await fO(a,c,l);s.new_scripts_pre_setup_callbacks.push(()=>{const c=s[oB];if(c){for(const h of c)MSe(h,a);c.length=0}if(r){const h={},u=[];dO(t,r,h,u);for(const f of t.scenes)dO(f,r,h,u);for(const f of u)f.resolveGuids(h)}})}const uO=Symbol("original-component-name"),kg=new Map;function dO(s,e,t,i){if(e===null||!s)return;const n=s.guid,r=s.guid;r!=null&&r.length&&(kg.has(r)||(d_&&console.log('Creating InstanceIdProvider with key "'+r+'" for object '+s.name),kg.set(r,new Ms(r))));const o=r&&kg.get(r)||e;if(s.guid=o.generateUUID(),n&&n!=="invalid"&&(t[n]=s.guid),s&&s.userData&&s.userData.components)for(const a of s.userData.components){if(a===null)continue;const l=a.guid;l?kg.has(l)||(d_&&console.log('Creating InstanceIdProvider with key "'+l+'" for component '+a[uO]),kg.set(l,new Ms(l))):d_&&console.warn("Can not create IdProvider: component "+a[uO]+" has no guid",a.guid);const c=kg.get(l)||e,h=a.guid;a.guid=c.generateUUID(),h&&h!=="invalid"&&(t[h]=a.guid),a.resolveGuids&&i.push(a)}if(s.children)for(const a of s.children)dO(a,e,t,i)}const eA=[];async function fO(s,e,t,i){if(!e)return;const n=e.userData;if(n){const r=n.builtin_components;if(r&&r.length>0)for(const o of r)try{if(o===null)continue;const a=J.get(o.name);if(a!=null){const l=new a;l.sourceId=s.gltfId,hv(l,o,s.implementationInformation),l.context=s.context,"guid"in o&&(l[qA]=o.guid),l[uO]=o.name,zp(e,l,!1),t.push({instance:l,compData:o,obj:e}),l.isCamera&&s.context&&s.context.mainCamera===null&&l.tag==="MainCamera"&&s.context.setCurrentCamera(l)}else d_&&console.debug("unknown component: "+o.name),eA.includes(o.name)||eA.push(o.name)}catch(a){console.error(o.name+" - "+a.message,a)}if(eA.length>0){const o=eA.join(", ");console.warn("unknown components: "+o),eA.length=0,yo()&&_n(`<strong>Unknown components in scene</strong>:

${o}

This could mean you forgot to add a npmdef to your ExportInfo
<a href="https://engine.needle.tools/docs/project_structure.html#creating-and-installing-a-npmdef" target="_blank">documentation</a>`,la.Warn)}}if(e.children)for(const r of e.children)await fO(s,r,t)}function MSe(s,e){const{instance:t,compData:i,obj:n}=s;e.object=n,e.target=t,cE(t,i,e),d_&&console.debug("add "+i.name,i,t)}const Nq=ie("debugfileformat");async function zq(s,e=!0){var i;if(e){const n=s,r=new URL(n,globalThis.location.origin);let o=null;const a=r.searchParams.get("filetype");switch(a&&(o=a.toUpperCase()),o!=null&&o.length||(o=(i=r.pathname.split(".").pop())==null?void 0:i.toUpperCase()),o){case"GLTF":return"gltf";case"VRM":return"vrm";case"GLB":return"glb";case"FBX":return"fbx";case"USD":return"usd";case"USDA":return"usda";case"USDZ":return"usdz"}}const t=await fetch(s,{method:"GET",headers:{range:"bytes=0-32"}}).catch(n=>null);if(t!=null&&t.ok){const n=await t.arrayBuffer(),r=Gq(n);return Nq&&console.log("Determined file type from header: "+r),r}return"unknown"}function Gq(s){if(s.byteLength<4)return"unknown";const e=new Uint8Array(s);return Nq&&console.warn(`Trying to determine file type from binary data
`,'"'+new TextDecoder().decode(s)+`"
`,e),e[0]==103&&e[1]==108&&e[2]==84&&e[3]==70?"glb":e[0]==80&&e[1]==75&&e[2]==3&&e[3]==4?"usdz":e[0]==80&&e[1]==88&&e[2]==82&&e[3]==45&&e[4]==85&&e[5]==83&&e[6]==68&&e[7]==67?"usd":e[0]==35&&e[1]==117&&e[2]==115&&e[3]==100&&e[4]==97?"usda":e[0]==75&&e[1]==97&&e[2]==121&&e[3]==100&&e[4]==97&&e[5]==114&&e[6]==97&&e[7]==32?"fbx":e[0]==35&&e[1]==32&&e[2]==66&&e[3]==108&&e[4]==101&&e[5]==110&&e[6]==100&&e[7]==101&&e[8]==114&&e[9]==32?"obj":"unknown"}class mU{createBuiltinComponents(e,t,i,n,r){return ESe(e,t,i,n,r)}writeBuiltinComponentData(e,t){return SSe(e,t)}parseSync(e,t,i,n){return jq(e,t,i,n)}loadSync(e,t,i,n,r){return yU(e,t,i,n,r)}}xL(mU);const Hq=ie("printGltf")||ie("printgltf"),Vq=ie("downloadgltf");var Qq=(s=>(s[s.BeforeLoad=0]="BeforeLoad",s[s.AfterLoaded=1]="AfterLoaded",s[s.FinishedSetup=10]="FinishedSetup",s))(Qq||{});class Xp{constructor(e,t,i,n){d(this,"context");d(this,"loader");d(this,"path");d(this,"gltf");this.context=e,this.path=t,this.loader=i,this.gltf=n}}const Ud={};function TSe(s,e){Ud[s]=Ud[s]||[],Ud[s].push(e)}function ISe(s,e){if(Ud[s]){const t=Ud[s].indexOf(e);t>=0&&Ud[s].splice(t,1)}}function Wy(s,e){if(Ud[s])for(const t of Ud[s])t(e)}async function Wq(s,e,t,i,n){Hq&&console.warn("glTF",e,t),e.includes("?")&&(e=e.split("?")[0]),await Gl().createBuiltinComponents(s,e,t,i,n)}async function gU(s,e){const t=await zq(s)||"unknown";switch(t){case"unknown":return console.warn("Unknown file type:",s),new Wd;case"fbx":return new n7;case"obj":return new sF;case"usd":case"usda":case"usdz":return console.warn("USD files are not supported."),null;default:console.warn("Unknown file type:",t);case"gltf":case"glb":case"vrm":const i=new Wd;return await kF(i,e,s),i}}async function jq(s,e,t,i){typeof t!="string"&&(console.warn("Parse gltf binary without path, this might lead to errors in resolving extensions. Please provide the source path of the gltf/glb file",t,typeof t),t=""),Hq&&console.log("Parse glTF",t);const n=await gU(t,s);if(!n)return;if(n instanceof sF){typeof e!="string"&&(e=new TextDecoder().decode(e));const o=n.parse(e);return{animations:o.animations,scene:o,scenes:[o]}}if(!(n instanceof Wd)){const o=n.parse(e,t);return Yq(n,o),{animations:o.animations,scene:o,scenes:[o]}}const r=LF(n);return new Promise((o,a)=>{try{let l=t.split("?")[0].trimEnd();if(l.endsWith(".glb")||l.endsWith(".gltf")){const h=l.split("/");h.pop(),l=h.join("/"),l.endsWith("/")||(l+="/")}n.resourcePath=l,rT(n,s),Wy(0,new Xp(s,t,n));const c=s.mainCamera;n.parse(e,"",async h=>{UF(t,h,s),Wy(1,new Xp(s,t,n,h)),await Wq(s,t,h,i,r),await qq(h.scene,s,c),Wy(10,new Xp(s,t,n,h)),o(h),Vq&&Xq(e)},h=>{console.error("failed loading "+t,h),o(void 0)})}catch(l){console.error(l),a(l)}})}async function yU(s,e,t,i,n){RSe(e);const r=await gU(e,s);if(!r)return;if(!(r instanceof Wd)){const a=await r.loadAsync(e,n);return Yq(r,a),{animations:a.animations,scene:a,scenes:[a]}}const o=LF(r);return new Promise((a,l)=>{try{rT(r,s),Wy(0,new Xp(s,e,r));const c=s.mainCamera;r.load(e,async h=>{UF(e,h,s),Wy(1,new Xp(s,e,r,h)),await Wq(s,t,h,i,o),await qq(h.scene,s,c),Wy(10,new Xp(s,e,r,h)),a(h),Vq&&Xq(e)},h=>{n==null||n.call(r,h)},h=>{console.error("failed loading "+e,h),a(void 0)})}catch(c){console.error(c),l(c)}})}async function qq(s,e,t){t||(t=e.mainCamera),t?await e.renderer.compileAsync(s,t,e.scene):hfe(s,e)}function RSe(s){if(new URL(s,window.location.href).href.startsWith("file://")){const t=`Hi - it looks like you are trying to load a local file which will not work. You need to use a webserver to serve your files.
Please refer to the documentation on <a href="https://fwd.needle.tools/needle-engine/docs/local-server">https://docs.needle.tools</a> or ask for help in our <a href="https://discord.needle.tools">discord community</a>`;_n(t),console.warn(t)}}function Xq(s){if(typeof s=="string"){const e=document.createElement("a");e.href=s,e.download=s.split("/").pop(),e.click()}else{const e=new Blob([s],{type:"application/octet-stream"}),t=window.URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download="download.glb",i.click()}}function Yq(s,e){if(e!=null&&e.isObject3D){const t=e;s instanceof n7?t.traverse(i=>{const n=i;n!=null&&n.isMesh&&sk(n,n.material)}):s instanceof sF&&t.traverse(i=>{})}}xL(mU);const pn=ie("debugwebcomponent"),BV="needle-engine",Kq="vr",Jq="desktop",PSe=[t7,Kq,Jq],tA="ar-session-active",iA="desktop-session-active",BSe=["hash","src","camera-controls","loadstart","progress","loadfinished","dracoDecoderPath","dracoDecoderType","ktx2DecoderPath","tone-mapping","tone-mapping-exposure"];class vU extends HTMLElement{constructor(){super();d(this,"_context");d(this,"_overlay_ar");d(this,"_loadingProgress01",0);d(this,"_loadingView");d(this,"_previousSrc",null);d(this,"_didFullyLoad",!1);d(this,"_loadId",0);d(this,"_abortController",null);d(this,"_lastSourceFiles",null);d(this,"_createContextPromise",null);d(this,"onXRSessionStarted",()=>{var i;const t=this.context.xrSessionMode;t==="immersive-ar"?this.onEnterAR(this.context.xrSession):t==="immersive-vr"&&this.onEnterVR(this.context.xrSession),(i=this.context.xrSession)==null||i.addEventListener("end",()=>{this.dispatchEvent(new CustomEvent("xr-session-ended",{detail:{session:this.context.xrSession,context:this._context,sessionMode:t}})),t==="immersive-ar"?this.onExitAR(this.context.xrSession):t==="immersive-vr"&&this.onExitVR(this.context.xrSession)})});d(this,"onReady",()=>{var t;return(t=this._loadingView)==null?void 0:t.onLoadingFinished()});d(this,"onError",()=>{var t;return(t=this._loadingView)==null?void 0:t.setMessage("Loading failed!")});d(this,"_previouslyRegisteredMap",new Map);this._overlay_ar=new ame,this.addEventListener("ready",this.onReady),Z9(),this.attachShadow({mode:"open"});const t=document.createElement("template");t.innerHTML=`<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap');

    :host {
        position: absolute;
        display: block;
        width: max(600px, 100%);
        height: max(300px, 100%);
        touch-action: none;
    }

    @media (max-width: 600px) {
        :host {
            width: 100%;
        }
    }
    @media (max-height: 300px) {
        :host {
            height: 100%;
        }
    }
    :host canvas {   
        position: absolute;
        user-select: none;
        /** allow touch panning but no pinch zoom **/
        /** but this doesnt work yet: 
         * touch-action: pan-x, pan-y;
         **/
    }
    :host .content {
        position: absolute;
        width: 100%;
        height: 100%;
        visibility: visible;
        z-index: 500; /* < must be less than the webxr buttons element */
        pointer-events: none;
    }
    :host .overlay-content {
        position: absolute;
        user-select: auto;
        pointer-events: all;
    }
    :host slot[name="quit-ar"]:hover {
        cursor: pointer;
    }
    :host .quit-ar-button {
        position: absolute;
        // top: env(titlebar-area-y); /** this doesnt work **/
        top: 60px; /** camera access needs a bit more space **/
        right: 20px;
        z-index: 9999;
    }
</style>
<div> <!-- this wrapper is necessary for WebXR https://github.com/meta-quest/immersive-web-emulator/issues/55 -->
    <canvas></canvas>
</div>
<div class="content">
    <slot class="overlay-content"></slot>
</div>
`,this.shadowRoot&&this.shadowRoot.appendChild(t.content.cloneNode(!0)),this._context=new Dt({domElement:this}),this.addEventListener("error",this.onError)}static get observedAttributes(){return BSe}get loadingProgress01(){return this._loadingProgress01}get loadingFinished(){return this.loadingProgress01>.999}get cameraControls(){const t=this.getAttribute("camera-controls");return t==null?null:!(t===null||t==="False"||t==="false"||t==="0")}getContext(){return new Promise((t,i)=>{if(this._context&&this.loadingFinished)t(this._context);else{const n=()=>{this.removeEventListener("loadfinished",n),this._context&&this.loadingFinished&&t(this._context)};this.addEventListener("loadfinished",n)}})}get context(){return this._context}async connectedCallback(){if(pn&&console.log("<needle-engine> connected"),this.addEventListener("xr-session-started",this.onXRSessionStarted),this.onSetupDesktop(),!this.getAttribute("src")){const i=globalThis["needle:codegen_files"];pn&&console.log('src is null, trying to load from globalThis["needle:codegen_files"]',i),i&&(pn&&console.log('globalThis["needle:codegen_files"]',i),this.setAttribute("src",i))}pn&&console.log("src",this.getAttribute("src"));const t=this._loadId;setTimeout(()=>{this.isConnected!==!1&&t===this._loadId&&this.onLoad()},1),tl!=null&&tl.length&&this.setAttribute("version",tl)}disconnectedCallback(){var n;this.removeEventListener("xr-session-started",this.onXRSessionStarted),this._didFullyLoad=!1;const t=this.getAttribute("keep-alive"),i=t==null||(t==null?void 0:t.length)>0&&t!=="true"&&t!=="1";pn&&console.warn('<needle-engine> disconnected, keep-alive: "'+t+'"',typeof t,"Dispose=",i),i?(pn&&console.warn("<needle-engine> dispose"),(n=this._context)==null||n.dispose(),this._context=null,this._lastSourceFiles=null,this._loadId+=1):pn&&console.warn("<needle-engine> is not disposed because keep-alive is set")}attributeChangedCallback(t,i,n){switch(pn&&console.log("attributeChangedCallback",t,i,n),t){case"src":pn&&console.warn(`<needle-engine src>
changed from "`,i,'" to "',n,'"'),this.onLoad();break;case"hash":this._context&&(this._context.hash=n);break;case"loadstart":case"progress":case"loadfinished":typeof n=="string"&&n.length>0&&(pn&&console.log(t+" attribute changed",n),this.registerEventFromAttribute(t,n));break;case"dracoDecoderPath":pn&&console.log("dracoDecoderPath",n),PG(n);break;case"dracoDecoderType":n==="wasm"||n==="js"?(pn&&console.log("dracoDecoderType",n),BG(n)):console.error("Invalid dracoDecoderType",n,"expected js or wasm");break;case"ktx2DecoderPath":pn&&console.log("ktx2DecoderPath",n),DG(n);break;case"tone-mapping":{this.applyTonemapping();break}case"tone-mapping-exposure":this.applyTonemapping()}}async onLoad(){var v,g;if(!this.isConnected)return;if(this._context||(pn&&console.warn("Create new context"),this._context=new Dt({domElement:this})),!this._context){console.error("Needle Engine: Context not initialized");return}const t=this.getSourceFiles();if(!this.checkIfSourceHasChanged(t,this._lastSourceFiles))return;this._abortController&&(pn&&console.warn("Abort previous loading process"),this._abortController.abort(),this._abortController=null),this._lastSourceFiles=t;const i=++this._loadId;if((t==null||t.length<=0)&&(pn&&console.warn("Clear scene",t),this._context.clear(),i!==this._loadId))return;const n=this.getAttribute("alias");this.classList.add("loading");const r=tu();this.ensureLoadStartIsRegistered();let o=this.dispatchEvent(new CustomEvent("loadstart",{detail:{context:this._context,alias:n},cancelable:!0}));if(r){const y=this.getAttribute("hide-loading-overlay");y!=null&&y!=="0"&&(o=!1)}o===!1&&!r&&(nt()||(o=!0),console.warn("Needle Engine: You need a commercial license to override the default loading view. Visit https://needle.tools/pricing"),nt()&&Fi('You need a <a target="_blank" href="https://needle.tools/pricing">commercial license</a> to override the default loading view. This will not work in production.')),!this._loadingView&&o&&(this._loadingView=new a_(this)),o&&(this._didFullyLoad!==!0?(v=this._loadingView)==null||v.onLoadingBegin("begin load"):setTimeout(()=>{this._loadingView&&this._loadingProgress01<.3&&this._loadId===i&&this._loadingView.onLoadingBegin("begin load")},300)),pn&&console.warn(`--------------
Needle Engine: Begin loading `+i+`
`,t),this.onBeforeBeginLoading();const a=[],l={context:this._context,name:"",progress:{},index:0,count:t.length,totalProgress01:this._loadingProgress01},c=new CustomEvent("progress",{detail:l}),h=new Array,u=new AbortController;this._abortController=u;const f={files:t,abortSignal:u.signal,onLoadingProgress:y=>{var _;if(u.signal.aborted)return;const A=y.index;!h[A]&&y.name&&(h[A]=DSe(y.name)),y.name=h[A],o&&((_=this._loadingView)==null||_.onLoadingUpdate(y)),l.name=y.name,l.progress=y.progress,this._loadingProgress01=nF(y),l.totalProgress01=this._loadingProgress01,this.dispatchEvent(c)},onLoadingFinished:(y,A,_)=>{u.signal.aborted||_&&a.push({src:A,file:_})}},p=this.getAttribute("hash");p!=null&&(this._context.hash=p),this._context.alias=n,this._createContextPromise=this._context.create(f);const m=await this._createContextPromise;if(this.applyTonemapping(),pn&&console.warn(`--------------
Needle Engine: finished loading `+i+`
`,t,`Aborted? ${u.signal.aborted}`),this._loadId!==i||u.signal.aborted){console.log("Loading finished but aborted...");return}this._loadingProgress01=1,o&&m&&((g=this._loadingView)==null||g.onLoadingUpdate(1,"creating scene")),this._didFullyLoad=!0,this.classList.remove("loading"),this.classList.add("loading-finished"),this.dispatchEvent(new CustomEvent("loadfinished",{detail:{context:this._context,src:n,loadedFiles:a}}))}applyTonemapping(){var n;if(!((n=this._context)!=null&&n.renderer))return;const t=this.getAttribute("tonemapping")||this.getAttribute("tone-mapping");switch(t==null?void 0:t.toLowerCase()){case"none":this._context.renderer.toneMapping=po;break;case"linear":this._context.renderer.toneMapping=mv;break;case"neutral":this._context.renderer.toneMapping=Jp;break;case"agx":this._context.renderer.toneMapping=gv;break;default:t!=null&&console.warn("Invalid tone-mapping attribute: "+t)}const i=this.getAttribute("tone-mapping-exposure");if(i!=null){const r=parseFloat(i);isNaN(r)||(this._context.renderer.toneMappingExposure=r)}}internalSetLoadingMessage(t){var i;(i=this._loadingView)==null||i.setMessage(t)}getSourceFiles(){const t=this.getAttribute("src");if(!t)return[];let i;Array.isArray(t)?i=t:t.startsWith("[")&&t.endsWith("]")?i=JSON.parse(t):t.includes(",")?i=t.split(","):i=[t];for(let n=i.length-1;n>=0;n--){const r=i[n];(r==="null"||r==="undefined"||(r==null?void 0:r.length)<=0)&&i.splice(n,1)}return i}checkIfSourceHasChanged(t,i){if((t==null?void 0:t.length)!==(i==null?void 0:i.length)||t==null&&i!==null||t!==null&&i==null)return!0;if(t!==null&&i!==null){for(let n=0;n<(t==null?void 0:t.length);n++)if(t[n]!==i[n])return!0}return!1}ensureLoadStartIsRegistered(){const t=this.getAttribute("loadstart");t&&this.registerEventFromAttribute("loadstart",t)}registerEventFromAttribute(t,i){const n=this._previouslyRegisteredMap.get(t);if(n&&(this._previouslyRegisteredMap.delete(t),this.removeEventListener(t,n)),typeof i=="string"&&i.length>0)try{const r=(0,eval)(i);typeof r=="function"&&(this._previouslyRegisteredMap.set(t,r),this.addEventListener(t,o=>r==null?void 0:r.call(globalThis,this._context,o)))}catch(r){console.error("Error registering event "+t+'="'+i+`" failed with the following error:
`,r)}}getAROverlayContainer(){return this._overlay_ar.createOverlayContainer(this)}getVROverlayContainer(){for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.classList.contains("vr"))return i}return null}onEnterAR(t){var n;this.onSetupAR();const i=this.getAROverlayContainer();this._overlay_ar.onBegin(this._context,i,t),this.dispatchEvent(new CustomEvent("enter-ar",{detail:{session:t,context:this._context,htmlContainer:(n=this._overlay_ar)==null?void 0:n.ARContainer}}))}onExitAR(t){var i;this._overlay_ar.onEnd(this._context),this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-ar",{detail:{session:t,context:this._context,htmlContainer:(i=this._overlay_ar)==null?void 0:i.ARContainer}}))}onEnterVR(t){this.onSetupVR(),this.dispatchEvent(new CustomEvent("enter-vr",{detail:{session:t,context:this._context}}))}onExitVR(t){this.onSetupDesktop(),this.dispatchEvent(new CustomEvent("exit-vr",{detail:{session:t,context:this._context}}))}onSetupAR(){this.classList.add(tA),this.classList.remove(iA);const t=this.getAROverlayContainer();pn&&console.warn("onSetupAR:",t),t&&(t.classList.add(tA),t.classList.remove(iA)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,t7))}onSetupVR(){this.classList.remove(tA),this.classList.remove(iA),this.foreachHtmlElement(t=>this.setupElementsForMode(t,Kq))}onSetupDesktop(){this.classList.remove(tA),this.classList.add(iA);const t=this.getAROverlayContainer();t&&(t.classList.remove(tA),t.classList.add(iA)),this.foreachHtmlElement(i=>this.setupElementsForMode(i,Jq))}setupElementsForMode(t,i,n=null){var o,a;if(t===((a=(o=this._context)==null?void 0:o.renderer)==null?void 0:a.domElement)||t.id==="VRButton"||t.id==="ARButton")return;if(t.classList.contains(i))t.style.visibility="visible",t.style.display==="none"&&(t.style.display="block");else for(const l of PSe)t.classList.contains(l)&&(t.style.visibility="hidden",t.style.display="none")}foreachHtmlElement(t){for(let i=0;i<this.children.length;i++){const n=this.children[i];n.style&&t(n)}}onBeforeBeginLoading(){const t=this.getAttribute("dracoDecoderPath");t&&(pn&&console.log("using custom draco decoder path",t),PG(t));const i=this.getAttribute("dracoDecoderType");i&&(pn&&console.log("using custom draco decoder type",i),BG(i));const n=this.getAttribute("ktx2DecoderPath");n&&(pn&&console.log("using custom ktx2 decoder path",n),DG(n))}}typeof window<"u"&&!window.customElements.get(BV)&&window.customElements.define(BV,vU);function DSe(s){if(s.startsWith("blob:"))return"blob";const e=s.split("/");let t=e[e.length-1];const i=t.indexOf("?");i>0&&(t=t.substring(0,i));const n=t.indexOf("=");n>0&&(t=t.substring(n));const r=t.split(".").pop();if((r==="glb"||r==="gltf")&&(t=t.substring(0,t.length-4)),t=decodeURIComponent(t),t.length>3){let o="";for(let a=0;a<t.length;a++){let l=t[a];if(l===" "&&o.length<=0)continue;const c=o.length===0,h=l>="0"&&l<="9";c==!1&&l===l.toUpperCase()&&!h?o+=" "+l:(c&&(l=l.toUpperCase()),o+=l)}return pn&&console.log("displayName",t,o),o}return pn&&console.log("displayName",t),t}const OSe=Object.freeze(Object.defineProperty({__proto__:null,NeedleEngineHTMLElement:vU},Symbol.toStringTag,{value:"Module"}));function LSe(){Nl.registerWaitForAllowAudio(()=>{const s=xM.getContext();s.addEventListener("statechange",()=>{setTimeout(()=>{const e=s.state;(e==="suspended"||e==="interrupted")&&s.resume().then(()=>{console.log("AudioContext resumed successfully")}).catch(t=>{console.log("Failed to resume AudioContext: "+t)})},500)})})}setTimeout(LSe,1e3);const E1=ie("debughotreload");let pb=!1;const f_=new Map;function kSe(){return pb}function FSe(s){var i;if(pb)return;const t=s.constructor.name;f_.has(t)?(i=f_.get(t))==null||i.push(s):f_.set(t,[s])}function USe(s){if(pb)return;const t=s.constructor.name,i=f_.get(t);if(!i)return;const n=i.indexOf(s);n!==-1&&i.splice(n,1)}let DV=!1;function NSe(){if(E1||DV)return;DV=!0;const s=console.error;console.error=(...e)=>{if(e.length){const t=e[0];if(typeof t=="string"&&t.includes("[hmr] Failed to reload ")){console.log("[Needle Engine] Hot reloading failed"),window.location.reload();return}}s.apply(console,e)}}function zSe(s){E1&&console.log("[HMR] Apply changes",s,Object.keys(s)),NSe();for(const e of Object.keys(s))try{pb=!0;const t=J.get(e);if(!t){E1&&console.log("[HMR] Type not found: "+e);continue}const i=s[e],n=f_.get(i.name);let r="[Needle Engine] Updating type: "+e;const o=(n==null?void 0:n.length)??-1;o>0?r+=" x"+o:r+=" - no instances",console.log(r);const a=Object.getOwnPropertyNames(t.prototype),l=Object.getOwnPropertyDescriptors(i.prototype);for(const c in l)l[c].writable&&(t.prototype[c]=s[e].prototype[c]);for(const c of a)l[c]||delete t.prototype[c];if(n){const c=new i,h=Object.getOwnPropertyDescriptors(c);for(const u of n){const f=u,p=f.isComponent===!0,m=p?f.activeAndEnabled:!0,v=p?f.context:void 0;try{if(p&&v&&Vh(f,v),p&&m&&(f.enabled=!1),u.onBeforeHotReloadFields&&u.onBeforeHotReloadFields()===!1)continue;for(const g in h)if(h[g].writable){if(u[g]===void 0)u[g]=c[g];else if(typeof u[g]=="function"&&!u[g].prototype){const A=u[g],_=A.name,b="bound ";if(_===b)continue;const x=A.name.substring(b.length),E=i.prototype[x];E&&(u[g]=E.bind(u))}}u.onAfterHotReloadFields&&u.onAfterHotReloadFields()}finally{p&&v&&Hk(f,v),p&&m&&(f.enabled=!0)}}}}catch(t){if(E1)console.error(t);else return!1}finally{pb=!1,Cc(la.Log,"Script changes applied (HMR)")}return!0}let Ue;const mb=new Array(128).fill(void 0);mb.push(void 0,null,!0,!1);mb.length;let lC=null;function OV(){return lC!==null&&lC.byteLength!==0||(lC=new Int32Array(Ue.memory.buffer)),lC}const GSe=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&GSe.decode();function vt(s,e){if(!(s instanceof e))throw new Error(`expected instance of ${e.name}`);return s.ptr}let cC=null;function HSe(){return cC!==null&&cC.byteLength!==0||(cC=new Float32Array(Ue.memory.buffer)),cC}let p_=128;function LV(s){if(p_==1)throw new Error("out of js stack");return mb[--p_]=s,p_}let hC=null;function VSe(){return hC!==null&&hC.byteLength!==0||(hC=new Uint32Array(Ue.memory.buffer)),hC}let ia=0;function ep(s,e){const t=e(4*s.length,4)>>>0;return HSe().set(s,t/4),ia=s.length,t}function uC(s,e){const t=e(4*s.length,4)>>>0;return VSe().set(s,t/4),ia=s.length,t}const nr=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"});class QSe{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_raweventqueue_free(e)}constructor(e){const t=Ue.raweventqueue_new(e);return this.__wbg_ptr=t>>>0,this}drainCollisionEvents(e){try{Ue.raweventqueue_drainCollisionEvents(this.__wbg_ptr,LV(e))}finally{mb[p_++]=void 0}}drainContactForceEvents(e){try{Ue.raweventqueue_drainContactForceEvents(this.__wbg_ptr,LV(e))}finally{mb[p_++]=void 0}}clear(){Ue.raweventqueue_clear(this.__wbg_ptr)}}class Nr{static __wrap(e){e>>>=0;const t=Object.create(Nr.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawgenericjoint_free(e)}static generic(e,t,i,n){vt(e,dt),vt(t,dt),vt(i,dt);const r=Ue.rawgenericjoint_generic(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n);return r===0?void 0:Nr.__wrap(r)}static spring(e,t,i,n,r){vt(n,dt),vt(r,dt);const o=Ue.rawgenericjoint_spring(e,t,i,n.__wbg_ptr,r.__wbg_ptr);return Nr.__wrap(o)}static rope(e,t,i){vt(t,dt),vt(i,dt);const n=Ue.rawgenericjoint_rope(e,t.__wbg_ptr,i.__wbg_ptr);return Nr.__wrap(n)}static spherical(e,t){vt(e,dt),vt(t,dt);const i=Ue.rawgenericjoint_spherical(e.__wbg_ptr,t.__wbg_ptr);return Nr.__wrap(i)}static prismatic(e,t,i,n,r,o){vt(e,dt),vt(t,dt),vt(i,dt);const a=Ue.rawgenericjoint_prismatic(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n,r,o);return a===0?void 0:Nr.__wrap(a)}static fixed(e,t,i,n){vt(e,dt),vt(t,cr),vt(i,dt),vt(n,cr);const r=Ue.rawgenericjoint_fixed(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr);return Nr.__wrap(r)}static revolute(e,t,i){vt(e,dt),vt(t,dt),vt(i,dt);const n=Ue.rawgenericjoint_revolute(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr);return n===0?void 0:Nr.__wrap(n)}}class AU{static __wrap(e){e>>>=0;const t=Object.create(AU.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawpointprojection_free(e)}point(){const e=Ue.rawpointprojection_point(this.__wbg_ptr);return dt.__wrap(e)}isInside(){return Ue.rawpointprojection_isInside(this.__wbg_ptr)!==0}}class _U{static __wrap(e){e>>>=0;const t=Object.create(_U.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawrayintersection_free(e)}normal(){const e=Ue.rawraycolliderintersection_normal(this.__wbg_ptr);return dt.__wrap(e)}toi(){return Ue.rawraycolliderintersection_toi(this.__wbg_ptr)}featureType(){return Ue.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const i=Ue.__wbindgen_add_to_stack_pointer(-16);Ue.rawpointcolliderprojection_featureId(i,this.__wbg_ptr);var e=OV()[i/4+0],t=OV()[i/4+1];return e===0?void 0:t>>>0}finally{Ue.__wbindgen_add_to_stack_pointer(16)}}}class cr{static __wrap(e){e>>>=0;const t=Object.create(cr.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawrotation_free(e)}constructor(e,t,i,n){const r=Ue.rawrotation_new(e,t,i,n);return this.__wbg_ptr=r>>>0,this}static identity(){const e=Ue.rawrotation_identity();return cr.__wrap(e)}get x(){return Ue.rawrotation_x(this.__wbg_ptr)}get y(){return Ue.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return Ue.rawraycolliderintersection_toi(this.__wbg_ptr)}get w(){return Ue.rawintegrationparameters_erp(this.__wbg_ptr)}}class Kt{static __wrap(e){e>>>=0;const t=Object.create(Kt.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawshape_free(e)}static cuboid(e,t,i){const n=Ue.rawshape_cuboid(e,t,i);return Kt.__wrap(n)}static roundCuboid(e,t,i,n){const r=Ue.rawshape_roundCuboid(e,t,i,n);return Kt.__wrap(r)}static ball(e){const t=Ue.rawshape_ball(e);return Kt.__wrap(t)}static halfspace(e){vt(e,dt);const t=Ue.rawshape_halfspace(e.__wbg_ptr);return Kt.__wrap(t)}static capsule(e,t){const i=Ue.rawshape_capsule(e,t);return Kt.__wrap(i)}static cylinder(e,t){const i=Ue.rawshape_cylinder(e,t);return Kt.__wrap(i)}static roundCylinder(e,t,i){const n=Ue.rawshape_roundCylinder(e,t,i);return Kt.__wrap(n)}static cone(e,t){const i=Ue.rawshape_cone(e,t);return Kt.__wrap(i)}static roundCone(e,t,i){const n=Ue.rawshape_roundCone(e,t,i);return Kt.__wrap(n)}static polyline(e,t){const i=ep(e,Ue.__wbindgen_malloc),n=ia,r=uC(t,Ue.__wbindgen_malloc),o=ia,a=Ue.rawshape_polyline(i,n,r,o);return Kt.__wrap(a)}static trimesh(e,t){const i=ep(e,Ue.__wbindgen_malloc),n=ia,r=uC(t,Ue.__wbindgen_malloc),o=ia,a=Ue.rawshape_trimesh(i,n,r,o);return Kt.__wrap(a)}static heightfield(e,t,i,n){const r=ep(i,Ue.__wbindgen_malloc),o=ia;vt(n,dt);const a=Ue.rawshape_heightfield(e,t,r,o,n.__wbg_ptr);return Kt.__wrap(a)}static segment(e,t){vt(e,dt),vt(t,dt);const i=Ue.rawshape_segment(e.__wbg_ptr,t.__wbg_ptr);return Kt.__wrap(i)}static triangle(e,t,i){vt(e,dt),vt(t,dt),vt(i,dt);const n=Ue.rawshape_triangle(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr);return Kt.__wrap(n)}static roundTriangle(e,t,i,n){vt(e,dt),vt(t,dt),vt(i,dt);const r=Ue.rawshape_roundTriangle(e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n);return Kt.__wrap(r)}static convexHull(e){const t=ep(e,Ue.__wbindgen_malloc),i=ia,n=Ue.rawshape_convexHull(t,i);return n===0?void 0:Kt.__wrap(n)}static roundConvexHull(e,t){const i=ep(e,Ue.__wbindgen_malloc),n=ia,r=Ue.rawshape_roundConvexHull(i,n,t);return r===0?void 0:Kt.__wrap(r)}static convexMesh(e,t){const i=ep(e,Ue.__wbindgen_malloc),n=ia,r=uC(t,Ue.__wbindgen_malloc),o=ia,a=Ue.rawshape_convexMesh(i,n,r,o);return a===0?void 0:Kt.__wrap(a)}static roundConvexMesh(e,t,i){const n=ep(e,Ue.__wbindgen_malloc),r=ia,o=uC(t,Ue.__wbindgen_malloc),a=ia,l=Ue.rawshape_roundConvexMesh(n,r,o,a,i);return l===0?void 0:Kt.__wrap(l)}castShape(e,t,i,n,r,o,a,l,c){vt(e,dt),vt(t,cr),vt(i,dt),vt(n,Kt),vt(r,dt),vt(o,cr),vt(a,dt);const h=Ue.rawshape_castShape(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o.__wbg_ptr,a.__wbg_ptr,l,c);return h===0?void 0:xU.__wrap(h)}intersectsShape(e,t,i,n,r){return vt(e,dt),vt(t,cr),vt(i,Kt),vt(n,dt),vt(r,cr),Ue.rawshape_intersectsShape(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr)!==0}contactShape(e,t,i,n,r,o){vt(e,dt),vt(t,cr),vt(i,Kt),vt(n,dt),vt(r,cr);const a=Ue.rawshape_contactShape(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r.__wbg_ptr,o);return a===0?void 0:bU.__wrap(a)}containsPoint(e,t,i){return vt(e,dt),vt(t,cr),vt(i,dt),Ue.rawshape_containsPoint(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr)!==0}projectPoint(e,t,i,n){vt(e,dt),vt(t,cr),vt(i,dt);const r=Ue.rawshape_projectPoint(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n);return AU.__wrap(r)}intersectsRay(e,t,i,n,r){return vt(e,dt),vt(t,cr),vt(i,dt),vt(n,dt),Ue.rawshape_intersectsRay(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r)!==0}castRay(e,t,i,n,r,o){return vt(e,dt),vt(t,cr),vt(i,dt),vt(n,dt),Ue.rawshape_castRay(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r,o)}castRayAndGetNormal(e,t,i,n,r,o){vt(e,dt),vt(t,cr),vt(i,dt),vt(n,dt);const a=Ue.rawshape_castRayAndGetNormal(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,i.__wbg_ptr,n.__wbg_ptr,r,o);return a===0?void 0:_U.__wrap(a)}}class bU{static __wrap(e){e>>>=0;const t=Object.create(bU.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawshapecontact_free(e)}distance(){return Ue.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const e=Ue.rawpointprojection_point(this.__wbg_ptr);return dt.__wrap(e)}point2(){const e=Ue.rawraycolliderintersection_normal(this.__wbg_ptr);return dt.__wrap(e)}normal1(){const e=Ue.rawshapecollidertoi_witness2(this.__wbg_ptr);return dt.__wrap(e)}normal2(){const e=Ue.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return dt.__wrap(e)}}class xU{static __wrap(e){e>>>=0;const t=Object.create(xU.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawshapetoi_free(e)}toi(){return Ue.rawrotation_x(this.__wbg_ptr)}witness1(){const e=Ue.rawshapetoi_witness1(this.__wbg_ptr);return dt.__wrap(e)}witness2(){const e=Ue.rawcontactforceevent_total_force(this.__wbg_ptr);return dt.__wrap(e)}normal1(){const e=Ue.rawshapetoi_normal1(this.__wbg_ptr);return dt.__wrap(e)}normal2(){const e=Ue.rawshapetoi_normal2(this.__wbg_ptr);return dt.__wrap(e)}}class dt{static __wrap(e){e>>>=0;const t=Object.create(dt.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ue.__wbg_rawvector_free(e)}static zero(){const e=Ue.rawvector_zero();return dt.__wrap(e)}constructor(e,t,i){const n=Ue.rawvector_new(e,t,i);return this.__wbg_ptr=n>>>0,this}get x(){return Ue.rawrotation_x(this.__wbg_ptr)}set x(e){Ue.rawvector_set_x(this.__wbg_ptr,e)}get y(){return Ue.rawintegrationparameters_dt(this.__wbg_ptr)}set y(e){Ue.rawintegrationparameters_set_dt(this.__wbg_ptr,e)}get z(){return Ue.rawraycolliderintersection_toi(this.__wbg_ptr)}set z(e){Ue.rawvector_set_z(this.__wbg_ptr,e)}xyz(){const e=Ue.rawvector_xyz(this.__wbg_ptr);return dt.__wrap(e)}yxz(){const e=Ue.rawvector_yxz(this.__wbg_ptr);return dt.__wrap(e)}zxy(){const e=Ue.rawvector_zxy(this.__wbg_ptr);return dt.__wrap(e)}xzy(){const e=Ue.rawvector_xzy(this.__wbg_ptr);return dt.__wrap(e)}yzx(){const e=Ue.rawvector_yzx(this.__wbg_ptr);return dt.__wrap(e)}zyx(){const e=Ue.rawvector_zyx(this.__wbg_ptr);return dt.__wrap(e)}}class WSe{constructor(e,t,i){this.x=e,this.y=t,this.z=i}}class Re{static new(e,t,i){return new WSe(e,t,i)}static intoRaw(e){return new dt(e.x,e.y,e.z)}static zeros(){return Re.new(0,0,0)}static fromRaw(e){if(!e)return null;let t=Re.new(e.x,e.y,e.z);return e.free(),t}static copy(e,t){e.x=t.x,e.y=t.y,e.z=t.z}}class kV{constructor(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n}}class Ji{static identity(){return new kV(0,0,0,1)}static fromRaw(e){if(!e)return null;let t=new kV(e.x,e.y,e.z,e.w);return e.free(),t}static intoRaw(e){return new cr(e.x,e.y,e.z,e.w)}static copy(e,t){e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w}}class jSe{constructor(e){this.elements=e}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class FV{static fromRaw(e){const t=new jSe(e.elements());return e.free(),t}}var m_,Lr,UV,NV,rs,pO,es,zV,TE,mO,GV,IE,Cy;(function(s){s[s.Dynamic=0]="Dynamic",s[s.Fixed=1]="Fixed",s[s.KinematicPositionBased=2]="KinematicPositionBased",s[s.KinematicVelocityBased=3]="KinematicVelocityBased"})(m_||(m_={}));class HV{constructor(e,t,i){this.rawSet=e,this.colliderSet=t,this.handle=i}finalizeDeserialization(e){this.colliderSet=e}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(e,t){return this.rawSet.rbLockTranslations(this.handle,e,t)}lockRotations(e,t){return this.rawSet.rbLockRotations(this.handle,e,t)}setEnabledTranslations(e,t,i,n){return this.rawSet.rbSetEnabledTranslations(this.handle,e,t,i,n)}restrictTranslations(e,t,i,n){this.setEnabledTranslations(e,t,i,n)}setEnabledRotations(e,t,i,n){return this.rawSet.rbSetEnabledRotations(this.handle,e,t,i,n)}restrictRotations(e,t,i,n){this.setEnabledRotations(e,t,i,n)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(e){this.rawSet.rbSetDominanceGroup(this.handle,e)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(e){this.rawSet.rbSetAdditionalSolverIterations(this.handle,e)}enableCcd(e){this.rawSet.rbEnableCcd(this.handle,e)}translation(){let e=this.rawSet.rbTranslation(this.handle);return Re.fromRaw(e)}rotation(){let e=this.rawSet.rbRotation(this.handle);return Ji.fromRaw(e)}nextTranslation(){let e=this.rawSet.rbNextTranslation(this.handle);return Re.fromRaw(e)}nextRotation(){let e=this.rawSet.rbNextRotation(this.handle);return Ji.fromRaw(e)}setTranslation(e,t){this.rawSet.rbSetTranslation(this.handle,e.x,e.y,e.z,t)}setLinvel(e,t){let i=Re.intoRaw(e);this.rawSet.rbSetLinvel(this.handle,i,t),i.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(e,t){this.rawSet.rbSetGravityScale(this.handle,e,t)}setRotation(e,t){this.rawSet.rbSetRotation(this.handle,e.x,e.y,e.z,e.w,t)}setAngvel(e,t){let i=Re.intoRaw(e);this.rawSet.rbSetAngvel(this.handle,i,t),i.free()}setNextKinematicTranslation(e){this.rawSet.rbSetNextKinematicTranslation(this.handle,e.x,e.y,e.z)}setNextKinematicRotation(e){this.rawSet.rbSetNextKinematicRotation(this.handle,e.x,e.y,e.z,e.w)}linvel(){return Re.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return Re.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return Re.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return Re.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return Re.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return Re.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return Re.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return Ji.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return FV.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return FV.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(e){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,e))}setEnabled(e){this.rawSet.rbSetEnabled(this.handle,e)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(e,t){return this.rawSet.rbSetBodyType(this.handle,e,t)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(e){this.rawSet.rbSetLinearDamping(this.handle,e)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(e,t){this.rawSet.rbSetAdditionalMass(this.handle,e,t)}setAdditionalMassProperties(e,t,i,n,r){let o=Re.intoRaw(t),a=Re.intoRaw(i),l=Ji.intoRaw(n);this.rawSet.rbSetAdditionalMassProperties(this.handle,e,o,a,l,r),o.free(),a.free(),l.free()}setAngularDamping(e){this.rawSet.rbSetAngularDamping(this.handle,e)}resetForces(e){this.rawSet.rbResetForces(this.handle,e)}resetTorques(e){this.rawSet.rbResetTorques(this.handle,e)}addForce(e,t){const i=Re.intoRaw(e);this.rawSet.rbAddForce(this.handle,i,t),i.free()}applyImpulse(e,t){const i=Re.intoRaw(e);this.rawSet.rbApplyImpulse(this.handle,i,t),i.free()}addTorque(e,t){const i=Re.intoRaw(e);this.rawSet.rbAddTorque(this.handle,i,t),i.free()}applyTorqueImpulse(e,t){const i=Re.intoRaw(e);this.rawSet.rbApplyTorqueImpulse(this.handle,i,t),i.free()}addForceAtPoint(e,t,i){const n=Re.intoRaw(e),r=Re.intoRaw(t);this.rawSet.rbAddForceAtPoint(this.handle,n,r,i),n.free(),r.free()}applyImpulseAtPoint(e,t,i){const n=Re.intoRaw(e),r=Re.intoRaw(t);this.rawSet.rbApplyImpulseAtPoint(this.handle,n,r,i),n.free(),r.free()}}(function(s){s[s.Revolute=0]="Revolute",s[s.Fixed=1]="Fixed",s[s.Prismatic=2]="Prismatic",s[s.Rope=3]="Rope",s[s.Spring=4]="Spring",s[s.Spherical=5]="Spherical",s[s.Generic=6]="Generic"})(Lr||(Lr={})),function(s){s[s.AccelerationBased=0]="AccelerationBased",s[s.ForceBased=1]="ForceBased"}(UV||(UV={})),function(s){s[s.X=1]="X",s[s.Y=2]="Y",s[s.Z=4]="Z",s[s.AngX=8]="AngX",s[s.AngY=16]="AngY",s[s.AngZ=32]="AngZ"}(NV||(NV={}));class Oh{constructor(){}static fixed(e,t,i,n){let r=new Oh;return r.anchor1=e,r.anchor2=i,r.frame1=t,r.frame2=n,r.jointType=Lr.Fixed,r}static spring(e,t,i,n,r){let o=new Oh;return o.anchor1=n,o.anchor2=r,o.length=e,o.stiffness=t,o.damping=i,o.jointType=Lr.Spring,o}static rope(e,t,i){let n=new Oh;return n.anchor1=t,n.anchor2=i,n.length=e,n.jointType=Lr.Rope,n}static generic(e,t,i,n){let r=new Oh;return r.anchor1=e,r.anchor2=t,r.axis=i,r.axesMask=n,r.jointType=Lr.Generic,r}static spherical(e,t){let i=new Oh;return i.anchor1=e,i.anchor2=t,i.jointType=Lr.Spherical,i}static prismatic(e,t,i){let n=new Oh;return n.anchor1=e,n.anchor2=t,n.axis=i,n.jointType=Lr.Prismatic,n}static revolute(e,t,i){let n=new Oh;return n.anchor1=e,n.anchor2=t,n.axis=i,n.jointType=Lr.Revolute,n}intoRaw(){let e,t,i=Re.intoRaw(this.anchor1),n=Re.intoRaw(this.anchor2),r=!1,o=0,a=0;switch(this.jointType){case Lr.Fixed:let l=Ji.intoRaw(this.frame1),c=Ji.intoRaw(this.frame2);t=Nr.fixed(i,l,n,c),l.free(),c.free();break;case Lr.Spring:t=Nr.spring(this.length,this.stiffness,this.damping,i,n);break;case Lr.Rope:t=Nr.rope(this.length,i,n);break;case Lr.Prismatic:e=Re.intoRaw(this.axis),this.limitsEnabled&&(r=!0,o=this.limits[0],a=this.limits[1]),t=Nr.prismatic(i,n,e,r,o,a),e.free();break;case Lr.Generic:e=Re.intoRaw(this.axis);let h=this.axesMask;t=Nr.generic(i,n,e,h);break;case Lr.Spherical:t=Nr.spherical(i,n);break;case Lr.Revolute:e=Re.intoRaw(this.axis),t=Nr.revolute(i,n,e),e.free()}return i.free(),n.free(),t}}(function(s){s[s.Average=0]="Average",s[s.Min=1]="Min",s[s.Multiply=2]="Multiply",s[s.Max=3]="Max"})(rs||(rs={}));class gb{constructor(e,t,i,n,r){this.distance=e,this.point1=t,this.point2=i,this.normal1=n,this.normal2=r}static fromRaw(e){if(!e)return null;const t=new gb(e.distance(),Re.fromRaw(e.point1()),Re.fromRaw(e.point2()),Re.fromRaw(e.normal1()),Re.fromRaw(e.normal2()));return e.free(),t}}(function(s){s[s.Vertex=0]="Vertex",s[s.Edge=1]="Edge",s[s.Face=2]="Face",s[s.Unknown=3]="Unknown"})(pO||(pO={}));class KT{constructor(e,t){this.point=e,this.isInside=t}static fromRaw(e){if(!e)return null;const t=new KT(Re.fromRaw(e.point()),e.isInside());return e.free(),t}}class qSe{constructor(e,t){this.origin=e,this.dir=t}pointAt(e){return{x:this.origin.x+this.dir.x*e,y:this.origin.y+this.dir.y*e,z:this.origin.z+this.dir.z*e}}}class JT{constructor(e,t,i,n){this.featureType=pO.Unknown,this.featureId=void 0,this.toi=e,this.normal=t,n!==void 0&&(this.featureId=n),i!==void 0&&(this.featureType=i)}static fromRaw(e){if(!e)return null;const t=new JT(e.toi(),Re.fromRaw(e.normal()),e.featureType(),e.featureId());return e.free(),t}}class Hx{constructor(e,t,i,n,r){this.toi=e,this.witness1=t,this.witness2=i,this.normal1=n,this.normal2=r}static fromRaw(e,t){if(!t)return null;const i=new Hx(t.toi(),Re.fromRaw(t.witness1()),Re.fromRaw(t.witness2()),Re.fromRaw(t.normal1()),Re.fromRaw(t.normal2()));return t.free(),i}}class wU extends Hx{constructor(e,t,i,n,r,o){super(t,i,n,r,o),this.collider=e}static fromRaw(e,t){if(!t)return null;const i=new wU(e.get(t.colliderHandle()),t.toi(),Re.fromRaw(t.witness1()),Re.fromRaw(t.witness2()),Re.fromRaw(t.normal1()),Re.fromRaw(t.normal2()));return t.free(),i}}class Ks{static fromRaw(e,t){const i=e.coShapeType(t);let n,r,o,a,l,c,h;switch(i){case nr.Ball:return new SU(e.coRadius(t));case nr.Cuboid:return n=e.coHalfExtents(t),new Zq(n.x,n.y,n.z);case nr.RoundCuboid:return n=e.coHalfExtents(t),r=e.coRoundRadius(t),new $q(n.x,n.y,n.z,r);case nr.Capsule:return l=e.coHalfHeight(t),c=e.coRadius(t),new eX(l,c);case nr.Segment:return o=e.coVertices(t),new tX(Re.new(o[0],o[1],o[2]),Re.new(o[3],o[4],o[5]));case nr.Polyline:return o=e.coVertices(t),a=e.coIndices(t),new sX(o,a);case nr.Triangle:return o=e.coVertices(t),new iX(Re.new(o[0],o[1],o[2]),Re.new(o[3],o[4],o[5]),Re.new(o[6],o[7],o[8]));case nr.RoundTriangle:return o=e.coVertices(t),r=e.coRoundRadius(t),new nX(Re.new(o[0],o[1],o[2]),Re.new(o[3],o[4],o[5]),Re.new(o[6],o[7],o[8]),r);case nr.HalfSpace:return h=Re.fromRaw(e.coHalfspaceNormal(t)),new XSe(h);case nr.TriMesh:return o=e.coVertices(t),a=e.coIndices(t),new rX(o,a);case nr.HeightField:const u=e.coHeightfieldScale(t),f=e.coHeightfieldHeights(t),p=e.coHeightfieldNRows(t),m=e.coHeightfieldNCols(t);return new oX(p,m,f,u);case nr.ConvexPolyhedron:return o=e.coVertices(t),a=e.coIndices(t),new gO(o,a);case nr.RoundConvexPolyhedron:return o=e.coVertices(t),a=e.coIndices(t),r=e.coRoundRadius(t),new yO(o,a,r);case nr.Cylinder:return l=e.coHalfHeight(t),c=e.coRadius(t),new aX(l,c);case nr.RoundCylinder:return l=e.coHalfHeight(t),c=e.coRadius(t),r=e.coRoundRadius(t),new lX(l,c,r);case nr.Cone:return l=e.coHalfHeight(t),c=e.coRadius(t),new cX(l,c);case nr.RoundCone:return l=e.coHalfHeight(t),c=e.coRadius(t),r=e.coRoundRadius(t),new hX(l,c,r);default:throw new Error("unknown shape type: "+i)}}castShape(e,t,i,n,r,o,a,l,c){let h=Re.intoRaw(e),u=Ji.intoRaw(t),f=Re.intoRaw(i),p=Re.intoRaw(r),m=Ji.intoRaw(o),v=Re.intoRaw(a),g=this.intoRaw(),y=n.intoRaw(),A=Hx.fromRaw(null,g.castShape(h,u,f,y,p,m,v,l,c));return h.free(),u.free(),f.free(),p.free(),m.free(),v.free(),g.free(),y.free(),A}intersectsShape(e,t,i,n,r){let o=Re.intoRaw(e),a=Ji.intoRaw(t),l=Re.intoRaw(n),c=Ji.intoRaw(r),h=this.intoRaw(),u=i.intoRaw(),f=h.intersectsShape(o,a,u,l,c);return o.free(),a.free(),l.free(),c.free(),h.free(),u.free(),f}contactShape(e,t,i,n,r,o){let a=Re.intoRaw(e),l=Ji.intoRaw(t),c=Re.intoRaw(n),h=Ji.intoRaw(r),u=this.intoRaw(),f=i.intoRaw(),p=gb.fromRaw(u.contactShape(a,l,f,c,h,o));return a.free(),l.free(),c.free(),h.free(),u.free(),f.free(),p}containsPoint(e,t,i){let n=Re.intoRaw(e),r=Ji.intoRaw(t),o=Re.intoRaw(i),a=this.intoRaw(),l=a.containsPoint(n,r,o);return n.free(),r.free(),o.free(),a.free(),l}projectPoint(e,t,i,n){let r=Re.intoRaw(e),o=Ji.intoRaw(t),a=Re.intoRaw(i),l=this.intoRaw(),c=KT.fromRaw(l.projectPoint(r,o,a,n));return r.free(),o.free(),a.free(),l.free(),c}intersectsRay(e,t,i,n){let r=Re.intoRaw(t),o=Ji.intoRaw(i),a=Re.intoRaw(e.origin),l=Re.intoRaw(e.dir),c=this.intoRaw(),h=c.intersectsRay(r,o,a,l,n);return r.free(),o.free(),a.free(),l.free(),c.free(),h}castRay(e,t,i,n,r){let o=Re.intoRaw(t),a=Ji.intoRaw(i),l=Re.intoRaw(e.origin),c=Re.intoRaw(e.dir),h=this.intoRaw(),u=h.castRay(o,a,l,c,n,r);return o.free(),a.free(),l.free(),c.free(),h.free(),u}castRayAndGetNormal(e,t,i,n,r){let o=Re.intoRaw(t),a=Ji.intoRaw(i),l=Re.intoRaw(e.origin),c=Re.intoRaw(e.dir),h=this.intoRaw(),u=JT.fromRaw(h.castRayAndGetNormal(o,a,l,c,n,r));return o.free(),a.free(),l.free(),c.free(),h.free(),u}}(function(s){s[s.Ball=0]="Ball",s[s.Cuboid=1]="Cuboid",s[s.Capsule=2]="Capsule",s[s.Segment=3]="Segment",s[s.Polyline=4]="Polyline",s[s.Triangle=5]="Triangle",s[s.TriMesh=6]="TriMesh",s[s.HeightField=7]="HeightField",s[s.ConvexPolyhedron=9]="ConvexPolyhedron",s[s.Cylinder=10]="Cylinder",s[s.Cone=11]="Cone",s[s.RoundCuboid=12]="RoundCuboid",s[s.RoundTriangle=13]="RoundTriangle",s[s.RoundCylinder=14]="RoundCylinder",s[s.RoundCone=15]="RoundCone",s[s.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",s[s.HalfSpace=17]="HalfSpace"})(es||(es={}));class SU extends Ks{constructor(e){super(),this.type=es.Ball,this.radius=e}intoRaw(){return Kt.ball(this.radius)}}class XSe extends Ks{constructor(e){super(),this.type=es.HalfSpace,this.normal=e}intoRaw(){let e=Re.intoRaw(this.normal),t=Kt.halfspace(e);return e.free(),t}}class Zq extends Ks{constructor(e,t,i){super(),this.type=es.Cuboid,this.halfExtents=Re.new(e,t,i)}intoRaw(){return Kt.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class $q extends Ks{constructor(e,t,i,n){super(),this.type=es.RoundCuboid,this.halfExtents=Re.new(e,t,i),this.borderRadius=n}intoRaw(){return Kt.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}class eX extends Ks{constructor(e,t){super(),this.type=es.Capsule,this.halfHeight=e,this.radius=t}intoRaw(){return Kt.capsule(this.halfHeight,this.radius)}}class tX extends Ks{constructor(e,t){super(),this.type=es.Segment,this.a=e,this.b=t}intoRaw(){let e=Re.intoRaw(this.a),t=Re.intoRaw(this.b),i=Kt.segment(e,t);return e.free(),t.free(),i}}class iX extends Ks{constructor(e,t,i){super(),this.type=es.Triangle,this.a=e,this.b=t,this.c=i}intoRaw(){let e=Re.intoRaw(this.a),t=Re.intoRaw(this.b),i=Re.intoRaw(this.c),n=Kt.triangle(e,t,i);return e.free(),t.free(),i.free(),n}}class nX extends Ks{constructor(e,t,i,n){super(),this.type=es.RoundTriangle,this.a=e,this.b=t,this.c=i,this.borderRadius=n}intoRaw(){let e=Re.intoRaw(this.a),t=Re.intoRaw(this.b),i=Re.intoRaw(this.c),n=Kt.roundTriangle(e,t,i,this.borderRadius);return e.free(),t.free(),i.free(),n}}class sX extends Ks{constructor(e,t){super(),this.type=es.Polyline,this.vertices=e,this.indices=t??new Uint32Array(0)}intoRaw(){return Kt.polyline(this.vertices,this.indices)}}class rX extends Ks{constructor(e,t){super(),this.type=es.TriMesh,this.vertices=e,this.indices=t}intoRaw(){return Kt.trimesh(this.vertices,this.indices)}}class gO extends Ks{constructor(e,t){super(),this.type=es.ConvexPolyhedron,this.vertices=e,this.indices=t}intoRaw(){return this.indices?Kt.convexMesh(this.vertices,this.indices):Kt.convexHull(this.vertices)}}class yO extends Ks{constructor(e,t,i){super(),this.type=es.RoundConvexPolyhedron,this.vertices=e,this.indices=t,this.borderRadius=i}intoRaw(){return this.indices?Kt.roundConvexMesh(this.vertices,this.indices,this.borderRadius):Kt.roundConvexHull(this.vertices,this.borderRadius)}}class oX extends Ks{constructor(e,t,i,n){super(),this.type=es.HeightField,this.nrows=e,this.ncols=t,this.heights=i,this.scale=n}intoRaw(){let e=Re.intoRaw(this.scale),t=Kt.heightfield(this.nrows,this.ncols,this.heights,e);return e.free(),t}}class aX extends Ks{constructor(e,t){super(),this.type=es.Cylinder,this.halfHeight=e,this.radius=t}intoRaw(){return Kt.cylinder(this.halfHeight,this.radius)}}class lX extends Ks{constructor(e,t,i){super(),this.type=es.RoundCylinder,this.borderRadius=i,this.halfHeight=e,this.radius=t}intoRaw(){return Kt.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class cX extends Ks{constructor(e,t){super(),this.type=es.Cone,this.halfHeight=e,this.radius=t}intoRaw(){return Kt.cone(this.halfHeight,this.radius)}}class hX extends Ks{constructor(e,t,i){super(),this.type=es.RoundCone,this.halfHeight=e,this.radius=t,this.borderRadius=i}intoRaw(){return Kt.roundCone(this.halfHeight,this.radius,this.borderRadius)}}(function(s){s[s.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",s[s.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",s[s.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",s[s.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",s[s.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",s[s.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",s[s.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",s[s.ONLY_FIXED=6]="ONLY_FIXED"})(zV||(zV={}));(function(s){s[s.NONE=0]="NONE",s[s.COLLISION_EVENTS=1]="COLLISION_EVENTS",s[s.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(TE||(TE={}));class YSe{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return Re.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return Re.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class KSe{constructor(e,t){this.raw=t||new QSe(e)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(e){this.raw.drainCollisionEvents(e)}drainContactForceEvents(e){let t=new YSe;this.raw.drainContactForceEvents(i=>{t.raw=i,e(t),t.free()})}clear(){this.raw.clear()}}(function(s){s[s.NONE=0]="NONE",s[s.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",s[s.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(mO||(mO={})),function(s){s[s.EMPTY=0]="EMPTY",s[s.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"}(GV||(GV={})),function(s){s[s.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",s[s.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",s[s.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",s[s.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",s[s.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",s[s.FIXED_FIXED=32]="FIXED_FIXED",s[s.DEFAULT=15]="DEFAULT",s[s.ALL=60943]="ALL"}(IE||(IE={}));class VV{constructor(e,t,i,n){this.colliderSet=e,this.handle=t,this._parent=i,this._shape=n}finalizeDeserialization(e){this.handle!=null&&(this._parent=e.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=Ks.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return Re.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return Ji.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(e){this.colliderSet.raw.coSetSensor(this.handle,e)}setShape(e){let t=e.intoRaw();this.colliderSet.raw.coSetShape(this.handle,t),t.free(),this._shape=e}setEnabled(e){this.colliderSet.raw.coSetEnabled(this.handle,e)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(e){this.colliderSet.raw.coSetRestitution(this.handle,e)}setFriction(e){this.colliderSet.raw.coSetFriction(this.handle,e)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(e){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,e)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(e){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,e)}setCollisionGroups(e){this.colliderSet.raw.coSetCollisionGroups(this.handle,e)}setSolverGroups(e){this.colliderSet.raw.coSetSolverGroups(this.handle,e)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(e){this.colliderSet.raw.coSetActiveHooks(this.handle,e)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(e){this.colliderSet.raw.coSetActiveEvents(this.handle,e)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(e){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,e)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(e){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,e)}setDensity(e){this.colliderSet.raw.coSetDensity(this.handle,e)}setMass(e){this.colliderSet.raw.coSetMass(this.handle,e)}setMassProperties(e,t,i,n){let r=Re.intoRaw(t),o=Re.intoRaw(i),a=Ji.intoRaw(n);this.colliderSet.raw.coSetMassProperties(this.handle,e,r,o,a),r.free(),o.free(),a.free()}setTranslation(e){this.colliderSet.raw.coSetTranslation(this.handle,e.x,e.y,e.z)}setTranslationWrtParent(e){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,e.x,e.y,e.z)}setRotation(e){this.colliderSet.raw.coSetRotation(this.handle,e.x,e.y,e.z,e.w)}setRotationWrtParent(e){this.colliderSet.raw.coSetRotationWrtParent(this.handle,e.x,e.y,e.z,e.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return Re.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(e){const t=Re.intoRaw(e);this.colliderSet.raw.coSetHalfExtents(this.handle,t)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(e){this.colliderSet.raw.coSetRadius(this.handle,e)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(e){this.colliderSet.raw.coSetRoundRadius(this.handle,e)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(e){this.colliderSet.raw.coSetHalfHeight(this.handle,e)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let e=this.colliderSet.raw.coHeightfieldScale(this.handle);return Re.fromRaw(e)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(e){let t=Re.intoRaw(e),i=this.colliderSet.raw.coContainsPoint(this.handle,t);return t.free(),i}projectPoint(e,t){let i=Re.intoRaw(e),n=KT.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,i,t));return i.free(),n}intersectsRay(e,t){let i=Re.intoRaw(e.origin),n=Re.intoRaw(e.dir),r=this.colliderSet.raw.coIntersectsRay(this.handle,i,n,t);return i.free(),n.free(),r}castShape(e,t,i,n,r,o,a){let l=Re.intoRaw(e),c=Re.intoRaw(i),h=Ji.intoRaw(n),u=Re.intoRaw(r),f=t.intoRaw(),p=Hx.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,l,f,c,h,u,o,a));return l.free(),c.free(),h.free(),u.free(),f.free(),p}castCollider(e,t,i,n,r){let o=Re.intoRaw(e),a=Re.intoRaw(i),l=wU.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,o,t.handle,a,n,r));return o.free(),a.free(),l}intersectsShape(e,t,i){let n=Re.intoRaw(t),r=Ji.intoRaw(i),o=e.intoRaw(),a=this.colliderSet.raw.coIntersectsShape(this.handle,o,n,r);return n.free(),r.free(),o.free(),a}contactShape(e,t,i,n){let r=Re.intoRaw(t),o=Ji.intoRaw(i),a=e.intoRaw(),l=gb.fromRaw(this.colliderSet.raw.coContactShape(this.handle,a,r,o,n));return r.free(),o.free(),a.free(),l}contactCollider(e,t){return gb.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,e.handle,t))}castRay(e,t,i){let n=Re.intoRaw(e.origin),r=Re.intoRaw(e.dir),o=this.colliderSet.raw.coCastRay(this.handle,n,r,t,i);return n.free(),r.free(),o}castRayAndGetNormal(e,t,i){let n=Re.intoRaw(e.origin),r=Re.intoRaw(e.dir),o=JT.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,n,r,t,i));return n.free(),r.free(),o}}(function(s){s[s.Density=0]="Density",s[s.Mass=1]="Mass",s[s.MassProps=2]="MassProps"})(Cy||(Cy={}));class yn{constructor(e){this.enabled=!0,this.shape=e,this.massPropsMode=Cy.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=Ji.identity(),this.translation=Re.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=rs.Average,this.restitutionCombineRule=rs.Average,this.activeCollisionTypes=IE.DEFAULT,this.activeEvents=TE.NONE,this.activeHooks=mO.NONE,this.mass=0,this.centerOfMass=Re.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=Re.zeros(),this.angularInertiaLocalFrame=Ji.identity()}static ball(e){const t=new SU(e);return new yn(t)}static capsule(e,t){const i=new eX(e,t);return new yn(i)}static segment(e,t){const i=new tX(e,t);return new yn(i)}static triangle(e,t,i){const n=new iX(e,t,i);return new yn(n)}static roundTriangle(e,t,i,n){const r=new nX(e,t,i,n);return new yn(r)}static polyline(e,t){const i=new sX(e,t);return new yn(i)}static trimesh(e,t){const i=new rX(e,t);return new yn(i)}static cuboid(e,t,i){const n=new Zq(e,t,i);return new yn(n)}static roundCuboid(e,t,i,n){const r=new $q(e,t,i,n);return new yn(r)}static heightfield(e,t,i,n){const r=new oX(e,t,i,n);return new yn(r)}static cylinder(e,t){const i=new aX(e,t);return new yn(i)}static roundCylinder(e,t,i){const n=new lX(e,t,i);return new yn(n)}static cone(e,t){const i=new cX(e,t);return new yn(i)}static roundCone(e,t,i){const n=new hX(e,t,i);return new yn(n)}static convexHull(e){const t=new gO(e,null);return new yn(t)}static convexMesh(e,t){const i=new gO(e,t);return new yn(i)}static roundConvexHull(e,t){const i=new yO(e,null,t);return new yn(i)}static roundConvexMesh(e,t,i){const n=new yO(e,t,i);return new yn(n)}setTranslation(e,t,i){if(typeof e!="number"||typeof t!="number"||typeof i!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:t,z:i},this}setRotation(e){return Ji.copy(this.rotation,e),this}setSensor(e){return this.isSensor=e,this}setEnabled(e){return this.enabled=e,this}setDensity(e){return this.massPropsMode=Cy.Density,this.density=e,this}setMass(e){return this.massPropsMode=Cy.Mass,this.mass=e,this}setMassProperties(e,t,i,n){return this.massPropsMode=Cy.MassProps,this.mass=e,Re.copy(this.centerOfMass,t),Re.copy(this.principalAngularInertia,i),Ji.copy(this.angularInertiaLocalFrame,n),this}setRestitution(e){return this.restitution=e,this}setFriction(e){return this.friction=e,this}setFrictionCombineRule(e){return this.frictionCombineRule=e,this}setRestitutionCombineRule(e){return this.restitutionCombineRule=e,this}setCollisionGroups(e){return this.collisionGroups=e,this}setSolverGroups(e){return this.solverGroups=e,this}setActiveHooks(e){return this.activeHooks=e,this}setActiveEvents(e){return this.activeEvents=e,this}setActiveCollisionTypes(e){return this.activeCollisionTypes=e,this}setContactForceEventThreshold(e){return this.contactForceEventThreshold=e,this}}for(var RTe={byteLength:function(s){var e=QV(s),t=e[0],i=e[1];return 3*(t+i)/4-i},toByteArray:function(s){var e,t,i=QV(s),n=i[0],r=i[1],o=new JSe(function(c,h,u){return 3*(h+u)/4-u}(0,n,r)),a=0,l=r>0?n-4:n;for(t=0;t<l;t+=4)e=Na[s.charCodeAt(t)]<<18|Na[s.charCodeAt(t+1)]<<12|Na[s.charCodeAt(t+2)]<<6|Na[s.charCodeAt(t+3)],o[a++]=e>>16&255,o[a++]=e>>8&255,o[a++]=255&e;return r===2&&(e=Na[s.charCodeAt(t)]<<2|Na[s.charCodeAt(t+1)]>>4,o[a++]=255&e),r===1&&(e=Na[s.charCodeAt(t)]<<10|Na[s.charCodeAt(t+1)]<<4|Na[s.charCodeAt(t+2)]>>2,o[a++]=e>>8&255,o[a++]=255&e),o},fromByteArray:function(s){for(var e,t=s.length,i=t%3,n=[],r=16383,o=0,a=t-i;o<a;o+=r)n.push($Se(s,o,o+r>a?a:o+r));return i===1?(e=s[t-1],n.push(yc[e>>2]+yc[e<<4&63]+"==")):i===2&&(e=(s[t-2]<<8)+s[t-1],n.push(yc[e>>10]+yc[e>>4&63]+yc[e<<2&63]+"=")),n.join("")}},yc=[],Na=[],JSe=typeof Uint8Array<"u"?Uint8Array:Array,aB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fg=0,ZSe=aB.length;Fg<ZSe;++Fg)yc[Fg]=aB[Fg],Na[aB.charCodeAt(Fg)]=Fg;function QV(s){var e=s.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=s.indexOf("=");return t===-1&&(t=e),[t,t===e?0:4-t%4]}function $Se(s,e,t){for(var i,n,r=[],o=e;o<t;o+=3)i=(s[o]<<16&16711680)+(s[o+1]<<8&65280)+(255&s[o+2]),r.push(yc[(n=i)>>18&63]+yc[n>>12&63]+yc[n>>6&63]+yc[63&n]);return r.join("")}Na["-".charCodeAt(0)]=62,Na["_".charCodeAt(0)]=63;const eCe=Symbol("object"),lB=new ba(()=>new S,20);class uX{constructor(e,t,i,n,r,o){d(this,"_point");d(this,"_normal");d(this,"_tangentVelocity");d(this,"distance");d(this,"impulse");d(this,"friction");this._point=e,this.distance=t,this._normal=i,this.impulse=n,this.friction=r,this._tangentVelocity=o}get point(){return lB.get().set(this._point.x,this._point.y,this._point.z)}get normal(){return lB.get().set(this._normal.x,this._normal.y,this._normal.z)}get tangentVelocity(){return lB.get().set(this._tangentVelocity.x,this._tangentVelocity.y,this._tangentVelocity.z)}}class dX{constructor(e,t,i){d(this,"contacts");d(this,"me");d(this,"_collider");d(this,"_gameObject");this.me=e,this._collider=t,this._gameObject=t.gameObject,this.contacts=i}get collider(){return this._collider}get gameObject(){return this._gameObject}get rigidBody(){var e;return(e=this.collider)==null?void 0:e.attachedRigidbody}}class fX{constructor(e,t){d(this,"object");d(this,"collider");this.object=e,this.collider=t}}const or=ie("debugphysics"),cB=ie("debugcolliderplacement"),hB=ie("debugcollisions"),tCe=ie("showcolliders"),uB=ie("debugraycasts"),Mo=Symbol("needle component"),so=Symbol("physics body"),WV=Symbol("rigidbody");let tp;globalThis.false=globalThis.false!==void 0?globalThis.false:!0;or&&console.log("Use Rapier",!1,globalThis.false);const b_=class{constructor(){d(this,"debugRenderColliders",!1);d(this,"debugRenderRaycasts",!1);d(this,"context");d(this,"_initializePromise");d(this,"_isInitialized",!1);d(this,"rapierRay",new qSe({x:0,y:0,z:0},{x:0,y:0,z:1}));d(this,"raycastVectorsBuffer",new ba(()=>new S,10));d(this,"rapierSphere",null);d(this,"rapierColliderArray",[]);d(this,"rapierIdentityRotation",{x:0,y:0,z:0,w:1});d(this,"rapierForwardVector",{x:0,y:0,z:1});d(this,"enabled",!1);d(this,"_tempPosition",new S);d(this,"_tempQuaternion",new Ce);d(this,"_tempScale",new S);d(this,"_tempMatrix",new le);d(this,"_isUpdatingPhysicsWorld",!1);d(this,"_world");d(this,"_hasCreatedWorld",!1);d(this,"eventQueue");d(this,"collisionHandler");d(this,"objects",[]);d(this,"bodies",[]);d(this,"_meshCache",new Map);d(this,"_gravity",{x:0,y:-9.81,z:0});d(this,"lines");d(this,"_tempCenterPos",new S);d(this,"_tempCenterVec",new S);d(this,"_tempCenterQuaternion",new Ce)}removeBody(e){var i,n,r;if(!e)return;this.validate();const t=e[so];if(e[so]=null,t&&this.world){const o=this.objects.findIndex(a=>a===e);if(o>=0){const a=this.bodies[o];if(this.bodies.splice(o,1),this.objects.splice(o,1),a instanceof VV){const l=a;(i=this.world)==null||i.removeCollider(l,!0);const c=l.parent();c&&c.numColliders()<=0&&(c[Mo]||(n=this.world)==null||n.removeRigidBody(c))}else a instanceof HV&&(a.numColliders()<=0?(r=this.world)==null||r.removeRigidBody(a):nt()&&(a.did_log_removing||setTimeout(()=>{a.numColliders()>0&&(a.did_log_removing=!0,console.warn("RapierPhysics: removing rigidbody with colliders from the physics world is not possible right now, please remove the colliders first"))},1)))}}}updateBody(e,t,i){if(this.validate(),!!this.enabled&&!(e.destroyed||!e.gameObject)&&!(!t&&!i))if(e.isCollider===!0)console.warn("TODO: implement updating collider position");else{const n=e,r=n[so];r&&this.syncPhysicsBody(n.gameObject,r,t,i)}}updateProperties(e){if(this.validate(),e.isCollider){const t=e,i=t[so];i&&(this.internalUpdateColliderProperties(t,i),t.sharedMaterial&&this.updatePhysicsMaterial(t))}else{const t=e,i=this.internal_getRigidbody(t);i&&this.internalUpdateRigidbodyProperties(t,i)}}addForce(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.addForce(t,i):console.warn("Rigidbody doesn't exist: can not apply force")}addImpulse(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.applyImpulse(t,i):console.warn("Rigidbody doesn't exist: can not apply impulse")}getLinearVelocity(e){this.validate();const t=this.internal_getRigidbody(e);return t?t.linvel():null}getAngularVelocity(e){this.validate();const t=this.internal_getRigidbody(e);return t?t.angvel():null}resetForces(e,t){this.validate();const i=this.internal_getRigidbody(e);i==null||i.resetForces(t)}resetTorques(e,t){this.validate();const i=this.internal_getRigidbody(e);i==null||i.resetTorques(t)}applyImpulse(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.applyImpulse(t,i):console.warn("Rigidbody doesn't exist: can not apply impulse")}wakeup(e){this.validate();const t=this.internal_getRigidbody(e);t?t.wakeUp():console.warn("Rigidbody doesn't exist: can not wake up")}isSleeping(e){this.validate();const t=this.internal_getRigidbody(e);return t==null?void 0:t.isSleeping()}setAngularVelocity(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.setAngvel(t,i):console.warn("Rigidbody doesn't exist: can not set angular velocity")}setLinearVelocity(e,t,i){this.validate();const n=this.internal_getRigidbody(e);n?n.setLinvel(t,i):console.warn("Rigidbody doesn't exist: can not set linear velocity")}async initialize(e){return this.context=e,this._initializePromise||(this._initializePromise=this.internalInitialization()),this._initializePromise}async internalInitialization(){return or&&console.log("Initialize rapier physics engine"),"env"in{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:VU&&VU.src||new URL("dist/needle-engine.light.umd.cjs",document.baseURI).href}&&{}.VITE_NEEDLE_USE_RAPIER==="false"&&or&&console.log("Rapier disabled"),!1}validate(){this._isInitialized||or&&(this._lastWarnTime=this._lastWarnTime??0,Date.now()-this._lastWarnTime>1e3&&(this._lastWarnTime=Date.now(),console.warn("Physics engine is not initialized")))}raycast(e,t,i){var l;let n=i==null?void 0:i.maxDistance,r=i==null?void 0:i.solid;n===void 0&&(n=1/0),r===void 0&&(r=!0);const o=this.getPhysicsRay(this.rapierRay,e,t);if(!o)return null;(this.debugRenderRaycasts||uB)&&_t.DrawRay(o.origin,o.dir,255,1);const a=(l=this.world)==null?void 0:l.castRay(o,n,r,i==null?void 0:i.queryFilterFlags,i==null?void 0:i.filterGroups,void 0,void 0,c=>{const h=c[Mo];return i!=null&&i.filterPredicate?i.filterPredicate(h):(i==null?void 0:i.useIgnoreRaycastLayer)!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(a){const c=o.pointAt(a.toi),h=this.raycastVectorsBuffer.get();return h.set(c.x,c.y,c.z),{point:h,collider:a.collider[Mo]}}return null}raycastAndGetNormal(e,t,i){var l;let n=i==null?void 0:i.maxDistance,r=i==null?void 0:i.solid;n===void 0&&(n=1/0),r===void 0&&(r=!0);const o=this.getPhysicsRay(this.rapierRay,e,t);if(!o)return null;(this.debugRenderRaycasts||uB)&&_t.DrawRay(o.origin,o.dir,255,1);const a=(l=this.world)==null?void 0:l.castRayAndGetNormal(o,n,r,i==null?void 0:i.queryFilterFlags,i==null?void 0:i.filterGroups,void 0,void 0,c=>{const h=c[Mo];return i!=null&&i.filterPredicate?i.filterPredicate(h):(i==null?void 0:i.useIgnoreRaycastLayer)!==!1?!(h!=null&&h.gameObject.layers.isEnabled(2)):!0});if(a){const c=o.pointAt(a.toi),h=a.normal,u=this.raycastVectorsBuffer.get(),f=this.raycastVectorsBuffer.get();return u.set(c.x,c.y,c.z),f.set(h.x,h.y,h.z),{point:u,normal:f,collider:a.collider[Mo]}}return null}getPhysicsRay(e,t,i){var a,l,c;const n=(a=this.context)==null?void 0:a.mainCamera;if(t===void 0){const h=(l=this.context)==null?void 0:l.input.getPointerPosition(0);if(h)t=h;else return null}if(t.z===void 0){if(!n)return console.error("Can not perform raycast from 2d point - no main camera found"),null;const h=this.raycastVectorsBuffer.get();h.x=t.x,h.y=t.y,h.z=0,(h.x>1||h.y>1||h.y<-1||h.x<-1)&&(or&&console.warn("Converting screenspace to raycast space",h),(c=this.context)==null||c.input.convertScreenspaceToRaycastSpace(h)),h.unproject(n),t=h}const r=t;e.origin.x=r.x,e.origin.y=r.y,e.origin.z=r.z;const o=this.raycastVectorsBuffer.get();if(i)o.set(i.x,i.y,i.z);else{if(!n)return console.error("Can not perform raycast - no camera found"),null;o.set(e.origin.x,e.origin.y,e.origin.z);const h=Ft(n);o.sub(h)}return o.normalize(),e.dir.x=o.x,e.dir.y=o.y,e.dir.z=o.z,e}sphereOverlap(e,t){return this.rapierColliderArray.length=0,this.world?(this.rapierSphere||(this.rapierSphere=new SU(t)),this.rapierSphere.radius=t,(this.debugRenderRaycasts||uB)&&_t.DrawWireSphere(e,t,3359999,1),this.world.intersectionsWithShape(e,this.rapierIdentityRotation,this.rapierSphere,i=>{const n=i[Mo],r=new fX(n.gameObject,n);return this.rapierColliderArray.push(r),!0},void 0,void 0,void 0,void 0,i=>i.isSensor()?!1:i[Mo].gameObject.layers.isEnabled(2)==!1),this.rapierColliderArray):this.rapierColliderArray}get world(){return this._world}get isUpdating(){return this._isUpdatingPhysicsWorld}get gravity(){var e;return((e=this.world)==null?void 0:e.gravity)??this._gravity}set gravity(e){this.world?this.world.gravity=e:this._gravity=e}clearCaches(){var e,t,i,n;this._meshCache.clear(),(e=this.eventQueue)!=null&&e.raw&&((t=this.eventQueue)==null||t.free()),(i=this.world)!=null&&i.bodies&&((n=this.world)==null||n.free())}async addBoxCollider(e,t){if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){or&&console.warn("Physics are disabled");return}const i=e.gameObject,n=$i(i,this._tempPosition).multiply(t);n.multiplyScalar(.5),n.x<0&&(n.x=Math.abs(n.x)),n.y<0&&(n.y=Math.abs(n.y)),n.z<0&&(n.z=Math.abs(n.z)),n.x==0&&(n.x=1e-7),n.y==0&&(n.y=1e-7),n.z==0&&(n.z=1e-7);const r=yn.cuboid(n.x,n.y,n.z);this.createCollider(e,r)}async addSphereCollider(e){if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){or&&console.warn("Physics are disabled");return}const t=yn.ball(.5);this.createCollider(e,t),this.updateProperties(e)}async addCapsuleCollider(e,t,i){if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){or&&console.warn("Physics are disabled");return}const n=e.gameObject,r=$i(n,this._tempPosition);r.x=Math.abs(r.x),r.y=Math.abs(r.y);const o=i*r.x;t=Math.max(t,o*2);const a=it.clamp(t*.5*r.y-i*r.x,0,Number.MAX_SAFE_INTEGER),l=yn.capsule(a,o);this.createCollider(e,l)}async addMeshCollider(e,t,i,n){var c,h,u;if(this._isInitialized||await this.initialize(e.context),!e.activeAndEnabled)return;if(!this.enabled){or&&console.warn("Physics are disabled");return}let r=t.geometry;if(!r){or&&console.warn("Missing mesh geometry",t.name);return}(h=(c=r.index)==null?void 0:c.array)!=null&&h.length||(console.warn(`Your MeshCollider is missing vertices or indices in the assined mesh "${t.name}". Consider providing an indexed geometry.`),r=Mme(r));let o=r.getAttribute("position").array;const a=(u=r.index)==null?void 0:u.array;if(Math.abs(n.x-1)>1e-4||Math.abs(n.y-1)>1e-4||Math.abs(n.z-1)>1e-4){const f=r.uuid+"_"+n.x+"_"+n.y+"_"+n.z+"_"+i;if(this._meshCache.has(f))or&&console.warn("Use cached mesh collider"),o=this._meshCache.get(f);else{(or||nt())&&console.warn(`Your MeshCollider "${e.name}" is scaled: consider applying the scale to the collider mesh instead (${n.x}, ${n.y}, ${n.z})`);const p=new Float32Array(o.length);for(let m=0;m<o.length;m+=3)p[m]=o[m]*n.x,p[m+1]=o[m+1]*n.y,p[m+2]=o[m+2]*n.z;o=p,this._meshCache.set(f,p)}}const l=i?yn.convexHull(o):yn.trimesh(o,a);l&&this.createCollider(e,l)}updatePhysicsMaterial(e){if(!e)return;const t=e.sharedMaterial,i=e[so];if(i&&t){if(t.bounciness!==void 0&&i.setRestitution(t.bounciness),t.bounceCombine!==void 0)switch(t.bounceCombine){case ks.Average:i.setRestitutionCombineRule(rs.Average);break;case ks.Maximum:i.setRestitutionCombineRule(rs.Max);break;case ks.Minimum:i.setRestitutionCombineRule(rs.Min);break;case ks.Multiply:i.setRestitutionCombineRule(rs.Multiply);break}if(t.dynamicFriction!==void 0&&i.setFriction(t.dynamicFriction),t.frictionCombine!==void 0)switch(t.frictionCombine){case ks.Average:i.setFrictionCombineRule(rs.Average);break;case ks.Maximum:i.setFrictionCombineRule(rs.Max);break;case ks.Minimum:i.setFrictionCombineRule(rs.Min);break;case ks.Multiply:i.setFrictionCombineRule(rs.Multiply);break}}}getBody(e){return e?e[so]:null}getComponent(e){return e?e[Mo]:null}createCollider(e,t){var o;if(!this.world)throw new Error("Physics world not initialized");const i=this._tempMatrix;let n;e.attachedRigidbody?n=this.getRigidbody(e,this._tempMatrix):(or&&console.log("Create collider without rigidbody",e.name),i.makeRotationFromQuaternion(ki(e.gameObject)),i.setPosition(Ft(e.gameObject))),i.decompose(this._tempPosition,this._tempQuaternion,this._tempScale),this.tryApplyCenter(e,this._tempPosition),t.setTranslation(this._tempPosition.x,this._tempPosition.y,this._tempPosition.z),t.setRotation(this._tempQuaternion),t.setSensor(e.isTrigger);const r=e.sharedMaterial;if(r){if(r.bounciness!==void 0&&t.setRestitution(r.bounciness),r.bounceCombine!==void 0)switch(r.bounceCombine){case ks.Average:t.setRestitutionCombineRule(rs.Average);break;case ks.Maximum:t.setRestitutionCombineRule(rs.Max);break;case ks.Minimum:t.setRestitutionCombineRule(rs.Min);break;case ks.Multiply:t.setRestitutionCombineRule(rs.Multiply);break}if(r.dynamicFriction!==void 0&&t.setFriction(r.dynamicFriction),r.frictionCombine!==void 0)switch(r.frictionCombine){case ks.Average:t.setFrictionCombineRule(rs.Average);break;case ks.Maximum:t.setFrictionCombineRule(rs.Max);break;case ks.Minimum:t.setFrictionCombineRule(rs.Min);break;case ks.Multiply:t.setFrictionCombineRule(rs.Multiply);break}}((o=e.attachedRigidbody)==null?void 0:o.autoMass)===!1&&(t.setDensity(1e-6),t.setMass(1e-6));try{const a=this.world.createCollider(t,n);return a[Mo]=e,e[so]=a,a.setActiveEvents(TE.COLLISION_EVENTS),a.setActiveCollisionTypes(IE.ALL),this.objects.push(e),this.bodies.push(a),this.updateColliderCollisionGroups(e),a}catch(a){return console.error('Error creating collider "'+e.name+`"
Error:`,a),null}}updateColliderCollisionGroups(e){const t=e[so],i=e.membership;let n=0;if(i==null)n=65535;else for(let a=0;a<i.length;a++){const l=i[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):n|=1<<Math.floor(l)}const r=e.filter;let o=0;if(r==null)o=65535;else for(let a=0;a<r.length;a++){const l=r[a];l>31?console.error(`Rapier only supports 32 layers, layer ${l} is not supported`):o|=1<<Math.floor(l)}t.setCollisionGroups(n<<16|o)}getRigidbody(e,t){if(!this.world)throw new Error("Physics world not initialized");let i=null;if(e.attachedRigidbody){const n=e.attachedRigidbody;if(i=n[so],!i){const r=n.isKinematic&&!cB;or&&console.log("Create rigidbody",r);const o=r?tp.RigidBodyDesc.kinematicPositionBased():tp.RigidBodyDesc.dynamic(),a=Ft(e.attachedRigidbody.gameObject);o.setTranslation(a.x,a.y,a.z),o.setRotation(ki(e.attachedRigidbody.gameObject)),o.centerOfMass=new tp.Vector3(n.centerOfMass.x,n.centerOfMass.y,n.centerOfMass.z),i=this.world.createRigidBody(o),this.bodies.push(i),this.objects.push(n)}i[Mo]=n,n[so]=i,this.internalUpdateRigidbodyProperties(n,i),this.getRigidbodyRelativeMatrix(e.gameObject,n.gameObject,t),e[WV]=i}else{const n=tp.RigidBodyDesc.kinematicPositionBased(),r=Ft(e.gameObject);n.setTranslation(r.x,r.y,r.z),n.setRotation(ki(e.gameObject)),i=this.world.createRigidBody(n),t.identity(),i[Mo]=null}return i}internal_getRigidbody(e){return e.isCollider===!0?e[WV]:e[so]}internalUpdateColliderProperties(e,t){const i=t.shape;let n=!1;switch(i.type){case es.Ball:{const f=i,p=e,m=e.gameObject,v=$i(m,this._tempPosition),g=Math.abs(p.radius*v.x);n=f.radius!==g,f.radius=g,n&&t.setShape(f);break}case es.Cuboid:const r=i,o=e,a=e.gameObject,l=$i(a,this._tempPosition),c=o.size.x*.5*l.x,h=o.size.y*.5*l.y,u=o.size.z*.5*l.z;n=r.halfExtents.x!==c||r.halfExtents.y!==h||r.halfExtents.z!==u,r.halfExtents.x=c,r.halfExtents.y=h,r.halfExtents.z=u,n&&t.setShape(r);break}if(n){const r=e.attachedRigidbody;if(r!=null&&r.autoMass){const o=this.getBody(r);o==null||o.recomputeMassPropertiesFromColliders()}}this.updateColliderCollisionGroups(e),e.isTrigger!==t.isSensor()&&t.setSensor(e.isTrigger)}internalUpdateRigidbodyProperties(e,t){if(t.enableCcd(e.collisionDetectionMode!==aT.Discrete),t.setLinearDamping(e.drag),t.setAngularDamping(e.angularDrag),t.setGravityScale(e.useGravity?e.gravityScale:0,!0),e.dominanceGroup<=127&&e.dominanceGroup>=-127?t.setDominanceGroup(Math.floor(e.dominanceGroup)):t.setDominanceGroup(0),e.autoMass){t.setAdditionalMass(0,!1);for(let i=0;i<t.numColliders();i++)t.collider(i).setDensity(1);t.recomputeMassPropertiesFromColliders()}else{t.setAdditionalMass(e.mass,!1);for(let i=0;i<t.numColliders();i++)t.collider(i).setDensity(1e-7);t.recomputeMassPropertiesFromColliders()}t.setEnabledRotations(!e.lockRotationX,!e.lockRotationY,!e.lockRotationZ,!1),t.setEnabledTranslations(!e.lockPositionX,!e.lockPositionY,!e.lockPositionZ,!1),e.isKinematic?t.setBodyType(tp.RigidBodyType.KinematicPositionBased,!1):t.setBodyType(tp.RigidBodyType.Dynamic,!1)}step(e){if(this.world&&this.enabled){if(this._isUpdatingPhysicsWorld=!0,this.eventQueue||(this.eventQueue=new KSe(!1)),e===void 0||e<=0){this._isUpdatingPhysicsWorld=!1;return}else e!==void 0&&(this.world.timestep=it.lerp(this.world.timestep,e,.8));try{this.world.step(this.eventQueue)}catch(t){console.warn("Error running physics step",t)}this._isUpdatingPhysicsWorld=!1}}postStep(){this.world&&this.enabled&&(this._isUpdatingPhysicsWorld=!0,this.syncObjects(),this._isUpdatingPhysicsWorld=!1,this.eventQueue&&!this.collisionHandler&&(this.collisionHandler=new iCe(this.world,this.eventQueue)),this.collisionHandler&&(this.collisionHandler.handleCollisionEvents(),this.collisionHandler.update()),this.updateDebugRendering(this.world))}updateDebugRendering(e){var t,i,n,r;if(or||cB||tCe||this.debugRenderColliders===!0){if(!this.lines){const a=new ji({color:7855479,fog:!1}),l=new yt;this.lines=new jr(l,a),this.lines.layers.disableAll(),this.lines.layers.enable(2)}this.lines.parent!==((t=this.context)==null?void 0:t.scene)&&((i=this.context)==null||i.scene.add(this.lines));const o=e.debugRender();this.lines.geometry.setAttribute("position",new Ke(o.vertices,3)),this.lines.geometry.setAttribute("color",new Ke(o.colors,4)),(this.context.time.frame%30===0||((n=this.lines.geometry.boundingSphere)==null?void 0:n.radius)===0)&&this.lines.geometry.computeBoundingSphere()}else this.lines&&((r=this.context)==null||r.scene.remove(this.lines))}syncObjects(){if(!cB)for(let e=0;e<this.bodies.length;e++){const t=this.objects[e],i=this.bodies[e],n=t;if((n==null?void 0:n.isCollider)===!0&&!n.attachedRigidbody){const l=i.parent();l?this.syncPhysicsBody(t.gameObject,l,!0,!0):this.syncPhysicsBody(t.gameObject,i,!0,!0);continue}const r=i.translation(),o=i.rotation();if(Number.isNaN(r.x)||Number.isNaN(o.x)){!n.__COLLIDER_NAN&&nt()&&(console.warn("Collider has NaN values",n.name,n.gameObject,i),n.__COLLIDER_NAN=!0);continue}const a=t.center;if(a&&a.isVector3){this._tempQuaternion.set(o.x,o.y,o.z,o.w);const l=this._tempPosition.copy(a).applyQuaternion(this._tempQuaternion),c=$i(t.gameObject);l.multiply(c),r.x-=l.x,r.y-=l.y,r.z-=l.z}rm(t.gameObject,r.x,r.y,r.z),ZL(t.gameObject,o.x,o.y,o.z,o.w)}}syncPhysicsBody(e,t,i,n){if(t instanceof HV){const r=Ft(e,this._tempPosition),o=ki(e,this._tempQuaternion);switch(t.bodyType()){case m_.Fixed:case m_.KinematicPositionBased:case m_.KinematicVelocityBased:i&&t.setNextKinematicTranslation(r),n&&t.setNextKinematicRotation(o);break;default:i&&t.setTranslation(r,!1),n&&t.setRotation(o,!1);break}}else if(t instanceof VV){e.matrixWorldNeedsUpdate&&e.updateWorldMatrix(!0,!1),e.matrixWorld.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=this._tempPosition,o=this._tempQuaternion,a=t[Mo];if(this.tryApplyCenter(a,r),i){const l=t.translation();(l.x!==r.x||l.y!==r.y||l.z!==r.z)&&t.setTranslation(r)}if(n){const l=t.rotation();(l.x!==o.x||l.y!==o.y||l.z!==o.z||l.w!==o.w)&&t.setRotation(o)}}}tryApplyCenter(e,t){const i=e.center;i&&e.gameObject&&(i.x!==0||i.y!==0||i.z!==0)&&(this._tempCenterPos.x=i.x,this._tempCenterPos.y=i.y,this._tempCenterPos.z=i.z,$i(e.gameObject,this._tempCenterVec),this._tempCenterPos.multiply(this._tempCenterVec),e.attachedRigidbody?this._tempCenterPos.applyQuaternion(e.gameObject.quaternion):(ki(e.gameObject,this._tempCenterQuaternion),this._tempCenterPos.applyQuaternion(this._tempCenterQuaternion)),t.x+=this._tempCenterPos.x,t.y+=this._tempCenterPos.y,t.z+=this._tempCenterPos.z)}getRigidbodyRelativeMatrix(e,t,i,n){if(n===void 0&&(n=b_._matricesBuffer,n.length=0),e===t){const r=$i(e,this._tempPosition);i.makeScale(r.x,r.y,r.z);for(let o=n.length-1;o>=0;o--)i.multiply(n[o]);return i}return n.push(e.matrix),e.parent&&this.getRigidbodyRelativeMatrix(e.parent,t,i,n),i}addFixedJoint(e,t){if(!this.world){console.error("Physics world not initialized");return}const i=e[so],n=t[so];this.calculateJointRelativeMatrices(e.gameObject,t.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const r=Oh.fixed(b_.centerConnectionPos,b_.centerConnectionRot,this._tempPosition,this._tempQuaternion),o=this.world.createImpulseJoint(r,i,n,!0);or&&console.log("ADD FIXED JOINT",o)}addHingeJoint(e,t,i,n){if(!this.world){console.error("Physics world not initialized");return}const r=e[so],o=t[so];this.calculateJointRelativeMatrices(e.gameObject,t.gameObject,this._tempMatrix),this._tempMatrix.decompose(this._tempPosition,this._tempQuaternion,this._tempScale);const a=tp.JointData.revolute(i,this._tempPosition,n),l=this.world.createImpulseJoint(a,r,o,!0);or&&console.log("ADD HINGE JOINT",l)}calculateJointRelativeMatrices(e,t,i){e.updateWorldMatrix(!0,!1),t.updateWorldMatrix(!0,!1);const n=e.matrixWorld,r=t.matrixWorld;n.elements[0]=1,n.elements[5]=1,n.elements[10]=1,r.elements[0]=1,r.elements[5]=1,r.elements[10]=1,i.copy(r).premultiply(n.invert()).invert()}};let hp=b_;d(hp,"_didLoadPhysicsEngine",!1),d(hp,"_matricesBuffer",[]),d(hp,"centerConnectionPos",{x:0,y:0,z:0}),d(hp,"centerConnectionRot",{x:0,y:0,z:0,w:1});class iCe{constructor(e,t){d(this,"world");d(this,"eventQueue");d(this,"activeCollisions",[]);d(this,"activeCollisionsStay",[]);d(this,"activeTriggers",[]);this.world=e,this.eventQueue=t}handleCollisionEvents(){this.eventQueue&&this.world&&this.eventQueue.drainCollisionEvents((e,t,i)=>{const n=this.world.getCollider(e),r=this.world.getCollider(t);if(!n||!r)return;const o=n[Mo],a=r[Mo];hB&&console.log("EVT",o.name,a.name,i,n,r),o&&a&&(i?(this.onCollisionStarted(o,n,a,r),this.onCollisionStarted(a,r,o,n)):(this.onCollisionEnded(o,a),this.onCollisionEnded(a,o)))})}update(){this.onHandleCollisionStay()}onCollisionStarted(e,t,i,n){let r=null;if(e.isTrigger||i.isTrigger)lm(e.gameObject,o=>{o.onTriggerEnter&&!o.destroyed&&o.onTriggerEnter(i),this.activeTriggers.push({collider:e,component:o,otherCollider:i})});else{const o=e.gameObject;this.world.contactPair(t,n,(a,l)=>{lm(o,c=>{var u;if(c.destroyed)return;const h=c.onCollisionEnter||c.onCollisionStay||c.onCollisionExit;if(h||hB){if(!r){const f=[],p=a.normal();for(let m=0;m<a.numSolverContacts();m++){const v=a.solverContactPoint(m),g=a.contactImpulse(m);if(v){const y=a.contactDist(m),A=a.solverContactFriction(m),_=a.solverContactTangentVelocity(m),b=new uX(v,y,p,g,A,_);f.push(b),hB&&_t.DrawDirection(v,p,16711680,3,!0)}}r=new dX(o,i,f)}if(h){const f={collider:e,component:c,collision:r};this.activeCollisions.push(f),c.onCollisionStay&&this.activeCollisionsStay.push(f),(u=c.onCollisionEnter)==null||u.call(c,r)}}})})}}onHandleCollisionStay(){for(const e of this.activeCollisionsStay){const t=e.component;if(!t.destroyed&&t.activeAndEnabled&&t.onCollisionStay){if(e.collision.collider.destroyed)continue;const i=e.collision;t.onCollisionStay(i)}}for(const e of this.activeTriggers){const t=e.component;if(!t.destroyed&&t.activeAndEnabled&&t.onTriggerStay){const i=e.otherCollider;if(i.destroyed)continue;t.onTriggerStay(i)}}}onCollisionEnded(e,t){if(!(e.destroyed||t.destroyed)){for(let i=0;i<this.activeCollisions.length;i++){const n=this.activeCollisions[i],r=n.collider;if(r.destroyed||n.collision.collider.destroyed){this.activeCollisions.splice(i,1),i--;continue}if(r===e&&n.collision.collider===t){const o=n.component;if(this.activeCollisions.splice(i,1),i--,o.activeAndEnabled&&o.onCollisionExit){const a=n.collision;o.onCollisionExit(a)}}}for(let i=0;i<this.activeCollisionsStay.length;i++){const n=this.activeCollisionsStay[i],r=n.collider;if(r.destroyed||n.collision.collider.destroyed){this.activeCollisionsStay.splice(i,1),i--;continue}if(r===e&&n.collision.collider===t){const o=n.component;if(this.activeCollisionsStay.splice(i,1),i--,o.activeAndEnabled&&o.onCollisionExit){const a=n.collision;o.onCollisionExit(a)}}}for(let i=0;i<this.activeTriggers.length;i++){const n=this.activeTriggers[i],r=n.collider;if(r.destroyed||n.otherCollider.destroyed){this.activeTriggers.splice(i,1),i--;continue}if(r===e&&n.otherCollider===t){const o=n.component;if(this.activeTriggers.splice(i,1),i--,o.activeAndEnabled&&o.onTriggerExit){const a=n.otherCollider;o.onTriggerExit(a)}}}}}}class nCe{static async createComparisonScene(e){const{files:t}=e,n=await Promise.all(t.map(g=>new ei(g).loadAssetAsync())),r=new Ws;let o=0;for(const g of n)if(g instanceof ye){g.position.y=o,r.add(g);const y=Hl([g]);o+=y.getSize(new S).y,o+=.1}const a=new Vt(20);r.add(a);const l=e.environment||"https://dl.polyhaven.org/file/ph-assets/HDRIs/exr/1k/studio_small_09_1k.exr";if(l){let g=null;if(l.endsWith(".hdr")){const y=(await Promise.resolve().then(()=>Rpe)).RGBELoader;g=new y}else if(l.endsWith(".exr")){const y=(await Promise.resolve().then(()=>Ipe)).EXRLoader;g=new y}if(g){const y=await g.loadAsync(l).catch(A=>(console.error(A),null));y&&(y.mapping=mo,y.needsUpdate=!0,r.background=y,r.environment=y,r.backgroundBlurriness=.75)}else console.warn("Unsupported environment map format",l)}const c=Hl(r.children),h=c.getCenter(new S),u=c.getSize(new S),p=Math.max(u.x,u.y,u.z)/(2*Math.tan(Math.PI*a.fov/360));a.position.set(h.x,h.y,p),a.lookAt(h);const m=new E7(a,e.domElement||document.body);m.target=h,m.update();const v=(e.domElement||document.body).getBoundingClientRect();return a.aspect=v.width/v.height,a.updateProjectionMatrix(),{scene:r,camera:a}}}function sCe(s,e,t,i="image/webp",n){return pX({context:s,width:e,height:t,mimeType:i,camera:n})}function pX(s={mimeType:"image/png",transparent:!1}){s||(s={});let{context:e,width:t,height:i,camera:n}=s;const{mimeType:r}=s;if(!e&&(e=mi.Current,!e))return console.error("Can not save screenshot: No needle-engine context found or provided."),null;if(!n&&(n=e.mainCamera,!n))return console.error("No camera found"),null;const o=e.renderer.domElement.width,a=e.renderer.domElement.height;t||(t=o),i||(i=a);const l=window.devicePixelRatio||1;t/=l,i/=l,e.renderer.domElement.style.width=t+"px",e.renderer.domElement.style.height=i+"px";const c=e.renderer.getClearColor(new Ae),h=e.renderer.getClearAlpha();try{s!=null&&s.transparent&&e.renderer.setClearColor(0,0);const u=e.renderer.domElement;e.renderer.setSize(t,i,!1),n instanceof Vt&&e.updateAspect(n,t,i);const f=s.render_events!==!1,p=new Array;f&&(Rv(e.scene,Vn,p),p.forEach(v=>v==null?void 0:v.onBeforeRender())),e.renderNow(),f&&p.forEach(v=>v.onAfterRender());const m=u.toDataURL(r);return s.download_filename&&mX(m,s.download_filename),m}finally{e.renderer.setSize(o,a,!1),e.updateSize(),e.renderer.setClearColor(c,h)}return null}let nA=null;function mX(s,e){if(s){if(!s.startsWith("data:image")){console.error("Can not save image: Data url is not an image",s);return}nA||(nA=document.createElement("a")),nA.href=s,nA.download=e,nA.click()}}let vO=0;function jV(s){s?vO++:vO--}function rCe(){return vO>0}class gX{constructor(e){d(this,"writer");this.writer=e}writeNode(e){}}class oCe extends gX{beforeWriteNode(e,t){_t.isGizmo(e)&&(t.keep=!1)}}class aCe extends gX{beforeWriteTexture(e,t){e.isRenderTargetTexture&&(t.newTexture=tF(new Ui(1,1,1,0)))}}const lCe={binary:!0,animations:!0};async function cCe(s){if(!s.context)throw new Error("No context provided to exportAsGLTF");s.scene||(s.scene=s.context.scene);const e={...lCe,...s},{context:t}=e,i=new PT;i.register(a=>new pq(a)),i.register(a=>new oCe(a)),i.register(a=>new aCe(a)),FF(i,e.context);const n={binary:e.binary,animations:uCe(t,e.scene,[])},r=new hCe;console.log("Exporting GLTF",n),r.onBeforeExport(e),jV(!0);const o=await i.parseAsync(e.scene,n).catch(a=>(console.error(a),null));if(jV(!1),r.onAfterExport(e),!o)throw new Error("Failed to export GLTF");if(e.downloadAs!=null){let a=null;if(o instanceof ArrayBuffer?a=new Blob([o],{type:"application/octet-stream"}):console.error("Can not download GLTF as a blob",o),a){const l=URL.createObjectURL(a),c=document.createElement("a");c.href=l;let h=e.downloadAs;!h.endsWith(".glb")&&!h.endsWith(".gltf")&&(h+=e.binary?".glb":".gltf"),c.download=h,c.click()}}return o}const qV=Symbol("needle:weight");class hCe{constructor(){d(this,"_undo",[])}onBeforeExport(e){e.context.animations.mixers.forEach(t=>{const i=uv.tryGetActionsFromMixer(t);if(i)for(let n=0;n<i.length;n++){const r=i[n];r[qV]=r.weight,r.weight=0,this._undo.push(()=>{r.weight=r[qV]})}t.update(0)})}onAfterExport(e){this._undo.forEach(t=>t()),this._undo.length=0}}function uCe(s,e,t){s.animations.mixers.forEach(n=>{const r=uv.tryGetActionsFromMixer(n);if(r)for(let o=0;o<r.length;o++){const l=r[o].getClip();t.push(l)}}),Array.isArray(e)||(e=[e]);for(const n of e)uv.tryGetAnimationClipsFromObjectHierarchy(n,t);const i=new Set(t);return Array.from(i)}const XV="needle-button",dB=nt();var Mp,Tp,Ip,lo,Uh,jy,NE,yX,zE,vX,_b;class CU extends HTMLElement{constructor(){super();qo(this,NE);qo(this,zE);qo(this,Mp,void 0);qo(this,Tp,void 0);qo(this,Ip,void 0);qo(this,lo,void 0);qo(this,Uh,void 0);qo(this,jy,void 0);qo(this,_b,t=>{dB&&console.log("Needle Button clicked"),!t.defaultPrevented&&pi(this,lo)&&pi(this,lo).click()});this.removeEventListener("click",pi(this,_b)),this.addEventListener("click",pi(this,_b))}attributeChangedCallback(t,i,n){Cf(this,NE,yX).call(this)}}Mp=new WeakMap,Tp=new WeakMap,Ip=new WeakMap,lo=new WeakMap,Uh=new WeakMap,jy=new WeakMap,NE=new WeakSet,yX=function(){var i,n;if((i=pi(this,lo))==null||i.remove(),this.getAttribute("ar")!=null)pi(this,Uh)??ml(this,Uh,new nu),ml(this,lo,pi(this,Uh).createARButton());else if(this.getAttribute("vr")!=null)pi(this,Uh)??ml(this,Uh,new nu),ml(this,lo,pi(this,Uh).createVRButton());else if(this.getAttribute("quicklook")!=null)pi(this,Uh)??ml(this,Uh,new nu),ml(this,lo,pi(this,Uh).createQuicklookButton());else{dB?console.warn("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute."):console.debug("No button type specified for <needle-button>. Use either ar, vr or quicklook attribute.");return}pi(this,Mp)??ml(this,Mp,this.attachShadow({mode:"open"})),pi(this,Tp)??ml(this,Tp,document.createElement("slot")),pi(this,Ip)??ml(this,Ip,document.createElement("style")),pi(this,Ip).innerHTML=`
            button {
                all: initial;
                cursor: inherit;
                color: inherit;
                font-family: inherit;
                gap: inherit;
                white-space: nowrap;
            }
        `,this.getAttribute("unstyled")!=null||(pi(this,Ip).innerHTML+=`
            :host {
                display: inline-block;
                background: rgba(255, 255, 255, .8);
                backdrop-filter: blur(10px);
                width: fit-content;
                transition: background .2s;

                cursor: pointer;
                padding: 0.4rem .5rem;
                border-radius: 0.8rem;
                color: black;
                background: rgba(245, 245, 245, .8);
                outline: rgba(0,0,0,.05) 1px solid;
            }
            :host(:hover) {
                background: rgba(255, 255, 255, 1);
                transition: background .2s;
            }
            slot {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: .5rem;
            }
`),pi(this,Tp).innerHTML=pi(this,lo).innerHTML,pi(this,Tp).style.cssText="display: flex; align-items: center; justify-content: center;",pi(this,lo).innerHTML=pi(this,Tp).outerHTML,pi(this,Mp).innerHTML=pi(this,lo).outerHTML,pi(this,Mp).prepend(pi(this,Ip)),gE(DD,{element:pi(this,Mp)}),(n=pi(this,jy))==null||n.disconnect(),pi(this,jy)??ml(this,jy,new MutationObserver(()=>Cf(this,zE,vX).call(this))),pi(this,jy).observe(pi(this,lo),{attributes:!0}),dB&&console.log("Needle Button updated")},zE=new WeakSet,vX=function(){pi(this,lo)&&(pi(this,lo).style.display==="none"?this.style.display="none":this.style.display==="none"&&(this.style.display=""))},_b=new WeakMap,d(CU,"observedAttributes",["ar","vr","quicklook"]);typeof window<"u"&&!window.customElements.get(XV)&&window.customElements.define(XV,CU);const RE=ie("debugmissingcamera");mi.registerCallback(Ti.MissingCamera,s=>{var a,l,c;RE&&console.warn("Creating missing camera");const e=s.context.scene,t=new Vt;t.name="Default Fallback Camera",e.add(t);const i=new Hi;i.sourceId=((l=(a=s.files)==null?void 0:a[0])==null?void 0:l.src)??"unknown",(c=s.context.domElement.getAttribute("skybox-image"))!=null&&c.length||0>0||s.context.lightmaps.tryGetSkybox(i.sourceId)?i.clearFlags=kd.Skybox:i.clearFlags=kd.SolidColor,i.backgroundColor=new Ui(.5,.5,.5,1),i.fieldOfView=35,s.context.domElement.getAttribute("transparent")!=null&&(i.clearFlags=kd.Uninitialized),i.backgroundBlurriness=.2;const r=zp(t,i,!0);t.position.x=0,t.position.y=1,t.position.z=2;const o=s.context.domElement;return(o==null?void 0:o.cameraControls)!=!1&&AX(s.context,r),r});mi.registerCallback(Ti.ContextCreated,s=>{if(!s.context.mainCamera){RE&&console.log("Will not auto-fit because a default camera exists");return}const e=s.context.domElement;if((e==null?void 0:e.cameraControls)==!0){const t=EQ(s.context.mainCamera);if((t==null?void 0:t.isCameraController)==!0){RE&&console.log("Will not auto-fit because a camera controller exists");return}AX(s.context)}});function AX(s,e){e=e??s.mainCameraComponent;const t=e==null?void 0:e.gameObject;if(RE&&console.log("Creating default camera controls",e==null?void 0:e.name),t){const i=Zb(t,Ei);i.sourceId=(e==null?void 0:e.sourceId)??"unknown";const n=s.domElement.getAttribute("auto-rotate");i.autoRotate=n!==void 0&&(n===""||n==="true"),i.autoRotateSpeed=.5,i.autoFit=!0}else console.warn("Missing camera object, can not add orbit controls")}const Hm={Context:Dt,glTF:{loadFromURL:yU}};globalThis.Needle!==void 0&&console.warn("Needle Engine is already imported");globalThis.Needle=Hm;function _X(s){for(const e in s)Hm[e]=s[e]}_X(Ege);_X(bSe);Hm.onStart=cF;Hm.onUpdate=hF;Hm.onBeforeRender=M7;Hm.NeedleXRSession=Mt;for(const s of Object.getOwnPropertyNames(ne))switch(s){case"prototype":case"constructor":case"length":case"name":continue;default:Hm[s]=ne[s];break}globalThis.THREE?console.warn("Threejs is already imported"):globalThis.THREE=Zte;class dCe{constructor(e){if(this._retries=0,!Number.isInteger(e)||e<0)throw new Error("Backoff must be a positive integer");this.backoff=e}get retries(){return this._retries}get current(){return this.backoff}next(){return this._retries++,this.backoff}reset(){this._retries=0}}class fCe{constructor(e,t){if(this._retries=0,!Number.isInteger(e)||e<0)throw new Error("Base must be a positive integer or zero");if(t!==void 0&&(!Number.isInteger(t)||t<0))throw new Error("ExpMax must be a undefined, a positive integer or zero");this.base=e,this.expMax=t,this.i=0}get retries(){return this._retries}get current(){return this.base*Math.pow(2,this.i)}next(){return this._retries++,this.i=this.expMax===void 0?this.i+1:Math.min(this.i+1,this.expMax),this.current}reset(){this._retries=0,this.i=0}}class pCe{constructor(e,t,i){if(this.i=0,this._retries=0,e<0)throw new Error("Initial must be a positive number or zero");if(t<0)throw new Error("Increment must be a positive number or zero");if(i!==void 0&&i<0)throw new Error("Max must be undefined, a positive number or zero");if(i!==void 0&&i<e)throw new Error("Max must be undefined or greater than or equal to initial");this.initial=e,this.increment=t,this.max=i}get retries(){return this._retries}get current(){return this.max===void 0?this.initial+this.increment*this.i:Math.min(this.initial+this.increment*this.i,this.max)}next(){return this._retries++,this.i++,this.current}reset(){this._retries=0,this.i=0}}class mCe{constructor(){this.elements=[]}add(e){this.elements.push(e)}clear(){this.elements.length=0}forEach(e){this.elements.forEach(e)}length(){return this.elements.length}isEmpty(){return this.elements.length===0}peek(){return this.elements[0]}read(){return this.elements.shift()}}class gCe{constructor(e){if(!Number.isInteger(e)||e<=0)throw new Error("Capacity must be a positive integer");this.elements=new Array(e+1),this.head=0,this.tail=0}add(e){this.elements[this.head]=e,this.head=(this.head+1)%this.elements.length,this.head===this.tail&&(this.tail=(this.tail+1)%this.elements.length)}clear(){this.head=0,this.tail=0}forEach(e){for(let t=this.tail;t!==this.head;t=(t+1)%this.elements.length)e(this.elements[t])}length(){return this.tail===this.head?0:this.tail<this.head?this.head-this.tail:this.elements.length-this.tail+this.head}isEmpty(){return this.head===this.tail}peek(){return this.isEmpty()?void 0:this.elements[this.tail]}read(){const e=this.peek();return e!==void 0&&(this.tail=(this.tail+1)%this.elements.length),e}}var Gi;(function(s){s.open="open",s.close="close",s.error="error",s.message="message",s.retry="retry",s.reconnect="reconnect"})(Gi||(Gi={}));class bX{constructor(e,t,i){var n,r,o,a,l,c,h,u,f,p,m,v,g,y,A;this._closedByUser=!1,this.handleOpenEvent=_=>this.handleEvent(Gi.open,_),this.handleErrorEvent=_=>this.handleEvent(Gi.error,_),this.handleCloseEvent=_=>this.handleEvent(Gi.close,_),this.handleMessageEvent=_=>this.handleEvent(Gi.message,_),this._url=e,this._protocols=t,this._options={buffer:i==null?void 0:i.buffer,retry:{maxRetries:(n=i==null?void 0:i.retry)===null||n===void 0?void 0:n.maxRetries,instantReconnect:(r=i==null?void 0:i.retry)===null||r===void 0?void 0:r.instantReconnect,backoff:(o=i==null?void 0:i.retry)===null||o===void 0?void 0:o.backoff},listeners:{open:[...(l=(a=i==null?void 0:i.listeners)===null||a===void 0?void 0:a.open)!==null&&l!==void 0?l:[]],close:[...(h=(c=i==null?void 0:i.listeners)===null||c===void 0?void 0:c.close)!==null&&h!==void 0?h:[]],error:[...(f=(u=i==null?void 0:i.listeners)===null||u===void 0?void 0:u.error)!==null&&f!==void 0?f:[]],message:[...(m=(p=i==null?void 0:i.listeners)===null||p===void 0?void 0:p.message)!==null&&m!==void 0?m:[]],retry:[...(g=(v=i==null?void 0:i.listeners)===null||v===void 0?void 0:v.retry)!==null&&g!==void 0?g:[]],reconnect:[...(A=(y=i==null?void 0:i.listeners)===null||y===void 0?void 0:y.reconnect)!==null&&A!==void 0?A:[]]}},this._underlyingWebsocket=this.tryConnect()}get url(){return this._url}get protocols(){return this._protocols}get buffer(){return this._options.buffer}get maxRetries(){return this._options.retry.maxRetries}get instantReconnect(){return this._options.retry.instantReconnect}get backoff(){return this._options.retry.backoff}get closedByUser(){return this._closedByUser}get lastConnection(){return this._lastConnection}get underlyingWebsocket(){return this._underlyingWebsocket}get readyState(){return this._underlyingWebsocket.readyState}get bufferedAmount(){return this._underlyingWebsocket.bufferedAmount}get extensions(){return this._underlyingWebsocket.extensions}get binaryType(){return this._underlyingWebsocket.binaryType}set binaryType(e){this._underlyingWebsocket.binaryType=e}send(e){this.closedByUser||(this._underlyingWebsocket.readyState===this._underlyingWebsocket.OPEN?this._underlyingWebsocket.send(e):this.buffer!==void 0&&this.buffer.add(e))}close(e,t){this.cancelScheduledConnectionRetry(),this._closedByUser=!0,this._underlyingWebsocket.close(e,t)}addEventListener(e,t,i){this._options.listeners[e].push({listener:t,options:i})}removeEventListener(e,t,i){const n=r=>r.listener!==t||r.options!==i;this._options.listeners[e]=this._options.listeners[e].filter(n)}tryConnect(){return this._underlyingWebsocket=new WebSocket(this.url,this.protocols),this._underlyingWebsocket.addEventListener(Gi.open,this.handleOpenEvent),this._underlyingWebsocket.addEventListener(Gi.close,this.handleCloseEvent),this._underlyingWebsocket.addEventListener(Gi.error,this.handleErrorEvent),this._underlyingWebsocket.addEventListener(Gi.message,this.handleMessageEvent),this._underlyingWebsocket}clearWebsocket(){this._underlyingWebsocket.removeEventListener(Gi.open,this.handleOpenEvent),this._underlyingWebsocket.removeEventListener(Gi.close,this.handleCloseEvent),this._underlyingWebsocket.removeEventListener(Gi.error,this.handleErrorEvent),this._underlyingWebsocket.removeEventListener(Gi.message,this.handleMessageEvent),this._underlyingWebsocket.close()}dispatchEvent(e,t){const i=this._options.listeners[e],n=[];i.forEach(({listener:r,options:o})=>{r(this,t),(o===void 0||o.once===void 0||!o.once)&&n.push({listener:r,options:o})}),this._options.listeners[e]=n}handleEvent(e,t){switch(e){case Gi.close:this.dispatchEvent(e,t),this.scheduleConnectionRetryIfNeeded();break;case Gi.open:if(this.backoff!==void 0&&this._lastConnection!==void 0){const i={retries:this.backoff.retries,lastConnection:new Date(this._lastConnection)},n=new CustomEvent(Gi.reconnect,{detail:i});this.dispatchEvent(Gi.reconnect,n),this.backoff.reset()}this._lastConnection=new Date,this.dispatchEvent(e,t),this.sendBufferedData();break;case Gi.retry:this.dispatchEvent(e,t),this.clearWebsocket(),this.tryConnect();break;default:this.dispatchEvent(e,t);break}}sendBufferedData(){if(this.buffer!==void 0)for(let e=this.buffer.read();e!==void 0;e=this.buffer.read())this.send(e)}scheduleConnectionRetryIfNeeded(){if(this.closedByUser||this.backoff===void 0)return;const e=i=>{const n=new CustomEvent(Gi.retry,{detail:i});this.handleEvent(Gi.retry,n)},t={backoff:this._options.retry.instantReconnect===!0?0:this.backoff.next(),retries:this._options.retry.instantReconnect===!0?0:this.backoff.retries,lastConnection:this._lastConnection};(this._options.retry.maxRetries===void 0||t.retries<=this._options.retry.maxRetries)&&(this.retryTimeout=globalThis.setTimeout(()=>e(t),t.backoff))}cancelScheduledConnectionRetry(){globalThis.clearTimeout(this.retryTimeout)}}class yCe{constructor(e){this._url=e}get url(){return this._url}withProtocols(e){return this._protocols=e,this}get protocols(){return this._protocols}withMaxRetries(e){var t;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(t=this._options)===null||t===void 0?void 0:t.retry),{maxRetries:e})}),this}get maxRetries(){var e,t;return(t=(e=this._options)===null||e===void 0?void 0:e.retry)===null||t===void 0?void 0:t.maxRetries}withInstantReconnect(e){var t;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(t=this._options)===null||t===void 0?void 0:t.retry),{instantReconnect:e})}),this}get instantReconnect(){var e,t;return(t=(e=this._options)===null||e===void 0?void 0:e.retry)===null||t===void 0?void 0:t.instantReconnect}withBackoff(e){var t;return this._options=Object.assign(Object.assign({},this._options),{retry:Object.assign(Object.assign({},(t=this._options)===null||t===void 0?void 0:t.retry),{backoff:e})}),this}get backoff(){var e,t;return(t=(e=this._options)===null||e===void 0?void 0:e.retry)===null||t===void 0?void 0:t.backoff}withBuffer(e){return this._options=Object.assign(Object.assign({},this._options),{buffer:e}),this}get buffer(){var e;return(e=this._options)===null||e===void 0?void 0:e.buffer}onOpen(e,t){return this.addListener(Gi.open,e,t),this}onClose(e,t){return this.addListener(Gi.close,e,t),this}onError(e,t){return this.addListener(Gi.error,e,t),this}onMessage(e,t){return this.addListener(Gi.message,e,t),this}onRetry(e,t){return this.addListener(Gi.retry,e,t),this}onReconnect(e,t){return this.addListener(Gi.reconnect,e,t),this}build(){return new bX(this._url,this._protocols,this._options)}addListener(e,t,i){var n,r,o,a,l,c,h,u,f,p,m,v,g,y,A,_,b,x,E,M,T;return this._options=Object.assign(Object.assign({},this._options),{listeners:{open:(o=(r=(n=this._options)===null||n===void 0?void 0:n.listeners)===null||r===void 0?void 0:r.open)!==null&&o!==void 0?o:[],close:(c=(l=(a=this._options)===null||a===void 0?void 0:a.listeners)===null||l===void 0?void 0:l.close)!==null&&c!==void 0?c:[],error:(f=(u=(h=this._options)===null||h===void 0?void 0:h.listeners)===null||u===void 0?void 0:u.error)!==null&&f!==void 0?f:[],message:(v=(m=(p=this._options)===null||p===void 0?void 0:p.listeners)===null||m===void 0?void 0:m.message)!==null&&v!==void 0?v:[],retry:(A=(y=(g=this._options)===null||g===void 0?void 0:g.listeners)===null||y===void 0?void 0:y.retry)!==null&&A!==void 0?A:[],reconnect:(x=(b=(_=this._options)===null||_===void 0?void 0:_.listeners)===null||b===void 0?void 0:b.reconnect)!==null&&x!==void 0?x:[],[e]:[...(T=(M=(E=this._options)===null||E===void 0?void 0:E.listeners)===null||M===void 0?void 0:M[e])!==null&&T!==void 0?T:[],{listener:t,options:i}]}}),this}}const vCe=Object.freeze(Object.defineProperty({__proto__:null,ArrayQueue:mCe,ConstantBackoff:dCe,ExponentialBackoff:fCe,LinearBackoff:pCe,RingQueue:gCe,Websocket:bX,WebsocketBuilder:yCe,get WebsocketEvent(){return Gi}},Symbol.toStringTag,{value:"Module"})),EU=0,xX=1,wX=2,ACe=0,_Ce=1,AO=2,M1=1.25,_O=1,Nd=6*4+4+4,ZT=65535,bCe=Math.pow(2,-24),fB=Symbol("SKIP_GENERATION");function SX(s){return s.index?s.index.count:s.attributes.position.count}function a0(s){return SX(s)/3}function CX(s,e=ArrayBuffer){return s>65535?new Uint32Array(new e(4*s)):new Uint16Array(new e(2*s))}function xCe(s,e){if(!s.index){const t=s.attributes.position.count,i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=CX(t,i);s.setIndex(new Ke(n,1));for(let r=0;r<t;r++)n[r]=r}}function EX(s){const e=a0(s),t=s.drawRange,i=t.start/3,n=(t.start+t.count)/3,r=Math.max(0,i),o=Math.min(e,n)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function MX(s){if(!s.groups||!s.groups.length)return EX(s);const e=[],t=new Set,i=s.drawRange,n=i.start/3,r=(i.start+i.count)/3;for(const a of s.groups){const l=a.start/3,c=(a.start+a.count)/3;t.add(Math.max(n,l)),t.add(Math.min(r,c))}const o=Array.from(t.values()).sort((a,l)=>a-l);for(let a=0;a<o.length-1;a++){const l=o[a],c=o[a+1];e.push({offset:Math.floor(l),count:Math.floor(c-l)})}return e}function wCe(s){if(s.groups.length===0)return!1;const e=a0(s),t=MX(s).sort((r,o)=>r.offset-o.offset),i=t[t.length-1];i.count=Math.min(e-i.offset,i.count);let n=0;return t.forEach(({count:r})=>n+=r),e!==n}function pB(s,e,t,i,n){let r=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,f=1/0,p=1/0,m=-1/0,v=-1/0,g=-1/0;for(let y=e*6,A=(e+t)*6;y<A;y+=6){const _=s[y+0],b=s[y+1],x=_-b,E=_+b;x<r&&(r=x),E>l&&(l=E),_<u&&(u=_),_>m&&(m=_);const M=s[y+2],T=s[y+3],R=M-T,w=M+T;R<o&&(o=R),w>c&&(c=w),M<f&&(f=M),M>v&&(v=M);const I=s[y+4],O=s[y+5],k=I-O,B=I+O;k<a&&(a=k),B>h&&(h=B),I<p&&(p=I),I>g&&(g=I)}i[0]=r,i[1]=o,i[2]=a,i[3]=l,i[4]=c,i[5]=h,n[0]=u,n[1]=f,n[2]=p,n[3]=m,n[4]=v,n[5]=g}function SCe(s,e=null,t=null,i=null){const n=s.attributes.position,r=s.index?s.index.array:null,o=a0(s),a=n.normalized;let l;e===null?(l=new Float32Array(o*6*4),t=0,i=o):(l=e,t=t||0,i=i||o);const c=n.array,h=n.offset||0;let u=3;n.isInterleavedBufferAttribute&&(u=n.data.stride);const f=["getX","getY","getZ"];for(let p=t;p<t+i;p++){const m=p*3,v=p*6;let g=m+0,y=m+1,A=m+2;r&&(g=r[g],y=r[y],A=r[A]),a||(g=g*u+h,y=y*u+h,A=A*u+h);for(let _=0;_<3;_++){let b,x,E;a?(b=n[f[_]](g),x=n[f[_]](y),E=n[f[_]](A)):(b=c[g+_],x=c[y+_],E=c[A+_]);let M=b;x<M&&(M=x),E<M&&(M=E);let T=b;x>T&&(T=x),E>T&&(T=E);const R=(T-M)/2,w=_*2;l[v+w+0]=M+R,l[v+w+1]=R+(Math.abs(M)+R)*bCe}}return l}function Zi(s,e,t){return t.min.x=e[s],t.min.y=e[s+1],t.min.z=e[s+2],t.max.x=e[s+3],t.max.y=e[s+4],t.max.z=e[s+5],t}function YV(s){let e=-1,t=-1/0;for(let i=0;i<3;i++){const n=s[i+3]-s[i];n>t&&(t=n,e=i)}return e}function KV(s,e){e.set(s)}function JV(s,e,t){let i,n;for(let r=0;r<3;r++){const o=r+3;i=s[r],n=e[r],t[r]=i<n?i:n,i=s[o],n=e[o],t[o]=i>n?i:n}}function dC(s,e,t){for(let i=0;i<3;i++){const n=e[s+2*i],r=e[s+2*i+1],o=n-r,a=n+r;o<t[i]&&(t[i]=o),a>t[i+3]&&(t[i+3]=a)}}function sA(s){const e=s[3]-s[0],t=s[4]-s[1],i=s[5]-s[2];return 2*(e*t+t*i+i*e)}const Ih=32,CCe=(s,e)=>s.candidate-e.candidate,$u=new Array(Ih).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),fC=new Float32Array(6);function ECe(s,e,t,i,n,r){let o=-1,a=0;if(r===EU)o=YV(e),o!==-1&&(a=(e[o]+e[o+3])/2);else if(r===xX)o=YV(s),o!==-1&&(a=MCe(t,i,n,o));else if(r===wX){const l=sA(s);let c=M1*n;const h=i*6,u=(i+n)*6;for(let f=0;f<3;f++){const p=e[f],g=(e[f+3]-p)/Ih;if(n<Ih/4){const y=[...$u];y.length=n;let A=0;for(let b=h;b<u;b+=6,A++){const x=y[A];x.candidate=t[b+2*f],x.count=0;const{bounds:E,leftCacheBounds:M,rightCacheBounds:T}=x;for(let R=0;R<3;R++)T[R]=1/0,T[R+3]=-1/0,M[R]=1/0,M[R+3]=-1/0,E[R]=1/0,E[R+3]=-1/0;dC(b,t,E)}y.sort(CCe);let _=n;for(let b=0;b<_;b++){const x=y[b];for(;b+1<_&&y[b+1].candidate===x.candidate;)y.splice(b+1,1),_--}for(let b=h;b<u;b+=6){const x=t[b+2*f];for(let E=0;E<_;E++){const M=y[E];x>=M.candidate?dC(b,t,M.rightCacheBounds):(dC(b,t,M.leftCacheBounds),M.count++)}}for(let b=0;b<_;b++){const x=y[b],E=x.count,M=n-x.count,T=x.leftCacheBounds,R=x.rightCacheBounds;let w=0;E!==0&&(w=sA(T)/l);let I=0;M!==0&&(I=sA(R)/l);const O=_O+M1*(w*E+I*M);O<c&&(o=f,c=O,a=x.candidate)}}else{for(let _=0;_<Ih;_++){const b=$u[_];b.count=0,b.candidate=p+g+_*g;const x=b.bounds;for(let E=0;E<3;E++)x[E]=1/0,x[E+3]=-1/0}for(let _=h;_<u;_+=6){let E=~~((t[_+2*f]-p)/g);E>=Ih&&(E=Ih-1);const M=$u[E];M.count++,dC(_,t,M.bounds)}const y=$u[Ih-1];KV(y.bounds,y.rightCacheBounds);for(let _=Ih-2;_>=0;_--){const b=$u[_],x=$u[_+1];JV(b.bounds,x.rightCacheBounds,b.rightCacheBounds)}let A=0;for(let _=0;_<Ih-1;_++){const b=$u[_],x=b.count,E=b.bounds,T=$u[_+1].rightCacheBounds;x!==0&&(A===0?KV(E,fC):JV(E,fC,fC)),A+=x;let R=0,w=0;A!==0&&(R=sA(fC)/l);const I=n-A;I!==0&&(w=sA(T)/l);const O=_O+M1*(R*A+w*I);O<c&&(o=f,c=O,a=b.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}function MCe(s,e,t,i){let n=0;for(let r=e,o=e+t;r<o;r++)n+=s[r*6+i*2];return n/t}class mB{constructor(){this.boundingData=new Float32Array(6)}}function TCe(s,e,t,i,n,r){let o=i,a=i+n-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){for(let h=0;h<3;h++){let u=e[o*3+h];e[o*3+h]=e[a*3+h],e[a*3+h]=u}for(let h=0;h<6;h++){let u=t[o*6+h];t[o*6+h]=t[a*6+h],t[a*6+h]=u}o++,a--}else return o}}function ICe(s,e,t,i,n,r){let o=i,a=i+n-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){let h=s[o];s[o]=s[a],s[a]=h;for(let u=0;u<6;u++){let f=t[o*6+u];t[o*6+u]=t[a*6+u],t[a*6+u]=f}o++,a--}else return o}}function uo(s,e){return e[s+15]===65535}function ko(s,e){return e[s+6]}function da(s,e){return e[s+14]}function il(s){return s+8}function fa(s,e){return e[s+6]}function MU(s,e){return e[s+7]}let TX,zA,T1,IX;const RCe=Math.pow(2,32);function bO(s){return"count"in s?1:1+bO(s.left)+bO(s.right)}function PCe(s,e,t){return TX=new Float32Array(t),zA=new Uint32Array(t),T1=new Uint16Array(t),IX=new Uint8Array(t),xO(s,e)}function xO(s,e){const t=s/4,i=s/2,n="count"in e,r=e.boundingData;for(let o=0;o<6;o++)TX[t+o]=r[o];if(n)if(e.buffer){const o=e.buffer;IX.set(new Uint8Array(o),s);for(let a=s,l=s+o.byteLength;a<l;a+=Nd){const c=a/2;uo(c,T1)||(zA[a/4+6]+=t)}return s+o.byteLength}else{const o=e.offset,a=e.count;return zA[t+6]=o,T1[i+14]=a,T1[i+15]=ZT,s+Nd}else{const o=e.left,a=e.right,l=e.splitAxis;let c;if(c=xO(s+Nd,o),c/4>RCe)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return zA[t+6]=c/4,c=xO(c,a),zA[t+7]=l,c}}function BCe(s,e){const t=(s.index?s.index.count:s.attributes.position.count)/3,i=t>2**16,n=i?4:2,r=e?new SharedArrayBuffer(t*n):new ArrayBuffer(t*n),o=i?new Uint32Array(r):new Uint16Array(r);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function DCe(s,e,t,i,n){const{maxDepth:r,verbose:o,maxLeafTris:a,strategy:l,onProgress:c,indirect:h}=n,u=s._indirectBuffer,f=s.geometry,p=f.index?f.index.array:null,m=h?ICe:TCe,v=a0(f),g=new Float32Array(6);let y=!1;const A=new mB;return pB(e,t,i,A.boundingData,g),b(A,t,i,g),A;function _(x){c&&c(x/v)}function b(x,E,M,T=null,R=0){if(!y&&R>=r&&(y=!0,o&&(console.warn(`MeshBVH: Max depth of ${r} reached when generating BVH. Consider increasing maxDepth.`),console.warn(f))),M<=a||R>=r)return _(E+M),x.offset=E,x.count=M,x;const w=ECe(x.boundingData,T,e,E,M,l);if(w.axis===-1)return _(E+M),x.offset=E,x.count=M,x;const I=m(u,p,e,E,M,w);if(I===E||I===E+M)_(E+M),x.offset=E,x.count=M;else{x.splitAxis=w.axis;const O=new mB,k=E,B=I-E;x.left=O,pB(e,k,B,O.boundingData,g),b(O,k,B,g,R+1);const G=new mB,L=I,U=M-B;x.right=G,pB(e,L,U,G.boundingData,g),b(G,L,U,g,R+1)}return x}}function OCe(s,e){const t=s.geometry;e.indirect&&(s._indirectBuffer=BCe(t,e.useSharedArrayBuffer),wCe(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),s._indirectBuffer||xCe(t,e);const i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=SCe(t),r=e.indirect?EX(t):MX(t);s._roots=r.map(o=>{const a=DCe(s,n,o.offset,o.count,e),l=bO(a),c=new i(Nd*l);return PCe(0,a,c),c})}class cu{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let r=0,o=e.length;r<o;r++){const l=e[r][t];i=l<i?l:i,n=l>n?l:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let r=0,o=t.length;r<o;r++){const a=t[r],l=e.dot(a);i=l<i?l:i,n=l>n?l:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}}cu.prototype.setFromBox=function(){const s=new S;return function(t,i){const n=i.min,r=i.max;let o=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){s.x=n.x*l+r.x*(1-l),s.y=n.y*c+r.y*(1-c),s.z=n.z*h+r.z*(1-h);const u=t.dot(s);o=Math.min(u,o),a=Math.max(u,a)}this.min=o,this.max=a}}();const LCe=function(){const s=new S,e=new S,t=new S;return function(n,r,o){const a=n.start,l=s,c=r.start,h=e;t.subVectors(a,c),s.subVectors(n.end,n.start),e.subVectors(r.end,r.start);const u=t.dot(h),f=h.dot(l),p=h.dot(h),m=t.dot(l),g=l.dot(l)*p-f*f;let y,A;g!==0?y=(u*f-m*p)/g:y=0,A=(u+y*f)/p,o.x=y,o.y=A}}(),TU=function(){const s=new ee,e=new S,t=new S;return function(n,r,o,a){LCe(n,r,s);let l=s.x,c=s.y;if(l>=0&&l<=1&&c>=0&&c<=1){n.at(l,o),r.at(c,a);return}else if(l>=0&&l<=1){c<0?r.at(0,a):r.at(1,a),n.closestPointToPoint(a,!0,o);return}else if(c>=0&&c<=1){l<0?n.at(0,o):n.at(1,o),r.closestPointToPoint(o,!0,a);return}else{let h;l<0?h=n.start:h=n.end;let u;c<0?u=r.start:u=r.end;const f=e,p=t;if(n.closestPointToPoint(u,!0,e),r.closestPointToPoint(h,!0,t),f.distanceToSquared(u)<=p.distanceToSquared(h)){o.copy(f),a.copy(u);return}else{o.copy(h),a.copy(p);return}}}}(),kCe=function(){const s=new S,e=new S,t=new xs,i=new ma;return function(r,o){const{radius:a,center:l}=r,{a:c,b:h,c:u}=o;if(i.start=c,i.end=h,i.closestPointToPoint(l,!0,s).distanceTo(l)<=a||(i.start=c,i.end=u,i.closestPointToPoint(l,!0,s).distanceTo(l)<=a)||(i.start=h,i.end=u,i.closestPointToPoint(l,!0,s).distanceTo(l)<=a))return!0;const v=o.getPlane(t);if(Math.abs(v.distanceToPoint(l))<=a){const y=v.projectPoint(l,e);if(o.containsPoint(y))return!0}return!1}}(),FCe=1e-15;function gB(s){return Math.abs(s)<FCe}class al extends pr{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new S),this.satBounds=new Array(4).fill().map(()=>new cu),this.points=[this.a,this.b,this.c],this.sphere=new ln,this.plane=new xs,this.needsUpdate=!0}intersectsSphere(e){return kCe(e,this)}update(){const e=this.a,t=this.b,i=this.c,n=this.points,r=this.satAxes,o=this.satBounds,a=r[0],l=o[0];this.getNormal(a),l.setFromPoints(a,n);const c=r[1],h=o[1];c.subVectors(e,t),h.setFromPoints(c,n);const u=r[2],f=o[2];u.subVectors(t,i),f.setFromPoints(u,n);const p=r[3],m=o[3];p.subVectors(i,e),m.setFromPoints(p,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}al.prototype.closestPointToSegment=function(){const s=new S,e=new S,t=new ma;return function(n,r=null,o=null){const{start:a,end:l}=n,c=this.points;let h,u=1/0;for(let f=0;f<3;f++){const p=(f+1)%3;t.start.copy(c[f]),t.end.copy(c[p]),TU(t,n,s,e),h=s.distanceToSquared(e),h<u&&(u=h,r&&r.copy(s),o&&o.copy(e))}return this.closestPointToPoint(a,s),h=a.distanceToSquared(s),h<u&&(u=h,r&&r.copy(s),o&&o.copy(a)),this.closestPointToPoint(l,s),h=l.distanceToSquared(s),h<u&&(u=h,r&&r.copy(s),o&&o.copy(l)),Math.sqrt(u)}}();al.prototype.intersectsTriangle=function(){const s=new al,e=new Array(3),t=new Array(3),i=new cu,n=new cu,r=new S,o=new S,a=new S,l=new S,c=new S,h=new ma,u=new ma,f=new ma,p=new S;function m(v,g,y){const A=v.points;let _=0,b=-1;for(let x=0;x<3;x++){const{start:E,end:M}=h;E.copy(A[x]),M.copy(A[(x+1)%3]),h.delta(o);const T=gB(g.distanceToPoint(E));if(gB(g.normal.dot(o))&&T){y.copy(h),_=2;break}const R=g.intersectLine(h,p);if(!R&&T&&p.copy(E),(R||T)&&!gB(p.distanceTo(M))){if(_<=1)(_===1?y.start:y.end).copy(p),T&&(b=_);else if(_>=2){(b===1?y.start:y.end).copy(p),_=2;break}if(_++,_===2&&b===-1)break}}return _}return function(g,y=null,A=!1){this.needsUpdate&&this.update(),g.isExtendedTriangle?g.needsUpdate&&g.update():(s.copy(g),s.update(),g=s);const _=this.plane,b=g.plane;if(Math.abs(_.normal.dot(b.normal))>1-1e-10){const x=this.satBounds,E=this.satAxes;t[0]=g.a,t[1]=g.b,t[2]=g.c;for(let R=0;R<4;R++){const w=x[R],I=E[R];if(i.setFromPoints(I,t),w.isSeparated(i))return!1}const M=g.satBounds,T=g.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let R=0;R<4;R++){const w=M[R],I=T[R];if(i.setFromPoints(I,e),w.isSeparated(i))return!1}for(let R=0;R<4;R++){const w=E[R];for(let I=0;I<4;I++){const O=T[I];if(r.crossVectors(w,O),i.setFromPoints(r,e),n.setFromPoints(r,t),i.isSeparated(n))return!1}}return y&&(A||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),y.start.set(0,0,0),y.end.set(0,0,0)),!0}else{const x=m(this,b,u);if(x===1&&g.containsPoint(u.end))return y&&(y.start.copy(u.end),y.end.copy(u.end)),!0;if(x!==2)return!1;const E=m(g,_,f);if(E===1&&this.containsPoint(f.end))return y&&(y.start.copy(f.end),y.end.copy(f.end)),!0;if(E!==2)return!1;if(u.delta(a),f.delta(l),a.dot(l)<0){let k=f.start;f.start=f.end,f.end=k}const M=u.start.dot(a),T=u.end.dot(a),R=f.start.dot(a),w=f.end.dot(a),I=T<R,O=M<w;return M!==w&&R!==T&&I===O?!1:(y&&(c.subVectors(u.start,f.start),c.dot(a)>0?y.start.copy(u.start):y.start.copy(f.start),c.subVectors(u.end,f.end),c.dot(a)<0?y.end.copy(u.end):y.end.copy(f.end)),!0)}}}();al.prototype.distanceToPoint=function(){const s=new S;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}();al.prototype.distanceToTriangle=function(){const s=new S,e=new S,t=["a","b","c"],i=new ma,n=new ma;return function(o,a=null,l=null){const c=a||l?i:null;if(this.intersectsTriangle(o,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let h=1/0;for(let u=0;u<3;u++){let f;const p=t[u],m=o[p];this.closestPointToPoint(m,s),f=m.distanceToSquared(s),f<h&&(h=f,a&&a.copy(s),l&&l.copy(m));const v=this[p];o.closestPointToPoint(v,s),f=v.distanceToSquared(s),f<h&&(h=f,a&&a.copy(v),l&&l.copy(s))}for(let u=0;u<3;u++){const f=t[u],p=t[(u+1)%3];i.set(this[f],this[p]);for(let m=0;m<3;m++){const v=t[m],g=t[(m+1)%3];n.set(o[v],o[g]),TU(i,n,s,e);const y=s.distanceToSquared(e);y<h&&(h=y,a&&a.copy(s),l&&l.copy(e))}}return Math.sqrt(h)}}();class Jr{constructor(e,t,i){this.isOrientedBox=!0,this.min=new S,this.max=new S,this.matrix=new le,this.invMatrix=new le,this.points=new Array(8).fill().map(()=>new S),this.satAxes=new Array(3).fill().map(()=>new S),this.satBounds=new Array(3).fill().map(()=>new cu),this.alignedSatBounds=new Array(3).fill().map(()=>new cu),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Jr.prototype.update=function(){return function(){const e=this.matrix,t=this.min,i=this.max,n=this.points;for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)for(let u=0;u<=1;u++){const f=1*c|2*h|4*u,p=n[f];p.x=c?i.x:t.x,p.y=h?i.y:t.y,p.z=u?i.z:t.z,p.applyMatrix4(e)}const r=this.satBounds,o=this.satAxes,a=n[0];for(let c=0;c<3;c++){const h=o[c],u=r[c],f=1<<c,p=n[f];h.subVectors(a,p),u.setFromPoints(h,n)}const l=this.alignedSatBounds;l[0].setFromPointsField(n,"x"),l[1].setFromPointsField(n,"y"),l[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Jr.prototype.intersectsBox=function(){const s=new cu;return function(t){this.needsUpdate&&this.update();const i=t.min,n=t.max,r=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(s.min=i.x,s.max=n.x,a[0].isSeparated(s)||(s.min=i.y,s.max=n.y,a[1].isSeparated(s))||(s.min=i.z,s.max=n.z,a[2].isSeparated(s)))return!1;for(let l=0;l<3;l++){const c=o[l],h=r[l];if(s.setFromBox(c,t),h.isSeparated(s))return!1}return!0}}();Jr.prototype.intersectsTriangle=function(){const s=new al,e=new Array(3),t=new cu,i=new cu,n=new S;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(s.copy(o),s.update(),o=s);const a=this.satBounds,l=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let f=0;f<3;f++){const p=a[f],m=l[f];if(t.setFromPoints(m,e),p.isSeparated(t))return!1}const c=o.satBounds,h=o.satAxes,u=this.points;for(let f=0;f<3;f++){const p=c[f],m=h[f];if(t.setFromPoints(m,u),p.isSeparated(t))return!1}for(let f=0;f<3;f++){const p=l[f];for(let m=0;m<4;m++){const v=h[m];if(n.crossVectors(p,v),t.setFromPoints(n,e),i.setFromPoints(n,u),t.isSeparated(i))return!1}}return!0}}();Jr.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Jr.prototype.distanceToPoint=function(){const s=new S;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}();Jr.prototype.distanceToBox=function(){const s=["x","y","z"],e=new Array(12).fill().map(()=>new ma),t=new Array(12).fill().map(()=>new ma),i=new S,n=new S;return function(o,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(l||c)&&(o.getCenter(n),this.closestPointToPoint(n,i),o.closestPointToPoint(i,n),l&&l.copy(i),c&&c.copy(n)),0;const h=a*a,u=o.min,f=o.max,p=this.points;let m=1/0;for(let g=0;g<8;g++){const y=p[g];n.copy(y).clamp(u,f);const A=y.distanceToSquared(n);if(A<m&&(m=A,l&&l.copy(y),c&&c.copy(n),A<h))return Math.sqrt(A)}let v=0;for(let g=0;g<3;g++)for(let y=0;y<=1;y++)for(let A=0;A<=1;A++){const _=(g+1)%3,b=(g+2)%3,x=y<<_|A<<b,E=1<<g|y<<_|A<<b,M=p[x],T=p[E];e[v].set(M,T);const w=s[g],I=s[_],O=s[b],k=t[v],B=k.start,G=k.end;B[w]=u[w],B[I]=y?u[I]:f[I],B[O]=A?u[O]:f[I],G[w]=f[w],G[I]=y?u[I]:f[I],G[O]=A?u[O]:f[I],v++}for(let g=0;g<=1;g++)for(let y=0;y<=1;y++)for(let A=0;A<=1;A++){n.x=g?f.x:u.x,n.y=y?f.y:u.y,n.z=A?f.z:u.z,this.closestPointToPoint(n,i);const _=n.distanceToSquared(i);if(_<m&&(m=_,l&&l.copy(i),c&&c.copy(n),_<h))return Math.sqrt(_)}for(let g=0;g<12;g++){const y=e[g];for(let A=0;A<12;A++){const _=t[A];TU(y,_,i,n);const b=i.distanceToSquared(n);if(b<m&&(m=b,l&&l.copy(i),c&&c.copy(n),b<h))return Math.sqrt(b)}}return Math.sqrt(m)}}();class IU{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class UCe extends IU{constructor(){super(()=>new al)}}const nl=new UCe;class NCe{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=i=>{t&&e.push(t),t=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const cn=new NCe;let Sd,Ey;const Ug=[],pC=new IU(()=>new jt);function zCe(s,e,t,i,n,r){Sd=pC.getPrimitive(),Ey=pC.getPrimitive(),Ug.push(Sd,Ey),cn.setBuffer(s._roots[e]);const o=wO(0,s.geometry,t,i,n,r);cn.clearBuffer(),pC.releasePrimitive(Sd),pC.releasePrimitive(Ey),Ug.pop(),Ug.pop();const a=Ug.length;return a>0&&(Ey=Ug[a-1],Sd=Ug[a-2]),o}function wO(s,e,t,i,n=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:c}=cn;let h=s*2;if(uo(h,l)){const f=ko(s,c),p=da(h,l);return Zi(s,a,Sd),i(f,p,!1,o,r+s,Sd)}else{let w=function(O){const{uint16Array:k,uint32Array:B}=cn;let G=O*2;for(;!uo(G,k);)O=il(O),G=O*2;return ko(O,B)},I=function(O){const{uint16Array:k,uint32Array:B}=cn;let G=O*2;for(;!uo(G,k);)O=fa(O,B),G=O*2;return ko(O,B)+da(G,k)};const f=il(s),p=fa(s,c);let m=f,v=p,g,y,A,_;if(n&&(A=Sd,_=Ey,Zi(m,a,A),Zi(v,a,_),g=n(A),y=n(_),y<g)){m=p,v=f;const O=g;g=y,y=O,A=_}A||(A=Sd,Zi(m,a,A));const b=uo(m*2,l),x=t(A,b,g,o+1,r+m);let E;if(x===AO){const O=w(m),B=I(m)-O;E=i(O,B,!0,o+1,r+m,A)}else E=x&&wO(m,e,t,i,n,r,o+1);if(E)return!0;_=Ey,Zi(v,a,_);const M=uo(v*2,l),T=t(_,M,y,o+1,r+v);let R;if(T===AO){const O=w(v),B=I(v)-O;R=i(O,B,!0,o+1,r+v,_)}else R=T&&wO(v,e,t,i,n,r,o+1);return!!R}}const rA=new S,yB=new S;function GCe(s,e,t={},i=0,n=1/0){const r=i*i,o=n*n;let a=1/0,l=null;if(s.shapecast({boundsTraverseOrder:h=>(rA.copy(e).clamp(h.min,h.max),rA.distanceToSquared(e)),intersectsBounds:(h,u,f)=>f<a&&f<o,intersectsTriangle:(h,u)=>{h.closestPointToPoint(e,rA);const f=e.distanceToSquared(rA);return f<a&&(yB.copy(rA),a=f,l=u),f<r}}),a===1/0)return null;const c=Math.sqrt(a);return t.point?t.point.copy(yB):t.point=yB.clone(),t.distance=c,t.faceIndex=l,t}const Ng=new S,zg=new S,Gg=new S,mC=new ee,gC=new ee,yC=new ee,ZV=new S,$V=new S,e5=new S,vC=new S;function HCe(s,e,t,i,n,r,o,a){let l;if(r===bn?l=s.intersectTriangle(i,t,e,!0,n):l=s.intersectTriangle(e,t,i,r!==_i,n),l===null)return null;const c=s.origin.distanceTo(n);return c<o||c>a?null:{distance:c,point:n.clone()}}function VCe(s,e,t,i,n,r,o,a,l,c,h){Ng.fromBufferAttribute(e,r),zg.fromBufferAttribute(e,o),Gg.fromBufferAttribute(e,a);const u=HCe(s,Ng,zg,Gg,vC,l,c,h);if(u){i&&(mC.fromBufferAttribute(i,r),gC.fromBufferAttribute(i,o),yC.fromBufferAttribute(i,a),u.uv=pr.getInterpolation(vC,Ng,zg,Gg,mC,gC,yC,new ee)),n&&(mC.fromBufferAttribute(n,r),gC.fromBufferAttribute(n,o),yC.fromBufferAttribute(n,a),u.uv1=pr.getInterpolation(vC,Ng,zg,Gg,mC,gC,yC,new ee)),t&&(ZV.fromBufferAttribute(t,r),$V.fromBufferAttribute(t,o),e5.fromBufferAttribute(t,a),u.normal=pr.getInterpolation(vC,Ng,zg,Gg,ZV,$V,e5,new S),u.normal.dot(s.direction)>0&&u.normal.multiplyScalar(-1));const f={a:r,b:o,c:a,normal:new S,materialIndex:0};pr.getNormal(Ng,zg,Gg,f.normal),u.face=f,u.faceIndex=r}return u}function $T(s,e,t,i,n,r,o){const a=i*3;let l=a+0,c=a+1,h=a+2;const u=s.index;s.index&&(l=u.getX(l),c=u.getX(c),h=u.getX(h));const{position:f,normal:p,uv:m,uv1:v}=s.attributes,g=VCe(t,f,p,m,v,l,c,h,e,r,o);return g?(g.faceIndex=i,n&&n.push(g),g):null}function hs(s,e,t,i){const n=s.a,r=s.b,o=s.c;let a=e,l=e+1,c=e+2;t&&(a=t.getX(a),l=t.getX(l),c=t.getX(c)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(l),r.y=i.getY(l),r.z=i.getZ(l),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}const AC=new S,_C=new S,bC=new S,t5=new ee,i5=new ee,n5=new ee;function QCe(s,e,t,i){const n=e.getIndex().array,r=e.getAttribute("position"),o=e.getAttribute("uv"),a=n[t*3],l=n[t*3+1],c=n[t*3+2];AC.fromBufferAttribute(r,a),_C.fromBufferAttribute(r,l),bC.fromBufferAttribute(r,c);let h=0;const u=e.groups,f=t*3;for(let m=0,v=u.length;m<v;m++){const g=u[m],{start:y,count:A}=g;if(f>=y&&f<y+A){h=g.materialIndex;break}}let p=null;return o&&(t5.fromBufferAttribute(o,a),i5.fromBufferAttribute(o,l),n5.fromBufferAttribute(o,c),i&&i.uv?p=i.uv:p=new ee,pr.getInterpolation(s,AC,_C,bC,t5,i5,n5,p)),i?(i.face||(i.face={}),i.face.a=a,i.face.b=l,i.face.c=c,i.face.materialIndex=h,i.face.normal||(i.face.normal=new S),pr.getNormal(AC,_C,bC,i.face.normal),p&&(i.uv=p),i):{face:{a,b:l,c,materialIndex:h,normal:pr.getNormal(AC,_C,bC,new S)},uv:p}}function WCe(s,e,t,i,n,r,o,a){const{geometry:l,_indirectBuffer:c}=s;for(let h=i,u=i+n;h<u;h++)$T(l,e,t,h,r,o,a)}function jCe(s,e,t,i,n,r,o){const{geometry:a,_indirectBuffer:l}=s;let c=1/0,h=null;for(let u=i,f=i+n;u<f;u++){let p;p=$T(a,e,t,u,null,r,o),p&&p.distance<c&&(h=p,c=p.distance)}return h}function qCe(s,e,t,i,n,r,o){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let h=s,u=e+s;h<u;h++){let f;if(f=h,hs(o,f*3,l,c),o.needsUpdate=!0,i(o,f,n,r))return!0}return!1}function XCe(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=s.geometry,i=t.index?t.index.array:null,n=t.attributes.position;let r,o,a,l,c=0;const h=s._roots;for(let f=0,p=h.length;f<p;f++)r=h[f],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,c),c+=r.byteLength;function u(f,p,m=!1){const v=f*2;if(a[v+15]===ZT){const y=o[f+6],A=a[v+14];let _=1/0,b=1/0,x=1/0,E=-1/0,M=-1/0,T=-1/0;for(let R=3*y,w=3*(y+A);R<w;R++){let I=i[R];const O=n.getX(I),k=n.getY(I),B=n.getZ(I);O<_&&(_=O),O>E&&(E=O),k<b&&(b=k),k>M&&(M=k),B<x&&(x=B),B>T&&(T=B)}return l[f+0]!==_||l[f+1]!==b||l[f+2]!==x||l[f+3]!==E||l[f+4]!==M||l[f+5]!==T?(l[f+0]=_,l[f+1]=b,l[f+2]=x,l[f+3]=E,l[f+4]=M,l[f+5]=T,!0):!1}else{const y=f+8,A=o[f+6],_=y+p,b=A+p;let x=m,E=!1,M=!1;e?x||(E=e.has(_),M=e.has(b),x=!E&&!M):(E=!0,M=!0);const T=x||E,R=x||M;let w=!1;T&&(w=u(y,p,x));let I=!1;R&&(I=u(A,p,x));const O=w||I;if(O)for(let k=0;k<3;k++){const B=y+k,G=A+k,L=l[B],U=l[B+3],z=l[G],j=l[G+3];l[f+k]=L<z?L:z,l[f+k+3]=U>j?U:j}return O}}}function Jd(s,e,t,i,n){let r,o,a,l,c,h;const u=1/t.direction.x,f=1/t.direction.y,p=1/t.direction.z,m=t.origin.x,v=t.origin.y,g=t.origin.z;let y=e[s],A=e[s+3],_=e[s+1],b=e[s+3+1],x=e[s+2],E=e[s+3+2];return u>=0?(r=(y-m)*u,o=(A-m)*u):(r=(A-m)*u,o=(y-m)*u),f>=0?(a=(_-v)*f,l=(b-v)*f):(a=(b-v)*f,l=(_-v)*f),r>l||a>o||((a>r||isNaN(r))&&(r=a),(l<o||isNaN(o))&&(o=l),p>=0?(c=(x-g)*p,h=(E-g)*p):(c=(E-g)*p,h=(x-g)*p),r>h||c>o)?!1:((c>r||r!==r)&&(r=c),(h<o||o!==o)&&(o=h),r<=n&&o>=i)}function YCe(s,e,t,i,n,r,o,a){const{geometry:l,_indirectBuffer:c}=s;for(let h=i,u=i+n;h<u;h++){let f=c?c[h]:h;$T(l,e,t,f,r,o,a)}}function KCe(s,e,t,i,n,r,o){const{geometry:a,_indirectBuffer:l}=s;let c=1/0,h=null;for(let u=i,f=i+n;u<f;u++){let p;p=$T(a,e,t,l?l[u]:u,null,r,o),p&&p.distance<c&&(h=p,c=p.distance)}return h}function JCe(s,e,t,i,n,r,o){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let h=s,u=e+s;h<u;h++){let f;if(f=t.resolveTriangleIndex(h),hs(o,f*3,l,c),o.needsUpdate=!0,i(o,f,n,r))return!0}return!1}function ZCe(s,e,t,i,n,r,o){cn.setBuffer(s._roots[e]),SO(0,s,t,i,n,r,o),cn.clearBuffer()}function SO(s,e,t,i,n,r,o){const{float32Array:a,uint16Array:l,uint32Array:c}=cn,h=s*2;if(uo(h,l)){const f=ko(s,c),p=da(h,l);WCe(e,t,i,f,p,n,r,o)}else{const f=il(s);Jd(f,a,i,r,o)&&SO(f,e,t,i,n,r,o);const p=fa(s,c);Jd(p,a,i,r,o)&&SO(p,e,t,i,n,r,o)}}const $Ce=["x","y","z"];function e1e(s,e,t,i,n,r){cn.setBuffer(s._roots[e]);const o=CO(0,s,t,i,n,r);return cn.clearBuffer(),o}function CO(s,e,t,i,n,r){const{float32Array:o,uint16Array:a,uint32Array:l}=cn;let c=s*2;if(uo(c,a)){const u=ko(s,l),f=da(c,a);return jCe(e,t,i,u,f,n,r)}else{const u=MU(s,l),f=$Ce[u],m=i.direction[f]>=0;let v,g;m?(v=il(s),g=fa(s,l)):(v=fa(s,l),g=il(s));const A=Jd(v,o,i,n,r)?CO(v,e,t,i,n,r):null;if(A){const x=A.point[f];if(m?x<=o[g+u]:x>=o[g+u+3])return A}const b=Jd(g,o,i,n,r)?CO(g,e,t,i,n,r):null;return A&&b?A.distance<=b.distance?A:b:A||b||null}}const xC=new jt,Hg=new al,Vg=new al,oA=new le,s5=new Jr,wC=new Jr;function t1e(s,e,t,i){cn.setBuffer(s._roots[e]);const n=EO(0,s,t,i);return cn.clearBuffer(),n}function EO(s,e,t,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=cn;let l=s*2;if(n===null&&(t.boundingBox||t.computeBoundingBox(),s5.set(t.boundingBox.min,t.boundingBox.max,i),n=s5),uo(l,o)){const h=e.geometry,u=h.index,f=h.attributes.position,p=t.index,m=t.attributes.position,v=ko(s,a),g=da(l,o);if(oA.copy(i).invert(),t.boundsTree)return Zi(s,r,wC),wC.matrix.copy(oA),wC.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:A=>wC.intersectsBox(A),intersectsTriangle:A=>{A.a.applyMatrix4(i),A.b.applyMatrix4(i),A.c.applyMatrix4(i),A.needsUpdate=!0;for(let _=v*3,b=(g+v)*3;_<b;_+=3)if(hs(Vg,_,u,f),Vg.needsUpdate=!0,A.intersectsTriangle(Vg))return!0;return!1}});for(let y=v*3,A=(g+v)*3;y<A;y+=3){hs(Hg,y,u,f),Hg.a.applyMatrix4(oA),Hg.b.applyMatrix4(oA),Hg.c.applyMatrix4(oA),Hg.needsUpdate=!0;for(let _=0,b=p.count;_<b;_+=3)if(hs(Vg,_,p,m),Vg.needsUpdate=!0,Hg.intersectsTriangle(Vg))return!0}}else{const h=s+8,u=a[s+6];return Zi(h,r,xC),!!(n.intersectsBox(xC)&&EO(h,e,t,i,n)||(Zi(u,r,xC),n.intersectsBox(xC)&&EO(u,e,t,i,n)))}}const SC=new le,vB=new Jr,aA=new Jr,i1e=new S,n1e=new S,s1e=new S,r1e=new S;function o1e(s,e,t,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),vB.set(e.boundingBox.min,e.boundingBox.max,t),vB.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,c=a.index,h=e.attributes.position,u=e.index,f=nl.getPrimitive(),p=nl.getPrimitive();let m=i1e,v=n1e,g=null,y=null;n&&(g=s1e,y=r1e);let A=1/0,_=null,b=null;return SC.copy(t).invert(),aA.matrix.copy(SC),s.shapecast({boundsTraverseOrder:x=>vB.distanceToBox(x),intersectsBounds:(x,E,M)=>M<A&&M<o?(E&&(aA.min.copy(x.min),aA.max.copy(x.max),aA.needsUpdate=!0),!0):!1,intersectsRange:(x,E)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:T=>aA.distanceToBox(T),intersectsBounds:(T,R,w)=>w<A&&w<o,intersectsRange:(T,R)=>{for(let w=T,I=T+R;w<I;w++){hs(p,3*w,u,h),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let O=x,k=x+E;O<k;O++){hs(f,3*O,c,l),f.needsUpdate=!0;const B=f.distanceToTriangle(p,m,g);if(B<A&&(v.copy(m),y&&y.copy(g),A=B,_=O,b=w),B<r)return!0}}}});{const M=a0(e);for(let T=0,R=M;T<R;T++){hs(p,3*T,u,h),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let w=x,I=x+E;w<I;w++){hs(f,3*w,c,l),f.needsUpdate=!0;const O=f.distanceToTriangle(p,m,g);if(O<A&&(v.copy(m),y&&y.copy(g),A=O,_=w,b=T),O<r)return!0}}}}}),nl.releasePrimitive(f),nl.releasePrimitive(p),A===1/0?null:(i.point?i.point.copy(v):i.point=v.clone(),i.distance=A,i.faceIndex=_,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(SC),v.applyMatrix4(SC),n.distance=v.sub(n.point).length(),n.faceIndex=b),i)}function a1e(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=s.geometry,i=t.index?t.index.array:null,n=t.attributes.position;let r,o,a,l,c=0;const h=s._roots;for(let f=0,p=h.length;f<p;f++)r=h[f],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,c),c+=r.byteLength;function u(f,p,m=!1){const v=f*2;if(a[v+15]===ZT){const y=o[f+6],A=a[v+14];let _=1/0,b=1/0,x=1/0,E=-1/0,M=-1/0,T=-1/0;for(let R=y,w=y+A;R<w;R++){const I=3*s.resolveTriangleIndex(R);for(let O=0;O<3;O++){let k=I+O;k=i?i[k]:k;const B=n.getX(k),G=n.getY(k),L=n.getZ(k);B<_&&(_=B),B>E&&(E=B),G<b&&(b=G),G>M&&(M=G),L<x&&(x=L),L>T&&(T=L)}}return l[f+0]!==_||l[f+1]!==b||l[f+2]!==x||l[f+3]!==E||l[f+4]!==M||l[f+5]!==T?(l[f+0]=_,l[f+1]=b,l[f+2]=x,l[f+3]=E,l[f+4]=M,l[f+5]=T,!0):!1}else{const y=f+8,A=o[f+6],_=y+p,b=A+p;let x=m,E=!1,M=!1;e?x||(E=e.has(_),M=e.has(b),x=!E&&!M):(E=!0,M=!0);const T=x||E,R=x||M;let w=!1;T&&(w=u(y,p,x));let I=!1;R&&(I=u(A,p,x));const O=w||I;if(O)for(let k=0;k<3;k++){const B=y+k,G=A+k,L=l[B],U=l[B+3],z=l[G],j=l[G+3];l[f+k]=L<z?L:z,l[f+k+3]=U>j?U:j}return O}}}function l1e(s,e,t,i,n,r,o){cn.setBuffer(s._roots[e]),MO(0,s,t,i,n,r,o),cn.clearBuffer()}function MO(s,e,t,i,n,r,o){const{float32Array:a,uint16Array:l,uint32Array:c}=cn,h=s*2;if(uo(h,l)){const f=ko(s,c),p=da(h,l);YCe(e,t,i,f,p,n,r,o)}else{const f=il(s);Jd(f,a,i,r,o)&&MO(f,e,t,i,n,r,o);const p=fa(s,c);Jd(p,a,i,r,o)&&MO(p,e,t,i,n,r,o)}}const c1e=["x","y","z"];function h1e(s,e,t,i,n,r){cn.setBuffer(s._roots[e]);const o=TO(0,s,t,i,n,r);return cn.clearBuffer(),o}function TO(s,e,t,i,n,r){const{float32Array:o,uint16Array:a,uint32Array:l}=cn;let c=s*2;if(uo(c,a)){const u=ko(s,l),f=da(c,a);return KCe(e,t,i,u,f,n,r)}else{const u=MU(s,l),f=c1e[u],m=i.direction[f]>=0;let v,g;m?(v=il(s),g=fa(s,l)):(v=fa(s,l),g=il(s));const A=Jd(v,o,i,n,r)?TO(v,e,t,i,n,r):null;if(A){const x=A.point[f];if(m?x<=o[g+u]:x>=o[g+u+3])return A}const b=Jd(g,o,i,n,r)?TO(g,e,t,i,n,r):null;return A&&b?A.distance<=b.distance?A:b:A||b||null}}const CC=new jt,Qg=new al,Wg=new al,lA=new le,r5=new Jr,EC=new Jr;function u1e(s,e,t,i){cn.setBuffer(s._roots[e]);const n=IO(0,s,t,i);return cn.clearBuffer(),n}function IO(s,e,t,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=cn;let l=s*2;if(n===null&&(t.boundingBox||t.computeBoundingBox(),r5.set(t.boundingBox.min,t.boundingBox.max,i),n=r5),uo(l,o)){const h=e.geometry,u=h.index,f=h.attributes.position,p=t.index,m=t.attributes.position,v=ko(s,a),g=da(l,o);if(lA.copy(i).invert(),t.boundsTree)return Zi(s,r,EC),EC.matrix.copy(lA),EC.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:A=>EC.intersectsBox(A),intersectsTriangle:A=>{A.a.applyMatrix4(i),A.b.applyMatrix4(i),A.c.applyMatrix4(i),A.needsUpdate=!0;for(let _=v,b=g+v;_<b;_++)if(hs(Wg,3*e.resolveTriangleIndex(_),u,f),Wg.needsUpdate=!0,A.intersectsTriangle(Wg))return!0;return!1}});for(let y=v,A=g+v;y<A;y++){const _=e.resolveTriangleIndex(y);hs(Qg,3*_,u,f),Qg.a.applyMatrix4(lA),Qg.b.applyMatrix4(lA),Qg.c.applyMatrix4(lA),Qg.needsUpdate=!0;for(let b=0,x=p.count;b<x;b+=3)if(hs(Wg,b,p,m),Wg.needsUpdate=!0,Qg.intersectsTriangle(Wg))return!0}}else{const h=s+8,u=a[s+6];return Zi(h,r,CC),!!(n.intersectsBox(CC)&&IO(h,e,t,i,n)||(Zi(u,r,CC),n.intersectsBox(CC)&&IO(u,e,t,i,n)))}}const MC=new le,AB=new Jr,cA=new Jr,d1e=new S,f1e=new S,p1e=new S,m1e=new S;function g1e(s,e,t,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),AB.set(e.boundingBox.min,e.boundingBox.max,t),AB.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,c=a.index,h=e.attributes.position,u=e.index,f=nl.getPrimitive(),p=nl.getPrimitive();let m=d1e,v=f1e,g=null,y=null;n&&(g=p1e,y=m1e);let A=1/0,_=null,b=null;return MC.copy(t).invert(),cA.matrix.copy(MC),s.shapecast({boundsTraverseOrder:x=>AB.distanceToBox(x),intersectsBounds:(x,E,M)=>M<A&&M<o?(E&&(cA.min.copy(x.min),cA.max.copy(x.max),cA.needsUpdate=!0),!0):!1,intersectsRange:(x,E)=>{if(e.boundsTree){const M=e.boundsTree;return M.shapecast({boundsTraverseOrder:T=>cA.distanceToBox(T),intersectsBounds:(T,R,w)=>w<A&&w<o,intersectsRange:(T,R)=>{for(let w=T,I=T+R;w<I;w++){const O=M.resolveTriangleIndex(w);hs(p,3*O,u,h),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let k=x,B=x+E;k<B;k++){const G=s.resolveTriangleIndex(k);hs(f,3*G,c,l),f.needsUpdate=!0;const L=f.distanceToTriangle(p,m,g);if(L<A&&(v.copy(m),y&&y.copy(g),A=L,_=k,b=w),L<r)return!0}}}})}else{const M=a0(e);for(let T=0,R=M;T<R;T++){hs(p,3*T,u,h),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let w=x,I=x+E;w<I;w++){const O=s.resolveTriangleIndex(w);hs(f,3*O,c,l),f.needsUpdate=!0;const k=f.distanceToTriangle(p,m,g);if(k<A&&(v.copy(m),y&&y.copy(g),A=k,_=w,b=T),k<r)return!0}}}}}),nl.releasePrimitive(f),nl.releasePrimitive(p),A===1/0?null:(i.point?i.point.copy(v):i.point=v.clone(),i.distance=A,i.faceIndex=_,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(MC),v.applyMatrix4(MC),n.distance=v.sub(n.point).length(),n.faceIndex=b),i)}function RX(){return typeof SharedArrayBuffer<"u"}const g_=new cn.constructor,PE=new cn.constructor,hd=new IU(()=>new jt),jg=new jt,qg=new jt,_B=new jt,bB=new jt;let xB=!1;function y1e(s,e,t,i){if(xB)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");xB=!0;const n=s._roots,r=e._roots;let o,a=0,l=0;const c=new le().copy(t).invert();for(let h=0,u=n.length;h<u;h++){g_.setBuffer(n[h]),l=0;const f=hd.getPrimitive();Zi(0,g_.float32Array,f),f.applyMatrix4(c);for(let p=0,m=r.length;p<m&&(PE.setBuffer(r[h]),o=Rl(0,0,t,c,i,a,l,0,0,f),PE.clearBuffer(),l+=r[p].length,!o);p++);if(hd.releasePrimitive(f),g_.clearBuffer(),a+=n[h].length,o)break}return xB=!1,o}function Rl(s,e,t,i,n,r=0,o=0,a=0,l=0,c=null,h=!1){let u,f;h?(u=PE,f=g_):(u=g_,f=PE);const p=u.float32Array,m=u.uint32Array,v=u.uint16Array,g=f.float32Array,y=f.uint32Array,A=f.uint16Array,_=s*2,b=e*2,x=uo(_,v),E=uo(b,A);let M=!1;if(E&&x)h?M=n(ko(e,y),da(e*2,A),ko(s,m),da(s*2,v),l,o+e,a,r+s):M=n(ko(s,m),da(s*2,v),ko(e,y),da(e*2,A),a,r+s,l,o+e);else if(E){const T=hd.getPrimitive();Zi(e,g,T),T.applyMatrix4(t);const R=il(s),w=fa(s,m);Zi(R,p,jg),Zi(w,p,qg);const I=T.intersectsBox(jg),O=T.intersectsBox(qg);M=I&&Rl(e,R,i,t,n,o,r,l,a+1,T,!h)||O&&Rl(e,w,i,t,n,o,r,l,a+1,T,!h),hd.releasePrimitive(T)}else{const T=il(e),R=fa(e,y);Zi(T,g,_B),Zi(R,g,bB);const w=c.intersectsBox(_B),I=c.intersectsBox(bB);if(w&&I)M=Rl(s,T,t,i,n,r,o,a,l+1,c,h)||Rl(s,R,t,i,n,r,o,a,l+1,c,h);else if(w)if(x)M=Rl(s,T,t,i,n,r,o,a,l+1,c,h);else{const O=hd.getPrimitive();O.copy(_B).applyMatrix4(t);const k=il(s),B=fa(s,m);Zi(k,p,jg),Zi(B,p,qg);const G=O.intersectsBox(jg),L=O.intersectsBox(qg);M=G&&Rl(T,k,i,t,n,o,r,l,a+1,O,!h)||L&&Rl(T,B,i,t,n,o,r,l,a+1,O,!h),hd.releasePrimitive(O)}else if(I)if(x)M=Rl(s,R,t,i,n,r,o,a,l+1,c,h);else{const O=hd.getPrimitive();O.copy(bB).applyMatrix4(t);const k=il(s),B=fa(s,m);Zi(k,p,jg),Zi(B,p,qg);const G=O.intersectsBox(jg),L=O.intersectsBox(qg);M=G&&Rl(R,k,i,t,n,o,r,l,a+1,O,!h)||L&&Rl(R,B,i,t,n,o,r,l,a+1,O,!h),hd.releasePrimitive(O)}}return M}const TC=new Jr,o5=new jt,v1e={strategy:EU,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class l0{static serialize(e,t={}){t={cloneBuffers:!0,...t};const i=e.geometry,n=e._roots,r=e._indirectBuffer,o=i.getIndex();let a;return t.cloneBuffers?a={roots:n.map(l=>l.slice()),index:o?o.array.slice():null,indirectBuffer:r?r.slice():null}:a={roots:n,index:o?o.array:null,indirectBuffer:r},a}static deserialize(e,t,i={}){i={setIndex:!0,indirect:!!e.indirectBuffer,...i};const{index:n,roots:r,indirectBuffer:o}=e,a=new l0(t,{...i,[fB]:!0});if(a._roots=r,a._indirectBuffer=o||null,i.setIndex){const l=t.getIndex();if(l===null){const c=new Ke(e.index,1,!1);t.setIndex(c)}else l.array!==n&&(l.array.set(n),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({...v1e,[fB]:!1},t),t.useSharedArrayBuffer&&!RX())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[fB]||(OCe(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new jt))),this.resolveTriangleIndex=t.indirect?i=>this._indirectBuffer[i]:i=>i}refit(e=null){return(this.indirect?a1e:XCe)(this,e)}traverse(e,t=0){const i=this._roots[t],n=new Uint32Array(i),r=new Uint16Array(i);o(0);function o(a,l=0){const c=a*2,h=r[c+15]===ZT;if(h){const u=n[a+6],f=r[c+14];e(l,h,new Float32Array(i,a*4,6),u,f)}else{const u=a+Nd/4,f=n[a+6],p=n[a+7];e(l,h,new Float32Array(i,a*4,6),p)||(o(u,l+1),o(f,l+1))}}}raycast(e,t=$n,i=0,n=1/0){const r=this._roots,o=this.geometry,a=[],l=t.isMaterial,c=Array.isArray(t),h=o.groups,u=l?t.side:t,f=this.indirect?l1e:ZCe;for(let p=0,m=r.length;p<m;p++){const v=c?t[h[p].materialIndex].side:u,g=a.length;if(f(this,p,v,e,a,i,n),c){const y=h[p].materialIndex;for(let A=g,_=a.length;A<_;A++)a[A].face.materialIndex=y}}return a}raycastFirst(e,t=$n,i=0,n=1/0){const r=this._roots,o=this.geometry,a=t.isMaterial,l=Array.isArray(t);let c=null;const h=o.groups,u=a?t.side:t,f=this.indirect?h1e:e1e;for(let p=0,m=r.length;p<m;p++){const v=l?t[h[p].materialIndex].side:u,g=f(this,p,v,e,i,n);g!=null&&(c==null||g.distance<c.distance)&&(c=g,l&&(g.face.materialIndex=h[p].materialIndex))}return c}intersectsGeometry(e,t){let i=!1;const n=this._roots,r=this.indirect?u1e:t1e;for(let o=0,a=n.length;o<a&&(i=r(this,o,e,t),!i);o++);return i}shapecast(e){const t=nl.getPrimitive(),i=this.indirect?JCe:qCe;let{boundsTraverseOrder:n,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=e;if(o&&a){const u=o;o=(f,p,m,v,g)=>u(f,p,m,v,g)?!0:i(f,p,this,a,m,v,t)}else o||(a?o=(u,f,p,m)=>i(u,f,this,a,p,m,t):o=(u,f,p)=>p);let l=!1,c=0;const h=this._roots;for(let u=0,f=h.length;u<f;u++){const p=h[u];if(l=zCe(this,u,r,o,n,c),l)break;c+=p.byteLength}return nl.releasePrimitive(t),l}bvhcast(e,t,i){let{intersectsRanges:n,intersectsTriangles:r}=i;const o=nl.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?m=>{const v=this.resolveTriangleIndex(m);hs(o,v*3,a,l)}:m=>{hs(o,m*3,a,l)},h=nl.getPrimitive(),u=e.geometry.index,f=e.geometry.attributes.position,p=e.indirect?m=>{const v=e.resolveTriangleIndex(m);hs(h,v*3,u,f)}:m=>{hs(h,m*3,u,f)};if(r){const m=(v,g,y,A,_,b,x,E)=>{for(let M=y,T=y+A;M<T;M++){p(M),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let R=v,w=v+g;R<w;R++)if(c(R),o.needsUpdate=!0,r(o,h,R,M,_,b,x,E))return!0}return!1};if(n){const v=n;n=function(g,y,A,_,b,x,E,M){return v(g,y,A,_,b,x,E,M)?!0:m(g,y,A,_,b,x,E,M)}}else n=m}return y1e(this,e,t,n)}intersectsBox(e,t){return TC.set(e.min,e.max,t),TC.needsUpdate=!0,this.shapecast({intersectsBounds:i=>TC.intersectsBox(i),intersectsTriangle:i=>TC.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},n={},r=0,o=1/0){return(this.indirect?g1e:o1e)(this,e,t,i,n,r,o)}closestPointToPoint(e,t={},i=0,n=1/0){return GCe(this,e,t,i,n)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{Zi(0,new Float32Array(i),o5),e.union(o5)}),e}}const a5=new jt;class A1e extends ye{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}constructor(e,t,i=10,n=0){super(),this.material=t,this.geometry=new yt,this.name="MeshBVHRootHelper",this.depth=i,this.displayParents=!1,this.bvh=e,this.displayEdges=!0,this._group=n}raycast(){}update(){const e=this.geometry,t=this.bvh,i=this._group;if(e.dispose(),this.visible=!1,t){const n=this.depth-1,r=this.displayParents;let o=0;t.traverse((f,p)=>{if(f>=n||p)return o++,!0;r&&o++},i);let a=0;const l=new Float32Array(8*3*o);t.traverse((f,p,m)=>{const v=f>=n||p;if(v||r){Zi(0,m,a5);const{min:g,max:y}=a5;for(let A=-1;A<=1;A+=2){const _=A<0?g.x:y.x;for(let b=-1;b<=1;b+=2){const x=b<0?g.y:y.y;for(let E=-1;E<=1;E+=2){const M=E<0?g.z:y.z;l[a+0]=_,l[a+1]=x,l[a+2]=M,a+=3}}}return v}},i);let c,h;this.displayEdges?h=new Uint8Array([0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]):h=new Uint8Array([0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),l.length>65535?c=new Uint32Array(h.length*o):c=new Uint16Array(h.length*o);const u=h.length;for(let f=0;f<o;f++){const p=f*8,m=f*u;for(let v=0;v<u;v++)c[m+v]=p+h[v]}e.setIndex(new Ke(c,1,!1)),e.setAttribute("position",new Ke(l,3,!1)),this.visible=!0}}}class RU extends Vs{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(e){this.edgeMaterial.opacity=e,this.meshMaterial.opacity=e}constructor(e=null,t=null,i=10){e instanceof l0&&(i=t||10,t=e,e=null),typeof t=="number"&&(i=t,t=null),super(),this.name="MeshBVHHelper",this.depth=i,this.mesh=e,this.bvh=t,this.displayParents=!1,this.displayEdges=!0,this._roots=[];const n=new ji({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),r=new ti({color:65416,transparent:!0,opacity:.3,depthWrite:!1});r.color=n.color,this.edgeMaterial=n,this.meshMaterial=r,this.update()}update(){const e=this.bvh||this.mesh.geometry.boundsTree,t=e?e._roots.length:0;for(;this._roots.length>t;){const i=this._roots.pop();i.geometry.dispose(),this.remove(i)}for(let i=0;i<t;i++){const{depth:n,edgeMaterial:r,meshMaterial:o,displayParents:a,displayEdges:l}=this;if(i>=this._roots.length){const h=new A1e(e,r,n,i);this.add(h),this._roots.push(h)}const c=this._roots[i];c.bvh=e,c.depth=n,c.displayParents=a,c.displayEdges=l,c.material=l?r:o,c.update()}}updateMatrixWorld(...e){const t=this.mesh,i=this.parent;t!==null&&(t.updateWorldMatrix(!0,!1),i?this.matrix.copy(i.matrixWorld).invert().multiply(t.matrixWorld):this.matrix.copy(t.matrixWorld),this.matrix.decompose(this.position,this.quaternion,this.scale)),super.updateMatrixWorld(...e)}copy(e){this.depth=e.depth,this.mesh=e.mesh,this.bvh=e.bvh,this.opacity=e.opacity,this.color.copy(e.color)}clone(){return new RU(this.mesh,this.bvh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].geometry.dispose()}}const hA=new jt,l5=new jt,Xg=new S;function c5(s){switch(typeof s){case"number":return 8;case"string":return s.length*2;case"boolean":return 4;default:return 0}}function _1e(s){return/(Uint|Int|Float)(8|16|32)Array/.test(s.constructor.name)}function b1e(s,e){const t={nodeCount:0,leafNodeCount:0,depth:{min:1/0,max:-1/0},tris:{min:1/0,max:-1/0},splits:[0,0,0],surfaceAreaScore:0};return s.traverse((i,n,r,o,a)=>{const l=r[3]-r[0],c=r[1+3]-r[1],h=r[2+3]-r[2],u=2*(l*c+c*h+h*l);t.nodeCount++,n?(t.leafNodeCount++,t.depth.min=Math.min(i,t.depth.min),t.depth.max=Math.max(i,t.depth.max),t.tris.min=Math.min(a,t.tris.min),t.tris.max=Math.max(a,t.tris.max),t.surfaceAreaScore+=u*M1*a):(t.splits[o]++,t.surfaceAreaScore+=u*_O)},e),t.tris.min===1/0&&(t.tris.min=0,t.tris.max=0),t.depth.min===1/0&&(t.depth.min=0,t.depth.max=0),t}function x1e(s){return s._roots.map((e,t)=>b1e(s,t))}function w1e(s){const e=new Set,t=[s];let i=0;for(;t.length;){const n=t.pop();if(!e.has(n)){e.add(n);for(let r in n){if(!Object.hasOwn(n,r))continue;i+=c5(r);const o=n[r];o&&(typeof o=="object"||typeof o=="function")?_1e(o)||RX()&&o instanceof SharedArrayBuffer||o instanceof ArrayBuffer?i+=o.byteLength:t.push(o):i+=c5(o)}}}return i}function S1e(s){const e=s.geometry,t=[],i=e.index,n=e.getAttribute("position");let r=!0;return s.traverse((o,a,l,c,h)=>{const u={depth:o,isLeaf:a,boundingData:l,offset:c,count:h};t[o]=u,Zi(0,l,hA);const f=t[o-1];if(a)for(let p=c,m=c+h;p<m;p++){const v=s.resolveTriangleIndex(p);let g=3*v,y=3*v+1,A=3*v+2;i&&(g=i.getX(g),y=i.getX(y),A=i.getX(A));let _;Xg.fromBufferAttribute(n,g),_=hA.containsPoint(Xg),Xg.fromBufferAttribute(n,y),_=_&&hA.containsPoint(Xg),Xg.fromBufferAttribute(n,A),_=_&&hA.containsPoint(Xg),console.assert(_,"Leaf bounds does not fully contain triangle."),r=r&&_}if(f){Zi(0,l,l5);const p=l5.containsBox(hA);console.assert(p,"Parent bounds does not fully contain child."),r=r&&p}}),r}function C1e(s){const e=[];return s.traverse((t,i,n,r,o)=>{const a={bounds:Zi(0,n,new jt)};i?(a.count=o,a.offset=r):(a.left=null,a.right=null),e[t]=a;const l=e[t-1];l&&(l.left===null?l.left=a:l.right=a)}),e[0]}function h5(s,e,t){return s===null?null:(s.point.applyMatrix4(e.matrixWorld),s.distance=s.point.distanceTo(t.ray.origin),s.object=e,s)}const IC=new _o,u5=new S,d5=new le,E1e=fe.prototype.raycast,f5=new S;function M1e(s,e){if(this.geometry.boundsTree){if(this.material===void 0)return;d5.copy(this.matrixWorld).invert(),IC.copy(s.ray).applyMatrix4(d5),R1e(this.matrixWorld,f5),u5.copy(IC.direction).multiply(f5);const t=u5.length(),i=s.near/t,n=s.far/t,r=this.geometry.boundsTree;if(s.firstHitOnly===!0){const o=h5(r.raycastFirst(IC,this.material,i,n),this,s);o&&e.push(o)}else{const o=r.raycast(IC,this.material,i,n);for(let a=0,l=o.length;a<l;a++){const c=h5(o[a],this,s);c&&e.push(c)}}}else E1e.call(this,s,e)}function T1e(s){return this.boundsTree=new l0(this,s),this.boundsTree}function I1e(){this.boundsTree=null}function R1e(s,e){const t=s.elements,i=e.set(t[0],t[1],t[2]).length(),n=e.set(t[4],t[5],t[6]).length(),r=e.set(t[8],t[9],t[10]).length();return e.set(i,n,r)}function P1e(s){switch(s){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function B1e(s){switch(s){case 1:return um;case 2:return qE;case 3:return Li;case 4:return Li}}function p5(s){switch(s){case 1:return jE;case 2:return Eb;case 3:return Ky;case 4:return Ky}}class eI extends Qr{constructor(){super(),this.minFilter=Ot,this.magFilter=Ot,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const t=this.overrideItemSize,i=e.itemSize,n=e.count;if(t!==null){if(i*n%t!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=t,e.count=n*i/t}const r=e.itemSize,o=e.count,a=e.normalized,l=e.array.constructor,c=l.BYTES_PER_ELEMENT;let h=this._forcedType,u=r;if(h===null)switch(l){case Float32Array:h=tn;break;case Uint8Array:case Uint16Array:case Uint32Array:h=Hr;break;case Int8Array:case Int16Array:case Int32Array:h=Pp;break}let f,p,m,v,g=P1e(r);switch(h){case tn:m=1,p=B1e(r),a&&c===1?(v=l,g+="8",l===Uint8Array?f=wn:(f=B1,g+="_SNORM")):(v=Float32Array,g+="32F",f=tn);break;case Pp:g+=c*8+"I",m=a?Math.pow(2,l.BYTES_PER_ELEMENT*8-1):1,p=p5(r),c===1?(v=Int8Array,f=B1):c===2?(v=Int16Array,f=OO):(v=Int32Array,f=Pp);break;case Hr:g+=c*8+"UI",m=a?Math.pow(2,l.BYTES_PER_ELEMENT*8-1):1,p=p5(r),c===1?(v=Uint8Array,f=wn):c===2?(v=Uint16Array,f=Cb):(v=Uint32Array,f=Hr);break}u===3&&(p===Li||p===Ky)&&(u=4);const y=Math.ceil(Math.sqrt(o))||1,A=u*y*y,_=new v(A),b=e.normalized;e.normalized=!1;for(let x=0;x<o;x++){const E=u*x;_[E]=e.getX(x)/m,r>=2&&(_[E+1]=e.getY(x)/m),r>=3&&(_[E+2]=e.getZ(x)/m,u===4&&(_[E+3]=1)),r>=4&&(_[E+3]=e.getW(x)/m)}e.normalized=b,this.internalFormat=g,this.format=p,this.type=f,this.image.width=y,this.image.height=y,this.image.data=_,this.needsUpdate=!0,this.dispose(),e.itemSize=i,e.count=n}}class PX extends eI{constructor(){super(),this._forcedType=Hr}}class D1e extends eI{constructor(){super(),this._forcedType=Pp}}class BX extends eI{constructor(){super(),this._forcedType=tn}}class O1e{constructor(){this.index=new PX,this.position=new BX,this.bvhBounds=new Qr,this.bvhContents=new Qr,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:t}=e;if(k1e(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(t.attributes.position),e.indirect){const i=e._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==i.length)if(t.index)this._cachedIndexAttr=t.index.clone();else{const n=CX(SX(t));this._cachedIndexAttr=new Ke(n,1,!1)}L1e(t,i,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(t.index)}dispose(){const{index:e,position:t,bvhBounds:i,bvhContents:n}=this;e&&e.dispose(),t&&t.dispose(),i&&i.dispose(),n&&n.dispose()}}function L1e(s,e,t){const i=t.array,n=s.index?s.index.array:null;for(let r=0,o=e.length;r<o;r++){const a=3*r,l=3*e[r];for(let c=0;c<3;c++)i[a+c]=n?n[l+c]:l+c}}function k1e(s,e,t){const i=s._roots;if(i.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const n=i[0],r=new Uint16Array(n),o=new Uint32Array(n),a=new Float32Array(n),l=n.byteLength/Nd,c=2*Math.ceil(Math.sqrt(l/2)),h=new Float32Array(4*c*c),u=Math.ceil(Math.sqrt(l)),f=new Uint32Array(2*u*u);for(let p=0;p<l;p++){const m=p*Nd/4,v=m*2,g=m;for(let y=0;y<3;y++)h[8*p+0+y]=a[g+0+y],h[8*p+4+y]=a[g+3+y];if(uo(v,r)){const y=da(v,r),A=ko(m,o),_=4294901760|y;f[p*2+0]=_,f[p*2+1]=A}else{const y=4*fa(m,o)/Nd,A=MU(m,o);f[p*2+0]=A,f[p*2+1]=y}}e.image.data=h,e.image.width=c,e.image.height=c,e.format=Li,e.type=tn,e.internalFormat="RGBA32F",e.minFilter=Ot,e.magFilter=Ot,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),t.image.data=f,t.image.width=u,t.image.height=u,t.format=Eb,t.type=Hr,t.internalFormat="RG32UI",t.minFilter=Ot,t.magFilter=Ot,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose()}const ip=new S,np=new S,sp=new S,m5=new Je,RC=new S,wB=new S,g5=new Je,y5=new Je,PC=new le,v5=new le;function uA(s,e){if(!s&&!e)return;const t=s.count===e.count,i=s.normalized===e.normalized,n=s.array.constructor===e.array.constructor,r=s.itemSize===e.itemSize;if(!t||!i||!n||!r)throw new Error}function GA(s,e=null){const t=s.array.constructor,i=s.normalized,n=s.itemSize,r=e===null?s.count:e;return new Ke(new t(n*r),n,i)}function DX(s,e,t=0){if(s.isInterleavedBufferAttribute){const i=s.itemSize;for(let n=0,r=s.count;n<r;n++){const o=n+t;e.setX(o,s.getX(n)),i>=2&&e.setY(o,s.getY(n)),i>=3&&e.setZ(o,s.getZ(n)),i>=4&&e.setW(o,s.getW(n))}}else{const i=e.array,n=i.constructor,r=i.BYTES_PER_ELEMENT*s.itemSize*t;new n(i.buffer,r,s.array.length).set(s.array)}}function F1e(s,e,t){const i=s.elements,n=e.elements;for(let r=0,o=n.length;r<o;r++)i[r]+=n[r]*t}function A5(s,e,t){const i=s.skeleton,n=s.geometry,r=i.bones,o=i.boneInverses;g5.fromBufferAttribute(n.attributes.skinIndex,e),y5.fromBufferAttribute(n.attributes.skinWeight,e),PC.elements.fill(0);for(let a=0;a<4;a++){const l=y5.getComponent(a);if(l!==0){const c=g5.getComponent(a);v5.multiplyMatrices(r[c].matrixWorld,o[c]),F1e(PC,v5,l)}}return PC.multiply(s.bindMatrix).premultiply(s.bindMatrixInverse),t.transformDirection(PC),t}function SB(s,e,t,i,n){RC.set(0,0,0);for(let r=0,o=s.length;r<o;r++){const a=e[r],l=s[r];a!==0&&(wB.fromBufferAttribute(l,i),t?RC.addScaledVector(wB,a):RC.addScaledVector(wB.sub(n),a))}n.add(RC)}function U1e(s,e={useGroups:!1,updateIndex:!1,skipAttributes:[]},t=new yt){const i=s[0].index!==null,{useGroups:n=!1,updateIndex:r=!1,skipAttributes:o=[]}=e,a=new Set(Object.keys(s[0].attributes)),l={};let c=0;t.clearGroups();for(let h=0;h<s.length;++h){const u=s[h];let f=0;if(i!==(u.index!==null))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const p in u.attributes){if(!a.has(p))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.');l[p]===void 0&&(l[p]=[]),l[p].push(u.attributes[p]),f++}if(f!==a.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(n){let p;if(i)p=u.index.count;else if(u.attributes.position!==void 0)p=u.attributes.position.count;else throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");t.addGroup(c,p,h),c+=p}}if(i){let h=!1;if(!t.index){let u=0;for(let f=0;f<s.length;++f)u+=s[f].index.count;t.setIndex(new Ke(new Uint32Array(u),1,!1)),h=!0}if(r||h){const u=t.index;let f=0,p=0;for(let m=0;m<s.length;++m){const v=s[m],g=v.index;if(o[m]!==!0)for(let y=0;y<g.count;++y)u.setX(f,g.getX(y)+p),f++;p+=v.attributes.position.count}}}for(const h in l){const u=l[h];if(!(h in t.attributes)){let m=0;for(const v in u)m+=u[v].count;t.setAttribute(h,GA(l[h][0],m))}const f=t.attributes[h];let p=0;for(let m=0,v=u.length;m<v;m++){const g=u[m];o[m]!==!0&&DX(g,f,p),p+=g.count}}return t}function N1e(s,e){if(s===null||e===null)return s===e;if(s.length!==e.length)return!1;for(let t=0,i=s.length;t<i;t++)if(s[t]!==e[t])return!1;return!0}function z1e(s){const{index:e,attributes:t}=s;if(e)for(let i=0,n=e.count;i<n;i+=3){const r=e.getX(i),o=e.getX(i+2);e.setX(i,o),e.setX(i+2,r)}else for(const i in t){const n=t[i],r=n.itemSize;for(let o=0,a=n.count;o<a;o+=3)for(let l=0;l<r;l++){const c=n.getComponent(o,l),h=n.getComponent(o+2,l);n.setComponent(o,l,h),n.setComponent(o+2,l,c)}}return s}class G1e{constructor(e){this.matrixWorld=new le,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=e,this.update()}update(){const e=this.mesh,t=e.geometry,i=e.skeleton,n=(t.index?t.index.count:t.attributes.position.count)/3;if(this.matrixWorld.copy(e.matrixWorld),this.geometryHash=t.attributes.position.version,this.primitiveCount=n,i){i.boneTexture||i.computeBoneTexture(),i.update();const r=i.boneMatrices;!this.boneMatrices||this.boneMatrices.length!==r.length?this.boneMatrices=r.slice():this.boneMatrices.set(r)}else this.boneMatrices=null}didChange(){const e=this.mesh,t=e.geometry,i=(t.index?t.index.count:t.attributes.position.count)/3;return!(this.matrixWorld.equals(e.matrixWorld)&&this.geometryHash===t.attributes.position.version&&N1e(e.skeleton&&e.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===i)}}class H1e{constructor(e){Array.isArray(e)||(e=[e]);const t=[];e.forEach(i=>{i.traverseVisible(n=>{n.isMesh&&t.push(n)})}),this.meshes=t,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=new Array(t.length).fill().map(()=>new yt),this._diffMap=new WeakMap}getMaterials(){const e=[];return this.meshes.forEach(t=>{Array.isArray(t.material)?e.push(...t.material):e.push(t.material)}),e}generate(e=new yt){let t=[];const{meshes:i,useGroups:n,_intermediateGeometry:r,_diffMap:o}=this;for(let a=0,l=i.length;a<l;a++){const c=i[a],h=r[a],u=o.get(c);!u||u.didChange(c)?(this._convertToStaticGeometry(c,h),t.push(!1),u?u.update():o.set(c,new G1e(c))):t.push(!0)}if(r.length===0){e.setIndex(null);const a=e.attributes;for(const l in a)e.deleteAttribute(l);for(const l in this.attributes)e.setAttribute(this.attributes[l],new Ke(new Float32Array(0),4,!1))}else U1e(r,{useGroups:n,skipAttributes:t},e);for(const a in e.attributes)e.attributes[a].needsUpdate=!0;return e}_convertToStaticGeometry(e,t=new yt){const i=e.geometry,n=this.applyWorldTransforms,r=this.attributes.includes("normal"),o=this.attributes.includes("tangent"),a=i.attributes,l=t.attributes;!t.index&&i.index&&(t.index=i.index.clone()),l.position||t.setAttribute("position",GA(a.position)),r&&!l.normal&&a.normal&&t.setAttribute("normal",GA(a.normal)),o&&!l.tangent&&a.tangent&&t.setAttribute("tangent",GA(a.tangent)),uA(i.index,t.index),uA(a.position,l.position),r&&uA(a.normal,l.normal),o&&uA(a.tangent,l.tangent);const c=a.position,h=r?a.normal:null,u=o?a.tangent:null,f=i.morphAttributes.position,p=i.morphAttributes.normal,m=i.morphAttributes.tangent,v=i.morphTargetsRelative,g=e.morphTargetInfluences,y=new Ut;y.getNormalMatrix(e.matrixWorld),i.index&&t.index.array.set(i.index.array);for(let A=0,_=a.position.count;A<_;A++)ip.fromBufferAttribute(c,A),h&&np.fromBufferAttribute(h,A),u&&(m5.fromBufferAttribute(u,A),sp.fromBufferAttribute(u,A)),g&&(f&&SB(f,g,v,A,ip),p&&SB(p,g,v,A,np),m&&SB(m,g,v,A,sp)),e.isSkinnedMesh&&(e.applyBoneTransform(A,ip),h&&A5(e,A,np),u&&A5(e,A,sp)),n&&ip.applyMatrix4(e.matrixWorld),l.position.setXYZ(A,ip.x,ip.y,ip.z),h&&(n&&np.applyNormalMatrix(y),l.normal.setXYZ(A,np.x,np.y,np.z)),u&&(n&&sp.transformDirection(e.matrixWorld),l.tangent.setXYZW(A,sp.x,sp.y,sp.z,m5.w));for(const A in this.attributes){const _=this.attributes[A];_==="position"||_==="tangent"||_==="normal"||!(_ in a)||(l[_]||t.setAttribute(_,GA(a[_])),uA(a[_],l[_]),DX(a[_],l[_]))}return e.matrixWorld.determinant()<0&&z1e(t),t}}const OX=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,LX=`

float dot2( vec3 v ) {

	return dot( v, v );

}

// https://www.shadertoy.com/view/ttfGWl
vec3 closestPointToTriangle( vec3 p, vec3 v0, vec3 v1, vec3 v2, out vec3 barycoord ) {

    vec3 v10 = v1 - v0;
    vec3 v21 = v2 - v1;
    vec3 v02 = v0 - v2;

	vec3 p0 = p - v0;
	vec3 p1 = p - v1;
	vec3 p2 = p - v2;

    vec3 nor = cross( v10, v02 );

    // method 2, in barycentric space
    vec3  q = cross( nor, p0 );
    float d = 1.0 / dot2( nor );
    float u = d * dot( q, v02 );
    float v = d * dot( q, v10 );
    float w = 1.0 - u - v;

	if( u < 0.0 ) {

		w = clamp( dot( p2, v02 ) / dot2( v02 ), 0.0, 1.0 );
		u = 0.0;
		v = 1.0 - w;

	} else if( v < 0.0 ) {

		u = clamp( dot( p0, v10 ) / dot2( v10 ), 0.0, 1.0 );
		v = 0.0;
		w = 1.0 - u;

	} else if( w < 0.0 ) {

		v = clamp( dot( p1, v21 ) / dot2( v21 ), 0.0, 1.0 );
		w = 0.0;
		u = 1.0-v;

	}

	barycoord = vec3( u, v, w );
    return u * v1 + v * v2 + w * v0;

}

float distanceToTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// point and cut off range
	vec3 point, float closestDistanceSquared,

	// outputs
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord, inout float side, inout vec3 outPoint
) {

	bool found = false;
	vec3 localBarycoord;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		// get the closest point and barycoord
		vec3 closestPoint = closestPointToTriangle( point, a, b, c, localBarycoord );
		vec3 delta = point - closestPoint;
		float sqDist = dot2( delta );
		if ( sqDist < closestDistanceSquared ) {

			// set the output results
			closestDistanceSquared = sqDist;
			faceIndices = uvec4( indices.xyz, i );
			faceNormal = normalize( cross( a - b, b - c ) );
			barycoord = localBarycoord;
			outPoint = closestPoint;
			side = sign( dot( faceNormal, delta ) );

		}

	}

	return closestDistanceSquared;

}

float distanceSqToBounds( vec3 point, vec3 boundsMin, vec3 boundsMax ) {

	vec3 clampedPoint = clamp( point, boundsMin, boundsMax );
	vec3 delta = point - clampedPoint;
	return dot( delta, delta );

}

float distanceSqToBVHNodeBoundsPoint( vec3 point, sampler2D bvhBounds, uint currNodeIndex ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return distanceSqToBounds( point, boundsMin, boundsMax );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhClosestPointToPoint(		bvh,		point, faceIndices, faceNormal, barycoord, side, outPoint	)	_bvhClosestPointToPoint(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		point, faceIndices, faceNormal, barycoord, side, outPoint	)

float _bvhClosestPointToPoint(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// point to check
	vec3 point,

	// output variables
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout vec3 outPoint
 ) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float closestDistanceSquared = pow( 100000.0, 2.0 );
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, currNodeIndex );
		if ( boundsHitDistance > closestDistanceSquared ) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );
		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;
			closestDistanceSquared = distanceToTriangles(
				bvh_position, bvh_index, offset, count, point, closestDistanceSquared,

				// outputs
				faceIndices, faceNormal, barycoord, side, outPoint
			);

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;
			bool leftToRight = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, leftIndex ) < distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, rightIndex );//rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;
			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return sqrt( closestDistanceSquared );

}
`,kX=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,FX=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,V1e=Object.freeze(Object.defineProperty({__proto__:null,bvh_distance_functions:LX,bvh_ray_functions:kX,bvh_struct_definitions:FX,common_functions:OX},Symbol.toStringTag,{value:"Module"})),Q1e=FX,W1e=LX,j1e=`
	${OX}
	${kX}
`,q1e=Object.freeze(Object.defineProperty({__proto__:null,AVERAGE:xX,BVHShaderGLSL:V1e,CENTER:EU,CONTAINED:AO,ExtendedTriangle:al,FloatVertexAttributeTexture:BX,INTERSECTED:_Ce,IntVertexAttributeTexture:D1e,MeshBVH:l0,MeshBVHHelper:RU,MeshBVHUniformStruct:O1e,NOT_INTERSECTED:ACe,OrientedBox:Jr,SAH:wX,StaticGeometryGenerator:H1e,UIntVertexAttributeTexture:PX,VertexAttributeTexture:eI,acceleratedRaycast:M1e,computeBoundsTree:T1e,disposeBoundsTree:I1e,estimateMemoryInBytes:w1e,getBVHExtremes:x1e,getJSONStructure:C1e,getTriangleHitPointInfo:QCe,shaderDistanceFunction:W1e,shaderIntersectFunction:j1e,shaderStructs:Q1e,validateBounds:S1e},Symbol.toStringTag,{value:"Module"}));class X1e{constructor(e){this.name="WorkerBase",this.running=!1,this.worker=e,this.worker.onerror=t=>{throw t.message?new Error(`${this.name}: Could not create Web Worker with error "${t.message}"`):new Error(`${this.name}: Could not create Web Worker.`)}}runTask(){}generate(...e){if(this.running)throw new Error("GenerateMeshBVHWorker: Already running job.");if(this.worker===null)throw new Error("GenerateMeshBVHWorker: Worker has been disposed.");this.running=!0;const t=this.runTask(this.worker,...e);return t.finally(()=>{this.running=!1}),t}dispose(){this.worker.terminate(),this.worker=null}}function Y1e(){return new Worker("/assets/generateMeshBVH.worker-95425733.js")}class K1e extends X1e{constructor(){super(new Y1e),this.name="GenerateMeshBVHWorker"}runTask(e,t,i={}){return new Promise((n,r)=>{if(t.getAttribute("position").isInterleavedBufferAttribute||t.index&&t.index.isInterleavedBufferAttribute)throw new Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");e.onerror=c=>{r(new Error(`GenerateMeshBVHWorker: ${c.message}`))},e.onmessage=c=>{const{data:h}=c;if(h.error)r(new Error(h.error)),e.onmessage=null;else if(h.serialized){const{serialized:u,position:f}=h,p=l0.deserialize(u,t,{setIndex:!1}),m=Object.assign({setBoundingBox:!0},i);if(t.attributes.position.array=f,u.index)if(t.index)t.index.array=u.index;else{const v=new Ke(u.index,1,!1);t.setIndex(v)}m.setBoundingBox&&(t.boundingBox=p.getBoundingBox(new jt)),i.onProgress&&i.onProgress(h.progress),n(p),e.onmessage=null}else i.onProgress&&i.onProgress(h.progress)};const o=t.index?t.index.array:null,a=t.attributes.position.array,l=[a];o&&l.push(o),e.postMessage({index:o,position:a,options:{...i,onProgress:null,includedProgressCallback:!!i.onProgress,groups:[...t.groups]}},l.map(c=>c.buffer).filter(c=>typeof SharedArrayBuffer>"u"||!(c instanceof SharedArrayBuffer)))})}}const J1e=Object.freeze(Object.defineProperty({__proto__:null,GenerateMeshBVHWorker:K1e},Symbol.toStringTag,{value:"Module"})),Fa={node:"node",material:"material",camera:"camera",light:"light"},rp="KHR_animation_pointer",Z1e={CUBICSPLINE:void 0,LINEAR:Fc,STEP:Hd},_5=Zt.findNode;let b5=!1;class $1e{constructor(e){this.parser=e,this.name=rp,this.animationPointerResolver=null}setAnimationPointerResolver(e){return this.animationPointerResolver=e,this}_patchPropertyBindingFindNode(){b5||(b5=!0,Zt.findNode=function(e,t){if(t.startsWith(".materials.")){const i=t.substring(11).substring(t.indexOf(".")),n=i.indexOf("."),r=n<0?i:i.substring(0,n);let o=null;return e.traverse(a=>{o!==null||a.type!=="Mesh"&&a.type!=="SkinnedMesh"||a.material&&(a.material.uuid===r||a.material.name===r)&&(o=a.material,o!==null&&(i.endsWith(".map")?o=o.map:i.endsWith(".emissiveMap")&&(o=o.emissiveMap)))}),o}else if(t.startsWith(".nodes.")||t.startsWith(".lights.")||t.startsWith(".cameras.")){const i=t.split(".");let n;for(let r=1;r<i.length;r++){const o=i[r];if(o.length==36)n=e.getObjectByProperty("uuid",o);else if(n&&n[o]){const l=Number.parseInt(o);let c=o;l>=0&&(c=l),n=n[c]}else{const l=e.getObjectByName(o);l&&(n=l)}}if(!n){const r=_5(e,i[2]);return r||console.warn(rp+": Property binding not found",t,e,e.name,i),r}return n}return _5(e,t)})}loadAnimationTargetFromChannel(e){const t=e.target,i=t.node!==void 0?t.node:t.id;return this.parser.getDependency("node",i)}loadAnimationTargetFromChannelWithAnimationPointer(e){this._havePatchedPropertyBindings||this._patchPropertyBindingFindNode();const t=e.target,i=t.extensions&&t.extensions[rp]&&t.path&&t.path==="pointer";if(!i)return null;let n,r=Fa.node,o;if(i){const l=t.extensions[rp];let c=l.pointer;if(!c){console.warn("Invalid path",l,t);return}if(c.startsWith("/materials/")?r=Fa.material:c.startsWith("/extensions/KHR_lights_punctual/lights/")?r=Fa.light:c.startsWith("/cameras/")&&(r=Fa.camera),o=this._tryResolveTargetId(c,r),o===null||isNaN(o)){console.warn("Failed resolving animation node id: "+o,c);return}switch(r){case Fa.material:const u=("/materials/"+o.toString()+"/").length,f=c.substring(0,u);switch(n=c.substring(u),n){case"pbrMetallicRoughness/baseColorFactor":n="color";break;case"pbrMetallicRoughness/roughnessFactor":n="roughness";break;case"pbrMetallicRoughness/metallicFactor":n="metalness";break;case"emissiveFactor":n="emissive";break;case"alphaCutoff":n="alphaTest";break;case"occlusionTexture/strength":n="aoMapIntensity";break;case"normalTexture/scale":n="normalScale";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale":n="map/repeat";break;case"pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset":n="map/offset";break;case"emissiveTexture/extensions/KHR_texture_transform/scale":n="emissiveMap/repeat";break;case"emissiveTexture/extensions/KHR_texture_transform/offset":n="emissiveMap/offset";break;case"extensions/KHR_materials_emissive_strength/emissiveStrength":n="emissiveIntensity";break;case"extensions/KHR_materials_transmission/transmissionFactor":n="transmission";break;case"extensions/KHR_materials_ior/ior":n="ior";break;case"extensions/KHR_materials_volume/thicknessFactor":n="thickness";break;case"extensions/KHR_materials_volume/attenuationColor":n="attenuationColor";break;case"extensions/KHR_materials_volume/attenuationDistance":n="attenuationDistance";break;case"extensions/KHR_materials_iridescence/iridescenceFactor":n="iridescence";break;case"extensions/KHR_materials_iridescence/iridescenceIor":n="iridescenceIOR";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMinimum":n="iridescenceThicknessRange[0]";break;case"extensions/KHR_materials_iridescence/iridescenceThicknessMaximum":n="iridescenceThicknessRange[1]";break;case"extensions/KHR_materials_clearcoat/clearcoatFactor":n="clearcoat";break;case"extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor":n="clearcoatRoughness";break;case"extensions/KHR_materials_sheen/sheenColorFactor":n="sheenColor";break;case"extensions/KHR_materials_sheen/sheenRoughnessFactor":n="sheenRoughness";break;case"extensions/KHR_materials_specular/specularFactor":n="specularIntensity";break;case"extensions/KHR_materials_specular/specularColorFactor":n="specularColor";break}c=f+n;break;case Fa.node:const p=("/nodes/"+o.toString()+"/").length,m=c.substring(0,p);switch(n=c.substring(p),n){case"translation":n="position";break;case"rotation":n="quaternion";break;case"scale":n="scale";break;case"weights":n="morphTargetInfluences";break}c=m+n;break;case Fa.light:const v=("/extensions/KHR_lights_punctual/lights/"+o.toString()+"/").length;switch(n=c.substring(v),n){case"color":break;case"intensity":break;case"spot/innerConeAngle":n="penumbra";break;case"spot/outerConeAngle":n="angle";break;case"range":n="distance";break}c="/lights/"+o.toString()+"/"+n;break;case Fa.camera:const g=("/cameras/"+o.toString()+"/").length,y=c.substring(0,g);switch(n=c.substring(g),n){case"perspective/yfov":n="fov";break;case"perspective/znear":case"orthographic/znear":n="near";break;case"perspective/zfar":case"orthographic/zfar":n="far";break;case"perspective/aspect":n="aspect";break;case"orthographic/xmag":n="zoom";break;case"orthographic/ymag":n="zoom";break}c=y+n;break}const h=this.animationPointerResolver;h&&h.resolvePath&&(c=h.resolvePath(c)),t.extensions[rp].pointer=c}if(o===null||isNaN(o)){console.warn("Failed resolving animation node id: "+o,t);return}let a;return r===Fa.node?a=this.parser.getDependency("node",o):r===Fa.material?a=this.parser.getDependency("material",o):r===Fa.light?a=this.parser.getDependency("light",o):r===Fa.camera?a=this.parser.getDependency("camera",o):console.error("Unhandled type",r),a}createAnimationTracksWithAnimationPointer(e,t,i,n,r){if(!(r.extensions&&r.extensions[rp]&&r.path&&r.path==="pointer"))return null;let a=r.extensions[rp].pointer;if(!a)return null;const l=[];a=a.replaceAll("/",".");const c=a.split(".");var u=e.name!==void 0&&e.name!==null?e.name:e.uuid;if(c[2]=u,c[3]==="morphTargetInfluences"&&e.type==="Group"){for(const p of e.children)p instanceof Fo&&p.morphTargetInfluences&&(c[3]=p.name,c[4]="morphTargetInfluences",f(this.parser));return l}f(this.parser);function f(p){a=c.join(".");let m;switch(i.itemSize){case 1:m=ou;break;case 2:case 3:m=Uc;break;case 4:a.endsWith(".quaternion")?m=zl:m=yM;break}const v=n.interpolation!==void 0?Z1e[n.interpolation]:Fc;let g=p._getArrayFromAccessor(i);a.endsWith(".fov")&&(g=g.map(A=>A/Math.PI*180));const y=new m(a,t.array,g,v);if(v==="CUBICSPLINE"&&p._createCubicSplineTrackInterpolant(y),l.push(y),a&&i.itemSize===4&&a.startsWith(".materials.")&&a.endsWith(".color")){const A=new Float32Array(g.length/4);for(let b=0,x=g.length/4;b<x;b+=1)A[b]=g[b*4+3];const _=new m(a.replace(".color",".opacity"),t.array,A,v);v==="CUBICSPLINE"&&p._createCubicSplineTrackInterpolant(y),l.push(_)}}return l}_tryResolveTargetId(e,t){let i="";return t==="node"?i=e.substring(7):t==="material"?i=e.substring(11):t==="light"?i=e.substring(39):t==="camera"&&(i=e.substring(9)),i=i.substring(0,i.indexOf("/")),Number.parseInt(i)}loadAnimation(e){const t=this,i=this.parser.json,n=this.parser,r=i.animations[e],o=r.name?r.name:"animation_"+e,a=[],l=[],c=[],h=[],u=[];for(let f=0,p=r.channels.length;f<p;f++){const m=r.channels[f],v=r.samplers[m.sampler],g=m.target,y=r.parameters!==void 0?r.parameters[v.input]:v.input,A=r.parameters!==void 0?r.parameters[v.output]:v.output;let _=t.loadAnimationTargetFromChannelWithAnimationPointer(m);_||(_=t.loadAnimationTargetFromChannel(m)),a.push(_),l.push(n.getDependency("accessor",y)),c.push(n.getDependency("accessor",A)),h.push(v),u.push(g)}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h),Promise.all(u)]).then(function(f){const p=f[0],m=f[1],v=f[2],g=f[3],y=f[4],A=[];for(let _=0,b=p.length;_<b;_++){const x=p[_],E=m[_],M=v[_],T=g[_],R=y[_];if(x===void 0)continue;x.updateMatrix&&(x.updateMatrix(),x.matrixAutoUpdate=!0);let w=t.createAnimationTracksWithAnimationPointer(x,E,M,T,R);if(w||(w=n._createAnimationTracks(x,E,M,T,R)),w)for(let I=0;I<w.length;I++)A.push(w[I])}return new go(o,void 0,A)})}}const eEe=Object.freeze(Object.defineProperty({__proto__:null,GLTFAnimationPointerExtension:$1e},Symbol.toStringTag,{value:"Module"}));exports.$physicsKey=eCe;exports.ActionBuilder=Ai;exports.ActionCollection=aF;exports.ActionModel=Ro;exports.Addressables=O9;exports.AlignmentConstraint=nx;exports.AmbientMode=zy;exports.Animation=Wr;exports.AnimationCurve=_m;exports.AnimationExtension=cx;exports.AnimationTrackHandler=uT;exports.AnimationUtils=uv;exports.Animator=vr;exports.AnimatorConditionMode=ld;exports.AnimatorController=Aa;exports.AnimatorControllerParameterType=fF;exports.AnimatorStateInfo=BA;exports.Antialiasing=ux;exports.Application=Nl;exports.ApplicationEvents=hE;exports.AssetDatabase=jj;exports.AssetReference=ei;exports.AudioExtension=cf;exports.AudioListener=Fd;exports.AudioSource=Hn;exports.AudioTrackHandler=Vp;exports.Avatar=qd;exports.AvatarBlink_Simple=xm;exports.AvatarEyeLook_Rotation=Uv;exports.AvatarLoader=bF;exports.AvatarMarker=Ss;exports.AvatarModel=yT;exports.Avatar_Brain_LookAt=sb;exports.Avatar_MouthShapes=fx;exports.Avatar_MustacheShake=AF;exports.Avatar_POI=Lc;exports.Axes=wy;exports.AxesHelper=Nv;exports.BUILD_TIME=ok;exports.BaseUIComponent=ol;exports.BasicIKConstraint=wF;exports.BehaviorExtension=vT;exports.BehaviorModel=cs;exports.Behaviour=Ie;exports.BloomEffect=wm;exports.BoxCollider=Gv;exports.BoxGizmo=Cm;exports.BoxHelperComponent=el;exports.Button=fu;exports.ButtonsFactory=Ll;exports.CallDirection=U7;exports.CallInfo=_c;exports.Camera=Hi;exports.CameraTargetReachedEvent=ib;exports.Canvas=Ar;exports.CanvasGroup=Xd;exports.CapsuleCollider=au;exports.ChangeMaterialOnClick=Qv;exports.ChangeTransformOnClick=Mm;exports.CharacterController=Im;exports.CharacterControllerInput=mu;exports.ChromaticAberration=Ax;exports.CircularBuffer=ba;exports.ClearFlags=kd;exports.ClipExtrapolation=hc;exports.Collider=Ea;exports.Collision=dX;exports.CollisionDetectionMode=aT;exports.ColorAdjustments=pf;exports.ColorBySpeedModule=Rm;exports.ColorOverLifetimeModule=bx;exports.Component=Ie;exports.ComponentEvents=Xb;exports.ComponentLifecycleEvents=Yb;exports.ConnectionEvents=Nj;exports.ContactPoint=uX;exports.ContactShadows=Zc;exports.Context=Dt;exports.ContextArgs=Jpe;exports.ContextEvent=Ti;exports.ContextRegistry=mi;exports.ControlTrackHandler=dT;exports.CustomBranding=Af;exports.CustomShader=ta;exports.DefaultReflectionMode=mE;exports.Deletable=VF;exports.DeleteBox=MT;exports.DepthOfField=Yl;exports.DeviceFlag=TT;exports.DocumentExtension=QF;exports.DragControls=Lo;exports.DragMode=WF;exports.DropListener=_f;exports.Duplicatable=Dm;exports.EffectWrapper=lb;exports.EmissionModule=Jc;exports.EmphasizeOnClick=Wv;exports.EngineLoadingView=a_;exports.EventList=Sn;exports.EventListEvent=oT;exports.EventSystem=Oo;exports.EventTrigger=RT;exports.FieldWithDefault=NF;exports.FileReference=Ny;exports.FileReferenceSerializer=k9;exports.FileSpawnModel=lq;exports.File_Event=aq;exports.FixedJoint=KF;exports.FlyControls=JF;exports.Fog=Jv;exports.FrameEvent=nn;exports.GENERATOR=OM;exports.GameObject=ne;exports.Gizmos=_t;exports.GltfExport=Mx;exports.GltfExportBox=$F;exports.GltfLoadEvent=Xp;exports.GltfLoadEventType=Qq;exports.Gradient=mf;exports.Graphic=Em;exports.GraphicRaycaster=lT;exports.Graphics=ja;exports.GridHelper=Zv;exports.GridLayoutGroup=PF;exports.GroundProjectedEnv=du;exports.GroupActionModel=bd;exports.HideFlags=x9;exports.HideOnStart=DF;exports.HingeJoint=Ex;exports.HorizontalLayoutGroup=RF;exports.HostData=Sfe;exports.Image=Vv;exports.ImageReference=Uy;exports.ImageReferenceSerializer=L9;exports.InheritVelocityModule=yf;exports.Input=WW;exports.InputEventQueue=Ka;exports.InputEvents=vn;exports.InputField=Om;exports.InstanceHandle=Wp;exports.InstancingHandler=Qp;exports.InstancingUtil=sl;exports.InstantiateEvent=n9;exports.InstantiateIdProvider=Ms;exports.InstantiateOptions=Xl;exports.Interactable=HF;exports.JoinedRoomResponse=kde;exports.KeyEventArgs=Wue;exports.Keyframe=ul;exports.LODGroup=Ix;exports.LODModel=Lm;exports.LeftRoomResponse=Fde;exports.Light=Qo;exports.LightData=X9;exports.LimitVelocityOverLifetimeModule=ys;exports.LoadingElementOptions=rme;exports.LogStats=tU;exports.LogType=la;exports.LookAt=km;exports.LookAtConstraint=bm;exports.MainModule=Cr;exports.MarkerType=dF;exports.MaskableGraphic=mx;exports.Mathf=it;exports.MeshCollider=Sm;exports.MeshRenderer=_x;exports.MinMaxCurve=At;exports.MinMaxGradient=Ho;exports.NEEDLE_progressive=yi;exports.NEKeyboardEvent=AA;exports.NEPointerEvent=Ph;exports.NeedleButtonElement=CU;exports.NeedleEngine=mi;exports.NeedleEngineHTMLElement=vU;exports.NeedleGltfLoader=mU;exports.NeedleMenu=$c;exports.NeedlePatchesKey=$C;exports.NeedleUSDZExporter=m7;exports.NeedleXRController=Mk;exports.NeedleXRSession=Mt;exports.NeedleXRSync=Hj;exports.NeedleXRUtils=Wj;exports.NestedGltf=OT;exports.NetworkConnection=Gj;exports.NetworkedStreamEvents=Ic;exports.NetworkedStreams=dx;exports.Networking=$v;exports.NewInstanceModel=r9;exports.NoiseModule=Pi;exports.ObjectRaycaster=wa;exports.ObjectUtils=Iv;exports.OffsetConstraint=Fm;exports.OneEuroFilter=JC;exports.OneEuroFilterXYZ=KL;exports.OpenURL=e0;exports.OrbitControls=Ei;exports.Outline=Hv;exports.OwnershipEvent=zj;exports.OwnershipModel=kk;exports.Padding=df;exports.ParticleBurst=ab;exports.ParticleSubEmitter=HT;exports.ParticleSystem=fs;exports.ParticleSystemBaseBehaviour=bf;exports.ParticleSystemRenderer=pl;exports.ParticleSystemShapeType=wE;exports.PeerHandle=Vy;exports.PeerNetworking=Uj;exports.Physics=Fy;exports.PhysicsExtension=ST;exports.PhysicsMaterialCombine=ks;exports.PixelationEffect=Bx;exports.PlayAnimationOnClick=cm;exports.PlayAudioOnClick=Yd;exports.PlayableDirector=jd;exports.PlayerColor=fv;exports.PlayerState=ha;exports.PlayerStateEvent=L7;exports.PlayerSync=Fv;exports.PlayerView=W9;exports.PlayerViewManager=j9;exports.PointerEventData=Ov;exports.PointerType=QM;exports.PostProcessingEffect=Sr;exports.PostProcessingHandler=VT;exports.PostProcessingManager=s0;exports.PreliminaryAction=jv;exports.PreliminaryTrigger=yx;exports.PrimitiveType=om;exports.Progress=ai;exports.PromiseAllWithErrors=TM;exports.PromiseErrorResult=T2;exports.RGBAColor=Ui;exports.RapierPhysics=hp;exports.RawImage=_T;exports.RaycastOptions=zc;exports.Rect=MF;exports.RectTransform=Xr;exports.ReflectionProbe=qv;exports.RegisteredAnimationInfo=pT;exports.RemoteSkybox=Vc;exports.RenderTexture=Od;exports.RenderTextureSerializer=S7;exports.Renderer=Vn;exports.RendererData=q9;exports.RendererLightmap=rb;exports.Rigidbody=Ni;exports.RigidbodyConstraints=jn;exports.RoomEvents=Qt;exports.RotationBySpeedModule=Ia;exports.RotationOverLifetimeModule=fl;exports.SceneLightSettings=bE;exports.SceneSwitcher=Ys;exports.ScreenCapture=xf;exports.ScreenSpaceAmbientOcclusion=Au;exports.ScreenSpaceAmbientOcclusionN8=Kl;exports.SendQueue=Bl;exports.SerializationContext=qk;exports.SetActiveOnClick=Tm;exports.ShadowCatcher=Ux;exports.ShapeModule=On;exports.SharpeningEffect=Ox;exports.SignalAsset=ax;exports.SignalReceiver=kv;exports.SignalReceiverEvent=Lv;exports.SignalTrackHandler=nb;exports.Size=EF;exports.SizeBySpeedModule=xo;exports.SizeOverLifetimeModule=gf;exports.SkinnedMeshRenderer=zF;exports.SmoothFollow=wf;exports.SpatialGrabRaycaster=Ld;exports.SpatialHtml=Nx;exports.SpatialTrigger=Gx;exports.SpatialTriggerReceiver=kc;exports.SpectatorCamera=WT;exports.SphereCollider=zv;exports.SphereIntersection=Nk;exports.SphereOverlapResult=fX;exports.Sprite=yu;exports.SpriteData=Yv;exports.SpriteRenderer=Vo;exports.SpriteSheet=xx;exports.StateMachineBehaviour=Pye;exports.StreamEndedEvent=yF;exports.StreamReceivedEvent=F7;exports.SubEmitterSystem=fb;exports.SyncedCamera=jT;exports.SyncedRoom=Jl;exports.SyncedTransform=Gc;exports.TapGestureTrigger=OF;exports.TeleportTarget=wT;exports.TestRunner=uU;exports.TestSceneUtils=nCe;exports.TestSimulateUserData=dU;exports.Text=Yr;exports.TextBuilder=CT;exports.TextExtension=wx;exports.TextureSheetAnimationModule=Er;exports.TiltShiftEffect=th;exports.Time=Y9;exports.ToneMappingEffect=Kd;exports.TrackHandler=lx;exports.TrackType=ea;exports.TrailModule=Mn;exports.TransformData=os;exports.TransformGizmo=Nm;exports.TriggerBuilder=Qs;exports.TriggerModel=iu;exports.TypeStore=J;exports.UIRaycastUtils=cT;exports.UIRootComponent=rx;exports.USDObject=mr;exports.USDWriter=p7;exports.USDZExporter=Gn;exports.USDZText=xd;exports.USDZUIExtension=ET;exports.Upload_Result=CD;exports.UriSerializer=C7;exports.UsageMarker=Sx;exports.UserJoinedOrLeftRoomModel=Ude;exports.VERSION=tl;exports.VariantAction=oF;exports.VelocityOverLifetimeModule=Ln;exports.VerticalLayoutGroup=IF;exports.VideoPlayer=Rs;exports.ViewDevice=Pd;exports.Vignette=zm;exports.VisibilityAction=vx;exports.Voip=hf;exports.Volume=s0;exports.VolumeParameter=Ze;exports.VolumeProfile=hx;exports.WaitForFrames=upe;exports.WaitForPromise=U9;exports.WaitForSeconds=F9;exports.Watch=Zh;exports.WebARCameraBackground=XT;exports.WebARSessionRoot=lu;exports.WebXR=Qn;exports.WebXRButtonFactory=nu;exports.WebXRImageTracking=pv;exports.WebXRImageTrackingModel=ih;exports.WebXRPlaneTracking=_u;exports.WebXRTrackedImage=wd;exports.XRControllerFollow=bu;exports.XRControllerModel=Hc;exports.XRControllerMovement=Sa;exports.XRFlag=ra;exports.XRRig=YT;exports.XRState=fr;exports.XRStateFlag=bc;exports.__Ignore=pU;exports.__internalNotifyObjectDestroyed=Jj;exports.activeInHierarchyFieldName=$h;exports.addAttributeChangeCallback=M6;exports.addComponent=va;exports.addCustomExtensionPlugin=U0e;exports.addFile=cq;exports.addFileFromUrl=hq;exports.addGltfLoadEventListener=TSe;exports.addNewComponent=zp;exports.addPatch=FM;exports.apply=JM;exports.applyHMRChanges=zSe;exports.applyPrototypeExtensions=g9;exports.beginListenDestroy=s9;exports.beginListenFileSpawn=uq;exports.beginListenInstantiate=o9;exports.binaryIdentifierCasts=Ik;exports.build_scene_functions=Kpe;exports.builtinComponentKeyName=fp;exports.calculateProgress01=nF;exports.clearBalloonMessages=L6;exports.clearOverlayMessages=L6;exports.colorSerializer=kge;exports.compareAssociation=h9;exports.componentSerializer=y1;exports.copyTexture=RQ;exports.createLoader=gU;exports.createMotion=P7;exports.debugNet=oo;exports.debugOwner=wA;exports.deepClone=Fb;exports.delay=Nc;exports.delayForFrames=CM;exports.deserializeObject=cE;exports.destroy=xa;exports.destroyComponentInstance=A9;exports.disposeObjectResources=Xi;exports.disposeStream=Rc;exports.download=D9;exports.download_file=Jk;exports.editorGuidKeyName=qA;exports.effectsOrder=aO;exports.enableSpatialConsole=Lp;exports.euler=Uge;exports.eventListSerializer=Hge;exports.exportAsGLTF=cCe;exports.findByGuid=tx;exports.findObjectOfType=KM;exports.findObjectsOfType=b9;exports.findResourceUsers=Gk;exports.fitObjectIntoVolume=BQ;exports.foreachComponent=lm;exports.foreachComponentEnumerator=$M;exports.forward=roe;exports.generateQRCode=I6;exports.generateSeed=XM;exports.getBoundingBox=Hl;exports.getCameraController=EQ;exports.getComponent=ym;exports.getComponentInChildren=ex;exports.getComponentInParent=Z_;exports.getComponents=$b;exports.getComponentsInChildren=Rv;exports.getComponentsInParent=YM;exports.getFormattedDate=h7;exports.getIconElement=dr;exports.getIconTexture=BD;exports.getIp=cie;exports.getIpAndLocation=hie;exports.getIpCloudflare=lie;exports.getLoader=Gl;exports.getOrAddComponent=Zb;exports.getParam=ie;exports.getParentHierarchyPath=loe;exports.getPath=sie;exports.getPeerOptions=Bde;exports.getPeerjsInstance=Fj;exports.getResourceUserCount=sfe;exports.getTempColor=TQ;exports.getTempQuaternion=fc;exports.getTempVector=wt;exports.getUrlParams=kb;exports.getVisibleInCustomShadowRendering=PQ;exports.getWorldDirection=$L;exports.getWorldEuler=ek;exports.getWorldPosition=Ft;exports.getWorldQuaternion=ki;exports.getWorldRotation=Gb;exports.getWorldScale=$i;exports.hasCommercialLicense=tu;exports.hasIndieLicense=iF;exports.hasPointerEventComponent=AE;exports.hasProLicense=Bd;exports.hash=Kk;exports.hideDebugConsole=kQ;exports.imageToCanvas=v7;exports.instantiate=Bv;exports.invokeAfterImportPluginHooks=UF;exports.invokeXRSessionEnd=VW;exports.invokeXRSessionStart=HW;exports.isActiveInHierarchy=w9;exports.isActiveSelf=Pv;exports.isAndroidDevice=C6;exports.isAnimationAction=IQ;exports.isDebugMode=eie;exports.isDesktop=ev;exports.isDestroyed=am;exports.isDevEnvironment=nt;exports.isDisposed=ife;exports.isExporting=rCe;exports.isHostedOnGlitch=A6;exports.isHotReloading=kSe;exports.isIconElement=J9;exports.isLocalNetwork=yo;exports.isMacOS=E6;exports.isMobileDevice=Wc;exports.isMozillaXR=Dp;exports.isQuest=MM;exports.isResourceTrackingEnabled=Xj;exports.isSafari=Dy;exports.isUsingInstancing=ZM;exports.isiOS=Vd;exports.loadSync=yU;exports.logHierarchy=Y1;exports.lookAtInverse=Zre;exports.lookAtObject=zb;exports.makeId=iie;exports.makeIdFromRandomWords=x6;exports.makeNameSafeForUSD=Wl;exports.markAsInstancedRendered=S9;exports.microphonePermissionsGranted=mA;exports.nameof=$te;exports.nameofFactory=_6;exports.objectSerializer=w7;exports.offXRSessionEnd=Fue;exports.offXRSessionStart=kue;exports.onAfterRender=$ge;exports.onBeforeRender=M7;exports.onClear=Jge;exports.onDestroy=Zge;exports.onInitialized=Kge;exports.onStart=cF;exports.onUpdate=hF;exports.onXRSessionEnd=Ek;exports.onXRSessionStart=VM;exports.parseSync=jq;exports.placeOnSurface=DQ;exports.postprocessFBXMaterials=sk;exports.prefix=tye;exports.pushState=b6;exports.randomNumber=nie;exports.registerBinaryType=Rk;exports.registerComponent=iT;exports.registerComponentExtension=LF;exports.registerCustomEffectType=dl;exports.registerExportExtensions=FF;exports.registerExtensions=kF;exports.registerHotReloadType=FSe;exports.registerLoader=xL;exports.registerPrefabProvider=l9;exports.registerPrototypeExtensions=y9;exports.registerType=Ife;exports.relativePathPrefix=S6;exports.removeAttributeChangeCallback=T6;exports.removeComponent=Yk;exports.removeCustomImportExtensionType=N0e;exports.removeGltfLoadEventListener=ISe;exports.removePatch=Ble;exports.resolveUrl=nf;exports.sanitizeString=w6;exports.saveImage=mX;exports.screenshot=sCe;exports.screenshot2=pX;exports.sendDestroyed=Vk;exports.serializable=C;exports.serializeObject=d9;exports.serializeable=Dv;exports.setActive=r_;exports.setAllowBalloonMessages=D6;exports.setAllowOverlayMessages=pie;exports.setAutoFitEnabled=k2;exports.setCameraController=O2;exports.setDestroyed=E9;exports.setDevEnvironment=goe;exports.setDisposable=zk;exports.setDontDestroy=xD;exports.setOrAddParamsToUrl=M2;exports.setParam=tie;exports.setParamWithoutReload=H1;exports.setPeerOptions=Dde;exports.setResourceTrackingEnabled=tfe;exports.setState=wL;exports.setVisibleInCustomShadowRendering=nk;exports.setWorldEuler=tk;exports.setWorldPosition=Es;exports.setWorldPositionXYZ=rm;exports.setWorldQuaternion=rl;exports.setWorldQuaternionXYZW=ZL;exports.setWorldRotation=ik;exports.setWorldRotationXYZ=Hb;exports.setWorldScale=sv;exports.showBalloonError=DM;exports.showBalloonMessage=_n;exports.showBalloonWarning=Fi;exports.showDebugConsole=rk;exports.slerp=Kre;exports.syncDestroy=Kb;exports.syncField=mF;exports.syncInstantiate=Qk;exports.textureToCanvas=coe;exports.tryCastBinary=jW;exports.tryDetermineFileTypeFromBinary=Gq;exports.tryDetermineFileTypeFromURL=zq;exports.tryFindObject=$y;exports.tryGetGuid=qW;exports.unregisterHotReloadType=USe;exports.unwatchWrite=SL;exports.upload_file=B9;exports.useForAutoFit=MQ;exports.validate=wr;exports.watchWrite=EM;
